000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.   TMKUP625.                                                  
000600 AUTHOR.       MARGARET MORRISON.                                         
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                                   
000800 DATE-WRITTEN. APRIL 1999.                                                
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THIS PROGRAM EXAMINES PURCHASE ORDER AND IMPORT DATA USING A  *        
001300*  RULE BASED PROCESSOR AND THEN DETERMINES IF AN EXCEPTION      *        
001400*  EXISTS OR NO LONGER EXISTS DUE TO AN IMPORTS DATA EVENT.      *        
001500*  ONCE THIS PROCESS IS COMPLETE, A SUBROUTINE IS CALLED TO      *        
001600*  PERFORM AN UPDATE, INSERT, OR TO RESOLVE TROUBLE ON THE       *        
001700*  TROUBLE TABLES.  DETAIL AND ERROR RECORDS ARE INSERTED INTO   *        
001800*  A DB2 WORK TABLE THAT IS LATER USED IN A REPORT PROGRAM.      *        
001900******************************************************************        
002000******************************************************************        
002100 ENVIRONMENT DIVISION.                                                    
002200******************************************************************        
002300                                                                          
002400 CONFIGURATION SECTION.                                                   
002500                                                                          
002600 SOURCE-COMPUTER.        IBM-3090.                                        
002700 OBJECT-COMPUTER.        IBM-3090.                                        
002800                                                                          
002900 INPUT-OUTPUT SECTION.                                                    
003000                                                                          
003100 FILE-CONTROL.                                                            
003200                                                                          
003300******************************************************************        
003400 DATA DIVISION.                                                           
003500******************************************************************        
003600                                                                          
003700 FILE SECTION.                                                            
003800                                                                          
003900******************************************************************        
004000 WORKING-STORAGE SECTION.                                                 
004100******************************************************************        
004200                                                                          
004300******************************************************************        
004400*  DB2 FORMATTED MESSAGE AREA                                    *        
004500******************************************************************        
004600     COPY DPWS004.                                                        
004700                                                                          
004800******************************************************************        
004900*  COMMUNICATIONS AREA FOR DB2                                   *        
005000******************************************************************        
005100     EXEC SQL                                                             
005200          INCLUDE SQLCA                                                   
005300     END-EXEC.                                                            
005400                                                                          
005500******************************************************************        
005600*  DB2 TABLE DECLARATION - TROUBLE REASON CODE TABLE             *        
005700*      (TTRBRSN)                                                 *        
005800******************************************************************        
005900     EXEC SQL                                                             
006000          INCLUDE TTRBRSN                                                 
006100     END-EXEC.                                                            
006200                                                                          
006300******************************************************************        
006400*  DB2 TABLE DECLARATION - IMPORT TROUBLE REASON PROCESSING      *        
006500*      (TIMTBCT)           CONTROL TABLE                         *        
006600******************************************************************        
006700     EXEC SQL                                                             
006800          INCLUDE TIMTBCT                                                 
006900     END-EXEC.                                                            
007000                                                                          
007100******************************************************************        
007200*  DB2 TABLE DECLARATION - IMPORT TROUBLE CONTROL TABLE          *        
007300*      (TIMCNTL)                                                 *        
007400******************************************************************        
007500     EXEC SQL                                                             
007600          INCLUDE TIMCNTL                                                 
007700     END-EXEC.                                                            
007800                                                                          
007900******************************************************************        
008000*  DB2 TABLE DECLARATION - TROUBLE NOTIFICATION TABLE            *        
008100*      (TTRBNTF)                                                 *        
008200******************************************************************        
008300     EXEC SQL                                                             
008400          INCLUDE TTRBNTF                                                 
008500     END-EXEC.                                                            
008600                                                                          
008700******************************************************************        
008800*  DB2 TABLE DECLARATION - TROUBLE DETAIL TABLE                  *        
008900*      (TTRBDTL)                                                 *        
009000******************************************************************        
009100     EXEC SQL                                                             
009200          INCLUDE TTRBDTL                                                 
009300     END-EXEC.                                                            
009400                                                                          
009500******************************************************************        
009600*  DB2 TABLE DECLARATION - PO TRACKING TROUBLE KEY TABLE         *        
009700*      (TIMTBKY)                                                 *        
009800******************************************************************        
009900     EXEC SQL                                                             
010000          INCLUDE TIMTBKY                                                 
010100     END-EXEC.                                                            
010200                                                                          
010300******************************************************************        
010400*  DB2 TABLE DECLARATION - TROUBLE APPLICATION RULE TABLE        *        
010500*      (TTBAPRL)                                                 *        
010600******************************************************************        
010700     EXEC SQL                                                             
010800          INCLUDE TTBAPRL                                                 
010900     END-EXEC.                                                            
011000                                                                          
011100******************************************************************        
011200*  DB2 TABLE DECLARATION - VIOLATION (TROUBLE) CODE MASTER TABLE *        
011300*      (TICDMST)                                                 *        
011400******************************************************************        
011500     EXEC SQL                                                             
011600          INCLUDE TICDMST                                                 
011700     END-EXEC.                                                            
011800                                                                          
011900******************************************************************        
012000*  DB2 TABLE DECLARATION - VIOLATION (TROUBLE) CODE VALUE TABLE  *        
012100*      (TICDVAL)                                                 *        
012200******************************************************************        
012300     EXEC SQL                                                             
012400          INCLUDE TICDVAL                                                 
012500     END-EXEC.                                                            
012600                                                                          
012700******************************************************************        
012800*  DB2 TABLE DECLARATION - TROUBLE PO EXTRACT WORK TABLE         *        
012900*      (TOUTTM1)                                                 *        
013000******************************************************************        
013100     EXEC SQL                                                             
013200          INCLUDE TOUTTM1                                                 
013300     END-EXEC.                                                            
013400                                                                          
013500******************************************************************        
013600*  DB2 TABLE DECLARATION - PROCESSING RESULTS WORK TABLE         *        
013700*      (TOUTTM2)                                                 *        
013800******************************************************************        
013900     EXEC SQL                                                             
014000          INCLUDE TOUTTM2                                                 
014100     END-EXEC.                                                            
014200                                                                          
014300******************************************************************        
014400*  DB2 TABLE DECLARATION - PURCHASE ORDER PLANNED SHIPMENT       *        
014500*      TABLE  (TPLNSHP)                                          *        
014600******************************************************************        
014700     EXEC SQL                                                             
014800          INCLUDE TPLNSHP                                                 
014900     END-EXEC.                                                            
015000                                                                          
015100******************************************************************        
015200*  DB2 TABLE DECLARATION -  IMPORT FOB TABLE                     *        
015300*      (TIMFOB)                                                  *        
015400******************************************************************        
015500     EXEC SQL                                                             
015600          INCLUDE TIMFOB                                                  
015700     END-EXEC.                                                            
015800                                                                          
015900******************************************************************        
016000*  DB2 TABLE DECLARATION -  IMPORT POE (PORT OF ENTRY) TABLE     *        
016100*      (TIMPOE)                                                  *        
016200******************************************************************        
016300     EXEC SQL                                                             
016400          INCLUDE TIMPOE                                                  
016500     END-EXEC.                                                            
016600                                                                          
016700******************************************************************        
016800*  DB2 TABLE DECLARATION - IMPORT PURCHASE ORDER BOOKING ORIGIN  *        
016900*      (TIMBKPO)           TABLE                                 *        
017000******************************************************************        
017100     EXEC SQL                                                             
017200          INCLUDE TIMBKPO                                                 
017300     END-EXEC.                                                            
017400                                                                          
017500******************************************************************        
017600*  DB2 TABLE DECLARATION - IMPORT AUDIT PURCHASE ORDER BOOKING   *        
017700*      (TAUBKPO)           ORIGIN TABLE                          *        
017800******************************************************************        
017900     EXEC SQL                                                             
018000          INCLUDE TAUBKPO                                                 
018100     END-EXEC.                                                            
018200                                                                          
018300******************************************************************        
018400*  DB2 TABLE DECLARATION - IMPORT PURCHASE ORDER RECEIVING TABLE *        
018500*      (TIMRCPO)                                                 *        
018600******************************************************************        
018700     EXEC SQL                                                             
018800          INCLUDE TIMRCPO                                                 
018900     END-EXEC.                                                            
019000                                                                          
019100******************************************************************        
019200*  DB2 TABLE DECLARATION - IMPORT AUDIT PURCHASE ORDER RECEIVING *        
019300*      (TAURCPO)           TABLE                                 *        
019400******************************************************************        
019500     EXEC SQL                                                             
019600          INCLUDE TAURCPO                                                 
019700     END-EXEC.                                                            
019800                                                                          
019900******************************************************************        
020000*  DB2 TABLE DECLARATION - IMPORT CONTAINER MANIFEST TABLE       *        
020100*      (TIMCNTK)                                                 *        
020200******************************************************************        
020300     EXEC SQL                                                             
020400          INCLUDE TIMCNTK                                                 
020500     END-EXEC.                                                            
020600                                                                          
020700******************************************************************        
020800*  DB2 TABLE DECLARATION - IMPORT AUDIT CONTAINER MANIFEST TABLE *        
020900*      (TAUCNTK)                                                 *        
021000******************************************************************        
021100     EXEC SQL                                                             
021200          INCLUDE TAUCNTK                                                 
021300     END-EXEC.                                                            
021400                                                                          
021500******************************************************************        
021600*  DB2 TABLE DECLARATION - IMPORT CONTAINER PURCHASE ORDER TABLE *        
021700*      (TIMCNPO)                                                 *        
021800******************************************************************        
021900     EXEC SQL                                                             
022000          INCLUDE TIMCNPO                                                 
022100     END-EXEC.                                                            
022200                                                                          
022300******************************************************************        
022400*  DB2 TABLE DECLARATION - IMPORT AUDIT CONTAINER PURCHASE ORDER *        
022500*      TABLE (TAUCNPO)                                           *        
022600******************************************************************        
022700     EXEC SQL                                                             
022800          INCLUDE TAUCNPO                                                 
022900     END-EXEC.                                                            
023000                                                                          
023100******************************************************************        
023200*  DB2 TABLE DECLARATION - IMPORT CUSTOMS ENTRY TABLE            *        
023300*      (TIMCSEN)                                                 *        
023400******************************************************************        
023500     EXEC SQL                                                             
023600          INCLUDE TIMCSEN                                                 
023700     END-EXEC.                                                            
023800                                                                          
023900******************************************************************        
024000*  DB2 TABLE DECLARATION - IMPORT AUDIT CUSTOMS ENTRY TABLE      *        
024100*      (TAUCSEN)                                                 *        
024200******************************************************************        
024300     EXEC SQL                                                             
024400          INCLUDE TAUCSEN                                                 
024500     END-EXEC.                                                            
024600                                                                          
024700******************************************************************        
024800*  DB2 TABLE DECLARATION - CUSTOMS PO TABLE                      *        
024900*      (TIMCSPO)                                                 *        
025000******************************************************************        
025100     EXEC SQL                                                             
025200          INCLUDE TIMCSPO                                                 
025300     END-EXEC.                                                            
025400                                                                          
025500******************************************************************        
025600*  DB2 TABLE DECLARATION - SHIPMENT TO PURCHASE ORDER ASSOCIATION         
025700*      TABLE (TSHPTPO)                                                    
025800******************************************************************        
025900     EXEC SQL                                                             
026000          INCLUDE TSHPTPO                                                 
026100     END-EXEC.                                                            
026200                                                                          
026300******************************************************************        
026400*  DB2 TABLE DECLARATION - SHIPMENT DATA                                  
026500*      TABLE (TSHIPMT)                                                    
026600******************************************************************        
026700     EXEC SQL                                                             
026800          INCLUDE TSHIPMT                                                 
026900     END-EXEC.                                                            
027000                                                                          
027100******************************************************************        
027200*  DB2 TABLE DECLARATION - VEHICLE TRIP DATA                              
027300*      TABLE (TVHTRIP)                                                    
027400******************************************************************        
027500     EXEC SQL                                                             
027600          INCLUDE TVHTRIP                                                 
027700     END-EXEC.                                                            
027800                                                                          
027900******************************************************************        
028000*  DB2 TABLE DECLARATION - VEHICLE DATA                                   
028100*      TABLE (TVEHICL)                                                    
028200******************************************************************        
028300     EXEC SQL                                                             
028400          INCLUDE TVEHICL                                                 
028500     END-EXEC.                                                            
028600                                                                          
028700******************************************************************        
028800*  DB2 TABLE DECLARATION - SHIPMENT STATUS TABLE                          
028900*      (TSHIPST)                                                          
029000******************************************************************        
029100     EXEC SQL                                                             
029200          INCLUDE TSHIPST                                                 
029300     END-EXEC.                                                            
029400                                                                          
029500******************************************************************        
029600*  DB2 TABLE DECLARATION - TRIP STATUS TABLE                              
029700*      (TTRIPST)                                                          
029800******************************************************************        
029900     EXEC SQL                                                             
030000          INCLUDE TTRIPST                                                 
030100     END-EXEC.                                                            
030200                                                                          
030300******************************************************************        
030400*  DB2 TABLE DECLARATION - CHECKPOINT RESTART CONTROL (TCKRSTCNTL)        
030500*  THIS TABLE IS BEING USED IN THIS PROGRAM TO CONTROL COMMIT             
030600*  INTERVALS.                                                             
030700******************************************************************        
030800     EXEC SQL                                                             
030900         INCLUDE TCKRSTCN                                                 
031000     END-EXEC.                                                            
031100                                                                          
031200******************************************************************        
031300*  DB2 TABLE DECLARATION - CHECKPOINT RESTART INFO    (TCKRSTINF)         
031400*  THIS TABLE IS BEING USED IN THIS PROGRAM TO CONTROL COMMIT             
031500*  INTERVALS.                                                             
031600******************************************************************        
031700     EXEC SQL                                                             
031800         INCLUDE TCKRSTIN                                                 
031900     END-EXEC.                                                            
032000                                                                          
032100******************************************************************        
032200*   TROUBLE PO EXTRACT WORK TABLE RECORD LAYOUT  (TOUTTM1)       *        
032300******************************************************************        
032400     COPY TMRD606.                                                        
032500                                                                          
032600 EJECT                                                                    
032700******************************************************************        
032800*   ERROR REPORT RECORD LAYOUT FOR WORK TABLE  (TOUTTM2)         *        
032900******************************************************************        
033000     COPY TMRD600.                                                        
033100                                                                          
033200 EJECT                                                                    
033300******************************************************************        
033400*   DATA RECORD LAYOUT PASSED TO SUBROUTINE                      *        
033500******************************************************************        
033600     COPY TMRD601.                                                        
033700                                                                          
033800 EJECT                                                                    
033900******************************************************************        
034000*   PO INFO RECORD LAYOUT FOR DETAIL REPORT  (TOUTTM2)           *        
034100******************************************************************        
034200     COPY TMRD602.                                                        
034300                                                                          
034400 EJECT                                                                    
034500******************************************************************        
034600*   TROUBLE PROCESSING RULES RESULTS RECORD LAYOUT  (TOUTTM2)    *        
034700******************************************************************        
034800     COPY TMRD603.                                                        
034900                                                                          
035000 EJECT                                                                    
035100******************************************************************        
035200*   CONTAINER INFO RECORD FOR DETAIL REPORT  (TOUTTM2)           *        
035300******************************************************************        
035400     COPY TMRD605.                                                        
035500                                                                          
035600 EJECT                                                                    
035700                                                                          
035800 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
035900                                                   COMP SYNC.             
036000 01  PA-PROGRAM-ACCUMULATORS.                                             
036100     05  PA-TOTALS.                                                       
036200         10 PA-TOT-COMMITS            PIC  S9(13)  VALUE +0               
036300                                                     COMP-3.              
036400         10 PA-TOT-RECS-LOADED        PIC  S9(13)  VALUE +0               
036500                                                     COMP-3.              
036600         10 PA-TOT-PO-RECS-READ       PIC  S9(13)  VALUE +0               
036700                                                     COMP-3.              
036800         10 PA-TOT-ERROR-COUNT        PIC  S9(13)  VALUE +0               
036900                                                     COMP-3.              
037000         10 PA-TOT-SUB-REC-COUNT      PIC  S9(13)  VALUE +0               
037100                                                     COMP-3.              
037200         10 PA-TOT-DETAIL-COUNT       PIC  S9(13)  VALUE +0               
037300                                                     COMP-3.              
037400         10 PA-TOT-PO-DETAIL-COUNT    PIC  S9(13)  VALUE +0               
037500                                                     COMP-3.              
037600         10 PA-TOT-RULE-DETAIL-COUNT   PIC S9(13)  VALUE +0               
037700                                                     COMP-3.              
037800         10 PA-TOT-CNTR-DETAIL-COUNT   PIC S9(13)    VALUE +0             
037900                                                     COMP-3.              
038000 01  PS-PROGRAM-SWITCHES.                                                 
038100     05  PS-RUN-TYPE-SW                PIC  X(01)    VALUE ' '.           
038200         88  NORMAL-RUN                              VALUE '0'.           
038300         88  RESTART-RUN                             VALUE '9'.           
038400     05  PS-COMMITS-TAKEN-SW           PIC  X(01)    VALUE 'N'.           
038500         88  COMMITS-TAKEN                           VALUE 'T'.           
038600         88  NO-COMMITS-TAKEN                        VALUE 'N'.           
038700     05  PS-SAME-COMMIT-FIELDS-SW      PIC  X(01)    VALUE 'N'.           
038800         88  PS-SAME-COMMIT-FIELDS                   VALUE 'Y'.           
038900         88  PS-NOT-SAME-COMMIT-FIELDS               VALUE 'N'.           
039000     05  PS-EOC-PO-EXTRACT-CURSOR-SW   PIC  X(01)    VALUE 'N'.           
039100         88  PS-EOC-PO-EXTRACT-CURSOR                VALUE 'Y'.           
039200         88  PS-EOC-PO-EXTRACT-CURSOR-NO             VALUE 'N'.           
039300     05  PS-EOC-TRBL-CONTROL-CURSOR-SW PIC  X(01)    VALUE 'N'.           
039400         88  PS-EOC-TRBL-CONTROL-CURSOR              VALUE 'Y'.           
039500         88  PS-EOC-TRBL-CONTROL-CURSOR-NO           VALUE 'N'.           
039600     05  PS-EOC-APPL-RULE-CURSOR-SW    PIC  X(01)    VALUE 'N'.           
039700         88  PS-EOC-APPL-RULE-CURSOR                 VALUE 'Y'.           
039800         88  PS-EOC-APPL-RULE-CURSOR-NO              VALUE 'N'.           
039900     05  PS-GOOD-APPL-RULE-FETCH-SW    PIC  X(01)    VALUE 'N'.           
040000         88  PS-GOOD-APPL-RULE-FETCH                 VALUE 'Y'.           
040100         88  PS-GOOD-APPL-RULE-FETCH-NO              VALUE 'N'.           
040200     05  PS-GOOD-TRBL-CNTL-FETCH-SW    PIC  X(01)    VALUE 'N'.           
040300         88  PS-GOOD-TRBL-CNTL-FETCH                 VALUE 'Y'.           
040400         88  PS-GOOD-TRBL-CNTL-FETCH-NO              VALUE 'N'.           
040500     05  PS-TRBL-CNTL-KEYS-FOUND-SW    PIC  X(01)    VALUE 'N'.           
040600         88  PS-TRBL-CNTL-KEYS-FOUND                 VALUE 'Y'.           
040700         88  PS-TRBL-CNTL-KEYS-NOT-FOUND             VALUE 'N'.           
040800     05  PS-SEVERE-ERROR-SW            PIC  X(01)    VALUE 'N'.           
040900         88  PS-SEVERE-ERROR                         VALUE 'Y'.           
041000         88  PS-NO-SEVERE-ERROR                      VALUE 'N'.           
041100     05  PS-TPLNSHP-STRT-FCTRY-SW      PIC  X(01)    VALUE 'N'.           
041200         88  PS-TPLNSHP-STRT-FCTRY                   VALUE 'Y'.           
041300         88  PS-TPLNSHP-STRT-FCTRY-NO                VALUE 'N'.           
041400     05  PS-TPLNSHP-LAST-FCTRY-SW      PIC  X(01)    VALUE 'N'.           
041500         88  PS-TPLNSHP-LAST-FCTRY                   VALUE 'Y'.           
041600         88  PS-TPLNSHP-LAST-FCTRY-NO                VALUE 'N'.           
041700     05  PS-TTRBNTF-EXISTS-SW          PIC  X(01)    VALUE 'N'.           
041800         88  PS-TTRBNTF-EXISTS                       VALUE 'Y'.           
041900         88  PS-TTRBNTF-EXISTS-NO                    VALUE 'N'.           
042000     05  PS-TTRBRSN-EXISTS-SW          PIC  X(01)    VALUE 'N'.           
042100         88  PS-TTRBRSN-EXISTS                       VALUE 'Y'.           
042200         88  PS-TTRBRSN-EXISTS-NO                    VALUE 'N'.           
042300     05  PS-FIRST-RULE-SW              PIC  X(01)    VALUE 'N'.           
042400         88  PS-FIRST-RULE                           VALUE 'Y'.           
042500         88  PS-FIRST-RULE-NO                        VALUE 'N'.           
042600     05  PS-PO-DETAIL-LINE-WRITTEN-SW  PIC  X(01)    VALUE 'N'.           
042700         88  PS-PO-DETAIL-LINE-WRITTEN               VALUE 'Y'.           
042800         88  PS-PO-DETAIL-LINE-WRITTEN-NO            VALUE 'N'.           
042900     05  PS-WRITE-TO-TRBDTL-SW         PIC  X(01)    VALUE 'N'.           
043000         88  PS-WRITE-TO-TRBDTL                      VALUE 'Y'.           
043100         88  PS-WRITE-TO-TRBDTL-NO                   VALUE 'N'.           
043200     05  PS-EMPTY-KEY-FIELDS-SW         PIC X(01)    VALUE 'N'.           
043300         88  PS-EMPTY-KEY-FIELDS                     VALUE 'Y'.           
043400         88  PS-EMPTY-KEY-FIELDS-NO                  VALUE 'N'.           
043500     05  PS-TIMCNTK-EXISTS-SW           PIC X(01)    VALUE 'N'.           
043600         88  PS-TIMCNTK-EXISTS                       VALUE 'Y'.           
043700         88  PS-TIMCNTK-EXISTS-NO                    VALUE 'N'.           
043800     05  PS-TAUCNTK-EXISTS-SW           PIC X(01)    VALUE 'N'.           
043900         88  PS-TAUCNTK-EXISTS                       VALUE 'Y'.           
044000         88  PS-TAUCNTK-EXISTS-NO                    VALUE 'N'.           
044100     05  PS-TIMCSEN-EXISTS-SW           PIC X(01)    VALUE 'N'.           
044200         88  PS-TIMCSEN-EXISTS                       VALUE 'Y'.           
044300         88  PS-TIMCSEN-EXISTS-NO                    VALUE 'N'.           
044400     05  PS-EMPTY-FOB-CDE-SW            PIC X(01)    VALUE 'N'.           
044500         88  PS-EMPTY-FOB-CDE                        VALUE 'Y'.           
044600         88  PS-EMPTY-FOB-CDE-NO                     VALUE 'N'.           
044700     05  PS-EMPTY-POE-CDE-SW            PIC X(01)    VALUE 'N'.           
044800         88  PS-EMPTY-POE-CDE                        VALUE 'Y'.           
044900         88  PS-EMPTY-POE-CDE-NO                     VALUE 'N'.           
045000     05  PS-VALID-FOB-CDE-SW           PIC  X(01)    VALUE 'N'.           
045100         88  PS-VALID-FOB-CDE                        VALUE 'Y'.           
045200         88  PS-INVALID-FOB-CDE                      VALUE 'N'.           
045300     05  PS-VALID-POE-CDE-SW           PIC  X(01)    VALUE 'N'.           
045400         88  PS-VALID-POE-CDE                        VALUE 'Y'.           
045500         88  PS-INVALID-POE-CDE                      VALUE 'N'.           
045600     05  PS-VALID-TRIP-TYP-CDE-SW      PIC  X(01)    VALUE 'N'.           
045700         88  PS-VALID-TRIP-TYP-CDE                   VALUE 'Y'.           
045800         88  PS-INVALID-TRIP-TYP-CDE                 VALUE 'N'.           
045900     05  PS-CONSLR-BLANK-SW            PIC  X(01)    VALUE 'N'.           
046000         88  PS-CONSLR-BLANK                         VALUE 'Y'.           
046100         88  PS-CONSLR-BLANK-NO                      VALUE 'N'.           
046200     05  PS-DCONSLR-BLANK-SW           PIC  X(01)    VALUE 'N'.           
046300         88  PS-DCONSLR-BLANK                        VALUE 'Y'.           
046400         88  PS-DCONSLR-BLANK-NO                     VALUE 'N'.           
046500     05  PS-EDIT-ERRORS-SW             PIC  X(01)    VALUE 'N'.           
046600         88  PS-EDIT-ERRORS                          VALUE 'Y'.           
046700         88  PS-EDIT-ERRORS-NO                       VALUE 'N'.           
046800     05  PS-PO-EXTRACT-DATA-SW         PIC  X(01)    VALUE 'N'.           
046900         88  PS-PO-EXTRACT-DATA-FOUND                VALUE 'Y'.           
047000         88  PS-PO-EXTRACT-DATA-NOT-FOUND            VALUE 'N'.           
047100     05  PS-TROUBLE-REASONS-SW         PIC  X(01)    VALUE 'N'.           
047200         88  PS-TROUBLE-REASONS-FOUND                VALUE 'Y'.           
047300         88  PS-TROUBLE-REASONS-NOT-FOUND            VALUE 'N'.           
047400     05  PS-RULE-PROCESS-SW            PIC  X(01)    VALUE 'Y'.           
047500         88  PS-RULE-PROCESS-CONTINUE                VALUE 'Y'.           
047600         88  PS-RULE-PROCESS-STOP                    VALUE 'N'.           
047700     05  PS-RULE-PROCESS-ERROR-SW      PIC  X(01)    VALUE 'N'.           
047800         88  PS-RULE-PROCESS-ERROR                   VALUE 'Y'.           
047900         88  PS-RULE-PROCESS-ERROR-NO                VALUE 'N'.           
048000     05  PS-TIMCNTL-CNTL-NBR-EXISTS-SW PIC  X(01)    VALUE 'N'.           
048100         88  PS-TIMCNTL-CNTL-NBR-EXISTS              VALUE 'Y'.           
048200         88  PS-TIMCNTL-CNTL-NBR-EXISTS-NO           VALUE 'N'.           
048300     05  PS-TROUBLE-CONDITION-SW       PIC  X(01)    VALUE ' '.           
048400         88  PS-NO-TROUBLE                           VALUE 'N'.           
048500         88  PS-UNRESOLVED-TROUBLE                   VALUE 'U'.           
048600         88  PS-RESOLVED-TROUBLE                     VALUE 'R'.           
048700         88  PS-ACKNOWLEDGED-TROUBLE                 VALUE 'A'.           
048800     05  PS-TRIP-TYP-SW                PIC  X(01)    VALUE ' '.           
048900         88  PS-TRIP-TYP-OCEAN                       VALUE 'O'.           
049000         88  PS-TRIP-TYP-AIR                         VALUE 'A'.           
049100         88  PS-TRIP-TYP-TRLR                        VALUE 'T'.           
049200     05  PS-BEG-END-LIMITS-TESTED-SW   PIC  X(01)    VALUE 'N'.           
049300         88  PS-BEG-END-LIMITS-TESTED                VALUE 'Y'.           
049400         88  PS-BEG-END-LIMITS-NOT-TESTED            VALUE 'N'.           
049500     05  PS-DUPLICATE-TROUBLE-SW       PIC  X(01)    VALUE 'N'.           
049600         88  PS-DUPLICATE-TROUBLE                    VALUE 'Y'.           
049700         88  PS-DUPLICATE-TROUBLE-NO                 VALUE 'N'.           
049800     05  PS-TROUBLE-PROCESSING-SW      PIC  X(01)    VALUE ' '.           
049900         88  PS-BEGIN-INSERT                         VALUE ' '.           
050000         88  PS-BYPASS-INSERT                        VALUE 'B'.           
050100         88  PS-INSERT-TROUBLE                       VALUE 'I'.           
050200     05  PS-RESOLVE-PROCESSING-SW      PIC  X(01)    VALUE ' '.           
050300         88  PS-BYPASS-RESOLVE                       VALUE 'B'.           
050400         88  PS-RESOLVE-TROUBLE                      VALUE 'R'.           
050500     05  PS-UPDATE-PROCESSING-SW       PIC  X(01)    VALUE ' '.           
050600         88  PS-BYPASS-UPDATE                        VALUE 'B'.           
050700         88  PS-UPDATE-TROUBLE                       VALUE 'U'.           
050800     05  PS-PROGRAM-ERRORS-SW          PIC  X(02)    VALUE '  '.          
050900         88  PS-TRBL-RSN-TURNED-OFF                  VALUE '01'.          
051000         88  PS-ACTVY-RSLU-CDE-ERROR                 VALUE '02'.          
051100         88  PS-PO-EXTRACT-WAS-EMPTY                 VALUE '03'.          
051200         88  PS-INVALID-DATE-WAS-USED                VALUE '04'.          
051300         88  PS-RULE-PARA-NOT-FOUND                  VALUE '06'.          
051400         88  PS-INVALID-RULE-RET-TYP                 VALUE '07'.          
051500         88  PS-INVALID-DAT-SRC-FOR-PRC-CDE          VALUE '08'.          
051600         88  PS-RULE-PARA-ERROR                      VALUE '09'.          
051700         88  PS-NO-TRBL-KEYS-FOUND                   VALUE '10'.          
051800         88  PS-NO-TPLNSHP-STRT-FCTRY                VALUE '12'.          
051900         88  PS-NO-TPLNSHP-LAST-FCTRY                VALUE '13'.          
052000         88  PS-NO-PO-BKG-DELY-DTE                   VALUE '14'.          
052100         88  PS-INVALID-TRIP-TYP-CDE-ERR             VALUE '15'.          
052200         88  PS-MISSING-KEY-FOB-CDE                  VALUE '16'.          
052300         88  PS-MISSING-KEY-ENTID                    VALUE '17'.          
052400         88  PS-NO-PO-RCVD-DELY-DTE                  VALUE '18'.          
052500         88  PS-NO-CNTL-NBR-FOUND                    VALUE '19'.          
052600         88  PS-NO-TIMCSEN-FILE-DATE                 VALUE '20'.          
052700         88  PS-NO-TIMCNTK-PKUP-DATE                 VALUE '21'.          
052800         88  PS-NO-TIMCNTK-ATA-DATE                  VALUE '22'.          
052900         88  PS-DUPLICATE-TROUBLE-EXISTS             VALUE '23'.          
053000         88  PS-INVALID-POE-CDE-ERR                  VALUE '24'.          
053100         88  PS-MISSING-KEY-POE-CDE                  VALUE '25'.          
053200         88  PS-NO-EST-DPRTR-DTE                     VALUE '26'.          
053300         88  PS-INVALID-FOB-CDE-TIMRCPO              VALUE '27'.          
053400         88  PS-INVALID-FOB-CDE-TAURCPO              VALUE '28'.          
053500         88  PS-INVALID-FOB-CDE-TIMBKPO              VALUE '29'.          
053600         88  PS-INVALID-FOB-CDE-TAUBKPO              VALUE '30'.          
053700         88  PS-INVALID-FOB-CDE-TIMCNTK              VALUE '31'.          
053800         88  PS-INVALID-FOB-CDE-TAUCNTK              VALUE '32'.          
053900         88  PS-INVALID-FOB-CDE-TPLNSHP              VALUE '33'.          
054000                                                                          
054100 01  PC-PROGRAM-CONSTANTS.                                                
054200     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)     VALUE                  
054300         'TMKUP625'.                                                      
054400     05  PC-01                       PIC X(02)     VALUE '01'.            
054500     05  PC-02                       PIC X(02)     VALUE '02'.            
054600     05  PC-03                       PIC X(02)     VALUE '03'.            
054700     05  PC-04                       PIC X(02)     VALUE '04'.            
054800     05  PC-05                       PIC X(02)     VALUE '05'.            
054900     05  PC-A                        PIC X(01)     VALUE 'A'.             
055000     05  PC-D                        PIC X(01)     VALUE 'D'.             
055100     05  PC-E                        PIC X(01)     VALUE 'E'.             
055200     05  PC-N                        PIC X(01)     VALUE 'N'.             
055300     05  PC-O                        PIC X(01)     VALUE 'O'.             
055400     05  PC-R                        PIC X(01)     VALUE 'R'.             
055500     05  PC-S                        PIC X(01)     VALUE 'S'.             
055600     05  PC-T                        PIC X(01)     VALUE 'T'.             
055700     05  PC-U                        PIC X(01)     VALUE 'U'.             
055800     05  PC-Y                        PIC X(01)     VALUE 'Y'.             
055900     05  PC-BD                       PIC X(02)     VALUE 'BD'.            
056000     05  PC-BK                       PIC X(02)     VALUE 'BK'.            
056100     05  PC-CN                       PIC X(02)     VALUE 'CN'.            
056200     05  PC-CS                       PIC X(02)     VALUE 'CS'.            
056300     05  PC-CV                       PIC X(02)     VALUE 'CV'.            
056400     05  PC-PO                       PIC X(02)     VALUE 'PO'.            
056500     05  PC-RC                       PIC X(02)     VALUE 'RC'.            
056600     05  PC-RD                       PIC X(02)     VALUE 'RD'.            
056700     05  PC-SD                       PIC X(02)     VALUE 'SD'.            
056800     05  PC-TR                       PIC X(02)     VALUE 'TR'.            
056900     05  PC-AV                       PIC X(02)     VALUE 'AV'.            
057000     05  PC-TROUBLE                  PIC X(01)     VALUE 'T'.             
057100     05  PC-RESOLVE                  PIC X(01)     VALUE 'R'.             
057200     05  PC-UPDATE                   PIC X(01)     VALUE 'U'.             
057300     05  PC-SPECIAL                  PIC X(01)     VALUE 'S'.             
057400     05  PC-DAY                      PIC X(03)     VALUE 'DAY'.           
057500     05  PC-IND                      PIC X(03)     VALUE 'IND'.           
057600     05  PC-PCT                      PIC X(03)     VALUE 'PCT'.           
057700     05  PC-DETAIL                   PIC X(01)     VALUE 'D'.             
057800     05  PC-WARNING                  PIC X(03)     VALUE 'W'.             
057900     05  PC-ERROR                    PIC X(03)     VALUE 'E'.             
058000     05  PC-DASH                     PIC X(01)     VALUE '-'.             
058100     05  PC-DECIMAL                  PIC X(01)     VALUE '.'.             
058200     05  PC-DEFAULT-SPACES           PIC X(01)     VALUE SPACES.          
058300     05  PC-DEFAULT-SECONDS          PIC X(10)     VALUE                  
058400                                     '.00.000000'.                        
058500     05  PC-DEFAULT-TMST             PIC X(26)     VALUE                  
058600                                     '0001-01-01-00.00.00.000000'.        
058700     05  PC-MAX-TMST                 PIC X(26)     VALUE                  
058800                                     '9999-09-09-09.09.09.999999'.        
058900     05  PC-DEFAULT-DTE              PIC X(10)     VALUE                  
059000                                     '0001-01-01'.                        
059100     05  PC-DEFAULT-DTE-NO-DASHES    PIC X(08)     VALUE                  
059200                                     '00010101'.                          
059300     05  PC-GOOD-RETURN-CODE         PIC X(02)     VALUE '00'.            
059400     05  PC-MAX-RETRIES              PIC S9(03)    VALUE +5               
059500                                                     COMP-3.              
059600     05  PC-IN-PROCESS-CODE          PIC X(01)     VALUE '9'.             
059700     05  PC-RUN-COMPLETE-CODE        PIC X(01)     VALUE '0'.             
059800                                                                          
059900 01  PV-PROGRAM-VARIABLES.                                                
060000     05  PV-DATA-SOURCE              PIC X(02).                           
060100         88  PV-BOOKING                             VALUE 'BK'.           
060200         88  PV-CONTAINER                           VALUE 'CN'.           
060300         88  PV-CUSTOMS                             VALUE 'CS'.           
060400         88  PV-CONTAINER-VOYAGE                    VALUE 'CV'.           
060500         88  PV-PO                                  VALUE 'PO'.           
060600         88  PV-RECEIVING                           VALUE 'RC'.           
060700     05  PV-EXTR-PRCG-APPL-CDE       PIC X(02).                           
060800         88  PV-ARRIVAL                             VALUE 'AR'.           
060900         88  PV-BOOKING-DELETE                      VALUE 'BD'.           
061000         88  PV-BOOKING-ADD                         VALUE 'BK'.           
061100         88  PV-CUSTOMS-FILING                      VALUE 'CF'.           
061200         88  PV-CUSTOMS-RELEASE                     VALUE 'CR'.           
061300         88  PV-CONTAINER-PICKUP                    VALUE 'CP'.           
061400         88  PV-DELIVERY-ORDER                      VALUE 'DO'.           
061500         88  PV-ESTIMATED-BOOKING-DATE              VALUE 'EB'.           
061600         88  PV-LAST-FCTRY                          VALUE 'LF'.           
061700         88  PV-PO-CHANGE                           VALUE 'PO'.           
061800         88  PV-RECEIVING-ADD                       VALUE 'RC'.           
061900         88  PV-RECEIVING-DELETE                    VALUE 'RD'.           
062000         88  PV-SAIL-DTE                            VALUE 'SD'.           
062100         88  PV-STRT-FCTRY                          VALUE 'SF'.           
062200         88  PV-OPEN-TROUBLE                        VALUE 'TR'.           
062300     05  PV-TRBL-DETAIL-TXT.                                              
062400         10  PV-TRBL-DETAIL-TXT1         PIC  X(50) VALUE SPACES.         
062500         10  PV-TRBL-DETAIL-TXT2         PIC  X(50) VALUE SPACES.         
062600         10  PV-TRBL-DETAIL-TXT3         PIC  X(50) VALUE SPACES.         
062700         10  PV-TRBL-DETAIL-TXT4         PIC  X(50) VALUE SPACES.         
062800         10  PV-TRBL-DETAIL-TXT5         PIC  X(50) VALUE SPACES.         
062900     05  PV-TRBL-DETAIL-2ND              PIC  X(50) VALUE SPACES.         
063000     05  PV-TRBL-DETAIL-3RD              PIC  X(50) VALUE SPACES.         
063100     05  PV-TRBL-DETAIL-4TH              PIC  X(50) VALUE SPACES.         
063200     05  PV-TRBL-DETAIL-COUNT            PIC S9(03) VALUE +0.             
063300     05  PV-IMCNTL-CNTL-ID               PIC S9(09) VALUE +0              
063400                                                    COMP.                 
063500     05  PV-KEY-INFO.                                                     
063600         10  PV-KEY-ODR-RECORD-TYP       PIC  X(01) VALUE SPACES.         
063700         10  PV-KEY-PO-NBR               PIC  9(09) VALUE ZEROES.         
063800         10  PV-KEY-CNTRL-NBR            PIC  9(09) VALUE ZEROES.         
063900         10  PV-KEY-TRBL-RSN-CDE         PIC  9(04) VALUE ZEROES.         
064000         10  PV-KEY-GROUP-TYP-CDE        PIC  X(02) VALUE SPACES.         
064100         10  PV-KEY-GROUP-SEQ-NBR        PIC  9(04) VALUE ZEROES.         
064200     05  PV-PROCESSING-DATA.                                              
064300         10  PV-CURR-RULE-NAME           PIC  X(30) VALUE SPACES.         
064400         10  PV-CURR-RULE-CDE            PIC  X(02) VALUE SPACES.         
064500         10  PV-CURR-RULE-RETURN-TYP     PIC  X(03) VALUE SPACES.         
064600         10  PV-CURR-RULE-COND-IND       PIC  X(01) VALUE SPACES.         
064700         10  PV-CURR-RULE-COND-PRC-CDE   PIC  X(01) VALUE SPACES.         
064800         10  PV-CURR-RULE-RESULT-IND     PIC  X(01) VALUE SPACES.         
064900         10  PV-CURR-RULE-RESULT-DAYS    PIC S9(04) VALUE +0              
065000                                                    COMP.                 
065100         10  PV-CURR-RULE-RESULT-PCT     PIC S9(04) VALUE +0              
065200                                                    COMP.                 
065300         10  PV-CURR-RULE-SEQ-NBR        PIC S9(04) VALUE +0              
065400                                                    COMP.                 
065500         10  PV-CURR-SRC-PRCG-APPL-CDE   PIC  X(02) VALUE SPACES.         
065600         10  PV-CURR-DATA-SRC            PIC  X(02) VALUE SPACES.         
065700         10  PV-NULL                     PIC S9(04) VALUE +0              
065800                                                    COMP.                 
065900         10  PV-CURR-TRBL-RSN            PIC S9(04) VALUE +0              
066000                                                    COMP.                 
066100         10  PV-CURR-PO-NBR              PIC S9(09) VALUE +0              
066200                                                    COMP.                 
066300         10  PV-CURR-PARAGRAPH           PIC  X(32) VALUE SPACES.         
066400         10  PV-CURR-INITR-ID            PIC S9(04) VALUE +0              
066500                                                    COMP.                 
066600         10  PV-CURR-INITR-ENT-ID        PIC S9(09) VALUE +0              
066700                                                    COMP.                 
066800         10  PV-CURR-RSPNB-RSLU-ID       PIC S9(04) VALUE +0              
066900                                                    COMP.                 
067000         10  PV-CURR-PFMC-TRKG-ID        PIC S9(04) VALUE +0              
067100                                                    COMP.                 
067200         10  PV-CURR-ACTVY-RSLU-CDE      PIC  X(02) VALUE SPACES.         
067300         10  PV-CURR-TRBL-NOTIF-NBR      PIC S9(09) VALUE +0              
067400                                                    COMP.                 
067500     05  PV-TOLERANCE-DATA.                                               
067600         10  PV-TRBL-CNTL-TYP-CDE        PIC  X(02) VALUE SPACES.         
067700         10  PV-CONSLR-ENT-ID            PIC S9(09) VALUE +0              
067800                                                    COMP.                 
067900         10  PV-DCONSLR-ENT-ID           PIC S9(09) VALUE +0              
068000                                                    COMP.                 
068100         10  PV-CSTM-BKR-ENT-ID          PIC S9(09) VALUE +0              
068200                                                    COMP.                 
068300         10  PV-FOB-CDE                  PIC  X(05) VALUE SPACES.         
068400         10  PV-FOB-CDE-OCEAN            PIC  X(05) VALUE SPACES.         
068500         10  PV-POE-CDE                  PIC  X(05) VALUE SPACES.         
068600         10  PV-POE-CDE-OCEAN            PIC  X(05) VALUE SPACES.         
068700         10  PV-TRIP-TYP-CDE             PIC  X(01) VALUE SPACES.         
068800         10  PV-TRIP-ID                  PIC  X(10) VALUE SPACES.         
068900         10  PV-CSTM-ENTR-ID             PIC  X(12) VALUE SPACES.         
069000     05  PV-RULE-PARAGRAPH-INPUT-DATA.                                    
069100         10  PV-PLNSHP-VER-NBR           PIC S9(09) VALUE +0              
069200                                                    COMP.                 
069300         10  PV-BKG-SEQ-NBR              PIC S9(04) VALUE +0              
069400                                                    COMP.                 
069500         10  PV-RCVD-SEQ-NBR             PIC S9(04) VALUE +0              
069600                                                    COMP.                 
069700         10  PV-CONTNR-SEQ-NBR           PIC S9(04) VALUE +0              
069800                                                    COMP.                 
069900         10  PV-STRT-FCTRY-DTE           PIC  X(10) VALUE SPACES.         
070000         10  PV-LAST-FCTRY-DTE           PIC  X(10) VALUE SPACES.         
070100     05  PV-RULE-PARAGRAPH-OUTPUT-DATA.                                   
070200         10  PV-RULE-RESULT-IND          PIC  X(01) VALUE SPACES.         
070300     05  PV-6010-DAYS-AFT-STRT-FCTRY.                                     
070400         10  PV-6010-LAST-PO-NBR         PIC S9(09) VALUE +0              
070500                                                    COMP.                 
070600         10  PV-6010-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
070700         10  PV-6010-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
070800                                                    COMP.                 
070900         10  PV-6010-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
071000                                                    COMP.                 
071100     05  PV-6015-DAYS-AFT-LAST-FCTRY.                                     
071200         10  PV-6015-LAST-PO-NBR         PIC S9(09) VALUE +0              
071300                                                    COMP.                 
071400         10  PV-6015-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
071500         10  PV-6015-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
071600                                                    COMP.                 
071700         10  PV-6015-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
071800                                                    COMP.                 
071900     05  PV-6020-DAYS-BKNG-TO-STRT.                                       
072000         10  PV-6020-LAST-PO-NBR         PIC S9(09) VALUE +0              
072100                                                    COMP.                 
072200         10  PV-6020-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
072300         10  PV-6020-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
072400                                                    COMP.                 
072500         10  PV-6020-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
072600                                                    COMP.                 
072700     05  PV-6025-DAYS-BKNG-TO-LAST.                                       
072800         10  PV-6025-LAST-PO-NBR         PIC S9(09) VALUE +0              
072900                                                    COMP.                 
073000         10  PV-6025-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
073100         10  PV-6025-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
073200                                                    COMP.                 
073300         10  PV-6025-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
073400                                                    COMP.                 
073500     05  PV-6035-A-BOOKING-EXISTS.                                        
073600         10  PV-6035-LAST-PO-NBR         PIC S9(09) VALUE +0              
073700                                                    COMP.                 
073800         10  PV-6035-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
073900         10  PV-6035-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
074000                                                    COMP.                 
074100         10  PV-6035-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
074200                                                    COMP.                 
074300     05  PV-6045-DAYS-RCPT-TO-STRT.                                       
074400         10  PV-6045-LAST-PO-NBR         PIC S9(09) VALUE +0              
074500                                                    COMP.                 
074600         10  PV-6045-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
074700         10  PV-6045-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
074800                                                    COMP.                 
074900         10  PV-6045-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
075000                                                    COMP.                 
075100     05  PV-6050-DAYS-RCPT-TO-LAST.                                       
075200         10  PV-6050-LAST-PO-NBR         PIC S9(09) VALUE +0              
075300                                                    COMP.                 
075400         10  PV-6050-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
075500         10  PV-6050-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
075600                                                    COMP.                 
075700         10  PV-6050-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
075800                                                    COMP.                 
075900     05  PV-6055-A-RECEIVING-EXISTS.                                      
076000         10  PV-6055-LAST-PO-NBR         PIC S9(09) VALUE +0              
076100                                                    COMP.                 
076200         10  PV-6055-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
076300         10  PV-6055-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
076400                                                    COMP.                 
076500         10  PV-6055-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
076600                                                    COMP.                 
076700     05  PV-6080-DAYS-AFT-SAIL.                                           
076800         10  PV-6080-LAST-PO-NBR         PIC S9(09) VALUE +0              
076900                                                    COMP.                 
077000         10  PV-6080-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
077100         10  PV-6080-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
077200                                                    COMP.                 
077300         10  PV-6080-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
077400                                                    COMP.                 
077500     05  PV-6095-DAYS-BKNG-TO-CURR.                                       
077600         10  PV-6095-LAST-PO-NBR         PIC S9(09) VALUE +0              
077700                                                    COMP.                 
077800         10  PV-6095-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
077900         10  PV-6095-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
078000                                                    COMP.                 
078100         10  PV-6095-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
078200                                                    COMP.                 
078300     05  PV-6110-CONTNR-PKUP-TO-AR.                                       
078400         10  PV-6110-LAST-PO-NBR         PIC S9(09) VALUE +0              
078500                                                    COMP.                 
078600         10  PV-6110-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
078700         10  PV-6110-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
078800                                                    COMP.                 
078900         10  PV-6110-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
079000                                                    COMP.                 
079100     05  PV-6115-A-CUSTOMS-RELEASE.                                       
079200         10  PV-6115-LAST-PO-NBR         PIC S9(09) VALUE +0              
079300                                                    COMP.                 
079400         10  PV-6115-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
079500         10  PV-6115-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
079600                                                    COMP.                 
079700         10  PV-6115-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
079800                                                    COMP.                 
079900     05  PV-6120-A-DEVAN-DATE.                                            
080000         10  PV-6120-LAST-PO-NBR         PIC S9(09) VALUE +0              
080100                                                    COMP.                 
080200         10  PV-6120-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
080300         10  PV-6120-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
080400                                                    COMP.                 
080500         10  PV-6120-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
080600                                                    COMP.                 
080700     05  PV-6125-CUSTOMS-FILE-TO-CURR.                                    
080800         10  PV-6125-LAST-PO-NBR         PIC S9(09) VALUE +0              
080900                                                    COMP.                 
081000         10  PV-6125-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
081100         10  PV-6125-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
081200                                                    COMP.                 
081300         10  PV-6125-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
081400                                                    COMP.                 
081500     05  PV-6130-CONTNR-PKUP-TO-CURR.                                     
081600         10  PV-6130-LAST-PO-NBR         PIC S9(09) VALUE +0              
081700                                                    COMP.                 
081800         10  PV-6130-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
081900         10  PV-6130-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
082000                                                    COMP.                 
082100         10  PV-6130-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
082200                                                    COMP.                 
082300     05  PV-6135-POE-ARRIVAL-TO-CURR.                                     
082400         10  PV-6135-LAST-PO-NBR         PIC S9(09) VALUE +0              
082500                                                    COMP.                 
082600         10  PV-6135-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
082700         10  PV-6135-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
082800                                                    COMP.                 
082900         10  PV-6135-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
083000                                                    COMP.                 
083100     05  PV-6140-A-CONTNR-PKUP.                                           
083200         10  PV-6140-LAST-PO-NBR         PIC S9(09) VALUE +0              
083300                                                    COMP.                 
083400         10  PV-6140-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
083500         10  PV-6140-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
083600                                                    COMP.                 
083700         10  PV-6140-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
083800                                                    COMP.                 
083900     05  PV-6145-A-CONTNR-MANF.                                           
084000         10  PV-6145-LAST-PO-NBR         PIC S9(09) VALUE +0              
084100                                                    COMP.                 
084200         10  PV-6145-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
084300         10  PV-6145-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
084400                                                    COMP.                 
084500         10  PV-6145-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
084600                                                    COMP.                 
084700     05  PV-6150-A-CUSTOMS-FILING.                                        
084800         10  PV-6150-LAST-PO-NBR         PIC S9(09) VALUE +0              
084900                                                    COMP.                 
085000         10  PV-6150-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
085100         10  PV-6150-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
085200                                                    COMP.                 
085300         10  PV-6150-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
085400                                                    COMP.                 
085500     05  PV-6155-AN-AIR-SHIPMENT.                                         
085600         10  PV-6155-LAST-PO-NBR         PIC S9(09) VALUE +0              
085700                                                    COMP.                 
085800         10  PV-6155-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
085900         10  PV-6155-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
086000                                                    COMP.                 
086100         10  PV-6155-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
086200                                                    COMP.                 
086300     05  PV-6160-BKNG-CRE-TO-STRT.                                        
086400         10  PV-6160-LAST-PO-NBR         PIC S9(09) VALUE +0              
086500                                                    COMP.                 
086600         10  PV-6160-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
086700         10  PV-6160-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
086800                                                    COMP.                 
086900         10  PV-6160-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
087000                                                    COMP.                 
087100     05  PV-6165-RCVG-CRE-TO-LAST.                                        
087200         10  PV-6165-LAST-PO-NBR         PIC S9(09) VALUE +0              
087300                                                    COMP.                 
087400         10  PV-6165-LAST-RESULT-IND     PIC  X(01) VALUE SPACES.         
087500         10  PV-6165-LAST-RESULT-DAYS    PIC S9(09) VALUE +0              
087600                                                    COMP.                 
087700         10  PV-6165-LAST-RESULT-PCT     PIC S9(04) VALUE +0              
087800                                                    COMP.                 
087900                                                                          
088000     05  PV-IMTBCT-BEG-LMT-DAY-QTY       PIC S9(04) VALUE +0              
088100                                                    COMP.                 
088200     05  PV-IMTBCT-END-LMT-DAY-QTY       PIC S9(04) VALUE +0              
088300                                                    COMP.                 
088400     05  PV-IMTBCT-BEG-LMT-PCT           PIC S9(04) VALUE +0              
088500                                                    COMP.                 
088600     05  PV-IMTBCT-END-LMT-PCT           PIC S9(04) VALUE +0              
088700                                                    COMP.                 
088800     05  PV-EXTR-NOTIF-NBR               PIC S9(09) VALUE +0              
088900                                                    COMP.                 
089000                                                                          
089100     05  PV-TIMTBKY-CNT              PIC S9(09)    VALUE +0               
089200                                                    COMP.                 
089300     05  PV-PRCT                     PIC X(01)     VALUE SPACES.          
089400     05  PV-PRCR                     PIC X(01)     VALUE SPACES.          
089500     05  PV-PRCU                     PIC X(01)     VALUE SPACES.          
089600     05  PV-PRCS                     PIC X(01)     VALUE SPACES.          
089700     05  PV-RESULTS                  PIC S9(04)    VALUE +0.              
089800     05  PV-RESULTS-X                PIC ----9     VALUE ZERO.            
089900     05  PV-HOLD-TMST                PIC X(26)     VALUE SPACES.          
090000     05  PV-TMST                     PIC X(26)     VALUE SPACES.          
090100**** THE FIELD BELOW IS NOT CURRENTLY BEING USED.                         
090200     05  PV-EXTL-REF-NBR             PIC X(15)     VALUE SPACES.          
090300     05  PV-CKPT-STAT-CODE           PIC X(01)     VALUE SPACES.          
090400     05  PV-SUB                      PIC S9(02)    VALUE +0.              
090500     05  PV-CURRENT-TMST             PIC X(26)     VALUE SPACES.          
090600     05  PV-CURRENT-DTE              PIC X(10)     VALUE SPACES.          
090700     05  PV-REFORMAT-TMST.                                                
090800         10  PV-REFORMAT-DTE.                                             
090900             15  PV-REFORMAT-DTE-MM  PIC X(02)     VALUE SPACES.          
091000             15  FILLER              PIC X(01)     VALUE '/'.             
091100             15  PV-REFORMAT-DTE-DD  PIC X(02)     VALUE SPACES.          
091200             15  FILLER              PIC X(01)     VALUE '/'.             
091300             15  PV-REFORMAT-DTE-YY  PIC X(04)     VALUE SPACES.          
091400     05  PV-PO-INPUT-COUNT           PIC 9(09)     VALUE ZERO             
091500                                                    COMP-3.               
091600     05  PV-TOTAL-RECS-READ          PIC 9(09)     VALUE ZERO             
091700                                                    COMP-3.               
091800     05  PV-RETRY-COUNTER            PIC S9(04)    VALUE +0               
091900                                                    COMP SYNC.            
092000                                                                          
092100 01  CKPT-RESTART-INFO.                                                   
092200     05  CR-INPUT-FILE-SW            PIC X(01)     VALUE 'I'.             
092300         88  INPUT-PO-FILE                         VALUE 'I'.             
092400     05  CR-PO-RECS-WORKED           PIC 9(09)     VALUE ZERO.            
092500     05  CR-COMMITS                  PIC 9(13)     VALUE ZERO.            
092600     05  CR-RECS-LOADED              PIC 9(13)     VALUE ZERO.            
092700     05  CR-ERROR-COUNT              PIC 9(13)     VALUE ZERO.            
092800     05  CR-SUB-REC-COUNT            PIC 9(13)     VALUE ZERO.            
092900     05  CR-DETAIL-COUNT             PIC 9(13)     VALUE ZERO.            
093000     05  CR-PO-DETAIL-COUNT          PIC 9(13)     VALUE ZERO.            
093100     05  CR-RULE-DETAIL-COUNT        PIC 9(13)     VALUE ZERO.            
093200     05  CR-CNTR-DETAIL-COUNT        PIC 9(13)     VALUE ZERO.            
093300     05  CR-IMCNTL-CNTL-ID           PIC 9(09)     VALUE ZERO.            
093400                                                                          
093500*                                                                         
093600*  CURSOR DECLARATION TO OBTAIN PO EXTRACT DATA                           
093700*                                                                         
093800     EXEC SQL                                                             
093900          DECLARE PO_EXTRACT_CUR CURSOR WITH HOLD FOR                     
094000             SELECT PO_NBR                                                
094100                   ,TRBL_ODR                                              
094200                   ,TRBL_TMST_ODR                                         
094300               FROM TOUTTM1                                               
094400*          ORDER BY PO_NBR                                                
094500      END-EXEC.                                                           
094600                                                                          
094700*                                                                         
094800*  CURSOR DECLARATION TO OBTAIN TROUBLE REASONS                           
094900*                                                                         
095000     EXEC SQL                                                             
095100          DECLARE TRBL_CONTROL_CUR CURSOR WITH HOLD FOR                   
095200             SELECT DISTINCT                                              
095300                    RL.TRBL_RSN_CDE                                       
095400                   ,BEG_LMT_DAY_QTY                                       
095500                   ,END_LMT_DAY_QTY                                       
095600                   ,BEG_LMT_PCT                                           
095700                   ,END_LMT_PCT                                           
095800                   ,INITR_ID                                              
095900                   ,PFMC_TRKG_ID                                          
096000                   ,TRIP_OCEN_IND                                         
096100                   ,TRIP_AIR_IND                                          
096200                   ,TRIP_TRLR_IND                                         
096300                   ,TRBL_CNTL_TYP_CDE                                     
096400                                                                          
096500               FROM TIMTBCT  CT                                           
096600                   ,TTBAPRL  RL                                           
096700                                                                          
096800              WHERE  (((CONSLR_ENT_ID   = :PV-CONSLR-ENT-ID               
096900                AND   FOB_CDE           = :PV-FOB-CDE                     
097000                AND   TRBL_CNTL_TYP_CDE = :PC-01)                         
097100                OR   (CONSLR_ENT_ID     = :PV-CONSLR-ENT-ID               
097200                AND   POE_CDE           = :PV-POE-CDE                     
097300                AND   TRBL_CNTL_TYP_CDE = :PC-02)                         
097400                OR   (DCONSLR_ENT_ID    = :PV-DCONSLR-ENT-ID              
097500                AND   POE_CDE           = :PV-POE-CDE                     
097600                AND   TRBL_CNTL_TYP_CDE = :PC-03)                         
097700                OR   (CSTM_BKR_ENT_ID   = :PV-CSTM-BKR-ENT-ID             
097800                AND   POE_CDE           = :PV-POE-CDE                     
097900                AND   TRBL_CNTL_TYP_CDE = :PC-04))                        
098000                AND   CT.TRBL_RSN_CDE      =  RL.TRBL_RSN_CDE             
098100                AND   RL.SRC_PRCG_APPL_CDE =                              
098200                                  :PV-EXTR-PRCG-APPL-CDE                  
098300                AND   EFF_BEG_DTE          <= CURRENT DATE                
098400                AND  (EFF_END_DTE          >  CURRENT DATE                
098500                 OR   EFF_END_DTE          = '0001-01-01'))               
098600                                                                          
098700                OR   (TRBL_CNTL_TYP_CDE    = :PC-DEFAULT-SPACES           
098800                AND   CT.TRBL_RSN_CDE      =  RL.TRBL_RSN_CDE             
098900                AND   RL.SRC_PRCG_APPL_CDE =                              
099000                                  :PV-EXTR-PRCG-APPL-CDE                  
099100                AND   EFF_BEG_DTE          <= CURRENT DATE                
099200                AND  (EFF_END_DTE          >  CURRENT DATE                
099300                 OR   EFF_END_DTE          = '0001-01-01')                
099400                AND   NOT EXISTS                                          
099500                        (SELECT  *                                        
099600                           FROM TIMTBCT                                   
099700                          WHERE ((CONSLR_ENT_ID                           
099800                                       = :PV-CONSLR-ENT-ID                
099900                          AND   FOB_CDE       = :PV-FOB-CDE               
100000                          AND   TRBL_CNTL_TYP_CDE = :PC-01)               
100100                          OR   (CONSLR_ENT_ID = :PV-CONSLR-ENT-ID         
100200                          AND   POE_CDE       = :PV-POE-CDE               
100300                          AND   TRBL_CNTL_TYP_CDE = :PC-02)               
100400                          OR   (DCONSLR_ENT_ID                            
100500                                       = :PV-DCONSLR-ENT-ID               
100600                          AND   POE_CDE         = :PV-POE-CDE             
100700                          AND  TRBL_CNTL_TYP_CDE = :PC-03)                
100800                          OR  (CSTM_BKR_ENT_ID =                          
100900                                        :PV-CSTM-BKR-ENT-ID               
101000                          AND   POE_CDE     = :PV-POE-CDE                 
101100                          AND  TRBL_CNTL_TYP_CDE   = :PC-04))             
101200                          AND   TRBL_RSN_CDE  = RL.TRBL_RSN_CDE)          
101300                          AND   EFF_BEG_DTE       <= CURRENT DATE         
101400                          AND  (EFF_END_DTE       >  CURRENT DATE         
101500                           OR   EFF_END_DTE       = '0001-01-01'))        
101600      END-EXEC.                                                           
101700                                                                          
101800*                                                                         
101900*  CURSOR DECLARATION TO OBTAIN TROUBLE REASON APPLICATION RULES          
102000*                                                                         
102100     EXEC SQL                                                             
102200          DECLARE APPL_RULE_CUR CURSOR WITH HOLD FOR                      
102300             SELECT TRBL_RSN_CDE                                          
102400                   ,RUL_SEQ_NBR                                           
102500                   ,RUL_CDE                                               
102600                   ,SRC_PRCG_APPL_CDE                                     
102700                   ,RSPNB_RSLU_ID                                         
102800                   ,ACTVY_RSLU_CDE                                        
102900                   ,RUL_DATYP_RET_CDE                                     
103000                   ,RUL_CND_IND                                           
103100                   ,RUL_CND_PRC_CDE                                       
103200                   ,CDE_EFF_STRT_DTE                                      
103300                   ,CDE_EFF_END_DTE                                       
103400                   ,CDVL_DESC                                             
103500               FROM TTBAPRL  A                                            
103600                   ,TICDMST  B                                            
103700                   ,TICDVAL  C                                            
103800              WHERE A.TRBL_RSN_CDE      =  :PV-CURR-TRBL-RSN              
103900                AND A.RUL_CDE           =   C.CDVL_CDE                    
104000                AND B.CDE_ID            =   800                           
104100                AND A.SRC_PRCG_APPL_CDE =  :PV-EXTR-PRCG-APPL-CDE         
104200                AND B.CDE_EFF_STRT_DTE  <  CURRENT DATE                   
104300                AND (B.CDE_EFF_END_DTE  >  CURRENT DATE OR                
104400                     B.CDE_EFF_END_DTE  =  :PC-DEFAULT-DTE)               
104500                AND B.CDE_ID        =   C.CDE_ID                          
104600                AND C.CDVL_EFF_STRT_DTE <  CURRENT DATE                   
104700                AND (C.CDVL_EFF_END_DTE >  CURRENT DATE OR                
104800                     C.CDVL_EFF_END_DTE =  :PC-DEFAULT-DTE)               
104900                                                                          
105000                AND A.RUL_CND_PRC_CDE    IN (:PV-PRCT                     
105100                                            ,:PV-PRCR                     
105200                                            ,:PV-PRCU                     
105300                                            ,:PV-PRCS)                    
105400           ORDER BY RUL_SEQ_NBR                                           
105500      END-EXEC.                                                           
105600                                                                          
105700******************************************************************        
105800 LINKAGE SECTION.                                                         
105900******************************************************************        
106000                                                                          
106100******************************************************************        
106200 PROCEDURE DIVISION.                                                      
106300******************************************************************        
106400*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *        
106500******************************************************************        
106600 0000-MAINLINE.                                                           
106700                                                                          
106800     MOVE '0000-MAINLINE' TO PV-CURR-PARAGRAPH.                           
106900                                                                          
107000     PERFORM 1000-INITIALIZATION.                                         
107100                                                                          
107200     PERFORM 8000-EOJ-ROUTINE.                                            
107300     STOP RUN.                                                            
107400                                                                          
107500******************************************************************        
107600*  INITIALIZE PROGRAM VARIABLES AND SWITCHES.                    *        
107700******************************************************************        
107800 1000-INITIALIZATION.                                                     
107900                                                                          
108000     MOVE '1000-INITIALIZATION' TO PV-CURR-PARAGRAPH.                     
108100                                                                          
108200     PERFORM 7100-SET-CURRENT-TMST.                                       
108300                                                                          
108400     PERFORM 7500-GET-CHECKPOINT-CNTL.                                    
108500     MOVE PV-CKPT-STAT-CODE  TO  PS-RUN-TYPE-SW.                          
108600                                                                          
108700     IF RESTART-RUN                                                       
108800         PERFORM 7540-CHECKPOINT-RESTART                                  
108900         PERFORM 2000-OUTER-LOOP-PROCESSING                               
109000             UNTIL PS-EOC-PO-EXTRACT-CURSOR                               
109100         IF PS-EOC-PO-EXTRACT-CURSOR                                      
109200             PERFORM 7010-CLOSE-PO-EXTRACT-CURSOR                         
109300         END-IF                                                           
109400     ELSE                                                                 
109500         PERFORM 1005-CONTINUE-INITIALIZE                                 
109600     END-IF.                                                              
109700                                                                          
109800     PERFORM 7520-SET-COMMIT-TIME.                                        
109900                                                                          
110000******************************************************************        
110100* CONTINUE INITIALIZATION PROCESS.                               *        
110200******************************************************************        
110300 1005-CONTINUE-INITIALIZE.                                                
110400                                                                          
110500     INITIALIZE PA-TOTALS.                                                
110600                                                                          
110700     INITIALIZE TM600-RECORD.                                             
110800                                                                          
110900     PERFORM 7110-SELECT-TIMCNTL-CNTL-NBR.                                
111000                                                                          
111100     IF PS-TIMCNTL-CNTL-NBR-EXISTS                                        
111200         MOVE IMCNTL-TRBL-RPTG-CNTL-ID TO PV-IMCNTL-CNTL-ID               
111300         PERFORM 7005-OPEN-PO-EXTRACT-CURSOR                              
111400         PERFORM 2000-OUTER-LOOP-PROCESSING                               
111500             UNTIL PS-EOC-PO-EXTRACT-CURSOR                               
111600         IF PS-EOC-PO-EXTRACT-CURSOR                                      
111700             PERFORM 7010-CLOSE-PO-EXTRACT-CURSOR                         
111800         END-IF                                                           
111900         IF PS-PO-EXTRACT-DATA-FOUND                                      
112000             CONTINUE                                                     
112100         ELSE                                                             
112200             SET PS-PO-EXTRACT-WAS-EMPTY TO TRUE                          
112300             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
112400         END-IF                                                           
112500     ELSE                                                                 
112600         SET PS-NO-CNTL-NBR-FOUND TO TRUE                                 
112700         PERFORM 6990-PREP-ERROR-REPORT-LINE                              
112800     END-IF.                                                              
112900                                                                          
113000******************************************************************        
113100* FETCHES PO'S FROM THE PO EXTRACT WORK TABLE AND PASSES THEM    *        
113200* THRU THE RULE BASE PROCESSOR.                                  *        
113300******************************************************************        
113400 2000-OUTER-LOOP-PROCESSING.                                              
113500                                                                          
113600     MOVE '2000-OUTER-LOOP-PROCESSING' TO PV-CURR-PARAGRAPH.              
113700                                                                          
113800     SET PS-EOC-TRBL-CONTROL-CURSOR-NO TO TRUE.                           
113900     SET PS-EDIT-ERRORS-NO             TO TRUE.                           
114000                                                                          
114100     PERFORM 7015-FETCH-PO-EXTRACT-CURSOR.                                
114200                                                                          
114300     IF PS-EOC-PO-EXTRACT-CURSOR-NO                                       
114400         SET PS-PO-EXTRACT-DATA-FOUND TO TRUE                             
114500         PERFORM 2005-MOVE-TM606-FIELDS                                   
114600         IF PS-EDIT-ERRORS-NO                                             
114700             PERFORM 2010-LOAD-TRBL-CNTL-KEYS                             
114800             IF PS-TRBL-CNTL-KEYS-FOUND                                   
114900                 PERFORM 2100-MOVE-KEYS-TO-TM602-FIELDS                   
115000                 PERFORM 7020-OPEN-TRBL-CONTROL-CURSOR                    
115100                 PERFORM 3000-MIDDLE-LOOP-PROCESSING                      
115200                     UNTIL PS-EOC-TRBL-CONTROL-CURSOR  OR                 
115300                           PS-SEVERE-ERROR                                
115400             ELSE                                                         
115500                 SET PS-NO-TRBL-KEYS-FOUND TO TRUE                        
115600                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
115700             END-IF                                                       
115800         END-IF                                                           
115900     END-IF.                                                              
116000                                                                          
116100     PERFORM 7530-COMMIT-CHECK.                                           
116200                                                                          
116300 EJECT                                                                    
116400******************************************************************        
116500* MOVE TM606 INPUT FIELDS TO APPROPRIATE OUTPUT FIELDS.          *        
116600* IT IS NOT NECESSARY TO ADD FURTHER CODING TO THE TM606-EXTR-   *        
116700* PRCG-APPL-CDE EVALUATE STATEMENT.  FUTURE CODES WILL BE PICKED *        
116800* UP IN THE 'OTHER' PORTION OF THE EVALUATE STATEMENT AND WITHIN *        
116900* THE 'IF LOGIC' IMMEDIATELY FOLLOWING THE EVALUATE STATMENT.    *        
117000******************************************************************        
117100 2005-MOVE-TM606-FIELDS.                                                  
117200                                                                          
117300     MOVE '2005-MOVE-TM606-FIELDS' TO PV-CURR-PARAGRAPH.                  
117400                                                                          
117500     INITIALIZE                      TM606-RECORD                         
117600                                     TM600-RECORD                         
117700                                     TM602-RECORD                         
117800                                     TM603-RECORD                         
117900                                     TM605-RECORD                         
118000                                     PV-KEY-INFO                          
118100                                     PV-CONSLR-ENT-ID                     
118200                                     PV-DCONSLR-ENT-ID                    
118300                                     PV-CSTM-BKR-ENT-ID                   
118400                                     PV-FOB-CDE                           
118500                                     PV-POE-CDE.                          
118600                                                                          
118700     MOVE OUTTM1-PO-NBR              TO TM606-PO-NBR                      
118800                                        PV-KEY-PO-NBR                     
118900                                        PV-CURR-PO-NBR.                   
119000     MOVE OUTTM1-TRBL-ODR            TO TM606-ODR.                        
119100     MOVE OUTTM1-TRBL-TMST-ODR       TO TM606-TMST-ODR.                   
119200                                                                          
119300     MOVE PV-IMCNTL-CNTL-ID          TO PV-KEY-CNTRL-NBR.                 
119400                                                                          
119500     MOVE TM606-PURCHS-VER-NBR       TO TM602-PURCHS-VER-NBR.             
119600     MOVE TM606-DATA-SOURCE          TO PV-CURR-DATA-SRC                  
119700                                        TM602-DATA-SOURCE.                
119800     MOVE TM606-EXTR-PRCG-APPL-CDE   TO PV-EXTR-PRCG-APPL-CDE             
119900                                        TM602-EXTR-PRCG-APPL-CDE.         
120000     MOVE TM606-CSTM-ENTR-ID         TO TM602-CSTM-ENTR-ID.               
120100     MOVE TM606-CUSTOMS-FILE-DTE     TO TM602-CUSTOMS-FILE-DTE.           
120200     MOVE TM606-EXTR-NOTIF-NBR       TO PV-EXTR-NOTIF-NBR.                
120300                                                                          
120400     MOVE TM606-MOM-IMPRT-TRIP-ID    TO TM602-MOM-IMPRT-TRIP-ID           
120500                                        PV-TRIP-ID.                       
120600                                                                          
120700     MOVE TM606-CONTNR-ID            TO TM602-CONTNR-ID.                  
120800     MOVE TM606-CONTNR-ID            TO TM605-CONTNR-ID.                  
120900                                                                          
121000     IF TM606-CONTNR-SEQ-NBR IS NUMERIC                                   
121100        MOVE TM606-CONTNR-SEQ-NBR    TO PV-CONTNR-SEQ-NBR                 
121200                                        TM605-CONTNR-SEQ-NBR              
121300     ELSE                                                                 
121400        MOVE 0                       TO TM605-CONTNR-SEQ-NBR              
121500     END-IF.                                                              
121600                                                                          
121700     IF TM606-PO-BKG-SEQ-NBR IS NUMERIC                                   
121800        MOVE TM606-PO-BKG-SEQ-NBR    TO PV-BKG-SEQ-NBR                    
121900                                        TM605-BKG-SEQ-NBR                 
122000     ELSE                                                                 
122100        MOVE 0                       TO PV-BKG-SEQ-NBR                    
122200                                        TM605-BKG-SEQ-NBR                 
122300     END-IF.                                                              
122400                                                                          
122500     IF TM606-PO-RCVD-SEQ-NBR IS NUMERIC                                  
122600        MOVE TM606-PO-RCVD-SEQ-NBR   TO PV-RCVD-SEQ-NBR                   
122700                                        TM605-RCVD-SEQ-NBR                
122800     ELSE                                                                 
122900        MOVE 0                       TO PV-RCVD-SEQ-NBR                   
123000                                        TM605-RCVD-SEQ-NBR                
123100     END-IF.                                                              
123200                                                                          
123300     MOVE PV-CURR-PARAGRAPH          TO TM600-CURR-PARAGRAPH.             
123400     MOVE PV-CURRENT-DTE             TO TM602-CURRENT-DTE.                
123500                                                                          
123600** PLEASE REFER TO PARAGRAPH DESCRIPTION ABOVE IF YOU ARE  **             
123700** PLANNING ON ADDING CODE TO THE REMAINDER OF THIS        **             
123800** PARAGRAPH                                               **             
123900                                                                          
124000     EVALUATE TM606-EXTR-PRCG-APPL-CDE                                    
124100         WHEN PC-BK                                                       
124200         WHEN PC-BD                                                       
124300             PERFORM 2070-SELECT-FACTORY-DATES                            
124400             MOVE PLNSHP-VER-NBR       TO PV-PLNSHP-VER-NBR               
124500                                          TM602-PLNSHP-VER-NBR            
124600             IF TM606-PO-BKG-DELY-DTE = SPACES OR LOW-VALUES OR           
124700                                        PC-DEFAULT-DTE                    
124800                 SET PS-EDIT-ERRORS        TO TRUE                        
124900                 SET PS-NO-PO-BKG-DELY-DTE TO TRUE                        
125000                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
125100             ELSE                                                         
125200                 MOVE TM606-PO-BKG-DELY-DTE TO                            
125300                                           TM602-PO-BKG-DELY-DTE          
125400             END-IF                                                       
125500                                                                          
125600         WHEN PC-RC                                                       
125700         WHEN PC-RD                                                       
125800             PERFORM 2070-SELECT-FACTORY-DATES                            
125900             MOVE PLNSHP-VER-NBR       TO PV-PLNSHP-VER-NBR               
126000                                          TM602-PLNSHP-VER-NBR            
126100             IF TM606-PO-RCVD-DELY-DTE = SPACES OR LOW-VALUES OR          
126200                                         PC-DEFAULT-DTE                   
126300                 SET PS-EDIT-ERRORS          TO TRUE                      
126400                 SET PS-NO-PO-RCVD-DELY-DTE  TO TRUE                      
126500                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
126600             ELSE                                                         
126700                 MOVE TM606-PO-RCVD-DELY-DTE TO                           
126800                                      TM602-PO-RCVD-DELY-DTE              
126900             END-IF                                                       
127000                                                                          
127100         WHEN PC-SD                                                       
127200           IF TM606-PO-RCVD-DELY-DTE = SPACES OR LOW-VALUES OR            
127300                                       PC-DEFAULT-DTE                     
127400                 SET PS-EDIT-ERRORS          TO TRUE                      
127500                 SET PS-NO-PO-RCVD-DELY-DTE  TO TRUE                      
127600                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
127700             ELSE                                                         
127800                 MOVE TM606-PO-RCVD-DELY-DTE TO                           
127900                                      TM602-PO-RCVD-DELY-DTE              
128000             END-IF                                                       
128100                                                                          
128200         WHEN OTHER                                                       
128300             MOVE TM606-PLNSHP-VER-NBR TO PV-PLNSHP-VER-NBR               
128400                                          TM602-PLNSHP-VER-NBR            
128500             MOVE TM606-STRT-FCTRY-DTE TO TM602-STRT-FCTRY-DTE            
128600             MOVE TM606-LAST-FCTRY-DTE TO TM602-LAST-FCTRY-DTE            
128700                                                                          
128800     END-EVALUATE.                                                        
128900                                                                          
129000     IF TM606-EST-DPRTR-DTE = SPACES OR LOW-VALUES                        
129100         MOVE PC-DEFAULT-DTE         TO TM602-EST-DPRTR-DTE               
129200     ELSE                                                                 
129300         MOVE TM606-EST-DPRTR-DTE    TO TM602-EST-DPRTR-DTE               
129400     END-IF.                                                              
129500                                                                          
129600     IF TM606-MOM-POE-DELY-DTE = SPACES OR LOW-VALUES                     
129700         MOVE PC-DEFAULT-DTE         TO TM602-MOM-POE-DELY-DTE            
129800     ELSE                                                                 
129900         MOVE TM606-MOM-POE-DELY-DTE TO TM602-MOM-POE-DELY-DTE            
130000     END-IF.                                                              
130100                                                                          
130200     IF TM606-CONTNR-PKUP-DTE = SPACES OR LOW-VALUES                      
130300         MOVE PC-DEFAULT-DTE        TO TM602-CONTNR-PKUP-DTE              
130400     ELSE                                                                 
130500         MOVE TM606-CONTNR-PKUP-DTE TO TM602-CONTNR-PKUP-DTE              
130600     END-IF.                                                              
130700                                                                          
130800******************************************************************        
130900* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
131000* PROCESSING CONTROL TABLE.  THE KEYS INCLUDE THE FOB, POE,      *        
131100* AND ENTID.                                                     *        
131200******************************************************************        
131300 2010-LOAD-TRBL-CNTL-KEYS.                                                
131400                                                                          
131500     MOVE '2010-LOAD-TRBL-CNTL-KEYS' TO TM600-CURR-PARAGRAPH.             
131600                                                                          
131700     SET PS-EMPTY-KEY-FIELDS             TO TRUE.                         
131800     SET PS-TIMCNTK-EXISTS-NO            TO TRUE.                         
131900     SET PS-TAUCNTK-EXISTS-NO            TO TRUE.                         
132000     SET PS-EMPTY-FOB-CDE-NO             TO TRUE.                         
132100     SET PS-EMPTY-POE-CDE-NO             TO TRUE.                         
132200     SET PS-VALID-FOB-CDE                TO TRUE.                         
132300     SET PS-VALID-POE-CDE                TO TRUE.                         
132400     SET PS-VALID-TRIP-TYP-CDE           TO TRUE.                         
132500                                                                          
132600     MOVE TM606-DATA-SOURCE TO PV-DATA-SOURCE.                            
132700                                                                          
132800     EVALUATE TRUE                                                        
132900         WHEN PV-BOOKING                                                  
133000             PERFORM 2020-LOAD-BOOKING-KEYS                               
133100                                                                          
133200         WHEN PV-RECEIVING                                                
133300             PERFORM 2030-LOAD-RECEIVING-KEYS                             
133400                                                                          
133500         WHEN PV-PO                                                       
133600             PERFORM 2040-LOAD-PO-KEYS                                    
133700                                                                          
133800         WHEN PV-CONTAINER                                                
133900         WHEN PV-CONTAINER-VOYAGE                                         
134000             PERFORM 2050-LOAD-CONTAINER-KEYS                             
134100                                                                          
134200         WHEN PV-CUSTOMS                                                  
134300             PERFORM 2055-LOAD-CUSTOMS-KEYS                               
134400                                                                          
134500         WHEN OTHER                                                       
134600             SET PS-EMPTY-KEY-FIELDS         TO TRUE                      
134700     END-EVALUATE.                                                        
134800                                                                          
134900     IF PS-EMPTY-KEY-FIELDS                                               
135000          SET PS-TRBL-CNTL-KEYS-NOT-FOUND TO TRUE                         
135100     ELSE                                                                 
135200          SET PS-TRBL-CNTL-KEYS-FOUND     TO TRUE                         
135300     END-IF.                                                              
135400                                                                          
135500******************************************************************        
135600* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
135700* PROCESSING CONTROL TABLE FOR BOOKING INFORMATION.              *        
135800******************************************************************        
135900 2020-LOAD-BOOKING-KEYS.                                                  
136000                                                                          
136100     MOVE '2020-LOAD-BOOKING-KEYS' TO TM600-CURR-PARAGRAPH.               
136200                                                                          
136300     PERFORM 7050-SELECT-TIMBKPO.                                         
136400     IF PS-EMPTY-KEY-FIELDS                                               
136500         PERFORM 7052-SELECT-TAUBKPO                                      
136600         IF PS-EMPTY-KEY-FIELDS                                           
136700             PERFORM 7055-SELECT-TPLNSHP-FOB                              
136800             IF PS-EMPTY-KEY-FIELDS                                       
136900                 SET PS-MISSING-KEY-FOB-CDE TO TRUE                       
137000                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
137100             END-IF                                                       
137200         END-IF                                                           
137300     END-IF.                                                              
137400                                                                          
137500******************************************************************        
137600* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
137700* PROCESSING CONTROL TABLE FOR RECEIVING INFORMATION.            *        
137800******************************************************************        
137900 2030-LOAD-RECEIVING-KEYS.                                                
138000                                                                          
138100     MOVE '2030-LOAD-RECEIVING-KEYS' TO TM600-CURR-PARAGRAPH.             
138200                                                                          
138300     PERFORM 7060-SELECT-TIMRCPO.                                         
138400     IF PS-EMPTY-KEY-FIELDS                                               
138500         PERFORM 7062-SELECT-TAURCPO                                      
138600         IF PS-EMPTY-KEY-FIELDS                                           
138700             PERFORM 7055-SELECT-TPLNSHP-FOB                              
138800             IF PS-EMPTY-KEY-FIELDS                                       
138900                 SET PS-MISSING-KEY-FOB-CDE TO TRUE                       
139000                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
139100             END-IF                                                       
139200         END-IF                                                           
139300     END-IF.                                                              
139400                                                                          
139500******************************************************************        
139600* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
139700* PROCESSING CONTROL TABLE FOR PO INFORMATION.                   *        
139800******************************************************************        
139900 2040-LOAD-PO-KEYS.                                                       
140000                                                                          
140100     MOVE '2040-LOAD-PO-KEYS' TO TM600-CURR-PARAGRAPH.                    
140200                                                                          
140300     PERFORM 7055-SELECT-TPLNSHP-FOB.                                     
140400     IF PS-EMPTY-KEY-FIELDS-NO                                            
140500         CONTINUE                                                         
140600     ELSE                                                                 
140700         SET PS-MISSING-KEY-FOB-CDE TO TRUE                               
140800         PERFORM 6990-PREP-ERROR-REPORT-LINE                              
140900     END-IF.                                                              
141000                                                                          
141100******************************************************************        
141200* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
141300* PROCESSING CONTROL TABLE FOR CONTAINER INFORMATION.            *        
141400******************************************************************        
141500 2050-LOAD-CONTAINER-KEYS.                                                
141600                                                                          
141700     MOVE '2050-LOAD-CONTNR-KEYS' TO TM600-CURR-PARAGRAPH.                
141800                                                                          
141900     PERFORM 7070-SELECT-TIMCNTK-TIMCNPO.                                 
142000     IF PS-TIMCNTK-EXISTS                                                 
142100       IF PS-INVALID-FOB-CDE                                              
142200           PERFORM 7056-SELECT-TPLNSHP-FOB-CNTR                           
142300       END-IF                                                             
142400       IF PS-INVALID-POE-CDE                                              
142500           PERFORM 7057-SELECT-TPLNSHP-POE                                
142600       END-IF                                                             
142700     ELSE                                                                 
142800         PERFORM 7072-SELECT-TAUCNTK-TAUCNPO                              
142900         IF PS-TAUCNTK-EXISTS                                             
143000           IF PS-EMPTY-FOB-CDE                                            
143100               PERFORM 7056-SELECT-TPLNSHP-FOB-CNTR                       
143200           END-IF                                                         
143300           IF PS-EMPTY-POE-CDE                                            
143400               PERFORM 7057-SELECT-TPLNSHP-POE                            
143500           END-IF                                                         
143600         END-IF                                                           
143700     END-IF.                                                              
143800                                                                          
143900     IF (PV-DCONSLR-ENT-ID = ZEROES   OR                                  
144000         PV-CONSLR-ENT-ID  = ZEROES   OR                                  
144100         PS-EMPTY-FOB-CDE             OR                                  
144200         PS-EMPTY-POE-CDE)                                                
144300          SET PS-EMPTY-KEY-FIELDS    TO TRUE                              
144400     ELSE                                                                 
144500          SET PS-EMPTY-KEY-FIELDS-NO TO TRUE                              
144600     END-IF.                                                              
144700                                                                          
144800******************************************************************        
144900* LOAD KEYS THAT ARE NECESSARY FOR READING THE TROUBLE           *        
145000* PROCESSING CONTROL TABLE FOR CUSTOMS INFORMATION.              *        
145100******************************************************************        
145200 2055-LOAD-CUSTOMS-KEYS.                                                  
145300                                                                          
145400     MOVE '2055-LOAD-CUSTOMS-KEYS' TO TM600-CURR-PARAGRAPH.               
145500                                                                          
145600     PERFORM 7080-SELECT-TIMCSEN-TIMCSPO.                                 
145700                                                                          
145800     IF PS-EMPTY-POE-CDE                                                  
145900         PERFORM 7057-SELECT-TPLNSHP-POE                                  
146000     END-IF.                                                              
146100                                                                          
146200     IF (PV-CSTM-BKR-ENT-ID = ZEROES OR                                   
146300         PS-EMPTY-POE-CDE)                                                
146400          SET PS-EMPTY-KEY-FIELDS    TO TRUE                              
146500     ELSE                                                                 
146600          SET PS-EMPTY-KEY-FIELDS-NO TO TRUE                              
146700     END-IF.                                                              
146800                                                                          
146900******************************************************************        
147000* SELECT START AND LAST FACTORY DATES.                           *        
147100******************************************************************        
147200 2070-SELECT-FACTORY-DATES.                                               
147300                                                                          
147400     MOVE '2070-SELECT-FACTORY-DATES' TO TM600-CURR-PARAGRAPH.            
147500                                                                          
147600     SET PS-TPLNSHP-STRT-FCTRY-NO     TO TRUE.                            
147700     SET PS-TPLNSHP-LAST-FCTRY-NO     TO TRUE.                            
147800                                                                          
147900     PERFORM 7090-SELECT-TPLNSHP-DATES.                                   
148000                                                                          
148100     IF PS-TPLNSHP-STRT-FCTRY                                             
148200         MOVE PV-STRT-FCTRY-DTE   TO TM602-STRT-FCTRY-DTE                 
148300     ELSE                                                                 
148400         SET PS-NO-TPLNSHP-STRT-FCTRY TO TRUE                             
148500         PERFORM 6990-PREP-ERROR-REPORT-LINE                              
148600     END-IF.                                                              
148700                                                                          
148800     IF PS-TPLNSHP-LAST-FCTRY                                             
148900         MOVE PV-LAST-FCTRY-DTE   TO TM602-LAST-FCTRY-DTE                 
149000     ELSE                                                                 
149100         SET PS-NO-TPLNSHP-LAST-FCTRY TO TRUE                             
149200         PERFORM 6990-PREP-ERROR-REPORT-LINE                              
149300     END-IF.                                                              
149400                                                                          
149500******************************************************************        
149600* MOVE FIELDS TO TM602 RECORD LAYOUT.                            *        
149700******************************************************************        
149800 2100-MOVE-KEYS-TO-TM602-FIELDS.                                          
149900                                                                          
150000     MOVE '2100-MOVE-KEYS-TO-TM602-FIELDS' TO                             
150100            TM600-CURR-PARAGRAPH.                                         
150200                                                                          
150300     MOVE PV-CONSLR-ENT-ID           TO TM602-CONSLR-ENT-ID.              
150400     MOVE PV-DCONSLR-ENT-ID          TO TM602-DCONSLR-ENT-ID.             
150500     MOVE PV-CSTM-BKR-ENT-ID         TO TM602-CSTM-BKR-ENT-ID.            
150600     MOVE PV-FOB-CDE                 TO TM602-FOB-CDE                     
150700                                        TM600-FOB-CDE.                    
150800     MOVE PV-POE-CDE                 TO TM602-POE-CDE.                    
150900                                                                          
151000 EJECT                                                                    
151100******************************************************************        
151200* LOADS THE TOLERANCES AND PROCESSES EACH RULE.                  *        
151300******************************************************************        
151400 3000-MIDDLE-LOOP-PROCESSING.                                             
151500                                                                          
151600     MOVE '3000-MIDDLE-LOOP-PROCESSING' TO TM600-CURR-PARAGRAPH.          
151700                                                                          
151800     PERFORM 7030-FETCH-TRBL-CONTROL-CURSOR.                              
151900                                                                          
152000     IF PS-EOC-TRBL-CONTROL-CURSOR                                        
152100         PERFORM 7025-CLOSE-TRBL-CONTROL-CURSOR                           
152200     ELSE                                                                 
152300         IF PS-GOOD-TRBL-CNTL-FETCH                                       
152400          PERFORM 3005-MOVE-TIMTBCT-FIELDS                                
152500          MOVE PV-TRIP-TYP-CDE TO PS-TRIP-TYP-SW                          
152600          IF (PS-TRIP-TYP-OCEAN AND IMTBCT-TRIP-OCEN-IND = PC-Y)          
152700                OR                                                        
152800             (PS-TRIP-TYP-AIR   AND IMTBCT-TRIP-AIR-IND  = PC-Y)          
152900                OR                                                        
153000             (PS-TRIP-TYP-TRLR  AND IMTBCT-TRIP-TRLR-IND = PC-Y)          
153100              PERFORM 3010-SELECT-ANY-TROUBLES                            
153200              IF PS-DUPLICATE-TROUBLE                                     
153300                  SET PS-DUPLICATE-TROUBLE-EXISTS TO TRUE                 
153400                  PERFORM 6990-PREP-ERROR-REPORT-LINE                     
153500              ELSE                                                        
153600                  IF (PS-NO-TROUBLE         OR                            
153700                      PS-UNRESOLVED-TROUBLE OR                            
153800                      PS-RESOLVED-TROUBLE)                                
153900                       PERFORM 7035-OPEN-APPL-RULE-CURSOR                 
154000                       PERFORM 4000-INNER-LOOP-PROCESSING                 
154100                  END-IF                                                  
154200              END-IF                                                      
154300          ELSE                                                            
154400              SET PS-TRBL-RSN-TURNED-OFF TO TRUE                          
154500              PERFORM 6990-PREP-ERROR-REPORT-LINE                         
154600          END-IF                                                          
154700         END-IF                                                           
154800     END-IF.                                                              
154900                                                                          
155000 EJECT                                                                    
155100******************************************************************        
155200* MOVE FIELDS FETCHED FROM TIMTBCT TABLE TO WORKING STORAGE AND  *        
155300* TM602 FIELDS.                                                  *        
155400******************************************************************        
155500 3005-MOVE-TIMTBCT-FIELDS.                                                
155600                                                                          
155700     MOVE '3005-MOVE-TIMTBCT-FIELDS' TO TM600-CURR-PARAGRAPH.             
155800                                                                          
155900     MOVE IMTBCT-TRBL-RSN-CDE       TO PV-CURR-TRBL-RSN                   
156000                                       PV-KEY-TRBL-RSN-CDE.               
156100     MOVE IMTBCT-BEG-LMT-DAY-QTY    TO PV-IMTBCT-BEG-LMT-DAY-QTY.         
156200     MOVE PV-IMTBCT-BEG-LMT-DAY-QTY TO TM602-BEG-LMT-DAY-QTY.             
156300     MOVE IMTBCT-END-LMT-DAY-QTY    TO PV-IMTBCT-END-LMT-DAY-QTY.         
156400     MOVE PV-IMTBCT-END-LMT-DAY-QTY TO TM602-END-LMT-DAY-QTY.             
156500     MOVE IMTBCT-BEG-LMT-PCT        TO PV-IMTBCT-BEG-LMT-PCT.             
156600     MOVE PV-IMTBCT-BEG-LMT-PCT     TO TM602-BEG-LMT-PCT.                 
156700     MOVE IMTBCT-END-LMT-PCT        TO PV-IMTBCT-END-LMT-PCT.             
156800     MOVE PV-IMTBCT-END-LMT-PCT     TO TM602-END-LMT-PCT.                 
156900                                                                          
157000                                                                          
157100     MOVE IMTBCT-TRBL-CNTL-TYP-CDE  TO TM602-TRBL-CNTL-TYP-CDE.           
157200                                                                          
157300     EVALUATE TRUE                                                        
157400         WHEN IMTBCT-INITR-ID = 21                                        
157500             MOVE PV-CONSLR-ENT-ID   TO PV-CURR-INITR-ENT-ID              
157600         WHEN IMTBCT-INITR-ID = 22                                        
157700             MOVE PV-DCONSLR-ENT-ID  TO PV-CURR-INITR-ENT-ID              
157800         WHEN IMTBCT-INITR-ID = 23                                        
157900             MOVE PV-CSTM-BKR-ENT-ID TO PV-CURR-INITR-ENT-ID              
158000     END-EVALUATE.                                                        
158100                                                                          
158200     MOVE IMTBCT-INITR-ID          TO PV-CURR-INITR-ID.                   
158300     MOVE IMTBCT-PFMC-TRKG-ID      TO PV-CURR-PFMC-TRKG-ID.               
158400                                                                          
158500     IF PV-TRIP-TYP-CDE = SPACES                                          
158600        IF IMTBCT-TRIP-TRLR-IND = PC-Y                                    
158700            MOVE PC-T TO PV-TRIP-TYP-CDE                                  
158800        END-IF                                                            
158900        IF IMTBCT-TRIP-AIR-IND = PC-Y                                     
159000            MOVE PC-A TO PV-TRIP-TYP-CDE                                  
159100        END-IF                                                            
159200        IF IMTBCT-TRIP-OCEN-IND = PC-Y                                    
159300            MOVE PC-O TO PV-TRIP-TYP-CDE                                  
159400        END-IF                                                            
159500     END-IF.                                                              
159600                                                                          
159700******************************************************************        
159800* DETERMINE IF THERE ARE ANY OPEN TROUBLES FOR THE PO AND THE    *        
159900* TROUBLE REASON BEING PROCESSED.                                *        
160000******************************************************************        
160100 3010-SELECT-ANY-TROUBLES.                                                
160200                                                                          
160300     MOVE '3100-SELECT-ANY-TROUBLES' TO TM600-CURR-PARAGRAPH.             
160400                                                                          
160500     SET PS-TTRBNTF-EXISTS-NO    TO TRUE.                                 
160600     SET PS-DUPLICATE-TROUBLE-NO TO TRUE.                                 
160700                                                                          
160800     MOVE SPACES                 TO PV-PRCT                               
160900                                    PV-PRCR                               
161000                                    PV-PRCU                               
161100                                    PV-PRCS.                              
161200                                                                          
161300     PERFORM 7085-SELECT-TTRBNTF.                                         
161400                                                                          
161500     IF PS-TTRBNTF-EXISTS-NO                                              
161600         SET PS-NO-TROUBLE         TO TRUE                                
161700         MOVE PC-T                 TO PV-PRCT                             
161800     ELSE                                                                 
161900         EVALUATE TRUE                                                    
162000             WHEN (TRBNTF-RESOLVED-TMST = PC-DEFAULT-TMST OR              
162100                   TRBNTF-RESOLVED-TMST = PC-MAX-TMST)   AND              
162200                   TRBRSN-NOTIF-IND = PC-T                                
162300                 SET PS-UNRESOLVED-TROUBLE   TO TRUE                      
162400                 MOVE PC-R                   TO PV-PRCR                   
162500                 MOVE PC-U                   TO PV-PRCU                   
162600                                                                          
162700             WHEN (TRBNTF-RESOLVED-TMST > PC-DEFAULT-TMST AND             
162800                   TRBNTF-RESOLVED-TMST < PC-MAX-TMST)    AND             
162900                   TRBRSN-NOTIF-IND = PC-T                                
163000                 SET PS-RESOLVED-TROUBLE     TO TRUE                      
163100                 MOVE PC-S                   TO PV-PRCS                   
163200                                                                          
163300             WHEN TRBRSN-NOTIF-IND = PC-N                                 
163400                 SET PS-UNRESOLVED-TROUBLE   TO TRUE                      
163500                 MOVE PC-U                   TO PV-PRCU                   
163600         END-EVALUATE                                                     
163700     END-IF.                                                              
163800                                                                          
163900 EJECT                                                                    
164000******************************************************************        
164100* READS THE APPLICATION RULE TABLE AND PROCESSES THE RULES.      *        
164200******************************************************************        
164300 4000-INNER-LOOP-PROCESSING.                                              
164400                                                                          
164500     MOVE '4000-INNER-LOOP-PROCESSING' TO TM600-CURR-PARAGRAPH.           
164600                                                                          
164700     SET PS-BYPASS-UPDATE             TO TRUE.                            
164800     SET PS-BEGIN-INSERT              TO TRUE.                            
164900     SET PS-BYPASS-RESOLVE            TO TRUE.                            
165000     SET PS-BEG-END-LIMITS-NOT-TESTED TO TRUE.                            
165100     SET PS-RULE-PROCESS-CONTINUE     TO TRUE.                            
165200     SET PS-EOC-APPL-RULE-CURSOR-NO   TO TRUE.                            
165300     SET PS-RULE-PROCESS-ERROR-NO     TO TRUE.                            
165400     SET PS-WRITE-TO-TRBDTL-NO        TO TRUE.                            
165500                                                                          
165600     INITIALIZE TM601-RECORD.                                             
165700                                                                          
165800     INITIALIZE PV-TRBL-DETAIL-2ND                                        
165900                PV-TRBL-DETAIL-3RD                                        
166000                PV-TRBL-DETAIL-4TH.                                       
166100                                                                          
166200     SET PS-FIRST-RULE-NO TO TRUE.                                        
166300     SET PS-PO-DETAIL-LINE-WRITTEN-NO TO TRUE.                            
166400                                                                          
166500     PERFORM 5000-PROCESS-RULES                                           
166600         UNTIL PS-EOC-APPL-RULE-CURSOR   OR                               
166700               PS-RULE-PROCESS-ERROR     OR                               
166800               PS-RULE-PROCESS-STOP.                                      
166900                                                                          
167000     IF PS-RULE-PROCESS-STOP     OR                                       
167100        PS-RULE-PROCESS-ERROR                                             
167200         PERFORM 7040-CLOSE-APPL-RULE-CURSOR                              
167300     END-IF.                                                              
167400                                                                          
167500     IF TM602-CURR-RSLV-PROCESS-SW = PC-R                                 
167600       IF PV-CURR-ACTVY-RSLU-CDE = SPACES                                 
167700           SET PS-RULE-PROCESS-ERROR   TO TRUE                            
167800           SET PS-ACTVY-RSLU-CDE-ERROR TO TRUE                            
167900           PERFORM 6990-PREP-ERROR-REPORT-LINE                            
168000       END-IF                                                             
168100     END-IF.                                                              
168200                                                                          
168300     IF PS-FIRST-RULE                                                     
168400        MOVE PS-RULE-PROCESS-ERROR-SW TO                                  
168500                             TM602-RULE-PROCESS-ERROR-SW                  
168600        PERFORM 6980-PREP-PO-DETAIL-LINE                                  
168700        SET PS-PO-DETAIL-LINE-WRITTEN TO TRUE                             
168800     END-IF.                                                              
168900                                                                          
169000     IF (PV-CURR-DATA-SRC = PC-BK OR PC-CN OR                             
169100                            PC-RC OR PC-CS)        AND                    
169200             PS-PO-DETAIL-LINE-WRITTEN                                    
169300          PERFORM 6975-PREP-CONTNR-DETAIL-LINE                            
169400     END-IF.                                                              
169500                                                                          
169600     IF (PS-UPDATE-TROUBLE     OR                                         
169700         PS-INSERT-TROUBLE     OR                                         
169800         PS-RESOLVE-TROUBLE)  AND                                         
169900         PS-RULE-PROCESS-ERROR-NO                                         
170000          PERFORM 4030-CALL-TRBL-UPD-SUBROUTINE                           
170100     END-IF.                                                              
170200                                                                          
170300******************************************************************        
170400* CALLS THE TROUBLE UPDATE SUBROUTINE.                           *        
170500******************************************************************        
170600 4030-CALL-TRBL-UPD-SUBROUTINE.                                           
170700                                                                          
170800     MOVE '4030-CALL-TRBL-UPD-SUBROUTINE' TO TM600-CURR-PARAGRAPH.        
170900                                                                          
171000     ADD +1 TO PA-TOT-SUB-REC-COUNT.                                      
171100                                                                          
171200     MOVE PC-CURRENT-PROGRAM-NAME    TO TM601-CALLING-PGM-NME             
171300                                        TM601-NOTIF-UID                   
171400                                        TM601-RSLVD-UID.                  
171500     MOVE TM602-CURR-TRBL-PROCESS-SW TO TM601-TRBL-PROCESS-SW.            
171600     MOVE TM602-CURR-RSLV-PROCESS-SW TO TM601-RSLV-PROCESS-SW.            
171700     MOVE TM602-CURR-UPD-PROCESS-SW  TO TM601-UPD-PROCESS-SW.             
171800     MOVE PV-IMCNTL-CNTL-ID          TO TM601-CNTRL-NBR.                  
171900                                                                          
172000     MOVE TM602-DATA-SOURCE          TO TM601-DATA-SOURCE.                
172100                                                                          
172200     EVALUATE TM602-DATA-SOURCE                                           
172300         WHEN PC-BK                                                       
172400             MOVE +1 TO TM601-IMPRT-ARRAY-CNT                             
172500             MOVE PV-BKG-SEQ-NBR  TO TM601-AR-BKG-SEQ-NBR (1)             
172600                                     TM601-BKG-SEQ-NBR                    
172700                                                                          
172800         WHEN PC-CN                                                       
172900             MOVE +1 TO TM601-IMPRT-ARRAY-CNT                             
173000             MOVE TM606-CONTNR-ID   TO TM601-AR-CONTNR-ID (1)             
173100                                       TM601-CONTNR-ID                    
173200             MOVE PV-CONTNR-SEQ-NBR TO                                    
173300                                    TM601-AR-CONTNR-SEQ-NBR (1)           
173400                                    TM601-CONTNR-SEQ-NBR                  
173500         WHEN PC-CS                                                       
173600             MOVE +1 TO TM601-IMPRT-ARRAY-CNT                             
173700             MOVE PV-CSTM-ENTR-ID   TO                                    
173800                                    TM601-AR-CSTM-ENTR-ID (1)             
173900                                    TM601-CSTM-ENTR-ID                    
174000         WHEN PC-CV                                                       
174100             MOVE +1 TO TM601-IMPRT-ARRAY-CNT                             
174200             MOVE TM606-MOM-IMPRT-TRIP-ID TO                              
174300                                      TM601-AR-IMPRT-TRIP-ID (1)          
174400             MOVE TM606-CONTNR-ID         TO TM601-CONTNR-ID              
174500             MOVE PV-CONTNR-SEQ-NBR       TO TM601-CONTNR-SEQ-NBR         
174600         WHEN PC-RC                                                       
174700             MOVE +1 TO TM601-IMPRT-ARRAY-CNT                             
174800             MOVE PV-RCVD-SEQ-NBR TO TM601-AR-RCVD-SEQ-NBR (1)            
174900                                     TM601-RCVD-SEQ-NBR                   
175000     END-EVALUATE.                                                        
175100                                                                          
175200     MOVE PV-KEY-PO-NBR              TO TM601-PO-NBR.                     
175300     MOVE PV-KEY-TRBL-RSN-CDE        TO TM601-TRBL-RSN-CDE.               
175400     MOVE TM602-PURCHS-VER-NBR       TO TM601-PURCHS-VER-NBR.             
175500     MOVE TM602-PLNSHP-VER-NBR       TO TM601-PLNSHP-VER-NBR.             
175600     MOVE TM602-PURITM-VER-NBR       TO TM601-PURITM-VER-NBR.             
175700     MOVE TM602-PO-LNE-NBR           TO TM601-PO-LNE-NBR.                 
175800     MOVE PV-FOB-CDE                 TO TM601-FOB-CDE.                    
175900     MOVE PV-POE-CDE                 TO TM601-POE-CDE.                    
176000                                                                          
176100     MOVE PV-CURR-RULE-RESULT-DAYS   TO TM601-ERLY-LTE-DAY-QTY.           
176200     MOVE PV-CURR-RULE-RESULT-PCT    TO TM601-OVER-SHRT-PCT.              
176300     MOVE PV-CURR-INITR-ID           TO TM601-INITR-ID.                   
176400     MOVE PV-CURR-INITR-ENT-ID       TO TM601-INITR-ENT-ID.               
176500     MOVE PV-CURR-RSPNB-RSLU-ID      TO TM601-RSPNB-RSLU-ID.              
176600     MOVE PV-CURR-PFMC-TRKG-ID       TO TM601-PFMC-TRKG-ID.               
176700     MOVE PV-CURR-ACTVY-RSLU-CDE     TO TM601-ACTVY-RSLU-CDE.             
176800     MOVE PV-CURR-TRBL-NOTIF-NBR     TO TM601-TRBL-NOTIF-NBR.             
176900                                                                          
177000     MOVE PV-TRBL-DETAIL-COUNT       TO                                   
177100                                     TM601-TRBL-DETAIL-COUNT.             
177200                                                                          
177300     MOVE TM606-PURCHS-LAST-UPD-TMST TO                                   
177400                                     TM601-PURCHS-LAST-UPD-TMST.          
177500     MOVE TM606-PLNSHP-LAST-UPD-TMST TO                                   
177600                                     TM601-PLNSHP-LAST-UPD-TMST.          
177700     MOVE TM606-IMBKPO-LAST-UPD-TMST TO                                   
177800                                     TM601-IMBKPO-LAST-UPD-TMST.          
177900     MOVE TM606-IMRCPO-LAST-UPD-TMST TO                                   
178000                                     TM601-IMRCPO-LAST-UPD-TMST.          
178100     MOVE TM606-IMCNPO-LAST-UPD-TMST TO                                   
178200                                     TM601-IMCNPO-LAST-UPD-TMST.          
178300     MOVE TM606-IMCSEN-LAST-UPD-TMST TO                                   
178400                                     TM601-IMCSEN-LAST-UPD-TMST.          
178500                                                                          
178600     CALL TM601-TRBL-UPDATE-FORMAT USING TM601-RECORD.                    
178700                                                                          
178800 EJECT                                                                    
178900******************************************************************        
179000* FETCHES RULES, PROCESSES RULE, AND EVALUATES THE RESULTS OF THE*        
179100* RULE JUST PROCESSED.                                           *        
179200******************************************************************        
179300 5000-PROCESS-RULES.                                                      
179400                                                                          
179500     MOVE '5000-PROCESS-RULES' TO TM600-CURR-PARAGRAPH.                   
179600                                                                          
179700     PERFORM 7045-FETCH-APPL-RULE-CURSOR.                                 
179800                                                                          
179900     IF PS-EOC-APPL-RULE-CURSOR                                           
180000         PERFORM 7040-CLOSE-APPL-RULE-CURSOR                              
180100     ELSE                                                                 
180200         IF PS-GOOD-APPL-RULE-FETCH                                       
180300          IF (TBAPRL-RUL-CND-PRC-CDE = PC-TROUBLE AND                     
180400              PS-NO-TROUBLE)                            OR                
180500             (PS-UNRESOLVED-TROUBLE AND                                   
180600              (TBAPRL-RUL-CND-PRC-CDE = PC-RESOLVE OR                     
180700               TBAPRL-RUL-CND-PRC-CDE = PC-UPDATE))     OR                
180800             (PS-RESOLVED-TROUBLE AND                                     
180900              TBAPRL-RUL-CND-PRC-CDE = PC-SPECIAL)                        
181000              SET PS-FIRST-RULE TO TRUE                                   
181100              PERFORM 5005-MOVE-APPL-RULE-FIELDS                          
181200              PERFORM 5010-EXECUTE-RULE                                   
181300              PERFORM 5020-TEST-WRITE-RULE-RESULT                         
181400          END-IF                                                          
181500         END-IF                                                           
181600     END-IF.                                                              
181700                                                                          
181800******************************************************************        
181900* MOVE APPLICATION RULE CURSOR FIELDS TO HOLD AND TM603 FIELDS.  *        
182000******************************************************************        
182100 5005-MOVE-APPL-RULE-FIELDS.                                              
182200                                                                          
182300     MOVE '5005-MOVE-APPL-RULE-FIELDS' TO TM600-CURR-PARAGRAPH.           
182400                                                                          
182500     INITIALIZE                     TM603-RECORD.                         
182600                                                                          
182700     MOVE ZERO                      TO PV-TRBL-DETAIL-COUNT.              
182800                                                                          
182900     MOVE ICDVAL-CDVL-DESC          TO PV-CURR-RULE-NAME                  
183000                                       TM603-CURR-RUL-NAME.               
183100     MOVE TBAPRL-RUL-DATYP-RET-CDE  TO PV-CURR-RULE-RETURN-TYP            
183200                                       TM603-CURR-RUL-RET-TYP.            
183300     MOVE TBAPRL-RUL-CND-IND        TO PV-CURR-RULE-COND-IND              
183400                                       TM603-CURR-RUL-COND-IND.           
183500     MOVE TBAPRL-RUL-CDE            TO PV-CURR-RULE-CDE                   
183600                                       TM603-CURR-RUL-CDE.                
183700     MOVE TBAPRL-RUL-SEQ-NBR        TO PV-CURR-RULE-SEQ-NBR               
183800                                       TM603-CURR-RUL-SEQ-NBR.            
183900     MOVE TBAPRL-RSPNB-RSLU-ID      TO PV-CURR-RSPNB-RSLU-ID.             
184000     MOVE TBAPRL-ACTVY-RSLU-CDE     TO PV-CURR-ACTVY-RSLU-CDE.            
184100     MOVE TBAPRL-RUL-CND-PRC-CDE    TO PV-CURR-RULE-COND-PRC-CDE          
184200                                    TM603-CURR-RUL-COND-PROC-CDE.         
184300     MOVE TBAPRL-SRC-PRCG-APPL-CDE  TO PV-CURR-SRC-PRCG-APPL-CDE          
184400                                    TM603-CURR-SRC-PRCG-APPL-CDE.         
184500                                                                          
184600******************************************************************        
184700* EXECUTES THE RULES FROM THE APPLICATION RULE TABLE.            *        
184800******************************************************************        
184900 5010-EXECUTE-RULE.                                                       
185000                                                                          
185100     MOVE '5010-EXECUTE-RULE' TO TM600-CURR-PARAGRAPH.                    
185200     MOVE PV-CURR-RULE-NAME   TO TM600-CURR-RUL-NAME.                     
185300                                                                          
185400     INITIALIZE TM602-CURR-TRBL-PROCESS-SW                                
185500                TM602-CURR-RSLV-PROCESS-SW                                
185600                TM602-CURR-UPD-PROCESS-SW.                                
185700                                                                          
185800     MOVE +1 TO PV-SUB.                                                   
185900                                                                          
186000     EVALUATE TRUE                                                        
186100         WHEN PV-CURR-RULE-NAME = 'DAYS_AFT_STRT_FCTRY'                   
186200             PERFORM 6010-DAYS-AFT-STRT-FCTRY                             
186300                                                                          
186400         WHEN PV-CURR-RULE-NAME = 'DAYS_AFT_LAST_FCTRY'                   
186500             PERFORM 6015-DAYS-AFT-LAST-FCTRY                             
186600                                                                          
186700         WHEN PV-CURR-RULE-NAME = 'DAYS_BKNG_TO_STRT'                     
186800             PERFORM 6020-DAYS-BKNG-TO-STRT                               
186900                                                                          
187000         WHEN PV-CURR-RULE-NAME = 'DAYS_BKNG_TO_LAST'                     
187100             PERFORM 6025-DAYS-BKNG-TO-LAST                               
187200                                                                          
187300         WHEN PV-CURR-RULE-NAME = 'BKNG_DT_IS_DEFAULT'                    
187400             PERFORM 6030-BKNG-DT-IS-DEFAULT                              
187500                                                                          
187600         WHEN PV-CURR-RULE-NAME = 'A_BOOKING_EXISTS'                      
187700             PERFORM 6035-A-BOOKING-EXISTS                                
187800                                                                          
187900         WHEN PV-CURR-RULE-NAME = 'INDC_FROM_BKNG'                        
188000             PERFORM 6040-INDC-FROM-BKNG                                  
188100                                                                          
188200         WHEN PV-CURR-RULE-NAME = 'DAYS_RCPT_TO_STRT'                     
188300             PERFORM 6045-DAYS-RCPT-TO-STRT                               
188400                                                                          
188500         WHEN PV-CURR-RULE-NAME = 'DAYS_RCPT_TO_LAST'                     
188600             PERFORM 6050-DAYS-RCPT-TO-LAST                               
188700                                                                          
188800         WHEN PV-CURR-RULE-NAME = 'A_RECEIVING_EXISTS'                    
188900             PERFORM 6055-A-RECEIVING-EXISTS                              
189000                                                                          
189100         WHEN PV-CURR-RULE-NAME = 'RCPT_TO_PO_PCT'                        
189200             PERFORM 6060-RCPT-TO-PO-PCT                                  
189300                                                                          
189400         WHEN PV-CURR-RULE-NAME = 'INDC_FROM_DELY'                        
189500             PERFORM 6065-INDC-FROM-DELY                                  
189600                                                                          
189700         WHEN PV-CURR-RULE-NAME = 'DAYS_AFT_SAIL'                         
189800             PERFORM 6080-DAYS-AFT-SAIL                                   
189900                                                                          
190000         WHEN PV-CURR-RULE-NAME = 'DAYS_BET_VESSELS'                      
190100             PERFORM 6090-DAYS-BET-VESSELS                                
190200                                                                          
190300         WHEN PV-CURR-RULE-NAME = 'DAYS_BKNG_TO_CURR'                     
190400             PERFORM 6095-DAYS-BKNG-TO-CURR                               
190500                                                                          
190600         WHEN PV-CURR-RULE-NAME = 'CONTNR_TO_RCPT_PCT'                    
190700             PERFORM 6100-CONTNR-TO-RCPT-PCT                              
190800                                                                          
190900         WHEN PV-CURR-RULE-NAME = 'CONTNR_TO_PO_PCT'                      
191000             PERFORM 6105-CONTNR-TO-PO-PCT                                
191100                                                                          
191200         WHEN PV-CURR-RULE-NAME = 'CONTNR_PKUP_TO_AR'                     
191300             PERFORM 6110-CONTNR-PKUP-TO-AR                               
191400                                                                          
191500         WHEN PV-CURR-RULE-NAME = 'A_CUSTOMS_RELEASE'                     
191600             PERFORM 6115-A-CUSTOMS-RELEASE                               
191700                                                                          
191800         WHEN PV-CURR-RULE-NAME = 'A_DEVAN_DATE'                          
191900             PERFORM 6120-A-DEVAN-DATE                                    
192000                                                                          
192100         WHEN PV-CURR-RULE-NAME = 'CUSTOMS_FILE_TO_CURR'                  
192200             PERFORM 6125-CUSTOMS-FILE-TO-CURR                            
192300                                                                          
192400         WHEN PV-CURR-RULE-NAME = 'CONTNR_PKUP_TO_CURR'                   
192500             PERFORM 6130-CONTNR-PKUP-TO-CURR                             
192600                                                                          
192700         WHEN PV-CURR-RULE-NAME = 'POE_ARRIVAL_TO_CURR'                   
192800             PERFORM 6135-POE-ARRIVAL-TO-CURR                             
192900                                                                          
193000         WHEN PV-CURR-RULE-NAME = 'A_CONTNR_PKUP'                         
193100             PERFORM 6140-A-CONTNR-PKUP                                   
193200                                                                          
193300         WHEN PV-CURR-RULE-NAME = 'A_CONTNR_MANF'                         
193400             PERFORM 6145-A-CONTNR-MANF                                   
193500                                                                          
193600         WHEN PV-CURR-RULE-NAME = 'A_CUSTOMS_FILING'                      
193700             PERFORM 6150-A-CUSTOMS-FILING                                
193800                                                                          
193900         WHEN PV-CURR-RULE-NAME = 'AN_AIR_SHIPMENT'                       
194000             PERFORM 6155-AN-AIR-SHIPMENT                                 
194100                                                                          
194200         WHEN PV-CURR-RULE-NAME = 'BKNG_CRE_TO_STRT'                      
194300             PERFORM 6160-BKNG-CRE-TO-STRT                                
194400                                                                          
194500         WHEN PV-CURR-RULE-NAME = 'RCVG_CRE_TO_LAST'                      
194600             PERFORM 6165-RCVG-CRE-TO-LAST                                
194700                                                                          
194800         WHEN OTHER                                                       
194900             SET PS-RULE-PROCESS-ERROR  TO TRUE                           
195000             SET PS-RULE-PARA-NOT-FOUND TO TRUE                           
195100             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
195200     END-EVALUATE.                                                        
195300                                                                          
195400******************************************************************        
195500* TESTS A RULES RESULT BY EVALUATING THE RULE RETURN TYPE AND    *        
195600* THEN TESTING THE TROUBLE REASON LIMITS.                        *        
195700******************************************************************        
195800 5020-TEST-WRITE-RULE-RESULT.                                             
195900                                                                          
196000     MOVE '5020-TEST-WRITE-RULE-RESULT' TO TM600-CURR-PARAGRAPH.          
196100                                                                          
196200*MAM IF PS-BEG-END-LIMITS-TESTED  AND                                     
196300*MAM    (PV-CURR-RULE-RETURN-TYP = PC-DAY OR PC-PCT)                      
196400*MAM     SET PS-RULE-PROCESS-ERROR      TO TRUE                           
196500*MAM     SET PS-INVALID-RULE-RET-TYP    TO TRUE                           
196600*MAM     PERFORM 6990-PREP-ERROR-REPORT-LINE                              
196700*MAM END-IF.                                                              
196800                                                                          
196900     IF PS-RULE-PROCESS-CONTINUE                                          
197000         EVALUATE TRUE                                                    
197100             WHEN PV-CURR-RULE-RETURN-TYP = PC-DAY                        
197200                 PERFORM 5025-TEST-TOLERANCE-LIMITS-DAY                   
197300                 SET PS-BEG-END-LIMITS-TESTED TO TRUE                     
197400                                                                          
197500             WHEN PV-CURR-RULE-RETURN-TYP = PC-PCT                        
197600                 PERFORM 5030-TEST-TOLERANCE-LIMITS-PCT                   
197700                 SET PS-BEG-END-LIMITS-TESTED TO TRUE                     
197800                                                                          
197900             WHEN PV-CURR-RULE-RETURN-TYP = PC-IND                        
198000                 MOVE PV-RULE-RESULT-IND TO                               
198100                       PV-CURR-RULE-RESULT-IND                            
198200                       TM603-CURR-RUL-RES-IND                             
198300                                                                          
198400             WHEN OTHER                                                   
198500                 SET PS-RULE-PROCESS-ERROR       TO TRUE                  
198600                 SET PS-INVALID-RULE-RET-TYP     TO TRUE                  
198700                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
198800         END-EVALUATE                                                     
198900                                                                          
199000         IF PS-RULE-PROCESS-CONTINUE                                      
199100           IF (PV-CURR-RULE-COND-PRC-CDE = PC-TROUBLE)  AND               
199200              PS-NO-TROUBLE                                               
199300             IF (PV-CURR-RULE-RESULT-IND = PV-CURR-RULE-COND-IND)         
199400                AND                                                       
199500                (PV-EXTR-PRCG-APPL-CDE =                                  
199600                                    PV-CURR-SRC-PRCG-APPL-CDE)            
199700                AND                                                       
199800                (PS-BEGIN-INSERT OR PS-INSERT-TROUBLE)                    
199900                 SET PS-INSERT-TROUBLE TO TRUE                            
200000                 MOVE PS-TROUBLE-PROCESSING-SW TO                         
200100                       TM602-CURR-TRBL-PROCESS-SW                         
200200                 PERFORM 5035-LOAD-TRBL-DETAIL                            
200300             ELSE                                                         
200400                 SET PS-BYPASS-INSERT TO TRUE                             
200500                 IF (PV-EXTR-PRCG-APPL-CDE =                              
200600                                 PV-CURR-SRC-PRCG-APPL-CDE)               
200700                    AND                                                   
200800                    (PV-CURR-RULE-RESULT-IND NOT =                        
200900                      PV-CURR-RULE-COND-IND)                              
201000                     SET PS-RULE-PROCESS-STOP TO TRUE                     
201100                 ELSE                                                     
201200                     SET PS-RULE-PROCESS-ERROR          TO TRUE           
201300                     SET PS-INVALID-DAT-SRC-FOR-PRC-CDE TO TRUE           
201400                     PERFORM 6990-PREP-ERROR-REPORT-LINE                  
201500                 END-IF                                                   
201600             END-IF                                                       
201700           END-IF                                                         
201800                                                                          
201900           IF PV-CURR-RULE-COND-PRC-CDE = PC-UPDATE  AND                  
202000              PS-UNRESOLVED-TROUBLE                                       
202100             IF PV-CURR-RULE-RESULT-IND = PV-CURR-RULE-COND-IND           
202200                 SET PS-UPDATE-TROUBLE    TO TRUE                         
202300                 SET PS-RULE-PROCESS-STOP TO TRUE                         
202400                 MOVE PS-UPDATE-PROCESSING-SW TO                          
202500                       TM602-CURR-UPD-PROCESS-SW                          
202600                 PERFORM 5035-LOAD-TRBL-DETAIL                            
202700             END-IF                                                       
202800           END-IF                                                         
202900                                                                          
203000           IF PV-CURR-RULE-COND-PRC-CDE = PC-SPECIAL AND                  
203100              PS-RESOLVED-TROUBLE                                         
203200                 SET PS-UPDATE-TROUBLE    TO TRUE                         
203300                 SET PS-RULE-PROCESS-STOP TO TRUE                         
203400                 MOVE PS-UPDATE-PROCESSING-SW TO                          
203500                       TM602-CURR-UPD-PROCESS-SW                          
203600                 PERFORM 5035-LOAD-TRBL-DETAIL                            
203700           END-IF                                                         
203800                                                                          
203900           IF PV-CURR-RULE-COND-PRC-CDE = PC-RESOLVE AND                  
204000              PS-UNRESOLVED-TROUBLE                                       
204100             IF PV-CURR-RULE-RESULT-IND = PV-CURR-RULE-COND-IND           
204200                 SET PS-RESOLVE-TROUBLE   TO TRUE                         
204300                 SET PS-RULE-PROCESS-STOP TO TRUE                         
204400                 MOVE PS-RESOLVE-PROCESSING-SW TO                         
204500                       TM602-CURR-RSLV-PROCESS-SW                         
204600                 PERFORM 5035-LOAD-TRBL-DETAIL                            
204700             END-IF                                                       
204800           END-IF                                                         
204900                                                                          
205000           IF PS-RULE-PROCESS-ERROR-NO                                    
205100               PERFORM 6985-PREP-RULE-DETAIL-LINE                         
205200           END-IF                                                         
205300         END-IF                                                           
205400     END-IF.                                                              
205500                                                                          
205600 EJECT                                                                    
205700******************************************************************        
205800* TESTS A RULES RESULT BY EVALUATING THE RULE RETURN TYPE AND    *        
205900* THEN TESTING THE TROUBLE REASON LIMITS.                        *        
206000******************************************************************        
206100 5025-TEST-TOLERANCE-LIMITS-DAY.                                          
206200                                                                          
206300     MOVE '5025-TEST-TOLERANCE-LIMITS-DAY' TO                             
206400            TM600-CURR-PARAGRAPH.                                         
206500                                                                          
206600     IF ((PV-CURR-RULE-RESULT-DAYS = IMTBCT-BEG-LMT-DAY-QTY) OR           
206700         (PV-CURR-RULE-RESULT-DAYS > IMTBCT-BEG-LMT-DAY-QTY))             
206800            AND                                                           
206900        ((PV-CURR-RULE-RESULT-DAYS = IMTBCT-END-LMT-DAY-QTY) OR           
207000         (PV-CURR-RULE-RESULT-DAYS < IMTBCT-END-LMT-DAY-QTY))             
207100         MOVE PC-Y TO PV-CURR-RULE-RESULT-IND                             
207200     ELSE                                                                 
207300         MOVE PC-N TO PV-CURR-RULE-RESULT-IND                             
207400     END-IF.                                                              
207500                                                                          
207600     MOVE PV-CURR-RULE-RESULT-DAYS TO TM603-CURR-RUL-RES-DAYS.            
207700     MOVE PV-CURR-RULE-RESULT-IND  TO TM603-CURR-RUL-RES-IND.             
207800                                                                          
207900******************************************************************        
208000* TESTS A RULES RESULT BY EVALUATING THE RULE RETURN TYPE AND    *        
208100* THEN TESTING THE TROUBLE REASON LIMITS.                        *        
208200******************************************************************        
208300 5030-TEST-TOLERANCE-LIMITS-PCT.                                          
208400                                                                          
208500     MOVE '5030-TEST-TOLERANCE-LIMITS-PCT' TO                             
208600            TM600-CURR-PARAGRAPH.                                         
208700                                                                          
208800     IF ((PV-CURR-RULE-RESULT-PCT = IMTBCT-BEG-LMT-PCT) OR                
208900         (PV-CURR-RULE-RESULT-PCT > IMTBCT-BEG-LMT-PCT))                  
209000            AND                                                           
209100        ((PV-CURR-RULE-RESULT-PCT = IMTBCT-END-LMT-PCT) OR                
209200         (PV-CURR-RULE-RESULT-PCT < IMTBCT-END-LMT-PCT))                  
209300         MOVE PC-Y TO PV-CURR-RULE-RESULT-IND                             
209400     ELSE                                                                 
209500         MOVE PC-N TO PV-CURR-RULE-RESULT-IND                             
209600     END-IF.                                                              
209700                                                                          
209800     MOVE PV-CURR-RULE-RESULT-IND TO TM603-CURR-RUL-RES-IND.              
209900     MOVE PV-CURR-RULE-RESULT-PCT TO TM603-CURR-RUL-RES-PCT.              
210000                                                                          
210100 EJECT                                                                    
210200******************************************************************        
210300* LOAD DATA INTO THE TROUBLE DETAIL ARRAY BEFORE PASSING IT TO   *        
210400* THE SUBROUTINE.                                                *        
210500******************************************************************        
210600 5035-LOAD-TRBL-DETAIL.                                                   
210700                                                                          
210800     IF (PV-EXTR-PRCG-APPL-CDE = PC-BD OR PC-RD)  OR                      
210900        PS-WRITE-TO-TRBDTL-NO                                             
211000         MOVE ZERO TO PV-TRBL-DETAIL-COUNT                                
211100     ELSE                                                                 
211200         INITIALIZE PV-TRBL-DETAIL-TXT                                    
211300         PERFORM 7095-SELECT-TTRBRSN                                      
211400         IF PS-TTRBRSN-EXISTS                                             
211500             MOVE TRBRSN-TRBL-LONG-DESC  TO PV-TRBL-DETAIL-TXT1           
211600             MOVE PV-TRBL-DETAIL-2ND     TO PV-TRBL-DETAIL-TXT2           
211700             MOVE PV-TRBL-DETAIL-3RD     TO PV-TRBL-DETAIL-TXT3           
211800             MOVE PV-TRBL-DETAIL-4TH     TO PV-TRBL-DETAIL-TXT4           
211900             MOVE PV-TRBL-DETAIL-TXT     TO                               
212000                                  TM601-TRBL-DTL-TXT-TXT (PV-SUB)         
212100             ADD +1 TO PV-TRBL-DETAIL-COUNT                               
212200             MOVE +200 TO TM601-TRBL-DTL-TXT-LEN (PV-SUB)                 
212300             ADD +1 TO PV-SUB                                             
212400         END-IF                                                           
212500     END-IF.                                                              
212600                                                                          
212700******************************************************************        
212800* RULE DESCRIPTION:  DAYS AFTER STRT FCTRY DATE                  *        
212900* RULE RETURN TYPE:  DAYS                                        *        
213000* RULE CALLS:        NONE                                        *        
213100******************************************************************        
213200 6010-DAYS-AFT-STRT-FCTRY.                                                
213300                                                                          
213400     MOVE '6010-DAYS-AFT-STRT-FCTRY' TO TM600-CURR-PARAGRAPH.             
213500                                                                          
213600     INITIALIZE PV-6010-DAYS-AFT-STRT-FCTRY.                              
213700                                                                          
213800     IF TM602-STRT-FCTRY-DTE = PC-DEFAULT-DTE                             
213900         PERFORM 7090-SELECT-TPLNSHP-DATES                                
214000         IF PS-TPLNSHP-STRT-FCTRY-NO                                      
214100             SET PS-NO-TPLNSHP-STRT-FCTRY TO TRUE                         
214200             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
214300         ELSE                                                             
214400             MOVE PV-STRT-FCTRY-DTE TO TM602-STRT-FCTRY-DTE               
214500         END-IF                                                           
214600     END-IF.                                                              
214700                                                                          
214800     IF TM602-STRT-FCTRY-DTE = PC-DEFAULT-DTE                             
214900         MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                          
215000     ELSE                                                                 
215100         PERFORM                                                          
215200             WITH TEST AFTER                                              
215300             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
215400             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                
215500                     SQLCODE = ZERO                     OR                
215600                     SQLCODE = -811                     OR                
215700                     SQLCODE = -180                                       
215800                                                                          
215900             EXEC SQL                                                     
216000               SELECT DISTINCT DAYS(CURRENT_DATE)                         
216100                             - DAYS(DATE(:TM602-STRT-FCTRY-DTE))          
216200                 INTO :PV-6010-LAST-RESULT-DAYS                           
216300                 FROM TIMCNTL                                             
216400             END-EXEC                                                     
216500                                                                          
216600             EVALUATE TRUE                                                
216700                 WHEN SQLCODE = ZERO                                      
216800                 WHEN SQLCODE = -811                                      
216900                     SET PS-WRITE-TO-TRBDTL TO TRUE                       
217000                     MOVE PV-CURR-PO-NBR TO PV-6010-LAST-PO-NBR           
217100                     MOVE PV-6010-LAST-RESULT-DAYS TO                     
217200                           PV-CURR-RULE-RESULT-DAYS                       
217300                           PV-RESULTS                                     
217400                     MOVE PV-RESULTS TO PV-RESULTS-X                      
217500                                                                          
217600                     STRING 'STRT FCTRY = ',                              
217700                             TM602-STRT-FCTRY-DTE (6:2), '/',             
217800                             TM602-STRT-FCTRY-DTE (9:2), '/',             
217900                             TM602-STRT-FCTRY-DTE (1:4),                  
218000                             '   CURR DATE = ',                           
218100                             PV-REFORMAT-DTE                              
218200                             DELIMITED BY SIZE                            
218300                        INTO PV-TRBL-DETAIL-2ND                           
218400                                                                          
218500                     STRING  'SEVERITY = ',                               
218600                             PV-RESULTS-X, ' DAY(S)'                      
218700                             DELIMITED BY SIZE                            
218800                        INTO PV-TRBL-DETAIL-3RD                           
218900                                                                          
219000                 WHEN SQLCODE = -911                                      
219100                 WHEN SQLCODE = -913                                      
219200                 WHEN SQLCODE = -904                                      
219300                     CONTINUE                                             
219400                 WHEN SQLCODE = -180                                      
219500                     SET PS-INVALID-DATE-WAS-USED TO TRUE                 
219600                     PERFORM 6990-PREP-ERROR-REPORT-LINE                  
219700                     SET PS-RULE-PROCESS-ERROR    TO TRUE                 
219800                                                                          
219900                 WHEN SQLWARN0 NOT EQUAL SPACE                            
220000                 WHEN SQLCODE NOT EQUAL ZERO                              
220100                     DISPLAY '***********************************'        
220200                     DISPLAY '** ABEND                         **'        
220300                     DISPLAY '** PROGRAM = TMKUP625            **'        
220400                     DISPLAY '** PARAGRAPH =                   **'        
220500                     DISPLAY '**    6010-DAYS-AFT-STRT-FCTRY   **'        
220600                     DISPLAY '** SELECT TIMCNTL                **'        
220700                     DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR          
220800                     DISPLAY '** STRT FCTRY DT = '                        
220900                     DISPLAY                TM602-STRT-FCTRY-DTE          
221000                     DISPLAY '***********************************'        
221100                     PERFORM 9100-SQL-ABEND                               
221200             END-EVALUATE                                                 
221300         END-PERFORM                                                      
221400                                                                          
221500           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                      
221600              (SQLCODE NOT = ZERO    AND                                  
221700               SQLCODE NOT = -811    AND                                  
221800               SQLCODE NOT = -180)                                        
221900              DISPLAY '******************************************'        
222000              DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'        
222100              DISPLAY '** SELECT FROM TIMCNTL                  **'        
222200              DISPLAY '** PARAGRAPH = 6010-DAYS-AFT-STRT-FCTRY **'        
222300              DISPLAY '** PO NUMBER = ' PV-KEY-PO-NBR                     
222400              DISPLAY '** STRT FCTRY DT  = '                              
222500                                         TM602-STRT-FCTRY-DTE             
222600              DISPLAY '******************************************'        
222700              PERFORM 9100-SQL-ABEND                                      
222800           END-IF                                                         
222900     END-IF.                                                              
223000                                                                          
223100******************************************************************        
223200* RULE DESCRIPTION:  DAYS AFTER LAST FCTRY DATE                  *        
223300* RULE RETURN TYPE:  DAYS                                        *        
223400* RULE CALLS:        NONE                                        *        
223500******************************************************************        
223600 6015-DAYS-AFT-LAST-FCTRY.                                                
223700                                                                          
223800     MOVE '6015-DAYS-AFT-LAST-FCTRY' TO TM600-CURR-PARAGRAPH.             
223900                                                                          
224000     INITIALIZE PV-6015-DAYS-AFT-LAST-FCTRY.                              
224100                                                                          
224200     IF TM602-LAST-FCTRY-DTE = PC-DEFAULT-DTE                             
224300         PERFORM 7090-SELECT-TPLNSHP-DATES                                
224400         IF PS-TPLNSHP-LAST-FCTRY-NO                                      
224500             SET PS-NO-TPLNSHP-LAST-FCTRY TO TRUE                         
224600             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
224700         ELSE                                                             
224800             MOVE PV-LAST-FCTRY-DTE TO TM602-LAST-FCTRY-DTE               
224900         END-IF                                                           
225000     END-IF.                                                              
225100                                                                          
225200     IF TM602-LAST-FCTRY-DTE = PC-DEFAULT-DTE                             
225300         MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                          
225400     ELSE                                                                 
225500           PERFORM                                                        
225600               WITH TEST AFTER                                            
225700               VARYING PV-RETRY-COUNTER FROM 1 BY 1                       
225800               UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              
225900                       SQLCODE = ZERO                     OR              
226000                       SQLCODE = -811                     OR              
226100                       SQLCODE = -180                                     
226200                                                                          
226300             EXEC SQL                                                     
226400               SELECT DISTINCT DAYS(CURRENT_DATE)                         
226500                             - DAYS(DATE(:TM602-LAST-FCTRY-DTE))          
226600                 INTO :PV-6015-LAST-RESULT-DAYS                           
226700                 FROM TIMCNTL                                             
226800             END-EXEC                                                     
226900                                                                          
227000             EVALUATE TRUE                                                
227100                 WHEN SQLCODE = ZERO                                      
227200                 WHEN SQLCODE = -811                                      
227300                     SET PS-WRITE-TO-TRBDTL TO TRUE                       
227400                     MOVE PV-CURR-PO-NBR TO PV-6015-LAST-PO-NBR           
227500                     MOVE PV-6015-LAST-RESULT-DAYS TO                     
227600                           PV-CURR-RULE-RESULT-DAYS                       
227700                           PV-RESULTS                                     
227800                     MOVE PV-RESULTS TO PV-RESULTS-X                      
227900                                                                          
228000                     STRING 'LAST FCTRY = ',                              
228100                             TM602-LAST-FCTRY-DTE (6:2), '/',             
228200                             TM602-LAST-FCTRY-DTE (9:2), '/',             
228300                             TM602-LAST-FCTRY-DTE (1:4),                  
228400                             '   CURR DATE = ',                           
228500                             PV-REFORMAT-DTE                              
228600                             DELIMITED BY SIZE                            
228700                        INTO PV-TRBL-DETAIL-2ND                           
228800                                                                          
228900                     STRING  'SEVERITY = ',                               
229000                             PV-RESULTS-X, ' DAY(S)'                      
229100                             DELIMITED BY SIZE                            
229200                        INTO PV-TRBL-DETAIL-3RD                           
229300                                                                          
229400                 WHEN SQLCODE = -180                                      
229500                     SET PS-INVALID-DATE-WAS-USED TO TRUE                 
229600                     PERFORM 6990-PREP-ERROR-REPORT-LINE                  
229700                     SET PS-RULE-PROCESS-ERROR    TO TRUE                 
229800                                                                          
229900                 WHEN SQLCODE = -911                                      
230000                 WHEN SQLCODE = -913                                      
230100                 WHEN SQLCODE = -904                                      
230200                     CONTINUE                                             
230300                                                                          
230400                 WHEN SQLWARN0 NOT EQUAL SPACE                            
230500                 WHEN SQLCODE NOT EQUAL ZERO                              
230600                     DISPLAY '***********************************'        
230700                     DISPLAY '** ABEND                         **'        
230800                     DISPLAY '** PROGRAM = TMKUP625            **'        
230900                     DISPLAY '** PARAGRAPH =                   **'        
231000                     DISPLAY '**    6015-DAYS-AFT-LAST-FCTRY   **'        
231100                     DISPLAY '** SELECT TIMCNTL                **'        
231200                     DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR          
231300                     DISPLAY '** LAST FCTRY DT = '                        
231400                     DISPLAY                TM602-LAST-FCTRY-DTE          
231500                     DISPLAY '***********************************'        
231600                     PERFORM 9100-SQL-ABEND                               
231700             END-EVALUATE                                                 
231800           END-PERFORM                                                    
231900                                                                          
232000           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                      
232100              (SQLCODE NOT = ZERO    AND                                  
232200               SQLCODE NOT = -811    AND                                  
232300               SQLCODE NOT = -180)                                        
232400              DISPLAY '******************************************'        
232500              DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'        
232600              DISPLAY '** SELECT FROM TIMCNTL                  **'        
232700              DISPLAY '** PARAGRAPH = 6015-DAYS-AFT-LAST-FCTRY **'        
232800              DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                
232900              DISPLAY '** LAST FCTRY DT  = '                              
233000                                         TM602-LAST-FCTRY-DTE             
233100              DISPLAY '******************************************'        
233200              PERFORM 9100-SQL-ABEND                                      
233300           END-IF                                                         
233400     END-IF.                                                              
233500                                                                          
233600******************************************************************        
233700* RULE DESCRIPTION:  DAYS FROM BKNG DELY DATE TO STRT FCTRY DTE  *        
233800* RULE RETURN TYPE:  DAYS                                        *        
233900* RULE CALLS:        NONE                                        *        
234000******************************************************************        
234100 6020-DAYS-BKNG-TO-STRT.                                                  
234200                                                                          
234300     MOVE '6020-DAYS-BKNG-TO-STRT' TO TM600-CURR-PARAGRAPH.               
234400                                                                          
234500     INITIALIZE PV-6020-DAYS-BKNG-TO-STRT.                                
234600                                                                          
234700     PERFORM                                                              
234800         WITH TEST AFTER                                                  
234900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
235000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
235100                 SQLCODE = ZERO                     OR                    
235200                 SQLCODE = -811                     OR                    
235300                 SQLCODE = -180                                           
235400                                                                          
235500         EXEC SQL                                                         
235600           SELECT DISTINCT                                                
235700                       DAYS(DATE(:TM602-PO-BKG-DELY-DTE))                 
235800                     - DAYS(:TM602-STRT-FCTRY-DTE)                        
235900             INTO :PV-6020-LAST-RESULT-DAYS                               
236000             FROM TIMCNTL                                                 
236100         END-EXEC                                                         
236200                                                                          
236300         EVALUATE TRUE                                                    
236400             WHEN SQLCODE = ZERO                                          
236500             WHEN SQLCODE = -811                                          
236600                 SET PS-WRITE-TO-TRBDTL TO TRUE                           
236700                 MOVE PV-CURR-PO-NBR TO PV-6020-LAST-PO-NBR               
236800                 MOVE PV-6020-LAST-RESULT-DAYS TO                         
236900                      PV-CURR-RULE-RESULT-DAYS                            
237000                      PV-RESULTS                                          
237100                 MOVE PV-RESULTS TO PV-RESULTS-X                          
237200                                                                          
237300                 STRING 'BKG DELY DT = ',                                 
237400                         TM602-PO-BKG-DELY-DTE (6:2), '/',                
237500                         TM602-PO-BKG-DELY-DTE (9:2), '/',                
237600                         TM602-PO-BKG-DELY-DTE (1:4),                     
237700                         '   STRT FCTRY = ',                              
237800                         TM602-STRT-FCTRY-DTE (6:2), '/',                 
237900                         TM602-STRT-FCTRY-DTE (9:2), '/',                 
238000                         TM602-STRT-FCTRY-DTE (1:4),                      
238100                         DELIMITED BY SIZE                                
238200                    INTO PV-TRBL-DETAIL-2ND                               
238300                                                                          
238400                 STRING  'ORIGIN SHIP TYPE = ',                           
238500                         IMBKPO-ORGN-SHPD-FR-CDE,                         
238600                         '     REF = ',                                   
238700                         PV-EXTL-REF-NBR,                                 
238800                         DELIMITED BY SIZE                                
238900                    INTO PV-TRBL-DETAIL-3RD                               
239000                                                                          
239100                 STRING  'SEVERITY = ',                                   
239200                         PV-RESULTS-X, ' DAY(S)'                          
239300                         DELIMITED BY SIZE                                
239400                    INTO PV-TRBL-DETAIL-4TH                               
239500                                                                          
239600             WHEN SQLCODE = -180                                          
239700                 SET PS-INVALID-DATE-WAS-USED TO TRUE                     
239800                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
239900                 SET PS-RULE-PROCESS-ERROR    TO TRUE                     
240000                                                                          
240100                 WHEN SQLCODE = -911                                      
240200                 WHEN SQLCODE = -913                                      
240300                 WHEN SQLCODE = -904                                      
240400                     CONTINUE                                             
240500                                                                          
240600             WHEN SQLWARN0 NOT EQUAL SPACE                                
240700             WHEN SQLCODE NOT EQUAL ZERO                                  
240800                 DISPLAY '***********************************'            
240900                 DISPLAY '** ABEND                         **'            
241000                 DISPLAY '** PROGRAM = TMKUP625            **'            
241100                 DISPLAY '** PARAGRAPH =                   **'            
241200                 DISPLAY '**    6020-DAYS-BKNG-TO-STRT     **'            
241300                 DISPLAY '** SELECT TIMCNTL                **'            
241400                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
241500                 DISPLAY '** BKNG DELY DT  = '                            
241600                 DISPLAY               TM602-PO-BKG-DELY-DTE              
241700                 DISPLAY '** STRT FCTRY DT = '                            
241800                 DISPLAY               TM602-STRT-FCTRY-DTE               
241900                 DISPLAY '***********************************'            
242000                 PERFORM 9100-SQL-ABEND                                   
242100         END-EVALUATE                                                     
242200     END-PERFORM.                                                         
242300                                                                          
242400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
242500         (SQLCODE NOT = ZERO    AND                                       
242600          SQLCODE NOT = -811    AND                                       
242700          SQLCODE NOT = -180)                                             
242800         DISPLAY '*******************************************'            
242900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
243000         DISPLAY '** SELECT FROM TIMCNTL                   **'            
243100         DISPLAY '** PARAGRAPH = 6020-DAYS-BKNG-TO-STRT    **'            
243200         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
243300         DISPLAY '** BKNG DELY DT  = ' TM602-PO-BKG-DELY-DTE              
243400         DISPLAY '** STRT FCTRY DT = ' TM602-STRT-FCTRY-DTE               
243500         DISPLAY '*******************************************'            
243600         PERFORM 9100-SQL-ABEND                                           
243700     END-IF.                                                              
243800                                                                          
243900******************************************************************        
244000* RULE DESCRIPTION:  DAYS FROM BKNG DELY DTE TO LAST FCTRY DTE   *        
244100* RULE RETURN TYPE:  DAYS                                        *        
244200* RULE CALLS:        NONE                                        *        
244300******************************************************************        
244400 6025-DAYS-BKNG-TO-LAST.                                                  
244500                                                                          
244600     MOVE '6025-DAYS-BKNG-TO-LAST' TO TM600-CURR-PARAGRAPH.               
244700                                                                          
244800     INITIALIZE PV-6025-DAYS-BKNG-TO-LAST.                                
244900                                                                          
245000     PERFORM                                                              
245100         WITH TEST AFTER                                                  
245200         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
245300         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
245400                 SQLCODE = ZERO                     OR                    
245500                 SQLCODE = -811                     OR                    
245600                 SQLCODE = -180                                           
245700                                                                          
245800         EXEC SQL                                                         
245900           SELECT DISTINCT                                                
246000                       DAYS(DATE(:TM602-PO-BKG-DELY-DTE))                 
246100                     - DAYS(:TM602-LAST-FCTRY-DTE)                        
246200             INTO :PV-6025-LAST-RESULT-DAYS                               
246300             FROM TIMCNTL                                                 
246400         END-EXEC                                                         
246500                                                                          
246600         EVALUATE TRUE                                                    
246700             WHEN SQLCODE = ZERO                                          
246800             WHEN SQLCODE = -811                                          
246900                 SET PS-WRITE-TO-TRBDTL TO TRUE                           
247000                 MOVE PV-CURR-PO-NBR TO PV-6025-LAST-PO-NBR               
247100                 MOVE PV-6025-LAST-RESULT-DAYS TO                         
247200                      PV-CURR-RULE-RESULT-DAYS                            
247300                      PV-RESULTS                                          
247400                 MOVE PV-RESULTS TO PV-RESULTS-X                          
247500                                                                          
247600                 STRING 'BKG DELY DT = ',                                 
247700                         TM602-PO-BKG-DELY-DTE (6:2), '/',                
247800                         TM602-PO-BKG-DELY-DTE (9:2), '/',                
247900                         TM602-PO-BKG-DELY-DTE (1:4),                     
248000                         '   LAST FCTRY = ',                              
248100                         TM602-LAST-FCTRY-DTE (6:2), '/',                 
248200                         TM602-LAST-FCTRY-DTE (9:2), '/',                 
248300                         TM602-LAST-FCTRY-DTE (1:4),                      
248400                         DELIMITED BY SIZE                                
248500                    INTO PV-TRBL-DETAIL-2ND                               
248600                                                                          
248700                 STRING  'ORIGIN SHIP TYPE = ',                           
248800                         IMBKPO-ORGN-SHPD-FR-CDE,                         
248900                         '     REF = ',                                   
249000                         PV-EXTL-REF-NBR,                                 
249100                         DELIMITED BY SIZE                                
249200                    INTO PV-TRBL-DETAIL-3RD                               
249300                                                                          
249400                 STRING  'SEVERITY = ',                                   
249500                         PV-RESULTS-X, ' DAY(S)'                          
249600                         DELIMITED BY SIZE                                
249700                    INTO PV-TRBL-DETAIL-4TH                               
249800                                                                          
249900             WHEN SQLCODE = -180                                          
250000                 SET PS-INVALID-DATE-WAS-USED TO TRUE                     
250100                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
250200                 SET PS-RULE-PROCESS-ERROR    TO TRUE                     
250300                                                                          
250400                 WHEN SQLCODE = -911                                      
250500                 WHEN SQLCODE = -913                                      
250600                 WHEN SQLCODE = -904                                      
250700                     CONTINUE                                             
250800                                                                          
250900             WHEN SQLWARN0 NOT EQUAL SPACE                                
251000             WHEN SQLCODE NOT EQUAL ZERO                                  
251100                 DISPLAY '***********************************'            
251200                 DISPLAY '** ABEND                         **'            
251300                 DISPLAY '** PROGRAM = TMKUP625            **'            
251400                 DISPLAY '** PARAGRAPH =                   **'            
251500                 DISPLAY '**    6025-DAYS-BKNG-TO-LAST     **'            
251600                 DISPLAY '** SELECT TIMCNTL                **'            
251700                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
251800                 DISPLAY '** BKNG DELY DT  = '                            
251900                 DISPLAY               TM602-PO-BKG-DELY-DTE              
252000                 DISPLAY '** LAST FCTRY DT = '                            
252100                 DISPLAY               TM602-LAST-FCTRY-DTE               
252200                 DISPLAY '***********************************'            
252300                 PERFORM 9100-SQL-ABEND                                   
252400         END-EVALUATE                                                     
252500     END-PERFORM.                                                         
252600                                                                          
252700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
252800         (SQLCODE NOT = ZERO    AND                                       
252900          SQLCODE NOT = -811    AND                                       
253000          SQLCODE NOT = -180)                                             
253100         DISPLAY '*******************************************'            
253200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
253300         DISPLAY '** SELECT FROM TIMCNTL                   **'            
253400         DISPLAY '** PARAGRAPH = 6025-DAYS-BKNG-TO-LAST    **'            
253500         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
253600         DISPLAY '** BKNG DELY DT  = ' TM602-PO-BKG-DELY-DTE              
253700         DISPLAY '** LAST FCTRY DT = ' TM602-LAST-FCTRY-DTE               
253800         DISPLAY '*******************************************'            
253900         PERFORM 9100-SQL-ABEND                                           
254000     END-IF.                                                              
254100                                                                          
254200******************************************************************        
254300* RULE DESCRIPTION:                                              *        
254400* RULE RETURN TYPE:  INDICATOR                                   *        
254500* RULE CALLS:        NONE                                        *        
254600******************************************************************        
254700 6030-BKNG-DT-IS-DEFAULT.                                                 
254800                                                                          
254900     MOVE '6030-BKNG-DT-IS-DEFAULT' TO TM600-CURR-PARAGRAPH.              
255000                                                                          
255100******************************************************************        
255200* RULE DESCRIPTION:  NO BOOKING EXISTS                           *        
255300* RULE RETURN TYPE:  INDICATOR                                   *        
255400* RULE CALLS:        NONE                                        *        
255500******************************************************************        
255600 6035-A-BOOKING-EXISTS.                                                   
255700                                                                          
255800     MOVE '6035-A-BOOKING-EXISTS' TO TM600-CURR-PARAGRAPH.                
255900                                                                          
256000     INITIALIZE PV-6035-A-BOOKING-EXISTS.                                 
256100                                                                          
256200     PERFORM                                                              
256300         WITH TEST AFTER                                                  
256400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
256500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
256600                 SQLCODE = ZERO                     OR                    
256700                 SQLCODE = -811                     OR                    
256800                 SQLCODE = +100                                           
256900                                                                          
257000         EVALUATE TRUE                                                    
257100         WHEN PV-BOOKING-DELETE                                           
257200           EXEC SQL                                                       
257300             SELECT PO_NBR                                                
257400              INTO :PV-6035-LAST-PO-NBR                                   
257500                                                                          
257600               FROM TIMBKPO                                               
257700              WHERE PO_NBR         = :PV-CURR-PO-NBR                      
257800              AND PO_BKG_SEQ_NBR   = :PV-BKG-SEQ-NBR                      
257900           END-EXEC                                                       
258000         WHEN OTHER                                                       
258100           EXEC SQL                                                       
258200             SELECT PO_NBR                                                
258300              INTO :PV-6035-LAST-PO-NBR                                   
258400                                                                          
258500               FROM TIMBKPO                                               
258600              WHERE PO_NBR         = :PV-CURR-PO-NBR                      
258700           END-EXEC                                                       
258800         END-EVALUATE                                                     
258900                                                                          
259000         EVALUATE TRUE                                                    
259100             WHEN SQLCODE = ZERO                                          
259200             WHEN SQLCODE = -811                                          
259300                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
259400                              PV-6035-LAST-RESULT-IND                     
259500                                                                          
259600             WHEN SQLCODE = +100                                          
259700                 MOVE PC-N TO PV-RULE-RESULT-IND                          
259800                              PV-6035-LAST-RESULT-IND                     
259900                                                                          
260000                                                                          
260100                 WHEN SQLCODE = -911                                      
260200                 WHEN SQLCODE = -913                                      
260300                 WHEN SQLCODE = -904                                      
260400                     CONTINUE                                             
260500                                                                          
260600             WHEN SQLWARN0 NOT EQUAL SPACE                                
260700             WHEN SQLCODE NOT EQUAL ZERO                                  
260800                 DISPLAY '***********************************'            
260900                 DISPLAY '** ABEND                         **'            
261000                 DISPLAY '** PROGRAM = TMKUP625            **'            
261100                 DISPLAY '** PARAGRAPH =                   **'            
261200                 DISPLAY '**    6035-A-BOOKING-EXISTS      **'            
261300                 DISPLAY '** SELECT TIMCNTL                **'            
261400                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
261500                 DISPLAY '** BKNG DELY DT  = '                            
261600                 DISPLAY               TM602-PO-BKG-DELY-DTE              
261700                 DISPLAY '** PO BKG SEQ NBR= '                            
261800                 DISPLAY               PV-BKG-SEQ-NBR                     
261900                 DISPLAY '***********************************'            
262000                 PERFORM 9100-SQL-ABEND                                   
262100         END-EVALUATE                                                     
262200     END-PERFORM.                                                         
262300                                                                          
262400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
262500         (SQLCODE NOT = ZERO    AND                                       
262600          SQLCODE NOT = -811    AND                                       
262700          SQLCODE NOT = +100)                                             
262800         DISPLAY '*******************************************'            
262900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
263000         DISPLAY '** SELECT FROM TIMCNTL                   **'            
263100         DISPLAY '** PARAGRAPH = 6035-A-BOOKING-EXISTS     **'            
263200         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
263300         DISPLAY '** BKNG DELY DT   = ' TM602-PO-BKG-DELY-DTE             
263400         DISPLAY '** PO BKG SEQ NBR = ' PV-BKG-SEQ-NBR                    
263500         DISPLAY '*******************************************'            
263600         PERFORM 9100-SQL-ABEND                                           
263700     END-IF.                                                              
263800                                                                          
263900******************************************************************        
264000* RULE DESCRIPTION:                                              *        
264100* RULE RETURN TYPE:  DAYS                                        *        
264200* RULE CALLS:        INDC                                        *        
264300******************************************************************        
264400 6040-INDC-FROM-BKNG.                                                     
264500                                                                          
264600     MOVE '6040-INDC-FROM-BKNG' TO TM600-CURR-PARAGRAPH.                  
264700                                                                          
264800******************************************************************        
264900* RULE DESCRIPTION:  DAYS FROM RCVD DELY DTE TO STRT FCTRY DTE   *        
265000* RULE RETURN TYPE:  DAYS                                        *        
265100* RULE CALLS:        NONE                                        *        
265200******************************************************************        
265300 6045-DAYS-RCPT-TO-STRT.                                                  
265400                                                                          
265500     MOVE '6045-DAYS-RCPT-TO-STRT' TO TM600-CURR-PARAGRAPH.               
265600                                                                          
265700     INITIALIZE PV-6045-DAYS-RCPT-TO-STRT.                                
265800                                                                          
265900     PERFORM                                                              
266000         WITH TEST AFTER                                                  
266100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
266200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
266300                 SQLCODE = ZERO                     OR                    
266400                 SQLCODE = -811                     OR                    
266500                 SQLCODE = -180                                           
266600                                                                          
266700         EXEC SQL                                                         
266800           SELECT DISTINCT                                                
266900                       DAYS(DATE(:TM602-PO-RCVD-DELY-DTE))                
267000                     - DAYS(:TM602-STRT-FCTRY-DTE)                        
267100             INTO :PV-6045-LAST-RESULT-DAYS                               
267200             FROM TIMCNTL                                                 
267300         END-EXEC                                                         
267400                                                                          
267500         EVALUATE TRUE                                                    
267600             WHEN SQLCODE = ZERO                                          
267700             WHEN SQLCODE = -811                                          
267800                 SET PS-WRITE-TO-TRBDTL TO TRUE                           
267900                 MOVE PV-CURR-PO-NBR TO PV-6045-LAST-PO-NBR               
268000                 MOVE PV-6045-LAST-RESULT-DAYS TO                         
268100                      PV-CURR-RULE-RESULT-DAYS                            
268200                      PV-RESULTS                                          
268300                 MOVE PV-RESULTS TO PV-RESULTS-X                          
268400                                                                          
268500                 STRING 'RCVD DELY DT = ',                                
268600                         TM602-PO-RCVD-DELY-DTE (6:2), '/',               
268700                         TM602-PO-RCVD-DELY-DTE (9:2), '/',               
268800                         TM602-PO-RCVD-DELY-DTE (1:4),                    
268900                         '   STRT FCTRY= ',                               
269000                         TM602-STRT-FCTRY-DTE (6:2), '/',                 
269100                         TM602-STRT-FCTRY-DTE (9:2), '/',                 
269200                         TM602-STRT-FCTRY-DTE (1:4),                      
269300                         DELIMITED BY SIZE                                
269400                    INTO PV-TRBL-DETAIL-2ND                               
269500                                                                          
269600                 STRING  'ORIGIN SHIP TYPE = ',                           
269700                         IMRCPO-ORGN-SHPD-FR-CDE,                         
269800                         '     REF = ',                                   
269900                         PV-EXTL-REF-NBR,                                 
270000                         DELIMITED BY SIZE                                
270100                    INTO PV-TRBL-DETAIL-3RD                               
270200                                                                          
270300                 STRING  'SEVERITY = ',                                   
270400                         PV-RESULTS-X, ' DAY(S)'                          
270500                         DELIMITED BY SIZE                                
270600                    INTO PV-TRBL-DETAIL-4TH                               
270700                                                                          
270800             WHEN SQLCODE = -180                                          
270900                 SET PS-INVALID-DATE-WAS-USED TO TRUE                     
271000                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
271100                 SET PS-RULE-PROCESS-ERROR    TO TRUE                     
271200                                                                          
271300                                                                          
271400                 WHEN SQLCODE = -911                                      
271500                 WHEN SQLCODE = -913                                      
271600                 WHEN SQLCODE = -904                                      
271700                     CONTINUE                                             
271800                                                                          
271900             WHEN SQLWARN0 NOT EQUAL SPACE                                
272000             WHEN SQLCODE NOT EQUAL ZERO                                  
272100                 DISPLAY '***********************************'            
272200                 DISPLAY '** ABEND                         **'            
272300                 DISPLAY '** PROGRAM = TMKUP625            **'            
272400                 DISPLAY '** PARAGRAPH =                   **'            
272500                 DISPLAY '**    6045-DAYS-RCPT-TO-STRT     **'            
272600                 DISPLAY '** SELECT TIMCNTL                **'            
272700                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
272800                 DISPLAY '** RCVD DELY DT  = '                            
272900                 DISPLAY               TM602-PO-RCVD-DELY-DTE             
273000                 DISPLAY '** STRT FCTRY DT = '                            
273100                 DISPLAY               TM602-STRT-FCTRY-DTE               
273200                 DISPLAY '***********************************'            
273300                 PERFORM 9100-SQL-ABEND                                   
273400         END-EVALUATE                                                     
273500     END-PERFORM.                                                         
273600                                                                          
273700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
273800         (SQLCODE NOT = ZERO    AND                                       
273900          SQLCODE NOT = -811    AND                                       
274000          SQLCODE NOT = -180)                                             
274100         DISPLAY '*******************************************'            
274200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
274300         DISPLAY '** SELECT FROM TIMCNTL                   **'            
274400         DISPLAY '** PARAGRAPH = 6045-DAYS-RCVD-TO-STRT    **'            
274500         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
274600         DISPLAY '** RCVD DELY DT  = ' TM602-PO-RCVD-DELY-DTE             
274700         DISPLAY '** STRT FCTRY DT = ' TM602-STRT-FCTRY-DTE               
274800         DISPLAY '*******************************************'            
274900         PERFORM 9100-SQL-ABEND                                           
275000     END-IF.                                                              
275100                                                                          
275200******************************************************************        
275300* RULE DESCRIPTION:  DAYS FROM RCVD DELY DTE TO LAST FCTRY DTE   *        
275400* RULE RETURN TYPE:  DAYS                                        *        
275500* RULE CALLS:        NONE                                        *        
275600******************************************************************        
275700 6050-DAYS-RCPT-TO-LAST.                                                  
275800                                                                          
275900     MOVE '6050-DAYS-RCPT-TO-LAST' TO TM600-CURR-PARAGRAPH.               
276000                                                                          
276100     INITIALIZE PV-6050-DAYS-RCPT-TO-LAST.                                
276200                                                                          
276300     PERFORM                                                              
276400         WITH TEST AFTER                                                  
276500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
276600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
276700                 SQLCODE = ZERO                     OR                    
276800                 SQLCODE = -811                     OR                    
276900                 SQLCODE = -180                                           
277000                                                                          
277100         EXEC SQL                                                         
277200           SELECT DISTINCT                                                
277300                       DAYS(DATE(:TM602-PO-RCVD-DELY-DTE))                
277400                     - DAYS(:TM602-LAST-FCTRY-DTE)                        
277500             INTO :PV-6050-LAST-RESULT-DAYS                               
277600             FROM TIMCNTL                                                 
277700         END-EXEC                                                         
277800                                                                          
277900         EVALUATE TRUE                                                    
278000             WHEN SQLCODE = ZERO                                          
278100             WHEN SQLCODE = -811                                          
278200                 SET PS-WRITE-TO-TRBDTL TO TRUE                           
278300                 MOVE PV-CURR-PO-NBR TO PV-6050-LAST-PO-NBR               
278400                 MOVE PV-6050-LAST-RESULT-DAYS TO                         
278500                      PV-CURR-RULE-RESULT-DAYS                            
278600                      PV-RESULTS                                          
278700                 MOVE PV-RESULTS TO PV-RESULTS-X                          
278800                                                                          
278900                 STRING 'RCVD DELY DT = ',                                
279000                         TM602-PO-RCVD-DELY-DTE (6:2), '/',               
279100                         TM602-PO-RCVD-DELY-DTE (9:2), '/',               
279200                         TM602-PO-RCVD-DELY-DTE (1:4),                    
279300                         '   LAST FCTRY= ',                               
279400                         TM602-LAST-FCTRY-DTE (6:2), '/',                 
279500                         TM602-LAST-FCTRY-DTE (9:2), '/',                 
279600                         TM602-LAST-FCTRY-DTE (1:4),                      
279700                         DELIMITED BY SIZE                                
279800                    INTO PV-TRBL-DETAIL-2ND                               
279900                                                                          
280000                 STRING  'ORIGIN SHIP TYPE = ',                           
280100                         IMRCPO-ORGN-SHPD-FR-CDE,                         
280200                         '     REF = ',                                   
280300                         PV-EXTL-REF-NBR,                                 
280400                         DELIMITED BY SIZE                                
280500                    INTO PV-TRBL-DETAIL-3RD                               
280600                                                                          
280700                 STRING  'SEVERITY = ',                                   
280800                         PV-RESULTS-X, ' DAY(S)'                          
280900                         DELIMITED BY SIZE                                
281000                    INTO PV-TRBL-DETAIL-4TH                               
281100                                                                          
281200             WHEN SQLCODE = -180                                          
281300                 SET PS-INVALID-DATE-WAS-USED TO TRUE                     
281400                 PERFORM 6990-PREP-ERROR-REPORT-LINE                      
281500                 SET PS-RULE-PROCESS-ERROR    TO TRUE                     
281600                                                                          
281700                                                                          
281800                 WHEN SQLCODE = -911                                      
281900                 WHEN SQLCODE = -913                                      
282000                 WHEN SQLCODE = -904                                      
282100                     CONTINUE                                             
282200                                                                          
282300             WHEN SQLWARN0 NOT EQUAL SPACE                                
282400             WHEN SQLCODE NOT EQUAL ZERO                                  
282500                 DISPLAY '***********************************'            
282600                 DISPLAY '** ABEND                         **'            
282700                 DISPLAY '** PROGRAM = TMKUP625            **'            
282800                 DISPLAY '** PARAGRAPH =                   **'            
282900                 DISPLAY '**    6050-DAYS-RCVD-TO-LAST     **'            
283000                 DISPLAY '** SELECT TIMCNTL                **'            
283100                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
283200                 DISPLAY '** RCVD DELY DT  = '                            
283300                 DISPLAY               TM602-PO-RCVD-DELY-DTE             
283400                 DISPLAY '** LAST FCTRY DT = '                            
283500                 DISPLAY               TM602-LAST-FCTRY-DTE               
283600                 DISPLAY '***********************************'            
283700                 PERFORM 9100-SQL-ABEND                                   
283800         END-EVALUATE                                                     
283900     END-PERFORM.                                                         
284000                                                                          
284100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
284200         (SQLCODE NOT = ZERO    AND                                       
284300          SQLCODE NOT = -180    AND                                       
284400          SQLCODE NOT = -811)                                             
284500         DISPLAY '*******************************************'            
284600         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
284700         DISPLAY '** SELECT FROM TIMCNTL                   **'            
284800         DISPLAY '** PARAGRAPH = 6050-DAYS-RCVD-TO-LAST    **'            
284900         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
285000         DISPLAY '** RCVD DELY DT  = ' TM602-PO-RCVD-DELY-DTE             
285100         DISPLAY '** LAST FCTRY DT = ' TM602-LAST-FCTRY-DTE               
285200         DISPLAY '*******************************************'            
285300         PERFORM 9100-SQL-ABEND                                           
285400     END-IF.                                                              
285500                                                                          
285600******************************************************************        
285700* RULE DESCRIPTION:  NO RECEVING EXISTS                          *        
285800* RULE RETURN TYPE:  INDICATOR                                   *        
285900* RULE CALLS:        NONE                                        *        
286000******************************************************************        
286100 6055-A-RECEIVING-EXISTS.                                                 
286200                                                                          
286300     MOVE '6055-A-RECEIVING-EXISTS' TO TM600-CURR-PARAGRAPH.              
286400                                                                          
286500     INITIALIZE PV-6055-A-RECEIVING-EXISTS.                               
286600                                                                          
286700     PERFORM                                                              
286800         WITH TEST AFTER                                                  
286900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
287000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
287100                 SQLCODE = ZERO                     OR                    
287200                 SQLCODE = +100                     OR                    
287300                 SQLCODE = -811                                           
287400                                                                          
287500         EVALUATE TRUE                                                    
287600         WHEN PV-RECEIVING-DELETE                                         
287700             EXEC SQL                                                     
287800                SELECT PO_NBR                                             
287900                INTO :PV-6055-LAST-PO-NBR                                 
288000                                                                          
288100                FROM TIMRCPO                                              
288200                WHERE PO_NBR         = :PV-CURR-PO-NBR                    
288300                AND PO_RCVD_SEQ_NBR  = :PV-RCVD-SEQ-NBR                   
288400             END-EXEC                                                     
288500         WHEN OTHER                                                       
288600             EXEC SQL                                                     
288700                SELECT PO_NBR                                             
288800                INTO :PV-6055-LAST-PO-NBR                                 
288900                                                                          
289000                FROM TIMRCPO                                              
289100                WHERE PO_NBR         = :PV-CURR-PO-NBR                    
289200             END-EXEC                                                     
289300         END-EVALUATE                                                     
289400                                                                          
289500         EVALUATE TRUE                                                    
289600             WHEN SQLCODE = ZERO                                          
289700             WHEN SQLCODE = -811                                          
289800                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
289900                                                                          
290000             WHEN SQLCODE = +100                                          
290100                 MOVE PC-N TO PV-RULE-RESULT-IND                          
290200                              PV-6055-LAST-RESULT-IND                     
290300                                                                          
290400                 WHEN SQLCODE = -911                                      
290500                 WHEN SQLCODE = -913                                      
290600                 WHEN SQLCODE = -904                                      
290700                     CONTINUE                                             
290800                                                                          
290900             WHEN SQLWARN0 NOT EQUAL SPACE                                
291000             WHEN SQLCODE NOT EQUAL ZERO                                  
291100                 DISPLAY '***********************************'            
291200                 DISPLAY '** ABEND                         **'            
291300                 DISPLAY '** PROGRAM = TMKUP625            **'            
291400                 DISPLAY '** PARAGRAPH =                   **'            
291500                 DISPLAY '**    6055-A-RECEIVING-EXISTS    **'            
291600                 DISPLAY '** SELECT TIMCNTL                **'            
291700                 DISPLAY '** PO NUMBER     =  ' PV-KEY-PO-NBR             
291800                 DISPLAY '** RCVD DELY DT  =  '                           
291900                 DISPLAY               TM602-PO-RCVD-DELY-DTE             
292000                 DISPLAY '** PO RCVD SEQ NBR= '                           
292100                 DISPLAY               PV-RCVD-SEQ-NBR                    
292200                 DISPLAY '***********************************'            
292300                 PERFORM 9100-SQL-ABEND                                   
292400         END-EVALUATE                                                     
292500     END-PERFORM.                                                         
292600                                                                          
292700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
292800         (SQLCODE NOT = ZERO    AND                                       
292900          SQLCODE NOT = -811    AND                                       
293000          SQLCODE NOT = +100)                                             
293100         DISPLAY '*******************************************'            
293200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
293300         DISPLAY '** SELECT FROM TIMCNTL                   **'            
293400         DISPLAY '** PARAGRAPH = 6055-A-RECEIVING-EXISTS   **'            
293500         DISPLAY '** PO NUMBER       = ' PV-KEY-PO-NBR                    
293600         DISPLAY '** RCVD DELY DT    = ' TM602-PO-RCVD-DELY-DTE           
293700         DISPLAY '** PO RCVD SEQ NBR = ' PV-RCVD-SEQ-NBR                  
293800         DISPLAY '*******************************************'            
293900         PERFORM 9100-SQL-ABEND                                           
294000     END-IF.                                                              
294100                                                                          
294200******************************************************************        
294300* RULE DESCRIPTION:                                              *        
294400* RULE RETURN TYPE:  PERCENT                                     *        
294500* RULE CALLS:        NONE                                        *        
294600******************************************************************        
294700 6060-RCPT-TO-PO-PCT.                                                     
294800                                                                          
294900     MOVE '6060-RCPT-TO-PO-PCT' TO TM600-CURR-PARAGRAPH.                  
295000                                                                          
295100******************************************************************        
295200* RULE DESCRIPTION:  ???????????????????????????????????????     *        
295300* RULE RETURN TYPE:  DAYS                                        *        
295400* RULE CALLS:        INDC                                        *        
295500******************************************************************        
295600 6065-INDC-FROM-DELY.                                                     
295700                                                                          
295800     MOVE '6065-INDC-FROM-DELY' TO TM600-CURR-PARAGRAPH.                  
295900                                                                          
296000******************************************************************        
296100* RULE DESCRIPTION:                                              *        
296200* RULE RETURN TYPE:  DAYS                                        *        
296300* RULE CALLS:        NONE                                        *        
296400******************************************************************        
296500 6080-DAYS-AFT-SAIL.                                                      
296600                                                                          
296700     MOVE '6080-DAYS-AFT-SAIL' TO TM600-CURR-PARAGRAPH.                   
296800                                                                          
296900     INITIALIZE PV-6080-DAYS-AFT-SAIL.                                    
297000                                                                          
297100     IF TM602-EST-DPRTR-DTE =    PC-DEFAULT-DTE OR SPACES                 
297200        SET PS-NO-EST-DPRTR-DTE     TO TRUE                               
297300        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
297400        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
297500     END-IF.                                                              
297600                                                                          
297700     MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                              
297800                                                                          
297900     PERFORM                                                              
298000        WITH TEST AFTER                                                   
298100        VARYING PV-RETRY-COUNTER FROM 1 BY 1                              
298200        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                     
298300        SQLCODE = ZERO                     OR                             
298400        SQLCODE = -811                     OR                             
298500        SQLCODE = -180                                                    
298600                                                                          
298700        EXEC SQL                                                          
298800          SELECT DISTINCT DAYS(CURRENT_DATE)                              
298900                      - DAYS(DATE(:TM602-EST-DPRTR-DTE))                  
299000          INTO :PV-6080-LAST-RESULT-DAYS                                  
299100          FROM TIMCNTL                                                    
299200        END-EXEC                                                          
299300                                                                          
299400        EVALUATE TRUE                                                     
299500          WHEN SQLCODE = ZERO                                             
299600          WHEN SQLCODE = -811                                             
299700            SET PS-WRITE-TO-TRBDTL TO TRUE                                
299800            MOVE PV-CURR-PO-NBR TO PV-6080-LAST-PO-NBR                    
299900            MOVE PV-6080-LAST-RESULT-DAYS TO                              
300000                                     PV-CURR-RULE-RESULT-DAYS             
300100                                     PV-RESULTS                           
300200            MOVE PV-RESULTS TO PV-RESULTS-X                               
300300            MOVE +1        TO PV-TRBL-DETAIL-COUNT                        
300400            STRING 'EST DPRTR DT = ',                                     
300500                             TM602-EST-DPRTR-DTE    (6:2), '/',           
300600                             TM602-EST-DPRTR-DTE    (9:2), '/',           
300700                             TM602-EST-DPRTR-DTE    (1:4),                
300800                             ' CURR DATE = ',                             
300900                             PV-REFORMAT-DTE                              
301000                             DELIMITED BY SIZE                            
301100                        INTO PV-TRBL-DETAIL-2ND                           
301200                                                                          
301300            STRING  'SEVERITY = ',                                        
301400                             PV-RESULTS-X, ' DAY(S)'                      
301500                             DELIMITED BY SIZE                            
301600                        INTO PV-TRBL-DETAIL-3RD                           
301700                                                                          
301800          WHEN SQLCODE = -180                                             
301900              SET PS-INVALID-DATE-WAS-USED TO TRUE                        
302000              PERFORM 6990-PREP-ERROR-REPORT-LINE                         
302100              SET PS-RULE-PROCESS-ERROR    TO TRUE                        
302200                                                                          
302300                 WHEN SQLCODE = -911                                      
302400                 WHEN SQLCODE = -913                                      
302500                 WHEN SQLCODE = -904                                      
302600                     CONTINUE                                             
302700                                                                          
302800          WHEN SQLWARN0 NOT EQUAL SPACE                                   
302900          WHEN SQLCODE NOT EQUAL ZERO                                     
303000                 DISPLAY '***********************************'            
303100                 DISPLAY '** ABEND                         **'            
303200                 DISPLAY '** PROGRAM = TMKUP625            **'            
303300                 DISPLAY '** PARAGRAPH =                   **'            
303400                 DISPLAY '**  6080-DAYS-AFT-SAIL           **'            
303500                 DISPLAY '** SELECT TIMCNTL                **'            
303600                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
303700                 DISPLAY '** EST DPRTR DATE= '                            
303800                 DISPLAY TM602-EST-DPRTR-DTE                              
303900                 DISPLAY '***********************************'            
304000                 PERFORM 9100-SQL-ABEND                                   
304100         END-EVALUATE                                                     
304200     END-PERFORM.                                                         
304300                                                                          
304400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
304500         (SQLCODE NOT = ZERO    AND                                       
304600          SQLCODE NOT = -811    AND                                       
304700          SQLCODE NOT = -180)                                             
304800         DISPLAY '***********************************'                    
304900         DISPLAY '** ABEND                         **'                    
305000         DISPLAY '** PROGRAM = TMKUP625            **'                    
305100         DISPLAY '** PARAGRAPH =                   **'                    
305200         DISPLAY '**  6080-DAYS-AFT-SAIL           **'                    
305300         DISPLAY '** SELECT TIMCNTL                **'                    
305400         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
305500         DISPLAY '** EST DPRTR DATE= '                                    
305600         DISPLAY TM602-EST-DPRTR-DTE                                      
305700         DISPLAY '***********************************'                    
305800         PERFORM 9100-SQL-ABEND                                           
305900     END-IF.                                                              
306000                                                                          
306100******************************************************************        
306200* RULE DESCRIPTION:                                              *        
306300* RULE RETURN TYPE:  DAYS                                        *        
306400* RULE CALLS:        NONE                                        *        
306500******************************************************************        
306600 6090-DAYS-BET-VESSELS.                                                   
306700                                                                          
306800     MOVE '6090-DAYS-BET-VESSELS' TO TM600-CURR-PARAGRAPH.                
306900                                                                          
307000******************************************************************        
307100* RULE DESCRIPTION:  DAYS FROM BKNG DATE TO CURRENT DATE         *        
307200* RULE RETURN TYPE:  DAYS                                        *        
307300* RULE CALLS:        NONE                                        *        
307400******************************************************************        
307500 6095-DAYS-BKNG-TO-CURR.                                                  
307600                                                                          
307700     MOVE '6095-DAYS-BKNG-TO-CURR' TO TM600-CURR-PARAGRAPH.               
307800                                                                          
307900*    INITIALIZE PV-6095-DAYS-BKNG-TO-CURR.                                
308000*                                                                         
308100*    PERFORM                                                              
308200*        WITH TEST AFTER                                                  
308300*        VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
308400*        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
308500*                SQLCODE = ZERO                     OR                    
308600*                SQLCODE = -811                     OR                    
308700*                SQLCODE = -180                                           
308800*                                                                         
308900*        EXEC SQL                                                         
309000*          SELECT DISTINCT                                                
309100*                      DAYS(DATE(CURRENT DATE))                           
309200*                    - DAYS(:TM602-PO-BKG-DELY-DTE)                       
309300*            INTO :PV-6095-LAST-RESULT-DAYS                               
309400*            FROM TIMCNTL                                                 
309500*        END-EXEC                                                         
309600*                                                                         
309700*        EVALUATE TRUE                                                    
309800*            WHEN SQLCODE = ZERO                                          
309900*            WHEN SQLCODE = -811                                          
310000*                SET PS-WRITE-TO-TRBDTL TO TRUE                           
310100*                MOVE PV-CURR-PO-NBR TO PV-6095-LAST-PO-NBR               
310200*                MOVE PV-6095-LAST-RESULT-DAYS TO                         
310300*                     PV-CURR-RULE-RESULT-DAYS                            
310400*                      PV-RESULTS                                         
310500*                MOVE PV-RESULTS TO PV-RESULTS-X                          
310600*                                                                         
310700*                STRING 'CURR DATE = ',                                   
310800*                        PV-REFORMAT-DTE,                                 
310900*                       '   BKG DELY DTE = ',                             
311000*                        TM602-PO-BKG-DELY-DTE (6:2), '/',                
311100*                        TM602-PO-BKG-DELY-DTE (9:2), '/',                
311200*                        TM602-PO-BKG-DELY-DTE (1:4),                     
311300*                        DELIMITED BY SIZE                                
311400*                   INTO PV-TRBL-DETAIL-2ND                               
311500*                                                                         
311600*                STRING  'SEVERITY = ',                                   
311700*                        PV-RESULTS-X, ' DAY(S)'                          
311800*                        DELIMITED BY SIZE                                
311900*                   INTO PV-TRBL-DETAIL-3RD                               
312000*                                                                         
312100*            WHEN SQLCODE = -180                                          
312200*                SET PS-INVALID-DATE-WAS-USED TO TRUE                     
312300*                PERFORM 6990-PREP-ERROR-REPORT-LINE                      
312400*                SET PS-RULE-PROCESS-ERROR    TO TRUE                     
312500*                                                                         
312600*            WHEN SQLWARN0 NOT EQUAL SPACE                                
312700*            WHEN SQLCODE NOT EQUAL ZERO                                  
312800*                DISPLAY '***********************************'            
312900*                DISPLAY '** ABEND                         **'            
313000*                DISPLAY '** PROGRAM = TMKUP625            **'            
313100*                DISPLAY '** PARAGRAPH =                   **'            
313200*                DISPLAY '**    6095-DAYS-BKNG-TO-CURR     **'            
313300*                DISPLAY '** SELECT TIMCNTL                **'            
313400*                DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
313500*                DISPLAY '** BKNG DELY DT  = '                            
313600*                DISPLAY               TM602-PO-BKG-DELY-DTE              
313700*                DISPLAY '***********************************'            
313800*                PERFORM 9100-SQL-ABEND                                   
313900*        END-EVALUATE                                                     
314000*    END-PERFORM.                                                         
314100*                                                                         
314200*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
314300*        (SQLCODE NOT = ZERO    AND                                       
314400*         SQLCODE NOT = -811    AND                                       
314500*         SQLCODE NOT = -180)                                             
314600*        DISPLAY '*******************************************'            
314700*        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
314800*        DISPLAY '** SELECT FROM TIMCNTL                   **'            
314900*        DISPLAY '** PARAGRAPH = 6095-DAYS-BKNG-TO-CURR    **'            
315000*        DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
315100*        DISPLAY '** BKNG DELY DT  = ' TM602-PO-BKG-DELY-DTE              
315200*        DISPLAY '*******************************************'            
315300*        PERFORM 9100-SQL-ABEND                                           
315400*    END-IF.                                                              
315500*                                                                         
315600******************************************************************        
315700* RULE DESCRIPTION:                                              *        
315800* RULE RETURN TYPE:  PERCENT                                     *        
315900* RULE CALLS:        NONE                                        *        
316000******************************************************************        
316100 6100-CONTNR-TO-RCPT-PCT.                                                 
316200                                                                          
316300     MOVE '6100-CONTNR-TO-RCPT-PCT' TO TM600-CURR-PARAGRAPH.              
316400                                                                          
316500******************************************************************        
316600* RULE DESCRIPTION:                                              *        
316700* RULE RETURN TYPE:  PERCENT                                     *        
316800* RULE CALLS:        NONE                                        *        
316900******************************************************************        
317000 6105-CONTNR-TO-PO-PCT.                                                   
317100                                                                          
317200     MOVE '6105-CONTNR-TO-PO-PCT' TO TM600-CURR-PARAGRAPH.                
317300                                                                          
317400******************************************************************        
317500* RULE DESCRIPTION:                                              *        
317600* RULE RETURN TYPE:  DAYS                                        *        
317700* RULE CALLS:        NONE                                        *        
317800******************************************************************        
317900 6110-CONTNR-PKUP-TO-AR.                                                  
318000                                                                          
318100     MOVE '6110-CONTNR-PKUP-TO-AR' TO TM600-CURR-PARAGRAPH.               
318200                                                                          
318300     INITIALIZE PV-6110-CONTNR-PKUP-TO-AR.                                
318400                                                                          
318500     IF TM602-CONTNR-PKUP-DTE = PC-DEFAULT-DTE OR SPACES                  
318600        SET PS-NO-TIMCNTK-PKUP-DATE TO TRUE                               
318700        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
318800        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
318900     END-IF.                                                              
319000                                                                          
319100     IF TM602-MOM-POE-DELY-DTE = PC-DEFAULT-DTE OR SPACES                 
319200        SET PS-NO-TIMCNTK-ATA-DATE  TO TRUE                               
319300        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
319400        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
319500     END-IF.                                                              
319600                                                                          
319700     MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                              
319800                                                                          
319900     PERFORM                                                              
320000        WITH TEST AFTER                                                   
320100        VARYING PV-RETRY-COUNTER FROM 1 BY 1                              
320200        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                     
320300        SQLCODE = ZERO                     OR                             
320400        SQLCODE = -811                     OR                             
320500        SQLCODE = -180                                                    
320600                                                                          
320700        EXEC SQL                                                          
320800          SELECT DISTINCT DAYS(DATE(:TM602-CONTNR-PKUP-DTE))              
320900                         - DAYS(DATE(:TM602-MOM-POE-DELY-DTE))            
321000          INTO :PV-6110-LAST-RESULT-DAYS                                  
321100          FROM TIMCNTL                                                    
321200        END-EXEC                                                          
321300                                                                          
321400        EVALUATE TRUE                                                     
321500          WHEN SQLCODE = ZERO                                             
321600          WHEN SQLCODE = -811                                             
321700            SET PS-WRITE-TO-TRBDTL TO TRUE                                
321800            MOVE PV-CURR-PO-NBR TO PV-6110-LAST-PO-NBR                    
321900            MOVE PV-6110-LAST-RESULT-DAYS TO                              
322000                                     PV-CURR-RULE-RESULT-DAYS             
322100                                     PV-RESULTS                           
322200            MOVE PV-RESULTS TO PV-RESULTS-X                               
322300            MOVE +1         TO TM601-IMPRT-ARRAY-CNT                      
322400            MOVE IMCNPO-CONTNR-SEQ-NBR                                    
322500                            TO TM601-AR-CONTNR-SEQ-NBR (1)                
322600            MOVE IMCNPO-CONTNR-ID                                         
322700                            TO TM601-AR-CONTNR-ID (1)                     
322800            MOVE +1         TO PV-TRBL-DETAIL-COUNT                       
322900            STRING 'CONTAINER PKUP = ',                                   
323000                             TM602-CONTNR-PKUP-DTE (6:2), '/',            
323100                             TM602-CONTNR-PKUP-DTE (9:2), '/',            
323200                             TM602-CONTNR-PKUP-DTE (1:4),                 
323300                             ' CONTNR ATA= ',                             
323400                             TM602-MOM-POE-DELY-DTE (6:2), '/',           
323500                             TM602-MOM-POE-DELY-DTE (9:2), '/',           
323600                             TM602-MOM-POE-DELY-DTE (1:4),                
323700                             DELIMITED BY SIZE                            
323800                        INTO PV-TRBL-DETAIL-2ND                           
323900                                                                          
324000            STRING  'SEVERITY = ',                                        
324100                             PV-RESULTS-X, ' DAY(S)',                     
324200                    ' CONTNR = ' TM606-CONTNR-ID                          
324300                             DELIMITED BY SIZE                            
324400                        INTO PV-TRBL-DETAIL-3RD                           
324500                                                                          
324600            WHEN SQLCODE = -180                                           
324700                SET PS-INVALID-DATE-WAS-USED TO TRUE                      
324800                PERFORM 6990-PREP-ERROR-REPORT-LINE                       
324900                SET PS-RULE-PROCESS-ERROR    TO TRUE                      
325000                                                                          
325100                 WHEN SQLCODE = -911                                      
325200                 WHEN SQLCODE = -913                                      
325300                 WHEN SQLCODE = -904                                      
325400                     CONTINUE                                             
325500                                                                          
325600          WHEN SQLWARN0 NOT EQUAL SPACE                                   
325700          WHEN SQLCODE NOT EQUAL ZERO                                     
325800                 DISPLAY '***********************************'            
325900                 DISPLAY '** ABEND                         **'            
326000                 DISPLAY '** PROGRAM = TMKUP625            **'            
326100                 DISPLAY '** PARAGRAPH =                   **'            
326200                 DISPLAY '**  6110-CONTNR-PKUP-TO-AR       **'            
326300                 DISPLAY '** SELECT TIMCNTL                **'            
326400                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
326500                 DISPLAY '** CONTAINER PKUP= '                            
326600                 DISPLAY TM602-CONTNR-PKUP-DTE                            
326700                 DISPLAY '** CONTAINER ATA = '                            
326800                 DISPLAY TM602-MOM-POE-DELY-DTE                           
326900                 DISPLAY '***********************************'            
327000                 PERFORM 9100-SQL-ABEND                                   
327100         END-EVALUATE                                                     
327200     END-PERFORM.                                                         
327300                                                                          
327400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
327500         (SQLCODE NOT = ZERO    AND                                       
327600          SQLCODE NOT = -811    AND                                       
327700          SQLCODE NOT = -180)                                             
327800         DISPLAY '***********************************'                    
327900         DISPLAY '** ABEND                         **'                    
328000         DISPLAY '** PROGRAM = TMKUP625            **'                    
328100         DISPLAY '** PARAGRAPH =                   **'                    
328200         DISPLAY '**  6110-CONTNR-PKUP-TO-AR       **'                    
328300         DISPLAY '** SELECT TIMCNTL                **'                    
328400         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
328500         DISPLAY '** CONTAINER PKUP= '                                    
328600         DISPLAY TM602-CONTNR-PKUP-DTE                                    
328700         DISPLAY '** CONTAINER ATA = '                                    
328800         DISPLAY TM602-MOM-POE-DELY-DTE                                   
328900         DISPLAY '***********************************'                    
329000         PERFORM 9100-SQL-ABEND                                           
329100     END-IF.                                                              
329200                                                                          
329300******************************************************************        
329400* RULE DESCRIPTION:  A CUSTOMS RELEASE EXISTS                    *        
329500* RULE RETURN TYPE:  INDICATOR                                   *        
329600* RULE CALLS:        NONE                                        *        
329700******************************************************************        
329800 6115-A-CUSTOMS-RELEASE.                                                  
329900                                                                          
330000     MOVE '6115-A-CUSTOMS-RELEASE' TO TM600-CURR-PARAGRAPH.               
330100                                                                          
330200     INITIALIZE PV-6115-A-CUSTOMS-RELEASE.                                
330300                                                                          
330400     PERFORM                                                              
330500         WITH TEST AFTER                                                  
330600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
330700         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
330800                 SQLCODE = ZERO                     OR                    
330900                 SQLCODE = -811                     OR                    
331000                 SQLCODE = +100                                           
331100                                                                          
331200         EXEC SQL                                                         
331300             SELECT PO_NBR                                                
331400              INTO :PV-6115-LAST-PO-NBR                                   
331500               FROM TIMCSPO A                                             
331600                   ,TIMCSEN B                                             
331700              WHERE A.PO_NBR         = :PV-CURR-PO-NBR                    
331800              AND   A.CSTM_ENTR_ID   = B.CSTM_ENTR_ID                     
331900              AND   B.ACTL_CLR_TMST  <> :PC-DEFAULT-TMST                  
332000         END-EXEC                                                         
332100                                                                          
332200         EVALUATE TRUE                                                    
332300             WHEN SQLCODE = ZERO                                          
332400             WHEN SQLCODE = -811                                          
332500                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
332600                              PV-6115-LAST-RESULT-IND                     
332700                                                                          
332800             WHEN SQLCODE = +100                                          
332900                 MOVE PC-N TO PV-RULE-RESULT-IND                          
333000                              PV-6115-LAST-RESULT-IND                     
333100                                                                          
333200                 WHEN SQLCODE = -911                                      
333300                 WHEN SQLCODE = -913                                      
333400                 WHEN SQLCODE = -904                                      
333500                     CONTINUE                                             
333600                                                                          
333700             WHEN SQLWARN0 NOT EQUAL SPACE                                
333800             WHEN SQLCODE NOT EQUAL ZERO                                  
333900                 DISPLAY '***********************************'            
334000                 DISPLAY '** ABEND                         **'            
334100                 DISPLAY '** PROGRAM = TMKUP625            **'            
334200                 DISPLAY '** PARAGRAPH =                   **'            
334300                 DISPLAY '**    6115-A-CUSTOMS-RELEASE     **'            
334400                 DISPLAY '** SELECT TIMCSEN/TIMCSPO        **'            
334500                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
334600                 DISPLAY '***********************************'            
334700                 PERFORM 9100-SQL-ABEND                                   
334800         END-EVALUATE                                                     
334900     END-PERFORM.                                                         
335000                                                                          
335100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
335200         (SQLCODE NOT = ZERO    AND                                       
335300          SQLCODE NOT = -811    AND                                       
335400          SQLCODE NOT = +100)                                             
335500         DISPLAY '*******************************************'            
335600         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
335700         DISPLAY '** SELECT FROM TIMCNTL                   **'            
335800         DISPLAY '** PARAGRAPH = 6115-A-CUSTOMS-RELEASE    **'            
335900         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
336000         DISPLAY '*******************************************'            
336100         PERFORM 9100-SQL-ABEND                                           
336200     END-IF.                                                              
336300                                                                          
336400******************************************************************        
336500* RULE DESCRIPTION:  A DEVAN DATE EXISTS                         *        
336600* RULE RETURN TYPE:  INDICATOR                                   *        
336700* RULE CALLS:        NONE                                        *        
336800******************************************************************        
336900 6120-A-DEVAN-DATE.                                                       
337000                                                                          
337100     MOVE '6120-A-DEVAN-DATE' TO TM600-CURR-PARAGRAPH.                    
337200                                                                          
337300     INITIALIZE PV-6120-A-DEVAN-DATE.                                     
337400                                                                          
337500     PERFORM                                                              
337600         WITH TEST AFTER                                                  
337700         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
337800         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
337900                 SQLCODE = ZERO                     OR                    
338000                 SQLCODE = -811                     OR                    
338100                 SQLCODE = +100                                           
338200                                                                          
338300         EXEC SQL                                                         
338400             SELECT COALESCE(B.PO_NBR,A.PO_NBR)                           
338500              INTO :PV-6120-LAST-PO-NBR:PV-NULL                           
338600              FROM  ((SELECT A.SHIPT_ID,A.PO_NBR                          
338700                    FROM  TSHPTPO A                                       
338800                         ,TSHIPMT B                                       
338900                         ,TVHTRIP C                                       
339000                         ,TVEHICL E                                       
339100                         ,TTRIPST D                                       
339200                    WHERE A.PO_NBR        = :PV-CURR-PO-NBR               
339300                    AND A.SHIPT_ID        = B.SHIPT_ID                    
339400                    AND B.TRIP_ID         = C.TRIP_ID                     
339500                    AND B.TRIP_ID         = D.TRIP_ID                     
339600                    AND E.OWNER_SCAC_ID   = C.OWNER_SCAC_ID               
339700                    AND E.VEH_NBR         = C.VEH_NBR                     
339800                    AND E.VEH_TYP_CDE     = 'TR'                          
339900                    AND C.VEH_NBR         IS NOT NULL                     
340000                    AND D.TRIP_STATUS_CDE = 'EN') AS A                    
340100                    FULL OUTER JOIN                                       
340200                      (SELECT B.SHIPT_ID                                  
340300                             ,B.PO_NBR                                    
340400                         FROM  TSHIPST A                                  
340500                              ,TSHPTPO B                                  
340600                        WHERE B.PO_NBR     = :PV-CURR-PO-NBR              
340700                        AND A.SHIPT_ID     = B.SHIPT_ID                   
340800                        AND A.SHIPT_STATUS_CDE = 'AM' ) AS B              
340900                    ON  A.SHIPT_ID = B.SHIPT_ID)                          
341000         END-EXEC                                                         
341100                                                                          
341200         EVALUATE TRUE                                                    
341300             WHEN SQLCODE = ZERO                                          
341400             WHEN SQLCODE = -811                                          
341500                 IF PV-NULL = 0                                           
341600                   MOVE PC-Y TO PV-RULE-RESULT-IND                        
341700                                PV-6120-LAST-RESULT-IND                   
341800                 ELSE                                                     
341900                    MOVE PC-N TO PV-RULE-RESULT-IND                       
342000                                PV-6120-LAST-RESULT-IND                   
342100                 END-IF                                                   
342200                                                                          
342300             WHEN SQLCODE = +100                                          
342400                 MOVE PC-N TO PV-RULE-RESULT-IND                          
342500                              PV-6120-LAST-RESULT-IND                     
342600                                                                          
342700                 WHEN SQLCODE = -911                                      
342800                 WHEN SQLCODE = -913                                      
342900                 WHEN SQLCODE = -904                                      
343000                     CONTINUE                                             
343100                                                                          
343200             WHEN SQLWARN0 NOT EQUAL SPACE                                
343300             WHEN SQLCODE NOT EQUAL ZERO                                  
343400                 DISPLAY '***********************************'            
343500                 DISPLAY '** ABEND                         **'            
343600                 DISPLAY '** PROGRAM = TMKUP625            **'            
343700                 DISPLAY '** PARAGRAPH =                   **'            
343800                 DISPLAY '**    6120-A-DEVAN-DATE          **'            
343900                 DISPLAY '** SELECT TSHPTPO/TSHIPST        **'            
344000                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
344100                 DISPLAY '***********************************'            
344200                 PERFORM 9100-SQL-ABEND                                   
344300         END-EVALUATE                                                     
344400     END-PERFORM.                                                         
344500                                                                          
344600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
344700         (SQLCODE NOT = ZERO    AND                                       
344800          SQLCODE NOT = -811    AND                                       
344900          SQLCODE NOT = +100)                                             
345000         DISPLAY '*******************************************'            
345100         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
345200         DISPLAY '** SELECT FROM TSHPTPO/TSHIPST           **'            
345300         DISPLAY '** PARAGRAPH = 6120-A-DEVAN-DATE         **'            
345400         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
345500         DISPLAY '*******************************************'            
345600         PERFORM 9100-SQL-ABEND                                           
345700     END-IF.                                                              
345800                                                                          
345900******************************************************************        
346000* RULE DESCRIPTION:  COMPARE A CUSTOMS FILING DATE TO CURRENT    *        
346100* RULE RETURN TYPE:  DAY                                         *        
346200* RULE CALLS:        NONE                                        *        
346300******************************************************************        
346400 6125-CUSTOMS-FILE-TO-CURR.                                               
346500                                                                          
346600     MOVE '6125-CUSTOMS-FILE-TO-CURR' TO TM600-CURR-PARAGRAPH.            
346700                                                                          
346800     INITIALIZE PV-6125-CUSTOMS-FILE-TO-CURR.                             
346900                                                                          
347000     MOVE       TM602-CSTM-ENTR-ID TO IMCSPO-CSTM-ENTR-ID.                
347100                                                                          
347200     IF TM602-CUSTOMS-FILE-DTE = PC-DEFAULT-DTE OR SPACES                 
347300        SET PS-NO-TIMCSEN-FILE-DATE TO TRUE                               
347400        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
347500        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
347600     END-IF.                                                              
347700                                                                          
347800     MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                              
347900                                                                          
348000     PERFORM                                                              
348100        WITH TEST AFTER                                                   
348200        VARYING PV-RETRY-COUNTER FROM 1 BY 1                              
348300        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                     
348400        SQLCODE = ZERO                     OR                             
348500        SQLCODE = -811                     OR                             
348600        SQLCODE = -180                                                    
348700                                                                          
348800        EXEC SQL                                                          
348900          SELECT DISTINCT DAYS(CURRENT_DATE)                              
349000                      - DAYS(DATE(:TM602-CUSTOMS-FILE-DTE))               
349100          INTO :PV-6125-LAST-RESULT-DAYS                                  
349200          FROM TIMCNTL                                                    
349300        END-EXEC                                                          
349400                                                                          
349500        EVALUATE TRUE                                                     
349600          WHEN SQLCODE = ZERO                                             
349700          WHEN SQLCODE = -811                                             
349800            SET PS-WRITE-TO-TRBDTL TO TRUE                                
349900            MOVE PV-CURR-PO-NBR TO PV-6125-LAST-PO-NBR                    
350000            MOVE PV-6125-LAST-RESULT-DAYS TO                              
350100                                     PV-CURR-RULE-RESULT-DAYS             
350200                                     PV-RESULTS                           
350300            MOVE PV-RESULTS TO PV-RESULTS-X                               
350400            MOVE +1 TO TM601-IMPRT-ARRAY-CNT                              
350500            MOVE IMCSPO-CSTM-ENTR-ID                                      
350600                           TO TM601-AR-CSTM-ENTR-ID (1)                   
350700            MOVE +1        TO PV-TRBL-DETAIL-COUNT                        
350800            STRING 'CUSTMS FILING = ',                                    
350900                             TM602-CUSTOMS-FILE-DTE (6:2), '/',           
351000                             TM602-CUSTOMS-FILE-DTE (9:2), '/',           
351100                             TM602-CUSTOMS-FILE-DTE (1:4),                
351200                             '   CURR DATE = ',                           
351300                             PV-REFORMAT-DTE                              
351400                             DELIMITED BY SIZE                            
351500                        INTO PV-TRBL-DETAIL-2ND                           
351600                                                                          
351700            STRING  'SEVERITY = ',                                        
351800                             PV-RESULTS-X, ' DAY(S)'                      
351900                             DELIMITED BY SIZE                            
352000                        INTO PV-TRBL-DETAIL-3RD                           
352100                                                                          
352200          WHEN SQLCODE = -180                                             
352300              SET PS-INVALID-DATE-WAS-USED TO TRUE                        
352400              PERFORM 6990-PREP-ERROR-REPORT-LINE                         
352500              SET PS-RULE-PROCESS-ERROR    TO TRUE                        
352600                                                                          
352700                 WHEN SQLCODE = -911                                      
352800                 WHEN SQLCODE = -913                                      
352900                 WHEN SQLCODE = -904                                      
353000                     CONTINUE                                             
353100                                                                          
353200          WHEN SQLWARN0 NOT EQUAL SPACE                                   
353300          WHEN SQLCODE NOT EQUAL ZERO                                     
353400                 DISPLAY '***********************************'            
353500                 DISPLAY '** ABEND                         **'            
353600                 DISPLAY '** PROGRAM = TMKUP625            **'            
353700                 DISPLAY '** PARAGRAPH =                   **'            
353800                 DISPLAY '**  6125-CUSTOMS-FILE-TO-CURR    **'            
353900                 DISPLAY '** SELECT TIMCNTL                **'            
354000                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
354100                 DISPLAY '** CUSTOMS FILING= '                            
354200                 DISPLAY TM602-CUSTOMS-FILE-DTE                           
354300                 DISPLAY '***********************************'            
354400                 PERFORM 9100-SQL-ABEND                                   
354500         END-EVALUATE                                                     
354600     END-PERFORM.                                                         
354700                                                                          
354800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
354900         (SQLCODE NOT = ZERO    AND                                       
355000          SQLCODE NOT = -811    AND                                       
355100          SQLCODE NOT = -180)                                             
355200         DISPLAY '***********************************'                    
355300         DISPLAY '** ABEND                         **'                    
355400         DISPLAY '** PROGRAM = TMKUP625            **'                    
355500         DISPLAY '** PARAGRAPH =                   **'                    
355600         DISPLAY '**  6125-CUSTOMS-FILE-TO-CURR    **'                    
355700         DISPLAY '** SELECT TIMCNTL                **'                    
355800         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
355900         DISPLAY '** CUSTOMS FILING= '                                    
356000         DISPLAY TM602-CUSTOMS-FILE-DTE                                   
356100         DISPLAY '***********************************'                    
356200         PERFORM 9100-SQL-ABEND                                           
356300     END-IF.                                                              
356400                                                                          
356500******************************************************************        
356600* RULE DESCRIPTION:  COMPARE A CONTAINER PICK UP DATE TO CURRENT *        
356700* RULE RETURN TYPE:  DAY                                         *        
356800* RULE CALLS:        NONE                                        *        
356900******************************************************************        
357000 6130-CONTNR-PKUP-TO-CURR.                                                
357100                                                                          
357200     MOVE '6130-CONTNR-PKUP-TO-CURR' TO TM600-CURR-PARAGRAPH.             
357300                                                                          
357400     INITIALIZE PV-6130-CONTNR-PKUP-TO-CURR.                              
357500                                                                          
357600     IF TM602-CONTNR-PKUP-DTE = PC-DEFAULT-DTE OR SPACES                  
357700        SET PS-NO-TIMCNTK-PKUP-DATE TO TRUE                               
357800        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
357900        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
358000     END-IF.                                                              
358100                                                                          
358200     MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                              
358300                                                                          
358400     PERFORM                                                              
358500        WITH TEST AFTER                                                   
358600        VARYING PV-RETRY-COUNTER FROM 1 BY 1                              
358700        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                     
358800        SQLCODE = ZERO                     OR                             
358900        SQLCODE = -811                     OR                             
359000        SQLCODE = -180                                                    
359100                                                                          
359200        EXEC SQL                                                          
359300          SELECT DISTINCT DAYS(CURRENT_DATE)                              
359400                      - DAYS(DATE(:TM602-CONTNR-PKUP-DTE))                
359500          INTO :PV-6130-LAST-RESULT-DAYS                                  
359600          FROM TIMCNTL                                                    
359700        END-EXEC                                                          
359800                                                                          
359900        EVALUATE TRUE                                                     
360000          WHEN SQLCODE = ZERO                                             
360100          WHEN SQLCODE = -811                                             
360200            SET PS-WRITE-TO-TRBDTL TO TRUE                                
360300            MOVE PV-CURR-PO-NBR TO PV-6130-LAST-PO-NBR                    
360400            MOVE PV-6130-LAST-RESULT-DAYS TO                              
360500                                     PV-CURR-RULE-RESULT-DAYS             
360600                                     PV-RESULTS                           
360700            MOVE PV-RESULTS TO PV-RESULTS-X                               
360800            MOVE +1         TO TM601-IMPRT-ARRAY-CNT                      
360900            MOVE IMCNPO-CONTNR-SEQ-NBR                                    
361000                            TO TM601-AR-CONTNR-SEQ-NBR (1)                
361100            MOVE IMCNPO-CONTNR-ID                                         
361200                            TO TM601-AR-CONTNR-ID (1)                     
361300            MOVE +1         TO PV-TRBL-DETAIL-COUNT                       
361400            STRING 'CONTNR PKUP = ',                                      
361500                             TM602-CONTNR-PKUP-DTE (6:2), '/',            
361600                             TM602-CONTNR-PKUP-DTE (9:2), '/',            
361700                             TM602-CONTNR-PKUP-DTE (1:4),                 
361800                             ' CURR DATE = ',                             
361900                             PV-REFORMAT-DTE                              
362000                             DELIMITED BY SIZE                            
362100                        INTO PV-TRBL-DETAIL-2ND                           
362200                                                                          
362300            STRING  'SEVERITY = ',                                        
362400                             PV-RESULTS-X, ' DAY(S)',                     
362500                    ' CONTNR = ' TM606-CONTNR-ID                          
362600                             DELIMITED BY SIZE                            
362700                        INTO PV-TRBL-DETAIL-3RD                           
362800                                                                          
362900          WHEN SQLCODE = -180                                             
363000              SET PS-INVALID-DATE-WAS-USED TO TRUE                        
363100              PERFORM 6990-PREP-ERROR-REPORT-LINE                         
363200              SET PS-RULE-PROCESS-ERROR    TO TRUE                        
363300                                                                          
363400                 WHEN SQLCODE = -911                                      
363500                 WHEN SQLCODE = -913                                      
363600                 WHEN SQLCODE = -904                                      
363700                     CONTINUE                                             
363800                                                                          
363900          WHEN SQLWARN0 NOT EQUAL SPACE                                   
364000          WHEN SQLCODE NOT EQUAL ZERO                                     
364100                 DISPLAY '***********************************'            
364200                 DISPLAY '** ABEND                         **'            
364300                 DISPLAY '** PROGRAM = TMKUP625            **'            
364400                 DISPLAY '** PARAGRAPH =                   **'            
364500                 DISPLAY '**  6130-CONTNR-PKUP-TO-CURR     **'            
364600                 DISPLAY '** SELECT TIMCNTL                **'            
364700                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
364800                 DISPLAY '** CONTAINER PKUP= '                            
364900                 DISPLAY TM602-CONTNR-PKUP-DTE                            
365000                 DISPLAY '***********************************'            
365100                 PERFORM 9100-SQL-ABEND                                   
365200         END-EVALUATE                                                     
365300     END-PERFORM.                                                         
365400                                                                          
365500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
365600         (SQLCODE NOT = ZERO    AND                                       
365700          SQLCODE NOT = -811    AND                                       
365800          SQLCODE NOT = -180)                                             
365900         DISPLAY '***********************************'                    
366000         DISPLAY '** ABEND                         **'                    
366100         DISPLAY '** PROGRAM = TMKUP625            **'                    
366200         DISPLAY '** PARAGRAPH =                   **'                    
366300         DISPLAY '**  6130-CONTNR-PKUP-TO-CURR     **'                    
366400         DISPLAY '** SELECT TIMCNTL                **'                    
366500         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
366600         DISPLAY '** CONTAINER PKUP= '                                    
366700         DISPLAY TM602-CONTNR-PKUP-DTE                                    
366800         DISPLAY '***********************************'                    
366900         PERFORM 9100-SQL-ABEND                                           
367000     END-IF.                                                              
367100                                                                          
367200******************************************************************        
367300* RULE DESCRIPTION:  COMPARE A CONTAINER ATA DATE TO CURRENT     *        
367400* RULE RETURN TYPE:  DAY                                         *        
367500* RULE CALLS:        NONE                                        *        
367600******************************************************************        
367700 6135-POE-ARRIVAL-TO-CURR.                                                
367800                                                                          
367900     MOVE '6135-POE-ARRIVAL-TO-CURR' TO TM600-CURR-PARAGRAPH.             
368000                                                                          
368100     INITIALIZE PV-6135-POE-ARRIVAL-TO-CURR.                              
368200                                                                          
368300     IF TM602-MOM-POE-DELY-DTE = PC-DEFAULT-DTE OR SPACES                 
368400        SET PS-NO-TIMCNTK-ATA-DATE  TO TRUE                               
368500        SET PS-RULE-PROCESS-ERROR   TO TRUE                               
368600        PERFORM 6990-PREP-ERROR-REPORT-LINE                               
368700     END-IF.                                                              
368800                                                                          
368900     MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                              
369000                                                                          
369100     PERFORM                                                              
369200        WITH TEST AFTER                                                   
369300        VARYING PV-RETRY-COUNTER FROM 1 BY 1                              
369400        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                     
369500        SQLCODE = ZERO                     OR                             
369600        SQLCODE = -811                     OR                             
369700        SQLCODE = -180                                                    
369800                                                                          
369900        EXEC SQL                                                          
370000          SELECT DISTINCT DAYS(CURRENT_DATE)                              
370100                      - DAYS(DATE(:TM602-MOM-POE-DELY-DTE))               
370200          INTO :PV-6135-LAST-RESULT-DAYS                                  
370300          FROM TIMCNTL                                                    
370400        END-EXEC                                                          
370500                                                                          
370600        EVALUATE TRUE                                                     
370700          WHEN SQLCODE = ZERO                                             
370800          WHEN SQLCODE = -811                                             
370900            SET PS-WRITE-TO-TRBDTL TO TRUE                                
371000            MOVE PV-CURR-PO-NBR TO PV-6135-LAST-PO-NBR                    
371100            MOVE PV-6135-LAST-RESULT-DAYS TO                              
371200                                     PV-CURR-RULE-RESULT-DAYS             
371300                                     PV-RESULTS                           
371400            MOVE PV-RESULTS TO PV-RESULTS-X                               
371500            MOVE +1         TO TM601-IMPRT-ARRAY-CNT                      
371600            MOVE TM606-CONTNR-SEQ-NBR                                     
371700                            TO TM601-AR-CONTNR-SEQ-NBR (1)                
371800            MOVE TM606-CONTNR-ID                                          
371900                            TO TM601-AR-CONTNR-ID (1)                     
372000            MOVE +1         TO PV-TRBL-DETAIL-COUNT                       
372100            STRING 'CONTNR ATA = ',                                       
372200                             TM602-MOM-POE-DELY-DTE(6:2), '/',            
372300                             TM602-MOM-POE-DELY-DTE(9:2), '/',            
372400                             TM602-MOM-POE-DELY-DTE(1:4),                 
372500                             ' CURR DATE = ',                             
372600                             PV-REFORMAT-DTE                              
372700                             DELIMITED BY SIZE                            
372800                        INTO PV-TRBL-DETAIL-2ND                           
372900                                                                          
373000            STRING  'SEVERITY = ',                                        
373100                             PV-RESULTS-X, ' DAY(S)',                     
373200                    ' CONTNR = ' TM606-CONTNR-ID                          
373300                             DELIMITED BY SIZE                            
373400                        INTO PV-TRBL-DETAIL-3RD                           
373500                                                                          
373600          WHEN SQLCODE = -180                                             
373700              SET PS-INVALID-DATE-WAS-USED TO TRUE                        
373800              PERFORM 6990-PREP-ERROR-REPORT-LINE                         
373900              SET PS-RULE-PROCESS-ERROR    TO TRUE                        
374000                                                                          
374100                 WHEN SQLCODE = -911                                      
374200                 WHEN SQLCODE = -913                                      
374300                 WHEN SQLCODE = -904                                      
374400                     CONTINUE                                             
374500                                                                          
374600          WHEN SQLWARN0 NOT EQUAL SPACE                                   
374700          WHEN SQLCODE NOT EQUAL ZERO                                     
374800                 DISPLAY '***********************************'            
374900                 DISPLAY '** ABEND                         **'            
375000                 DISPLAY '** PROGRAM = TMKUP625            **'            
375100                 DISPLAY '** PARAGRAPH =                   **'            
375200                 DISPLAY '**  6135-POE-ARRIVAL-TO-CURR     **'            
375300                 DISPLAY '** SELECT TIMCNTL                **'            
375400                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
375500                 DISPLAY '** CONTAINER POE ATA = '                        
375600                 DISPLAY TM602-MOM-POE-DELY-DTE                           
375700                 DISPLAY '***********************************'            
375800                 PERFORM 9100-SQL-ABEND                                   
375900         END-EVALUATE                                                     
376000     END-PERFORM.                                                         
376100                                                                          
376200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
376300         (SQLCODE NOT = ZERO    AND                                       
376400          SQLCODE NOT = -811    AND                                       
376500          SQLCODE NOT = -180)                                             
376600         DISPLAY '***********************************'                    
376700         DISPLAY '** ABEND                         **'                    
376800         DISPLAY '** PROGRAM = TMKUP625            **'                    
376900         DISPLAY '** PARAGRAPH =                   **'                    
377000         DISPLAY '**  6135-POE-ARRIVAL-TO-CURR     **'                    
377100         DISPLAY '** SELECT TIMCNTL                **'                    
377200         DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR                      
377300         DISPLAY '** CONTAINER POE ATA = '                                
377400         DISPLAY TM602-MOM-POE-DELY-DTE                                   
377500         DISPLAY '***********************************'                    
377600         PERFORM 9100-SQL-ABEND                                           
377700     END-IF.                                                              
377800                                                                          
377900******************************************************************        
378000* RULE DESCRIPTION:  A CONTAINER PICK UP DATE EXISTS             *        
378100* RULE RETURN TYPE:  INDICATOR                                   *        
378200* RULE CALLS:        NONE                                        *        
378300******************************************************************        
378400 6140-A-CONTNR-PKUP.                                                      
378500                                                                          
378600     MOVE '6140-A-CONTNR-PKUP' TO TM600-CURR-PARAGRAPH.                   
378700                                                                          
378800     INITIALIZE PV-6140-A-CONTNR-PKUP.                                    
378900                                                                          
379000     MOVE TM606-CONTNR-ID      TO IMCNPO-CONTNR-ID.                       
379100     MOVE TM606-CONTNR-SEQ-NBR TO IMCNPO-CONTNR-SEQ-NBR.                  
379200                                                                          
379300     PERFORM                                                              
379400         WITH TEST AFTER                                                  
379500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
379600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
379700                 SQLCODE = ZERO                     OR                    
379800                 SQLCODE = -811                     OR                    
379900                 SQLCODE = +100                                           
380000                                                                          
380100         EXEC SQL                                                         
380200             SELECT PO_NBR                                                
380300              INTO :PV-6140-LAST-PO-NBR                                   
380400             FROM  TIMCNPO A                                              
380500                  ,TIMCNTK B                                              
380600             WHERE A.PO_NBR           = :PV-CURR-PO-NBR                   
380700             AND   A.CONTNR_ID        = B.CONTNR_ID                       
380800             AND   A.CONTNR_SEQ_NBR   = B.CONTNR_SEQ_NBR                  
380900             AND   A.CONTNR_ID        = :IMCNPO-CONTNR-ID                 
381000             AND   A.CONTNR_SEQ_NBR   = :IMCNPO-CONTNR-SEQ-NBR            
381100             AND   B.CONTNR_PU_TMST   <> :PC-DEFAULT-TMST                 
381200         END-EXEC                                                         
381300                                                                          
381400         EVALUATE TRUE                                                    
381500             WHEN SQLCODE = ZERO                                          
381600             WHEN SQLCODE = -811                                          
381700                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
381800                              PV-6140-LAST-RESULT-IND                     
381900                                                                          
382000             WHEN SQLCODE = +100                                          
382100                 MOVE PC-N TO PV-RULE-RESULT-IND                          
382200                              PV-6140-LAST-RESULT-IND                     
382300                                                                          
382400                 WHEN SQLCODE = -911                                      
382500                 WHEN SQLCODE = -913                                      
382600                 WHEN SQLCODE = -904                                      
382700                     CONTINUE                                             
382800                                                                          
382900             WHEN SQLWARN0 NOT EQUAL SPACE                                
383000             WHEN SQLCODE NOT EQUAL ZERO                                  
383100                 DISPLAY '***********************************'            
383200                 DISPLAY '** ABEND                         **'            
383300                 DISPLAY '** PROGRAM = TMKUP625            **'            
383400                 DISPLAY '** PARAGRAPH =                   **'            
383500                 DISPLAY '**    6140-A-CONTNR-PKUP         **'            
383600                 DISPLAY '** SELECT TIMCNPO/TIMCNTK        **'            
383700                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
383800                 DISPLAY '***********************************'            
383900                 PERFORM 9100-SQL-ABEND                                   
384000         END-EVALUATE                                                     
384100     END-PERFORM.                                                         
384200                                                                          
384300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
384400         (SQLCODE NOT = ZERO    AND                                       
384500          SQLCODE NOT = -811    AND                                       
384600          SQLCODE NOT = +100)                                             
384700         DISPLAY '*******************************************'            
384800         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
384900         DISPLAY '** SELECT FROM TIMCNPO/TIMCNPO           **'            
385000         DISPLAY '** PARAGRAPH = 6140-A-CONTNR-PKUP        **'            
385100         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
385200         DISPLAY '*******************************************'            
385300         PERFORM 9100-SQL-ABEND                                           
385400     END-IF.                                                              
385500                                                                          
385600******************************************************************        
385700* RULE DESCRIPTION:  A CONTAINER MANIFEST EXISTS                 *        
385800* RULE RETURN TYPE:  INDICATOR                                   *        
385900* RULE CALLS:        NONE                                        *        
386000******************************************************************        
386100 6145-A-CONTNR-MANF.                                                      
386200                                                                          
386300     MOVE '6145-A-CONTNR-MANF' TO TM600-CURR-PARAGRAPH.                   
386400                                                                          
386500     INITIALIZE PV-6145-A-CONTNR-MANF.                                    
386600                                                                          
386700     PERFORM                                                              
386800         WITH TEST AFTER                                                  
386900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
387000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
387100                 SQLCODE = ZERO                     OR                    
387200                 SQLCODE = -811                     OR                    
387300                 SQLCODE = +100                                           
387400                                                                          
387500         EXEC SQL                                                         
387600             SELECT PO_NBR                                                
387700              INTO :PV-6145-LAST-PO-NBR                                   
387800             FROM  TIMCNPO A                                              
387900                  ,TIMCNTK B                                              
388000             WHERE A.PO_NBR           = :PV-CURR-PO-NBR                   
388100             AND   A.CONTNR_ID        = B.CONTNR_ID                       
388200             AND   A.CONTNR_SEQ_NBR   = B.CONTNR_SEQ_NBR                  
388300         END-EXEC                                                         
388400                                                                          
388500         EVALUATE TRUE                                                    
388600             WHEN SQLCODE = ZERO                                          
388700             WHEN SQLCODE = -811                                          
388800                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
388900                              PV-6145-LAST-RESULT-IND                     
389000                                                                          
389100             WHEN SQLCODE = +100                                          
389200                 MOVE PC-N TO PV-RULE-RESULT-IND                          
389300                              PV-6145-LAST-RESULT-IND                     
389400                                                                          
389500                 WHEN SQLCODE = -911                                      
389600                 WHEN SQLCODE = -913                                      
389700                 WHEN SQLCODE = -904                                      
389800                     CONTINUE                                             
389900                                                                          
390000             WHEN SQLWARN0 NOT EQUAL SPACE                                
390100             WHEN SQLCODE NOT EQUAL ZERO                                  
390200                 DISPLAY '***********************************'            
390300                 DISPLAY '** ABEND                         **'            
390400                 DISPLAY '** PROGRAM = TMKUP625            **'            
390500                 DISPLAY '** PARAGRAPH =                   **'            
390600                 DISPLAY '**    6145-A-CONTNR-MANF         **'            
390700                 DISPLAY '** SELECT TIMCNPO/TIMCNTK        **'            
390800                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
390900                 DISPLAY '***********************************'            
391000                 PERFORM 9100-SQL-ABEND                                   
391100         END-EVALUATE                                                     
391200     END-PERFORM.                                                         
391300                                                                          
391400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
391500         (SQLCODE NOT = ZERO    AND                                       
391600          SQLCODE NOT = -811    AND                                       
391700          SQLCODE NOT = +100)                                             
391800         DISPLAY '*******************************************'            
391900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
392000         DISPLAY '** SELECT FROM TIMCNPO/TIMCNPO           **'            
392100         DISPLAY '** PARAGRAPH = 6145-A-CONTNR-MANF        **'            
392200         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
392300         DISPLAY '*******************************************'            
392400         PERFORM 9100-SQL-ABEND                                           
392500     END-IF.                                                              
392600                                                                          
392700******************************************************************        
392800* RULE DESCRIPTION:  A CUSTOMS RELEASE EXISTS                    *        
392900* RULE RETURN TYPE:  INDICATOR                                   *        
393000* RULE CALLS:        NONE                                        *        
393100******************************************************************        
393200 6150-A-CUSTOMS-FILING.                                                   
393300                                                                          
393400     MOVE '6150-A-CUSTOMS-FILING'  TO TM600-CURR-PARAGRAPH.               
393500                                                                          
393600     INITIALIZE PV-6150-A-CUSTOMS-FILING.                                 
393700                                                                          
393800     PERFORM                                                              
393900         WITH TEST AFTER                                                  
394000         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
394100         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
394200                 SQLCODE = ZERO                     OR                    
394300                 SQLCODE = -811                     OR                    
394400                 SQLCODE = +100                                           
394500                                                                          
394600         EXEC SQL                                                         
394700             SELECT PO_NBR                                                
394800              INTO :PV-6150-LAST-PO-NBR                                   
394900               FROM TIMCSPO A                                             
395000                   ,TIMCSEN B                                             
395100              WHERE A.PO_NBR         = :PV-CURR-PO-NBR                    
395200              AND   A.CSTM_ENTR_ID   = B.CSTM_ENTR_ID                     
395300              AND   B.FILD_TMST     <> :PC-DEFAULT-TMST                   
395400         END-EXEC                                                         
395500                                                                          
395600         EVALUATE TRUE                                                    
395700             WHEN SQLCODE = ZERO                                          
395800             WHEN SQLCODE = -811                                          
395900                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
396000                              PV-6150-LAST-RESULT-IND                     
396100                                                                          
396200             WHEN SQLCODE = +100                                          
396300                 MOVE PC-N TO PV-RULE-RESULT-IND                          
396400                              PV-6150-LAST-RESULT-IND                     
396500                                                                          
396600                 WHEN SQLCODE = -911                                      
396700                 WHEN SQLCODE = -913                                      
396800                 WHEN SQLCODE = -904                                      
396900                     CONTINUE                                             
397000                                                                          
397100             WHEN SQLWARN0 NOT EQUAL SPACE                                
397200             WHEN SQLCODE NOT EQUAL ZERO                                  
397300                 DISPLAY '***********************************'            
397400                 DISPLAY '** ABEND                         **'            
397500                 DISPLAY '** PROGRAM = TMKUP625            **'            
397600                 DISPLAY '** PARAGRAPH =                   **'            
397700                 DISPLAY '**    6150-A-CUSTOMS-FILING      **'            
397800                 DISPLAY '** SELECT TIMCSEN/TIMCSPO        **'            
397900                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
398000                 DISPLAY '***********************************'            
398100                 PERFORM 9100-SQL-ABEND                                   
398200         END-EVALUATE                                                     
398300     END-PERFORM.                                                         
398400                                                                          
398500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
398600         (SQLCODE NOT = ZERO    AND                                       
398700          SQLCODE NOT = -811    AND                                       
398800          SQLCODE NOT = +100)                                             
398900         DISPLAY '*******************************************'            
399000         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
399100         DISPLAY '** SELECT FROM TIMCNTL                   **'            
399200         DISPLAY '** PARAGRAPH = 6150-A-CUSTOMS-FILING     **'            
399300         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
399400         DISPLAY '*******************************************'            
399500         PERFORM 9100-SQL-ABEND                                           
399600     END-IF.                                                              
399700                                                                          
399800******************************************************************        
399900* RULE DESCRIPTION:  AN AIR SHIPMENT EXISTS                      *        
400000* RULE RETURN TYPE:  INDICATOR                                   *        
400100* RULE CALLS:        NONE                                        *        
400200******************************************************************        
400300 6155-AN-AIR-SHIPMENT.                                                    
400400                                                                          
400500     MOVE '6155-AN-AIR-SHIPMENT'   TO TM600-CURR-PARAGRAPH.               
400600                                                                          
400700     INITIALIZE PV-6155-AN-AIR-SHIPMENT.                                  
400800                                                                          
400900     PERFORM                                                              
401000         WITH TEST AFTER                                                  
401100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
401200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
401300                 SQLCODE = ZERO                     OR                    
401400                 SQLCODE = -811                     OR                    
401500                 SQLCODE = +100                                           
401600                                                                          
401700         EXEC SQL                                                         
401800             SELECT PO_NBR                                                
401900              INTO :PV-6155-LAST-PO-NBR                                   
402000             FROM  TSHPTPO A                                              
402100                  ,TSHIPMT B                                              
402200                  ,TVHTRIP C                                              
402300                  ,TVEHICL D                                              
402400             WHERE A.SHIPT_ID         = B.SHIPT_ID                        
402500             AND   B.TRIP_ID          = C.TRIP_ID                         
402600             AND   C.OWNER_SCAC_ID    = D.OWNER_SCAC_ID                   
402700             AND   C.VEH_NBR          = D.VEH_NBR                         
402800             AND   D.VEH_TYP_CDE      = :PC-AV                            
402900             AND   A.PO_NBR           = :PV-CURR-PO-NBR                   
403000         END-EXEC                                                         
403100                                                                          
403200         EVALUATE TRUE                                                    
403300             WHEN SQLCODE = ZERO                                          
403400             WHEN SQLCODE = -811                                          
403500                 MOVE PC-Y TO PV-RULE-RESULT-IND                          
403600                              PV-6155-LAST-RESULT-IND                     
403700                                                                          
403800             WHEN SQLCODE = +100                                          
403900                 MOVE PC-N TO PV-RULE-RESULT-IND                          
404000                              PV-6155-LAST-RESULT-IND                     
404100                                                                          
404200                 WHEN SQLCODE = -911                                      
404300                 WHEN SQLCODE = -913                                      
404400                 WHEN SQLCODE = -904                                      
404500                     CONTINUE                                             
404600                                                                          
404700             WHEN SQLWARN0 NOT EQUAL SPACE                                
404800             WHEN SQLCODE NOT EQUAL ZERO                                  
404900                 DISPLAY '***********************************'            
405000                 DISPLAY '** ABEND                         **'            
405100                 DISPLAY '** PROGRAM = TMKUP625            **'            
405200                 DISPLAY '** PARAGRAPH =                   **'            
405300                 DISPLAY '**    6155-AN-AIR-SHIPMENT       **'            
405400                 DISPLAY '** SELECT TSHPTPO/TSHIPMT/       **'            
405500                 DISPLAY '**        TVHTRIP/TVEHICL        **'            
405600                 DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR              
405700                 DISPLAY '***********************************'            
405800                 PERFORM 9100-SQL-ABEND                                   
405900         END-EVALUATE                                                     
406000     END-PERFORM.                                                         
406100                                                                          
406200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
406300         (SQLCODE NOT = ZERO    AND                                       
406400          SQLCODE NOT = -811    AND                                       
406500          SQLCODE NOT = +100)                                             
406600         DISPLAY '*******************************************'            
406700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
406800         DISPLAY '** 6155-AN-AIR-SHIPMENT                  **'            
406900         DISPLAY '** SELECT TSHPTPO/TSHIPMT/TVHTRIP/TVEHICL**'            
407000         DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                     
407100         DISPLAY '*******************************************'            
407200         PERFORM 9100-SQL-ABEND                                           
407300     END-IF.                                                              
407400                                                                          
407500******************************************************************        
407600* RULE DESCRIPTION:  DAYS AFTER STRT FCTRY DATE BY EARLIEST      *        
407700*                    BOOKING TRANSMISSION                        *        
407800* RULE RETURN TYPE:  DAYS                                        *        
407900* RULE CALLS:        NONE                                        *        
408000******************************************************************        
408100 6160-BKNG-CRE-TO-STRT.                                                   
408200                                                                          
408300     MOVE '6160-BKNG-CRE-TO-STRT'    TO TM600-CURR-PARAGRAPH.             
408400                                                                          
408500     INITIALIZE PV-6160-BKNG-CRE-TO-STRT.                                 
408600                                                                          
408700     IF TM602-STRT-FCTRY-DTE = PC-DEFAULT-DTE OR SPACES                   
408800         PERFORM 7090-SELECT-TPLNSHP-DATES                                
408900         IF PS-TPLNSHP-STRT-FCTRY-NO                                      
409000             SET PS-NO-TPLNSHP-STRT-FCTRY TO TRUE                         
409100             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
409200         ELSE                                                             
409300             MOVE PV-STRT-FCTRY-DTE TO TM602-STRT-FCTRY-DTE               
409400         END-IF                                                           
409500     END-IF.                                                              
409600                                                                          
409700     IF TM602-STRT-FCTRY-DTE = PC-DEFAULT-DTE                             
409800         MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                          
409900     ELSE                                                                 
410000         PERFORM                                                          
410100             WITH TEST AFTER                                              
410200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
410300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                
410400                     SQLCODE = ZERO                     OR                
410500                     SQLCODE = -811                     OR                
410600                     SQLCODE = -180                                       
410700                                                                          
410800             EXEC SQL                                                     
410900               SELECT DISTINCT DAYS(MIN(DATE(CRE_TMST)))                  
411000                             - DAYS(DATE(:TM602-STRT-FCTRY-DTE))          
411100                 INTO :PV-6160-LAST-RESULT-DAYS                           
411200                 FROM TIMBKPO                                             
411300                 WHERE PO_NBR         = :PV-CURR-PO-NBR                   
411400             END-EXEC                                                     
411500                                                                          
411600             EVALUATE TRUE                                                
411700                 WHEN SQLCODE = ZERO                                      
411800                 WHEN SQLCODE = -811                                      
411900                     SET PS-WRITE-TO-TRBDTL TO TRUE                       
412000                     MOVE PV-CURR-PO-NBR TO PV-6160-LAST-PO-NBR           
412100                     MOVE PV-6160-LAST-RESULT-DAYS TO                     
412200                           PV-CURR-RULE-RESULT-DAYS                       
412300                           PV-RESULTS                                     
412400                     MOVE PV-RESULTS TO PV-RESULTS-X                      
412500                                                                          
412600                     STRING 'STRT FCTRY = ',                              
412700                             TM602-STRT-FCTRY-DTE (6:2), '/',             
412800                             TM602-STRT-FCTRY-DTE (9:2), '/',             
412900                             TM602-STRT-FCTRY-DTE (1:4),                  
413000                             '   CURR DATE = ',                           
413100                             PV-REFORMAT-DTE                              
413200                             DELIMITED BY SIZE                            
413300                        INTO PV-TRBL-DETAIL-2ND                           
413400                                                                          
413500                     STRING  'SEVERITY = ',                               
413600                             PV-RESULTS-X, ' DAY(S)'                      
413700                             DELIMITED BY SIZE                            
413800                        INTO PV-TRBL-DETAIL-3RD                           
413900                                                                          
414000                 WHEN SQLCODE = -180                                      
414100                     SET PS-INVALID-DATE-WAS-USED TO TRUE                 
414200                     PERFORM 6990-PREP-ERROR-REPORT-LINE                  
414300                     SET PS-RULE-PROCESS-ERROR    TO TRUE                 
414400                                                                          
414500                 WHEN SQLCODE = -911                                      
414600                 WHEN SQLCODE = -913                                      
414700                 WHEN SQLCODE = -904                                      
414800                     CONTINUE                                             
414900                                                                          
415000                 WHEN SQLWARN0 NOT EQUAL SPACE                            
415100                 WHEN SQLCODE NOT EQUAL ZERO                              
415200                     DISPLAY '***********************************'        
415300                     DISPLAY '** ABEND                         **'        
415400                     DISPLAY '** PROGRAM = TMKUP625            **'        
415500                     DISPLAY '** PARAGRAPH =                   **'        
415600                     DISPLAY '**    6160-BKNG-CRE-TO-STRT      **'        
415700                     DISPLAY '** SELECT TIMBKPO                **'        
415800                     DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR          
415900                     DISPLAY '** STRT FCTRY DT = '                        
416000                     DISPLAY                TM602-STRT-FCTRY-DTE          
416100                     DISPLAY '***********************************'        
416200                     PERFORM 9100-SQL-ABEND                               
416300             END-EVALUATE                                                 
416400         END-PERFORM                                                      
416500                                                                          
416600           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                      
416700              (SQLCODE NOT = ZERO    AND                                  
416800               SQLCODE NOT = -811    AND                                  
416900               SQLCODE NOT = -180)                                        
417000              DISPLAY '******************************************'        
417100              DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'        
417200              DISPLAY '** SELECT FROM TIMBKPO                  **'        
417300              DISPLAY '** PARAGRAPH = 6160-BKNG-CRE-TO-STRT    **'        
417400              DISPLAY '** PO NUMBER = ' PV-KEY-PO-NBR                     
417500              DISPLAY '** STRT FCTRY DT  = '                              
417600                                         TM602-STRT-FCTRY-DTE             
417700              DISPLAY '******************************************'        
417800              PERFORM 9100-SQL-ABEND                                      
417900           END-IF                                                         
418000     END-IF.                                                              
418100                                                                          
418200******************************************************************        
418300* RULE DESCRIPTION:  DAYS AFTER LAST FCTRY DATE BASED ON         *        
418400*                    EARLIEST RECEIVING TRANSACTION.             *        
418500* RULE RETURN TYPE:  DAYS                                        *        
418600* RULE CALLS:        NONE                                        *        
418700******************************************************************        
418800 6165-RCVG-CRE-TO-LAST.                                                   
418900                                                                          
419000     MOVE '6165-RCVG-CRE-TO-LAST'    TO TM600-CURR-PARAGRAPH.             
419100                                                                          
419200     INITIALIZE PV-6165-RCVG-CRE-TO-LAST.                                 
419300                                                                          
419400     IF TM602-LAST-FCTRY-DTE = PC-DEFAULT-DTE OR SPACES                   
419500         PERFORM 7090-SELECT-TPLNSHP-DATES                                
419600         IF PS-TPLNSHP-LAST-FCTRY-NO                                      
419700             SET PS-NO-TPLNSHP-LAST-FCTRY TO TRUE                         
419800             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
419900         ELSE                                                             
420000             MOVE PV-LAST-FCTRY-DTE TO TM602-LAST-FCTRY-DTE               
420100         END-IF                                                           
420200     END-IF.                                                              
420300                                                                          
420400     IF TM602-LAST-FCTRY-DTE = PC-DEFAULT-DTE                             
420500         MOVE ZEROES TO PV-CURR-RULE-RESULT-DAYS                          
420600     ELSE                                                                 
420700           PERFORM                                                        
420800               WITH TEST AFTER                                            
420900               VARYING PV-RETRY-COUNTER FROM 1 BY 1                       
421000               UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              
421100                       SQLCODE = ZERO                     OR              
421200                       SQLCODE = -811                     OR              
421300                       SQLCODE = -180                                     
421400                                                                          
421500             EXEC SQL                                                     
421600               SELECT DISTINCT DAYS(MIN(DATE(CRE_TMST)))                  
421700                             - DAYS(DATE(:TM602-LAST-FCTRY-DTE))          
421800                 INTO :PV-6165-LAST-RESULT-DAYS                           
421900                 FROM TIMRCPO                                             
422000                 WHERE PO_NBR         = :PV-CURR-PO-NBR                   
422100             END-EXEC                                                     
422200                                                                          
422300             EVALUATE TRUE                                                
422400                 WHEN SQLCODE = ZERO                                      
422500                 WHEN SQLCODE = -811                                      
422600                     SET PS-WRITE-TO-TRBDTL TO TRUE                       
422700                     MOVE PV-CURR-PO-NBR TO PV-6165-LAST-PO-NBR           
422800                     MOVE PV-6165-LAST-RESULT-DAYS TO                     
422900                           PV-CURR-RULE-RESULT-DAYS                       
423000                           PV-RESULTS                                     
423100                     MOVE PV-RESULTS TO PV-RESULTS-X                      
423200                                                                          
423300                     STRING 'LAST FCTRY = ',                              
423400                             TM602-LAST-FCTRY-DTE (6:2), '/',             
423500                             TM602-LAST-FCTRY-DTE (9:2), '/',             
423600                             TM602-LAST-FCTRY-DTE (1:4),                  
423700                             '   CURR DATE = ',                           
423800                             PV-REFORMAT-DTE                              
423900                             DELIMITED BY SIZE                            
424000                        INTO PV-TRBL-DETAIL-2ND                           
424100                                                                          
424200                     STRING  'SEVERITY = ',                               
424300                             PV-RESULTS-X, ' DAY(S)'                      
424400                             DELIMITED BY SIZE                            
424500                        INTO PV-TRBL-DETAIL-3RD                           
424600                                                                          
424700                 WHEN SQLCODE = -180                                      
424800                     SET PS-INVALID-DATE-WAS-USED TO TRUE                 
424900                     PERFORM 6990-PREP-ERROR-REPORT-LINE                  
425000                     SET PS-RULE-PROCESS-ERROR    TO TRUE                 
425100                                                                          
425200                 WHEN SQLCODE = -911                                      
425300                 WHEN SQLCODE = -913                                      
425400                 WHEN SQLCODE = -904                                      
425500                     CONTINUE                                             
425600                                                                          
425700                 WHEN SQLWARN0 NOT EQUAL SPACE                            
425800                 WHEN SQLCODE NOT EQUAL ZERO                              
425900                     DISPLAY '***********************************'        
426000                     DISPLAY '** ABEND                         **'        
426100                     DISPLAY '** PROGRAM = TMKUP625            **'        
426200                     DISPLAY '** PARAGRAPH =                   **'        
426300                     DISPLAY '**    6165-RCVG-CRE-TO-LAST      **'        
426400                     DISPLAY '** SELECT TIMCNTL                **'        
426500                     DISPLAY '** PO NUMBER     = ' PV-KEY-PO-NBR          
426600                     DISPLAY '** LAST FCTRY DT = '                        
426700                     DISPLAY                TM602-LAST-FCTRY-DTE          
426800                     DISPLAY '***********************************'        
426900                     PERFORM 9100-SQL-ABEND                               
427000             END-EVALUATE                                                 
427100           END-PERFORM                                                    
427200                                                                          
427300           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                      
427400              (SQLCODE NOT = ZERO    AND                                  
427500               SQLCODE NOT = -811    AND                                  
427600               SQLCODE NOT = -180)                                        
427700              DISPLAY '******************************************'        
427800              DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'        
427900              DISPLAY '** SELECT FROM TIMCNTL                  **'        
428000              DISPLAY '** PARAGRAPH = 6165-RCVG-CRE-TO-LAST    **'        
428100              DISPLAY '** PO NUMBER      = ' PV-KEY-PO-NBR                
428200              DISPLAY '** LAST FCTRY DT  = '                              
428300                                         TM602-LAST-FCTRY-DTE             
428400              DISPLAY '******************************************'        
428500              PERFORM 9100-SQL-ABEND                                      
428600           END-IF                                                         
428700     END-IF.                                                              
428800                                                                          
428900******************************************************************        
429000* PREP THE DETAIL REPORT CONTAINER LINE DATA.                    *        
429100******************************************************************        
429200 6975-PREP-CONTNR-DETAIL-LINE.                                            
429300                                                                          
429400     MOVE PC-DETAIL TO PV-KEY-ODR-RECORD-TYP.                             
429500     MOVE PC-04     TO PV-KEY-GROUP-TYP-CDE.                              
429600                                                                          
429700     EVALUATE PV-CURR-DATA-SRC                                            
429800         WHEN PC-BK                                                       
429900             MOVE PC-BK TO TM605-PRCS-TYP-CDE                             
430000         WHEN PC-CN                                                       
430100             MOVE PC-CN TO TM605-PRCS-TYP-CDE                             
430200         WHEN PC-CS                                                       
430300             MOVE PC-CS TO TM605-PRCS-TYP-CDE                             
430400         WHEN PC-CV                                                       
430500             MOVE PC-CV TO TM605-PRCS-TYP-CDE                             
430600         WHEN PC-RC                                                       
430700             MOVE PC-RC TO TM605-PRCS-TYP-CDE                             
430800     END-EVALUATE.                                                        
430900                                                                          
431000     MOVE PV-KEY-INFO            TO TM605-RPT-PAR-1-ODR-KEY.              
431100     MOVE TM605-RPT-PAR-1-ODR    TO OUTTM2-TRBL-RPT-PAR-1-ODR.            
431200     MOVE TM605-RPT-PAR-2-ODR    TO OUTTM2-TRBL-RPT-PAR-2-ODR.            
431300                                                                          
431400     PERFORM 7000-INSERT-TOUTTM2-RPT.                                     
431500                                                                          
431600     ADD +1                      TO PA-TOT-CNTR-DETAIL-COUNT.             
431700     ADD +1                      TO PA-TOT-DETAIL-COUNT.                  
431800     ADD +1                      TO PA-TOT-RECS-LOADED.                   
431900                                                                          
432000 EJECT                                                                    
432100******************************************************************        
432200* PREP THE DETAIL REPORT PO LINE DATA.                           *        
432300******************************************************************        
432400 6980-PREP-PO-DETAIL-LINE.                                                
432500                                                                          
432600     MOVE PC-DETAIL TO PV-KEY-ODR-RECORD-TYP.                             
432700     MOVE PC-01     TO PV-KEY-GROUP-TYP-CDE.                              
432800                                                                          
432900     MOVE PV-KEY-INFO            TO TM602-RPT-PAR-1-ODR-KEY.              
433000     MOVE TM602-RPT-PAR-1-ODR    TO OUTTM2-TRBL-RPT-PAR-1-ODR.            
433100     MOVE TM602-RPT-PAR-2-ODR    TO OUTTM2-TRBL-RPT-PAR-2-ODR.            
433200                                                                          
433300     PERFORM 7000-INSERT-TOUTTM2-RPT.                                     
433400                                                                          
433500     ADD +1                      TO PA-TOT-PO-DETAIL-COUNT.               
433600     ADD +1                      TO PA-TOT-DETAIL-COUNT.                  
433700     ADD +1                      TO PA-TOT-RECS-LOADED.                   
433800                                                                          
433900 EJECT                                                                    
434000******************************************************************        
434100* PREP THE DETAIL REPORT RULE LINE DATA.                         *        
434200******************************************************************        
434300 6985-PREP-RULE-DETAIL-LINE.                                              
434400                                                                          
434500     MOVE PC-DETAIL TO PV-KEY-ODR-RECORD-TYP.                             
434600     MOVE PC-02     TO PV-KEY-GROUP-TYP-CDE.                              
434700                                                                          
434800     MOVE PV-KEY-INFO            TO TM603-RPT-PAR-1-ODR-KEY.              
434900     MOVE TM603-RPT-PAR-1-ODR    TO OUTTM2-TRBL-RPT-PAR-1-ODR.            
435000     MOVE SPACES                 TO OUTTM2-TRBL-RPT-PAR-2-ODR.            
435100                                                                          
435200     PERFORM 7000-INSERT-TOUTTM2-RPT.                                     
435300                                                                          
435400     ADD +1                      TO PA-TOT-RULE-DETAIL-COUNT.             
435500     ADD +1                      TO PA-TOT-DETAIL-COUNT.                  
435600     ADD +1                      TO PA-TOT-RECS-LOADED.                   
435700                                                                          
435800 EJECT                                                                    
435900******************************************************************        
436000* PREP ERROR REPORT LINE DATA.                                   *        
436100******************************************************************        
436200 6990-PREP-ERROR-REPORT-LINE.                                             
436300                                                                          
436400     MOVE PC-ERROR TO PV-KEY-ODR-RECORD-TYP.                              
436500     MOVE PC-05     TO PV-KEY-GROUP-TYP-CDE.                              
436600                                                                          
436700     PERFORM 6995-DETERMINE-ERROR-TEXT.                                   
436800     MOVE PV-KEY-INFO           TO TM600-RPT-PAR-1-ODR-KEY.               
436900     MOVE TM600-RPT-PAR-1-ODR   TO OUTTM2-TRBL-RPT-PAR-1-ODR.             
437000     MOVE SPACES                TO OUTTM2-TRBL-RPT-PAR-2-ODR.             
437100                                                                          
437200     PERFORM 7000-INSERT-TOUTTM2-RPT.                                     
437300                                                                          
437400     ADD +1                     TO PA-TOT-ERROR-COUNT.                    
437500     ADD +1                     TO PA-TOT-RECS-LOADED.                    
437600                                                                          
437700 EJECT                                                                    
437800******************************************************************        
437900* DETERMINE WHAT ERROR MESSAGE SWITCH IS SET ON AND MOVE THE     *        
438000* APPROPRIATE ERROR MESSAGE TO THE ERROR TEXT FIELD.             *        
438100******************************************************************        
438200 6995-DETERMINE-ERROR-TEXT.                                               
438300                                                                          
438400     EVALUATE TRUE                                                        
438500         WHEN PS-TRBL-RSN-TURNED-OFF                                      
438600             MOVE 'TROUBLE REASON TURNED OFF' TO                          
438700                                        TM600-TRBL-ERROR-TEXT             
438800         WHEN PS-PO-EXTRACT-WAS-EMPTY                                     
438900             MOVE 'EMPTY PO EXTRACT TABLE'    TO                          
439000                                        TM600-TRBL-ERROR-TEXT             
439100         WHEN PS-RULE-PARA-NOT-FOUND                                      
439200             MOVE 'RULE PARAGRAPH NOT FOUND'  TO                          
439300                                        TM600-TRBL-ERROR-TEXT             
439400         WHEN PS-INVALID-RULE-RET-TYP                                     
439500             MOVE 'INVALID RULE RETURN TYPE'  TO                          
439600                                        TM600-TRBL-ERROR-TEXT             
439700         WHEN PS-INVALID-DAT-SRC-FOR-PRC-CDE                              
439800             MOVE 'INVALID DATA SOURCE FOR PROCESSING CODE' TO            
439900                                        TM600-TRBL-ERROR-TEXT             
440000         WHEN PS-RULE-PARA-ERROR                                          
440100             MOVE 'RULE PARAGRAPH ERROR'      TO                          
440200                                        TM600-TRBL-ERROR-TEXT             
440300         WHEN PS-NO-TRBL-KEYS-FOUND                                       
440400             MOVE 'NO TROUBLE KEYS FOUND'     TO                          
440500                                        TM600-TRBL-ERROR-TEXT             
440600         WHEN PS-INVALID-FOB-CDE-TIMRCPO                                  
440700             MOVE 'INVALID FOB CODE - TIMRCPO' TO                         
440800                                        TM600-TRBL-ERROR-TEXT             
440900         WHEN PS-INVALID-FOB-CDE-TAURCPO                                  
441000             MOVE 'INVALID FOB CODE - TAURCPO' TO                         
441100                                        TM600-TRBL-ERROR-TEXT             
441200         WHEN PS-INVALID-FOB-CDE-TIMBKPO                                  
441300             MOVE 'INVALID FOB CODE - TIMBKPO' TO                         
441400                                        TM600-TRBL-ERROR-TEXT             
441500         WHEN PS-INVALID-FOB-CDE-TAUBKPO                                  
441600             MOVE 'INVALID FOB CODE - TAUBKPO' TO                         
441700                                        TM600-TRBL-ERROR-TEXT             
441800         WHEN PS-INVALID-FOB-CDE-TIMCNTK                                  
441900             MOVE 'INVALID FOB CODE - TIMCNTK' TO                         
442000                                        TM600-TRBL-ERROR-TEXT             
442100         WHEN PS-INVALID-FOB-CDE-TAUCNTK                                  
442200             MOVE 'INVALID FOB CODE - TAUCNTK' TO                         
442300                                        TM600-TRBL-ERROR-TEXT             
442400         WHEN PS-INVALID-FOB-CDE-TPLNSHP                                  
442500             MOVE 'INVALID FOB CODE - TPLNSHP' TO                         
442600                                        TM600-TRBL-ERROR-TEXT             
442700         WHEN PS-NO-TPLNSHP-STRT-FCTRY                                    
442800             MOVE 'TPLNSHP STRT FCTRY MISSING' TO                         
442900                                        TM600-TRBL-ERROR-TEXT             
443000         WHEN PS-NO-TPLNSHP-LAST-FCTRY                                    
443100             MOVE 'TPLNSHP LAST FCTRY MISSING' TO                         
443200                                        TM600-TRBL-ERROR-TEXT             
443300         WHEN PS-NO-PO-BKG-DELY-DTE                                       
443400             MOVE 'PO BKG DELY DTE MISSING'   TO                          
443500                                        TM600-TRBL-ERROR-TEXT             
443600         WHEN PS-INVALID-TRIP-TYP-CDE-ERR                                 
443700             MOVE 'INVALID TRIP TYPE'         TO                          
443800                                        TM600-TRBL-ERROR-TEXT             
443900         WHEN PS-MISSING-KEY-FOB-CDE                                      
444000             MOVE 'MISSING FOB KEY'           TO                          
444100                                        TM600-TRBL-ERROR-TEXT             
444200         WHEN PS-MISSING-KEY-ENTID                                        
444300             MOVE 'MISSING ENTID KEY'         TO                          
444400                                        TM600-TRBL-ERROR-TEXT             
444500         WHEN PS-NO-PO-RCVD-DELY-DTE                                      
444600             MOVE 'PO RCVD DELY DTE MISSING'  TO                          
444700                                        TM600-TRBL-ERROR-TEXT             
444800         WHEN PS-NO-CNTL-NBR-FOUND                                        
444900             MOVE 'NO TIMCNTL CONTROL NBR FOUND' TO                       
445000                                        TM600-TRBL-ERROR-TEXT             
445100         WHEN PS-NO-TIMCNTK-PKUP-DATE                                     
445200             MOVE 'NO CONTAINER PKUP DATE FOUND' TO                       
445300                                        TM600-TRBL-ERROR-TEXT             
445400         WHEN PS-NO-TIMCNTK-ATA-DATE                                      
445500             MOVE 'NO CONTAINER ATA DATE FOUND' TO                        
445600                                        TM600-TRBL-ERROR-TEXT             
445700         WHEN PS-NO-TIMCSEN-FILE-DATE                                     
445800             MOVE 'NO CUSTOMS FILING DATE FOUND' TO                       
445900                                        TM600-TRBL-ERROR-TEXT             
446000         WHEN PS-DUPLICATE-TROUBLE-EXISTS                                 
446100             MOVE 'MUST PROCESS AS A TR OR OPEN TROUBLE' TO               
446200                                        TM600-TRBL-ERROR-TEXT             
446300         WHEN PS-INVALID-POE-CDE-ERR                                      
446400             MOVE 'INVALID POE CODE ERROR'       TO                       
446500                                        TM600-TRBL-ERROR-TEXT             
446600         WHEN PS-MISSING-KEY-POE-CDE                                      
446700             MOVE 'MISSING POE KEY'           TO                          
446800                                        TM600-TRBL-ERROR-TEXT             
446900         WHEN PS-NO-EST-DPRTR-DTE                                         
447000             MOVE 'MISSING EST DPRTR DTE'     TO                          
447100                                        TM600-TRBL-ERROR-TEXT             
447200         WHEN PS-ACTVY-RSLU-CDE-ERROR                                     
447300             MOVE 'CANNOT RESOLVE W/OUT RSLU CD' TO                       
447400                                        TM600-TRBL-ERROR-TEXT             
447500         WHEN PS-INVALID-DATE-WAS-USED                                    
447600             MOVE 'INVALID DATE WAS USED'     TO                          
447700                                        TM600-TRBL-ERROR-TEXT             
447800     END-EVALUATE.                                                        
447900                                                                          
448000******************************************************************        
448100* INSERT A ROW INTO THE DB2 PROCESSING WORK TABLE (TOUTTM2).     *        
448200******************************************************************        
448300 7000-INSERT-TOUTTM2-RPT.                                                 
448400                                                                          
448500     PERFORM                                                              
448600         WITH TEST AFTER                                                  
448700         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
448800         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
448900                 SQLCODE = ZERO                                           
449000                                                                          
449100       EXEC SQL                                                           
449200          INSERT INTO TOUTTM2                                             
449300             (TRBL_RPT_PAR_1_ODR,                                         
449400              TRBL_RPT_PAR_2_ODR)                                         
449500            VALUES  (:OUTTM2-TRBL-RPT-PAR-1-ODR,                          
449600                     :OUTTM2-TRBL-RPT-PAR-2-ODR)                          
449700       END-EXEC                                                           
449800                                                                          
449900         EVALUATE TRUE                                                    
450000             WHEN SQLCODE = ZERO                                          
450100                 CONTINUE                                                 
450200                                                                          
450300                 WHEN SQLCODE = -911                                      
450400                 WHEN SQLCODE = -913                                      
450500                 WHEN SQLCODE = -904                                      
450600                     CONTINUE                                             
450700                                                                          
450800             WHEN SQLWARN0 NOT EQUAL SPACE                                
450900             WHEN SQLCODE NOT EQUAL ZERO                                  
451000                 DISPLAY '**************************************'         
451100                 DISPLAY '** ABEND                            **'         
451200                 DISPLAY '** PROGRAM = TMKUP625               **'         
451300                 DISPLAY '*PARAGRAPH = 7000-INSERT-TOUTTM2-RPT**'         
451400                 DISPLAY '** INSERT INTO TOUTTM2              **'         
451500                 DISPLAY '** PO NUMBER     = ' TM606-PO-NBR               
451600                 DISPLAY '**************************************'         
451700                 PERFORM 9100-SQL-ABEND                                   
451800         END-EVALUATE                                                     
451900     END-PERFORM.                                                         
452000                                                                          
452100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
452200         (SQLCODE NOT = ZERO)                                             
452300        DISPLAY '****************************************'                
452400        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'                
452500        DISPLAY '** INSERT TO TOUTTM2                  **'                
452600        DISPLAY '** PARAGRAPH = 7000-INSERT-TOUTTM2-RPT**'                
452700        DISPLAY '** PO NUMBER     = ' TM606-PO-NBR                        
452800        DISPLAY '****************************************'                
452900      PERFORM 9100-SQL-ABEND                                              
453000     END-IF.                                                              
453100                                                                          
453200 EJECT                                                                    
453300******************************************************************        
453400* OPEN THE PO EXTRACT CURSOR.                                    *        
453500******************************************************************        
453600 7005-OPEN-PO-EXTRACT-CURSOR.                                             
453700                                                                          
453800     EXEC SQL                                                             
453900          OPEN PO_EXTRACT_CUR                                             
454000     END-EXEC.                                                            
454100                                                                          
454200     EVALUATE TRUE                                                        
454300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
454400         WHEN SQLCODE NOT EQUAL ZERO                                      
454500             DISPLAY '** ABEND                       **'                  
454600             DISPLAY '** PROGRAM = TMKUP625          **'                  
454700             DISPLAY '** PARAGRAPH =                 **'                  
454800             DISPLAY '**  7005-OPEN-PO-EXTRACT-CURSOR**'                  
454900             PERFORM 9100-SQL-ABEND                                       
455000     END-EVALUATE.                                                        
455100                                                                          
455200******************************************************************        
455300* CLOSE THE PO EXTRACT CURSOR.                                   *        
455400******************************************************************        
455500 7010-CLOSE-PO-EXTRACT-CURSOR.                                            
455600                                                                          
455700     EXEC SQL                                                             
455800         CLOSE PO_EXTRACT_CUR                                             
455900     END-EXEC.                                                            
456000                                                                          
456100     EVALUATE TRUE                                                        
456200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
456300         WHEN SQLCODE NOT EQUAL ZERO                                      
456400             DISPLAY '** ABEND                         **'                
456500             DISPLAY '** PROGRAM   = TMKUP625          **'                
456600             DISPLAY '** PARAGRAPH =                   **'                
456700             DISPLAY '**  7010-CLOSE-PO-EXTRACT-CURSOR **'                
456800             PERFORM 9100-SQL-ABEND                                       
456900     END-EVALUATE.                                                        
457000                                                                          
457100******************************************************************        
457200* FETCH THE PO EXTRACT CURSOR                                    *        
457300******************************************************************        
457400 7015-FETCH-PO-EXTRACT-CURSOR.                                            
457500                                                                          
457600     EXEC SQL                                                             
457700          FETCH PO_EXTRACT_CUR                                            
457800              INTO :OUTTM1-PO-NBR,                                        
457900                   :OUTTM1-TRBL-ODR,                                      
458000                   :OUTTM1-TRBL-TMST-ODR                                  
458100     END-EXEC.                                                            
458200                                                                          
458300     EVALUATE TRUE                                                        
458400         WHEN SQLCODE = ZERO                                              
458500              SET PS-EOC-PO-EXTRACT-CURSOR-NO TO TRUE                     
458600              ADD +1 TO PV-IMCNTL-CNTL-ID                                 
458700              ADD +1 TO PA-TOT-PO-RECS-READ                               
458800              ADD +1 TO PV-PO-INPUT-COUNT                                 
458900                                                                          
459000         WHEN SQLCODE = +100                                              
459100              SET PS-EOC-PO-EXTRACT-CURSOR    TO TRUE                     
459200                                                                          
459300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
459400         WHEN SQLCODE NOT EQUAL ZERO                                      
459500             DISPLAY '** ABEND                         **'                
459600             DISPLAY '** PROGRAM   = TMKUP625          **'                
459700             DISPLAY '** PARAGRAPH =                   **'                
459800             DISPLAY '**  7015-FETCH-PO-EXTRACT-CURSOR **'                
459900             PERFORM 9100-SQL-ABEND                                       
460000     END-EVALUATE.                                                        
460100                                                                          
460200 EJECT                                                                    
460300******************************************************************        
460400* OPEN THE TROUBLE CONTROL TABLE CURSOR.                         *        
460500******************************************************************        
460600 7020-OPEN-TRBL-CONTROL-CURSOR.                                           
460700                                                                          
460800     EXEC SQL                                                             
460900          OPEN TRBL_CONTROL_CUR                                           
461000     END-EXEC.                                                            
461100                                                                          
461200     EVALUATE TRUE                                                        
461300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
461400         WHEN SQLCODE NOT EQUAL ZERO                                      
461500             DISPLAY '** ABEND                         **'                
461600             DISPLAY '** PROGRAM = TMKUP625            **'                
461700             DISPLAY '** PARAGRAPH =                   **'                
461800             DISPLAY '**  7020-OPEN-TRBL-CONTROL-CURSOR**'                
461900             PERFORM 9100-SQL-ABEND                                       
462000     END-EVALUATE.                                                        
462100                                                                          
462200******************************************************************        
462300* CLOSE THE TROUBLE CONTROL TABLE CURSOR.                        *        
462400******************************************************************        
462500 7025-CLOSE-TRBL-CONTROL-CURSOR.                                          
462600                                                                          
462700     EXEC SQL                                                             
462800         CLOSE TRBL_CONTROL_CUR                                           
462900     END-EXEC.                                                            
463000                                                                          
463100     EVALUATE TRUE                                                        
463200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
463300         WHEN SQLCODE NOT EQUAL ZERO                                      
463400             DISPLAY '** ABEND                          **'               
463500             DISPLAY '** PROGRAM   = TMKUP625           **'               
463600             DISPLAY '** PARAGRAPH =                    **'               
463700             DISPLAY '**  7025-CLOSE-TRBL-CONTROL-CURSOR**'               
463800             PERFORM 9100-SQL-ABEND                                       
463900     END-EVALUATE.                                                        
464000                                                                          
464100******************************************************************        
464200* FETCH THE TROUBLE CONTROL TABLE CURSOR.                        *        
464300******************************************************************        
464400 7030-FETCH-TRBL-CONTROL-CURSOR.                                          
464500                                                                          
464600     EXEC SQL                                                             
464700          FETCH TRBL_CONTROL_CUR                                          
464800              INTO :IMTBCT-TRBL-RSN-CDE,                                  
464900                   :IMTBCT-BEG-LMT-DAY-QTY,                               
465000                   :IMTBCT-END-LMT-DAY-QTY,                               
465100                   :IMTBCT-BEG-LMT-PCT,                                   
465200                   :IMTBCT-END-LMT-PCT,                                   
465300                   :IMTBCT-INITR-ID,                                      
465400                   :IMTBCT-PFMC-TRKG-ID,                                  
465500                   :IMTBCT-TRIP-OCEN-IND,                                 
465600                   :IMTBCT-TRIP-AIR-IND,                                  
465700                   :IMTBCT-TRIP-TRLR-IND,                                 
465800                   :IMTBCT-TRBL-CNTL-TYP-CDE                              
465900     END-EXEC.                                                            
466000                                                                          
466100     EVALUATE TRUE                                                        
466200         WHEN SQLCODE = ZERO                                              
466300              SET PS-GOOD-TRBL-CNTL-FETCH TO TRUE                         
466400              SET PS-EOC-TRBL-CONTROL-CURSOR-NO TO TRUE                   
466500                                                                          
466600         WHEN SQLCODE = +100                                              
466700              SET PS-EOC-TRBL-CONTROL-CURSOR    TO TRUE                   
466800              MOVE ZEROES TO PV-CURR-TRBL-RSN                             
466900                                                                          
467000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
467100         WHEN SQLCODE NOT EQUAL ZERO                                      
467200             DISPLAY '** ABEND                          **'               
467300             DISPLAY '** PROGRAM   = TMKUP625           **'               
467400             DISPLAY '** PARAGRAPH =                    **'               
467500             DISPLAY '**  7030-FETCH-TRBL-CONTROL-CURSOR**'               
467600             PERFORM 9100-SQL-ABEND                                       
467700     END-EVALUATE.                                                        
467800                                                                          
467900 EJECT                                                                    
468000******************************************************************        
468100* OPEN THE APPLICATION RULE CURSOR.                              *        
468200******************************************************************        
468300 7035-OPEN-APPL-RULE-CURSOR.                                              
468400                                                                          
468500     EXEC SQL                                                             
468600          OPEN APPL_RULE_CUR                                              
468700     END-EXEC.                                                            
468800                                                                          
468900     EVALUATE TRUE                                                        
469000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
469100         WHEN SQLCODE NOT EQUAL ZERO                                      
469200             DISPLAY '** ABEND                        **'                 
469300             DISPLAY '** PROGRAM = TMKUP625           **'                 
469400             DISPLAY '** PARAGRAPH =                  **'                 
469500             DISPLAY '**  7035-OPEN-APPL-RULE-CURSOR  **'                 
469600             PERFORM 9100-SQL-ABEND                                       
469700     END-EVALUATE.                                                        
469800                                                                          
469900******************************************************************        
470000* CLOSE THE APPLICATION RULE CURSOR.                             *        
470100******************************************************************        
470200 7040-CLOSE-APPL-RULE-CURSOR.                                             
470300                                                                          
470400     EXEC SQL                                                             
470500         CLOSE APPL_RULE_CUR                                              
470600     END-EXEC.                                                            
470700                                                                          
470800     EVALUATE TRUE                                                        
470900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
471000         WHEN SQLCODE NOT EQUAL ZERO                                      
471100             DISPLAY '** ABEND                         **'                
471200             DISPLAY '** PROGRAM   = TMKUP625          **'                
471300             DISPLAY '** PARAGRAPH =                   **'                
471400             DISPLAY '**  7040-CLOSE-APPL-RULE-CURSOR  **'                
471500             PERFORM 9100-SQL-ABEND                                       
471600     END-EVALUATE.                                                        
471700                                                                          
471800******************************************************************        
471900* FETCH THE APPLICATION RULE CURSOR.                             *        
472000******************************************************************        
472100 7045-FETCH-APPL-RULE-CURSOR.                                             
472200                                                                          
472300     EXEC SQL                                                             
472400          FETCH APPL_RULE_CUR                                             
472500              INTO :TBAPRL-TRBL-RSN-CDE,                                  
472600                   :TBAPRL-RUL-SEQ-NBR,                                   
472700                   :TBAPRL-RUL-CDE,                                       
472800                   :TBAPRL-SRC-PRCG-APPL-CDE,                             
472900                   :TBAPRL-RSPNB-RSLU-ID,                                 
473000                   :TBAPRL-ACTVY-RSLU-CDE,                                
473100                   :TBAPRL-RUL-DATYP-RET-CDE,                             
473200                   :TBAPRL-RUL-CND-IND,                                   
473300                   :TBAPRL-RUL-CND-PRC-CDE,                               
473400                   :ICDMST-CDE-EFF-STRT-DTE,                              
473500                   :ICDMST-CDE-EFF-END-DTE,                               
473600                   :ICDVAL-CDVL-DESC                                      
473700     END-EXEC.                                                            
473800                                                                          
473900     EVALUATE TRUE                                                        
474000         WHEN SQLCODE = ZERO                                              
474100              SET PS-GOOD-APPL-RULE-FETCH    TO TRUE                      
474200              SET PS-EOC-APPL-RULE-CURSOR-NO TO TRUE                      
474300                                                                          
474400         WHEN SQLCODE = +100                                              
474500              SET PS-EOC-APPL-RULE-CURSOR    TO TRUE                      
474600                                                                          
474700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
474800         WHEN SQLCODE NOT EQUAL ZERO                                      
474900             DISPLAY '** ABEND                         **'                
475000             DISPLAY '** PROGRAM   = TMKUP625          **'                
475100             DISPLAY '** PARAGRAPH =                   **'                
475200             DISPLAY '**  7045-FETCH-APPL-RULE-CURSOR  **'                
475300             PERFORM 9100-SQL-ABEND                                       
475400     END-EVALUATE.                                                        
475500                                                                          
475600 EJECT                                                                    
475700******************************************************************        
475800* SELECT A ROW FROM THE IMPORT BOOKING PURCHASE ORDER TABLE      *        
475900* (TIMBKPO).  A -811 SQLCODE MUST BE CHECKED IN THE RETRY LOGIC  *        
476000* BECAUSE THERE ARE NESTED SQL STATEMENTS THAT ARE PERFORMED.    *        
476100******************************************************************        
476200 7050-SELECT-TIMBKPO.                                                     
476300                                                                          
476400     PERFORM                                                              
476500         WITH TEST AFTER                                                  
476600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
476700         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
476800                 SQLCODE = ZERO                     OR                    
476900                 SQLCODE = +100                     OR                    
477000                 SQLCODE = -811                                           
477100                                                                          
477200         EXEC SQL                                                         
477300             SELECT FOB_CDE,                                              
477400                    TRIP_TYP_CDE,                                         
477500                    PO_UNT_QTY,                                           
477600                    ORGN_SHPD_FR_CDE,                                     
477700                    EXTL_REF_NBR                                          
477800              INTO :PV-FOB-CDE,                                           
477900                   :PV-TRIP-TYP-CDE,                                      
478000                   :IMBKPO-PO-UNT-QTY,                                    
478100                   :IMBKPO-ORGN-SHPD-FR-CDE,                              
478200                   :IMBKPO-EXTL-REF-NBR                                   
478300                                                                          
478400               FROM TIMBKPO                                               
478500              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
478600                AND DATE(PO_BKG_DELY_TMST)                                
478700                                     = :TM602-PO-BKG-DELY-DTE             
478800                AND PO_BKG_SEQ_NBR   = :PV-BKG-SEQ-NBR                    
478900         END-EXEC                                                         
479000                                                                          
479100         EVALUATE TRUE                                                    
479200             WHEN SQLCODE = ZERO                                          
479300                 MOVE IMBKPO-PO-UNT-QTY TO                                
479400                                        TM602-IMBKPO-PO-UNT-QTY           
479500                 IF PV-FOB-CDE      = SPACES                              
479600                     SET PS-EMPTY-KEY-FIELDS TO TRUE                      
479700                 ELSE                                                     
479800                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
479900                     IF PS-INVALID-FOB-CDE                                
480000                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
480100                         SET PS-INVALID-FOB-CDE-TIMBKPO TO TRUE           
480200                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
480300                     END-IF                                               
480400                                                                          
480500                     IF PS-CONSLR-BLANK                                   
480600                         SET PS-MISSING-KEY-ENTID TO TRUE                 
480700                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
480800                     END-IF                                               
480900                 END-IF                                                   
481000                                                                          
481100                 IF IMBKPO-EXTL-REF-NBR = SPACES                          
481200                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
481300                 ELSE                                                     
481400                    MOVE IMBKPO-EXTL-REF-NBR                              
481500                               TO PV-EXTL-REF-NBR                         
481600                 END-IF                                                   
481700                                                                          
481800             WHEN SQLCODE = +100                                          
481900                 SET PS-EMPTY-KEY-FIELDS  TO TRUE                         
482000                                                                          
482100                 WHEN SQLCODE = -911                                      
482200                 WHEN SQLCODE = -913                                      
482300                 WHEN SQLCODE = -904                                      
482400                     CONTINUE                                             
482500                                                                          
482600             WHEN SQLWARN0 NOT EQUAL SPACE                                
482700             WHEN SQLCODE NOT EQUAL ZERO                                  
482800                 DISPLAY '**************************************'         
482900                 DISPLAY '** ABEND                            **'         
483000                 DISPLAY '** PROGRAM = TMKUP625               **'         
483100                 DISPLAY '** PARAGRAPH = 7050-SELECT-TIMBKPO  **'         
483200                 DISPLAY '** SELECT TIMBKPO                   **'         
483300                 DISPLAY '** PO NUMBER       = '                          
483400                 DISPLAY            PV-KEY-PO-NBR                         
483500                 DISPLAY '** PO BKG SEQ NBR  = '                          
483600                 DISPLAY            PV-BKG-SEQ-NBR                        
483700                 DISPLAY '** PO BKG DELY DTE = '                          
483800                 DISPLAY            TM602-PO-BKG-DELY-DTE                 
483900                 DISPLAY '**************************************'         
484000                 PERFORM 9100-SQL-ABEND                                   
484100         END-EVALUATE                                                     
484200     END-PERFORM.                                                         
484300                                                                          
484400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
484500         (SQLCODE NOT = ZERO AND                                          
484600          SQLCODE NOT = +100 AND                                          
484700          SQLCODE NOT = -811)                                             
484800         DISPLAY '****************************************'               
484900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
485000         DISPLAY '** SELECT FROM TIMBKPO                **'               
485100         DISPLAY '** PARAGRAPH = 7050-SELECT-TIMBKPO    **'               
485200         DISPLAY '** PO NUMBER       = ' PV-KEY-PO-NBR                    
485300         DISPLAY '** PO BKG SEQ NBR  = ' PV-BKG-SEQ-NBR                   
485400         DISPLAY '** PO BKG DELY DTE = ' TM602-PO-BKG-DELY-DTE            
485500         DISPLAY '****************************************'               
485600         PERFORM 9100-SQL-ABEND                                           
485700     END-IF.                                                              
485800                                                                          
485900 EJECT                                                                    
486000******************************************************************        
486100* SELECT A ROW FROM THE IMPORT AUDIT BOOKING PURCHASE ORCER TABLE*        
486200* (TAUBKPO).                                                     *        
486300******************************************************************        
486400 7052-SELECT-TAUBKPO.                                                     
486500                                                                          
486600     PERFORM                                                              
486700         WITH TEST AFTER                                                  
486800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
486900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
487000                 SQLCODE = ZERO                     OR                    
487100                 SQLCODE = +100                     OR                    
487200                 SQLCODE = -811                                           
487300                                                                          
487400         EXEC SQL                                                         
487500             SELECT FOB_CDE,                                              
487600                    TRIP_TYP_CDE,                                         
487700                    PO_UNT_QTY,                                           
487800                    ORGN_SHPD_FR_CDE,                                     
487900                    EXTL_REF_NBR                                          
488000              INTO :PV-FOB-CDE,                                           
488100                   :PV-TRIP-TYP-CDE,                                      
488200                   :AUBKPO-PO-UNT-QTY,                                    
488300                   :AUBKPO-ORGN-SHPD-FR-CDE,                              
488400                   :AUBKPO-EXTL-REF-NBR                                   
488500                                                                          
488600               FROM TAUBKPO                                               
488700              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
488800                AND DATE(PO_BKG_DELY_TMST)                                
488900                                     = :TM602-PO-BKG-DELY-DTE             
489000                AND PO_BKG_SEQ_NBR   = :PV-BKG-SEQ-NBR                    
489100                AND AUD_FUNC_CDE     = :PC-D                              
489200         END-EXEC                                                         
489300                                                                          
489400         EVALUATE TRUE                                                    
489500             WHEN SQLCODE = ZERO                                          
489600             WHEN SQLCODE = -811                                          
489700                 MOVE AUBKPO-PO-UNT-QTY TO                                
489800                                        TM602-IMBKPO-PO-UNT-QTY           
489900                 MOVE AUBKPO-ORGN-SHPD-FR-CDE TO                          
490000                                        IMBKPO-ORGN-SHPD-FR-CDE           
490100                 IF PV-FOB-CDE      = SPACES                              
490200                     SET PS-EMPTY-KEY-FIELDS  TO TRUE                     
490300                 ELSE                                                     
490400                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
490500                     IF PS-INVALID-FOB-CDE                                
490600                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
490700                         SET PS-INVALID-FOB-CDE-TAUBKPO TO TRUE           
490800                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
490900                     END-IF                                               
491000                                                                          
491100                     IF PS-CONSLR-BLANK                                   
491200                         SET PS-MISSING-KEY-ENTID TO TRUE                 
491300                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
491400                     END-IF                                               
491500                 END-IF                                                   
491600                                                                          
491700                 IF AUBKPO-EXTL-REF-NBR = SPACES                          
491800                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
491900                 ELSE                                                     
492000                    MOVE AUBKPO-EXTL-REF-NBR                              
492100                               TO PV-EXTL-REF-NBR                         
492200                 END-IF                                                   
492300                                                                          
492400             WHEN SQLCODE = +100                                          
492500                 SET PS-EMPTY-KEY-FIELDS  TO TRUE                         
492600                                                                          
492700                 WHEN SQLCODE = -911                                      
492800                 WHEN SQLCODE = -913                                      
492900                 WHEN SQLCODE = -904                                      
493000                     CONTINUE                                             
493100                                                                          
493200             WHEN SQLWARN0 NOT EQUAL SPACE                                
493300             WHEN SQLCODE NOT EQUAL ZERO                                  
493400                 DISPLAY '**************************************'         
493500                 DISPLAY '** ABEND                            **'         
493600                 DISPLAY '** PROGRAM = TMKUP625               **'         
493700                 DISPLAY '** PARAGRAPH = 7052-SELECT-TAUBKPO  **'         
493800                 DISPLAY '** SELECT TIMBKPO                   **'         
493900                 DISPLAY '** PO NUMBER       = '                          
494000                 DISPLAY            PV-KEY-PO-NBR                         
494100                 DISPLAY '** PO BKG SEQ NBR  = '                          
494200                 DISPLAY            PV-BKG-SEQ-NBR                        
494300                 DISPLAY '** PO BKG DELY DTE = '                          
494400                 DISPLAY            TM602-PO-BKG-DELY-DTE                 
494500                 DISPLAY '**************************************'         
494600                 PERFORM 9100-SQL-ABEND                                   
494700         END-EVALUATE                                                     
494800     END-PERFORM.                                                         
494900                                                                          
495000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
495100         (SQLCODE NOT = ZERO AND                                          
495200          SQLCODE NOT = +100 AND                                          
495300          SQLCODE NOT = -811)                                             
495400         DISPLAY '****************************************'               
495500         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
495600         DISPLAY '** SELECT FROM TIMBKPO                **'               
495700         DISPLAY '** PARAGRAPH = 7052-SELECT-TAUBKPO    **'               
495800         DISPLAY '** PO NUMBER       = ' PV-KEY-PO-NBR                    
495900         DISPLAY '** PO BKG SEQ NBR  = ' PV-BKG-SEQ-NBR                   
496000         DISPLAY '** PO BKG DELY DTE = ' TM602-PO-BKG-DELY-DTE            
496100         DISPLAY '****************************************'               
496200         PERFORM 9100-SQL-ABEND                                           
496300     END-IF.                                                              
496400                                                                          
496500 EJECT                                                                    
496600******************************************************************        
496700* SELECT A ROW FROM THE PLANED SHIPMENT TABLE (TPLNSHP).         *        
496800******************************************************************        
496900 7055-SELECT-TPLNSHP-FOB.                                                 
497000                                                                          
497100     PERFORM                                                              
497200         WITH TEST AFTER                                                  
497300         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
497400         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
497500                 SQLCODE = ZERO                     OR                    
497600                 SQLCODE = +100                     OR                    
497700                 SQLCODE = -811                                           
497800                                                                          
497900         EXEC SQL                                                         
498000             SELECT FOB_CDE                                               
498100              INTO :PV-FOB-CDE                                            
498200                                                                          
498300               FROM TPLNSHP                                               
498400              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
498500               AND  VER_STATUS_CDE   = :PC-A                              
498600         END-EXEC                                                         
498700                                                                          
498800         EVALUATE TRUE                                                    
498900             WHEN SQLCODE = ZERO                                          
499000             WHEN SQLCODE = -811                                          
499100                 IF PV-FOB-CDE = SPACES                                   
499200                     SET PS-EMPTY-KEY-FIELDS  TO TRUE                     
499300                 ELSE                                                     
499400                     PERFORM 7155-SELECT-ENTID-TIMFOB-FOB                 
499500                     IF PS-INVALID-FOB-CDE                                
499600                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
499700                         SET PS-INVALID-FOB-CDE-TPLNSHP TO TRUE           
499800                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
499900                         SET PS-EMPTY-KEY-FIELDS    TO TRUE               
500000                     ELSE                                                 
500100                         SET PS-EMPTY-KEY-FIELDS-NO TO TRUE               
500200                     END-IF                                               
500300                 END-IF                                                   
500400                                                                          
500500             WHEN SQLCODE = +100                                          
500600                 SET PS-EMPTY-KEY-FIELDS  TO TRUE                         
500700                                                                          
500800                 WHEN SQLCODE = -911                                      
500900                 WHEN SQLCODE = -913                                      
501000                 WHEN SQLCODE = -904                                      
501100                     CONTINUE                                             
501200                                                                          
501300             WHEN SQLWARN0 NOT EQUAL SPACE                                
501400             WHEN SQLCODE NOT EQUAL ZERO                                  
501500                 DISPLAY '**************************************'         
501600                 DISPLAY '** ABEND                            **'         
501700                 DISPLAY '** PROGRAM = TMKUP625               **'         
501800                 DISPLAY '** PARAGRAPH = 7055-SELECT-TPLNSHP-FOB'         
501900                 DISPLAY '** SELECT TPLNSHP                   **'         
502000                 DISPLAY '** PO NUMBER      = ' TM606-PO-NBR              
502100                 DISPLAY '** PLNSHP VER NBR = '                           
502200                 DISPLAY                    TM606-PLNSHP-VER-NBR          
502300                 DISPLAY '**************************************'         
502400                 PERFORM 9100-SQL-ABEND                                   
502500         END-EVALUATE                                                     
502600     END-PERFORM.                                                         
502700                                                                          
502800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
502900         (SQLCODE NOT = ZERO    AND                                       
503000          SQLCODE NOT = -811    AND                                       
503100          SQLCODE NOT = +100)                                             
503200         DISPLAY '****************************************'               
503300         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
503400         DISPLAY '** SELECT FROM TPLNSHP                **'               
503500         DISPLAY '** PARAGRAPH = 7055-SELECT-TPLNSHP-FOB**'               
503600         DISPLAY '** PO NUMBER       = ' TM606-PO-NBR                     
503700         DISPLAY '** PLNSHP VER NBR  = ' TM606-PLNSHP-VER-NBR             
503800         DISPLAY '****************************************'               
503900         PERFORM 9100-SQL-ABEND                                           
504000     END-IF.                                                              
504100                                                                          
504200 EJECT                                                                    
504300******************************************************************        
504400* SELECT A ROW FROM THE PLANED SHIPMENT TABLE (TPLNSHP).         *        
504500******************************************************************        
504600 7056-SELECT-TPLNSHP-FOB-CNTR.                                            
504700                                                                          
504800     PERFORM                                                              
504900         WITH TEST AFTER                                                  
505000         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
505100         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
505200                 SQLCODE = ZERO                     OR                    
505300                 SQLCODE = +100                     OR                    
505400                 SQLCODE = -811                                           
505500                                                                          
505600         EXEC SQL                                                         
505700             SELECT FOB_CDE                                               
505800              INTO :PV-FOB-CDE                                            
505900                                                                          
506000               FROM TPLNSHP                                               
506100              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
506200               AND  VER_STATUS_CDE   = :PC-A                              
506300         END-EXEC                                                         
506400                                                                          
506500         EVALUATE TRUE                                                    
506600             WHEN SQLCODE = ZERO                                          
506700             WHEN SQLCODE = -811                                          
506800                 IF PV-FOB-CDE = SPACES                                   
506900                     SET PS-EMPTY-FOB-CDE    TO TRUE                      
507000                 ELSE                                                     
507100                     SET PS-EMPTY-FOB-CDE-NO TO TRUE                      
507200                     PERFORM 7156-SELECT-ENTID-TIMFOB-FOB                 
507300                     IF PS-INVALID-FOB-CDE                                
507400                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
507500                         SET PS-INVALID-FOB-CDE-TPLNSHP TO TRUE           
507600                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
507700                     END-IF                                               
507800                 END-IF                                                   
507900                                                                          
508000             WHEN SQLCODE = +100                                          
508100                 SET PS-EMPTY-FOB-CDE TO TRUE                             
508200                                                                          
508300                 WHEN SQLCODE = -911                                      
508400                 WHEN SQLCODE = -913                                      
508500                 WHEN SQLCODE = -904                                      
508600                     CONTINUE                                             
508700                                                                          
508800             WHEN SQLWARN0 NOT EQUAL SPACE                                
508900             WHEN SQLCODE NOT EQUAL ZERO                                  
509000                 DISPLAY '**************************************'         
509100                 DISPLAY '** ABEND                            **'         
509200                 DISPLAY '** PROGRAM = TMKUP625               **'         
509300                 DISPLAY '** PARAGRAPH = 7056-SELECT-TPLNSHP-FOB'         
509400                 DISPLAY '** SELECT TPLNSHP                   **'         
509500                 DISPLAY '** PO NUMBER      = ' TM606-PO-NBR              
509600                 DISPLAY '** PLNSHP VER NBR = '                           
509700                 DISPLAY                    TM606-PLNSHP-VER-NBR          
509800                 DISPLAY '**************************************'         
509900                 PERFORM 9100-SQL-ABEND                                   
510000         END-EVALUATE                                                     
510100     END-PERFORM.                                                         
510200                                                                          
510300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
510400         (SQLCODE NOT = ZERO    AND                                       
510500          SQLCODE NOT = -811    AND                                       
510600          SQLCODE NOT = +100)                                             
510700         DISPLAY '****************************************'               
510800         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
510900         DISPLAY '** SELECT FROM TPLNSHP                **'               
511000         DISPLAY '** PARAGRAPH = 7056-SELECT-TPLNSHP-FOB**'               
511100         DISPLAY '** PO NUMBER       = ' TM606-PO-NBR                     
511200         DISPLAY '** PLNSHP VER NBR  = ' TM606-PLNSHP-VER-NBR             
511300         DISPLAY '****************************************'               
511400         PERFORM 9100-SQL-ABEND                                           
511500     END-IF.                                                              
511600                                                                          
511700 EJECT                                                                    
511800* SELECT A ROW FROM THE PLANED SHIPMENT TABLE (TPLNSHP).         *        
511900******************************************************************        
512000 7057-SELECT-TPLNSHP-POE.                                                 
512100                                                                          
512200     PERFORM                                                              
512300         WITH TEST AFTER                                                  
512400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
512500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
512600                 SQLCODE = ZERO                     OR                    
512700                 SQLCODE = +100                     OR                    
512800                 SQLCODE = -811                                           
512900                                                                          
513000         EXEC SQL                                                         
513100             SELECT POE_CDE                                               
513200              INTO :PV-POE-CDE                                            
513300                                                                          
513400               FROM TPLNSHP                                               
513500              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
513600               AND  VER_STATUS_CDE   = :PC-A                              
513700         END-EXEC                                                         
513800                                                                          
513900         EVALUATE TRUE                                                    
514000             WHEN SQLCODE = ZERO                                          
514100             WHEN SQLCODE = -811                                          
514200                 IF PV-POE-CDE = SPACES                                   
514300                     SET PS-EMPTY-POE-CDE    TO TRUE                      
514400                 ELSE                                                     
514500                     SET PS-EMPTY-POE-CDE-NO TO TRUE                      
514600                     PERFORM 7157-SELECT-ENTID-TIMPOE-POE                 
514700                 END-IF                                                   
514800                                                                          
514900             WHEN SQLCODE = +100                                          
515000                 SET PS-EMPTY-POE-CDE        TO TRUE                      
515100                                                                          
515200                 WHEN SQLCODE = -911                                      
515300                 WHEN SQLCODE = -913                                      
515400                 WHEN SQLCODE = -904                                      
515500                     CONTINUE                                             
515600                                                                          
515700             WHEN SQLWARN0 NOT EQUAL SPACE                                
515800             WHEN SQLCODE NOT EQUAL ZERO                                  
515900                 DISPLAY '**************************************'         
516000                 DISPLAY '** ABEND                            **'         
516100                 DISPLAY '** PROGRAM = TMKUP625               **'         
516200                 DISPLAY '** PARAGRAPH = 7057-SELECT-TPLNSHP-POE'         
516300                 DISPLAY '** SELECT TPLNSHP                   **'         
516400                 DISPLAY '** PO NUMBER      = ' TM606-PO-NBR              
516500                 DISPLAY '** PLNSHP VER NBR = '                           
516600                 DISPLAY                    TM606-PLNSHP-VER-NBR          
516700                 DISPLAY '**************************************'         
516800                 PERFORM 9100-SQL-ABEND                                   
516900         END-EVALUATE                                                     
517000     END-PERFORM.                                                         
517100                                                                          
517200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
517300         (SQLCODE NOT = ZERO    AND                                       
517400          SQLCODE NOT = -811    AND                                       
517500          SQLCODE NOT = +100)                                             
517600         DISPLAY '****************************************'               
517700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
517800         DISPLAY '** SELECT FROM TPLNSHP                **'               
517900         DISPLAY '** PARAGRAPH = 7057-SELECT-TPLNSHP-POE**'               
518000         DISPLAY '** PO NUMBER       = ' TM606-PO-NBR                     
518100         DISPLAY '** PLNSHP VER NBR  = ' TM606-PLNSHP-VER-NBR             
518200         DISPLAY '****************************************'               
518300         PERFORM 9100-SQL-ABEND                                           
518400     END-IF.                                                              
518500                                                                          
518600 EJECT                                                                    
518700******************************************************************        
518800* SELECT A ROW FROM THE IMPORT RECEIVING PURCHASE ORDER TABLE    *        
518900* (TIMRCPO).  A -811 SQLCODE MUST BE CHECKED IN THE RETRY LOGIC  *        
519000* BECAUSE THERE ARE NESTED SQL STATEMENTS THAT ARE PERFORMED.    *        
519100******************************************************************        
519200 7060-SELECT-TIMRCPO.                                                     
519300                                                                          
519400     PERFORM                                                              
519500         WITH TEST AFTER                                                  
519600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
519700         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
519800                 SQLCODE = ZERO                     OR                    
519900                 SQLCODE = +100                     OR                    
520000                 SQLCODE = -811                                           
520100                                                                          
520200         EXEC SQL                                                         
520300             SELECT FOB_CDE,                                              
520400                    TRIP_TYP_CDE,                                         
520500                    PO_UNT_QTY,                                           
520600                    ORGN_SHPD_FR_CDE,                                     
520700                    EXTL_REF_NBR                                          
520800              INTO :PV-FOB-CDE,                                           
520900                   :PV-TRIP-TYP-CDE,                                      
521000                   :IMRCPO-PO-UNT-QTY,                                    
521100                   :IMRCPO-ORGN-SHPD-FR-CDE,                              
521200                   :IMRCPO-EXTL-REF-NBR                                   
521300                                                                          
521400               FROM TIMRCPO                                               
521500              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
521600                AND DATE(PO_RCVD_DELY_TMST)                               
521700                                     = :TM602-PO-RCVD-DELY-DTE            
521800                AND PO_RCVD_SEQ_NBR   = :PV-RCVD-SEQ-NBR                  
521900         END-EXEC                                                         
522000                                                                          
522100         EVALUATE TRUE                                                    
522200             WHEN SQLCODE = ZERO                                          
522300                 MOVE IMRCPO-PO-UNT-QTY TO                                
522400                                        TM602-IMRCPO-PO-UNT-QTY           
522500                 IF PV-FOB-CDE      = SPACES                              
522600                     SET PS-EMPTY-KEY-FIELDS TO TRUE                      
522700                 ELSE                                                     
522800                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
522900                     IF PS-INVALID-FOB-CDE                                
523000                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
523100                         SET PS-INVALID-FOB-CDE-TIMRCPO TO TRUE           
523200                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
523300                     END-IF                                               
523400                                                                          
523500                     IF PS-CONSLR-BLANK                                   
523600                         SET PS-MISSING-KEY-ENTID TO TRUE                 
523700                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
523800                     END-IF                                               
523900                 END-IF                                                   
524000                                                                          
524100                 IF IMRCPO-EXTL-REF-NBR = SPACES                          
524200                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
524300                 ELSE                                                     
524400                    MOVE IMRCPO-EXTL-REF-NBR                              
524500                               TO PV-EXTL-REF-NBR                         
524600                 END-IF                                                   
524700                                                                          
524800             WHEN SQLCODE = +100                                          
524900                 SET PS-EMPTY-KEY-FIELDS  TO TRUE                         
525000                                                                          
525100                 WHEN SQLCODE = -911                                      
525200                 WHEN SQLCODE = -913                                      
525300                 WHEN SQLCODE = -904                                      
525400                     CONTINUE                                             
525500                                                                          
525600             WHEN SQLWARN0 NOT EQUAL SPACE                                
525700             WHEN SQLCODE NOT EQUAL ZERO                                  
525800                 DISPLAY '**************************************'         
525900                 DISPLAY '** ABEND                            **'         
526000                 DISPLAY '** PROGRAM = TMKUP625               **'         
526100                 DISPLAY '** PARAGRAPH = 7060-SELECT-TIMRCPO  **'         
526200                 DISPLAY '** SELECT TIMRCPO                   **'         
526300                 DISPLAY '** PO NUMBER       = '                          
526400                 DISPLAY            PV-KEY-PO-NBR                         
526500                 DISPLAY '** PO RCVD SEQ NBR  = '                         
526600                 DISPLAY            PV-RCVD-SEQ-NBR                       
526700                 DISPLAY '** PO RCVD DELY DTE = '                         
526800                 DISPLAY            TM602-PO-RCVD-DELY-DTE                
526900                 DISPLAY '**************************************'         
527000                 PERFORM 9100-SQL-ABEND                                   
527100         END-EVALUATE                                                     
527200     END-PERFORM.                                                         
527300                                                                          
527400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
527500         (SQLCODE NOT = ZERO AND                                          
527600          SQLCODE NOT = +100 AND                                          
527700          SQLCODE NOT = -811)                                             
527800         DISPLAY '****************************************'               
527900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
528000         DISPLAY '** SELECT FROM TIMRCPO                **'               
528100         DISPLAY '** PARAGRAPH = 7060-SELECT-TIMRCPO    **'               
528200         DISPLAY '** PO NUMBER        = ' PV-KEY-PO-NBR                   
528300         DISPLAY '** PO RCVD SEQ NBR  = ' PV-RCVD-SEQ-NBR                 
528400         DISPLAY '** PO RCVD DELY DTE = ' TM602-PO-RCVD-DELY-DTE          
528500         DISPLAY '****************************************'               
528600         PERFORM 9100-SQL-ABEND                                           
528700     END-IF.                                                              
528800                                                                          
528900 EJECT                                                                    
529000******************************************************************        
529100* SELECT A ROW FROM THE IMPORT AUDIT RECEIVING PURCHASE ORDER    *        
529200* TABLE  (TAURCPO).                                              *        
529300******************************************************************        
529400 7062-SELECT-TAURCPO.                                                     
529500                                                                          
529600     PERFORM                                                              
529700         WITH TEST AFTER                                                  
529800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
529900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
530000                 SQLCODE = ZERO                     OR                    
530100                 SQLCODE = +100                     OR                    
530200                 SQLCODE = -811                                           
530300                                                                          
530400         EXEC SQL                                                         
530500             SELECT FOB_CDE,                                              
530600                    TRIP_TYP_CDE,                                         
530700                    PO_UNT_QTY,                                           
530800                    ORGN_SHPD_FR_CDE,                                     
530900                    EXTL_REF_NBR                                          
531000              INTO :PV-FOB-CDE,                                           
531100                   :PV-TRIP-TYP-CDE,                                      
531200                   :AURCPO-PO-UNT-QTY,                                    
531300                   :AURCPO-ORGN-SHPD-FR-CDE,                              
531400                   :AURCPO-EXTL-REF-NBR                                   
531500                                                                          
531600               FROM TAURCPO                                               
531700              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
531800                AND DATE(PO_RCVD_DELY_TMST)                               
531900                                     = :TM602-PO-RCVD-DELY-DTE            
532000                AND PO_RCVD_SEQ_NBR   = :PV-RCVD-SEQ-NBR                  
532100                AND AUD_FUNC_CDE     = :PC-D                              
532200         END-EXEC                                                         
532300                                                                          
532400         EVALUATE TRUE                                                    
532500             WHEN SQLCODE = ZERO                                          
532600             WHEN SQLCODE = -811                                          
532700                 MOVE AURCPO-PO-UNT-QTY TO                                
532800                                        TM602-IMRCPO-PO-UNT-QTY           
532900                 MOVE AURCPO-ORGN-SHPD-FR-CDE TO                          
533000                                        IMRCPO-ORGN-SHPD-FR-CDE           
533100                 IF PV-FOB-CDE      = SPACES                              
533200                     SET PS-EMPTY-KEY-FIELDS  TO TRUE                     
533300                 ELSE                                                     
533400                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
533500                     IF PS-INVALID-FOB-CDE                                
533600                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
533700                         SET PS-INVALID-FOB-CDE-TAURCPO TO TRUE           
533800                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
533900                     END-IF                                               
534000                                                                          
534100                     IF PS-CONSLR-BLANK                                   
534200                         SET PS-MISSING-KEY-ENTID TO TRUE                 
534300                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
534400                     END-IF                                               
534500                 END-IF                                                   
534600                                                                          
534700                 IF AURCPO-EXTL-REF-NBR = SPACES                          
534800                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
534900                 ELSE                                                     
535000                    MOVE AURCPO-EXTL-REF-NBR                              
535100                               TO PV-EXTL-REF-NBR                         
535200                 END-IF                                                   
535300                                                                          
535400             WHEN SQLCODE = +100                                          
535500                 SET PS-EMPTY-KEY-FIELDS  TO TRUE                         
535600                                                                          
535700                 WHEN SQLCODE = -911                                      
535800                 WHEN SQLCODE = -913                                      
535900                 WHEN SQLCODE = -904                                      
536000                     CONTINUE                                             
536100                                                                          
536200             WHEN SQLWARN0 NOT EQUAL SPACE                                
536300             WHEN SQLCODE NOT EQUAL ZERO                                  
536400                 DISPLAY '**************************************'         
536500                 DISPLAY '** ABEND                            **'         
536600                 DISPLAY '** PROGRAM = TMKUP625               **'         
536700                 DISPLAY '** PARAGRAPH = 7062-SELECT-TAURCPO  **'         
536800                 DISPLAY '** SELECT TIMRCPO                   **'         
536900                 DISPLAY '** PO NUMBER       = '                          
537000                 DISPLAY            PV-KEY-PO-NBR                         
537100                 DISPLAY '** PO RCVD SEQ NBR  = '                         
537200                 DISPLAY            PV-RCVD-SEQ-NBR                       
537300                 DISPLAY '** PO RCVD DELY DTE = '                         
537400                 DISPLAY            TM602-PO-RCVD-DELY-DTE                
537500                 DISPLAY '**************************************'         
537600                 PERFORM 9100-SQL-ABEND                                   
537700         END-EVALUATE                                                     
537800     END-PERFORM.                                                         
537900                                                                          
538000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
538100         (SQLCODE NOT = ZERO AND                                          
538200          SQLCODE NOT = +100 AND                                          
538300          SQLCODE NOT = -811)                                             
538400         DISPLAY '****************************************'               
538500         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
538600         DISPLAY '** SELECT FROM TIMRCPO                **'               
538700         DISPLAY '** PARAGRAPH = 7062-SELECT-TAURCPO    **'               
538800         DISPLAY '** PO NUMBER        = ' PV-KEY-PO-NBR                   
538900         DISPLAY '** PO RCVD SEQ NBR  = ' PV-RCVD-SEQ-NBR                 
539000         DISPLAY '** PO RCVD DELY DTE = ' TM602-PO-RCVD-DELY-DTE          
539100         DISPLAY '****************************************'               
539200         PERFORM 9100-SQL-ABEND                                           
539300     END-IF.                                                              
539400                                                                          
539500 EJECT                                                                    
539600******************************************************************        
539700* SELECT A ROW FROM THE IMPORT CONTAINER MANIFEST TABLE          *        
539800* (TIMCNTK).                                                     *        
539900******************************************************************        
540000 7070-SELECT-TIMCNTK-TIMCNPO.                                             
540100                                                                          
540200     PERFORM                                                              
540300         WITH TEST AFTER                                                  
540400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
540500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
540600                 SQLCODE = ZERO                     OR                    
540700                 SQLCODE = +100                     OR                    
540800                 SQLCODE = -811                                           
540900                                                                          
541000         EXEC SQL                                                         
541100             SELECT A.MOM_DEST_POE_CDE,                                   
541200                    A.MOM_TRIP_TYP_CDE,                                   
541300                    A.MOM_FOB_CDE,                                        
541400                    A.ORGN_SHPD_FR_CDE,                                   
541500                    B.EXTL_REF_NBR,                                       
541600                    B.PO_UNT_QTY                                          
541700              INTO :PV-POE-CDE,                                           
541800                   :PV-TRIP-TYP-CDE,                                      
541900                   :PV-FOB-CDE,                                           
542000                   :IMCNTK-ORGN-SHPD-FR-CDE,                              
542100                   :IMCNPO-EXTL-REF-NBR,                                  
542200                   :IMCNPO-PO-UNT-QTY                                     
542300                                                                          
542400               FROM TIMCNTK  A                                            
542500                  , TIMCNPO  B                                            
542600              WHERE A.CONTNR_ID      = :TM606-CONTNR-ID                   
542700                AND A.CONTNR_ID      =  B.CONTNR_ID                       
542800                AND A.CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR                 
542900                AND A.CONTNR_SEQ_NBR =  B.CONTNR_SEQ_NBR                  
543000                AND B.PO_NBR         = :PV-CURR-PO-NBR                    
543100         END-EXEC                                                         
543200                                                                          
543300         EVALUATE TRUE                                                    
543400             WHEN SQLCODE = ZERO                                          
543500                 SET PS-TIMCNTK-EXISTS TO TRUE                            
543600                 MOVE IMCNPO-PO-UNT-QTY TO                                
543700                                        TM602-IMCNPO-PO-UNT-QTY           
543800                 IF PV-FOB-CDE > SPACES                                   
543900                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
544000                     IF PS-INVALID-FOB-CDE                                
544100                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
544200                         SET PS-INVALID-FOB-CDE-TIMCNTK TO TRUE           
544300                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
544400                     END-IF                                               
544500                                                                          
544600                     IF PS-CONSLR-BLANK                                   
544700                         SET PS-MISSING-KEY-ENTID TO TRUE                 
544800                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
544900                     END-IF                                               
545000                 ELSE                                                     
545100                     SET PS-EMPTY-FOB-CDE TO TRUE                         
545200                 END-IF                                                   
545300                                                                          
545400                 IF PV-POE-CDE > SPACES                                   
545500                     PERFORM 7152-SELECT-ENTID-VALIDATE-POE               
545600                 ELSE                                                     
545700                     SET PS-EMPTY-POE-CDE TO TRUE                         
545800                 END-IF                                                   
545900                                                                          
546000                 IF IMCNPO-EXTL-REF-NBR = SPACES                          
546100                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
546200                 ELSE                                                     
546300                    MOVE IMCNPO-EXTL-REF-NBR TO PV-EXTL-REF-NBR           
546400                 END-IF                                                   
546500                                                                          
546600                                                                          
546700             WHEN SQLCODE = +100                                          
546800                 SET PS-TIMCNTK-EXISTS-NO TO TRUE                         
546900                                                                          
547000                 WHEN SQLCODE = -911                                      
547100                 WHEN SQLCODE = -913                                      
547200                 WHEN SQLCODE = -904                                      
547300                     CONTINUE                                             
547400                                                                          
547500             WHEN SQLWARN0 NOT EQUAL SPACE                                
547600             WHEN SQLCODE NOT EQUAL ZERO                                  
547700                 DISPLAY '**************************************'         
547800                 DISPLAY '** ABEND                            **'         
547900                 DISPLAY '** PROGRAM = TMKUP625               **'         
548000                 DISPLAY '** PARAGRAPH = 7070-SELECT-TIMCNTK  **'         
548100                 DISPLAY '** SELECT TIMCNTK/TIMCNPO           **'         
548200                 DISPLAY '** CONTNR ID       = ' TM606-CONTNR-ID          
548300                 DISPLAY '** CONTNR SEQ NBR  = ' PV-CONTNR-SEQ-NBR        
548400                 DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR           
548500                 DISPLAY '**************************************'         
548600                 PERFORM 9100-SQL-ABEND                                   
548700         END-EVALUATE                                                     
548800     END-PERFORM.                                                         
548900                                                                          
549000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
549100         (SQLCODE NOT = ZERO AND                                          
549200          SQLCODE NOT = +100 AND                                          
549300          SQLCODE NOT = -811)                                             
549400         DISPLAY '*********************************************'          
549500         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO      **'          
549600         DISPLAY '** SELECT FROM TIMCNTK/TIMCNPO             **'          
549700         DISPLAY '** PARAGRAPH = 7070-SELECT-TIMCNTK-TIMCNPO **'          
549800         DISPLAY '** CONTNR ID       = ' TM606-CONTNR-ID                  
549900         DISPLAY '** CONTNR SEQ NBR  = ' PV-CONTNR-SEQ-NBR                
550000         DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR                   
550100         DISPLAY '*********************************************'          
550200         PERFORM 9100-SQL-ABEND                                           
550300     END-IF.                                                              
550400                                                                          
550500 EJECT                                                                    
550600******************************************************************        
550700* SELECT A ROW FROM THE IMPORT AUDIT CONTAINER MANIFEST TABLE    *        
550800* (TAUCNTK).                                                     *        
550900******************************************************************        
551000 7072-SELECT-TAUCNTK-TAUCNPO.                                             
551100                                                                          
551200     PERFORM                                                              
551300         WITH TEST AFTER                                                  
551400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
551500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
551600                 SQLCODE = ZERO                     OR                    
551700                 SQLCODE = +100                     OR                    
551800                 SQLCODE = -811                                           
551900                                                                          
552000         EXEC SQL                                                         
552100             SELECT A.MOM_DEST_POE_CDE,                                   
552200                    A.MOM_TRIP_TYP_CDE,                                   
552300                    A.MOM_FOB_CDE,                                        
552400                    A.ORGN_SHPD_FR_CDE,                                   
552500                    B.EXTL_REF_NBR,                                       
552600                    B.PO_UNT_QTY                                          
552700              INTO :PV-POE-CDE,                                           
552800                   :PV-TRIP-TYP-CDE,                                      
552900                   :PV-FOB-CDE,                                           
553000                   :AUCNTK-ORGN-SHPD-FR-CDE,                              
553100                   :AUCNPO-EXTL-REF-NBR,                                  
553200                   :AUCNPO-PO-UNT-QTY                                     
553300                                                                          
553400               FROM TAUCNTK  A                                            
553500                  , TAUCNPO  B                                            
553600              WHERE A.CONTNR_ID      = :TM606-CONTNR-ID                   
553700                AND A.CONTNR_ID      =  B.CONTNR_ID                       
553800                AND A.CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR                 
553900                AND A.CONTNR_SEQ_NBR =  B.CONTNR_SEQ_NBR                  
554000                AND B.PO_NBR         = :PV-CURR-PO-NBR                    
554100                AND A.AUD_FUNC_CDE   = :PC-D                              
554200         END-EXEC                                                         
554300                                                                          
554400         EVALUATE TRUE                                                    
554500             WHEN SQLCODE = ZERO                                          
554600             WHEN SQLCODE = -811                                          
554700                 SET PS-TAUCNTK-EXISTS  TO TRUE                           
554800                 MOVE AUCNPO-PO-UNT-QTY TO                                
554900                                        TM602-IMCNPO-PO-UNT-QTY           
555000                 MOVE AUCNTK-ORGN-SHPD-FR-CDE TO                          
555100                                        IMCNTK-ORGN-SHPD-FR-CDE           
555200                 IF PV-FOB-CDE > SPACES                                   
555300                     PERFORM 7150-SELECT-ENTID-VALIDATE-FOB               
555400                     IF PS-INVALID-FOB-CDE                                
555500                         MOVE PV-FOB-CDE TO TM600-FOB-CDE                 
555600                         SET PS-INVALID-FOB-CDE-TAUCNTK TO TRUE           
555700                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
555800                     END-IF                                               
555900                                                                          
556000                     IF PS-CONSLR-BLANK                                   
556100                         SET PS-MISSING-KEY-ENTID TO TRUE                 
556200                         PERFORM 6990-PREP-ERROR-REPORT-LINE              
556300                     END-IF                                               
556400                 ELSE                                                     
556500                     SET PS-EMPTY-FOB-CDE TO TRUE                         
556600                 END-IF                                                   
556700                                                                          
556800                 IF PV-POE-CDE > SPACES                                   
556900                     PERFORM 7152-SELECT-ENTID-VALIDATE-POE               
557000                 ELSE                                                     
557100                     SET PS-EMPTY-POE-CDE TO TRUE                         
557200                 END-IF                                                   
557300                                                                          
557400                 IF AUCNPO-EXTL-REF-NBR = SPACES                          
557500                    MOVE 'N/A' TO PV-EXTL-REF-NBR                         
557600                 ELSE                                                     
557700                    MOVE AUCNPO-EXTL-REF-NBR                              
557800                               TO PV-EXTL-REF-NBR                         
557900                 END-IF                                                   
558000                                                                          
558100             WHEN SQLCODE = +100                                          
558200                 SET PS-TAUCNTK-EXISTS-NO TO TRUE                         
558300                                                                          
558400                 WHEN SQLCODE = -911                                      
558500                 WHEN SQLCODE = -913                                      
558600                 WHEN SQLCODE = -904                                      
558700                     CONTINUE                                             
558800                                                                          
558900             WHEN SQLWARN0 NOT EQUAL SPACE                                
559000             WHEN SQLCODE NOT EQUAL ZERO                                  
559100                 DISPLAY '**************************************'         
559200                 DISPLAY '** ABEND                            **'         
559300                 DISPLAY '** PROGRAM = TMKUP625               **'         
559400                 DISPLAY '** PARAGRAPH = 7072-SELECT-TAURCPO  **'         
559500                 DISPLAY '** SELECT TAUCNTK/TAUCNPO           **'         
559600                 DISPLAY '** CONTNR ID       = ' TM606-CONTNR-ID          
559700                 DISPLAY '** CONTNR SEQ NBR  = ' PV-CONTNR-SEQ-NBR        
559800                 DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR           
559900                 DISPLAY '**************************************'         
560000                 PERFORM 9100-SQL-ABEND                                   
560100         END-EVALUATE                                                     
560200     END-PERFORM.                                                         
560300                                                                          
560400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
560500         (SQLCODE NOT = ZERO AND                                          
560600          SQLCODE NOT = +100 AND                                          
560700          SQLCODE NOT = -811)                                             
560800         DISPLAY '*********************************************'          
560900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO      **'          
561000         DISPLAY '** SELECT FROM TAUCNTK/TAUCNPO             **'          
561100         DISPLAY '** PARAGRAPH = 7072-SELECT-AUCNTK          **'          
561200         DISPLAY '** CONTNR ID       = ' TM606-CONTNR-ID                  
561300         DISPLAY '** CONTNR SEQ NBR  = ' PV-CONTNR-SEQ-NBR                
561400         DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR                   
561500         DISPLAY '*********************************************'          
561600         PERFORM 9100-SQL-ABEND                                           
561700     END-IF.                                                              
561800                                                                          
561900 EJECT                                                                    
562000******************************************************************        
562100* SELECT A ROW FROM THE IMPORT CUSTOMS ENTRY TABLE.              *        
562200* (TIMCSEN).                                                     *        
562300******************************************************************        
562400 7080-SELECT-TIMCSEN-TIMCSPO.                                             
562500                                                                          
562600     PERFORM                                                              
562700         WITH TEST AFTER                                                  
562800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
562900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
563000                 SQLCODE = ZERO                     OR                    
563100                 SQLCODE = +100                     OR                    
563200                 SQLCODE = -811                                           
563300                                                                          
563400         EXEC SQL                                                         
563500             SELECT A.MOM_DEST_POE_CDE,                                   
563600                    A.ENT_ID,                                             
563700                    'O'                                                   
563800              INTO :PV-POE-CDE,                                           
563900                   :PV-CSTM-BKR-ENT-ID,                                   
564000                   :PV-TRIP-TYP-CDE                                       
564100                                                                          
564200               FROM TIMCSEN  A                                            
564300                  , TIMCSPO  B                                            
564400              WHERE B.PO_NBR         = :PV-CURR-PO-NBR                    
564500                AND A.CSTM_ENTR_ID   = :PV-CSTM-ENTR-ID                   
564600         END-EXEC                                                         
564700                                                                          
564800         EVALUATE TRUE                                                    
564900             WHEN SQLCODE = ZERO                                          
565000                 SET PS-TIMCSEN-EXISTS TO TRUE                            
565100                                                                          
565200                 IF PV-POE-CDE > SPACES                                   
565300                     PERFORM 7152-SELECT-ENTID-VALIDATE-POE               
565400                 ELSE                                                     
565500                     SET PS-EMPTY-POE-CDE TO TRUE                         
565600                 END-IF                                                   
565700                                                                          
565800             WHEN SQLCODE = +100                                          
565900                 SET PS-TIMCSEN-EXISTS-NO TO TRUE                         
566000                 SET PS-EMPTY-POE-CDE     TO TRUE                         
566100                 MOVE +0 TO PV-CSTM-BKR-ENT-ID                            
566200                                                                          
566300                 WHEN SQLCODE = -911                                      
566400                 WHEN SQLCODE = -913                                      
566500                 WHEN SQLCODE = -904                                      
566600                     CONTINUE                                             
566700                                                                          
566800             WHEN SQLWARN0 NOT EQUAL SPACE                                
566900             WHEN SQLCODE NOT EQUAL ZERO                                  
567000                 DISPLAY '**************************************'         
567100                 DISPLAY '** ABEND                            **'         
567200                 DISPLAY '** PROGRAM = TMKUP625               **'         
567300                 DISPLAY '** PARAGRAPH = 7080-SELECT-TIMCSEN  **'         
567400                 DISPLAY '** SELECT TIMCSEN/TIMCSPO           **'         
567500                 DISPLAY '** CSTM ENTRY ID   = ' PV-CSTM-ENTR-ID          
567600                 DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR           
567700                 DISPLAY '**************************************'         
567800                 PERFORM 9100-SQL-ABEND                                   
567900         END-EVALUATE                                                     
568000     END-PERFORM.                                                         
568100                                                                          
568200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
568300         (SQLCODE NOT = ZERO AND                                          
568400          SQLCODE NOT = +100 AND                                          
568500          SQLCODE NOT = -811)                                             
568600         DISPLAY '*********************************************'          
568700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO      **'          
568800         DISPLAY '** SELECT FROM TIMCSEN/TIMCSPO             **'          
568900         DISPLAY '** PARAGRAPH = 7080-SELECT-TIMCSEN-TIMCSPO **'          
569000         DISPLAY '** CSTM ENTRY ID   = ' PV-CSTM-ENTR-ID                  
569100         DISPLAY '** PO NUMBER       = ' PV-CURR-PO-NBR                   
569200         DISPLAY '*********************************************'          
569300         PERFORM 9100-SQL-ABEND                                           
569400     END-IF.                                                              
569500                                                                          
569600 EJECT                                                                    
569700******************************************************************        
569800* SELECT A ROW FROM TROUBLE NOTIFICATION TABLE (TTRBNTF).        *        
569900******************************************************************        
570000 7085-SELECT-TTRBNTF.                                                     
570100                                                                          
570200     PERFORM                                                              
570300         WITH TEST AFTER                                                  
570400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
570500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
570600                 SQLCODE = ZERO                     OR                    
570700                 SQLCODE = -811                     OR                    
570800                 SQLCODE = +100                                           
570900                                                                          
571000         EXEC SQL                                                         
571100             SELECT D.NOTIF_NBR                                           
571200                  , D.NOTIF_TMST                                          
571300                  , D.RESOLVED_TMST                                       
571400                  , D.ACKNOWLG_TMST                                       
571500                  , D.OVER_SHT_PCT                                        
571600                  , D.ERLY_LTE_DAY_QTY                                    
571700                  , D.TRBL_RSN_CDE                                        
571800                  , D.NOTIF_IND                                           
571900             INTO  :TRBNTF-NOTIF-NBR                                      
572000                  ,:TRBNTF-NOTIF-TMST                                     
572100                  ,:TRBNTF-RESOLVED-TMST                                  
572200                  ,:TRBNTF-ACKNOWLG-TMST                                  
572300                  ,:TRBNTF-OVER-SHT-PCT                                   
572400                  ,:TRBNTF-ERLY-LTE-DAY-QTY                               
572500                  ,:TRBNTF-TRBL-RSN-CDE                                   
572600                  ,:TRBRSN-NOTIF-IND                                      
572700               FROM                                                       
572800                   (SELECT A.NOTIF_NBR                                    
572900                         , A.NOTIF_TMST                                   
573000                         , A.RESOLVED_TMST                                
573100                         , A.ACKNOWLG_TMST                                
573200                         , A.OVER_SHT_PCT                                 
573300                         , A.ERLY_LTE_DAY_QTY                             
573400                         , A.TRBL_RSN_CDE                                 
573500                         , B.NOTIF_IND                                    
573600                      FROM TTRBNTF  A                                     
573700                         , TTRBRSN  B                                     
573800                     WHERE ((A.PO_NBR       = :PV-CURR-PO-NBR             
573900                       AND   A.TRBL_RSN_CDE = :PV-CURR-TRBL-RSN           
574000                       AND   :TM606-EXTR-PRCG-APPL-CDE <> :PC-TR)         
574100                        OR  (A.NOTIF_NBR = :PV-EXTR-NOTIF-NBR             
574200                       AND   :PV-EXTR-NOTIF-NBR > 0                       
574300                       AND   :TM606-EXTR-PRCG-APPL-CDE = :PC-TR))         
574400                                                                          
574500                       AND   B.TRBL_INITR_CDE = :PC-T                     
574600                     AND   A.TRBL_RSN_CDE = B.TRBL_RSN_CDE) AS D          
574700                                                                          
574800                       LEFT OUTER JOIN TIMTBKY C                          
574900                         ON D.NOTIF_NBR = C.NOTIF_NBR                     
575000                                                                          
575100                WHERE ((C.IMPRT_SEQ_NBR       = :PV-BKG-SEQ-NBR           
575200                  AND  C.PRCS_TYP_CDE        = :PV-DATA-SOURCE            
575300                  AND  :PV-DATA-SOURCE       = :PC-BK)                    
575400                                                                          
575500                   OR (C.IMPRT_SEQ_NBR       = :PV-RCVD-SEQ-NBR           
575600                  AND  C.PRCS_TYP_CDE        = :PV-DATA-SOURCE            
575700                  AND  :PV-DATA-SOURCE       = :PC-RC)                    
575800                                                                          
575900                   OR (C.IMPRT_SEQ_NBR       = :PV-CONTNR-SEQ-NBR         
576000                  AND  C.IMPRT_ID            = :TM606-CONTNR-ID           
576100                  AND  C.PRCS_TYP_CDE        = :PV-DATA-SOURCE            
576200                  AND  :PV-DATA-SOURCE       = :PC-CN)                    
576300                                                                          
576400                   OR (C.IMPRT_ID            = :PV-TRIP-ID                
576500                  AND  C.PRCS_TYP_CDE        = :PV-DATA-SOURCE            
576600                  AND  :PV-DATA-SOURCE       = :PC-CV)                    
576700                                                                          
576800                   OR (C.IMPRT_ID            = :PV-CSTM-ENTR-ID           
576900                  AND  C.PRCS_TYP_CDE        = :PV-DATA-SOURCE            
577000                  AND  :PV-DATA-SOURCE       = :PC-CS)                    
577100                                                                          
577200                   OR  C.NOTIF_NBR IS NULL                                
577300                   OR (C.NOTIF_NBR IS NOT NULL                            
577400                  AND  :PV-DATA-SOURCE = :PC-PO))                         
577500                                                                          
577600         END-EXEC                                                         
577700                                                                          
577800         EVALUATE TRUE                                                    
577900             WHEN SQLCODE = ZERO                                          
578000                 SET PS-TTRBNTF-EXISTS  TO TRUE                           
578100                 MOVE TRBNTF-NOTIF-NBR        TO                          
578200                                       PV-CURR-TRBL-NOTIF-NBR             
578300                 MOVE TRBNTF-OVER-SHT-PCT     TO                          
578400                                       PV-CURR-RULE-RESULT-PCT            
578500                 MOVE TRBNTF-ERLY-LTE-DAY-QTY TO                          
578600                                       PV-CURR-RULE-RESULT-DAYS           
578700                                                                          
578800             WHEN SQLCODE = -811                                          
578900                 SET PS-DUPLICATE-TROUBLE       TO TRUE                   
579000                                                                          
579100             WHEN SQLCODE = +100                                          
579200                 SET PS-TTRBNTF-EXISTS-NO       TO TRUE                   
579300                 SET PS-DUPLICATE-TROUBLE-NO    TO TRUE                   
579400                                                                          
579500                 WHEN SQLCODE = -911                                      
579600                 WHEN SQLCODE = -913                                      
579700                 WHEN SQLCODE = -904                                      
579800                     CONTINUE                                             
579900                                                                          
580000             WHEN SQLWARN0 NOT EQUAL SPACE                                
580100             WHEN SQLCODE NOT EQUAL ZERO                                  
580200                 DISPLAY '**************************************'         
580300                 DISPLAY '** ABEND                            **'         
580400                 DISPLAY '** PROGRAM = TMKUP625               **'         
580500                 DISPLAY '** PARAGRAPH = 7085-SELECT-TTRBNTF  **'         
580600                 DISPLAY '** SELECT TTRBNTF                   **'         
580700                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
580800                 DISPLAY '**************************************'         
580900                 PERFORM 9100-SQL-ABEND                                   
581000         END-EVALUATE                                                     
581100     END-PERFORM.                                                         
581200                                                                          
581300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
581400         (SQLCODE NOT = ZERO    AND                                       
581500          SQLCODE NOT = -811    AND                                       
581600          SQLCODE NOT = +100)                                             
581700         DISPLAY '******************************************'             
581800         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'             
581900         DISPLAY '** SELECT FROM TTRBNTF                  **'             
582000         DISPLAY '** PARAGRAPH = 7085-SELECT-TTRBNTF      **'             
582100         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
582200         DISPLAY '******************************************'             
582300         PERFORM 9100-SQL-ABEND                                           
582400     END-IF.                                                              
582500                                                                          
582600 EJECT                                                                    
582700******************************************************************        
582800* SELECT A ROW FROM THE PLANNED SHIPMENT TABLE (TPLNSHP).        *        
582900******************************************************************        
583000 7090-SELECT-TPLNSHP-DATES.                                               
583100                                                                          
583200     PERFORM                                                              
583300         WITH TEST AFTER                                                  
583400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
583500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
583600                 SQLCODE = ZERO                     OR                    
583700                 SQLCODE = +100                                           
583800                                                                          
583900         EXEC SQL                                                         
584000             SELECT STRT_FCTRY_DTE                                        
584100                   ,LAST_FCTRY_DTE                                        
584200                   ,VER_NBR                                               
584300              INTO :PV-STRT-FCTRY-DTE,                                    
584400                   :PV-LAST-FCTRY-DTE,                                    
584500                   :PLNSHP-VER-NBR                                        
584600                                                                          
584700               FROM TPLNSHP                                               
584800              WHERE PO_NBR           = :PV-CURR-PO-NBR                    
584900               AND  VER_STATUS_CDE   = :PC-A                              
585000         END-EXEC                                                         
585100                                                                          
585200         EVALUATE TRUE                                                    
585300             WHEN SQLCODE = ZERO                                          
585400                 IF PV-STRT-FCTRY-DTE = SPACES                            
585500                     SET PS-TPLNSHP-STRT-FCTRY-NO TO TRUE                 
585600                 ELSE                                                     
585700                     SET PS-TPLNSHP-STRT-FCTRY    TO TRUE                 
585800                 END-IF                                                   
585900                                                                          
586000                 IF PV-LAST-FCTRY-DTE = SPACES                            
586100                     SET PS-TPLNSHP-LAST-FCTRY-NO TO TRUE                 
586200                 ELSE                                                     
586300                     SET PS-TPLNSHP-LAST-FCTRY    TO TRUE                 
586400                 END-IF                                                   
586500                                                                          
586600             WHEN SQLCODE = +100                                          
586700                 SET PS-TPLNSHP-STRT-FCTRY-NO   TO TRUE                   
586800                 SET PS-TPLNSHP-LAST-FCTRY-NO   TO TRUE                   
586900                                                                          
587000                 WHEN SQLCODE = -911                                      
587100                 WHEN SQLCODE = -913                                      
587200                 WHEN SQLCODE = -904                                      
587300                     CONTINUE                                             
587400                                                                          
587500             WHEN SQLWARN0 NOT EQUAL SPACE                                
587600             WHEN SQLCODE NOT EQUAL ZERO                                  
587700                 DISPLAY '**************************************'         
587800                 DISPLAY '** ABEND                            **'         
587900                 DISPLAY '** PROGRAM = TMKUP625               **'         
588000                 DISPLAY '** PARAGRAPH = 7090-SELECT-TPLNSHP  **'         
588100                 DISPLAY '** SELECT TPLNSHP                   **'         
588200                 DISPLAY '** PO NUMBER      = ' TM606-PO-NBR              
588300                 DISPLAY '** PLNSHP VER NBR = '                           
588400                 DISPLAY                    TM606-PLNSHP-VER-NBR          
588500                 DISPLAY '**************************************'         
588600                 PERFORM 9100-SQL-ABEND                                   
588700         END-EVALUATE                                                     
588800     END-PERFORM.                                                         
588900                                                                          
589000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
589100         (SQLCODE NOT = ZERO AND                                          
589200             SQLCODE NOT = +100)                                          
589300         DISPLAY '****************************************'               
589400         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
589500         DISPLAY '** SELECT FROM TPLNSHP                **'               
589600         DISPLAY '** PARAGRAPH = 7090-SELECT-TPLNSHP    **'               
589700         DISPLAY '** PO NUMBER       = ' TM606-PO-NBR                     
589800         DISPLAY '** PLNSHP VER NBR  = ' TM606-PLNSHP-VER-NBR             
589900         DISPLAY '****************************************'               
590000         PERFORM 9100-SQL-ABEND                                           
590100     END-IF.                                                              
590200                                                                          
590300 EJECT                                                                    
590400******************************************************************        
590500* SELECT A ROW FROM THE TROUBLE REASON TABLE (TTRBRSN).          *        
590600******************************************************************        
590700 7095-SELECT-TTRBRSN.                                                     
590800                                                                          
590900     PERFORM                                                              
591000         WITH TEST AFTER                                                  
591100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
591200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
591300                 SQLCODE = ZERO                     OR                    
591400                 SQLCODE = -811                     OR                    
591500                 SQLCODE = +100                                           
591600                                                                          
591700         EXEC SQL                                                         
591800             SELECT TRBL_LONG_DESC                                        
591900              INTO :TRBRSN-TRBL-LONG-DESC                                 
592000               FROM TTRBRSN                                               
592100              WHERE TRBL_RSN_CDE     = :PV-CURR-TRBL-RSN                  
592200         END-EXEC                                                         
592300                                                                          
592400         EVALUATE TRUE                                                    
592500             WHEN SQLCODE = ZERO                                          
592600             WHEN SQLCODE = -811                                          
592700                 SET PS-TTRBRSN-EXISTS  TO TRUE                           
592800                                                                          
592900             WHEN SQLCODE = +100                                          
593000                 SET PS-TTRBRSN-EXISTS-NO       TO TRUE                   
593100                                                                          
593200                 WHEN SQLCODE = -911                                      
593300                 WHEN SQLCODE = -913                                      
593400                 WHEN SQLCODE = -904                                      
593500                     CONTINUE                                             
593600                                                                          
593700             WHEN SQLWARN0 NOT EQUAL SPACE                                
593800             WHEN SQLCODE NOT EQUAL ZERO                                  
593900                 DISPLAY '**************************************'         
594000                 DISPLAY '** ABEND                            **'         
594100                 DISPLAY '** PROGRAM = TMKUP625               **'         
594200                 DISPLAY '** PARAGRAPH = 7095-SELECT-TTRBRSN  **'         
594300                 DISPLAY '** SELECT TTRBRSN                   **'         
594400                 DISPLAY '** TRBL REASON  = ' PV-CURR-TRBL-RSN            
594500                 DISPLAY '**************************************'         
594600                 PERFORM 9100-SQL-ABEND                                   
594700         END-EVALUATE                                                     
594800     END-PERFORM.                                                         
594900                                                                          
595000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
595100         (SQLCODE NOT = ZERO    AND                                       
595200          SQLCODE NOT = -811    AND                                       
595300          SQLCODE NOT = +100)                                             
595400         DISPLAY '******************************************'             
595500         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO   **'             
595600         DISPLAY '** SELECT FROM TTRBNTF                  **'             
595700         DISPLAY '** PARAGRAPH = 7095-SELECT-TTRBRSN      **'             
595800         DISPLAY '** TRBL REASON  = ' PV-CURR-TRBL-RSN                    
595900         DISPLAY '******************************************'             
596000         PERFORM 9100-SQL-ABEND                                           
596100     END-IF.                                                              
596200                                                                          
596300 EJECT                                                                    
596400******************************************************************        
596500* SET THE CURRENT TIMESTAMP.                                     *        
596600******************************************************************        
596700 7100-SET-CURRENT-TMST.                                                   
596800                                                                          
596900          EXEC SQL                                                        
597000              SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                    
597100          END-EXEC                                                        
597200                                                                          
597300         EVALUATE TRUE                                                    
597400             WHEN SQLCODE = ZERO                                          
597500                 MOVE PV-CURRENT-TMST (1:4) TO PV-REFORMAT-DTE-YY         
597600                 MOVE PV-CURRENT-TMST (6:2) TO PV-REFORMAT-DTE-MM         
597700                 MOVE PV-CURRENT-TMST (9:2) TO PV-REFORMAT-DTE-DD         
597800                 MOVE PV-CURRENT-TMST (1:10) TO PV-CURRENT-DTE            
597900                                                                          
598000             WHEN SQLWARN0 NOT EQUAL SPACE                                
598100             WHEN SQLCODE NOT EQUAL ZERO                                  
598200                 DISPLAY '**************************************'         
598300                 DISPLAY '** ABEND                            **'         
598400                 DISPLAY '** PROGRAM = TMKUP625               **'         
598500                 DISPLAY '** PARAGRAPH = 7100-SET-CURRENT-TMST**'         
598600                 DISPLAY '** SET CURRENT TIMESTAMP            **'         
598700                 DISPLAY '** CURRENT TMST   = ' PV-CURRENT-TMST           
598800                 DISPLAY '**************************************'         
598900                 PERFORM 9100-SQL-ABEND                                   
599000         END-EVALUATE.                                                    
599100                                                                          
599200******************************************************************        
599300* SELECT THE SEQUENCE CONTROL NUMBER FROM TIMCNTL TO USE IN      *        
599400* SORTING THE DATA.                                              *        
599500******************************************************************        
599600 7110-SELECT-TIMCNTL-CNTL-NBR.                                            
599700                                                                          
599800     PERFORM                                                              
599900         WITH TEST AFTER                                                  
600000         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
600100         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
600200                 SQLCODE = ZERO                     OR                    
600300                 SQLCODE = -811                     OR                    
600400                 SQLCODE = +100                                           
600500                                                                          
600600         EXEC SQL                                                         
600700             SELECT TRBL_RPTG_CNTL_ID                                     
600800              INTO :IMCNTL-TRBL-RPTG-CNTL-ID                              
600900               FROM TIMCNTL                                               
601000         END-EXEC                                                         
601100                                                                          
601200         EVALUATE TRUE                                                    
601300             WHEN SQLCODE = ZERO                                          
601400             WHEN SQLCODE = -811                                          
601500                 SET PS-TIMCNTL-CNTL-NBR-EXISTS    TO TRUE                
601600                                                                          
601700             WHEN SQLCODE = +100                                          
601800                 SET PS-TIMCNTL-CNTL-NBR-EXISTS-NO TO TRUE                
601900                                                                          
602000                 WHEN SQLCODE = -911                                      
602100                 WHEN SQLCODE = -913                                      
602200                 WHEN SQLCODE = -904                                      
602300                     CONTINUE                                             
602400                                                                          
602500             WHEN SQLWARN0 NOT EQUAL SPACE                                
602600             WHEN SQLCODE NOT EQUAL ZERO                                  
602700                 DISPLAY '**************************************'         
602800                 DISPLAY '** ABEND                            **'         
602900                 DISPLAY '** PROGRAM = TMKUP625               **'         
603000                 DISPLAY '** PARAGRAPH = 7110-SELECT-TIMCNTL- **'         
603100                 DISPLAY '**                  CNTL-NBR        **'         
603200                 DISPLAY '** SELECT TIMCNTL                   **'         
603300                 DISPLAY '**************************************'         
603400                 PERFORM 9100-SQL-ABEND                                   
603500         END-EVALUATE                                                     
603600     END-PERFORM.                                                         
603700                                                                          
603800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
603900         (SQLCODE NOT = ZERO    AND                                       
604000          SQLCODE NOT = -811    AND                                       
604100          SQLCODE NOT = +100)                                             
604200         DISPLAY '*******************************************'            
604300         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
604400         DISPLAY '** SELECT FROM TIMCNTL                   **'            
604500         DISPLAY '** PARAGRAPH = 7110-SELECT-TIMCNTL-CNTL-NBR'            
604600         DISPLAY '*******************************************'            
604700         PERFORM 9100-SQL-ABEND                                           
604800     END-IF.                                                              
604900                                                                          
605000 EJECT                                                                    
605100******************************************************************        
605200* UPDATE THE SEQUENCE CONTROL NUMBER FROM TIMCNTL TO USE IN      *        
605300* SORTING THE DATA.                                              *        
605400******************************************************************        
605500 7115-UPDATE-TIMCNTL-CNTL-NBR.                                            
605600                                                                          
605700     PERFORM                                                              
605800         WITH TEST AFTER                                                  
605900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
606000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
606100                 SQLCODE = ZERO                     OR                    
606200                 SQLCODE = +100                                           
606300                                                                          
606400         EXEC SQL                                                         
606500             UPDATE TIMCNTL                                               
606600                SET TRBL_RPTG_CNTL_ID = :PV-IMCNTL-CNTL-ID                
606700              WHERE TRBL_RPTG_CNTL_ID > -1                                
606800         END-EXEC                                                         
606900                                                                          
607000         EVALUATE TRUE                                                    
607100             WHEN SQLCODE = ZERO                                          
607200             WHEN SQLCODE = +100                                          
607300                 CONTINUE                                                 
607400                                                                          
607500                 WHEN SQLCODE = -911                                      
607600                 WHEN SQLCODE = -913                                      
607700                 WHEN SQLCODE = -904                                      
607800                     CONTINUE                                             
607900                                                                          
608000             WHEN SQLWARN0 NOT EQUAL SPACE                                
608100             WHEN SQLCODE NOT EQUAL ZERO                                  
608200                 DISPLAY '**************************************'         
608300                 DISPLAY '** ABEND                            **'         
608400                 DISPLAY '** PROGRAM = TMKUP625               **'         
608500                 DISPLAY '** PARAGRAPH = 7115-UPDATE-TIMCNTL- **'         
608600                 DISPLAY '**                  CNTL-NBR        **'         
608700                 DISPLAY '** UPDATE TIMCNTL                   **'         
608800                 DISPLAY '** RPTG CNTL ID = ' PV-IMCNTL-CNTL-ID           
608900                 DISPLAY '**************************************'         
609000                 PERFORM 9100-SQL-ABEND                                   
609100         END-EVALUATE                                                     
609200     END-PERFORM.                                                         
609300                                                                          
609400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
609500         (SQLCODE NOT = ZERO    AND                                       
609600          SQLCODE NOT = +100)                                             
609700         DISPLAY '*******************************************'            
609800         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO    **'            
609900         DISPLAY '** UPDATE FROM TIMCNTL                   **'            
610000         DISPLAY '** PARAGRAPH = 7115-UPDATE-TIMCNTL-CNTL-NBR'            
610100         DISPLAY '** RPTG CNTL ID = ' PV-IMCNTL-CNTL-ID                   
610200         DISPLAY '*******************************************'            
610300         PERFORM 9100-SQL-ABEND                                           
610400     END-IF.                                                              
610500                                                                          
610600 EJECT                                                                    
610700******************************************************************        
610800* LOAD THE ENTID KEY FOR TROUBLE PROCSSING CONTROL TABLE.        *        
610900******************************************************************        
611000 7150-SELECT-ENTID-VALIDATE-FOB.                                          
611100                                                                          
611200     MOVE '7150-SELECT-ENTID-VALIDATE-FOB' TO                             
611300           TM600-CURR-PARAGRAPH.                                          
611400                                                                          
611500     EVALUATE TRUE                                                        
611600         WHEN PV-TRIP-TYP-CDE = PC-A                                      
611700             PERFORM 7155-SELECT-ENTID-TIMFOB-FOB                         
611800                                                                          
611900         WHEN PV-TRIP-TYP-CDE = PC-O                                      
612000         WHEN PV-TRIP-TYP-CDE = PC-T                                      
612100             PERFORM 7160-SELECT-ENTID-TIMFOB-EDI                         
612200                                                                          
612300         WHEN OTHER                                                       
612400             SET PS-VALID-FOB-CDE TO TRUE                                 
612500             SET PS-INVALID-TRIP-TYP-CDE-ERR TO TRUE                      
612600             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
612700     END-EVALUATE.                                                        
612800                                                                          
612900*    IF PS-INVALID-FOB-CDE                                                
613000*        SET PS-INVALID-FOB-CDE-ERR TO TRUE                               
613100*        PERFORM 6990-PREP-ERROR-REPORT-LINE                              
613200*    END-IF.                                                              
613300                                                                          
613400******************************************************************        
613500* LOAD THE ENTID KEY FOR TROUBLE PROCSSING CONTROL TABLE.        *        
613600******************************************************************        
613700 7152-SELECT-ENTID-VALIDATE-POE.                                          
613800                                                                          
613900     MOVE '7152-SELECT-ENTID-VALIDATE-POE' TO                             
614000           TM600-CURR-PARAGRAPH.                                          
614100                                                                          
614200     EVALUATE TRUE                                                        
614300         WHEN PV-TRIP-TYP-CDE = PC-A                                      
614400             PERFORM 7157-SELECT-ENTID-TIMPOE-POE                         
614500                                                                          
614600         WHEN PV-TRIP-TYP-CDE = PC-O                                      
614700         WHEN PV-TRIP-TYP-CDE = PC-T                                      
614800             PERFORM 7162-SELECT-ENTID-TIMPOE-EDI                         
614900                                                                          
615000         WHEN OTHER                                                       
615100             SET PS-VALID-POE-CDE TO TRUE                                 
615200             SET PS-INVALID-TRIP-TYP-CDE-ERR TO TRUE                      
615300             PERFORM 6990-PREP-ERROR-REPORT-LINE                          
615400     END-EVALUATE.                                                        
615500                                                                          
615600     IF PS-INVALID-POE-CDE                                                
615700         SET PS-INVALID-POE-CDE-ERR TO TRUE                               
615800         PERFORM 6990-PREP-ERROR-REPORT-LINE                              
615900     END-IF.                                                              
616000                                                                          
616100******************************************************************        
616200* SELECT ENTID CODE FOR AIR TRIPS.                               *        
616300******************************************************************        
616400 7155-SELECT-ENTID-TIMFOB-FOB.                                            
616500                                                                          
616600     PERFORM                                                              
616700         WITH TEST AFTER                                                  
616800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
616900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
617000                 SQLCODE = ZERO                     OR                    
617100                 SQLCODE = -811                     OR                    
617200                 SQLCODE = +100                                           
617300                                                                          
617400         EXEC SQL                                                         
617500             SELECT CONSLR_ENT_ID                                         
617600              INTO :PV-CONSLR-ENT-ID                                      
617700               FROM TIMFOB                                                
617800              WHERE FOB_CDE     =   :PV-FOB-CDE                           
617900                AND STAT_CDE    =   'A'                                   
618000         END-EXEC                                                         
618100                                                                          
618200         EVALUATE TRUE                                                    
618300             WHEN SQLCODE = ZERO                                          
618400             WHEN SQLCODE = -811                                          
618500                 SET PS-VALID-FOB-CDE       TO TRUE                       
618600                 SET PS-EMPTY-KEY-FIELDS-NO TO TRUE                       
618700                                                                          
618800             WHEN SQLCODE = +100                                          
618900                 SET PS-INVALID-FOB-CDE         TO TRUE                   
619000                 SET PS-EMPTY-KEY-FIELDS        TO TRUE                   
619100                                                                          
619200                 WHEN SQLCODE = -911                                      
619300                 WHEN SQLCODE = -913                                      
619400                 WHEN SQLCODE = -904                                      
619500                     CONTINUE                                             
619600                                                                          
619700             WHEN SQLWARN0 NOT EQUAL SPACE                                
619800             WHEN SQLCODE NOT EQUAL ZERO                                  
619900                 DISPLAY '**************************************'         
620000                 DISPLAY '** ABEND                            **'         
620100                 DISPLAY '** PROGRAM = TMKUP625               **'         
620200                 DISPLAY '** PARAGRAPH =                      **'         
620300                 DISPLAY '**    7155-SELECT-ENTID-TIMFOB-FOB  **'         
620400                 DISPLAY '** SELECT TIMFOB FOB/ENTID CODE     **'         
620500                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
620600                 DISPLAY '** FOB CODE     = ' PV-FOB-CDE                  
620700                 DISPLAY '**************************************'         
620800                 PERFORM 9100-SQL-ABEND                                   
620900         END-EVALUATE                                                     
621000     END-PERFORM.                                                         
621100                                                                          
621200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
621300         (SQLCODE NOT = ZERO    AND                                       
621400          SQLCODE NOT = -811    AND                                       
621500          SQLCODE NOT = +100)                                             
621600         DISPLAY '**********************************************'         
621700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO       **'         
621800         DISPLAY '** SELECT FROM TIMFOB                       **'         
621900         DISPLAY '** PARAGRAPH = 7155-SELECT-ENTID-TIMFOB-FOB **'         
622000         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
622100         DISPLAY '** FOB CODE     = ' PV-FOB-CDE                          
622200         DISPLAY '****************************************'               
622300         PERFORM 9100-SQL-ABEND                                           
622400     END-IF.                                                              
622500                                                                          
622600 EJECT                                                                    
622700******************************************************************        
622800* SELECT ENTID CODE FOR AIR TRIPS.                               *        
622900******************************************************************        
623000 7156-SELECT-ENTID-TIMFOB-FOB.                                            
623100                                                                          
623200     PERFORM                                                              
623300         WITH TEST AFTER                                                  
623400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
623500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
623600                 SQLCODE = ZERO                     OR                    
623700                 SQLCODE = -811                     OR                    
623800                 SQLCODE = +100                                           
623900                                                                          
624000         EXEC SQL                                                         
624100             SELECT CONSLR_ENT_ID                                         
624200              INTO :PV-CONSLR-ENT-ID                                      
624300               FROM TIMFOB                                                
624400              WHERE FOB_CDE     =   :PV-FOB-CDE                           
624500                AND STAT_CDE    =   'A'                                   
624600         END-EXEC                                                         
624700                                                                          
624800         EVALUATE TRUE                                                    
624900             WHEN SQLCODE = ZERO                                          
625000             WHEN SQLCODE = -811                                          
625100                 SET PS-VALID-FOB-CDE      TO TRUE                        
625200                                                                          
625300             WHEN SQLCODE = +100                                          
625400                 SET PS-INVALID-FOB-CDE         TO TRUE                   
625500                                                                          
625600                 WHEN SQLCODE = -911                                      
625700                 WHEN SQLCODE = -913                                      
625800                 WHEN SQLCODE = -904                                      
625900                     CONTINUE                                             
626000                                                                          
626100             WHEN SQLWARN0 NOT EQUAL SPACE                                
626200             WHEN SQLCODE NOT EQUAL ZERO                                  
626300                 DISPLAY '**************************************'         
626400                 DISPLAY '** ABEND                            **'         
626500                 DISPLAY '** PROGRAM = TMKUP625               **'         
626600                 DISPLAY '** PARAGRAPH =                      **'         
626700                 DISPLAY '**    7156-SELECT-ENTID-TIMFOB-FOB  **'         
626800                 DISPLAY '** SELECT TIMFOB FOB/ENTID CODE     **'         
626900                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
627000                 DISPLAY '** FOB CODE     = ' PV-FOB-CDE                  
627100                 DISPLAY '**************************************'         
627200                 PERFORM 9100-SQL-ABEND                                   
627300         END-EVALUATE                                                     
627400     END-PERFORM.                                                         
627500                                                                          
627600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
627700         (SQLCODE NOT = ZERO    AND                                       
627800          SQLCODE NOT = -811    AND                                       
627900          SQLCODE NOT = +100)                                             
628000         DISPLAY '**********************************************'         
628100         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO       **'         
628200         DISPLAY '** SELECT FROM TIMFOB                       **'         
628300         DISPLAY '** PARAGRAPH = 7156-SELECT-ENTID-TIMFOB-FOB **'         
628400         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
628500         DISPLAY '** FOB CODE     = ' PV-FOB-CDE                          
628600         DISPLAY '****************************************'               
628700         PERFORM 9100-SQL-ABEND                                           
628800     END-IF.                                                              
628900                                                                          
629000 EJECT                                                                    
629100******************************************************************        
629200* SELECT ENTID CODE FOR AIR TRIPS.                               *        
629300******************************************************************        
629400 7157-SELECT-ENTID-TIMPOE-POE.                                            
629500                                                                          
629600     PERFORM                                                              
629700         WITH TEST AFTER                                                  
629800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
629900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
630000                 SQLCODE = ZERO                     OR                    
630100                 SQLCODE = -811                     OR                    
630200                 SQLCODE = +100                                           
630300                                                                          
630400         EXEC SQL                                                         
630500             SELECT DCONSLR_ENT_ID                                        
630600              INTO :PV-DCONSLR-ENT-ID                                     
630700               FROM TIMPOE                                                
630800              WHERE POE_CDE     =   :PV-POE-CDE                           
630900                AND STAT_CDE    =   'A'                                   
631000         END-EXEC                                                         
631100                                                                          
631200         EVALUATE TRUE                                                    
631300             WHEN SQLCODE = ZERO                                          
631400             WHEN SQLCODE = -811                                          
631500                 SET PS-VALID-POE-CDE    TO TRUE                          
631600                 EVALUATE TRUE                                            
631700                   WHEN PV-POE-CDE = 'LA'                                 
631800                   WHEN PV-POE-CDE = 'AN'                                 
631900                   WHEN PV-POE-CDE = 'SF'                                 
632000                      MOVE 6778  TO PV-DCONSLR-ENT-ID                     
632100                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
632200                   WHEN PV-POE-CDE = 'SE'                                 
632300                   WHEN PV-POE-CDE = 'TA'                                 
632400                      MOVE 11657 TO PV-DCONSLR-ENT-ID                     
632500                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
632600                   WHEN PV-POE-CDE = 'MI'                                 
632700                      MOVE 11149 TO PV-DCONSLR-ENT-ID                     
632800                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
632900                   WHEN PV-POE-CDE = 'NY'                                 
633000                   WHEN PV-POE-CDE = 'PH'                                 
633100                      MOVE 4830  TO PV-DCONSLR-ENT-ID                     
633200                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
633300                   WHEN PV-POE-CDE = 'CH'                                 
633400                   WHEN PV-POE-CDE = 'DE'                                 
633500                      MOVE 5115  TO PV-DCONSLR-ENT-ID                     
633600                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
633700                 END-EVALUATE                                             
633800                                                                          
633900             WHEN SQLCODE = +100                                          
634000                 SET PS-INVALID-POE-CDE         TO TRUE                   
634100                                                                          
634200                 WHEN SQLCODE = -911                                      
634300                 WHEN SQLCODE = -913                                      
634400                 WHEN SQLCODE = -904                                      
634500                     CONTINUE                                             
634600                                                                          
634700             WHEN SQLWARN0 NOT EQUAL SPACE                                
634800             WHEN SQLCODE NOT EQUAL ZERO                                  
634900                 DISPLAY '**************************************'         
635000                 DISPLAY '** ABEND                            **'         
635100                 DISPLAY '** PROGRAM = TMKUP625               **'         
635200                 DISPLAY '** PARAGRAPH =                      **'         
635300                 DISPLAY '**    7157-SELECT-ENTID-TIMPOE-POE  **'         
635400                 DISPLAY '** SELECT TIMPOE POE/ENTID CODE     **'         
635500                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
635600                 DISPLAY '** POE CODE     = ' PV-POE-CDE                  
635700                 DISPLAY '**************************************'         
635800                 PERFORM 9100-SQL-ABEND                                   
635900         END-EVALUATE                                                     
636000     END-PERFORM.                                                         
636100                                                                          
636200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
636300         (SQLCODE NOT = ZERO    AND                                       
636400          SQLCODE NOT = -811    AND                                       
636500          SQLCODE NOT = +100)                                             
636600         DISPLAY '**********************************************'         
636700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO       **'         
636800         DISPLAY '** SELECT FROM TIMPOE                       **'         
636900         DISPLAY '** PARAGRAPH = 7157-SELECT-ENTID-TIMPOE-POE **'         
637000         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
637100         DISPLAY '** POE CODE     = ' PV-POE-CDE                          
637200         DISPLAY '****************************************'               
637300         PERFORM 9100-SQL-ABEND                                           
637400     END-IF.                                                              
637500                                                                          
637600 EJECT                                                                    
637700******************************************************************        
637800* SELECT ENTID CODE FOR OCEAN AND TRAILER TRIPS.                 *        
637900******************************************************************        
638000 7160-SELECT-ENTID-TIMFOB-EDI.                                            
638100                                                                          
638200     PERFORM                                                              
638300         WITH TEST AFTER                                                  
638400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
638500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
638600                 SQLCODE = ZERO                     OR                    
638700                 SQLCODE = -811                     OR                    
638800                 SQLCODE = +100                                           
638900                                                                          
639000         EXEC SQL                                                         
639100             SELECT CONSLR_ENT_ID                                         
639200                 ,  FOB_CDE                                               
639300              INTO :PV-CONSLR-ENT-ID                                      
639400                 , :PV-FOB-CDE-OCEAN                                      
639500               FROM TIMFOB                                                
639600              WHERE FOB_STD_EDI_CDE  = :PV-FOB-CDE                        
639700                AND STAT_CDE         = 'A'                                
639800         END-EXEC                                                         
639900                                                                          
640000         EVALUATE TRUE                                                    
640100             WHEN SQLCODE = ZERO                                          
640200             WHEN SQLCODE = -811                                          
640300                 SET PS-VALID-FOB-CDE    TO TRUE                          
640400                 MOVE PV-FOB-CDE-OCEAN   TO PV-FOB-CDE                    
640500                 IF PV-CONSLR-ENT-ID = ZEROES                             
640600                     SET PS-EMPTY-KEY-FIELDS    TO TRUE                   
640700                     SET PS-CONSLR-BLANK        TO TRUE                   
640800                 ELSE                                                     
640900                     SET PS-EMPTY-KEY-FIELDS-NO TO TRUE                   
641000                     SET PS-CONSLR-BLANK-NO     TO TRUE                   
641100                 END-IF                                                   
641200                                                                          
641300             WHEN SQLCODE = +100                                          
641400                 SET PS-INVALID-FOB-CDE         TO TRUE                   
641500                 SET PS-EMPTY-KEY-FIELDS        TO TRUE                   
641600                                                                          
641700                 WHEN SQLCODE = -911                                      
641800                 WHEN SQLCODE = -913                                      
641900                 WHEN SQLCODE = -904                                      
642000                     CONTINUE                                             
642100                                                                          
642200             WHEN SQLWARN0 NOT EQUAL SPACE                                
642300             WHEN SQLCODE NOT EQUAL ZERO                                  
642400                 DISPLAY '**************************************'         
642500                 DISPLAY '** ABEND                            **'         
642600                 DISPLAY '** PROGRAM = TMKUP625               **'         
642700                 DISPLAY '** PARAGRAPH =                      **'         
642800                 DISPLAY '**    7160-SELECT-ENTID-TIMFOB-EDI  **'         
642900                 DISPLAY '** SELECT TIMFOB ENTID CODE         **'         
643000                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
643100                 DISPLAY '** FOB CODE     = ' PV-FOB-CDE                  
643200                 DISPLAY '**************************************'         
643300                 PERFORM 9100-SQL-ABEND                                   
643400         END-EVALUATE                                                     
643500     END-PERFORM.                                                         
643600                                                                          
643700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
643800         (SQLCODE NOT = ZERO    AND                                       
643900          SQLCODE NOT = -811    AND                                       
644000          SQLCODE NOT = +100)                                             
644100         DISPLAY '**********************************************'         
644200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO       **'         
644300         DISPLAY '** SELECT FROM TIMFOB                       **'         
644400         DISPLAY '** PARAGRAPH = 7160-SELECT-ENTID-TIMFOB-EDI  *'         
644500         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
644600         DISPLAY '** FOB CODE     = ' PV-FOB-CDE                          
644700         DISPLAY '****************************************'               
644800         PERFORM 9100-SQL-ABEND                                           
644900     END-IF.                                                              
645000                                                                          
645100 EJECT                                                                    
645200******************************************************************        
645300* SELECT ENTID CODE FOR OCEAN AND TRAILER TRIPS.                 *        
645400******************************************************************        
645500 7162-SELECT-ENTID-TIMPOE-EDI.                                            
645600                                                                          
645700     PERFORM                                                              
645800         WITH TEST AFTER                                                  
645900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
646000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
646100                 SQLCODE = ZERO                     OR                    
646200                 SQLCODE = -811                     OR                    
646300                 SQLCODE = +100                                           
646400                                                                          
646500         EXEC SQL                                                         
646600             SELECT DCONSLR_ENT_ID                                        
646700                 ,  POE_CDE                                               
646800              INTO :PV-DCONSLR-ENT-ID                                     
646900                 , :PV-POE-CDE-OCEAN                                      
647000               FROM TIMPOE                                                
647100              WHERE POE_STD_EDI_CDE  = :PV-POE-CDE                        
647200                AND STAT_CDE         = 'A'                                
647300         END-EXEC                                                         
647400                                                                          
647500         EVALUATE TRUE                                                    
647600             WHEN SQLCODE = ZERO                                          
647700             WHEN SQLCODE = -811                                          
647800                 SET PS-VALID-POE-CDE    TO TRUE                          
647900                 MOVE PV-POE-CDE-OCEAN   TO PV-POE-CDE                    
648000                 EVALUATE TRUE                                            
648100                   WHEN PV-POE-CDE = 'LA'                                 
648200                   WHEN PV-POE-CDE = 'AN'                                 
648300                   WHEN PV-POE-CDE = 'SF'                                 
648400                      MOVE 6778  TO PV-DCONSLR-ENT-ID                     
648500                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
648600                   WHEN PV-POE-CDE = 'SE'                                 
648700                   WHEN PV-POE-CDE = 'TA'                                 
648800                      MOVE 11657 TO PV-DCONSLR-ENT-ID                     
648900                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
649000                   WHEN PV-POE-CDE = 'MI'                                 
649100                      MOVE 11149 TO PV-DCONSLR-ENT-ID                     
649200                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
649300                   WHEN PV-POE-CDE = 'NY'                                 
649400                   WHEN PV-POE-CDE = 'PH'                                 
649500                      MOVE 4830  TO PV-DCONSLR-ENT-ID                     
649600                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
649700                   WHEN PV-POE-CDE = 'CH'                                 
649800                   WHEN PV-POE-CDE = 'DE'                                 
649900                      MOVE 5115  TO PV-DCONSLR-ENT-ID                     
650000                      MOVE 10594 TO PV-CSTM-BKR-ENT-ID                    
650100                 END-EVALUATE                                             
650200                 IF PV-DCONSLR-ENT-ID = ZEROES                            
650300                     SET PS-EMPTY-KEY-FIELDS    TO TRUE                   
650400                     SET PS-DCONSLR-BLANK       TO TRUE                   
650500                 ELSE                                                     
650600                     SET PS-EMPTY-KEY-FIELDS-NO TO TRUE                   
650700                     SET PS-DCONSLR-BLANK-NO    TO TRUE                   
650800                 END-IF                                                   
650900                                                                          
651000             WHEN SQLCODE = +100                                          
651100                 SET PS-INVALID-POE-CDE         TO TRUE                   
651200                 SET PS-EMPTY-KEY-FIELDS        TO TRUE                   
651300                                                                          
651400                 WHEN SQLCODE = -911                                      
651500                 WHEN SQLCODE = -913                                      
651600                 WHEN SQLCODE = -904                                      
651700                     CONTINUE                                             
651800                                                                          
651900             WHEN SQLWARN0 NOT EQUAL SPACE                                
652000             WHEN SQLCODE NOT EQUAL ZERO                                  
652100                 DISPLAY '**************************************'         
652200                 DISPLAY '** ABEND                            **'         
652300                 DISPLAY '** PROGRAM = TMKUP625               **'         
652400                 DISPLAY '** PARAGRAPH =                      **'         
652500                 DISPLAY '**    7162-SELECT-ENTID-TIMPOE-EDI  **'         
652600                 DISPLAY '** SELECT TIMPOE ENTID CODE         **'         
652700                 DISPLAY '** PO NBR       = ' TM606-PO-NBR                
652800                 DISPLAY '** POE CODE     = ' PV-POE-CDE                  
652900                 DISPLAY '**************************************'         
653000                 PERFORM 9100-SQL-ABEND                                   
653100         END-EVALUATE                                                     
653200     END-PERFORM.                                                         
653300                                                                          
653400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
653500         (SQLCODE NOT = ZERO    AND                                       
653600          SQLCODE NOT = -811    AND                                       
653700          SQLCODE NOT = +100)                                             
653800         DISPLAY '**********************************************'         
653900         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO       **'         
654000         DISPLAY '** SELECT FROM TIMPOE                       **'         
654100         DISPLAY '** PARAGRAPH = 7162-SELECT-ENTID-TIMPOE-EDI  *'         
654200         DISPLAY '** PO NBR       = ' TM606-PO-NBR                        
654300         DISPLAY '** POE CODE     = ' PV-POE-CDE                          
654400         DISPLAY '****************************************'               
654500         PERFORM 9100-SQL-ABEND                                           
654600     END-IF.                                                              
654700                                                                          
654800 EJECT                                                                    
654900******************************************************************        
655000*    SELECT CHECKPOINT RESTART CONTROL INFORMATION.              *        
655100******************************************************************        
655200 7500-GET-CHECKPOINT-CNTL.                                                
655300                                                                          
655400     PERFORM WITH TEST AFTER                                              
655500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
655600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                     
655700                 SQLCODE = ZERO                                           
655800                                                                          
655900         EXEC SQL                                                         
656000           SELECT  CKPT_STAT_CODE                                         
656100             INTO :PV-CKPT-STAT-CODE                                      
656200             FROM  TCKRSTCNTL                                             
656300            WHERE  PLAN_NAME = :PC-CURRENT-PROGRAM-NAME                   
656400         END-EXEC                                                         
656500                                                                          
656600         EVALUATE TRUE                                                    
656700             WHEN SQLCODE = ZERO                                          
656800                  CONTINUE                                                
656900                                                                          
657000                 WHEN SQLCODE = -911                                      
657100                 WHEN SQLCODE = -913                                      
657200                 WHEN SQLCODE = -904                                      
657300                     CONTINUE                                             
657400                                                                          
657500             WHEN SQLWARN0 NOT EQUAL SPACE                                
657600             WHEN SQLCODE NOT EQUAL ZERO                                  
657700                 DISPLAY '**************************************'         
657800                 DISPLAY '** ABEND                            **'         
657900                 DISPLAY '** PROGRAM = TMKUP625               **'         
658000                 DISPLAY '** PARAGRAPH = 7500-GET-CHECKPOINT- **'         
658100                 DISPLAY '**                  CNTL            **'         
658200                 DISPLAY '** SELECT FROM TCKRSTCNTL           **'         
658300                 DISPLAY '**CKPT-STAT-CODE ='                             
658400                 DISPLAY              TCKRSTCNTL-CKPT-STAT-CODE           
658500                 DISPLAY '**************************************'         
658600                 PERFORM 9100-SQL-ABEND                                   
658700         END-EVALUATE                                                     
658800     END-PERFORM.                                                         
658900                                                                          
659000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
659100         SQLCODE NOT = ZERO                                               
659200         DISPLAY '****************************************'               
659300         DISPLAY '** MAX RETRIES EXCEEDED ON SELECT     **'               
659400         DISPLAY '** FROM TCKRSTCNTL                    **'               
659500         DISPLAY '** PARAGRAPH = 7500-GET-CHECKPOINT-CNTL*'               
659600         DISPLAY '****************************************'               
659700         PERFORM 9100-SQL-ABEND                                           
659800     END-IF.                                                              
659900                                                                          
660000 EJECT                                                                    
660100******************************************************************        
660200*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *        
660300******************************************************************        
660400 7510-GET-CHECKPOINT-INFO.                                                
660500                                                                          
660600     PERFORM                                                              
660700         WITH TEST AFTER                                                  
660800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
660900         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
661000                 SQLCODE = ZERO                                           
661100                                                                          
661200         EXEC SQL                                                         
661300           SELECT WORK_STRG_DESC                                          
661400           INTO :TCKRSTINF-WORK-STRG-DESC                                 
661500           FROM TCKRSTINF                                                 
661600           WHERE PLAN_NAME = :PC-CURRENT-PROGRAM-NAME                     
661700         END-EXEC                                                         
661800                                                                          
661900         EVALUATE TRUE                                                    
662000             WHEN SQLCODE = ZERO                                          
662100                  CONTINUE                                                
662200                                                                          
662300                 WHEN SQLCODE = -911                                      
662400                 WHEN SQLCODE = -913                                      
662500                 WHEN SQLCODE = -904                                      
662600                     CONTINUE                                             
662700                                                                          
662800             WHEN SQLWARN0 NOT EQUAL SPACE                                
662900             WHEN SQLCODE NOT EQUAL ZERO                                  
663000                 DISPLAY '**************************************'         
663100                 DISPLAY '** ABEND                            **'         
663200                 DISPLAY '** PROGRAM = TRKUP625               **'         
663300                 DISPLAY '** PARAGRAPH = 7510-GET-CHECKPOINT- **'         
663400                 DISPLAY '**                  INFO            **'         
663500                 DISPLAY '** SELECT FROM TCKRSTINF            **'         
663600                 DISPLAY '**************************************'         
663700                 PERFORM 9100-SQL-ABEND                                   
663800         END-EVALUATE                                                     
663900     END-PERFORM.                                                         
664000                                                                          
664100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
664200         SQLCODE NOT = ZERO                                               
664300         DISPLAY '****************************************'               
664400         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
664500         DISPLAY '** SELECT FROM TCKRSTINF              **'               
664600         DISPLAY '** PARAGRAPH = 7510-GET-CHECKPOINT-INFO*'               
664700         DISPLAY '****************************************'               
664800         PERFORM 9100-SQL-ABEND                                           
664900     END-IF.                                                              
665000                                                                          
665100 EJECT                                                                    
665200******************************************************************        
665300*    SET THE TIME FOR THE NEXT CHECKPOINT.                       *        
665400******************************************************************        
665500 7520-SET-COMMIT-TIME.                                                    
665600                                                                          
665700      EXEC SQL                                                            
665800          SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)            
665900          INTO :PV-HOLD-TMST                                              
666000          FROM TCKRSTCNTL                                                 
666100          WHERE PLAN_NAME = :PC-CURRENT-PROGRAM-NAME                      
666200      END-EXEC.                                                           
666300                                                                          
666400     EVALUATE TRUE                                                        
666500      WHEN SQLWARN0 NOT EQUAL SPACE                                       
666600      WHEN SQLCODE NOT EQUAL ZERO                                         
666700       DISPLAY '********************************************'             
666800       DISPLAY '** ABEND                                  **'             
666900       DISPLAY '** PROGRAM   = TMKUP625                   **'             
667000       DISPLAY '** PARAGRAPH = 7520-SET-COMMIT-TIME       **'             
667100       DISPLAY '** UNSUCESSFUL SET OF COMMIT INTERVAL     **'             
667200       DISPLAY 'TM606 PO NUMBER      = ' TM606-PO-NBR                     
667300       DISPLAY 'DATA SOURCE          = ' TM606-DATA-SOURCE                
667400       DISPLAY 'APPL CODE            = ' TM606-EXTR-PRCG-APPL-CDE         
667500       DISPLAY 'TOTAL COMMITS        = ' PA-TOT-COMMITS                   
667600       DISPLAY 'TOTAL PO RECS READ   = ' PA-TOT-PO-RECS-READ              
667700       DISPLAY 'TOTAL SUBR REC COUNT = ' PA-TOT-SUB-REC-COUNT             
667800       DISPLAY 'TOTAL PO DETAIL CNT  = ' PA-TOT-PO-DETAIL-COUNT           
667900       DISPLAY 'TOTAL RULE DETAIL CNT= ' PA-TOT-RULE-DETAIL-COUNT         
668000       DISPLAY 'TOTAL CONTNR DTL CNT = ' PA-TOT-CNTR-DETAIL-COUNT         
668100       DISPLAY 'TOTAL DETAIL COUNT   = ' PA-TOT-DETAIL-COUNT              
668200       DISPLAY 'TOTAL ERROR COUNT    = ' PA-TOT-ERROR-COUNT               
668300       DISPLAY 'TOTAL TOUTTM2 COUNT  = ' PA-TOT-RECS-LOADED               
668400       DISPLAY '********************************************'             
668500                                                                          
668600             PERFORM 9100-SQL-ABEND                                       
668700     END-EVALUATE.                                                        
668800                                                                          
668900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
669000         SQLCODE NOT = ZERO                                               
669100         DISPLAY '****************************************'               
669200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
669300         DISPLAY '** SELECT FROM TCKRSTCNTL             **'               
669400         DISPLAY '** PARAGRAPH = 7520-SET-COMMIT-TIME   **'               
669500         DISPLAY '****************************************'               
669600         PERFORM 9100-SQL-ABEND                                           
669700     END-IF.                                                              
669800                                                                          
669900 EJECT                                                                    
670000******************************************************************        
670100*    CHECK TO SEE IF A COMMIT SHOULD BE TAKEN.                   *        
670200******************************************************************        
670300 7530-COMMIT-CHECK.                                                       
670400                                                                          
670500     EXEC SQL                                                             
670600       SET :PV-TMST = CURRENT TIMESTAMP                                   
670700     END-EXEC.                                                            
670800                                                                          
670900     EVALUATE TRUE                                                        
671000      WHEN SQLWARN0 NOT EQUAL SPACE                                       
671100      WHEN SQLCODE NOT EQUAL ZERO                                         
671200       DISPLAY '********************************************'             
671300       DISPLAY '** ABEND                                  **'             
671400       DISPLAY '** PROGRAM   = TMKUP625                   **'             
671500       DISPLAY '** PARAGRAPH = 7530-SET-COMMIT-CHECK      **'             
671600       DISPLAY '** UNSUCESSFUL SELECT TIMESTAMP           **'             
671700       DISPLAY 'TM606 PO NUMBER      = ' TM606-PO-NBR                     
671800       DISPLAY 'DATA SOURCE          = ' TM606-DATA-SOURCE                
671900       DISPLAY 'APPL CODE            = ' TM606-EXTR-PRCG-APPL-CDE         
672000       DISPLAY 'TOTAL COMMITS        = ' PA-TOT-COMMITS                   
672100       DISPLAY 'TOTAL PO RECS READ   = ' PA-TOT-PO-RECS-READ              
672200       DISPLAY 'TOTAL SUBR REC COUNT = ' PA-TOT-SUB-REC-COUNT             
672300       DISPLAY 'TOTAL PO DETAIL CNT  = ' PA-TOT-PO-DETAIL-COUNT           
672400       DISPLAY 'TOTAL RULE DETAIL CNT= ' PA-TOT-RULE-DETAIL-COUNT         
672500       DISPLAY 'TOTAL CONTNR DTL CNT = ' PA-TOT-CNTR-DETAIL-COUNT         
672600       DISPLAY 'TOTAL DETAIL COUNT   = ' PA-TOT-DETAIL-COUNT              
672700       DISPLAY 'TOTAL ERROR COUNT    = ' PA-TOT-ERROR-COUNT               
672800       DISPLAY 'TOTAL TOUTTM2 COUNT  = ' PA-TOT-RECS-LOADED               
672900       DISPLAY '********************************************'             
673000                                                                          
673100          PERFORM 9100-SQL-ABEND                                          
673200     END-EVALUATE.                                                        
673300                                                                          
673400     IF PV-TMST > PV-HOLD-TMST                                            
673500         IF NO-COMMITS-TAKEN                                              
673600             MOVE PC-IN-PROCESS-CODE TO PV-CKPT-STAT-CODE                 
673700             PERFORM 7550-UPDATE-TCKRSTCNTL                               
673800             SET COMMITS-TAKEN TO TRUE                                    
673900         END-IF                                                           
674000        PERFORM 7560-UPDATE-TCKRSTINF                                     
674100        PERFORM 7570-COMMIT                                               
674200        DISPLAY 'COMMIT TAKEN AT '                                        
674300        DISPLAY  PV-TMST (6:2) '/' PV-TMST (9:2) '/' PV-TMST (3:2)        
674400         '  ' PV-TMST (12:2) ':' PV-TMST (15:2) ':' PV-TMST (18:2)        
674500        DISPLAY 'TM606 PO NUMBER      = ' TM606-PO-NBR                    
674600        DISPLAY 'DATA SOURCE          = ' TM606-DATA-SOURCE               
674700        DISPLAY 'APPL CODE            = ' TM606-EXTR-PRCG-APPL-CDE        
674800        DISPLAY 'TOTAL COMMITS        = ' PA-TOT-COMMITS                  
674900        DISPLAY 'PO CURSOR INPUT COUNT = ' PV-PO-INPUT-COUNT              
675000        DISPLAY 'TOTAL PO RECS READ   = ' PA-TOT-PO-RECS-READ             
675100        DISPLAY 'TOTAL SUBR REC COUNT = ' PA-TOT-SUB-REC-COUNT            
675200        DISPLAY 'TOTAL PO DETAIL CNT  = ' PA-TOT-PO-DETAIL-COUNT          
675300        DISPLAY 'TOTAL RULE DETAIL CNT= ' PA-TOT-RULE-DETAIL-COUNT        
675400        DISPLAY 'TOTAL CONTNR DTL CNT = ' PA-TOT-CNTR-DETAIL-COUNT        
675500        DISPLAY 'TOTAL DETAIL COUNT   = ' PA-TOT-DETAIL-COUNT             
675600        DISPLAY 'TOTAL ERROR COUNT    = ' PA-TOT-ERROR-COUNT              
675700        DISPLAY 'TOTAL TOUTTM2 COUNT  = ' PA-TOT-RECS-LOADED              
675800        PERFORM 7520-SET-COMMIT-TIME                                      
675900     END-IF.                                                              
676000                                                                          
676100 EJECT                                                                    
676200******************************************************************        
676300*    CHECK TO SEE IF A CHECKPOINT RESTART SHOULD BE DONE.        *        
676400******************************************************************        
676500 7540-CHECKPOINT-RESTART.                                                 
676600                                                                          
676700     PERFORM 7510-GET-CHECKPOINT-INFO.                                    
676800     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.             
676900                                                                          
677000     DISPLAY '***********************************************'.           
677100     DISPLAY '** TMKUP625 CHECKPOINT RESTART               **'.           
677200     DISPLAY '** PO CURSOR RECS BYPASSED ON RESTART = '.                  
677300     DISPLAY           CR-PO-RECS-WORKED.                                 
677400     DISPLAY '***********************************************'.           
677500                                                                          
677600     IF INPUT-PO-FILE                                                     
677700         PERFORM 7005-OPEN-PO-EXTRACT-CURSOR                              
677800         PERFORM 7015-FETCH-PO-EXTRACT-CURSOR                             
677900             CR-PO-RECS-WORKED TIMES                                      
678000         MOVE CR-COMMITS           TO PA-TOT-COMMITS                      
678100         MOVE CR-RECS-LOADED       TO PA-TOT-RECS-LOADED                  
678200         MOVE CR-ERROR-COUNT       TO PA-TOT-ERROR-COUNT                  
678300         MOVE CR-SUB-REC-COUNT     TO PA-TOT-SUB-REC-COUNT                
678400         MOVE CR-DETAIL-COUNT      TO PA-TOT-DETAIL-COUNT                 
678500         MOVE CR-PO-DETAIL-COUNT   TO PA-TOT-PO-DETAIL-COUNT              
678600         MOVE CR-RULE-DETAIL-COUNT TO PA-TOT-RULE-DETAIL-COUNT            
678700         MOVE CR-CNTR-DETAIL-COUNT TO PA-TOT-CNTR-DETAIL-COUNT            
678800         MOVE CR-IMCNTL-CNTL-ID    TO PV-IMCNTL-CNTL-ID                   
678900     ELSE                                                                 
679000         MOVE CR-PO-RECS-WORKED TO PV-PO-INPUT-COUNT                      
679100         SET PS-EOC-PO-EXTRACT-CURSOR TO TRUE                             
679200     END-IF.                                                              
679300                                                                          
679400 EJECT                                                                    
679500******************************************************************        
679600*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *        
679700*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *        
679800******************************************************************        
679900 7550-UPDATE-TCKRSTCNTL.                                                  
680000                                                                          
680100     PERFORM WITH TEST AFTER                                              
680200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
680300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                 
680400                     SQLCODE = ZERO                                       
680500                                                                          
680600         EXEC SQL                                                         
680700             UPDATE TCKRSTCNTL                                            
680800             SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE                      
680900             WHERE PLAN_NAME      = :PC-CURRENT-PROGRAM-NAME              
681000         END-EXEC                                                         
681100                                                                          
681200         EVALUATE TRUE                                                    
681300             WHEN SQLCODE = ZERO                                          
681400                  CONTINUE                                                
681500                                                                          
681600                 WHEN SQLCODE = -911                                      
681700                 WHEN SQLCODE = -913                                      
681800                 WHEN SQLCODE = -904                                      
681900                     CONTINUE                                             
682000                                                                          
682100             WHEN SQLWARN0 NOT EQUAL SPACE                                
682200             WHEN SQLCODE NOT EQUAL ZERO                                  
682300                 DISPLAY '**************************************'         
682400                 DISPLAY '** ABEND                            **'         
682500                 DISPLAY '** PROGRAM = TMKUP625               **'         
682600                 DISPLAY '** PARAGRAPH = 7550-UPDATE-TCKRSTCNTL*'         
682700                 DISPLAY '** UPDATE TCKRSTCNTL                **'         
682800                 DISPLAY '**' PV-CKPT-STAT-CODE                           
682900                 DISPLAY '**************************************'         
683000                 PERFORM 9100-SQL-ABEND                                   
683100         END-EVALUATE                                                     
683200     END-PERFORM.                                                         
683300                                                                          
683400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
683500         SQLCODE NOT = ZERO                                               
683600         DISPLAY '****************************************'               
683700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
683800         DISPLAY '** UPDATE TO TCKRSTCNTL               **'               
683900         DISPLAY '** PARAGRAPH = 7550-UPDATE-TCKRSTCNTL **'               
684000         DISPLAY '**' PV-CKPT-STAT-CODE                                   
684100         DISPLAY '****************************************'               
684200         PERFORM 9100-SQL-ABEND                                           
684300     END-IF.                                                              
684400                                                                          
684500 EJECT                                                                    
684600******************************************************************        
684700*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *        
684800*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *        
684900*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *        
685000******************************************************************        
685100 7560-UPDATE-TCKRSTINF.                                                   
685200                                                                          
685300     MOVE PV-PO-INPUT-COUNT        TO CR-PO-RECS-WORKED.                  
685400     MOVE PA-TOT-COMMITS           TO CR-COMMITS.                         
685500     MOVE PA-TOT-RECS-LOADED       TO CR-RECS-LOADED.                     
685600     MOVE PA-TOT-ERROR-COUNT       TO CR-ERROR-COUNT.                     
685700     MOVE PA-TOT-SUB-REC-COUNT     TO CR-SUB-REC-COUNT.                   
685800     MOVE PA-TOT-DETAIL-COUNT      TO CR-DETAIL-COUNT.                    
685900     MOVE PA-TOT-PO-DETAIL-COUNT   TO CR-PO-DETAIL-COUNT.                 
686000     MOVE PA-TOT-RULE-DETAIL-COUNT TO CR-RULE-DETAIL-COUNT.               
686100     MOVE PA-TOT-CNTR-DETAIL-COUNT TO CR-CNTR-DETAIL-COUNT.               
686200     MOVE PV-IMCNTL-CNTL-ID        TO CR-IMCNTL-CNTL-ID.                  
686300     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.           
686400     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.            
686500                                                                          
686600     PERFORM WITH TEST AFTER                                              
686700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
686800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                 
686900                     SQLCODE = ZERO                                       
687000                                                                          
687100         EXEC SQL                                                         
687200             UPDATE TCKRSTINF                                             
687300             SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC             
687400             WHERE PLAN_NAME      = :PC-CURRENT-PROGRAM-NAME              
687500         END-EXEC                                                         
687600                                                                          
687700         EVALUATE TRUE                                                    
687800             WHEN SQLCODE = ZERO                                          
687900                  CONTINUE                                                
688000                                                                          
688100                 WHEN SQLCODE = -911                                      
688200                 WHEN SQLCODE = -913                                      
688300                 WHEN SQLCODE = -904                                      
688400                     CONTINUE                                             
688500                                                                          
688600             WHEN SQLWARN0 NOT EQUAL SPACE                                
688700             WHEN SQLCODE NOT EQUAL ZERO                                  
688800                 DISPLAY '**************************************'         
688900                 DISPLAY '** ABEND                            **'         
689000                 DISPLAY '** PROGRAM = TMKUP625               **'         
689100                 DISPLAY '** PARAGRAPH = 7560-UPDATE-TCKRSTINF**'         
689200                 DISPLAY '** UPDATE TCKRSTINF                 **'         
689300                 DISPLAY '**' TCKRSTINF-WORK-STRG-DESC                    
689400                 DISPLAY '**************************************'         
689500                 PERFORM 9100-SQL-ABEND                                   
689600         END-EVALUATE                                                     
689700     END-PERFORM.                                                         
689800                                                                          
689900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
690000         SQLCODE NOT = ZERO                                               
690100         DISPLAY '****************************************'               
690200         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
690300         DISPLAY '** UPDATE TCKRSTINF                   **'               
690400         DISPLAY '** PARAGRAPH = 7560-UPDATE-TCKRSTINF  **'               
690500         DISPLAY '**' TCKRSTINF-WORK-STRG-DESC                            
690600         DISPLAY '****************************************'               
690700         PERFORM 9100-SQL-ABEND                                           
690800     END-IF.                                                              
690900                                                                          
691000 EJECT                                                                    
691100******************************************************************        
691200*  ISSUES AN SQL COMMIT AFTER A LOGICAL UNIT OF WORK HAS BEEN    *        
691300*  COMPLETED.                                                    *        
691400******************************************************************        
691500 7570-COMMIT.                                                             
691600                                                                          
691700     EXEC SQL                                                             
691800         COMMIT                                                           
691900     END-EXEC.                                                            
692000                                                                          
692100     EVALUATE TRUE                                                        
692200      WHEN SQLWARN0 NOT EQUAL SPACE                                       
692300      WHEN SQLCODE NOT EQUAL ZERO                                         
692400       DISPLAY '********************************************'             
692500       DISPLAY '** ABEND                                  **'             
692600       DISPLAY '** PROGRAM = TMKUP625                     **'             
692700       DISPLAY '** PARAGRAPH = 7570-COMMIT                **'             
692800       DISPLAY '** UNSUCCESSFUL COMMIT                    **'             
692900       DISPLAY '********************************************'             
693000       DISPLAY 'TM606 PO NUMBER      = ' TM606-PO-NBR                     
693100       DISPLAY 'DATA SOURCE          = ' TM606-DATA-SOURCE                
693200       DISPLAY 'APPL CODE            = ' TM606-EXTR-PRCG-APPL-CDE         
693300       DISPLAY 'TOTAL COMMITS        = ' PA-TOT-COMMITS                   
693400       DISPLAY 'PO CURSOR INPUT COUNT = ' PV-PO-INPUT-COUNT               
693500       DISPLAY 'TOTAL PO RECS READ   = ' PA-TOT-PO-RECS-READ              
693600       DISPLAY 'TOTAL SUBR REC COUNT = ' PA-TOT-SUB-REC-COUNT             
693700       DISPLAY 'TOTAL PO DETAIL CNT  = ' PA-TOT-PO-DETAIL-COUNT           
693800       DISPLAY 'TOTAL RULE DETAIL CNT= ' PA-TOT-RULE-DETAIL-COUNT         
693900       DISPLAY 'TOTAL CONTNR DTL CNT = ' PA-TOT-CNTR-DETAIL-COUNT         
694000       DISPLAY 'TOTAL DETAIL COUNT   = ' PA-TOT-DETAIL-COUNT              
694100       DISPLAY 'TOTAL ERROR COUNT    = ' PA-TOT-ERROR-COUNT               
694200       DISPLAY 'TOTAL TOUTTM2 COUNT  = ' PA-TOT-RECS-LOADED               
694300       DISPLAY '********************************************'             
694400                                                                          
694500          PERFORM 9100-SQL-ABEND                                          
694600                                                                          
694700      WHEN SQLCODE EQUAL ZERO                                             
694800          ADD +1 TO PA-TOT-COMMITS                                        
694900     END-EVALUATE.                                                        
695000                                                                          
695100 EJECT                                                                    
695200******************************************************************        
695300* TAKES A FINAL COMMIT, UPDATES THE REPORTING CONTROL NUMBER ON  *        
695400* TIMCNTL, AND DISPLAYS MISCELLANEOUS JOB SUMMARY INFORMATION.   *        
695500******************************************************************        
695600 8000-EOJ-ROUTINE.                                                        
695700                                                                          
695800     PERFORM 7115-UPDATE-TIMCNTL-CNTL-NBR.                                
695900                                                                          
696000     PERFORM 7570-COMMIT.                                                 
696100     DISPLAY 'COMMIT TAKEN AT '.                                          
696200     DISPLAY  PV-TMST (6:2) '/' PV-TMST (9:2) '/' PV-TMST (3:2)           
696300      '  ' PV-TMST (12:2) ':' PV-TMST (15:2) ':' PV-TMST (18:2).          
696400                                                                          
696500     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.                      
696600     PERFORM 7550-UPDATE-TCKRSTCNTL.                                      
696700                                                                          
696800     DISPLAY '*************************************************'.         
696900     DISPLAY '**      TMKUP625  SUMMARY                      **'.         
697000     DISPLAY 'TOTAL COMMITS        = ' PA-TOT-COMMITS.                    
697100     DISPLAY 'TOTAL PO RECS READ   = ' PA-TOT-PO-RECS-READ.               
697200     DISPLAY 'TOTAL SUBR REC COUNT = ' PA-TOT-SUB-REC-COUNT.              
697300     DISPLAY 'TOTAL PO DETAIL CNT  = ' PA-TOT-PO-DETAIL-COUNT.            
697400     DISPLAY 'TOTAL RULE DTL COUNT = ' PA-TOT-RULE-DETAIL-COUNT.          
697500     DISPLAY 'TOTAL CONTNR DTL CNT = ' PA-TOT-CNTR-DETAIL-COUNT.          
697600     DISPLAY 'TOTAL DETAIL COUNT   = ' PA-TOT-DETAIL-COUNT.               
697700     DISPLAY 'TOTAL ERROR COUNT    = ' PA-TOT-ERROR-COUNT.                
697800     DISPLAY 'TOTAL TOUTTM2 COUNT  = ' PA-TOT-RECS-LOADED.                
697900     DISPLAY '*************************************************'.         
698000                                                                          
698100 EJECT                                                                    
698200******************************************************************        
698300* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *        
698400* ERROR OR WARNING CODE OCCURS.                                  *        
698500******************************************************************        
698600 9100-SQL-ABEND.                                                          
698700******************************************************************        
698800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *        
698900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *        
699000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *        
699100* FORMAT.                                                        *        
699200******************************************************************        
699300                                                                          
699400     COPY DPPD004.                                                        
699500                                                                          
699600     DISPLAY 'EXCEPTION PROCESSING ABEND'                                 
699700     DISPLAY 'PO NUMBER        '  TM606-PO-NBR.                           
699800     MOVE +4013 TO ABEND-CODE.                                            
699900     CALL 'ILBOABN0' USING ABEND-CODE.                                    
700000                                                                          
