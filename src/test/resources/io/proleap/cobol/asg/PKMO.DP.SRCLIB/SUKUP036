000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400*                                                                 00040000
000500 PROGRAM-ID.             SUKUP036.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           SEPTEMBER, 2018.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000*                                                                 00100000
001100***************************************************************** 00110000
001200* THIS PROGRAM WILL BE USED TO DELETE ROWS FROM THE PO AUDIT      00120001
001300* EXCEPTION DATABASE (SUT_PO_AUD_EXC)                             00130001
001330***************************************************************** 00133000
001340 ENVIRONMENT DIVISION.                                            00134000
001350***************************************************************** 00135000
001360 CONFIGURATION SECTION.                                           00136000
001370 SOURCE-COMPUTER.                        IBM-3090.                00137000
001380 OBJECT-COMPUTER.                        IBM-3090.                00138000
001390 INPUT-OUTPUT SECTION.                                            00139000
001400 FILE-CONTROL.                                                    00140000
001500                                                                  00150000
001600     SELECT EXTRACT-FILE                                          00160000
001700         ASSIGN TO INP01.                                         00170000
001800/                                                                 00180000
001900***************************************************************** 00190000
002000 DATA DIVISION.                                                   00200000
002100***************************************************************** 00210000
002200 FILE SECTION.                                                    00220000
002300                                                                  00230000
002400 FD  EXTRACT-FILE                                                 00240000
002500     RECORDING MODE IS F                                          00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     BLOCK CONTAINS 0 RECORDS.                                    00270000
002800 01  EXTRACT-RECORD                   PIC X(100).                 00280000
002900/                                                                 00290000
003000***************************************************************** 00300000
003100 WORKING-STORAGE SECTION.                                         00310000
003200***************************************************************** 00320000
003300                                                                  00330000
003400 01  PS-SWITCHES.                                                 00340000
003500     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00350000
003600         88  PS-END-OF-INPUT                    VALUE 'Y'.        00360000
003700         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00370000
003800                                                                  00380000
003900 01  PV-VARIABLES.                                                00390000
004000     05  PV-COUNT                     PIC  9(09) VALUE ZERO.      00400000
004100     05  PV-COMMIT-CNT                PIC  9(09) VALUE ZERO.      00410000
004200     05  PV-READ-CNT                  PIC  9(09) VALUE ZERO.      00420000
004400     05  PV-DELETE-CNT                PIC  9(09) VALUE ZERO.      00440001
004800     05  PV-NOT-FND-CNT               PIC  9(09) VALUE ZERO.      00480002
004900     05  PV-DISPLAY-CNT               PIC  ZZZ,ZZZ,ZZ9.           00490000
005100                                                                  00510000
005200******************************************************************00520000
005300 01  PV-ABEND-FIELDS.                                             00530000
005400     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00540000
005500                                                 COMP SYNC.       00550000
005600     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUP036'.00560000
005700     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00570000
005800     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    00580000
005900     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    00590000
006000     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    00600000
006100     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    00610000
006200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00620000
006300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00630000
006400     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00640000
006500     05  PV-DB2-FUNCTION              PIC  X(50) VALUE SPACES.    00650000
006600/                                                                 00660000
006700 01  PC-CONSTANTS.                                                00670000
006800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUP036'. 00680000
006900     05  PC-COMMIT-HOLD               PIC 9(3)  VALUE 100.        00690000
007000     05  PC-COUNT-HOLD                PIC 9(9)  VALUE 100000.     00700000
007100                                                                  00710000
007200******************************************************************00720000
007300*  LAYOUT FOR EXTRACT FILE                                        00730000
007400******************************************************************00740000
007500     COPY SURD165.                                                00750001
007600*                                                                 00760000
007700******************************************************************00770000
007800*  DB2 FORMATTED MESSAGE AREA                                     00780000
007900******************************************************************00790000
008000     COPY DPWS004.                                                00800000
008100                                                                  00810000
008200******************************************************************00820000
008300*   DB2 SQL COMMUNICATION AREA                                    00830000
008400******************************************************************00840000
008500     EXEC SQL                                                     00850000
008600         INCLUDE SQLCA                                            00860000
008700     END-EXEC.                                                    00870000
008800*                                                                 00880000
008900     COPY SQLCA2.                                                 00890000
009000*                                                                 00900000
009100******************************************************************00910000
009200*   SUT_PO_AUD_EXC                                                00920001
009300******************************************************************00930000
009400*                                                                 00940000
009500     EXEC SQL                                                     00950000
009600         INCLUDE SUT00014                                         00960001
009700     END-EXEC.                                                    00970000
009800                                                                  00980001
011500******************************************************************01150000
011600 PROCEDURE DIVISION.                                              01160000
011700******************************************************************01170000
011800 0000-MAINLINE.                                                   01180000
011900                                                                  01190000
012000     PERFORM 1000-INITIALIZE.                                     01200000
012100                                                                  01210000
012200     PERFORM 2000-PROCESS-EXTRACT                                 01220000
012300         UNTIL PS-END-OF-INPUT.                                   01230000
012400                                                                  01240000
012500     PERFORM 9000-EOJ.                                            01250000
012600                                                                  01260000
012700      GOBACK.                                                     01270000
012800                                                                  01280000
012900******************************************************************01290000
013000*  INITIALIZATION TASKS.                                          01300000
013100*    -- OPEN INPUT FILE                                           01310000
013200*    -- READ FILE                                                 01320000
013300******************************************************************01330000
013400 1000-INITIALIZE.                                                 01340000
013500                                                                  01350000
013600     OPEN INPUT  EXTRACT-FILE.                                    01360000
013700                                                                  01370000
013800     PERFORM 2100-READ-EXTRACT.                                   01380000
013900/                                                                 01390000
014000******************************************************************01400000
014100 2000-PROCESS-EXTRACT.                                            01410000
014200******************************************************************01420000
014300*                                                                 01430000
014400     IF  PV-COUNT  <  PC-COUNT-HOLD                               01440000
014500         CONTINUE                                                 01450000
014600     ELSE                                                         01460000
014700         MOVE PV-READ-CNT  TO  PV-DISPLAY-CNT                     01470000
014800         DISPLAY 'READ:  '     PV-DISPLAY-CNT                     01480000
014900         MOVE  ZEROES  TO      PV-COUNT                           01490000
015000     END-IF.                                                      01500000
015100                                                                  01510000
015200     MOVE SU165-PO-NBR             TO SUT00014-PO-NBR.            01520001
015210     MOVE SU165-PO-LNE-NBR         TO SUT00014-PO-LNE-NBR.        01521001
015220     MOVE SU165-PO-PREPK-ID        TO SUT00014-PO-PREPK-ID.       01522001
015230     MOVE SU165-OPER-UNT-ID        TO SUT00014-OPER-UNT-ID.       01523001
015240     MOVE SU165-AUD-TYP-CDE        TO SUT00014-AUD-TYP-CDE.       01524001
015250     MOVE SU165-CRE-TMST           TO SUT00014-CRE-TMST.          01525001
015260     MOVE SU165-LAST-UPD-TMST      TO SUT00014-LAST-UPD-TMST.     01526001
015270     MOVE SU165-LAST-UPD-BY-USR-ID TO SUT00014-LAST-UPD-BY-USR-ID.01527001
015830                                                                  01583001
015900     PERFORM 8100-DELETE-RECORD.                                  01590002
016400     ADD +1 TO PV-COMMIT-CNT.                                     01640002
016700                                                                  01670000
017100     IF PV-COMMIT-CNT > PC-COMMIT-HOLD                            01710000
017200         PERFORM 2200-COMMIT-DELETE                               01720000
017300     END-IF.                                                      01730000
017400                                                                  01740000
017500     PERFORM 2100-READ-EXTRACT.                                   01750000
017600                                                                  01760001
017610                                                                  01761001
017700******************************************************************01770000
017800*  READ NEXT INPUT FILE RECORD.                                   01780000
017900******************************************************************01790000
018000 2100-READ-EXTRACT.                                               01800000
018100                                                                  01810000
018200     READ EXTRACT-FILE INTO SU165-EXTRACT-RECORD                  01820001
018300        AT END                                                    01830000
018400           SET PS-END-OF-INPUT TO TRUE                            01840000
018500        NOT AT END                                                01850000
018600           ADD +1                   TO PV-READ-CNT                01860000
018700                                       PV-COUNT                   01870000
018800     END-READ.                                                    01880000
018900*                                                                 01890000
019000******************************************************************01900000
019100* COMMIT THE DELETE FROM ERROR TABLE                              01910000
019200******************************************************************01920000
019300 2200-COMMIT-DELETE.                                              01930000
019400                                                                  01940000
019500      EXEC SQL                                                    01950000
019600         COMMIT                                                   01960000
019700      END-EXEC                                                    01970000
019800                                                                  01980000
019900      MOVE +0 TO PV-COMMIT-CNT.                                   01990000
020000                                                                  02000000
023000******************************************************************02300000
023100* DELETE THE OUTBOUND DATABASE                                    02310000
023200******************************************************************02320000
023300 8100-DELETE-RECORD.                                              02330001
023400                                                                  02340000
023500     EXEC SQL                                                     02350000
023600          DELETE                                                  02360000
023700            FROM  SUT_PO_AUD_EXC                                  02370001
023800           WHERE PO_NBR             = :SUT00014-PO-NBR            02380001
023810             AND PO_LNE_NBR         = :SUT00014-PO-LNE-NBR        02381001
023820             AND PO_PREPK_ID        = :SUT00014-PO-PREPK-ID       02382001
023830             AND OPER_UNT_ID        = :SUT00014-OPER-UNT-ID       02383001
023840             AND AUD_TYP_CDE        = :SUT00014-AUD-TYP-CDE       02384001
023850             AND CRE_TMST           = :SUT00014-CRE-TMST          02385001
023860             AND LAST_UPD_TMST      = :SUT00014-LAST-UPD-TMST     02386001
023870             AND LAST_UPD_BY_USR_ID = :SUT00014-LAST-UPD-BY-USR-ID02387001
023900     END-EXEC.                                                    02390000
024000                                                                  02400000
024100     EVALUATE TRUE                                                02410000
024200         WHEN SQLCODE = 0                                         02420000
024300             ADD +1           TO PV-DELETE-CNT                    02430001
024301         WHEN SQLCODE = +100                                      02430100
024302             ADD +1           TO PV-NOT-FND-CNT                   02430201
024305         WHEN OTHER                                               02430501
024308             MOVE '8100-DELETE-RECORD      '                      02430801
024309                         TO PV-ABEND-PARAGRAPH                    02430900
024310             MOVE 'DELETE OF SUT_PO-AUD-EXC '                     02431001
024311                         TO PV-DB2-FUNCTION                       02431100
024312             PERFORM 9200-SQL-ABEND                               02431200
024313     END-EVALUATE.                                                02431300
024343******************************************************************02434300
024344*CLOSE INPUT FILE.                                                02434400
024345******************************************************************02434500
024346 9000-EOJ.                                                        02434600
024347*                                                                 02434700
024348     CLOSE EXTRACT-FILE.                                          02434800
024349                                                                  02434900
024350     MOVE PV-READ-CNT           TO PV-DISPLAY-CNT.                02435000
024360     DISPLAY 'READ:              ' PV-DISPLAY-CNT.                02436000
024361                                                                  02436101
024390     MOVE PV-DELETE-CNT         TO PV-DISPLAY-CNT.                02439002
024400     DISPLAY 'DELETE:            ' PV-DISPLAY-CNT.                02440001
024500                                                                  02450001
024700     MOVE PV-NOT-FND-CNT        TO PV-DISPLAY-CNT.                02470001
024800     DISPLAY 'NOT FOUND:         ' PV-DISPLAY-CNT.                02480001
024900                                                                  02490001
025200     DISPLAY 'PRC MSG COUNT:     ' PV-DISPLAY-CNT.                02520000
025300                                                                  02530000
025400******************************************************************02540000
025500 9200-SQL-ABEND.                                                  02550000
025600******************************************************************02560000
025700                                                                  02570000
025800     MOVE SQLCODE                     TO SQLCODE2.                02580000
025900     MOVE SQLERRD(3)                  TO SQLERRD3.                02590000
026000                                                                  02600000
026100     DISPLAY '** ABEND **         ** = SQLERROR'.                 02610000
026200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02620000
026300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             02630000
026400     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02640000
026401     DISPLAY ' '.                                                 02640101
026410     DISPLAY '** AUDIT TYPE   = ' SU165-AUD-TYP-CDE.              02641001
026420     DISPLAY '**  PO          = ' SU165-OPER-UNT-ID               02642001
026500                              '-' SU165-PO-NBR                    02650001
026501     DISPLAY '**  LINE        = ' SU165-PO-LNE-NBR                02650101
026510     DISPLAY '**  PREPACK     = ' SU165-PO-PREPK-ID.              02651001
026800                                                                  02680000
026810     DISPLAY ' '.                                                 02681001
026900     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                02690000
027000     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                02700000
027100     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 02710000
027200     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                02720000
027300                                                                  02730000
027400                                                                  02740000
027500     MOVE +4013                       TO PV-ABEND-CODE.           02750000
027600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02760000
027700                                                                  02770000
