000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT074.                                         00020000
000300 AUTHOR.        DENISE HAHN.                                      00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   APRIL, 2020.                                      00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*   AHKUT074. THIS PROGRAM IS TO EXTRACT OLD TRIP RECORDS FROM   *00090000
001000*   RCT_TRLR_UNLD WHERE THE TRIP HAS ALREADY PURGED FROM THE     *00100001
001100*   THE TVHTRIP DATABASE.                                        *00110000
001200*                                                                *00120000
001300*   THIS WILL BE USED AS A CONTROLLED PURGE OF THE OLD ROWS..    *00130000
001400*   FROM THE FILE CREATED, AHKUP074 WILL PURGE THE DATA FROM     *00140000
001500*   THE RCT_TRLR_UNLD DATABASE WITH CASCADE DELETE TO            *00150000
001600*   RCT_RCVR_TRLR_LST.                                           *00160000
001700*                                                                *00170000
002000******************************************************************00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200 CONFIGURATION SECTION.                                           00220000
002300 SOURCE-COMPUTER.        IBM-3090.                                00230000
002400 OBJECT-COMPUTER.        IBM-3090.                                00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700 FILE-CONTROL.                                                    00270000
002800                                                                  00280000
002900     SELECT  OUT-DRIVER-FILE              ASSIGN TO OUT01.        00290000
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400 FD  OUT-DRIVER-FILE                                              00340000
003500     RECORDING MODE IS F                                          00350000
003600     LABEL RECORDS ARE STANDARD                                   00360000
003700     BLOCK CONTAINS 0 RECORDS.                                    00370000
003800 01  OUT-DRIVER-RECORD               PIC  X(101).                 00380000
003900                                                                  00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100                                                                  00410000
004200 01  PC-PROGRAM-CONSTANTS.                                        00420000
004300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT074'.  00430000
004400     05  PC-PGM-PROGRESS-DESC.                                    00440000
004500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00450000
004600         10  PC-OPEN-CSR             PIC X(13) VALUE              00460000
004700                                               'OPEN CURSOR  '.   00470000
004800         10  PC-CONTINUING           PIC X(10) VALUE              00480000
004900                                               'CONTINUING'.      00490000
005000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00500000
005100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00510000
005200     05  PC-ABEND-INFO.                                           00520000
005300         10  PC-ABEND                PIC X(11) VALUE              00530000
005400                                               '** ABEND **'.     00540000
005500         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00550000
005600                                               '- PARA       : '. 00560000
005700         10  PC-ABEND-MSG-DISPLAY-PARA                            00570000
005800                                     PIC X(15) VALUE              00580000
005900                                               '  CALLED PARA: '. 00590000
006000         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00600000
006100                                               '  FOR ABEND# : '. 00610000
006200         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00620000
006300                                               '- ERROR IS   : '. 00630000
006400         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00640000
006500         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00650000
006600                                               '- ACTION     : '. 00660000
006700     05  PC-TEST-AND-SET-NULL-IND.                                00670000
006800         10  PC-NOT-NULL             PIC S9(4) COMP               00680000
006900                                               VALUE ZERO.        00690000
007000         10  PC-NULL                 PIC S9(4) COMP               00700000
007100                                               VALUE -1.          00710000
007200         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00720000
007300                                               VALUE -2.          00730000
007400         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00740000
007500                                                                  00750000
007600     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100000.      00760000
007700                                                                  00770000
007800 01  PS-PROGRAM-SWITCHES.                                         00780000
007900     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00790000
008000         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00800000
008100         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00810000
008200     05  PS-BYPASS-PO-IND            PIC X(01) VALUE 'N'.         00820000
008300         88  BYPASS-THIS-PO                    VALUE 'Y'.         00830000
008400         88  PROCESS-THIS-PO                   VALUE 'N'.         00840000
008500                                                                  00850000
008600 01  PV-PROGRAM-VARIABLES.                                        00860000
008700     05  PV-ONE                      PIC X     VALUE SPACES.      00870000
008900     05  DISPLAY-TRIP-ID             PIC  ZZZZZZZZ9.              00890000
009000     05  PV-RLS-TMST                 PIC X(26) VALUE SPACES.      00900000
009100     05  PV-RLS-TMST-DETAIL REDEFINES PV-RLS-TMST.                00910000
009200         10  PV-RLS-DATE             PIC X(10).                   00920000
009300         10  PV-RLS-TIME             PIC X(16).                   00930000
009400     05  PV-SELECT-INTO-FIELD        PIC  X VALUE SPACES.         00940000
009500     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00950000
009600     05  PV-DRIVER-WRITTEN-CNT       PIC  9(9) VALUE 0.           00960000
009700     05  PV-PROCESS-COUNT            PIC  ZZZ,ZZZ,ZZZ.            00970007
009900     05  PV-NULL-INDICATORS.                                      00990000
010000         10  PV-NULL-IND-INIT-INVC-ID                             01000000
010100                                     PIC S9(4) COMP               01010000
010200                                               VALUE 0.           01020000
010300     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01030000
010400     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01040000
010500     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      01050000
010600     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      01060000
010700     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01070000
010800     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01080000
010900     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01090000
011000                                                                  01100000
011100     05  PV-TMST                     PIC X(26) VALUE SPACES.      01110000
011200     05  PV-TIMESTAMP-DETAIL                                      01120000
011300         REDEFINES                                                01130000
011400         PV-TMST.                                                 01140000
011500         10  PV-TIMESTAMP-19.                                     01150000
011600             15  PV-TMS-DATE.                                     01160000
011700                 20  PV-TMS-YEAR.                                 01170000
011800                     25  PV-TMS-CC   PIC X(02).                   01180000
011900                     25  PV-TMS-YY   PIC X(02).                   01190000
012000                 20  FILLER          PIC X(01).                   01200000
012100                 20  PV-TMS-MONTH    PIC X(02).                   01210000
012200                 20  FILLER          PIC X(01).                   01220000
012300                 20  PV-TMS-DAY      PIC X(02).                   01230000
012400             15  FILLER              PIC X(01).                   01240000
012500             15  PV-TMS-HOUR         PIC X(02).                   01250000
012600             15  FILLER              PIC X(01).                   01260000
012700             15  PV-TMS-MINUTE       PIC X(02).                   01270000
012800             15  FILLER              PIC X(01).                   01280000
012900             15  PV-TMS-SECOND       PIC X(02).                   01290000
013000         10  FILLER                  PIC X(01).                   01300000
013100         10  PV-TMS-MSECOND          PIC X(06).                   01310000
013110     05  PV-NULL-IND                 PIC S9(04)  VALUE ZEROS      01311006
013120                                                 COMP SYNC.       01312006
013130     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      01313006
013140                                                 COMP SYNC.       01314006
013150     05  PV-NULL-IND-3               PIC S9(04)  VALUE ZEROS      01315006
013160                                                 COMP SYNC.       01316006
013200                                                                  01320000
013300                                                                  01330000
014000 01  DM-DISPLAY-MESSAGE.                                          01400000
014100     05  DM-01-10.                                                01410000
014200         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01420000
014300         10  FILLER                  PIC X(02) VALUE ': '.        01430000
014400     05  DM-11-80.                                                01440000
014500         10  FILLER                  PIC X(27) VALUE              01450000
014600                                    'BEGIN DRIVER FILE CREATION.'.01460000
014700         10  FILLER                  PIC X(01) VALUE SPACE.       01470000
014800         10  FILLER                  PIC X(42) VALUE ALL '*'.     01480000
014900     05  DM-81-120.                                               01490000
015000         10  FILLER                  PIC X(40) VALUE ALL '*'.     01500000
015100                                                                  01510000
015200 01  DP-DISPLAY-PROGRESS-MSG.                                     01520000
015300     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01530000
015400     05  FILLER                      PIC X(02) VALUE SPACE.       01540000
015500     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01550000
015600     05  FILLER                      PIC X(04) VALUE ' AT '.      01560000
015700     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01570000
015800     05  FILLER                      PIC X(03) VALUE '.  '.       01580000
015900     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01590000
016000     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01600000
016100                                               VALUE ZERO.        01610000
016200     05  FILLER                      PIC X(02) VALUE ', '.        01620000
016300     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01630000
016400     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01640000
016500                                               VALUE ZERO.        01650000
016600     05  FILLER                      PIC X(01) VALUE '.'.         01660000
016700                                                                  01670000
016800 01  ABEND-CODE                      PIC S9(04)                   01680000
016900                                               VALUE ZEROES       01690000
017000                                               COMP SYNC.         01700000
017100                                                                  01710000
017200*---------------------------------------------------------------* 01720000
017300*  DB2 FORMATTED MESSAGE AREA                                     01730000
017400*---------------------------------------------------------------* 01740000
017500     COPY DPWS004.                                                01750000
017600                                                                  01760000
017700*---------------------------------------------------------------* 01770000
017800*    DB2 AREA FOR TVHTRIP                                       * 01780002
017900*---------------------------------------------------------------* 01790000
018000     EXEC SQL                                                     01800000
018100          INCLUDE TVHTRIP                                         01810002
018200     END-EXEC.                                                    01820000
018300                                                                  01830000
018400*---------------------------------------------------------------* 01840000
018500*    DB2 AREA FOR RCT_TRLR_UNLD                                 * 01850001
018600*---------------------------------------------------------------* 01860000
018700     EXEC SQL                                                     01870000
018800          INCLUDE RCT00014                                        01880001
018900     END-EXEC.                                                    01890000
019000                                                                  01900000
019080*---------------------------------------------------------------* 01908001
019090*    DB2 AREA FOR TVEHICL                                       * 01909001
019091*---------------------------------------------------------------* 01909101
019092     EXEC SQL                                                     01909201
019093          INCLUDE TVEHICL                                         01909301
019094     END-EXEC.                                                    01909401
019095                                                                  01909501
019100*---------------------------------------------------------------* 01910000
019200*    DB2 AREA FOR SYSDUMMY                                      * 01920000
019300*---------------------------------------------------------------* 01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE SYSDUMMY                                        01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800*---------------------------------------------------------------* 01980000
019900*    DB2 AREA FOR COMMUNICATIONS                                * 01990000
020000*---------------------------------------------------------------* 02000000
020100     EXEC SQL                                                     02010000
020200          INCLUDE SQLCA                                           02020000
020300     END-EXEC.                                                    02030000
020400                                                                  02040000
020500*---------------------------------------------------------------* 02050000
020600*    DEFINE CURSOR FOR RCT_TRLR_UNLD ENTRIES WHERE PO'S HAVE    * 02060001
020700*    PURGED                                                     * 02070000
020800*---------------------------------------------------------------* 02080000
020900     EXEC SQL                                                     02090000
021000         DECLARE TABLE-CURSOR CURSOR FOR                          02100000
021100           SELECT DISTINCT A.TRIP_ID                              02110001
021200             FROM RCT_TRLR_UNLD A                                 02120001
021300            WHERE NOT A.TRIP_ID IN                                02130001
021400                (SELECT DISTINCT B.TRIP_ID                        02140001
021500                   FROM TVHTRIP B)                                02150001
021600            ORDER BY A.TRIP_ID                                    02160005
021700             WITH UR                                              02170000
021800     END-EXEC.                                                    02180000
021900                                                                  02190000
022000                                                                  02200000
022100 PROCEDURE DIVISION.                                              02210000
022200                                                                  02220000
022300 0000-PROGRAM-MAINLINE.                                           02230000
022400                                                                  02240000
022500     PERFORM 1000-INITIALIZE.                                     02250000
022600                                                                  02260000
022700     PERFORM 2000-GET-NEXT-FROM-CURSOR                            02270000
022800         UNTIL PS-TABLE-LOOP-DONE.                                02280000
022900                                                                  02290000
023000     PERFORM 6000-EOJ-ROUTINE.                                    02300000
023100     STOP RUN.                                                    02310000
023200                                                                  02320000
023300                                                                  02330000
023400******************************************************************02340000
023500*  INITIALIZATIONS                                               *02350000
023600******************************************************************02360000
023700 1000-INITIALIZE.                                                 02370000
023800                                                                  02380000
023900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02390000
024000     DISPLAY DM-DISPLAY-MESSAGE.                                  02400000
024100                                                                  02410000
024200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02420000
024300     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02430000
024400                                                                  02440000
024500     OPEN OUTPUT OUT-DRIVER-FILE.                                 02450000
024600                                                                  02460000
024700     SET PS-TABLE-LOOP-NOT-DONE TO TRUE.                          02470000
024800     PERFORM 9100-OPEN-TABLE-CURSOR.                              02480000
024900     MOVE PC-OPEN-CSR      TO DP-STATUS-DESCRIPTION.              02490000
025000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02500000
025100                                                                  02510000
025200     PERFORM 9200-TVEHICL-FORMAT.                                 02520001
025300                                                                  02530000
025400     PERFORM 9110-FETCH-TABLE-CURSOR.                             02540000
025500                                                                  02550000
025600     IF PS-TABLE-LOOP-DONE                                        02560000
025700        DISPLAY 'NO PO SELECTED FROM CURSOR'                      02570000
025800     END-IF.                                                      02580000
025900                                                                  02590000
026000******************************************************************02600000
026100*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02610000
026200******************************************************************02620000
026300 2000-GET-NEXT-FROM-CURSOR.                                       02630000
026400                                                                  02640000
026500     MOVE RCT00014-TRIP-ID  TO DISPLAY-TRIP-ID.                   02650002
026600*    DISPLAY 'TRIP:  '         DISPLAY-TRIP-ID.                   02660002
026700                                                                  02670000
027000     MOVE RCT00014-TRIP-ID         TO VEHICL-CURR-TRIP-ID.        02700004
027100                                                                  02710000
027200     PERFORM 9650-WRITE-DRIVER-RECORD                             02720000
027300                                                                  02730000
027400     PERFORM 2100-CHECK-PGM-PROGRESS                              02740000
027500                                                                  02750000
027800     PERFORM 9110-FETCH-TABLE-CURSOR.                             02780000
027900                                                                  02790000
028000******************************************************************02800000
028100*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02810000
028200*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02820000
028300*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02830000
028400******************************************************************02840000
028500 2100-CHECK-PGM-PROGRESS.                                         02850000
028600     DIVIDE    PV-DRIVER-WRITTEN-CNT                              02860000
028700         BY        PC-HOW-OFTEN-TO-DISPLAY                        02870000
028800         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02880000
028900         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02890000
029000                                                                  02900000
029100     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02910000
029200         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02920000
029300         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02930000
029400     END-IF.                                                      02940000
029500                                                                  02950000
029600******************************************************************02960000
029700*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02970000
029800******************************************************************02980000
029900 6000-EOJ-ROUTINE.                                                02990000
030000                                                                  03000000
030100     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   03010000
030200                                                                  03020000
030300     CLOSE OUT-DRIVER-FILE.                                       03030000
030400                                                                  03040000
030500     PERFORM 9130-CLOSE-TABLE-CURSOR.                             03050000
030600                                                                  03060000
030700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03070000
030800                                                                  03080000
030810     MOVE PV-DRIVER-WRITTEN-CNT  TO PV-PROCESS-COUNT.             03081007
030900     DISPLAY 'TOTAL TRIP EXTRACT: ' PV-PROCESS-COUNT.             03090007
031100                                                                  03110000
031200******************************************************************03120000
031300*  DISPLAY PROGRAM PROGRESS.                                     *03130000
031400******************************************************************03140000
031500 6200-DISPLAY-PGM-PROGRESS.                                       03150000
031600                                                                  03160000
031700     EXEC SQL                                                     03170000
031800          SET :PV-TMST = CURRENT TIMESTAMP                        03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03210000
032200     MOVE PV-TMST                   TO DP-TIMESTAMP.              03220000
032300     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  03230000
032400     MOVE PV-DRIVER-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.     03240000
032500                                                                  03250000
032600     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03260000
032700                                                                  03270000
032800                                                                  03280000
032900******************************************************************03290000
033000*  OPEN   TABLE CURSOR                                           *03300000
033100******************************************************************03310000
033200 9100-OPEN-TABLE-CURSOR.                                          03320000
033300     EXEC SQL                                                     03330000
033400          OPEN TABLE-CURSOR                                       03340000
033500     END-EXEC.                                                    03350000
033600                                                                  03360000
033700     EVALUATE TRUE                                                03370000
033800         WHEN SQLCODE = ZERO                                      03380000
033900              CONTINUE                                            03390000
034000         WHEN SQLCODE = +100                                      03400000
034100              SET PS-TABLE-LOOP-DONE TO TRUE                      03410000
034200              MOVE '9100-OPEN-TABLE-CURSOR'                       03420000
034300                                  TO PV-PARAGRAPH-NAME            03430000
034400              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         03440000
034500                                  TO PV-DB2-OPERATION-MSG-1       03450000
034600              MOVE 'RCT_TRLR_UNLD' TO PV-DB2-TABLE-NAME-1         03460001
034700              MOVE 'TVHTRIP'      TO PV-DB2-TABLE-NAME-2          03470002
034800              PERFORM 9999-DB2-ABEND                              03480000
034900         WHEN SQLWARN0 NOT EQUAL SPACE                            03490000
035000         WHEN SQLCODE  NOT EQUAL ZERO                             03500000
035100              MOVE '9100-OPEN-TABLE-CURSOR'                       03510000
035200                                  TO PV-PARAGRAPH-NAME            03520000
035300              MOVE 'OPEN TABLE CURSOR'                            03530000
035400                                  TO PV-DB2-OPERATION-MSG-1       03540000
035500              MOVE 'RCT_TRLR_UNLD' TO PV-DB2-TABLE-NAME-1         03550001
035600              MOVE 'TVHTRIP'      TO PV-DB2-TABLE-NAME-2          03560002
035700              PERFORM 9999-DB2-ABEND                              03570000
035800     END-EVALUATE.                                                03580000
035900                                                                  03590000
036000                                                                  03600000
036100******************************************************************03610000
036200*  FETCH TABLE CURSOR                                            *03620000
036300******************************************************************03630000
036400 9110-FETCH-TABLE-CURSOR.                                         03640000
036500     EXEC SQL                                                     03650000
036600         FETCH TABLE-CURSOR                                       03660000
036700          INTO  :RCT00014-TRIP-ID                                 03670002
036800     END-EXEC.                                                    03680000
036900                                                                  03690000
037000     EVALUATE TRUE                                                03700000
037100         WHEN SQLCODE = ZERO                                      03710000
037200              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  03720000
037300         WHEN SQLCODE = +100                                      03730000
037400              SET PS-TABLE-LOOP-DONE TO TRUE                      03740000
037500         WHEN SQLWARN0 NOT EQUAL SPACE                            03750000
037600         WHEN SQLCODE NOT EQUAL ZERO                              03760000
037700              MOVE '9110-FETCH-TABLE-CURSOR'                      03770000
037800                                  TO PV-PARAGRAPH-NAME            03780000
037900              MOVE 'FETCH TABLE CURSOR'                           03790000
038000                                  TO PV-DB2-OPERATION-MSG-1       03800000
038100              MOVE 'RCT_TRLR_UNLD' TO PV-DB2-TABLE-NAME-1         03810001
038200              MOVE 'TVHTRIP'      TO PV-DB2-TABLE-NAME-2          03820002
038300              PERFORM 9999-DB2-ABEND                              03830000
038400     END-EVALUATE.                                                03840000
038500                                                                  03850000
038600                                                                  03860000
038700******************************************************************03870000
038800*  CLOSE TABLE CURSOR                                            *03880000
038900******************************************************************03890000
039000 9130-CLOSE-TABLE-CURSOR.                                         03900000
039100     EXEC SQL                                                     03910000
039200          CLOSE TABLE-CURSOR                                      03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500     EVALUATE TRUE                                                03950000
039600         WHEN SQLCODE = ZERO                                      03960000
039700              CONTINUE                                            03970000
039800         WHEN SQLWARN0 NOT EQUAL SPACE                            03980000
039900         WHEN SQLCODE NOT EQUAL ZERO                              03990000
040000              MOVE '9130-CLOSE-TABLE-CURSOR'                      04000000
040100                                  TO PV-PARAGRAPH-NAME            04010000
040200              MOVE 'CLOSE TABLE CURSOR'                           04020000
040300                                  TO PV-DB2-OPERATION-MSG-1       04030000
040400              MOVE 'RCT_TRLR_UNLD' TO PV-DB2-TABLE-NAME-1         04040001
040500              MOVE 'TVHTRIP'      TO PV-DB2-TABLE-NAME-2          04050002
040600              PERFORM 9999-DB2-ABEND                              04060000
040700     END-EVALUATE.                                                04070000
040800                                                                  04080000
040801                                                                  04080101
040802******************************************************************04080201
040803* EXTRACT FILE IS IN TVEHICL FORMAT...SINCE THESE TRIPS HAVE     *04080301
040804* ALREADY PURGED EXTRACT ANY RECORD TO GET CORRECT VALUES.  WILL *04080401
040805* BE UPDATING THE CURR_TRIP_ID WITH THE TRIP THAT IS BEING       *04080501
040806* EXTRACTED TO BE USED IN AHKUP074 TO DELETE THE ROWS.           *04080601
040807******************************************************************04080701
040810 9200-TVEHICL-FORMAT.                                             04081001
040860     EXEC SQL                                                     04086001
040871        SELECT  A.OWNER_SCAC_ID                                   04087101
040872              , A.VEH_NBR                                         04087201
040873              , A.CRT_SRC_CDE                                     04087301
040874              , A.LAST_UPD_DTE                                    04087401
040875              , A.LAST_UPD_TME                                    04087501
040876              , A.LAST_UPD_UID                                    04087601
040877              , A.USAGE_CDE                                       04087701
040878              , A.VEH_TYP_CDE                                     04087801
040879              , A.CURR_STATUS_CDE                                 04087901
040880              , A.CURR_STATUS_DTE                                 04088001
040881              , A.CURR_STATUS_TME                                 04088101
040882              , A.CURR_OPER_UNT_ID                                04088201
040883              , A.CURR_FCLTY_ID                                   04088301
040884              , A.CURR_FAC_AREA_ID                                04088401
040885              , A.CURR_LOC_DTE                                    04088501
040886              , A.CURR_LOC_TME                                    04088601
040887              , A.CURR_TRIP_ID                                    04088701
040888              , A.VEH_SIZE_CDE                                    04088801
040889          INTO  :VEHICL-OWNER-SCAC-ID                             04088901
040890              , :VEHICL-VEH-NBR                                   04089001
040891              , :VEHICL-CRT-SRC-CDE                               04089101
040892              , :VEHICL-LAST-UPD-DTE                              04089201
040893              , :VEHICL-LAST-UPD-TME                              04089301
040894              , :VEHICL-LAST-UPD-UID                              04089401
040895              , :VEHICL-USAGE-CDE                                 04089501
040896              , :VEHICL-VEH-TYP-CDE                               04089601
040897              , :VEHICL-CURR-STATUS-CDE                           04089701
040898              , :VEHICL-CURR-STATUS-DTE                           04089801
040899              , :VEHICL-CURR-STATUS-TME                           04089901
040900              , :VEHICL-CURR-OPER-UNT-ID                          04090001
040901              , :VEHICL-CURR-FCLTY-ID                             04090101
040902              , :VEHICL-CURR-FAC-AREA-ID  :PV-NULL-IND            04090206
040903              , :VEHICL-CURR-LOC-DTE                              04090301
040904              , :VEHICL-CURR-LOC-TME                              04090401
040905              , :VEHICL-CURR-TRIP-ID      :PV-NULL-IND-2          04090506
040906              , :VEHICL-VEH-SIZE-CDE      :PV-NULL-IND-3          04090606
040907          FROM  TVEHICL A                                         04090701
040908          WHERE A.CURR_STATUS_DTE IN                              04090801
040909               (SELECT MIN(B.CURR_STATUS_DTE)                     04090901
040910                  FROM TVEHICL B)                                 04091001
040911          FETCH FIRST 1 ROW ONLY                                  04091101
040912          WITH UR                                                 04091201
040913     END-EXEC.                                                    04091301
040914                                                                  04091401
040915     EVALUATE TRUE                                                04091501
040916         WHEN SQLCODE = ZERO                                      04091601
040917              IF  PV-NULL-IND    =  -1                            04091706
040918                  MOVE ZEROES    TO  VEHICL-CURR-FAC-AREA-ID      04091806
040919              END-IF                                              04091906
040920              IF  PV-NULL-IND-2  =  -1                            04092006
040921                  MOVE ZEROES    TO  VEHICL-CURR-TRIP-ID          04092106
040922              END-IF                                              04092206
040923              IF  PV-NULL-IND-3  =  -1                            04092306
040924                  MOVE SPACES    TO  VEHICL-VEH-SIZE-CDE          04092406
040925              END-IF                                              04092506
040926         WHEN SQLWARN0 NOT EQUAL SPACE                            04092601
040927         WHEN SQLCODE NOT EQUAL ZERO                              04092701
040928              MOVE '9200-TVEHICL-FORMAT    '                      04092802
040929                                  TO PV-PARAGRAPH-NAME            04092901
040930              MOVE 'POPULATE TVEHICL FIELDS'                      04093002
040931                                  TO PV-DB2-OPERATION-MSG-1       04093101
040932              MOVE 'TVEHICL'       TO PV-DB2-TABLE-NAME-1         04093203
040933              MOVE 'SPACES'       TO PV-DB2-TABLE-NAME-2          04093302
040934              PERFORM 9999-DB2-ABEND                              04093401
040935     END-EVALUATE.                                                04093501
040936                                                                  04093601
040940                                                                  04094001
041000******************************************************************04100000
041100*  WRITE A RECORD TO THE DRIVER FILE                             *04110000
041200******************************************************************04120000
041300 9650-WRITE-DRIVER-RECORD.                                        04130000
041400                                                                  04140000
041500     WRITE  OUT-DRIVER-RECORD  FROM  DCLTVEHICL.                  04150002
041600     ADD +1 TO PV-DRIVER-WRITTEN-CNT.                             04160000
041700                                                                  04170000
041800                                                                  04180000
041900******************************************************************04190000
042000*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *04200000
042100*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *04210000
042200*  SQL ERROR OR WARNING CODE OCCURS.                             *04220000
042300******************************************************************04230000
042400 9999-DB2-ABEND.                                                  04240000
042500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04250000
042600             ' 9999-DB2-ABEND'.                                   04260000
042700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04270000
042800             ' ** ABEND           **'.                            04280000
042900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04290000
043000             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04300000
043100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04310000
043200             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     04320000
043300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04330000
043400             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     04340000
043500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04350000
043600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04360000
043700                                                                  04370000
043800     DISPLAY PC-CURRENT-PROGRAM-NAME                              04380000
043900             ' ** SQLCODE         ** = ' SQLCODE.                 04390000
044000     MOVE SQLCODE TO PV-SQLCODE.                                  04400000
044100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04410000
044200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04420000
044300                                                                  04430000
044400     DISPLAY PC-CURRENT-PROGRAM-NAME                              04440000
044500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04450000
044600                                                                  04460000
044700                                                                  04470000
044800*----------------------------------------------------------------*04480000
044900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04490000
045000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04500000
045100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04510000
045200* FORMAT.                                                        *04520000
045300*----------------------------------------------------------------*04530000
045400     COPY DPPD004.                                                04540000
045500                                                                  04550000
045600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04560000
045700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04570000
045800                                                                  04580000
045900                                                                  04590000
046000*----------------------------------------------------------------*04600000
046100* CALL ABEND                                                     *04610000
046200*----------------------------------------------------------------*04620000
046300     MOVE +4013                  TO ABEND-CODE.                   04630000
046400     CALL 'ILBOABN0' USING ABEND-CODE.                            04640000
046500*                                                                 04650000
