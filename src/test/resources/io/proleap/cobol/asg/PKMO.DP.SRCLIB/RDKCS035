000100*-----------------------*                                         00010033
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030033
000400 PROGRAM-ID.    RDKCS035.                                         00040033
000600 AUTHOR.        GREG SHEFF.                                       00060075
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070033
000800 DATE-WRITTEN.  07-08-03.                                         00080075
000900 DATE-COMPILED.                                                   00090033
001000                                                                  00100033
001100*---------------------------------------------------------------* 00110033
001200*                                                               * 00120033
001300*  THIS PROGRAM IS USED TO LIST CORPORATE REFUND REQUESTS FOR     00130033
001400*  CUSTOMER OR FOR A TRANSACTION.  CRITERIA PASSED WHEN           00140033
001500*  REQUEST IS BY CUSTOMER MAY BE DRIVER LICENSE OR SOCIAL SECURITY00150033
001600*  DRIVER LICENSE AND/OR SOCIAL SECURITY NUMBER WOULD COME FROM   00160033
001700*  FROM RDSCRCS.    CRITERIA PASSED FOR TRANSACTION INFO WILL BE  00170033
001800*  RECEIPT DATE, AND POSSIBLY STORE, TERMINAL, TRANSACTION.       00180033
001900*  CRITERIA PASSED FOR APPROVAL CODE WILL BE AN APPROVAL CODE.    00190033
002000*                                                               * 00200033
002010*  THE ABILITY TO SELECT MULTIPLE ITEMS HAS BEEN DISABLED.        00201099
002020*                                                               * 00202079
002021*---------------------------------------------------------------* 00202199
002030* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00203099
002040*            - CHANGE CALL OF DPKUT100 TO                       * 00204099
002050*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00205099
002060*              MAKING THE CALL DYNAMIC VS STATIC                * 00206099
002070*                                                               * 00207099
002100*---------------------------------------------------------------* 00210033
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00211099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00212099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00213099
CICS  ******************************************************************00214099
002200                                                                  00220081
002300 ENVIRONMENT DIVISION.                                            00230033
002400                                                                  00240033
002500 DATA DIVISION.                                                   00250033
002600                                                                  00260033
002700 WORKING-STORAGE SECTION.                                         00270033
004400 01  IV-INDICATOR-VARIABLES.                                      00440033
004500     15  IV-STAT-CHNG-DTE               PIC S9(04)  COMP          00450033
004600                                                    VALUE 0.      00460033
004700     15  IV-RFND-CK-DTE                 PIC S9(04)  COMP          00470033
004800                                                    VALUE 0.      00480033
004900     15  IV-RFND-CK-NBR                 PIC S9(04)  COMP          00490033
005000                                                    VALUE 0.      00500033
005001     15  IV-RFND-AMT-ADJ                PIC S9(04)  COMP          00500194
005002                                                    VALUE 0.      00500294
005100                                                                  00510033
005200 01  PC-PROGRAM-CONSTANTS.                                        00520033
005300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00530033
005400                                                    'RD035A  '.   00540033
005500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00550033
005600                                                    'RDKM035 '.   00560033
005700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00570033
005800                                                    'RDKCS035'.   00580033
005900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00590033
006000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00600033
006200     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE ' '.    00620033
006300     05  PC-CUST-INQ-FORMAT             PIC  X(01)  VALUE 'E'.    00630099
006400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00640033
006500                                                    COMP SYNC.    00650033
006600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00660033
006700                                                    COMP SYNC.    00670033
006800     05  PC-MAX-ITEMS                PIC S9(09)  VALUE +30000     00680099
007100                                                         COMP-3.  00710099
007200     05  PC-MSG-NUMBER-LENGTH        PIC S9(04)  VALUE +5         00720099
007300                                                       COMP SYNC. 00730099
007400     05  PC-MAX-RETRIES              PIC S9(03)  VALUE 3          00740099
007500                                                          COMP-3. 00750099
007600     05  PC-ZEROS                    PIC S9(7)V  COMP-3           00760099
007610                                                    VALUE ZEROES. 00761090
007611     05  PC-DEL-RFND                 PIC  X(08)  VALUE 'RDDRFND'. 00761199
007612                                                                  00761299
007700     05  PC-TSYMSG-NUMBERS.                                       00770033
007800         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00780099
007900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00790099
008000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00800033
008100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00810033
008200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00820033
008300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00830033
008400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00840033
008500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00850033
008600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00860033
008700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00870033
008800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00880033
008900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00890033
009000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00900033
009100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00910033
009101         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00910199
009102         10  PC-TSYMSG-00118            PIC  9(05)  VALUE 00118.  00910299
009110         10  PC-TSYMSG-00233            PIC  9(05)  VALUE 00233.  00911099
009200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00920033
009300         10  PC-TSYMSG-03084            PIC  9(05)  VALUE 03084.  00930033
009400         10  PC-TSYMSG-99910            PIC  9(05)  VALUE 99910.  00940099
009500                                                                  00950099
009600 01  PS-PROGRAM-SWITCHES.                                         00960033
009700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00970033
009800         88  PS-NO-ERROR                            VALUE 'Y'.    00980033
009900         88  PS-ERROR                               VALUE 'N'.    00990033
010000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01000033
010100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01010033
010200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01020033
010210     05  PS-DEL-RFND-SW                 PIC  X(01).               01021099
010220         88  PS-DELETE-RFND                         VALUE 'D'.    01022099
010230         88  PS-NO-DELETE-RFND                      VALUE 'N'.    01023099
010300*                                                                 01030033
010400 01  PV-PROGRAM-VARIABLES.                                        01040033
010500     05  PV-SUB                         PIC S9(04)  VALUE +0      01050033
010600                                                    COMP SYNC.    01060033
010700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01070033
010800                                                    COMP SYNC.    01080033
010900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01090033
011000                                                    COMP-3.       01100033
011100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01110033
011200                                                    COMP-3.       01120033
011300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01130033
011400                                                    COMP-3.       01140033
011500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01150033
011600                                                    COMP-3.       01160033
011700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01170033
011800                                                    COMP-3.       01180033
011900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01190033
012000                                                    COMP-3.       01200033
012300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01230033
012400                                                    COMP SYNC.    01240033
012500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01250033
012600                                                    COMP SYNC.    01260033
012700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01270033
012800                                                    COMP SYNC.    01280033
012900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01290033
013000                                                    COMP SYNC.    01300033
013100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01310033
013200                                                    COMP SYNC.    01320033
013300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01330033
013400                                                    COMP SYNC.    01340033
013500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01350033
013600                                                    COMP SYNC.    01360033
013700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01370033
013800                                                    COMP SYNC.    01380033
013900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01390033
014000                                                    COMP SYNC.    01400033
014100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01410033
014200                                                    COMP SYNC.    01420033
014300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01430033
014400                                                    COMP SYNC.    01440033
014500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01450033
014600                                                    COMP SYNC.    01460033
014700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01470033
014800                                                    COMP SYNC.    01480033
014900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01490033
015000                                                    COMP SYNC.    01500033
015300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01530033
015400                                                    COMP SYNC.    01540033
015420     05  PV-STORE-NBR                   PIC  9(05)  VALUE  0.     01542099
015500     05  PV-RECEIPT-DTE.                                          01550033
015600         10  PV-DATE-YY                 PIC  X(04)  VALUE SPACES. 01560033
015700         10  PV-DASH1                   PIC  X(01)  VALUE '-'.    01570033
015800         10  PV-DATE-MM                 PIC  X(02)  VALUE SPACES. 01580033
015900         10  PV-DASH2                   PIC  X(01)  VALUE '-'.    01590076
016000         10  PV-DATE-DD                 PIC  X(02)  VALUE SPACES. 01600033
016100******************************************************************01610033
016200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01620033
016300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01630033
016400**  APPLICATION-SPECIFIC COMMAREA.                              **01640033
016500******************************************************************01650033
016600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01660033
016700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01670033
016800     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           01680033
016900                                        INDEXED BY LQW-IDX.       01690033
017000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01700033
017100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01710033
017200         10  LQW-SELECTED-SW            PIC  X(01).               01720033
017300             88  LQW-SELECT                         VALUE 'S'.    01730033
017400             88  LQW-DESELECT                       VALUE ' '.    01740033
017600         10  LQW-STORE-NBR              PIC S9(04)                01760033
017700                                              COMP.               01770033
017800         10  LQW-RECEIPT-DTE            PIC  X(10).               01780033
017900         10  LQW-TERMINAL               PIC S9(04)                01790033
018000                                              COMP.               01800033
018100         10  LQW-TRANSACTION            PIC S9(04)                01810033
018200                                              COMP.               01820033
018300         10  LQW-REFUND                 PIC S9(05)V99             01830033
018400                                              COMP.               01840033
018410         10  LQW-ADJ-REFUND             PIC S9(05)V99             01841096
018420                                              COMP.               01842096
018500         10  LQW-STATUS-CDE             PIC  X(01).               01850097
018700         10  LQW-STATDESC               PIC  X(07).               01870033
018800         10  LQW-CHGDATE                PIC  X(10).               01880033
018900         10  LQW-CKDATE                 PIC  X(10).               01890033
019000         10  LQW-CKNBR                  PIC S9(07)                01900033
019100                                          COMP-3.                 01910033
019200*        NEXT TWO NOT DISPLAYED BUT PASSED TO NEXT PROG           01920074
019300         10  LQW-CUST-ID                PIC S9(10)                01930033
019400                                              COMP-3.             01940033
019500         10  LQW-SEQ-NBR                PIC S9(04)                01950033
019600                                              COMP.               01960033
019800*---------------------------------------------------------------* 01980033
019900*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.            01990033
020000*---------------------------------------------------------------* 02000033
020100                                                                  02010074
020200     COPY RDWS035.                                                02020099
020300                                                                  02030033
020500*---------------------------------------------------------------* 02050033
020600*    MAP LAYOUT                                                 * 02060033
020700*---------------------------------------------------------------* 02070033
020800                                                                  02080074
020900     COPY RDKM035.                                                02090033
021000*                                                                 02100033
021200 01  MR-OCCURS-LAYOUT                   REDEFINES  RD035AO.       02120033
021300     05  FILLER                         PIC X(42).                02130033
021500     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02150033
021600         10  MR-SELECTL                 PIC S9(04) COMP.          02160033
021700         10  MR-SELECTA                 PIC  X(01).               02170033
021800         10  MR-SELECTC                 PIC  X(01).               02180033
021900         10  MR-SELECTH                 PIC  X(01).               02190033
022000         10  MR-SELECTI                 PIC  X(01).               02200033
022100                                                                  02210033
022200         10  MR-STOREL                  PIC S9(04) COMP.          02220033
022300         10  MR-STOREA                  PIC  X(01).               02230033
022400         10  MR-STOREC                  PIC  X(01).               02240033
022500         10  MR-STOREH                  PIC  X(01).               02250033
022600         10  MR-STOREX.                                           02260033
022700             15  MR-STORE               PIC  Z9(04).              02270093
022800                                                                  02280033
022900         10  MR-RECTDTEL                PIC S9(04) COMP.          02290033
023000         10  MR-RECTDTEA                PIC  X(01).               02300033
023100         10  MR-RECTDTEC                PIC  X(01).               02310033
023200         10  MR-RECTDTEH                PIC  X(01).               02320033
023300         10  MR-RECTDTE                 PIC  X(10).               02330033
023400                                                                  02340033
023500         10  MR-REGISTERL               PIC S9(04) COMP.          02350033
023600         10  MR-REGISTERA               PIC  X(01).               02360033
023700         10  MR-REGISTERC               PIC  X(01).               02370033
023800         10  MR-REGISTERH               PIC  X(01).               02380033
023900         10  MR-REGISTERX.                                        02390033
024000             15  MR-REGISTER            PIC  9(04).               02400093
024100                                                                  02410033
024200         10  MR-TRANSL                  PIC S9(04) COMP.          02420033
024300         10  MR-TRANSA                  PIC  X(01).               02430033
024400         10  MR-TRANSC                  PIC  X(01).               02440033
024500         10  MR-TRANSH                  PIC  X(01).               02450033
024600         10  MR-TRANSX.                                           02460033
024700             15  MR-TRANS               PIC  9(04).               02470093
024800                                                                  02480033
024900         10  MR-REFUNDL                 PIC S9(04) COMP.          02490033
025000         10  MR-REFUNDA                 PIC  X(01).               02500033
025100         10  MR-REFUNDC                 PIC  X(01).               02510033
025200         10  MR-REFUNDH                 PIC  X(01).               02520033
025300         10  MR-REFUNDX.                                          02530033
025400             15  MR-REFUND              PIC  Z(05).99.            02540033
025500                                                                  02550033
025600         10  MR-STATUSL                 PIC S9(04) COMP.          02560033
025700         10  MR-STATUSA                 PIC  X(01).               02570033
025800         10  MR-STATUSC                 PIC  X(01).               02580033
025900         10  MR-STATUSH                 PIC  X(01).               02590033
026000         10  MR-STATUS                  PIC  X(01).               02600033
026100                                                                  02610033
026200         10  MR-STATDESCL               PIC S9(04) COMP.          02620033
026300         10  MR-STATDESCA               PIC  X(01).               02630033
026400         10  MR-STATDESCC               PIC  X(01).               02640033
026500         10  MR-STATDESCH               PIC  X(01).               02650033
026600         10  MR-STATDESC                PIC  X(07).               02660033
026700                                                                  02670033
026800         10  MR-CHGDATEL                PIC S9(04) COMP.          02680033
026900         10  MR-CHGDATEA                PIC  X(01).               02690033
027000         10  MR-CHGDATEC                PIC  X(01).               02700033
027100         10  MR-CHGDATEH                PIC  X(01).               02710033
027200         10  MR-CHGDATE                 PIC  X(10).               02720033
027300                                                                  02730033
027400         10  MR-CKDATEL                 PIC S9(04) COMP.          02740033
027500         10  MR-CKDATEA                 PIC  X(01).               02750033
027600         10  MR-CKDATEC                 PIC  X(01).               02760033
027700         10  MR-CKDATEH                 PIC  X(01).               02770033
027800         10  MR-CKDATE                  PIC  X(10).               02780033
027900                                                                  02790033
028000         10  MR-CKNBRL                  PIC S9(04) COMP.          02800033
028100         10  MR-CKNBRA                  PIC  X(01).               02810033
028200         10  MR-CKNBRC                  PIC  X(01).               02820033
028300         10  MR-CKNBRH                  PIC  X(01).               02830033
028400         10  MR-CKNBRX.                                           02840033
028500             15  MR-CKNBR               PIC  Z(07).               02850033
028600                                                                  02860033
028800*---------------------------------------------------------------* 02880033
028900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02890033
029000*---------------------------------------------------------------* 02900033
029100                                                                  02910033
029300     COPY DPWS015.                                                02930099
029400                                                                  02940033
029500*---------------------------------------------------------------* 02950033
029600*    FUNCTION KEYS COPYBOOK.                                    * 02960033
029700*---------------------------------------------------------------* 02970033
029800                                                                  02980033
029900     COPY DPWS016.                                                02990099
030000                                                                  03000033
030010*---------------------------------------------------------------* 03001099
030020*    WORK AREA FOR CICSAUTH SUBROUTINE                          * 03002099
030030*---------------------------------------------------------------* 03003099
030040                                                                  03004099
030050     COPY DPWS008.                                                03005099
030060                                                                  03006099
030100*---------------------------------------------------------------* 03010033
030200*    NUMERIC EDIT LAYOUT.                                       * 03020033
030300*---------------------------------------------------------------* 03030033
030400                                                                  03040033
030500     COPY DPWS010I.                                               03050099
030600                                                                  03060081
030700*---------------------------------------------------------------* 03070033
030800*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03080099
030900*---------------------------------------------------------------* 03090033
031000                                                                  03100033
031100     COPY DPWS030.                                                03110099
CICS       COPY DPWS930.                                                03111099
031200                                                                  03120081
031740*---------------------------------------------------------------* 03174068
031750*    STANDARD COMMAREA.                                         * 03175068
031760*---------------------------------------------------------------* 03176068
031770                                                                  03177068
031780     COPY DPWS020.                                                03178099
031800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03180033
031900                                                                  03190033
032000*---------------------------------------------------------------* 03200033
032100* INTER-APPLICATION COMMAREA.                                   * 03210033
032200*   RDWS033 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03220033
032300*             SPEC SCREEN.                                      * 03230033
032400*   RDWS034 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03240033
032500*             THIS LIST PROGRAM TO RDKCS036, 37, 38, 39 AND 48  * 03250080
032600*   SAWS031 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03260033
032700*             THIS LIST PROGRAM TO SAKCS426                     * 03270033
033200*---------------------------------------------------------------* 03320033
033300                                                                  03330033
033400         10  INTER-APPL-COMM-AREA       PIC X(200).               03340033
033600     COPY RDWS033.                                                03360099
033710     COPY RDWS034.                                                03371099
033800     COPY SAWS031.                                                03380099
033900*---------------------------------------------------------------* 03390033
034000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03400033
034100*---------------------------------------------------------------* 03410033
034200         10  ASC-SPECIFIC-COMMAREA.                               03420033
034300             15  ASC-LIST-KEYS.                                   03430033
034500                 20  ASC-KEY-DRIVERS-LIC            PIC  X(25).   03450033
034600                 20  ASC-KEY-SSN                    PIC S9(09)    03460033
034700                                                        COMP-3.   03470033
034800                 20  ASC-KEY-RECEIPT-DTE            PIC  X(10).   03480033
034900                 20  ASC-KEY-STORE-NBR              PIC S9(04)    03490082
035000                                                          COMP.   03500033
035100                 20  ASC-KEY-TERMINAL               PIC S9(04)    03510033
035200                                                          COMP.   03520033
035300                 20  ASC-KEY-TRANSACTION            PIC S9(04)    03530033
035400                                                          COMP.   03540033
035410                 20  ASC-KEY-SEQ-NBR                PIC S9(04)    03541099
035420                                                          COMP.   03542099
035500                 20  ASC-KEY-STATUS-CDE             PIC  X(01).   03550097
035508                 20  ASC-KEY-CUST-ID                PIC S9(10)    03550882
035510                                                        COMP-3.   03551066
035600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03560033
035700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03570033
035800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03580033
035900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03590033
036000                                                                  03600033
036100                 20  ASC-ITEM-ARRAY.                              03610033
036300                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03630033
036400                         30  ASC-LIST-ITEM-NUMBER                 03640033
036500                                                     PIC S9(09)   03650033
036600                                                     COMP-3.      03660033
036700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03670033
036800                             88  ASC-VALID-SELECT    VALUE ' '    03680033
036900                                                           'S'    03690033
037000                                                           'B'    03700033
037100                                                           'E'.   03710033
037200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03720033
037300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03730033
037400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03740033
037500                             88  ASC-TEMP-END        VALUE 'E'.   03750033
037600                         30  ASC-SELECTED-SW         PIC  X(01).  03760033
037700                             88  ASC-NO-SELECT       VALUE ' '.   03770033
037800                             88  ASC-SELECT          VALUE 'S'.   03780033
037900                             88  ASC-BEGIN           VALUE 'B'.   03790033
038000                             88  ASC-END             VALUE 'E'.   03800033
038200                         30  ASC-STORE-NBR           PIC S9(04)   03820033
038300                                                           COMP.  03830033
038400                         30  ASC-RECEIPT-DTE         PIC  X(10).  03840033
038500                         30  ASC-TERMINAL            PIC S9(04)   03850033
038600                                                           COMP.  03860033
038700                         30  ASC-TRANSACTION         PIC S9(04)   03870033
038800                                                           COMP.  03880033
038900                         30  ASC-REFUND              PIC S9(05)V9903890033
039000                                                           COMP.  03900033
039010                         30  ASC-ADJ-REFUND          PIC S9(05)V9903901094
039020                                                           COMP.  03902094
039100                         30  ASC-STATUS-CDE          PIC  X(01).  03910097
039300                         30  ASC-STATDESC            PIC  X(07).  03930033
039400                         30  ASC-CHGDATE             PIC  X(10).  03940033
039500                         30  ASC-CKDATE              PIC  X(10).  03950033
039600                         30  ASC-CKNBR               PIC S9(07)   03960033
039700                                                       COMP-3.    03970033
039800                         30  ASC-CUST-ID             PIC S9(10)   03980033
039900                                                        COMP-3.   03990033
040000                         30  ASC-SEQ-NBR             PIC S9(04)   04000033
040100                                                           COMP.  04010033
040200             15  ASC-BLK-SUB                      PIC S9(04)      04020033
040300                                                          COMP    04030033
040400                                                          SYNC.   04040033
040500             15  ASC-ITEM-SUB                        PIC S9(04)   04050033
040600                                                          COMP    04060033
040700                                                          SYNC.   04070033
040800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04080033
040900                                                          COMP-3. 04090033
041000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04100033
041100                                                          COMP-3. 04110033
041200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04120033
041300                                                          COMP-3. 04130033
041400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04140033
041500                                                          COMP-3. 04150033
041600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04160033
041700                                                          COMP-3. 04170033
041800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04180033
041900                                                          COMP    04190033
042000                                                          SYNC.   04200033
042100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04210033
042200                                                          COMP-3. 04220033
042300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04230033
042400                                                          COMP-3. 04240033
042500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04250033
042600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04260033
042700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04270033
042710             15  ASC-PF2-INDICATOR-SW                PIC  X(01).  04271099
042720                 88  ASC-PF2-YES                     VALUE 'Y'.   04272099
042730                 88  ASC-PF2-NO                      VALUE 'N'.   04273099
042800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04280033
042900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04290033
043000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04300033
043100             15  ASC-LIST-QUEUE-NAME.                             04310033
043200                 20  ASC-LIST-TERM-ID                PIC  X(04).  04320033
043300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04330033
043400                                                          COMP-3. 04340033
043500                 20  ASC-LIST-SEQ                    PIC  9(01).  04350033
043600             15  ASC-SEL-QUEUE-NAME.                              04360033
043700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04370033
043800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04380033
043900                                                          COMP-3. 04390033
044000                 20  ASC-SEL-SEQ                     PIC  9(01).  04400033
044100             15  ASC-CURSOR-SW                       PIC  X(01).  04410033
044200                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04420033
044300                 88  ASC-DRIVERS-LIC-CURSOR          VALUE 'D'.   04430033
044400                 88  ASC-SSN-CURSOR                  VALUE 'S'.   04440033
044500                 88  ASC-RECEIPT-CURSOR              VALUE '1'.   04450033
044600                 88  ASC-STORE-CURSOR                VALUE '2'.   04460033
044700                 88  ASC-TERMINAL-CURSOR             VALUE '3'.   04470033
044800                 88  ASC-TRANSACTION-CURSOR          VALUE '4'.   04480033
044900                 88  ASC-APPRVL-CURSOR               VALUE 'A'.   04490033
044910                 88  ASC-STORE2-CURSOR               VALUE 'O'.   04491099
044920                 88  ASC-STATDT-CURSOR               VALUE 'T'.   04492099
044930                 88  ASC-CUSTID-CURSOR               VALUE 'C'.   04493099
045000             15  ASC-START-ITEM-REQUEST.                          04500033
045100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04510033
045330         10  FILLER                                  PIC X(0615). 04533099
045400                                                                  04540081
045500*---------------------------------------------------------------* 04550033
045600*    ABEND PROCESSING COPYBOOK.                                 * 04560033
045700*---------------------------------------------------------------* 04570033
045800     COPY DPWS013.                                                04580099
045900                                                                  04590033
046100*---------------------------------------------------------------* 04610033
046200*    DB2 AREA FOR CUSTOMERS (RDT_CUST)                          * 04620033
046300*---------------------------------------------------------------* 04630033
046500     EXEC SQL                                                     04650033
046600          INCLUDE RDT00000                                        04660033
046700     END-EXEC.                                                    04670033
046800*---------------------------------------------------------------* 04680033
046900*    DB2 AREA FOR MAILED REFUND CHECKS (RDT_MAL_CK_RFND)        * 04690033
047000*---------------------------------------------------------------* 04700033
047100     EXEC SQL                                                     04710033
047200          INCLUDE RDT00001                                        04720033
047300     END-EXEC.                                                    04730033
047400*---------------------------------------------------------------* 04740033
047500*    DB2 AREA FOR COMMUNICATIONS                                * 04750033
047600*---------------------------------------------------------------* 04760033
047700     EXEC SQL                                                     04770033
047800          INCLUDE SQLCA                                           04780033
047900     END-EXEC.                                                    04790033
048000                                                                  04800033
048100*---------------------------------------------------------------* 04810033
048200*    VARIOUS CURSOR DECLARATIONS                                  04820033
048300*---------------------------------------------------------------* 04830033
048400                                                                  04840033
048600     EXEC SQL                                                     04860033
048700          DECLARE DRIVERS-LIC-CSR CURSOR                          04870033
048800          FOR SELECT                                              04880033
048900                M.STR_NBR                                         04890033
049000              , M.RFND_REQ_DTE                                    04900033
049100              , M.STR_RGST_ID                                     04910033
049200              , M.RGST_TRN_NBR                                    04920033
049300              , M.RFND_AMT                                        04930033
049320              , M.ADJ_RFND_AMT                                    04932094
049400              , M.RFND_STAT_CDE                                   04940033
049500              , M.STAT_CHNG_DTE                                   04950033
049600              , M.RFND_CK_DTE                                     04960033
049700              , M.RFND_CK_NBR                                     04970091
049800              , M.CUST_ID                                         04980033
049900              , M.RFND_SEQ_NBR                                    04990033
050000          FROM                                                    05000033
050100                RDT_CUST         C,                               05010033
050200                RDT_MAL_CK_RFND  M                                05020033
050300          WHERE                                                   05030033
050400                C.DRV_LIC_NBR = :ASC-KEY-DRIVERS-LIC              05040098
050500            AND C.CUST_ID   = M.CUST_ID                           05050033
050510          ORDER BY                                                05051082
050520                RFND_REQ_DTE DESC                                 05052082
050530              , STR_NBR                                           05053082
050540              , STR_RGST_ID                                       05054082
050550              , RGST_TRN_NBR                                      05055082
050600     END-EXEC.                                                    05060033
050700                                                                  05070033
050900     EXEC SQL                                                     05090033
051000          DECLARE SSN-CSR CURSOR                                  05100033
051100          FOR SELECT                                              05110033
051200                M.STR_NBR                                         05120033
051300              , M.RFND_REQ_DTE                                    05130033
051400              , M.STR_RGST_ID                                     05140033
051500              , M.RGST_TRN_NBR                                    05150033
051600              , M.RFND_AMT                                        05160033
051620              , M.ADJ_RFND_AMT                                    05162094
051700              , M.RFND_STAT_CDE                                   05170033
051800              , M.STAT_CHNG_DTE                                   05180033
051900              , M.RFND_CK_DTE                                     05190033
052010              , M.RFND_CK_NBR                                     05201091
052100              , M.CUST_ID                                         05210033
052200              , M.RFND_SEQ_NBR                                    05220033
052300          FROM                                                    05230033
052400                RDT_CUST         C,                               05240033
052500                RDT_MAL_CK_RFND  M                                05250033
052600          WHERE                                                   05260033
052700                C.SSN_NBR = :ASC-KEY-SSN                          05270098
052800            AND C.CUST_ID = M.CUST_ID                             05280033
052810          ORDER BY                                                05281082
052820                RFND_REQ_DTE DESC                                 05282082
052830              , STR_NBR                                           05283082
052840              , STR_RGST_ID                                       05284082
052850              , RGST_TRN_NBR                                      05285082
052900     END-EXEC.                                                    05290033
053000                                                                  05300033
053100     EXEC SQL                                                     05310033
053200          DECLARE RECEIPT-CSR CURSOR                              05320033
053300          FOR SELECT                                              05330033
053400                STR_NBR                                           05340033
053500              , RFND_REQ_DTE                                      05350033
053600              , STR_RGST_ID                                       05360033
053700              , RGST_TRN_NBR                                      05370033
053800              , RFND_AMT                                          05380033
053820              , ADJ_RFND_AMT                                      05382094
053900              , RFND_STAT_CDE                                     05390033
054000              , STAT_CHNG_DTE                                     05400033
054100              , RFND_CK_DTE                                       05410033
054210              , RFND_CK_NBR                                       05421091
054300              , CUST_ID                                           05430033
054400              , RFND_SEQ_NBR                                      05440033
054500          FROM                                                    05450033
054600                RDT_MAL_CK_RFND                                   05460033
054700          WHERE                                                   05470033
054800                RFND_REQ_DTE = :ASC-KEY-RECEIPT-DTE               05480098
054900          ORDER BY                                                05490033
055000                RFND_REQ_DTE DESC                                 05500033
055100              , STR_NBR                                           05510033
055200              , STR_RGST_ID                                       05520033
055300              , RGST_TRN_NBR                                      05530033
055400     END-EXEC.                                                    05540033
055500                                                                  05550033
055600     EXEC SQL                                                     05560033
055700          DECLARE STORE-CSR CURSOR                                05570033
055800          FOR SELECT                                              05580033
055900                STR_NBR                                           05590033
056000              , RFND_REQ_DTE                                      05600033
056100              , STR_RGST_ID                                       05610033
056200              , RGST_TRN_NBR                                      05620033
056300              , RFND_AMT                                          05630033
056320              , ADJ_RFND_AMT                                      05632094
056400              , RFND_STAT_CDE                                     05640033
056500              , STAT_CHNG_DTE                                     05650033
056600              , RFND_CK_DTE                                       05660033
056710              , RFND_CK_NBR                                       05671091
056800              , CUST_ID                                           05680033
056900              , RFND_SEQ_NBR                                      05690033
057000          FROM                                                    05700033
057100                RDT_MAL_CK_RFND                                   05710033
057200          WHERE                                                   05720033
057300                RFND_REQ_DTE = :ASC-KEY-RECEIPT-DTE               05730098
057400            AND STR_NBR      = :ASC-KEY-STORE-NBR                 05740098
057500          ORDER BY                                                05750033
057600                RFND_REQ_DTE DESC                                 05760033
057700              , STR_NBR                                           05770033
057800              , STR_RGST_ID                                       05780033
057900              , RGST_TRN_NBR                                      05790033
058000     END-EXEC.                                                    05800033
058010                                                                  05801099
058020     EXEC SQL                                                     05802099
058030          DECLARE STORE2-CSR CURSOR                               05803099
058040          FOR SELECT                                              05804099
058050                STR_NBR                                           05805099
058060              , RFND_REQ_DTE                                      05806099
058070              , STR_RGST_ID                                       05807099
058080              , RGST_TRN_NBR                                      05808099
058090              , RFND_AMT                                          05809099
058091              , ADJ_RFND_AMT                                      05809199
058092              , RFND_STAT_CDE                                     05809299
058093              , STAT_CHNG_DTE                                     05809399
058094              , RFND_CK_DTE                                       05809499
058095              , RFND_CK_NBR                                       05809599
058096              , CUST_ID                                           05809699
058097              , RFND_SEQ_NBR                                      05809799
058098          FROM                                                    05809899
058099                RDT_MAL_CK_RFND                                   05809999
058100          WHERE                                                   05810099
058102                STR_NBR      = :ASC-KEY-STORE-NBR                 05810299
058103          ORDER BY                                                05810399
058104                RFND_REQ_DTE DESC                                 05810499
058105              , STR_NBR                                           05810599
058106              , STR_RGST_ID                                       05810699
058107              , RGST_TRN_NBR                                      05810799
058108     END-EXEC.                                                    05810899
058110                                                                  05811033
058200     EXEC SQL                                                     05820033
058300          DECLARE TERMINAL-CSR CURSOR                             05830033
058400          FOR SELECT                                              05840033
058500                STR_NBR                                           05850033
058600              , RFND_REQ_DTE                                      05860033
058700              , STR_RGST_ID                                       05870033
058800              , RGST_TRN_NBR                                      05880033
058900              , RFND_AMT                                          05890033
058920              , ADJ_RFND_AMT                                      05892094
059000              , RFND_STAT_CDE                                     05900033
059100              , STAT_CHNG_DTE                                     05910033
059200              , RFND_CK_DTE                                       05920033
059310              , RFND_CK_NBR                                       05931091
059400              , CUST_ID                                           05940033
059500              , RFND_SEQ_NBR                                      05950033
059600          FROM                                                    05960033
059700                RDT_MAL_CK_RFND                                   05970033
059800          WHERE                                                   05980033
059900                RFND_REQ_DTE = :ASC-KEY-RECEIPT-DTE               05990098
060000            AND STR_NBR      = :ASC-KEY-STORE-NBR                 06000098
060100            AND STR_RGST_ID  = :ASC-KEY-TERMINAL                  06010098
060200          ORDER BY                                                06020033
060300                RFND_REQ_DTE DESC                                 06030033
060400              , STR_NBR                                           06040033
060500              , STR_RGST_ID                                       06050033
060600              , RGST_TRN_NBR                                      06060033
060700     END-EXEC.                                                    06070033
060800                                                                  06080033
060900     EXEC SQL                                                     06090033
061000          DECLARE TRANSACTION-CSR CURSOR                          06100033
061100          FOR SELECT                                              06110033
061200                STR_NBR                                           06120033
061300              , RFND_REQ_DTE                                      06130033
061400              , STR_RGST_ID                                       06140033
061500              , RGST_TRN_NBR                                      06150033
061600              , RFND_AMT                                          06160033
061620              , ADJ_RFND_AMT                                      06162094
061700              , RFND_STAT_CDE                                     06170033
061800              , STAT_CHNG_DTE                                     06180033
061900              , RFND_CK_DTE                                       06190033
062010              , RFND_CK_NBR                                       06201091
062100              , CUST_ID                                           06210033
062200              , RFND_SEQ_NBR                                      06220033
062300          FROM                                                    06230033
062400                RDT_MAL_CK_RFND                                   06240033
062500          WHERE                                                   06250033
062600                RFND_REQ_DTE = :ASC-KEY-RECEIPT-DTE               06260098
062700            AND STR_NBR      = :ASC-KEY-STORE-NBR                 06270098
062800            AND STR_RGST_ID  = :ASC-KEY-TERMINAL                  06280098
062900            AND RGST_TRN_NBR = :ASC-KEY-TRANSACTION               06290098
063000          ORDER BY                                                06300033
063100                RFND_REQ_DTE DESC                                 06310033
063200              , STR_NBR                                           06320033
063300              , STR_RGST_ID                                       06330033
063400              , RGST_TRN_NBR                                      06340033
063500     END-EXEC.                                                    06350033
063600                                                                  06360033
063700     EXEC SQL                                                     06370033
063800          DECLARE APPRVL-CDE-CSR CURSOR                           06380033
063900          FOR SELECT                                              06390033
064000                STR_NBR                                           06400033
064100              , RFND_REQ_DTE                                      06410033
064200              , STR_RGST_ID                                       06420033
064300              , RGST_TRN_NBR                                      06430033
064400              , RFND_AMT                                          06440033
064420              , ADJ_RFND_AMT                                      06442094
064500              , RFND_STAT_CDE                                     06450033
064600              , STAT_CHNG_DTE                                     06460033
064700              , RFND_CK_DTE                                       06470033
064820              , COALESCE(RFND_CK_NBR, :PC-ZEROS) AS RFND_CK_NBR   06482092
064900              , CUST_ID                                           06490033
065000              , RFND_SEQ_NBR                                      06500033
065100          FROM                                                    06510033
065200                RDT_MAL_CK_RFND                                   06520033
065300          WHERE                                                   06530033
065400                RFND_STAT_CDE = :ASC-KEY-STATUS-CDE               06540098
065500          ORDER BY                                                06550033
065600                RFND_STAT_CDE                                     06560033
065700              , RFND_CK_NBR                                       06570033
065800              , RFND_REQ_DTE DESC                                 06580033
065900              , STR_NBR                                           06590033
066000              , STR_RGST_ID                                       06600033
066100              , RGST_TRN_NBR                                      06610033
066200     END-EXEC.                                                    06620033
066300                                                                  06630099
066400     EXEC SQL                                                     06640099
066500          DECLARE STATUS-DTE-CSR CURSOR                           06650099
066600          FOR SELECT                                              06660099
066700                STR_NBR                                           06670099
066800              , RFND_REQ_DTE                                      06680099
066900              , STR_RGST_ID                                       06690099
067000              , RGST_TRN_NBR                                      06700099
067100              , RFND_AMT                                          06710099
067200              , ADJ_RFND_AMT                                      06720099
067300              , RFND_STAT_CDE                                     06730099
067400              , STAT_CHNG_DTE                                     06740099
067500              , RFND_CK_DTE                                       06750099
067600              , COALESCE(RFND_CK_NBR, :PC-ZEROS) AS RFND_CK_NBR   06760099
067700              , CUST_ID                                           06770099
067800              , RFND_SEQ_NBR                                      06780099
067900          FROM                                                    06790099
068000                RDT_MAL_CK_RFND                                   06800099
068100          WHERE                                                   06810099
068110                RFND_REQ_DTE  = :ASC-KEY-RECEIPT-DTE              06811099
068200          AND   RFND_STAT_CDE = :ASC-KEY-STATUS-CDE               06820099
068300          ORDER BY                                                06830099
068400                RFND_STAT_CDE                                     06840099
068500              , RFND_CK_NBR                                       06850099
068510              , RFND_REQ_DTE DESC                                 06851099
068520              , STR_NBR                                           06852099
068530              , STR_RGST_ID                                       06853099
068540              , RGST_TRN_NBR                                      06854099
068550     END-EXEC.                                                    06855099
068600                                                                  06860081
068700     EXEC SQL                                                     06870099
068701          DECLARE CUST-ID-CSR CURSOR                              06870199
068702          FOR SELECT                                              06870233
068703                STR_NBR                                           06870399
068704              , RFND_REQ_DTE                                      06870499
068705              , STR_RGST_ID                                       06870599
068706              , RGST_TRN_NBR                                      06870699
068708              , RFND_AMT                                          06870899
068709              , ADJ_RFND_AMT                                      06870999
068710              , RFND_STAT_CDE                                     06871099
068711              , STAT_CHNG_DTE                                     06871199
068712              , RFND_CK_DTE                                       06871299
068713              , RFND_CK_NBR                                       06871399
068714              , CUST_ID                                           06871499
068715              , RFND_SEQ_NBR                                      06871599
068716          FROM                                                    06871699
068717                RDT_MAL_CK_RFND                                   06871799
068718          WHERE                                                   06871833
068719                CUST_ID   = :ASC-KEY-CUST-ID                      06871999
068721          ORDER BY                                                06872182
068722                RFND_REQ_DTE DESC                                 06872282
068723              , STR_NBR                                           06872382
068724              , STR_RGST_ID                                       06872482
068725              , RGST_TRN_NBR                                      06872582
068726     END-EXEC.                                                    06872633
068727                                                                  06872733
068728 LINKAGE SECTION.                                                 06872833
068800                                                                  06880033
068900 01  DFHCOMMAREA.                                                 06890033
069000     05  FILLER                         OCCURS  1 TO 4072 TIMES   06900033
069100                                        DEPENDING ON EIBCALEN.    06910033
069200         10  FILLER                     PIC X.                    06920033
069300                                                                  06930033
069500 PROCEDURE DIVISION.                                              06950033
069600******************************************************************06960033
069700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06970033
069800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06980033
069900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06990033
070000******************************************************************07000033
070100 0000-MAIN-MODULE.                                                07010033
070200     INITIALIZE DP030-CICS-API-FIELDS.                            07020033
070300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07030033
070400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07040033
070500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07050033
070600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07060033
070700                                                                  07070074
070800     MOVE LENGTH OF RD035AI        TO DP030-MAP-LENGTH (1).       07080033
070900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07090033
071000     PERFORM 0001-CALL-CICS-ARCH-API.                             07100033
071100*                                                                 07110033
071200     PERFORM 1000-CONTROL-PROCESSING                              07120033
071300*                                                                 07130033
071400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07140033
071500     PERFORM 0001-CALL-CICS-ARCH-API.                             07150033
071600                                                                  07160033
071700******************************************************************07170033
071800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **07180033
071900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **07190033
072000******************************************************************07200033
072100 0001-CALL-CICS-ARCH-API.                                         07210033
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07220099
072300                                    DFHCOMMAREA                   07230099
072400                                    DP030-CICS-API-FIELDS         07240099
072500                                    DP020-STANDARD-COMMAREA       07250099
072700                                    RD035AI.                      07270099
072800*                                                                 07280033
072900     IF  DP030-RC-CALL-SUCCESSFUL                                 07290033
073000         CONTINUE                                                 07300033
073100     ELSE                                                         07310033
073200         SET DP013-NO-ROLLBACK                                    07320033
073300             DP013-XCTL-DISPLAY-RESTART                           07330033
073400             DP013-CICS-ABEND      TO TRUE                        07340033
073500         MOVE '0001-CALL-CICS-ARCH-API'                           07350033
073600                                   TO DP013-PARAGRAPH             07360033
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07361099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07362099
073900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07390033
074000         PERFORM DP013-0000-PROCESS-ABEND                         07400033
074100     END-IF.                                                      07410033
074200*----------------------------------------------------------------*07420033
074300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07430033
074400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07440033
074500*                                                                *07450033
074600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07460033
074700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07470033
074800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07480033
074900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07490033
075000*----------------------------------------------------------------*07500033
075100                                                                  07510033
075200 1000-CONTROL-PROCESSING.                                         07520033
075300                                                                  07530033
075400     EVALUATE TRUE                                                07540033
075500         WHEN DP020-NEXT-ACT-INITIAL                              07550033
075600             INITIALIZE ASC-SPECIFIC-COMMAREA                     07560099
075610             SET ASC-PF2-NO TO TRUE                               07561099
075700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07570033
075800                                      ASC-SEL-TERM-ID             07580033
075900             MOVE DP020-SRC-TASK-NUMBER                           07590033
076000                                   TO ASC-LIST-TASK-NUMBER        07600033
076100                                      ASC-SEL-TASK-NUMBER         07610033
076200             MOVE PC-LIST-QUEUE-SEQ                               07620033
076300                                   TO ASC-LIST-SEQ                07630033
076400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07640033
076500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07650033
076700             PERFORM 4100-PREPARE-CURSOR                          07670089
077900             PERFORM 4000-BUILD-INITIAL-PANEL                     07790076
078100                                                                  07810033
078200         WHEN DP020-NEXT-ACT-READ-MAP                             07820033
078300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07830033
078400                                   TO PV-TOP-ITEM                 07840033
078500             PERFORM 2000-PROCESS-PANEL                           07850033
078600*                                                                 07860089
078810         WHEN DP020-NEXT-ACT-RETURN                               07881047
079320             PERFORM 2050-DELETE-LIST-QUEUE                       07932089
079340             SET PS-COMMAREA-VALID TO TRUE                        07934089
079350             PERFORM 4000-BUILD-INITIAL-PANEL                     07935089
079400                                                                  07940033
079500         WHEN OTHER                                               07950033
079600             SET DP013-LOGIC-ABEND TO TRUE                        07960033
079700             SET DP013-NO-ROLLBACK TO TRUE                        07970033
079800             MOVE '1000-CONTROL-PROCESSING'                       07980033
079900                                   TO DP013-PARAGRAPH             07990033
080000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08000033
080100                                   TO DP013-MESSAGE-TEXT(1)       08010033
080200             PERFORM DP013-0000-PROCESS-ABEND                     08020033
080300     END-EVALUATE.                                                08030033
080400                                                                  08040033
080600*----------------------------------------------------------------*08060033
080700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *08070033
080800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *08080033
080900*----------------------------------------------------------------*08090033
081000                                                                  08100033
081100 1100-PROCESS-INTER-APPL-COMM.                                    08110033
081200                                                                  08120033
081300     SET PS-COMMAREA-VALID          TO TRUE.                      08130099
081400     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    08140099
081600                                                                  08160099
081902     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          08190299
081903         MOVE RD033-APPRVL-CDE                                    08190344
081904                                   TO ASC-KEY-STATUS-CDE          08190497
082000         MOVE RD033-DRIVERS-LIC                                   08200033
082100                                   TO ASC-KEY-DRIVERS-LIC         08210033
082300         IF RD033-SSN > SPACES                                    08230044
082310            MOVE RD033-SSN                                        08231044
082400                                   TO ASC-KEY-SSN                 08240033
082501         ELSE                                                     08250144
082510            MOVE ZEROES                                           08251044
082520                                   TO ASC-KEY-SSN                 08252044
082540         END-IF                                                   08254044
082600                                                                  08260099
082710         IF RD033-RECEIPT-DTE > SPACES                            08271099
082711            MOVE RD033-RECEIPT-DTE(1:2) TO PV-DATE-MM             08271199
082720            MOVE RD033-RECEIPT-DTE(3:2) TO PV-DATE-DD             08272099
082730            MOVE RD033-RECEIPT-DTE(5:4) TO PV-DATE-YY             08273099
082800            MOVE PV-RECEIPT-DTE TO ASC-KEY-RECEIPT-DTE            08280099
083000         END-IF                                                   08300099
083100                                                                  08310099
083102         MOVE RD033-STORE-NBR      TO PV-STORE-NBR                08310299
083110         IF PV-STORE-NBR > 32000                                  08311099
083112            MOVE 9999              TO ASC-KEY-STORE-NBR           08311299
083120         ELSE                                                     08312099
083130            MOVE PV-STORE-NBR      TO ASC-KEY-STORE-NBR           08313099
083300         END-IF                                                   08330099
083400         MOVE RD033-TERMINAL                                      08340033
083500                                   TO ASC-KEY-TERMINAL            08350033
083700         MOVE RD033-TRANSACTION                                   08370033
083800                                   TO ASC-KEY-TRANSACTION         08380033
083900         MOVE RD033-CUST-ID        TO ASC-KEY-CUST-ID             08390099
084000     ELSE                                                         08400033
084010*-----------------  IF COMING FROM RDICUST  --------------------- 08401099
084020         IF  DP020-INT-APPL-FORMAT-IND = PC-CUST-INQ-FORMAT       08402099
084030             MOVE RD033-CUST-ID        TO ASC-KEY-CUST-ID         08403099
084040         ELSE                                                     08404099
084100            IF  DP020-NAV-KEY-DATA > SPACE                        08410099
084200                MOVE DP020-NAV-KEY-DATA TO                        08420099
084400                                      ASC-KEY-STATUS-CDE          08440097
084600                                      ASC-KEY-DRIVERS-LIC         08460033
084800                                      ASC-KEY-SSN                 08480033
085000                                      ASC-KEY-RECEIPT-DTE         08500033
085200                                      ASC-KEY-STORE-NBR           08520033
085400                                      ASC-KEY-TERMINAL            08540033
085600                                      ASC-KEY-TRANSACTION         08560033
085800            END-IF                                                08580099
085810         END-IF                                                   08581099
085900     END-IF.                                                      08590033
086000                                                                  08600033
087100*----------------------------------------------------------------*08710033
087200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08720033
087300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08730033
087400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08740033
087500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08750033
087600* FUNCTION KEYS CAN GET THIS FAR.                                *08760033
087700*----------------------------------------------------------------*08770033
087800                                                                  08780033
087900 2000-PROCESS-PANEL.                                              08790033
088000     EVALUATE TRUE                                                08800033
088100         WHEN DP020-SRC-AID = DP016-CLEAR                         08810033
088200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08820033
088300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08830033
088400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08840033
088500                                                                  08850033
088600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08860099
090200             PERFORM 2050-DELETE-LIST-QUEUE                       09020033
090400             SET PS-COMMAREA-VALID TO TRUE                        09040033
090500             PERFORM 4000-BUILD-INITIAL-PANEL                     09050033
090501                                                                  09050199
091500         WHEN OTHER                                               09150033
091600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09160033
091700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09170033
091800             IF  PS-NO-ERROR                                      09180033
091900                 SET DP030-CONTINUE-GO                            09190033
092000                                 TO TRUE                          09200033
092100                 PERFORM 2100-CHECK-FUNCTION-KEY                  09210033
092200             ELSE                                                 09220033
092300                 SET DP030-OVERRIDE-GO                            09230033
092400                                 TO TRUE                          09240033
092500             END-IF                                               09250033
092600     END-EVALUATE.                                                09260033
092700                                                                  09270081
092800*----------------------------------------------------------------*09280033
092900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09290033
093000*----------------------------------------------------------------*09300033
093100 2050-DELETE-LIST-QUEUE.                                          09310033
093200                                                                  09320033
093300     EXEC CICS                                                    09330033
093400         DELETEQ TS                                               09340033
093500             QUEUE (ASC-LIST-QUEUE-NAME)                          09350033
093600             RESP  (PV-CICS-RESP)                                 09360033
093700     END-EXEC.                                                    09370033
093800                                                                  09380033
093900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09390033
094000        (PV-CICS-RESP = DFHRESP(QIDERR))                          09400033
094100         CONTINUE                                                 09410033
094200     ELSE                                                         09420033
094300         SET DP013-CICS-ABEND      TO TRUE                        09430033
094400         SET DP013-NO-ROLLBACK     TO TRUE                        09440033
094500                                                                  09450033
094600         MOVE '2050-DELETE-LIST-QUEUE'                            09460033
094700                                   TO DP013-PARAGRAPH             09470033
094800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09480033
094900                                   TO DP013-MESSAGE-TEXT (1)      09490033
095000         PERFORM DP013-0000-PROCESS-ABEND                         09500033
095100     END-IF.                                                      09510033
095200                                                                  09520033
095300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09530033
095400                                                                  09540081
095500*----------------------------------------------------------------*09550033
095600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09560033
095700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09570033
095800* CICS ARCHITECTURE API.                                         *09580033
095900*----------------------------------------------------------------*09590033
096000 2100-CHECK-FUNCTION-KEY.                                         09600033
096100     EVALUATE TRUE                                                09610033
096110*                -- F14 INQUIRY --                                09611081
096200         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               09620055
096210*                -- F15 UPDATE --                                 09621081
096300         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               09630033
096310*                -- F17 COMMENTS --                               09631081
096400         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               09640033
096800             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              09680033
096900                 SET DP030-OVERRIDE-GO                            09690033
097000                                   TO TRUE                        09700033
097100*                --  A LIST ITEM MUST BE SELECTED --              09710033
097200                 MOVE PC-TSYMSG-00057                             09720033
097300                                   TO DP020-MSG-NUMBER            09730033
097400                 SET DP020-MSG-FATAL                              09740033
097500                                   TO TRUE                        09750033
097600             ELSE                                                 09760033
097700               IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1               09770033
097800                   SET DP030-OVERRIDE-GO                          09780033
097900                                   TO TRUE                        09790033
098000*                --  ONLY ONE LIST ITEM MAY BE SELECTED --        09800033
098100                   MOVE PC-TSYMSG-00047                           09810033
098200                                   TO DP020-MSG-NUMBER            09820033
098300                   SET DP020-MSG-FATAL                            09830033
098400                                   TO TRUE                        09840033
098500               ELSE                                               09850033
098600*                -- MULTIPLE SELECTIONS ARE NOT ALLOWED --        09860081
098700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09870033
098800                                TO RD034-NUMBER-OF-SELECTED-ITEMS 09880033
098900                 PERFORM 5000-PREPARE-SEL-QUEUE                   09890033
099000               END-IF                                             09900033
099100             END-IF                                               09910033
099101                                                                  09910156
099110*             -- F18 GO TO SAKCS426 --                            09911081
099111         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               09911160
099113             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              09911360
099114                 SET DP030-OVERRIDE-GO                            09911460
099115                                   TO TRUE                        09911560
099116*                --  A LIST ITEM MUST BE SELECTED --              09911660
099117                 MOVE PC-TSYMSG-00057                             09911760
099118                                   TO DP020-MSG-NUMBER            09911860
099119                 SET DP020-MSG-FATAL                              09911960
099120                                   TO TRUE                        09912060
099121             ELSE                                                 09912160
099122               IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1               09912260
099123                   SET DP030-OVERRIDE-GO                          09912360
099124                                   TO TRUE                        09912460
099125*                --  ONLY ONE LIST ITEM MAY BE SELECTED --        09912560
099126                   MOVE PC-TSYMSG-00047                           09912660
099127                                   TO DP020-MSG-NUMBER            09912760
099128                   SET DP020-MSG-FATAL                            09912860
099129                                   TO TRUE                        09912960
099130               ELSE                                               09913060
099132                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09913260
099133                                TO RD034-NUMBER-OF-SELECTED-ITEMS 09913360
099134                 PERFORM 5000-PREPARE-SEL-QUEUE                   09913460
099135               END-IF                                             09913560
099136             END-IF                                               09913660
099137                 INITIALIZE SA031-INTER-APPL-COMMAREA             09913765
099138                 MOVE ASC-KEY-RECEIPT-DTE   TO                    09913882
099140                                             SA031-SALES-DATE-FROM09914082
099141                 MOVE ASC-KEY-STORE-NBR     TO SA031-STORE        09914182
099143                 MOVE ASC-KEY-TERMINAL      TO SA031-REGISTER     09914382
099145                 MOVE ASC-KEY-TRANSACTION   TO SA031-TRANSACTION  09914582
099148                                                                  09914882
099183*             -- F13 ADD FUNCTION --                              09918381
099184         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               09918474
099185                 INITIALIZE RD034-INTER-APPL-COMMAREA             09918574
099188                                                                  09918866
099189*             -- F16 DELETE FUNCTION --                           09918999
099190         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               09919099
099200             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              09920099
099210                 SET DP030-OVERRIDE-GO   TO TRUE                  09921099
099220*                --  A LIST ITEM MUST BE SELECTED --              09922099
099230                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         09923099
099240                 SET DP020-MSG-FATAL     TO TRUE                  09924099
099250             ELSE                                                 09925099
099260               IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1               09926099
099270                   SET DP030-OVERRIDE-GO TO TRUE                  09927099
099280*                --  ONLY ONE LIST ITEM MAY BE SELECTED --        09928099
099290                   MOVE PC-TSYMSG-00047                           09929099
099291                                   TO DP020-MSG-NUMBER            09929199
099292                   SET DP020-MSG-FATAL   TO TRUE                  09929299
099293               ELSE                                               09929399
099295                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09929599
099296                                TO RD034-NUMBER-OF-SELECTED-ITEMS 09929699
099297                 PERFORM 5000-PREPARE-SEL-QUEUE                   09929799
099298                 SET ASC-PF2-YES TO TRUE                          09929899
099299                 MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER         09929999
099300                 SET DP020-MSG-INFORMATIONAL TO TRUE              09930099
099310               END-IF                                             09931099
099311             END-IF                                               09931199
099312                                                                  09931299
099313*             -- F2 CONFIRM (USED FOR DELETE FUNCTION ONLY) --    09931399
099314         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     09931499
099315             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              09931599
099316                 SET DP030-OVERRIDE-GO                            09931699
099317                                   TO TRUE                        09931799
099318*                --  A LIST ITEM MUST BE SELECTED --              09931899
099319                 MOVE PC-TSYMSG-00057                             09931999
099320                                   TO DP020-MSG-NUMBER            09932099
099321                 SET DP020-MSG-FATAL                              09932199
099322                     ASC-PF2-NO                                   09932299
099323                                   TO TRUE                        09932399
099324             ELSE                                                 09932499
099325               IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1               09932599
099326                   SET DP030-OVERRIDE-GO                          09932699
099327                                   TO TRUE                        09932799
099328*                --  ONLY ONE LIST ITEM MAY BE SELECTED --        09932899
099329                   MOVE PC-TSYMSG-00047                           09932999
099330                                   TO DP020-MSG-NUMBER            09933099
099331                   SET DP020-MSG-FATAL                            09933199
099332                       ASC-PF2-NO                                 09933299
099333                                   TO TRUE                        09933399
099334               ELSE                                               09933499
099335                 IF ASC-PF2-YES                                   09933599
099336                     SET DP030-CONTINUE-GO TO TRUE                09933699
099337                     PERFORM 4350-CHECK-SECURITY-AUTH             09933799
099338                     IF DP008-ACCESS-ALLOWED                      09933899
099339                         PERFORM 4360-DELETE-REFUND               09933999
099340                         PERFORM 2050-DELETE-LIST-QUEUE           09934099
099341                         SET PS-COMMAREA-VALID TO TRUE            09934199
099342                         PERFORM 4000-BUILD-INITIAL-PANEL         09934299
099343                     END-IF                                       09934399
099344                 ELSE                                             09934499
099345*              ----DELETE MUST BE REQUESTED BEFORE CONFIRM----    09934599
099346                     MOVE PC-TSYMSG-00118 TO DP020-MSG-NUMBER     09934699
099347                     SET DP020-MSG-INFORMATIONAL TO TRUE          09934799
099348                 END-IF                                           09934899
099349               END-IF                                             09934999
099350             END-IF                                               09935099
099351                                                                  09935199
099360         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09936099
099400             MOVE +1               TO PV-TOP-ITEM                 09940033
099500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09950033
099600                                                                  09960033
099700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09970033
099800             PERFORM 2110-BROWSE-BACKWARD                         09980033
099900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09990033
100000                                                                  10000033
100100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10010033
100200             PERFORM 2120-BROWSE-FORWARD                          10020033
100300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10030033
100400                                                                  10040033
100500         WHEN DP020-SRC-AID = DP016-ENTER                         10050033
100600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10060033
100700             IF  PS-ERROR                                         10070033
100800                 CONTINUE                                         10080033
100900             ELSE                                                 10090033
101000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10100033
101100             END-IF                                               10110033
101200                                                                  10120033
101300         WHEN OTHER                                               10130033
101400             SET DP013-NO-ROLLBACK                                10140033
101500                 DP013-XCTL-DISPLAY-RESTART                       10150033
101600                 DP013-CICS-ABEND  TO TRUE                        10160033
101700             MOVE '2100-CHECK-FUNCTION-KEY'                       10170033
101800                                   TO DP013-PARAGRAPH             10180033
101900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10190033
102000                                   TO DP013-MESSAGE-TEXT (1)      10200033
102100             PERFORM DP013-0000-PROCESS-ABEND                     10210033
102200     END-EVALUATE.                                                10220033
102300*                                                                 10230033
102400*----------------------------------------------------------------*10240033
102500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10250033
102600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10260033
102700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10270033
102800*    MESSAGE.                                                    *10280033
102900*----------------------------------------------------------------*10290033
103000                                                                  10300033
103100 2110-BROWSE-BACKWARD.                                            10310033
103200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10320033
103300         GIVING PV-TOP-ITEM.                                      10330033
103400*                                                                 10340033
103500     IF  ((PV-TOP-ITEM < +1)                                      10350033
103600       OR (PV-TOP-ITEM = +1))                                     10360033
103700         MOVE +1                   TO PV-TOP-ITEM                 10370033
103800*        -- TOP OF LIST --                                        10380033
103900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10390033
104000         SET DP020-MSG-INFORMATIONAL TO TRUE                      10400033
104100     END-IF.                                                      10410033
104200                                                                  10420033
104300                                                                  10430081
104400*----------------------------------------------------------------*10440033
104500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10450033
104600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10460033
104700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10470033
104800*----------------------------------------------------------------*10480033
104900                                                                  10490033
105000 2120-BROWSE-FORWARD.                                             10500033
105100                                                                  10510033
105200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10520033
105300         GIVING PV-TOP-ITEM.                                      10530033
105400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10540033
105500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10550033
105600                                   TO PV-TOP-ITEM                 10560033
105700*        -- BOTTOM OF LIST --                                     10570033
105800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10580033
105900         SET DP020-MSG-INFORMATIONAL                              10590033
106000                                   TO TRUE                        10600033
106100     ELSE                                                         10610033
106200         COMPUTE PV-BOTTOM-ITEM =                                 10620033
106300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10630033
106400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10640033
106500*            -- BOTTOM OF LIST --                                 10650033
106600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10660033
106700             SET DP020-MSG-INFORMATIONAL                          10670033
106800                                   TO TRUE                        10680033
106900         END-IF                                                   10690033
107000     END-IF.                                                      10700033
107100                                                                  10710081
107200*----------------------------------------------------------------*10720033
107300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10730033
107400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10740033
107500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10750033
107600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10760033
107700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10770033
107800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10780033
107900*----------------------------------------------------------------*10790033
108000                                                                  10800033
108100 2130-CHECK-FOR-JUMP-BROWSE.                                      10810033
108200     SET PS-NO-ERROR               TO TRUE.                       10820033
108300     IF (ASC-START-ITEM-REQUEST = SPACE)                          10830033
108400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10840033
108500                                   TO PV-TOP-ITEM                 10850033
108600     ELSE                                                         10860033
108700         MOVE ASC-START-ITEM-REQUEST                              10870033
108800                                   TO DP010I-UNEDITED-FIELD       10880033
108900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10890033
109000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10900033
109100         SET DP010I-NEGATIVE-NOT-ALLOWED                          10910033
109200                                   TO TRUE                        10920033
109310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10931099
109320                         USING DP010I-NUMERIC-EDIT-AREA           10932099
109400                                                                  10940033
109500         IF  NOT DP010I-ERROR-DETECTED                            10950033
109600             MOVE DP010I-NUMERIC-FIELD                            10960033
109700                                   TO  ASC-START-ITEM-REQUEST-N   10970033
109800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10980033
109900                 IF  ASC-START-ITEM-REQUEST-N >                   10990033
110000                                          ASC-NUMBER-OF-ITEMS-READ11000033
110100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11010033
110200                     COMPUTE PV-TOP-ITEM =                        11020033
110300                             ASC-NUMBER-OF-ITEMS-READ             11030033
110400                             - PC-ITEMS-PER-PANEL + 1             11040033
110500                     IF  PV-TOP-ITEM < +1                         11050033
110600                         MOVE +1   TO PV-TOP-ITEM                 11060033
110610*                        -- BOTTOM OF LIST --                     11061078
110700                         MOVE PC-TSYMSG-00070                     11070033
110800                                   TO DP020-MSG-NUMBER            11080033
110900                         SET DP020-MSG-INFORMATIONAL              11090033
111000                                   TO TRUE                        11100033
111100                     END-IF                                       11110033
111200                 ELSE                                             11120033
111300                     MOVE ASC-START-ITEM-REQUEST-N                11130033
111400                                   TO PV-TOP-ITEM                 11140033
111500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11150033
111600                     COMPUTE PV-BOTTOM-ITEM =                     11160033
111700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11170033
111800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11180033
111900*                        -- BOTTOM OF LIST --                     11190033
112000                         MOVE PC-TSYMSG-00070                     11200033
112100                                   TO DP020-MSG-NUMBER            11210033
112200                         SET DP020-MSG-INFORMATIONAL              11220033
112300                                   TO TRUE                        11230033
112400                     END-IF                                       11240033
112500                 END-IF                                           11250033
112600             ELSE                                                 11260033
112700*                --- VALUE OUT OF RANGE ----                      11270033
112800                 MOVE PC-TSYMSG-00101                             11280033
112900                                   TO DP020-MSG-NUMBER            11290033
113000                 MOVE -1           TO ASTRTITL                    11300033
113100                 SET DP030-SET-CURSOR-APPL-1                      11310033
113200                                   TO TRUE                        11320033
113300                 MOVE DP015-REVERSE                               11330033
113400                                   TO ASTRTITH                    11340033
113500                 MOVE DP015-RED    TO ASTRTITC                    11350033
113600                 MOVE DP015-UNP-NUM-BRT-MDT                       11360033
113700                                   TO ASTRTITA                    11370033
113800                 SET DP020-MSG-FATAL                              11380033
113900                                   TO TRUE                        11390033
114000                 SET PS-ERROR      TO TRUE                        11400033
114100             END-IF                                               11410033
114200                                                                  11420033
114300         ELSE                                                     11430033
114310*            ---- NON NUMERIC ENTERED ----                        11431078
114400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11440033
114500             MOVE -1               TO ASTRTITL                    11450033
114600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11460033
114700             MOVE DP015-REVERSE    TO ASTRTITH                    11470033
114800             MOVE DP015-RED        TO ASTRTITC                    11480033
114900             MOVE DP015-UNP-NUM-BRT-MDT                           11490033
115000                                   TO ASTRTITA                    11500033
115100             SET DP020-MSG-FATAL   TO TRUE                        11510033
115200             SET PS-ERROR          TO TRUE                        11520033
115300         END-IF                                                   11530033
115400     END-IF.                                                      11540033
115500                                                                  11550081
136600******************************************************************13660033
136700** MOVE ALL OF THE FIELDS FROM THE SCREEN INTO THE COMMAREA.    **13670077
136900******************************************************************13690033
137000 2200-MOVE-SCREEN-TO-COMMAREA.                                    13700033
137100                                                                  13710033
137200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13720033
137300     MOVE +1                       TO PV-SUB.                     13730033
137400*                                                                 13740033
137500     PERFORM 3100-SET-SUBSCRIPTS.                                 13750033
137600     IF  ASTRTITL > ZERO                                          13760033
137700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13770033
137800     ELSE                                                         13780033
137900         IF  ASTRTITF = DP015-ERASE-EOF                           13790033
138000             INITIALIZE ASC-START-ITEM-REQUEST                    13800033
138100         END-IF                                                   13810033
138200     END-IF.                                                      13820033
138300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13830033
138400         VARYING PV-SUB                                           13840033
138500         FROM 1 BY 1                                              13850033
138600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13860033
138700******************************************************************13870033
138800** MOVE THE FIELDS ON EACH LIST LINE INTO THE COMMAREA          **13880077
138900******************************************************************13890033
139000 2210-MOVE-LINES-TO-COMMAREA.                                     13900033
139100     IF  MR-SELECTL (PV-SUB) > ZERO                               13910033
139200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13920033
139300         MOVE MR-SELECTI (PV-SUB)                                 13930033
139400                                   TO ASC-TEMP-SELECTED-SW        13940033
139500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13950033
139600     ELSE                                                         13960033
139700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13970033
139800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13980033
139900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13990033
140000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14000033
140100         END-IF                                                   14010033
140200     END-IF.                                                      14020033
140300     ADD +1                        TO ASC-ITEM-SUB.               14030033
140400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14040033
140500         ADD +1                    TO ASC-BLK-SUB                 14050033
140600         MOVE +1                   TO ASC-ITEM-SUB                14060033
140700     END-IF.                                                      14070033
140800******************************************************************14080033
140900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14090033
141000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14100033
141100******************************************************************14110033
141200 3000-EDIT-DATA-IN-COMMAREA.                                      14120033
141300     SET PS-NO-ERROR               TO TRUE.                       14130033
141400     PERFORM 3200-RESET-ATTRIBUTES.                               14140033
141500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14150033
141600**                                                                14160033
141700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14170033
141800* EDITTING IS DONE FROM THE BOTTOM UP.                            14180033
141900**                                                                14190033
142000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14200033
142100         ASC-ITEMS-DISPLAYED - 1.                                 14210033
142200     PERFORM 3100-SET-SUBSCRIPTS.                                 14220033
142300     PERFORM 3300-EDIT-SELECTIONS                                 14230033
142400         VARYING PV-SUB                                           14240033
142500         FROM PV-SUB BY -1                                        14250033
142600         UNTIL PV-SUB < +1                                        14260033
142700*                                                                 14270033
142800     IF  PS-NO-ERROR                                              14280033
142900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14290033
143000     END-IF.                                                      14300033
143100*                                                                 14310033
143200     IF  ((PS-NO-ERROR)                                           14320033
143300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14330033
143400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14340033
143500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14350033
143600     END-IF.                                                      14360033
143700                                                                  14370081
143800*----------------------------------------------------------------*14380033
143900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14390033
144000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14400033
144100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14410033
144200*                                                                *14420033
144300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14430033
144400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14440033
144500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14450033
144600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14460033
144700*----------------------------------------------------------------*14470033
144800                                                                  14480033
144900 3100-SET-SUBSCRIPTS.                                             14490033
145000                                                                  14500033
145100     COMPUTE ASC-ITEM-SUB =                                       14510033
145200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14520033
145300                                                                  14530033
145400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14540033
145500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14550033
145600                                                                  14560033
145700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14570033
145800     ELSE                                                         14580033
145900         MOVE +1                     TO ASC-BLK-SUB               14590033
146000     END-IF.                                                      14600033
146100******************************************************************14610033
146200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14620033
146300******************************************************************14630033
146400                                                                  14640033
146500 3200-RESET-ATTRIBUTES.                                           14650033
146600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14660033
146700     MOVE DP015-GREEN              TO ASTRTITC.                   14670033
146800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14680033
146900*                                                                 14690033
147000     PERFORM                                                      14700033
147100         VARYING PV-SUB                                           14710033
147200         FROM 1 BY 1                                              14720033
147300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14730033
147400         MOVE DP015-UNP-ALP-NOR-OFF                               14740033
147500                                   TO MR-SELECTA (PV-SUB)         14750033
147600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         14760033
147700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         14770033
147800     END-PERFORM.                                                 14780033
147900******************************************************************14790033
148000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14800033
148100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14810033
148200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14820033
148300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14830033
148400******************************************************************14840033
148500 3300-EDIT-SELECTIONS.                                            14850033
148600     EVALUATE TRUE                                                14860033
148700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14870033
148800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14880033
148900                 CONTINUE                                         14890033
149000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14900033
149100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14910033
149200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14920033
149300                 MOVE ASC-TEMP-SELECTED-SW                        14930033
149400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14940033
149500                                TO ASC-SELECTED-SW                14950033
149600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14960033
149700             END-IF                                               14970033
149800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14980033
149900                 = SPACE                                          14990033
150000             EVALUATE TRUE                                        15000033
150100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15010033
150200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15020033
150300                     MOVE SPACE TO ASC-SELECTED-SW                15030033
150400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15040033
150500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15050033
150600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15060033
150700                     MOVE SPACE TO ASC-SELECTED-SW                15070033
150800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15080033
150900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15090033
151000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15100033
151100                     MOVE SPACE TO ASC-SELECTED-SW                15110033
151200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15120033
151300             END-EVALUATE                                         15130033
151400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15140033
151500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15150033
151600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15160033
151700             END-IF                                               15170033
151800             PERFORM 3310-EDIT-RANGE                              15180033
151900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15190033
152000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15200033
152100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15210033
152200             END-IF                                               15220033
152300             PERFORM 3310-EDIT-RANGE                              15230033
152400         WHEN OTHER                                               15240033
152410*            -- INVALID VALUE ----                                15241078
152500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15250033
152600             SET DP020-MSG-FATAL    TO TRUE                       15260033
152700             MOVE -1                TO MR-SELECTL (PV-SUB)        15270033
152800             SET DP030-SET-CURSOR-APPL-1                          15280033
152900                                    TO TRUE                       15290033
153000             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15300033
153100             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15310033
153200             SET PS-ERROR TO TRUE                                 15320033
153300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15330033
153400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15340033
153500                 MOVE SPACE         TO ASC-SELECTED-SW            15350033
153600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15360033
153700             END-IF                                               15370033
153800     END-EVALUATE.                                                15380033
153900                                                                  15390033
154000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15400033
154100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15410033
154200     IF  ASC-ITEM-SUB < 1                                         15420033
154300         SUBTRACT +1 FROM ASC-BLK-SUB                             15430033
154400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15440033
154500     END-IF.                                                      15450033
154600******************************************************************15460033
154700** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15470033
154800** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15480033
154900** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15490033
155000** THE ENDING.                                                  **15500033
155100******************************************************************15510033
155200 3310-EDIT-RANGE.                                                 15520033
155300     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15530033
155400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15540033
155500             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15550033
155600                                   TO ASC-SELECTED-SW             15560033
155700                                        (ASC-BLK-SUB ASC-ITEM-SUB)15570033
155800             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15580033
155900         ELSE                                                     15590033
156000             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15600033
156100                 CONTINUE                                         15610033
156200             ELSE                                                 15620033
156300*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15630033
156400                 MOVE PC-TSYMSG-00054                             15640033
156500                                   TO DP020-MSG-NUMBER            15650033
156600                 SET DP020-MSG-FATAL                              15660033
156700                                   TO TRUE                        15670033
156800                 MOVE -1           TO MR-SELECTL (PV-SUB)         15680033
156900                 SET DP030-SET-CURSOR-APPL-1                      15690033
157000                                   TO TRUE                        15700033
157100                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15710033
157200                 MOVE DP015-UNDERLINE                             15720033
157300                                   TO MR-SELECTH (PV-SUB)         15730033
157400                 SET PS-ERROR      TO TRUE                        15740033
157500             END-IF                                               15750033
157600         END-IF                                                   15760033
157700     ELSE                                                         15770033
157800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15780033
157900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15790033
158000                                   TO ASC-SELECTED-SW             15800033
158100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15810033
158200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15820033
158300         ELSE                                                     15830033
158400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15840033
158500                 CONTINUE                                         15850033
158600             ELSE                                                 15860033
158700*                -- ONLY ONE END-OF-RANGE ALLOWED --              15870033
158800                 MOVE PC-TSYMSG-00055                             15880033
158900                                   TO DP020-MSG-NUMBER            15890033
159000                 SET DP020-MSG-FATAL                              15900033
159100                                   TO TRUE                        15910033
159200                 MOVE -1           TO MR-SELECTL (PV-SUB)         15920033
159300                 SET DP030-SET-CURSOR-APPL-1                      15930033
159400                                   TO TRUE                        15940033
159500                 SET PS-ERROR      TO TRUE                        15950033
159600             END-IF                                               15960033
159700         END-IF                                                   15970033
159800     END-IF.                                                      15980033
159900*                                                                 15990033
160000******************************************************************16000033
160100** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **16010033
160200** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **16020033
160300******************************************************************16030033
160400 3400-CHECK-RANGE-SEQUENCE.                                       16040033
160500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16050033
160600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16060033
160700       AND  ASC-START-OF-SELECTED-RANGE >                         16070033
160800                                         ASC-END-OF-SELECTED-RANGE16080033
160900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16090033
161000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16100033
161100         SET DP020-MSG-FATAL TO TRUE                              16110033
161200         SET PS-ERROR TO TRUE                                     16120033
161300         PERFORM 3410-POSITION-AT-ERROR                           16130033
161400     END-IF.                                                      16140033
161500******************************************************************16150033
161600** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16160033
161700** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16170033
161800** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16180033
161900******************************************************************16190033
162000 3410-POSITION-AT-ERROR.                                          16200033
162100     SET DP030-SET-CURSOR-APPL-1                                  16210033
162200                                   TO TRUE.                       16220033
162300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16230033
162400                    - PV-TOP-ITEM + 1.                            16240033
162500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16250033
162600         CONTINUE                                                 16260033
162700     ELSE                                                         16270033
162800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16280033
162900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16290033
163000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16300033
163100     END-IF.                                                      16310033
163200*                                                                 16320033
163300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16330033
163400                    - PV-TOP-ITEM + 1.                            16340033
163500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16350033
163600         CONTINUE                                                 16360033
163700     ELSE                                                         16370033
163800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16380033
163900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16390033
164000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16400033
164100     END-IF.                                                      16410033
164200                                                                  16420081
164300*----------------------------------------------------------------*16430033
164400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16440033
164500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16450033
164600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16460033
164700*----------------------------------------------------------------*16470033
164800                                                                  16480033
164900 3500-MARK-RANGE-AS-SELECTED.                                     16490033
165000     MOVE +1                       TO  ASC-BLK-SUB.               16500033
165100     PERFORM 3510-MARK-SELECTED-INDS                              16510033
165200         VARYING ASC-ITEM-SUB                                     16520033
165300         FROM 1 BY 1                                              16530033
165400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16540033
165500                                                                  16550033
165600     ADD +1                        TO ASC-BLK-SUB.                16560033
165700     PERFORM 3510-MARK-SELECTED-INDS                              16570033
165800         VARYING ASC-ITEM-SUB                                     16580033
165900         FROM 1 BY 1                                              16590033
166000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16600033
166100                                                                  16610033
166200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16620033
166300                                   TO  PV-LIST-ITEM-NUMBER.       16630033
166400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16640033
166500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16650033
166600               PC-ITEMS-PER-PANEL).                               16660033
166700                                                                  16670033
166800     MOVE ASC-START-OF-SELECTED-RANGE                             16680033
166900                                   TO PV-START-OF-SELECTED-RANGE. 16690033
167000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16700033
167100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16710033
167200               PC-ITEMS-PER-PANEL).                               16720033
167300                                                                  16730033
167400     MOVE ASC-END-OF-SELECTED-RANGE                               16740033
167500                                   TO  PV-END-OF-SELECTED-RANGE.  16750033
167600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16760033
167700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16770033
167800               PC-ITEMS-PER-PANEL).                               16780033
167900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16790033
168000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16800033
168100                                                                  16810033
168200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16820033
168300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16830033
168400         MOVE +1                   TO ASC-BLK-SUB                 16840033
168500         PERFORM 5100-WRITE-TEMP-STORAGE                          16850033
168600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16860033
168700             PV-FIRST-BLOCK-IN-ARRAY - 1                          16870033
168800                                                                  16880033
168900         PERFORM                                                  16890033
169000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16900033
169100                   PV-PREV-BLOCK-IN-ARRAY                         16910033
169200             MOVE PV-FIRST-BLOCK-IN-RANGE                         16920033
169300                                   TO PV-BLOCK-NUMBER             16930033
169400             PERFORM 4410-READ-TEMP-STORAGE                       16940033
169500             PERFORM 3510-MARK-SELECTED-INDS                      16950033
169600                 VARYING ASC-ITEM-SUB                             16960033
169700                 FROM 1 BY 1                                      16970033
169800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16980033
169900             PERFORM 5100-WRITE-TEMP-STORAGE                      16990033
170000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17000033
170100         END-PERFORM                                              17010033
170200                                                                  17020033
170300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17030033
170400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17040033
170500         PERFORM                                                  17050033
170600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17060033
170700                   PV-LAST-BLOCK-IN-RANGE                         17070033
170800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17080033
170900                                   TO PV-BLOCK-NUMBER             17090033
171000             PERFORM 4410-READ-TEMP-STORAGE                       17100033
171100             PERFORM 3510-MARK-SELECTED-INDS                      17110033
171200                 VARYING ASC-ITEM-SUB                             17120033
171300                 FROM 1 BY 1                                      17130033
171400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17140033
171500             PERFORM 5100-WRITE-TEMP-STORAGE                      17150033
171600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17160033
171700         END-PERFORM                                              17170033
171800                                                                  17180033
171900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17190033
172000                                   TO PV-BLOCK-NUMBER             17200033
172100         PERFORM 4410-READ-TEMP-STORAGE                           17210033
172200     END-IF.                                                      17220033
172300                                                                  17230033
172400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17240033
172500                                      ASC-END-OF-SELECTED-RANGE.  17250033
172600                                                                  17260033
172800*----------------------------------------------------------------*17280033
172900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17290033
173000*----------------------------------------------------------------*17300033
173100                                                                  17310033
173200 3510-MARK-SELECTED-INDS.                                         17320033
173300                                                                  17330033
173400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17340033
173500                                ASC-ITEM-SUB) >                   17350033
173600         ASC-START-OF-SELECTED-RANGE)                             17360033
173700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17370033
173800                                ASC-ITEM-SUB) =                   17380033
173900         ASC-START-OF-SELECTED-RANGE)                             17390033
174000                                                                  17400033
174100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17410033
174200                                    ASC-ITEM-SUB) <               17420033
174300             ASC-END-OF-SELECTED-RANGE)                           17430033
174400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17440033
174500                                    ASC-ITEM-SUB) =               17450033
174600             ASC-END-OF-SELECTED-RANGE)                           17460033
174700                                                                  17470033
174800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17480033
174900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17490033
175000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17500033
175100                               TO TRUE                            17510033
175200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17520033
175300                               TO TRUE                            17530033
175400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17540033
175500             END-IF                                               17550033
175600         END-IF                                                   17560033
175700     END-IF.                                                      17570033
175800                                                                  17580033
176000*----------------------------------------------------------------*17600033
176100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17610033
176200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17620033
176300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17630033
176400*    DISPLAY THE PANEL TO USER.                                  *17640033
176500*----------------------------------------------------------------*17650033
176600                                                                  17660033
176700 4000-BUILD-INITIAL-PANEL.                                        17670033
176800                                                                  17680033
176900     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17690033
177000                                 ASC-BLOCK-ENTRIES (2).           17700033
177100     MOVE +1                 TO ASC-BLK-SUB.                      17710033
177200     SET ASC-ITEMS-LEFT-ON-DB                                     17720033
177300                             TO TRUE.                             17730033
177400                                                                  17740033
177500     MOVE +0                 TO ASC-ITEM-SUB                      17750033
177600                                ASC-NUMBER-OF-ITEMS-READ          17760033
177700                                ASC-NUMBER-OF-SELECTED-ITEMS      17770033
177800                                ASC-HIGHEST-BLOCK-WRITTEN         17780033
177900                                ASC-START-OF-SELECTED-RANGE       17790033
178000                                ASC-END-OF-SELECTED-RANGE         17800033
178100                                ASC-ITEM-AT-TOP-OF-PANEL.         17810033
178500*    ONLY DO IF SCREEN PASSES EDIT TESTS                          17850074
178600     IF PS-COMMAREA-VALID                                         17860033
178700        PERFORM 4010-OPEN-CURSOR                                  17870033
178800        PERFORM 4300-READ-ITEMS-FROM-DB                           17880033
178900        PERFORM 4020-CLOSE-CURSOR                                 17890033
179000        MOVE +1                   TO  PV-TOP-ITEM                 17900033
179100        IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                       17910033
179200            SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                 17920033
179300            SET DP020-MSG-FATAL   TO  TRUE                        17930033
179310*            -- NO LIST ITEMS ----                                17931078
179400            MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER            17940033
179500        ELSE                                                      17950033
179600            MOVE -1               TO MR-SELECTL (1)               17960033
179700            SET DP030-SET-CURSOR-APPL-1                           17970033
179800                                  TO TRUE                         17980033
179900            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                  17990033
180000        END-IF                                                    18000033
180100     END-IF.                                                      18010033
180200                                                                  18020081
180296                                                                  18029687
180300*----------------------------------------------------------------*18030033
180400* OPEN THE CURSOR.                                               *18040033
180500*   IN THIS PARTICULAR APPLICATION ONE OF 7 DIFFERENT CURSORS    *18050033
180600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18060033
180700*   USER.                                                        *18070033
180800*----------------------------------------------------------------*18080033
180900*                                                                 18090074
181000 4010-OPEN-CURSOR.                                                18100033
181100     PERFORM                                                      18110033
181200         WITH TEST AFTER                                          18120033
181300         VARYING PV-RETRY-COUNTER                                 18130033
181400         FROM 1 BY 1                                              18140033
181500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18150033
181600                   OR (SQLCODE = ZERO))                           18160033
181700*                                                                 18170033
181800         EVALUATE TRUE                                            18180033
181900             WHEN ASC-DRIVERS-LIC-CURSOR                          18190033
182000                 MOVE 'CURSOR:  DRIVERS-LIC-CSR'                  18200033
182100                                   TO DP013-MESSAGE-TEXT (2)      18210033
182200                 EXEC SQL                                         18220033
182300                      OPEN DRIVERS-LIC-CSR                        18230033
182400                 END-EXEC                                         18240033
182500                                                                  18250033
182600             WHEN ASC-SSN-CURSOR                                  18260033
182700                 MOVE 'CURSOR:  SSN-CSR'                          18270033
182800                                   TO DP013-MESSAGE-TEXT (2)      18280033
182900                 EXEC SQL                                         18290033
183000                      OPEN SSN-CSR                                18300033
183100                 END-EXEC                                         18310033
183200                                                                  18320033
183400             WHEN ASC-RECEIPT-CURSOR                              18340033
183500                 MOVE 'CURSOR:  RECEIPT-CSR'                      18350033
183600                                   TO DP013-MESSAGE-TEXT (2)      18360033
183700                 EXEC SQL                                         18370033
183800                      OPEN RECEIPT-CSR                            18380033
183900                 END-EXEC                                         18390033
184000                                                                  18400033
184100             WHEN ASC-STORE-CURSOR                                18410033
184200                 MOVE 'CURSOR:  STORE-CSR'                        18420033
184300                                   TO DP013-MESSAGE-TEXT (2)      18430033
184400                 EXEC SQL                                         18440033
184500                      OPEN STORE-CSR                              18450033
184600                 END-EXEC                                         18460033
184610                                                                  18461099
184620             WHEN ASC-STORE2-CURSOR                               18462099
184630                 MOVE 'CURSOR:  STORE-CSR'                        18463099
184640                                   TO DP013-MESSAGE-TEXT (2)      18464099
184650                 EXEC SQL                                         18465099
184660                      OPEN STORE2-CSR                             18466099
184670                 END-EXEC                                         18467099
184700                                                                  18470033
184800             WHEN ASC-TERMINAL-CURSOR                             18480033
184900                 MOVE 'CURSOR:  TERMINAL-CSR'                     18490033
185000                                   TO DP013-MESSAGE-TEXT (2)      18500033
185100                 EXEC SQL                                         18510033
185200                      OPEN TERMINAL-CSR                           18520033
185300                 END-EXEC                                         18530033
185400                                                                  18540033
185500             WHEN ASC-TRANSACTION-CURSOR                          18550033
185600                 MOVE 'CURSOR:  TRANSACTION-CSR'                  18560033
185700                                   TO DP013-MESSAGE-TEXT (2)      18570033
185800                 EXEC SQL                                         18580033
185900                      OPEN TRANSACTION-CSR                        18590033
186000                 END-EXEC                                         18600033
186100                                                                  18610033
186200             WHEN ASC-APPRVL-CURSOR                               18620033
186300                 MOVE 'CURSOR:  APPRVL-CDE-CSR'                   18630033
186400                                   TO DP013-MESSAGE-TEXT (2)      18640033
186500                 EXEC SQL                                         18650033
186600                      OPEN APPRVL-CDE-CSR                         18660033
186700                 END-EXEC                                         18670033
186710                                                                  18671099
186720             WHEN ASC-STATDT-CURSOR                               18672099
186730                 MOVE 'CURSOR:  STATUS-DTE-CSR'                   18673099
186740                                   TO DP013-MESSAGE-TEXT (2)      18674099
186750                 EXEC SQL                                         18675099
186760                      OPEN STATUS-DTE-CSR                         18676099
186770                 END-EXEC                                         18677099
186800                                                                  18680033
186900             WHEN ASC-CUSTID-CURSOR                               18690099
186901                 MOVE 'CURSOR:  CUST-ID-CSR'                      18690199
186902                                   TO DP013-MESSAGE-TEXT (2)      18690299
186903                 EXEC SQL                                         18690399
186904                      OPEN CUST-ID-CSR                            18690499
186905                 END-EXEC                                         18690599
186906                                                                  18690633
186907         END-EVALUATE                                             18690733
187000                                                                  18700033
187100         EVALUATE TRUE                                            18710033
187200             WHEN SQLCODE = ZERO                                  18720033
187300             WHEN SQLCODE = -904                                  18730033
187400             WHEN SQLCODE = -913                                  18740033
187500                 CONTINUE                                         18750033
187600             WHEN SQLWARN0 NOT = SPACES                           18760033
187700             WHEN SQLCODE < ZERO                                  18770033
187800             WHEN SQLCODE > ZERO                                  18780033
187900                 MOVE '4010-OPEN-CURSOR'                          18790033
188000                                   TO DP013-PARAGRAPH             18800033
188100                 MOVE 'OPEN CURSOR - '                            18810033
188200                                   TO DP013-MESSAGE-TEXT (1)      18820033
188300                 MOVE SQLCA        TO DP013-SQLCA                 18830033
188400                 MOVE 'RDT MAL CK RFND'                           18840033
188500                                   TO DP013-DB2-TABLE-NAME (1)    18850033
188510                 MOVE 'RDT CUST       '                           18851077
188520                                   TO DP013-DB2-TABLE-NAME (2)    18852077
188600                 SET DP013-DB2-ABEND                              18860033
188700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18870033
188800                 PERFORM DP013-0000-PROCESS-ABEND                 18880033
188900         END-EVALUATE                                             18890033
189000     END-PERFORM.                                                 18900033
189100*                                                                 18910033
189200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18920033
189300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18930033
189400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18940033
189500                                   TO DP013-MESSAGE-TEXT (1)      18950033
189600         MOVE SQLCA                TO DP013-SQLCA                 18960033
189700         MOVE 'RDT MAL CK RFND'    TO DP013-DB2-TABLE-NAME (1)    18970033
189710         MOVE 'RDT CUST       '    TO DP013-DB2-TABLE-NAME (2)    18971077
189800         SET DP013-DB2-ABEND                                      18980033
189900             DP013-XCTL-DISPLAY-RESTART                           18990033
190000                                   TO TRUE                        19000033
190100         PERFORM DP013-0000-PROCESS-ABEND                         19010033
190200     END-IF.                                                      19020033
190300                                                                  19030033
190500*----------------------------------------------------------------*19050033
190600* CLOSE THE CURSOR.                                              *19060033
190700*   IN THIS PARTICULAR APPLICATION ONE OF 7 DIFFERENT CURSORS    *19070033
190800*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *19080033
190900*   USER.                                                        *19090033
191000*----------------------------------------------------------------*19100033
191100                                                                  19110033
191300 4020-CLOSE-CURSOR.                                               19130033
191400         EVALUATE TRUE                                            19140033
191500             WHEN ASC-DRIVERS-LIC-CURSOR                          19150033
191510                  MOVE 'CLOSE DRIVERS-LIC CURSOR '                19151082
191520                                    TO DP013-MESSAGE-TEXT (1)     19152082
191600                  EXEC SQL                                        19160033
191700                       CLOSE DRIVERS-LIC-CSR                      19170033
191800                  END-EXEC                                        19180033
191900                                                                  19190033
192000             WHEN ASC-SSN-CURSOR                                  19200033
192010                  MOVE 'CLOSE SSN CURSOR '                        19201082
192020                                    TO DP013-MESSAGE-TEXT (1)     19202082
192100                  EXEC SQL                                        19210033
192200                       CLOSE SSN-CSR                              19220085
192300                  END-EXEC                                        19230085
192400                                                                  19240033
192500             WHEN ASC-APPRVL-CURSOR                               19250033
192510                  MOVE 'CLOSE APPRVL-CDE CURSOR '                 19251082
192520                                    TO DP013-MESSAGE-TEXT (1)     19252082
192600                  EXEC SQL                                        19260033
192700                       CLOSE APPRVL-CDE-CSR                       19270033
192800                  END-EXEC                                        19280033
192900                                                                  19290033
193100             WHEN ASC-RECEIPT-CURSOR                              19310033
193110                  MOVE 'CLOSE RECEIPT CURSOR '                    19311082
193120                                    TO DP013-MESSAGE-TEXT (1)     19312082
193200                  EXEC SQL                                        19320033
193300                      CLOSE RECEIPT-CSR                           19330033
193400                  END-EXEC                                        19340033
193500                                                                  19350033
193600             WHEN ASC-STORE-CURSOR                                19360033
193610                  MOVE 'CLOSE STORE CURSOR '                      19361082
193620                                    TO DP013-MESSAGE-TEXT (1)     19362082
193700                  EXEC SQL                                        19370033
193800                      CLOSE STORE-CSR                             19380033
193900                  END-EXEC                                        19390033
193910                                                                  19391099
193920             WHEN ASC-STORE2-CURSOR                               19392099
193930                  MOVE 'CLOSE STORE CURSOR '                      19393099
193940                                    TO DP013-MESSAGE-TEXT (1)     19394099
193950                  EXEC SQL                                        19395099
193960                      CLOSE STORE2-CSR                            19396099
193970                  END-EXEC                                        19397099
194000                                                                  19400033
194100             WHEN ASC-TERMINAL-CURSOR                             19410033
194110                  MOVE 'CLOSE TERMINAL CURSOR '                   19411082
194120                                    TO DP013-MESSAGE-TEXT (1)     19412082
194200                  EXEC SQL                                        19420033
194300                      CLOSE TERMINAL-CSR                          19430033
194400                  END-EXEC                                        19440033
194500                                                                  19450033
194600             WHEN ASC-TRANSACTION-CURSOR                          19460033
194610                  MOVE 'CLOSE TRANSACTION CURSOR '                19461082
194620                                    TO DP013-MESSAGE-TEXT (1)     19462082
194700                  EXEC SQL                                        19470033
194800                      CLOSE TRANSACTION-CSR                       19480033
194900                  END-EXEC                                        19490033
194910                                                                  19491099
194920             WHEN ASC-STATDT-CURSOR                               19492099
194930                  MOVE 'CLOSE STATUS DATE CURSOR '                19493099
194940                                    TO DP013-MESSAGE-TEXT (1)     19494099
194950                  EXEC SQL                                        19495099
194960                      CLOSE STATUS-DTE-CSR                        19496099
194970                  END-EXEC                                        19497099
195000                                                                  19500033
195100             WHEN ASC-CUSTID-CURSOR                               19510099
195101                  MOVE 'CLOSE CUST-ID CURSOR '                    19510199
195102                                    TO DP013-MESSAGE-TEXT (1)     19510299
195103                  EXEC SQL                                        19510399
195104                      CLOSE CUST-ID-CSR                           19510499
195105                  END-EXEC                                        19510599
195106                                                                  19510633
195107     END-EVALUATE.                                                19510733
195200*                                                                 19520033
195300     EVALUATE TRUE                                                19530033
195400         WHEN SQLCODE = ZERO                                      19540033
195500             CONTINUE                                             19550033
195600         WHEN SQLWARN0 NOT = SPACES                               19560033
195700         WHEN SQLCODE < ZERO                                      19570033
195800         WHEN SQLCODE > ZERO                                      19580033
196100             MOVE 'CLOSE APPROVAL CODE CURSOR - '                 19610033
196200                               TO DP013-MESSAGE-TEXT (1)          19620033
196300             MOVE SQLCA        TO DP013-SQLCA                     19630033
196400             MOVE 'RDT MAL CK RFND'                               19640033
196500                               TO DP013-DB2-TABLE-NAME (1)        19650033
196510             MOVE 'RDT CUST       '                               19651077
196520                               TO DP013-DB2-TABLE-NAME (2)        19652077
196600             SET DP013-DB2-ABEND                                  19660033
196700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19670033
196800             PERFORM DP013-0000-PROCESS-ABEND                     19680033
196900     END-EVALUATE.                                                19690033
196901*                                                                *19690198
197200*----------------------------------------------------------------*19720033
197300*    SET UP THE HOST VARIABLES.                                  *19730033
197400*----------------------------------------------------------------*19740033
197500*                                                                 19750074
197600 4100-PREPARE-CURSOR.                                             19760033
197700                                                                  19770033
197800     SET ASC-NO-CURSOR         TO TRUE.                           19780033
197900                                                                  19790033
197910     IF ASC-KEY-STATUS-CDE > SPACES AND                           19791099
197912        ASC-KEY-RECEIPT-DTE > SPACES                              19791299
197920              SET ASC-STATDT-CURSOR                               19792099
197930                  TO TRUE                                         19793099
197940     ELSE                                                         19794099
198000      IF ASC-KEY-DRIVERS-LIC > SPACES                             19800099
198100          SET ASC-DRIVERS-LIC-CURSOR                              19810099
198200              TO TRUE                                             19820099
198300      ELSE                                                        19830099
198400        IF ASC-KEY-SSN > ZEROS                                    19840033
198500           SET ASC-SSN-CURSOR                                     19850033
198600               TO TRUE                                            19860033
198700        ELSE                                                      19870033
198900           IF ASC-KEY-STATUS-CDE > SPACES                         19890097
199000              SET ASC-APPRVL-CURSOR                               19900033
199100                  TO TRUE                                         19910033
199200           ELSE                                                   19920033
199300              IF ASC-KEY-TRANSACTION > 0                          19930033
199400                 PERFORM 4200-TRANSACTION-EDIT                    19940033
199500              ELSE                                                19950033
199600                  IF ASC-KEY-TERMINAL > 0                         19960033
199700                     PERFORM 4210-TERMINAL-EDIT                   19970033
199800                  ELSE                                            19980033
199900                     IF ASC-KEY-STORE-NBR > 0                     19990099
200000                        PERFORM 4220-STORE-EDIT                   20000099
200100                     ELSE                                         20010099
200210                        IF ASC-KEY-RECEIPT-DTE > SPACES           20021099
200300                           SET ASC-RECEIPT-CURSOR                 20030033
200400                               TO TRUE                            20040033
200520                        ELSE                                      20052099
200530                           IF ASC-KEY-CUST-ID > 0                 20053099
200540                              SET ASC-CUSTID-CURSOR               20054099
200550                                  TO TRUE                         20055099
200560                           END-IF                                 20056099
200570                        END-IF                                    20057099
200600                     END-IF                                       20060033
200700                  END-IF                                          20070033
200800              END-IF                                              20080033
200900           END-IF                                                 20090033
201000        END-IF                                                    20100033
201020      END-IF                                                      20102099
201100     END-IF.                                                      20110033
201200                                                                  20120033
201300*----------------------------------------------------------------*20130033
201400*                                                                 20140033
201500*  IF TRANSACTION IS FILLED IN THEN TERMINAL, STORE AND RECEIPT   20150033
201600*  DATE MUST BE FILLED IN TOO.                                    20160033
201700*                                                                 20170033
201800*  IF TERMINAL IS FILLED IN, THEN STORE AND RECEIPT DATE MUST BE  20180033
201900*  FILLED IN TOO.                                                 20190033
202000*                                                                 20200033
202100*  IF STORE IS FILLED IN, THEN RECEIPT DATE MUST BE FILLED IN TOO 20210033
202200*                                                                 20220033
202300*----------------------------------------------------------------*20230033
202400*                                                                 20240074
202500 4200-TRANSACTION-EDIT.                                           20250033
202610     IF ASC-KEY-RECEIPT-DTE      > SPACES      AND                20261099
202700        ASC-KEY-STORE-NBR        > 0           AND                20270033
202800        ASC-KEY-TERMINAL         > 0                              20280033
202900        SET ASC-TRANSACTION-CURSOR                                20290033
203000            TO TRUE                                               20300033
203100     ELSE                                                         20310033
203200        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     20320033
203300        SET DP020-MSG-FATAL   TO  TRUE                            20330033
203310*       -- INVALID DATE/STORE/TERMINAL/TRANSACTION --             20331083
203400        MOVE PC-TSYMSG-03084  TO  DP020-MSG-NUMBER                20340033
203500        SET  PS-COMMAREA-NOT-VALID TO TRUE                        20350033
203600     END-IF.                                                      20360033
203700                                                                  20370033
203800 4210-TERMINAL-EDIT.                                              20380033
203920     IF ASC-KEY-RECEIPT-DTE      > SPACES      AND                20392099
204000        ASC-KEY-STORE-NBR        > 0                              20400033
204100        SET ASC-TERMINAL-CURSOR                                   20410033
204200            TO TRUE                                               20420033
204300     ELSE                                                         20430033
204400        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     20440033
204500        SET DP020-MSG-FATAL   TO  TRUE                            20450033
204510*       -- INVALID DATE/STORE/TERMINAL/TRANSACTION --             20451083
204600        MOVE PC-TSYMSG-03084  TO  DP020-MSG-NUMBER                20460033
204700        SET  PS-COMMAREA-NOT-VALID TO TRUE                        20470033
204800     END-IF.                                                      20480033
204900                                                                  20490033
205000 4220-STORE-EDIT.                                                 20500033
205012     IF ASC-KEY-RECEIPT-DTE      = SPACES      AND                20501299
205013        ASC-KEY-TRANSACTION      = 0           AND                20501399
205030        ASC-KEY-TERMINAL         = 0                              20503099
205031        SET ASC-STORE2-CURSOR                                     20503199
205050            TO TRUE                                               20505099
205060     ELSE                                                         20506099
205120     IF ASC-KEY-RECEIPT-DTE      > SPACES                         20512099
205200        SET ASC-STORE-CURSOR                                      20520033
205300            TO TRUE                                               20530033
205400     ELSE                                                         20540033
205500        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     20550033
205600        SET DP020-MSG-FATAL   TO  TRUE                            20560033
205610*       -- INVALID DATE/STORE/TERMINAL/TRANSACTION --             20561083
205700        MOVE PC-TSYMSG-03084  TO  DP020-MSG-NUMBER                20570033
205800        SET  PS-COMMAREA-NOT-VALID TO TRUE                        20580033
205900     END-IF.                                                      20590033
206000                                                                  20600081
206100*----------------------------------------------------------------*20610033
206200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20620033
206300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20630033
206400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20640033
206500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20650033
206600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20660033
206700*                                                                *20670033
206800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20680033
206900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20690033
207000*    UPON INITIALIZATION.                                        *20700033
207100*----------------------------------------------------------------*20710033
207200                                                                  20720033
207300 4300-READ-ITEMS-FROM-DB.                                         20730033
207400                                                                  20740033
207500     PERFORM                                                      20750033
207600         VARYING PV-READ-COUNT                                    20760033
207700         FROM 1 BY 1                                              20770033
207800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20780033
207900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20790033
208000                                                                  20800033
208100         PERFORM 4310-FETCH                                       20810033
208200                                                                  20820033
208300         IF  ASC-ITEMS-LEFT-ON-DB                                 20830033
208400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20840033
208500                 ADD +1            TO ASC-ITEM-SUB                20850033
208600             ELSE                                                 20860033
208700                 ADD +1            TO ASC-BLK-SUB                 20870033
208800                 MOVE +1           TO ASC-ITEM-SUB                20880033
208900                                                                  20890033
209000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20900033
209100                     MOVE +1       TO ASC-BLK-SUB                 20910033
209200                     SET ASC-BLOCK-MODIFIED (1)                   20920033
209300                                   TO TRUE                        20930033
209400                     PERFORM 5100-WRITE-TEMP-STORAGE              20940033
209500                     MOVE ASC-BLOCK-ENTRIES                       20950033
209600                               (PC-MAX-BLOCKS-IN-ARRAY)           20960033
209700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20970033
209800                     ADD +1        TO ASC-BLK-SUB                 20980033
209900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20990033
210000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21000033
210100                                   TO TRUE                        21010033
210200                 END-IF                                           21020033
210300             END-IF                                               21030033
210400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21040033
210500             MOVE ASC-NUMBER-OF-ITEMS-READ                        21050033
210600                                   TO ASC-LIST-ITEM-NUMBER        21060033
210700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21070033
210900             MOVE RDT00001-STR-NBR                                21090033
211000                               TO  ASC-STORE-NBR                  21100033
211100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21110033
211200             MOVE RDT00001-RFND-REQ-DTE                           21120033
211300                               TO  ASC-RECEIPT-DTE                21130033
211400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21140033
211500             MOVE RDT00001-STR-RGST-ID                            21150033
211600                               TO  ASC-TERMINAL                   21160033
211700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21170033
211800             MOVE RDT00001-RGST-TRN-NBR                           21180033
211900                               TO  ASC-TRANSACTION                21190033
212000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21200033
212100             MOVE RDT00001-RFND-SEQ-NBR                           21210099
212200                               TO  ASC-SEQ-NBR                    21220099
212300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21230099
212331             IF IV-RFND-AMT-ADJ = 0                               21233194
212332                MOVE RDT00001-ADJ-RFND-AMT                        21233294
212333                               TO  ASC-ADJ-REFUND                 21233394
212334                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21233494
212336             ELSE                                                 21233694
212337                MOVE RDT00001-RFND-AMT                            21233794
212338                               TO  ASC-REFUND                     21233894
212339                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21233994
212340                MOVE ZEROES    TO  ASC-ADJ-REFUND                 21234095
212341                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21234195
212342             END-IF                                               21234294
212343                                                                  21234397
212400             MOVE RDT00001-RFND-STAT-CDE                          21240033
212500                               TO  ASC-STATUS-CDE                 21250097
212600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21260033
212700             EVALUATE ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)   21270097
212800                 WHEN 'A'                                         21280033
212900                      MOVE 'APPROVD' TO ASC-STATDESC              21290033
213000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21300033
213100                 WHEN 'D'                                         21310033
213200                      MOVE 'DENIED '  TO ASC-STATDESC             21320033
213300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21330033
213310                 WHEN 'M'                                         21331099
213320                      MOVE 'KMRC   ' TO ASC-STATDESC              21332099
213330                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21333099
213340                 WHEN 'V'                                         21334099
213350                      MOVE 'VOID   '  TO ASC-STATDESC             21335099
213360                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21336099
213370                 WHEN 'S'                                         21337099
213380                      MOVE 'STORE H'  TO ASC-STATDESC             21338099
213390                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21339099
213391                 WHEN 'C'                                         21339199
213392                      MOVE 'CASH PD' TO ASC-STATDESC              21339299
213393                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21339399
213400                 WHEN 'K'                                         21340033
213500                      MOVE 'KOHLS C' TO ASC-STATDESC              21350099
213600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21360033
213700                 WHEN 'B'                                         21370099
213800                      MOVE 'BANK CD'  TO ASC-STATDESC             21380099
213900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21390099
213910                 WHEN 'E'                                         21391099
213920                      MOVE 'MDSE XC'  TO ASC-STATDESC             21392099
213930                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21393099
214297                 WHEN 'O'                                         21429748
214298                      MOVE 'ORIG   '  TO ASC-STATDESC             21429848
214299                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21429948
214300                 WHEN 'P'                                         21430099
214301                      MOVE 'PENDING'  TO ASC-STATDESC             21430199
214302                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21430299
214303                 WHEN OTHER                                       21430399
214304                      MOVE 'UNKNOWN'  TO ASC-STATDESC             21430499
214305                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21430599
214310             END-EVALUATE                                         21431033
214400                                                                  21440033
214600             IF IV-STAT-CHNG-DTE = 0                              21460033
214700                MOVE RDT00001-STAT-CHNG-DTE                       21470033
214800                               TO  ASC-CHGDATE                    21480033
214900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21490033
215000             END-IF                                               21500033
215100                                                                  21510033
215300             IF IV-RFND-CK-DTE = 0                                21530033
215400                MOVE RDT00001-RFND-CK-DTE                         21540033
215500                               TO  ASC-CKDATE                     21550033
215600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21560033
215700             END-IF                                               21570033
215800                                                                  21580033
216000             IF  IV-RFND-CK-NBR = 0                               21600033
216100                 MOVE RDT00001-RFND-CK-NBR                        21610033
216200                               TO  ASC-CKNBR                      21620033
216300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21630033
216400             END-IF                                               21640033
216500                                                                  21650033
216700             MOVE RDT00001-CUST-ID                                21670033
216800                               TO  ASC-CUST-ID                    21680033
216900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21690033
216911                                   ASC-KEY-CUST-ID                21691182
217000             MOVE RDT00001-RFND-SEQ-NBR                           21700033
217100                               TO  ASC-SEQ-NBR                    21710033
217200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21720033
217300         END-IF                                                   21730033
217400     END-PERFORM.                                                 21740033
217500                                                                  21750033
217600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21760033
217700         MOVE +1               TO ASC-BLK-SUB                     21770033
217800         PERFORM 5100-WRITE-TEMP-STORAGE                          21780033
217900         ADD +1                TO ASC-BLK-SUB                     21790033
218000         PERFORM 5100-WRITE-TEMP-STORAGE                          21800033
218100                                                                  21810033
218200         MOVE 1                TO ASC-BLK-SUB                     21820033
218300                                  PV-BLOCK-NUMBER                 21830033
218400         PERFORM 4410-READ-TEMP-STORAGE                           21840033
218500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21850033
218600             MOVE 2            TO ASC-BLK-SUB                     21860033
218700                                  PV-BLOCK-NUMBER                 21870033
218800             PERFORM 4410-READ-TEMP-STORAGE                       21880033
218900         END-IF                                                   21890033
219000     END-IF.                                                      21900033
219100                                                                  21910081
219200*----------------------------------------------------------------*21920033
219300*    FETCH THE APPROPRIATE CURSOR.                               *21930033
219400*----------------------------------------------------------------*21940033
219500 4310-FETCH.                                                      21950033
219501     MOVE 0 TO IV-STAT-CHNG-DTE.                                  21950182
219502     MOVE 0 TO IV-RFND-CK-DTE.                                    21950282
219503     MOVE 0 TO IV-RFND-CK-NBR.                                    21950382
219504     MOVE 0 TO IV-RFND-AMT-ADJ.                                   21950499
219505                                                                  21950599
220200     EVALUATE TRUE                                                22020033
220300                                                                  22030033
220400       WHEN ASC-APPRVL-CURSOR                                     22040033
220500         EXEC SQL                                                 22050033
220600          FETCH APPRVL-CDE-CSR                                    22060033
220700                   INTO  :RDT00001-STR-NBR                        22070033
220800                       , :RDT00001-RFND-REQ-DTE                   22080033
220900                       , :RDT00001-STR-RGST-ID                    22090033
221000                       , :RDT00001-RGST-TRN-NBR                   22100033
221100                       , :RDT00001-RFND-AMT                       22110033
221103                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22110399
221200                       , :RDT00001-RFND-STAT-CDE                  22120094
221300                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22130033
221400                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22140033
221500                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22150033
221600                       , :RDT00001-CUST-ID                        22160033
221700                       , :RDT00001-RFND-SEQ-NBR                   22170033
221800         END-EXEC                                                 22180033
221900                                                                  22190033
222100       WHEN ASC-RECEIPT-CURSOR                                    22210033
222200         EXEC SQL                                                 22220033
222300          FETCH RECEIPT-CSR                                       22230033
222400                   INTO  :RDT00001-STR-NBR                        22240033
222500                       , :RDT00001-RFND-REQ-DTE                   22250033
222600                       , :RDT00001-STR-RGST-ID                    22260033
222700                       , :RDT00001-RGST-TRN-NBR                   22270033
222800                       , :RDT00001-RFND-AMT                       22280033
222820                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22282094
222900                       , :RDT00001-RFND-STAT-CDE                  22290033
223000                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22300033
223100                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22310033
223200                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22320033
223300                       , :RDT00001-CUST-ID                        22330033
223400                       , :RDT00001-RFND-SEQ-NBR                   22340033
223500                       , :RDT00001-CUST-ID                        22350033
223600                       , :RDT00001-RFND-SEQ-NBR                   22360033
223700         END-EXEC                                                 22370033
223800                                                                  22380033
223900       WHEN ASC-STORE-CURSOR                                      22390033
224000         EXEC SQL                                                 22400033
224100          FETCH STORE-CSR                                         22410033
224200                   INTO  :RDT00001-STR-NBR                        22420033
224300                       , :RDT00001-RFND-REQ-DTE                   22430033
224400                       , :RDT00001-STR-RGST-ID                    22440033
224500                       , :RDT00001-RGST-TRN-NBR                   22450033
224600                       , :RDT00001-RFND-AMT                       22460033
224620                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22462094
224700                       , :RDT00001-RFND-STAT-CDE                  22470033
224800                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22480033
224900                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22490033
225000                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22500033
225100                       , :RDT00001-CUST-ID                        22510033
225200                       , :RDT00001-RFND-SEQ-NBR                   22520033
225300                       , :RDT00001-CUST-ID                        22530033
225400                       , :RDT00001-RFND-SEQ-NBR                   22540033
225500         END-EXEC                                                 22550033
225510                                                                  22551099
225520       WHEN ASC-STORE2-CURSOR                                     22552099
225530         EXEC SQL                                                 22553099
225540          FETCH STORE2-CSR                                        22554099
225550                   INTO  :RDT00001-STR-NBR                        22555099
225560                       , :RDT00001-RFND-REQ-DTE                   22556099
225570                       , :RDT00001-STR-RGST-ID                    22557099
225580                       , :RDT00001-RGST-TRN-NBR                   22558099
225590                       , :RDT00001-RFND-AMT                       22559099
225591                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22559199
225592                       , :RDT00001-RFND-STAT-CDE                  22559299
225593                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22559399
225594                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22559499
225595                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22559599
225596                       , :RDT00001-CUST-ID                        22559699
225597                       , :RDT00001-RFND-SEQ-NBR                   22559799
225598                       , :RDT00001-CUST-ID                        22559899
225599                       , :RDT00001-RFND-SEQ-NBR                   22559999
225600         END-EXEC                                                 22560099
225610                                                                  22561033
225700       WHEN ASC-TERMINAL-CURSOR                                   22570033
225800         EXEC SQL                                                 22580033
225900          FETCH TERMINAL-CSR                                      22590033
226000                   INTO  :RDT00001-STR-NBR                        22600033
226100                       , :RDT00001-RFND-REQ-DTE                   22610033
226200                       , :RDT00001-STR-RGST-ID                    22620033
226300                       , :RDT00001-RGST-TRN-NBR                   22630033
226400                       , :RDT00001-RFND-AMT                       22640033
226420                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22642094
226500                       , :RDT00001-RFND-STAT-CDE                  22650033
226600                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22660033
226700                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22670033
226800                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22680033
226900                       , :RDT00001-CUST-ID                        22690033
227000                       , :RDT00001-RFND-SEQ-NBR                   22700033
227100                       , :RDT00001-CUST-ID                        22710033
227200                       , :RDT00001-RFND-SEQ-NBR                   22720033
227300         END-EXEC                                                 22730033
227400                                                                  22740033
227500       WHEN ASC-TRANSACTION-CURSOR                                22750033
227600         EXEC SQL                                                 22760033
227700          FETCH TRANSACTION-CSR                                   22770033
227800                   INTO  :RDT00001-STR-NBR                        22780033
227900                       , :RDT00001-RFND-REQ-DTE                   22790033
228000                       , :RDT00001-STR-RGST-ID                    22800033
228100                       , :RDT00001-RGST-TRN-NBR                   22810033
228200                       , :RDT00001-RFND-AMT                       22820033
228220                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   22822094
228300                       , :RDT00001-RFND-STAT-CDE                  22830033
228400                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 22840033
228500                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     22850033
228600                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     22860033
228700                       , :RDT00001-CUST-ID                        22870033
228800                       , :RDT00001-RFND-SEQ-NBR                   22880033
228900                       , :RDT00001-CUST-ID                        22890033
229000                       , :RDT00001-RFND-SEQ-NBR                   22900033
229100         END-EXEC                                                 22910033
229200                                                                  22920033
229400       WHEN ASC-DRIVERS-LIC-CURSOR                                22940033
229500         EXEC SQL                                                 22950033
229600          FETCH DRIVERS-LIC-CSR                                   22960033
229700                   INTO  :RDT00001-STR-NBR                        22970033
229800                       , :RDT00001-RFND-REQ-DTE                   22980033
229900                       , :RDT00001-STR-RGST-ID                    22990033
230000                       , :RDT00001-RGST-TRN-NBR                   23000033
230100                       , :RDT00001-RFND-AMT                       23010033
230120                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   23012094
230200                       , :RDT00001-RFND-STAT-CDE                  23020033
230300                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 23030033
230400                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     23040033
230500                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     23050033
230600                       , :RDT00001-CUST-ID                        23060033
230700                       , :RDT00001-RFND-SEQ-NBR                   23070033
230800         END-EXEC                                                 23080033
230900                                                                  23090033
231000       WHEN ASC-SSN-CURSOR                                        23100033
231100         EXEC SQL                                                 23110033
231200          FETCH SSN-CSR                                           23120033
231300                   INTO  :RDT00001-STR-NBR                        23130033
231400                       , :RDT00001-RFND-REQ-DTE                   23140033
231500                       , :RDT00001-STR-RGST-ID                    23150033
231600                       , :RDT00001-RGST-TRN-NBR                   23160033
231700                       , :RDT00001-RFND-AMT                       23170033
231720                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   23172094
231800                       , :RDT00001-RFND-STAT-CDE                  23180033
231900                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 23190033
232000                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     23200033
232100                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     23210033
232200                       , :RDT00001-CUST-ID                        23220033
232300                       , :RDT00001-RFND-SEQ-NBR                   23230033
232400         END-EXEC                                                 23240033
232410                                                                  23241099
232420       WHEN ASC-STATDT-CURSOR                                     23242099
232430         EXEC SQL                                                 23243099
232440          FETCH STATUS-DTE-CSR                                    23244099
232450                   INTO  :RDT00001-STR-NBR                        23245099
232460                       , :RDT00001-RFND-REQ-DTE                   23246099
232470                       , :RDT00001-STR-RGST-ID                    23247099
232480                       , :RDT00001-RGST-TRN-NBR                   23248099
232490                       , :RDT00001-RFND-AMT                       23249099
232491                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   23249199
232492                       , :RDT00001-RFND-STAT-CDE                  23249299
232493                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 23249399
232494                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     23249499
232495                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     23249599
232496                       , :RDT00001-CUST-ID                        23249699
232497                       , :RDT00001-RFND-SEQ-NBR                   23249799
232498         END-EXEC                                                 23249899
232500                                                                  23250033
232510       WHEN ASC-CUSTID-CURSOR                                     23251099
232520         EXEC SQL                                                 23252099
232530          FETCH CUST-ID-CSR                                       23253099
232540                   INTO  :RDT00001-STR-NBR                        23254099
232550                       , :RDT00001-RFND-REQ-DTE                   23255099
232560                       , :RDT00001-STR-RGST-ID                    23256099
232570                       , :RDT00001-RGST-TRN-NBR                   23257099
232580                       , :RDT00001-RFND-AMT                       23258099
232590                       , :RDT00001-ADJ-RFND-AMT:IV-RFND-AMT-ADJ   23259099
232591                       , :RDT00001-RFND-STAT-CDE                  23259199
232592                       , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE 23259299
232593                       , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE     23259399
232594                       , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR     23259499
232595                       , :RDT00001-CUST-ID                        23259599
232596                       , :RDT00001-RFND-SEQ-NBR                   23259699
232597         END-EXEC                                                 23259799
232598                                                                  23259899
232600       END-EVALUATE.                                              23260088
232700                                                                  23270033
232800     EVALUATE TRUE                                                23280033
232900         WHEN SQLCODE = ZERO                                      23290033
233000         WHEN SQLCODE = +100                                      23300033
233100              CONTINUE                                            23310033
233200         WHEN SQLWARN0 NOT = SPACE                                23320033
233300         WHEN SQLCODE NOT = ZERO                                  23330033
233400              MOVE '4310-FETCH       '                            23340081
233500                               TO DP013-PARAGRAPH                 23350033
233600              MOVE 'FETCH CURSOR'                                 23360082
233700                               TO DP013-MESSAGE-TEXT (1)          23370033
233800              MOVE SQLCA       TO DP013-SQLCA                     23380033
233900              SET DP013-DB2-ABEND                                 23390033
234000                               TO TRUE                            23400033
234100              PERFORM DP013-0000-PROCESS-ABEND                    23410033
234200     END-EVALUATE.                                                23420088
234310                                                                  23431033
234400     IF  SQLCODE EQUAL +100                                       23440033
234500         SET ASC-NO-ITEMS-LEFT-ON-DB                              23450033
234600                                   TO TRUE                        23460033
234700     END-IF.                                                      23470033
234800                                                                  23480033
234810*----------------------------------------------------------------*23481099
234820*  LINK TO SECURITY MODULE TO CHECK USERS' AUTHORIZATION.         23482099
234830*----------------------------------------------------------------*23483099
234840 4350-CHECK-SECURITY-AUTH.                                        23484099
234850                                                                  23485099
234860     SET DP008-RSRC-TYPE-FUNC  TO  TRUE.                          23486099
234870     MOVE PC-DEL-RFND          TO  DP008-RESOURCE-NAME.           23487099
234880     SET DP008-ACCESS-TYPE-USE TO  TRUE.                          23488099
234890                                                                  23489099
234891     EXEC CICS                                                    23489199
234892         LINK                                                     23489299
234893            PROGRAM  (DP008-SECURITY-SUBROUTINE)                  23489399
234894            COMMAREA (DP008-SECURITY-COMMAREA)                    23489499
234895            LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)             23489599
234896            RESP     (PV-CICS-RESP)                               23489699
234897     END-EXEC.                                                    23489799
234898                                                                  23489899
234899     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        23489999
234900*  ---  BAD LINK TO SECURITY MODULE ---                           23490099
234910        MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER                 23491099
234920        SET DP020-MSG-WARNING TO TRUE                             23492099
234970     ELSE                                                         23497099
234980        IF DP008-ACCESS-ALLOWED                                   23498099
234992           CONTINUE                                               23499299
234993        ELSE                                                      23499399
234994* ---  THE FUNCTION REQUESTED IS NOT AUTHORIZED FOR YOUR USERID-- 23499499
234995           MOVE PC-TSYMSG-99910 TO DP020-MSG-NUMBER               23499599
234997           SET DP020-MSG-FATAL  TO TRUE                           23499799
235020        END-IF                                                    23502099
235030     END-IF.                                                      23503099
235040                                                                  23504099
235050*----------------------------------------------------------------*23505099
235060*    IF THE USER HAS THE PROPER AUTHORIZATION THEY WILL BE ABLE TO23506099
235070*    DELETE CORPORATE REFUNDS                                     23507099
235080*----------------------------------------------------------------*23508099
235090 4360-DELETE-REFUND.                                              23509099
235091                                                                  23509199
235092     PERFORM                                                      23509299
235093        WITH TEST AFTER                                           23509399
235094        VARYING PV-RETRY-COUNTER                                  23509499
235095        FROM 1 BY 1                                               23509599
235096        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                23509699
235097                  OR (SQLCODE = ZERO))                            23509799
235098                                                                  23509899
235099        EXEC SQL                                                  23509999
235100            DELETE FROM RDT_MAL_CK_RFND                           23510099
235110             WHERE CUST_ID       = :ASC-KEY-CUST-ID               23511099
235120               AND STR_RGST_ID   = :ASC-KEY-TERMINAL              23512099
235130               AND RGST_TRN_NBR  = :ASC-KEY-TRANSACTION           23513099
235140               AND RFND_SEQ_NBR  = :ASC-KEY-SEQ-NBR               23514099
235150        END-EXEC                                                  23515099
235160                                                                  23516099
235170        EVALUATE TRUE                                             23517099
235180            WHEN SQLCODE = +0                                     23518099
235190                MOVE PC-TSYMSG-00115 TO DP020-MSG-NUMBER          23519099
235191            WHEN SQLCODE = +100                                   23519199
235192            WHEN SQLCODE = -310                                   23519299
235193            WHEN SQLCODE = -904                                   23519399
235194            WHEN SQLCODE = -913                                   23519499
235195               CONTINUE                                           23519599
235196            WHEN OTHER                                            23519699
235197                 MOVE '4360-DELETE-REFUND'                        23519799
235198                                  TO DP013-PARAGRAPH              23519899
235199                 MOVE 'DELETE FROM RDT_MAL_CK_RFND'               23519999
235200                                 TO DP013-MESSAGE-TEXT (1)        23520099
235210                 MOVE SQLCA       TO DP013-SQLCA                  23521099
235220                 MOVE 'RDT_MAL_CK_RFND'                           23522099
235230                                  TO DP013-DB2-TABLE-NAME (1)     23523099
235240                 SET DP013-DB2-ABEND  TO TRUE                     23524099
235250                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           23525099
235260                 PERFORM DP013-0000-PROCESS-ABEND                 23526099
235270        END-EVALUATE                                              23527099
235280     END-PERFORM.                                                 23528099
235290                                                                  23529099
235600*----------------------------------------------------------------*23560033
235700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23570033
235800*----------------------------------------------------------------*23580033
235900                                                                  23590033
236000 4400-MOVE-COMMAREA-TO-SCREEN.                                    23600033
237400*                                                                 23740074
237500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23750033
237600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23760033
237700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23770033
237800             MOVE +1    TO ASC-BLK-SUB                            23780033
237900             PERFORM 5100-WRITE-TEMP-STORAGE                      23790033
238000             ADD +1     TO ASC-BLK-SUB                            23800033
238100             PERFORM 5100-WRITE-TEMP-STORAGE                      23810033
238200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23820033
238300                 GIVING PV-BLOCK-NUMBER                           23830033
238400                 REMAINDER PV-REMAINDER                           23840033
238500             IF  PV-REMAINDER > ZERO                              23850033
238600                 ADD +1 TO PV-BLOCK-NUMBER                        23860033
238700             END-IF                                               23870033
238800             MOVE +1    TO ASC-BLK-SUB                            23880033
238900             PERFORM 4410-READ-TEMP-STORAGE                       23890033
239000             ADD +1     TO ASC-BLK-SUB                            23900033
239100                           PV-BLOCK-NUMBER                        23910033
239200             PERFORM 4410-READ-TEMP-STORAGE                       23920033
239300     END-IF.                                                      23930033
239400     MOVE +1            TO ASC-BLK-SUB.                           23940033
239500     COMPUTE ASC-ITEM-SUB =                                       23950033
239600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23960033
239700         + PC-ITEMS-PER-PANEL).                                   23970033
239800*                                                                 23980033
239900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23990033
240000         ADD +1         TO ASC-BLK-SUB                            24000033
240100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24010033
240200     END-IF.                                                      24020033
240300*                                                                 24030033
240400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24040033
240500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24050033
240600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        24060033
240700     PERFORM 4420-FORMAT-LIST-LINES                               24070033
240800         VARYING PV-SUB                                           24080033
240900         FROM PC-ITEMS-PER-PANEL BY -1                            24090033
241000         UNTIL PV-SUB < +1.                                       24100033
241100*                                                                 24110033
241200     COMPUTE ASC-ITEMS-DISPLAYED =                                24120033
241300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24130033
241400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24140033
241500                                      ASTRTITO.                   24150033
241600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    24160033
241700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    24170033
242000*                                                                 24200033
242100     IF  DP020-MSG-NUMBER-X = SPACE                               24210033
242200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  24220033
242300*            --- MORE ITEMS TO DISPLAY ----                       24230033
242400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            24240033
242500             SET DP020-MSG-INFORMATIONAL TO TRUE                  24250033
242600         END-IF                                                   24260033
242700     END-IF.                                                      24270033
242800*----------------------------------------------------------------*24280033
242900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *24290033
243000*----------------------------------------------------------------*24300033
243100                                                                  24310033
243200 4410-READ-TEMP-STORAGE.                                          24320033
243300                                                                  24330033
243400     EXEC CICS                                                    24340033
243500         READQ TS                                                 24350033
243600             QUEUE (ASC-LIST-QUEUE-NAME)                          24360033
243700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24370033
243800             ITEM  (PV-BLOCK-NUMBER)                              24380033
243900             RESP  (PV-CICS-RESP)                                 24390033
244000     END-EXEC.                                                    24400033
244100                                                                  24410033
244200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       24420033
244300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     24430033
244400         CONTINUE                                                 24440033
244500     ELSE                                                         24450033
244600         SET DP013-CICS-ABEND     TO TRUE                         24460033
244700         SET DP013-NO-ROLLBACK    TO TRUE                         24470033
244800         MOVE '4410-READ-TEMP-STORAGE'                            24480033
244900                                  TO DP013-PARAGRAPH              24490033
245000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24500033
245100                                  TO DP013-MESSAGE-TEXT(1)        24510033
245200         PERFORM DP013-0000-PROCESS-ABEND                         24520033
245300     END-IF.                                                      24530033
245400                                                                  24540033
245500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24550033
245600*                                                                 24560033
245700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24570033
245800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24580033
245900     END-IF.                                                      24590033
246000                                                                  24600081
246100*----------------------------------------------------------------*24610033
246200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24620033
246300*----------------------------------------------------------------*24630033
246400                                                                  24640033
246500 4420-FORMAT-LIST-LINES.                                          24650033
246600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24660033
246700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24670033
246800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        24680033
246900         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        24690033
247000*                                                                 24700074
247100         MOVE SPACE              TO MR-SELECTI    (PV-SUB)        24710033
247200                                    MR-STOREX     (PV-SUB)        24720033
247300                                    MR-RECTDTE    (PV-SUB)        24730033
247400                                    MR-REGISTERX  (PV-SUB)        24740033
247500                                    MR-TRANSX     (PV-SUB)        24750033
247600                                    MR-REFUNDX    (PV-SUB)        24760033
247700                                    MR-STATUS     (PV-SUB)        24770033
247800                                    MR-STATDESC   (PV-SUB)        24780033
247900                                    MR-CHGDATE    (PV-SUB)        24790033
248000                                    MR-CKDATE     (PV-SUB)        24800033
248100                                    MR-CKNBRX     (PV-SUB)        24810033
248200     ELSE                                                         24820033
248300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24830033
248400                                                   > SPACE        24840033
248500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24850033
248600                                 TO MR-SELECTI (PV-SUB)           24860033
248700         ELSE                                                     24870033
248800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24880033
248900                                 TO MR-SELECTI (PV-SUB)           24890033
249000         END-IF                                                   24900033
249100*                                                                 24910033
249200         IF  DP030-SET-CURSOR-TRAILER                             24920033
249300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24930033
249400                 > SPACE)                                         24940033
249500               OR (PV-SUB = 1))                                   24950033
249600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24960033
249700                MOVE -1          TO MR-SELECTL (PV-SUB)           24970033
249800             END-IF                                               24980033
249900         END-IF                                                   24990033
250000*                                                                 25000033
250100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           25010033
250300             MOVE ASC-STORE-NBR                                   25030033
250400                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25040033
250500                          TO MR-STORE (PV-SUB)                    25050033
250600             MOVE ASC-RECEIPT-DTE                                 25060033
250700                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25070033
250800                          TO MR-RECTDTE (PV-SUB)                  25080033
250900             MOVE ASC-TERMINAL                                    25090033
251000                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25100033
251100                          TO MR-REGISTER (PV-SUB)                 25110033
251200             MOVE ASC-TRANSACTION                                 25120033
251300                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25130033
251400                          TO MR-TRANS (PV-SUB)                    25140033
251500                                                                  25150097
251701             IF ASC-ADJ-REFUND (ASC-BLK-SUB ASC-ITEM-SUB) > 0     25170194
251703                MOVE ASC-ADJ-REFUND                               25170394
251704                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25170494
251705                                   TO MR-REFUND (PV-SUB)          25170594
251706                MOVE DP015-YELLOW  TO MR-REFUNDC (PV-SUB)         25170694
251707             ELSE                                                 25170794
251708                MOVE ASC-REFUND                                   25170894
251709                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25170994
251710                                   TO MR-REFUND (PV-SUB)          25171094
251711             END-IF                                               25171194
251720                                                                  25172097
251800             MOVE ASC-STATUS-CDE                                  25180097
251900                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25190033
252000                          TO MR-STATUS (PV-SUB)                   25200033
252100             MOVE ASC-STATDESC                                    25210033
252200                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25220033
252300                          TO MR-STATDESC (PV-SUB)                 25230033
252400             MOVE ASC-CHGDATE                                     25240033
252500                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25250033
252600                          TO MR-CHGDATE (PV-SUB)                  25260033
252700             MOVE ASC-CKDATE                                      25270033
252800                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25280033
252900                          TO MR-CKDATE (PV-SUB)                   25290033
253000             MOVE ASC-CKNBR                                       25300033
253100                     (ASC-BLK-SUB ASC-ITEM-SUB)                   25310033
253200                          TO MR-CKNBR (PV-SUB)                    25320033
254400         END-IF                                                   25440033
254500     END-IF.                                                      25450033
254600     SUBTRACT +1 FROM ASC-ITEM-SUB                                25460033
254700     IF  ASC-ITEM-SUB < + 1                                       25470033
254800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  25480033
254900         MOVE +1                 TO ASC-BLK-SUB                   25490033
255000     END-IF.                                                      25500033
255100******************************************************************25510033
255200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **25520033
255300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **25530033
255400** ISSUE A WARNING.                                             **25540033
255500******************************************************************25550033
255600 4430-CHECK-FOR-BEGIN-AND-END.                                    25560033
255700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25570033
255800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25580033
255900*            -- NO END-OF-RANGE SPECFIED ---                      25590033
256000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25600033
256100             SET DP020-MSG-WARNING TO TRUE                        25610033
256200             PERFORM 4431-POSITION-AT-WARNING                     25620033
256300         END-IF                                                   25630033
256400     ELSE                                                         25640033
256500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25650033
256600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25660033
256700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25670033
256800             SET DP020-MSG-WARNING TO TRUE                        25680033
256900             PERFORM 4431-POSITION-AT-WARNING                     25690033
257000         END-IF                                                   25700033
257100     END-IF.                                                      25710033
257200******************************************************************25720033
257300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **25730033
257400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **25740033
257500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **25750033
257600** POSITION THE CURSOR THERE.                                   **25760033
257700******************************************************************25770033
257800 4431-POSITION-AT-WARNING.                                        25780033
257900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25790033
258000                    - PV-TOP-ITEM + 1.                            25800033
258100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25810033
258200         CONTINUE                                                 25820033
258300     ELSE                                                         25830033
258400         SET DP030-SET-CURSOR-APPL-1                              25840033
258500                                   TO TRUE                        25850033
258600         MOVE -1                   TO MR-SELECTL (PV-SUB)         25860033
258700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25870033
258800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25880033
258900     END-IF.                                                      25890033
259000*                                                                 25900033
259100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25910033
259200                    - PV-TOP-ITEM + 1.                            25920033
259300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25930033
259400         CONTINUE                                                 25940033
259500     ELSE                                                         25950033
259600         SET DP030-SET-CURSOR-APPL-1                              25960033
259700                                   TO TRUE                        25970033
259800         MOVE -1                   TO MR-SELECTL (PV-SUB)         25980033
259900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25990033
260000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         26000033
260100     END-IF.                                                      26010033
260200                                                                  26020081
260300*----------------------------------------------------------------*26030033
260400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *26040033
260500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *26050033
260600* FOR THE SELECTED ITEMS QUEUE.                                  *26060033
260700*                                                                *26070033
260800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *26080033
260900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *26090033
261000* THE ARRAY IS FULL.                                             *26100033
261100*----------------------------------------------------------------*26110033
261200                                                                  26120033
261300 5000-PREPARE-SEL-QUEUE.                                          26130033
261400                                                                  26140033
261500     MOVE +1                   TO  ASC-BLK-SUB.                   26150033
261600     PERFORM 5100-WRITE-TEMP-STORAGE.                             26160033
261700     ADD +1                    TO  ASC-BLK-SUB.                   26170033
261800     PERFORM 5100-WRITE-TEMP-STORAGE.                             26180033
261900                                                                  26190033
262000     MOVE ASC-SEL-QUEUE-NAME   TO  RD034-SEL-QUEUE-NAME.          26200033
262100     PERFORM 6010-DELETE-SEL-QUEUE.                               26210033
262200                                                                  26220033
262300     SET ASC-UPDATE-TSQ        TO  TRUE.                          26230033
262400                                                                  26240033
262500     SET RD035-IDX             TO  1.                             26250033
262600     MOVE ZERO                 TO RD034-NUMBER-OF-TS-ITEMS.       26260033
262700     INITIALIZE RD035-SELECTED-ITEM-ARRAY.                        26270033
262800                                                                  26280033
262900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           26290033
263000             VARYING PV-ITEM                                      26300033
263100             FROM 1 BY 1                                          26310033
263200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     26320033
263310*                                                                 26331074
263400     IF  RD035-IDX > 1                                            26340060
263500         PERFORM 5205-WRITE-SEL-QUEUE                             26350060
263600         ADD +1                TO RD034-NUMBER-OF-TS-ITEMS        26360060
263700     END-IF.                                                      26370060
263800                                                                  26380081
263900*----------------------------------------------------------------*26390033
264000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26400033
264100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26410033
264200*----------------------------------------------------------------*26420033
264300                                                                  26430033
264400 5100-WRITE-TEMP-STORAGE.                                         26440033
264500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26450033
264600                                   TO PV-LIST-ITEM-NUMBER.        26460033
264700     COMPUTE PV-BLOCK-NUMBER =                                    26470033
264800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26480033
264900                                                                  26490033
265000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26500033
265100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26510033
265200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26520033
265300             PERFORM 5105-REWRITE-ASC-LISTQ                       26530033
265400         END-IF                                                   26540033
265500     ELSE                                                         26550033
265600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26560033
265700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26570033
265800         PERFORM 5110-WRITE-ASC-LISTQ                             26580033
265900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26590033
266000     END-IF.                                                      26600033
266100                                                                  26610033
266200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26620033
266300******************************************************************26630033
266400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **26640033
266500** SPECIFIC COMMAREA.                                           **26650033
266600******************************************************************26660033
266700 5105-REWRITE-ASC-LISTQ.                                          26670033
266800     EXEC CICS                                                    26680033
266900         WRITEQ TS                                                26690033
267000             QUEUE (ASC-LIST-QUEUE-NAME)                          26700033
267100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26710033
267200             ITEM  (PV-BLOCK-NUMBER)                              26720033
267300             REWRITE                                              26730033
267400             RESP  (PV-CICS-RESP)                                 26740033
267500     END-EXEC.                                                    26750033
267600                                                                  26760033
267700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26770033
267800         CONTINUE                                                 26780033
267900     ELSE                                                         26790033
268000         SET DP013-CICS-ABEND            TO TRUE                  26800033
268100         SET DP013-NO-ROLLBACK           TO TRUE                  26810033
268200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26820033
268300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26830033
268400                                         TO DP013-MESSAGE-TEXT(1) 26840033
268500         PERFORM DP013-0000-PROCESS-ABEND                         26850033
268600     END-IF.                                                      26860033
268700                                                                  26870033
268800******************************************************************26880033
268900** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **26890033
269000** SPECIFIC COMMAREA.                                           **26900033
269100******************************************************************26910033
269200 5110-WRITE-ASC-LISTQ.                                            26920033
269300     EXEC CICS                                                    26930033
269400         WRITEQ TS                                                26940033
269500             QUEUE (ASC-LIST-QUEUE-NAME)                          26950033
269600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26960033
269700             ITEM  (PV-BLOCK-NUMBER)                              26970033
269800             RESP  (PV-CICS-RESP)                                 26980033
269900     END-EXEC.                                                    26990033
270000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      27000033
270100         SET DP013-CICS-ABEND      TO TRUE                        27010033
270200         SET DP013-NO-ROLLBACK     TO TRUE                        27020033
270300         MOVE '5110-WRITE-ASC-LISTQ'                              27030033
270400                                   TO DP013-PARAGRAPH             27040033
270500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           27050033
270600                                   TO DP013-MESSAGE-TEXT(1)       27060033
270700         PERFORM DP013-0000-PROCESS-ABEND                         27070033
270800     END-IF.                                                      27080033
270900                                                                  27090081
271000*----------------------------------------------------------------*27100033
271100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *27110033
271200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *27120033
271300*----------------------------------------------------------------*27130033
271400                                                                  27140033
271500 5200-FILL-SEL-QUEUE-RECORD.                                      27150033
271600                                                                  27160033
271700     PERFORM 6112-READ-LIST-QUEUE.                                27170033
271800                                                                  27180033
271900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       27190033
272000         PERFORM                                                  27200033
272100         VARYING LQW-IDX                                          27210033
272200         FROM 1 BY 1                                              27220033
272300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            27230033
272400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          27240033
272500                                                                  27250033
272600             IF  LQW-SELECT (LQW-IDX)                             27260033
272700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              27270033
272800                                   TO RD035-ITEM       (RD035-IDX)27280033
273000                 MOVE LQW-STATUS-CDE  (LQW-IDX)                   27300097
273100                                   TO RD035-APPRVL-CDE (RD035-IDX)27310033
273200                 MOVE LQW-TERMINAL    (LQW-IDX)                   27320033
273300                                   TO RD034-TERMINAL              27330033
273501                                      ASC-KEY-TERMINAL            27350182
273600                 MOVE LQW-TRANSACTION (LQW-IDX)                   27360033
273700                                   TO RD034-TRANSACTION           27370033
273900                                      ASC-KEY-TRANSACTION         27390082
274000                 MOVE LQW-CUST-ID     (LQW-IDX)                   27400033
274100                                   TO RD034-CUST-ID               27410033
274110                                      ASC-KEY-CUST-ID             27411099
274200                 MOVE LQW-SEQ-NBR     (LQW-IDX)                   27420033
274300                                   TO RD034-SEQ-NBR               27430033
274400                                      ASC-KEY-SEQ-NBR             27440099
274500                 MOVE LQW-STORE-NBR   (LQW-IDX)                   27450064
274600                                   TO ASC-KEY-STORE-NBR           27460082
274700                 MOVE LQW-RECEIPT-DTE (LQW-IDX)                   27470064
274800                                   TO ASC-KEY-RECEIPT-DTE         27480082
275000                 MOVE LQW-REFUND      (LQW-IDX)                   27500033
275100                                   TO RD035-REFUND   (RD035-IDX)  27510096
275200                 MOVE LQW-STATDESC    (LQW-IDX)                   27520033
275300                                   TO RD035-STATDESC (RD035-IDX)  27530033
275400                 MOVE LQW-CHGDATE     (LQW-IDX)                   27540033
275500                                   TO RD035-CHGDATE  (RD035-IDX)  27550033
275600                 MOVE LQW-CKDATE      (LQW-IDX)                   27560033
275700                                   TO RD035-CKDATE   (RD035-IDX)  27570033
275800                 MOVE LQW-CKNBR       (LQW-IDX)                   27580033
275900                                   TO RD035-CKNBR    (RD035-IDX)  27590033
276000                 SET RD035-IDX UP BY 1                            27600033
276100                 IF  RD035-IDX > RD035-MAX-ITEMS                  27610033
276200                     PERFORM 5205-WRITE-SEL-QUEUE                 27620033
276300                     ADD +1        TO RD034-NUMBER-OF-TS-ITEMS    27630033
276400                     INITIALIZE RD035-SELECTED-ITEM-ARRAY         27640033
276500                     SET RD035-IDX TO  1                          27650033
276600                 END-IF                                           27660033
276700             END-IF                                               27670033
276800         END-PERFORM                                              27680033
276900     END-IF.                                                      27690033
277000                                                                  27700033
277100*----------------------------------------------------------------*27710033
277200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *27720033
277300*----------------------------------------------------------------*27730033
277400                                                                  27740033
277500 5205-WRITE-SEL-QUEUE.                                            27750033
277600                                                                  27760033
277700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27770033
277800                                   TO RD035-SELECTED-ITEMS.       27780033
277900                                                                  27790033
278000     EXEC CICS                                                    27800033
278100          WRITEQ TS                                               27810033
278200              QUEUE (ASC-SEL-QUEUE-NAME)                          27820033
278300              FROM  (RD035-SEL-REC)                               27830033
278400              ITEM  (PV-SEL-QUEUE-ITEM)                           27840033
278500              RESP  (PV-CICS-RESP)                                27850033
278600     END-EXEC.                                                    27860033
278700                                                                  27870033
278800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27880033
278900         CONTINUE                                                 27890033
279000     ELSE                                                         27900033
279100         SET DP013-CICS-ABEND      TO TRUE                        27910033
279200         SET DP013-NO-ROLLBACK     TO TRUE                        27920033
279300         MOVE '5205-WRITE-SEL-QUEUE'                              27930033
279400                                   TO DP013-PARAGRAPH             27940033
279500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27950033
279600                                   TO DP013-MESSAGE-TEXT(1)       27960033
279700         PERFORM DP013-0000-PROCESS-ABEND                         27970033
279800     END-IF.                                                      27980033
280000                                                                  28000033
282400*----------------------------------------------------------------*28240033
282500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *28250033
282600*----------------------------------------------------------------*28260033
282700 6010-DELETE-SEL-QUEUE.                                           28270033
282800                                                                  28280033
282900     EXEC CICS                                                    28290033
283000         DELETEQ TS                                               28300033
283100             QUEUE (ASC-SEL-QUEUE-NAME)                           28310033
283200             RESP  (PV-CICS-RESP)                                 28320033
283300     END-EXEC.                                                    28330033
283400*                                                                 28340033
283500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      28350033
283600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         28360033
283700         CONTINUE                                                 28370033
283800     ELSE                                                         28380033
283900         SET DP013-CICS-ABEND TO TRUE                             28390033
284000         SET DP013-NO-ROLLBACK TO TRUE                            28400033
284100         MOVE '6010-DELETE-SEL-QUEUE'                             28410033
284200                        TO DP013-PARAGRAPH                        28420033
284300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         28430033
284400                        TO DP013-MESSAGE-TEXT (1)                 28440033
284500         PERFORM DP013-0000-PROCESS-ABEND                         28450033
284600     END-IF.                                                      28460033
284700                                                                  28470033
296100*----------------------------------------------------------------*29610033
296200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*29620033
296300*----------------------------------------------------------------*29630033
296400                                                                  29640033
296500 6112-READ-LIST-QUEUE.                                            29650033
296600                                                                  29660033
296700     EXEC CICS                                                    29670033
296800         READQ TS                                                 29680033
296900             QUEUE (ASC-LIST-QUEUE-NAME)                          29690033
297000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     29700033
297100             ITEM  (PV-ITEM)                                      29710033
297200             RESP  (PV-CICS-RESP)                                 29720033
297300     END-EXEC.                                                    29730033
297400*                                                                 29740033
297500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29750033
297600         CONTINUE                                                 29760033
297700     ELSE                                                         29770033
297800         SET DP013-CICS-ABEND        TO TRUE                      29780033
297900         SET DP013-NO-ROLLBACK       TO TRUE                      29790033
298000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           29800033
298100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29810033
298200                                     TO DP013-MESSAGE-TEXT(1)     29820033
298300         PERFORM DP013-0000-PROCESS-ABEND                         29830033
298400     END-IF.                                                      29840033
298500                                                                  29850099
298780*----------------------------------------------------------------*29878033
298800*    ABEND PROCESSOR MODULE                                      *29880033
298900*----------------------------------------------------------------*29890033
299000                                                                  29900033
299100     COPY DPPD013.                                                29910099
481200                                                                  48120067
