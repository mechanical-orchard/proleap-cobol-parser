000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKUP005.                                00050000
000600 AUTHOR.                 CHRISTINE FOLEY.                         00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            11-XX-92.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                    ITEM MAINTENANCE                           * 00120000
001300*                                                               * 00130000
001400*  THIS PROGRAM WILL UPDATE THE INFOREM MAINTAINED VALUES ONTO  * 00140000
001500*  OUR ITEM DATABASES.                                          * 00150000
001600*                                                               * 00160000
001700*  THIS PROGRAM IS A REPLACEMENT FOR INFOREM PROGRAM ICB050C.   * 00170000
001800*                                                               * 00180000
001900***************************************************************** 00190000
002000*  CHANGE MADE:                                                 * 00200000
002100*                                                               * 00210000
002200***************************************************************** 00220000
002300* CHANGED 07/26/93 BY CHRISTINE FOLEY                             00230000
002400*   WR# XXXXXXXXXXXX                                              00240000
002500*            ADDED UPDATE OF OP & OUTL COLUMNS ON THE TMRITST     00250000
002600*            TABLE.  THIS INFORMATION WILL BE USED FOR SKU ROLL-  00260000
002700*            UP.                                                  00270000
002800* CHANGED 04/19/95 BY LEN LEWANDOWSKI (CPU)                       00280000
002900*   WR# 3227                                                      00290000
003000*            CHANGED COMMIT LOGIC TO USE TIME INSTEAD OF COUNT    00300000
003100*                                                                 00310000
003200* CHANGED 03/12/99 BY LINDA FRIESS                                00320000
003300*   WR# 6041                                                      00330000
003400*            CORRECTED DATE LOGIC FOR GETTING FISCAL YEAR/WEEK    00340000
003500*                                                                 00350000
003600* CHANGED 05/10/99 BY ANNE KINTOPF                                00360000
003700*   PIT# 309322                                                   00370000
003800*            CHANGED HOW HISTORY RECORD IS WRITTEN OUT SO THAT    00380000
003900*            IF PV-INAME-STORE = SPACES, ZEROES ARE MOVED TO      00390000
004000*            MR015O-STR-NBR.                                      00400000
004100*                                                                 00410000
004200* CHANGED 05/24/01 BY DAVID COLOMBO - COMPUWARE                   00420000
004300*   WR# 22255                                                     00430000
004400*            REMOVED THE LOGIC THAT UPDATES THE TMRISFL (ITEM /   00440000
004500*            STORE FCST ERR LOOKUP) TABLE AND PUT IT IN A NEW     00450000
004600*            PROGRAM (MRKUP121).                                  00460000
004610*                                                                 00470031
004620* CHANGED 09/04/02 BY IBM GLOBAL SERVICES INDIA                   00480031
004630*   WR# 21601 NI-SKU PROJECT - MR PHASE 3                         00490031
004640*            ITEM NUMBER IS FETCHED  USING NI-SKU  AS KEY FROM    00500031
004650*            TSKXREF TABLE.                                       00510031
004700*                                                                 00520000
004620* CHANGED 06/03/04 BY BOB FORD                                    00530032
004630*   WR# 26363 STORE NUMBER EXPANSION PROJECT                      00540032
004640*            MODIFIED PROGRAM TO HANDLE 5 DIGIT STORE NUMBERS.    00550032
004650*            DB CHGS TO TMRISHS AND TMRISFE NOT READY YET.        00560032
004700*                                                                 00570032
004620* CHANGED 05/05/05 BY MARIA KLAMIK                                00580038
004630*   WR# 28751 DD UPDATE SPLIT PROJECT                             00590038
004640*            MODIFIED PROGRAM TO UPDATE THE FIELDS THAT ARE       00600038
004650*            ONLY AFFECTED BY ORDER GENERATION.  THE TMRISFE      00610038
004650*            AND THE TMRISFL TABLE UPDATES/INSERTS WERE           00620038
004650*            REMOVED.                                             00630038
004800***************************************************************** 00640000
004900 ENVIRONMENT DIVISION.                                            00650000
005000***************************************************************** 00660000
005100                                                                  00670000
005200 CONFIGURATION SECTION.                                           00680000
005300                                                                  00690000
005400 SOURCE-COMPUTER.        IBM-3090.                                00700000
005500 OBJECT-COMPUTER.        IBM-3090.                                00710000
005600                                                                  00720000
005700 INPUT-OUTPUT SECTION.                                            00730000
005800                                                                  00740000
005900 FILE-CONTROL.                                                    00750000
006000*                                                                 00760000
006100     SELECT IC-SUPP-FILE          ASSIGN   TO  INP01.             00770000
006200*                                                                 00780000
006500***************************************************************** 00790000
006600 DATA DIVISION.                                                   00800000
006700***************************************************************** 00810000
006800*                                                                 00820000
006900 FILE SECTION.                                                    00830000
007000*                                                                 00840000
007100 FD  IC-SUPP-FILE                                                 00850000
007200     LABEL RECORDS ARE STANDARD                                   00860000
007300     BLOCK CONTAINS 0 RECORDS                                     00870000
007400     RECORD CONTAINS 2090 CHARACTERS                              00880000
007500     DATA RECORD IS IC-SUPP-REC.                                  00890000
007600 01  IC-SUPP-REC                     PIC  X(2090).                00900000
007700*                                                                 00910000
008500 WORKING-STORAGE SECTION.                                         00920000
008600*                                                                 00930000
008700 01  FILLER.                                                      00940000
008800     05  FILLER                      PIC  X(36)    VALUE          00950000
008900         ' ***** WORKING STORAGE PGM=MRKUP005 '.                  00960000
009000     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00970000
009100     05  FILLER                      PIC  X(10)    VALUE          00980000
009200         ' LOCATION='.                                            00990000
009300     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   01000000
009400     05  FILLER                      PIC  X(06)    VALUE          01010000
009500         ' *****'.                                                01020000
009600 EJECT                                                            01030000
009700 01  PROGRAM-SWITCHES.                                            01040000
009800     05  PS-EOF-SUPP-FILE            PIC  X(01)    VALUE 'N'.     01050000
009900         88  EOF-SUPP-FILE                         VALUE 'Y'.     01060000
010000     05  PS-EOC-ITEM-STORE-CSR       PIC  X(01)    VALUE 'N'.     01070000
010100         88  EOC-ITEM-STORE-CSR                    VALUE 'Y'.     01080000
010200     05  PS-END-OF-PARM-REC          PIC  X(01)    VALUE 'N'.     01090000
010300         88  END-OF-PARM-REC                       VALUE 'Y'.     01100000
010400*                                                                 01110000
010500/                                                                 01120000
010600 01  PC-CONSTANTS.                                                01130000
010700     05  PC-DECR-7-DAYS              PIC  9(05)    VALUE 7.       01140000
010800     05  PC-DECR-14-DAYS             PIC  9(05)    VALUE 14.      01150000
010900     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01160000
011000                                                   COMP SYNC.     01170000
011100     05  PC-NOT-REF-INTEGRAL         PIC S9(04)    VALUE -530     01180000
011200                                                   COMP SYNC.     01190000
011300     05  PC-19                       PIC  X(02)    VALUE '19'.    01200000
011400     05  PC-20                       PIC  X(02)    VALUE '20'.    01210000
011500     05  PC-53                       PIC  9(02)    VALUE 53.      01220000
011600     05  PC-N                        PIC  X(01)    VALUE 'N'.     01230000
011700     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01240000
011800     05  PC-F2                       PIC  X(02)    VALUE 'F2'.    01250000
011900     05  PC-MRKUP005                 PIC  X(08)    VALUE          01260000
012000                                                   'MRKUP005'.    01270000
012100     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          01280000
012200                                                   'DPKUT500'.    01290000
012300     05  PC-ASTERISK                 PIC  X(30)    VALUE          01300000
012400         '*****************************'.                         01310000
012500 EJECT                                                            01320000
012600*                                                                 01330000
012700 01  PV-ACCUMULATOR-FIELDS.                                       01340000
012800     05  PV-SYSTEM-INPUT-CNT         PIC S9(03)    VALUE ZERO     01350000
012900                                                   COMP-3.        01360000
013000     05  PV-PARM-INPUT-CNT           PIC S9(03)    VALUE ZERO     01370000
013100                                                   COMP-3.        01380000
013200     05  PV-SYSTEM-OUTPUT-CNT        PIC S9(04)    VALUE ZERO     01390000
013300                                                   COMP-3.        01400000
013400     05  PV-UPDATE-CNT               PIC S9(04)    VALUE ZERO     01410000
013500                                                   COMP-3.        01420000
013600 EJECT                                                            01430000
013700*                                                                 01440000
013800 01  PV-MISC-FIELDS.                                              01450000
013900     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01460000
014000                                                   COMP SYNC.     01470000
014100     05  PV-RBA                      PIC S9(09)    VALUE ZERO     01480000
014200                                                   COMP SYNC.     01490000
014300     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01500000
014400     05  PV-CURR-TMST                PIC  X(26)    VALUE SPACE.   01510000
014500     05  PV-COMMIT-TMST              PIC  X(26)    VALUE SPACE.   01520000
014600     05  PV-TODAYS-DAY               PIC  9(01)    VALUE ZERO.    01530000
014700     05  PV-CURRENT-DATE.                                         01540000
014800         10  PV-CURRENT-YEAR.                                     01550000
014900             15 PV-CURRENT-DATE-CC   PIC  9(02)    VALUE ZERO.    01560000
015000             15 PV-CURRENT-DATE-YR   PIC  9(02)    VALUE ZERO.    01570000
015100         10  FILLER                  PIC  X(01)    VALUE '-'.     01580000
015200         10  PV-CURRENT-DATE-MO      PIC  9(02)    VALUE ZERO.    01590000
015300         10  FILLER                  PIC  X(01)    VALUE '-'.     01600000
015400         10  PV-CURRENT-DATE-DY      PIC  9(02)    VALUE ZERO.    01610000
015500     05  CC-DATE.                                                 01620000
015600         10  CC-CURRENT-YEAR.                                     01630000
015700             15 CC-CURRENT-DATE-CC   PIC  9(02)    VALUE ZERO.    01640000
015800             15 CC-CURRENT-DATE-YR   PIC  9(02)    VALUE ZERO.    01650000
015900         10  FILLER                  PIC  X(01)    VALUE '-'.     01660000
016000         10  CC-CURRENT-DATE-MO      PIC  9(02)    VALUE ZERO.    01670000
016100         10  FILLER                  PIC  X(01)    VALUE '-'.     01680000
016200         10  CC-CURRENT-DATE-DY      PIC  9(02)    VALUE ZERO.    01690000
016300     05  PV-FIRST-DATE.                                           01700000
016400         10  PV-FIRST-YEAR.                                       01710000
016500             15 PV-FIRST-DATE-CC     PIC  9(02)    VALUE ZERO.    01720000
016600             15 PV-FIRST-DATE-YR     PIC  9(02)    VALUE ZERO.    01730000
016700         10  FILLER                  PIC  X(01)    VALUE '-'.     01740000
016800         10  PV-FIRST-DATE-MO        PIC  9(02)    VALUE ZERO.    01750000
016900         10  FILLER                  PIC  X(01)    VALUE '-'.     01760000
017000         10  PV-FIRST-DATE-DY        PIC  9(02)    VALUE ZERO.    01770000
017100     05  PV-FISCAL-YEAR.                                          01780000
017200         10  PV-FISCAL-YEAR-CC       PIC  9(02).                  01790000
017300         10  PV-FISCAL-YEAR-YR       PIC  9(02).                  01800000
017400     05  PV-FISCAL-YEAR-NBR REDEFINES PV-FISCAL-YEAR              01810000
017500                                     PIC  9(04).                  01820000
017600     05  PV-MMDDYY.                                               01830000
017700         10  PV-MM                   PIC  9(02)    VALUE ZERO.    01840000
017800         10  PV-DD                   PIC  9(02)    VALUE ZERO.    01850000
017900         10  PV-YY                   PIC  9(02)    VALUE ZERO.    01860000
018000     05  PV-YYMMDD                   PIC  9(06)    VALUE ZERO.    01870000
018100     05  PV-TODAYS-TIME.                                          01880000
018200         10  PV-TODAYS-TIME-HH       PIC  9(02)    VALUE ZERO.    01890000
018300         10  PV-TODAYS-TIME-MM       PIC  9(02)    VALUE ZERO.    01900000
018400         10  PV-TODAYS-TIME-SS       PIC  9(02)    VALUE ZERO.    01910000
018500         10  FILLER                  PIC  9(02)    VALUE ZERO.    01920000
018600     05  PV-SUBSCRIPTS.                                           01930000
018700         10  PV-DD-SUB               PIC  9(02)    VALUE ZERO.    01940000
018800         10  PV-OH-SUB               PIC  9(02)    VALUE ZERO.    01950000
018900         10  PV-CPS-SUB              PIC  9(02)    VALUE ZERO.    01960000
019000         10  PV-MAD-SUB              PIC  9(02)    VALUE ZERO.    01970000
019100         10  PV-LYS-SUB              PIC  9(02)    VALUE ZERO.    01980000
019200         10  PV-FWM-SUB              PIC  9(02)    VALUE ZERO.    01990000
019300         10  PV-LFWM-SUB             PIC  9(02)    VALUE ZERO.    02000000
019400     05  PV-INAME.                                                02010000
019910         10  PV-INAME-SKU            PIC  9(08)    VALUE ZERO.    02020000
020000         10  FILLER                  PIC  X(02)    VALUE SPACES.  02030000
020010         10  FILLER                  PIC  X(05)                   02040032
020100             VALUE ' STR:'.                                       02050032
020200         10  PV-INAME-STORE          PIC  X(05)    VALUE SPACES.  02060032
020300         10  FILLER                  PIC  X(01)    VALUE '/'.     02070000
020400         10  PV-INAME-SKU-DESC       PIC  X(25)    VALUE SPACES.  02080000
020510         10  FILLER                  PIC  X(04)    VALUE SPACES.  02090000
020600     05  PV-SKU.                                                  02100000
020700         10  PV-SKU-STYLE            PIC  X(15)    VALUE SPACES.  02110000
020800         10  FILLER                  PIC  X(01)    VALUE '/'.     02120000
020900         10  PV-SKU-SIZE             PIC  X(05)    VALUE SPACES.  02130000
021000         10  FILLER                  PIC  X(01)    VALUE '/'.     02140000
021100         10  PV-SKU-COLOR            PIC  X(04)    VALUE SPACES.  02150000
021200         10  FILLER                  PIC  X(01)    VALUE ' '.     02160000
021300         10  PV-SKU-VEND-NBR         PIC  X(03)    VALUE SPACES.  02170000
021400     05  PV-SALES-INDCT.                                          02180000
021500         10  PV-SALES-INDCT-YR       PIC  X(02)    VALUE SPACES.  02190000
021600         10  PV-SALES-INDCT-WK       PIC  X(02)    VALUE SPACES.  02200000
021700     05  PV-WEEK-NBR                 PIC  S9(2)    COMP-3.        02210000
021800     05  PV-WN                       PIC   9(2)    VALUE ZERO.    02220000
021900     05  PV-DECR-DAYS                PIC  9(05)    VALUE ZERO.    02230000
022000     05  PV-VENDOR-NMBR              PIC  9(09).                  02240000
022100     05  PV-SUP-KEY.                                              02250000
022200         10 PV-SUP-KEY-1-08          PIC  9(08).                  02260028
022700         10 FILLER                   PIC  X(03).                  02270000
022710         10 FILLER                   PIC  X(04).                  02280032
022800         10 PV-SUP-KEY-16-20         PIC  9(05).                  02290032
022900         10 FILLER                   PIC  X(10).                  02300000
023000     10  PV-PREV-YEAR.                                            02310000
023100         15 PV-PREV-YEAR-CC          PIC  9(02)    VALUE ZERO.    02320000
023200         15 PV-PREV-YEAR-YR          PIC  9(02)    VALUE ZERO.    02330000
023300 EJECT                                                            02340000
023400*                                                                 02350000
023500     COPY ISWS006.                                                02360000
023600*                                                                 02370000
023601     COPY DPWS500.                                                02380029
023602*                                                                 02390000
023700     COPY MRRD015O.                                               02400000
023800*                                                                 02410000
023900 01 SUPP-RECORD.                                                  02420000
024000     COPY ICI165C.                                                02430000
024100  02 TR-INPUT-RECORD REDEFINES SUP-TR-RCD-IN.                     02440000
024200     COPY ICI030C.                                                02450000
024300     COPY MRRD165.                                                02460000
024400 EJECT                                                            02470000
024500* DB2 TABLE LAYOUTS                                               02480000
024600     EXEC SQL                                                     02490000
024700         INCLUDE TMRITST                                          02500000
024800     END-EXEC.                                                    02510000
024900 EJECT                                                            02520000
025000     EXEC SQL                                                     02530000
025100         INCLUDE TCKRSTCN                                         02540000
025200     END-EXEC.                                                    02550000
025300 EJECT                                                            02560000
026510     EXEC SQL                                                     02570000
026520         INCLUDE TSKXREF                                          02580000
026530     END-EXEC.                                                    02590000
026540 EJECT                                                            02600000
026600* DB2 COMMUNICATION AREA                                          02610000
026700*                                                                 02620000
026800     EXEC SQL                                                     02630000
026900         INCLUDE SQLCA                                            02640000
027000     END-EXEC.                                                    02650000
027100 EJECT                                                            02660000
027200* DB2 COMMUNICATION AREA2                                         02670000
027300*                                                                 02680000
027400     COPY SQLCA2.                                                 02690000
027500 EJECT                                                            02700000
027600*                                                                 02710000
027700 LINKAGE SECTION.                                                 02720000
027800***************************************************************** 02730000
027900*PROCEDURE DIVISION.                                              02740000
028000***************************************************************** 02750000
028100 PROCEDURE DIVISION.                                              02760000
028200*                                                                 02770000
028300 A000-MAINLINE-PROCESSING.                                        02780000
028400*                                                                 02790000
028500     PERFORM A100-INITIALIZATION.                                 02800000
028600*                                                                 02810000
028700     PERFORM B000-PROCESS-SUPPLEMENTAL-REC                        02820000
028800             UNTIL EOF-SUPP-FILE.                                 02830000
028900*                                                                 02840000
029000     PERFORM Y100-END-ROUTINE.                                    02850000
029100*                                                                 02860000
029200     GOBACK.                                                      02870000
029300*                                                                 02880000
029400 EJECT                                                            02890000
029500******************************************************************02900000
029600** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 02910000
029700** READ THE FIRST RECORD.                                         02920000
029800******************************************************************02930000
029900 A100-INITIALIZATION.                                             02940000
030000*                                                                 02950000
030100     OPEN  INPUT IC-SUPP-FILE.                                    02960000
030300*                                                                 02970000
030400*    ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          02980000
030500     ACCEPT CC-DATE.                                              02990000
030600*                                                                 03000000
030700*    MOVE DPG51-SYSTEM-DATE-YR TO PV-CURRENT-DATE-YR.             03010000
030800*    MOVE DPG51-SYSTEM-DATE-MO TO PV-CURRENT-DATE-MO.             03020000
030900*    MOVE DPG51-SYSTEM-DATE-DY TO PV-CURRENT-DATE-DY.             03030000
031000*    IF DPG51-SYSTEM-DATE-YR > 80                                 03040000
031100*        MOVE PC-19   TO PV-CURRENT-DATE-CC                       03050000
031200*    ELSE                                                         03060000
031300*        MOVE PC-20   TO PV-CURRENT-DATE-CC                       03070000
031400*    END-IF.                                                      03080000
031500*                                                                 03090000
031800     PERFORM R000-READ-SUPP-FILE.                                 03100000
031900*                                                                 03110000
032000      IF EOF-SUPP-FILE                                            03120000
032100         CLOSE  IC-SUPP-FILE                                      03130000
032300         GOBACK.                                                  03140000
032400*                                                                 03150000
032500*  SET UP FIRST SCHEDULED COMMIT TIME                             03160000
032600                                                                  03170000
032700     EXEC SQL                                                     03180000
032800         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    03190000
032900           INTO  :PV-COMMIT-TMST                                  03200000
033000           FROM  TCKRSTCNTL                                       03210000
033100          WHERE  PLAN_NAME = 'MRKUP005'                           03220000
033200     END-EXEC.                                                    03230000
033300                                                                  03240000
033400     IF SQLCODE = +0                                              03250000
033500         CONTINUE                                                 03260000
033600     ELSE                                                         03270000
033700         DISPLAY 'PARAGRAPH A100, BAD SELECT FOR TIMESTAMP'       03280000
033800         DISPLAY ' '                                              03290000
033900         PERFORM Z999-SQL-ERROR.                                  03300000
034000*                                                                 03310000
034100     PERFORM T000-DATE-ROUTINE.                                   03320000
034200*                                                                 03330000
034300 EJECT                                                            03340000
034400******************************************************************03350000
034500*  THIS IS THE MAIN CONTROLLING PARAGRAPH FOR PROCESSING THE     *03360000
034600*  SUPPLEMENTAL RECORD.                                          *03370000
034700******************************************************************03380000
034800 B000-PROCESS-SUPPLEMENTAL-REC.                                   03390000
034900*                                                                 03400000
035000     MOVE SUP-KEY TO PV-SUP-KEY.                                  03410000
035310     MOVE PV-SUP-KEY-1-08  TO NI-SKU-9-8.                         03420000
035311     MOVE NI-SKU-9-8       TO SKXREF-SKU.                         03430029
035400     PERFORM S400-READ-SKU-TABLE.                                 03440000
035500*                                                                 03450000
035600     IF SQLCODE = 100                                             03460000
035700        CONTINUE                                                  03470000
035800     ELSE                                                         03480000
035900         PERFORM F000-FORMAT-UPDATE-ITEM-STORE                    03490000
036200         PERFORM Z900-COMMIT-TEST                                 03500000
036300     END-IF.                                                      03510000
036400*                                                                 03520000
036500     PERFORM R000-READ-SUPP-FILE.                                 03530000
036600*                                                                 03540000
036700 EJECT                                                            03550000
036800******************************************************************03560000
036900*    THIS SECTION CALLS THE CALENDAR ROUTINE                     *03570000
037000******************************************************************03580000
037100 E000-CALENDAR-ROUTINE.                                           03590000
037200*                                                                 03600000
037300*    DISPLAY 'E000-CALENDAR-ROUTINE'.                             03610000
037400*                                                                 03620000
037500     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       03630000
037600                                DPG53 DPG54                       03640000
037700                                DPG55 DPG56.                      03650000
037800     EVALUATE TRUE                                                03660000
037900     WHEN DPG54-SEVERE-ERROR                                      03670000
038000         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               03680000
038100         DISPLAY DPG54-ERROR-MESSAGE                              03690000
038200         CALL 'ILBOABN0'        USING PV-ABEND-CODE               03700000
038300     WHEN DPG54-WARNING-ERROR                                     03710000
038400         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              03720000
038500         DISPLAY DPG54-ERROR-MESSAGE                              03730000
038600     WHEN DPG54-NO-ERROR                                          03740000
038700         CONTINUE                                                 03750000
038800     END-EVALUATE.                                                03760000
038900*                                                                *03770000
039000******************************************************************03780000
039100*   FORMAT FIELDS AND UPDATE ON THE ITEM/STORE TABLE WITH THE    *03790000
039200*   DATA FROM THE SUPPLEMENTAL RECORD.                           *03800000
039300******************************************************************03810000
039400 F000-FORMAT-UPDATE-ITEM-STORE.                                   03820000
039500*                                                                 03830000
039600*    DISPLAY 'F000-FORMAT-UPDATE-ITEM-STORE'.                     03840000
039700*                                                                 03850000
039800* @@@                                                             03860000
039900     MOVE OO                   TO  MRITST-ON-ORDER-QTY.           03870000
040300     MOVE MADSS                TO  MRITST-MADSS-QTY.              03880000
040400     MOVE FWMAD                TO  MRITST-FWMAD-QTY.              03890000
040500     MOVE TRNDP                TO  MRITST-TRNDP-PCT.              03900000
040800     MOVE LTVFACT              TO  MRITST-LTVFACT-FCTR.           03910000
040900     MOVE PCTZ                 TO  MRITST-PCTZ-PCT.               03920000
041000     MOVE MADSTAT              TO  MRITST-MADSTAT-CDE.            03930000
041100     MOVE DFLREG               TO  MRITST-DFLREG-CDE.             03940000
041200     MOVE TSREG                TO  MRITST-TSREG-CDE.              03950000
041300     MOVE DIREG                TO  MRITST-DIREG-CDE.              03960000
042000     MOVE OUTSTAT              TO  MRITST-OUTSTAT-CDE.            03970000
042100     MOVE LRTFCST              TO  MRITST-LRTFCST-NBR.            03980000
042200     MOVE ORDSTAT              TO  MRITST-ORDSTAT-CDE.            03990000
042300     MOVE PV-SUP-KEY-16-20     TO  MRITST-STR-NBR.                04000038
042400     MOVE SUP-OP-QTY           TO  MRITST-OP-QTY.                 04010000
042500     MOVE SUP-OUTL-QTY         TO  MRITST-OUTL-QTY.               04020000
042600     MOVE SUP-SSTOCK-QTY       TO  MRITST-SSTOCK-QTY.             04030000
042700*                                                                *04040000
042800     PERFORM S100-UPDATE-TMRITST.                                 04050000
042900*                                                                *04060000
047200******************************************************************04070000
047300*  THIS PARAGRAPH READS THE SUPPLEMENTAL FILE FOR PROCESSING     *04080000
047400******************************************************************04090000
047500 R000-READ-SUPP-FILE.                                             04100000
047600*                                                                 04110000
047700     READ IC-SUPP-FILE  INTO  SUPP-RECORD                         04120000
047800         AT END                                                   04130000
047900            MOVE PC-Y TO PS-EOF-SUPP-FILE.                        04140000
048000*                                                                 04150000
048100*                                                                 04160000
048200******************************************************************04170000
048300* THIS PARAGRAPH PERFORMS THE UPDATE OF THE ITEM/STORE TABLE     *04180000
048400******************************************************************04190000
048500 S100-UPDATE-TMRITST.                                             04200000
048600*                                                                 04210000
048700*    DISPLAY 'S100-UPDATE-TMRITST'.                               04220000
048800*                                                                 04230000
048900     MOVE 'S100'                   TO PGM-LOCATION.               04240000
049000     MOVE 'S100-UPDATE-TMRITST'    TO PV-ABEND-PARAGRAPH.         04250000
049100*                                                                 04260000
049200     EXEC SQL                                                     04270000
049300         UPDATE TMRITST                                           04280000
049400            SET   MADSS_QTY    =  :MRITST-MADSS-QTY,              04290038
049800                  FWMAD_QTY    =  :MRITST-FWMAD-QTY,              04300000
049900                  TRNDP_PCT    =  :MRITST-TRNDP-PCT,              04310000
050200                  LTVFACT_FCTR =  :MRITST-LTVFACT-FCTR,           04320000
050300                  PCTZ_PCT     =  :MRITST-PCTZ-PCT,               04330000
050400                  MADSTAT_CDE  =  :MRITST-MADSTAT-CDE,            04340000
050500                  DFLREG_CDE   =  :MRITST-DFLREG-CDE,             04350000
050600                  TSREG_CDE    =  :MRITST-TSREG-CDE,              04360000
050700                  DIREG_CDE    =  :MRITST-DIREG-CDE,              04370000
051400                  OUTSTAT_CDE  =  :MRITST-OUTSTAT-CDE,            04380000
051500                  LRTFCST_NBR  =  :MRITST-LRTFCST-NBR,            04390000
051600                  ORDSTAT_CDE  =  :MRITST-ORDSTAT-CDE,            04400000
051700                  OP_QTY       =  :MRITST-OP-QTY,                 04410000
051800                  ON_ORDER_QTY =  :MRITST-ON-ORDER-QTY,           04420000
051900                  OUTL_QTY     =  :MRITST-OUTL-QTY,               04430000
052000                  SSTOCK_QTY   =  :MRITST-SSTOCK-QTY              04440000
052110          WHERE   ITEM_NBR     =  :SKXREF-ITM-NBR                 04450000
052200            AND   STR_NBR      =  :MRITST-STR-NBR                 04460000
052300     END-EXEC.                                                    04470000
052400*                                                                 04480000
052500     EVALUATE TRUE                                                04490000
052600       WHEN SQLCODE         = ZERO                                04500000
052700         ADD 1 TO PV-UPDATE-CNT                                   04510000
053100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    04520000
053200         CONTINUE                                                 04530000
053300       WHEN OTHER                                                 04540000
053400         DISPLAY PV-ABEND-PARAGRAPH                               04550000
053500         PERFORM Z999-SQL-ERROR                                   04560000
053600     END-EVALUATE.                                                04570000
053700*                                                                 04580000
053800 EJECT                                                            04590000
059600******************************************************************04600000
059700*  THIS PARAGRAPH READS THE SKU TABLE FOR PROCESSING             *04610000
059800******************************************************************04620000
059900 S400-READ-SKU-TABLE.                                             04630000
060000*                                                                 04640000
060100     MOVE 'S400'                   TO PGM-LOCATION.               04650000
060200     MOVE 'S400-READ-SKU-TABLE '   TO PV-ABEND-PARAGRAPH.         04660000
060300*                                                                 04670000
061110     EXEC SQL                                                     04680000
061120         SELECT   ITM_NBR                                         04690000
061130           INTO   :SKXREF-ITM-NBR                                 04700000
061140           FROM   TSKXREF                                         04710000
061150          WHERE   SKU = :SKXREF-SKU                               04720000
061180     END-EXEC.                                                    04730000
061200*                                                                 04740000
061300     EVALUATE TRUE                                                04750000
061400       WHEN SQLCODE         = ZERO                                04760000
061500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    04770000
061600         CONTINUE                                                 04780000
061700       WHEN OTHER                                                 04790000
061800         DISPLAY PV-ABEND-PARAGRAPH                               04800000
061900         PERFORM Z999-SQL-ERROR                                   04810000
062000     END-EVALUATE.                                                04820000
062100*                                                                 04830000
067200******************************************************************04840000
067300*T000-DATE-ROUTINE.                                               04850000
067400*                                                                 04860000
067500*  THIS ROUTINE GETS THE FISCAL WEEK NUMBER FOR THE CURRENT WEEK. 04870000
067600*  THE FISCAL WEEK IS THEN COMPARED TO THE INPUT WEEK.  IF THEY   04880000
067700*  ARE THE SAME, GET PREVIOUS WEEK'S FISCAL YEAR.                 04890000
067800*  IF FISCAL WEEK = 53, GO BACK 2 WEEKS FOR FISCAL YEAR.          04900000
067900*                                                                 04910000
068000*  THEN THE WEEK NUMBER FOR THE PREVIOUS WEEK IS COMPUTED.        04920000
068100*                                                                 04930000
068200******************************************************************04940000
068300 T000-DATE-ROUTINE.                                               04950000
068400*                                                                 04960000
068500     MOVE ZEROES              TO DPG51-INCR-DECR-DAYS-9.          04970000
068600*    MOVE PV-CURRENT-DATE     TO DPG52-LK-DATE-INPUT.             04980000
068700     MOVE CC-DATE             TO DPG52-LK-DATE-INPUT.             04990000
068800     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             05000000
068900     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            05010000
069000     PERFORM E000-CALENDAR-ROUTINE.                               05020000
069100*                                                                 05030000
069200     IF DPG56-FISCAL-WEEK-NBR = WN                                05040000
069300        MOVE PC-DECR-7-DAYS TO PV-DECR-DAYS                       05050000
069400     ELSE                                                         05060000
069500        IF DPG56-FISCAL-WEEK-NBR = PC-53                          05070000
069600           MOVE PC-DECR-14-DAYS TO PV-DECR-DAYS                   05080000
069700        ELSE                                                      05090000
069800           DISPLAY '** ABEND **'                                  05100000
069900           DISPLAY '** PROGRAM    = MRKUP005'                     05110000
070000           DISPLAY '** PARAGRAPH  = T000-DATE-ROUTINE'            05120000
070100           DISPLAY '** MESSAGE    = '                             05130000
070200                   'FISCAL WEEK AND INPUT WEEK DO NOT MATCH'      05140000
070300           DISPLAY '** FISCAL WK  = ' DPG56-FISCAL-WEEK-NBR       05150000
070400           DISPLAY '** INPUT WN   = ' WN                          05160000
070500           MOVE +4005      TO PV-ABEND-CODE                       05170000
070600           CALL 'ILBOABN0' USING PV-ABEND-CODE                    05180000
070700        END-IF                                                    05190000
070800     END-IF.                                                      05200000
070900*                                                                 05210000
071000     INITIALIZE DPG51                                             05220000
071100                DPG52                                             05230000
071200                DPG53                                             05240000
071300                DPG54                                             05250000
071400                DPG55                                             05260000
071500                DPG56.                                            05270000
071600*                                                                 05280000
071700*    MOVE PV-CURRENT-DATE     TO DPG52-LK-DATE-INPUT.             05290000
071800     MOVE CC-DATE             TO DPG52-LK-DATE-INPUT.             05300000
071900     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            05310000
072000     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             05320000
072100     MOVE PV-DECR-DAYS        TO DPG51-INCR-DECR-DAYS-9.          05330000
072200     SET DPG51-DECREMENT-DATE TO TRUE.                            05340000
072300                                                                  05350000
072400     PERFORM E000-CALENDAR-ROUTINE.                               05360000
072500     MOVE DPG56-FISCAL-YEAR-CCYY TO PV-FISCAL-YEAR-NBR.           05370000
072600*                                                                 05380000
072700     COMPUTE PV-WEEK-NBR = WN - 1.                                05390000
072800*                                                                 05400000
072900     IF PV-WEEK-NBR = ZERO                                        05410000
073000        MOVE 52 TO PV-WEEK-NBR                                    05420000
073100     END-IF.                                                      05430000
073200*                                                                 05440000
073300 EJECT                                                            05450000
073400******************************************************************05460000
073500*   CLOSES FILES AND DISPLAYS MESSAGES.                          *05470000
073600******************************************************************05480000
073700 Y100-END-ROUTINE.                                                05490000
073800*                                                                 05500000
073900     CLOSE  IC-SUPP-FILE.                                         05510000
074100*                                                                 05520000
074200 EJECT                                                            05530000
074300******************************************************************05540000
074400*     DB2 COMMIT TEST                                            *05550000
074500*                                                                *05560000
074600******************************************************************05570000
074700                                                                  05580000
074800 Z900-COMMIT-TEST.                                                05590000
074900*-----------------                                                05600000
075000                                                                  05610000
075100*  GET THE CURRENT TIMESTAMP                                      05620000
075200                                                                  05630000
075300     EXEC SQL                                                     05640000
075400         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    05650000
075500     END-EXEC.                                                    05660000
075600                                                                  05670000
075700     IF SQLCODE = +0                                              05680000
075800         CONTINUE                                                 05690000
075900     ELSE                                                         05700000
076000         DISPLAY 'PARAGRAPH Z900, BAD SET FOR CURRENT TIMESTAMP'  05710000
076100         DISPLAY ' '                                              05720000
076200         PERFORM Z999-SQL-ERROR.                                  05730000
076300                                                                  05740000
076400*  COMPARE TO THE NEXT SCHEDULED COMMIT TIME                      05750000
076500                                                                  05760000
076600     IF PV-CURR-TMST > PV-COMMIT-TMST                             05770000
076700         PERFORM Z910-COMMIT.                                     05780000
076800                                                                  05790000
076900 EJECT                                                            05800000
077000******************************************************************05810000
077100*     DB2 COMMIT PROCESSING                                      *05820000
077200*                                                                *05830000
077300******************************************************************05840000
077400                                                                  05850000
077500 Z910-COMMIT.                                                     05860000
077600*------------                                                     05870000
077700                                                                  05880000
077800*  TAKE COMMIT                                                    05890000
077900                                                                  05900000
078000     EXEC SQL                                                     05910000
078100         COMMIT                                                   05920000
078200     END-EXEC.                                                    05930000
078300                                                                  05940000
078400     IF SQLCODE = +0                                              05950000
078500         CONTINUE                                                 05960000
078600     ELSE                                                         05970000
078700         DISPLAY 'PARAGRAPH Z910, BAD COMMIT'                     05980000
078800         DISPLAY ' '                                              05990000
078900         PERFORM Z999-SQL-ERROR.                                  06000000
079000                                                                  06010000
079100*  GET THE NEXT SCHEDULED COMMIT TIME                             06020000
079200                                                                  06030000
079300     EXEC SQL                                                     06040000
079400         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    06050000
079500           INTO  :PV-COMMIT-TMST                                  06060000
079600           FROM  TCKRSTCNTL                                       06070000
079700          WHERE  PLAN_NAME = 'MRKUP005'                           06080000
079800     END-EXEC.                                                    06090000
079900                                                                  06100000
080000     IF SQLCODE = +0                                              06110000
080100         CONTINUE                                                 06120000
080200     ELSE                                                         06130000
080300         DISPLAY 'PARAGRAPH Z910, SELECT FOR NEXT TIMESTAMP'      06140000
080400         DISPLAY ' '                                              06150000
080500         PERFORM Z999-SQL-ERROR.                                  06160000
080600                                                                  06170000
080700*                                                                 06180000
080800 Z999-SQL-ERROR.                                                  06190000
080900*---------------                                                  06200000
081000                                                                  06210000
081100     MOVE SQLCODE    TO SQLCODE2.                                 06220000
081200     MOVE SQLERRD(3) TO SQLERRD3.                                 06230000
081300     DISPLAY '** ABEND **       ** = SQLERROR'.                   06240000
081400     DISPLAY '** PROGRAM        ** = MRKUP005'.                   06250000
081500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06260000
081600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06270000
081700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06280000
081800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06290000
081900     MOVE +4013 TO PV-ABEND-CODE.                                 06300000
082000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06310000
082100*                                                                 06320000
082300******************************************************************06330000
