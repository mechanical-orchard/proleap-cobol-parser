000100 IDENTIFICATION DIVISION.                                         00010091
000200 PROGRAM-ID.    POKCS102.                                         00020091
000300 AUTHOR.        DAVE COLOMBO - COMPUWARE.                         00030091
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040091
000500 DATE-WRITTEN.  06-01-99.                                         00050091
000600 DATE-COMPILED.                                                   00060091
000700                                                                  00070091
000800*---------------------------------------------------------------* 00080091
000900*    W102 - PO SELECTION LIST                                   * 00090091
001000*                                                               * 00100091
001100*    THIS PROGRAM GENERATES A LIST OF PO'S BASED ON CRITERIA    * 00110091
001200*    PASSED FROM THE SET LIST SCREEN.                           * 00120091
001300*                                                               * 00130091
001400*---------------------------------------------------------------* 00140091
001500* 05/15/02  TKMA609    ADD LOGIC TO BRIDGE DB2 UPDATES TO RMS   * 00150099
001600*                      BY SENDING AN MQ TRIGGER MESSAGE TO THE  * 00160099
001700*                      PO STAGING QUEUE (PO.BRIDGE.TO.RMS.Q).   * 00170099
001800*---------------------------------------------------------------* 00180099
001900* 11/18/13  TKMAKZD    THE PROGRAM WAS MODIFIED AS TO COMMENT   * 00190099
002000*                      OUT THE CALL TO POKCS127 PROGRAM.        * 00200099
002100*           CHANGE TAG : P5207  CR NO : CHG0081355              * 00210099
002200*---------------------------------------------------------------* 00220099
002300* 11/05/14  TKMA394    EXPANDED PO NUMBER TO 9 DIGITS IN MAP      00230099
002400*                      AND COMMAREA.                              00240099
002500*           CHANGE TAG : C98147  CR NO : CHG0098147               00250099
002600*---------------------------------------------------------------* 00260099
002700 EJECT                                                            00270091
002800 ENVIRONMENT DIVISION.                                            00280091
002900                                                                  00290091
003000 DATA DIVISION.                                                   00300091
003100                                                                  00310091
003200 WORKING-STORAGE SECTION.                                         00320091
003300                                                                  00330091
003400 01  DK-DB2-KEYS.                                                 00340091
003500     05  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES. 00350091
003600     05  DK-DMA-NBR                     PIC X(02)   VALUE SPACES. 00360091
003700     05  DK-GMA-NBR                     PIC X(02)   VALUE SPACES. 00370091
003800                                                                  00380091
003900 01  PC-PROGRAM-CONSTANTS.                                        00390091
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00400091
004100                                                    'PO102A  '.   00410091
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00420091
004300                                                    'POKM102 '.   00430091
004400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00440091
004500                                                    'POKCS102'.   00450091
004600     05  PC-PO027-CS102-PO-TABLE-MAX    PIC S9(04)  VALUE +100    00460099
004700                                                    COMP.         00470093
004800     05  PC-BYTE-LENGTH-OF-PO           PIC S9(04)  VALUE +7      00480094
004900                                                    COMP.         00490094
005000*LENGTH OF NON TABLE FIELDS THAT ARE USED SPECIFICALLY FOR 102    00500095
005100     05  PC-LNGTH-STATIC-102-FLDS       PIC S9(04)  VALUE +9      00510095
005200                                                    COMP.         00520095
005300     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00530091
005400                                                    COMP.         00540091
005500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00550091
005600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00560091
005700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00570091
005800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00580091
005900                                                    COMP SYNC.    00590091
006000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00600091
006100                                                    COMP SYNC.    00610091
006200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00620091
006300                                                    +1000000      00630091
006400                                                    COMP-3.       00640091
006500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00650091
006600                                                    COMP SYNC.    00660091
006700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00670091
006800                                                    COMP-3.       00680091
006900     05  PC-CNT-MINUS-2                 PIC S9(04)  VALUE -2      00690091
007000                                                    COMP SYNC.    00700091
007100     05  PC-CNT-6                       PIC S9(04)  VALUE +6      00710091
007200                                                    COMP SYNC.    00720091
007300     05  PC-CNT-7                       PIC S9(04)  VALUE +7      00730091
007400                                                    COMP SYNC.    00740091
007500     05  PC-QUOTE                       PIC  X(01)  VALUE X'7D'.  00750091
007600     05  PC-INTER-APPL-CODES.                                     00760091
007700         10  PC-INTER-APPL-CRIT       PIC X(01)  VALUE ' '.       00770091
007800         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '1'.       00780091
007900                                                                  00790091
008000     05  PC-TSYMSG-NUMBERS.                                       00800091
008100         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00810091
008200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00820091
008300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00830091
008400         10  PC-TSYMSG-00014            PIC  9(05)  VALUE 00014.  00840091
008500         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00850091
008600         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00860091
008700         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00870091
008800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00880091
008900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00890091
009000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00900091
009100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00910091
009200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00920091
009300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00930091
009400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00940091
009500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00950091
009600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00960091
009700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00970091
009800         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00980091
009900         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00990091
010000         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01000091
010100         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01010091
010200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01020091
010300         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01030091
010400         10  PC-TSYMSG-00317            PIC  9(05)  VALUE 00317.  01040091
010500         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01050091
010600         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01060091
010700         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01070091
010800         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01080091
010900         10  PC-TSYMSG-00621            PIC  9(05)  VALUE 00621.  01090091
011000         10  PC-TSYMSG-02044            PIC  9(05)  VALUE 02044.  01100091
011100         10  PC-TSYMSG-02670            PIC  9(05)  VALUE 02670.  01110093
011200         10  PC-TSYMSG-02671            PIC  9(05)  VALUE 02671.  01120093
011300                                                                  01130091
011400 01  PS-PROGRAM-SWITCHES.                                         01140091
011500     05  PS-PURITM-SW                   PIC  X(01)  VALUE 'Y'.    01150091
011600         88  PS-206-PURITM                          VALUE 'Y'.    01160091
011700         88  PS-000-PURITM                          VALUE 'N'.    01170091
011800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01180091
011900         88  PS-NO-ERROR                            VALUE 'Y'.    01190091
012000         88  PS-ERROR                               VALUE 'N'.    01200091
012100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01210091
012200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01220091
012300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01230091
012400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01240091
012500         88  PS-DONE                                VALUE 'Y'.    01250091
012600         88  PS-NOT-DONE                            VALUE 'N'.    01260091
012700     05  PS-PROCESS-SELECTION-SW        PIC  X(01)  VALUE 'N'.    01270091
012800         88  PS-EDIT-SELECTION                      VALUE 'N'.    01280091
012900         88  PS-DEL-SELECTION                       VALUE 'Y'.    01290091
012910     05  PS-RACF-FUNC-SW                PIC  X(01)  VALUE 'N'.    01291099
012920         88  PS-RACF-FUNC-NO                        VALUE 'N'.    01292099
012930         88  PS-RACF-FUNC-YES                       VALUE 'Y'.    01293099
013000                                                                  01300091
013100 01  PV-PROGRAM-VARIABLES.                                        01310091
013200     05  PV-HOLD-CC                     PIC X(02).                01320091
013300     05  PV-SUB                         PIC S9(04)  VALUE +0      01330091
013400                                                    COMP SYNC.    01340091
013500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01350091
013600                                                    COMP SYNC.    01360091
013700     05  PV-SELECT-BYTES                PIC S9(04)  VALUE +78     01370091
013800                                                    COMP SYNC.    01380091
013900     05  PV-STRING-POINTER-FROM         PIC S9(04)  VALUE +0      01390091
014000                                                    COMP   SYNC.  01400091
014100     05  PV-STRING-POINTER-WHERE        PIC S9(04)  VALUE +0      01410091
014200                                                    COMP   SYNC.  01420091
014300     05  PV-TALLY-1                     PIC S9(04)  VALUE +0      01430091
014400                                                    COMP   SYNC.  01440091
014500     05  PV-TALLY-2                     PIC S9(04)  VALUE +0      01450091
014600                                                    COMP   SYNC.  01460091
014700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01470091
014800                                                    COMP-3.       01480091
014900     05  PV-COUNT-ITEMS-READ            PIC S9(09)  VALUE +0      01490094
015000                                                    COMP-3.       01500093
015100     05  PV-COUNT-ITEMS-SELECTED        PIC S9(09)  VALUE +0      01510094
015200                                                    COMP-3.       01520094
015300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01530091
015400                                                    COMP-3.       01540091
015500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01550091
015600                                                    COMP-3.       01560091
015700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01570091
015800                                                    COMP-3.       01580091
015900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01590091
016000                                                    COMP-3.       01600091
016100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01610091
016200                                                    COMP-3.       01620091
016300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01630091
016400                                                    COMP-3.       01640091
016500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01650091
016600                                                    COMP SYNC.    01660091
016700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01670091
016800                                                    COMP SYNC.    01680091
016900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01690091
017000                                                    COMP SYNC.    01700091
017100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01710091
017200                                                    COMP SYNC.    01720091
017300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01730091
017400                                                    COMP SYNC.    01740091
017500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01750091
017600                                                    COMP SYNC.    01760091
017700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01770091
017800                                                    COMP SYNC.    01780091
017900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01790091
018000                                                    COMP SYNC.    01800091
018100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01810091
018200                                                    COMP SYNC.    01820091
018300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01830091
018400                                                    COMP SYNC.    01840091
018500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01850091
018600                                                    COMP SYNC.    01860091
018700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01870091
018800                                                    COMP SYNC.    01880091
018900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01890091
019000                                                    COMP SYNC.    01900091
019100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01910091
019200                                                    COMP SYNC.    01920091
019300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01930091
019400                                                    COMP SYNC.    01940091
019500                                                                  01950091
019600     05  PV-NULL-IND                    PIC S9(04)  VALUE +0 COMP.01960091
019700                                                                  01970091
019800     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01980091
019900                                                    COMP-3.       01990091
020000     05  PV-DB2-COUNT2                  PIC S9(09)  VALUE +0      02000091
020100                                                    COMP-3.       02010091
020200     05  PV-SCREEN-TITLE.                                         02020091
020300         10  PV-SCREEN-SHRT-NME         PIC  X(05).               02030091
020400         10  FILLER                     PIC  X(01)  VALUE SPACES. 02040091
020500         10  PV-SCREEN-YEAR             PIC  X(04).               02050091
020600         10  PV-SCREEN-HEADING          PIC  X(20)  VALUE         02060091
020700             ' SET PO LIST        '.                              02070091
020800     05  PV-DB2-DATE                    PIC  X(10).               02080091
020900     05  FILLER  REDEFINES PV-DB2-DATE.                           02090091
021000         10  PV-DB2-DATE-CC             PIC  X(02).               02100091
021100         10  PV-DB2-DATE-YY             PIC  X(02).               02110091
021200         10  FILLER                     PIC  X(01).               02120091
021300         10  PV-DB2-DATE-MM             PIC  X(02).               02130091
021400         10  FILLER                     PIC  X(01).               02140091
021500         10  PV-DB2-DATE-DD             PIC  X(02).               02150091
021600     05  PV-DISPLAY-DATE.                                         02160091
021700         10  PV-DISPLAY-DATE-MM         PIC  X(02).               02170091
021800         10  FILLER                     PIC  X(01)  VALUE '/'.    02180091
021900         10  PV-DISPLAY-DATE-DD         PIC  X(02).               02190091
022000         10  FILLER                     PIC  X(01)  VALUE '/'.    02200091
022100         10  PV-DISPLAY-DATE-YY         PIC  X(02).               02210091
022200     05  PV-DONT-SHIP-BEF-DTE           PIC  X(08).               02220091
022300     05  PV-CAN-IFNOT-SHIP-DTE          PIC  X(08).               02230091
022400     05  PV-LAST-UPD-TMESTMP            PIC  X(26).               02240097
022500     05  PV-MSG-TEXT                    PIC  ZZZZ9  VALUE ZEROES. 02250094
022600     05  PV-ERROR-MESSAGE-AREA.                                   02260094
022700         10  PV-ERROR-MSG-1.                                      02270094
022800             15  FILLER                 PIC X(21)    VALUE        02280094
022900                 'UNSUCCESSFUL CALL TO '.                         02290094
023000             15  PV-ERROR-PGM-NAME      PIC X(08).                02300094
023100             15  FILLER                 PIC X(11)    VALUE        02310094
023200                 ' IN PARA:  '.                                   02320094
023300             15  PV-ERROR-PARA-NAME     PIC X(30).                02330094
023400         10  PV-ERROR-MSG-2.                                      02340094
023500             15  PV-ERROR-MESSAGE       PIC X(57).                02350094
023600         10  PV-ERROR-MSG-3.                                      02360094
023700             15  PV-ERROR-TYPE          PIC X(15).                02370094
023800             15  PV-OPTIONAL-TEXT       PIC X(10).                02380094
023900             15  PV-ERROR-REASON        PIC X(30).                02390094
024000                                                                  02400091
024100*---------------------------------------------------------------* 02410091
024200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02420091
024300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02430091
024400*   APPLICATION-SPECIFIC COMMAREA.                              * 02440091
024500*---------------------------------------------------------------* 02450091
024600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02460091
024700     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02470091
024800     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02480091
024900                                        INDEXED BY LQW-IDX.       02490091
025000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02500091
025100         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02510091
025200         10  LQW-SELECTED-SW            PIC X(01).                02520091
025300             88  LQW-SELECT                         VALUE 'S'.    02530091
025400             88  LQW-DESELECT                       VALUE ' '.    02540091
025500         10  LQW-PO-NBR                 PIC 9(09).                02550099
025600         10  LQW-DEPT-NBR               PIC X(03).                02560091
025700         10  LQW-VENDOR-NAME            PIC X(10).                02570091
025800         10  LQW-STATUS                 PIC X(02).                02580091
025900         10  LQW-OTB                    PIC X(04).                02590091
026000         10  LQW-SHIP-DATE              PIC X(08).                02600091
026100         10  LQW-CANCEL-DATE            PIC X(08).                02610091
026200         10  LQW-TOT-UNIT-ORDERED       PIC 9(07).                02620091
026300*        10  LQW-IP-IND                 PIC X(01).                02630091
026400                                                                  02640091
026500 EJECT                                                            02650091
026600*----------------------------------------------------------------*02660091
026700*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *02670091
026800*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *02680091
026900*----------------------------------------------------------------*02690091
027000                                                                  02700091
027100     COPY POWS077.                                                02710091
027200                                                                  02720091
027300*---------------------------------------------------------------* 02730091
027400*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02740091
027500*---------------------------------------------------------------* 02750091
027600                                                                  02760091
027700     COPY POWS012.                                                02770091
027800                                                                  02780091
027900                                                                  02790099
027910*----------------------------------------------------------------*02791099
027920**  SECURITY SUBROUTINE PARAMETERS                                02792099
027930*----------------------------------------------------------------*02793099
027940     COPY DPWS008.                                                02794099
027950                                                                  02795099
027960                                                                  02796099
028000*---------------------------------------------------------------* 02800091
028100*    MAP LAYOUT                                                 * 02810091
028200*---------------------------------------------------------------* 02820091
028300                                                                  02830091
028400     COPY POKM102.                                                02840091
028500                                                                  02850091
028600 01  MR-OCCURS-LAYOUT                   REDEFINES  PO102AO.       02860091
028700     05  FILLER                         PIC X(48).                02870091
028800                                                                  02880091
028900     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02890091
029000         10  MR-SELECTL                 PIC S9(04) COMP.          02900091
029100         10  MR-SELECTA                 PIC X(01).                02910091
029200         10  MR-SELECTC                 PIC X(01).                02920091
029300         10  MR-SELECTH                 PIC X(01).                02930091
029400         10  MR-SELECT                  PIC X(01).                02940091
029500                                                                  02950091
029600         10  MR-PO-NBRL                 PIC S9(04) COMP.          02960091
029700         10  MR-PO-NBRA                 PIC X(01).                02970091
029800         10  MR-PO-NBRC                 PIC X(01).                02980091
029900         10  MR-PO-NBRH                 PIC X(01).                02990091
030000         10  MR-PO-NBR-X.                                         03000091
030100             15  MR-PO-NBR              PIC ZZZZZZZZZ.            03010099
030200                                                                  03020091
030300         10  FILLER                     PIC X(05).                03030091
030400         10  MR-DEPT-NBR                PIC X(03).                03040091
030500                                                                  03050091
030600         10  FILLER                     PIC X(05).                03060091
030700         10  MR-VENDOR-NAME             PIC X(10).                03070091
030800                                                                  03080091
030900         10  FILLER                     PIC X(05).                03090091
031000         10  MR-STATUS                  PIC X(02).                03100091
031100                                                                  03110091
031200         10  FILLER                     PIC X(05).                03120091
031300         10  MR-OTB                     PIC X(04).                03130091
031400                                                                  03140091
031500         10  FILLER                     PIC X(05).                03150091
031600         10  MR-SHIP-DATE               PIC X(08).                03160091
031700                                                                  03170091
031800         10  FILLER                     PIC X(05).                03180091
031900         10  MR-CANCEL-DATE             PIC X(08).                03190091
032000                                                                  03200091
032100         10  FILLER                     PIC X(05).                03210091
032200         10  MR-UNITS-ORDERED-X.                                  03220091
032300             15  MR-UNITS-ORDERED       PIC ZZZZZZ9.              03230091
032400                                                                  03240091
032500     05  FILLER                         PIC X(05).                03250091
032600     05  MR-UNITS-ORDERED-TOT           PIC ZZZZZZZ9.             03260099
032700                                                                  03270091
032800                                                                  03280091
032900 EJECT                                                            03290091
033000*---------------------------------------------------------------* 03300091
033100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03310091
033200*---------------------------------------------------------------* 03320091
033300                                                                  03330091
033400     COPY DPWS015.                                                03340091
033500                                                                  03350091
033600*---------------------------------------------------------------* 03360091
033700*    FUNCTION KEYS COPYBOOK.                                    * 03370091
033800*---------------------------------------------------------------* 03380091
033900                                                                  03390091
034000     COPY DPWS016.                                                03400091
034100                                                                  03410091
034200*---------------------------------------------------------------* 03420091
034300*    NUMERIC EDIT LAYOUT.                                       * 03430091
034400*---------------------------------------------------------------* 03440091
034500                                                                  03450091
034600     COPY DPWS010I.                                               03460091
034700                                                                  03470091
034800 EJECT                                                            03480091
034900*---------------------------------------------------------------* 03490091
035000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API.              * 03500099
035100*---------------------------------------------------------------* 03510091
035200                                                                  03520091
035300     COPY DPWS030.                                                03530091
035310     COPY DPWS930.                                                03531099
035400                                                                  03540091
035500 EJECT                                                            03550091
035600*---------------------------------------------------------------* 03560091
035700*    STANDARD COMMAREA.                                         * 03570091
035800*---------------------------------------------------------------* 03580091
035900                                                                  03590091
036000     COPY DPWS020.                                                03600091
036100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03610091
036200                                                                  03620091
036300*---------------------------------------------------------------* 03630091
036400* INTER-APPLICATION COMMAREA.                                   * 03640091
036500*   POWS078 - COMMAREA PASSED FROM POKCS099                     * 03650091
036600*   POWS079 - COMMAREA PASSED TO POKCS103                       * 03660091
036700*---------------------------------------------------------------* 03670091
036800         10  INTER-APPL-COMM-AREA       PIC X(200).               03680091
036900                                                                  03690091
037000     COPY POWS078.                                                03700099
037100     COPY POWS079.                                                03710099
037200*---------------------------------------------------------------* 03720091
037300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03730091
037400*---------------------------------------------------------------* 03740091
037500         10  ASC-SPECIFIC-COMMAREA.                               03750091
037600             15  ASC-CLASS-RANGE-SW       PIC X(01).              03760091
037700                 88  ASC-CLASS-RANGE      VALUE 'Y'.              03770091
037800             15  ASC-LIST-KEYS.                                   03780091
037900                 20  ASC-KEY-SHORT-NME    PIC X(05).              03790091
038000                 20  ASC-KEY-YEAR         PIC X(04).              03800091
038100             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03810091
038200                 20  ASC-BLOCK-MODIFIED-SW                        03820091
038300                                        PIC X(01).                03830091
038400                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03840091
038500                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03850091
038600                                                                  03860091
038700                 20  ASC-ITEM-ARRAY.                              03870091
038800                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03880091
038900                         30  ASC-LIST-ITEM-NUMBER                 03890091
039000                                        PIC S9(09) COMP-3.        03900091
039100                         30  ASC-TEMP-SELECTED-SW                 03910091
039200                                        PIC X(01).                03920091
039300                             88  ASC-VALID-SELECT  VALUE ' '      03930091
039400                                                         'S'      03940091
039500                                                         'B'      03950091
039600                                                         'E'.     03960091
039700                             88  ASC-TEMP-NO-SELECT               03970091
039800                                                   VALUE ' '.     03980091
039900                             88  ASC-TEMP-SELECT   VALUE 'S'.     03990091
040000                             88  ASC-TEMP-BEGIN    VALUE 'B'.     04000091
040100                             88  ASC-TEMP-END      VALUE 'E'.     04010091
040200                         30  ASC-SELECTED-SW                      04020091
040300                                        PIC X(01).                04030091
040400                             88  ASC-NO-SELECT     VALUE ' '.     04040091
040500                             88  ASC-SELECT        VALUE 'S'.     04050091
040600                             88  ASC-BEGIN         VALUE 'B'.     04060091
040700                             88  ASC-END           VALUE 'E'.     04070091
040800                         30  ASC-PO-NBR            PIC 9(09).     04080099
040900                         30  ASC-DEPT-NBR          PIC X(03).     04090091
041000                         30  ASC-VENDOR-NAME       PIC X(10).     04100091
041100                         30  ASC-STATUS            PIC X(02).     04110091
041200                         30  ASC-OTB               PIC X(04).     04120091
041300                         30  ASC-SHIP-DATE         PIC X(08).     04130091
041400                         30  ASC-CANCEL-DATE       PIC X(08).     04140091
041500                         30  ASC-TOT-UNIT-ORDERED  PIC 9(07).     04150091
041600                                                                  04160091
041700             15  ASC-NUMBER-OF-TS-ITEMS                           04170091
041800                                       PIC S9(05) COMP-3.         04180091
041900             15  ASC-SEL-SUB           PIC  S9(04) COMP.          04190091
042000             15  ASC-SEL-ITEM          PIC  S9(04) COMP.          04200091
042100                                                                  04210091
042200             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     04220091
042300             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     04230091
042400             15  ASC-NUMBER-OF-ITEMS-READ                         04240091
042500                                        PIC S9(09) COMP-3.        04250091
042600             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04260091
042700                                        PIC S9(09) COMP-3.        04270091
042800             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        04280091
042900             15  ASC-ITEM-AT-TOP-OF-PANEL                         04290091
043000                                        PIC S9(09) COMP-3.        04300091
043100             15  ASC-ITEM-AT-BOT-OF-PANEL                         04310091
043200                                        PIC S9(09) COMP-3.        04320091
043300             15  ASC-HIGHEST-BLOCK-WRITTEN                        04330091
043400                                        PIC S9(04) COMP SYNC.     04340091
043500             15  ASC-START-OF-SELECTED-RANGE                      04350091
043600                                        PIC S9(09) COMP-3.        04360091
043700             15  ASC-END-OF-SELECTED-RANGE                        04370091
043800                                        PIC S9(09) COMP-3.        04380091
043900             15  ASC-ITEMS-LEFT-INDICATOR                         04390091
044000                                        PIC X(01).                04400091
044100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04410091
044200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04420091
044300             15  ASC-CONFIRM-SW         PIC X(01).                04430091
044400                 88  ASC-CONFIRM-DELETE            VALUE 'Y'.     04440091
044500                 88  ASC-CONFIRM-NO-DELETE         VALUE 'N'.     04450091
044600             15  ASC-TEMP-QUEUE-UPDATE-SW                         04460091
044700                                        PIC X(01).                04470091
044800                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04480091
044900                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04490091
045000             15  ASC-LIST-QUEUE-NAME.                             04500091
045100                 20  ASC-LIST-TERM-ID   PIC X(04).                04510091
045200                 20  ASC-LIST-TASK-NUMBER                         04520091
045300                                        PIC S9(05) COMP-3.        04530091
045400                 20  ASC-LIST-SEQ       PIC 9(01).                04540091
045500             15  ASC-SEL-QUEUE-NAME.                              04550091
045600                 20  ASC-SEL-TERM-ID    PIC X(04).                04560091
045700                 20  ASC-SEL-TASK-NUMBER                          04570091
045800                                        PIC S9(05) COMP-3.        04580091
045900                 20  ASC-SEL-SEQ        PIC 9(01).                04590091
046000                                                                  04600091
046100             15  ASC-START-ITEM-REQUEST.                          04610091
046200                 20  ASC-START-ITEM-REQUEST-N                     04620091
046300                                        PIC 9(07).                04630091
046400             15  ASC-UNIT-ORD-TOT       PIC S9(08).               04640091
046500 EJECT                                                            04650091
046600*---------------------------------------------------------------* 04660091
046700*    ABEND PROCESSING COPYBOOK.                                 * 04670091
046800*---------------------------------------------------------------* 04680091
046900                                                                  04690091
047000     COPY DPWS013.                                                04700091
047100                                                                  04710091
047200 EJECT                                                            04720091
047300*---------------------------------------------------------------* 04730091
047400*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04740091
047500*---------------------------------------------------------------* 04750091
047600     EXEC SQL                                                     04760091
047700          INCLUDE TPURCHS                                         04770091
047800     END-EXEC.                                                    04780091
047900                                                                  04790091
048000 EJECT                                                            04800091
048100*---------------------------------------------------------------* 04810091
048200*    DB2 AREA FOR THE PLANNED SHIPMENTS TABLE                   * 04820091
048300*---------------------------------------------------------------* 04830091
048400     EXEC SQL                                                     04840091
048500          INCLUDE TPLNSHP                                         04850091
048600     END-EXEC.                                                    04860091
048700                                                                  04870091
048800 EJECT                                                            04880091
048900*---------------------------------------------------------------* 04890091
049000*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04900091
049100*---------------------------------------------------------------* 04910091
049200     EXEC SQL                                                     04920091
049300          INCLUDE TENTNME                                         04930091
049400     END-EXEC.                                                    04940091
049500                                                                  04950091
049600 EJECT                                                            04960091
049700*---------------------------------------------------------------* 04970091
049800*    DB2 AREA FOR THE RECEIVING TABLE                           * 04980091
049900*---------------------------------------------------------------* 04990091
050000                                                                  05000091
050100     EXEC SQL                                                     05010091
050200         INCLUDE TRECEIV                                          05020091
050300     END-EXEC.                                                    05030091
050400                                                                  05040091
050500 EJECT                                                            05050091
050600*---------------------------------------------------------------* 05060091
050700*    DB2 AREA FOR THE MERCHANDISE AREA TABLE                    * 05070091
050800*---------------------------------------------------------------* 05080091
050900                                                                  05090091
051000     EXEC SQL                                                     05100091
051100         INCLUDE TMDSEAR                                          05110091
051200     END-EXEC.                                                    05120091
051300                                                                  05130091
051400 EJECT                                                            05140091
051500*---------------------------------------------------------------* 05150091
051600*    DB2 AREA FOR THE RESPONSIBILITY AREA TABLE                 * 05160091
051700*---------------------------------------------------------------* 05170091
051800                                                                  05180091
051900     EXEC SQL                                                     05190091
052000         INCLUDE TRSPBAR                                          05200091
052100     END-EXEC.                                                    05210091
052200                                                                  05220091
052300 EJECT                                                            05230091
052400*---------------------------------------------------------------* 05240091
052500*    DB2 AREA FOR THE WORKER TABLE                              * 05250091
052600*---------------------------------------------------------------* 05260091
052700                                                                  05270091
052800     EXEC SQL                                                     05280091
052900         INCLUDE TWORKER                                          05290091
053000     END-EXEC.                                                    05300091
053100                                                                  05310091
053200 EJECT                                                            05320091
053300*---------------------------------------------------------------* 05330091
053400*    DB2 AREA FOR COMMUNICATIONS                                * 05340091
053500*---------------------------------------------------------------* 05350091
053600     EXEC SQL                                                     05360091
053700          INCLUDE SQLCA                                           05370091
053800     END-EXEC.                                                    05380091
053900                                                                  05390091
054000 EJECT                                                            05400091
054100*---------------------------------------------------------------* 05410091
054200*    DECLARE PO CURSOR                                          * 05420091
054300*---------------------------------------------------------------* 05430091
054400     EXEC SQL                                                     05440091
054500         DECLARE PO-CSR CURSOR FOR                                05450091
054600          SELECT                                                  05460091
054700        DISTINCT A.PO_NBR                                         05470091
054800                ,A.OTB_PER_NBR                                    05480091
054900                ,A.DEPT_NBR                                       05490091
055000                ,A.ENT_ID                                         05500091
055100                ,C.DONT_SHIP_BEF_DTE                              05510091
055200            FROM TPURCHS A                                        05520091
055300                ,TPLNSHP C                                        05530091
055400           WHERE A.SEASET_SHRT_NM     =  :ASC-KEY-SHORT-NME       05540091
055500             AND A.SEASET_YR          =  :ASC-KEY-YEAR            05550091
055600             AND A.OTB_PER_NBR        >  '199906' CONCAT ' '      05560091
055700             AND A.VER_STATUS_CDE     =  'A'                      05570091
055800             AND C.VER_STATUS_CDE     =  'A'                      05580091
055900             AND A.PO_NBR             = C.PO_NBR                  05590091
056000        ORDER BY A.DEPT_NBR                                       05600091
056100                ,A.PO_NBR                                         05610091
056200     END-EXEC.                                                    05620091
056300                                                                  05630091
056400 EJECT                                                            05640091
056500 LINKAGE SECTION.                                                 05650091
056600                                                                  05660091
056700 01  DFHCOMMAREA.                                                 05670091
056800     05  FILLER                         OCCURS  1 TO 4072 TIMES   05680091
056900                                        DEPENDING ON EIBCALEN.    05690091
057000         10  FILLER                     PIC X.                    05700091
057100                                                                  05710091
057200 EJECT                                                            05720091
057300 PROCEDURE DIVISION.                                              05730091
057400*---------------------------------------------------------------* 05740091
057500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05750091
057600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05760091
057700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05770091
057800*---------------------------------------------------------------* 05780091
057900 0000-MAIN-MODULE.                                                05790091
058000                                                                  05800091
058100     INITIALIZE DP030-CICS-API-FIELDS.                            05810091
058200                                                                  05820091
058300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05830091
058400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05840091
058500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05850091
058600                                                                  05860091
058700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05870091
058800                                                                  05880091
058900     MOVE LENGTH OF PO102AI        TO DP030-MAP-LENGTH (1).       05890091
059000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05900091
059100                                                                  05910091
059200     PERFORM 0001-CALL-CICS-ARCH-API.                             05920091
059300     PERFORM 1000-CONTROL-PROCESSING                              05930091
059400                                                                  05940091
059500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05950091
059600     PERFORM 0001-CALL-CICS-ARCH-API.                             05960091
059700                                                                  05970091
059800*---------------------------------------------------------------* 05980091
059900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05990091
060000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 06000091
060100*---------------------------------------------------------------* 06010091
060200 0001-CALL-CICS-ARCH-API.                                         06020091
060300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06030099
060400                              DFHCOMMAREA                         06040099
060500                              DP030-CICS-API-FIELDS               06050099
060600                              DP020-STANDARD-COMMAREA             06060099
060700                              PO102AI.                            06070099
060800                                                                  06080091
060900     IF  DP030-RC-CALL-SUCCESSFUL                                 06090091
061000         CONTINUE                                                 06100091
061100     ELSE                                                         06110091
061200         SET DP013-NO-ROLLBACK                                    06120091
061300             DP013-XCTL-DISPLAY-RESTART                           06130091
061400             DP013-CICS-ABEND      TO TRUE                        06140091
061500         MOVE '0001-CALL-CICS-ARCH-API'                           06150091
061600                                   TO DP013-PARAGRAPH             06160091
061610         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06161099
061800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06180099
061900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06190091
062000         PERFORM DP013-0000-PROCESS-ABEND                         06200091
062100     END-IF.                                                      06210091
062200                                                                  06220091
062300*----------------------------------------------------------------*06230091
062400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06240091
062500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06250091
062600*                                                                *06260091
062700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06270091
062800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06280091
062900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06290091
063000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06300091
063100*----------------------------------------------------------------*06310091
063200                                                                  06320091
063300 1000-CONTROL-PROCESSING.                                         06330091
063400                                                                  06340091
063500     EVALUATE TRUE                                                06350091
063600         WHEN DP020-NEXT-ACT-INITIAL                              06360091
063700             INITIALIZE ASC-SPECIFIC-COMMAREA                     06370091
063800                                                                  06380091
063900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06390091
064000                                      ASC-SEL-TERM-ID             06400091
064100             MOVE DP020-SRC-TASK-NUMBER                           06410091
064200                                   TO ASC-LIST-TASK-NUMBER        06420091
064300                                      ASC-SEL-TASK-NUMBER         06430091
064400             MOVE PC-LIST-QUEUE-SEQ                               06440091
064500                                   TO ASC-LIST-SEQ                06450091
064600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06460091
064700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06470091
064800             IF  PS-COMMAREA-NOT-VALID                            06480091
064900                 SET DP020-NEXT-ACT-APPL-ERROR                    06490091
065000                                   TO TRUE                        06500091
065100             ELSE                                                 06510091
065200                 PERFORM 4000-BUILD-INITIAL-PANEL                 06520091
065300                 MOVE ASC-KEY-SHORT-NME                           06530091
065400                                   TO PV-SCREEN-SHRT-NME          06540091
065500                 MOVE ASC-KEY-YEAR TO PV-SCREEN-YEAR              06550091
065600                 MOVE PV-SCREEN-TITLE                             06560091
065700                                   TO DP020-PANEL-TITLE           06570091
065800             END-IF                                               06580091
065900                                                                  06590091
066000         WHEN DP020-NEXT-ACT-READ-MAP                             06600091
066100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06610091
066200                                   TO PV-TOP-ITEM                 06620091
066300             PERFORM 2000-PROCESS-PANEL                           06630091
066400                                                                  06640091
066500         WHEN DP020-NEXT-ACT-RETURN                               06650091
066600             MOVE ASC-KEY-SHORT-NME                               06660091
066700                                   TO PV-SCREEN-SHRT-NME          06670091
066800             MOVE ASC-KEY-YEAR     TO PV-SCREEN-YEAR              06680091
066900             MOVE PV-SCREEN-TITLE  TO DP020-PANEL-TITLE           06690091
067000             IF PO079-W102-REFRESH                                06700091
067100                 PERFORM 2050-DELETE-LIST-QUEUE                   06710091
067200                 PERFORM 4000-BUILD-INITIAL-PANEL                 06720091
067300             ELSE                                                 06730091
067400                 IF ASC-NUMBER-OF-ITEMS-READ > ZERO               06740091
067500                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                06750091
067600                                   TO PV-TOP-ITEM                 06760091
067700                     MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL    06770091
067800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06780091
067900                 ELSE                                             06790091
068000                     PERFORM 4100-FORMAT-EMPTY-SCREEN             06800091
068100                         VARYING PV-SUB FROM +1 BY +1             06810091
068200                             UNTIL PV-SUB > PC-ITEMS-PER-PANEL    06820091
068300                 END-IF                                           06830091
068400             END-IF                                               06840091
068500                                                                  06850091
068600         WHEN OTHER                                               06860091
068700             SET DP013-LOGIC-ABEND TO TRUE                        06870091
068800             SET DP013-NO-ROLLBACK TO TRUE                        06880091
068900             MOVE '1000-CONTROL-PROCESSING'                       06890091
069000                                   TO DP013-PARAGRAPH             06900091
069100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06910091
069200                                   TO DP013-MESSAGE-TEXT(1)       06920091
069300             PERFORM DP013-0000-PROCESS-ABEND                     06930091
069400     END-EVALUATE.                                                06940091
069500                                                                  06950091
069600 EJECT                                                            06960091
069700*----------------------------------------------------------------*06970091
069800* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06980091
069900*----------------------------------------------------------------*06990091
070000                                                                  07000091
070100 1100-PROCESS-INTER-APPL-COMM.                                    07010091
070200                                                                  07020091
070300     SET PS-COMMAREA-VALID         TO TRUE.                       07030091
070400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07040091
070500                                                                  07050091
070600     EVALUATE DP020-INT-APPL-FORMAT-IND                           07060091
070700                                                                  07070091
070800         WHEN PC-INTER-APPL-LIST                                  07080091
070900             MOVE PO078-NUMBER-OF-SELECTED-ITEMS                  07090091
071000                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  07100091
071100             MOVE PO078-NUMBER-OF-TS-ITEMS                        07110091
071200                                 TO ASC-NUMBER-OF-TS-ITEMS        07120091
071300             MOVE PO078-SEL-QUEUE-NAME                            07130091
071400                                 TO ASC-SEL-QUEUE-NAME            07140091
071500             PERFORM 1120-PREPARE-LIST-ENTRY                      07150091
071600                                                                  07160091
071700         WHEN OTHER                                               07170091
071800             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            07180091
071900             SET PS-ERROR                                         07190091
072000                 PS-COMMAREA-NOT-VALID                            07200091
072100                 DP020-MSG-FATAL                                  07210091
072200                 DP020-NEXT-ACT-APPL-ERROR                        07220091
072300                                   TO TRUE                        07230091
072400                                                                  07240091
072500     END-EVALUATE.                                                07250091
072600                                                                  07260091
072700 EJECT                                                            07270091
072800*----------------------------------------------------------------*07280091
072900*    ENTRY IS FROM A LIST.  GET THE SET YEAR AND NAME FROM THE   *07290091
073000*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *07300091
073100*----------------------------------------------------------------*07310091
073200 1120-PREPARE-LIST-ENTRY.                                         07320091
073300                                                                  07330091
073400     MOVE PO077-MAX-ITEMS          TO ASC-SEL-SUB.                07340091
073500     MOVE ZERO                     TO ASC-SEL-ITEM.               07350091
073600     PERFORM 2310-GET-NEXT-SET.                                   07360091
073700                                                                  07370091
073800 EJECT                                                            07380091
073900*----------------------------------------------------------------*07390091
074000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07400091
074100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07410091
074200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07420091
074300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07430091
074400* FUNCTION KEYS CAN GET THIS FAR.                                *07440091
074500*----------------------------------------------------------------*07450091
074600                                                                  07460091
074700 2000-PROCESS-PANEL.                                              07470091
074800     EVALUATE TRUE                                                07480091
074900         WHEN DP020-SRC-AID = DP016-CLEAR                         07490091
075000             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07500091
075100                 MOVE ZERO        TO ASC-ITEM-AT-TOP-OF-PANEL     07510091
075200                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07520091
075300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07530091
075400             ELSE                                                 07540091
075500                 MOVE +0           TO PV-SUB                      07550091
075600                 PERFORM                                          07560091
075700                     UNTIL PV-SUB > PC-ITEMS-PER-PANEL            07570091
075800                     MOVE DP015-ASK-DRK-OFF                       07580091
075900                                    TO MR-SELECTA (PV-SUB)        07590091
076000                     ADD +1         TO PV-SUB                     07600091
076100                 END-PERFORM                                      07610091
076200             END-IF                                               07620091
076300                                                                  07630091
076400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07640091
076500             PERFORM 2050-DELETE-LIST-QUEUE                       07650091
076600             PERFORM 4000-BUILD-INITIAL-PANEL                     07660091
076700                                                                  07670091
076800         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   07680091
076900             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07690091
077000                 PERFORM 2140-DESELECT-ALL-ITEMS                  07700091
077100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07710091
077200             END-IF                                               07720091
077300                                                                  07730091
077400         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 07740091
077500             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07750091
077600                  PERFORM 2150-SELECT-ALL-ITEMS                   07760091
077700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            07770091
077800             END-IF                                               07780091
077900                                                                  07790091
078000         WHEN OTHER                                               07800091
078100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07810091
078200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07820091
078300             IF  PS-NO-ERROR                                      07830091
078400                 SET DP030-CONTINUE-GO TO TRUE                    07840091
078500                 PERFORM 2100-CHECK-FUNCTION-KEY                  07850091
078600             ELSE                                                 07860091
078700                 SET DP030-OVERRIDE-GO TO TRUE                    07870091
078800             END-IF                                               07880091
078900     END-EVALUATE.                                                07890091
079000                                                                  07900091
079100 EJECT                                                            07910091
079200*----------------------------------------------------------------*07920091
079300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07930091
079400*----------------------------------------------------------------*07940091
079500 2050-DELETE-LIST-QUEUE.                                          07950091
079600                                                                  07960091
079700     EXEC CICS                                                    07970091
079800         DELETEQ TS                                               07980091
079900           QUEUE (ASC-LIST-QUEUE-NAME)                            07990091
080000            RESP (PV-CICS-RESP)                                   08000091
080100     END-EXEC.                                                    08010091
080200                                                                  08020091
080300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08030091
080400        (PV-CICS-RESP = DFHRESP(QIDERR))                          08040091
080500         CONTINUE                                                 08050091
080600     ELSE                                                         08060091
080700         SET DP013-CICS-ABEND      TO TRUE                        08070091
080800         SET DP013-NO-ROLLBACK     TO TRUE                        08080091
080900                                                                  08090091
081000         MOVE '2050-DELETE-LIST-QUEUE'                            08100091
081100                                   TO DP013-PARAGRAPH             08110091
081200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08120091
081300                                   TO DP013-MESSAGE-TEXT (1)      08130091
081400         PERFORM DP013-0000-PROCESS-ABEND                         08140091
081500     END-IF.                                                      08150091
081600                                                                  08160091
081700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08170091
081800                                                                  08180091
081900 EJECT                                                            08190091
082000*----------------------------------------------------------------*08200091
082100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08210091
082200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08220091
082300* CICS ARCHITECTURE API.                                         *08230091
082400*----------------------------------------------------------------*08240091
082500 2100-CHECK-FUNCTION-KEY.                                         08250091
082600                                                                  08260091
082700     IF ASC-CONFIRM-DELETE                                        08270091
082800         IF DP020-FK-CONFIRM (DP020-SRC-AID)                      08280091
082900             NEXT SENTENCE                                        08290091
083000         ELSE                                                     08300091
083100             SET ASC-CONFIRM-NO-DELETE TO TRUE                    08310091
083200         END-IF                                                   08320091
083300     END-IF.                                                      08330091
083400                                                                  08340091
083500     EVALUATE TRUE                                                08350091
083600                                                                  08360091
083700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08370091
083800             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08380091
083900                 MOVE +1               TO PV-TOP-ITEM             08390091
084000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08400091
084100                 PERFORM 3200-RESET-ATTRIBUTES                    08410091
084200             END-IF                                               08420091
084300                                                                  08430091
084400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08440091
084500             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08450091
084600                 PERFORM 2110-BROWSE-BACKWARD                     08460091
084700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08470091
084800                 PERFORM 3200-RESET-ATTRIBUTES                    08480091
084900             END-IF                                               08490091
085000                                                                  08500091
085100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08510091
085200             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08520091
085300                 PERFORM 2120-BROWSE-FORWARD                      08530091
085400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08540091
085500                 PERFORM 3200-RESET-ATTRIBUTES                    08550091
085600             END-IF                                               08560091
085700                                                                  08570091
085800         WHEN DP020-SRC-AID = DP016-ENTER                         08580091
085900             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08590091
086000                 PERFORM 2130-CHECK-FOR-JUMP-BROWSE               08600091
086100                 IF  PS-ERROR                                     08610091
086200                     CONTINUE                                     08620091
086300                 ELSE                                             08630091
086400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08640091
086500                     PERFORM 3200-RESET-ATTRIBUTES                08650091
086600                 END-IF                                           08660091
086700             END-IF                                               08670091
086800                                                                  08680091
086900         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08690091
087000*            ADD PROCESSING                                       08700091
087100             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               08710091
087200                 SET DP030-OVERRIDE-GO                            08720091
087300                     DP020-MSG-FATAL                              08730091
087400                                   TO TRUE                        08740091
087500                 MOVE PC-TSYMSG-00146                             08750091
087600                                   TO DP020-MSG-NUMBER            08760091
087700             ELSE                                                 08770091
087800                 INITIALIZE PO079-INTER-APPL-COMMAREA             08780091
087900                 SET PO079-W102-DONT-REFRESH TO TRUE              08790091
088000                 MOVE ASC-KEY-YEAR                                08800091
088100                                   TO PO079-SET-YEAR              08810091
088200                 MOVE ASC-KEY-SHORT-NME                           08820091
088300                                   TO PO079-SET-SHORT-NME         08830091
088400             END-IF                                               08840091
088500                                                                  08850091
088600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               08860091
088700*            START OF DELETE PROCESS, SEND COMFIRMATION MESSAGE   08870091
088800             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               08880091
088900               IF ASC-NUMBER-OF-SELECTED-ITEMS >                  08890094
089000                  PC-PO027-CS102-PO-TABLE-MAX                     08900094
089100                 SET DP020-MSG-FATAL TO TRUE                      08910094
089200                 MOVE PC-TSYMSG-02670 TO DP020-MSG-NUMBER         08920094
089300                 MOVE PC-PO027-CS102-PO-TABLE-MAX TO PV-MSG-TEXT  08930094
089400                 MOVE PV-MSG-TEXT TO DP020-MSG-TEXT               08940094
089500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08950094
089600               ELSE                                               08960094
089700                 SET PS-EDIT-SELECTION                            08970091
089800                                   TO TRUE                        08980091
089900                 PERFORM 7000-UPDATE-PO                           08990091
090000                 IF PS-NO-ERROR                                   09000091
090100                     SET DP020-MSG-WARNING                        09010091
090200                         ASC-CONFIRM-DELETE                       09020091
090300                                   TO TRUE                        09030091
090400                     MOVE PC-TSYMSG-00004                         09040091
090500                                   TO DP020-MSG-NUMBER            09050091
090600                 END-IF                                           09060091
090700               END-IF                                             09070094
090800             ELSE                                                 09080091
090900                 SET DP020-MSG-FATAL                              09090091
091000                                   TO TRUE                        09100091
091100                 MOVE PC-TSYMSG-00057                             09110091
091200                                   TO DP020-MSG-NUMBER            09120091
091300             END-IF                                               09130091
091400                                                                  09140091
091500         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    09150091
091600*            DELETE CONFIRMATION                                  09160091
091700             IF ASC-CONFIRM-DELETE                                09170091
091800                 SET PS-DEL-SELECTION  TO TRUE                    09180091
091900                 PERFORM 7000-UPDATE-PO                           09190091
092000                 IF PS-NO-ERROR                                   09200091
092100                     PERFORM 2050-DELETE-LIST-QUEUE               09210091
092200                     PERFORM 4000-BUILD-INITIAL-PANEL             09220091
092300                     SET DP020-MSG-INFORMATIONAL                  09230091
092400                                       TO TRUE                    09240091
092500                     MOVE PC-TSYMSG-00115                         09250091
092600                                       TO DP020-MSG-NUMBER        09260091
092700                 END-IF                                           09270091
092800             ELSE                                                 09280091
092900                 SET DP020-MSG-FATAL                              09290091
093000                                   TO TRUE                        09300091
093100                 MOVE PC-TSYMSG-00045                             09310091
093200                                   TO DP020-MSG-NUMBER            09320091
093300             END-IF                                               09330091
093400                                                                  09340091
093500         WHEN OTHER                                               09350091
093600             SET DP013-NO-ROLLBACK                                09360091
093700                 DP013-XCTL-DISPLAY-RESTART                       09370091
093800                 DP013-CICS-ABEND  TO TRUE                        09380091
093900             MOVE '2100-CHECK-FUNCTION-KEY'                       09390091
094000                                   TO DP013-PARAGRAPH             09400091
094100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09410091
094200                                   TO DP013-MESSAGE-TEXT (1)      09420091
094300             PERFORM DP013-0000-PROCESS-ABEND                     09430091
094400     END-EVALUATE.                                                09440091
094500                                                                  09450091
094600 EJECT                                                            09460091
094700*----------------------------------------------------------------*09470091
094800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09480091
094900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09490091
095000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09500091
095100*    MESSAGE.                                                    *09510091
095200*----------------------------------------------------------------*09520091
095300                                                                  09530091
095400 2110-BROWSE-BACKWARD.                                            09540091
095500                                                                  09550091
095600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09560091
095700         GIVING PV-TOP-ITEM.                                      09570091
095800                                                                  09580091
095900     IF  ((PV-TOP-ITEM < +1)                                      09590091
096000       OR (PV-TOP-ITEM = +1))                                     09600091
096100         MOVE +1                   TO PV-TOP-ITEM                 09610091
096200*        -- TOP OF LIST --                                        09620091
096300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09630091
096400         SET DP020-MSG-INFORMATIONAL                              09640091
096500                                   TO TRUE                        09650091
096600     END-IF.                                                      09660091
096700                                                                  09670091
096800 EJECT                                                            09680091
096900*----------------------------------------------------------------*09690091
097000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09700091
097100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09710091
097200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09720091
097300*----------------------------------------------------------------*09730091
097400                                                                  09740091
097500 2120-BROWSE-FORWARD.                                             09750091
097600                                                                  09760091
097700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09770091
097800         GIVING PV-TOP-ITEM.                                      09780091
097900                                                                  09790091
098000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09800091
098100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09810091
098200                                   TO PV-TOP-ITEM                 09820091
098300*        -- BOTTOM OF LIST --                                     09830091
098400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09840091
098500         SET DP020-MSG-INFORMATIONAL                              09850091
098600                                   TO TRUE                        09860091
098700     ELSE                                                         09870091
098800         COMPUTE PV-BOTTOM-ITEM =                                 09880091
098900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09890091
099000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09900091
099100*            -- BOTTOM OF LIST --                                 09910091
099200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09920091
099300             SET DP020-MSG-INFORMATIONAL                          09930091
099400                                   TO TRUE                        09940091
099500         END-IF                                                   09950091
099600     END-IF.                                                      09960091
099700                                                                  09970091
099800 EJECT                                                            09980091
099900*----------------------------------------------------------------*09990091
100000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10000091
100100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10010091
100200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10020091
100300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10030091
100400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10040091
100500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10050091
100600*----------------------------------------------------------------*10060091
100700                                                                  10070091
100800 2130-CHECK-FOR-JUMP-BROWSE.                                      10080091
100900                                                                  10090091
101000     SET PS-NO-ERROR               TO TRUE.                       10100091
101100     IF (ASC-START-ITEM-REQUEST = SPACE)                          10110091
101200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10120091
101300                                   TO PV-TOP-ITEM                 10130091
101400     ELSE                                                         10140091
101500         MOVE ASC-START-ITEM-REQUEST                              10150091
101600                                   TO DP010I-UNEDITED-FIELD       10160091
101700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10170091
101800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10180091
101900         SET DP010I-NEGATIVE-NOT-ALLOWED                          10190091
102000                                   TO TRUE                        10200091
102100         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10210092
102200              USING DP010I-NUMERIC-EDIT-AREA                      10220091
102300                                                                  10230091
102400         IF  NOT DP010I-ERROR-DETECTED                            10240091
102500             MOVE DP010I-NUMERIC-FIELD                            10250091
102600                                   TO ASC-START-ITEM-REQUEST-N    10260091
102700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10270091
102800                 IF  ASC-START-ITEM-REQUEST-N >                   10280091
102900                                          ASC-NUMBER-OF-ITEMS-READ10290091
103000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10300091
103100                     COMPUTE PV-TOP-ITEM =                        10310091
103200                             ASC-NUMBER-OF-ITEMS-READ             10320091
103300                             - PC-ITEMS-PER-PANEL + 1             10330091
103400                     IF  PV-TOP-ITEM < +1                         10340091
103500                         MOVE +1   TO PV-TOP-ITEM                 10350091
103600                         MOVE PC-TSYMSG-00070                     10360091
103700                                   TO DP020-MSG-NUMBER            10370091
103800                         SET DP020-MSG-INFORMATIONAL              10380091
103900                                   TO TRUE                        10390091
104000                     END-IF                                       10400091
104100                 ELSE                                             10410091
104200                     MOVE ASC-START-ITEM-REQUEST-N                10420091
104300                                   TO PV-TOP-ITEM                 10430091
104400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10440091
104500                     COMPUTE PV-BOTTOM-ITEM =                     10450091
104600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10460091
104700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10470091
104800*                        -- BOTTOM OF LIST --                     10480091
104900                         MOVE PC-TSYMSG-00070                     10490091
105000                                   TO DP020-MSG-NUMBER            10500091
105100                         SET DP020-MSG-INFORMATIONAL              10510091
105200                                   TO TRUE                        10520091
105300                     END-IF                                       10530091
105400                 END-IF                                           10540091
105500             ELSE                                                 10550091
105600*                --- VALUE OUT OF RANGE ----                      10560091
105700                 MOVE PC-TSYMSG-00101                             10570091
105800                                   TO DP020-MSG-NUMBER            10580091
105900                 MOVE -1           TO ASTRTITL                    10590091
106000                 SET DP030-SET-CURSOR-APPL-1                      10600091
106100                                   TO TRUE                        10610091
106200                 MOVE DP015-REVERSE                               10620091
106300                                   TO ASTRTITH                    10630091
106400                 MOVE DP015-RED    TO ASTRTITC                    10640091
106500                 MOVE DP015-UNP-NUM-BRT-MDT                       10650091
106600                                   TO ASTRTITA                    10660091
106700                 SET DP020-MSG-FATAL                              10670091
106800                                   TO TRUE                        10680091
106900                 SET PS-ERROR      TO TRUE                        10690091
107000             END-IF                                               10700091
107100                                                                  10710091
107200         ELSE                                                     10720091
107300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10730091
107400             MOVE -1               TO ASTRTITL                    10740091
107500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10750091
107600             MOVE DP015-REVERSE    TO ASTRTITH                    10760091
107700             MOVE DP015-RED        TO ASTRTITC                    10770091
107800             MOVE DP015-UNP-NUM-BRT-MDT                           10780091
107900                                   TO ASTRTITA                    10790091
108000             SET DP020-MSG-FATAL   TO TRUE                        10800091
108100             SET PS-ERROR          TO TRUE                        10810091
108200         END-IF                                                   10820091
108300     END-IF.                                                      10830091
108400                                                                  10840091
108500 EJECT                                                            10850091
108600*----------------------------------------------------------------*10860091
108700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10870091
108800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10880091
108900*----------------------------------------------------------------*10890091
109000 2140-DESELECT-ALL-ITEMS.                                         10900091
109100                                                                  10910091
109200     MOVE +1                       TO ASC-BLK-SUB.                10920091
109300                                                                  10930091
109400     PERFORM 2141-CLEAR-SELECTED-INDS                             10940091
109500         VARYING ASC-ITEM-SUB                                     10950091
109600         FROM 1 BY 1                                              10960091
109700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10970091
109800                                                                  10980091
109900     ADD +1                        TO ASC-BLK-SUB.                10990091
110000                                                                  11000091
110100     PERFORM 2141-CLEAR-SELECTED-INDS                             11010091
110200         VARYING ASC-ITEM-SUB                                     11020091
110300         FROM 1 BY 1                                              11030091
110400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11040091
110500                                                                  11050091
110600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11060091
110700                                   TO PV-LIST-ITEM-NUMBER.        11070091
110800                                                                  11080091
110900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11090091
111000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11100091
111100                                                                  11110091
111200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11120091
111300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11130091
111400         MOVE +1                   TO ASC-BLK-SUB                 11140091
111500                                                                  11150091
111600         PERFORM 5100-WRITE-TEMP-STORAGE                          11160091
111700                                                                  11170091
111800         MOVE +1                   TO PV-BLOCK-NUMBER             11180091
111900                                                                  11190091
112000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11200091
112100             PV-FIRST-BLOCK-IN-ARRAY - 1                          11210091
112200                                                                  11220091
112300         PERFORM                                                  11230091
112400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11240091
112500                                                                  11250091
112600             PERFORM 4410-READ-TEMP-STORAGE                       11260091
112700                                                                  11270091
112800             PERFORM 2141-CLEAR-SELECTED-INDS                     11280091
112900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11290091
113000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11300091
113100                                                                  11310091
113200             PERFORM 5100-WRITE-TEMP-STORAGE                      11320091
113300                                                                  11330091
113400             ADD +1                TO PV-BLOCK-NUMBER             11340091
113500                                                                  11350091
113600         END-PERFORM                                              11360091
113700                                                                  11370091
113800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11380091
113900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11390091
114000                                                                  11400091
114100         PERFORM                                                  11410091
114200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11420091
114300                   ASC-HIGHEST-BLOCK-WRITTEN                      11430091
114400                                                                  11440091
114500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11450091
114600                                   TO PV-BLOCK-NUMBER             11460091
114700                                                                  11470091
114800             PERFORM 4410-READ-TEMP-STORAGE                       11480091
114900                                                                  11490091
115000             PERFORM 2141-CLEAR-SELECTED-INDS                     11500091
115100                 VARYING ASC-ITEM-SUB                             11510091
115200                 FROM 1 BY 1                                      11520091
115300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11530091
115400                                                                  11540091
115500             PERFORM 5100-WRITE-TEMP-STORAGE                      11550091
115600                                                                  11560091
115700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11570091
115800                                                                  11580091
115900         END-PERFORM                                              11590091
116000                                                                  11600091
116100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11610091
116200                                   TO PV-BLOCK-NUMBER             11620091
116300                                                                  11630091
116400         PERFORM 4410-READ-TEMP-STORAGE                           11640091
116500     END-IF.                                                      11650091
116600                                                                  11660091
116700     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS11670091
116800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11680091
116900     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11690091
117000                                                                  11700091
117100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11710091
117200                                                                  11720091
117300 EJECT                                                            11730091
117400*----------------------------------------------------------------*11740091
117500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11750091
117600*----------------------------------------------------------------*11760091
117700                                                                  11770091
117800 2141-CLEAR-SELECTED-INDS.                                        11780091
117900                                                                  11790091
118000     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          11800091
118100             NOT EQUAL ZERO                                       11810091
118200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11820091
118300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11830091
118400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11840091
118500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11850091
118600                                   TO TRUE                        11860091
118700         END-IF                                                   11870091
118800     END-IF.                                                      11880091
118900                                                                  11890091
119000 EJECT                                                            11900091
119100*----------------------------------------------------------------*11910091
119200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11920091
119300*  FOR ALL ITEMS.                                                *11930091
119400*----------------------------------------------------------------*11940091
119500                                                                  11950091
119600 2150-SELECT-ALL-ITEMS.                                           11960091
119700                                                                  11970091
119800     MOVE +1                       TO ASC-BLK-SUB.                11980091
119900     MOVE ZERO                     TO PV-COUNT-ITEMS-SELECTED.    11990094
120000                                                                  12000091
120100     PERFORM 2151-SET-SELECTED-INDS                               12010091
120200         VARYING ASC-ITEM-SUB                                     12020091
120300         FROM 1 BY 1                                              12030091
120400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12040091
120500                                                                  12050091
120600     ADD +1                        TO ASC-BLK-SUB.                12060091
120700                                                                  12070091
120800     PERFORM 2151-SET-SELECTED-INDS                               12080091
120900         VARYING ASC-ITEM-SUB                                     12090091
121000         FROM 1 BY 1                                              12100091
121100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12110091
121200                                                                  12120091
121300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12130091
121400                                   TO PV-LIST-ITEM-NUMBER.        12140091
121500                                                                  12150091
121600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12160091
121700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12170091
121800                                                                  12180091
121900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12190091
122000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12200091
122100         MOVE +1                   TO ASC-BLK-SUB                 12210091
122200                                                                  12220091
122300         PERFORM 5100-WRITE-TEMP-STORAGE                          12230091
122400                                                                  12240091
122500         MOVE +1                   TO PV-BLOCK-NUMBER             12250091
122600                                                                  12260091
122700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12270091
122800             PV-FIRST-BLOCK-IN-ARRAY - 1                          12280091
122900                                                                  12290091
123000         PERFORM                                                  12300091
123100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12310091
123200                                                                  12320091
123300             PERFORM 4410-READ-TEMP-STORAGE                       12330091
123400                                                                  12340091
123500             PERFORM 2151-SET-SELECTED-INDS                       12350091
123600                 VARYING ASC-ITEM-SUB                             12360091
123700                 FROM 1 BY 1                                      12370091
123800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12380091
123900                                                                  12390091
124000             PERFORM 5100-WRITE-TEMP-STORAGE                      12400091
124100                                                                  12410091
124200             ADD +1                TO PV-BLOCK-NUMBER             12420091
124300         END-PERFORM                                              12430091
124400                                                                  12440091
124500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12450091
124600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12460091
124700                                                                  12470091
124800         PERFORM                                                  12480091
124900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12490091
125000                   ASC-HIGHEST-BLOCK-WRITTEN                      12500091
125100                                                                  12510091
125200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12520091
125300                                   TO PV-BLOCK-NUMBER             12530091
125400                                                                  12540091
125500             PERFORM 4410-READ-TEMP-STORAGE                       12550091
125600                                                                  12560091
125700             PERFORM 2151-SET-SELECTED-INDS                       12570091
125800                 VARYING ASC-ITEM-SUB                             12580091
125900                 FROM 1 BY 1                                      12590091
126000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12600091
126100                                                                  12610091
126200             PERFORM 5100-WRITE-TEMP-STORAGE                      12620091
126300                                                                  12630091
126400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12640091
126500         END-PERFORM                                              12650091
126600                                                                  12660091
126700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12670091
126800                                   TO PV-BLOCK-NUMBER             12680091
126900                                                                  12690091
127000         PERFORM 4410-READ-TEMP-STORAGE                           12700091
127100     END-IF.                                                      12710091
127200                                                                  12720091
127300*RAS                                                              12730099
127400*    MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12740099
127500     MOVE PV-COUNT-ITEMS-SELECTED  TO                             12750099
127600          ASC-NUMBER-OF-SELECTED-ITEMS.                           12760099
127700*RAS                                                              12770099
127800                                                                  12780091
127900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12790091
128000                                                                  12800091
128100 EJECT                                                            12810091
128200*----------------------------------------------------------------*12820091
128300*    MARK EACH ITEM AS BEING SELECTED.                           *12830091
128400*----------------------------------------------------------------*12840091
128500                                                                  12850091
128600 2151-SET-SELECTED-INDS.                                          12860091
128700                                                                  12870091
128800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12880091
128900             NOT EQUAL ZERO                                       12890091
129000         IF PV-COUNT-ITEMS-SELECTED = PC-PO027-CS102-PO-TABLE-MAX 12900099
129100           SET DP020-MSG-WARNING       TO TRUE                    12910099
129200           MOVE PC-TSYMSG-02671        TO DP020-MSG-NUMBER        12920099
129300           MOVE PC-PO027-CS102-PO-TABLE-MAX TO PV-MSG-TEXT        12930099
129400           MOVE PV-MSG-TEXT            TO DP020-MSG-TEXT          12940099
129500         ELSE                                                     12950099
129600           IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)            12960099
129700               SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)           12970099
129800                   ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)      12980099
129900                   ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                12990099
130000                                     TO TRUE                      13000099
130100*RAS                                                              13010099
130200               ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS             13020099
130300*RAS                                                              13030099
130400           END-IF                                                 13040099
130500           ADD +1 TO PV-COUNT-ITEMS-SELECTED                      13050099
130600         END-IF                                                   13060099
130700     END-IF.                                                      13070091
130800                                                                  13080091
130900 EJECT                                                            13090091
131000*----------------------------------------------------------------*13100091
131100*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13110091
131200*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13120091
131300*----------------------------------------------------------------*13130091
131400 2200-MOVE-SCREEN-TO-COMMAREA.                                    13140091
131500                                                                  13150091
131600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13160091
131700     MOVE +1                       TO PV-SUB.                     13170091
131800                                                                  13180091
131900     PERFORM 3100-SET-SUBSCRIPTS.                                 13190091
132000                                                                  13200091
132100     IF  ASTRTITL > ZERO                                          13210091
132200             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   13220091
132300                 MOVE ASTRTITI        TO ASC-START-ITEM-REQUEST   13230091
132400             ELSE                                                 13240091
132500                 MOVE ZEROS           TO ASTRTITO                 13250091
132600             END-IF                                               13260091
132700     ELSE                                                         13270091
132800         IF  ASTRTITF = DP015-ERASE-EOF                           13280091
132900             INITIALIZE ASC-START-ITEM-REQUEST                    13290091
133000         END-IF                                                   13300091
133100     END-IF.                                                      13310091
133200                                                                  13320091
133300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13330091
133400         VARYING PV-SUB                                           13340091
133500         FROM 1 BY 1                                              13350091
133600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13360091
133700                                                                  13370091
133800 EJECT                                                            13380091
133900*----------------------------------------------------------------*13390091
134000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *13400091
134100*----------------------------------------------------------------*13410091
134200 2210-MOVE-LINES-TO-COMMAREA.                                     13420091
134300                                                                  13430091
134400     IF  MR-SELECTL (PV-SUB) > ZERO                               13440091
134500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13450091
134600                                   TO TRUE                        13460091
134700         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        13470091
134800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13480091
134900     ELSE                                                         13490091
135000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13500091
135100             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         13510091
135200             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        13520091
135300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13530091
135400         END-IF                                                   13540091
135500     END-IF.                                                      13550091
135600                                                                  13560091
135700     ADD +1                        TO ASC-ITEM-SUB.               13570091
135800                                                                  13580091
135900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13590091
136000         ADD +1                    TO ASC-BLK-SUB                 13600091
136100         MOVE +1                   TO ASC-ITEM-SUB                13610091
136200     END-IF.                                                      13620091
136300                                                                  13630091
136400 EJECT                                                            13640091
136500*----------------------------------------------------------------*13650091
136600*    GET THE SET INFO (KEY) OF THE NEXT SELECTED OBJECT          *13660091
136700*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *13670091
136800*----------------------------------------------------------------*13680091
136900 2310-GET-NEXT-SET.                                               13690091
137000                                                                  13700091
137100     ADD +1                        TO ASC-SEL-SUB.                13710091
137200     IF  ASC-SEL-SUB > PO077-MAX-ITEMS                            13720091
137300         ADD +1                    TO ASC-SEL-ITEM                13730091
137400         MOVE +1                   TO ASC-SEL-SUB                 13740091
137500     END-IF.                                                      13750091
137600                                                                  13760091
137700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                13770091
137800         PERFORM 9100-READ-SEL-QUEUE                              13780091
137900         IF  PO077-ITEM (ASC-SEL-SUB) > ZERO                      13790091
138000             MOVE PO077-SHORT-NME (ASC-SEL-SUB)                   13800091
138100                                   TO ASC-KEY-SHORT-NME           13810091
138200             MOVE PO077-YEAR (ASC-SEL-SUB)                        13820091
138300                                   TO ASC-KEY-YEAR                13830091
138400             SET PO077-INQ (ASC-SEL-SUB)                          13840091
138500                                   TO TRUE                        13850091
138600             PERFORM 9200-REWRITE-SEL-QUEUE                       13860091
138700         ELSE                                                     13870091
138800             SUBTRACT +1 FROM ASC-SEL-SUB                         13880091
138900*            --- BOTTOM OF LIST ---                               13890091
139000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13900091
139100             SET DP020-MSG-INFORMATIONAL                          13910091
139200                                   TO TRUE                        13920091
139300         END-IF                                                   13930091
139400     ELSE                                                         13940091
139500         SUBTRACT +1 FROM ASC-SEL-ITEM                            13950091
139600         MOVE PO077-MAX-ITEMS      TO ASC-SEL-SUB                 13960091
139700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13970091
139800         SET DP020-MSG-INFORMATIONAL                              13980091
139900                                   TO TRUE                        13990091
140000     END-IF.                                                      14000091
140100                                                                  14010091
140200 EJECT                                                            14020091
140300*----------------------------------------------------------------*14030091
140400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *14040091
140500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *14050091
140600*----------------------------------------------------------------*14060091
140700 3000-EDIT-DATA-IN-COMMAREA.                                      14070091
140800                                                                  14080091
140900     SET PS-NO-ERROR               TO TRUE.                       14090091
141000                                                                  14100091
141100     PERFORM 3200-RESET-ATTRIBUTES.                               14110091
141200                                                                  14120091
141300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14130091
141400**                                                                14140091
141500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14150091
141600* EDITTING IS DONE FROM THE BOTTOM UP.                            14160091
141700**                                                                14170091
141800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14180091
141900         ASC-ITEMS-DISPLAYED - 1.                                 14190091
142000                                                                  14200091
142100     PERFORM 3100-SET-SUBSCRIPTS.                                 14210091
142200     PERFORM 3300-EDIT-SELECTIONS                                 14220091
142300         VARYING PV-SUB                                           14230091
142400         FROM PV-SUB BY -1                                        14240091
142500         UNTIL PV-SUB < +1                                        14250091
142600                                                                  14260091
142700     IF  PS-NO-ERROR                                              14270091
142800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14280091
142900     END-IF.                                                      14290091
143000                                                                  14300091
143100     IF  ((PS-NO-ERROR)                                           14310091
143200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14320091
143300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14330091
143400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14340091
143500     END-IF.                                                      14350091
143600                                                                  14360091
143700 EJECT                                                            14370091
143800*----------------------------------------------------------------*14380091
143900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14390091
144000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14400091
144100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14410091
144200*                                                                *14420091
144300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14430091
144400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14440091
144500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14450091
144600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14460091
144700*----------------------------------------------------------------*14470091
144800                                                                  14480091
144900 3100-SET-SUBSCRIPTS.                                             14490091
145000                                                                  14500091
145100     COMPUTE ASC-ITEM-SUB =                                       14510091
145200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14520091
145300                                                                  14530091
145400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14540091
145500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14550091
145600                                                                  14560091
145700         MOVE PC-MAX-BLOCKS-IN-ARRAY                              14570091
145800                                   TO ASC-BLK-SUB                 14580091
145900     ELSE                                                         14590091
146000         MOVE +1                   TO ASC-BLK-SUB                 14600091
146100     END-IF.                                                      14610091
146200                                                                  14620091
146300*----------------------------------------------------------------*14630091
146400*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14640091
146500*----------------------------------------------------------------*14650091
146600                                                                  14660091
146700 3200-RESET-ATTRIBUTES.                                           14670091
146800                                                                  14680091
146900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14690091
147000     MOVE DP015-GREEN              TO ASTRTITC.                   14700091
147100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14710091
147200                                                                  14720091
147300     IF DP020-NEXT-ACT-RETURN                                     14730091
147400     OR DP020-NEXT-ACT-READ-MAP                                   14740091
147500        PERFORM                                                   14750091
147600            VARYING PV-SUB                                        14760091
147700            FROM 1 BY 1                                           14770091
147800            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    14780091
147900            MOVE DP015-UNP-ALP-NOR-OFF                            14790091
148000                                      TO MR-SELECTA (PV-SUB)      14800091
148100            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14810091
148200            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14820091
148300        END-PERFORM                                               14830091
148400     ELSE                                                         14840091
148500        PERFORM                                                   14850091
148600            VARYING PV-SUB                                        14860091
148700            FROM 1 BY 1                                           14870091
148800            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     14880091
148900            MOVE DP015-UNP-ALP-NOR-OFF                            14890091
149000                                      TO MR-SELECTA (PV-SUB)      14900091
149100            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14910091
149200            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14920091
149300        END-PERFORM                                               14930091
149400     END-IF.                                                      14940091
149500                                                                  14950091
149600 EJECT                                                            14960091
149700*----------------------------------------------------------------*14970091
149800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14980091
149900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14990091
150000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *15000091
150100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *15010091
150200*----------------------------------------------------------------*15020091
150300 3300-EDIT-SELECTIONS.                                            15030091
150400                                                                  15040091
150500     EVALUATE TRUE                                                15050091
150600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15060091
150700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15070091
150800                 CONTINUE                                         15080091
150900                                                                  15090091
151000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15100091
151100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15110091
151200                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15120091
151300                 MOVE ASC-TEMP-SELECTED-SW                        15130091
151400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15140091
151500                                   TO ASC-SELECTED-SW             15150091
151600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15160091
151700             END-IF                                               15170099
151800                                                                  15180091
151900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15190091
152000                 = SPACE                                          15200091
152100             EVALUATE TRUE                                        15210091
152200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15220091
152300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15230091
152400                     MOVE SPACE    TO ASC-SELECTED-SW             15240091
152500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15250091
152600                                                                  15260091
152700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15270091
152800                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 15280091
152900                     MOVE SPACE    TO ASC-SELECTED-SW             15290091
153000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15300091
153100                                                                  15310091
153200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15320091
153300                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   15330091
153400                     MOVE SPACE    TO ASC-SELECTED-SW             15340091
153500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15350091
153600             END-EVALUATE                                         15360091
153700                                                                  15370091
153800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15380091
153900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15390091
154000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15400091
154100             END-IF                                               15410091
154200             PERFORM 3310-EDIT-RANGE                              15420091
154300                                                                  15430091
154400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15440091
154500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15450091
154600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15460091
154700             END-IF                                               15470091
154800             PERFORM 3310-EDIT-RANGE                              15480091
154900                                                                  15490091
155000         WHEN OTHER                                               15500091
155100             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            15510091
155200             SET DP020-MSG-FATAL   TO TRUE                        15520091
155300             MOVE -1               TO MR-SELECTL (PV-SUB)         15530091
155400             SET DP030-SET-CURSOR-APPL-1                          15540091
155500                                   TO TRUE                        15550091
155600             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         15560091
155700             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         15570091
155800             SET PS-ERROR          TO TRUE                        15580091
155900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15590091
156000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15600091
156100                 MOVE SPACE        TO ASC-SELECTED-SW             15610091
156200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15620091
156300             END-IF                                               15630091
156400     END-EVALUATE.                                                15640091
156500                                                                  15650091
156600     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             15660091
156700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15670091
156800                                                                  15680091
156900     IF  ASC-ITEM-SUB < 1                                         15690091
157000         SUBTRACT +1 FROM ASC-BLK-SUB                             15700091
157100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15710091
157200     END-IF.                                                      15720091
157300                                                                  15730091
157400*----------------------------------------------------------------*15740091
157500*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15750091
157600*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15760091
157700*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15770091
157800*  THE ENDING.                                                   *15780091
157900*----------------------------------------------------------------*15790091
158000 3310-EDIT-RANGE.                                                 15800091
158100                                                                  15810091
158200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15820091
158300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15830091
158400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15840091
158500                                   TO ASC-SELECTED-SW             15850091
158600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15860091
158700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15870091
158800         ELSE                                                     15880091
158900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15890091
159000                 CONTINUE                                         15900091
159100             ELSE                                                 15910091
159200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15920091
159300                 MOVE PC-TSYMSG-00054                             15930091
159400                                   TO DP020-MSG-NUMBER            15940091
159500                 SET DP020-MSG-FATAL                              15950091
159600                                   TO TRUE                        15960091
159700                 MOVE -1           TO MR-SELECTL (PV-SUB)         15970091
159800                 SET DP030-SET-CURSOR-APPL-1                      15980091
159900                                   TO TRUE                        15990091
160000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16000091
160100                 MOVE DP015-UNDERLINE                             16010091
160200                                   TO MR-SELECTH (PV-SUB)         16020091
160300                 SET PS-ERROR      TO TRUE                        16030091
160400             END-IF                                               16040091
160500         END-IF                                                   16050091
160600     ELSE                                                         16060091
160700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16070091
160800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16080091
160900                                   TO ASC-SELECTED-SW             16090091
161000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16100091
161100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16110091
161200         ELSE                                                     16120091
161300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16130091
161400                 CONTINUE                                         16140091
161500             ELSE                                                 16150091
161600*                -- ONLY ONE END-OF-RANGE ALLOWED --              16160091
161700                 MOVE PC-TSYMSG-00055                             16170091
161800                                   TO DP020-MSG-NUMBER            16180091
161900                 SET DP020-MSG-FATAL                              16190091
162000                                   TO TRUE                        16200091
162100                 MOVE -1           TO MR-SELECTL (PV-SUB)         16210091
162200                 SET DP030-SET-CURSOR-APPL-1                      16220091
162300                                   TO TRUE                        16230091
162400                 SET PS-ERROR      TO TRUE                        16240091
162500             END-IF                                               16250091
162600         END-IF                                                   16260091
162700     END-IF.                                                      16270091
162800                                                                  16280091
162900*----------------------------------------------------------------*16290091
163000*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *16300091
163100*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *16310091
163200*----------------------------------------------------------------*16320091
163300 3400-CHECK-RANGE-SEQUENCE.                                       16330091
163400                                                                  16340091
163500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16350091
163600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16360091
163700       AND  ASC-START-OF-SELECTED-RANGE >                         16370091
163800                                         ASC-END-OF-SELECTED-RANGE16380091
163900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16390091
164000         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            16400091
164100         SET DP020-MSG-FATAL       TO TRUE                        16410091
164200         SET PS-ERROR              TO TRUE                        16420091
164300         PERFORM 3410-POSITION-AT-ERROR                           16430091
164400     END-IF.                                                      16440091
164500                                                                  16450091
164600*----------------------------------------------------------------*16460091
164700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16470091
164800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16480091
164900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16490091
165000*----------------------------------------------------------------*16500091
165100 3410-POSITION-AT-ERROR.                                          16510091
165200                                                                  16520091
165300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16530091
165400                                                                  16540091
165500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16550091
165600                    - PV-TOP-ITEM + 1.                            16560091
165700                                                                  16570091
165800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16580091
165900         CONTINUE                                                 16590091
166000     ELSE                                                         16600091
166100         MOVE -1                   TO MR-SELECTL (PV-SUB)         16610091
166200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16620091
166300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16630091
166400     END-IF.                                                      16640091
166500                                                                  16650091
166600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16660091
166700                    - PV-TOP-ITEM + 1.                            16670091
166800                                                                  16680091
166900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16690091
167000         CONTINUE                                                 16700091
167100     ELSE                                                         16710091
167200         MOVE -1                   TO MR-SELECTL (PV-SUB)         16720091
167300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16730091
167400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16740091
167500     END-IF.                                                      16750091
167600                                                                  16760091
167700 EJECT                                                            16770091
167800*----------------------------------------------------------------*16780091
167900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16790091
168000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16800091
168100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16810091
168200*----------------------------------------------------------------*16820091
168300                                                                  16830091
168400 3500-MARK-RANGE-AS-SELECTED.                                     16840091
168500                                                                  16850091
168600     MOVE +1                       TO ASC-BLK-SUB.                16860091
168700                                                                  16870091
168800     PERFORM 3510-MARK-SELECTED-INDS                              16880091
168900         VARYING ASC-ITEM-SUB                                     16890091
169000         FROM 1 BY 1                                              16900091
169100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16910091
169200                                                                  16920091
169300     ADD +1                        TO ASC-BLK-SUB.                16930091
169400                                                                  16940091
169500     PERFORM 3510-MARK-SELECTED-INDS                              16950091
169600         VARYING ASC-ITEM-SUB                                     16960091
169700         FROM 1 BY 1                                              16970091
169800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16980091
169900                                                                  16990091
170000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17000091
170100                                   TO PV-LIST-ITEM-NUMBER.        17010091
170200                                                                  17020091
170300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17030091
170400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17040091
170500               PC-ITEMS-PER-PANEL).                               17050091
170600                                                                  17060091
170700     MOVE ASC-START-OF-SELECTED-RANGE                             17070091
170800                                   TO PV-START-OF-SELECTED-RANGE. 17080091
170900                                                                  17090091
171000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17100091
171100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17110091
171200               PC-ITEMS-PER-PANEL).                               17120091
171300                                                                  17130091
171400     MOVE ASC-END-OF-SELECTED-RANGE                               17140091
171500                                   TO PV-END-OF-SELECTED-RANGE.   17150091
171600                                                                  17160091
171700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17170091
171800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17180091
171900               PC-ITEMS-PER-PANEL).                               17190091
172000                                                                  17200091
172100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17210091
172200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17220091
172300                                                                  17230091
172400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17240091
172500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17250091
172600         MOVE +1                   TO ASC-BLK-SUB                 17260091
172700         PERFORM 5100-WRITE-TEMP-STORAGE                          17270091
172800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17280091
172900             PV-FIRST-BLOCK-IN-ARRAY - 1                          17290091
173000                                                                  17300091
173100         PERFORM                                                  17310091
173200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17320091
173300                   PV-PREV-BLOCK-IN-ARRAY                         17330091
173400             MOVE PV-FIRST-BLOCK-IN-RANGE                         17340091
173500                                   TO PV-BLOCK-NUMBER             17350091
173600             PERFORM 4410-READ-TEMP-STORAGE                       17360091
173700             PERFORM 3510-MARK-SELECTED-INDS                      17370091
173800                 VARYING ASC-ITEM-SUB                             17380091
173900                 FROM 1 BY 1                                      17390091
174000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17400091
174100             PERFORM 5100-WRITE-TEMP-STORAGE                      17410091
174200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17420091
174300         END-PERFORM                                              17430091
174400                                                                  17440091
174500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17450091
174600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17460091
174700         PERFORM                                                  17470091
174800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17480091
174900                   PV-LAST-BLOCK-IN-RANGE                         17490091
175000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17500091
175100                                   TO PV-BLOCK-NUMBER             17510091
175200             PERFORM 4410-READ-TEMP-STORAGE                       17520091
175300             PERFORM 3510-MARK-SELECTED-INDS                      17530091
175400                 VARYING ASC-ITEM-SUB                             17540091
175500                 FROM 1 BY 1                                      17550091
175600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17560091
175700             PERFORM 5100-WRITE-TEMP-STORAGE                      17570091
175800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17580091
175900         END-PERFORM                                              17590091
176000                                                                  17600091
176100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17610091
176200                                   TO PV-BLOCK-NUMBER             17620091
176300         PERFORM 4410-READ-TEMP-STORAGE                           17630091
176400     END-IF.                                                      17640091
176500                                                                  17650091
176600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17660091
176700                                      ASC-END-OF-SELECTED-RANGE.  17670091
176800                                                                  17680091
176900 EJECT                                                            17690091
177000*----------------------------------------------------------------*17700091
177100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17710091
177200*----------------------------------------------------------------*17720091
177300                                                                  17730091
177400 3510-MARK-SELECTED-INDS.                                         17740091
177500                                                                  17750091
177600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         17760091
177700         ASC-START-OF-SELECTED-RANGE)                             17770091
177800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         17780091
177900         ASC-START-OF-SELECTED-RANGE)                             17790091
178000                                                                  17800091
178100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     17810091
178200             ASC-END-OF-SELECTED-RANGE)                           17820091
178300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     17830091
178400             ASC-END-OF-SELECTED-RANGE)                           17840091
178500                                                                  17850091
178600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17860091
178700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17870091
178800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17880091
178900                                   TO TRUE                        17890091
179000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17900091
179100                                   TO TRUE                        17910091
179200                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17920091
179300             END-IF                                               17930091
179400         END-IF                                                   17940091
179500     END-IF.                                                      17950091
179600                                                                  17960091
179700 EJECT                                                            17970091
179800*----------------------------------------------------------------*17980091
179900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17990091
180000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18000091
180100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18010091
180200*    DISPLAY THE PANEL TO USER.                                  *18020091
180300*----------------------------------------------------------------*18030091
180400                                                                  18040091
180500 4000-BUILD-INITIAL-PANEL.                                        18050091
180600                                                                  18060091
180700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             18070091
180800                ASC-BLOCK-ENTRIES (2).                            18080091
180900                                                                  18090091
181000     MOVE +1                       TO ASC-BLK-SUB                 18100091
181100                                      PV-STRING-POINTER-FROM      18110091
181200                                      PV-STRING-POINTER-WHERE.    18120091
181300                                                                  18130091
181400     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       18140091
181500                                                                  18150091
181600     MOVE +0                       TO ASC-ITEM-SUB                18160091
181700                                      ASC-NUMBER-OF-ITEMS-READ    18170091
181800                                      ASC-NUMBER-OF-SELECTED-ITEMS18180091
181900                                      ASC-HIGHEST-BLOCK-WRITTEN   18190091
182000                                      ASC-START-OF-SELECTED-RANGE 18200091
182100                                      ASC-END-OF-SELECTED-RANGE   18210091
182200                                      ASC-ITEM-AT-TOP-OF-PANEL    18220091
182300                                      ASC-ITEMS-DISPLAYED         18230099
182400                                      ASC-UNIT-ORD-TOT.           18240091
182500                                                                  18250091
182600     MOVE ZERO TO PV-COUNT-ITEMS-READ.                            18260094
182700     PERFORM 4030-OPEN-CURSOR.                                    18270091
182800     PERFORM 4300-READ-ITEMS-FROM-DB.                             18280091
182900     PERFORM 4040-CLOSE-CURSOR.                                   18290091
183000                                                                  18300093
183100     IF PV-COUNT-ITEMS-READ > PC-PO027-CS102-PO-TABLE-MAX         18310093
183200       SET DP020-MSG-INFORMATIONAL TO TRUE                        18320094
183300       MOVE PC-TSYMSG-02670 TO DP020-MSG-NUMBER                   18330094
183400       MOVE PC-PO027-CS102-PO-TABLE-MAX TO PV-MSG-TEXT            18340094
183500       MOVE PV-MSG-TEXT TO DP020-MSG-TEXT                         18350094
183600     END-IF.                                                      18360093
183700                                                                  18370091
183800     MOVE +1                       TO PV-TOP-ITEM.                18380091
183900                                                                  18390091
184000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18400091
184100         SET DP020-MSG-WARNING     TO TRUE                        18410091
184200         MOVE PC-TSYMSG-02044      TO DP020-MSG-NUMBER            18420091
184300         PERFORM 4100-FORMAT-EMPTY-SCREEN                         18430091
184400             VARYING PV-SUB FROM +1 BY +1                         18440091
184500                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                18450091
184600     ELSE                                                         18460091
184700         MOVE -1                   TO MR-SELECTL (1)              18470091
184800         SET DP030-SET-CURSOR-APPL-1                              18480091
184900                                   TO TRUE                        18490091
185000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18500091
185100     END-IF.                                                      18510091
185200                                                                  18520091
185300 EJECT                                                            18530091
185400*----------------------------------------------------------------*18540091
185500* OPEN THE PO CURSOR                                             *18550091
185600*----------------------------------------------------------------*18560091
185700                                                                  18570091
185800 4030-OPEN-CURSOR.                                                18580091
185900                                                                  18590091
186000     PERFORM                                                      18600091
186100         WITH TEST AFTER                                          18610091
186200         VARYING PV-RETRY-COUNTER                                 18620091
186300         FROM 1 BY 1                                              18630091
186400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18640091
186500            OR (SQLCODE = +0))                                    18650091
186600                                                                  18660091
186700         EXEC SQL                                                 18670091
186800             OPEN PO-CSR                                          18680091
186900         END-EXEC                                                 18690091
187000                                                                  18700091
187100         EVALUATE TRUE                                            18710091
187200             WHEN SQLCODE = +0                                    18720091
187300                  CONTINUE                                        18730091
187400             WHEN SQLCODE = -904                                  18740091
187500             WHEN SQLCODE = -913                                  18750091
187600                  CONTINUE                                        18760091
187700             WHEN SQLWARN0 NOT = SPACE                            18770091
187800             WHEN SQLCODE  NOT = +0                               18780091
187900                  MOVE '4030-OPEN-CURSOR'                         18790091
188000                                   TO DP013-PARAGRAPH             18800091
188100                  MOVE 'OPEN PO-CSR CURSOR'                       18810091
188200                                   TO DP013-MESSAGE-TEXT (1)      18820091
188300                  MOVE SQLCA       TO DP013-SQLCA                 18830091
188400                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    18840091
188500                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (2)    18850091
188600                  SET DP013-DB2-ABEND                             18860091
188700                                   TO TRUE                        18870091
188800                  PERFORM DP013-0000-PROCESS-ABEND                18880091
188900         END-EVALUATE                                             18890091
189000     END-PERFORM.                                                 18900091
189100                                                                  18910091
189200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18920091
189300         MOVE '4030-OPEN-CURSOR'   TO DP013-PARAGRAPH             18930091
189400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              18940091
189500                                   TO DP013-MESSAGE-TEXT (1)      18950091
189600         MOVE SQLCA                TO DP013-SQLCA                 18960091
189700         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    18970091
189800         MOVE 'TPLNSHP'            TO DP013-DB2-TABLE-NAME (2)    18980091
189900         SET DP013-DB2-ABEND       TO TRUE                        18990091
190000         PERFORM DP013-0000-PROCESS-ABEND                         19000091
190100     END-IF.                                                      19010091
190200                                                                  19020091
190300 EJECT                                                            19030091
190400*----------------------------------------------------------------*19040091
190500* CLOSE THE PO CURSOR                                            *19050091
190600*----------------------------------------------------------------*19060091
190700                                                                  19070091
190800 4040-CLOSE-CURSOR.                                               19080091
190900                                                                  19090091
191000     EXEC SQL                                                     19100091
191100         CLOSE PO-CSR                                             19110091
191200     END-EXEC.                                                    19120091
191300                                                                  19130091
191400     EVALUATE TRUE                                                19140091
191500         WHEN SQLCODE = +0                                        19150091
191600              CONTINUE                                            19160091
191700         WHEN SQLWARN0 NOT = SPACE                                19170091
191800         WHEN SQLCODE  NOT = +0                                   19180091
191900              MOVE '4040-CLOSE-CURSOR'                            19190091
192000                                   TO DP013-PARAGRAPH             19200091
192100              MOVE 'CLOSE PO-CSR CURSOR'                          19210091
192200                                   TO DP013-MESSAGE-TEXT (1)      19220091
192300              MOVE SQLCA           TO DP013-SQLCA                 19230091
192400              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    19240091
192500              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (2)    19250091
192600              SET DP013-DB2-ABEND  TO TRUE                        19260091
192700              PERFORM DP013-0000-PROCESS-ABEND                    19270091
192800     END-EVALUATE.                                                19280091
192900                                                                  19290091
193000 EJECT                                                            19300091
193100                                                                  19310091
193200*----------------------------------------------------------------*19320091
193300* FORMAT EMPTY SCREEN WHEN NO DATA EXIST FOR PO SET.             *19330091
193400*----------------------------------------------------------------*19340091
193500 4100-FORMAT-EMPTY-SCREEN.                                        19350091
193600                                                                  19360091
193700     MOVE DP015-PRO-DRK-OFF      TO MR-SELECTA (PV-SUB).          19370091
193800     MOVE SPACES                 TO MR-SELECT  (PV-SUB)           19380091
193900                                    MR-PO-NBR-X (PV-SUB)          19390091
194000                                    MR-DEPT-NBR (PV-SUB)          19400091
194100                                    MR-VENDOR-NAME (PV-SUB)       19410091
194200                                    MR-STATUS (PV-SUB)            19420091
194300                                    MR-OTB (PV-SUB)               19430091
194400                                    MR-SHIP-DATE (PV-SUB)         19440091
194500                                    MR-CANCEL-DATE (PV-SUB)       19450091
194600                                    MR-UNITS-ORDERED-X (PV-SUB).  19460091
194700                                                                  19470091
194800 EJECT                                                            19480091
194900*----------------------------------------------------------------*19490091
195000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19500091
195100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19510091
195200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19520091
195300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19530091
195400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19540091
195500*                                                                *19550091
195600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19560091
195700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19570091
195800*    UPON INITIALIZATION.                                        *19580091
195900*----------------------------------------------------------------*19590091
196000                                                                  19600091
196100 4300-READ-ITEMS-FROM-DB.                                         19610091
196200                                                                  19620091
196300     PERFORM                                                      19630091
196400         VARYING PV-READ-COUNT                                    19640091
196500         FROM 1 BY 1                                              19650091
196600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19660091
196700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19670091
196800                                                                  19680091
196900         PERFORM 4310-FETCH                                       19690091
197000                                                                  19700091
197100         IF  ASC-ITEMS-LEFT-ON-DB                                 19710091
197200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19720091
197300                 ADD +1            TO ASC-ITEM-SUB                19730091
197400             ELSE                                                 19740091
197500                 ADD +1            TO ASC-BLK-SUB                 19750091
197600                 MOVE +1           TO ASC-ITEM-SUB                19760091
197700                                                                  19770091
197800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19780091
197900                     MOVE +1       TO ASC-BLK-SUB                 19790091
198000                     SET ASC-BLOCK-MODIFIED (1)                   19800091
198100                                   TO TRUE                        19810091
198200                     PERFORM 5100-WRITE-TEMP-STORAGE              19820091
198300                     MOVE ASC-BLOCK-ENTRIES                       19830091
198400                               (PC-MAX-BLOCKS-IN-ARRAY)           19840091
198500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19850091
198600                     ADD +1        TO ASC-BLK-SUB                 19860091
198700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19870091
198800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19880091
198900                                   TO TRUE                        19890091
199000                 END-IF                                           19900091
199100             END-IF                                               19910091
199200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19920091
199300             MOVE ASC-NUMBER-OF-ITEMS-READ                        19930091
199400                                   TO ASC-LIST-ITEM-NUMBER        19940091
199500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19950091
199600             MOVE PURCHS-PO-NBR    TO ASC-PO-NBR                  19960091
199700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19970091
199800             PERFORM 4320-GET-PO-INFO                             19980091
199900             IF ENTNME-ENT-ID NOT = PURCHS-ENT-ID                 19990091
200000                PERFORM 4330-GET-VENDOR-SHORT-NAME                20000091
200100                IF  SQLCODE = +100                                20010091
200200                    PERFORM 4335-GET-VENDOR-PRIMARY-NAME          20020091
200300                END-IF                                            20030091
200400             END-IF                                               20040091
200500             PERFORM 4340-GET-SHIPMENT-INFO                       20050091
200600                                                                  20060091
200700             MOVE PURCHS-DEPT-NBR  TO ASC-DEPT-NBR                20070091
200800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20080091
200900             MOVE ENTNME-ENT-NAME-DESC                            20090091
201000                                   TO ASC-VENDOR-NAME             20100091
201100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20110091
201200             MOVE PURCHS-STATUS-CDE                               20120091
201300                                   TO ASC-STATUS                  20130091
201400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20140091
201500             STRING PURCHS-OTB-PER-NBR(5:2) DELIMITED BY SIZE     20150091
201600                    PURCHS-OTB-PER-NBR(3:2) DELIMITED BY SIZE     20160091
201700                                 INTO ASC-OTB                     20170091
201800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20180091
201900             MOVE PV-DONT-SHIP-BEF-DTE                            20190091
202000                                   TO ASC-SHIP-DATE               20200091
202100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20210091
202200             MOVE PV-CAN-IFNOT-SHIP-DTE                           20220091
202300                                   TO ASC-CANCEL-DATE             20230091
202400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20240091
202500             MOVE PURCHS-TOT-UNT-QTY                              20250091
202600                                   TO ASC-TOT-UNIT-ORDERED        20260091
202700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20270091
202800                                                                  20280091
202900                                                                  20290091
203000                                                                  20300091
203100             COMPUTE ASC-UNIT-ORD-TOT = ASC-UNIT-ORD-TOT +        20310091
203200                   ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)20320091
203300                                                                  20330091
203400         END-IF                                                   20340091
203500     END-PERFORM.                                                 20350091
203600                                                                  20360091
203700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20370091
203800         MOVE +1                   TO ASC-BLK-SUB                 20380091
203900         PERFORM 5100-WRITE-TEMP-STORAGE                          20390091
204000         ADD +1                    TO ASC-BLK-SUB                 20400091
204100         PERFORM 5100-WRITE-TEMP-STORAGE                          20410091
204200                                                                  20420091
204300         MOVE 1                    TO ASC-BLK-SUB                 20430091
204400                                      PV-BLOCK-NUMBER             20440091
204500         PERFORM 4410-READ-TEMP-STORAGE                           20450091
204600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20460091
204700             MOVE 2                TO ASC-BLK-SUB                 20470091
204800                                      PV-BLOCK-NUMBER             20480091
204900             PERFORM 4410-READ-TEMP-STORAGE                       20490091
205000         END-IF                                                   20500091
205100     END-IF.                                                      20510091
205200                                                                  20520091
205300 EJECT                                                            20530091
205400*----------------------------------------------------------------*20540091
205500*    FETCH A VENDOR ROW                                          *20550091
205600*----------------------------------------------------------------*20560091
205700                                                                  20570091
205800 4310-FETCH.                                                      20580091
205900                                                                  20590091
206000     EXEC SQL                                                     20600091
206100         FETCH PO-CSR                                             20610091
206200          INTO :PURCHS-PO-NBR,                                    20620091
206300               :PURCHS-OTB-PER-NBR,                               20630091
206400               :PURCHS-DEPT-NBR,                                  20640091
206500               :PURCHS-ENT-ID,                                    20650091
206600               :PLNSHP-DONT-SHIP-BEF-DTE                          20660091
206700     END-EXEC.                                                    20670091
206800                                                                  20680091
206900     EVALUATE TRUE                                                20690091
207000         WHEN SQLCODE = +0                                        20700091
207100              ADD 1 TO PV-COUNT-ITEMS-READ                        20710094
207200         WHEN SQLCODE = +100                                      20720091
207300              SET ASC-NO-ITEMS-LEFT-ON-DB                         20730091
207400                                   TO TRUE                        20740091
207500         WHEN SQLWARN0 NOT = SPACE                                20750091
207600         WHEN SQLCODE < +0                                        20760091
207700         WHEN SQLCODE > +0                                        20770091
207800              MOVE '4310-FETCH-CURSOR'                            20780091
207900                                   TO DP013-PARAGRAPH             20790091
208000              MOVE 'FETCH PO CURSOR'                              20800091
208100                                   TO DP013-MESSAGE-TEXT (1)      20810091
208200              MOVE SQLCA           TO DP013-SQLCA                 20820091
208300              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    20830091
208400              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (2)    20840091
208500              SET DP013-DB2-ABEND  TO TRUE                        20850091
208600              PERFORM DP013-0000-PROCESS-ABEND                    20860091
208700     END-EVALUATE.                                                20870091
208800                                                                  20880091
208900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20890091
209000         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             20900091
209100         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             20910091
209200                                   TO DP013-MESSAGE-TEXT (1)      20920091
209300         MOVE SQLCA                TO DP013-SQLCA                 20930091
209400         SET DP013-DB2-ABEND                                      20940091
209500             DP013-XCTL-DISPLAY-RESTART                           20950091
209600                                   TO TRUE                        20960091
209700         PERFORM DP013-0000-PROCESS-ABEND                         20970091
209800     END-IF.                                                      20980091
209900                                                                  20990091
210000 EJECT                                                            21000091
210100*----------------------------------------------------------------*21010091
210200* GET PO INFORMATION                                             *21020091
210300*----------------------------------------------------------------*21030091
210400                                                                  21040091
210500 4320-GET-PO-INFO.                                                21050091
210600                                                                  21060091
210700     EXEC SQL                                                     21070091
210800         SELECT DEPT_NBR                                          21080091
210900               ,OTB_PER_NBR                                       21090091
211000               ,STATUS_CDE                                        21100091
211100               ,TOT_VAL_RTL_AMT                                   21110091
211200               ,TOT_UNT_QTY                                       21120091
211300               ,ENT_ID                                            21130091
211400          INTO  :PURCHS-DEPT-NBR                                  21140091
211500               ,:PURCHS-OTB-PER-NBR                               21150091
211600               ,:PURCHS-STATUS-CDE                                21160091
211700               ,:PURCHS-TOT-VAL-RTL-AMT                           21170091
211800               ,:PURCHS-TOT-UNT-QTY                               21180091
211900               ,:PURCHS-ENT-ID                                    21190091
212000          FROM  TPURCHS                                           21200091
212100          WHERE PO_NBR         = :PURCHS-PO-NBR                   21210091
212200            AND VER_STATUS_CDE = 'A'                              21220091
212300            AND PO_CATEG_CDE   = 'MR'                             21230091
212400     END-EXEC.                                                    21240091
212500                                                                  21250091
212600     EVALUATE TRUE                                                21260091
212700         WHEN SQLCODE = +0                                        21270091
212800         WHEN SQLCODE = -904                                      21280091
212900         WHEN SQLCODE = -913                                      21290091
213000             CONTINUE                                             21300091
213100         WHEN SQLWARN0 NOT = SPACE                                21310091
213200         WHEN SQLCODE < +0                                        21320091
213300         WHEN SQLCODE > +0                                        21330091
213400             MOVE '4320-GET-PO-INFO'                              21340091
213500                                 TO DP013-PARAGRAPH               21350091
213600             MOVE 'SELECT ON PURCHASE HEADER TABLE'               21360091
213700                                 TO DP013-MESSAGE-TEXT (1)        21370091
213800             MOVE SQLCA          TO DP013-SQLCA                   21380091
213900             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      21390091
214000                 SET DP013-DB2-ABEND                              21400091
214100                     DP013-XCTL-DISPLAY-RESTART                   21410091
214200                                 TO TRUE                          21420091
214300             PERFORM DP013-0000-PROCESS-ABEND                     21430091
214400     END-EVALUATE.                                                21440091
214500                                                                  21450091
214600 EJECT                                                            21460091
214700*----------------------------------------------------------------*21470091
214800* GET THE VENDOR SHORT NAME                                      *21480091
214900*----------------------------------------------------------------*21490091
215000                                                                  21500091
215100 4330-GET-VENDOR-SHORT-NAME.                                      21510091
215200                                                                  21520091
215300     EXEC SQL                                                     21530091
215400         SELECT ENT_NAME_DESC                                     21540091
215500              , ENT_ID                                            21550091
215600          INTO  :ENTNME-ENT-NAME-DESC                             21560091
215700              , :ENTNME-ENT-ID                                    21570091
215800          FROM  TENTNME                                           21580091
215900          WHERE ENT_ID   = :PURCHS-ENT-ID                         21590091
216000            AND TYPE_CDE = '04'                                   21600091
216100     END-EXEC.                                                    21610091
216200                                                                  21620091
216300     EVALUATE TRUE                                                21630091
216400         WHEN SQLCODE = +0                                        21640091
216500         WHEN SQLCODE = +100                                      21650091
216600         WHEN SQLCODE = -904                                      21660091
216700         WHEN SQLCODE = -913                                      21670091
216800             CONTINUE                                             21680091
216900         WHEN SQLWARN0 NOT = SPACE                                21690091
217000         WHEN SQLCODE < +0                                        21700091
217100         WHEN SQLCODE > +0                                        21710091
217200             MOVE '4330-GET-VENDOR-SHORT-NAME'                    21720091
217300                                 TO DP013-PARAGRAPH               21730091
217400             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               21740091
217500                                 TO DP013-MESSAGE-TEXT (1)        21750091
217600             MOVE SQLCA          TO DP013-SQLCA                   21760091
217700             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      21770091
217800                 SET DP013-DB2-ABEND                              21780091
217900                     DP013-XCTL-DISPLAY-RESTART                   21790091
218000                                 TO TRUE                          21800091
218100             PERFORM DP013-0000-PROCESS-ABEND                     21810091
218200     END-EVALUATE.                                                21820091
218300                                                                  21830091
218400 EJECT                                                            21840091
218500*----------------------------------------------------------------*21850091
218600* GET THE VENDOR PRIMARY NAME                                    *21860091
218700*----------------------------------------------------------------*21870091
218800                                                                  21880091
218900 4335-GET-VENDOR-PRIMARY-NAME.                                    21890091
219000                                                                  21900091
219100     EXEC SQL                                                     21910091
219200         SELECT ENT_NAME_DESC                                     21920091
219300              , ENT_ID                                            21930091
219400          INTO  :ENTNME-ENT-NAME-DESC                             21940091
219500              , :ENTNME-ENT-ID                                    21950091
219600          FROM  TENTNME                                           21960091
219700          WHERE ENT_ID   = :PURCHS-ENT-ID                         21970091
219800            AND TYPE_CDE = '01'                                   21980091
219900     END-EXEC.                                                    21990091
220000                                                                  22000091
220100     EVALUATE TRUE                                                22010091
220200         WHEN SQLCODE = +0                                        22020091
220300         WHEN SQLCODE = -904                                      22030091
220400         WHEN SQLCODE = -913                                      22040091
220500             CONTINUE                                             22050091
220600         WHEN SQLWARN0 NOT = SPACE                                22060091
220700         WHEN SQLCODE < +0                                        22070091
220800         WHEN SQLCODE > +0                                        22080091
220900             MOVE '4335-GET-VENDOR-PRIMARY-NAME'                  22090091
221000                                 TO DP013-PARAGRAPH               22100091
221100             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               22110091
221200                                 TO DP013-MESSAGE-TEXT (1)        22120091
221300             MOVE SQLCA          TO DP013-SQLCA                   22130091
221400             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      22140091
221500                 SET DP013-DB2-ABEND                              22150091
221600                     DP013-XCTL-DISPLAY-RESTART                   22160091
221700                                 TO TRUE                          22170091
221800             PERFORM DP013-0000-PROCESS-ABEND                     22180091
221900     END-EVALUATE.                                                22190091
222000                                                                  22200091
222100 EJECT                                                            22210091
222200*----------------------------------------------------------------*22220091
222300* GET PLANNED SHIPMENT INFO                                      *22230091
222400*----------------------------------------------------------------*22240091
222500                                                                  22250091
222600 4340-GET-SHIPMENT-INFO.                                          22260091
222700                                                                  22270091
222800     EXEC SQL                                                     22280091
222900         SELECT DONT_SHIP_BEF_DTE                                 22290091
223000               ,CAN_IFNOT_SHIP_DTE                                22300091
223100          INTO  :PLNSHP-DONT-SHIP-BEF-DTE                         22310091
223200               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        22320091
223300          FROM  TPLNSHP                                           22330091
223400          WHERE PO_NBR          = :PURCHS-PO-NBR                  22340091
223500            AND VER_STATUS_CDE  = 'A'                             22350091
223600     END-EXEC.                                                    22360091
223700                                                                  22370091
223800     EVALUATE TRUE                                                22380091
223900         WHEN SQLCODE = +0                                        22390091
224000              IF  PLNSHP-DONT-SHIP-BEF-DTE > SPACES               22400091
224100              AND PLNSHP-DONT-SHIP-BEF-DTE NOT = '0001-01-01'     22410091
224200                  MOVE PLNSHP-DONT-SHIP-BEF-DTE                   22420091
224300                                       TO PV-DB2-DATE             22430091
224400                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      22440091
224500                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      22450091
224600                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      22460091
224700                  MOVE PV-DISPLAY-DATE TO PV-DONT-SHIP-BEF-DTE    22470091
224800              ELSE                                                22480091
224900                  MOVE SPACES          TO PV-DONT-SHIP-BEF-DTE    22490091
225000              END-IF                                              22500091
225100              IF  PLNSHP-CAN-IFNOT-SHIP-DTE > SPACES              22510091
225200              AND PLNSHP-CAN-IFNOT-SHIP-DTE NOT = '0001-01-01'    22520091
225300                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                  22530091
225400                                       TO PV-DB2-DATE             22540091
225500                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      22550091
225600                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      22560091
225700                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      22570091
225800                  MOVE PV-DISPLAY-DATE TO PV-CAN-IFNOT-SHIP-DTE   22580091
225900              ELSE                                                22590091
226000                  MOVE SPACES          TO PV-CAN-IFNOT-SHIP-DTE   22600091
226100              END-IF                                              22610091
226200                                                                  22620091
226300         WHEN SQLCODE = -904                                      22630091
226400         WHEN SQLCODE = -913                                      22640091
226500             CONTINUE                                             22650091
226600         WHEN SQLWARN0 NOT = SPACE                                22660091
226700         WHEN SQLCODE < +0                                        22670091
226800         WHEN SQLCODE > +0                                        22680091
226900             MOVE '4340-GET-SHIPMENT-INFO'                        22690091
227000                                 TO DP013-PARAGRAPH               22700091
227100             MOVE 'SELECT ON PLANNED SHIPMENTS'                   22710091
227200                                 TO DP013-MESSAGE-TEXT (1)        22720091
227300             MOVE SQLCA          TO DP013-SQLCA                   22730091
227400             MOVE 'TPLNSHP'      TO DP013-DB2-TABLE-NAME (1)      22740091
227500                 SET DP013-DB2-ABEND                              22750091
227600                     DP013-XCTL-DISPLAY-RESTART                   22760091
227700                                 TO TRUE                          22770091
227800             PERFORM DP013-0000-PROCESS-ABEND                     22780091
227900     END-EVALUATE.                                                22790091
228000                                                                  22800091
228100 EJECT                                                            22810091
228200*----------------------------------------------------------------*22820091
228300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22830091
228400*----------------------------------------------------------------*22840091
228500                                                                  22850091
228600 4400-MOVE-COMMAREA-TO-SCREEN.                                    22860091
228700                                                                  22870091
228800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22880091
228900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22890091
229000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22900091
229100             MOVE +1               TO ASC-BLK-SUB                 22910091
229200             PERFORM 5100-WRITE-TEMP-STORAGE                      22920091
229300             ADD +1                TO ASC-BLK-SUB                 22930091
229400             PERFORM 5100-WRITE-TEMP-STORAGE                      22940091
229500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22950091
229600                 GIVING PV-BLOCK-NUMBER                           22960091
229700                 REMAINDER PV-REMAINDER                           22970091
229800             IF  PV-REMAINDER > ZERO                              22980091
229900                 ADD +1            TO PV-BLOCK-NUMBER             22990091
230000             END-IF                                               23000091
230100             MOVE +1               TO ASC-BLK-SUB                 23010091
230200             PERFORM 4410-READ-TEMP-STORAGE                       23020091
230300             ADD +1                TO ASC-BLK-SUB                 23030091
230400                                      PV-BLOCK-NUMBER             23040091
230500             PERFORM 4410-READ-TEMP-STORAGE                       23050091
230600     END-IF.                                                      23060091
230700                                                                  23070091
230800     MOVE +1                       TO ASC-BLK-SUB.                23080091
230900                                                                  23090091
231000     COMPUTE ASC-ITEM-SUB =                                       23100091
231100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23110091
231200         + PC-ITEMS-PER-PANEL).                                   23120091
231300                                                                  23130091
231400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23140091
231500         ADD +1                    TO ASC-BLK-SUB                 23150091
231600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23160091
231700     END-IF.                                                      23170091
231800                                                                  23180091
231900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23190091
232000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23200091
232100                                                                  23210091
232200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23220091
232300     PERFORM 4420-FORMAT-LIST-LINES                               23230091
232400         VARYING PV-SUB                                           23240091
232500         FROM PC-ITEMS-PER-PANEL BY -1                            23250091
232600         UNTIL PV-SUB < +1.                                       23260091
232700                                                                  23270091
232800     COMPUTE ASC-ITEMS-DISPLAYED =                                23280091
232900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23290091
233000                                                                  23300091
233100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23310091
233200                                      ASTRTITO.                   23320091
233300                                                                  23330091
233400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23340091
233500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23350091
233600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23360091
233700                                   TO ASELITO.                    23370091
233800                                                                  23380091
233900     MOVE ASC-UNIT-ORD-TOT         TO MR-UNITS-ORDERED-TOT        23390091
234000                                                                  23400091
234100     IF  DP020-MSG-NUMBER-X = SPACE                               23410091
234200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23420091
234300*            --- MORE ITEMS TO DISPLAY ----                       23430091
234400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23440091
234500             SET DP020-MSG-INFORMATIONAL                          23450091
234600                                   TO TRUE                        23460091
234700         END-IF                                                   23470091
234800     END-IF.                                                      23480091
234900                                                                  23490091
235000*----------------------------------------------------------------*23500091
235100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23510091
235200*----------------------------------------------------------------*23520091
235300                                                                  23530091
235400 4410-READ-TEMP-STORAGE.                                          23540091
235500                                                                  23550091
235600     EXEC CICS                                                    23560091
235700         READQ TS                                                 23570091
235800             QUEUE (ASC-LIST-QUEUE-NAME)                          23580091
235900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23590091
236000             ITEM  (PV-BLOCK-NUMBER)                              23600091
236100             RESP  (PV-CICS-RESP)                                 23610091
236200     END-EXEC.                                                    23620091
236300                                                                  23630091
236400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23640091
236500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23650091
236600         CONTINUE                                                 23660091
236700     ELSE                                                         23670091
236800         SET DP013-CICS-ABEND      TO TRUE                        23680091
236900         SET DP013-NO-ROLLBACK     TO TRUE                        23690091
237000         MOVE '4410-READ-TEMP-STORAGE'                            23700091
237100                                   TO DP013-PARAGRAPH             23710091
237200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23720091
237300                                   TO DP013-MESSAGE-TEXT(1)       23730091
237400         PERFORM DP013-0000-PROCESS-ABEND                         23740091
237500     END-IF.                                                      23750091
237600                                                                  23760091
237700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      23770091
237800                                   TO TRUE.                       23780091
237900                                                                  23790091
238000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23800091
238100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23810091
238200     END-IF.                                                      23820091
238300 EJECT                                                            23830091
238400*----------------------------------------------------------------*23840091
238500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23850091
238600*----------------------------------------------------------------*23860091
238700                                                                  23870091
238800 4420-FORMAT-LIST-LINES.                                          23880091
238900                                                                  23890091
239000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23900091
239100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23910091
239200         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         23920091
239300         MOVE SPACES               TO MR-SELECT  (PV-SUB)         23930091
239400                                      MR-PO-NBR-X (PV-SUB)        23940091
239500                                      MR-DEPT-NBR (PV-SUB)        23950091
239600                                      MR-VENDOR-NAME (PV-SUB)     23960091
239700                                      MR-STATUS (PV-SUB)          23970091
239800                                      MR-OTB (PV-SUB)             23980091
239900                                      MR-SHIP-DATE (PV-SUB)       23990091
240000                                      MR-CANCEL-DATE (PV-SUB)     24000091
240100                                      MR-UNITS-ORDERED-X (PV-SUB) 24010091
240200     ELSE                                                         24020091
240300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24030091
240400                                                   > SPACE        24040091
240500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24050091
240600                                   TO MR-SELECT (PV-SUB)          24060091
240700         ELSE                                                     24070091
240800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24080091
240900                                   TO MR-SELECT (PV-SUB)          24090091
241000         END-IF                                                   24100091
241100                                                                  24110091
241200         IF  DP030-SET-CURSOR-TRAILER                             24120091
241300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24130091
241400                 > SPACE)                                         24140091
241500               OR (PV-SUB = 1))                                   24150091
241600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24160091
241700                MOVE -1            TO MR-SELECTL (PV-SUB)         24170091
241800             END-IF                                               24180091
241900         END-IF                                                   24190091
242000                                                                  24200091
242100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24210091
242200             MOVE DP015-UNP-ALP-NOR-OFF                           24220091
242300                                      TO MR-SELECTA (PV-SUB)      24230091
242400             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           24240091
242500                                   TO MR-PO-NBR (PV-SUB)          24250091
242600             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         24260091
242700                                   TO MR-DEPT-NBR (PV-SUB)        24270091
242800             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      24280091
242900                                   TO MR-VENDOR-NAME (PV-SUB)     24290091
243000             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           24300091
243100                                   TO MR-STATUS (PV-SUB)          24310091
243200             MOVE ASC-OTB (ASC-BLK-SUB ASC-ITEM-SUB)              24320091
243300                                   TO MR-OTB (PV-SUB)             24330091
243400             MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        24340091
243500                                   TO MR-SHIP-DATE (PV-SUB)       24350091
243600             MOVE ASC-CANCEL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      24360091
243700                                   TO MR-CANCEL-DATE (PV-SUB)     24370091
243800         END-IF                                                   24380091
243900                                                                  24390091
244000         MOVE ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)     24400091
244100                                   TO MR-UNITS-ORDERED (PV-SUB)   24410091
244200     END-IF.                                                      24420091
244300                                                                  24430091
244400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               24440091
244500                                                                  24450091
244600     IF  ASC-ITEM-SUB < + 1                                       24460091
244700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                24470091
244800         MOVE +1                   TO ASC-BLK-SUB                 24480091
244900     END-IF.                                                      24490091
245000                                                                  24500091
245100                                                                  24510091
245200*----------------------------------------------------------------*24520091
245300*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *24530091
245400*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *24540091
245500*  ISSUE A WARNING.                                              *24550091
245600*----------------------------------------------------------------*24560091
245700 4430-CHECK-FOR-BEGIN-AND-END.                                    24570091
245800                                                                  24580091
245900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24590091
246000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24600091
246100*            -- NO END-OF-RANGE SPECFIED ---                      24610091
246200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24620091
246300             SET DP020-MSG-WARNING TO TRUE                        24630091
246400             PERFORM 4431-POSITION-AT-WARNING                     24640091
246500         END-IF                                                   24650091
246600     ELSE                                                         24660091
246700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24670091
246800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24680091
246900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24690091
247000             SET DP020-MSG-WARNING TO TRUE                        24700091
247100             PERFORM 4431-POSITION-AT-WARNING                     24710091
247200         END-IF                                                   24720091
247300     END-IF.                                                      24730091
247400                                                                  24740091
247500*----------------------------------------------------------------*24750091
247600*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24760091
247700*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24770091
247800*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24780091
247900*  POSITION THE CURSOR THERE.                                    *24790091
248000*----------------------------------------------------------------*24800091
248100 4431-POSITION-AT-WARNING.                                        24810091
248200                                                                  24820091
248300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24830091
248400                    - PV-TOP-ITEM + 1.                            24840091
248500                                                                  24850091
248600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24860091
248700         CONTINUE                                                 24870091
248800     ELSE                                                         24880091
248900         SET DP030-SET-CURSOR-APPL-1                              24890091
249000                                   TO TRUE                        24900091
249100         MOVE -1                   TO MR-SELECTL (PV-SUB)         24910091
249200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24920091
249300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24930091
249400     END-IF.                                                      24940091
249500                                                                  24950091
249600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24960091
249700                    - PV-TOP-ITEM + 1.                            24970091
249800                                                                  24980091
249900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24990091
250000         CONTINUE                                                 25000091
250100     ELSE                                                         25010091
250200         SET DP030-SET-CURSOR-APPL-1                              25020091
250300                                   TO TRUE                        25030091
250400         MOVE -1                   TO MR-SELECTL (PV-SUB)         25040091
250500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25050091
250600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25060091
250700     END-IF.                                                      25070091
250800                                                                  25080091
250900 EJECT                                                            25090091
251000*----------------------------------------------------------------*25100091
251100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25110091
251200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25120091
251300*----------------------------------------------------------------*25130091
251400                                                                  25140091
251500 5100-WRITE-TEMP-STORAGE.                                         25150091
251600                                                                  25160091
251700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25170091
251800                                   TO PV-LIST-ITEM-NUMBER.        25180091
251900     COMPUTE PV-BLOCK-NUMBER =                                    25190091
252000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25200091
252100                                                                  25210091
252200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25220091
252300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25230091
252400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25240091
252500             PERFORM 5105-REWRITE-ASC-LISTQ                       25250091
252600         END-IF                                                   25260091
252700     ELSE                                                         25270091
252800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25280091
252900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25290091
253000         PERFORM 5110-WRITE-ASC-LISTQ                             25300091
253100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25310091
253200     END-IF.                                                      25320091
253300                                                                  25330091
253400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      25340091
253500                                   TO TRUE.                       25350091
253600 EJECT                                                            25360091
253700*----------------------------------------------------------------*25370091
253800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *25380091
253900*  SPECIFIC COMMAREA.                                            *25390091
254000*----------------------------------------------------------------*25400091
254100 5105-REWRITE-ASC-LISTQ.                                          25410091
254200                                                                  25420091
254300     EXEC CICS                                                    25430091
254400         WRITEQ TS                                                25440091
254500             QUEUE (ASC-LIST-QUEUE-NAME)                          25450091
254600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25460091
254700             ITEM  (PV-BLOCK-NUMBER)                              25470091
254800             REWRITE                                              25480091
254900             RESP  (PV-CICS-RESP)                                 25490091
255000     END-EXEC.                                                    25500091
255100                                                                  25510091
255200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25520091
255300         CONTINUE                                                 25530091
255400     ELSE                                                         25540091
255500         SET DP013-CICS-ABEND      TO TRUE                        25550091
255600         SET DP013-NO-ROLLBACK     TO TRUE                        25560091
255700         MOVE '5105-REWRITE-ASC-LISTQ'                            25570091
255800                                   TO DP013-PARAGRAPH             25580091
255900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25590091
256000                                   TO DP013-MESSAGE-TEXT(1)       25600091
256100         PERFORM DP013-0000-PROCESS-ABEND                         25610091
256200     END-IF.                                                      25620091
256300                                                                  25630091
256400 EJECT                                                            25640091
256500*----------------------------------------------------------------*25650091
256600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *25660091
256700*  SPECIFIC COMMAREA.                                            *25670091
256800*----------------------------------------------------------------*25680091
256900 5110-WRITE-ASC-LISTQ.                                            25690091
257000                                                                  25700091
257100     EXEC CICS                                                    25710091
257200         WRITEQ TS                                                25720091
257300             QUEUE (ASC-LIST-QUEUE-NAME)                          25730091
257400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25740091
257500             ITEM  (PV-BLOCK-NUMBER)                              25750091
257600             RESP  (PV-CICS-RESP)                                 25760091
257700     END-EXEC.                                                    25770091
257800                                                                  25780091
257900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25790091
258000         SET DP013-CICS-ABEND      TO TRUE                        25800091
258100         SET DP013-NO-ROLLBACK     TO TRUE                        25810091
258200         MOVE '5110-WRITE-ASC-LISTQ'                              25820091
258300                                   TO DP013-PARAGRAPH             25830091
258400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25840091
258500                                   TO DP013-MESSAGE-TEXT(1)       25850091
258600         PERFORM DP013-0000-PROCESS-ABEND                         25860091
258700     END-IF.                                                      25870091
258800                                                                  25880091
258900 EJECT                                                            25890091
259000*----------------------------------------------------------------*25900091
259100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25910091
259200*----------------------------------------------------------------*25920091
259300                                                                  25930091
259400 6112-READ-LIST-QUEUE.                                            25940091
259500                                                                  25950091
259600     EXEC CICS                                                    25960091
259700         READQ TS                                                 25970091
259800             QUEUE (ASC-LIST-QUEUE-NAME)                          25980091
259900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25990091
260000             ITEM  (PV-ITEM)                                      26000091
260100             RESP  (PV-CICS-RESP)                                 26010091
260200     END-EXEC.                                                    26020091
260300                                                                  26030091
260400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26040091
260500         CONTINUE                                                 26050091
260600     ELSE                                                         26060091
260700         SET DP013-CICS-ABEND      TO TRUE                        26070091
260800         SET DP013-NO-ROLLBACK     TO TRUE                        26080091
260900         MOVE '6112-READ-LIST-QUEUE'                              26090091
261000                                   TO DP013-PARAGRAPH             26100091
261100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26110091
261200                                   TO DP013-MESSAGE-TEXT(1)       26120091
261300         PERFORM DP013-0000-PROCESS-ABEND                         26130091
261400     END-IF.                                                      26140091
261500                                                                  26150091
261600 EJECT                                                            26160091
261700*----------------------------------------------------------------*26170091
261800* DELETE ALL SELECTED PO'S FROM THE SET LIST USING THE LIST TEMP *26180091
261900* STORAGE QUEUE.  FIRST CHECK THAT THE USER IS AUTHORIZED TO     *26190091
262000* DELETE ALL THE PURCHASE ORDERS SELECTED. IF NO ERRORS ARE      *26200091
262100* FOUND THEN DELETE THE PURCHASE ORDERS FROM THE SET. BOTH THESE *26210091
262200* PROCESSES ARE ACCOMPLISHED WITH THE SAME PARAGRAPH (7200-), A  *26220091
262300* SWITCH IS USED TO DETERMINE WHICH ACTION IS TO BE PERFORMED.   *26230091
262400*----------------------------------------------------------------*26240091
262500 7000-UPDATE-PO.                                                  26250091
262600                                                                  26260091
262700*    UPDATE THE QUEUE WITH THE CURRENT SCREEN DATA.               26270091
262800     MOVE +1                       TO ASC-BLK-SUB.                26280091
262900     PERFORM 7100-WRITE-TEMP-STORAGE.                             26290091
263000     ADD +1                        TO ASC-BLK-SUB.                26300091
263100     PERFORM 7100-WRITE-TEMP-STORAGE.                             26310091
263200                                                                  26320091
263300     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      26330091
263400         SET ASC-UPDATE-TSQ        TO TRUE                        26340091
263500     END-IF.                                                      26350091
263600                                                                  26360091
263700     PERFORM 7200-PROCESS-SELECTED-DELETES                        26370091
263800             VARYING PV-ITEM                                      26380091
263900             FROM 1 BY 1                                          26390091
264000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     26400091
264100                                                                  26410091
264200                                                                  26420091
264300 EJECT                                                            26430091
264400*----------------------------------------------------------------*26440091
264500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26450091
264600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26460091
264700*----------------------------------------------------------------*26470091
264800                                                                  26480091
264900 7100-WRITE-TEMP-STORAGE.                                         26490091
265000                                                                  26500091
265100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26510091
265200                                   TO PV-LIST-ITEM-NUMBER.        26520091
265300     COMPUTE PV-BLOCK-NUMBER =                                    26530091
265400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26540091
265500                                                                  26550091
265600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26560091
265700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26570091
265800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26580091
265900             PERFORM 7105-REWRITE-ASC-LISTQ                       26590091
266000         END-IF                                                   26600091
266100     ELSE                                                         26610091
266200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26620091
266300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26630091
266400         PERFORM 7110-WRITE-ASC-LISTQ                             26640091
266500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26650091
266600     END-IF.                                                      26660091
266700                                                                  26670091
266800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      26680091
266900                                   TO TRUE.                       26690091
267000                                                                  26700091
267100 EJECT                                                            26710091
267200*----------------------------------------------------------------*26720091
267300*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *26730091
267400*  SPECIFIC COMMAREA.                                            *26740091
267500*----------------------------------------------------------------*26750091
267600 7105-REWRITE-ASC-LISTQ.                                          26760091
267700                                                                  26770091
267800     EXEC CICS                                                    26780091
267900         WRITEQ TS                                                26790091
268000             QUEUE (ASC-LIST-QUEUE-NAME)                          26800091
268100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26810091
268200             ITEM  (PV-BLOCK-NUMBER)                              26820091
268300             REWRITE                                              26830091
268400             RESP  (PV-CICS-RESP)                                 26840091
268500     END-EXEC.                                                    26850091
268600                                                                  26860091
268700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26870091
268800         CONTINUE                                                 26880091
268900     ELSE                                                         26890091
269000         SET DP013-CICS-ABEND      TO TRUE                        26900091
269100         SET DP013-NO-ROLLBACK     TO TRUE                        26910091
269200         MOVE '7105-REWRITE-ASC-LISTQ'                            26920091
269300                                   TO DP013-PARAGRAPH             26930091
269400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26940091
269500                                   TO DP013-MESSAGE-TEXT(1)       26950091
269600         PERFORM DP013-0000-PROCESS-ABEND                         26960091
269700     END-IF.                                                      26970091
269800                                                                  26980091
269900 EJECT                                                            26990091
270000*----------------------------------------------------------------*27000091
270100*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *27010091
270200*  SPECIFIC COMMAREA.                                            *27020091
270300*----------------------------------------------------------------*27030091
270400 7110-WRITE-ASC-LISTQ.                                            27040091
270500                                                                  27050091
270600     EXEC CICS                                                    27060091
270700         WRITEQ TS                                                27070091
270800             QUEUE (ASC-LIST-QUEUE-NAME)                          27080091
270900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27090091
271000             ITEM  (PV-BLOCK-NUMBER)                              27100091
271100             RESP  (PV-CICS-RESP)                                 27110091
271200     END-EXEC.                                                    27120091
271300                                                                  27130091
271400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      27140091
271500         SET DP013-CICS-ABEND      TO TRUE                        27150091
271600         SET DP013-NO-ROLLBACK     TO TRUE                        27160091
271700         MOVE '7110-WRITE-ASC-LISTQ'                              27170091
271800                                   TO DP013-PARAGRAPH             27180091
271900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           27190091
272000                                   TO DP013-MESSAGE-TEXT(1)       27200091
272100         PERFORM DP013-0000-PROCESS-ABEND                         27210091
272200     END-IF.                                                      27220091
272300                                                                  27230091
272400 EJECT                                                            27240091
272500*----------------------------------------------------------------*27250091
272600* READ A LIST QUEUE RECORD AND EITHER EDIT THE SELECTED PO FOR   *27260091
272700* DELETE PROCESSING OR DELETE THE PO FROM THE SET BASED ON THE   *27270091
272800* PROCESS SELECTION SWITCH.                                      *27280091
272900*----------------------------------------------------------------*27290091
273000                                                                  27300091
273100 7200-PROCESS-SELECTED-DELETES.                                   27310091
273200                                                                  27320091
273300     PERFORM 6112-READ-LIST-QUEUE.                                27330091
273400                                                                  27340091
273500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       27350091
273600         PERFORM                                                  27360091
273700         VARYING LQW-IDX                                          27370091
273800         FROM 1 BY 1                                              27380091
273900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            27390091
274000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          27400091
274100                                                                  27410091
274200             IF  LQW-SELECT (LQW-IDX)                             27420091
274300                 IF PS-EDIT-SELECTION                             27430091
274400                     MOVE LQW-DEPT-NBR (LQW-IDX)                  27440091
274500                                       TO DK-DEPT-NBR             27450091
274510*                                                                 27451099
274511                     SET  PS-RACF-FUNC-NO  TO TRUE                27451199
274512                     PERFORM 7250-RACF-FUNC                       27451299
274520*                                                                 27452099
274530                     IF  PS-RACF-FUNC-NO                          27453099
274600                         PERFORM 7300-CHECK-AUTHORIZATION         27460099
274610                     END-IF                                       27461099
274700                 ELSE                                             27470091
274800                     MOVE LQW-PO-NBR (LQW-IDX)                    27480091
274900                                       TO PURCHS-PO-NBR           27490091
275000                     PERFORM 7500-UPDATE-TPURCHS                  27500091
275100                 END-IF                                           27510091
275200             END-IF                                               27520091
275300         END-PERFORM                                              27530091
275400     END-IF.                                                      27540091
275500                                                                  27550091
275600                                                                  27560099
275601*----------------------------------------------------------------*27560199
275602*    CHECK TO SEE IF COC (CENTRAL ORDER CONTROL) HAS FUNCTION    *27560299
275603*    ACCESS TO BE ABLE TO UPDATE SEASONAL SET INFO               *27560399
275604*----------------------------------------------------------------*27560499
275610 7250-RACF-FUNC.                                                  27561099
275611                                                                  27561199
275620      SET  PS-RACF-FUNC-NO  TO TRUE.                              27562099
275700                                                                  27570091
275702      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  27570299
275703      MOVE 'POSEASET'                    TO DP008-FUNCTION-NAME   27570399
275704      SET DP008-ACCESS-TYPE-USE          TO TRUE                  27570499
275705                                                                  27570599
275706      EXEC CICS                                                   27570699
275707         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 27570799
275708              COMMAREA (DP008-SECURITY-COMMAREA)                  27570899
275709              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             27570999
275710      END-EXEC                                                    27571099
275711                                                                  27571199
275712      IF DP008-CALL-SUCCESSFUL                                    27571299
275713         IF DP008-ACCESS-ALLOWED                                  27571399
275714             SET  PS-RACF-FUNC-YES  TO TRUE                       27571499
275715             DISPLAY ' POKCS102 - BYPASS DEPT CHECK FOR'          27571599
275716                     ' SEASONAL SET CHANGE ' DP020-USERID         27571699
275717         ELSE                                                     27571799
275718             SET  PS-RACF-FUNC-NO   TO TRUE                       27571899
275719         END-IF                                                   27571999
275720     ELSE                                                         27572099
275721         MOVE '7250-RACF-FUNC'                                    27572199
275722                               TO DP013-PARAGRAPH                 27572299
275723          MOVE 'UNABLE TO ACCESS CICS'                            27572399
275724                               TO DP013-MESSAGE-TEXT (1)          27572499
275725          MOVE SQLCA                 TO DP013-SQLCA               27572599
275726          SET DP013-DB2-ABEND                                     27572699
275727              DP013-XCTL-DISPLAY-RESTART                          27572799
275728                               TO TRUE                            27572899
275729          PERFORM DP013-0000-PROCESS-ABEND                        27572999
275730      END-IF.                                                     27573099
275731                                                                  27573199
275740                                                                  27574099
275800*----------------------------------------------------------------*27580091
275900*    CHECK TO MAKE SURE USER IS AUTHORIZED TO PERFORM MAINTENACE *27590091
276000*    ON THIS PO.                                                 *27600091
276100*----------------------------------------------------------------*27610091
276200 7300-CHECK-AUTHORIZATION.                                        27620091
276300                                                                  27630091
276400     PERFORM                                                      27640091
276500         WITH TEST AFTER                                          27650091
276600         VARYING PV-RETRY-COUNTER                                 27660091
276700         FROM 1 BY 1                                              27670091
276800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27680091
276900             OR (SQLCODE = +0)                                    27690091
277000             OR (SQLCODE = +100))                                 27700091
277100                                                                  27710091
277200         EXEC SQL                                                 27720091
277300              SELECT COUNT(*)                                     27730091
277400                INTO :PV-DB2-COUNT                                27740091
277500                FROM TMDSEAR A                                    27750091
277600                    ,TRSPBAR B                                    27760091
277700               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                27770091
277800                 AND A.DEPT_NBR    = :DK-DEPT-NBR                 27780091
277900                 AND A.MDSELV_CDE  = 'DPT'                        27790091
278000                 AND A.OPERCO_NBR  = '03'                         27800091
278100                 AND B.WORKER_STRT_DTE <= CURRENT DATE            27810091
278200                 AND B.WORKER_END_DTE  >= CURRENT DATE            27820091
278300                 AND B.WORKER_NBR  =                              27830091
278400                    (SELECT WORKER_NBR                            27840091
278500                       FROM TWORKER                               27850091
278600                      WHERE OPERCO_NBR = '03'                     27860091
278700                        AND UID_NBR    = :DP020-USERID)           27870091
278800         END-EXEC                                                 27880091
278900                                                                  27890091
279000         EVALUATE TRUE                                            27900091
279100             WHEN SQLCODE = +0                                    27910091
279200             WHEN SQLCODE = +100                                  27920091
279300             WHEN SQLCODE = -904                                  27930091
279400             WHEN SQLCODE = -913                                  27940091
279500                  CONTINUE                                        27950091
279600                                                                  27960091
279700             WHEN SQLWARN0 NOT = SPACES                           27970091
279800             WHEN SQLCODE < +0                                    27980091
279900             WHEN SQLCODE > +0                                    27990091
280000                  MOVE '7300-CHECK-AUTHORIZATION'                 28000091
280100                                  TO DP013-PARAGRAPH              28010091
280200                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             28020091
280300                                  TO DP013-MESSAGE-TEXT (1)       28030091
280400                  MOVE SQLCA      TO DP013-SQLCA                  28040091
280500                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     28050091
280600                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     28060091
280700                  SET DP013-DB2-ABEND                             28070091
280800                      DP013-XCTL-DISPLAY-RESTART                  28080091
280900                                  TO TRUE                         28090091
281000                  PERFORM DP013-0000-PROCESS-ABEND                28100091
281100         END-EVALUATE                                             28110091
281200     END-PERFORM.                                                 28120091
281300                                                                  28130091
281400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28140091
281500         MOVE '7300-CHECK-AUTHORIZATION'                          28150091
281600                                  TO DP013-PARAGRAPH              28160091
281700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          28170091
281800                                  TO DP013-MESSAGE-TEXT (1)       28180091
281900         MOVE SQLCA               TO DP013-SQLCA                  28190091
282000         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     28200091
282100         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     28210091
282200         SET DP013-DB2-ABEND                                      28220091
282300             DP013-XCTL-DISPLAY-RESTART                           28230091
282400                                  TO TRUE                         28240091
282500         PERFORM DP013-0000-PROCESS-ABEND                         28250091
282600     END-IF.                                                      28260091
282700                                                                  28270091
282800     IF PV-DB2-COUNT = +0                                         28280091
282900         PERFORM 7301-GET-DMA-GMA                                 28290091
283000         IF SQLCODE = +100                                        28300091
283100             CONTINUE                                             28310091
283200         ELSE                                                     28320091
283300             PERFORM 7302-CHECK-DMA-AUTHORIZATION                 28330091
283400             IF PV-DB2-COUNT = +0                                 28340091
283500                 PERFORM 7303-CHECK-GMA-AUTHORIZATION             28350091
283600             END-IF                                               28360091
283700         END-IF                                                   28370091
283800     END-IF.                                                      28380091
283900                                                                  28390091
284000     IF PV-DB2-COUNT = +0                                         28400091
284100         PERFORM 7304-CHECK-NO-AUTHORIZATION                      28410091
284200         IF PV-DB2-COUNT = +0                                     28420091
284300             PERFORM 7305-CHECK-NO-DMA-AUTH                       28430091
284400             IF PV-DB2-COUNT = +0                                 28440091
284500                 PERFORM 7306-CHECK-NO-GMA-AUTH                   28450091
284600                 IF PV-DB2-COUNT = +0                             28460091
284700                     MOVE +1       TO PV-DB2-COUNT                28470091
284800                 ELSE                                             28480091
284900                     MOVE +0       TO PV-DB2-COUNT                28490091
285000                 END-IF                                           28500091
285100             ELSE                                                 28510091
285200                 MOVE +0           TO PV-DB2-COUNT                28520091
285300             END-IF                                               28530091
285400         ELSE                                                     28540091
285500             MOVE +0               TO PV-DB2-COUNT                28550091
285600         END-IF                                                   28560091
285700     END-IF.                                                      28570091
285800                                                                  28580091
285900     IF  PV-DB2-COUNT = +0                                        28590091
286000         MOVE PC-TSYMSG-00014    TO DP020-MSG-NUMBER              28600091
286100         SET PS-ERROR                                             28610091
286200             DP020-MSG-FATAL     TO TRUE                          28620091
286300     END-IF.                                                      28630091
286400                                                                  28640091
286500 7301-GET-DMA-GMA.                                                28650091
286600                                                                  28660091
286700     PERFORM                                                      28670091
286800         WITH TEST AFTER                                          28680091
286900         VARYING PV-RETRY-COUNTER                                 28690091
287000         FROM 1 BY 1                                              28700091
287100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28710091
287200             OR (SQLCODE = +0)                                    28720091
287300             OR (SQLCODE = +100))                                 28730091
287400                                                                  28740091
287500         EXEC SQL                                                 28750091
287600              SELECT GMA_NBR,                                     28760091
287700                     DMA_NBR                                      28770091
287800                INTO :DK-GMA-NBR,                                 28780091
287900                     :DK-DMA-NBR                                  28790091
288000                FROM TMDSEAR                                      28800091
288100               WHERE DEPT_NBR    = :DK-DEPT-NBR                   28810091
288200                 AND MDSELV_CDE  = 'DPT'                          28820091
288300                 AND OPERCO_NBR  = '03'                           28830091
288400                 AND STRT_DTE   <= CURRENT DATE                   28840091
288500                 AND END_DTE    >= CURRENT DATE                   28850091
288600         END-EXEC                                                 28860091
288700                                                                  28870091
288800         EVALUATE TRUE                                            28880091
288900             WHEN SQLCODE = +0                                    28890091
289000             WHEN SQLCODE = +100                                  28900091
289100             WHEN SQLCODE = -904                                  28910091
289200             WHEN SQLCODE = -913                                  28920091
289300                  CONTINUE                                        28930091
289400                                                                  28940091
289500             WHEN SQLWARN0 NOT = SPACES                           28950091
289600             WHEN SQLCODE < +0                                    28960091
289700             WHEN SQLCODE > +0                                    28970091
289800                  MOVE '7301-GET-DMA-GMA'                         28980091
289900                                  TO DP013-PARAGRAPH              28990091
290000                  MOVE 'UNSUCCESSFUL SELECT ON MDSEAR'            29000091
290100                                  TO DP013-MESSAGE-TEXT (1)       29010091
290200                  MOVE SQLCA      TO DP013-SQLCA                  29020091
290300                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     29030091
290400                  SET DP013-DB2-ABEND                             29040091
290500                      DP013-XCTL-DISPLAY-RESTART                  29050091
290600                                  TO TRUE                         29060091
290700                  PERFORM DP013-0000-PROCESS-ABEND                29070091
290800         END-EVALUATE                                             29080091
290900     END-PERFORM.                                                 29090091
291000                                                                  29100091
291100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29110091
291200         MOVE '7301-GET-DMA-GMA'                                  29120091
291300                                  TO DP013-PARAGRAPH              29130091
291400         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON MDSEAR'          29140091
291500                                  TO DP013-MESSAGE-TEXT (1)       29150091
291600         MOVE SQLCA               TO DP013-SQLCA                  29160091
291700         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     29170091
291800         SET DP013-DB2-ABEND                                      29180091
291900             DP013-XCTL-DISPLAY-RESTART                           29190091
292000                                  TO TRUE                         29200091
292100         PERFORM DP013-0000-PROCESS-ABEND                         29210091
292200     END-IF.                                                      29220091
292300                                                                  29230091
292400 7302-CHECK-DMA-AUTHORIZATION.                                    29240091
292500                                                                  29250091
292600     PERFORM                                                      29260091
292700         WITH TEST AFTER                                          29270091
292800         VARYING PV-RETRY-COUNTER                                 29280091
292900         FROM 1 BY 1                                              29290091
293000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29300091
293100             OR (SQLCODE = +0)                                    29310091
293200             OR (SQLCODE = +100))                                 29320091
293300                                                                  29330091
293400         EXEC SQL                                                 29340091
293500              SELECT COUNT(*)                                     29350091
293600                INTO :PV-DB2-COUNT                                29360091
293700                FROM TMDSEAR A                                    29370091
293800                    ,TRSPBAR B                                    29380091
293900               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                29390091
294000                 AND A.DMA_NBR    = :DK-DMA-NBR                   29400091
294100                 AND A.MDSELV_CDE  = 'DMA'                        29410091
294200                 AND A.OPERCO_NBR  = '03'                         29420091
294300                 AND B.WORKER_STRT_DTE <= CURRENT DATE            29430091
294400                 AND B.WORKER_END_DTE  >= CURRENT DATE            29440091
294500                 AND B.WORKER_NBR  =                              29450091
294600                    (SELECT WORKER_NBR                            29460091
294700                       FROM TWORKER                               29470091
294800                      WHERE OPERCO_NBR = '03'                     29480091
294900                        AND UID_NBR    = :DP020-USERID)           29490091
295000         END-EXEC                                                 29500091
295100                                                                  29510091
295200         EVALUATE TRUE                                            29520091
295300             WHEN SQLCODE = +0                                    29530091
295400             WHEN SQLCODE = +100                                  29540091
295500             WHEN SQLCODE = -904                                  29550091
295600             WHEN SQLCODE = -913                                  29560091
295700                  CONTINUE                                        29570091
295800                                                                  29580091
295900             WHEN SQLWARN0 NOT = SPACES                           29590091
296000             WHEN SQLCODE < +0                                    29600091
296100             WHEN SQLCODE > +0                                    29610091
296200                  MOVE '7302-CHECK-DMA-AUTHORIZATION'             29620091
296300                                  TO DP013-PARAGRAPH              29630091
296400                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             29640091
296500                                  TO DP013-MESSAGE-TEXT (1)       29650091
296600                  MOVE SQLCA      TO DP013-SQLCA                  29660091
296700                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     29670091
296800                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     29680091
296900                  SET DP013-DB2-ABEND                             29690091
297000                      DP013-XCTL-DISPLAY-RESTART                  29700091
297100                                  TO TRUE                         29710091
297200                  PERFORM DP013-0000-PROCESS-ABEND                29720091
297300         END-EVALUATE                                             29730091
297400     END-PERFORM.                                                 29740091
297500                                                                  29750091
297600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29760091
297700         MOVE '7302-CHECK-DMA-AUTHORIZATION'                      29770091
297800                                  TO DP013-PARAGRAPH              29780091
297900         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          29790091
298000                                  TO DP013-MESSAGE-TEXT (1)       29800091
298100         MOVE SQLCA               TO DP013-SQLCA                  29810091
298200         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     29820091
298300         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     29830091
298400         SET DP013-DB2-ABEND                                      29840091
298500             DP013-XCTL-DISPLAY-RESTART                           29850091
298600                                  TO TRUE                         29860091
298700         PERFORM DP013-0000-PROCESS-ABEND                         29870091
298800     END-IF.                                                      29880091
298900                                                                  29890091
299000 7303-CHECK-GMA-AUTHORIZATION.                                    29900091
299100                                                                  29910091
299200     PERFORM                                                      29920091
299300         WITH TEST AFTER                                          29930091
299400         VARYING PV-RETRY-COUNTER                                 29940091
299500         FROM 1 BY 1                                              29950091
299600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29960091
299700             OR (SQLCODE = +0)                                    29970091
299800             OR (SQLCODE = +100))                                 29980091
299900                                                                  29990091
300000         EXEC SQL                                                 30000091
300100              SELECT COUNT(*)                                     30010091
300200                INTO :PV-DB2-COUNT                                30020091
300300                FROM TMDSEAR A                                    30030091
300400                    ,TRSPBAR B                                    30040091
300500               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                30050091
300600                 AND A.GMA_NBR    = :DK-GMA-NBR                   30060091
300700                 AND A.MDSELV_CDE  = 'GMA'                        30070091
300800                 AND A.OPERCO_NBR  = '03'                         30080091
300900                 AND B.WORKER_STRT_DTE <= CURRENT DATE            30090091
301000                 AND B.WORKER_END_DTE  >= CURRENT DATE            30100091
301100                 AND B.WORKER_NBR  =                              30110091
301200                    (SELECT WORKER_NBR                            30120091
301300                       FROM TWORKER                               30130091
301400                      WHERE OPERCO_NBR = '03'                     30140091
301500                        AND UID_NBR    = :DP020-USERID)           30150091
301600         END-EXEC                                                 30160091
301700                                                                  30170091
301800         EVALUATE TRUE                                            30180091
301900             WHEN SQLCODE = +0                                    30190091
302000             WHEN SQLCODE = +100                                  30200091
302100             WHEN SQLCODE = -904                                  30210091
302200             WHEN SQLCODE = -913                                  30220091
302300                  CONTINUE                                        30230091
302400                                                                  30240091
302500             WHEN SQLWARN0 NOT = SPACES                           30250091
302600             WHEN SQLCODE < +0                                    30260091
302700             WHEN SQLCODE > +0                                    30270091
302800                  MOVE '7303-CHECK-GMA-AUTHORIZATION'             30280091
302900                                  TO DP013-PARAGRAPH              30290091
303000                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             30300091
303100                                  TO DP013-MESSAGE-TEXT (1)       30310091
303200                  MOVE SQLCA      TO DP013-SQLCA                  30320091
303300                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     30330091
303400                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     30340091
303500                  SET DP013-DB2-ABEND                             30350091
303600                      DP013-XCTL-DISPLAY-RESTART                  30360091
303700                                  TO TRUE                         30370091
303800                  PERFORM DP013-0000-PROCESS-ABEND                30380091
303900         END-EVALUATE                                             30390091
304000     END-PERFORM.                                                 30400091
304100                                                                  30410091
304200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30420091
304300         MOVE '7303-CHECK-GMA-AUTHORIZATION'                      30430091
304400                                  TO DP013-PARAGRAPH              30440091
304500         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          30450091
304600                                  TO DP013-MESSAGE-TEXT (1)       30460091
304700         MOVE SQLCA               TO DP013-SQLCA                  30470091
304800         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     30480091
304900         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     30490091
305000         SET DP013-DB2-ABEND                                      30500091
305100             DP013-XCTL-DISPLAY-RESTART                           30510091
305200                                  TO TRUE                         30520091
305300         PERFORM DP013-0000-PROCESS-ABEND                         30530091
305400     END-IF.                                                      30540091
305500                                                                  30550091
305600 7304-CHECK-NO-AUTHORIZATION.                                     30560091
305700                                                                  30570091
305800     PERFORM                                                      30580091
305900         WITH TEST AFTER                                          30590091
306000         VARYING PV-RETRY-COUNTER                                 30600091
306100         FROM 1 BY 1                                              30610091
306200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30620091
306300             OR (SQLCODE = +0)                                    30630091
306400             OR (SQLCODE = +100))                                 30640091
306500                                                                  30650091
306600         EXEC SQL                                                 30660091
306700              SELECT COUNT(*)                                     30670091
306800                INTO :PV-DB2-COUNT                                30680091
306900                FROM TMDSEAR A                                    30690091
307000                    ,TRSPBAR B                                    30700091
307100               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                30710091
307200                 AND A.MDSELV_CDE  = 'DPT'                        30720091
307300                 AND A.OPERCO_NBR  = '03'                         30730091
307400                 AND B.WORKER_STRT_DTE <= CURRENT DATE            30740091
307500                 AND B.WORKER_END_DTE  >= CURRENT DATE            30750091
307600                 AND B.WORKER_NBR  =                              30760091
307700                    (SELECT WORKER_NBR                            30770091
307800                       FROM TWORKER                               30780091
307900                      WHERE OPERCO_NBR = '03'                     30790091
308000                        AND UID_NBR    = :DP020-USERID)           30800091
308100         END-EXEC                                                 30810091
308200                                                                  30820091
308300         EVALUATE TRUE                                            30830091
308400             WHEN SQLCODE = +0                                    30840091
308500             WHEN SQLCODE = +100                                  30850091
308600             WHEN SQLCODE = -904                                  30860091
308700             WHEN SQLCODE = -913                                  30870091
308800                  CONTINUE                                        30880091
308900                                                                  30890091
309000             WHEN SQLWARN0 NOT = SPACES                           30900091
309100             WHEN SQLCODE < +0                                    30910091
309200             WHEN SQLCODE > +0                                    30920091
309300                  MOVE '7304-CHECK-NO-AUTHORIZATION'              30930091
309400                                  TO DP013-PARAGRAPH              30940091
309500                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             30950091
309600                                  TO DP013-MESSAGE-TEXT (1)       30960091
309700                  MOVE SQLCA      TO DP013-SQLCA                  30970091
309800                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     30980091
309900                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     30990091
310000                  SET DP013-DB2-ABEND                             31000091
310100                      DP013-XCTL-DISPLAY-RESTART                  31010091
310200                                  TO TRUE                         31020091
310300                  PERFORM DP013-0000-PROCESS-ABEND                31030091
310400         END-EVALUATE                                             31040091
310500     END-PERFORM.                                                 31050091
310600                                                                  31060091
310700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31070091
310800         MOVE '7304-CHECK-NO-AUTHORIZATION'                       31080091
310900                                  TO DP013-PARAGRAPH              31090091
311000         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          31100091
311100                                  TO DP013-MESSAGE-TEXT (1)       31110091
311200         MOVE SQLCA               TO DP013-SQLCA                  31120091
311300         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     31130091
311400         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     31140091
311500         SET DP013-DB2-ABEND                                      31150091
311600             DP013-XCTL-DISPLAY-RESTART                           31160091
311700                                  TO TRUE                         31170091
311800         PERFORM DP013-0000-PROCESS-ABEND                         31180091
311900     END-IF.                                                      31190091
312000                                                                  31200091
312100 7305-CHECK-NO-DMA-AUTH.                                          31210091
312200                                                                  31220091
312300     PERFORM                                                      31230091
312400         WITH TEST AFTER                                          31240091
312500         VARYING PV-RETRY-COUNTER                                 31250091
312600         FROM 1 BY 1                                              31260091
312700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31270091
312800             OR (SQLCODE = +0)                                    31280091
312900             OR (SQLCODE = +100))                                 31290091
313000                                                                  31300091
313100         EXEC SQL                                                 31310091
313200              SELECT COUNT(*)                                     31320091
313300                INTO :PV-DB2-COUNT                                31330091
313400                FROM TMDSEAR A                                    31340091
313500                    ,TRSPBAR B                                    31350091
313600               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                31360091
313700                 AND A.MDSELV_CDE  = 'DMA'                        31370091
313800                 AND A.OPERCO_NBR  = '03'                         31380091
313900                 AND B.WORKER_STRT_DTE <= CURRENT DATE            31390091
314000                 AND B.WORKER_END_DTE  >= CURRENT DATE            31400091
314100                 AND B.WORKER_NBR  =                              31410091
314200                    (SELECT WORKER_NBR                            31420091
314300                       FROM TWORKER                               31430091
314400                      WHERE OPERCO_NBR = '03'                     31440091
314500                        AND UID_NBR    = :DP020-USERID)           31450091
314600         END-EXEC                                                 31460091
314700                                                                  31470091
314800         EVALUATE TRUE                                            31480091
314900             WHEN SQLCODE = +0                                    31490091
315000             WHEN SQLCODE = +100                                  31500091
315100             WHEN SQLCODE = -904                                  31510091
315200             WHEN SQLCODE = -913                                  31520091
315300                  CONTINUE                                        31530091
315400                                                                  31540091
315500             WHEN SQLWARN0 NOT = SPACES                           31550091
315600             WHEN SQLCODE < +0                                    31560091
315700             WHEN SQLCODE > +0                                    31570091
315800                  MOVE '7305-CHECK-NO-DMA-AUTH'                   31580091
315900                                  TO DP013-PARAGRAPH              31590091
316000                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             31600091
316100                                  TO DP013-MESSAGE-TEXT (1)       31610091
316200                  MOVE SQLCA      TO DP013-SQLCA                  31620091
316300                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     31630091
316400                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     31640091
316500                  SET DP013-DB2-ABEND                             31650091
316600                      DP013-XCTL-DISPLAY-RESTART                  31660091
316700                                  TO TRUE                         31670091
316800                  PERFORM DP013-0000-PROCESS-ABEND                31680091
316900         END-EVALUATE                                             31690091
317000     END-PERFORM.                                                 31700091
317100                                                                  31710091
317200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31720091
317300         MOVE '7305-CHECK-NO-DMA-AUTH'                            31730091
317400                                  TO DP013-PARAGRAPH              31740091
317500         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          31750091
317600                                  TO DP013-MESSAGE-TEXT (1)       31760091
317700         MOVE SQLCA               TO DP013-SQLCA                  31770091
317800         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     31780091
317900         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     31790091
318000         SET DP013-DB2-ABEND                                      31800091
318100             DP013-XCTL-DISPLAY-RESTART                           31810091
318200                                  TO TRUE                         31820091
318300         PERFORM DP013-0000-PROCESS-ABEND                         31830091
318400     END-IF.                                                      31840091
318500                                                                  31850091
318600 7306-CHECK-NO-GMA-AUTH.                                          31860091
318700                                                                  31870091
318800     PERFORM                                                      31880091
318900         WITH TEST AFTER                                          31890091
319000         VARYING PV-RETRY-COUNTER                                 31900091
319100         FROM 1 BY 1                                              31910091
319200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31920091
319300             OR (SQLCODE = +0)                                    31930091
319400             OR (SQLCODE = +100))                                 31940091
319500                                                                  31950091
319600         EXEC SQL                                                 31960091
319700              SELECT COUNT(*)                                     31970091
319800                INTO :PV-DB2-COUNT                                31980091
319900                FROM TMDSEAR A                                    31990091
320000                    ,TRSPBAR B                                    32000091
320100               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                32010091
320200                 AND A.MDSELV_CDE  = 'GMA'                        32020091
320300                 AND A.OPERCO_NBR  = '03'                         32030091
320400                 AND B.WORKER_STRT_DTE <= CURRENT DATE            32040091
320500                 AND B.WORKER_END_DTE  >= CURRENT DATE            32050091
320600                 AND B.WORKER_NBR  =                              32060091
320700                    (SELECT WORKER_NBR                            32070091
320800                       FROM TWORKER                               32080091
320900                      WHERE OPERCO_NBR = '03'                     32090091
321000                        AND UID_NBR    = :DP020-USERID)           32100091
321100         END-EXEC                                                 32110091
321200                                                                  32120091
321300         EVALUATE TRUE                                            32130091
321400             WHEN SQLCODE = +0                                    32140091
321500             WHEN SQLCODE = +100                                  32150091
321600             WHEN SQLCODE = -904                                  32160091
321700             WHEN SQLCODE = -913                                  32170091
321800                  CONTINUE                                        32180091
321900                                                                  32190091
322000             WHEN SQLWARN0 NOT = SPACES                           32200091
322100             WHEN SQLCODE < +0                                    32210091
322200             WHEN SQLCODE > +0                                    32220091
322300                  MOVE '7306-CHECK-NO-GMA-AUTH'                   32230091
322400                                  TO DP013-PARAGRAPH              32240091
322500                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             32250091
322600                                  TO DP013-MESSAGE-TEXT (1)       32260091
322700                  MOVE SQLCA      TO DP013-SQLCA                  32270091
322800                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     32280091
322900                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     32290091
323000                  SET DP013-DB2-ABEND                             32300091
323100                      DP013-XCTL-DISPLAY-RESTART                  32310091
323200                                  TO TRUE                         32320091
323300                  PERFORM DP013-0000-PROCESS-ABEND                32330091
323400         END-EVALUATE                                             32340091
323500     END-PERFORM.                                                 32350091
323600                                                                  32360091
323700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32370091
323800         MOVE '7306-CHECK-NO-GMA-AUTH'                            32380091
323900                                  TO DP013-PARAGRAPH              32390091
324000         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          32400091
324100                                  TO DP013-MESSAGE-TEXT (1)       32410091
324200         MOVE SQLCA               TO DP013-SQLCA                  32420091
324300         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     32430091
324400         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     32440091
324500         SET DP013-DB2-ABEND                                      32450091
324600             DP013-XCTL-DISPLAY-RESTART                           32460091
324700                                  TO TRUE                         32470091
324800         PERFORM DP013-0000-PROCESS-ABEND                         32480091
324900     END-IF.                                                      32490091
325000                                                                  32500091
325100 EJECT                                                            32510091
325200*----------------------------------------------------------------*32520091
325300*    UPDATE THE TPURCHS TABLE, REMOVING THE SET YEAR AND NAME.   *32530091
325400*----------------------------------------------------------------*32540091
325500 7500-UPDATE-TPURCHS.                                             32550091
325600                                                                  32560091
325700     MOVE SPACES                   TO PURCHS-SEASET-YR            32570091
325800                                      PURCHS-SEASET-SHRT-NM.      32580091
325900     PERFORM                                                      32590091
326000         WITH TEST AFTER                                          32600091
326100         VARYING PV-RETRY-COUNTER                                 32610091
326200         FROM 1 BY 1                                              32620091
326300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32630091
326400            OR (SQLCODE = +0))                                    32640091
326500                                                                  32650091
326600         EXEC SQL                                                 32660091
326700             UPDATE  TPURCHS                                      32670091
326800                SET  SEASET_YR      = :PURCHS-SEASET-YR           32680091
326900                    ,SEASET_SHRT_NM = :PURCHS-SEASET-SHRT-NM      32690091
326910                    ,LAST_UPD_TMST  = CURRENT TIMESTAMP           32691099
327000              WHERE  PO_NBR           = :PURCHS-PO-NBR            32700091
327100                AND  VER_STATUS_CDE   = 'A'                       32710091
327200         END-EXEC                                                 32720091
327300                                                                  32730091
327400         EVALUATE TRUE                                            32740091
327500             WHEN SQLCODE = +0                                    32750091
327600             WHEN SQLCODE = -904                                  32760091
327700             WHEN SQLCODE = -913                                  32770091
327800                  CONTINUE                                        32780091
327900             WHEN OTHER                                           32790091
328000                  MOVE '7500-UPDATE-TPURCHS'                      32800091
328100                                   TO DP013-PARAGRAPH             32810091
328200                  MOVE 'UPDATE TPURCHS '                          32820091
328300                                   TO DP013-MESSAGE-TEXT (1)      32830091
328400                  MOVE SQLCA       TO DP013-SQLCA                 32840091
328500                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    32850091
328600                  SET DP013-DB2-ABEND                             32860091
328700                                   TO TRUE                        32870091
328800                  PERFORM DP013-0000-PROCESS-ABEND                32880091
328900         END-EVALUATE                                             32890091
329000     END-PERFORM.                                                 32900091
329100                                                                  32910091
329200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32920091
329300         MOVE '7500-UPDATE-TPURCHS' TO DP013-PARAGRAPH            32930091
329400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              32940091
329500                                   TO DP013-MESSAGE-TEXT (1)      32950091
329600         MOVE SQLCA                TO DP013-SQLCA                 32960091
329700         SET DP013-DB2-ABEND       TO TRUE                        32970091
329800         PERFORM DP013-0000-PROCESS-ABEND                         32980091
329900     END-IF.                                                      32990091
330000                                                                  33000091
330100 EJECT                                                            33010091
330200*----------------------------------------------------------------*33020091
330300*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *33030091
330400*----------------------------------------------------------------*33040091
330500                                                                  33050091
330600 9100-READ-SEL-QUEUE.                                             33060091
330700     EXEC CICS                                                    33070091
330800         READQ TS                                                 33080091
330900             QUEUE (ASC-SEL-QUEUE-NAME)                           33090091
331000             INTO  (PO077-SET-SEL-REC)                            33100091
331100             ITEM  (ASC-SEL-ITEM)                                 33110091
331200             RESP  (PV-CICS-RESP)                                 33120091
331300     END-EXEC.                                                    33130091
331400                                                                  33140091
331500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       33150091
331600         CONTINUE                                                 33160091
331700     ELSE                                                         33170091
331800         SET DP013-LOGIC-ABEND                                    33180091
331900             DP013-NO-ROLLBACK     TO TRUE                        33190091
332000         MOVE '9100-READ-SEL-QUEUE'                               33200091
332100                                   TO DP013-PARAGRAPH             33210091
332200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   33220091
332300                                   TO DP013-MESSAGE-TEXT (1)      33230091
332400         PERFORM DP013-0000-PROCESS-ABEND                         33240091
332500     END-IF.                                                      33250091
332600                                                                  33260091
332700 EJECT                                                            33270091
332800*----------------------------------------------------------------*33280091
332900*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *33290091
333000*----------------------------------------------------------------*33300091
333100 9200-REWRITE-SEL-QUEUE.                                          33310091
333200     EXEC CICS                                                    33320091
333300          WRITEQ TS                                               33330091
333400              QUEUE  (ASC-SEL-QUEUE-NAME)                         33340091
333500              FROM   (PO077-SET-SEL-REC)                          33350091
333600              ITEM   (ASC-SEL-ITEM)                               33360091
333700              RESP   (PV-CICS-RESP)                               33370091
333800              REWRITE                                             33380091
333900     END-EXEC.                                                    33390091
334000                                                                  33400091
334100     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   33410091
334200         SET DP013-CICS-ABEND                                     33420091
334300             DP013-NO-ROLLBACK     TO TRUE                        33430091
334400         MOVE '9200-REWRITE-SEL-QUEUE'                            33440091
334500                                   TO DP013-PARAGRAPH             33450091
334600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   33460091
334700                                   TO DP013-MESSAGE-TEXT (1)      33470091
334800         PERFORM DP013-0000-PROCESS-ABEND                         33480091
334900     END-IF.                                                      33490091
335000                                                                  33500091
335100 EJECT                                                            33510091
335200*----------------------------------------------------------------*33520091
335300*    ABEND PROCESSOR MODULE                                      *33530091
335400*----------------------------------------------------------------*33540091
335500                                                                  33550091
335600     COPY DPPD013.                                                33560091
