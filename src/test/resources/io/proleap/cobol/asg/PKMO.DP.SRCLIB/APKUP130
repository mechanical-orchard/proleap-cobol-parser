000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKUP130.                                         00020000
000300 AUTHOR.        JILL JUEL.                                        00030000
000400 DATE-WRITTEN.  DECEMBER 1998.                                    00040000
000500 DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700*      FORMAT FREIGHT TRANSACTIONS FOR ADJUSTMENT JOURNAL       * 00070000
000800***************************************************************** 00080000
000900*    COBOL II WITH SQL                                          * 00090000
001000***************************************************************** 00100000
001100*    THE PURPOSE OF THIS PROGRAM IS TO EDIT AND REFORMAT        * 00110000
001200*    FREIGHT TRANSACTIONS                                       * 00120000
001300*                                                               * 00130000
001400*    INPUT:  TRANS INTERNATIONAL FILE   LRECL 273   APRD023     * 00140000
001500*    OUTPUT: FREIGHT ADJUSTMENT FILE    LRECL 500   APRD045     * 00150000
001600*            ERROR REPORT               LRECL 150               * 00160000
001700***************************************************************** 00170000
001800* DB2 TABLES:                                                   * 00180000
001900*  1. PURCHASE ORDER HEADER            (TPURCHS)                * 00190000
002000*  2. EXTERNAL ENTERPRISE              (TEXTENT)                * 00200000
002100*  3. AP CONTROL TABLE                 (TAPCNTL)                * 00210000
002200*  4. TRANSACTION CODE TABLE           (TTRNCDE)                * 00220000
002300*  5. ADJUSTMENT JOURNAL PRORATION     (TAJPRRT)                * 00230000
002400*  6. MERCHANDISE DEPARTMENT TABLE     (TMDSEAR)                * 00240000
002500*  7. ENTITY NAME TABLE                (TENTNME)                * 00250000
002600*  8. LOCATION TABLE                   (XFT00017)               * 00260000
002700*  9. RECEIVER TABLE                   (TRECEIV)                * 00270000
002800***************************************************************** 00280000
002900* CHANGE LOG:                                                   * 00290000
003000*  10/29/99    ROBIN BERNOSKI                                   * 00300000
003100*  CHANGE MADE: ADDED S1100- TO BE ABLE TO RETRIEVE THE CORRECT * 00310000
003200*  NAME AND ID OF THE DEFAULT VENDOR.  IN ADDITION, ADDED THE   * 00320000
003300*  MOVES NECESSARY TO POPULATE THE CORRESPONDING OUTPUT FIELDS. * 00330000
003400*                                                               * 00340000
003500*  12/27/99    MARK BURNSIDE                                    * 00350000
003600*  CHANGE MADE: ADDED MOVE OF PRO BILL FROM APRD023 COPYBOOK    * 00360000
003700*  TO AP045-RSN-1ST-LNE-TXT TO PASS THIS VALUE THROUGH TO THE   * 00370000
003800*  ADJUSTMENT JOURNAL.                                          * 00380000
003900*                                                               * 00390000
004000*  03/16/00    CAROLYN GIFFORD                                  * 00400000
004100*  CHANGE MADE: SELECT VENDOR NUMBER FOR ACTIVE OR INACTIVE     * 00410000
004200*  STATUS WHEN PO NUMBER IS VALID.                              * 00420000
004300*                                                               * 00430000
004400*  08/31/2000  JILL JUEL                     WR# 20741          * 00440000
004500*  CHANGE MADE:  CHANGES MADE TO REFLECT THE FILE BEING FTP'D   * 00450000
004600*  RATHER THAN BEING READ OFF OF A TAPE.  CHANGES INCLUDE       * 00460000
004700*  READING THE HASH TOTAL OFF THE FILE RATHER THAN FROM A       * 00470000
004800*  CONTROL CARD, COPY BOOK CHANGES, AND INCREASED FILE SIZE.    * 00480000
004900*                                                               * 00490000
005000*  11/10/2000  JILL JUEL                     WR# 20224          * 00500000
005100*  ADDED LOGIC TO PROCESS THE NEW MOS FIELDS. THE NEW           * 00510000
005200*  FIELD IS HANDLED THE SAME WAY THE NEW STORE DISCOUNT         * 00520000
005300*  IS HANDLED.                                                  * 00530000
005400*                                                               * 00540000
005500*  05/01/2001  KEVIN CATLIN                  WR# 22119          * 00550000
005600*    ADDED 16 BYTES TO INPUT FILE (FREIGHT-FILE) RECORD         * 00560000
005700*    LENGTH.  THIS WILL ALLOW FOR RECEIPT OF ADDITIONAL         * 00570000
005800*    INFO ON THE WEEKLY FILE TRANSMITTED FROM TRANS INTL.       * 00580000
005900*                                                               * 00590000
006000*  07/23/2001  ALEXIS KEIKER                 WR# 22467          * 00600000
006100*    INCREASED THE LRECL OF FRGT-ADJ-FILE FROM 400 TO 500.      * 00610000
006200*    ALSO THE NAME OF FRGT-ADJ-FILE WAS CHANGED FROM THE        * 00620000
006300*    ORIGINAL NAME WHICH WAS AP-TRAN-FILE TO ADD MORE CLARITY.  * 00630000
006400*                                                               * 00640000
006500*  05/16/2002  KEVIN CATLIN                  WR# 21278          * 00650000
006600*    CHANGE MADE:  NI-SKU CHANGES.  THE 3 BYTE SKU-SEQ FIELD    * 00660000
006700*    IS REPLACED WITH A NUMERIC 8 BYTE SKU FIELD.  CHANGES MADE * 00670000
006800*    TO CURSOR AND TO PARAGRAPHS C200, C400, AND D300.          * 00680000
006900*                                                               * 00690000
007000*  DATE  03/27/2003                                             * 00700000
007100*      CHANGE MADE: EXPAND THE LRECL ON INPUT FILE TO 263.      * 00710000
007200*      RENAMED PARAGRAPHS TO S950 AND S960.  ADDED LOGIC IN     * 00720000
007300*      PARAGRAPH B200 TO LOOK FOR COLLECT FREIGHT CHARGEBACKS.  * 00730000
007400*      ADDED NEW PARAGRAPH C600 THAT WILL DETERMINE WHETHER OR  * 00740000
007500*      NOT A COLLECT PROGRAM TRANSACTION WILL BE CREATED.       * 00750000
007600*      ADDED NEW PARAGRAPH D500 THAT WILL FORMAT AND WRITE THE  * 00760000
007700*      ADJUSTMENT RECORD.                                       * 00770000
007800*      MADE BY: KEVIN CATLIN            WR/IR #: WR24278        * 00780000
007900*                                                               * 00790000
008000*  DATE  05/02/2003                                             * 00800000
008100*      CHANGE MADE: CHANGE NEEDED FOR ARK PO NI-SKU.            * 00810000
008200*      REMOVED SKU-SEQ-NBR AND REPLACED IT WITH SKU-NBR.        * 00820000
008300*      REPLACED STRINGING DEPT,CL,AND SEQ TOGETHER FOR SKU WITH * 00830000
008400*      SKU FROM AJPRRT IN D300-PROCESS-THE-RESULT-SET.          * 00840000
008500*      MADE BY: ROLLIN KRING            WR/IR #: WR22557        * 00850000
008600*                                                               * 00860000
008700*  DATE  06/05/2003                                             * 00870000
008800*      CHANGE MADE: REMOVED THREE VENDORS OFF OF EXEMPT LIST    * 00880000
008900*      PER LOGISTICS DEPARTMENT.  VENDOR ENT IDS REMOVED ARE    * 00890000
009000*      4066 (ASICS TIGER CORP), 190 (MALLORY & CHURCH CORP),    * 00900000
009100*      AND 1979 (MIKASA).                                       * 00910000
009200*      MADE BY: KEVIN CATLIN            WR/IR #: WR25232        * 00920000
009300*                                                               * 00930000
009400*  DATE  07/31/2003                                             * 00940000
009500*      CHANGE MADE: ADDED ADDITIONAL ZIP CODES THAT WILL BE     * 00950000
009600*      EXEMPT FROM THE AUTOMATED COLLECT PROGRAM CHARGEBACKS.   * 00960000
009700*      MADE BY: KEVIN CATLIN            WR/IR #: WR25232        * 00970000
009800*                                                               * 00980000
009900*  DATE  09/03/2003                                             * 00990000
010000*      CHANGE MADE: ADDED EFFECTIVE DATE CHECKING FOR TTRNCDE IN* 01000000
010100*      TRN_CDE_CSR AND THE SQL IN PARA S950-.                   * 01010000
010200*      MADE BY: MIKE BESKE              WR/IR #: WR21316        * 01020000
010300*                                                               * 01030000
010400*  DATE  03/31/2004                                             * 01040000
010500*      CHANGE MADE: REMOVED TSTR000 AND REPLACED IT WITH        * 01050000
010600*      XFT00003 (FI_XFT_LOC).  RECODED PARA S700- TO HANDLE     * 01060000
010700*      THE NEW TABLE. INCREASED THE SIZE OF DL-STORE-NBR FROM   * 01070000
010800*      3 TO 4 CHARACTERS.  THIS PROGRAM USES COPYBOOK APRD023   * 01080000
010900*      WHICH HAD AP023-FR-STORE-NBR INCREASED TO 4 CHARS ALSO.  * 01090000
011000*      MADE BY: MIKE BESKE              WR/IR #: WR25805        * 01100000
011100*                                                               * 01110000
011200*  DATE  06/10/2004                                             * 01120000
011300*      CHANGE MADE: REMOVED COLLECT PROGRAM EXEMPT ZIP CODE     * 01130000
011400*      RANGES AND REPLACED WITH ZIP CODE RANGES TO INCLUDE      * 01140000
011500*      FOR THE COLLECT PROGRAM.  THIS INCLUSIVE LIST IS MORE    * 01150000
011600*      STATIC.  CHANGED 88 LEVELS FOR PV-ZIP-CODE AND CHANGED   * 01160000
011700*      CODE IN PARAGRAPH C600.                                  * 01170000
011800*      MADE BY: KEVIN CATLIN            WR/IR #: WR26553        * 01180000
011900*                                                               * 01190000
012000*  DATE  08/12/2004                                             * 01200000
012100*      CHANGE MADE: REMOVED THREE VENDORS OFF OF EXEMPT LIST    * 01210000
012200*      PER LOGISTICS DEPARTMENT.  VENDOR ENT IDS REMOVED ARE    * 01220000
012300*      2115 (MATTEL INC), 2171 (MATTEL BRANDS ***), AND 845     * 01230000
012400*      (HASBRO INC ***).                                        * 01240000
012500*      MADE BY: KEVIN CATLIN            WR/IR #: WR26553        * 01250000
012600*                                                               * 01260000
012700*   DATE  10/04/2004                                            * 01270000
012800*       CHANGE MADE: REPLACED SQL COMMIT WITH X400-COMMIT PARA. * 01280000
012900*       MADE BY: MIKE BESKE              WR/IR #: P000690867    * 01290000
013000*                                                               * 01300000
013100*   DATE  06/21/2005                                            * 01310000
013200*       CHANGE MADE: REMOVED VENDORS LISTED AS EXEMPT           * 01320000
013300*       (EXEMPT-VENDOR) FROM WORKING STORAGE AND REFERENCE IN   * 01330000
013400*       PARAGRAPH C600-.                                        * 01340000
013500*       MADE BY: KRYSTEN LEARY           WR/IR #: WR29025       * 01350000
013600*                                                               * 01360000
013700*   DATE  08/04/2005                                            * 01370000
013800*       CHANGE MADE: ADDED STORE NUMBER TO THE AP045-RSN-TXT    * 01380000
013900*       FIELD. CHANGE MADE TO REMOVE THE LEADING ZEROS FROM     * 01390000
014000*       THE CAN NUMBER FIELD.                                   * 01400000
014100*       MADE BY: RACHEL GILBERTSON       WR/IR #: WR25952       * 01410000
014200*                                                               * 01420000
014300*   DATE  08/11/2005                                            * 01430000
014400*       CHANGE MADE: REMOVED DEBUGGING DISPLAYS THAT WERE       * 01440000
014500*       CREATING EXCESSIVE SYSOUT.                              * 01450000
014600*       MADE BY: NANCY EILBES            WR/IR #: WR25952       * 01460000
014700*                                                               * 01470000
014800*   DATE  01/27/2006                                            * 01480000
014900*       CHANGE MADE: INCREASED RECORD COUNTERS AND DISPLAY      * 01490000
015000*       COUNTER FIELDS TO ELIMINATE TRUNCATION DUE TO VOLUME    * 01500000
015100*       INCREASES WITH THE BRAND PLANNING PROJECT.              * 01510000
015200*       MADE BY: NANCY EILBES            WR/IR #: WR28582       * 01520000
015300*                                                               * 01530000
015400*   DATE  12/07/2006                                            * 01540000
015500*       CHANGE MADE: ADDED 'GBEA' AS VALID SCAC CODE AS PER     * 01550000
015600*       TRANSPORTATION. (FOR COLLECT PROGRAM)                   * 01560000
015700*       MADE BY: ROLLIN KRING            WR/IR #: WR30042       * 01570000
015800*                                                               * 01580000
015900*   DATE  03/27/2007                                            * 01590000
016000*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE   * 01600000
016100*       CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.     * 01610000
016200*       MADE BY: KEVIN CATLIN            WR/IR #: WR31452       * 01620000
016300*                                                               * 01630000
016400*   DATE  08/09/2007                                            * 01640000
016500*       CHANGE MADE: ADDED SCAC CODE 'GLTN' TO THE 88 LEVEL     * 01650000
016600*       COLLECT-PGM-CARRIER.                                    * 01660000
016700*       MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31939       * 01670000
016800*                                                               * 01680000
016900*   DATE  11/20/2008                                            * 01690000
017000*       CHANGE MADE: ADDED VENDORS LISTED AS EXEMPT             * 01700000
017100*       (EXEMPT-VENDOR) FOR SKECHERS IN WORKING STORAGE AND     * 01710000
017200*       REFERENCE IN PARAGRAPH C600-.                           * 01720000
017300*       MADE BY: ROLF NOHE               WR/IR #: WR33658       * 01730000
017400*                                                               * 01740000
017500*   DATE  01/11/2011                                            * 01750000
017600*       CHANGE MADE: IMPORT REPLENISHMENT PROJECT               * 01760000
017700*       INCREASED THE INPUT FILE LENGTH FROM 264 TO BE 273 AND  * 01770000
017800*       THE REPORT FILE LENGTH FROM 132 TO BE 150 TO INCORPORATE* 01780000
017900*       THE TRIP ID FIELD.  ACCORDINGLY, CHANGED ALL REPORT     * 01790000
018000*       REFERENCES OF 132 TO BE 150.  DECLARED THE NEW          * 01800000
018100*       TRIP_PRORATION_CSR ALONG WITH CREATING THE FOLLOWING    * 01810000
018200*       PARAGRAPHS TO ACCOUNT FOR THE TRIP ID PRORATION AND     * 01820000
018300*       PROCESSING:                                             * 01830000
018400*       - C350-CREATE-MULTI-TRIP-TRANS                          * 01840000
018500*       - D250-CALL-TRIP-PRORATN-ROUTINE                        * 01850000
018600*       - D350-PROCESS-TRIP-RESULT-SET                          * 01860000
018700*       - S350-FETCH-TRIP-PRORATN-CSR                           * 01870000
018800*       - S970-SELECT-TRIP-ID                                   * 01880000
018900*       - S980-SELECT-TRIP-VENDOR                               * 01890000
019000*       - Y250-OPEN-TRIP-PRORATN-CSR                            * 01900000
019100*       - Y550-CLOSE-TRIP-PRORATN-CSR                           * 01910000
019200*       - U100-DELETE-FROM-TAJPRRT                              * 01920000
019300*       ALTERED THE LOGIC IN PARAGRAPH B200-CREATE-FRGT-ADJ-FILE* 01930000
019400*       TO CREATE EITHER A SINGLE PO TRANSACTION, A MULTI PO    * 01940000
019500*       TRANSACTION, OR A MULTI TRIP TRANSACTION.  ALSO EDITED  * 01950000
019600*       PARAGRAPH C100-EDIT-FREIGHT-FILE TO VALIDATE EITHER THE * 01960000
019700*       INPUT TRIP ID OR PO NUMBER.  POPULATED THE WS150-CL-NBR * 01970000
019800*       AND WS150-DC-NBR FIELDS IN THE C300-CREAT-MULTI-PO-TRANS* 01980000
019900*       PARAGRAPH TO PASS TO THE DPKUP150 PRORATION MODULE.     * 01990000
020000*       LASTLY, CHANGED ALL INSTANCES OF CREDIT AMOUNT          * 02000000
020100*       PROCESSING.  CREDIT AMOUNTS SHOULD BE NEGATIVE WHILE    * 02010000
020200*       CHARGE AMOUNTS SHOULD BE POSTIVE.  THE ORIGINAL LOGIC   * 02020000
020300*       THROUGHOUT THE PROGRAM WAS MULTIPLYING THE CREDIT AMOUNT* 02030000
020400*       BY -1 WHICH PRODUCTED A POSITIVE AMOUNT.                * 02040000
020500*       MADE BY: KRYSTEN LEROY           WR/IR #: WR38804       * 02050000
020600*                                                               * 02060000
020700*   DATE  01/27/2011                                            * 02070000
020800*       CHANGE MADE: IMPORT REPLENISHMENT PROJECT               * 02080000
020900*       REMOVED THE POPULATION OF THE WS150-CL-NBR VARIABLE AS  * 02090000
021000*       WELL AS THE PERFORM OF THE U100- ROUTINE IN THE         * 02100000
021100*       C300-CREATE-MULTI-PO-TRANS PARAGRAPH.  ALSO REMOVED THE * 02110000
021200*       PERFORM OF THE U100- ROUTINE IN THE C350-CREATE-MULTI-  * 02120000
021300*       TRIP-TRANS PARAGRAPH.  MOVED THE LOCATION OF THE        * 02130000
021400*       INFORMATIONAL DISPLAY STATEMENTS IN THE D200-CALL-PO-   * 02140000
021500*       PRORATION-ROUTINE AND D250-CALL-TRIP-PRORATN-ROUTINE    * 02150000
021600*       PARAGRAPHS TO ONLY DISPLAY WHEN THERE ARE ERRORS        * 02160000
021700*       RETURNED FROM THE PRORATION ROUTINES.  LASTLY, REMOVED  * 02170000
021800*       THE U100-DELETE-FROM-TAJPRRT PARAGRAPH FROM THE PROGRAM.* 02180000
021900*       ALL OF THESE CHANGES WERE DONE TO INCREASE THE          * 02190000
022000*       EFFICIENCY OF THE PROGRAM.                              * 02200000
022100*       MADE BY: KRYSTEN LEROY           WR/IR #: INC1566554    * 02210000
022200*                                                               * 02220000
022300*   DATE  03/15/2011                                            * 02230000
022400*       CHANGE MADE: IMPORT REPLENISHMENT - SIX MONTH RETENTION * 02240000
022500*       REMOVED THE INCLUDE STATEMENTS FOR THE SUT_OTBND_CART,  * 02250000
022600*       SUT_OTBND_LOC, AND SUT_OTBND_UPC TABLES AND REPLACED    * 02260000
022700*       THEM WITH THOSE FOR THE XFT_OTBND_CART_LOC AND          * 02270000
022800*       XFT_OTBND_UPC TABLES.  CHANGED THE SELECT STATEMENT IN  * 02280000
022900*       THE S970-SELECT-TRIP-ID PARAGRAPH TO USE THE            * 02290000
023000*       XFT_OTBND_CART_LOC AND XFT_OTBND_UPC TABLES RATHER THAN * 02300000
023100*       THE SUT_ VERSIONS OF THE TABLES.                        * 02310000
023200*       MADE BY: KRYSTEN LEROY           WR/IR #: WR38804       * 02320000
023300*                                                               * 02330000
023400*   DATE  03/28/2011                                            * 02340000
023500*       CHANGE MADE: MODIFICATIONS FOR THE TERADATA PROJECT.    * 02350000
023600*       CHANGED THE CODE THAT POPULATES THE AP045-ENTR-DTE,     * 02360000
023700*       AP045-DOC-DTE, AP045-BTCH-DTE & AP045-CUTOFF-DTE IN     * 02370000
023800*       THE FOLLOWING PARAS: C200-, C300-, C350- AND C400-.     * 02380000
023900*       THIS FIELD WILL BE POPULATED WITH THE CURRENT DATE INSTEAD02390000
024000*       OF THE APCNTL-BTCH-PRC-DTE.  THIS NEEDS TO BE DONE SO THAT02400000
024100*       THE TERADATA BATCH EXTRACT CAN PICK UP THE NEWLY INSERTED*02410000
024200*       ADJUSTMENTS FROM APK210.  APK210 IS SCHEDULED AS PART OF* 02420000
024300*       THE THURSDAY NIGHT BATCH RUN, BUT ACTUALLY RUNS ON FRIDAY*02430000
024400*       AT 6AM.  THIS CHANGE ENSURES THAT THE DATE FOR FRIDAY IS* 02440000
024500*       IN THE ENTERED DATE INSTEAD OF DATE FOR THURSDAY.       * 02450000
024600*       MADE BY: MIKE BESKE              WR/IR #: WR38891       * 02460000
024700*                                                               * 02470000
024800*   DATE  08/02/2011                                            * 02480000
024900*   PROGRAM MODIFIED TO REFERENCE THE NEW DOMAIN TABLE IN DB2   * 02490000
025000*   INSTEAD OF REFERENCING THE DB3P DOMAIN TABLE AS DB3P IS     * 02500000
025100*   GOING AWAY.                                                 * 02510000
025200*   CHANGE OF FINANCE DOMAIN TABLE FOR LOCATION INFORMATION     * 02520000
025300*      FI_XFT_LOC  --> XFT_LOC(XFT00017)                        * 02530000
025400*      MADE BY : ANIL (CTS)          WR/IR  #: W37038           * 02540000
025500*                                                               * 02550000
025600*   DATE  03/30/2016                                            * 02560000
025601*   CHANGED VERBIAGE IN COMMENTS ON COLLECT PROGRAM             * 02560100
025602*   ADJUSTMENTS. CHANGED THE WORKING STORAGE VARIABLE           * 02560200
025603*   PV-COLLECT-PGM-MESSAGE TO SAY 'CONSOL FEES' INSTEAD OF      * 02560300
025604*   'CONSOL CHARGES'                 WR/IR #: CHG0138302        * 02560400
025605*                                                               * 02560500
025606*   DATE  08/10/2017                                            * 02560600
025607*   ADDED TWO MORE VENDORS TO THE EXEMPT VENDOR WORKING         * 02560700
025608*   STORAGE VARIABLE.                WR/IR #: CHG0138302        * 02560800
025609*                                                               * 02560900
025610*   DATE  01/15/2018                                            * 02561000
025611*   ADDED PO-TYPE-CODE 'LE' ECOMM LANDED TO THE PROGRAM.        * 02561100
025612*   MADE BY: BARB SCHULTZ            WR/IR #: CHG0181356        * 02561200
025613*                                                               * 02561300
025614*   DATE  02/11/2020                                            * 02561400
025615*   DELETED CODE FOR THE EDIT FOR VALIDATING THE TRIP ID AND    * 02561500
025616*   THE CALL FOR THE PRORATION ROUTINE. ALSO DELETED THE        * 02561600
025617*   COPYBOOKS FOR XFT_OTBND_CART_LOC AND XFT_OTBND_UPC.         * 02561700
025618*   DELETED THESE PARAGRAPHS SINCE THEY ARE NO LONGER USED      * 02561800
025619*   - C350-CREATE-MULTI-TRIP-TRANS                              * 02561900
025620*   - D250-CALL-TRIP-PRORATN-ROUTINE                            * 02562000
025630*   - D350-PROCESS-TRIP-RESULT-SET                              * 02563000
025640*   - S350-FETCH-TRIP-PRORATN-CSR                               * 02564000
025650*   - S970-SELECT-TRIP-ID                                       * 02565000
025651*   - S980-SELECT-TRIP-VENDOR                                   * 02565100
025652*   - Y250-OPEN-TRIP-PRORATN-CSR                                * 02565200
025653*   - Y550-CLOSE-TRIP-PRORATN-CSR                               * 02565300
025654*   MADE BY: BARB SCHULTZ            WR/IR #: CHG0239316        * 02565400
025655*                                                               * 02565500
025656*   DATE  07/08/2021                                            * 02565600
025657*   ADDED SEPHORA USA TO THE EXEMPT VENDOR WORKING STORAGE      * 02565700
025658*   STORAGE VARIABLE SO THEY WILL NOT HAVE COLLECT PROGRAM      * 02565800
025659*   CHARGEBACKS GENERATED.                                      * 02565900
025660*   MADE BY: NANCY EILBES            WR/IR #: CHG0258758        * 02566000
025670*                                                               * 02567000
025680*   DATE  07/13/2021                                            * 02568000
025690*   ADDED LIST OF 97 EXEMPT SEPHORA BEAUTY VENDORS WHO WILL BE  * 02569000
025691*   EXCLUDED FROM THE COLLECT PROGRAM UNTIL 12/15/2021 BASED    * 02569100
025692*   THE PRO BILL DATE FROM THE FREIGHT BILLS.                   * 02569200
025693*   MADE BY: NANCY EILBES            WR/IR #: CHG0258934        * 02569300
025694*                                                               * 02569400
025695*   DATE  12/07/2021                                            * 02569500
025696*   ADDED 7 VENDORS TO THE LIST OF EXEMPT SEPHORA VENDORS AND   * 02569600
025697*   EXTENDED THE EXCLUSION DATE TO 02/01/2023.                  * 02569700
025698*   MADE BY: NANCY EILBES            WR/IR #: CHG0264618        * 02569800
025699*                                                               * 02569900
025700*   DATE  05/25/2022                                            * 02570000
025701*   CHANGE TO AUTOMATE THE LIST OF SEPHORA VENDORS INSTEAD OF   * 02570100
025702*   USING HARDCODED VALUES                                      * 02570200
025703*   MADE BY: JEAN KURK               WR/IR #: CHG0270189        * 02570300
025704*                                                               * 02570400
025705*   DATE  02/21/2023                                            * 02570500
025706*   CHANGE CALLS TO DPKUP150 AND DPKUP151 FROM STATIC TO        * 02570600
025707*   DYNAMIC                                                     * 02570700
025708*   MADE BY: JEAN KURK               WR/IR #: CHG0282641        * 02570800
025709*                                                               * 02570900
025710*   DATE  03/01/2023                                            * 02571000
025711*   ADDED ARO STUDIOS INC TO THE EXEMPT VENDOR WORKING STORAGE  * 02571100
025712*   STORAGE VARIABLE SO THEY WILL NOT HAVE COLLECT PROGRAM      * 02571200
025713*   CHARGEBACKS GENERATED.                                      * 02571300
025714*   MADE BY: NANCY EILBES            WR/IR #: CHG0284490        * 02571400
025715*                                                               * 02571500
025716*   DATE  03/14/2023                                            * 02571600
025717*   COMMENTED THE LOGIC OF DEPT/CLASS SWITCH TO AVOID VALUES    * 02571700
025718*   NOT ADDING TO THE ACCUMULATOR.                              * 02571800
025719*   MADE BY: SRINIVASAN SIVARAJ      WR/IR #: CHG0285515        * 02571900
025720*                                                               * 02572000
025721*   DATE  11/15/2023                                            * 02572100
025722*   ADDED VENDOR FOLDEN LAQNE TO THE LIST OF EXEMPT VENDORS FOR * 02572200
025723*   COLLECT PROGRAM.                                            * 02572300
025724*   MADE BY: NANCY EILBES            WR/IR #: CHG0297212        * 02572400
025720*                                                               * 02572501
025721*   DATE  02/14/2024                                            * 02572601
025722*   REMOVE VENDOR 229430 FROM LIST OF EXEMPT VENDORS FOR COLLECT* 02572701
025723*   PROGRAM                                                     * 02572801
025724*   MADE BY: JEAN KURK               WR/IR #: CHG0300878        * 02572901
025725***************************************************************** 02573000
025726 ENVIRONMENT DIVISION.                                            02573100
025727                                                                  02573200
025728 INPUT-OUTPUT SECTION.                                            02573300
025729 FILE-CONTROL.                                                    02573400
025730                                                                  02573500
025740     SELECT FREIGHT-FILE  ASSIGN TO UT-S-INP01.                   02574000
025750     SELECT FRGT-ADJ-FILE ASSIGN TO UT-S-OUT01.                   02575000
025760     SELECT REPORT-FILE   ASSIGN TO UT-S-RPT01.                   02576000
025770 EJECT                                                            02577000
025780 DATA DIVISION.                                                   02578000
025790                                                                  02579000
025800 FILE SECTION.                                                    02580000
025900                                                                  02590000
026000 FD  FREIGHT-FILE                                                 02600000
026100     LABEL RECORDS ARE OMITTED                                    02610000
026200     RECORDING MODE IS F                                          02620000
026300     RECORD CONTAINS 273 CHARACTERS                               02630000
026400     BLOCK CONTAINS 0 RECORDS.                                    02640000
026500 01  FREIGHT-RECORD                  PIC X(273).                  02650000
026600                                                                  02660000
026700 FD  FRGT-ADJ-FILE                                                02670000
026800     LABEL RECORDS ARE STANDARD                                   02680000
026900     RECORDING MODE IS F                                          02690000
027000     BLOCK CONTAINS 0 RECORDS.                                    02700000
027100 01  FRGT-ADJ-RECORD                 PIC X(500).                  02710000
027200                                                                  02720000
027300 FD  REPORT-FILE                                                  02730000
027400     LABEL RECORDS ARE STANDARD                                   02740000
027500     RECORDING MODE IS F                                          02750000
027600     BLOCK CONTAINS 0 RECORDS.                                    02760000
027700 01  REPORT-RECORD.                                               02770000
027800     05  FILLER                      PIC  X(150).                 02780000
027900 EJECT                                                            02790000
028000 WORKING-STORAGE SECTION.                                         02800000
028100                                                                  02810000
028200 01  PROGRAM-COUNTERS.                                            02820000
028300     05  REFSEQ-WS                   PIC S9(03) COMP-3 VALUE +0.  02830000
028400     05  FREIGHT-RECORDS-IN          PIC S9(09) COMP-3 VALUE +0.  02840000
028500     05  FREIGHT-RECORDS-OUT         PIC S9(09) COMP-3 VALUE +0.  02850000
028600     05  FREIGHT-ERROR-RECORDS       PIC S9(09) COMP-3 VALUE +0.  02860000
028700     05  FREIGHT-EXCPT-RECORDS       PIC S9(09) COMP-3 VALUE +0.  02870000
028800     05  TOTAL-FREIGHT-AMOUNT-IN     PIC S9(09)V99                02880000
028900                                                COMP-3 VALUE +0.  02890000
029000     05  TOTAL-FREIGHT-CREDIT-AMT    PIC S9(09)V99                02900000
029100                                                COMP-3 VALUE +0.  02910000
029200     05  TOTAL-FREIGHT-CHARGE-AMT    PIC S9(09)V99                02920000
029300                                                COMP-3 VALUE +0.  02930000
029400     05  TOTAL-FREIGHT-DSPLY-CREDIT-AMT    PIC S9(09)V99          02940000
029500                                                COMP-3 VALUE +0.  02950000
029600     05  TOTAL-FREIGHT-DSPLY-CHARGE-AMT    PIC S9(09)V99          02960000
029700                                                COMP-3 VALUE +0.  02970000
029800                                                                  02980000
029900     05  PRT-FREIGHT-RECORDS-IN        PIC  9(09) VALUE ZERO.     02990000
030000     05  PRT-FREIGHT-RECORDS-OUT       PIC  9(09) VALUE ZERO.     03000000
030100     05  PRT-FREIGHT-ERROR-RECORDS     PIC  9(09) VALUE ZERO.     03010000
030200     05  PRT-FREIGHT-EXCPT-RECORDS     PIC  9(09) VALUE ZERO.     03020000
030300     05  PRT-HASH-TOTAL                PIC  Z(09).99- VALUE ZERO. 03030000
030400     05  PRT-TOTAL-FREIGHT-AMOUNT-IN   PIC  Z(09).99- VALUE ZERO. 03040000
030500     05  PRT-TOTAL-FREIGHT-CREDIT-AMT  PIC  Z(09).99- VALUE ZERO. 03050000
030600     05  PRT-TOTAL-FREIGHT-CHARGE-AMT  PIC  Z(09).99- VALUE ZERO. 03060000
030700     05  COUNT-PRORATION-CSR           PIC  9(09) VALUE ZERO.     03070000
030800     05  CNTR1                         PIC  9(09) VALUE ZERO.     03080000
030900                                                                  03090000
031000 01  PROGRAM-SWITCHES.                                            03100000
031100     05  EDIT-SW                     PIC X  VALUE 'N'.            03110000
031200         88  EDIT-ERROR                     VALUE 'Y'.            03120000
031300     05  PS-FREIGHT-EOF-SW           PIC X  VALUE 'N'.            03130000
031400         88  FREIGHT-EOF                    VALUE 'Y'.            03140000
031500     05  PS-VALID-PO-NBR-SW          PIC X  VALUE 'N'.            03150000
031600         88  INVALID-PO-NBR                 VALUE 'N'.            03160000
031700         88  VALID-PO-NBR                   VALUE 'Y'.            03170000
031800*    05  PS-VALID-DEPT-CL-SW         PIC X  VALUE 'Y'.            03180000
031900*        88  INVALID-DEPT-CL                VALUE 'N'.            03190000
032000*        88  VALID-DEPT-CL                  VALUE 'Y'.            03200000
032100     05  PS-VALID-TRIP-ID-SW         PIC X  VALUE 'N'.            03210000
032200         88  INVALID-TRIP-ID                VALUE 'N'.            03220000
032300         88  VALID-TRIP-ID                  VALUE 'Y'.            03230000
032400     05  PS-FIRST-PO-PRORTN-SW       PIC X  VALUE 'N'.            03240000
032500         88  FIRST-PO-PRORTN                VALUE 'Y'.            03250000
032600     05  PS-FIRST-TRIP-PRORTN-SW     PIC X  VALUE 'N'.            03260000
032700         88  FIRST-TRIP-PRORTN              VALUE 'Y'.            03270000
032800     05  PS-END-OF-PO-PRORTN-CSR     PIC X  VALUE 'N'.            03280000
032900         88  END-OF-PO-PRORTN-CSR           VALUE 'Y'.            03290000
033000     05  PS-END-OF-TRIP-PRORTN-CSR   PIC X  VALUE 'N'.            03300000
033100         88  END-OF-TRIP-PRORTN-CSR         VALUE 'Y'.            03310000
033200     05  PS-END-OF-TRN-CDE-CSR       PIC X  VALUE 'N'.            03320000
033300         88  END-OF-TRN-CDE-CSR             VALUE 'Y'.            03330000
033400     05  PS-DEFAULT-VENDOR-SW        PIC X  VALUE 'N'.            03340000
033500         88  DEFAULT-VENDOR                 VALUE 'Y'.            03350000
033600     05  PS-VENDOR-FOUND-SW          PIC X  VALUE 'N'.            03360000
033700         88  VENDOR-FOUND                   VALUE 'Y'.            03370000
033800     05  PS-TRECEIV-FOUND-SW         PIC X  VALUE 'N'.            03380000
033900         88  TRECEIV-NOT-FOUND              VALUE 'N'.            03390000
034000         88  TRECEIV-FOUND                  VALUE 'Y'.            03400000
034100     05  PS-TRECEIV-PO-FOUND-SW      PIC X  VALUE 'Y'.            03410000
034200         88  TRECEIV-PO-NOT-FOUND           VALUE 'N'.            03420000
034300         88  TRECEIV-PO-FOUND               VALUE 'Y'.            03430000
034400     05  PS-ZIP-CODE-SW              PIC X  VALUE 'V'.            03440000
034500         88  INVALID-ZIP                    VALUE 'I'.            03450000
034600         88  VALID-ZIP                      VALUE 'V'.            03460000
034700         88  CANADIAN-ZIP                   VALUE 'C'.            03470000
034800     05  WS-LOCATION-CSR-SW          PIC X  VALUE 'N'.            03480000
034900         88  END-OF-LOC-CSR                 VALUE 'Y'.            03490000
035000         88  NOT-END-OF-LOC-CSR             VALUE 'N'.            03500000
035100     05  PS-PRORATE-ALL-DCS-SW       PIC X  VALUE 'N'.            03510000
035200         88 PRORATE-ALL-DCS                 VALUE 'Y'.            03520000
035300     05  PS-FETCH-DEPT-SW          PIC X    VALUE 'N'.            03530000
035400         88  PS-DEPT-END-YES                VALUE 'Y'.            03540000
035500         88  PS-DEPT-END-NO                 VALUE 'N'.            03550000
035600     05  PS-FETCH-ENTID-SW         PIC X    VALUE 'N'.            03560000
035700         88  PS-ENTID-END-YES               VALUE 'Y'.            03570000
035800         88  PS-ENTID-END-NO                VALUE 'N'.            03580000
035900     05  PS-SEPHORA-EXEMPT-SW      PIC X    VALUE 'N'.            03590000
036000         88  PS-SEPHORA-EXEMPT-YES          VALUE 'Y'.            03600000
036010         88  PS-SEPHORA-EXEMPT-NO           VALUE 'N'.            03601000
036020                                                                  03602000
036030 01  PC-PROGRAM-CONSTANTS.                                        03603000
036040     05  PC-PROGRAM-NAME             PIC X(08) VALUE 'APKUP130'.  03604000
036050     05  PC-DEFAULT-VENDOR           PIC X(09) VALUE '000337550'. 03605000
036060     05  PC-RETRY-MAX                PIC S9(04) VALUE +3          03606000
036070                                                COMP.             03607000
036080     05  PC-MAX-RETRIES-DOC-NO       PIC S9(04) VALUE +10         03608000
036090                                                COMP.             03609000
036100     05  PC-LOC-TBL-MAX              PIC S9(09) COMP SYNC         03610000
036200                                                VALUE +1500.      03620000
036300                                                                  03630000
036400 01  PV-PROGRAM-VARIABLES.                                        03640000
036500     05  PV-DEFAULT-VND-NAME         PIC X(30) VALUE SPACES.      03650000
036600     05  PV-DEFAULT-VND-NBR          PIC S9(9) VALUE ZERO COMP.   03660000
036700     05  PV-DEPT-NBR                 PIC X(03) VALUE SPACES.      03670000
036800     05  PV-TRIP-ID                  PIC X(09) VALUE SPACES.      03680000
036900     05  PV-DOC-NBR                  PIC X(16) VALUE SPACES.      03690000
037000     05  PV-DOC-DTE                  PIC X(10).                   03700000
037100     05  FILLER REDEFINES PV-DOC-DTE.                             03710000
037200         10  PV-DOC-CC               PIC X(2).                    03720000
037300         10  PV-DOC-YY               PIC X(2).                    03730000
037400         10  PV-DOC-DASH1            PIC X(1).                    03740000
037500         10  PV-DOC-MM               PIC X(2).                    03750000
037600         10  PV-DOC-DASH2            PIC X(1).                    03760000
037700         10  PV-DOC-DD               PIC X(2).                    03770000
037800     05  PV-ENTR-DTE                 PIC X(10).                   03780000
037900     05  FILLER REDEFINES PV-ENTR-DTE.                            03790000
038000         10  PV-ENTR-DTE-CC          PIC X(2).                    03800000
038100         10  PV-ENTR-DTE-YY          PIC X(2).                    03810000
038200         10  PV-ENTR-DTE-DASH1       PIC X(1).                    03820000
038300         10  PV-ENTR-DTE-MM          PIC X(2).                    03830000
038400         10  PV-ENTR-DTE-DASH2       PIC X(1).                    03840000
038500         10  PV-ENTR-DTE-DD          PIC X(2).                    03850000
038600     05  PV-SYSTEM-DATE              PIC  9(06)  VALUE ZERO.      03860000
038700     05  FILLER                      REDEFINES PV-SYSTEM-DATE.    03870000
038800         10  PV-SYSTEM-YEAR          PIC  9(02).                  03880000
038900         10  PV-SYSTEM-MONTH         PIC  9(02).                  03890000
039000         10  PV-SYSTEM-DAY           PIC  9(02).                  03900000
039100     05  PV-SYSTEM-TIME              PIC  9(08)  VALUE ZERO.      03910000
039200     05  FILLER                      REDEFINES PV-SYSTEM-TIME.    03920000
039300         10  PV-SYSTEM-HOUR          PIC  9(02).                  03930000
039400         10  PV-SYSTEM-MINUTE        PIC  9(02).                  03940000
039500         10  PV-SYSTEM-SECOND        PIC  9(02).                  03950000
039600         10  FILLER                  PIC  9(02).                  03960000
039700     05  PV-TIMESTAMP                PIC  X(16).                  03970000
039800     05  FILLER                      REDEFINES PV-TIMESTAMP.      03980000
039900         10  PV-TIMESTAMP-HYPHEN     PIC  X(01).                  03990000
040000         10  PV-TIMESTAMP-HH         PIC  9(02).                  04000000
040100         10  PV-TIMESTAMP-PERIOD1    PIC  X(01).                  04010000
040200         10  PV-TIMESTAMP-MM         PIC  9(02).                  04020000
040300         10  PV-TIMESTAMP-PERIOD2    PIC  X(01).                  04030000
040400         10  PV-TIMESTAMP-SS         PIC  9(02).                  04040000
040500         10  PV-TIMESTAMP-PERIOD3    PIC  X(01).                  04050000
040600         10  PV-TIMESTAMP-XXXXXX     PIC  9(06).                  04060000
040700     05  PV-SYSTEM-JULIAN            PIC  9(05)  VALUE ZERO.      04070000
040800     05  PV-STORE-9                  PIC 9(04)         VALUE  0.  04080000
040900     05  PV-STORE-9COMP              PIC S9(04)   COMP VALUE +0.  04090000
041000     05  PV-FREIGHT-AMT              PIC S9(09)V9(02)             04100000
041100                                                 COMP-3           04110000
041200                                                 VALUE +0.        04120000
041300     05  PV-VARIANCE-PERCENT         PIC S9(03)V9(04)             04130000
041400                                                 VALUE +0.        04140000
041500     05  PV-VARIANCE-AMOUNT          PIC  9(09)V9(02)             04150000
041600                                                 VALUE ZERO.      04160000
041700     05  PV-ACTUAL-DIFFERENCE        PIC  9(09)V9(02)             04170000
041800                                                 VALUE ZERO.      04180000
041900     05  PV-RETRY-COUNTER            PIC S9(04)  VALUE ZEROS      04190000
042000                                                 COMP.            04200000
042100     05  PO-BEING-PROCESSED          PIC S9(09)   COMP VALUE +0.  04210000
042200     05  PV-PO-DISPLAY               PIC  9(09)        VALUE  0.  04220000
042300     05  TRIP-BEING-PROCESSED        PIC S9(09)   COMP VALUE +0.  04230000
042400     05  PV-TRIP-DISPLAY             PIC  9(09)        VALUE  0.  04240000
042500     05  PV-DEPT                     PIC X(03).                   04250000
042600     05  PV-MAJOR-CLASSNO            PIC X(02).                   04260000
042700     05  PV-SUB-CLASSNO              PIC X(03).                   04270000
042800     05  PV-SUB-CLASSNOB             REDEFINES PV-SUB-CLASSNO.    04280000
042900         10 PV-SUB-CLASS-FRST1       PIC X(01).                   04290000
043000         10 PV-SUB-CLASS-LAST2       PIC X(02).                   04300000
043100     05  PV-PRORATE-PARAMETERS.                                   04310000
043200         10 PV-REC-SEQ-NBR           PIC S9(09)  COMP.            04320000
043300         10 PV-STR-NBR               PIC S9(04)  COMP.            04330000
043400         10 PV-STR-TYP-CDE           PIC X(02).                   04340000
043500         10 PV-PO-LNE-NBR            PIC S9(09)  COMP.            04350000
043600         10 PV-PRORATE-BASIS         PIC X(01).                   04360000
043700         10 PV-PRORATE-LEVEL         PIC X(01).                   04370000
043800     05  PV-ADJUSTED-FRGT-AMT        PIC S9(9)V99 COMP-3.         04380000
043900     05  PV-FRGT-AMT                 PIC S9(9)V9(4) COMP-3.       04390000
044000     05  PV-MATCH-DEPT               PIC X(01) VALUE SPACE.       04400000
044100     05  PV-MATCH-ENTID              PIC X(01) VALUE SPACE.       04410000
044200     05  PV-AP023-REC-SEQ-NBR        PIC  S9(9) COMP.             04420000
044300     05  PV-CHECK-SCAC-CODE          PIC X(5)  VALUE SPACES.      04430000
044400         88  COLLECT-PGM-CARRIER     VALUES '9GLE', 'TTPJ',       04440000
044500                                            'GBEA', 'GLTN'.       04450000
044600     05  PV-PO-TYPE-CODE             PIC X(2)  VALUE SPACES.      04460000
044700         88  IMPORT-LANDED-PO-TYP   VALUES 'IM', 'IE', 'IF',      04470000
044800                                           'LD', 'LE'.            04480000
044900     05  PV-ZIP-CODE                 PIC X(5)  VALUE SPACES.      04490000
045000         88  COLLECT-INCLUSIVE-ZIP   VALUES '07000' THRU '07999', 04500000
045100                                            '08600' THRU '08999', 04510000
045200                                            '10000' THRU '10899', 04520000
045300                                            '11000' THRU '11999', 04530000
045400                                            '90000' THRU '93199'. 04540000
045500**       88  SAN-FRANCISCO-ZIP       VALUES '94000' THRU '95999'. 04550000
045600**       88  PA-ZIP                  VALUES '15001' THRU '19640'. 04560000
045700**       88  MA-ZIP                  VALUES '01001' THRU '02791'. 04570000
045800**       88  RI-ZIP                  VALUES '02801' THRU '02940'. 04580000
045900**       88  CT-ZIP                  VALUES '06001' THRU '06928'. 04590000
046000**       88  LOWER-NJ-ZIP            VALUES '08001' THRU '08599'. 04600000
046100     05  PV-COLL-BTCH-PRC-DTE        PIC X(10) VALUE SPACES.      04610000
046200     05  PV-COLL-DEPT-NBR            PIC X(03) VALUE SPACES.      04620000
046300     05  PV-COLL-CL-NBR              PIC X(02) VALUE SPACES.      04630000
046400     05  PV-COLL-VND-NBR             PIC X(9)  VALUE SPACES.      04640000
046500     05  PV-COLL-ENT-ID              PIC S9(9) VALUE ZERO COMP.   04650000
046600     05  PV-COLL-ENT-NAME            PIC X(30) VALUE SPACES.      04660000
046700     05  PV-CHECK-VENDOR             PIC 9(9)  VALUE ZEROES.      04670000
046800         88  HALF-FREIGHT-VENDOR     VALUES  2432, 457.           04680000
046900         88  EXEMPT-VENDOR           VALUES  9446, 11289, 64592,  04690000
047000                                             57244, 57064, 202922,04700000
047100                                           232264, 228220.        04710001
047100*                                          232264, 228220, 229430.04711001
047200** EXEMPT VENDOR NAMES ARE LISTED BELOW                           04720000
047300**                                                                04730000
047400**  9446    SKECHERS COLLECTIONS/SKECH USA                        04740000
047500**  57064   HADDAD ACCESSORIES                                    04750000
047600**  11289   HADDAD APPAREL                                        04760000
047700**  202922  HADDAD BROTHERS INC                                   04770000
047800**  64592   HADDAD FOOTWEAR LLC                                   04780000
047900**  57244   HADDAD HOSIERY LLC                                    04790000
048000**  228220  SEPHORA USA INC                                       04800000
048100**  229430  ARO STUDIOS INC - DDP                                 04810000
048200**  232264  FOLDEN LANE                                           04820000
048300**                                                                04830000
048310*        88  SEPHORA-TEMP-EXEMPT  VALUES                          04831000
048320*             117857, 121428, 142610, 217297, 227507, 227537,     04832000
048330*             227543, 227562, 227563, 227565, 227566, 227569,     04833000
048331*             227570, 227580, 227583, 227586, 227591, 227603,     04833100
048332*             227606, 227620, 227622, 227635, 227640, 227647,     04833200
048333*             227648, 227649, 227650, 227658, 227659, 227661,     04833300
048334*             227669, 227672, 227675, 227676, 227677, 227680,     04833400
048335*             227681, 227684, 227686, 227688, 227692, 227694,     04833500
048336*             227707, 227709, 227710, 227712, 227719, 227741,     04833600
048337*             227742, 227747, 227752, 227771, 227776, 227782,     04833700
048338*             227790, 227801, 227811, 227814, 227829, 227830,     04833800
048339*             227849, 227853, 227857, 227886, 227893, 227917,     04833900
048340*             227954, 227955, 227959, 227960, 227971, 227976,     04834000
048350*             227977, 227978, 227981, 227982, 227983, 227990,     04835000
048360*             228008, 228011, 228012, 228014, 228022, 228160,     04836000
048361*             228181, 228217, 228228, 228235, 228252, 228351,     04836100
048362*             228372, 228376, 228377, 228378, 228379, 228384,     04836200
048363*             228418,                                             04836300
048364*             228945, 229048, 229208, 229242, 229598, 229616,     04836400
048365*             229620.                                             04836500
048366** SEPHORA VENDORS OTHER THAN SEPHORA USA INC ARE TEMPORARILY     04836600
048367** EXEMPT FROM THE COLLECT PROGRAM.  PROGRAM WILL RESUME FOR      04836700
048368** FREIGHT BILLS WITH PRO DATE AFTER 12/15/2021                   04836800
048369**                                                                04836900
048370** 12/2/21 - ADDED 7 SEPHORA VENDORS AND EXTENDED DATE TO 2/1/202304837000
048380**                                                                04838000
048390     05  PV-COLLECT-PGM-MESSAGE      PIC X(36) VALUE              04839000
048400         'COLLECT PGM - PICKUP/CONSOL FEES'.                      04840000
048410     05  PV-CARRIER-AUTH-NUMBER      PIC X(12).                   04841000
048420     05  PV-CARRIER-FLDS REDEFINES PV-CARRIER-AUTH-NUMBER.        04842000
048430         10  PV-CARRIER-FLD1         PIC X.                       04843000
048440         10  PV-CARRIER-FLD2         PIC X.                       04844000
048450         10  PV-CARRIER-FLD3         PIC X.                       04845000
048460         10  PV-CARRIER-FLD4         PIC X.                       04846000
048470         10  PV-CARRIER-FLD5         PIC X.                       04847000
048480         10  PV-CARRIER-FLD6         PIC X.                       04848000
048490         10  PV-CARRIER-FLD7         PIC X.                       04849000
048500         10  PV-CARRIER-FLD8         PIC X.                       04850000
048600         10  PV-CARRIER-FLD9         PIC X.                       04860000
048700         10  PV-CARRIER-FLD10        PIC X.                       04870000
048800         10  PV-CARRIER-FLD11        PIC X.                       04880000
048900         10  PV-CARRIER-FLD12        PIC X.                       04890000
049000     05  PV-NEW-CARRIER-FLDS.                                     04900000
049100         10  PV-NEW-CARRIER-FLD1     PIC X.                       04910000
049200         10  PV-NEW-CARRIER-FLD2     PIC X.                       04920000
049300         10  PV-NEW-CARRIER-FLD3     PIC X.                       04930000
049400         10  PV-NEW-CARRIER-FLD4     PIC X.                       04940000
049500         10  PV-NEW-CARRIER-FLD5     PIC X.                       04950000
049600         10  PV-NEW-CARRIER-FLD6     PIC X.                       04960000
049700         10  PV-NEW-CARRIER-FLD7     PIC X.                       04970000
049800         10  PV-NEW-CARRIER-FLD8     PIC X.                       04980000
049900         10  PV-NEW-CARRIER-FLD9     PIC X.                       04990000
050000         10  PV-NEW-CARRIER-FLD10    PIC X.                       05000000
050100         10  PV-NEW-CARRIER-FLD11    PIC X.                       05010000
050200         10  PV-NEW-CARRIER-FLD12    PIC X.                       05020000
050300                                                                  05030000
050400 01  DISPLAY-FIELDS.                                              05040000
050500     05  DISPLAY-ADJUSTED-FRGT-AMT   PIC -ZZZZZZZZ9.99.           05050000
050600     05  DISPLAY-FRGT-AMT            PIC -ZZZZZZZZ9.99.           05060000
050700                                                                  05070000
050800 01  TRAN-CODE-TABLE.                                             05080000
050900     05  TC-TABLE OCCURS 2 TIMES INDEXED BY TC-IDX.               05090000
051000         10 TC-AP-TRN-CDE            PIC X(2).                    05100000
051100         10 TC-SUB-CL-REQR-IND       PIC X(1).                    05110000
051200         10 TC-SKU-SEQ-REQR-IND      PIC X(1).                    05120000
051300         10 TC-AUTO-OFFST-TRN-CDE    PIC X(21).                   05130000
051400         10 TC-PSTG-TYP-CDE          PIC X(2).                    05140000
051500         10 TC-TRN-TYP-CDE           PIC X(3).                    05150000
051600         10 TC-GL-ACCT-NBR           PIC X(6).                    05160000
051700         10 TC-BTCH-SRC-CDE          PIC X(3).                    05170000
051800                                                                  05180000
051900 01  WS-LOCATION-TABLE-AREA.                                      05190000
052000     05 WS-LOCATION-TABLE OCCURS 1500 TIMES INDEXED BY LOC-INDX.  05200000
052100        10  WS-STORE-NBR        PIC S9(4) COMP.                   05210000
052200        10  WS-STORE-TYP-CDE    PIC X(2).                         05220000
052300                                                                  05230000
052400 01  SEPHORA-DEPT-TABLE.                                          05240000
052500     05 PV-SEPHORA-DEPTS     OCCURS 25  TIMES  INDEXED BY SD-IDX. 05250000
052600       15 PV-SEPHORA-DEPT          PIC X(3) VALUE SPACES.         05260000
052700                                                                  05270000
052800 01  SEPHORA-ENTID-TABLE.                                         05280000
052900     05 PV-SEPHORA-ENTIDS    OCCURS 500 TIMES  INDEXED BY SE-IDX. 05290000
053000       15 PV-SEPHORA-ENTID         PIC S9(9) COMP VALUE ZEROS.    05300000
053100                                                                  05310000
053200 01  HT-HASH-TOTAL-RECORD.                                        05320000
053300     05  HT-FREIGHT-AMT              PIC  X(12)  VALUE SPACE.     05330000
053310     05  FILLER                      PIC  X(68)  VALUE SPACE.     05331000
053320 EJECT                                                            05332000
053330*--------------------------------------------------------------*  05333000
053340*     TPURCHS DCLGEN                                           *  05334000
053350*--------------------------------------------------------------*  05335000
053360     EXEC SQL                                                     05336000
053370         INCLUDE TPURCHS                                          05337000
053380     END-EXEC.                                                    05338000
053390 EJECT                                                            05339000
053400*--------------------------------------------------------------*  05340000
053500*     TEXTENT DCLGEN                                           *  05350000
053600*--------------------------------------------------------------*  05360000
053700     EXEC SQL                                                     05370000
053800         INCLUDE TEXTENT                                          05380000
053900     END-EXEC.                                                    05390000
054000 EJECT                                                            05400000
054100*--------------------------------------------------------------*  05410000
054200*     VNT_VND_CPBL                                             *  05420000
054300*--------------------------------------------------------------*  05430000
054400     EXEC SQL                                                     05440000
054500         INCLUDE VNT00001                                         05450000
054600     END-EXEC.                                                    05460000
054700 EJECT                                                            05470000
054800*--------------------------------------------------------------*  05480000
054900*  COMMUNICATIONS AREA2 FOR DB2                                *  05490000
055000*--------------------------------------------------------------*  05500000
055100     COPY SQLCA2.                                                 05510000
055200*--------------------------------------------------------------*  05520000
055300*     SQL COMMUNICATIONS AREA DCLGEN                           *  05530000
055400*--------------------------------------------------------------*  05540000
055500     EXEC SQL                                                     05550000
055600         INCLUDE SQLCA                                            05560000
055700     END-EXEC.                                                    05570000
055800 EJECT                                                            05580000
055900*--------------------------------------------------------------*  05590000
056000*  AP CONTROL TABLE                                            *  05600000
056100*--------------------------------------------------------------*  05610000
056200     EXEC SQL                                                     05620000
056300          INCLUDE TAPCNTL                                         05630000
056400     END-EXEC.                                                    05640000
056500 EJECT                                                            05650000
056600*--------------------------------------------------------------*  05660000
056700*  ADJUSTMENT PRORATE TABLE                                    *  05670000
056800*--------------------------------------------------------------*  05680000
056900     EXEC SQL                                                     05690000
057000          INCLUDE TAJPRRT                                         05700000
057100     END-EXEC.                                                    05710000
057200 EJECT                                                            05720000
057300*--------------------------------------------------------------*  05730000
057400*  TRANSACTION CODE TABLE                                      *  05740000
057500*--------------------------------------------------------------*  05750000
057600     EXEC SQL                                                     05760000
057700          INCLUDE TTRNCDE                                         05770000
057800     END-EXEC.                                                    05780000
057900 EJECT                                                            05790000
058000*--------------------------------------------------------------*  05800000
058100*  MERCHANDISE DEPARTMENT TABLE                                *  05810000
058200*--------------------------------------------------------------*  05820000
058300     EXEC SQL                                                     05830000
058400          INCLUDE TMDSEAR                                         05840000
058500     END-EXEC.                                                    05850000
058600 EJECT                                                            05860000
058700*--------------------------------------------------------------*  05870000
058800*  ENTITY NAME TABLE                                           *  05880000
058900*--------------------------------------------------------------*  05890000
059000     EXEC SQL                                                     05900000
059100          INCLUDE TENTNME                                         05910000
059200     END-EXEC.                                                    05920000
059300 EJECT                                                            05930000
059400*--------------------------------------------------------------*  05940000
059500*  LOCATION TABLE                                              *  05950000
059600*--------------------------------------------------------------*  05960000
059700     EXEC SQL                                                     05970000
059800          INCLUDE XFT00017                                        05980000
059900     END-EXEC.                                                    05990000
060000 EJECT                                                            06000000
060100*--------------------------------------------------------------*  06010000
060200*     TRECEIV DCLGEN                                           *  06020000
060300*--------------------------------------------------------------*  06030000
060400     EXEC SQL                                                     06040000
060500         INCLUDE TRECEIV                                          06050000
060600     END-EXEC.                                                    06060000
060700*--------------------------------------------------------------*  06070000
060800*  HOLD_CSR FOR TEMPORARY TAJPRRT TABLE                        *  06080000
060900*--------------------------------------------------------------*  06090000
061000     EXEC SQL                                                     06100000
061100       DECLARE HOLD_CSR CURSOR WITH HOLD FOR                      06110000
061200         SELECT *                                                 06120000
061300           FROM TAJPRRT                                           06130000
061400     END-EXEC.                                                    06140000
061500 EJECT                                                            06150000
061600*--------------------------------------------------------------*  06160000
061700*  PO_PRORATION_CSR FOR TAJPRRT TABLE                          *  06170000
061800*--------------------------------------------------------------*  06180000
061900     EXEC SQL                                                     06190000
062000       DECLARE PO_PRORATION_CSR CURSOR FOR                        06200000
062100       SELECT PO_NBR                                              06210000
062200            , RCVR_SEQ_NBR                                        06220000
062300            , PO_LNE_NBR                                          06230000
062400            , DEPT_NBR                                            06240000
062500            , CL_NBR                                              06250000
062600            , SKU_NBR                                             06260000
062700            , STR_NBR                                             06270000
062800            , PRRT_PCT                                            06280000
062900         FROM TAJPRRT                                             06290000
063000        WHERE PO_NBR = :PO-BEING-PROCESSED                        06300000
063100     END-EXEC.                                                    06310000
063200 EJECT                                                            06320000
063300*--------------------------------------------------------------*  06330000
063400*  TRN_CDE_CSR FOR TTRNCDE TABLE                               *  06340000
063500*--------------------------------------------------------------*  06350000
063600     EXEC SQL                                                     06360000
063700       DECLARE TRN_CDE_CSR CURSOR FOR                             06370000
063800       SELECT AP_TRN_CDE                                          06380000
063900            , SUB_CL_REQR_IND                                     06390000
064000            , SKU_SEQ_REQR_IND                                    06400000
064100            , AUTO_OFFST_TRN_CDE                                  06410000
064200            , PSTG_TYP_CDE                                        06420000
064300            , TRN_TYP_CDE                                         06430000
064400            , GL_ACCT_NBR                                         06440000
064500            , BTCH_SRC_CDE                                        06450000
064600         FROM TTRNCDE                                             06460000
064700        WHERE AP_TRN_CDE    IN ('45','46')                        06470000
064800          AND CURRENT DATE  BETWEEN EFF_STRT_DTE AND              06480000
064900                                    EFF_END_DTE                   06490000
065000     END-EXEC.                                                    06500000
065100 EJECT                                                            06510000
065200*--------------------------------------------------------------*  06520000
065300*  LOCATION_CSR FOR XFT_LOC TABLE                              *  06530000
065400*--------------------------------------------------------------*  06540000
065500     EXEC SQL                                                     06550000
065600       DECLARE LOCATION_CSR CURSOR FOR                            06560000
065700       SELECT LOC_NBR                                             06570000
065800            , LOC_TYP_CDE                                         06580000
065900         FROM XFT_LOC                                             06590000
066000        WHERE FINCL_CLO_DTE > CURRENT DATE                        06600000
066100     END-EXEC.                                                    06610000
066200 EJECT                                                            06620000
066300*--------------------------------------------------------------*  06630000
066400*  SEPHORA ENTID CURSOR                                        *  06640000
066500*--------------------------------------------------------------*  06650000
066600     EXEC SQL                                                     06660000
066700       DECLARE SEPHORA_ENTID_CSR CURSOR FOR                       06670000
066800       SELECT ENT_ID                                              06680000
066900         FROM VNT_VND_CPBL                                        06690000
067000        WHERE VND_CPBL_CDE = 'SBS'                                06700000
067100          AND EFF_BEG_DTE <= CURRENT DATE                         06710000
067200          AND EFF_END_DTE >= CURRENT DATE                         06720000
067300     END-EXEC.                                                    06730000
067400 EJECT                                                            06740000
067500*----------------------------------------------------------------*06750000
067600*    SEPHORA DEPT CURSOR TO SELECT 'SEPHORA @ KOHLS' DEPTS        06760000
067700*    NOTE THAT THERE ARE SEPHORA VENDORS IN OTHER DEPTS - THOSE   06770000
067800*    ARE TREATED AS ANY OTHER KOHL'S VENDOR                       06780000
067900*----------------------------------------------------------------*06790000
068000     EXEC SQL                                                     06800000
068100         DECLARE SEPHORA_DEPT_CSR CURSOR FOR                      06810000
068200             SELECT DEPT_NBR                                      06820000
068300             FROM   TMDSEAR                                       06830000
068400             WHERE  DMA_NBR = '50'                                06840000
068500               AND  MDSELV_CDE = 'DPT'                            06850000
068600                AND STRT_DTE      <= CURRENT DATE                 06860000
068700                AND END_DTE       >= CURRENT DATE                 06870000
068800             ORDER BY DEPT_NBR                                    06880000
068900     END-EXEC.                                                    06890000
069000*--------------------------------------------------------------*  06900000
069100* CALL PARAMETERS FOR THE NUMERIC EDIT SUBROUTINE              *  06910000
069200*--------------------------------------------------------------*  06920000
069300     COPY DPWS010I.                                               06930000
069400 EJECT                                                            06940000
069500                                                                  06950000
069600*--------------------------------------------------------------*  06960000
069700*   RECORD LAYOUT FOR THE ADJUSTMENT JOURNAL TRANSACTION FILE  *  06970000
069800*--------------------------------------------------------------*  06980000
069900     COPY APRD045.                                                06990000
070000 EJECT                                                            07000000
070100                                                                  07010000
070200*--------------------------------------------------------------*  07020000
070300*   RECORD LAYOUT CONTAINING THE LINKAGE SECTION FOR DPKUP150  *  07030000
070400*--------------------------------------------------------------*  07040000
070500     COPY APWS150.                                                07050000
070600     COPY DPWS950.                                                07060000
070700 EJECT                                                            07070000
070800                                                                  07080000
070900*--------------------------------------------------------------*  07090000
071000*   RECORD LAYOUT CONTAINING THE LINKAGE SECTION FOR APKUP352  *  07100000
071100*--------------------------------------------------------------*  07110000
071200     COPY APWS035.                                                07120000
071300 EJECT                                                            07130000
071400                                                                  07140000
071500*--------------------------------------------------------------*  07150000
071600*   RECORD LAYOUT CONTAINING THE LINKAGE SECTION FOR DPKUP151  *  07160000
071700*--------------------------------------------------------------*  07170000
071800     COPY APWS151.                                                07180000
071900     COPY DPWS951.                                                07190000
072000 EJECT                                                            07200000
072100                                                                  07210000
072200*--------------------------------------------------------------*  07220000
072300* FREIGHT RECORD COPYBOOK                                      *  07230000
072400*--------------------------------------------------------------*  07240000
072500     COPY APRD023.                                                07250000
072600 EJECT                                                            07260000
072700                                                                  07270000
072800*--------------------------------------------------------------*  07280000
072900* REPORT STANDARD HEADER COPYBOOK                              *  07290000
073000*--------------------------------------------------------------*  07300000
073100     COPY DPWS150O.                                               07310000
073200 EJECT                                                            07320000
073300                                                                  07330000
073400 01  REPORT-CONTROLS.                                             07340000
073500     05  PAGE-COUNT        PIC S9(4)  COMP-3 VALUE +0.            07350000
073600     05  LINE-COUNT        PIC S9(4)  COMP-3 VALUE +0.            07360000
073700                                                                  07370000
073800 01  HDR-LINE-1.                                                  07380000
073900         10  FILLER        PIC X(59) VALUE SPACES.                07390000
074000         10  FILLER        PIC X(73) VALUE                        07400000
074100            'FREIGHT EDIT ERRORS   '.                             07410000
074200                                                                  07420000
074300 01  HDR-LINE-2.                                                  07430000
074400     05  FILLER            PIC X(07)   VALUE 'TRIP ID'.           07440000
074500     05  FILLER            PIC X(04)   VALUE SPACE.               07450000
074600     05  FILLER            PIC X(07)   VALUE 'PO NBR '.           07460000
074700     05  FILLER            PIC X(04)   VALUE SPACE.               07470000
074800     05  FILLER            PIC X(07)   VALUE 'DOC NBR'.           07480000
074900     05  FILLER            PIC X(08)   VALUE SPACES.              07490000
075000     05  FILLER            PIC X(08)   VALUE 'KEY REC '.          07500000
075100     05  FILLER            PIC X(02)   VALUE SPACE.               07510000
075200     05  FILLER            PIC X(05)   VALUE 'STORE'.             07520000
075300     05  FILLER            PIC X(02)   VALUE SPACE.               07530000
075400     05  FILLER            PIC X(04)   VALUE 'DEPT'.              07540000
075500     05  FILLER            PIC X(02)   VALUE SPACE.               07550000
075600     05  FILLER            PIC X(05)   VALUE 'CLASS'.             07560000
075700     05  FILLER            PIC X(05)   VALUE SPACES.              07570000
075800     05  FILLER            PIC X(06)   VALUE 'AMOUNT'.            07580000
075900     05  FILLER            PIC X(03)   VALUE SPACES.              07590000
076000     05  FILLER            PIC X(17)   VALUE 'EXCEPTION MESSAGE'. 07600000
076100     05  FILLER            PIC X(54)   VALUE SPACES.              07610000
076200                                                                  07620000
076300 01  DETAIL-LINE.                                                 07630000
076400     05  DL-TRIP-ID        PIC X(09).                             07640000
076500     05  FILLER            PIC X(02)   VALUE SPACE.               07650000
076600     05  DL-PO-NBR         PIC X(09).                             07660000
076700     05  FILLER            PIC X(02)   VALUE SPACE.               07670000
076800     05  DL-DOC-NBR        PIC X(13).                             07680000
076900     05  FILLER            PIC X(02)   VALUE SPACE.               07690000
077000     05  DL-KEY-REC        PIC X(08).                             07700000
077100     05  FILLER            PIC X(02)   VALUE SPACE.               07710000
077200     05  DL-STORE-NBR      PIC X(04).                             07720000
077300     05  FILLER            PIC X(03)   VALUE SPACES.              07730000
077400     05  DL-DEPT-NBR       PIC X(03).                             07740000
077500     05  FILLER            PIC X(03)   VALUE SPACES.              07750000
077600     05  DL-CLASS-NBR      PIC X(02).                             07760000
077700     05  FILLER            PIC X(05)   VALUE SPACES.              07770000
077800     05  DL-AMT-PAID-X.                                           07780000
077900         10  DL-AMT-PAID   PIC -ZZZZZ.ZZ VALUE ZERO.              07790000
078000     05  FILLER            PIC X(03)   VALUE SPACE.               07800000
078100     05  DL-MESSAGE-AREA   PIC X(71)   VALUE SPACES.              07810000
078200     05  FILLER REDEFINES DL-MESSAGE-AREA.                        07820000
078300         10 DL-MESSAGE-A1  PIC X(30).                             07830000
078400         10 DL-MESSAGE-A2  PIC X(30).                             07840000
078500         10 DL-MESSAGE-A3  PIC X(11).                             07850000
078600                                                                  07860000
078700 01  REPORT-TOTAL-LINE1.                                          07870000
078800     05  FILLER            PIC X(29)                              07880000
078900                           VALUE '** TOTAL NUMBER OF ERRORS  = '. 07890000
079000     05  TL-ERROR-RECORDS  PIC ZZZZ9  VALUE ZERO.                 07900000
079100                                                                  07910000
079200 01  REPORT-TOTAL-LINE2.                                          07920000
079300     05  FILLER            PIC X(29)                              07930000
079400                           VALUE 'TOTAL NUMBER OF MESSAGES   = '. 07940000
079500     05  TL-EXCPT-RECORDS  PIC ZZZZ9  VALUE ZERO.                 07950000
079600                                                                  07960000
079700 01  ABEND-CODE            PIC S9(04)  VALUE ZEROS COMP SYNC.     07970000
079800     88  AC-BAD-WRITE                        VALUE +4001.         07980000
079900     88  AC-CONTROL-CARD-ERROR               VALUE +4003.         07990000
080000     88  AC-OPEN-ERROR                       VALUE +4005.         08000000
080100     88  AC-CLOSE-ERROR                      VALUE +4006.         08010000
080200     88  AC-BAD-DATA                         VALUE +4008.         08020000
080300     88  AC-TABLE-OVERFLOW                   VALUE +4009.         08030000
080400     88  AC-DB2-ERROR                        VALUE +4013.         08040000
080500     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         08050000
080600     88  AC-MAX-RETRIES-EXCEEDED             VALUE +4016.         08060000
080700     88  AC-DATE-ERROR                       VALUE +4019.         08070000
080800                                                                  08080000
080900 01  ABEND-AREAS.                                                 08090000
081000     05  AA-ABEND-LIT            PIC  X(40)  VALUE                08100000
081100             '*****       ABEND'.                                 08110000
081200     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                08120000
081300             '*****   PROGRAM: APKUP130'.                         08130000
081400     05  AA-PARAGRAPH-LIT.                                        08140000
081500         10  FILLER              PIC  X(17)  VALUE                08150000
081600             '***** PARAGRAPH: '.                                 08160000
081700         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        08170000
081800     05  AA-MESSAGE-LINE.                                         08180000
081900         10  FILLER              PIC  X(06)  VALUE '*****'.       08190000
082000         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        08200000
082100         10  FILLER REDEFINES AA-MESSAGE.                         08210000
082200             15 AA-MESSAGE-1     PIC  X(45).                      08220000
082300             15 AA-MESSAGE-2     PIC  X(45).                      08230000
082400             15 AA-MESSAGE-3     PIC  X(37).                      08240000
082500     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                08250000
082600             '*****    DB2 ERROR'.                                08260000
082700     05  AA-DB2-OPERATION-LIT.                                    08270000
082800         10  FILLER              PIC  X(17)  VALUE                08280000
082900             '***** OPERATION: '.                                 08290000
083000         10  AA-DB2-OPERATION.                                    08300000
083100             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        08310000
083200             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        08320000
083300     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        08330000
083400     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        08340000
083500     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        08350000
083600 EJECT                                                            08360000
083700                                                                  08370000
083800     COPY DPWS004.                                                08380000
083900 EJECT                                                            08390000
084000                                                                  08400000
084100************************                                          08410000
084200 PROCEDURE DIVISION.                                              08420000
084300************************                                          08430000
084400 A100-MAINLINE-ROUTINE.                                           08440000
084500                                                                  08450000
084600     PERFORM B100-INITIALIZATION.                                 08460000
084700                                                                  08470000
084800     PERFORM B200-CREATE-FRGT-ADJ-FILE                            08480000
084900         UNTIL  FREIGHT-EOF.                                      08490000
085000                                                                  08500000
085100     PERFORM B300-TERMINATION.                                    08510000
085200                                                                  08520000
085300     GOBACK.                                                      08530000
085400                                                                  08540000
085500*--------------------------------------------------------------*  08550000
085600*    INITIALIZATION PROCESSING                                 *  08560000
085700*--------------------------------------------------------------*  08570000
085800 B100-INITIALIZATION.                                             08580000
085900                                                                  08590000
086000     DISPLAY ' '.                                                 08600000
086100     DISPLAY '*------------ PROGRAM:  APKUP130 ------------*'.    08610000
086200     DISPLAY '  RUN DATE = ' FUNCTION CURRENT-DATE(1:8)           08620000
086300             '  RUN TIME = ' FUNCTION CURRENT-DATE(9:6).          08630000
086400     DISPLAY ' '.                                                 08640000
086500                                                                  08650000
086600     OPEN INPUT  FREIGHT-FILE                                     08660000
086700          OUTPUT REPORT-FILE                                      08670000
086800                 FRGT-ADJ-FILE.                                   08680000
086900                                                                  08690000
087000     PERFORM Y100-OPEN-HOLD-CSR.                                  08700000
087100                                                                  08710000
087200     INITIALIZE DCLTPURCHS                                        08720000
087300                DCLTEXTENT                                        08730000
087400                DCLTAPCNTL                                        08740000
087500                DCLTTRNCDE                                        08750000
087600                DCLTAJPRRT                                        08760000
087700                DCLTMDSEAR                                        08770000
087800                DCLTENTNME                                        08780000
087900                DCLXFT00017                                       08790000
088000                REPORT-RECORD                                     08800000
088100                TRAN-CODE-TABLE.                                  08810000
088200     INITIALIZE PS-VALID-PO-NBR-SW                                08820000
088300*               PS-VALID-DEPT-CL-SW                               08830000
088400                PS-VALID-TRIP-ID-SW                               08840000
088500                PS-TRECEIV-FOUND-SW                               08850000
088600                PS-TRECEIV-PO-FOUND-SW.                           08860000
088700                                                                  08870000
088800     ACCEPT PV-SYSTEM-DATE FROM DATE.                             08880000
088900     MOVE PV-SYSTEM-YEAR   TO DP150O-RUN-YEAR                     08890000
089000                              PV-ENTR-DTE-YY.                     08900000
089100     MOVE PV-SYSTEM-MONTH  TO DP150O-RUN-MONTH                    08910000
089200                              PV-ENTR-DTE-MM.                     08920000
089300     MOVE PV-SYSTEM-DAY    TO DP150O-RUN-DAY                      08930000
089400                              PV-ENTR-DTE-DD.                     08940000
089500                                                                  08950000
089600     MOVE '20'             TO PV-ENTR-DTE-CC.                     08960000
089700     MOVE '-'              TO PV-ENTR-DTE-DASH1                   08970000
089800                              PV-ENTR-DTE-DASH2.                  08980000
089900                                                                  08990000
090000     ACCEPT PV-SYSTEM-TIME FROM TIME.                             09000000
090100     MOVE PV-SYSTEM-HOUR   TO DP150O-RUN-HOUR.                    09010000
090200     MOVE PV-SYSTEM-MINUTE TO DP150O-RUN-MINUTE.                  09020000
090300     MOVE PC-PROGRAM-NAME  TO DP150O-PROGRAM-NAME.                09030000
090400     MOVE 1                TO DP150O-REPORT-NUMBER.               09040000
090500                                                                  09050000
090600     MOVE '-'              TO PV-TIMESTAMP-HYPHEN.                09060000
090700     MOVE PV-SYSTEM-HOUR   TO PV-TIMESTAMP-HH.                    09070000
090800     MOVE '.'              TO PV-TIMESTAMP-PERIOD1.               09080000
090900     MOVE PV-SYSTEM-MINUTE TO PV-TIMESTAMP-MM.                    09090000
091000     MOVE '.'              TO PV-TIMESTAMP-PERIOD2.               09100000
091100     MOVE PV-SYSTEM-SECOND TO PV-TIMESTAMP-SS.                    09110000
091200     MOVE '.'              TO PV-TIMESTAMP-PERIOD3.               09120000
091300     MOVE ZEROES           TO PV-TIMESTAMP-XXXXXX.                09130000
091400                                                                  09140000
091500     PERFORM W100-WRITE-REPORT-HEADERS.                           09150000
091600                                                                  09160000
091700     PERFORM T100-GET-SEPHORA-ENTIDS.                             09170000
091800     PERFORM T500-GET-SEPHORA-DEPTS.                              09180000
091900                                                                  09190000
092000     SET TC-IDX TO 1.                                             09200000
092010     PERFORM S960-SELECT-DEFAULT-INFO.                            09201000
092020     PERFORM Y300-OPEN-TRN-CDE-CSR.                               09202000
092030     PERFORM S200-FETCH-TRN-CDE-CSR.                              09203000
092040     PERFORM C500-FILL-TRAN-CODE-TABLE                            09204000
092050       UNTIL END-OF-TRN-CDE-CSR.                                  09205000
092060     PERFORM Y700-CLOSE-TRN-CDE-CSR.                              09206000
092070                                                                  09207000
092080     PERFORM X100-OPEN-LOCATION-CSR.                              09208000
092090     PERFORM X200-LOAD-LOCATION-TBL.                              09209000
092100     PERFORM X300-CLOSE-LOCATION-CSR.                             09210000
092200                                                                  09220000
092300     PERFORM X400-COMMIT.                                         09230000
092400                                                                  09240000
092500** ACCEPT AND EDIT CONTROL FREIGHT AMOUNT                         09250000
092600     PERFORM R100-READ-FREIGHT-FILE.                              09260000
092700                                                                  09270000
092800     IF FREIGHT-EOF                                               09280000
092900        MOVE 'B100-INITIALIZATION'      TO AA-PARAGRAPH-LIT       09290000
093000        MOVE 'NO DATA ON FREIGHT FILE ' TO AA-MESSAGE             09300000
093100        PERFORM Z999-ABEND                                        09310000
093200     END-IF.                                                      09320000
093300                                                                  09330000
093400     IF AP023-TOTAL-INDICATOR = '***************'                 09340000
093500        IF AP023-HASH-TOTAL NUMERIC                               09350000
093600           MOVE AP023-HASH-TOTAL      TO PV-FREIGHT-AMT           09360000
093700        ELSE                                                      09370000
093800           MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-LIT         09380000
093900           MOVE 'INVALID HASH TOTAL ' TO AA-MESSAGE               09390000
094000           PERFORM Z999-ABEND                                     09400000
094100        END-IF                                                    09410000
094200     ELSE                                                         09420000
094300        MOVE 'B100-INITIALIZATION'           TO AA-PARAGRAPH-NAME 09430000
094400        MOVE 'FIRST RECORD NOT TOTAL RECORD' TO AA-MESSAGE        09440000
094500        PERFORM Z999-ABEND                                        09450000
094600     END-IF.                                                      09460000
094700                                                                  09470000
094800     MOVE AP023-HASH-TOTAL TO PRT-HASH-TOTAL.                     09480000
094900     DISPLAY 'HT-HASH-TOTAL-RECORD (FREIGHT AMOUNT) FOLLOWS:'.    09490000
095000     DISPLAY PRT-HASH-TOTAL.                                      09500000
095100                                                                  09510000
095200** READ AND EDIT VARIANCE PERCENT RECORD                          09520000
095300     PERFORM S100-SELECT-CONTROL-DATA.                            09530000
095400     DISPLAY '**** VARIANCE PCT ' APCNTL-INVC-RCV-VAR-PCT.        09540000
095500     IF  APCNTL-INVC-RCV-VAR-PCT < 0                              09550000
095600         SET  AC-CONTROL-CARD-ERROR TO TRUE                       09560000
095700         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          09570000
095800         MOVE 'VARIANCE AMOUNT ENTERED IS NOT VALID'              09580000
095900                                    TO AA-MESSAGE                 09590000
096000         PERFORM Z999-ABEND                                       09600000
096100     ELSE                                                         09610000
096200         MOVE APCNTL-INVC-RCV-VAR-PCT TO PV-VARIANCE-PERCENT      09620000
096300     END-IF.                                                      09630000
096400                                                                  09640000
096500     DISPLAY '**** PV-FREIGHT-AMT '  PV-FREIGHT-AMT.              09650000
096600     COMPUTE PV-VARIANCE-AMOUNT =                                 09660000
096700             (PV-FREIGHT-AMT * (PV-VARIANCE-PERCENT / 100)).      09670000
096800     DISPLAY '**** PV-VARIANCE-AMT '  PV-VARIANCE-AMOUNT.         09680000
096900                                                                  09690000
097000     PERFORM R100-READ-FREIGHT-FILE.                              09700000
097100                                                                  09710000
097200 EJECT                                                            09720000
097300                                                                  09730000
097400* -------------------------------------------------------------*  09740000
097500*  THIS PARAGRAPH VALIDATES THAT THE FREIGHT FILE IS VALID,    *  09750000
097600*  USING THE C100- PARAGRAPH AND DETERMINES WEATHER TO CREATE  *  09760000
097700*  CREATE A SINGLE OR MULTIPLE TRANSACTION(S) BASED ON A       *  09770000
097800*  VALID PO NUMBER.                                            *  09780000
097900*--------------------------------------------------------------*  09790000
098000 B200-CREATE-FRGT-ADJ-FILE.                                       09800000
098100                                                                  09810000
098200     PERFORM C100-EDIT-FREIGHT-FILE.                              09820000
098300                                                                  09830000
098400     IF EDIT-ERROR                                                09840000
098500        ADD 1 TO FREIGHT-ERROR-RECORDS                            09850000
098600        MOVE 'N' TO EDIT-SW                                       09860000
098700     ELSE                                                         09870000
098800        IF INVALID-PO-NBR OR TRECEIV-PO-NOT-FOUND                 09880000
098900           PERFORM C200-CREATE-SINGLE-TRANS                       09890000
099000        ELSE                                                      09900000
099100           PERFORM C300-CREATE-MULTI-PO-TRANS                     09910000
099200        END-IF                                                    09920000
099300                                                                  09930000
099400        IF VALID-PO-NBR                                           09940000
099500           AND AP023-FR-PRO-DATE >= '20030301'                    09950000
099600               PERFORM C600-LOOK-FOR-COLLECT-PGM                  09960000
099700        END-IF                                                    09970000
099800     END-IF.                                                      09980000
099900                                                                  09990000
100000     INITIALIZE PS-VALID-PO-NBR-SW                                10000000
100100*               PS-VALID-DEPT-CL-SW                               10010000
100200                PS-VALID-TRIP-ID-SW                               10020000
100300                PS-TRECEIV-FOUND-SW                               10030000
100400                PS-TRECEIV-PO-FOUND-SW.                           10040000
100500     PERFORM R100-READ-FREIGHT-FILE.                              10050000
100600 EJECT                                                            10060000
100700                                                                  10070000
100800*---------------------------------------------------------------* 10080000
100900*  END OF PROGRAM PROCESSING:                                   * 10090000
101000*  1)  DISPLAYS RECORD COUNTS AND TOTALS.                       * 10100000
101100*  2)  VERIFY THE CALCULATED TOTAL AGREES WITH THE HASH TOTAL   * 10110000
101200*      FROM THE CONTROL CARD WITHIN THE TOLERANCE LIMIT.        * 10120000
101300*  3)  CREATES THE GL OFFSET ENTRIES                            * 10130000
101400*  4)  CLOSES THE HOLD CURSOR, INPUT AND OUTPUT FILES.          * 10140000
101500*---------------------------------------------------------------* 10150000
101600 B300-TERMINATION.                                                10160000
101700                                                                  10170000
101800     MOVE FREIGHT-RECORDS-IN      TO PRT-FREIGHT-RECORDS-IN.      10180000
101900     MOVE FREIGHT-RECORDS-OUT     TO PRT-FREIGHT-RECORDS-OUT.     10190000
102000     MOVE FREIGHT-ERROR-RECORDS   TO PRT-FREIGHT-ERROR-RECORDS    10200000
102100                                     TL-ERROR-RECORDS.            10210000
102200     MOVE FREIGHT-EXCPT-RECORDS   TO PRT-FREIGHT-EXCPT-RECORDS    10220000
102300                                     TL-EXCPT-RECORDS.            10230000
102400     MOVE TOTAL-FREIGHT-AMOUNT-IN TO PRT-TOTAL-FREIGHT-AMOUNT-IN. 10240000
102500*** THE TOTAL-FREIGHT-CREDIT-AMT AND TOTAL-FREIGHT-CHARGE-AMT     10250000
102600*** RELATE TO THE OFFSET AMOUNTS.  AS A RESULT, EACH HAS TO BE    10260000
102700*** MULTIPLIED BY -1 TO GET THE INPUT CREDIT AND CHARGE AMOUNTS   10270000
102800*** FOR DISPLAY IN THE CLOSING INFORMATION.                       10280000
102900     COMPUTE TOTAL-FREIGHT-DSPLY-CREDIT-AMT =                     10290000
103000         TOTAL-FREIGHT-CHARGE-AMT * -1.                           10300000
103100     COMPUTE TOTAL-FREIGHT-DSPLY-CHARGE-AMT =                     10310000
103200         TOTAL-FREIGHT-CREDIT-AMT * -1.                           10320000
103300     MOVE TOTAL-FREIGHT-DSPLY-CREDIT-AMT                          10330000
103400       TO PRT-TOTAL-FREIGHT-CREDIT-AMT.                           10340000
103500     MOVE TOTAL-FREIGHT-DSPLY-CHARGE-AMT                          10350000
103600       TO PRT-TOTAL-FREIGHT-CHARGE-AMT.                           10360000
103700                                                                  10370000
103800     DISPLAY '*******************************************'.       10380000
103900     DISPLAY '********  CLOSING APKUP130  ***************'.       10390000
104000     DISPLAY '*******************************************'.       10400000
104100     DISPLAY 'RECORDS IN    = ' PRT-FREIGHT-RECORDS-IN.           10410000
104200     DISPLAY 'AMOUNT IN     = ' PRT-TOTAL-FREIGHT-AMOUNT-IN.      10420000
104300     DISPLAY 'CREDIT AMT    = ' PRT-TOTAL-FREIGHT-CREDIT-AMT.     10430000
104400     DISPLAY 'CHARGE AMT    = ' PRT-TOTAL-FREIGHT-CHARGE-AMT.     10440000
104500     DISPLAY 'ERROR RECORDS = ' PRT-FREIGHT-ERROR-RECORDS.        10450000
104600     DISPLAY 'EXCEPTION REC = ' PRT-FREIGHT-EXCPT-RECORDS.        10460000
104700     DISPLAY 'RECORDS OUT   = ' PRT-FREIGHT-RECORDS-OUT.          10470000
104800     DISPLAY '*******************************************'.       10480000
104900                                                                  10490000
105000     PERFORM W400-WRITE-REPORT-TOTALS.                            10500000
105100                                                                  10510000
105200     SUBTRACT TOTAL-FREIGHT-AMOUNT-IN FROM PV-FREIGHT-AMT         10520000
105300         GIVING PV-ACTUAL-DIFFERENCE.                             10530000
105400     DISPLAY 'PV-VARIANCE-AMOUNT = '   PV-VARIANCE-AMOUNT.        10540000
105500     DISPLAY 'PV-ACTUAL-DIFFERENCE = ' PV-ACTUAL-DIFFERENCE.      10550000
105600                                                                  10560000
105700     IF  PV-ACTUAL-DIFFERENCE > PV-VARIANCE-AMOUNT                10570000
105800         SET AC-BAD-DATA TO TRUE                                  10580000
105900         MOVE 'B300-TERMINATION'   TO AA-PARAGRAPH-NAME           10590000
106000         MOVE  'INPUT FREIGHT AMOUNT IS NOT WITHIN VARIANCE'      10600000
106100                                   TO AA-MESSAGE                  10610000
106200         PERFORM Z999-ABEND                                       10620000
106300     END-IF.                                                      10630000
106400                                                                  10640000
106500     PERFORM C400-CREATE-GL-ENTRIES.                              10650000
106600                                                                  10660000
106700     PERFORM Y600-CLOSE-HOLD-CSR.                                 10670000
106800                                                                  10680000
106900     CLOSE FREIGHT-FILE                                           10690000
107000           REPORT-FILE                                            10700000
107100           FRGT-ADJ-FILE.                                         10710000
107200                                                                  10720000
107300     DISPLAY '***********  END OF APKUP130 ***********'.          10730000
107400 EJECT                                                            10740000
107500                                                                  10750000
107600*---------------------------------------------------------------* 10760000
107700*  THIS PARAGRAPH LOOKS AT THE FREIGHT FILE AND VERIFIES THAT   * 10770000
107800*  THE PO NUMBER, STORE NUMBER, DEPARTMENT NUMBER, CLASS NUMBER * 10780000
107900*  AND THE FREIGHT AMT ARE VALID.                               * 10790000
108000*---------------------------------------------------------------* 10800000
108100 C100-EDIT-FREIGHT-FILE.                                          10810000
108200                                                                  10820000
108300     MOVE 'N' TO EDIT-SW.                                         10830000
108400     MOVE AP023-FR-PO-NBR  TO PO-BEING-PROCESSED.                 10840000
108500     MOVE AP023-FR-TRIP-ID TO TRIP-BEING-PROCESSED.               10850000
108600                                                                  10860000
108700**   VALIDATE PO NUMBER                                           10870000
108800     IF PO-BEING-PROCESSED > 0                                    10880000
108900         PERFORM S400-SELECT-PO-NBR                               10890000
109000         IF INVALID-PO-NBR                                        10900000
109100            SET INVALID-PO-NBR    TO TRUE                         10910000
109200            MOVE ZEROES           TO PO-BEING-PROCESSED           10920000
109300            MOVE 'PO NUMBER INVALID, CREATING SI' TO DL-MESSAGE-A110930000
109400            MOVE 'NGLE TRANSACTION              ' TO DL-MESSAGE-A210940000
109500            PERFORM W300-WRITE-REPORT-DETAILS                     10950000
109600         END-IF                                                   10960000
109700     ELSE                                                         10970000
109800         IF TRIP-BEING-PROCESSED > 0                              10980000
109900            CONTINUE                                              10990000
110000         ELSE                                                     11000000
110100            SET INVALID-PO-NBR   TO TRUE                          11010000
110200            MOVE ZEROES          TO PO-BEING-PROCESSED            11020000
110300            MOVE 'PO NUMBER INVALID, CREATING SI' TO DL-MESSAGE-A111030000
110400            MOVE 'NGLE TRANSACTION              ' TO DL-MESSAGE-A211040000
110500            PERFORM W300-WRITE-REPORT-DETAILS                     11050000
110600         END-IF                                                   11060000
110700     END-IF.                                                      11070000
110800                                                                  11080000
110900**   VALIDATE DEPT/CLASS NUMBER                                   11090000
111000     IF INVALID-PO-NBR                                            11100000
111100        PERFORM E200-VALIDATE-DEPT-CLASS-NBR                      11110000
111200     END-IF.                                                      11120000
111300                                                                  11130000
111400**   VALIDATE AMOUNT PAID                                         11140000
111500     IF AP023-FR-AMT-PAID NUMERIC                                 11150000
111600         ADD AP023-FR-AMT-PAID TO TOTAL-FREIGHT-AMOUNT-IN         11160000
111700         IF  AP023-FR-AMT-PAID = 0                                11170000
111800             MOVE 'Y' TO EDIT-SW                                  11180000
111900             MOVE 'AMOUNT = ZERO ON FREIGHT FILE,'                11190000
112000                                              TO DL-MESSAGE-A1    11200000
112100             MOVE ' REJECTING TRANSACTION'    TO DL-MESSAGE-A2    11210000
112200             PERFORM W300-WRITE-REPORT-DETAILS                    11220000
112300         END-IF                                                   11230000
112400     ELSE                                                         11240000
112500         MOVE 'Y' TO EDIT-SW                                      11250000
112600         MOVE 'AMOUNT NOT NUMERIC ON FREIGHT ' TO DL-MESSAGE-A1   11260000
112700         MOVE 'FILE, REJECTING TRANSACTION   ' TO DL-MESSAGE-A2   11270000
112800         PERFORM W300-WRITE-REPORT-DETAILS                        11280000
112900     END-IF.                                                      11290000
113000                                                                  11300000
113100**   VALIDATE STORE NUMBER                                        11310000
113200     IF (AP023-FR-STORE-NBR NUMERIC) AND                          11320000
113300        (AP023-FR-STORE-NBR > ZEROES)                             11330000
113400         PERFORM S700-SELECT-STORE-NBR                            11340000
113500     ELSE                                                         11350000
113600         MOVE 'Y' TO EDIT-SW                                      11360000
113700         MOVE 'INVALID STORE NUMBER ON FREIGH' TO DL-MESSAGE-A1   11370000
113800         MOVE 'T FILE, REJECTING TRANSACTION ' TO DL-MESSAGE-A2   11380000
113900         PERFORM W300-WRITE-REPORT-DETAILS                        11390000
114000     END-IF.                                                      11400000
114100 EJECT                                                            11410000
114200     IF VALID-PO-NBR                                              11420000
114300        MOVE AP023-REC-SEQ-NBR TO PV-AP023-REC-SEQ-NBR            11430000
114400        PERFORM S900-SELECT-TRECEIV                               11440000
114500        IF TRECEIV-NOT-FOUND                                      11450000
114600           MOVE 'RECEIVING SEQUENCE # INVALID -' TO DL-MESSAGE-A1 11460000
114700           MOVE ' PRORATING TO ALL RECEIVERS   ' TO DL-MESSAGE-A2 11470000
114800           PERFORM W300-WRITE-REPORT-DETAILS                      11480000
114900           MOVE ZEROES TO AP023-REC-SEQ-NBR                       11490000
115000           SET PRORATE-ALL-DCS                    TO TRUE         11500000
115100        END-IF                                                    11510000
115200        IF TRECEIV-PO-NOT-FOUND                                   11520000
115300           MOVE 'RECEIVING SEQUENCE PO INVALID -' TO DL-MESSAGE-A111530000
115400           MOVE ' CREATING SINGLE TRANSACTION  '  TO DL-MESSAGE-A211540000
115500           PERFORM W300-WRITE-REPORT-DETAILS                      11550000
115600           PERFORM E200-VALIDATE-DEPT-CLASS-NBR                   11560000
115700        END-IF                                                    11570000
115800     END-IF.                                                      11580000
115900                                                                  11590000
116000*---------------------------------------------------------------* 11600000
116100*  IF THE PO NUMBER IS ZERO OR THE PO IS NOT FOUND ON THE       * 11610000
116200*  DATABASE, A SINGLE TRANSACTION WILL BE CREATED.              * 11620000
116300*---------------------------------------------------------------* 11630000
116400 C200-CREATE-SINGLE-TRANS.                                        11640000
116500                                                                  11650000
116600     INITIALIZE AP045-TRANSACTION-FILE                            11660000
116700                AP045-DETAIL-FIELDS.                              11670000
116800                                                                  11680000
116900     IF INVALID-PO-NBR                                            11690000
117000        MOVE PC-DEFAULT-VENDOR    TO AP045-VND-NBR                11700000
117100        MOVE PV-DEFAULT-VND-NBR   TO AP045-ENT-ID                 11710000
117200        MOVE PV-DEFAULT-VND-NAME  TO AP045-ENT-NME-DESC           11720000
117300     ELSE                                                         11730000
117400        PERFORM D100-GET-VENDOR-DUNNS                             11740000
117500     END-IF.                                                      11750000
117600                                                                  11760000
117700     PERFORM D400-CALL-GET-NEXT-DOC-NBR.                          11770000
117800     MOVE WS151-NEXT-DOC-NBR      TO AP045-DOC-NBR.               11780000
117900     SET  AP045-DETAIL-RECORD     TO TRUE.                        11790000
118000                                                                  11800000
118100     IF  AP023-FR-AMT-PAID < 0                                    11810000
118200         PERFORM                                                  11820000
118300            WITH TEST AFTER                                       11830000
118400            VARYING TC-IDX FROM +1 BY +1                          11840000
118500              UNTIL TC-PSTG-TYP-CDE (TC-IDX) = 'CR'               11850000
118600                 OR TC-IDX > +2                                   11860000
118700            MOVE TC-AP-TRN-CDE (TC-IDX)   TO  AP045-AP-TRN-CDE    11870000
118800            MOVE TC-PSTG-TYP-CDE (TC-IDX) TO  AP045-PSTG-TYP-CDE  11880000
118900            MOVE TC-TRN-TYP-CDE (TC-IDX)  TO  AP045-TRN-TYP-CDE   11890000
119000            MOVE TC-BTCH-SRC-CDE(TC-IDX) TO AP045-PS-BTCH-SRC-CDE 11900000
119100         END-PERFORM                                              11910000
119200** OFFSETTING TRAN CODE WILL BE A CHARGE THAT'S WHY WE NEED TO    11920000
119300** ADD TO TOTAL CHARGE AMOUNT                                     11930000
119400     COMPUTE TOTAL-FREIGHT-CHARGE-AMT =                           11940000
119500        TOTAL-FREIGHT-CHARGE-AMT + (AP023-FR-AMT-PAID * -1)       11950000
119600     ELSE                                                         11960000
119700         PERFORM                                                  11970000
119800            WITH TEST AFTER                                       11980000
119900            VARYING TC-IDX FROM +1 BY +1                          11990000
120000              UNTIL TC-PSTG-TYP-CDE (TC-IDX) = 'CH'               12000000
120100                 OR TC-IDX > +2                                   12010000
120200            MOVE TC-AP-TRN-CDE (TC-IDX)   TO  AP045-AP-TRN-CDE    12020000
120300            MOVE TC-PSTG-TYP-CDE (TC-IDX) TO  AP045-PSTG-TYP-CDE  12030000
120400            MOVE TC-TRN-TYP-CDE (TC-IDX)  TO  AP045-TRN-TYP-CDE   12040000
120500            MOVE TC-BTCH-SRC-CDE(TC-IDX) TO AP045-PS-BTCH-SRC-CDE 12050000
120600         END-PERFORM                                              12060000
120700** OFFSETTING TRAN CODE WILL BE A CREDIT THAT'S WHY WE NEED TO    12070000
120800** ADD TO TOTAL CREDIT AMOUNT                                     12080000
120900*        IF VALID-DEPT-CL                                         12090000
121000         COMPUTE TOTAL-FREIGHT-CREDIT-AMT =                       12100000
121100             TOTAL-FREIGHT-CREDIT-AMT + (AP023-FR-AMT-PAID * -1)  12110000
121200*        END-IF                                                   12120000
121300     END-IF.                                                      12130000
121400                                                                  12140000
121500     MOVE PO-BEING-PROCESSED       TO  AP045-PO-NBR.              12150000
121600     MOVE MDSEAR-DEPT-NBR          TO  AP045-DEPT-NBR             12160000
121700** NEED TO MOVE VALID DEPT-NBR FOR POSSIBLE COLLECT TRANSACTION.  12170000
121800                                       PV-COLL-DEPT-NBR.          12180000
121900     MOVE PV-ENTR-DTE              TO  AP045-ENTR-DTE             12190000
122000                                       AP045-DOC-DTE              12200000
122100                                       AP045-INV-CUTOFF-DTE       12210000
122200                                       AP045-PS-BTCH-DTE.         12220000
122300     MOVE PV-TIMESTAMP             TO  AP045-ENTR-TME.            12230000
122400     MOVE 'APKUP130'               TO  AP045-ENTR-ID.             12240000
122500     SET  AP045-ORGN-FREIGHT       TO  TRUE.                      12250000
122600     MOVE '00'                     TO  AP045-PS-BTCH-SEQ-NBR.     12260000
122700** 12-27-99 START                                                 12270000
122800     MOVE AP023-FR-PB-FRST10       TO  AP045-RSN-1ST-LNE-TXT.     12280000
122900** 12-27-99 END                                                   12290000
123000     MOVE APCNTL-CURR-PSTG-FYR-NBR TO  AP045-PSTG-FYR-NBR.        12300000
123100     MOVE APCNTL-CURR-PSTG-FMN-NBR TO  AP045-PSTG-FMN-NBR.        12310000
123200     MOVE APCNTL-CURR-PSTG-FWK-NBR TO  AP045-PSTG-FWK-NBR.        12320000
123300                                                                  12330000
123400*  DETAIL FIELDS                                                  12340000
123500     MOVE PV-STR-NBR               TO  AP045-STR-NBR.             12350000
123600     MOVE AP023-FR-CLASSNO         TO  AP045-CL-NBR               12360000
123700** NEED TO MOVE VALID CLASS NBR FOR POSSIBLE COLLECT TRANSACTION. 12370000
123800                                       PV-COLL-CL-NBR.            12380000
123900     MOVE ZEROES                   TO  AP045-SKU-NBR.             12390000
124000     MOVE ZEROES                   TO  AP045-GRO-COST-AMT.        12400000
124100     MOVE ZEROES                   TO  AP045-RETL-AMT.            12410000
124200     MOVE ZEROES                   TO  AP045-MISC-CHRG-AMT.       12420000
124300                                                                  12430000
124400** MULTIPLYING BY -1 SINCE WE ARE USING TRAN CODES, WE DON'T      12440000
124500** WANT A NEGATIVE CREDIT, THAT WOULD MAKE IT A CHARGE            12450000
124600**** IF AP023-FR-AMT-PAID < 0                                     12460000
124700****     COMPUTE AP045-FRGT-AMT = (AP023-FR-AMT-PAID * -1)        12470000
124800**** ELSE                                                         12480000
124900         MOVE AP023-FR-AMT-PAID    TO  AP045-FRGT-AMT.            12490000
125000**** END-IF.                                                      12500000
125100                                                                  12510000
125200     MOVE ZEROES                   TO  AP045-DTL-TERM-DISC-AMT.   12520000
125300     MOVE ZEROES                   TO  AP045-DTL-NW-STR-DISC-AMT. 12530000
125400     MOVE ZEROES                   TO  AP045-DTL-TRD-DISC-AMT.    12540000
125500     MOVE AP045-FRGT-AMT           TO  AP045-NET-COST-AMT.        12550000
125600     MOVE ZEROES                   TO  AP045-DTL-MOS-DISC-AMT.    12560000
125700                                                                  12570000
125800** WRITE TRANSACTION                                              12580000
125900     PERFORM W200-WRITE-FRGT-ADJ.                                 12590000
126000 EJECT                                                            12600000
126100                                                                  12610000
126200*---------------------------------------------------------------* 12620000
126300*  A TRANSACTION WILL BE CREATED FOR EACH ROW RETURNED FROM     * 12630000
126400*  PRORATION TABLE (TAJPRRT) FOR A VALID PO NUMBER              * 12640000
126500*---------------------------------------------------------------* 12650000
126600 C300-CREATE-MULTI-PO-TRANS.                                      12660000
126700                                                                  12670000
126800     INITIALIZE AP045-TRANSACTION-FILE                            12680000
126900                AP045-DETAIL-FIELDS.                              12690000
127000                                                                  12700000
127100     IF (AP023-FR-PO-NBR > ZERO)    AND                           12710000
127200        (AP023-FR-PO-NBR NOT = SPACES)                            12720000
127300        PERFORM D100-GET-VENDOR-DUNNS                             12730000
127400     ELSE                                                         12740000
127500        MOVE PC-DEFAULT-VENDOR    TO AP045-VND-NBR                12750000
127600        MOVE PV-DEFAULT-VND-NBR   TO AP045-ENT-ID                 12760000
127700        MOVE PV-DEFAULT-VND-NAME  TO AP045-ENT-NME-DESC           12770000
127800     END-IF.                                                      12780000
127900                                                                  12790000
128000     MOVE PO-BEING-PROCESSED      TO AP045-DOC-NBR.               12800000
128100     SET  AP045-DETAIL-RECORD     TO TRUE.                        12810000
128200                                                                  12820000
128300     IF  AP023-FR-AMT-PAID < 0                                    12830000
128400         PERFORM                                                  12840000
128500            WITH TEST AFTER                                       12850000
128600            VARYING TC-IDX FROM +1 BY +1                          12860000
128700              UNTIL TC-PSTG-TYP-CDE (TC-IDX) = 'CR'               12870000
128800                 OR TC-IDX > +2                                   12880000
128900            MOVE TC-AP-TRN-CDE (TC-IDX)   TO  AP045-AP-TRN-CDE    12890000
129000            MOVE TC-PSTG-TYP-CDE (TC-IDX) TO  AP045-PSTG-TYP-CDE  12900000
129100            MOVE TC-TRN-TYP-CDE (TC-IDX)  TO  AP045-TRN-TYP-CDE   12910000
129200            MOVE TC-BTCH-SRC-CDE(TC-IDX) TO AP045-PS-BTCH-SRC-CDE 12920000
129300            IF (TC-SUB-CL-REQR-IND (TC-IDX) = 'N') AND            12930000
129400               (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'N')               12940000
129500                SET WS150-MAJOR-CLASS TO TRUE                     12950000
129600            ELSE                                                  12960000
129700                IF (TC-SUB-CL-REQR-IND (TC-IDX) = 'Y') AND        12970000
129800                   (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'N')           12980000
129900                    SET WS150-SUB-CLASS TO TRUE                   12990000
130000                ELSE                                              13000000
130100                    IF (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'Y')       13010000
130200                        SET WS150-SKU     TO TRUE                 13020000
130300                    END-IF                                        13030000
130400                END-IF                                            13040000
130500            END-IF                                                13050000
130600         END-PERFORM                                              13060000
130700** OFFSETTING TRAN CODE WILL BE A CHARGE THAT'S WHY WE NEED TO    13070000
130800** ADD TO TOTAL CHARGE AMOUNT                                     13080000
130900         COMPUTE TOTAL-FREIGHT-CHARGE-AMT =                       13090000
131000            TOTAL-FREIGHT-CHARGE-AMT + (AP023-FR-AMT-PAID * -1)   13100000
131100     ELSE                                                         13110000
131200         PERFORM                                                  13120000
131300            WITH TEST AFTER                                       13130000
131400            VARYING TC-IDX FROM +1 BY +1                          13140000
131500              UNTIL (TC-PSTG-TYP-CDE (TC-IDX) = 'CH')             13150000
131600                 OR (TC-IDX > +2)                                 13160000
131700            MOVE TC-AP-TRN-CDE (TC-IDX)   TO  AP045-AP-TRN-CDE    13170000
131800            MOVE TC-PSTG-TYP-CDE (TC-IDX) TO  AP045-PSTG-TYP-CDE  13180000
131900            MOVE TC-TRN-TYP-CDE (TC-IDX)  TO  AP045-TRN-TYP-CDE   13190000
132000            MOVE TC-BTCH-SRC-CDE(TC-IDX) TO AP045-PS-BTCH-SRC-CDE 13200000
132100            IF (TC-SUB-CL-REQR-IND (TC-IDX) = 'N') AND            13210000
132200               (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'N')               13220000
132300                SET WS150-MAJOR-CLASS TO TRUE                     13230000
132400            ELSE                                                  13240000
132500                IF (TC-SUB-CL-REQR-IND (TC-IDX) = 'Y') AND        13250000
132600                   (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'N')           13260000
132700                    SET WS150-SUB-CLASS TO TRUE                   13270000
132800                ELSE                                              13280000
132900                    IF (TC-SKU-SEQ-REQR-IND (TC-IDX) = 'Y')       13290000
133000                        SET WS150-SKU     TO TRUE                 13300000
133100                    END-IF                                        13310000
133200                END-IF                                            13320000
133300            END-IF                                                13330000
133400         END-PERFORM                                              13340000
133500** OFFSETTING TRAN CODE WILL BE A CREDIT THAT'S WHY WE NEED TO    13350000
133600** ADD TO TOTAL CREDIT AMOUNT                                     13360000
133700*        IF VALID-DEPT-CL                                         13370000
133800         COMPUTE TOTAL-FREIGHT-CREDIT-AMT =                       13380000
133900             TOTAL-FREIGHT-CREDIT-AMT + (AP023-FR-AMT-PAID * -1)  13390000
134000*        END-IF                                                   13400000
134100     END-IF.                                                      13410000
134200                                                                  13420000
134300     MOVE PO-BEING-PROCESSED       TO  AP045-PO-NBR.              13430000
134400     MOVE PV-ENTR-DTE              TO  AP045-ENTR-DTE             13440000
134500                                       AP045-DOC-DTE              13450000
134600                                       AP045-INV-CUTOFF-DTE       13460000
134700                                       AP045-PS-BTCH-DTE.         13470000
134800     MOVE PV-TIMESTAMP             TO  AP045-ENTR-TME.            13480000
134900     MOVE 'APKUP130'               TO  AP045-ENTR-ID.             13490000
135000     SET  AP045-ORGN-FREIGHT       TO  TRUE.                      13500000
135100     MOVE '00'                     TO  AP045-PS-BTCH-SEQ-NBR.     13510000
135200** 12-27-99 START                                                 13520000
135300     MOVE AP023-FR-PB-FRST10       TO  AP045-RSN-1ST-LNE-TXT.     13530000
135400** 12-27-99 END                                                   13540000
135500     MOVE EXTENT-ENT-ID            TO  AP045-ENT-ID.              13550000
135600     MOVE APCNTL-CURR-PSTG-FYR-NBR TO  AP045-PSTG-FYR-NBR.        13560000
135700     MOVE APCNTL-CURR-PSTG-FMN-NBR TO  AP045-PSTG-FMN-NBR.        13570000
135800     MOVE APCNTL-CURR-PSTG-FWK-NBR TO  AP045-PSTG-FWK-NBR.        13580000
135900*  DETAIL FIELDS                                                  13590000
136000     MOVE ZEROES                   TO  AP045-GRO-COST-AMT.        13600000
136100     MOVE ZEROES                   TO  AP045-RETL-AMT.            13610000
136200     MOVE ZEROES                   TO  AP045-MISC-CHRG-AMT.       13620000
136300** MULTIPLYING BY -1 SINCE WE ARE USING TRAN CODES, WE DON'T      13630000
136400** WANT A NEGATIVE CREDIT, THAT WOULD MAKE IT A CHARGE            13640000
136500**** IF AP023-FR-AMT-PAID < 0                                     13650000
136600****     COMPUTE PV-ADJUSTED-FRGT-AMT = (AP023-FR-AMT-PAID * -1)  13660000
136700**** ELSE                                                         13670000
136800         MOVE AP023-FR-AMT-PAID   TO  PV-ADJUSTED-FRGT-AMT.       13680000
136900**** END-IF.                                                      13690000
137000                                                                  13700000
137100** BUILD PARAMETER LIST BEFORE CALLING PRORATE ROUTINE (DPKUP150) 13710000
137200     MOVE PO-BEING-PROCESSED TO WS150-PO-NBR.                     13720000
137300     MOVE AP023-REC-SEQ-NBR  TO WS150-REC-SEQ-NBR.                13730000
137400                                                                  13740000
137500     EVALUATE PV-STR-TYP-CDE                                      13750000
137600       WHEN 'DS'                                                  13760000
137700         MOVE PV-STR-NBR     TO WS150-STR-NBR                     13770000
137800       WHEN 'DC'                                                  13780000
137900         IF PRORATE-ALL-DCS                                       13790000
138000            MOVE ZEROES      TO WS150-DC-NBR                      13800000
138100         ELSE                                                     13810000
138200            MOVE PV-STR-NBR  TO WS150-DC-NBR                      13820000
138300         END-IF                                                   13830000
138400       WHEN OTHER                                                 13840000
138500         MOVE ZEROES         TO WS150-STR-NBR                     13850000
138600                                WS150-DC-NBR                      13860000
138700     END-EVALUATE.                                                13870000
138800     MOVE ZEROES             TO WS150-PO-LNE-NBR.                 13880000
138900*    SET  WS150-BASE-ON-COST TO TRUE.                             13890000
139000     MOVE 'C'                TO WS150-PRORATE-BASIS.              13900000
139100                                                                  13910000
139200     PERFORM D200-CALL-PO-PRORATION-ROUTINE.                      13920000
139300     PERFORM Y200-OPEN-PO-PRORATION-CSR.                          13930000
139400                                                                  13940000
139500     SET FIRST-PO-PRORTN TO TRUE.                                 13950000
139600     PERFORM UNTIL END-OF-PO-PRORTN-CSR                           13960000
139700         PERFORM S300-FETCH-PO-PRORATION-CSR                      13970000
139800         PERFORM D300-PROCESS-PO-RESULT-SET                       13980000
139900     END-PERFORM.                                                 13990000
140000                                                                  14000000
140100     PERFORM Y500-CLOSE-PO-PRORATION-CSR.                         14010000
140200     MOVE 'N' TO PS-END-OF-PO-PRORTN-CSR.                         14020000
140300     MOVE 'N' TO PS-PRORATE-ALL-DCS-SW.                           14030000
140400 EJECT                                                            14040000
140500                                                                  14050000
140600*---------------------------------------------------------------* 14060000
140700*  THIS PARAGRAPH CREATES THE OFFSETTING GL ENTRIES.            * 14070000
140800*---------------------------------------------------------------* 14080000
140900 C400-CREATE-GL-ENTRIES.                                          14090000
141000                                                                  14100000
141100     MOVE PC-DEFAULT-VENDOR    TO AP045-VND-NBR.                  14110000
141200     MOVE PV-DEFAULT-VND-NBR   TO AP045-ENT-ID.                   14120000
141300     MOVE PV-DEFAULT-VND-NAME  TO AP045-ENT-NME-DESC.             14130000
141400     SET  AP045-DETAIL-RECORD  TO TRUE.                           14140000
141500     SET  AP045-ORGN-FREIGHT   TO TRUE.                           14150000
141600     MOVE 090                  TO AP045-STR-NBR.                  14160000
141700     MOVE PV-ENTR-DTE          TO AP045-ENTR-DTE                  14170000
141800                                  AP045-DOC-DTE                   14180000
141900                                  AP045-INV-CUTOFF-DTE            14190000
142000                                  AP045-PS-BTCH-DTE.              14200000
142100     MOVE SPACES               TO AP045-PO-NBR                    14210000
142200                                  AP045-DEPT-NBR                  14220000
142300                                  AP045-CL-NBR                    14230000
142400                                  AP045-RSN-TXT.                  14240000
142500     MOVE ZEROES               TO AP045-SKU-NBR                   14250000
142600                                  AP045-GRO-COST-AMT              14260000
142700                                  AP045-RETL-AMT                  14270000
142800                                  AP045-MISC-CHRG-AMT.            14280000
142900                                                                  14290000
143000     PERFORM VARYING TC-IDX FROM +1 BY +1                         14300000
143100             UNTIL TC-IDX > +2                                    14310000
143200         IF TC-PSTG-TYP-CDE (TC-IDX) = 'CR'                       14320000
143300** OFFSETTING TRAN CODE WILL BE A CHARGE THAT'S WHY WE NEED TO    14330000
143400** MOVE TOTAL CHARGE AMOUNT                                       14340000
143500            MOVE TOTAL-FREIGHT-CHARGE-AMT TO AP045-FRGT-AMT       14350000
143600                                             AP045-NET-COST-AMT   14360000
143700            MOVE TC-AUTO-OFFST-TRN-CDE (TC-IDX)                   14370000
143800                                          TO AP045-AP-TRN-CDE     14380000
143900                                                                  14390000
144000* USE POSTING TYPE CODE, ETC. FOR OFFSET TRAN CODE                14400000
144100            PERFORM S950-SELECT-TTRNCDE                           14410000
144200            MOVE TRNCDE-PSTG-TYP-CDE TO AP045-PSTG-TYP-CDE        14420000
144300            MOVE TRNCDE-TRN-TYP-CDE  TO AP045-TRN-TYP-CDE         14430000
144400            MOVE TRNCDE-GL-ACCT-NBR  TO AP045-GL-ACCT-NBR         14440000
144500            MOVE TRNCDE-BTCH-SRC-CDE TO AP045-PS-BTCH-SRC-CDE     14450000
144600         ELSE                                                     14460000
144700** OFFSETTING TRAN CODE WILL BE A CREDIT THAT'S WHY WE NEED TO    14470000
144800** MOVE TOTAL CREDIT AMOUNT                                       14480000
144900            MOVE TOTAL-FREIGHT-CREDIT-AMT TO AP045-FRGT-AMT       14490000
145000                                             AP045-NET-COST-AMT   14500000
145100            MOVE TC-AUTO-OFFST-TRN-CDE (TC-IDX)                   14510000
145200                                          TO AP045-AP-TRN-CDE     14520000
145300* USE POSTING TYPE CODE, ETC. FOR OFFSET TRAN CODE                14530000
145400            PERFORM S950-SELECT-TTRNCDE                           14540000
145500            MOVE TRNCDE-PSTG-TYP-CDE TO AP045-PSTG-TYP-CDE        14550000
145600            MOVE TRNCDE-TRN-TYP-CDE  TO AP045-TRN-TYP-CDE         14560000
145700            MOVE TRNCDE-GL-ACCT-NBR  TO AP045-GL-ACCT-NBR         14570000
145800            MOVE TRNCDE-BTCH-SRC-CDE TO AP045-PS-BTCH-SRC-CDE     14580000
145900         END-IF                                                   14590000
146000         IF AP045-FRGT-AMT = ZERO                                 14600000
146100             CONTINUE                                             14610000
146200         ELSE                                                     14620000
146300             PERFORM D400-CALL-GET-NEXT-DOC-NBR                   14630000
146400             MOVE WS151-NEXT-DOC-NBR   TO AP045-DOC-NBR           14640000
146500             PERFORM W200-WRITE-FRGT-ADJ                          14650000
146600         END-IF                                                   14660000
146700     END-PERFORM.                                                 14670000
146800 EJECT                                                            14680000
146900                                                                  14690000
147000*---------------------------------------------------------------* 14700000
147100*  THIS PARAGRAPH RETRIEVES THE TRANSACTION CODE, SUBCLASS,     * 14710000
147200*  SKU SEQUENCE, AUTO OFFSET TRAN CODE, TYPE CODES, AND BATCH   * 14720000
147300*  SOURCE CODE FROM THE TTRNCDE TABLE FOR SPECIFIED TRAN CODES  * 14730000
147400*  AND FILLS THE TRAN CODE TABLE FOR USE THOUGHOUT THE PROGRAM  * 14740000
147500*---------------------------------------------------------------* 14750000
147600 C500-FILL-TRAN-CODE-TABLE.                                       14760000
147700                                                                  14770000
147800     MOVE TRNCDE-AP-TRN-CDE   TO TC-AP-TRN-CDE (TC-IDX).          14780000
147900     MOVE TRNCDE-SUB-CL-REQR-IND                                  14790000
148000                              TO TC-SUB-CL-REQR-IND (TC-IDX).     14800000
148100     MOVE TRNCDE-SKU-SEQ-REQR-IND                                 14810000
148200                              TO TC-SKU-SEQ-REQR-IND (TC-IDX).    14820000
148300     MOVE TRNCDE-AUTO-OFFST-TRN-CDE                               14830000
148400                              TO TC-AUTO-OFFST-TRN-CDE (TC-IDX).  14840000
148500     MOVE TRNCDE-PSTG-TYP-CDE TO TC-PSTG-TYP-CDE (TC-IDX).        14850000
148600     MOVE TRNCDE-TRN-TYP-CDE  TO TC-TRN-TYP-CDE  (TC-IDX).        14860000
148700     MOVE TRNCDE-GL-ACCT-NBR  TO TC-GL-ACCT-NBR  (TC-IDX).        14870000
148800     MOVE TRNCDE-BTCH-SRC-CDE TO TC-BTCH-SRC-CDE (TC-IDX).        14880000
148900     SET TC-IDX UP BY 1.                                          14890000
149000                                                                  14900000
149100     PERFORM S200-FETCH-TRN-CDE-CSR.                              14910000
149200 EJECT                                                            14920000
149300                                                                  14930000
149400*---------------------------------------------------------------* 14940000
149500*  THIS PARAGRAPH WILL DETERMINE WHETHER OR NOT A COLLECT       * 14950000
149600*  PROGRAM TRANSACTION SHOULD BE CREATED OR NOT.                * 14960000
149700*---------------------------------------------------------------* 14970000
149800 C600-LOOK-FOR-COLLECT-PGM.                                       14980000
149900                                                                  14990000
150000     MOVE AP023-FR-SCAC-CODE  TO PV-CHECK-SCAC-CODE.              15000000
150100     MOVE AP023-FR-ORIG-ZIP   TO PV-ZIP-CODE.                     15010000
150200     MOVE PURCHS-PO-TYP-CDE   TO PV-PO-TYPE-CODE.                 15020000
150300     MOVE PV-COLL-ENT-ID      TO PV-CHECK-VENDOR.                 15030000
150400     MOVE PURCHS-DEPT-NBR     TO PV-DEPT-NBR.                     15040000
150500     PERFORM T900-SET-SEPHORA-SW.                                 15050000
150600                                                                  15060000
150700     INITIALIZE CNTR1.                                            15070000
150800     INSPECT AP023-FR-ORIG-ZIP TALLYING CNTR1 FOR ALL SPACES.     15080000
150900     EVALUATE TRUE                                                15090000
151000         WHEN CNTR1 = 1                                           15100000
151100              SET VALID-ZIP TO TRUE                               15110000
151200         WHEN CNTR1 = 0                                           15120000
151300              SET CANADIAN-ZIP TO TRUE                            15130000
151400         WHEN CNTR1 > 1                                           15140000
151500              SET INVALID-ZIP TO TRUE                             15150000
151600     END-EVALUATE                                                 15160000
151700                                                                  15170000
151800**>CHANGED TO CHECK FOR INCLUSIVE GROUP OF ZIP CODES THAT         15180000
151900** WILL GENERATE CHARGEBACKS INSTEAD OF ZIP CODES TO EXCLUDE.     15190000
152000     IF  (COLLECT-PGM-CARRIER)                                    15200000
152100     AND (AP023-FR-AMT-PAID > 0)                                  15210000
152200     AND (VENDOR-FOUND)                                           15220000
152300     AND (VALID-ZIP)                                              15230000
152400     AND (COLLECT-INCLUSIVE-ZIP)                                  15240000
152500     AND (NOT IMPORT-LANDED-PO-TYP)                               15250000
152600         IF EXEMPT-VENDOR                                         15260000
152700*        OR (SEPHORA-TEMP-EXEMPT                                  15270000
152800         OR (PS-SEPHORA-EXEMPT-YES                                15280000
152900             AND AP023-FR-PRO-DATE  < '20230201')                 15290000
153000            CONTINUE                                              15300000
153100         ELSE                                                     15310000
153200            PERFORM D500-CREATE-COLLECT-CHARGEBACK                15320000
153300         END-IF                                                   15330000
153400     END-IF.                                                      15340000
153500                                                                  15350000
153600*--------------------------------------------------------------*  15360000
153700* THIS PARAGRAPH RETREIVES THE VENDOR DUNN NUMBER, ENT ID,     *  15370000
153800* AND ENT NAME FOR THE PO BEING PROCESSED                      *  15380000
153900*--------------------------------------------------------------*  15390000
154000 D100-GET-VENDOR-DUNNS.                                           15400000
154100                                                                  15410000
154200     MOVE 'N' TO PS-VENDOR-FOUND-SW.                              15420000
154300     MOVE 'N' TO PS-DEFAULT-VENDOR-SW.                            15430000
154400                                                                  15440000
154500     PERFORM WITH TEST AFTER                                      15450000
154600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 15460000
154700             UNTIL   (PV-RETRY-COUNTER > PC-RETRY-MAX) OR         15470000
154800                     (VENDOR-FOUND) OR                            15480000
154900                     (DEFAULT-VENDOR)                             15490000
155000         PERFORM S800-SELECT-VENDOR                               15500000
155100         EVALUATE TRUE                                            15510000
155200             WHEN VENDOR-FOUND                                    15520000
155300                 IF EXTENT-DUN-NBR = ZERO                         15530000
155400                    MOVE PC-DEFAULT-VENDOR   TO AP045-VND-NBR     15540000
155500                                                PV-COLL-VND-NBR   15550000
155600                    MOVE PV-DEFAULT-VND-NBR  TO AP045-ENT-ID      15560000
155700                                                PV-COLL-ENT-ID    15570000
155800                    MOVE PV-DEFAULT-VND-NAME TO                   15580000
155900                                               AP045-ENT-NME-DESC 15590000
156000                                               PV-COLL-ENT-NAME   15600000
156100                 ELSE                                             15610000
156200                    MOVE EXTENT-DUN-NBR      TO AP045-VND-NBR     15620000
156300                                                PV-COLL-VND-NBR   15630000
156400                    MOVE EXTENT-ENT-ID       TO AP045-ENT-ID      15640000
156500                                                PV-COLL-ENT-ID    15650000
156600                    MOVE ENTNME-ENT-NAME-DESC TO                  15660000
156700                                              AP045-ENT-NME-DESC  15670000
156800                                              PV-COLL-ENT-NAME    15680000
156900                 END-IF                                           15690000
157000*                MOVE EXTENT-ENT-ID  TO AP045-ENT-ID              15700000
157100*                MOVE ENTNME-ENT-NAME-DESC TO AP045-ENT-NME-DESC  15710000
157200             WHEN DEFAULT-VENDOR                                  15720000
157300                 MOVE PC-DEFAULT-VENDOR   TO AP045-VND-NBR        15730000
157400                                             PV-COLL-VND-NBR      15740000
157500                 MOVE PV-DEFAULT-VND-NBR  TO AP045-ENT-ID         15750000
157600                                             PV-COLL-ENT-ID       15760000
157700                 MOVE PV-DEFAULT-VND-NAME TO AP045-ENT-NME-DESC   15770000
157800                                             PV-COLL-ENT-NAME     15780000
157900                                                                  15790000
158000             WHEN OTHER                                           15800000
158100                 CONTINUE                                         15810000
158200         END-EVALUATE                                             15820000
158300     END-PERFORM.                                                 15830000
158400                                                                  15840000
158500     IF PV-RETRY-COUNTER > PC-RETRY-MAX                           15850000
158600        SET AC-MAX-RETRIES-EXCEEDED  TO TRUE                      15860000
158700        MOVE 'D100-GET-VENDOR-DUNNS' TO AA-PARAGRAPH-NAME         15870000
158800        MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION          15880000
158900        MOVE 'TEXTENT'               TO AA-DB2-TABLE-1            15890000
159000        MOVE SPACES                  TO AA-DB2-TABLE-2            15900000
159100        MOVE SPACES                  TO AA-DB2-TABLE-3            15910000
159200        PERFORM Z998-DB2-ABEND                                    15920000
159300     END-IF.                                                      15930000
159400 EJECT                                                            15940000
159500                                                                  15950000
159600*--------------------------------------------------------------*  15960000
159700*  THIS PARAGRAPH CALLS THE PO ADJUSTMENT PRORATION ROUTINE    *  15970000
159800*  (DPKUP150) USING THE WS150-PRORATE-PARAMETERS.  THE         *  15980000
159900*  PRORATION ROUTINE FILLS A GLOBAL DB2 TABLE (TAJPRRT) WHICH  *  15990000
160000*  HOLDS THE PRORATION PERCENT USED TO CALCULATE THE FREIGHT   *  16000000
160100*  AMOUNT.                                                     *  16010000
160200*--------------------------------------------------------------*  16020000
160300 D200-CALL-PO-PRORATION-ROUTINE.                                  16030000
160400                                                                  16040000
160500     CALL DP950-AJ-PRORATION-SUBROUTINE                           16050000
160600                     USING WS150-PRORATE-PARAMETERS.              16060000
160700                                                                  16070000
160800     IF WS150-ERRORS-FOUND                                        16080000
160900        SET AC-BAD-DATA TO TRUE                                   16090000
161000        DISPLAY 'PO NBR: ' WS150-PO-NBR                           16100000
161100        DISPLAY 'SEQ: ' WS150-REC-SEQ-NBR                         16110000
161200        DISPLAY 'STORE: ' WS150-STR-NBR                           16120000
161300        DISPLAY 'DC: ' WS150-DC-NBR                               16130000
161400        DISPLAY 'LINE: ' WS150-PO-LNE-NBR                         16140000
161500        DISPLAY 'BASIS: ' WS150-PRORATE-BASIS                     16150000
161600        DISPLAY 'LEVEL: ' WS150-PRORATE-LEVEL                     16160000
161700        MOVE 'D200-CALL-PO-PRORATION-ROUTINE'                     16170000
161800          TO AA-PARAGRAPH-NAME                                    16180000
161900        MOVE 'ERRORS FOUND IN ADJ JRNL PRORATION' TO AA-MESSAGE   16190000
162000        PERFORM Z999-ABEND                                        16200000
162100     END-IF.                                                      16210000
162200 EJECT                                                            16220000
162300                                                                  16230000
162400*                                                                 16240000
162500*--------------------------------------------------------------*  16250000
162600*  THIS PARAGRAPH PROCESSES EACH ROW IN THE TAJPRRT TABLE      *  16260000
162700*  FOR THE PO-BEING-PROCESSED.  IT WAITS TO WRITE THE PREVIOUS *  16270000
162800*  TO TO VERIFY THE SUMMED AMT EQUALS INPUT AMT.               *  16280000
162900*  IF NO ROW IS RETURNED, ONE RECORD IS CREATED, THE CLASS     *  16290000
163000*  AND DEPARTMENT ARE VERIFIED.                                *  16300000
163100*                                                              *  16310000
163200*--------------------------------------------------------------*  16320000
163300 D300-PROCESS-PO-RESULT-SET.                                      16330000
163400                                                                  16340000
163500     IF END-OF-PO-PRORTN-CSR                                      16350000
163600         IF FIRST-PO-PRORTN                                       16360000
163700             MOVE 'NO ROWS ON TAJPRRT TABLE, CREA'                16370000
163800                                              TO DL-MESSAGE-A1    16380000
163900             MOVE 'TING SINGLE TRANSACTION'   TO DL-MESSAGE-A2    16390000
164000             PERFORM W300-WRITE-REPORT-DETAILS                    16400000
164100**           CREATE ONE OUTPUT RECORD WITH NO PRORATION           16410000
164200             PERFORM E200-VALIDATE-DEPT-CLASS-NBR                 16420000
164300             IF EDIT-ERROR                                        16430000
164400                 ADD 1 TO FREIGHT-ERROR-RECORDS                   16440000
164500                 MOVE 'N' TO EDIT-SW                              16450000
164600             ELSE                                                 16460000
164700                 MOVE AP023-FR-DEPT     TO AP045-DEPT-NBR         16470000
164800** NEED TO MOVE VALID DEPT-NBR FOR POSSIBLE COLLECT TRANSACTION.  16480000
164900                                           PV-COLL-DEPT-NBR       16490000
165000                 MOVE AP023-FR-CLASSNO  TO AP045-CL-NBR           16500000
165100** NEED TO MOVE VALID CLASS NBR FOR POSSIBLE COLLECT TRANSACTION. 16510000
165200                                           PV-COLL-CL-NBR         16520000
165300                 MOVE ZEROES            TO AP045-SKU-NBR          16530000
165400                 MOVE PV-STR-NBR        TO AP045-STR-NBR          16540000
165500***              IF AP023-FR-AMT-PAID < 0                         16550000
165600***                  COMPUTE AP045-FRGT-AMT = (AP023-FR-AMT-PAID  16560000
165700***                                            * -1)              16570000
165800***              ELSE                                             16580000
165900                     MOVE AP023-FR-AMT-PAID TO AP045-FRGT-AMT     16590000
166000***              END-IF                                           16600000
166100                 MOVE AP045-FRGT-AMT    TO AP045-NET-COST-AMT     16610000
166200                 PERFORM W200-WRITE-FRGT-ADJ                      16620000
166300             END-IF                                               16630000
166400         ELSE                                                     16640000
166500**       CHECKING TO VERIFY THE SUMMED AMT EQUALS INPUT AMT       16650000
166600         MOVE PV-ADJUSTED-FRGT-AMT TO DISPLAY-ADJUSTED-FRGT-AMT   16660000
166700             IF PV-ADJUSTED-FRGT-AMT = 0                          16670000
166800                 PERFORM W200-WRITE-FRGT-ADJ                      16680000
166900             ELSE                                                 16690000
167000                 MOVE AP045-FRGT-AMT TO DISPLAY-FRGT-AMT          16700000
167100                 ADD PV-ADJUSTED-FRGT-AMT  TO AP045-FRGT-AMT      16710000
167200                 MOVE AP045-FRGT-AMT       TO AP045-NET-COST-AMT  16720000
167300                 MOVE PV-ADJUSTED-FRGT-AMT TO                     16730000
167400                      DISPLAY-ADJUSTED-FRGT-AMT                   16740000
167500                 MOVE AP045-FRGT-AMT TO DISPLAY-FRGT-AMT          16750000
167600                                                                  16760000
167700                 PERFORM W200-WRITE-FRGT-ADJ                      16770000
167800             END-IF                                               16780000
167900         END-IF                                                   16790000
168000     ELSE                                                         16800000
168100         IF FIRST-PO-PRORTN                                       16810000
168200             CONTINUE                                             16820000
168300         ELSE                                                     16830000
168400**           WRITING PREVIOUS RECORD                              16840000
168500             PERFORM W200-WRITE-FRGT-ADJ                          16850000
168600         END-IF                                                   16860000
168700         MOVE AJPRRT-DEPT-NBR         TO  AP045-DEPT-NBR          16870000
168800** NEED TO MOVE VALID DEPT-NBR FOR POSSIBLE COLLECT TRANSACTION.  16880000
168900                                          PV-COLL-DEPT-NBR        16890000
169000         MOVE AJPRRT-CL-NBR           TO  AP045-CL-NBR            16900000
169100** NEED TO MOVE VALID CLASS NBR FOR POSSIBLE COLLECT TRANSACTION. 16910000
169200                                          PV-COLL-CL-NBR          16920000
169300         IF AJPRRT-SKU-NBR EQUAL ZEROES                           16930000
169400            MOVE ZEROES TO AP045-SKU-NBR                          16940000
169500         ELSE                                                     16950000
169600            MOVE AJPRRT-SKU-NBR TO AP045-SKU-NBR                  16960000
169700         END-IF                                                   16970000
169800         MOVE AJPRRT-STR-NBR          TO  AP045-STR-NBR           16980000
169900****     IF AP023-FR-AMT-PAID < 0                                 16990000
170000****         COMPUTE AP045-FRGT-AMT =                             17000000
170100****               ((AP023-FR-AMT-PAID * AJPRRT-PRRT-PCT * -1)    17010000
170200****               + .005)                                        17020000
170300****     ELSE                                                     17030000
170400             COMPUTE AP045-FRGT-AMT =                             17040000
170500                   ((AP023-FR-AMT-PAID * AJPRRT-PRRT-PCT)         17050000
170600                   + .005)                                        17060000
170700****     END-IF                                                   17070000
170800         MOVE PV-ADJUSTED-FRGT-AMT TO DISPLAY-ADJUSTED-FRGT-AMT   17080000
170900         MOVE AP045-FRGT-AMT TO DISPLAY-FRGT-AMT                  17090000
171000         COMPUTE PV-ADJUSTED-FRGT-AMT =                           17100000
171100                 PV-ADJUSTED-FRGT-AMT - AP045-FRGT-AMT            17110000
171200         MOVE ZEROES            TO  AP045-DTL-TERM-DISC-AMT       17120000
171300         MOVE ZEROES            TO  AP045-DTL-NW-STR-DISC-AMT     17130000
171400         MOVE ZEROES            TO  AP045-DTL-TRD-DISC-AMT        17140000
171500         MOVE AP045-FRGT-AMT    TO  AP045-NET-COST-AMT            17150000
171600         MOVE ZEROES            TO  AP045-DTL-MOS-DISC-AMT        17160000
171700     END-IF.                                                      17170000
171800                                                                  17180000
171900     MOVE 'N' TO PS-FIRST-PO-PRORTN-SW.                           17190000
172000 EJECT                                                            17200000
172100                                                                  17210000
172200*---------------------------------------------------------------* 17220000
172300*  GET NEXT DOCUMENT NUMBER FROM TAPCNTL TABLE                  * 17230000
172400*---------------------------------------------------------------* 17240000
172500 D400-CALL-GET-NEXT-DOC-NBR.                                      17250000
172600                                                                  17260000
172700     SET WS151-COMMIT TO TRUE.                                    17270000
172800     CALL DP951-AJ-NEXT-DOC-NBR-ROUTINE                           17280000
172900                     USING WS151-DOC-NBR-PARAMETERS.              17290000
173000                                                                  17300000
173100     IF WS151-ERRORS-FOUND                                        17310000
173200         SET AC-BAD-DATA TO TRUE                                  17320000
173300         MOVE 'D400-CALL-GET-NEXT-DOC-NBR'                        17330000
173400                                    TO AA-PARAGRAPH-NAME          17340000
173500         MOVE 'ERRORS FOUND IN THE GET NEXT DOC NBR ROUTINE'      17350000
173600                                    TO AA-MESSAGE-1               17360000
173700         MOVE ', PROGRAM DPKUP151'  TO AA-MESSAGE-2               17370000
173800         PERFORM Z999-ABEND                                       17380000
173900     END-IF.                                                      17390000
174000 EJECT                                                            17400000
174100                                                                  17410000
174200*---------------------------------------------------------------* 17420000
174300*  THIS PARAGRAPH FORMATS AND WRITES THE CHARGEBACK ADJUSTMENT  * 17430000
174400*  RECORD TO CHARGE THE FREIGHT AMOUNT BACK TO THE VENDOR.      * 17440000
174500*---------------------------------------------------------------* 17450000
174600 D500-CREATE-COLLECT-CHARGEBACK.                                  17460000
174700                                                                  17470000
174800     INITIALIZE AP045-TRANSACTION-FILE                            17480000
174900                AP045-DETAIL-FIELDS.                              17490000
175000                                                                  17500000
175100     IF PV-COLL-ENT-ID = 9446 OR 32854                            17510000
175200        NEXT SENTENCE                                             17520000
175300     ELSE                                                         17530000
175400     MOVE PV-COLL-VND-NBR          TO AP045-VND-NBR.              17540000
175500     MOVE PV-COLL-ENT-ID           TO AP045-ENT-ID.               17550000
175600     MOVE PV-COLL-ENT-NAME         TO AP045-ENT-NME-DESC.         17560000
175700                                                                  17570000
175800     PERFORM D400-CALL-GET-NEXT-DOC-NBR.                          17580000
175900     MOVE WS151-NEXT-DOC-NBR       TO AP045-DOC-NBR.              17590000
176000     SET  AP045-DETAIL-RECORD      TO TRUE.                       17600000
176100     MOVE '11'                     TO AP045-AP-TRN-CDE.           17610000
176200                                                                  17620000
176300     PERFORM S950-SELECT-TTRNCDE.                                 17630000
176400     MOVE TRNCDE-PSTG-TYP-CDE      TO AP045-PSTG-TYP-CDE.         17640000
176500     MOVE TRNCDE-TRN-TYP-CDE       TO AP045-TRN-TYP-CDE.          17650000
176600     MOVE TRNCDE-BTCH-SRC-CDE      TO AP045-PS-BTCH-SRC-CDE.      17660000
176700                                                                  17670000
176800     MOVE PO-BEING-PROCESSED       TO AP045-PO-NBR.               17680000
176900     MOVE PV-COLL-DEPT-NBR         TO AP045-DEPT-NBR.             17690000
177000     MOVE PV-COLL-BTCH-PRC-DTE     TO AP045-ENTR-DTE              17700000
177100                                      AP045-DOC-DTE.              17710000
177200     MOVE PV-TIMESTAMP             TO AP045-ENTR-TME.             17720000
177300     MOVE 'APKUP130'               TO AP045-ENTR-ID.              17730000
177400     SET  AP045-ORGN-ADJUST        TO TRUE.                       17740000
177500     MOVE PV-COLL-BTCH-PRC-DTE     TO AP045-INV-CUTOFF-DTE.       17750000
177600     MOVE PV-COLL-BTCH-PRC-DTE     TO AP045-PS-BTCH-DTE.          17760000
177700     MOVE '00'                     TO AP045-PS-BTCH-SEQ-NBR.      17770000
177800     MOVE APCNTL-CURR-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR.         17780000
177900     MOVE APCNTL-CURR-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR.         17790000
178000     MOVE APCNTL-CURR-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR.         17800000
178100                                                                  17810000
178200     MOVE SPACES                   TO PV-CARRIER-AUTH-NUMBER.     17820000
178300     MOVE AP023-CARRIER-AUTH-NBR                                  17830000
178400                                   TO PV-CARRIER-AUTH-NUMBER.     17840000
178500     EVALUATE TRUE                                                17850000
178600         WHEN PV-CARRIER-FLD1 > 0                                 17860000
178700            MOVE PV-CARRIER-AUTH-NUMBER                           17870000
178800                                   TO PV-NEW-CARRIER-FLDS         17880000
178900         WHEN PV-CARRIER-FLD2 > 0                                 17890000
179000            MOVE PV-CARRIER-FLD2   TO PV-NEW-CARRIER-FLD1         17900000
179100            MOVE PV-CARRIER-FLD3   TO PV-NEW-CARRIER-FLD2         17910000
179200            MOVE PV-CARRIER-FLD4   TO PV-NEW-CARRIER-FLD3         17920000
179300            MOVE PV-CARRIER-FLD5   TO PV-NEW-CARRIER-FLD4         17930000
179400            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD5         17940000
179500            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD6         17950000
179600            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD7         17960000
179700            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD8         17970000
179800            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD9         17980000
179900            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD10        17990000
180000            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD11        18000000
180100         WHEN PV-CARRIER-FLD2 > 0                                 18010000
180200            MOVE PV-CARRIER-FLD2   TO PV-NEW-CARRIER-FLD1         18020000
180300            MOVE PV-CARRIER-FLD3   TO PV-NEW-CARRIER-FLD2         18030000
180400            MOVE PV-CARRIER-FLD4   TO PV-NEW-CARRIER-FLD3         18040000
180500            MOVE PV-CARRIER-FLD5   TO PV-NEW-CARRIER-FLD4         18050000
180600            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD5         18060000
180700            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD6         18070000
180800            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD7         18080000
180900            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD8         18090000
181000            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD9         18100000
181100            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD10        18110000
181200            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD11        18120000
181300         WHEN PV-CARRIER-FLD3 > 0                                 18130000
181400            MOVE PV-CARRIER-FLD3   TO PV-NEW-CARRIER-FLD1         18140000
181500            MOVE PV-CARRIER-FLD4   TO PV-NEW-CARRIER-FLD2         18150000
181600            MOVE PV-CARRIER-FLD5   TO PV-NEW-CARRIER-FLD3         18160000
181700            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD4         18170000
181800            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD5         18180000
181900            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD6         18190000
182000            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD7         18200000
182100            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD8         18210000
182200            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD9         18220000
182300            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD10        18230000
182400         WHEN PV-CARRIER-FLD4 > 0                                 18240000
182500            MOVE PV-CARRIER-FLD4   TO PV-NEW-CARRIER-FLD1         18250000
182600            MOVE PV-CARRIER-FLD5   TO PV-NEW-CARRIER-FLD2         18260000
182700            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD3         18270000
182800            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD4         18280000
182900            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD5         18290000
183000            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD6         18300000
183100            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD7         18310000
183200            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD8         18320000
183300            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD9         18330000
183400         WHEN PV-CARRIER-FLD5 > 0                                 18340000
183500            MOVE PV-CARRIER-FLD5   TO PV-NEW-CARRIER-FLD1         18350000
183600            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD2         18360000
183700            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD3         18370000
183800            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD4         18380000
183900            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD5         18390000
184000            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD6         18400000
184100            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD7         18410000
184200            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD8         18420000
184300         WHEN PV-CARRIER-FLD6 > 0                                 18430000
184400            MOVE PV-CARRIER-FLD6   TO PV-NEW-CARRIER-FLD1         18440000
184500            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD2         18450000
184600            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD3         18460000
184700            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD4         18470000
184800            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD5         18480000
184900            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD6         18490000
185000            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD7         18500000
185100         WHEN PV-CARRIER-FLD7 > 0                                 18510000
185200            MOVE PV-CARRIER-FLD7   TO PV-NEW-CARRIER-FLD1         18520000
185300            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD2         18530000
185400            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD3         18540000
185500            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD4         18550000
185600            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD5         18560000
185700            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD6         18570000
185800         WHEN PV-CARRIER-FLD8 > 0                                 18580000
185900            MOVE PV-CARRIER-FLD8   TO PV-NEW-CARRIER-FLD1         18590000
186000            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD2         18600000
186100            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD3         18610000
186200            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD4         18620000
186300            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD5         18630000
186400         WHEN PV-CARRIER-FLD9 > 0                                 18640000
186500            MOVE PV-CARRIER-FLD9   TO PV-NEW-CARRIER-FLD1         18650000
186600            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD2         18660000
186700            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD3         18670000
186800            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD4         18680000
186900         WHEN PV-CARRIER-FLD9 > 0                                 18690000
187000            MOVE PV-CARRIER-FLD10  TO PV-NEW-CARRIER-FLD1         18700000
187100            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD2         18710000
187200            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD3         18720000
187300         WHEN PV-CARRIER-FLD9 > 0                                 18730000
187400            MOVE PV-CARRIER-FLD11  TO PV-NEW-CARRIER-FLD1         18740000
187500            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD2         18750000
187600         WHEN PV-CARRIER-FLD9 > 0                                 18760000
187700            MOVE PV-CARRIER-FLD12  TO PV-NEW-CARRIER-FLD1         18770000
187800         WHEN OTHER                                               18780000
187900            MOVE PV-CARRIER-AUTH-NUMBER                           18790000
188000                                   TO PV-NEW-CARRIER-FLDS         18800000
188100     END-EVALUATE.                                                18810000
188200     MOVE SPACES                   TO AP045-RSN-TXT.              18820000
188300     IF (PV-NEW-CARRIER-FLDS   = SPACES OR                        18830000
188400         PV-NEW-CARRIER-FLDS   = LOW-VALUES OR                    18840000
188500         AP023-FR-BOL-NO = SPACES OR                              18850000
188600         AP023-FR-BOL-NO = LOW-VALUES)                            18860000
188700         IF (PV-NEW-CARRIER-FLDS   = SPACES OR                    18870000
188800             PV-NEW-CARRIER-FLDS   = LOW-VALUES)                  18880000
188900          AND (AP023-FR-BOL-NO = SPACES OR                        18890000
189000               AP023-FR-BOL-NO = LOW-VALUES)                      18900000
189100             STRING                                               18910000
189200                PV-COLLECT-PGM-MESSAGE DELIMITED BY SIZE          18920000
189300                ' FOR DC#'             DELIMITED BY SIZE          18930000
189400                 AP023-FR-STORE-NBR    DELIMITED BY SIZE          18940000
189500                ' PRO#'                DELIMITED BY SIZE          18950000
189600                AP023-FR-PB-FRST10     DELIMITED BY SPACES        18960000
189700             INTO AP045-RSN-TXT                                   18970000
189800         ELSE                                                     18980000
189900             IF (PV-NEW-CARRIER-FLDS   = SPACES OR                18990000
190000                 PV-NEW-CARRIER-FLDS   = LOW-VALUES)              19000000
190100                 STRING                                           19010000
190200                    PV-COLLECT-PGM-MESSAGE DELIMITED BY SIZE      19020000
190300                    ' FOR DC#'             DELIMITED BY SIZE      19030000
190400                    AP023-FR-STORE-NBR     DELIMITED BY SIZE      19040000
190500                    ' PRO#'                DELIMITED BY SIZE      19050000
190600                    AP023-FR-PB-FRST10     DELIMITED BY SPACES    19060000
190700                    ' BOL#'                DELIMITED BY SIZE      19070000
190800                    AP023-FR-BOL-NO        DELIMITED BY SPACES    19080000
190900                 INTO AP045-RSN-TXT                               19090000
191000             ELSE                                                 19100000
191100                 STRING                                           19110000
191200                    PV-COLLECT-PGM-MESSAGE DELIMITED BY SIZE      19120000
191300                    ' FOR DC#'             DELIMITED BY SIZE      19130000
191400                    AP023-FR-STORE-NBR     DELIMITED BY SIZE      19140000
191500                    ' PRO#'                DELIMITED BY SIZE      19150000
191600                    AP023-FR-PB-FRST10     DELIMITED BY SPACES    19160000
191700                    ' CAN#'                DELIMITED BY SIZE      19170000
191800                    PV-NEW-CARRIER-FLDS    DELIMITED BY SIZE      19180000
191900                 INTO AP045-RSN-TXT                               19190000
192000             END-IF                                               19200000
192100         END-IF                                                   19210000
192200     ELSE                                                         19220000
192300         STRING                                                   19230000
192400            PV-COLLECT-PGM-MESSAGE DELIMITED BY SIZE              19240000
192500            ' FOR DC#'             DELIMITED BY SIZE              19250000
192600            AP023-FR-STORE-NBR     DELIMITED BY SIZE              19260000
192700            ' PRO#'                DELIMITED BY SIZE              19270000
192800            AP023-FR-PB-FRST10     DELIMITED BY SPACES            19280000
192900            ' BOL#'                DELIMITED BY SIZE              19290000
193000            AP023-FR-BOL-NO        DELIMITED BY SPACES            19300000
193100            ' CAN#'                DELIMITED BY SIZE              19310000
193200            PV-NEW-CARRIER-FLDS    DELIMITED BY SIZE              19320000
193300         INTO AP045-RSN-TXT                                       19330000
193400     END-IF.                                                      19340000
193500                                                                  19350000
193600*  DETAIL FIELDS                                                  19360000
193700     MOVE PV-STR-NBR               TO AP045-STR-NBR.              19370000
193800     MOVE PV-COLL-CL-NBR           TO AP045-CL-NBR.               19380000
193900     MOVE ZEROES                   TO AP045-SKU-NBR.              19390000
194000     MOVE ZEROES                   TO AP045-GRO-COST-AMT.         19400000
194100     MOVE ZEROES                   TO AP045-RETL-AMT.             19410000
194200     MOVE ZEROES                   TO AP045-MISC-CHRG-AMT.        19420000
194300                                                                  19430000
194400     MOVE AP023-FR-AMT-PAID        TO AP045-FRGT-AMT.             19440000
194500     IF HALF-FREIGHT-VENDOR                                       19450000
194600        COMPUTE AP045-FRGT-AMT ROUNDED = AP045-FRGT-AMT * .5      19460000
194700     END-IF.                                                      19470000
194800** MUST REVERSE SIGN IN FIELD TO CREATE CREDIT FOR TRANSACTION    19480000
194900     COMPUTE AP045-FRGT-AMT = AP045-FRGT-AMT * -1.                19490000
195000                                                                  19500000
195100     MOVE ZEROES                   TO AP045-DTL-TERM-DISC-AMT.    19510000
195200     MOVE ZEROES                   TO AP045-DTL-NW-STR-DISC-AMT.  19520000
195300     MOVE ZEROES                   TO AP045-DTL-TRD-DISC-AMT.     19530000
195400     MOVE AP045-FRGT-AMT           TO AP045-NET-COST-AMT.         19540000
195500     MOVE ZEROES                   TO AP045-DTL-MOS-DISC-AMT.     19550000
195600                                                                  19560000
195700** WRITE TRANSACTION                                              19570000
195800     PERFORM W200-WRITE-FRGT-ADJ.                                 19580000
195900 EJECT                                                            19590000
196000                                                                  19600000
196100*--------------------------------------------------------------*  19610000
196200*  THIS PARAGRAPH VALIDATES THE DEPARTMENT AND EITHER THE      *  19620000
196300*  MAJOR CLASS OR SUBCLASS.                                    *  19630000
196400*--------------------------------------------------------------*  19640000
196500 E200-VALIDATE-DEPT-CLASS-NBR.                                    19650000
196600                                                                  19660000
196700     IF (AP023-FR-DEPT NOT NUMERIC) OR                            19670000
196800        (AP023-FR-DEPT = 0)                                       19680000
196900        MOVE 'Y' TO EDIT-SW                                       19690000
197000        MOVE 'DEPT INVALID ON FREIGHT FILE, ' TO DL-MESSAGE-A1    19700000
197100        MOVE 'REJECTING TRANSACTION         ' TO DL-MESSAGE-A2    19710000
197200        PERFORM W300-WRITE-REPORT-DETAILS                         19720000
197300*       SET INVALID-DEPT-CL                   TO TRUE             19730000
197400     ELSE                                                         19740000
197500        IF (AP023-FR-CLASSNO NOT NUMERIC) OR                      19750000
197600           (AP023-FR-CLASSNO = 0)                                 19760000
197700            MOVE 'Y' TO EDIT-SW                                   19770000
197800            MOVE 'CLASS INVALID ON FREIGHT FILE,'                 19780000
197900                                              TO DL-MESSAGE-A1    19790000
198000            MOVE ' REJECTING TRANSACTION        '                 19800000
198100                                              TO DL-MESSAGE-A2    19810000
198200            PERFORM W300-WRITE-REPORT-DETAILS                     19820000
198300*           SET INVALID-DEPT-CL               TO TRUE             19830000
198400        ELSE                                                      19840000
198500*  VALIDATES FOR THE MAJOR CLASS                                  19850000
198600             IF AP023-FR-CLASSNO(2:1) = 0                         19860000
198700                 MOVE AP023-FR-DEPT    TO PV-DEPT                 19870000
198800                 MOVE AP023-FR-CLASSNO TO PV-MAJOR-CLASSNO        19880000
198900                 PERFORM S500-SELECT-DEPT-MAJOR-CLASS             19890000
199000*  VALIDATES FOR THE SUB CLASS                                    19900000
199100             ELSE                                                 19910000
199200                 MOVE AP023-FR-DEPT      TO PV-DEPT               19920000
199300                 MOVE '0'                TO PV-SUB-CLASS-FRST1    19930000
199400                 MOVE AP023-FR-CLASSNO   TO PV-SUB-CLASS-LAST2    19940000
199500                 PERFORM S600-SELECT-DEPT-SUB-CLASS               19950000
199600             END-IF                                               19960000
199700        END-IF                                                    19970000
199800     END-IF.                                                      19980000
199900 EJECT                                                            19990000
200000                                                                  20000000
200100*--------------------------------------------------------------*  20010000
200200*  READS THE FREIGHT FILE.                                     *  20020000
200300*--------------------------------------------------------------*  20030000
200400 R100-READ-FREIGHT-FILE.                                          20040000
200500                                                                  20050000
200600     READ FREIGHT-FILE INTO AP023-FREIGHT-RECORD                  20060000
200700        AT END                                                    20070000
200800           MOVE 'Y' TO PS-FREIGHT-EOF-SW                          20080000
200900        NOT AT END                                                20090000
201000           ADD 1 TO FREIGHT-RECORDS-IN                            20100000
201100     END-READ.                                                    20110000
201200 EJECT                                                            20120000
201300                                                                  20130000
201400*--------------------------------------------------------------*  20140000
201500*  RETRIEVES INVOICE/RECEIVER ALLOWABLE VARIANCE PERCENT,      *  20150000
201600*  INVOICE/RECEIVER ALLOWABLE VARIANCE AMOUNT, AND PROCESS     *  20160000
201700*  DATE FROM THE AP PAYMENT CONTROL TABLE.                     *  20170000
201800*  NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE  *  20180000
201900*         CALCULATION OF WITHIN TOLERANCE AMOUNTS AND PAYMENT  *  20190000
202000*         DUE AND CUTOFF DATES SO PROCESSING CANNOT PROCEED    *  20200000
202100*         AND THE PROGRAM MUST ABEND.                          *  20210000
202200*--------------------------------------------------------------*  20220000
202300 S100-SELECT-CONTROL-DATA.                                        20230000
202400                                                                  20240000
202500     EXEC SQL                                                     20250000
202600         SELECT                                                   20260000
202700             INVC_RCV_VAR_PCT                                     20270000
202800            ,INVC_RCV_VAR_AMT                                     20280000
202900            ,BTCH_PRC_DTE                                         20290000
203000            ,BTCH_PRC_DTE + 1 DAY                                 20300000
203100            ,CURR_PSTG_FYR_NBR                                    20310000
203200            ,CURR_PSTG_FMN_NBR                                    20320000
203300            ,CURR_PSTG_FWK_NBR                                    20330000
203400         INTO                                                     20340000
203500             :APCNTL-INVC-RCV-VAR-PCT                             20350000
203600            ,:APCNTL-INVC-RCV-VAR-AMT                             20360000
203700            ,:APCNTL-BTCH-PRC-DTE                                 20370000
203800            ,:PV-COLL-BTCH-PRC-DTE                                20380000
203900            ,:APCNTL-CURR-PSTG-FYR-NBR                            20390000
204000            ,:APCNTL-CURR-PSTG-FMN-NBR                            20400000
204100            ,:APCNTL-CURR-PSTG-FWK-NBR                            20410000
204200         FROM TAPCNTL                                             20420000
204300     END-EXEC.                                                    20430000
204400                                                                  20440000
204500     EVALUATE TRUE                                                20450000
204600         WHEN SQLCODE = ZERO                                      20460000
204700              CONTINUE                                            20470000
204800         WHEN OTHER                                               20480000
204900             SET AC-UNSUCCESSFUL-SELECT TO TRUE                   20490000
205000             MOVE 'S100-SELECT-CONTROL-DATA'                      20500000
205100                                 TO AA-PARAGRAPH-NAME             20510000
205200             MOVE 'UNSUCCESSFUL SELECT'                           20520000
205300                                 TO AA-DB2-OPERATION              20530000
205400             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                20540000
205500             MOVE SPACES         TO AA-DB2-TABLE-2                20550000
205600             MOVE SPACES         TO AA-DB2-TABLE-3                20560000
205700             PERFORM Z998-DB2-ABEND                               20570000
205800     END-EVALUATE.                                                20580000
205900                                                                  20590000
206000 EJECT                                                            20600000
206100                                                                  20610000
206200*--------------------------------------------------------------*  20620000
206300*  RETRIEVES THE TRANSACTION CODE, SUBCLASS, SKU SEQUENCE,     *  20630000
206400*  AUTO OFFSET TRAN CODE, TYPE CODES, AND BATCH SOURCE CODE    *  20640000
206500*  FROM THE TTRNCDE TABLE FOR SPECIFIED TRAN CODES.            *  20650000
206600*--------------------------------------------------------------*  20660000
206700 S200-FETCH-TRN-CDE-CSR.                                          20670000
206800                                                                  20680000
206900     EXEC SQL                                                     20690000
207000       FETCH TRN_CDE_CSR                                          20700000
207100         INTO :TRNCDE-AP-TRN-CDE                                  20710000
207200            , :TRNCDE-SUB-CL-REQR-IND                             20720000
207300            , :TRNCDE-SKU-SEQ-REQR-IND                            20730000
207400            , :TRNCDE-AUTO-OFFST-TRN-CDE                          20740000
207500            , :TRNCDE-PSTG-TYP-CDE                                20750000
207600            , :TRNCDE-TRN-TYP-CDE                                 20760000
207700            , :TRNCDE-GL-ACCT-NBR                                 20770000
207800            , :TRNCDE-BTCH-SRC-CDE                                20780000
207900     END-EXEC.                                                    20790000
208000                                                                  20800000
208100     EVALUATE TRUE                                                20810000
208200         WHEN SQLCODE = ZERO                                      20820000
208300             CONTINUE                                             20830000
208400         WHEN SQLCODE = +100                                      20840000
208500             SET END-OF-TRN-CDE-CSR TO TRUE                       20850000
208600         WHEN OTHER                                               20860000
208700             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                20870000
208800             MOVE 'S200-FETCH-TRN-CDE-CSR' TO AA-PARAGRAPH-NAME   20880000
208900             MOVE 'UNSUCCESSFUL FETCH'    TO AA-DB2-OPERATION     20890000
209000             MOVE 'TTRNCDE'                TO AA-DB2-TABLE-1      20900000
209100             MOVE SPACES                   TO AA-DB2-TABLE-2      20910000
209200             MOVE SPACES                   TO AA-DB2-TABLE-3      20920000
209300             PERFORM Z998-DB2-ABEND                               20930000
209400     END-EVALUATE.                                                20940000
209500 EJECT                                                            20950000
209600                                                                  20960000
209700*--------------------------------------------------------------*  20970000
209800*  RETRIEVES THE PO NUMBER, DEPARTMENT NUMBER, CLASS NUMBER,   *  20980000
209900*  SKU SEQUENCE NUMBER, STORE NUMBER, AND PRORATION PERCENTAGE *  20990000
210000*  TO CREATE THE INDIVIDUAL TRANSACTIONS.                      *  21000000
210100*--------------------------------------------------------------*  21010000
210200 S300-FETCH-PO-PRORATION-CSR.                                     21020000
210300                                                                  21030000
210400     EXEC SQL                                                     21040000
210500       FETCH PO_PRORATION_CSR                                     21050000
210600         INTO :AJPRRT-PO-NBR                                      21060000
210700            , :AJPRRT-RCVR-SEQ-NBR                                21070000
210800            , :AJPRRT-PO-LNE-NBR                                  21080000
210900            , :AJPRRT-DEPT-NBR                                    21090000
211000            , :AJPRRT-CL-NBR                                      21100000
211100            , :AJPRRT-SKU-NBR                                     21110000
211200            , :AJPRRT-STR-NBR                                     21120000
211300            , :AJPRRT-PRRT-PCT                                    21130000
211400     END-EXEC.                                                    21140000
211500                                                                  21150000
211600     EVALUATE TRUE                                                21160000
211700         WHEN SQLCODE = ZERO                                      21170000
211800             CONTINUE                                             21180000
211900         WHEN SQLCODE = +100                                      21190000
212000             SET END-OF-PO-PRORTN-CSR   TO TRUE                   21200000
212100         WHEN OTHER                                               21210000
212200             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                21220000
212300             MOVE 'S300-FETCH-PO-PRORATION-CSR'                   21230000
212400                                 TO AA-PARAGRAPH-NAME             21240000
212500             MOVE 'UNSUCCESSFUL FETCH ON PO_PRORATION_CSR'        21250000
212600                                 TO AA-DB2-OPERATION              21260000
212700             MOVE 'TAJPRRT'      TO AA-DB2-TABLE-1                21270000
212800             MOVE SPACES         TO AA-DB2-TABLE-2                21280000
212900             MOVE SPACES         TO AA-DB2-TABLE-3                21290000
213000             PERFORM Z998-DB2-ABEND                               21300000
213100     END-EVALUATE.                                                21310000
213200 EJECT                                                            21320000
213300                                                                  21330000
213400*--------------------------------------------------------------*  21340000
213500*  RETRIEVES THE PO NUMBER FOR THE PO BEING PROCESSED TO       *  21350000
213600*  VALIDATE THE PO IS VALID.                                   *  21360000
213700*  NOTE: THE PO NUMBER CAN BE ZERO, IF IT IS ZERO WE HAVE TO   *  21370000
213800*        A VALID DEPT AND CLASS NUMBER.                        *  21380000
213900*--------------------------------------------------------------*  21390000
214000 S400-SELECT-PO-NBR.                                              21400000
214100                                                                  21410000
214200     EXEC SQL                                                     21420000
214300       SELECT  PO_NBR                                             21430000
214400             , PO_TYP_CDE                                         21440000
214500             , DEPT_NBR                                           21450000
214600         INTO :PURCHS-PO-NBR                                      21460000
214700             ,:PURCHS-PO-TYP-CDE                                  21470000
214800             ,:PURCHS-DEPT-NBR                                    21480000
214900         FROM TPURCHS                                             21490000
215000        WHERE PO_NBR = :PO-BEING-PROCESSED                        21500000
215100          AND VER_STATUS_CDE = 'A'                                21510000
215200          AND ORD_DTE  > (CURRENT DATE - 2 YEARS)                 21520000
215300     END-EXEC.                                                    21530000
215400                                                                  21540000
215500     EVALUATE TRUE                                                21550000
215600         WHEN SQLCODE = ZERO                                      21560000
215700             SET VALID-PO-NBR TO TRUE                             21570000
215800         WHEN SQLCODE = +100                                      21580000
215900             SET INVALID-PO-NBR TO TRUE                           21590000
216000             MOVE ZEROES TO PO-BEING-PROCESSED                    21600000
216100         WHEN OTHER                                               21610000
216200             MOVE PO-BEING-PROCESSED   TO PV-PO-DISPLAY           21620000
216300             DISPLAY 'PO BEING PROCESSED: ' PV-PO-DISPLAY         21630000
216400             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                21640000
216500             MOVE 'S400-SELECT-PO-NBR' TO AA-PARAGRAPH-NAME       21650000
216600             MOVE 'UNSUCCESSFUL SELECT ON PO NBR'                 21660000
216700                                       TO AA-DB2-OPERATION        21670000
216800             MOVE 'TPURCHS'            TO AA-DB2-TABLE-1          21680000
216900             MOVE SPACES               TO AA-DB2-TABLE-2          21690000
217000             MOVE SPACES               TO AA-DB2-TABLE-3          21700000
217100             PERFORM Z998-DB2-ABEND                               21710000
217200     END-EVALUATE.                                                21720000
217300 EJECT                                                            21730000
217400                                                                  21740000
217500*--------------------------------------------------------------*  21750000
217600*  RETRIEVES THE DEPARTMENT NUMBER AND MAJOR CLASS NUMBER      *  21760000
217700*  FOR THE PO BEING PROCESSED TO VALIDATE THEY ARE VALID       *  21770000
217800*--------------------------------------------------------------*  21780000
217900 S500-SELECT-DEPT-MAJOR-CLASS.                                    21790000
218000                                                                  21800000
218100     EXEC SQL                                                     21810000
218200       SELECT DEPT_NBR                                            21820000
218300            , MAJ_CL_NBR                                          21830000
218400         INTO :MDSEAR-DEPT-NBR                                    21840000
218500            , :MDSEAR-MAJ-CL-NBR                                  21850000
218600         FROM TMDSEAR                                             21860000
218700        WHERE DEPT_NBR    = :PV-DEPT                              21870000
218800          AND MAJ_CL_NBR  = :PV-MAJOR-CLASSNO                     21880000
218900          AND MDSELV_CDE  =  'MCL'                                21890000
219000          AND STRT_DTE   <= CURRENT DATE                          21900000
219100          AND END_DTE    >= CURRENT DATE                          21910000
219200     END-EXEC.                                                    21920000
219300                                                                  21930000
219400     EVALUATE TRUE                                                21940000
219500         WHEN SQLCODE = ZERO                                      21950000
219600             CONTINUE                                             21960000
219700         WHEN SQLCODE = +100                                      21970000
219800             MOVE 'Y' TO EDIT-SW                                  21980000
219900             MOVE 'DEPT/CLASS INVALID ON FREIGHT '                21990000
220000                                      TO DL-MESSAGE-A1            22000000
220100             MOVE 'FILE, REJECTING TRANSACTION   '                22010000
220200                                      TO DL-MESSAGE-A2            22020000
220300             PERFORM W300-WRITE-REPORT-DETAILS                    22030000
220400*            SET INVALID-DEPT-CL      TO TRUE                     22040000
220500         WHEN OTHER                                               22050000
220600             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                22060000
220700             MOVE 'S500-SELECT-DEPT-MAJOR-CLASS'                  22070000
220800                                       TO AA-PARAGRAPH-NAME       22080000
220900             MOVE 'UNSUCCESSFUL SELECT ON PO NBR'                 22090000
221000                                       TO AA-DB2-OPERATION        22100000
221100             MOVE 'TMDSEAR'            TO AA-DB2-TABLE-1          22110000
221200             MOVE SPACES               TO AA-DB2-TABLE-2          22120000
221300             MOVE SPACES               TO AA-DB2-TABLE-3          22130000
221400             PERFORM Z998-DB2-ABEND                               22140000
221500     END-EVALUATE.                                                22150000
221600 EJECT                                                            22160000
221700                                                                  22170000
221800*--------------------------------------------------------------*  22180000
221900*  RETRIEVES THE DEPARTMENT NUMBER AND SUB CLASS NUMBER        *  22190000
222000*  FOR THE PO BEING PROCESSED TO VALIDATE THEY ARE VALID       *  22200000
222100*--------------------------------------------------------------*  22210000
222200 S600-SELECT-DEPT-SUB-CLASS.                                      22220000
222300                                                                  22230000
222400     EXEC SQL                                                     22240000
222500       SELECT DEPT_NBR                                            22250000
222600            , SUB_CL_NBR                                          22260000
222700         INTO :MDSEAR-DEPT-NBR                                    22270000
222800            , :MDSEAR-SUB-CL-NBR                                  22280000
222900         FROM TMDSEAR                                             22290000
223000        WHERE DEPT_NBR    = :PV-DEPT                              22300000
223100          AND SUB_CL_NBR  = :PV-SUB-CLASSNO                       22310000
223200          AND MDSELV_CDE  =  'SCL'                                22320000
223300          AND STRT_DTE   <= CURRENT DATE                          22330000
223400          AND END_DTE    >= CURRENT DATE                          22340000
223500     END-EXEC.                                                    22350000
223600                                                                  22360000
223700     EVALUATE TRUE                                                22370000
223800         WHEN SQLCODE = ZERO                                      22380000
223900             CONTINUE                                             22390000
224000         WHEN SQLCODE = +100                                      22400000
224100             MOVE 'Y' TO EDIT-SW                                  22410000
224200             MOVE 'DEPT/CLASS INVALID ON FREIGHT '                22420000
224300                                                TO DL-MESSAGE-A1  22430000
224400             MOVE 'FILE, REJECTING TRANSACTION   '                22440000
224500                                                TO DL-MESSAGE-A2  22450000
224600             PERFORM W300-WRITE-REPORT-DETAILS                    22460000
224700*            SET INVALID-DEPT-CL      TO TRUE                     22470000
224800         WHEN OTHER                                               22480000
224900             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                22490000
225000             MOVE 'S600-SELECT-DEPT-SUB-CLASS'                    22500000
225100                                       TO AA-PARAGRAPH-NAME       22510000
225200             MOVE 'UNSUCCESSFUL SELECT ON PO NBR'                 22520000
225300                                       TO AA-DB2-OPERATION        22530000
225400             MOVE 'TMDSEAR'            TO AA-DB2-TABLE-1          22540000
225500             MOVE SPACES               TO AA-DB2-TABLE-2          22550000
225600             MOVE SPACES               TO AA-DB2-TABLE-3          22560000
225700             PERFORM Z998-DB2-ABEND                               22570000
225800     END-EVALUATE.                                                22580000
225900 EJECT                                                            22590000
226000                                                                  22600000
226100*--------------------------------------------------------------*  22610000
226200*  RETRIEVES THE STORE NUMBER AND THE TYPE CODE FOR THE PO     *  22620000
226300*  BEING PROCESSED TO VALIDATE THE STORE NUMBER IS CORRECT.    *  22630000
226400*  THE TYPE CODE WILL BE USED LATER TO DETERMINE WEATHER TO    *  22640000
226500*  PRORATE AT STORE LEVEL OR PRORATE TO ALL STORES.            *  22650000
226600*--------------------------------------------------------------*  22660000
226700 S700-SELECT-STORE-NBR.                                           22670000
226800                                                                  22680000
226900     MOVE ZERO               TO PV-STORE-9                        22690000
227000                                PV-STORE-9COMP.                   22700000
227100     MOVE AP023-FR-STORE-NBR TO PV-STORE-9.                       22710000
227200     MOVE PV-STORE-9         TO PV-STORE-9COMP.                   22720000
227300                                                                  22730000
227400     PERFORM VARYING LOC-INDX FROM 1 BY 1                         22740000
227500       UNTIL WS-STORE-NBR(LOC-INDX) = PV-STORE-9COMP              22750000
227600          OR WS-STORE-NBR(LOC-INDX) = ZEROES                      22760000
227700          OR LOC-INDX > 1500                                      22770000
227800     END-PERFORM.                                                 22780000
227900                                                                  22790000
228000     EVALUATE TRUE                                                22800000
228100         WHEN WS-STORE-NBR(LOC-INDX) = PV-STORE-9COMP             22810000
228200            MOVE WS-STORE-NBR(LOC-INDX) TO PV-STR-NBR             22820000
228300            MOVE WS-STORE-TYP-CDE(LOC-INDX) TO PV-STR-TYP-CDE     22830000
228400         WHEN WS-STORE-NBR(LOC-INDX) = ZEROES                     22840000
228500           OR LOC-INDX > 1500                                     22850000
228600            MOVE 'Y' TO EDIT-SW                                   22860000
228700            MOVE 'STORE NUMBER INVALID ON FREIGH' TO DL-MESSAGE-A122870000
228800            MOVE 'T FILE, REJECTING TRANSACTION ' TO DL-MESSAGE-A222880000
228900            PERFORM W300-WRITE-REPORT-DETAILS                     22890000
229000     END-EVALUATE.                                                22900000
229100                                                                  22910000
229200 EJECT                                                            22920000
229300                                                                  22930000
229400*--------------------------------------------------------------*  22940000
229500* RETREIVES THE VENDOR DUNN NUMBER, ENT ID,                    *  22950000
229600* AND ENT NAME FOR THE PO BEING PROCESSED                      *  22960000
229700*--------------------------------------------------------------*  22970000
229800 S800-SELECT-VENDOR.                                              22980000
229900                                                                  22990000
230000     EXEC SQL                                                     23000000
230100         SELECT DISTINCT EE.DUN_NBR                               23010000
230200              , EE.ENT_ID                                         23020000
230300              , NE.ENT_NAME_DESC                                  23030000
230400           INTO :EXTENT-DUN-NBR                                   23040000
230500              , :EXTENT-ENT-ID                                    23050000
230600              , :ENTNME-ENT-NAME-DESC                             23060000
230700           FROM TPURCHS PU                                        23070000
230800              , TEXTENT EE                                        23080000
230900              , TENTNME NE                                        23090000
231000          WHERE PU.PO_NBR = :PO-BEING-PROCESSED                   23100000
231100            AND PU.ENT_ID = EE.ENT_ID                             23110000
231200            AND NE.ENT_ID = EE.ENT_ID                             23120000
231300            AND PU.VER_STATUS_CDE = 'A'                           23130000
231400**          AND EE.STATUS_CDE = 'A'                               23140000
231500            AND NE.TYPE_CDE = '01'                                23150000
231600     END-EXEC.                                                    23160000
231700                                                                  23170000
231800     EVALUATE TRUE                                                23180000
231900        WHEN SQLCODE = ZERO                                       23190000
232000            SET VENDOR-FOUND TO TRUE                              23200000
232100        WHEN SQLCODE = -904                                       23210000
232200        WHEN SQLCODE = -911                                       23220000
232300        WHEN SQLCODE = -913                                       23230000
232400            CONTINUE                                              23240000
232500        WHEN SQLCODE = +100                                       23250000
232600            SET DEFAULT-VENDOR TO TRUE                            23260000
232700        WHEN OTHER                                                23270000
232800            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    23280000
232900            MOVE 'S800-SELECT-VENDOR'    TO AA-PARAGRAPH-NAME     23290000
233000            MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION      23300000
233100            MOVE 'TPURCHS'               TO AA-DB2-TABLE-1        23310000
233200            MOVE 'TEXTENT'               TO AA-DB2-TABLE-2        23320000
233300            MOVE 'TENTNME'               TO AA-DB2-TABLE-3        23330000
233400            PERFORM Z998-DB2-ABEND                                23340000
233500     END-EVALUATE.                                                23350000
233600 EJECT                                                            23360000
233700                                                                  23370000
233800*--------------------------------------------------------------*  23380000
233900* SELECT FROM TRECEIV TO SEE IF SEQUENCE NUMBER EXISTS         *  23390000
234000*--------------------------------------------------------------*  23400000
234100 S900-SELECT-TRECEIV.                                             23410000
234200                                                                  23420000
234300     EXEC SQL                                                     23430000
234400         SELECT 1                                                 23440000
234500           INTO :RECEIV-REC-SEQ-NBR                               23450000
234600           FROM TRECEIV                                           23460000
234700          WHERE ORD_NBR = :PO-BEING-PROCESSED                     23470000
234800            AND STATUS_CDE = 'VE'                                 23480000
234900            AND VER_STATUS_CDE = 'A'                              23490000
235000            AND NOT FS_POST_TMST = '9999-09-09-09.09.09.999999'   23500000
235100            AND REC_SEQ_NBR = :PV-AP023-REC-SEQ-NBR               23510000
235200     END-EXEC.                                                    23520000
235300                                                                  23530000
235400     EVALUATE TRUE                                                23540000
235500        WHEN SQLCODE = ZERO                                       23550000
235600            SET TRECEIV-FOUND TO TRUE                             23560000
235700            SET TRECEIV-PO-FOUND TO TRUE                          23570000
235800        WHEN SQLCODE = +100                                       23580000
235900            SET TRECEIV-NOT-FOUND TO TRUE                         23590000
236000            PERFORM S910-SELECT-TRECEIV-FOR-PO                    23600000
236100        WHEN OTHER                                                23610000
236200            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    23620000
236300            MOVE 'S900-SELECT-TRECEIV'   TO AA-PARAGRAPH-NAME     23630000
236400            MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION      23640000
236500            MOVE 'TRECEIV'               TO AA-DB2-TABLE-1        23650000
236600            MOVE SPACES                  TO AA-DB2-TABLE-2        23660000
236700                                            AA-DB2-TABLE-3        23670000
236800            PERFORM Z998-DB2-ABEND                                23680000
236900     END-EVALUATE.                                                23690000
237000 EJECT                                                            23700000
237100                                                                  23710000
237200*--------------------------------------------------------------*  23720000
237300* SELECT FROM TRECEIV TO SEE IF PO EXISTS                      *  23730000
237400*--------------------------------------------------------------*  23740000
237500 S910-SELECT-TRECEIV-FOR-PO.                                      23750000
237600                                                                  23760000
237700     EXEC SQL                                                     23770000
237800         SELECT 1                                                 23780000
237900           INTO :RECEIV-REC-SEQ-NBR                               23790000
238000           FROM TRECEIV                                           23800000
238100          WHERE ORD_NBR = :PO-BEING-PROCESSED                     23810000
238200            AND STATUS_CDE = 'VE'                                 23820000
238300            AND VER_STATUS_CDE = 'A'                              23830000
238400            AND NOT FS_POST_TMST = '9999-09-09-09.09.09.999999'   23840000
238500     END-EXEC.                                                    23850000
238600                                                                  23860000
238700     EVALUATE TRUE                                                23870000
238800        WHEN SQLCODE = ZERO                                       23880000
238900        WHEN SQLCODE = -811                                       23890000
239000            SET TRECEIV-PO-FOUND TO TRUE                          23900000
239100        WHEN SQLCODE = +100                                       23910000
239200            SET TRECEIV-PO-NOT-FOUND TO TRUE                      23920000
239300        WHEN OTHER                                                23930000
239400            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    23940000
239500            MOVE 'S910-SELECT-TRECEIV'   TO AA-PARAGRAPH-NAME     23950000
239600            MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION      23960000
239700            MOVE 'TRECEIV'               TO AA-DB2-TABLE-1        23970000
239800            MOVE SPACES                  TO AA-DB2-TABLE-2        23980000
239900                                            AA-DB2-TABLE-3        23990000
240000            PERFORM Z998-DB2-ABEND                                24000000
240100     END-EVALUATE.                                                24010000
240200 EJECT                                                            24020000
240300                                                                  24030000
240400*--------------------------------------------------------------*  24040000
240500* SELECT FROM TTRNCDE TABLE TO GET DATA NEEDED TO CREATE       *  24050000
240600* OFFSET TRANSACTION RECORD FOR GL                             *  24060000
240700*--------------------------------------------------------------*  24070000
240800 S950-SELECT-TTRNCDE.                                             24080000
240900                                                                  24090000
241000     EXEC SQL                                                     24100000
241100       SELECT AP_TRN_CDE                                          24110000
241200            , SUB_CL_REQR_IND                                     24120000
241300            , SKU_SEQ_REQR_IND                                    24130000
241400            , AUTO_OFFST_TRN_CDE                                  24140000
241500            , PSTG_TYP_CDE                                        24150000
241600            , TRN_TYP_CDE                                         24160000
241700            , GL_ACCT_NBR                                         24170000
241800            , BTCH_SRC_CDE                                        24180000
241900         INTO :TRNCDE-AP-TRN-CDE                                  24190000
242000            , :TRNCDE-SUB-CL-REQR-IND                             24200000
242100            , :TRNCDE-SKU-SEQ-REQR-IND                            24210000
242200            , :TRNCDE-AUTO-OFFST-TRN-CDE                          24220000
242300            , :TRNCDE-PSTG-TYP-CDE                                24230000
242400            , :TRNCDE-TRN-TYP-CDE                                 24240000
242500            , :TRNCDE-GL-ACCT-NBR                                 24250000
242600            , :TRNCDE-BTCH-SRC-CDE                                24260000
242700         FROM TTRNCDE                                             24270000
242800        WHERE AP_TRN_CDE = :AP045-AP-TRN-CDE                      24280000
242900          AND CURRENT DATE  BETWEEN EFF_STRT_DTE AND              24290000
243000                                    EFF_END_DTE                   24300000
243100     END-EXEC.                                                    24310000
243200                                                                  24320000
243300     EVALUATE TRUE                                                24330000
243400        WHEN SQLCODE = ZERO                                       24340000
243500            CONTINUE                                              24350000
243600        WHEN OTHER                                                24360000
243700            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    24370000
243800            MOVE 'S950-SELECT-TTRNCDE'    TO AA-PARAGRAPH-NAME    24380000
243900            MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION      24390000
244000            MOVE 'TTRNCDE'               TO AA-DB2-TABLE-1        24400000
244100            MOVE SPACES                  TO AA-DB2-TABLE-2        24410000
244200                                            AA-DB2-TABLE-3        24420000
244300            PERFORM Z998-DB2-ABEND                                24430000
244400     END-EVALUATE.                                                24440000
244500 EJECT                                                            24450000
244600                                                                  24460000
244700*--------------------------------------------------------------*  24470000
244800* RETREIVES THE ENT ID AND ENT NAME FOR THE DEFAULT VENDOR     *  24480000
244900* BEING PROCESSED                                              *  24490000
245000*--------------------------------------------------------------*  24500000
245100 S960-SELECT-DEFAULT-INFO.                                        24510000
245200                                                                  24520000
245300     EXEC SQL                                                     24530000
245400         SELECT EE.ENT_ID                                         24540000
245500              , NE.ENT_NAME_DESC                                  24550000
245600           INTO :PV-DEFAULT-VND-NBR                               24560000
245700              , :PV-DEFAULT-VND-NAME                              24570000
245800           FROM TEXTENT EE                                        24580000
245900              , TENTNME NE                                        24590000
246000          WHERE EE.DUN_NBR = :PC-DEFAULT-VENDOR                   24600000
246100            AND NE.ENT_ID = EE.ENT_ID                             24610000
246200            AND EE.STATUS_CDE = 'A'                               24620000
246300            AND NE.TYPE_CDE = '01'                                24630000
246400     END-EXEC.                                                    24640000
246500                                                                  24650000
246600     EVALUATE TRUE                                                24660000
246700        WHEN SQLCODE = ZERO                                       24670000
246800        WHEN SQLCODE = -904                                       24680000
246900        WHEN SQLCODE = -911                                       24690000
247000        WHEN SQLCODE = -913                                       24700000
247100            CONTINUE                                              24710000
247200        WHEN OTHER                                                24720000
247300            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    24730000
247400            MOVE 'S960-SELECT-DEFAULT-INFO' TO AA-PARAGRAPH-NAME  24740000
247500            MOVE 'UNSUCCESSFUL SELECT'       TO AA-DB2-OPERATION  24750000
247600            MOVE 'TEXTENT'                   TO AA-DB2-TABLE-1    24760000
247700            MOVE 'TENTNME'                   TO AA-DB2-TABLE-2    24770000
247800            MOVE SPACES                      TO AA-DB2-TABLE-3    24780000
247900            PERFORM Z998-DB2-ABEND                                24790000
248000     END-EVALUATE.                                                24800000
248100 EJECT                                                            24810000
248200                                                                  24820000
248300*--------------------------------------------------------------*  24830000
248400* RETREIVES THE ENT ID FOR ALL SEPHORA VENDORS AND STORES THEM *  24840000
248500* IN AN ARRAY                                                  *  24850000
248600*--------------------------------------------------------------*  24860000
248700 T100-GET-SEPHORA-ENTIDS.                                         24870000
248800                                                                  24880000
248900     SET SE-IDX TO 1.                                             24890000
249000     PERFORM T200-OPEN-ENTID-CSR.                                 24900000
249100     PERFORM T300-FETCH-ENTID-CSR UNTIL                           24910000
249200                                PS-ENTID-END-YES OR               24920000
249300                                SE-IDX > 500.                     24930000
249400       IF SE-IDX > 500                                            24940000
249500          SET AC-TABLE-OVERFLOW           TO TRUE                 24950000
249600          MOVE 'T100-GET-SEPHORA-ENTIDS'  TO AA-PARAGRAPH-NAME    24960000
249700          MOVE 'ENTID ARRAY EXCEEDS MAX' TO AA-MESSAGE            24970000
249800          PERFORM Z999-ABEND                                      24980000
249900       END-IF                                                     24990000
250000     PERFORM T400-CLOSE-ENTID-CSR.                                25000000
250100                                                                  25010000
250200*---------------------------------------------------------------  25020000
250300*   T200-OPEN-ENTID-CSR                                           25030000
250400*   OPENS THE CURSOR THAT WILL GET THE SEPHORA ENTIDS             25040000
250500*---------------------------------------------------------------  25050000
250600 T200-OPEN-ENTID-CSR.                                             25060000
250700                                                                  25070000
250800     EXEC SQL                                                     25080000
250900         OPEN SEPHORA_ENTID_CSR                                   25090000
251000     END-EXEC.                                                    25100000
251100                                                                  25110000
251200     EVALUATE TRUE                                                25120000
251300         WHEN SQLCODE = ZERO                                      25130000
251400              CONTINUE                                            25140000
251500                                                                  25150000
251600         WHEN SQLCODE = +100                                      25160000
251700             MOVE 'T200-OPEN-ENTID-CSR'                           25170000
251800                                TO AA-PARAGRAPH-NAME              25180000
251900             MOVE 'NO SEPHORA AT KOHLS ENTIDS'                    25190000
252000                                 TO AA-DB2-OPERATION              25200000
252100             MOVE 'VNT_VND_CPBL' TO AA-DB2-TABLE-1                25210000
252200             MOVE SPACES         TO AA-DB2-TABLE-2                25220000
252300             PERFORM Z998-DB2-ABEND                               25230000
252400                                                                  25240000
252500         WHEN SQLWARN0 NOT = SPACES                               25250000
252600         WHEN SQLCODE  NOT = ZERO                                 25260000
252700             MOVE 'T200-OPEN-DEPT-CSR'                            25270000
252800                                 TO AA-PARAGRAPH-NAME             25280000
252900             MOVE 'UNSUCCESSFUL OPEN ON SEPHORA_DEPT_CSR'         25290000
253000                                 TO AA-DB2-OPERATION              25300000
253100             MOVE 'VNT_VND_CPBL' TO AA-DB2-TABLE-1                25310000
253200             MOVE SPACES         TO AA-DB2-TABLE-2                25320000
253300             PERFORM Z998-DB2-ABEND                               25330000
253400     END-EVALUATE.                                                25340000
253500                                                                  25350000
253600                                                                  25360000
253700*---------------------------------------------------------------- 25370000
253800*   T300-FETCH-ENTID-CSR                                          25380000
253900*   RETRIEVE THE SEPHORA ENTIDS AND LOAD INTO TABLE               25390000
254000*---------------------------------------------------------------- 25400000
254100  T300-FETCH-ENTID-CSR.                                           25410000
254200                                                                  25420000
254300     EXEC SQL                                                     25430000
254400         FETCH SEPHORA_ENTID_CSR                                  25440000
254500         INTO :VNT00001-ENT-ID                                    25450000
254600     END-EXEC.                                                    25460000
254700                                                                  25470000
254800     EVALUATE TRUE                                                25480000
254900         WHEN SQLCODE = +100                                      25490000
255000           SET PS-ENTID-END-YES    TO TRUE                        25500000
255100         WHEN SQLCODE = ZERO                                      25510000
255200           MOVE VNT00001-ENT-ID TO PV-SEPHORA-ENTID(SE-IDX)       25520000
255300           SET SE-IDX UP BY 1                                     25530000
255400         WHEN SQLWARN0 NOT = SPACES                               25540000
255500         WHEN SQLCODE  NOT = ZERO                                 25550000
255600           MOVE 'T300-FETCH-ENTID-CSR'                            25560000
255700                               TO AA-PARAGRAPH-NAME               25570000
255800           MOVE                                                   25580000
255900             'UNSUCCESSFUL FETCH WITH SEPHORA_ENTID_CSR'          25590000
256000                               TO AA-DB2-OPERATION                25600000
256100           MOVE 'VNT_VND_CPBL' TO AA-DB2-TABLE-1                  25610000
256200           MOVE SPACES         TO AA-DB2-TABLE-2                  25620000
256300           PERFORM Z998-DB2-ABEND                                 25630000
256400     END-EVALUATE.                                                25640000
256500                                                                  25650000
256600*---------------------------------------------------------------- 25660000
256700*   T400-CLOSE-ENTID-CSR                                          25670000
256800*   CLOSES THE CURSOR THAT GOT THE SEPHORA ENT-IDS                25680000
256900*---------------------------------------------------------------- 25690000
257000  T400-CLOSE-ENTID-CSR.                                           25700000
257100                                                                  25710000
257200     EXEC SQL                                                     25720000
257300         CLOSE SEPHORA_ENTID_CSR                                  25730000
257400     END-EXEC.                                                    25740000
257500                                                                  25750000
257600     EVALUATE TRUE                                                25760000
257700         WHEN SQLCODE = ZERO                                      25770000
257800              CONTINUE                                            25780000
257900                                                                  25790000
258000         WHEN SQLWARN0 NOT = SPACES                               25800000
258100         WHEN SQLCODE  NOT = ZERO                                 25810000
258200             MOVE 'T400-CLOSE-ENTID-CSR'                          25820000
258300                                 TO AA-PARAGRAPH-NAME             25830000
258400             MOVE 'UNSUCCESSFUL CLOSE ON SEPHORA_ENTID_CSR'       25840000
258500                                 TO AA-DB2-OPERATION              25850000
258600             MOVE 'VNT_VND_CPBL' TO AA-DB2-TABLE-1                25860000
258700             MOVE SPACES         TO AA-DB2-TABLE-2                25870000
258800             PERFORM Z998-DB2-ABEND                               25880000
258900     END-EVALUATE.                                                25890000
259000                                                                  25900000
259100*--------------------------------------------------------------*  25910000
259200* RETREIVES THE 'SEPHORA AT KOHLS' DEPTS AND STORES THEM       *  25920000
259300* IN AN ARRAY                                                  *  25930000
259400*--------------------------------------------------------------*  25940000
259500 T500-GET-SEPHORA-DEPTS.                                          25950000
259600                                                                  25960000
259700     SET SD-IDX TO 1.                                             25970000
259800     PERFORM T600-OPEN-DEPT-CSR.                                  25980000
259900     PERFORM T700-FETCH-DEPT-CSR UNTIL                            25990000
260000                                PS-DEPT-END-YES OR                26000000
260100                                SD-IDX > 25.                      26010000
260200       IF SD-IDX > 25                                             26020000
260300          SET AC-TABLE-OVERFLOW           TO TRUE                 26030000
260400          MOVE 'T500-GET-SEPHORA-DEPT'    TO AA-PARAGRAPH-NAME    26040000
260500          MOVE 'DEPT ARRAY EXCEEDS LIMIT' TO AA-MESSAGE           26050000
260600          PERFORM Z999-ABEND                                      26060000
260700       END-IF                                                     26070000
260800     PERFORM T800-CLOSE-DEPT-CSR.                                 26080000
260900                                                                  26090000
261000*---------------------------------------------------------------  26100000
261100*   T600-OPEN-DEPT-CSR                                            26110000
261200*   OPENS THE CURSOR THAT WILL GET THE 'SEPHORA AT KOHLS' DEPTS   26120000
261300*---------------------------------------------------------------  26130000
261400 T600-OPEN-DEPT-CSR.                                              26140000
261500                                                                  26150000
261600     EXEC SQL                                                     26160000
261700         OPEN SEPHORA_DEPT_CSR                                    26170000
261800     END-EXEC.                                                    26180000
261900                                                                  26190000
262000     EVALUATE TRUE                                                26200000
262100         WHEN SQLCODE = ZERO                                      26210000
262200              CONTINUE                                            26220000
262300                                                                  26230000
262400         WHEN SQLCODE = +100                                      26240000
262500             MOVE 'T600-OPEN-DEPT-CSR'                            26250000
262600                                TO AA-PARAGRAPH-NAME              26260000
262700             MOVE 'NO SEPHORA AT KOHLS DEPTS'                     26270000
262800                                 TO AA-DB2-OPERATION              26280000
262900             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                26290000
263000             MOVE SPACES         TO AA-DB2-TABLE-2                26300000
263100             PERFORM Z998-DB2-ABEND                               26310000
263200                                                                  26320000
263300         WHEN SQLWARN0 NOT = SPACES                               26330000
263400         WHEN SQLCODE  NOT = ZERO                                 26340000
263500             MOVE 'T600-OPEN-DEPT-CSR'                            26350000
263600                                TO AA-PARAGRAPH-NAME              26360000
263700             MOVE 'UNSUCCESSFUL OPEN ON SEPHORA_DEPT_CSR'         26370000
263800                                TO AA-DB2-OPERATION               26380000
263900             MOVE 'TMDSEAR'     TO AA-DB2-TABLE-1                 26390000
264000             MOVE SPACES        TO AA-DB2-TABLE-2                 26400000
264100             PERFORM Z998-DB2-ABEND                               26410000
264200     END-EVALUATE.                                                26420000
264300                                                                  26430000
264400                                                                  26440000
264500*---------------------------------------------------------------- 26450000
264600*   T700-FETCH-DEPT-CSR                                           26460000
264700*   RETRIEVE THE 'SEPHORA AT KOHLS' DEPTS AND LOAD INTO TABLE     26470000
264800*---------------------------------------------------------------- 26480000
264900  T700-FETCH-DEPT-CSR.                                            26490000
265000                                                                  26500000
265100     EXEC SQL                                                     26510000
265200         FETCH SEPHORA_DEPT_CSR                                   26520000
265300         INTO :MDSEAR-DEPT-NBR                                    26530000
265400     END-EXEC.                                                    26540000
265500                                                                  26550000
265600     EVALUATE TRUE                                                26560000
265700         WHEN SQLCODE = +100                                      26570000
265800           SET PS-DEPT-END-YES    TO TRUE                         26580000
265900         WHEN SQLCODE = ZERO                                      26590000
266000           MOVE MDSEAR-DEPT-NBR TO PV-SEPHORA-DEPT(SD-IDX)        26600000
266100           SET SD-IDX UP BY 1                                     26610000
266200         WHEN SQLWARN0 NOT = SPACES                               26620000
266300         WHEN SQLCODE  NOT = ZERO                                 26630000
266400           MOVE 'T700-FETCH-DEPT-CSR'                             26640000
266500                               TO AA-PARAGRAPH-NAME               26650000
266600           MOVE                                                   26660000
266700             'UNSUCCESSFUL FETCH WITH SEPHORA_DEPT_CSR'           26670000
266800                               TO AA-DB2-OPERATION                26680000
266900           MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                  26690000
267000           MOVE SPACES         TO AA-DB2-TABLE-2                  26700000
267100           PERFORM Z998-DB2-ABEND                                 26710000
267200     END-EVALUATE.                                                26720000
267300                                                                  26730000
267400*---------------------------------------------------------------- 26740000
267500*   T800-CLOSE-DEPT-CSR                                           26750000
267600*   CLOSES THE CURSOR THAT GOT THE 'SEPHORA AT KOHLS' DEPTS       26760000
267700*---------------------------------------------------------------- 26770000
267800  T800-CLOSE-DEPT-CSR.                                            26780000
267900                                                                  26790000
268000     EXEC SQL                                                     26800000
268100         CLOSE SEPHORA_DEPT_CSR                                   26810000
268200     END-EXEC.                                                    26820000
268300                                                                  26830000
268400     EVALUATE TRUE                                                26840000
268500         WHEN SQLCODE = ZERO                                      26850000
268600              CONTINUE                                            26860000
268700                                                                  26870000
268800         WHEN SQLWARN0 NOT = SPACES                               26880000
268900         WHEN SQLCODE  NOT = ZERO                                 26890000
269000             MOVE 'T800-CLOSE-DEPT-CSR'                           26900000
269100                                 TO AA-PARAGRAPH-NAME             26910000
269200             MOVE 'UNSUCCESSFUL CLOSE ON SEPHORA_DEPT_CSR'        26920000
269300                                 TO AA-DB2-OPERATION              26930000
269400             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                26940000
269500             MOVE SPACES         TO AA-DB2-TABLE-2                26950000
269600             PERFORM Z998-DB2-ABEND                               26960000
269700     END-EVALUATE.                                                26970000
269800                                                                  26980000
269900                                                                  26990000
270000*---------------------------------------------------------------- 27000000
270100*  CHECK TO SEE IF THE DEPT IS FOR 'SEPHORA AT KOHLS' AND THE     27010000
270200*  ENTID HAS A CAPABILITY CODE OF 'SBS'                           27020000
270300*---------------------------------------------------------------- 27030000
270400 T900-SET-SEPHORA-SW.                                             27040000
270500                                                                  27050000
270600     SET PS-SEPHORA-EXEMPT-NO TO TRUE.                            27060000
270700     MOVE 'N'                 TO PV-MATCH-DEPT.                   27070000
270800     MOVE 'N'                 TO PV-MATCH-ENTID.                  27080000
270900     SET SD-IDX TO 1.                                             27090000
271000     PERFORM T910-SEARCH-DEPT                                     27100000
271100        UNTIL PV-MATCH-DEPT = 'Y' OR                              27110000
271200              PV-SEPHORA-DEPT(SD-IDX) = SPACES.                   27120000
271300                                                                  27130000
271400     IF PV-MATCH-DEPT = 'Y'                                       27140000
271500         SET SE-IDX TO 1                                          27150000
271600         PERFORM T920-SEARCH-ENTID                                27160000
271700            UNTIL PV-MATCH-ENTID = 'Y' OR                         27170000
271800                  PV-SEPHORA-ENTID(SE-IDX) = ZERO                 27180000
271900         IF PV-MATCH-ENTID = 'Y'                                  27190000
272000            SET PS-SEPHORA-EXEMPT-YES TO TRUE                     27200000
272100         END-IF                                                   27210000
272200     END-IF.                                                      27220000
272300                                                                  27230000
272400                                                                  27240000
272500 T910-SEARCH-DEPT.                                                27250000
272600     IF PV-SEPHORA-DEPT(SD-IDX) = PV-DEPT-NBR                     27260000
272700         MOVE 'Y'              TO PV-MATCH-DEPT                   27270000
272800     END-IF.                                                      27280000
272900     SET SD-IDX UP BY 1.                                          27290000
273000                                                                  27300000
273100 T920-SEARCH-ENTID.                                               27310000
273200     IF PV-SEPHORA-ENTID(SE-IDX) = PV-CHECK-VENDOR                27320000
273300         MOVE 'Y'              TO PV-MATCH-ENTID                  27330000
273400     END-IF.                                                      27340000
273500     SET SE-IDX UP BY 1.                                          27350000
273600                                                                  27360000
273700*--------------------------------------------------------------*  27370000
273800*  WRITES THE REPORT HEADERS                                   *  27380000
273900*--------------------------------------------------------------*  27390000
274000 W100-WRITE-REPORT-HEADERS.                                       27400000
274100                                                                  27410000
274200     ADD 1 TO PAGE-COUNT.                                         27420000
274300     MOVE PAGE-COUNT TO DP150O-PAGE-NUMBER.                       27430000
274400                                                                  27440000
274500     WRITE REPORT-RECORD FROM DP150O-STANDRD-HEADER-150-COLS      27450000
274600           AFTER PAGE.                                            27460000
274700     WRITE REPORT-RECORD FROM HDR-LINE-1 AFTER 1.                 27470000
274800     WRITE REPORT-RECORD FROM HDR-LINE-2 AFTER 2.                 27480000
274900                                                                  27490000
275000     MOVE +5 TO LINE-COUNT.                                       27500000
275100 EJECT                                                            27510000
275200                                                                  27520000
275300*--------------------------------------------------------------*  27530000
275400*  WRITES THE TRANSACTION RECORD                               *  27540000
275500*--------------------------------------------------------------*  27550000
275600 W200-WRITE-FRGT-ADJ.                                             27560000
275700                                                                  27570000
275800     WRITE FRGT-ADJ-RECORD FROM AP045-TRANSACTION-FILE.           27580000
275900                                                                  27590000
276000     ADD +1 TO FREIGHT-RECORDS-OUT.                               27600000
276100 EJECT                                                            27610000
276200                                                                  27620000
276300*--------------------------------------------------------------*  27630000
276400*  WRITES THE DETAIL LINES FOR THE EXCEPTION REPORT            *  27640000
276500*--------------------------------------------------------------*  27650000
276600 W300-WRITE-REPORT-DETAILS.                                       27660000
276700                                                                  27670000
276800     MOVE AP023-FR-PO-NBR       TO DL-PO-NBR.                     27680000
276900     MOVE AP023-FR-PRODBILL     TO DL-DOC-NBR.                    27690000
277000     MOVE AP023-FR-KEYREC       TO DL-KEY-REC.                    27700000
277100     MOVE AP023-FR-STORE-NBR    TO DL-STORE-NBR.                  27710000
277200     MOVE AP023-FR-DEPT         TO DL-DEPT-NBR.                   27720000
277300     MOVE AP023-FR-CLASSNO      TO DL-CLASS-NBR.                  27730000
277400     MOVE AP023-FR-TRIP-ID      TO DL-TRIP-ID.                    27740000
277500                                                                  27750000
277600     IF AP023-FR-AMT-PAID NUMERIC                                 27760000
277700         MOVE AP023-FR-AMT-PAID TO DL-AMT-PAID                    27770000
277800     ELSE                                                         27780000
277900         MOVE AP023-FR-AMT-PAID TO DL-AMT-PAID-X                  27790000
278000     END-IF.                                                      27800000
278100                                                                  27810000
278200     IF LINE-COUNT > 55                                           27820000
278300        PERFORM W100-WRITE-REPORT-HEADERS                         27830000
278400     END-IF.                                                      27840000
278500                                                                  27850000
278600     WRITE REPORT-RECORD FROM DETAIL-LINE AFTER 1.                27860000
278700                                                                  27870000
278800     INITIALIZE DETAIL-LINE.                                      27880000
278900     ADD +1 TO LINE-COUNT.                                        27890000
279000     ADD +1 TO FREIGHT-EXCPT-RECORDS.                             27900000
279100 EJECT                                                            27910000
279200                                                                  27920000
279300*--------------------------------------------------------------*  27930000
279400*  WRITES THE REPORT TOTAL LINE                                *  27940000
279500*--------------------------------------------------------------*  27950000
279600 W400-WRITE-REPORT-TOTALS.                                        27960000
279700                                                                  27970000
279800     IF LINE-COUNT > 55                                           27980000
279900        PERFORM W100-WRITE-REPORT-HEADERS                         27990000
280000     END-IF.                                                      28000000
280100                                                                  28010000
280200     WRITE REPORT-RECORD FROM REPORT-TOTAL-LINE1 AFTER 2.         28020000
280300     WRITE REPORT-RECORD FROM REPORT-TOTAL-LINE2 AFTER 1.         28030000
280400                                                                  28040000
280500     MOVE +3 TO LINE-COUNT.                                       28050000
280600 EJECT                                                            28060000
280700                                                                  28070000
280800*--------------------------------------------------------------*  28080000
280900*  OPEN LOCATION CURSOR                                        *  28090000
281000*--------------------------------------------------------------*  28100000
281100 X100-OPEN-LOCATION-CSR.                                          28110000
281200                                                                  28120000
281300     EXEC SQL                                                     28130000
281400        OPEN LOCATION_CSR                                         28140000
281500     END-EXEC.                                                    28150000
281600                                                                  28160000
281700     EVALUATE TRUE                                                28170000
281800         WHEN SQLCODE = ZERO                                      28180000
281900              CONTINUE                                            28190000
282000         WHEN OTHER                                               28200000
282100             SET AC-OPEN-ERROR TO TRUE                            28210000
282200             MOVE 'X100-OPEN-LOCATION-CSR' TO AA-PARAGRAPH-NAME   28220000
282300             MOVE 'OPEN CURSOR'            TO AA-DB2-OPERATION    28230000
282400             MOVE 'XFT00017'               TO AA-DB2-TABLE-1      28240000
282500             MOVE SPACES                   TO AA-DB2-TABLE-2      28250000
282600             MOVE SPACES                   TO AA-DB2-TABLE-3      28260000
282700             PERFORM Z998-DB2-ABEND                               28270000
282800     END-EVALUATE.                                                28280000
282900                                                                  28290000
283000*--------------------------------------------------------------*  28300000
283100*  FETCH ROWS FROM LOCATION CURSOR AND LOAD INTO LOCATION TABLE*  28310000
283200*  FOR STORE NUMBER VALIDATION.                                *  28320000
283300*--------------------------------------------------------------*  28330000
283400 X200-LOAD-LOCATION-TBL.                                          28340000
283500                                                                  28350000
283600     PERFORM VARYING LOC-INDX FROM 1 BY 1                         28360000
283700       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            28370000
283800           MOVE ZEROES TO WS-STORE-NBR(LOC-INDX)                  28380000
283900           MOVE SPACES TO WS-STORE-TYP-CDE(LOC-INDX)              28390000
284000     END-PERFORM.                                                 28400000
284100                                                                  28410000
284200     PERFORM VARYING LOC-INDX FROM 1 BY 1                         28420000
284300       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            28430000
284400          OR END-OF-LOC-CSR                                       28440000
284500             EXEC SQL                                             28450000
284600                  FETCH LOCATION_CSR                              28460000
284700                  INTO :XFT00017-LOC-NBR                          28470000
284800                     , :XFT00017-LOC-TYP-CDE                      28480000
284900             END-EXEC                                             28490000
285000                                                                  28500000
285100             EVALUATE TRUE                                        28510000
285200               WHEN SQLCODE = +100                                28520000
285300                  SET END-OF-LOC-CSR TO TRUE                      28530000
285400               WHEN SQLCODE = ZERO                                28540000
285500                  MOVE XFT00017-LOC-NBR                           28550000
285600                                   TO WS-STORE-NBR(LOC-INDX)      28560000
285700                  MOVE XFT00017-LOC-TYP-CDE                       28570000
285800                                   TO WS-STORE-TYP-CDE(LOC-INDX)  28580000
285900               WHEN SQLWARN0 NOT = SPACES                         28590000
286000               WHEN SQLCODE  NOT = ZERO                           28600000
286100                  SET AC-UNSUCCESSFUL-SELECT  TO TRUE             28610000
286200                  MOVE 'X200-LOAD-LOCATION-TBL '                  28620000
286300                                              TO AA-PARAGRAPH-NAME28630000
286400                  MOVE 'UNSUCCESSFUL FETCH'                       28640000
286500                                              TO AA-DB2-OPERATION 28650000
286600                  MOVE 'XFT00017'             TO AA-DB2-TABLE-1   28660000
286700                  MOVE SPACES                 TO AA-DB2-TABLE-2   28670000
286800                  MOVE SPACES                 TO AA-DB2-TABLE-3   28680000
286900                  PERFORM Z998-DB2-ABEND                          28690000
287000             END-EVALUATE                                         28700000
287100     END-PERFORM.                                                 28710000
287200                                                                  28720000
287300*--------------------------------------------------------------*  28730000
287400*  CLOSE LOCATION CURSOR                                       *  28740000
287500*--------------------------------------------------------------*  28750000
287600 X300-CLOSE-LOCATION-CSR.                                         28760000
287700                                                                  28770000
287800     EXEC SQL                                                     28780000
287900        CLOSE LOCATION_CSR                                        28790000
288000     END-EXEC.                                                    28800000
288100                                                                  28810000
288200     EVALUATE TRUE                                                28820000
288300         WHEN SQLCODE = ZERO                                      28830000
288400              CONTINUE                                            28840000
288500         WHEN OTHER                                               28850000
288600             SET AC-CLOSE-ERROR TO TRUE                           28860000
288700             MOVE 'X300-CLOSE-LOCATION-CSR' TO AA-PARAGRAPH-NAME  28870000
288800             MOVE 'CLOSE CURSOR'            TO AA-DB2-OPERATION   28880000
288900             MOVE 'XFT00017'                TO AA-DB2-TABLE-1     28890000
289000             MOVE SPACES                    TO AA-DB2-TABLE-2     28900000
289100             MOVE SPACES                    TO AA-DB2-TABLE-3     28910000
289200             PERFORM Z998-DB2-ABEND                               28920000
289300     END-EVALUATE.                                                28930000
289400                                                                  28940000
289500*--------------------------------------------------------------*  28950000
289600*  COMMIT                                                      *  28960000
289700*--------------------------------------------------------------*  28970000
289800 X400-COMMIT.                                                     28980000
289900                                                                  28990000
290000     EXEC SQL                                                     29000000
290100         COMMIT                                                   29010000
290200     END-EXEC.                                                    29020000
290300                                                                  29030000
290400     EVALUATE TRUE                                                29040000
290500         WHEN SQLCODE = ZERO                                      29050000
290600              CONTINUE                                            29060000
290700         WHEN OTHER                                               29070000
290800             MOVE 'X400-COMMIT           '  TO AA-PARAGRAPH-NAME  29080000
290900             MOVE 'COMMIT'                  TO AA-DB2-OPERATION   29090000
291000             MOVE SPACES                    TO AA-DB2-TABLE-1     29100000
291100             MOVE SPACES                    TO AA-DB2-TABLE-2     29110000
291200             MOVE SPACES                    TO AA-DB2-TABLE-3     29120000
291300             PERFORM Z998-DB2-ABEND                               29130000
291400     END-EVALUATE.                                                29140000
291500                                                                  29150000
291600*--------------------------------------------------------------*  29160000
291700*  OPENS THE HOLD CURSOR                                       *  29170000
291800*--------------------------------------------------------------*  29180000
291900 Y100-OPEN-HOLD-CSR.                                              29190000
292000                                                                  29200000
292100     EXEC SQL                                                     29210000
292200          OPEN HOLD_CSR                                           29220000
292300     END-EXEC.                                                    29230000
292400                                                                  29240000
292500     EVALUATE TRUE                                                29250000
292600         WHEN SQLCODE = ZERO                                      29260000
292700              CONTINUE                                            29270000
292800         WHEN OTHER                                               29280000
292900             SET AC-OPEN-ERROR TO TRUE                            29290000
293000             MOVE 'Y100-OPEN-HOLD-CSR'    TO AA-PARAGRAPH-NAME    29300000
293100             MOVE 'OPEN CURSOR'           TO AA-DB2-OPERATION     29310000
293200             MOVE 'TAJPRRT'               TO AA-DB2-TABLE-1       29320000
293300             MOVE SPACES                  TO AA-DB2-TABLE-2       29330000
293400             MOVE SPACES                  TO AA-DB2-TABLE-3       29340000
293500             PERFORM Z998-DB2-ABEND                               29350000
293600     END-EVALUATE.                                                29360000
293700 EJECT                                                            29370000
293800                                                                  29380000
293900*--------------------------------------------------------------*  29390000
294000*  OPENS THE PO PRORATION CURSOR                               *  29400000
294100*--------------------------------------------------------------*  29410000
294200 Y200-OPEN-PO-PRORATION-CSR.                                      29420000
294300                                                                  29430000
294400     EXEC SQL                                                     29440000
294500          OPEN PO_PRORATION_CSR                                   29450000
294600     END-EXEC.                                                    29460000
294700                                                                  29470000
294800     EVALUATE TRUE                                                29480000
294900         WHEN SQLCODE = ZERO                                      29490000
295000              CONTINUE                                            29500000
295100         WHEN SQLCODE = +100                                      29510000
295200              SET END-OF-PO-PRORTN-CSR TO TRUE                    29520000
295300         WHEN OTHER                                               29530000
295400             SET AC-OPEN-ERROR TO TRUE                            29540000
295500             MOVE 'Y200-OPEN-PO-PRORATION-CSR'                    29550000
295600                                 TO AA-PARAGRAPH-NAME             29560000
295700             MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              29570000
295800             MOVE 'TAJPRRT'      TO AA-DB2-TABLE-1                29580000
295900             MOVE SPACES         TO AA-DB2-TABLE-2                29590000
296000             MOVE SPACES         TO AA-DB2-TABLE-3                29600000
296100             PERFORM Z998-DB2-ABEND                               29610000
296200     END-EVALUATE.                                                29620000
296300 EJECT                                                            29630000
296400                                                                  29640000
296500*--------------------------------------------------------------*  29650000
296600*  OPENS THE TRAN CODE CURSOR                                  *  29660000
296700*--------------------------------------------------------------*  29670000
296800 Y300-OPEN-TRN-CDE-CSR.                                           29680000
296900                                                                  29690000
297000     EXEC SQL                                                     29700000
297100          OPEN TRN_CDE_CSR                                        29710000
297200     END-EXEC.                                                    29720000
297300                                                                  29730000
297400     EVALUATE TRUE                                                29740000
297500         WHEN SQLCODE = ZERO                                      29750000
297600             CONTINUE                                             29760000
297700         WHEN OTHER                                               29770000
297800             SET AC-OPEN-ERROR TO TRUE                            29780000
297900             MOVE 'Y300-OPEN-TRN-CDE-CSR'    TO AA-PARAGRAPH-NAME 29790000
298000             MOVE 'OPEN CURSOR'              TO AA-DB2-OPERATION  29800000
298100             MOVE 'TAJPRRT'                  TO AA-DB2-TABLE-1    29810000
298200             MOVE SPACES                     TO AA-DB2-TABLE-2    29820000
298300             MOVE SPACES                     TO AA-DB2-TABLE-3    29830000
298400             PERFORM Z998-DB2-ABEND                               29840000
298500     END-EVALUATE.                                                29850000
298600 EJECT                                                            29860000
298700                                                                  29870000
298800*--------------------------------------------------------------*  29880000
298900*  CLOSES THE PO PRORATION CURSOR                              *  29890000
299000*--------------------------------------------------------------*  29900000
299100 Y500-CLOSE-PO-PRORATION-CSR.                                     29910000
299200                                                                  29920000
299300     EXEC SQL                                                     29930000
299400          CLOSE PO_PRORATION_CSR                                  29940000
299500     END-EXEC.                                                    29950000
299600                                                                  29960000
299700     EVALUATE TRUE                                                29970000
299800         WHEN SQLCODE = ZERO                                      29980000
299900             CONTINUE                                             29990000
300000         WHEN OTHER                                               30000000
300100             SET AC-CLOSE-ERROR TO TRUE                           30010000
300200             MOVE 'Y500-CLOSE-PO-PRORATION-CSR'                   30020000
300300                                             TO AA-PARAGRAPH-NAME 30030000
300400             MOVE 'CLOSE CURSOR'             TO AA-DB2-OPERATION  30040000
300500             MOVE 'TAJPRRT'                  TO AA-DB2-TABLE-1    30050000
300600             MOVE SPACES                     TO AA-DB2-TABLE-2    30060000
300700             MOVE SPACES                     TO AA-DB2-TABLE-3    30070000
300800             PERFORM Z998-DB2-ABEND                               30080000
300900     END-EVALUATE.                                                30090000
301000 EJECT                                                            30100000
301100                                                                  30110000
301200*--------------------------------------------------------------*  30120000
301300*  CLOSES THE HOLD CURSOR                                      *  30130000
301400*--------------------------------------------------------------*  30140000
301500 Y600-CLOSE-HOLD-CSR.                                             30150000
301600                                                                  30160000
301700     EXEC SQL                                                     30170000
301800          CLOSE HOLD_CSR                                          30180000
301900     END-EXEC.                                                    30190000
302000                                                                  30200000
302100     EVALUATE TRUE                                                30210000
302200         WHEN SQLCODE = ZERO                                      30220000
302300             CONTINUE                                             30230000
302400         WHEN OTHER                                               30240000
302500             SET AC-CLOSE-ERROR TO TRUE                           30250000
302600             MOVE 'Y600-CLOSE-HOLD-CSR'    TO AA-PARAGRAPH-NAME   30260000
302700             MOVE 'CLOSE CURSOR'           TO AA-DB2-OPERATION    30270000
302800             MOVE 'TAJPRRT'                TO AA-DB2-TABLE-1      30280000
302900             MOVE SPACES                   TO AA-DB2-TABLE-2      30290000
303000             MOVE SPACES                   TO AA-DB2-TABLE-3      30300000
303100             PERFORM Z998-DB2-ABEND                               30310000
303200     END-EVALUATE.                                                30320000
303300 EJECT                                                            30330000
303400                                                                  30340000
303500*--------------------------------------------------------------*  30350000
303600*  CLOSES THE TRAN CODE CURSOR                                 *  30360000
303700*--------------------------------------------------------------*  30370000
303800 Y700-CLOSE-TRN-CDE-CSR.                                          30380000
303900                                                                  30390000
304000     EXEC SQL                                                     30400000
304100          CLOSE TRN_CDE_CSR                                       30410000
304200     END-EXEC.                                                    30420000
304300                                                                  30430000
304400     EVALUATE TRUE                                                30440000
304500         WHEN SQLCODE = ZERO                                      30450000
304600             CONTINUE                                             30460000
304700         WHEN OTHER                                               30470000
304800             SET AC-CLOSE-ERROR TO TRUE                           30480000
304900             MOVE 'Y700-CLOSE-TRN-CDE-CSR' TO AA-PARAGRAPH-NAME   30490000
305000             MOVE 'CLOSE CURSOR'           TO AA-DB2-OPERATION    30500000
305100             MOVE 'TAJPRRT'                TO AA-DB2-TABLE-1      30510000
305200             MOVE SPACES                   TO AA-DB2-TABLE-2      30520000
305300             MOVE SPACES                   TO AA-DB2-TABLE-3      30530000
305400             PERFORM Z998-DB2-ABEND                               30540000
305500     END-EVALUATE.                                                30550000
305600 EJECT                                                            30560000
305700                                                                  30570000
305800*---------------------------------------------------------------  30580000
305900*     DB2 ABEND ROUTINE                                           30590000
306000*---------------------------------------------------------------  30600000
306100 Z998-DB2-ABEND.                                                  30610000
306200                                                                  30620000
306300     DISPLAY AA-ABEND-LIT.                                        30630000
306400     DISPLAY AA-DB2-ERROR-LIT.                                    30640000
306500     DISPLAY AA-PROGRAM-LIT.                                      30650000
306600     DISPLAY AA-PARAGRAPH-LIT.                                    30660000
306700     DISPLAY AA-DB2-OPERATION-LIT.                                30670000
306800     DISPLAY AA-DB2-TABLE-1.                                      30680000
306900     DISPLAY AA-DB2-TABLE-2.                                      30690000
307000     DISPLAY AA-DB2-TABLE-3.                                      30700000
307100                                                                  30710000
307200     SET AC-DB2-ERROR TO TRUE.                                    30720000
307300                                                                  30730000
307400     COPY DPPD004.                                                30740000
307500                                                                  30750000
307600     CALL 'ILBOABN0' USING ABEND-CODE.                            30760000
307700 EJECT                                                            30770000
307800*---------------------------------------------------------------  30780000
307900*     ABEND ROUTINE                                               30790000
308000*---------------------------------------------------------------  30800000
308100 Z999-ABEND.                                                      30810000
308200                                                                  30820000
308300     DISPLAY AA-ABEND-LIT.                                        30830000
308400     DISPLAY AA-PROGRAM-LIT.                                      30840000
308500     DISPLAY AA-PARAGRAPH-LIT.                                    30850000
308600     DISPLAY AA-MESSAGE-LINE.                                     30860000
308700                                                                  30870000
308800     CALL 'ILBOABN0' USING ABEND-CODE.                            30880000
308900                                                                  30890000
