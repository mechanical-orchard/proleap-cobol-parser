000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    RCKCS266.                                         00020002
000300 AUTHOR.        STEPHANIE HERON.                                  00030002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040002
000500 DATE-WRITTEN.  06-24-95.                                         00050002
000600 DATE-COMPILED.                                                   00060002
000700                                                                  00070002
000800*---------------------------------------------------------------* 00080002
000900*  CHANGE LOG                                                     00090002
001000*  DATE       CHANGED BY    DESC                                  00100002
001100*  ---------- ------------- --------------------------------------00110002
001200*  11/11/2011 CHRISTINE TWIEHAUS                                  00120002
001300*                       TMS YMS (WR40574)                         00130002
001400*                       ADDED CAN (CARRIER AUTH ID) TO            00140008
001500*                       SCREEN AND TABLES TSHIPMT & TAUSHIP       00150006
001600*  03/20/2012 CHRISTINE TWIEHAUS                                  00160040
001700*                       TMS YMS (WR40574)                         00170028
001800*                       REMOVED 4095-GET-CAN.  ADD CAN TO         00180028
001900*                       4010, 4010 & 4030 TO GET CAN WHEN         00190028
002000*                       GETTING PRO AND BOL                       00200028
002100******************************************************************00210002
002200*                                                               * 00220002
002300*    TRANID      - E266                                         * 00230002
002400*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00240002
002500*    DESCRIPTION - ADD ADVANCE RECEIVER INFORMATION             * 00250002
002600*    MAPSET      - RCKM266                                      * 00260002
002700*                                                               * 00270002
002800*                                                               * 00280002
002900*---------------------------------------------------------------* 00290002
002920* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00292035
002930* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00293035
002940* MAKING THE CALL DYNAMIC VS STATIC.                              00294035
002950*---------------------------------------------------------------* 00295035
002960* CHANGED 08/15/2022    BY BARB SCHULTZ    WR: CHG0273427         00296040
002970* CHANGED CALLS OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE   00297040
002990* MAKING THE CALL DYNAMIC VS STATIC.                              00299040
002991*---------------------------------------------------------------* 00299140
003000                                                                  00300002
003100 ENVIRONMENT DIVISION.                                            00310002
003200 DATA DIVISION.                                                   00320002
003300/                                                                 00330002
003400 WORKING-STORAGE SECTION.                                         00340002
003500                                                                  00350002
003600 01  DN-DB2-NULL-INDICATORS.                                      00360002
003700     05  DN-TRIP-ID                   PIC S9(04) COMP VALUE +0.   00370002
003800     05  DN-CURR-TRIP-ID              PIC S9(04) COMP VALUE +0.   00380002
003900     05  DN-EST-AR-TMST               PIC S9(04) COMP VALUE +0.   00390002
004000     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   00400002
004100     05  DN-SUBAREA-OF-ID             PIC S9(04) COMP VALUE +0.   00410002
004200     05  DN-TKT-FMT-ID                PIC S9(04) COMP VALUE +0.   00420002
004300     05  DN-AD-EVNT-DTE               PIC S9(04) COMP VALUE +0.   00430002
004400     05  DN-TKT-FMT-ID-MAX            PIC S9(04) COMP VALUE +0.   00440002
004500     05  DN-TKT-FMT-ID-MIN            PIC S9(04) COMP VALUE +0.   00450002
004600     05  DN-TKT-DESC                  PIC S9(04) COMP VALUE +0.   00460002
004700                                                                  00470002
004800 01  DK-DB2-KEYS.                                                 00480002
004900     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00490002
005000     05  DK-ORD-NBR                   PIC S9(09) COMP VALUE +0.   00500002
005100     05  DK-REC-SEQ-NBR               PIC S9(09) COMP VALUE +0.   00510002
005200     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00520002
005300     05  DK-TRIP-ID-B                 PIC S9(09) COMP VALUE +0.   00530002
005400     05  DK-TRIP-ID-E                 PIC S9(09) COMP VALUE +0.   00540002
005500     05  DK-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00550002
005600     05  DK-SCAC-ID                   PIC X(04)  VALUE SPACES.    00560002
005700     05  DK-VEH-NBR                   PIC X(10)  VALUE SPACES.    00570002
005800** CT - START - 11/11/2011                                        00580003
005900     05  DK-CARR-AUTH-ID              PIC X(30)  VALUE SPACES.    00590007
006000** CT - END   - 11/11/2011                                        00600003
006100     05  DK-STATUS-DTE                PIC X(10)  VALUE SPACES.    00610003
006200     05  DK-PRO-NBR                   PIC X(22)  VALUE SPACES.    00620002
006300     05  DK-BOL-NBR                   PIC X(30)  VALUE SPACES.    00630002
006400     05  DK-ENT-ID                    PIC S9(09) COMP VALUE +0.   00640002
006500     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE +0.   00650002
006600** AHP - BEGIN - 04/14/08                                         00660002
006700     05  DK-DC-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.   00670002
006800     05  DK-EFC-OPER-UNT-ID           PIC S9(04) COMP VALUE +0.   00680002
006900** AHP - END   - 04/14/08                                         00690002
007000     05  DK-FCLTY-ID                  PIC S9(04) COMP VALUE +0.   00700002
007100     05  DK-TKT-FMT-ID                PIC X(06)  VALUE SPACES.    00710002
007200     05  DK-DEPT-NBR                  PIC X(03)  VALUE SPACES.    00720002
007300     05  DK-OPER-SET-ID               PIC S9(04) COMP VALUE +0.   00730002
007400     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00740002
007500     05  DK-TYP-CDE                   PIC S9(04) COMP VALUE +0.   00750002
007600     05  DK-STORE-NMBR                PIC X(04)  VALUE SPACES.    00760002
007700     05  DK-RCVR-NBR                  PIC S9(09) COMP VALUE +0.   00770002
007800     05  DK-SUBCLASS-NBR              PIC X(03) VALUE SPACE.      00780002
007900     05  DK-MAJCLASS-NBR              PIC X(02) VALUE SPACE.      00790002
008000     05  DK-CHARTC-SEQ-NBR            PIC S9(4) COMP VALUE +0.    00800002
008100     05  DK-TKT-TYP-SEQ-NBR           PIC S9(4) COMP VALUE +0.    00810002
008200     05  DK-TKT-DESC                  PIC X(20)  VALUE SPACES.    00820002
008300     05  DK-TKT-DESC-MIN              PIC X(20)  VALUE SPACES.    00830002
008400     05  DK-TKT-DESC-MAX              PIC X(20)  VALUE SPACES.    00840002
008500** DMH - BEGIN - 07/25/08                                         00850002
008600     05  DK-CURR-OPER-UNT-ID          PIC S9(04) COMP VALUE +0.   00860002
008700** DMH - END   - 07/25/08                                         00870002
008800                                                                  00880002
008900 01  PC-PROGRAM-CONSTANTS.                                        00890002
009000     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RCKCS266'.  00900002
009100     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'RC266A  '.  00910002
009200     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'RCKM266 '.  00920002
009400     05  PC-RCKUT023              PIC  X(08)  VALUE  'RCKUT023'.  00940002
009500     05  PC-RANDNBR-PGM           PIC  X(08)  VALUE  'DPKUT902'.  00950002
009600     05  PC-TROUBLE-RTN           PIC X(08)   VALUE  'TMKCS520'.  00960002
009700     05  PC-TROUBLE-RTN-LENGTH    PIC S9(04)  VALUE +600 COMP.    00970002
009800     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3 COMP.     00980002
009900     05  PC-VALID-VND-DT-RANGE    PIC  9(05)  VALUE   7.          00990002
010000     05  PC-I                     PIC  X(01)  VALUE  'I'.         01000002
010100     05  PC-A                     PIC  X(01)  VALUE  'A'.         01010002
010200     05  PC-U                     PIC  X(01)  VALUE  'U'.         01020002
010300     05  PC-ACTIVE                PIC  X(01)  VALUE  'A'.         01030002
010400     05  PC-B                     PIC  X(01)  VALUE  'B'.         01040002
010500     05  PC-C                     PIC  X(01)  VALUE  'C'.         01050002
010600     05  PC-M                     PIC  X(01)  VALUE  'M'.         01060002
010700     05  PC-S                     PIC  X(01)  VALUE  'S'.         01070002
010800     05  PC-INNER-PPK             PIC  X(13)  VALUE               01080002
010900                                  'INNER PACK'.                   01090002
011000     05  PC-MULTI-SKU             PIC  X(12)  VALUE               01100002
011100                                  'MULTIPLE SKU'.                 01110002
011200     05  PC-SINGLE-SKU            PIC  X(10)  VALUE               01120002
011300                                  'SINGLE SKU'.                   01130002
011400     05  PC-CASEPACK              PIC  X(08)  VALUE               01140002
011500                                  'CASEPACK'.                     01150002
011600     05  PC-BULK-PACK             PIC  X(09)  VALUE               01160002
011700                                  'BULK PACK'.                    01170002
011800     05  PC-NOT-FOUND             PIC  X(09)  VALUE               01180002
011900                                  'NOT FOUND'.                    01190002
012000                                                                  01200002
012100     05  PC-INTER-APPL-CODES.                                     01210002
012200         10  PC-INTER-APPL-MENU   PIC  X(01)  VALUE  '1'.         01220002
012300         10  PC-INTER-APPL-MULT-LIST                              01230002
012400                                  PIC  X(01)  VALUE  '2'.         01240002
012500         10  PC-INTER-APPL-LIST                                   01250002
012600                                  PIC  X(01)  VALUE  '3'.         01260002
012700     05  PC-DEFAULT-DATE          PIC X(10)   VALUE               01270002
012800                                  '0001-01-01'.                   01280002
012900     05  PC-DEFAULT-9DATE         PIC X(10)   VALUE               01290002
013000                                  '9999-09-09'.                   01300002
013100     05  PC-DEFAULT-TIME          PIC X(08)   VALUE               01310002
013200                                  '00.00.00'.                     01320002
013300     05  PC-CURRENT-DATE          PIC X(10) VALUE SPACE.          01330002
013400     05  PC-VS-TICKET-TYPE-CDE       PIC S9(04) COMP              01340002
013500                                                VALUE +2.         01350002
013600     05  PC-SUBCLASS-MDSELV-CDE   PIC X(03) VALUE 'SCL'.          01360002
013700     05  PC-MAJCLASS-MDSELV-CDE   PIC X(03) VALUE 'MCL'.          01370002
013800     05  PC-DPT-MDSELV-CDE        PIC X(03) VALUE 'DPT'.          01380002
013900     05  PC-CORPORATE             PIC 9(4)  VALUE 90.             01390002
014000                                                                  01400002
014100     05  PC-TSYMSG-NUMBERS.                                       01410002
014200         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       01420002
014300         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01430002
014400         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01440002
014500         10  PC-TSYMSG-00009      PIC  9(05)  VALUE  00009.       01450002
014600         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       01460002
014700         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       01470002
014800         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01480002
014900         10  PC-TSYMSG-00268      PIC  9(05)  VALUE  00268.       01490002
015000         10  PC-TSYMSG-00391      PIC  9(05)  VALUE  00391.       01500002
015100         10  PC-TSYMSG-00847      PIC  9(05)  VALUE  00847.       01510002
015200         10  PC-TSYMSG-00984      PIC  9(05)  VALUE  00984.       01520002
015300         10  PC-TSYMSG-00991      PIC  9(05)  VALUE  00991.       01530002
015400         10  PC-TSYMSG-00992      PIC  9(05)  VALUE  00992.       01540002
015500         10  PC-TSYMSG-01015      PIC  9(05)  VALUE  01015.       01550002
015600         10  PC-TSYMSG-01049      PIC  9(05)  VALUE  01049.       01560002
015700         10  PC-TSYMSG-01050      PIC  9(05)  VALUE  01050.       01570002
015800         10  PC-TSYMSG-01051      PIC  9(05)  VALUE  01051.       01580002
015900         10  PC-TSYMSG-01052      PIC  9(05)  VALUE  01052.       01590002
016000         10  PC-TSYMSG-01053      PIC  9(05)  VALUE  01053.       01600002
016100         10  PC-TSYMSG-01055      PIC  9(05)  VALUE  01055.       01610002
016200** 1838 - DATE OUTSIDE RECOMMENDED RANGE - PRESS F2 TO CONFIRM    01620002
016300         10  PC-TSYMSG-01838      PIC  9(05)  VALUE  01838.       01630002
016400** 3336 - CURRENT LOCATION NUMBER IS 0, CAN NOT CREATE RECEIVER   01640002
016500         10  PC-TSYMSG-03336      PIC  9(05)  VALUE  03336.       01650002
016600** 3337 - CURRENT LOCATION NUMBER IS INVALID FOR CREATING A REC   01660002
016700         10  PC-TSYMSG-03337      PIC  9(05)  VALUE  03337.       01670002
016800* * UNABLE TO CREATE A RECEIVER FOR A CUSTOMER DIRECT PO          01680002
016900         10  PC-TSYMSG-03405      PIC  9(05)  VALUE  03405.       01690002
017000         10  PC-TSYMSG-03407      PIC  9(05)  VALUE  03407.       01700002
017100                                                                  01710002
017200 01  PS-PROGRAM-SWITCHES.                                         01720002
017300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01730002
017400         88  PS-ERROR                         VALUE  'Y'.         01740002
017500         88  PS-NO-ERROR                      VALUE  'N'.         01750002
017600     05  PS-AUD-TSHIPMT-SW        PIC  X(01)  VALUE 'N'.          01760002
017700         88  PS-AUD-TSHIPMT                   VALUE 'Y'.          01770002
017800         88  PS-NO-AUD-TSHIPMT                VALUE 'N'.          01780002
017900     05  PS-AUD-TVHTRIP-SW        PIC  X(01)  VALUE 'N'.          01790002
018000         88  PS-AUD-TVHTRIP                   VALUE 'Y'.          01800002
018100         88  PS-NO-AUD-TVHTRIP                VALUE 'N'.          01810002
018200     05  PS-UPD-TSHIPMT-SW        PIC  X(01)  VALUE 'N'.          01820002
018300         88  PS-UPD-TSHIPMT-PROBOL            VALUE 'Y'.          01830002
018400         88  PS-NO-UPD-TSHIPMT-PROBOL         VALUE 'N'.          01840002
018500     05  PS-UPD-TSHIPMT-VNDSHP-SW PIC  X(01)  VALUE 'N'.          01850002
018600         88  PS-UPD-TSHIPMT-VNDSHP            VALUE 'Y'.          01860002
018700         88  PS-NO-UPD-TSHIPMT-VNDSHP         VALUE 'N'.          01870002
018800     05  PS-UPD-TVHTRIP-CARSHP-SW PIC  X(01)  VALUE 'N'.          01880002
018900         88  PS-UPD-TVHTRIP-CARSHP            VALUE 'Y'.          01890002
019000         88  PS-NO-UPD-TVHTRIP-CARSHP         VALUE 'N'.          01900002
019100     05  PS-LIST-END-SW           PIC X(01)   VALUE 'N'.          01910002
019200         88  PS-LIST-END                      VALUE 'Y'.          01920002
019300         88  PS-NO-LIST-END                   VALUE 'N'.          01930002
019400     05  PS-TOSOPFA-CURSOR-SW     PIC  X(01)  VALUE 'N'.          01940002
019500         88  PS-EOF-TOSOPFA-CSR               VALUE 'Y'.          01950002
019600     05  PS-TRECVER-CURSOR-SW     PIC  X(01)  VALUE 'N'.          01960002
019700         88  PS-EOF-TRECVER-CSR               VALUE 'Y'.          01970002
019800     05  PS-INSTRUCTION-SW        PIC  X(01)  VALUE 'N'.          01980002
019900         88  PS-FIRST-INSTRUCTION             VALUE 'Y'.          01990002
020000     05  PS-VALID-VND-DTE-SW            PIC X(01)    VALUE 'N'.   02000002
020100         88  PS-VALID-VND-DTE                        VALUE 'Y'.   02010002
020200         88  PS-INVALID-VND-DTE                      VALUE 'N'.   02020002
020300     05  PS-VALID-CARR-DTE-SW           PIC X(01)    VALUE 'N'.   02030002
020400         88  PS-VALID-CARR-DTE                       VALUE 'Y'.   02040002
020500         88  PS-INVALID-CARR-DTE                     VALUE 'N'.   02050002
020600     05  PS-SHPTPO-FOUND-SW             PIC X(01)    VALUE 'N'.   02060002
020700         88  PS-SHPTPO-FOUND                         VALUE 'Y'.   02070002
020800         88  PS-SHPTPO-NOT-FOUND                     VALUE 'N'.   02080002
020900     05  PS-VALID-SCAC-SW               PIC X(01)    VALUE 'N'.   02090002
021000         88  PS-VALID-SCAC                           VALUE 'Y'.   02100002
021100         88  PS-INVALID-SCAC                         VALUE 'N'.   02110002
021200     05  PS-VALID-DATE-SW               PIC X(01)    VALUE 'N'.   02120002
021300         88  PS-VALID-DATE                           VALUE 'Y'.   02130002
021400         88  PS-INVALID-DATE                         VALUE 'N'.   02140002
021500     05  PS-MSG-SET-SW            PIC  X(01)  VALUE 'N'.          02150002
021600         88  PS-MSG-SET                       VALUE 'Y'.          02160002
021700         88  PS-MSG-NOT-SET                   VALUE 'N'.          02170002
021800     05  PS-FOUND-SW              PIC  X(01)  VALUE 'N'.          02180002
021900         88  PS-FOUND                         VALUE 'Y'.          02190002
022000         88  PS-NOT-FOUND                     VALUE 'N'.          02200002
022100     05  PS-INQUIRE-SW            PIC  X(01)  VALUE 'N'.          02210002
022200         88  PS-INQUIRE                       VALUE 'Y'.          02220002
022300         88  PS-NO-INQUIRE                    VALUE 'N'.          02230002
022400     05  PS-MULT-TROUBLE-SW       PIC  X(01)  VALUE 'N'.          02240002
022500         88  PS-MULT-TROUBLE                  VALUE 'Y'.          02250002
022600         88  PS-SINGLE-TROUBLE                VALUE 'N'.          02260002
022700     05  PS-DELETE-VHTRIP-SW      PIC  X(01)  VALUE 'N'.          02270002
022800         88  PS-DELETE-VHTRIP                 VALUE 'Y'.          02280002
022900         88  PS-UPDATE-VHTRIP                 VALUE 'N'.          02290002
023000     05  PS-RCVR-FOUND-SW         PIC  X(01)  VALUE 'N'.          02300002
023100         88  PS-RCVR-FOUND                    VALUE 'Y'.          02310002
023200         88  PS-NO-RCVR-FOUND                 VALUE 'N'.          02320002
023300     05  PS-PRETIC-FOUND-SW       PIC  X(01)  VALUE 'N'.          02330002
023400         88  PS-PRETIC-FOUND                  VALUE 'Y'.          02340002
023500         88  PS-NO-PRETIC-FOUND               VALUE 'N'.          02350002
023600     05  PS-VSM-SW                PIC X       VALUE 'N'.          02360002
023700         88  PS-NOT-VSM                       VALUE 'N'.          02370002
023800         88  PS-VSM                           VALUE 'Y'.          02380002
023900     05  PS-VALID-VND-DT-RANGE-SW PIC X(01)  VALUE 'Y'.           02390002
024000         88  PS-VALID-VND-DT-RANGE           VALUE 'Y'.           02400002
024100         88  PS-INVALID-VND-DT-RANGE         VALUE 'N'.           02410002
024200     05  PS-VALID-LOC-SW          PIC  X(01)  VALUE 'N'.          02420002
024300         88  PS-VALID-LOC                     VALUE 'Y'.          02430002
024400         88  PS-INVALID-LOC                   VALUE 'N'.          02440002
024500     05  PS-ASNS-TO-WMS-SW        PIC X(01) VALUE 'N'.            02450002
024600         88  PS-ASNS-TO-WMS-YES             VALUE 'Y'.            02460002
024700         88  PS-ASNS-TO-WMS-NO              VALUE 'N'.            02470002
024800                                                                  02480002
024900                                                                  02490002
025000******************************************************************02500002
025100*                                               **   WR # 230ZZ  *02510002
025200******************************************************************02520002
025300     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        02530002
025400         88  PS-CALL-API-NO                     VALUE 'N'.        02540002
025500         88  PS-CALL-API-YES                    VALUE 'Y'.        02550002
025600                                                                  02560002
025700******************************************************************02570002
025800*  CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        *02580002
025900******************************************************************02590002
026000                                                                  02600002
026100 01  PV-PROGRAM-VARIABLES.                                        02610002
026200     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            02620002
026300                                              COMP SYNC.          02630002
026400     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            02640002
026500                                              COMP SYNC.          02650002
026600     05  PV-COMMAREA-LENGTH       PIC S9(04)  VALUE +0 COMP.      02660002
026700     05  PV-DB2-COUNT             PIC S9(09)  VALUE +0            02670002
026800                                              COMP-3.             02680002
026900     05  PV-COUNT                 PIC S9(09)  VALUE +0            02690002
027000                                              COMP-3.             02700002
027100     05  PV-CURR-TRIP-ID          PIC S9(09)  VALUE +0            02710002
027200                                              COMP.               02720002
027300     05  PV-CURR-SHIPT-ID         PIC S9(09)  VALUE +0            02730002
027400                                              COMP.               02740002
027500     05  PV-VHTRIP-COUNT          PIC S9(09)  VALUE +0            02750002
027600                                              COMP-3.             02760002
027700     05  PV-SHIPMT-COUNT          PIC S9(09)  VALUE +0            02770002
027800                                              COMP-3.             02780002
027900     05  PV-REC-SEQ-NBR           PIC S9(09) COMP VALUE +0.       02790002
028000     05  PV-NULL-IND              PIC S9(4) VALUE ZERO            02800002
028100                                              COMP SYNC.          02810002
028200     05  PV-TRIP-ID-OLD           PIC S9(09) COMP.                02820002
028300     05  PV-DB2-CURRENT-DATE      PIC  X(10).                     02830002
028400     05  PV-DB2-CURRENT-DATE-M7DD PIC  X(10).                     02840002
028500     05  PV-DB2-CURRENT-TIME      PIC  X(10).                     02850002
028600     05  PV-DB2-DATE              PIC  X(10).                     02860002
028700     05  FILLER  REDEFINES PV-DB2-DATE.                           02870002
028800         10  PV-DB2-DATE-CCYY.                                    02880002
028900             20  PV-DB2-DATE-CC       PIC  X(02).                 02890002
029000             20  PV-DB2-DATE-YY       PIC  X(02).                 02900002
029100         10  PV-DB2-DASH-1        PIC  X(01).                     02910002
029200         10  PV-DB2-DATE-MM       PIC  X(02).                     02920002
029300         10  PV-DB2-DASH-2        PIC  X(01).                     02930002
029400         10  PV-DB2-DATE-DD       PIC  X(02).                     02940002
029500     05  PV-INPUT-DATE.                                           02950002
029600         10  PV-INPUT-DATE-MM           PIC 9(2)     VALUE ZEROES.02960002
029700         10  PV-INPUT-DATE-DD           PIC 9(2)     VALUE ZEROES.02970002
029800         10  PV-INPUT-DATE-CCYY         PIC 9(4)     VALUE ZEROES.02980002
029900         10  FILLER REDEFINES PV-INPUT-DATE-CCYY.                 02990002
030000             15  PV-INPUT-DATE-CC       PIC 9(2).                 03000002
030100             15  PV-INPUT-DATE-YY       PIC 9(2).                 03010002
030200     05  PV-TEMP-DATE.                                            03020002
030300         10  PV-DATE-CCYY             PIC X(04).                  03030002
030400         10  FILLER                   PIC X(01).                  03040002
030500         10  PV-DATE-MM               PIC X(02).                  03050002
030600         10  FILLER                   PIC X(01).                  03060002
030700         10  PV-DATE-DD               PIC X(02).                  03070002
030800     05  PV-VALID-DATE.                                           03080002
030900         10  PV-VALID-DATE-MM           PIC X(2)     VALUE SPACES.03090002
031000         10  PV-VALID-DATE-DD           PIC X(2)     VALUE SPACES.03100002
031100         10  PV-VALID-DATE-CCYY         PIC X(4)     VALUE SPACES.03110002
031200         10  FILLER REDEFINES PV-VALID-DATE-CCYY.                 03120002
031300             15  PV-VALID-DATE-CC       PIC X(2).                 03130002
031400             15  PV-VALID-DATE-YY       PIC X(2).                 03140002
031500     05  PV-DISPLAY-DATE.                                         03150002
031600         10  PV-DISPLAY-DATE-MM   PIC  X(02).                     03160002
031700         10  FILLER               PIC  X(01) VALUE '/'.           03170002
031800         10  PV-DISPLAY-DATE-DD   PIC  X(02).                     03180002
031900         10  FILLER               PIC  X(01) VALUE '/'.           03190002
032000         10  PV-DISPLAY-DATE-YY   PIC  X(02).                     03200002
032100     05  PV-VEND-SHIP-DATE.                                       03210002
032200         10  PV-VEND-SHIP-CCYY        PIC X(04).                  03220002
032300         10  FILLER                   PIC X(01)  VALUE '-'.       03230002
032400         10  PV-VEND-SHIP-MM          PIC X(02).                  03240002
032500         10  FILLER                   PIC X(01)  VALUE '-'.       03250002
032600         10  PV-VEND-SHIP-DD          PIC X(02).                  03260002
032700     05  PV-DB2-HOLD-DATE         PIC  X(10).                     03270002
032800     05  FILLER  REDEFINES PV-DB2-HOLD-DATE.                      03280002
032900         10  PV-DB2-HOLD-DATE-CCYY.                               03290002
033000             20  PV-DB2-HOLD-DATE-CC  PIC  X(02).                 03300002
033100             20  PV-DB2-HOLD-DATE-YY  PIC  X(02).                 03310002
033200         10  PV-DB2-HOLD-DASH-1   PIC  X(01).                     03320002
033300         10  PV-DB2-HOLD-DATE-MM  PIC  X(02).                     03330002
033400         10  PV-DB2-HOLD-DASH-2   PIC  X(01).                     03340002
033500         10  PV-DB2-HOLD-DATE-DD  PIC  X(02).                     03350002
033600                                                                  03360002
033700     05  PV-TRN-CDE               PIC X(1)    VALUE SPACES.       03370002
033800                                                                  03380002
033900     05  PV-WO-INSTR-SEQ-NBR      PIC S9(04)  VALUE +0 COMP.      03390002
034000     05  PV-COPER-UNT-ID          PIC S9(04) COMP VALUE +0.       03400002
034100     05  PV-OPER-UNT-ID           PIC 9(04).                      03410002
034200     05  PV-OPER-UNT-ID-X REDEFINES                               03420002
034300         PV-OPER-UNT-ID           PIC X(04).                      03430002
034400     05  PV-TROUBLE-DESC-ALL.                                     03440002
034500         10  PV-TROUBLE-DESC      PIC X(09).                      03450002
034600         10  PV-TROUBLE-ASTERICK  PIC X(01)   VALUE '*'.          03460002
034700                                                                  03470002
034800     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 03480002
034900     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 03490002
035000     05  PV-CICS-MSG-HOLD.                                        03500002
035100         10  FILLER                      PIC  X(01)  VALUE SPACE. 03510002
035200         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 03520002
035300     05  PV-CICS-MSG-HOLD2.                                       03530002
035400         10  FILLER                      PIC  X(01)  VALUE SPACE. 03540002
035500         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 03550002
035600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      03560002
035700                                                    COMP SYNC.    03570002
035800                                                                  03580002
035900     05  PV-DISPLAY-RCVR                PIC  9(9).                03590002
036000     05  PV-DISPLAY-COUNT               PIC  9(9).                03600002
036100     05  PV-DISPLAY-SQLCODE             PIC  9(9).                03610002
036200*    05  PV-AD-INFO               PIC X(4)    VALUE SPACES.       03620002
036300*        88  PV-HOT                           VALUE 'X '.         03630002
036400*        88  PV-CUST-ORD                      VALUE ' X'.         03640002
036410     05  PV-DISP-OPER                   PIC 9(04).                03641043
036420     05  PV-DISP-PO                     PIC 9(09).                03642043
036430     05  PV-DISP-RCVR                   PIC 9(04).                03643043
036500                                                                  03650002
036600                                                                  03660002
036700     05  PV-MESSAGE.                                              03670002
036800         10  PV-MESSAGE1                PIC X(10).                03680002
036900         10  PV-FILLER                  PIC X(01).                03690002
037000         10  PV-MESSAGE2                PIC X(10).                03700002
037100         10  PV-FILLER                  PIC X(01).                03710002
037200         10  PV-MESSAGE3                PIC X(10).                03720002
037300     05  PV-SUBCLASS-NBR.                                         03730002
037400         10  FILLER                   PIC X(01) VALUE '0'.        03740002
037500         10  PV-SUBCLASS.                                         03750002
037600             15  PV-SUBCLASS-MAJ-NBR   PIC X(01).                 03760002
037700             15  PV-SUBCLASS-MIN-NBR  PIC X(01).                  03770002
037800     05  PV-MAJCLASS-NBR.                                         03780002
037900         10  PV-MAJCLASS-MAJ-NBR      PIC X(01).                  03790002
038000         10  FILLER                   PIC X(01) VALUE '0'.        03800002
038100** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  03810032
038200     05  PV-TEMP-PO-NBR               PIC 9(08).                  03820032
038300     05  PV-TEMP-OPER-UNT             PIC 9(04).                  03830002
038400     05  PV-TEMP-FCLTY                PIC 9(04).                  03840002
038500                                                                  03850002
038600 01  WA-WORK-AREA.                                                03860002
038700     05  WS-MAX-RCVR-NBR      PIC 9(09)  VALUE ZERO.              03870002
038800     05  WS-KEYREC-WORK.                                          03880002
038900         10 WS-FIRST-7-DIG    PIC 9(07)  VALUE ZERO.              03890002
039000         10 WS-CHECK-DIGIT    PIC 9(01)  VALUE ZERO.              03900002
039100     05  WS-KEYREC-QUOTIENT   PIC S9(07) COMP-3                   03910002
039200                                         VALUE ZERO.              03920002
039300     05  WS-KEYREC-REMAINDER  PIC S9(01) COMP-3                   03930002
039400                                         VALUE ZERO.              03940002
039500     05  WS-KEYREC-SUM        PIC S9(07) COMP-3                   03950002
039600                                         VALUE ZERO.              03960002
039700 01  PW-PROGRAM-WORKAREA.                                         03970002
039800     05  PW-CONTROL-REC.                                          03980002
039900         10  PW-CONTROL-KEYREC.                                   03990002
040000             20  PW-CONTROL-PANL-NBR.                             04000002
040100                 30  PW-CONTROL-PANEL    PIC 9(05)  VALUE ZERO.   04010002
040200                 30  PW-CONTROL-KEYREC-NBR                        04020002
040300                                         PIC 9(02)  VALUE ZERO.   04030002
040400             20  PW-CONTROL-PANL-NBR-9 REDEFINES                  04040002
040500                                       PW-CONTROL-PANL-NBR        04050002
040600                                         PIC 9(7).                04060002
040700             20  PW-CONTROL-CEHCK-DIG    PIC 9(01)  VALUE ZERO.   04070002
040800         10  PW-CONTROL-KEYREC-9 REDEFINES PW-CONTROL-KEYREC      04080002
040900                                         PIC 9(08).               04090002
041000         10  PW-CONTROL-FILLER           PIC X(73)  VALUE SPACE.  04100002
041100                                                                  04110002
041200     05  PW-SAVE-PANEL-NBR               PIC X(7)   VALUE SPACES. 04120002
041300                                                                  04130002
041400     05  PW-QUOTIENT                     PIC S9(7)  VALUE ZERO.   04140002
041500     05  PW-REMAINDER                    PIC S9     VALUE ZERO.   04150002
041600/                                                                 04160002
041700*----------------------------------------------------------------*04170002
041800*    MAP LAYOUT                                                  *04180002
041900*----------------------------------------------------------------*04190002
042000     COPY RCKM266.                                                04200002
042100                                                                  04210002
042200/                                                                 04220002
042300*----------------------------------------------------------------*04230002
042400*  WORK AREA PASSED IN CALL TO DPKUT500                          *04240002
042500*----------------------------------------------------------------*04250002
042600     COPY DPWS500.                                                04260002
042700                                                                  04270002
042800/                                                                 04280002
042900*----------------------------------------------------------------*04290002
043000*  WORK AREA PASSED IN CALL TO DPKUT100                          *04300002
043100*----------------------------------------------------------------*04310002
043200     COPY DPWS010I.                                               04320002
043300                                                                  04330002
043400/                                                                 04340002
043500*----------------------------------------------------------------*04350002
043600*    ATTRIBUTE SETTINGS COPYBOOK.                                *04360002
043700*----------------------------------------------------------------*04370002
043800     COPY DPWS015.                                                04380002
043900                                                                  04390002
044000/                                                                 04400002
044100*----------------------------------------------------------------*04410002
044200*    FUNCTION KEYS COPYBOOK                                      *04420002
044300*----------------------------------------------------------------*04430002
044400     COPY DPWS016.                                                04440002
044500                                                                  04450002
044600/                                                                 04460002
044700***************************************************************** 04470002
044800* RECORD LAYOUT OF TEMP QUEUE FROM LIST PROGRAM                   04480002
044900***************************************************************** 04490002
045000     COPY RCWS013.                                                04500002
045100                                                                  04510002
045200/                                                                 04520002
045300*----------------------------------------------------------------*04530002
045400*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     04540002
045500*----------------------------------------------------------------*04550002
045600     COPY TMWS500.                                                04560002
045700                                                                  04570002
045800/                                                                 04580002
045900*----------------------------------------------------------------*04590002
046000*  WORK AREA PASSED IN CALL TO DPKUT902                          *04600002
046100*----------------------------------------------------------------*04610002
046200     COPY DPWS902.                                                04620002
046300                                                                  04630002
046400/                                                                 04640002
046500******************************************************************04650041
046600** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **04660041
046610** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **04661041
046700******************************************************************04670041
046800     COPY DPWS017.                                                04680002
046900                                                                  04690002
047000     COPY DPWS030.                                                04700002
047010     COPY DPWS930.                                                04701041
047100                                                                  04710002
047200/                                                                 04720002
047300******************************************************************04730002
047400* COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ  *04740002
047500******************************************************************04750002
047600     COPY XLWS001.                                                04760002
047700                                                                  04770002
047800******************************************************************04780002
047900* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *04790002
048000*                                                                 04800002
048100******************************************************************04810002
048200* LOCATION MASTER INFORMATION - CALLED MODULE PARAMETERS          04820002
048300******************************************************************04830002
048400     COPY XLWS071.                                                04840002
048500*                                                                 04850002
048600/                                                                 04860002
048700***************************************************************** 04870002
048800*    STANDARD COMMAREA.                                           04880002
048900***************************************************************** 04890002
049000                                                                  04900002
049100     COPY DPWS020.                                                04910002
049200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04920002
049300                                                                  04930002
049400***************************************************************** 04940002
049500*    INTER-APPLICATION COMMAREA.                                  04950002
049600***************************************************************** 04960002
049700                                                                  04970002
049800         10  INTER-APPL-COMM-AREA PIC X(200).                     04980002
049900     COPY TRWS001.                                                04990002
050000     COPY RCWS012.                                                05000002
050100     COPY RCWS015.                                                05010002
050200***************************************************************** 05020002
050300*    SPECIFIC COMMMAREA FOR RCKCS266.                             05030002
050400***************************************************************** 05040002
050500         10  ASC-SPECIFIC-COMMAREA.                               05050002
050600             15  ASC-USE-SELECTION-QUEUE-IND                      05060002
050700                                           PIC X(01).             05070002
050800                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        05080002
050900             15  ASC-SEL-QUEUE-NAME        PIC X(08).             05090002
051000             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     05100002
051100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     05110002
051200                                           PIC S9(09) COMP-3.     05120002
051300             15  ASC-SEL-SUB               PIC S9(04) COMP.       05130002
051400             15  ASC-SEL-ITEM              PIC S9(04) COMP.       05140002
051500             15  ASC-ACTION-SW            PIC X(03).              05150002
051600                 88  ASC-ADD-PENDING      VALUE 'ADD'.            05160002
051700             15  ASC-SHIPT-STATUS-OK-SW    PIC X(01).             05170002
051800                 88  ASC-SHIPT-STATUS-OK                VALUE 'Y'.05180002
051900                 88  ASC-SHIPT-STATUS-NOTOK             VALUE 'N'.05190002
052000             15  ASC-ADD-SHIPMENT-SW       PIC X(01).             05200002
052100                 88  ASC-ADD-SHIPMENT                   VALUE '1'.05210002
052200                 88  ASC-SHIPMENT-EXIST                 VALUE '2'.05220002
052300                 88  ASC-MULT-SHIP-EXIST                VALUE '3'.05230002
052400             15  ASC-ADD-FROM-MULTSHIP-SW  PIC X(01).             05240002
052500                 88  ASC-ADD-NEW-SHIP                   VALUE '1'.05250002
052600                 88  ASC-SKIP-CHECKS                    VALUE ' '.05260002
052700             15  ASC-ADD-TYPE-SW           PIC X(03).             05270002
052800                 88  ASC-ADD-FROM-LIST                VALUE 'LIS'.05280002
052900                 88  ASC-ADD-FROM-MENU                VALUE 'MEN'.05290002
053000             15  ASC-SELECTION-MADE-SW     PIC X(01).             05300002
053100                 88  ASC-NO-SELECTION-MADE            VALUE 'N'.  05310002
053200                 88  ASC-SELECTION-MADE               VALUE 'Y'.  05320002
053300             15  ASC-ADD-SUCCESSFUL-SW     PIC X(01).             05330002
053400                 88  ASC-ADD-NOT-SUCCESSFUL           VALUE ' '.  05340002
053500                 88  ASC-ADD-SUCCESSFUL               VALUE 'Y'.  05350002
053600             15  ASC-TRIP-ID                PIC S9(09) COMP.      05360002
053700             15  ASC-SHIPT-ID               PIC S9(09) COMP.      05370002
053800             15  ASC-DEPT-NBR               PIC X(03).            05380002
053900             15  ASC-TRIP-STATUS-CDE        PIC X(02).            05390002
054000             15  ASC-VER-NBR                PIC S9(09) COMP.      05400002
054100             15  ASC-SEQ-NBR                PIC S9(04) COMP.      05410002
054200                                                                  05420002
054300             15  ASC-SCREEN-FIELDS.                               05430002
054400                 20  ASC-REC-SEQ-NBR         PIC 9(04).           05440002
054500                 20  ASC-1ST-REC-SEQ-NBR     PIC 9(04).           05450002
054600** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  05460032
054700                 20  ASC-PO-NBR              PIC X(08).           05470032
054800                 20  ASC-PO-NBR-N REDEFINES ASC-PO-NBR            05480002
054900                                             PIC 9(08).           05490032
055000                 20  ASC-PO-NBR-OLD          PIC X(08).           05500032
055100                 20  ASC-TRBL-DESC           PIC X(11).           05510002
055200                 20  ASC-ENT-NAME-DESC       PIC X(25).           05520002
055300                 20  ASC-AP-RCVR-NBR         PIC X(08).           05530002
055400                 20  ASC-AP-RCVR-NBR-N REDEFINES                  05540002
055500                     ASC-AP-RCVR-NBR         PIC 9(08).           05550002
055600                 20  ASC-SCAC-ID             PIC X(04).           05560002
055700                 20  ASC-SCAC-ID-OLD         PIC X(04).           05570002
055800                 20  ASC-VEH-NBR             PIC X(10).           05580002
055900                 20  ASC-PRO-NBR             PIC X(22).           05590002
056000                 20  ASC-PRO-NBR-OLD         PIC X(22).           05600002
056100                 20  ASC-COMPLETE-PRO-NBR    PIC X(22).           05610002
056200                 20  ASC-BOL-NBR             PIC X(30).           05620002
056300                 20  ASC-BOL-NBR-OLD         PIC X(30).           05630002
056400                 20  ASC-COMPLETE-BOL-NBR    PIC X(30).           05640002
056500                 20  ASC-OPER-SET-ID         PIC X(03).           05650002
056600                 20  ASC-OPER-SET-ID-N REDEFINES                  05660002
056700                     ASC-OPER-SET-ID         PIC 9(03).           05670002
056800                 20  ASC-CARR-SHIP-DTE.                           05680002
056900                     25  ASC-CARR-SHIP-MM    PIC X(02).           05690002
057000                     25  ASC-CARR-SHIP-DD    PIC X(02).           05700002
057100                     25  ASC-CARR-SHIP-CCYY.                      05710002
057200                         30  ASC-CARR-SHIP-CC PIC X(02).          05720002
057300                         30  ASC-CARR-SHIP-YY PIC X(02).          05730002
057400                 20  ASC-VEND-SHIP-DTE.                           05740002
057500                     25  ASC-VEND-SHIP-MM    PIC X(02).           05750002
057600                     25  ASC-VEND-SHIP-DD    PIC X(02).           05760002
057700                     25  ASC-VEND-SHIP-CCYY.                      05770002
057800                         30  ASC-VEND-SHIP-CC PIC X(02).          05780002
057900                         30  ASC-VEND-SHIP-YY PIC X(02).          05790002
058000                 20  ASC-VEND-SHIP-DTE-ISO   PIC X(10).           05800002
058100                 20  ASC-RECEIVER-LOC        PIC X(02).           05810002
058200                 20  ASC-TKT-FMT-ID          PIC X(06).           05820002
058300                 20  ASC-EXPTED-CART-CNT     PIC X(04).           05830002
058400                 20  ASC-EXPTED-CART-CNT-N REDEFINES              05840002
058500                     ASC-EXPTED-CART-CNT     PIC 9(04).           05850002
058600* CT 11/11/11 - BEGIN WR40574                                     05860010
058700                 20  ASC-CAN                 PIC X(30).           05870016
058800* CT 11/11/11 - END   WR40574                                     05880010
058900                 20  ASC-ASN-IND             PIC X(01).           05890003
059000                 20  ASC-HOT-IND             PIC X(01).           05900002
059100*                20  ASC-PKSL-IND            PIC X(01).           05910002
059200*                20  ASC-AVIS-IND            PIC X(01).           05920002
059300                 20  ASC-PKGNG-CDE           PIC X(01).           05930002
059400                 20  ASC-AD-DTE              PIC X(08).           05940002
059500                 20  ASC-CONS-IND            PIC X(01).           05950002
059600                 20  ASC-PACK-BY-ST-IND      PIC X(01).           05960002
059700                 20  ASC-PRE-TICKET-IND      PIC X(01).           05970002
059800                 20  ASC-HANGER-IND          PIC X(01).           05980002
059900                 20  ASC-CUST-ORD-IND        PIC X(01).           05990002
060000                 20  ASC-CRE-OPER-UNT-ID     PIC X(04).           06000002
060100                 20  ASC-CRE-OPER-UNT-ID-N REDEFINES              06010002
060200                     ASC-CRE-OPER-UNT-ID                          06020002
060300                                             PIC 9(04).           06030002
060400                 20  ASC-CRE-OPER-UNT-ID-OLD PIC X(04).           06040002
060500                 20  ASC-CRE-FCLTY-ID        PIC X(04).           06050002
060600                 20  ASC-CRE-FCLTY-ID-N REDEFINES ASC-CRE-FCLTY-ID06060002
060700                                             PIC 9(04).           06070002
060800                 20  ASC-TKT-DESC            PIC X(20).           06080002
060900                 20  ASC-PO-TYPE             PIC X(02).           06090002
061000* DMH 7/30/08 - BEGIN                                             06100002
061100                 20  ASC-CURR-OPER-UNT-ID    PIC X(04).           06110002
061200                 20  ASC-CURR-OPER-UNT-ID-N REDEFINES             06120002
061300                     ASC-CURR-OPER-UNT-ID                         06130002
061400                                             PIC 9(04).           06140002
061500* DMH 7/30/08 - END                                               06150002
061600             15  ASC-VND-DT-EDIT-FIELDS.                          06160002
061700                 20  ASC-VND-DT-F2-REQUIRED-SW    PIC X(01).      06170002
061800                     88  ASC-VND-DT-F2-REQUIRED       VALUE 'Y'.  06180002
061900                     88  ASC-VND-DT-F2-NOT-REQUIRED   VALUE 'N'.  06190002
062000                 20  ASC-VEND-SHIP-DATE-OLD.                      06200002
062100                     25  ASC-VEND-SHIP-MM-OLD     PIC X(02).      06210002
062200                     25  ASC-VEND-SHIP-DD-OLD     PIC X(02).      06220002
062300                     25  ASC-VEND-SHIP-CCYY-OLD.                  06230002
062400                         30  ASC-VEND-SHIP-CC-OLD PIC X(02).      06240002
062500                         30  ASC-VEND-SHIP-YY-OLD PIC X(02).      06250002
062600                                                                  06260002
062700/                                                                 06270002
062800*----------------------------------------------------------------*06280002
062900*    ABEND PROCESSING COPYBOOK.                                  *06290002
063000*----------------------------------------------------------------*06300002
063100     COPY DPWS013.                                                06310002
063200                                                                  06320002
063300/                                                                 06330002
063400*----------------------------------------------------------------*06340002
063500*    COMMAREA TO RE-FORMAT THE FREIGHT BILL, BILL OF LADING      *06350002
063600*    AND THE VEHICLE NUMBER                                      *06360002
063700*----------------------------------------------------------------*06370002
063800     COPY RCWS023.                                                06380002
063900                                                                  06390002
064000/                                                                 06400002
064100*---------------------------------------------------------------* 06410002
064200*    DB2 AREA FOR THE COMPANY CONTROL TABLE                     * 06420002
064300*---------------------------------------------------------------* 06430002
064400     EXEC SQL                                                     06440002
064500          INCLUDE TCOCNTL                                         06450002
064600     END-EXEC.                                                    06460002
064700                                                                  06470002
064800/                                                                 06480002
064900*---------------------------------------------------------------* 06490002
065000*    DB2 AREA FOR THE ENTERPRISE TABLE                          * 06500002
065100*---------------------------------------------------------------* 06510002
065200     EXEC SQL                                                     06520002
065300          INCLUDE TEXTENT                                         06530002
065400     END-EXEC.                                                    06540002
065500                                                                  06550002
065600/                                                                 06560002
065700*---------------------------------------------------------------* 06570002
065800*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 06580002
065900*---------------------------------------------------------------* 06590002
066000     EXEC SQL                                                     06600002
066100          INCLUDE TENTNME                                         06610002
066200     END-EXEC.                                                    06620002
066300                                                                  06630002
066400/                                                                 06640002
066500*---------------------------------------------------------------* 06650002
066600*    DB2 AREA FOR RECEIVER TABLE                                * 06660002
066700*---------------------------------------------------------------* 06670002
066800     EXEC SQL                                                     06680002
066900          INCLUDE TRECEIV                                         06690002
067000     END-EXEC.                                                    06700002
067100/                                                                 06710002
067200     EXEC SQL                                                     06720002
067300          INCLUDE TPOSYNC                                         06730002
067400     END-EXEC.                                                    06740002
067500                                                                  06750002
067600/                                                                 06760002
067700*---------------------------------------------------------------* 06770002
067800*    DB2 AREA FOR SHIPMENT TABLE                                * 06780002
067900*---------------------------------------------------------------* 06790002
068000     EXEC SQL                                                     06800002
068100          INCLUDE TSHIPMT                                         06810002
068200     END-EXEC.                                                    06820002
068300                                                                  06830002
068400/                                                                 06840002
068500*---------------------------------------------------------------* 06850002
068600*    DB2 AREA FOR SHIPMENT AUDIT TABLE                          * 06860002
068700*---------------------------------------------------------------* 06870002
068800     EXEC SQL                                                     06880002
068900          INCLUDE TAUSHIP                                         06890002
069000     END-EXEC.                                                    06900002
069100                                                                  06910002
069200/                                                                 06920002
069300*---------------------------------------------------------------* 06930002
069400*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 06940002
069500*---------------------------------------------------------------* 06950002
069600     EXEC SQL                                                     06960002
069700          INCLUDE TSHIPST                                         06970002
069800     END-EXEC.                                                    06980002
069900                                                                  06990002
070000/                                                                 07000002
070100*---------------------------------------------------------------* 07010002
070200*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 07020002
070300*---------------------------------------------------------------* 07030002
070400     EXEC SQL                                                     07040002
070500          INCLUDE TPURCHS                                         07050002
070600     END-EXEC.                                                    07060002
070700                                                                  07070002
070800/                                                                 07080002
070900*---------------------------------------------------------------* 07090002
071000*    DB2 AREA FOR PURCHASE ORDER LINE ITEM TABLE                * 07100002
071100*---------------------------------------------------------------* 07110002
071200     EXEC SQL                                                     07120002
071300          INCLUDE TPURITM                                         07130002
071400     END-EXEC.                                                    07140002
071500                                                                  07150002
071600/                                                                 07160002
071700*---------------------------------------------------------------* 07170002
071800*    DB2 AREA FOR SHIPMENT PO TABLE                             * 07180002
071900*---------------------------------------------------------------* 07190002
072000     EXEC SQL                                                     07200002
072100          INCLUDE TSHPTPO                                         07210002
072200     END-EXEC.                                                    07220002
072300                                                                  07230002
072400/                                                                 07240002
072500*---------------------------------------------------------------* 07250002
072600*    DB2 AREA FOR SHIPMENT PO AUDIT TABLE                       * 07260002
072700*---------------------------------------------------------------* 07270002
072800     EXEC SQL                                                     07280002
072900          INCLUDE TAUSHPO                                         07290002
073000     END-EXEC.                                                    07300002
073100                                                                  07310002
073200/                                                                 07320002
073300*---------------------------------------------------------------* 07330002
073400*    DB2 AREA FOR VEHICLE TABLE                                 * 07340002
073500*---------------------------------------------------------------* 07350002
073600     EXEC SQL                                                     07360002
073700          INCLUDE TVEHICL                                         07370002
073800     END-EXEC.                                                    07380002
073900                                                                  07390002
074000/                                                                 07400002
074100*---------------------------------------------------------------* 07410002
074200*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 07420002
074300*---------------------------------------------------------------* 07430002
074400     EXEC SQL                                                     07440002
074500          INCLUDE TAUVHCL                                         07450002
074600     END-EXEC.                                                    07460002
074700                                                                  07470002
074800/                                                                 07480002
074900*---------------------------------------------------------------* 07490002
075000*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 07500002
075100*---------------------------------------------------------------* 07510002
075200     EXEC SQL                                                     07520002
075300          INCLUDE TVHTRIP                                         07530002
075400     END-EXEC.                                                    07540002
075500                                                                  07550002
075600/                                                                 07560002
075700*---------------------------------------------------------------* 07570002
075800*    DB2 AREA FOR VEHICLE TRIP AUDIT TABLE                      * 07580002
075900*---------------------------------------------------------------* 07590002
076000     EXEC SQL                                                     07600002
076100          INCLUDE TAUTRIP                                         07610002
076200     END-EXEC.                                                    07620002
076300                                                                  07630002
076400/                                                                 07640002
076500*---------------------------------------------------------------* 07650002
076600*    DB2 AREA FOR VEHICLE TRIP STATUS TABLE                     * 07660002
076700*---------------------------------------------------------------* 07670002
076800     EXEC SQL                                                     07680002
076900          INCLUDE TTRIPST                                         07690002
077000     END-EXEC.                                                    07700002
077100                                                                  07710002
077200/                                                                 07720002
077300*---------------------------------------------------------------* 07730002
077400*    DB2 AREA FOR TRIP STATUS CODE TABLE                        * 07740002
077500*---------------------------------------------------------------* 07750002
077600     EXEC SQL                                                     07760002
077700          INCLUDE TTRSTYP                                         07770002
077800     END-EXEC.                                                    07780002
077900                                                                  07790002
078000/                                                                 07800002
078100*---------------------------------------------------------------* 07810002
078200*    DB2 AREA FOR PACKING SLIP TABLE                            * 07820002
078300*---------------------------------------------------------------* 07830002
078400     EXEC SQL                                                     07840002
078500          INCLUDE TPKSLIP                                         07850002
078600     END-EXEC.                                                    07860002
078700                                                                  07870002
078800/                                                                 07880002
078900*----------------------------------------------------------------*07890002
079000*    DB2 AREA FOR TDCFAAS  DEPT/CLASS FACILITY LOC. ASSIGNMENTS  *07900002
079100*----------------------------------------------------------------*07910002
079200                                                                  07920002
079300     EXEC SQL                                                     07930002
079400          INCLUDE TDCFAAS                                         07940002
079500     END-EXEC.                                                    07950002
079600                                                                  07960002
079700/                                                                 07970002
079800*                                                                 07980002
079900*----------------------------------------------------------------*07990002
080000*    DB2 AREA FOR OPERATION SET TABLE                            *08000002
080100*----------------------------------------------------------------*08010002
080200                                                                  08020002
080300     EXEC SQL                                                     08030002
080400          INCLUDE TOPRSET                                         08040002
080500     END-EXEC.                                                    08050002
080600                                                                  08060002
080700/                                                                 08070002
080800*----------------------------------------------------------------*08080002
080900*    DB2 AREA FOR OPERATION SET/FACILITY TABLE                   *08090002
081000*----------------------------------------------------------------*08100002
081100                                                                  08110002
081200     EXEC SQL                                                     08120002
081300          INCLUDE TOSOPFA                                         08130002
081400     END-EXEC.                                                    08140002
081500                                                                  08150002
081600/                                                                 08160002
081700*----------------------------------------------------------------*08170002
081800*    DB2 AREA FOR WORK ORDER TABLE                               *08180002
081900*----------------------------------------------------------------*08190002
082000                                                                  08200002
082100     EXEC SQL                                                     08210002
082200          INCLUDE TWRKORD                                         08220002
082300     END-EXEC.                                                    08230002
082400                                                                  08240002
082500/                                                                 08250002
082600*----------------------------------------------------------------*08260002
082700*    DB2 AREA FOR WORK ORDER INSTRUCTION TABLE                   *08270002
082800*----------------------------------------------------------------*08280002
082900                                                                  08290002
083000     EXEC SQL                                                     08300002
083100          INCLUDE TWKORIN                                         08310002
083200     END-EXEC.                                                    08320002
083300                                                                  08330002
083400/                                                                 08340002
083500*----------------------------------------------------------------*08350002
083600*    DB2 DCLGEN FOR PO AGREEMENT TABLE                            08360002
083700*----------------------------------------------------------------*08370002
083800     EXEC SQL                                                     08380002
083900          INCLUDE TPOAGMT                                         08390002
084000     END-EXEC.                                                    08400002
084100                                                                  08410002
084200/                                                                 08420002
084300*----------------------------------------------------------------*08430002
084400*    DB2 DCLGEN FOR THE RECEIVER NUMBER TABLE                     08440002
084500*----------------------------------------------------------------*08450002
084600     EXEC SQL                                                     08460002
084700          INCLUDE TRECVER                                         08470002
084800     END-EXEC.                                                    08480002
084900                                                                  08490002
085000*----------------------------------------------------------------*08500002
085100*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                08510002
085200*----------------------------------------------------------------*08520002
085300     EXEC SQL                                                     08530002
085400          INCLUDE TTRBNTF                                         08540002
085500     END-EXEC.                                                    08550002
085600                                                                  08560002
085700*----------------------------------------------------------------*08570002
085800*    DB2 DCLGEN FOR THE TROUBLE REASON CODES                      08580002
085900*----------------------------------------------------------------*08590002
086000     EXEC SQL                                                     08600002
086100          INCLUDE TTRBRSN                                         08610002
086200     END-EXEC.                                                    08620002
086300                                                                  08630002
086400/                                                                 08640002
086500*----------------------------------------------------------------*08650002
086600*    DB2 DCLGEN FOR THE TPTKREQ TABLE                             08660002
086700*----------------------------------------------------------------*08670002
086800     EXEC SQL                                                     08680002
086900          INCLUDE TPTKREQ                                         08690002
087000     END-EXEC.                                                    08700002
087100/                                                                 08710002
087200*----------------------------------------------------------------*08720002
087300*    DB2 DCLGEN FOR THE TPTKREQ TABLE                             08730002
087400*----------------------------------------------------------------*08740002
087500     EXEC SQL                                                     08750002
087600          INCLUDE TPTKLNE                                         08760002
087700     END-EXEC.                                                    08770002
087800/                                                                 08780002
087900*----------------------------------------------------------------*08790002
088000*    DB2 DCLGEN FOR THE TTKTFMT TABLE                             08800002
088100*----------------------------------------------------------------*08810002
088200     EXEC SQL                                                     08820002
088300          INCLUDE TTKTFMT                                         08830002
088400     END-EXEC.                                                    08840002
088500/                                                                 08850002
088600*----------------------------------------------------------------*08860002
088700*    DB2 DCLGEN FOR THE TKRPRPM TABLE                             08870002
088800*----------------------------------------------------------------*08880002
088900     EXEC SQL                                                     08890002
089000          INCLUDE TKRPRPM                                         08900002
089100     END-EXEC.                                                    08910002
089200                                                                  08920002
089300** AHP - BEGIN 04/14/08                                           08930002
089400/                                                                 08940002
089500*----------------------------------------------------------------*08950002
089600*    DB2 DCLGEN FOR THE WST_INTGRTN_TYP TABLE                     08960002
089700*----------------------------------------------------------------*08970002
089800     EXEC SQL                                                     08980002
089900          INCLUDE WST00008                                        08990002
090000     END-EXEC.                                                    09000002
090100/                                                                 09010002
090200*----------------------------------------------------------------*09020002
090300*    DB2 DCLGEN FOR THE WST_ATTR_DEFN TABLE                       09030002
090400*----------------------------------------------------------------*09040002
090500     EXEC SQL                                                     09050002
090600          INCLUDE WST00009                                        09060002
090700     END-EXEC.                                                    09070002
090800/                                                                 09080002
090900*----------------------------------------------------------------*09090002
091000*    DB2 DCLGEN FOR THE WST_ATTR_ELEM TABLE                       09100002
091100*----------------------------------------------------------------*09110002
091200     EXEC SQL                                                     09120002
091300          INCLUDE WST00010                                        09130002
091400     END-EXEC.                                                    09140002
091500/                                                                 09150002
091600** AHP -  END  04/14/08                                           09160002
091700/                                                                 09170002
091710******************************************************************09171042
091720*    DB2 DCLGEN FOR THE RCT_PO_RCVR_TRKG TABLE                    09172042
091730******************************************************************09173042
091740     EXEC SQL                                                     09174042
091750          INCLUDE RCT00017                                        09175042
091760     END-EXEC.                                                    09176042
091770/                                                                 09177042
091800*----------------------------------------------------------------*09180002
091900*    DB2 AREA FOR COMMUNICATIONS                                 *09190002
092000*----------------------------------------------------------------*09200002
092100                                                                  09210002
092200     EXEC SQL                                                     09220002
092300          INCLUDE SQLCA                                           09230002
092400     END-EXEC.                                                    09240002
092500                                                                  09250002
092600/                                                                 09260002
092700 LINKAGE SECTION.                                                 09270002
092800                                                                  09280002
092900 01  DFHCOMMAREA.                                                 09290002
093000     05  FILLER                         OCCURS  1 TO 4072 TIMES   09300002
093100                                        DEPENDING ON EIBCALEN.    09310002
093200         10  FILLER                     PIC  X(01).               09320002
093300                                                                  09330002
093400/                                                                 09340002
093500 PROCEDURE DIVISION.                                              09350002
093600***************************************************************** 09360002
093700** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 09370002
093800** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 09380002
093900** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 09390002
094000**                                                             ** 09400002
094100** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 09410002
094200** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 09420002
094300***************************************************************** 09430002
094400 0000-MAIN-MODULE.                                                09440002
094500     INITIALIZE DP030-CICS-API-FIELDS.                            09450002
094600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09460002
094700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09470002
094800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09480002
094900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09490002
095000     MOVE LENGTH OF RC266AI        TO DP030-MAP-LENGTH (1).       09500002
095100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09510002
095200     PERFORM 0001-CALL-CICS-ARCH-API.                             09520002
095300*                                                                 09530002
095400     PERFORM 1000-CONTROL-PROCESSING.                             09540002
095500*                                                                 09550002
095600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09560002
095700     PERFORM 0001-CALL-CICS-ARCH-API.                             09570002
095800                                                                  09580002
095900 0001-CALL-CICS-ARCH-API.                                         09590002
096010     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09601041
096100                                    DFHCOMMAREA                   09610041
096200                                    DP030-CICS-API-FIELDS         09620041
096300                                    DP020-STANDARD-COMMAREA       09630041
096400                                    RC266AI.                      09640041
096500*                                                                 09650002
096600     IF  DP030-RC-CALL-SUCCESSFUL                                 09660002
096700         CONTINUE                                                 09670002
096800     ELSE                                                         09680002
096900         SET DP013-NO-ROLLBACK                                    09690002
097000             DP013-XCTL-DISPLAY-RESTART                           09700002
097100             DP013-CICS-ABEND      TO TRUE                        09710002
097200         MOVE 'BEFORE 0000-MAIN-MODULE'                           09720002
097300                                   TO DP013-PARAGRAPH             09730002
097320         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O09732041
097330-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09733041
097600         MOVE DP030-RETURN-CODE                                   09760002
097700                                   TO DP013-MESSAGE-TEXT (3)      09770002
097800         PERFORM DP013-0000-PROCESS-ABEND                         09780002
097900     END-IF.                                                      09790002
098000                                                                  09800002
098100/                                                                 09810002
098200*----------------------------------------------------------------*09820002
098300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *09830002
098400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *09840002
098500*----------------------------------------------------------------*09850002
098600 1000-CONTROL-PROCESSING.                                         09860002
098700                                                                  09870002
098800     EVALUATE TRUE                                                09880002
098900         WHEN DP020-NEXT-ACT-INITIAL                              09890002
099000              PERFORM 1100-PROCESS-INTER-APPL-COMM                09900002
099100              IF  PS-ERROR                                        09910002
099200                  CONTINUE                                        09920002
099300              ELSE                                                09930002
099400                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               09940002
099500                 SET ASC-ADD-PENDING TO TRUE                      09950002
099600                 PERFORM 4000-BUILD-INITIAL-PANEL                 09960002
099700              END-IF                                              09970002
099800                                                                  09980002
099900         WHEN DP020-NEXT-ACT-READ-MAP                             09990002
100000             PERFORM 2000-PROCESS-PANEL                           10000002
100100                                                                  10010002
100200         WHEN DP020-NEXT-ACT-RETURN                               10020002
100300             IF DP020-INT-APPL-FORMAT-IND =                       10030002
100400                                     PC-INTER-APPL-MULT-LIST      10040002
100500                MOVE TR001-PRO-NBR TO ASC-COMPLETE-PRO-NBR        10050002
100600                MOVE TR001-BOL-NBR TO ASC-COMPLETE-BOL-NBR        10060002
100700                MOVE TR001-SCAC    TO ASC-SCAC-ID                 10070002
100800                IF TR001-NEW-SHIP                                 10080002
100900                   SET ASC-ADD-NEW-SHIP TO TRUE                   10090002
101000                ELSE                                              10100002
101100                   MOVE TR001-SHIPT-ID TO ASC-SHIPT-ID            10110002
101200                   SET ASC-SHIPMENT-EXIST TO TRUE                 10120002
101300                END-IF                                            10130002
101400             END-IF                                               10140002
101500             SET PS-INQUIRE TO TRUE                               10150002
101600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10160002
101700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10170002
101800                                                                  10180002
101900         WHEN OTHER                                               10190002
102000             SET DP013-LOGIC-ABEND                                10200002
102100                 DP013-NO-ROLLBACK TO TRUE                        10210002
102200             MOVE '1000-CONTROL-PROCESSING'                       10220002
102300                                   TO DP013-PARAGRAPH             10230002
102400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   10240002
102500                                   TO DP013-MESSAGE-TEXT(1)       10250002
102600             MOVE DP020-NEXT-APPL-ACTIVITY                        10260002
102700                                   TO DP013-MESSAGE-TEXT(2)       10270002
102800             PERFORM DP013-0000-PROCESS-ABEND                     10280002
102900     END-EVALUATE.                                                10290002
103000                                                                  10300002
103100/                                                                 10310002
103200******************************************************************10320002
103300** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **10330002
103400** INTER-APPLICATION FORMAT CODE.                               **10340002
103500******************************************************************10350002
103600 1100-PROCESS-INTER-APPL-COMM.                                    10360002
103700                                                                  10370002
103800     INITIALIZE ASC-SPECIFIC-COMMAREA.                            10380002
103900                                                                  10390002
104000     EVALUATE DP020-INT-APPL-FORMAT-IND                           10400002
104100                                                                  10410002
104200         WHEN PC-INTER-APPL-MENU                                  10420002
104300             SET ASC-ADD-FROM-MENU TO TRUE                        10430002
104400             MOVE DP020-LOCATION-NBR                              10440002
104500                                   TO ASC-CRE-OPER-UNT-ID-N       10450002
104600                                      ASC-CRE-OPER-UNT-ID-OLD     10460002
104700                                      ASC-CURR-OPER-UNT-ID-N      10470002
104800             MOVE DP020-FCLTY-ID   TO ASC-CRE-FCLTY-ID-N          10480002
104900                                                                  10490002
105000         WHEN PC-INTER-APPL-LIST                                  10500002
105100             MOVE DP020-LOCATION-NBR                              10510002
105200                                   TO ASC-CURR-OPER-UNT-ID-N      10520002
105300             SET ASC-ADD-FROM-LIST TO TRUE                        10530002
105400             IF  RC015-NUMBER-OF-SELECTED-ITEMS = +0              10540002
105500                 SET DP030-OVERRIDE-GO                            10550002
105600                                   TO TRUE                        10560002
105700                 MOVE PC-TSYMSG-00057                             10570002
105800                                   TO DP020-MSG-NUMBER            10580002
105900                 SET PS-ERROR                                     10590002
106000                     DP020-MSG-WARNING                            10600002
106100                     DP020-NEXT-ACT-APPL-ERROR                    10610002
106200                                   TO TRUE                        10620002
106300             ELSE                                                 10630002
106400                 SET ASC-USE-SELECTION-QUEUE                      10640002
106500                     ASC-SELECTION-MADE                           10650002
106600                                   TO TRUE                        10660002
106700                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              10670002
106800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS10680002
106900                 MOVE RC015-NUMBER-OF-TS-ITEMS                    10690002
107000                                   TO ASC-NUMBER-OF-TS-ITEMS      10700002
107100                 MOVE RC015-SEL-QUEUE-NAME                        10710002
107200                                   TO ASC-SEL-QUEUE-NAME          10720002
107300                 MOVE RC015-CARTON-CNT                            10730002
107400                                   TO ASC-EXPTED-CART-CNT         10740002
107500                 MOVE RC015-PO-NBR TO ASC-PO-NBR-N                10750003
107600                 MOVE ASC-PO-NBR-N TO ASC-PO-NBR-OLD              10760002
107700                 MOVE RC015-OPER-UNT-ID                           10770002
107800                                   TO ASC-CRE-OPER-UNT-ID         10780002
107900                 MOVE RC015-FCLTY-ID                              10790002
108000                                   TO ASC-CRE-FCLTY-ID            10800002
108100                 PERFORM 1120-PREPARE-LIST-ENTRY                  10810002
108200                 IF  ASC-CRE-OPER-UNT-ID-N = ZEROES               10820002
108300                     MOVE RC015-OPER-UNT-ID                       10830002
108400                                   TO ASC-CRE-OPER-UNT-ID-N       10840002
108500                                      DK-OPER-UNT-ID              10850002
108600                     MOVE RC015-FCLTY-ID TO ASC-CRE-FCLTY-ID-N    10860002
108700                                            DK-FCLTY-ID           10870002
108800                 END-IF                                           10880002
108900                 MOVE ASC-CRE-OPER-UNT-ID-N                       10890002
109000                                   TO ASC-CRE-OPER-UNT-ID-OLD     10900002
109100                 IF  ASC-1ST-REC-SEQ-NBR NOT = +0                 10910002
109200                     MOVE PC-TSYMSG-00268                         10920002
109300                                   TO DP020-MSG-NUMBER            10930002
109400                     SET PS-ERROR                                 10940002
109500                         DP020-MSG-FATAL                          10950002
109600                         DP020-NEXT-ACT-APPL-ERROR                10960002
109700                                   TO TRUE                        10970002
109800                 ELSE                                             10980002
109900                     MOVE RC015-SHIPT-ID                          10990002
110000                                   TO DK-SHIPT-ID                 11000002
110100                                      ASC-SHIPT-ID                11010002
110200                 END-IF                                           11020002
110300             END-IF                                               11030002
110400                                                                  11040002
110500         WHEN OTHER                                               11050002
110600             SET PS-ERROR                                         11060002
110700                 DP020-MSG-FATAL                                  11070002
110800                 DP020-NEXT-ACT-APPL-ERROR                        11080002
110900                                  TO TRUE                         11090002
111000                                                                  11100002
111100     END-EVALUATE.                                                11110002
111200                                                                  11120002
111300/                                                                 11130002
111400*----------------------------------------------------------------*11140002
111500*    ENTRY IS FROM A LIST.  GET THE KEY INFORMATION FROM THE     *11150002
111600*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *11160002
111700*----------------------------------------------------------------*11170002
111800 1120-PREPARE-LIST-ENTRY.                                         11180002
111900                                                                  11190002
112000     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                11200002
112100     MOVE ZERO                     TO ASC-SEL-ITEM.               11210002
112200     PERFORM 2110-GET-NEXT-RECORD.                                11220002
112300                                                                  11230002
112400*----------------------------------------------------------------*11240002
112500*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*11250002
112600*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*11260002
112700*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *11270002
112800*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *11280002
112900*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *11290002
113000*----------------------------------------------------------------*11300002
113100 2000-PROCESS-PANEL.                                              11310002
113200                                                                  11320002
113300     EVALUATE TRUE                                                11330002
113400                                                                  11340002
113500         WHEN DP020-SRC-AID = DP016-ENTER                         11350002
113600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11360002
113700             SET PS-INQUIRE TO TRUE                               11370002
113800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11380002
113900             IF PS-NO-ERROR                                       11390002
114000                PERFORM 4005-GET-SHIPMENT-INFO                    11400002
114100                IF ASC-SHIPMENT-EXIST                             11410002
114200                   PERFORM 4065-MOVE-SHIPMENT-INFO                11420002
114300                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           11430002
114400                END-IF                                            11440002
114500             END-IF                                               11450002
114600                                                                  11460002
114700                                                                  11470002
114800         WHEN DP020-SRC-AID = DP016-CLEAR                         11480002
114900             SET PS-INQUIRE TO TRUE                               11490002
115000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11500002
115100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11510002
115200                                                                  11520002
115300         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     11530002
115400                                                                  11540002
115500             SET PS-INQUIRE TO TRUE                               11550002
115600             PERFORM 4000-BUILD-INITIAL-PANEL                     11560002
115700             PERFORM 3200-RESET-ATTRIBUTES                        11570002
115800                                                                  11580002
115900         WHEN OTHER                                               11590002
116000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11600002
116100             IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)            11610002
116200                CONTINUE                                          11620002
116300             ELSE                                                 11630002
116400                SET PS-INQUIRE TO TRUE                            11640002
116500             END-IF                                               11650002
116600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11660002
116700             IF  PS-NO-ERROR                                      11670002
116800                 PERFORM 2100-CHECK-FUNCTION-KEY                  11680002
116900                 SET DP030-CONTINUE-GO TO TRUE                    11690002
117000             ELSE                                                 11700002
117100                 SET DP030-OVERRIDE-GO TO TRUE                    11710002
117200             END-IF                                               11720002
117300     END-EVALUATE.                                                11730002
117400                                                                  11740002
117500/                                                                 11750002
117600******************************************************************11760002
117700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **11770002
117800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **11780002
117900** FROM THE CICS ARCHITECTURE API.                              **11790002
118000******************************************************************11800002
118100 2100-CHECK-FUNCTION-KEY.                                         11810002
118200                                                                  11820002
118300     EVALUATE TRUE                                                11830002
118400                                                                  11840002
118500         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 11850002
118600             PERFORM 2105-PREPARE-INTER-APPL-COMM                 11860002
118700                                                                  11870002
118800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11880002
118900             IF ASC-PO-TYPE = 'CD'                                11890002
119000                 SET PS-ERROR                                     11900002
119100                     DP020-MSG-FATAL        TO TRUE               11910002
119200                 MOVE PC-TSYMSG-03405 TO DP020-MSG-NUMBER         11920002
119300                 MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA            11930002
119400                 MOVE DP015-RED             TO APONBRC            11940002
119500                 MOVE DP015-REVERSE         TO APONBRH            11950002
119600                 MOVE -1                    TO APONBRL            11960002
119700                 SET DP030-SET-CURSOR-APPL-1                      11970002
119800                                               TO TRUE            11980002
119900             ELSE                                                 11990002
120000                 PERFORM 2150-RCVR-CREATE                         12000002
120100             END-IF                                               12010002
120200                                                                  12020002
120300         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    12030002
120400             IF ASC-VND-DT-F2-REQUIRED                            12040002
120500                 MOVE DP015-UNP-ALP-NOR-OFF TO AVSHMMA            12050002
120600                                               AVSHDDA            12060002
120700                                               AVSHYYA            12070002
120800                 MOVE DP015-GREEN           TO AVSHMMC            12080002
120900                                               AVSHDDC            12090002
121000                                               AVSHYYC            12100002
121100                 MOVE DP015-UNDERLINE       TO AVSHMMH            12110002
121200                                               AVSHDDH            12120002
121300                                               AVSHYYH            12130002
121400                 PERFORM 2150-RCVR-CREATE                         12140002
121500             ELSE                                                 12150002
121600                 SET PS-ERROR                                     12160002
121700                     DP020-MSG-WARNING  TO TRUE                   12170002
121800                 MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER         12180002
121900             END-IF                                               12190002
122000                                                                  12200002
122100                                                                  12210002
122200         WHEN OTHER                                               12220002
122300             SET DP013-NO-ROLLBACK                                12230002
122400                 DP013-XCTL-DISPLAY-RESTART                       12240002
122500                 DP013-CICS-ABEND  TO TRUE                        12250002
122600             MOVE '2100-CHECK-FUNCTION-KEY'                       12260002
122700                                   TO DP013-PARAGRAPH             12270002
122800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12280002
122900                                   TO DP013-MESSAGE-TEXT (1)      12290002
123000             PERFORM DP013-0000-PROCESS-ABEND                     12300002
123100     END-EVALUATE.                                                12310002
123200                                                                  12320002
123300/                                                                 12330002
123400******************************************************************12340002
123500** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **12350002
123600** INTER-APPLICATION COMMAREA.                                  **12360002
123700******************************************************************12370002
123800 2105-PREPARE-INTER-APPL-COMM.                                    12380002
123900                                                                  12390002
124000     INITIALIZE TR001-INTER-APPL-COMMAREA.                        12400002
124100                                                                  12410002
124200     MOVE ASC-PO-NBR               TO TR001-PO-NBR.               12420002
124300     MOVE ASC-COMPLETE-PRO-NBR     TO TR001-PRO-NBR.              12430002
124400     MOVE ASC-COMPLETE-BOL-NBR     TO TR001-BOL-NBR.              12440002
124500     MOVE ASC-VEH-NBR              TO TR001-TRLR-NBR.             12450002
124600     MOVE ASC-CRE-OPER-UNT-ID      TO TR001-OPER-UNT-ID.          12460002
124700     MOVE ASC-CRE-FCLTY-ID         TO TR001-FCLTY-ID.             12470002
124800     MOVE ASC-SCAC-ID              TO TR001-SCAC.                 12480002
124900     MOVE ASC-VEND-SHIP-DTE        TO TR001-ETA-DTE.              12490002
125000     MOVE ASC-REC-SEQ-NBR          TO TR001-REC-SEQ-NBR.          12500002
125100                                                                  12510002
125200*----------------------------------------------------------------*12520002
125300*    GET THE DATA (KEY) OF THE NEXT SELECTED OBJECT              *12530002
125400*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *12540002
125500*----------------------------------------------------------------*12550002
125600 2110-GET-NEXT-RECORD.                                            12560002
125700                                                                  12570002
125800     ADD +1                        TO ASC-SEL-SUB.                12580002
125900     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            12590002
126000         ADD +1                    TO ASC-SEL-ITEM                12600002
126100         MOVE +1                   TO ASC-SEL-SUB                 12610002
126200     END-IF.                                                      12620002
126300                                                                  12630002
126400     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12640002
126500         PERFORM 9100-READ-SEL-QUEUE                              12650002
126600         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      12660002
126700             MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                 12670002
126800                                   TO ASC-1ST-REC-SEQ-NBR         12680002
126900             MOVE RC013-SEQ-NBR (ASC-SEL-SUB)                     12690002
127000                                   TO ASC-SEQ-NBR                 12700002
127100             MOVE RC013-OWNER-SCAC-ID (ASC-SEL-SUB)               12710002
127200                                   TO ASC-SCAC-ID                 12720002
127300             MOVE RC013-VEH-NBR       (ASC-SEL-SUB)               12730002
127400                                   TO ASC-VEH-NBR                 12740002
127500             MOVE RC013-PRO-NBR       (ASC-SEL-SUB)               12750002
127600                                   TO ASC-COMPLETE-PRO-NBR        12760002
127700             MOVE RC013-BOL-NBR       (ASC-SEL-SUB)               12770002
127800                                   TO ASC-COMPLETE-BOL-NBR        12780002
127900             MOVE RC013-VND-SHP-DTE (ASC-SEL-SUB)                 12790002
128000                                   TO PV-DB2-DATE                 12800002
128100             MOVE PV-DB2-DATE-MM   TO ASC-VEND-SHIP-MM            12810002
128200             MOVE PV-DB2-DATE-DD   TO ASC-VEND-SHIP-DD            12820002
128300             MOVE PV-DB2-DATE-CCYY TO ASC-VEND-SHIP-CCYY          12830002
128400             SET RC013-INQ (ASC-SEL-SUB)                          12840002
128500                                   TO TRUE                        12850002
128600             PERFORM 9200-REWRITE-SEL-QUEUE                       12860002
128700         ELSE                                                     12870002
128800             SUBTRACT +1 FROM ASC-SEL-SUB                         12880002
128900              SET PS-LIST-END       TO TRUE                       12890002
129000         END-IF                                                   12900002
129100     ELSE                                                         12910002
129200         SUBTRACT +1 FROM ASC-SEL-ITEM                            12920002
129300         SET PS-LIST-END       TO TRUE                            12930002
129400     END-IF.                                                      12940002
129500                                                                  12950002
129600 2150-RCVR-CREATE.                                                12960002
129700     PERFORM 6000-CREATE-SHIPMENT.                                12970002
129800     IF PS-NO-ERROR                                               12980002
129900        PERFORM 5000-ADD-RECEIVER                                 12990002
130000        IF PS-NO-ERROR                                            13000002
130100            MOVE ASC-REC-SEQ-NBR TO SHPTPO-REC-SEQ-NBR            13010002
130200            MOVE ASC-EXPTED-CART-CNT-N                            13020002
130300                                 TO SHPTPO-EXPTED-CART-CNT        13030002
130400            IF ASC-TRBL-DESC > SPACES                             13040002
130500               MOVE ASC-TRBL-DESC TO ATRBLO                       13050002
130600               MOVE DP015-YELLOW          TO ATRBLC               13060002
130700            END-IF                                                13070002
130800            IF PS-SHPTPO-FOUND                                    13080002
130900               PERFORM 6080-UPDATE-TSHPTPO                        13090002
131000            ELSE                                                  13100002
131100               PERFORM 6070-INSERT-TSHPTPO                        13110002
131200            END-IF                                                13120002
131300            IF ASC-ADD-FROM-LIST                                  13130002
131400               PERFORM 5500-UPDATE-PKSLIPS                        13140002
131500            END-IF                                                13150002
131600        END-IF                                                    13160002
131700     END-IF.                                                      13170002
131800/                                                                 13180002
131900*----------------------------------------------------------------*13190002
132000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13200002
132100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13210002
132200*----------------------------------------------------------------*13220002
132300 2200-MOVE-SCREEN-TO-COMMAREA.                                    13230002
132400                                                                  13240002
132500     IF  APONBRL > ZERO                                           13250002
132600         MOVE APONBRI              TO ASC-PO-NBR                  13260002
132700     ELSE                                                         13270002
132800        IF  APONBRF = DP015-ERASE-EOF                             13280002
132900            MOVE SPACES            TO ASC-PO-NBR                  13290002
133000        END-IF                                                    13300002
133100     END-IF.                                                      13310002
133200                                                                  13320002
133300     IF  AAPRCVRL > ZERO                                          13330002
133400         MOVE AAPRCVRI             TO ASC-AP-RCVR-NBR             13340002
133500     ELSE                                                         13350002
133600        IF  AAPRCVRF = DP015-ERASE-EOF                            13360002
133700            MOVE SPACES            TO ASC-AP-RCVR-NBR             13370002
133800        END-IF                                                    13380002
133900     END-IF.                                                      13390002
134000                                                                  13400002
134100     IF  ASCACL > ZERO                                            13410002
134200         MOVE ASCACI               TO ASC-SCAC-ID                 13420002
134300     ELSE                                                         13430002
134400         IF  ASCACF = DP015-ERASE-EOF                             13440002
134500             MOVE SPACES           TO ASC-SCAC-ID                 13450002
134600         END-IF                                                   13460002
134700     END-IF.                                                      13470002
134800                                                                  13480002
134900     IF  ATRLNBRL > ZERO                                          13490002
135000         MOVE ATRLNBRI             TO ASC-VEH-NBR                 13500002
135100     ELSE                                                         13510002
135200         IF  ATRLNBRF = DP015-ERASE-EOF                           13520002
135300             MOVE SPACES           TO ASC-VEH-NBR                 13530002
135400         END-IF                                                   13540002
135500     END-IF.                                                      13550002
135600                                                                  13560002
135700* CT 11/11/11 - BEGIN WR40574                                     13570010
135800     IF  ACANIDL > ZERO                                           13580003
135900         MOVE ACANIDI             TO ASC-CAN                      13590016
136000     ELSE                                                         13600003
136100         IF  ACANIDF = DP015-ERASE-EOF                            13610003
136200             MOVE SPACES           TO ASC-CAN                     13620016
136300         END-IF                                                   13630003
136400     END-IF.                                                      13640003
136500* CT 11/11/11 - END   WR40574                                     13650010
136600                                                                  13660003
136700     IF  AFBNBRL > ZERO                                           13670002
136800         MOVE AFBNBRI              TO ASC-COMPLETE-PRO-NBR        13680002
136900     ELSE                                                         13690002
137000         IF  AFBNBRF = DP015-ERASE-EOF                            13700002
137100             MOVE SPACES           TO ASC-COMPLETE-PRO-NBR        13710002
137200                                      ASC-PRO-NBR                 13720002
137300         END-IF                                                   13730002
137400     END-IF.                                                      13740002
137500                                                                  13750002
137600     IF  ASHPMML > ZERO                                           13760002
137700         MOVE ASHPMMI             TO ASC-CARR-SHIP-MM             13770002
137800     ELSE                                                         13780002
137900         IF  ASHPMMF = DP015-ERASE-EOF                            13790002
138000             MOVE SPACES           TO ASC-CARR-SHIP-MM            13800002
138100         END-IF                                                   13810002
138200     END-IF.                                                      13820002
138300                                                                  13830002
138400     IF  ASHPDDL > ZERO                                           13840002
138500         MOVE ASHPDDI             TO ASC-CARR-SHIP-DD             13850002
138600     ELSE                                                         13860002
138700         IF  ASHPDDF = DP015-ERASE-EOF                            13870002
138800             MOVE SPACES           TO ASC-CARR-SHIP-DD            13880002
138900         END-IF                                                   13890002
139000     END-IF.                                                      13900002
139100                                                                  13910002
139200     IF  ASHPYYL > ZERO                                           13920002
139300         MOVE ASHPYYI             TO ASC-CARR-SHIP-YY             13930002
139400     ELSE                                                         13940002
139500         IF  ASHPYYF = DP015-ERASE-EOF                            13950002
139600             MOVE SPACES           TO ASC-CARR-SHIP-YY            13960002
139700         END-IF                                                   13970002
139800     END-IF.                                                      13980002
139900                                                                  13990002
140000     IF ASC-CARR-SHIP-YY > SPACES                                 14000002
140100        IF ASC-CARR-SHIP-YY > '60'                                14010002
140200           MOVE '19'            TO ASC-CARR-SHIP-CC               14020002
140300        ELSE                                                      14030002
140400           MOVE '20'            TO ASC-CARR-SHIP-CC               14040002
140500        END-IF                                                    14050002
140600     ELSE                                                         14060002
140700        MOVE SPACES             TO ASC-CARR-SHIP-CC               14070002
140800     END-IF.                                                      14080002
140900                                                                  14090002
141000     IF  AOPERL > ZERO                                            14100002
141100         MOVE AOPERI               TO ASC-CRE-OPER-UNT-ID         14110002
141200     ELSE                                                         14120002
141300         IF  AOPERF = DP015-ERASE-EOF                             14130002
141400             MOVE SPACES           TO ASC-CRE-OPER-UNT-ID         14140002
141500         END-IF                                                   14150002
141600     END-IF.                                                      14160002
141700                                                                  14170002
141800     IF  AFCLTYL > ZERO                                           14180002
141900         MOVE AFCLTYI              TO ASC-CRE-FCLTY-ID            14190002
142000     ELSE                                                         14200002
142100         IF  AFCLTYF = DP015-ERASE-EOF                            14210002
142200             MOVE SPACES           TO ASC-CRE-FCLTY-ID            14220002
142300         END-IF                                                   14230002
142400     END-IF.                                                      14240002
142500                                                                  14250002
142600     IF  AVSHMML > ZERO                                           14260002
142700         MOVE AVSHMMI             TO ASC-VEND-SHIP-MM             14270002
142800     ELSE                                                         14280002
142900         IF  AVSHMMF = DP015-ERASE-EOF                            14290002
143000             MOVE SPACES           TO ASC-VEND-SHIP-MM            14300002
143100         END-IF                                                   14310002
143200     END-IF.                                                      14320002
143300                                                                  14330002
143400     IF  AVSHDDL > ZERO                                           14340002
143500         MOVE AVSHDDI             TO ASC-VEND-SHIP-DD             14350002
143600     ELSE                                                         14360002
143700         IF  AVSHDDF = DP015-ERASE-EOF                            14370002
143800             MOVE SPACES           TO ASC-VEND-SHIP-DD            14380002
143900         END-IF                                                   14390002
144000     END-IF.                                                      14400002
144100                                                                  14410002
144200     IF  AVSHYYL > ZERO                                           14420002
144300         MOVE AVSHYYI             TO ASC-VEND-SHIP-YY             14430002
144400     ELSE                                                         14440002
144500         IF  AVSHYYF = DP015-ERASE-EOF                            14450002
144600             MOVE SPACES           TO ASC-VEND-SHIP-YY            14460002
144700         END-IF                                                   14470002
144800     END-IF.                                                      14480002
144900                                                                  14490002
145000     IF ASC-VEND-SHIP-YY > SPACES                                 14500002
145100        IF ASC-VEND-SHIP-YY > '60'                                14510002
145200           MOVE '19'                  TO ASC-VEND-SHIP-CC         14520002
145300        ELSE                                                      14530002
145400           MOVE '20'                  TO ASC-VEND-SHIP-CC         14540002
145500        END-IF                                                    14550002
145600     ELSE                                                         14560002
145700        MOVE SPACES                   TO ASC-VEND-SHIP-CC         14570002
145800     END-IF.                                                      14580002
145900                                                                  14590002
146000     IF  ABOLNBRL > ZERO                                          14600002
146100         MOVE ABOLNBRI             TO ASC-COMPLETE-BOL-NBR        14610002
146200     ELSE                                                         14620002
146300         IF  ABOLNBRF = DP015-ERASE-EOF                           14630002
146400             MOVE SPACES           TO ASC-COMPLETE-BOL-NBR        14640002
146500                                      ASC-BOL-NBR                 14650002
146600         END-IF                                                   14660002
146700     END-IF.                                                      14670002
146800                                                                  14680002
146900     IF  ACRTCNTL > ZERO                                          14690002
147000         MOVE ACRTCNTI             TO ASC-EXPTED-CART-CNT         14700002
147100     ELSE                                                         14710002
147200         IF  ACRTCNTF = DP015-ERASE-EOF                           14720002
147300             MOVE SPACES           TO ASC-EXPTED-CART-CNT         14730002
147400         END-IF                                                   14740002
147500     END-IF.                                                      14750002
147600                                                                  14760002
147700                                                                  14770002
147800     IF  ABYSTRL > ZERO                                           14780002
147900         MOVE ABYSTRI              TO ASC-PACK-BY-ST-IND          14790002
148000     ELSE                                                         14800002
148100         IF  ABYSTRF = DP015-ERASE-EOF                            14810002
148200             MOVE SPACES           TO ASC-PACK-BY-ST-IND          14820002
148300         END-IF                                                   14830002
148400     END-IF.                                                      14840002
148500                                                                  14850002
148600     IF  APRETKL > ZERO                                           14860002
148700         MOVE APRETKI              TO ASC-PRE-TICKET-IND          14870002
148800     ELSE                                                         14880002
148900         IF  APRETKF = DP015-ERASE-EOF                            14890002
149000             MOVE SPACES           TO ASC-PRE-TICKET-IND          14900002
149100         END-IF                                                   14910002
149200     END-IF.                                                      14920002
149300                                                                  14930002
149400     IF  AHANGERL > ZERO                                          14940002
149500         MOVE AHANGERI             TO ASC-HANGER-IND              14950002
149600     ELSE                                                         14960002
149700         IF  AHANGERF = DP015-ERASE-EOF                           14970002
149800             MOVE SPACES           TO ASC-HANGER-IND              14980002
149900         END-IF                                                   14990002
150000     END-IF.                                                      15000002
150100                                                                  15010002
150200/                                                                 15020002
150300*----------------------------------------------------------------*15030002
150400* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *15040002
150500* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *15050002
150600* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *15060002
150700*----------------------------------------------------------------*15070002
150800 3000-EDIT-DATA-IN-COMMAREA.                                      15080002
150900                                                                  15090002
151000     PERFORM 3200-RESET-ATTRIBUTES.                               15100002
151100                                                                  15110002
151200     IF  ASC-HANGER-IND = (' ' OR 'Y' OR 'N')                     15120002
151300         CONTINUE                                                 15130002
151400     ELSE                                                         15140002
151500         SET PS-ERROR                                             15150002
151600             DP020-MSG-FATAL        TO TRUE                       15160002
151700         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           15170002
151800         MOVE DP015-UNP-ALP-BRT-OFF TO AHANGERA                   15180002
151900         MOVE DP015-RED             TO AHANGERC                   15190002
152000         MOVE DP015-REVERSE         TO AHANGERH                   15200002
152100         MOVE -1                    TO AHANGERL                   15210002
152200         SET DP030-SET-CURSOR-APPL-1                              15220002
152300                                    TO TRUE                       15230002
152400     END-IF.                                                      15240002
152500                                                                  15250002
152600     IF  ASC-PRE-TICKET-IND = (' ' OR 'Y' OR 'N')                 15260002
152700         CONTINUE                                                 15270002
152800     ELSE                                                         15280002
152900         SET PS-ERROR                                             15290002
153000             DP020-MSG-FATAL        TO TRUE                       15300002
153100         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           15310002
153200         MOVE DP015-UNP-ALP-BRT-OFF TO APRETKA                    15320002
153300         MOVE DP015-RED             TO APRETKC                    15330002
153400         MOVE DP015-REVERSE         TO APRETKH                    15340002
153500         MOVE -1                    TO APRETKL                    15350002
153600         SET DP030-SET-CURSOR-APPL-1                              15360002
153700                                    TO TRUE                       15370002
153800     END-IF.                                                      15380002
153900                                                                  15390002
154000     IF ASC-PO-NBR > (SPACES OR ZEROES)                           15400002
154100        MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD       15410002
154200        MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS       15420002
154300        MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS     15430002
154400        SET  DP010I-NEGATIVE-NOT-ALLOWED                          15440002
154500                                   TO TRUE                        15450002
154610        CALL DP010I-NUMERIC-EDIT-ROUTINE                          15461040
154620             USING DP010I-NUMERIC-EDIT-AREA                       15462040
154630                                                                  15463040
154700        IF  DP010I-ERROR-DETECTED                                 15470002
154800            SET PS-ERROR                                          15480002
154900                DP020-MSG-FATAL    TO TRUE                        15490002
155000            MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER            15500002
155100            MOVE DP015-UNP-ALP-BRT-OFF                            15510002
155200                                   TO APONBRA                     15520002
155300            MOVE DP015-RED         TO APONBRC                     15530002
155400            MOVE DP015-REVERSE     TO APONBRH                     15540002
155500            MOVE -1                TO APONBRL                     15550002
155600            SET DP030-SET-CURSOR-APPL-1                           15560002
155700                                   TO TRUE                        15570002
155800        ELSE                                                      15580002
155900            MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-PO-NBR           15590002
156000            MOVE PV-TEMP-PO-NBR      TO ASC-PO-NBR-N              15600002
156100                                        DK-PO-NBR                 15610002
156200                                        APONBRO                   15620002
156300            PERFORM 4070-GET-ENT-NAME-DESC                        15630002
156400            MOVE ASC-ENT-NAME-DESC    TO AVNDNMO                  15640002
156500            MOVE ASC-DEPT-NBR         TO DK-DEPT-NBR              15650002
156600            PERFORM 4090-GET-AD-DATE                              15660002
156700            MOVE ASC-AD-DTE           TO AADDTEO                  15670002
156800        END-IF                                                    15680020
156900     END-IF.                                                      15690002
157000                                                                  15700002
157100     IF  ASC-COMPLETE-PRO-NBR NOT = ASC-PRO-NBR-OLD OR            15710002
157200         ASC-COMPLETE-BOL-NBR NOT = ASC-BOL-NBR-OLD OR            15720002
157300         ASC-SCAC-ID          NOT = ASC-SCAC-ID-OLD               15730002
157400         MOVE SPACES               TO ASC-AP-RCVR-NBR             15740002
157500                                      ASC-TRBL-DESC               15750002
157600     END-IF.                                                      15760002
157700                                                                  15770002
157800     IF ASC-CRE-OPER-UNT-ID > (SPACES OR ZEROES)                  15780002
157900         MOVE ASC-CRE-OPER-UNT-ID TO DP010I-UNEDITED-FIELD        15790002
158000         MOVE LENGTH OF ASC-CRE-OPER-UNT-ID                       15800002
158100                                 TO DP010I-MAXIMUM-DIGITS         15810002
158200         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       15820002
158300         SET DP010I-NEGATIVE-NOT-ALLOWED                          15830002
158400                                 TO TRUE                          15840002
158520         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15852040
158530              USING DP010I-NUMERIC-EDIT-AREA                      15853040
158540                                                                  15854040
158600         IF  DP010I-ERROR-DETECTED                                15860002
158700             SET PS-ERROR                                         15870002
158800                 DP020-MSG-FATAL TO TRUE                          15880002
158900             MOVE PC-TSYMSG-00008                                 15890002
159000                                 TO DP020-MSG-NUMBER              15900002
159100             MOVE DP015-UNP-ALP-BRT-OFF                           15910002
159200                                 TO AOPERA                        15920002
159300             MOVE DP015-RED      TO AOPERC                        15930002
159400             MOVE DP015-REVERSE  TO AOPERH                        15940002
159500             MOVE -1             TO AOPERL                        15950002
159600             SET DP030-SET-CURSOR-APPL-1                          15960002
159700                                 TO TRUE                          15970002
159800         ELSE                                                     15980002
159900             MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-OPER-UNT        15990002
160000             MOVE PV-TEMP-OPER-UNT TO ASC-CRE-OPER-UNT-ID-N       16000002
160100                                    DK-OPER-UNT-ID                16010002
160200             MOVE ASC-CRE-OPER-UNT-ID                             16020002
160300                                 TO AOPERO                        16030002
160400             MOVE ASC-CURR-OPER-UNT-ID                            16040002
160500                                 TO ACURRO                        16050002
160600             PERFORM 3010-VALIDATE-OPER-UNT-ID                    16060002
160700             IF PS-INVALID-LOC                                    16070002
160800                 SET PS-ERROR                                     16080002
160900                     DP020-MSG-FATAL     TO TRUE                  16090002
161000                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      16100002
161100                 MOVE DP015-UNP-ALP-BRT-OFF                       16110002
161200                                         TO AOPERA                16120002
161300                 MOVE DP015-RED          TO AOPERC                16130002
161400                 MOVE DP015-REVERSE      TO AOPERH                16140002
161500                 MOVE -1                 TO AOPERL                16150002
161600                 SET DP030-SET-CURSOR-APPL-1                      16160002
161700                                         TO TRUE                  16170002
161800             END-IF                                               16180002
161900         END-IF                                                   16190002
162000     END-IF.                                                      16200002
162100                                                                  16210002
162200     IF ASC-CRE-FCLTY-ID > (SPACES OR ZEROES)                     16220002
162300         MOVE ASC-CRE-FCLTY-ID   TO DP010I-UNEDITED-FIELD         16230002
162400         MOVE LENGTH OF ASC-CRE-FCLTY-ID                          16240002
162500                                 TO DP010I-MAXIMUM-DIGITS         16250002
162600         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       16260002
162700         SET DP010I-NEGATIVE-NOT-ALLOWED                          16270002
162800                                 TO TRUE                          16280002
162920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16292040
162930              USING DP010I-NUMERIC-EDIT-AREA                      16293040
162940                                                                  16294040
163000         IF  DP010I-ERROR-DETECTED                                16300002
163100             SET PS-ERROR                                         16310002
163200                 DP020-MSG-FATAL TO TRUE                          16320002
163300             MOVE PC-TSYMSG-00008                                 16330002
163400                                 TO DP020-MSG-NUMBER              16340002
163500             MOVE DP015-UNP-ALP-BRT-OFF                           16350002
163600                                 TO AFCLTYA                       16360002
163700             MOVE DP015-RED      TO AFCLTYC                       16370002
163800             MOVE DP015-REVERSE  TO AFCLTYH                       16380002
163900             MOVE -1             TO AFCLTYL                       16390002
164000             SET DP030-SET-CURSOR-APPL-1                          16400002
164100                                 TO TRUE                          16410002
164200         ELSE                                                     16420002
164300             MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-FCLTY           16430002
164400             MOVE PV-TEMP-FCLTY  TO ASC-CRE-FCLTY-ID-N            16440002
164500                                    DK-FCLTY-ID                   16450002
164600             MOVE ASC-CRE-FCLTY-ID TO AFCLTYO                     16460002
164700             IF ASC-CRE-FCLTY-ID-N NOT = 1                        16470002
164800                 SET PS-ERROR                                     16480002
164900                     DP020-MSG-FATAL     TO TRUE                  16490002
165000                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      16500002
165100                 MOVE DP015-UNP-ALP-BRT-OFF                       16510002
165200                                         TO AFCLTYA               16520002
165300                 MOVE DP015-RED          TO AFCLTYC               16530002
165400                 MOVE DP015-REVERSE      TO AFCLTYH               16540002
165500                 MOVE -1                 TO AFCLTYL               16550002
165600                 SET DP030-SET-CURSOR-APPL-1                      16560002
165700                                         TO TRUE                  16570002
165800             END-IF                                               16580002
165900         END-IF                                                   16590002
166000     END-IF.                                                      16600002
166100                                                                  16610002
166200     IF  ASC-VEND-SHIP-DTE = '01010001'                           16620002
166300         MOVE SPACES  TO ASC-VEND-SHIP-DTE                        16630002
166400     END-IF.                                                      16640002
166500                                                                  16650002
166600     IF ASC-VND-DT-F2-REQUIRED                                    16660002
166700         AND ASC-VEND-SHIP-MM  = ASC-VEND-SHIP-MM-OLD             16670002
166800         AND ASC-VEND-SHIP-DD  = ASC-VEND-SHIP-DD-OLD             16680002
166900         AND ASC-VEND-SHIP-CCYY  = ASC-VEND-SHIP-CCYY-OLD         16690002
167000         CONTINUE                                                 16700002
167100     ELSE                                                         16710002
167200         IF  ASC-VEND-SHIP-DTE > SPACES                           16720002
167300             PERFORM 3030-VALIDATE-VEND-SHIP-DTE                  16730002
167400             IF  PS-INVALID-VND-DTE                               16740002
167500                 MOVE DP015-RED      TO AVSHMMC                   16750002
167600                                        AVSHDDC                   16760002
167700                                        AVSHYYC                   16770002
167800                 MOVE DP015-REVERSE  TO AVSHMMH                   16780002
167900                                        AVSHDDH                   16790002
168000                                        AVSHYYH                   16800002
168100                 MOVE -1             TO AVSHMML                   16810002
168200                 MOVE PC-TSYMSG-00009                             16820002
168300                                     TO DP020-MSG-NUMBER          16830002
168400                 SET DP020-MSG-FATAL TO TRUE                      16840002
168500                 SET PS-ERROR        TO TRUE                      16850002
168600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              16860002
168700             ELSE                                                 16870002
168800                 MOVE ASC-VEND-SHIP-MM    TO AVSHMMO              16880002
168900                                             ASC-VEND-SHIP-MM-OLD 16890002
169000                 MOVE ASC-VEND-SHIP-DD    TO AVSHDDO              16900002
169100                                             ASC-VEND-SHIP-DD-OLD 16910002
169200                 MOVE ASC-VEND-SHIP-YY    TO AVSHYYO              16920002
169300                                             ASC-VEND-SHIP-YY-OLD 16930002
169400                 MOVE ASC-VEND-SHIP-CC    TO ASC-VEND-SHIP-CC-OLD 16940002
169500                 MOVE PV-DB2-HOLD-DATE TO ASC-VEND-SHIP-DTE-ISO   16950002
169600             END-IF                                               16960002
169700         END-IF                                                   16970002
169800     END-IF.                                                      16980002
169900                                                                  16990002
170000     IF  ASC-CARR-SHIP-DTE = '01010001'                           17000002
170100         MOVE SPACES TO ASC-CARR-SHIP-DTE                         17010002
170200     END-IF.                                                      17020002
170300                                                                  17030002
170400     IF  ASC-CARR-SHIP-DTE > SPACES                               17040002
170500         PERFORM 3035-VALIDATE-CARR-SHIP-DTE                      17050002
170600         IF  PS-INVALID-CARR-DTE                                  17060002
170700             MOVE DP015-RED      TO ASHPMMC                       17070002
170800                                    ASHPDDC                       17080002
170900                                    ASHPYYC                       17090002
171000             MOVE DP015-REVERSE  TO ASHPMMH                       17100002
171100                                    ASHPDDH                       17110002
171200                                    ASHPYYH                       17120002
171300             MOVE -1             TO ASHPMML                       17130002
171400             MOVE PC-TSYMSG-00009                                 17140002
171500                                 TO DP020-MSG-NUMBER              17150002
171600             SET DP020-MSG-FATAL TO TRUE                          17160002
171700             SET PS-ERROR        TO TRUE                          17170002
171800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17180002
171900         END-IF                                                   17190002
172000     END-IF.                                                      17200002
172100                                                                  17210002
172200     IF  ASC-VEH-NBR > SPACES                                     17220002
172300         MOVE ASC-VEH-NBR TO RC023-VEHICLE                        17230002
172400         CALL RC023-FB-BOL-VEH-FORMAT USING                       17240002
172500                                    RC023-FORMAT-DATA-AREA        17250002
172600         MOVE RC023-VEHICLE  TO ASC-VEH-NBR                       17260002
172700                                ATRLNBRO                          17270002
172800     END-IF.                                                      17280002
172900                                                                  17290002
173000     IF ASC-COMPLETE-PRO-NBR > SPACES AND PS-NO-ERROR             17300002
173100        MOVE ASC-COMPLETE-PRO-NBR       TO RC023-FREIGHT-BILL     17310002
173200                                           AFBNBRO                17320002
173300        CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA             17330002
173400        MOVE RC023-FREIGHT-BILL  TO ASC-PRO-NBR                   17340002
173500     ELSE                                                         17350002
173600        IF PS-NO-ERROR                                            17360002
173700           MOVE SPACES           TO ASC-PRO-NBR                   17370002
173800        END-IF                                                    17380002
173900     END-IF.                                                      17390002
174000                                                                  17400002
174100     IF ASC-COMPLETE-BOL-NBR > SPACES AND PS-NO-ERROR             17410002
174200        MOVE ASC-COMPLETE-BOL-NBR       TO RC023-BILL-OF-LADING   17420002
174300                                           ABOLNBRO               17430002
174400        CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA             17440002
174500        MOVE RC023-BILL-OF-LADING  TO ASC-BOL-NBR                 17450002
174600     ELSE                                                         17460002
174700        IF PS-NO-ERROR                                            17470002
174800           MOVE SPACES             TO ASC-BOL-NBR                 17480002
174900        END-IF                                                    17490002
175000     END-IF.                                                      17500002
175100                                                                  17510002
175200     IF  ASC-SCAC-ID > SPACES AND PS-NO-ERROR                     17520002
175300         MOVE ASC-SCAC-ID TO DK-SCAC-ID                           17530002
175400         PERFORM 3040-VALIDATE-SCAC-CDE                           17540002
175500         IF  PS-INVALID-SCAC                                      17550002
175600             MOVE DP015-RED      TO ASCACC                        17560002
175700             MOVE DP015-REVERSE  TO ASCACH                        17570002
175800             MOVE DP015-UNP-ALP-BRT-OFF                           17580002
175900                                     TO ASCACA                    17590002
176000             MOVE -1             TO ASCACL                        17600002
176100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17610002
176200             MOVE PC-TSYMSG-00148                                 17620002
176300                                 TO DP020-MSG-NUMBER              17630002
176400             SET DP020-MSG-FATAL TO TRUE                          17640002
176500             SET PS-ERROR        TO TRUE                          17650002
176600         END-IF                                                   17660002
176700     END-IF.                                                      17670002
176800                                                                  17680002
176900                                                                  17690002
177000      IF ASC-EXPTED-CART-CNT > (SPACES OR ZEROES)                 17700002
177100          MOVE ASC-EXPTED-CART-CNT   TO DP010I-UNEDITED-FIELD     17710002
177200          MOVE LENGTH OF ASC-EXPTED-CART-CNT                      17720002
177300                                     TO DP010I-MAXIMUM-DIGITS     17730002
177400          MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS   17740002
177500          SET  DP010I-NEGATIVE-NOT-ALLOWED                        17750002
177600                                     TO TRUE                      17760002
177720          CALL DP010I-NUMERIC-EDIT-ROUTINE                        17772040
177730               USING DP010I-NUMERIC-EDIT-AREA                     17773040
177740                                                                  17774040
177800          IF  DP010I-ERROR-DETECTED                               17780002
177900              SET PS-ERROR                                        17790002
178000                  DP020-MSG-FATAL    TO TRUE                      17800002
178100              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          17810002
178200              MOVE DP015-UNP-ALP-BRT-OFF                          17820002
178300                                     TO ACRTCNTA                  17830002
178400              MOVE DP015-RED         TO ACRTCNTC                  17840002
178500              MOVE DP015-REVERSE     TO ACRTCNTH                  17850002
178600              MOVE -1                TO ACRTCNTL                  17860002
178700              SET DP030-SET-CURSOR-APPL-1                         17870002
178800                                     TO TRUE                      17880002
178900          ELSE                                                    17890002
179000              MOVE DP010I-NUMERIC-FIELD                           17900002
179100                                     TO ASC-EXPTED-CART-CNT-N     17910002
179200              MOVE ASC-EXPTED-CART-CNT                            17920002
179300                                     TO ACRTCNTO                  17930002
179400         END-IF                                                   17940002
179500     END-IF.                                                      17950002
179600                                                                  17960002
179700* CT 11/11/11 - BEGIN WR40574                                     17970011
179800                                                                  17980011
179900     IF ASC-CAN             > (SPACES OR ZEROES)                  17990016
180000        MOVE ASC-CAN TO ACANIDI                                   18000016
180100     END-IF.                                                      18010011
180200                                                                  18020011
180300* CT 11/11/11 - END   WR40574                                     18030011
180400     IF  ASC-PO-NBR NOT = ASC-PO-NBR-OLD                          18040002
180500         MOVE SPACES               TO ASC-TKT-FMT-ID              18050002
180600                                      ASC-TKT-DESC                18060002
180700                                      ASC-AP-RCVR-NBR             18070002
180800                                      ASC-TRBL-DESC               18080002
180900         MOVE ASC-CRE-OPER-UNT-ID  TO DK-OPER-UNT-ID              18090002
181000         MOVE ASC-CRE-FCLTY-ID     TO DK-FCLTY-ID                 18100002
181100         MOVE ASC-PO-NBR           TO DK-PO-NBR                   18110002
181200         MOVE ASC-PO-NBR           TO ASC-PO-NBR-OLD              18120002
181300         MOVE ASC-CRE-OPER-UNT-ID  TO ASC-CRE-OPER-UNT-ID-OLD     18130002
181400         SET ASC-ADD-FROM-MENU     TO TRUE                        18140002
181500         PERFORM 3100-MOVE-DEFAULT-TO-COMMAREA                    18150002
181600     END-IF.                                                      18160002
181700                                                                  18170002
181800* SLH 07/07                                                       18180002
181900     PERFORM 3009-CHECK-TKRPRPM                                   18190002
182000     IF PS-ASNS-TO-WMS-YES                                        18200002
182100        IF ASC-CRE-OPER-UNT-ID-N NOT = DP020-LOCATION-NBR         18210002
182200            MOVE ASC-CRE-OPER-UNT-ID  TO ASC-CRE-OPER-UNT-ID-OLD  18220002
182300            PERFORM 3102-GET-BUS-IND                              18230002
182400            IF XL071-E-BUS-IND = 'Y'                              18240002
182500** AHP - BEGIN - 04/14/08                                         18250002
182600                MOVE ASC-CRE-OPER-UNT-ID-N TO DK-EFC-OPER-UNT-ID  18260002
182700                MOVE DP020-LOCATION-NBR    TO DK-DC-OPER-UNT-ID   18270002
182800                INITIALIZE PV-DB2-COUNT                           18280002
182900                PERFORM 4080-CHECK-FOR-REPURP                     18290002
183000                IF PV-DB2-COUNT > 0                               18300002
183100                    MOVE PC-B         TO ASC-PKGNG-CDE            18310002
183200                                         APKGCDEO                 18320002
183300                    MOVE PC-BULK-PACK TO APKGDSCO                 18330002
183400                    MOVE 'N'          TO ASC-PACK-BY-ST-IND       18340002
183500                                         ABYSTRO                  18350002
183600                ELSE                                              18360002
183700                    PERFORM 3110-PBS-PKGNG-CDE                    18370002
183800                END-IF                                            18380002
183900** AHP -  END - 04/14/08                                          18390002
184000            ELSE                                                  18400002
184100                PERFORM 3110-PBS-PKGNG-CDE                        18410002
184200            END-IF                                                18420002
184300        END-IF                                                    18430002
184400     ELSE                                                         18440002
184500        IF ASC-CRE-OPER-UNT-ID NOT = ASC-CRE-OPER-UNT-ID-OLD      18450002
184600            MOVE ASC-CRE-OPER-UNT-ID  TO ASC-CRE-OPER-UNT-ID-OLD  18460002
184700            PERFORM 3102-GET-BUS-IND                              18470002
184800            IF XL071-E-BUS-IND = 'Y'                              18480002
184900** AHP - BEGIN - 04/14/08                                         18490002
185000                MOVE ASC-CRE-OPER-UNT-ID-N TO DK-EFC-OPER-UNT-ID  18500002
185100                MOVE DP020-LOCATION-NBR    TO DK-DC-OPER-UNT-ID   18510002
185200                INITIALIZE PV-DB2-COUNT                           18520002
185300                PERFORM 4080-CHECK-FOR-REPURP                     18530002
185400                IF PV-DB2-COUNT > 0                               18540002
185500                    MOVE PC-B         TO ASC-PKGNG-CDE            18550002
185600                                         APKGCDEO                 18560002
185700                    MOVE PC-BULK-PACK TO APKGDSCO                 18570002
185800                    MOVE 'N'          TO ASC-PACK-BY-ST-IND       18580002
185900                                         ABYSTRO                  18590002
186000                ELSE                                              18600002
186100                    PERFORM 3110-PBS-PKGNG-CDE                    18610002
186200                END-IF                                            18620002
186300** AHP -  END - 04/14/08                                          18630002
186400            ELSE                                                  18640002
186500                PERFORM 3110-PBS-PKGNG-CDE                        18650002
186600            END-IF                                                18660002
186700        END-IF                                                    18670002
186800     END-IF.                                                      18680002
186900                                                                  18690002
187000* AS OF 1/24/05, PROTECT THE PACK BY STR INDICATOR SO THE USERS   18700002
187100* DO NOT CHANGE IT.                                               18710002
187200*    IF  ASC-PACK-BY-ST-IND = (' ' OR 'Y' OR 'N')                 18720002
187300*        CONTINUE                                                 18730002
187400*    ELSE                                                         18740002
187500*        SET PS-ERROR                                             18750002
187600*            DP020-MSG-FATAL        TO TRUE                       18760002
187700*        MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           18770002
187800*        MOVE DP015-UNP-ALP-BRT-OFF TO ABYSTRA                    18780002
187900*        MOVE DP015-RED             TO ABYSTRC                    18790002
188000*        MOVE DP015-REVERSE         TO ABYSTRH                    18800002
188100*        MOVE -1                    TO ABYSTRL                    18810002
188200*        SET DP030-SET-CURSOR-APPL-1                              18820002
188300*                                   TO TRUE                       18830002
188400*    END-IF.                                                      18840002
188500                                                                  18850002
188600                                                                  18860002
188700*** CHECK IF THE REQUIRED FIELDS ARE FILLED IN                    18870002
188800     IF  ASC-ADD-PENDING AND PS-NO-INQUIRE                        18880002
188900         IF  ASC-CRE-OPER-UNT-ID = (SPACES OR ZEROES)             18890002
189000             SET PS-ERROR                                         18900002
189100                 DP020-MSG-FATAL     TO TRUE                      18910002
189200             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          18920002
189300             MOVE DP015-UNP-ALP-BRT-OFF                           18930002
189400                                     TO AOPERA                    18940002
189500             MOVE DP015-RED          TO AOPERC                    18950002
189600             MOVE DP015-REVERSE      TO AOPERH                    18960002
189700             MOVE -1                 TO AOPERL                    18970002
189800             SET DP030-SET-CURSOR-APPL-1                          18980002
189900                                     TO TRUE                      18990002
190000         END-IF                                                   19000002
190100                                                                  19010002
190200         IF  ASC-SCAC-ID = (SPACES OR ZEROES)                     19020002
190300             SET PS-ERROR                                         19030002
190400                 DP020-MSG-FATAL     TO TRUE                      19040002
190500             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          19050002
190600             MOVE DP015-UNP-ALP-BRT-OFF                           19060002
190700                                     TO ASCACA                    19070002
190800             MOVE DP015-RED          TO ASCACC                    19080002
190900             MOVE DP015-REVERSE      TO ASCACH                    19090002
191000             MOVE -1                 TO ASCACL                    19100002
191100             SET DP030-SET-CURSOR-APPL-1                          19110002
191200                                     TO TRUE                      19120002
191300         END-IF                                                   19130002
191400                                                                  19140002
191500         IF  ASC-VEND-SHIP-DTE = SPACES OR                        19150002
191600             ASC-VEND-SHIP-DTE = '01010001'                       19160002
191700             SET PS-ERROR                                         19170002
191800                 DP020-MSG-FATAL       TO TRUE                    19180002
191900             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        19190002
192000             MOVE DP015-UNP-ALP-BRT-OFF                           19200002
192100                                       TO AVSHMMA                 19210002
192200                                          AVSHDDA                 19220002
192300                                          AVSHYYA                 19230002
192400             MOVE DP015-RED            TO AVSHMMC                 19240002
192500                                          AVSHDDC                 19250002
192600                                          AVSHYYC                 19260002
192700             MOVE DP015-REVERSE        TO AVSHMMH                 19270002
192800                                          AVSHDDH                 19280002
192900                                          AVSHYYH                 19290002
193000             MOVE -1                   TO AVSHMML                 19300002
193100             SET DP030-SET-CURSOR-APPL-1                          19310002
193200                                       TO TRUE                    19320002
193300         END-IF                                                   19330002
193400                                                                  19340002
193500          IF ASC-COMPLETE-PRO-NBR = SPACES                        19350002
193600             IF ASC-COMPLETE-BOL-NBR = SPACES                     19360002
193700                SET PS-ERROR                                      19370002
193800                    DP020-MSG-FATAL       TO TRUE                 19380002
193900                MOVE PC-TSYMSG-00991      TO DP020-MSG-NUMBER     19390002
194000                MOVE DP015-UNP-ALP-BRT-OFF                        19400002
194100                                          TO AFBNBRA              19410002
194200                MOVE DP015-RED            TO AFBNBRC              19420002
194300                MOVE DP015-REVERSE        TO AFBNBRH              19430002
194400                MOVE -1                   TO AFBNBRL              19440002
194500                SET DP030-SET-CURSOR-APPL-1                       19450002
194600                                          TO TRUE                 19460002
194700             END-IF                                               19470002
194800          END-IF                                                  19480002
194900                                                                  19490002
195000          IF  ASC-PO-NBR = (SPACES OR ZEROES)                     19500002
195100              SET PS-ERROR                                        19510002
195200                  DP020-MSG-FATAL        TO TRUE                  19520002
195300              MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER      19530002
195400              MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA               19540002
195500              MOVE DP015-RED             TO APONBRC               19550002
195600              MOVE DP015-REVERSE         TO APONBRH               19560002
195700              MOVE -1                    TO APONBRL               19570002
195800              SET DP030-SET-CURSOR-APPL-1                         19580002
195900                                         TO TRUE                  19590002
196000          END-IF                                                  19600002
196100                                                                  19610002
196200          IF  ASC-EXPTED-CART-CNT = SPACES                        19620002
196300              SET PS-ERROR                                        19630002
196400                  DP020-MSG-FATAL        TO TRUE                  19640002
196500              MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER      19650002
196600              MOVE DP015-UNP-ALP-BRT-OFF TO ACRTCNTA              19660002
196700              MOVE DP015-RED             TO ACRTCNTC              19670002
196800              MOVE DP015-REVERSE         TO ACRTCNTH              19680002
196900              MOVE -1                    TO ACRTCNTL              19690002
197000              SET DP030-SET-CURSOR-APPL-1                         19700002
197100                                         TO TRUE                  19710002
197200          END-IF                                                  19720002
197300                                                                  19730002
197400     END-IF.                                                      19740002
197500*                                                                 19750002
197600     IF ASC-ADD-PENDING                                           19760002
197700         PERFORM 4105-SELECT-MIN-ITMNBR                           19770002
197800                                                                  19780002
197900         INITIALIZE XL001-ITEM-COMMAREA                           19790002
198000                                                                  19800002
198100           IF PS-CALL-API-YES                                     19810002
198200              PERFORM 4200-CALL-CICS-API-ARCH                     19820002
198300              MOVE ASC-TKT-DESC           TO ATKTTYPO             19830002
198400           END-IF                                                 19840002
198500     END-IF                                                       19850002
198600*                                                                 19860002
198700     IF  PS-NO-ERROR                                              19870002
198800         MOVE -1       TO APONBRL                                 19880002
198900         SET DP030-SET-CURSOR-APPL-1                              19890002
199000                           TO TRUE                                19900002
199100     END-IF.                                                      19910002
199200/                                                                 19920002
199300*----------------------------------------------------------------*19930002
199400*  CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   19940002
199500*  TO WMS.                                                        19950002
199600*----------------------------------------------------------------*19960002
199700 3009-CHECK-TKRPRPM.                                              19970002
199800                                                                  19980002
199900     MOVE ASC-CRE-OPER-UNT-ID-N TO PV-COPER-UNT-ID.               19990002
200000                                                                  20000002
200100     EXEC SQL                                                     20010002
200200          SELECT   FUNC_TXT                                       20020002
200300            INTO  :KRPRPM-FUNC-TXT                                20030002
200400            FROM                                                  20040002
200500                  TKRPRPM A                                       20050002
200600            WHERE                                                 20060002
200700                  LOC_ID            = :PV-COPER-UNT-ID            20070002
200800              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    20080002
200900              AND FUNC_PRC_STAT_CDE = 'AC'                        20090002
201000              AND INTFC_SYS_CDE     = 'KHL'                       20100002
201100              AND FUNC_TXT          = 'Y'                         20110002
201200              AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP           20120002
201300     END-EXEC.                                                    20130002
201400                                                                  20140002
201500     EVALUATE TRUE                                                20150002
201600         WHEN SQLCODE = ZERO                                      20160002
201700             SET PS-ASNS-TO-WMS-YES    TO TRUE                    20170002
201800         WHEN SQLCODE = +100                                      20180002
201900             SET PS-ASNS-TO-WMS-NO     TO TRUE                    20190002
202000         WHEN SQLWARN0 NOT = SPACES                               20200002
202100         WHEN SQLCODE  NOT = ZERO                                 20210002
202200             MOVE '3009-CHECK-TKRPRPM'                            20220002
202300                                 TO DP013-PARAGRAPH               20230002
202400             MOVE 'SELECT A TKRPRPM ROW   '                       20240002
202500                                 TO DP013-MESSAGE-TEXT(1)         20250002
202600             MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT(2)         20260002
202700             MOVE SQLCA          TO DP013-SQLCA                   20270002
202800             MOVE 'TKRPRPM'      TO DP013-DB2-TABLE-NAME (1)      20280002
202900             SET DP013-DB2-ABEND                                  20290002
203000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20300002
203100             PERFORM DP013-0000-PROCESS-ABEND                     20310002
203200     END-EVALUATE.                                                20320002
203300                                                                  20330002
203400*----------------------------------------------------------------*20340002
203500*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *20350002
203600*  ENTERED ON THE MAP IS VALID.                                  *20360002
203700*----------------------------------------------------------------*20370002
203800                                                                  20380002
203900 3010-VALIDATE-OPER-UNT-ID.                                       20390002
204000                                                                  20400002
204100     INITIALIZE PS-VALID-LOC-SW                                   20410002
204200                XL071-COMMAREA-REC.                               20420002
204300     MOVE PV-TEMP-OPER-UNT         TO XL071-LOCATION-NUMBER.      20430002
204400                                                                  20440002
204500     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  20450002
204600                                        XL071-COMMAREA            20460002
204700                                        XL071-COMMAREA-REC.       20470002
204800                                                                  20480002
204900* * THERE IS LEGITIMATELY NO ROW ON XLT_DC_LOC_ASGMT              20490002
205000* * FOR CORPORATE                                                 20500002
205100     IF XL071-LOCATION-NUMBER = PC-CORPORATE                      20510002
205200       AND XL071-DC-ASGMT-NOT-FND                                 20520002
205300         SET XL071-NO-ERRORS          TO TRUE                     20530002
205400     END-IF.                                                      20540002
205500                                                                  20550002
205600     EVALUATE TRUE                                                20560002
205700         WHEN XL071-NO-ERRORS                                     20570002
205800           IF XL071-LOC-TYP-CDE = 'DC' OR 'HQ' OR 'DS'            20580002
205900               SET PS-VALID-LOC      TO TRUE                      20590002
206000           ELSE                                                   20600002
206100               SET PS-INVALID-LOC    TO TRUE                      20610002
206200           END-IF                                                 20620002
206300         WHEN XL071-LOC-NOT-FOUND                                 20630002
206400               SET PS-INVALID-LOC    TO TRUE                      20640002
206500         WHEN XL071-DC-ASGMT-NOT-FND                              20650002
206600               SET DP030-OVERRIDE-GO                              20660002
206700                                 TO TRUE                          20670002
206800               MOVE PC-TSYMSG-03407                               20680002
206900                                 TO DP020-MSG-NUMBER              20690002
207000               SET PS-ERROR                                       20700002
207100                   DP020-MSG-WARNING                              20710002
207200                   DP020-NEXT-ACT-APPL-ERROR                      20720002
207300                                 TO TRUE                          20730002
207400               SET DP030-SET-CURSOR-APPL-1 TO TRUE                20740002
207500         WHEN XL071-BAD-DB2-RETURN                                20750002
207600               SET DP030-OVERRIDE-GO                              20760002
207700                                 TO TRUE                          20770002
207800               MOVE PC-TSYMSG-00984                               20780002
207900                                 TO DP020-MSG-NUMBER              20790002
208000               SET PS-ERROR                                       20800002
208100                   DP020-MSG-WARNING                              20810002
208200                   DP020-NEXT-ACT-APPL-ERROR                      20820002
208300                                 TO TRUE                          20830002
208400               SET DP030-SET-CURSOR-APPL-1 TO TRUE                20840002
208500         WHEN OTHER                                               20850002
208600              SET PS-INVALID-LOC TO TRUE                          20860002
208700              INITIALIZE DP013-MESSAGE-TEXT (1)                   20870002
208800              STRING ' CALL TO XLKUT071 '                         20880002
208900                     ' DC =    ' XL071-LOCATION-NUMBER            20890002
209000                     ' PO =    ' ASC-PO-NBR                       20900002
209100                                              DELIMITED BY SIZE   20910002
209200                                 INTO DP013-MESSAGE-TEXT (1)      20920002
209300                                                                  20930002
209400              MOVE XL071-SQLCODE-N TO XL071-SQLCODE               20940002
209500              INITIALIZE DP013-MESSAGE-TEXT (2)                   20950002
209600              STRING ' XL071 RC = ' XL071-RETURN-CODE             20960002
209700                     ' SQLCODE  = ' XL071-SQLCODE                 20970002
209800                                              DELIMITED BY SIZE   20980002
209900                                 INTO DP013-MESSAGE-TEXT (2)      20990002
210000                                                                  21000002
210100               MOVE '3010-VALIDATE-OPER-UNT-ID'                   21010002
210200                                  TO DP013-PARAGRAPH              21020002
210300               MOVE XL071-SQLCA   TO DP013-SQLCA                  21030002
210400               MOVE 'XLT_DC_LOC_ASGMT'                            21040002
210500                     TO DP013-DB2-TABLE-NAME (1)                  21050002
210600               SET DP013-DB2-ABEND                                21060002
210700                   DP013-XCTL-DISPLAY-RESTART                     21070002
210800                                  TO TRUE                         21080002
210900               PERFORM DP013-0000-PROCESS-ABEND                   21090002
211000     END-EVALUATE.                                                21100002
211100                                                                  21110002
211200                                                                  21120002
211300/                                                                 21130002
211400*----------------------------------------------------------------*21140002
211500*  VALIDATE THE VENDOR SHIP DATE ENTERED                         *21150002
211600*----------------------------------------------------------------*21160002
211700 3030-VALIDATE-VEND-SHIP-DTE.                                     21170002
211800                                                                  21180002
211900     MOVE ASC-VEND-SHIP-MM       TO PV-INPUT-DATE-MM              21190002
212000                                    PV-VALID-DATE-MM.             21200002
212100     MOVE ASC-VEND-SHIP-DD       TO PV-INPUT-DATE-DD              21210002
212200                                    PV-VALID-DATE-DD.             21220002
212300                                                                  21230002
212400     MOVE ASC-VEND-SHIP-CCYY     TO PV-INPUT-DATE-CCYY            21240002
212500                                    PV-VALID-DATE-CCYY.           21250002
212600                                                                  21260002
212700     PERFORM 3032-VALIDATE-DATE.                                  21270002
212800                                                                  21280002
212900     IF PS-VALID-DATE                                             21290002
213000         MOVE PV-INPUT-DATE-MM   TO                               21300002
213100                                    ASC-VEND-SHIP-MM              21310002
213200         MOVE PV-INPUT-DATE-DD   TO                               21320002
213300                                    ASC-VEND-SHIP-DD              21330002
213400         MOVE PV-INPUT-DATE-CCYY TO ASC-VEND-SHIP-CCYY            21340002
213500         PERFORM 3031-CALL-DATE-RTN                               21350002
213600                                                                  21360002
213700         IF DPG54-DATE-VALID                                      21370002
213800             SET PS-VALID-VND-DTE  TO TRUE                        21380002
213900             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-HOLD-DATE      21390002
214000******* CHECK IF VENDOR DATE IS WITHIN THE REQUIRED RANGE         21400002
214100*******    VENDOR DATE NOT > CURRENT DATE  OR                     21410002
214200*******      < CURRENT-DATE - PC-VALID-VND-DT-RANGE  DAYS         21420002
214300******* WHEN DP020-FK-LOCAL-FUNC-01 (ADD) IS PRESSED OR           21430002
214400******* WHEN DP020-FK-CONFIRM (CONFIRM) IS PRESSED (IN CASE THE   21440002
214500*******      USER CHANGED THE DATE THEY FIRST ENTERED)            21450002
214600             IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR         21460002
214700                   DP020-FK-CONFIRM (DP020-SRC-AID)               21470002
214800                 SET PS-VALID-VND-DT-RANGE TO TRUE                21480002
214900                 PERFORM 3050-CHK-VND-DATE-RANGE                  21490002
215000             END-IF                                               21500002
215100         ELSE                                                     21510002
215200             SET PS-INVALID-VND-DTE TO TRUE                       21520002
215300         END-IF                                                   21530002
215400     ELSE                                                         21540002
215500         SET PS-INVALID-VND-DTE    TO TRUE                        21550002
215600     END-IF.                                                      21560002
215700                                                                  21570002
215800 EJECT                                                            21580002
215900                                                                  21590002
216000*----------------------------------------------------------------*21600002
216100*    SETS ALL THE PROPER INDICATORS FOR A DATE VALIDATION        *21610002
216200*----------------------------------------------------------------*21620002
216300 3031-CALL-DATE-RTN.                                              21630002
216400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              21640002
216500     SET DPG51-ACTUAL-CALENDAR-ONLY                               21650002
216600         DPG51-DO-NOT-INCR-DECR-DATE                              21660002
216700         DPG52-LK-DTE-GREG-CC    TO TRUE.                         21670002
216800                                                                  21680002
216900     MOVE PV-INPUT-DATE          TO DPG52-LK-DATE-INPUT.          21690002
217000                                                                  21700002
217100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            21710002
217200                       USING DPG51 DPG52                          21720002
217300                             DPG53 DPG54                          21730002
217400                             DPG55 DPG56.                         21740002
217500                                                                  21750002
217600 EJECT                                                            21760002
217700                                                                  21770002
217800 3032-VALIDATE-DATE.                                              21780002
217900*----------------------------------------------------------------*21790002
218000*    TAKES THE DATE FIELDS ENTERED AND ADDS LEADING ZEROS IF     *21800002
218100*    NEEDED.  IF THE FIELDS ENTERED ON THE SCREEN ARE NOT NUMERIC*21810002
218200*    A SWITCH IS SET.                                            *21820002
218300*----------------------------------------------------------------*21830002
218400                                                                  21840002
218500     SET PS-VALID-DATE           TO TRUE.                         21850002
218600                                                                  21860002
218700     MOVE PV-VALID-DATE-MM       TO DP010I-UNEDITED-FIELD.        21870002
218800     MOVE +2                     TO DP010I-MAXIMUM-DIGITS.        21880002
218900     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      21890002
219000                                                                  21900002
219100     SET DP010I-NEGATIVE-NOT-ALLOWED                              21910002
219200                                 TO TRUE.                         21920002
219300                                                                  21930002
219500     CALL DP010I-NUMERIC-EDIT-ROUTINE                             21950040
219510          USING DP010I-NUMERIC-EDIT-AREA.                         21951040
219520                                                                  21952037
219600     IF DP010I-ERROR-DETECTED                                     21960002
219700         SET PS-INVALID-DATE     TO TRUE                          21970002
219800     ELSE                                                         21980002
219900         MOVE DP010I-NUMERIC-FIELD                                21990002
220000                                 TO PV-INPUT-DATE-MM              22000002
220100     END-IF.                                                      22010002
220200                                                                  22020002
220300     MOVE PV-VALID-DATE-DD       TO DP010I-UNEDITED-FIELD.        22030002
220400     MOVE +2                     TO DP010I-MAXIMUM-DIGITS.        22040002
220500     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      22050002
220600                                                                  22060002
220700     SET DP010I-NEGATIVE-NOT-ALLOWED                              22070002
220800                                 TO TRUE.                         22080002
220900                                                                  22090002
221010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             22101040
221020          USING DP010I-NUMERIC-EDIT-AREA.                         22102040
221100                                                                  22110002
221200     IF DP010I-ERROR-DETECTED                                     22120002
221300         SET PS-INVALID-DATE     TO TRUE                          22130002
221400     ELSE                                                         22140002
221500         MOVE DP010I-NUMERIC-FIELD                                22150002
221600                                 TO PV-INPUT-DATE-DD              22160002
221700     END-IF.                                                      22170002
221800                                                                  22180002
221900     MOVE PV-VALID-DATE-CCYY     TO DP010I-UNEDITED-FIELD.        22190002
222000     MOVE +4                     TO DP010I-MAXIMUM-DIGITS.        22200002
222100     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      22210002
222200                                                                  22220002
222300     SET DP010I-NEGATIVE-NOT-ALLOWED                              22230002
222400                                 TO TRUE.                         22240002
222500                                                                  22250002
222700     CALL DP010I-NUMERIC-EDIT-ROUTINE                             22270040
222710          USING DP010I-NUMERIC-EDIT-AREA.                         22271040
222720                                                                  22272037
222800     IF DP010I-ERROR-DETECTED                                     22280002
222900         SET PS-INVALID-DATE     TO TRUE                          22290002
223000     ELSE                                                         22300002
223100         MOVE DP010I-NUMERIC-FIELD                                22310002
223200                                 TO PV-INPUT-DATE-CCYY            22320002
223300     END-IF.                                                      22330002
223400                                                                  22340002
223500*----------------------------------------------------------------*22350002
223600*  VALIDATES THE CARRIER SHIP DATE ENTERED.                      *22360002
223700*----------------------------------------------------------------*22370002
223800 3035-VALIDATE-CARR-SHIP-DTE.                                     22380002
223900                                                                  22390002
224000     MOVE ASC-CARR-SHIP-MM       TO PV-INPUT-DATE-MM              22400002
224100                                    PV-VALID-DATE-MM.             22410002
224200     MOVE ASC-CARR-SHIP-DD       TO PV-INPUT-DATE-DD              22420002
224300                                    PV-VALID-DATE-DD.             22430002
224400                                                                  22440002
224500     MOVE ASC-CARR-SHIP-CCYY     TO PV-INPUT-DATE-CCYY            22450002
224600                                    PV-VALID-DATE-CCYY.           22460002
224700                                                                  22470002
224800     PERFORM 3032-VALIDATE-DATE.                                  22480002
224900                                                                  22490002
225000     IF PS-VALID-DATE                                             22500002
225100         MOVE PV-INPUT-DATE-MM   TO                               22510002
225200                                    ASC-CARR-SHIP-MM              22520002
225300         MOVE PV-INPUT-DATE-DD   TO                               22530002
225400                                    ASC-CARR-SHIP-DD              22540002
225500         MOVE PV-INPUT-DATE-CCYY TO ASC-CARR-SHIP-CCYY            22550002
225600         PERFORM 3031-CALL-DATE-RTN                               22560002
225700                                                                  22570002
225800         IF DPG54-DATE-VALID                                      22580002
225900             SET PS-VALID-CARR-DTE TO TRUE                        22590002
226000         ELSE                                                     22600002
226100             SET PS-INVALID-CARR-DTE                              22610002
226200                                   TO TRUE                        22620002
226300         END-IF                                                   22630002
226400     ELSE                                                         22640002
226500         SET PS-INVALID-CARR-DTE   TO TRUE                        22650002
226600     END-IF.                                                      22660002
226700                                                                  22670002
226800*----------------------------------------------------------------*22680002
226900*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *22690002
227000*  ENTERED IS VALID.                                             *22700002
227100*----------------------------------------------------------------*22710002
227200                                                                  22720002
227300 3040-VALIDATE-SCAC-CDE.                                          22730002
227400                                                                  22740002
227500     PERFORM                                                      22750002
227600         WITH TEST AFTER                                          22760002
227700         VARYING PV-RETRY-COUNTER                                 22770002
227800         FROM 1 BY 1                                              22780002
227900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22790002
228000                   OR (SQLCODE = +0)                              22800002
228100                   OR (SQLCODE = +100)                            22810002
228200                   OR (SQLCODE = -811))                           22820002
228300                                                                  22830002
228400         EXEC SQL                                                 22840002
228500            SELECT  SCAC_CDE                                      22850002
228600              INTO :EXTENT-SCAC-CDE                               22860002
228700              FROM  TEXTENT                                       22870002
228800             WHERE  SCAC_CDE = :DK-SCAC-ID                        22880002
228900             WITH UR                                              22890031
229000         END-EXEC                                                 22900002
229100                                                                  22910002
229200         EVALUATE TRUE                                            22920002
229300             WHEN SQLCODE = +0                                    22930002
229400             WHEN SQLCODE = +100                                  22940002
229500             WHEN SQLCODE = -811                                  22950002
229600             WHEN SQLCODE = -904                                  22960002
229700             WHEN SQLCODE = -913                                  22970002
229800                 CONTINUE                                         22980002
229900                                                                  22990002
230000             WHEN SQLWARN0 NOT = SPACES                           23000002
230100             WHEN SQLCODE < +0                                    23010002
230200             WHEN SQLCODE > +0                                    23020002
230300                 MOVE '3040-VALIDATE-SCAC-CDE'                    23030002
230400                                 TO DP013-PARAGRAPH               23040002
230500                 MOVE 'SELECT SCAC CODE'                          23050002
230600                                 TO DP013-MESSAGE-TEXT (1)        23060002
230700                 MOVE SQLCA      TO DP013-SQLCA                   23070002
230800                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      23080002
230900                 SET DP013-DB2-ABEND                              23090002
231000                                 TO TRUE                          23100002
231100                 SET DP013-XCTL-DISPLAY-RESTART                   23110002
231200                                 TO TRUE                          23120002
231300                 PERFORM DP013-0000-PROCESS-ABEND                 23130002
231400         END-EVALUATE                                             23140002
231500     END-PERFORM.                                                 23150002
231600                                                                  23160002
231700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23170002
231800             AND (SQLCODE NOT = +0)                               23180002
231900         MOVE '3040-VALIDATE-SCAC-CDE'                            23190002
232000                                 TO DP013-PARAGRAPH               23200002
232100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     23210002
232200                                 TO DP013-MESSAGE-TEXT (1)        23220002
232300         MOVE 'SCAC CODE       ' TO DP013-MESSAGE-TEXT (2)        23230002
232400         MOVE SQLCA              TO DP013-SQLCA                   23240002
232500         MOVE 'TEXTENT'          TO DP013-DB2-TABLE-NAME (1)      23250002
232600         SET DP013-DB2-ABEND     TO TRUE                          23260002
232700         SET DP013-XCTL-DISPLAY-RESTART                           23270002
232800                                 TO TRUE                          23280002
232900         PERFORM DP013-0000-PROCESS-ABEND                         23290002
233000     END-IF.                                                      23300002
233100                                                                  23310002
233200     EVALUATE TRUE                                                23320002
233300         WHEN SQLCODE = ZERO                                      23330002
233400              SET PS-VALID-SCAC  TO TRUE                          23340002
233500         WHEN SQLCODE = +100                                      23350002
233600              SET PS-INVALID-SCAC                                 23360002
233700                                 TO TRUE                          23370002
233800     END-EVALUATE.                                                23380002
233900                                                                  23390002
234000 3050-CHK-VND-DATE-RANGE.                                         23400002
234100     EXEC SQL                                                     23410002
234200         SET :PV-DB2-CURRENT-DATE = CURRENT_DATE                  23420002
234300     END-EXEC.                                                    23430002
234400                                                                  23440002
234500****** GET CURRENT DATE MINUS PC-VALID-VND-DT-RANGE               23450002
234600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              23460002
234700     SET DPG51-ACTUAL-CALENDAR-ONLY                               23470002
234800         DPG51-DECREMENT-DATE                                     23480002
234900         DPG52-LK-DTE-ISO-FMT      TO TRUE.                       23490002
235000                                                                  23500002
235100     MOVE PC-VALID-VND-DT-RANGE TO DPG51-INCR-DECR-DAYS-9.        23510002
235200     MOVE PV-DB2-CURRENT-DATE TO DPG52-LK-DATE-INPUT.             23520002
235300                                                                  23530002
235400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            23540002
235500             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.           23550002
235600                                                                  23560002
235700     IF DPG54-INCR-DECR-VALID                                     23570002
235800         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-CURRENT-DATE-M7DD  23580002
235900         MOVE ASC-VEND-SHIP-MM   TO PV-VEND-SHIP-MM               23590002
236000         MOVE ASC-VEND-SHIP-DD   TO PV-VEND-SHIP-DD               23600002
236100         MOVE ASC-VEND-SHIP-CCYY TO PV-VEND-SHIP-CCYY             23610002
236200***** CHECK IF VEND SHIP DATE WITHIN THE RANGE                    23620002
236300         IF PV-VEND-SHIP-DATE GREATER THAN PV-DB2-CURRENT-DATE OR 23630002
236400            PV-VEND-SHIP-DATE LESS THAN PV-DB2-CURRENT-DATE-M7DD  23640002
236500             SET PS-INVALID-VND-DT-RANGE TO TRUE                  23650002
236600         ELSE                                                     23660002
236700             SET PS-VALID-VND-DT-RANGE TO TRUE                    23670002
236800         END-IF                                                   23680002
236900     ELSE                                                         23690002
237000         SET PS-INVALID-VND-DT-RANGE TO TRUE                      23700002
237100     END-IF.                                                      23710002
237200                                                                  23720002
237300     IF PS-VALID-VND-DT-RANGE                                     23730002
237400         IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                23740002
237500            SET ASC-VND-DT-F2-NOT-REQUIRED TO TRUE                23750002
237600         ELSE                                                     23760002
237700             CONTINUE                                             23770002
237800         END-IF                                                   23780002
237900     ELSE                                                         23790002
238000         SET ASC-VND-DT-F2-REQUIRED                               23800002
238100             PS-ERROR                                             23810002
238200             DP020-MSG-WARNING TO TRUE                            23820002
238300         MOVE DP015-YELLOW  TO AVSHMMC                            23830002
238400                               AVSHDDC                            23840002
238500                               AVSHYYC                            23850002
238600         MOVE DP015-REVERSE TO AVSHMMH                            23860002
238700                               AVSHDDH                            23870002
238800                               AVSHYYH                            23880002
238900         MOVE -1            TO AVSHMML                            23890002
239000         MOVE PC-TSYMSG-01838 TO DP020-MSG-NUMBER                 23900002
239100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      23910002
239200     END-IF.                                                      23920002
239300                                                                  23930002
239400 3090-VALIDATE-OPER-SET-ID.                                       23940002
239500                                                                  23950002
239600     PERFORM                                                      23960002
239700         WITH TEST AFTER                                          23970002
239800         VARYING PV-RETRY-COUNTER                                 23980002
239900         FROM 1 BY 1                                              23990002
240000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24000002
240100                   OR (SQLCODE = +0)                              24010002
240200                   OR (SQLCODE = +100))                           24020002
240300                                                                  24030002
240400         EXEC SQL                                                 24040002
240500            SELECT  OPER_SET_DESC                                 24050002
240600              INTO :OPRSET-OPER-SET-DESC                          24060002
240700              FROM  TOPRSET                                       24070002
240800             WHERE  OPER_SET_ID    = :DK-OPER-SET-ID              24080002
240900               AND  VER_STATUS_CDE = 'A'                          24090002
241000               AND  OPER_UNT_ID    = :DK-OPER-UNT-ID              24100002
241100               AND  FCLTY_ID       = :DK-FCLTY-ID                 24110002
241200         END-EXEC                                                 24120002
241300                                                                  24130002
241400         EVALUATE TRUE                                            24140002
241500             WHEN SQLCODE = +0                                    24150002
241600             WHEN SQLCODE = +100                                  24160002
241700             WHEN SQLCODE = -904                                  24170002
241800             WHEN SQLCODE = -913                                  24180002
241900                 CONTINUE                                         24190002
242000                                                                  24200002
242100             WHEN SQLWARN0 NOT = SPACES                           24210002
242200             WHEN SQLCODE < +0                                    24220002
242300             WHEN SQLCODE > +0                                    24230002
242400                 MOVE '3090-VALIDATE-OPER-SET-ID'                 24240002
242500                                 TO DP013-PARAGRAPH               24250002
242600                 MOVE 'SELECT OPERATION SET ID'                   24260002
242700                                 TO DP013-MESSAGE-TEXT (1)        24270002
242800                 MOVE SQLCA      TO DP013-SQLCA                   24280002
242900                 MOVE 'TOPRSET'  TO DP013-DB2-TABLE-NAME (1)      24290002
243000                 SET DP013-DB2-ABEND                              24300002
243100                                 TO TRUE                          24310002
243200                 SET DP013-XCTL-DISPLAY-RESTART                   24320002
243300                                 TO TRUE                          24330002
243400                 PERFORM DP013-0000-PROCESS-ABEND                 24340002
243500         END-EVALUATE                                             24350002
243600     END-PERFORM.                                                 24360002
243700                                                                  24370002
243800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24380002
243900             AND (SQLCODE NOT = +0)                               24390002
244000         MOVE '3090-VALIDATE-OPER-SET-ID'                         24400002
244100                                 TO DP013-PARAGRAPH               24410002
244200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     24420002
244300                                 TO DP013-MESSAGE-TEXT (1)        24430002
244400         MOVE 'ON TOPRSET    '   TO DP013-MESSAGE-TEXT (2)        24440002
244500         MOVE SQLCA              TO DP013-SQLCA                   24450002
244600         MOVE 'TOPRSET'          TO DP013-DB2-TABLE-NAME (1)      24460002
244700         SET DP013-DB2-ABEND     TO TRUE                          24470002
244800         SET DP013-XCTL-DISPLAY-RESTART                           24480002
244900                                 TO TRUE                          24490002
245000         PERFORM DP013-0000-PROCESS-ABEND                         24500002
245100     END-IF.                                                      24510002
245200                                                                  24520002
245300/                                                                 24530002
245400*----------------------------------------------------------------*24540002
245500* MOVE DEFAULT VALUES TO THE COMMAREA                            *24550002
245600*----------------------------------------------------------------*24560002
245700 3100-MOVE-DEFAULT-TO-COMMAREA.                                   24570002
245800                                                                  24580002
245900** DMH - BEGIN - 07/25/08                                         24590002
246000     MOVE  ASC-CURR-OPER-UNT-ID                                   24600002
246100       TO  DK-CURR-OPER-UNT-ID.                                   24610002
246200** DMH - BEGIN - 07/25/08                                         24620002
246300                                                                  24630002
246400     IF  ASC-PO-NBR = (SPACES OR ZEROES)                          24640002
246500         CONTINUE                                                 24650002
246600     ELSE                                                         24660002
246700        IF  ASC-OPER-SET-ID = (SPACES OR ZEROES)                  24670002
246800            PERFORM 3120-GET-OPER-SET-INFO                        24680002
246900            IF  SQLCODE = +0                                      24690002
247000                MOVE DCFAAS-OPER-SET-ID   TO ASC-OPER-SET-ID-N    24700002
247100                                             DK-OPER-SET-ID       24710002
247200            ELSE                                                  24720002
247300                PERFORM 3130-GET-OPER-SET-ID                      24730002
247400                   MOVE COCNTL-DFLT-OPER-SET-ID                   24740002
247500                                          TO ASC-OPER-SET-ID-N    24750002
247600                                             DK-OPER-SET-ID       24760002
247700                PERFORM 3090-VALIDATE-OPER-SET-ID                 24770002
247800            END-IF                                                24780002
247900        ELSE                                                      24790002
248000            MOVE ASC-OPER-SET-ID TO DK-OPER-SET-ID                24800002
248100        END-IF                                                    24810002
248200     END-IF.                                                      24820002
248300                                                                  24830002
248400* SET PRE TICKET INDICATOR                                        24840002
248500     INITIALIZE PV-DB2-COUNT.                                     24850002
248600     MOVE 4                      TO DK-AGRMT-TYP-ID.              24860002
248700     MOVE 1                      TO DK-TYP-CDE.                   24870002
248800                                                                  24880002
248900     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          24890002
249000                                                                  24900002
249100     IF  PV-DB2-COUNT > +0                                        24910002
249200         MOVE 'Y'                TO ASC-PRE-TICKET-IND            24920002
249300                                    APRETKI                       24930002
249400                                    APRETKO                       24940002
249500     ELSE                                                         24950002
249600         MOVE 'N'                TO ASC-PRE-TICKET-IND            24960002
249700                                    APRETKI                       24970002
249800                                    APRETKO                       24980002
249900     END-IF.                                                      24990002
250000                                                                  25000002
250100* SET GARMENT ON HANGER (GOH) INDICATOR                           25010002
250200     INITIALIZE PV-DB2-COUNT.                                     25020002
250300     MOVE 4                      TO DK-AGRMT-TYP-ID.              25030002
250400     MOVE 2                      TO DK-TYP-CDE.                   25040002
250500                                                                  25050002
250600     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          25060002
250700                                                                  25070002
250800     IF  PV-DB2-COUNT > +0                                        25080002
250900         MOVE 'Y'                TO ASC-HANGER-IND                25090002
251000                                    AHANGERI                      25100002
251100                                    AHANGERO                      25110002
251200     ELSE                                                         25120002
251300         MOVE 'N'                TO ASC-HANGER-IND                25130002
251400                                    AHANGERI                      25140002
251500                                    AHANGERO                      25150002
251600     END-IF.                                                      25160002
251700                                                                  25170002
251800*    MOVE 'Y'     TO ASC-PKSL-IND.                                25180002
251900                                                                  25190002
252000     IF ASC-CRE-OPER-UNT-ID-N NOT = DP020-LOCATION-NBR            25200002
252100        PERFORM 3102-GET-BUS-IND                                  25210002
252200        IF XL071-E-BUS-IND = 'Y'                                  25220002
252300           MOVE PC-B               TO ASC-PKGNG-CDE               25230002
252400                                      APKGCDEO                    25240002
252500           MOVE PC-BULK-PACK       TO APKGDSCO                    25250002
252600           MOVE 'N'                TO ASC-PACK-BY-ST-IND          25260002
252700                                      ABYSTRO                     25270002
252800        ELSE                                                      25280002
252900           PERFORM 3110-PBS-PKGNG-CDE                             25290002
253000        END-IF                                                    25300002
253100     ELSE                                                         25310002
253200        PERFORM 3110-PBS-PKGNG-CDE                                25320002
253300     END-IF.                                                      25330002
253400                                                                  25340002
253500     PERFORM 4090-GET-AD-DATE.                                    25350002
253600     MOVE ASC-AD-DTE             TO AADDTEO.                      25360002
253700                                                                  25370002
253800 3102-GET-BUS-IND.                                                25380002
253900     INITIALIZE XL071-COMMAREA-REC.                               25390002
254000     MOVE DK-OPER-UNT-ID            TO XL071-LOCATION-NUMBER.     25400002
254100                                                                  25410002
254200     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  25420002
254300                                        XL071-COMMAREA            25430002
254400                                        XL071-COMMAREA-REC.       25440002
254500     EVALUATE TRUE                                                25450002
254600         WHEN XL071-NO-ERRORS                                     25460002
254700         WHEN XL071-LOC-NOT-FOUND                                 25470002
254800         WHEN XL071-DC-ASGMT-NOT-FND                              25480002
254900             CONTINUE                                             25490002
255000         WHEN OTHER                                               25500002
255100              MOVE '3102-GET-BUS-IND'                             25510002
255200                                     TO DP013-PARAGRAPH           25520002
255300              MOVE 'UNSUCCESSFUL SELECT ON XLT_LOC TABLE'         25530002
255400                                     TO DP013-MESSAGE-TEXT (1)    25540002
255500              MOVE XL071-SQLCA       TO DP013-SQLCA               25550002
255600              MOVE 'XLT_LOC '        TO DP013-DB2-TABLE-NAME (1)  25560002
255700              SET DP013-DB2-ABEND                                 25570002
255800                         DP013-XCTL-DISPLAY-RESTART               25580002
255900                                     TO TRUE                      25590002
256000              PERFORM DP013-0000-PROCESS-ABEND                    25600002
256100     END-EVALUATE.                                                25610002
256200                                                                  25620002
256300 3110-PBS-PKGNG-CDE.                                              25630002
256400* SET PACK BY STORE INDICATOR                                     25640002
256500     INITIALIZE PV-DB2-COUNT.                                     25650002
256600     MOVE 4                      TO DK-AGRMT-TYP-ID.              25660002
256700     MOVE 4                      TO DK-TYP-CDE.                   25670002
256800                                                                  25680002
256900     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          25690002
257000                                                                  25700002
257100     IF  PV-DB2-COUNT > +0                                        25710002
257200         MOVE 'Y'                TO ASC-PACK-BY-ST-IND            25720002
257300                                    ABYSTRI                       25730002
257400                                    ABYSTRO                       25740002
257500     ELSE                                                         25750002
257600         MOVE 'N'                TO ASC-PACK-BY-ST-IND            25760002
257700                                    ABYSTRI                       25770002
257800                                    ABYSTRO                       25780002
257900     END-IF.                                                      25790002
258000                                                                  25800002
258100     IF ASC-PACK-BY-ST-IND NOT = 'Y'                              25810002
258200         PERFORM 3160-PKGNG-CDE-FROM-PO                           25820002
258300                                                                  25830002
258400         EVALUATE ASC-PKGNG-CDE                                   25840002
258500             WHEN PC-I                                            25850002
258600                 MOVE PC-INNER-PPK     TO APKGDSCO                25860002
258700             WHEN PC-M                                            25870002
258800                 MOVE PC-MULTI-SKU     TO APKGDSCO                25880002
258900             WHEN PC-S                                            25890002
259000                 MOVE PC-SINGLE-SKU    TO APKGDSCO                25900002
259100             WHEN PC-C                                            25910002
259200                 MOVE PC-CASEPACK      TO APKGDSCO                25920002
259300             WHEN PC-B                                            25930002
259400                 MOVE PC-BULK-PACK     TO APKGDSCO                25940002
259500*            WHEN SPACES                                          25950002
259600*                MOVE PC-NOT-FOUND     TO APKGDSCO                25960002
259700             WHEN OTHER                                           25970002
259800                 MOVE SPACES           TO APKGDSCO                25980002
259900         END-EVALUATE                                             25990002
260000                                                                  26000002
260100         MOVE ASC-PKGNG-CDE            TO APKGCDEO                26010002
260200     ELSE                                                         26020002
260300         MOVE SPACES                   TO APKGDSCO                26030002
260400                                          APKGCDEO                26040002
260500                                          ASC-PKGNG-CDE           26050002
260600     END-IF.                                                      26060002
260700/                                                                 26070002
260800 3120-GET-OPER-SET-INFO.                                          26080002
260900*  THIS IS THE OPER SET DEFAULT THAT IS ASSIGNED IN CNUDCLOC      26090002
261000*  BY OPER-UNIT, FACILTY, DEPT, AND CLASS.                        26100002
261100                                                                  26110002
261200     PERFORM 4105-SELECT-MIN-ITMNBR                               26120002
261300     INITIALIZE XL001-ITEM-COMMAREA                               26130002
261400     IF PS-CALL-API-YES                                           26140002
261500        PERFORM 4200-CALL-CICS-API-ARCH                           26150002
261600     END-IF                                                       26160002
261700                                                                  26170002
261800     IF XL001-SUCCESSFUL                                          26180002
261900        PERFORM                                                   26190002
262000            WITH TEST AFTER                                       26200002
262100            VARYING PV-RETRY-COUNTER                              26210002
262200            FROM 1 BY 1                                           26220002
262300            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            26230002
262400                OR (SQLCODE = +0)                                 26240002
262500                OR (SQLCODE = +100))                              26250002
262600                                                                  26260002
262700            EXEC SQL                                              26270002
262800                 SELECT A.OPER_SET_ID                             26280002
262900                       ,A.CL_NBR                                  26290002
263000                       ,B.OPER_SET_DESC                           26300002
263100                   INTO :DCFAAS-OPER-SET-ID                       26310002
263200                       ,:DCFAAS-CL-NBR                            26320002
263300                       ,:OPRSET-OPER-SET-DESC                     26330002
263400                   FROM TDCFAAS A                                 26340002
263500                       ,TOPRSET B                                 26350002
263600*** DMH 7/25/08   WHERE A.OPER_UNT_ID       = :DK-OPER-UNT-ID     26360002
263700                  WHERE A.OPER_UNT_ID    = :DK-CURR-OPER-UNT-ID   26370002
263800                    AND A.FCLTY_ID          = :DK-FCLTY-ID        26380002
263900                    AND A.DEPT_NBR          = :DK-DEPT-NBR        26390002
264000                    AND A.FCLTY_LOC_TYP_CDE = 'PA'                26400002
264100                    AND A.RANK_NBR          = 1                   26410002
264200                    AND B.VER_STATUS_CDE    = 'A'                 26420002
264300                    AND A.CL_NBR      = :XL001-SUB-CL-NBR-2CH     26430002
264400                    AND A.OPER_SET_ID = B.OPER_SET_ID             26440002
264500                    AND A.OPER_UNT_ID       = B.OPER_UNT_ID       26450002
264600            END-EXEC                                              26460002
264700                                                                  26470002
264800            EVALUATE TRUE                                         26480002
264900                WHEN SQLCODE = +0                                 26490002
265000                WHEN SQLCODE = +100                               26500002
265100                WHEN SQLCODE = -904                               26510002
265200                WHEN SQLCODE = -913                               26520002
265300                     CONTINUE                                     26530002
265400                                                                  26540002
265500                WHEN SQLWARN0 NOT = SPACES                        26550002
265600                WHEN SQLCODE < +0                                 26560002
265700                WHEN SQLCODE > +0                                 26570002
265800                     MOVE '3120-GET-OPER-SET-INFO'                26580002
265900                                     TO DP013-PARAGRAPH           26590002
266000                     MOVE 'UNSUCCESSFUL SELECT ON TDCFAAS TABLE'  26600002
266100                                     TO DP013-MESSAGE-TEXT (1)    26610002
266200                     MOVE SQLCA      TO DP013-SQLCA               26620002
266300                     MOVE 'TDCFAAS ' TO DP013-DB2-TABLE-NAME (1)  26630002
266400                     MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)  26640002
266500                     SET DP013-DB2-ABEND                          26650002
266600                         DP013-XCTL-DISPLAY-RESTART               26660002
266700                                     TO TRUE                      26670002
266800                     PERFORM DP013-0000-PROCESS-ABEND             26680002
266900            END-EVALUATE                                          26690002
267000        END-PERFORM                                               26700002
267100                                                                  26710002
267200        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     26720002
267300                AND (SQLCODE NOT = +0)                            26730002
267400            MOVE '3120-GET-OPER-SET-INFO'  TO DP013-PARAGRAPH     26740002
267500            MOVE                                                  26750002
267600            'MAX RETRIES EXCEEDED ON FACILITY LOC ASSIGNMENTS'    26760002
267700                                     TO DP013-MESSAGE-TEXT (1)    26770002
267800            MOVE SQLCA               TO DP013-SQLCA               26780002
267900            MOVE 'TDCFAAS'           TO DP013-DB2-TABLE-NAME (1)  26790002
268000            MOVE 'TOPRSET'           TO DP013-DB2-TABLE-NAME (2)  26800002
268100            SET DP013-DB2-ABEND                                   26810002
268200                DP013-XCTL-DISPLAY-RESTART                        26820002
268300                                     TO TRUE                      26830002
268400            PERFORM DP013-0000-PROCESS-ABEND                      26840002
268500        END-IF                                                    26850002
268600     END-IF.                                                      26860002
268700                                                                  26870002
268800/                                                                 26880002
268900*----------------------------------------------------------------*26890002
269000*  GET OPER-SET-ID FROM TCOCNTL                                  *26900002
269100*----------------------------------------------------------------*26910002
269200 3130-GET-OPER-SET-ID.                                            26920002
269300                                                                  26930002
269400     EXEC SQL                                                     26940002
269500          SELECT  DFLT_OPER_SET_ID                                26950002
269600            INTO :COCNTL-DFLT-OPER-SET-ID                         26960002
269700            FROM  TCOCNTL                                         26970002
269800*** DMH    WHERE  OPER_UNT_ID    = :DK-OPER-UNT-ID                26980002
269900           WHERE  OPER_UNT_ID    = :DK-CURR-OPER-UNT-ID           26990002
270000             AND  FCLTY_ID       = :DK-FCLTY-ID                   27000002
270100     END-EXEC.                                                    27010002
270200                                                                  27020002
270300     EVALUATE TRUE                                                27030002
270400         WHEN SQLCODE = +0                                        27040002
270500              CONTINUE                                            27050002
270600                                                                  27060002
270700         WHEN SQLCODE = +100                                      27070002
270800              MOVE  ZEROES  TO  COCNTL-DFLT-OPER-SET-ID           27080002
270900                                                                  27090002
271000         WHEN SQLWARN0 NOT = SPACES                               27100002
271100         WHEN SQLCODE < +0                                        27110002
271200         WHEN SQLCODE > +0                                        27120002
271300              MOVE '3130-GET-OPER-SET-ID'                         27130002
271400                                       TO DP013-PARAGRAPH         27140002
271500              MOVE 'SELECT OPERATION SET ID FROM TCOCNTL'         27150002
271600                                       TO DP013-MESSAGE-TEXT(1)   27160002
271700              MOVE SQLCA               TO DP013-SQLCA             27170002
271800              MOVE 'TCOCNTL'           TO DP013-DB2-TABLE-NAME(1) 27180002
271900              SET DP013-DB2-ABEND      TO TRUE                    27190002
272000              SET DP013-XCTL-DISPLAY-RESTART                      27200002
272100                                       TO TRUE                    27210002
272200              PERFORM DP013-0000-PROCESS-ABEND                    27220002
272300     END-EVALUATE.                                                27230002
272400                                                                  27240002
272500                                                                  27250002
272600*----------------------------------------------------------------*27260002
272700*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *27270002
272800*----------------------------------------------------------------*27280002
272900 3140-CHECK-PO-SERVICE-INFO.                                      27290002
273000                                                                  27300002
273100     PERFORM                                                      27310002
273200         WITH TEST AFTER                                          27320002
273300         VARYING PV-RETRY-COUNTER                                 27330002
273400         FROM 1 BY 1                                              27340002
273500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27350002
273600             OR (SQLCODE = +0)                                    27360002
273700             OR (SQLCODE = +100))                                 27370002
273800                                                                  27380002
273900         EXEC SQL                                                 27390002
274000              SELECT COUNT(*)                                     27400002
274100                INTO :PV-DB2-COUNT                                27410002
274200                FROM TPOAGMT                                      27420002
274300               WHERE PO_NBR         = :DK-PO-NBR                  27430002
274400                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            27440002
274500                 AND VER_STATUS_CDE = 'A'                         27450002
274600                 AND TYP_CDE        = :DK-TYP-CDE                 27460002
274700         END-EXEC                                                 27470002
274800                                                                  27480002
274900         EVALUATE TRUE                                            27490002
275000             WHEN SQLCODE = +0                                    27500002
275100             WHEN SQLCODE = +100                                  27510002
275200             WHEN SQLCODE = -904                                  27520002
275300             WHEN SQLCODE = -913                                  27530002
275400                  CONTINUE                                        27540002
275500                                                                  27550002
275600             WHEN SQLWARN0 NOT = SPACES                           27560002
275700             WHEN SQLCODE < +0                                    27570002
275800             WHEN SQLCODE > +0                                    27580002
275900                  MOVE '3140-CHECK-PO-SERVICE-INFO'               27590002
276000                                  TO DP013-PARAGRAPH              27600002
276100                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   27610002
276200                                  TO DP013-MESSAGE-TEXT (1)       27620002
276300                  MOVE SQLCA      TO DP013-SQLCA                  27630002
276400                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     27640002
276500                  SET DP013-DB2-ABEND                             27650002
276600                      DP013-XCTL-DISPLAY-RESTART                  27660002
276700                                  TO TRUE                         27670002
276800                  PERFORM DP013-0000-PROCESS-ABEND                27680002
276900         END-EVALUATE                                             27690002
277000     END-PERFORM.                                                 27700002
277100                                                                  27710002
277200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27720002
277300             AND (SQLCODE NOT = +0)                               27730002
277400         MOVE '3140-CHECK-PO-SERVICE-INFO'                        27740002
277500                                  TO DP013-PARAGRAPH              27750002
277600         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 27760002
277700                                  TO DP013-MESSAGE-TEXT (1)       27770002
277800         MOVE SQLCA               TO DP013-SQLCA                  27780002
277900         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     27790002
278000         SET DP013-DB2-ABEND                                      27800002
278100             DP013-XCTL-DISPLAY-RESTART                           27810002
278200                                  TO TRUE                         27820002
278300         PERFORM DP013-0000-PROCESS-ABEND                         27830002
278400     END-IF.                                                      27840002
278500                                                                  27850002
278600/                                                                 27860002
278700*----------------------------------------------------------------*27870002
278800*    CHECK TO SEE IF RCVR NBR IS UNIQUE                          *27880002
278900*----------------------------------------------------------------*27890002
279000 3150-CHECK-DUPL-RCVR-NBR.                                        27900002
279100                                                                  27910002
279200     PERFORM                                                      27920002
279300         WITH TEST AFTER                                          27930002
279400         VARYING PV-RETRY-COUNTER                                 27940002
279500         FROM 1 BY 1                                              27950002
279600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27960002
279700             OR (SQLCODE = +0)                                    27970002
279800             OR (SQLCODE = +100))                                 27980002
279900                                                                  27990002
280000         EXEC SQL                                                 28000002
280100              SELECT COUNT(*)                                     28010002
280200                INTO :PV-DB2-COUNT                                28020002
280300                FROM TRECEIV                                      28030002
280400               WHERE RCVR_NBR = :DK-RCVR-NBR                      28040002
280500         END-EXEC                                                 28050002
280600                                                                  28060002
280700         EVALUATE TRUE                                            28070002
280800             WHEN SQLCODE = +0                                    28080002
280900             WHEN SQLCODE = +100                                  28090002
281000             WHEN SQLCODE = -904                                  28100002
281100             WHEN SQLCODE = -913                                  28110002
281200                  INITIALIZE PV-CICS-MSG-DATA2                    28120002
281300                  MOVE DK-RCVR-NBR TO PV-DISPLAY-RCVR             28130002
281400                  MOVE PV-DB2-COUNT TO PV-DISPLAY-COUNT           28140002
281500                  MOVE SQLCODE      TO PV-DISPLAY-SQLCODE         28150002
281600                  STRING 'RCKCS266- ' DELIMITED BY SIZE           28160002
281700                         'PO NBR '    DELIMITED BY SIZE           28170002
281800                  ASC-PO-NBR          DELIMITED BY SIZE           28180002
281900                         'RCVR NBR '  DELIMITED BY SIZE           28190002
282000                  PV-DISPLAY-RCVR     DELIMITED BY SIZE           28200002
282100                         ' DB2 COUNT ' DELIMITED BY SIZE          28210002
282200                  PV-DISPLAY-COUNT    DELIMITED BY SIZE           28220002
282300                         ' SQLCODE = ' DELIMITED BY SIZE          28230002
282400                  PV-DISPLAY-COUNT    DELIMITED BY SIZE           28240002
282500                                  INTO PV-CICS-MSG-DATA2          28250002
282600                  MOVE PV-CICS-MSG-HOLD2                          28260002
282700                                  TO PV-CICS-MSG-AREA2            28270002
282800                  MOVE LENGTH OF PV-CICS-MSG-AREA2 TO             28280002
282900                                  PV-COMMAREA-LENGTH              28290002
283000                  EXEC CICS                                       28300002
283100                    WRITEQ TD                                     28310002
283200                        QUEUE ('CSSL')                            28320002
283300                        FROM  (PV-CICS-MSG-AREA2)                 28330002
283400                        LENGTH (PV-COMMAREA-LENGTH)               28340002
283500                        RESP  (PV-CICS-RESP)                      28350002
283600                  END-EXEC                                        28360002
283700                                                                  28370002
283800             WHEN SQLWARN0 NOT = SPACES                           28380002
283900             WHEN SQLCODE < +0                                    28390002
284000             WHEN SQLCODE > +0                                    28400002
284100                  MOVE '3150-CHECK-DUPL-RCVR-NBR  '               28410002
284200                                  TO DP013-PARAGRAPH              28420002
284300                  MOVE 'UNSUCCESSFUL SELECT RCVR NBR '            28430002
284400                                  TO DP013-MESSAGE-TEXT (1)       28440002
284500                  MOVE SQLCA      TO DP013-SQLCA                  28450002
284600                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     28460002
284700                  SET DP013-DB2-ABEND                             28470002
284800                      DP013-XCTL-DISPLAY-RESTART                  28480002
284900                                  TO TRUE                         28490002
285000                  PERFORM DP013-0000-PROCESS-ABEND                28500002
285100         END-EVALUATE                                             28510002
285200     END-PERFORM.                                                 28520002
285300                                                                  28530002
285400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28540002
285500             AND (SQLCODE NOT = +0)                               28550002
285600         MOVE '3150-CHECK-DUPL-RCVR-NBR  '                        28560002
285700                                  TO DP013-PARAGRAPH              28570002
285800         MOVE 'MAX RETRIES EXCEEDED ON SELECT RCVR NBR '          28580002
285900                                  TO DP013-MESSAGE-TEXT (1)       28590002
286000         MOVE SQLCA               TO DP013-SQLCA                  28600002
286100         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     28610002
286200         SET DP013-DB2-ABEND                                      28620002
286300             DP013-XCTL-DISPLAY-RESTART                           28630002
286400                                  TO TRUE                         28640002
286500         PERFORM DP013-0000-PROCESS-ABEND                         28650002
286600     END-IF.                                                      28660002
286700                                                                  28670002
286800     IF SQLCODE = +0 AND                                          28680002
286900        PV-DB2-COUNT = +0                                         28690002
287000         SET PS-NO-RCVR-FOUND TO TRUE                             28700002
287100     END-IF.                                                      28710002
287200                                                                  28720002
287300/                                                                 28730002
287400 3160-PKGNG-CDE-FROM-PO.                                          28740002
287500     PERFORM                                                      28750002
287600         WITH TEST AFTER                                          28760002
287700         VARYING PV-RETRY-COUNTER                                 28770002
287800         FROM 1 BY 1                                              28780002
287900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28790002
288000             OR (SQLCODE = +0)                                    28800002
288100             OR (SQLCODE = +100))                                 28810002
288200                                                                  28820002
288300         EXEC SQL                                                 28830002
288400             SELECT PKGNG_CDE                                     28840002
288500               ,    PO_TYP_CDE                                    28850002
288600               INTO :PURCHS-PKGNG-CDE                             28860002
288700               ,    :PURCHS-PO-TYP-CDE                            28870002
288800               FROM TPURCHS A                                     28880002
288900               WHERE A.PO_NBR = :DK-PO-NBR                        28890002
289000                   AND VER_STATUS_CDE = 'A'                       28900002
289100         END-EXEC                                                 28910002
289200                                                                  28920002
289300         EVALUATE TRUE                                            28930002
289400             WHEN SQLCODE = +0                                    28940002
289500                 MOVE PURCHS-PKGNG-CDE                            28950002
289600                          TO ASC-PKGNG-CDE                        28960002
289700                 MOVE PURCHS-PO-TYP-CDE                           28970002
289800                          TO ASC-PO-TYPE                          28980002
289900             WHEN SQLCODE = +100                                  28990002
290000                 MOVE SPACES TO ASC-PKGNG-CDE                     29000002
290100                                ASC-PO-TYPE                       29010002
290200             WHEN SQLCODE = -904                                  29020002
290300             WHEN SQLCODE = -913                                  29030002
290400                 CONTINUE                                         29040002
290500             WHEN SQLWARN0 NOT = SPACES                           29050002
290600             WHEN SQLCODE < +0                                    29060002
290700             WHEN SQLCODE > +0                                    29070002
290800                 MOVE '3160-PKGNG-CDE-FROM-PO'                    29080002
290900                        TO DP013-PARAGRAPH                        29090002
291000                 MOVE 'UNSUCCESSFUL SELECT PKGNG-CDE'             29100002
291100                        TO DP013-MESSAGE-TEXT (1)                 29110002
291200                 MOVE SQLCA     TO DP013-SQLCA                    29120002
291300                 MOVE 'TPURCHS' TO DP013-DB2-TABLE-NAME (1)       29130002
291400                 SET DP013-DB2-ABEND                              29140002
291500                     DP013-XCTL-DISPLAY-RESTART                   29150002
291600                                TO TRUE                           29160002
291700                 PERFORM DP013-0000-PROCESS-ABEND                 29170002
291800         END-EVALUATE                                             29180002
291900     END-PERFORM.                                                 29190002
292000                                                                  29200002
292100 3200-RESET-ATTRIBUTES.                                           29210002
292200                                                                  29220002
292300     MOVE DP015-BLUE                TO ATRBLC.                    29230002
292400                                                                  29240002
292500     IF  ASC-ADD-PENDING OR ASC-ADD-FROM-MENU                     29250002
292600             MOVE DP015-UNP-ALP-NOR-OFF                           29260002
292700                                    TO APONBRA                    29270002
292800                                       ASCACA                     29280002
292900                                       ATRLNBRA                   29290002
293000                                       AFBNBRA                    29300002
293100                                       ASHPMMA                    29310002
293200                                       ASHPDDA                    29320002
293300                                       ASHPYYA                    29330002
293400                                       AOPERA                     29340002
293500                                       AFCLTYA                    29350002
293600                                       AVSHMMA                    29360002
293700                                       AVSHDDA                    29370002
293800                                       AVSHYYA                    29380002
293900                                       ABOLNBRA                   29390002
294000                                       ACRTCNTA                   29400002
294100* CT 11/11/11 - START WR40574                                     29410013
294200                                       ACANIDA                    29420013
294300* CT 11/11/11 - END   WR40574                                     29430013
294400*                                      APKSLPA                    29440002
294500*                                      AHOTA                      29450002
294600*                                      ACUSTA                     29460002
294700             MOVE DP015-GREEN       TO APONBRC                    29470002
294800                                       ASCACC                     29480002
294900                                       ATRLNBRC                   29490002
295000                                       AFBNBRC                    29500002
295100                                       ASHPMMC                    29510002
295200                                       ASHPDDC                    29520002
295300                                       ASHPYYC                    29530002
295400                                       AOPERC                     29540002
295500                                       AFCLTYC                    29550002
295600                                       AVSHMMC                    29560002
295700                                       AVSHDDC                    29570002
295800                                       AVSHYYC                    29580002
295900                                       ABOLNBRC                   29590002
296000                                       ACRTCNTC                   29600002
296100* CT 11/11/11 - START WR40574                                     29610013
296200                                       ACANIDC                    29620013
296300* CT 11/11/11 - END   WR40574                                     29630013
296400*                                      APKSLPC                    29640002
296500*                                      AHOTC                      29650002
296600*                                      ACUSTC                     29660002
296700             MOVE DP015-UNDERLINE   TO APONBRH                    29670002
296800                                       ASCACH                     29680002
296900                                       ATRLNBRH                   29690002
297000                                       AFBNBRH                    29700002
297100                                       ASHPMMH                    29710002
297200                                       ASHPDDH                    29720002
297300                                       ASHPYYH                    29730002
297400                                       AOPERH                     29740002
297500                                       AFCLTYH                    29750002
297600                                       AVSHMMH                    29760002
297700                                       AVSHDDH                    29770002
297800                                       AVSHYYH                    29780002
297900                                       ABOLNBRH                   29790002
298000                                       ACRTCNTH                   29800002
298100* CT 11/11/11 - START WR40574                                     29810013
298200                                       ACANIDC                    29820013
298300* CT 11/11/11 - END   WR40574                                     29830013
298400     END-IF.                                                      29840002
298500                                                                  29850002
298600     IF  ASC-ADD-SUCCESSFUL                                       29860002
298700         MOVE DP015-UNP-ALP-NOR-OFF TO APONBRA                    29870002
298800         MOVE DP015-GREEN           TO APONBRC                    29880002
298900         MOVE DP015-UNDERLINE       TO APONBRH                    29890002
299000     END-IF.                                                      29900002
299100                                                                  29910002
299200                                                                  29920002
299300/                                                                 29930002
299400/                                                                 29940002
299500 4000-BUILD-INITIAL-PANEL.                                        29950002
299600                                                                  29960002
299700     IF ASC-ADD-FROM-MENU                                         29970002
299800        MOVE ZEROES                 TO ASC-REC-SEQ-NBR            29980002
299900                                       ASC-PO-NBR-N               29990002
300000                                       ASC-EXPTED-CART-CNT-N      30000002
300100     END-IF.                                                      30010002
300200                                                                  30020002
300300     MOVE SPACES                 TO ASC-AP-RCVR-NBR.              30030002
300400     MOVE ASC-CRE-OPER-UNT-ID-N  TO DK-OPER-UNT-ID.               30040002
300500     MOVE ASC-CRE-FCLTY-ID-N     TO DK-FCLTY-ID.                  30050002
300600     MOVE ASC-PO-NBR             TO DK-PO-NBR                     30060002
300700                                    DK-ORD-NBR.                   30070002
300800* CT 11/11/11 - START WR40574                                     30080010
300900     MOVE ASC-CAN                TO DK-CARR-AUTH-ID.              30090016
301000* CT 11/11/11 - END   WR40574                                     30100010
301100     MOVE ASC-REC-SEQ-NBR        TO DK-REC-SEQ-NBR.               30110002
301200     MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID.                  30120002
301300                                                                  30130002
301400     IF  ASC-VEH-NBR > SPACES                                     30140002
301500         MOVE ASC-VEH-NBR        TO DK-VEH-NBR                    30150002
301600     ELSE                                                         30160002
301700         MOVE SPACES             TO DK-VEH-NBR                    30170002
301800                                    ASC-VEH-NBR                   30180002
301900     END-IF.                                                      30190002
302000                                                                  30200002
302100     IF  ASC-SCAC-ID > SPACES                                     30210002
302200         MOVE ASC-SCAC-ID                                         30220002
302300                                 TO DK-SCAC-ID                    30230002
302400     ELSE                                                         30240002
302500         MOVE SPACES             TO DK-SCAC-ID                    30250002
302600                                    ASC-SCAC-ID                   30260002
302700     END-IF.                                                      30270002
302800                                                                  30280002
302900     IF  ASC-TRIP-ID > ZEROES                                     30290002
303000         MOVE ASC-TRIP-ID    TO DK-TRIP-ID                        30300002
303100     ELSE                                                         30310002
303200         MOVE ZEROES             TO DK-TRIP-ID                    30320002
303300     END-IF.                                                      30330002
303400                                                                  30340002
303500     IF  ASC-PRO-NBR > SPACES                                     30350002
303600         MOVE ASC-PRO-NBR        TO DK-PRO-NBR                    30360002
303700     ELSE                                                         30370002
303800         MOVE SPACES             TO DK-PRO-NBR                    30380002
303900     END-IF.                                                      30390002
304000                                                                  30400002
304100     IF  ASC-BOL-NBR > SPACES                                     30410002
304200         MOVE ASC-BOL-NBR        TO DK-BOL-NBR                    30420002
304300     ELSE                                                         30430002
304400         MOVE SPACES             TO DK-BOL-NBR                    30440002
304500     END-IF.                                                      30450002
304600                                                                  30460002
304700     IF  ASC-ADD-PENDING AND ASC-ADD-FROM-MENU                    30470002
304800         MOVE DP020-LOCATION-NBR TO ASC-CRE-OPER-UNT-ID-N         30480002
304900         MOVE 1                  TO ASC-CRE-FCLTY-ID-N            30490002
305000         MOVE ASC-CRE-OPER-UNT-ID-N TO DK-OPER-UNT-ID             30500002
305100         MOVE ASC-CRE-FCLTY-ID-N TO DK-FCLTY-ID                   30510002
305200     END-IF.                                                      30520002
305300                                                                  30530002
305400     IF ASC-ADD-PENDING                                           30540002
305500        IF ASC-ADD-FROM-MENU                                      30550002
305600           CONTINUE                                               30560002
305700     ELSE                                                         30570002
305800        PERFORM 4005-GET-SHIPMENT-INFO                            30580002
305900        IF ASC-SHIPMENT-EXIST                                     30590002
306000           PERFORM 4065-MOVE-SHIPMENT-INFO                        30600002
306100        END-IF                                                    30610002
306200     END-IF.                                                      30620002
306300                                                                  30630002
306400     INITIALIZE PV-DB2-COUNT.                                     30640002
306500     MOVE DK-OPER-UNT-ID     TO PV-OPER-UNT-ID.                   30650002
306600     MOVE PV-OPER-UNT-ID-X   TO DK-STORE-NMBR.                    30660002
306700                                                                  30670002
306800     IF ASC-ADD-FROM-MENU                                         30680002
306900        MOVE 'Y'       TO ASC-PACK-BY-ST-IND                      30690002
307000     END-IF.                                                      30700002
307100                                                                  30710002
307200     PERFORM 4070-GET-ENT-NAME-DESC.                              30720002
307300     MOVE ASC-DEPT-NBR            TO DK-DEPT-NBR.                 30730002
307400                                                                  30740002
307500     PERFORM 4090-GET-AD-DATE.                                    30750002
307600                                                                  30760002
307700                                                                  30770002
307800     IF  ASC-ADD-PENDING                                          30780002
307900         PERFORM 3100-MOVE-DEFAULT-TO-COMMAREA                    30790002
308000     END-IF.                                                      30800002
308100                                                                  30810002
308200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        30820002
308300                                                                  30830002
308400/                                                                 30840002
308500*----------------------------------------------------------------*30850002
308600*  IDENTIFYING A SHIPMENT MATCH.                                 *30860002
308700*  A SHIPMENT IDENTIFIER MAY CONSIST OF THE FOLLOWING COMBINATIONS30870002
308800*  - SCAC AND BILL OF LADING NUMBER                              *30880002
308900*  - SCAC AND FREIGHT BILL NUMBER                                *30890002
309000*  - SCAC, BILL OF LADING NUMBER, AND FREIGHT BILL NUMBER.       *30900002
309100*  THE RULES TO COMPARE SHIPPING INFORMATION TO A SHIPMENT AND SAY30910002
309200*  THERE IS A MATCH ARE:                                         *30920002
309300*  1. SCAC MUST ALWAYS MATCH THE SHIPMENT SCAC.                  *30930002
309400*  2. IF THERE IS A BILL OF LADING, BUT NOT FREIGHT BILL NUBMER, *30940002
309500*     THE MATCH IS ATTEMPTED AGAINT THE BILL OF LADING NUMBER AND*30950002
309600*     A FREIGHT BILL OF SPACES.  IF THE SHIPMENT IS NOT FOUND AN *30960002
309700*     ATTEMPT IS MADE USING JUST THE BILL OF LADING NUMBER,  IF  *30970002
309800*     FOUND IT'S ASSUMED YOU HAVE A MATCH.                       *30980002
309900*  3. IF THERE IS A FREIGHT BILL, BUT NOT BILL OF LADING NUMBER, *30990002
310000*     THE MATCH IS ATTEMPTED AGAINST THE FREIGHT BILL NUMBER AND *31000002
310100*     A BILL OF LADING OF SPACES.  IF THE SHIPMENT IS NOT FOUND AN31010002
310200*     ATTEMPT IS MADE USING JUST THE FREIGHT BILL NUMBER, IF FOUND31020002
310300*     IT'S ASSUMED YOU HAVE A MATCH.                             *31030002
310400*  4. IF THERE IS A FREIGHT BILL AND BILL OF LADING NUMBER, THE  *31040002
310500*     MATCH IS FIRST ATTEMPTED AGAINST A SHIPMENT THAT HAS THE   *31050002
310600*     SAME FREIGHT BILL AND BILL OF LADING NUMBER.  IF FOUND, YOU*31060002
310700*     HAVE A MATCH.  IF NOT FOUND, A MATCH IS THEN ATTEMPTED     *31070002
310800*     AGAINST A SHIPMENT WITH THE SAME SCAC AND BILL OF LADING   *31080002
310900*     NUMBER AND A FREIGHT BILL OF SPACES.  IF FOUND YOU HAVE A  *31090002
311000*     MATCH.  IF NOT FOUND, A MATCH IS ATTEMPTED TO A SHIPMENT   *31100002
311100*     WITH THE SAME SCAC AND FREIGHT BILL NUMBER AND A BILL OF   *31110002
311200*     LADING NUMBER OF SPACES.  IF NOT FOUND, NO MATCH EXISTS.   *31120002
311300*----------------------------------------------------------------*31130002
311400 4005-GET-SHIPMENT-INFO.                                          31140002
311500                                                                  31150002
311600     MOVE ASC-SCAC-ID TO DK-SCAC-ID.                              31160002
311700                                                                  31170002
311800     IF ASC-PRO-NBR > SPACES                                      31180002
311900        IF ASC-BOL-NBR > SPACES                                   31190002
312000*          * BOTH FILLED IN *                                     31200002
312100           MOVE ASC-PRO-NBR TO DK-PRO-NBR                         31210002
312200           MOVE ASC-BOL-NBR TO DK-BOL-NBR                         31220002
312300           PERFORM 4010-SELECT-SHIP1                              31230002
312400           IF ASC-SHIPMENT-EXIST                                  31240002
312500              NEXT SENTENCE                                       31250002
312600           ELSE                                                   31260002
312700              MOVE SPACES TO  DK-PRO-NBR                          31270002
312800              PERFORM 4010-SELECT-SHIP1                           31280002
312900              IF ASC-SHIPMENT-EXIST                               31290002
313000                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        31300002
313100                    SET PS-UPD-TSHIPMT-PROBOL TO TRUE             31310002
313200                 END-IF                                           31320002
313300              ELSE                                                31330002
313400                 MOVE ASC-PRO-NBR TO DK-PRO-NBR                   31340002
313500                 MOVE SPACES      TO DK-BOL-NBR                   31350002
313600                 PERFORM 4010-SELECT-SHIP1                        31360002
313700                 IF ASC-SHIPMENT-EXIST                            31370002
313800                    IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)     31380002
313900                       SET PS-UPD-TSHIPMT-PROBOL TO TRUE          31390002
314000                    END-IF                                        31400002
314100                 END-IF                                           31410002
314200              END-IF                                              31420002
314300           END-IF                                                 31430002
314400        ELSE                                                      31440002
314500*          * JUST PRO FILLED IN *                                 31450002
314600           MOVE ASC-PRO-NBR TO DK-PRO-NBR                         31460002
314700           MOVE SPACES      TO DK-BOL-NBR                         31470002
314800           PERFORM 4010-SELECT-SHIP1                              31480002
314900           IF ASC-SHIPMENT-EXIST                                  31490002
315000              NEXT SENTENCE                                       31500002
315100           ELSE                                                   31510002
315200              PERFORM 4020-SELECT-SHIP2                           31520002
315300              IF ASC-SHIPMENT-EXIST                               31530002
315400                 IF SHIPMT-BOL-NBR > SPACES                       31540002
315500                    MOVE SHIPMT-BOL-NBR  TO ASC-BOL-NBR           31550002
315600                    MOVE SHIPMT-COMPLETE-BOL-NBR                  31560002
315700                                         TO ABOLNBRO              31570002
315800                                            ASC-COMPLETE-BOL-NBR  31580002
315900                    MOVE DP015-RED       TO ABOLNBRC              31590002
316000                    IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)     31600002
316100                       SET PS-UPD-TSHIPMT-PROBOL TO TRUE          31610002
316200                    END-IF                                        31620002
316300                 END-IF                                           31630002
316400              END-IF                                              31640002
316500           END-IF                                                 31650002
316600        END-IF                                                    31660002
316700     ELSE                                                         31670002
316800        IF ASC-BOL-NBR > SPACES                                   31680002
316900*          * JUST BOL FILLED IN *                                 31690002
317000           MOVE SPACES      TO DK-PRO-NBR                         31700002
317100           MOVE ASC-BOL-NBR TO DK-BOL-NBR                         31710002
317200           PERFORM 4010-SELECT-SHIP1                              31720002
317300           IF ASC-SHIPMENT-EXIST                                  31730002
317400              NEXT SENTENCE                                       31740002
317500           ELSE                                                   31750002
317600              PERFORM 4030-SELECT-SHIP3                           31760002
317700              IF ASC-SHIPMENT-EXIST                               31770002
317800                 IF SHIPMT-PRO-NBR > SPACES                       31780002
317900                    MOVE SHIPMT-PRO-NBR  TO ASC-PRO-NBR           31790002
318000                    MOVE SHIPMT-COMPLETE-PRO-NBR                  31800002
318100                                         TO AFBNBRO               31810002
318200                                            ASC-COMPLETE-PRO-NBR  31820002
318300                    MOVE DP015-RED       TO AFBNBRC               31830002
318400                    IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)     31840002
318500                       SET PS-UPD-TSHIPMT-PROBOL TO TRUE          31850002
318600                    END-IF                                        31860002
318700                 END-IF                                           31870002
318800              END-IF                                              31880002
318900           END-IF                                                 31890002
319000        END-IF                                                    31900002
319100     END-IF.                                                      31910002
319200                                                                  31920002
319300     IF ASC-SHIPMENT-EXIST                                        31930028
319400        MOVE SHIPMT-SHIPT-ID TO ASC-SHIPT-ID                      31940002
319500        MOVE SHIPMT-TRIP-ID  TO ASC-TRIP-ID                       31950002
319600** CT - START - 03/20/2012                                        31960028
319700        MOVE SHIPMT-CARR-AUTH-ID TO ASC-CAN                       31970028
319800                                    ACANIDO                       31980028
319900** CT - END   - 03/20/2012                                        31990028
320000        PERFORM 4060-SELECT-TSHPTPO                               32000002
320100        IF PS-NO-ERROR                                            32010002
320200           MOVE SHIPMT-TRIP-ID TO DK-TRIP-ID                      32020002
320300           PERFORM 4040-CHECK-TRIP-STATUS                         32030002
320400           IF ASC-SHIPT-STATUS-NOTOK                              32040002
320500              MOVE PC-TSYMSG-00992 TO DP020-MSG-NUMBER            32050002
320600              MOVE TRIPST-TRIP-STATUS-CDE                         32060002
320700                                   TO DP020-MSG-TEXT              32070002
320800              MOVE -1             TO APONBRL                      32080002
320900              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 32090002
321000              SET DP020-MSG-FATAL TO TRUE                         32100002
321100              SET PS-ERROR                                        32110002
321200                  PS-MSG-SET      TO TRUE                         32120002
321300           END-IF                                                 32130002
321400        END-IF                                                    32140002
321500     END-IF.                                                      32150002
321600                                                                  32160002
321700*----------------------------------------------------------------*32170002
321800*    TRY TO MATCH TO A SHIPMENT THAT HAS THE SAME                *32180002
321900*    FREIGHT AND BILL OF LADING NUMBER.                          *32190002
322000*----------------------------------------------------------------*32200002
322100* CT 03/20/11 - ADDED CARR-AUTH-ID BELOW WR40574                  32210028
322200 4010-SELECT-SHIP1.                                               32220002
322300                                                                  32230002
322400     PERFORM WITH TEST AFTER                                      32240002
322500         VARYING PV-RETRY-COUNTER                                 32250002
322600         FROM 1 BY 1                                              32260002
322700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 32270002
322800                 OR SQLCODE = 0                                   32280002
322900                 OR SQLCODE = -811                                32290002
323000                 OR SQLCODE = +100)                               32300002
323100                                                                  32310002
323200         EXEC SQL                                                 32320002
323300             SELECT A.TRIP_ID,                                    32330002
323400                    A.SHIPT_ID,                                   32340002
323500                    A.PRO_SCAC_ID,                                32350002
323600                    A.VEND_SHIP_DTE,                              32360002
323700                    A.PRO_NBR,                                    32370002
323800                    A.BOL_NBR,                                    32380002
323900                    A.COMPLETE_PRO_NBR,                           32390002
324000                    A.COMPLETE_BOL_NBR,                           32400002
324100                    B.VEH_NBR,                                    32410002
324200                    B.OWNR_SCAC_SHIP_DTE,                         32420028
324300                    A.CARR_AUTH_ID                                32430028
324400             INTO   :SHIPMT-TRIP-ID,                              32440002
324500                    :SHIPMT-SHIPT-ID,                             32450002
324600                    :SHIPMT-PRO-SCAC-ID,                          32460002
324700                    :SHIPMT-VEND-SHIP-DTE,                        32470002
324800                    :SHIPMT-PRO-NBR,                              32480002
324900                    :SHIPMT-BOL-NBR,                              32490002
325000                    :SHIPMT-COMPLETE-PRO-NBR,                     32500002
325100                    :SHIPMT-COMPLETE-BOL-NBR,                     32510002
325200                    :VHTRIP-VEH-NBR :DN-VEH-NBR,                  32520002
325300                    :VHTRIP-OWNR-SCAC-SHIP-DTE,                   32530028
325400                    :SHIPMT-CARR-AUTH-ID                          32540028
325500             FROM   TSHIPMT A,                                    32550002
325600                    TVHTRIP B                                     32560002
325700             WHERE  A.PRO_SCAC_ID   = :DK-SCAC-ID                 32570002
325800             AND    A.PRO_NBR       = :DK-PRO-NBR                 32580002
325900             AND    A.BOL_NBR       = :DK-BOL-NBR                 32590002
326000             AND    A.TRIP_ID       = B.TRIP_ID                   32600002
326100         END-EXEC                                                 32610002
326200                                                                  32620002
326300         EVALUATE TRUE                                            32630002
326400             WHEN SQLCODE = ZERO                                  32640002
326500             WHEN SQLCODE = +100                                  32650002
326600             WHEN SQLCODE = -904                                  32660002
326700             WHEN SQLCODE = -913                                  32670002
326800             WHEN SQLCODE = -811                                  32680002
326900                 CONTINUE                                         32690002
327000             WHEN SQLWARN0 NOT = SPACES                           32700002
327100             WHEN SQLCODE NOT EQUAL ZERO                          32710002
327200                 MOVE SPACES TO PV-MESSAGE                        32720002
327300                 MOVE DK-SCAC-ID   TO PV-MESSAGE1                 32730002
327400                 MOVE DK-PRO-NBR   TO PV-MESSAGE2                 32740002
327500                 MOVE DK-BOL-NBR   TO PV-MESSAGE3                 32750002
327600                 MOVE '4010-SELECT-SHIP1'                         32760002
327700                                 TO DP013-PARAGRAPH               32770002
327800                 MOVE 'CHECK SHIPMENT'                            32780002
327900                                 TO DP013-MESSAGE-TEXT(1)         32790002
328000                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT(2)         32800002
328100                 MOVE SQLCA      TO DP013-SQLCA                   32810002
328200                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME(1)       32820002
328300                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME(2)       32830002
328400                 SET DP013-DB2-ABEND                              32840002
328500                                 TO TRUE                          32850002
328600                 SET DP013-NO-ROLLBACK                            32860002
328700                                 TO TRUE                          32870002
328800                 SET DP013-XCTL-DISPLAY-RESTART                   32880002
328900                                 TO TRUE                          32890002
329000                 PERFORM DP013-0000-PROCESS-ABEND                 32900002
329100         END-EVALUATE                                             32910002
329200     END-PERFORM.                                                 32920002
329300                                                                  32930002
329400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         32940002
329500             AND (SQLCODE NOT = +0)                               32950002
329600         MOVE '4010-SELECT-SHIP1'                                 32960002
329700                                 TO DP013-PARAGRAPH               32970002
329800         MOVE 'CHECK SHIPMENT'   TO DP013-MESSAGE-TEXT(1)         32980002
329900         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    32990002
330000                                 TO DP013-MESSAGE-TEXT(2)         33000002
330100         MOVE SQLCA              TO DP013-SQLCA                   33010002
330200         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME(1)       33020002
330300         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME(2)       33030002
330400         SET DP013-DB2-ABEND     TO TRUE                          33040002
330500         SET DP013-NO-ROLLBACK   TO TRUE                          33050002
330600         SET DP013-XCTL-DISPLAY-RESTART                           33060002
330700                                 TO TRUE                          33070002
330800         PERFORM DP013-0000-PROCESS-ABEND                         33080002
330900     END-IF.                                                      33090002
331000                                                                  33100002
331100     EVALUATE TRUE                                                33110002
331200         WHEN SQLCODE = ZERO                                      33120002
331300              SET ASC-SHIPMENT-EXIST TO TRUE                      33130002
331400         WHEN SQLCODE = +100                                      33140002
331500              SET ASC-ADD-SHIPMENT TO TRUE                        33150002
331600         WHEN SQLCODE = -811                                      33160002
331700              SET ASC-MULT-SHIP-EXIST                             33170002
331800                  PS-ERROR                                        33180002
331900                  DP020-MSG-FATAL    TO TRUE                      33190002
332000              MOVE PC-TSYMSG-01049   TO DP020-MSG-NUMBER          33200002
332100     END-EVALUATE.                                                33210002
332200                                                                  33220002
332300 EJECT                                                            33230002
332400                                                                  33240002
332500*                                                                 33250002
332600*----------------------------------------------------------------*33260002
332700*    TRY TO MATCH A SHIPMENT USING THE FREIGHT BILL NUMBER.       33270002
332800*----------------------------------------------------------------*33280002
332900* CT 03/20/11 - ADDED CARR-AUTH-ID BELOW WR40574                  33290028
333000 4020-SELECT-SHIP2.                                               33300002
333100                                                                  33310002
333200     PERFORM WITH TEST AFTER                                      33320002
333300         VARYING PV-RETRY-COUNTER                                 33330002
333400         FROM 1 BY 1                                              33340002
333500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 33350002
333600                 OR SQLCODE = 0                                   33360002
333700                 OR SQLCODE = -811                                33370002
333800                 OR SQLCODE = +100)                               33380002
333900                                                                  33390002
334000         EXEC SQL                                                 33400002
334100             SELECT A.TRIP_ID,                                    33410002
334200                    A.SHIPT_ID,                                   33420002
334300                    A.PRO_SCAC_ID,                                33430002
334400                    A.VEND_SHIP_DTE,                              33440002
334500                    A.PRO_NBR,                                    33450002
334600                    A.BOL_NBR,                                    33460002
334700                    A.COMPLETE_PRO_NBR,                           33470002
334800                    A.COMPLETE_BOL_NBR,                           33480002
334900                    B.VEH_NBR,                                    33490002
335000                    B.OWNR_SCAC_SHIP_DTE,                         33500028
335100                    A.CARR_AUTH_ID                                33510028
335200             INTO   :SHIPMT-TRIP-ID,                              33520002
335300                    :SHIPMT-SHIPT-ID,                             33530002
335400                    :SHIPMT-PRO-SCAC-ID,                          33540002
335500                    :SHIPMT-VEND-SHIP-DTE,                        33550002
335600                    :SHIPMT-PRO-NBR,                              33560002
335700                    :SHIPMT-BOL-NBR,                              33570002
335800                    :SHIPMT-COMPLETE-PRO-NBR,                     33580002
335900                    :SHIPMT-COMPLETE-BOL-NBR,                     33590002
336000                    :VHTRIP-VEH-NBR :DN-VEH-NBR,                  33600002
336100                    :VHTRIP-OWNR-SCAC-SHIP-DTE,                   33610028
336200                    :SHIPMT-CARR-AUTH-ID                          33620028
336300             FROM   TSHIPMT A,                                    33630002
336400                    TVHTRIP B                                     33640002
336500             WHERE  A.PRO_SCAC_ID   = :DK-SCAC-ID                 33650002
336600             AND    A.PRO_NBR       = :ASC-PRO-NBR                33660002
336700             AND    A.TRIP_ID       = B.TRIP_ID                   33670002
336800         END-EXEC                                                 33680002
336900                                                                  33690002
337000         EVALUATE TRUE                                            33700002
337100             WHEN SQLCODE = ZERO                                  33710002
337200             WHEN SQLCODE = +100                                  33720002
337300             WHEN SQLCODE = -904                                  33730002
337400             WHEN SQLCODE = -913                                  33740002
337500             WHEN SQLCODE = -811                                  33750002
337600                 CONTINUE                                         33760002
337700             WHEN SQLWARN0 NOT = SPACES                           33770002
337800             WHEN SQLCODE NOT EQUAL ZERO                          33780002
337900                 MOVE SPACES TO PV-MESSAGE                        33790002
338000                 MOVE DK-SCAC-ID   TO PV-MESSAGE1                 33800002
338100                 MOVE ASC-PRO-NBR  TO PV-MESSAGE2                 33810002
338200                 MOVE '4020-SELECT-SHIP2'                         33820002
338300                                 TO DP013-PARAGRAPH               33830002
338400                 MOVE 'CHECK SHIPMENT'                            33840002
338500                                 TO DP013-MESSAGE-TEXT(1)         33850002
338600                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT(2)         33860002
338700                 MOVE SQLCA      TO DP013-SQLCA                   33870002
338800                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME(1)       33880002
338900                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME(2)       33890002
339000                 SET DP013-DB2-ABEND                              33900002
339100                                 TO TRUE                          33910002
339200                 SET DP013-NO-ROLLBACK                            33920002
339300                                 TO TRUE                          33930002
339400                 SET DP013-XCTL-DISPLAY-RESTART                   33940002
339500                                 TO TRUE                          33950002
339600                 PERFORM DP013-0000-PROCESS-ABEND                 33960002
339700         END-EVALUATE                                             33970002
339800     END-PERFORM.                                                 33980002
339900                                                                  33990002
340000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         34000002
340100             AND (SQLCODE NOT = +0)                               34010002
340200         MOVE '4020-SELECT-SHIP2'                                 34020002
340300                                 TO DP013-PARAGRAPH               34030002
340400         MOVE 'CHECK SHIPMENT'   TO DP013-MESSAGE-TEXT(1)         34040002
340500         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    34050002
340600                                 TO DP013-MESSAGE-TEXT(2)         34060002
340700         MOVE SQLCA              TO DP013-SQLCA                   34070002
340800         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME(1)       34080002
340900         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME(2)       34090002
341000         SET DP013-DB2-ABEND     TO TRUE                          34100002
341100         SET DP013-NO-ROLLBACK   TO TRUE                          34110002
341200         SET DP013-XCTL-DISPLAY-RESTART                           34120002
341300                                 TO TRUE                          34130002
341400         PERFORM DP013-0000-PROCESS-ABEND                         34140002
341500     END-IF.                                                      34150002
341600                                                                  34160002
341700     EVALUATE TRUE                                                34170002
341800         WHEN SQLCODE = ZERO                                      34180002
341900              SET ASC-SHIPMENT-EXIST TO TRUE                      34190002
342000         WHEN SQLCODE = +100                                      34200002
342100              SET ASC-ADD-SHIPMENT   TO TRUE                      34210002
342200         WHEN SQLCODE = -811                                      34220002
342300              SET ASC-MULT-SHIP-EXIST                             34230002
342400                  PS-ERROR                                        34240002
342500                  DP020-MSG-FATAL    TO TRUE                      34250002
342600              MOVE PC-TSYMSG-01049   TO DP020-MSG-NUMBER          34260002
342700     END-EVALUATE.                                                34270002
342800                                                                  34280002
342900 EJECT                                                            34290002
343000                                                                  34300002
343100*----------------------------------------------------------------*34310002
343200*    TRY TO MATCH A SHIPMENT USING THE BILL OF LADING NUMBER.     34320002
343300*----------------------------------------------------------------*34330002
343400* CT 03/20/11 - ADDED CARR-AUTH-ID BELOW WR40574                  34340028
343500 4030-SELECT-SHIP3.                                               34350002
343600                                                                  34360002
343700     PERFORM WITH TEST AFTER                                      34370002
343800         VARYING PV-RETRY-COUNTER                                 34380002
343900         FROM 1 BY 1                                              34390002
344000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 34400002
344100                 OR SQLCODE = 0                                   34410002
344200                 OR SQLCODE = -811                                34420002
344300                 OR SQLCODE = +100)                               34430002
344400                                                                  34440002
344500         EXEC SQL                                                 34450002
344600             SELECT A.TRIP_ID,                                    34460002
344700                    A.SHIPT_ID,                                   34470002
344800                    A.PRO_SCAC_ID,                                34480002
344900                    A.VEND_SHIP_DTE,                              34490002
345000                    A.PRO_NBR,                                    34500002
345100                    A.BOL_NBR,                                    34510002
345200                    A.COMPLETE_PRO_NBR,                           34520002
345300                    A.COMPLETE_BOL_NBR,                           34530002
345400                    B.VEH_NBR,                                    34540002
345500                    B.OWNR_SCAC_SHIP_DTE,                         34550028
345600                    A.CARR_AUTH_ID                                34560028
345700             INTO   :SHIPMT-TRIP-ID,                              34570002
345800                    :SHIPMT-SHIPT-ID,                             34580002
345900                    :SHIPMT-PRO-SCAC-ID,                          34590002
346000                    :SHIPMT-VEND-SHIP-DTE,                        34600002
346100                    :SHIPMT-PRO-NBR,                              34610002
346200                    :SHIPMT-BOL-NBR,                              34620002
346300                    :SHIPMT-COMPLETE-PRO-NBR,                     34630002
346400                    :SHIPMT-COMPLETE-BOL-NBR,                     34640002
346500                    :VHTRIP-VEH-NBR :DN-VEH-NBR,                  34650002
346600                    :VHTRIP-OWNR-SCAC-SHIP-DTE,                   34660028
346700                    :SHIPMT-CARR-AUTH-ID                          34670028
346800             FROM   TSHIPMT A,                                    34680002
346900                    TVHTRIP B                                     34690002
347000             WHERE  A.PRO_SCAC_ID   = :DK-SCAC-ID                 34700002
347100             AND    A.BOL_NBR       = :ASC-BOL-NBR                34710002
347200             AND    A.TRIP_ID       = B.TRIP_ID                   34720002
347300         END-EXEC                                                 34730002
347400                                                                  34740002
347500         EVALUATE TRUE                                            34750002
347600             WHEN SQLCODE = ZERO                                  34760002
347700             WHEN SQLCODE = +100                                  34770002
347800             WHEN SQLCODE = -904                                  34780002
347900             WHEN SQLCODE = -913                                  34790002
348000             WHEN SQLCODE = -811                                  34800002
348100                 CONTINUE                                         34810002
348200             WHEN SQLWARN0 NOT = SPACES                           34820002
348300             WHEN SQLCODE NOT EQUAL ZERO                          34830002
348400                 MOVE SPACES TO PV-MESSAGE                        34840002
348500                 MOVE DK-SCAC-ID   TO PV-MESSAGE1                 34850002
348600                 MOVE ASC-BOL-NBR  TO PV-MESSAGE2                 34860002
348700                 MOVE '4030-SELECT-SHIP3'                         34870002
348800                                 TO DP013-PARAGRAPH               34880002
348900                 MOVE 'CHECK SHIPMENT'                            34890002
349000                                 TO DP013-MESSAGE-TEXT(1)         34900002
349100                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT(2)         34910002
349200                 MOVE SQLCA      TO DP013-SQLCA                   34920002
349300                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME(1)       34930002
349400                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME(2)       34940002
349500                 SET DP013-DB2-ABEND                              34950002
349600                                 TO TRUE                          34960002
349700                 SET DP013-NO-ROLLBACK                            34970002
349800                                 TO TRUE                          34980002
349900                 SET DP013-XCTL-DISPLAY-RESTART                   34990002
350000                                 TO TRUE                          35000002
350100                 PERFORM DP013-0000-PROCESS-ABEND                 35010002
350200         END-EVALUATE                                             35020002
350300     END-PERFORM.                                                 35030002
350400                                                                  35040002
350500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35050002
350600             AND (SQLCODE NOT = +0)                               35060002
350700         MOVE '4030-SELECT-SHIP3'                                 35070002
350800                                 TO DP013-PARAGRAPH               35080002
350900         MOVE 'CHECK SHIPMENT'   TO DP013-MESSAGE-TEXT(1)         35090002
351000         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    35100002
351100                                 TO DP013-MESSAGE-TEXT(2)         35110002
351200         MOVE SQLCA              TO DP013-SQLCA                   35120002
351300         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME(1)       35130002
351400         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME(2)       35140002
351500         SET DP013-DB2-ABEND     TO TRUE                          35150002
351600         SET DP013-NO-ROLLBACK   TO TRUE                          35160002
351700         SET DP013-XCTL-DISPLAY-RESTART                           35170002
351800                                 TO TRUE                          35180002
351900         PERFORM DP013-0000-PROCESS-ABEND                         35190002
352000     END-IF.                                                      35200002
352100                                                                  35210002
352200     EVALUATE TRUE                                                35220002
352300         WHEN SQLCODE = ZERO                                      35230002
352400              SET ASC-SHIPMENT-EXIST TO TRUE                      35240002
352500         WHEN SQLCODE = +100                                      35250002
352600              SET ASC-ADD-SHIPMENT TO TRUE                        35260002
352700         WHEN SQLCODE = -811                                      35270002
352800              SET ASC-MULT-SHIP-EXIST                             35280002
352900                  PS-ERROR                                        35290002
353000                  DP020-MSG-FATAL TO TRUE                         35300002
353100              MOVE PC-TSYMSG-01055 TO DP020-MSG-NUMBER            35310002
353200     END-EVALUATE.                                                35320002
353300                                                                  35330002
353400 EJECT                                                            35340002
353500*----------------------------------------------------------------*35350002
353600*  ADDITIONAL PO'S AND ADVANCED RECEIVERS CAN ONLY BE ADDED TO    35360002
353700*  TRIPS THAT HAVE A STATUS OF ENROUTE.  THE SHIPMENT STATUS      35370002
353800*  IS CHECKED BEFORE ANY ADDS CAN TAKE PLACE.                     35380002
353900*----------------------------------------------------------------*35390002
354000 4040-CHECK-TRIP-STATUS.                                          35400002
354100                                                                  35410002
354200     PERFORM WITH TEST AFTER                                      35420002
354300         VARYING PV-RETRY-COUNTER                                 35430002
354400         FROM 1 BY 1                                              35440002
354500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 35450002
354600                 OR SQLCODE = 0                                   35460002
354700                 OR SQLCODE = +100)                               35470002
354800                                                                  35480002
354900         EXEC SQL                                                 35490002
355000           SELECT DISTINCT                                        35500002
355100                  A.TRIP_STATUS_CDE                               35510002
355200                 ,A.OPER_UNT_ID                                   35520002
355300                 ,A.FCLTY_ID                                      35530002
355400                 ,B.PRTY_CDE                                      35540002
355500           INTO   :TRIPST-TRIP-STATUS-CDE                         35550002
355600                 ,:TRIPST-OPER-UNT-ID                             35560002
355700                 ,:TRIPST-FCLTY-ID                                35570002
355800                 ,:TRSTYP-PRTY-CDE                                35580002
355900           FROM   TTRIPST A                                       35590002
356000                 ,TTRSTYP B                                       35600002
356100           WHERE  A.TRIP_ID     = :DK-TRIP-ID                     35610002
356200             AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE           35620002
356300             AND  B.PRTY_CDE =                                    35630002
356400                 (SELECT DISTINCT                                 35640002
356500                      MAX(D.PRTY_CDE)                             35650002
356600                   FROM   TTRIPST C                               35660002
356700                         ,TTRSTYP D                               35670002
356800                   WHERE  C.TRIP_ID     = :DK-TRIP-ID             35680002
356900                     AND  C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  35690002
357000         END-EXEC                                                 35700002
357100                                                                  35710002
357200         EVALUATE TRUE                                            35720002
357300             WHEN SQLCODE = ZERO                                  35730002
357400             WHEN SQLCODE = +100                                  35740002
357500             WHEN SQLCODE = -904                                  35750002
357600             WHEN SQLCODE = -913                                  35760002
357700                 CONTINUE                                         35770002
357800             WHEN SQLWARN0 NOT = SPACES                           35780002
357900             WHEN SQLCODE NOT EQUAL ZERO                          35790002
358000                 MOVE '4040-CHECK-TRIP-STATUS'                    35800002
358100                                 TO DP013-PARAGRAPH               35810002
358200                 MOVE 'CHECK TRIP STATUS'                         35820002
358300                                 TO DP013-MESSAGE-TEXT(1)         35830002
358400                 MOVE SHIPMT-TRIP-ID                              35840002
358500                                 TO DP013-MESSAGE-TEXT(2)         35850002
358600                 MOVE SQLCA      TO DP013-SQLCA                   35860002
358700                 MOVE 'TTRIPST'  TO DP013-DB2-TABLE-NAME(1)       35870002
358800                 SET DP013-DB2-ABEND                              35880002
358900                                 TO TRUE                          35890002
359000                 SET DP013-NO-ROLLBACK                            35900002
359100                                 TO TRUE                          35910002
359200                 SET DP013-XCTL-DISPLAY-RESTART                   35920002
359300                                 TO TRUE                          35930002
359400                 PERFORM DP013-0000-PROCESS-ABEND                 35940002
359500         END-EVALUATE                                             35950002
359600     END-PERFORM.                                                 35960002
359700                                                                  35970002
359800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35980002
359900             AND (SQLCODE NOT = +0)                               35990002
360000         MOVE '4040-CHECK-TRIP-STATUS'                            36000002
360100                                 TO DP013-PARAGRAPH               36010002
360200         MOVE 'CHECK TRIP STATUS'  TO DP013-MESSAGE-TEXT(1)       36020002
360300         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    36030002
360400                                 TO DP013-MESSAGE-TEXT(2)         36040002
360500         MOVE SQLCA              TO DP013-SQLCA                   36050002
360600         MOVE 'TTRIPST'          TO DP013-DB2-TABLE-NAME(1)       36060002
360700         SET DP013-DB2-ABEND     TO TRUE                          36070002
360800         SET DP013-NO-ROLLBACK   TO TRUE                          36080002
360900         SET DP013-XCTL-DISPLAY-RESTART                           36090002
361000                                 TO TRUE                          36100002
361100         PERFORM DP013-0000-PROCESS-ABEND                         36110002
361200     END-IF.                                                      36120002
361300                                                                  36130002
361400     EVALUATE TRUE                                                36140002
361500         WHEN SQLCODE = ZERO                                      36150002
361600              IF TRSTYP-PRTY-CDE <= '30'                          36160002
361700                 SET ASC-SHIPT-STATUS-OK TO TRUE                  36170002
361800              ELSE                                                36180002
361900                 SET ASC-SHIPT-STATUS-NOTOK TO TRUE               36190002
362000              END-IF                                              36200002
362100         WHEN SQLCODE = +100                                      36210002
362200              SET ASC-SHIPT-STATUS-NOTOK TO TRUE                  36220002
362300     END-EVALUATE.                                                36230002
362400                                                                  36240002
362500*----------------------------------------------------------------*36250002
362600*  DETERMINE IF THE PO ENTERED IS ALREADY ON THE SHIPMENT.        36260002
362700*----------------------------------------------------------------*36270002
362800 4060-SELECT-TSHPTPO.                                             36280002
362900                                                                  36290002
363000     PERFORM WITH TEST AFTER                                      36300002
363100         VARYING PV-RETRY-COUNTER                                 36310002
363200         FROM 1 BY 1                                              36320002
363300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 36330002
363400                 OR SQLCODE = 0                                   36340002
363500                 OR SQLCODE = +100)                               36350002
363600                                                                  36360002
363700         EXEC SQL                                                 36370002
363800             SELECT REC_SEQ_NBR                                   36380002
363900             INTO   :SHPTPO-REC-SEQ-NBR                           36390002
364000             FROM   TSHPTPO                                       36400002
364100             WHERE  SHIPT_ID    = :ASC-SHIPT-ID                   36410002
364200             AND    PO_NBR      = :DK-PO-NBR                      36420002
364300         END-EXEC                                                 36430002
364400                                                                  36440002
364500         EVALUATE TRUE                                            36450002
364600             WHEN SQLCODE = ZERO                                  36460002
364700                 SET PS-SHPTPO-FOUND TO TRUE                      36470002
364800             WHEN SQLCODE = +100                                  36480002
364900             WHEN SQLCODE = -904                                  36490002
365000             WHEN SQLCODE = -913                                  36500002
365100                 SET PS-SHPTPO-NOT-FOUND TO TRUE                  36510002
365200             WHEN SQLWARN0 NOT = SPACES                           36520002
365300             WHEN SQLCODE NOT EQUAL ZERO                          36530002
365400                 MOVE '4060-SELECT-TSHPTPO'                       36540002
365500                                 TO DP013-PARAGRAPH               36550002
365600                 MOVE 'CHECK SHIPT/PO   '                         36560002
365700                                 TO DP013-MESSAGE-TEXT(1)         36570002
365800                 MOVE ASC-SHIPT-ID TO DP013-MESSAGE-TEXT(2)       36580002
365900                 MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT(3)         36590002
366000                 MOVE SQLCA      TO DP013-SQLCA                   36600002
366100                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME(1)       36610002
366200                 SET DP013-DB2-ABEND                              36620002
366300                                 TO TRUE                          36630002
366400                 SET DP013-NO-ROLLBACK                            36640002
366500                                 TO TRUE                          36650002
366600                 SET DP013-XCTL-DISPLAY-RESTART                   36660002
366700                                 TO TRUE                          36670002
366800                 PERFORM DP013-0000-PROCESS-ABEND                 36680002
366900         END-EVALUATE                                             36690002
367000     END-PERFORM.                                                 36700002
367100                                                                  36710002
367200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         36720002
367300             AND (SQLCODE NOT = +0)                               36730002
367400         MOVE '4050-SELECT-TSHPTPO'                               36740002
367500                                 TO DP013-PARAGRAPH               36750002
367600         MOVE 'CHECK SHIPT/PO   '  TO DP013-MESSAGE-TEXT(1)       36760002
367700         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    36770002
367800                                 TO DP013-MESSAGE-TEXT(2)         36780002
367900         MOVE SQLCA              TO DP013-SQLCA                   36790002
368000         MOVE 'TSHPTPO'          TO DP013-DB2-TABLE-NAME(1)       36800002
368100         SET DP013-DB2-ABEND     TO TRUE                          36810002
368200         SET DP013-NO-ROLLBACK   TO TRUE                          36820002
368300         SET DP013-XCTL-DISPLAY-RESTART                           36830002
368400                                 TO TRUE                          36840002
368500         PERFORM DP013-0000-PROCESS-ABEND                         36850002
368600     END-IF.                                                      36860002
368700                                                                  36870002
368800     IF PS-SHPTPO-FOUND                                           36880002
368900        IF SHPTPO-REC-SEQ-NBR > ZERO                              36890002
369000           MOVE PC-TSYMSG-01053 TO DP020-MSG-NUMBER               36900002
369100           MOVE SHPTPO-REC-SEQ-NBR TO DP020-MSG-TEXT              36910002
369200           MOVE -1              TO APONBRL                        36920002
369300           SET DP030-SET-CURSOR-APPL-1                            36930002
369400               DP020-MSG-FATAL                                    36940002
369500               PS-ERROR                                           36950002
369600               PS-MSG-SET              TO TRUE                    36960002
369700        END-IF                                                    36970002
369800     END-IF.                                                      36980002
369900                                                                  36990002
370000 4065-MOVE-SHIPMENT-INFO.                                         37000002
370100                                                                  37010002
370200     MOVE SHIPMT-PRO-NBR          TO ASC-PRO-NBR.                 37020002
370300     MOVE SHIPMT-BOL-NBR          TO ASC-BOL-NBR.                 37030002
370400     MOVE SHIPMT-PRO-SCAC-ID      TO ASC-SCAC-ID.                 37040002
370500                                                                  37050002
370600     IF SHIPMT-VEND-SHIP-DTE = PC-DEFAULT-DATE                    37060002
370700        MOVE SPACES                  TO ASC-VEND-SHIP-DTE         37070002
370800     ELSE                                                         37080002
370900        MOVE SHIPMT-VEND-SHIP-DTE    TO PV-TEMP-DATE              37090002
371000        MOVE PV-DATE-CCYY            TO ASC-VEND-SHIP-CCYY        37100002
371100        MOVE PV-DATE-MM              TO ASC-VEND-SHIP-MM          37110002
371200        MOVE PV-DATE-DD              TO ASC-VEND-SHIP-DD          37120002
371300     END-IF.                                                      37130002
371400                                                                  37140002
371500     IF VHTRIP-OWNR-SCAC-SHIP-DTE = PC-DEFAULT-DATE               37150002
371600        MOVE SPACES               TO ASC-CARR-SHIP-DTE            37160002
371700     ELSE                                                         37170002
371800        MOVE VHTRIP-OWNR-SCAC-SHIP-DTE                            37180002
371900                                     TO PV-TEMP-DATE              37190002
372000        MOVE PV-DATE-CCYY            TO ASC-CARR-SHIP-CCYY        37200002
372100        MOVE PV-DATE-MM              TO ASC-CARR-SHIP-MM          37210002
372200        MOVE PV-DATE-DD              TO ASC-CARR-SHIP-DD          37220003
372300     END-IF.                                                      37230002
372400                                                                  37240002
372500     IF DN-VEH-NBR = -1                                           37250002
372600        MOVE SPACES               TO ASC-VEH-NBR                  37260002
372700     ELSE                                                         37270002
372800        MOVE VHTRIP-VEH-NBR       TO ASC-VEH-NBR                  37280002
372900     END-IF.                                                      37290002
373000                                                                  37300002
373100/                                                                 37310002
373200*----------------------------------------------------------------*37320002
373300*  RETRIEVE THE PRIMARY VENDOR NAME                               37330002
373400*----------------------------------------------------------------*37340002
373500                                                                  37350002
373600 4070-GET-ENT-NAME-DESC.                                          37360002
373700                                                                  37370002
373800     PERFORM                                                      37380002
373900         WITH TEST AFTER                                          37390002
374000         VARYING PV-RETRY-COUNTER                                 37400002
374100         FROM 1 BY 1                                              37410002
374200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               37420002
374300             OR (SQLCODE = +0)                                    37430002
374400             OR (SQLCODE = +100))                                 37440002
374500                                                                  37450002
374600         EXEC SQL                                                 37460002
374700              SELECT A.DEPT_NBR                                   37470002
374800                    ,A.VER_NBR                                    37480002
374900                    ,B.ENT_NAME_DESC                              37490002
375000                    ,B.ENT_ID                                     37500002
375100                INTO :PURCHS-DEPT-NBR                             37510002
375200                    ,:PURCHS-VER-NBR                              37520002
375300                    ,:ENTNME-ENT-NAME-DESC                        37530002
375400                    ,:ENTNME-ENT-ID                               37540002
375500                FROM TPURCHS A                                    37550002
375600                    ,TENTNME B                                    37560002
375700               WHERE A.PO_NBR         = :DK-PO-NBR                37570002
375800                 AND A.VER_STATUS_CDE = 'A'                       37580002
375900                 AND B.TYPE_CDE       = '01'                      37590002
376000                 AND A.ENT_ID = B.ENT_ID                          37600002
376100         END-EXEC                                                 37610002
376200                                                                  37620002
376300         EVALUATE TRUE                                            37630002
376400             WHEN SQLCODE = +0                                    37640002
376500                  MOVE PURCHS-DEPT-NBR                            37650002
376600                                  TO ASC-DEPT-NBR                 37660002
376700                  MOVE PURCHS-VER-NBR                             37670002
376800                                  TO ASC-VER-NBR                  37680002
376900                  MOVE ENTNME-ENT-NAME-DESC                       37690002
377000                                  TO ASC-ENT-NAME-DESC            37700002
377100                                                                  37710002
377200             WHEN SQLCODE = +100                                  37720002
377300                  MOVE SPACES     TO ASC-DEPT-NBR                 37730002
377400                                     ASC-ENT-NAME-DESC            37740002
377500                  MOVE +1         TO ASC-VER-NBR                  37750002
377600                                                                  37760002
377700             WHEN SQLCODE = -904                                  37770002
377800             WHEN SQLCODE = -913                                  37780002
377900                  CONTINUE                                        37790002
378000                                                                  37800002
378100             WHEN SQLWARN0 NOT = SPACES                           37810002
378200             WHEN SQLCODE < +0                                    37820002
378300             WHEN SQLCODE > +0                                    37830002
378400                  MOVE '4070-GET-ENT-NAME-DESC'                   37840002
378500                                  TO DP013-PARAGRAPH              37850002
378600                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      37860002
378700                                  TO DP013-MESSAGE-TEXT (1)       37870002
378800                  MOVE SQLCA      TO DP013-SQLCA                  37880002
378900                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     37890002
379000                  SET DP013-DB2-ABEND                             37900002
379100                      DP013-XCTL-DISPLAY-RESTART                  37910002
379200                                  TO TRUE                         37920002
379300                  PERFORM DP013-0000-PROCESS-ABEND                37930002
379400         END-EVALUATE                                             37940002
379500     END-PERFORM.                                                 37950002
379600                                                                  37960002
379700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        37970002
379800             AND (SQLCODE NOT = +0)                               37980002
379900         MOVE '4070-GET-ENT-NAME-DESC'                            37990002
380000                                  TO DP013-PARAGRAPH              38000002
380100         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    38010002
380200                                  TO DP013-MESSAGE-TEXT (1)       38020002
380300         MOVE SQLCA               TO DP013-SQLCA                  38030002
380400         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     38040002
380500         SET DP013-DB2-ABEND                                      38050002
380600             DP013-XCTL-DISPLAY-RESTART                           38060002
380700                                  TO TRUE                         38070002
380800         PERFORM DP013-0000-PROCESS-ABEND                         38080002
380900     END-IF.                                                      38090002
381000                                                                  38100002
381100                                                                  38110002
381200** AHP - BEGIN - 04/14/08                                         38120002
381300/                                                                 38130002
381400*----------------------------------------------------------------*38140002
381500*  CHECK FOR REPURPOSE                                            38150002
381600*----------------------------------------------------------------*38160002
381700                                                                  38170002
381800 4080-CHECK-FOR-REPURP.                                           38180002
381900                                                                  38190002
382000     PERFORM                                                      38200002
382100         WITH TEST AFTER                                          38210002
382200         VARYING PV-RETRY-COUNTER                                 38220002
382300         FROM 1 BY 1                                              38230002
382400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38240002
382500                   OR (SQLCODE = +0)                              38250002
382600                   OR (SQLCODE = +100))                           38260002
382700                                                                  38270002
382800         EXEC SQL                                                 38280002
382900            SELECT   COUNT(*)                                     38290002
383000              INTO :PV-DB2-COUNT                                  38300002
383100              FROM                                                38310002
383200                    WST_INTGRTN_TYP  A                            38320002
383300                 ,  WST_ATTR_DEFN    B                            38330002
383400                 ,  WST_ATTR_ELEM    C                            38340002
383500                 ,  WST_ATTR_ELEM    D                            38350002
383600                 ,  WST_ATTR_ELEM    E                            38360002
383700                 ,  WST_ATTR_ELEM    F                            38370002
383800                 ,  WST_ATTR_ELEM    G                            38380002
383900              WHERE                                               38390002
384000                    A.INTGRTN_TYP_CDE   = 'EFCREPURP'             38400002
384100                AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE       38410002
384200                AND B.ATTR_DEFN_SEQ_NBR = 1                       38420002
384300                AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE       38430002
384400                AND C.ATTR_DEFN_SEQ_NBR = 1                       38440002
384500                AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE       38450002
384600                AND D.ATTR_DEFN_SEQ_NBR = 2                       38460002
384700                AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE       38470002
384800                AND E.ATTR_DEFN_SEQ_NBR = 3                       38480002
384900                AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE       38490002
385000                AND F.ATTR_DEFN_SEQ_NBR = 4                       38500002
385100                AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE       38510002
385200                AND G.ATTR_DEFN_SEQ_NBR = 5                       38520002
385300                AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR     38530002
385400                AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR     38540002
385500                AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR     38550002
385600                AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR     38560002
385700                AND C.ATTR_ELEM_NBR     = :DK-DC-OPER-UNT-ID      38570002
385800                AND D.ATTR_ELEM_NBR     = :DK-EFC-OPER-UNT-ID     38580002
385900                AND E.ATTR_ELEM_TXT     = 'Y'                     38590002
386000                AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP       38600002
386100             AND G.ATTR_ELEM_TMST = '9999-09-09-23.59.59.999999'  38610002
386200         END-EXEC                                                 38620002
386300                                                                  38630002
386400***  C.ATTR_ELEM_NBR = 1 = DC NUMBER                              38640002
386500***  D.ATTR_ELEM_NBR = 2 = EFC NUMBER                             38650002
386600                                                                  38660002
386700***  WHEN 810 PROCESING FOR 870, CURR OPER = 810, OPER = 870      38670002
386800                                                                  38680002
386900         EVALUATE TRUE                                            38690002
387000             WHEN SQLCODE = +0                                    38700002
387100             WHEN SQLCODE = +100                                  38710002
387200             WHEN SQLCODE = -904                                  38720002
387300             WHEN SQLCODE = -913                                  38730002
387400                  CONTINUE                                        38740002
387500                                                                  38750002
387600             WHEN SQLWARN0 NOT = SPACES                           38760002
387700             WHEN SQLCODE < +0                                    38770002
387800             WHEN SQLCODE > +0                                    38780002
387900                  MOVE '4080-CHECK-FOR-REPURP'                    38790002
388000                                  TO DP013-PARAGRAPH              38800002
388100                  MOVE 'UNSUCCESSFUL SELECT ON WST_INTGRTN_TYP'   38810002
388200                                  TO DP013-MESSAGE-TEXT (1)       38820002
388300                  MOVE SQLCA      TO DP013-SQLCA                  38830002
388400                  MOVE 'WST_INTGRTN_TYP'                          38840002
388500                                  TO DP013-DB2-TABLE-NAME (1)     38850002
388600                  MOVE 'WST_ATTR_DEFN'                            38860002
388700                                  TO DP013-DB2-TABLE-NAME (2)     38870002
388800                  MOVE 'WST_ATTR_ELEM'                            38880002
388900                                  TO DP013-DB2-TABLE-NAME (3)     38890002
389000                  SET DP013-DB2-ABEND                             38900002
389100                      DP013-XCTL-DISPLAY-RESTART                  38910002
389200                                  TO TRUE                         38920002
389300                  PERFORM DP013-0000-PROCESS-ABEND                38930002
389400         END-EVALUATE                                             38940002
389500     END-PERFORM.                                                 38950002
389600                                                                  38960002
389700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        38970002
389800             AND (SQLCODE = -904 OR -913)                         38980002
389900         MOVE '4080-CHECK-FOR-REPURP'                             38990002
390000                                  TO DP013-PARAGRAPH              39000002
390100         MOVE 'MAX RETRIES EXCEEDED ON COUNT'                     39010002
390200                                  TO DP013-MESSAGE-TEXT (1)       39020002
390300         MOVE SQLCA               TO DP013-SQLCA                  39030002
390400         MOVE 'WST_INTGRTN_TYP'   TO DP013-DB2-TABLE-NAME (1)     39040002
390500         SET DP013-DB2-ABEND                                      39050002
390600             DP013-XCTL-DISPLAY-RESTART                           39060002
390700                                  TO TRUE                         39070002
390800         PERFORM DP013-0000-PROCESS-ABEND                         39080002
390900     END-IF.                                                      39090002
391000                                                                  39100002
391100** AHP -  END - 04/14/08                                          39110002
391200/                                                                 39120002
391300*----------------------------------------------------------------*39130002
391400*    GET THE EARLIEST AD DATE                                    *39140002
391500*----------------------------------------------------------------*39150002
391600 4090-GET-AD-DATE.                                                39160002
391700                                                                  39170002
391800     PERFORM                                                      39180002
391900         WITH TEST AFTER                                          39190002
392000         VARYING PV-RETRY-COUNTER                                 39200002
392100         FROM 1 BY 1                                              39210002
392200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39220002
392300             OR (SQLCODE = +0)                                    39230002
392400             OR (SQLCODE = -305))                                 39240002
392500                                                                  39250002
392600         EXEC SQL                                                 39260002
392700              SELECT MIN(AD_EVNT_DTE)                             39270002
392800                INTO :PURITM-AD-EVNT-DTE                          39280002
392900                       :DN-AD-EVNT-DTE                            39290002
393000                FROM TPURITM                                      39300002
393100               WHERE PO_NBR         = :DK-PO-NBR                  39310002
393200                 AND VER_STATUS_CDE = 'A'                         39320002
393300                 AND AD_EVNT_DTE > '0001-01-01'                   39330002
393400         END-EXEC                                                 39340002
393500                                                                  39350002
393600         EVALUATE TRUE                                            39360002
393700             WHEN SQLCODE = +0                                    39370002
393800                IF  DN-AD-EVNT-DTE = -1                           39380002
393900                    MOVE SPACES           TO ASC-AD-DTE           39390002
394000                ELSE                                              39400002
394100                    MOVE PURITM-AD-EVNT-DTE TO PV-DB2-DATE        39410002
394200                    MOVE PV-DB2-DATE-MM   TO PV-DISPLAY-DATE-MM   39420002
394300                    MOVE PV-DB2-DATE-DD   TO PV-DISPLAY-DATE-DD   39430002
394400                    MOVE PV-DB2-DATE-YY   TO PV-DISPLAY-DATE-YY   39440002
394500                    MOVE PV-DISPLAY-DATE  TO ASC-AD-DTE           39450002
394600                END-IF                                            39460002
394700                                                                  39470002
394800             WHEN SQLCODE = -305                                  39480002
394900                    MOVE SPACES           TO ASC-AD-DTE           39490002
395000                                                                  39500002
395100             WHEN SQLCODE = -904                                  39510002
395200             WHEN SQLCODE = -913                                  39520002
395300                  CONTINUE                                        39530002
395400                                                                  39540002
395500             WHEN SQLWARN0 NOT = SPACES                           39550002
395600             WHEN SQLCODE < +0                                    39560002
395700             WHEN SQLCODE > +0                                    39570002
395800                  MOVE '4090-GET-AD-DATE'                         39580002
395900                                  TO DP013-PARAGRAPH              39590002
396000                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           39600002
396100                                  TO DP013-MESSAGE-TEXT (1)       39610002
396200                  MOVE SQLCA      TO DP013-SQLCA                  39620002
396300                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     39630002
396400                  SET DP013-DB2-ABEND                             39640002
396500                      DP013-XCTL-DISPLAY-RESTART                  39650002
396600                                  TO TRUE                         39660002
396700                  PERFORM DP013-0000-PROCESS-ABEND                39670002
396800         END-EVALUATE                                             39680002
396900     END-PERFORM.                                                 39690002
397000                                                                  39700002
397100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        39710002
397200             AND (SQLCODE NOT = +0)                               39720002
397300         MOVE '4090-GET-AD-DATE'                                  39730002
397400                                  TO DP013-PARAGRAPH              39740002
397500         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            39750002
397600                                  TO DP013-MESSAGE-TEXT (1)       39760002
397700         MOVE SQLCA               TO DP013-SQLCA                  39770002
397800         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     39780002
397900         SET DP013-DB2-ABEND                                      39790002
398000             DP013-XCTL-DISPLAY-RESTART                           39800002
398100                                  TO TRUE                         39810002
398200         PERFORM DP013-0000-PROCESS-ABEND                         39820002
398300     END-IF.                                                      39830002
398400                                                                  39840002
398500                                                                  39850020
398600 4300-GET-TKT-DESC.                                               39860002
398700      EXEC SQL                                                    39870002
398800          SELECT DISTINCT TKT_FMT_DESC                            39880002
398900                INTO :TKTFMT-TKT-FMT-DESC                         39890002
399000              FROM TTKTFMT                                        39900002
399100           WHERE                                                  39910002
399200              TKT_FMT_ID   = :DK-TKT-FMT-ID                       39920002
399300     END-EXEC                                                     39930002
399400                                                                  39940002
399500     EVALUATE TRUE                                                39950002
399600           WHEN SQLCODE = +0                                      39960002
399700             MOVE TKTFMT-TKT-FMT-DESC TO ASC-TKT-DESC             39970002
399800           WHEN SQLCODE = +100                                    39980002
399900                  MOVE SPACES    TO ASC-TKT-DESC                  39990002
400000             WHEN SQLCODE = -904                                  40000002
400100             WHEN SQLCODE = -911                                  40010002
400200             WHEN SQLCODE = -913                                  40020002
400300                  CONTINUE                                        40030002
400400             WHEN SQLWARN0 NOT = SPACES                           40040002
400500             WHEN SQLCODE  NOT = ZERO                             40050002
400600                  MOVE '4300-GET-TKT-DESC'                        40060002
400700                                 TO DP013-PARAGRAPH               40070002
400800                  MOVE 'UNSUCCESSFUL SELECT OF TTKTFMT'           40080002
400900                                 TO DP013-MESSAGE-TEXT (1)        40090002
401000                  MOVE DK-TKT-DESC                                40100002
401100                                 TO DP013-MESSAGE-TEXT (2)        40110002
401200                  MOVE SQLCA     TO DP013-SQLCA                   40120002
401300                  MOVE 'TTKTFMT' TO DP013-DB2-TABLE-NAME (1)      40130002
401400                  SET DP013-DB2-ABEND                             40140002
401500                      DP013-XCTL-DISPLAY-RESTART                  40150002
401600                                 TO TRUE                          40160002
401700                  PERFORM DP013-0000-PROCESS-ABEND                40170002
401800         END-EVALUATE.                                            40180002
401900                                                                  40190002
402000 4105-SELECT-MIN-ITMNBR.                                          40200002
402100     INITIALIZE PS-CALL-API-SW                                    40210002
402200     PERFORM                                                      40220002
402300         WITH TEST AFTER                                          40230002
402400         VARYING PV-RETRY-COUNTER                                 40240002
402500         FROM 1 BY 1                                              40250002
402600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               40260002
402700             OR (SQLCODE = +0)                                    40270002
402800             OR (SQLCODE = +100)                                  40280002
402900             OR (SQLCODE = -305))                                 40290002
403000*                                                                 40300002
403100         EXEC SQL                                                 40310002
403200                 SELECT MIN(ITM_NBR)                              40320002
403300                   INTO :PURITM-ITM-NBR                           40330002
403400                   FROM TPURITM                                   40340002
403500                  WHERE PO_NBR         = :DK-PO-NBR               40350002
403600                    AND VER_STATUS_CDE = 'A'                      40360002
403700         END-EXEC                                                 40370002
403800*                                                                 40380002
403900         EVALUATE TRUE                                            40390002
404000             WHEN SQLCODE = +0                                    40400002
404100                  SET PS-CALL-API-YES TO TRUE                     40410002
404200                                                                  40420002
404300             WHEN SQLCODE = +100                                  40430002
404400             WHEN SQLCODE = -305                                  40440002
404500                  MOVE ZEROES            TO PURITM-ITM-NBR        40450002
404600                                                                  40460002
404700             WHEN SQLCODE = -904                                  40470002
404800             WHEN SQLCODE = -913                                  40480002
404900                  CONTINUE                                        40490002
405000                                                                  40500002
405100             WHEN SQLWARN0 NOT = SPACES                           40510002
405200             WHEN SQLCODE < +0                                    40520002
405300             WHEN SQLCODE > +0                                    40530002
405400                  MOVE '4105-SELECT-TPURITM'                      40540002
405500                                  TO DP013-PARAGRAPH              40550002
405600                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM TABLE'     40560002
405700                                  TO DP013-MESSAGE-TEXT (1)       40570002
405800                  MOVE SQLCA      TO DP013-SQLCA                  40580002
405900                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     40590002
406000                  SET DP013-DB2-ABEND                             40600002
406100                      DP013-XCTL-DISPLAY-RESTART                  40610002
406200                                  TO TRUE                         40620002
406300                  PERFORM DP013-0000-PROCESS-ABEND                40630002
406400         END-EVALUATE                                             40640002
406500     END-PERFORM.                                                 40650002
406600                                                                  40660002
406700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        40670002
406800             AND (SQLCODE NOT = +0)                               40680002
406900         MOVE '4105-SELECT-TPURITM'  TO DP013-PARAGRAPH           40690002
407000         MOVE 'MAX RETRIES EXCEEDED ON SELECT MINIMUM ITEM NUMBER'40700002
407100                                  TO DP013-MESSAGE-TEXT (1)       40710002
407200         MOVE SQLCA               TO DP013-SQLCA                  40720002
407300         MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (1)     40730002
407400         SET DP013-DB2-ABEND                                      40740002
407500             DP013-XCTL-DISPLAY-RESTART                           40750002
407600                                  TO TRUE                         40760002
407700         PERFORM DP013-0000-PROCESS-ABEND                         40770002
407800     END-IF.                                                      40780002
407900                                                                  40790002
408000******************************************************************40800002
408100*                                               **   WR # 230ZZ  *40810002
408200* CODE FOR LOGISTICS DOMAIN ITEM ACCESS MODULE                    40820002
408300******************************************************************40830002
408400                                                                  40840002
408500 4200-CALL-CICS-API-ARCH.                                         40850002
408600                                                                  40860002
408700            MOVE PURITM-ITM-NBR        TO XL001-KEY-ITM-NBR.      40870002
408800                                                                  40880002
408900            SET  XL001-BY-ITEM                                    40890002
409000                 XL001-SELECT-SKU                                 40900002
409100                 XL001-SELECT-VND-STYL TO TRUE.                   40910002
409200                                                                  40920002
409300            CALL XL001-VSM-PGM USING  DFHEIBLK                    40930002
409400                                      XL001-COMMAREA              40940002
409500                                      XL001-ITEM-COMMAREA.        40950002
409600         EVALUATE TRUE                                            40960002
409700                                                                  40970002
409800              WHEN XL001-SUCCESSFUL                               40980002
409900                  MOVE XL001-TKT-TYP-DESC TO                      40990002
410000                                ASC-TKT-DESC                      41000002
410100                                                                  41010002
410200              WHEN XL001-SKU-SQLCODE      =                       41020002
410300                                 (+100 OR -904 OR -913)           41030002
410400              WHEN XL001-VND-STYL-SQLCODE =                       41040002
410500                                 (+100 OR -904 OR -913)           41050002
410600                  MOVE SPACES TO ASC-TKT-DESC                     41060002
410700                                                                  41070002
410800              WHEN OTHER                                          41080002
410900                  MOVE '4200-CALL-CICS-API-ARCH'                  41090002
411000                                 TO DP013-PARAGRAPH               41100002
411100                  MOVE 'UNSUCCESSFUL SELECT OF SKU'               41110002
411200                                 TO DP013-MESSAGE-TEXT (1)        41120002
411300                  IF XL001-SKU-SQLCODE NOT = ZERO                 41130002
411400                      MOVE XL001-SKU-SQLCODE                      41140002
411500                                 TO SQLCODE                       41150002
411600                  ELSE                                            41160002
411700                      MOVE XL001-VND-STYL-SQLCODE                 41170002
411800                                 TO SQLCODE                       41180002
411900                  END-IF                                          41190002
412000                  MOVE SQLCA     TO DP013-SQLCA                   41200002
412100                  MOVE 'SKU VEND' TO DP013-DB2-TABLE-NAME (1)     41210002
412200                  SET DP013-DB2-ABEND                             41220002
412300                      DP013-XCTL-DISPLAY-RESTART                  41230002
412400                                 TO TRUE                          41240002
412500                  PERFORM DP013-0000-PROCESS-ABEND                41250002
412600             END-EVALUATE.                                        41260002
412700                                                                  41270002
412800******************************************************************41280002
412900*  CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        *41290002
413000******************************************************************41300002
413100/                                                                 41310002
413200*----------------------------------------------------------------*41320002
413300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *41330002
413400*----------------------------------------------------------------*41340002
413500                                                                  41350002
413600 4400-MOVE-COMMAREA-TO-SCREEN.                                    41360002
413700                                                                  41370002
413800     MOVE ASC-REC-SEQ-NBR         TO ARECSEQO.                    41380002
413900     MOVE ASC-PO-NBR-N            TO APONBRO.                     41390002
414000     MOVE ASC-TRBL-DESC           TO ATRBLO.                      41400002
414100     MOVE ASC-ENT-NAME-DESC       TO AVNDNMO.                     41410002
414200     MOVE ASC-AP-RCVR-NBR-N       TO AAPRCVRO.                    41420002
414300     MOVE ASC-SCAC-ID             TO ASCACO.                      41430002
414400     MOVE ASC-VEH-NBR             TO ATRLNBRO.                    41440002
414500     MOVE ASC-COMPLETE-PRO-NBR    TO AFBNBRO.                     41450002
414600     MOVE ASC-COMPLETE-BOL-NBR    TO ABOLNBRO.                    41460002
414700     IF ASC-CARR-SHIP-DTE = '01010001'                            41470002
414800        MOVE SPACES               TO ASHPMMO                      41480002
414900                                     ASHPDDO                      41490002
415000                                     ASHPYYO                      41500002
415100     ELSE                                                         41510002
415200        MOVE ASC-CARR-SHIP-MM     TO ASHPMMO                      41520002
415300        MOVE ASC-CARR-SHIP-DD     TO ASHPDDO                      41530002
415400        MOVE ASC-CARR-SHIP-YY     TO ASHPYYO                      41540002
415500     END-IF.                                                      41550002
415600     MOVE ASC-CRE-OPER-UNT-ID     TO AOPERO.                      41560002
415700     MOVE ASC-CURR-OPER-UNT-ID    TO ACURRO.                      41570002
415800     MOVE ASC-CRE-FCLTY-ID        TO AFCLTYO.                     41580002
415900     IF ASC-VEND-SHIP-DTE = '01010001'                            41590002
416000        MOVE SPACES               TO AVSHMMO                      41600002
416100                                     AVSHDDO                      41610002
416200                                     AVSHYYO                      41620002
416300     ELSE                                                         41630002
416400        MOVE ASC-VEND-SHIP-MM     TO AVSHMMO                      41640002
416500        MOVE ASC-VEND-SHIP-DD     TO AVSHDDO                      41650002
416600        MOVE ASC-VEND-SHIP-YY     TO AVSHYYO                      41660002
416700     END-IF.                                                      41670002
416800     MOVE ASC-TKT-DESC            TO ATKTTYPO.                    41680002
416900     MOVE ASC-EXPTED-CART-CNT-N   TO ACRTCNTO.                    41690002
417000* CT 11/11/11 - START WR40574                                     41700010
417100     MOVE ASC-CAN                 TO ACANIDO.                     41710016
417200* CT 11/11/11 - END   WR40574                                     41720010
417300     MOVE ASC-ASN-IND             TO AASNO.                       41730002
417400     MOVE ASC-PKGNG-CDE           TO APKGCDEO.                    41740002
417500     MOVE ASC-AD-DTE              TO AADDTEO.                     41750002
417600     MOVE ASC-PACK-BY-ST-IND      TO ABYSTRO.                     41760002
417700     MOVE ASC-PRE-TICKET-IND      TO APRETKO.                     41770002
417800     MOVE ASC-HANGER-IND          TO AHANGERO.                    41780002
417900                                                                  41790002
418000     IF  ASC-ADD-PENDING                                          41800002
418100         MOVE -1              TO APONBRL                          41810002
418200         SET DP030-SET-CURSOR-APPL-1                              41820002
418300                                  TO TRUE                         41830002
418400     END-IF.                                                      41840002
418500                                                                  41850002
418600*----------------------------------------------------------------*41860002
418700*    THIS COPYBOOK CONTAINS ALL THE LOGIC FOR CREATING A         *41870002
418800*    RECEIVER                                                    *41880002
418900*----------------------------------------------------------------*41890002
419000                                                                  41900002
419100 5000-ADD-RECEIVER.                                               41910002
419200                                                                  41920002
419300     MOVE ASC-PO-NBR         TO DK-PO-NBR.                        41930002
419400     MOVE ASC-REC-SEQ-NBR    TO DK-REC-SEQ-NBR.                   41940002
419500     MOVE ASC-VEH-NBR        TO DK-VEH-NBR.                       41950002
419600     MOVE ASC-SCAC-ID        TO DK-SCAC-ID.                       41960002
419700     MOVE ASC-CRE-OPER-UNT-ID TO DK-OPER-UNT-ID                   41970002
419800     MOVE ASC-CRE-FCLTY-ID   TO DK-FCLTY-ID                       41980002
419900                                                                  41990002
420000     IF  PS-NO-ERROR                                              42000002
420100         PERFORM 5015-GET-MAX-SEQ-NBR                             42010002
420200         MOVE PV-REC-SEQ-NBR  TO ASC-REC-SEQ-NBR                  42020002
420300         PERFORM 5100-BUILD-RECEIVER-INFO                         42030002
420400         IF  PS-NO-ERROR                                          42040002
420500             PERFORM 5300-BUILD-ZERO-LINE-WORK-ORD                42050002
420600         END-IF                                                   42060002
420700     END-IF.                                                      42070002
420800                                                                  42080002
420900     IF  PS-NO-ERROR                                              42090002
421000         IF TM500-NO-TROUBLE                                      42100002
421100             MOVE PC-TSYMSG-00391    TO DP020-MSG-NUMBER          42110002
421200             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            42120002
421300                                        ARECSEQO                  42130002
421400         ELSE                                                     42140002
421500             MOVE PC-TSYMSG-00847    TO DP020-MSG-NUMBER          42150002
421600             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            42160002
421700                                        ARECSEQO                  42170002
421800                                        DK-REC-SEQ-NBR            42180002
421900             PERFORM 5500-GET-SHORT-TROUBLE                       42190002
422000             IF PS-MULT-TROUBLE                                   42200002
422100                MOVE TRBRSN-TRBL-SHT-DESC TO PV-TROUBLE-DESC      42210002
422200                MOVE PV-TROUBLE-DESC-ALL  TO ASC-TRBL-DESC        42220002
422300             ELSE                                                 42230002
422400                MOVE TRBRSN-TRBL-SHT-DESC TO ASC-TRBL-DESC        42240002
422500             END-IF                                               42250002
422600         END-IF                                                   42260002
422700         SET DP020-MSG-INFORMATIONAL                              42270002
422800             ASC-ADD-SUCCESSFUL  TO TRUE                          42280002
422900     END-IF.                                                      42290002
423000                                                                  42300002
423100*----------------------------------------------------------------*42310002
423200* GET THE NEXT HIGHEST RECEIVER SEQ NBR                          *42320002
423300*----------------------------------------------------------------*42330002
423400 5015-GET-MAX-SEQ-NBR.                                            42340002
423500                                                                  42350002
423600     PERFORM                                                      42360002
423700         WITH TEST AFTER                                          42370002
423800         VARYING PV-RETRY-COUNTER                                 42380002
423900         FROM 1 BY 1                                              42390002
424000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               42400002
424100            OR (SQLCODE = +0)                                     42410002
424200            OR (SQLCODE = +100)                                   42420002
424300            OR (SQLCODE = -305))                                  42430002
424400                                                                  42440002
424500         EXEC SQL                                                 42450002
424600           SELECT MAX(REC_SEQ_NBR)                                42460002
424700           INTO  :RECEIV-REC-SEQ-NBR                              42470002
424800           FROM   TRECEIV                                         42480002
424900           WHERE  ORD_NBR = :DK-PO-NBR                            42490002
425000         END-EXEC                                                 42500002
425100                                                                  42510002
425200         EVALUATE TRUE                                            42520002
425300             WHEN SQLCODE = +0                                    42530002
425400                 MOVE RECEIV-REC-SEQ-NBR                          42540002
425500                                 TO PV-REC-SEQ-NBR                42550002
425600                 ADD +1          TO PV-REC-SEQ-NBR                42560002
425700                                                                  42570002
425800             WHEN SQLCODE = +100                                  42580002
425900             WHEN SQLCODE = -305                                  42590002
426000                 MOVE +1         TO PV-REC-SEQ-NBR                42600002
426100                                                                  42610002
426200             WHEN SQLCODE = -904                                  42620002
426300             WHEN SQLCODE = -913                                  42630002
426400                 CONTINUE                                         42640002
426500                                                                  42650002
426600             WHEN SQLWARN0 NOT = SPACE                            42660002
426700             WHEN SQLCODE < +0                                    42670002
426800             WHEN SQLCODE > +0                                    42680002
426900                 MOVE '5015-GET-MAX-SEQ-NBR  '                    42690002
427000                                 TO DP013-PARAGRAPH               42700002
427100                 MOVE 'SELECT MAX ON RECEIPTS TABLE'              42710002
427200                                 TO DP013-MESSAGE-TEXT (1)        42720002
427300                 MOVE SQLCA      TO DP013-SQLCA                   42730002
427400                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      42740002
427500                     SET DP013-DB2-ABEND                          42750002
427600                         DP013-XCTL-DISPLAY-RESTART               42760002
427700                                     TO TRUE                      42770002
427800                 PERFORM DP013-0000-PROCESS-ABEND                 42780002
427900         END-EVALUATE                                             42790002
428000     END-PERFORM.                                                 42800002
428100                                                                  42810002
428200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        42820002
428300             AND (SQLCODE NOT = +0)                               42830002
428400         MOVE '5015-GET-MAX-SEQ-NBR  '                            42840002
428500                                  TO DP013-PARAGRAPH              42850002
428600         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV'         42860002
428700                                  TO DP013-MESSAGE-TEXT (1)       42870002
428800         MOVE SQLCA               TO DP013-SQLCA                  42880002
428900         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     42890002
429000         SET DP013-DB2-ABEND                                      42900002
429100             DP013-XCTL-DISPLAY-RESTART                           42910002
429200                                  TO TRUE                         42920002
429300         PERFORM DP013-0000-PROCESS-ABEND                         42930002
429400     END-IF.                                                      42940002
429500                                                                  42950002
429600*---------------------------------------------------------------* 42960002
429700*  LOAD THE RECEIV FIELDS, PERFORM THE INSERT TO THE TRECEIV    * 42970002
429800*  TABLE, AND CHECK FOR TROUBLE.                                * 42980002
429900*---------------------------------------------------------------* 42990002
430000 5100-BUILD-RECEIVER-INFO.                                        43000002
430100                                                                  43010002
430200     INITIALIZE DCLTRECEIV.                                       43020002
430300                                                                  43030002
430400     MOVE ASC-PO-NBR-N           TO RECEIV-ORD-NBR.               43040002
430500     MOVE ASC-REC-SEQ-NBR        TO RECEIV-REC-SEQ-NBR            43050002
430600                                    RECEIV-REFER-BACK-SEQ-NBR.    43060002
430700     MOVE ASC-VER-NBR            TO RECEIV-PO-VER-NBR.            43070002
430800     MOVE ASC-CRE-OPER-UNT-ID    TO RECEIV-OPER-UNT-ID.           43080002
430900     MOVE ASC-CRE-FCLTY-ID       TO RECEIV-FCLTY-ID.              43090002
431000     MOVE 'IP'                   TO RECEIV-STATUS-CDE.            43100002
431100     MOVE 'P'                    TO RECEIV-SYST-CRE-CDE.          43110002
431200     MOVE 'MR'                   TO RECEIV-REC-TYP-CDE.           43120002
431300     MOVE 'A'                    TO RECEIV-VER-STATUS-CDE.        43130002
431400     MOVE ASC-HANGER-IND         TO RECEIV-GOH-IND.               43140002
431500     MOVE ASC-PRE-TICKET-IND     TO RECEIV-PRE-TKT-IND.           43150002
431600     MOVE ASC-PACK-BY-ST-IND     TO RECEIV-PACK-BY-ST-IND.        43160002
431700     MOVE ASC-EXPTED-CART-CNT-N  TO RECEIV-EXPTED-CART-CNT.       43170002
431800     MOVE ZERO                   TO RECEIV-ACTL-CART-CNT.         43180002
431900     MOVE '9999-09-09'           TO RECEIV-AP-PRC-DTE.            43190002
432000     MOVE '9999-09-09-09.09.09.999999'                            43200002
432100                                 TO RECEIV-ML-POST-TMST           43210002
432200                                    RECEIV-FS-POST-TMST           43220002
432300                                    RECEIV-IN-TRBL-TMST           43230002
432400                                    RECEIV-VERFYD-TMST            43240002
432500                                    RECEIV-REC-TMST               43250002
432600                                    RECEIV-MKNG-APRN-PRT-TMST.    43260002
432700                                                                  43270002
432800     MOVE DP020-LOCATION-NBR      TO RECEIV-CURR-OPER-UNT-ID.     43280002
432900                                                                  43290002
433000     IF RECEIV-CURR-OPER-UNT-ID > ZEROES                          43300002
433100         MOVE RECEIV-CURR-OPER-UNT-ID    TO PV-TEMP-OPER-UNT      43310002
433200                                                                  43320002
433300             PERFORM 3010-VALIDATE-OPER-UNT-ID                    43330002
433400             IF PS-INVALID-LOC                                    43340002
433500                 SET PS-ERROR                                     43350002
433600                     DP020-MSG-FATAL     TO TRUE                  43360002
433700                 MOVE PC-TSYMSG-03337    TO DP020-MSG-NUMBER      43370002
433800                 MOVE DP015-UNP-ALP-BRT-OFF                       43380002
433900                                         TO AOPERA                43390002
434000                 MOVE DP015-RED          TO AOPERC                43400002
434100                 MOVE DP015-REVERSE      TO AOPERH                43410002
434200                 MOVE -1                 TO AOPERL                43420002
434300                 SET DP030-SET-CURSOR-APPL-1                      43430002
434400                                         TO TRUE                  43440002
434500             END-IF                                               43450002
434600     ELSE                                                         43460002
434700         IF RECEIV-CURR-OPER-UNT-ID = ZEROES                      43470002
434800             SET PS-ERROR                                         43480002
434900                 DP020-MSG-FATAL         TO TRUE                  43490002
435000             MOVE PC-TSYMSG-03336        TO DP020-MSG-NUMBER      43500002
435100             MOVE DP015-UNP-ALP-BRT-OFF                           43510002
435200                                         TO AOPERA                43520002
435300             MOVE DP015-RED              TO AOPERC                43530002
435400                 MOVE DP015-REVERSE      TO AOPERH                43540002
435500                 MOVE -1                 TO AOPERL                43550002
435600                 SET DP030-SET-CURSOR-APPL-1                      43560002
435700                                         TO TRUE                  43570002
435800         END-IF                                                   43580002
435900     END-IF.                                                      43590002
436000                                                                  43600002
436100     MOVE ASC-CRE-OPER-UNT-ID     TO RECEIV-CRE-OPER-UNT-ID.      43610002
436200     MOVE DP020-FCLTY-ID          TO RECEIV-CURR-FCLTY-ID.        43620002
436300     MOVE ASC-CRE-FCLTY-ID        TO RECEIV-CRE-FCLTY-ID.         43630002
436400     MOVE DP020-USERID            TO RECEIV-UPD-UID.              43640002
436500     MOVE PC-CURRENT-PROGRAM-NAME TO RECEIV-UPD-PGM-ID.           43650002
436600     MOVE ASC-PKGNG-CDE           TO RECEIV-PKGNG-CDE.            43660002
436700                                                                  43670002
436800     MOVE SPACES                 TO RECEIV-RCVG-CLERK-INIT-ID.    43680002
436900                                                                  43690002
437000                                                                  43700002
437100     IF  ASC-AP-RCVR-NBR = (SPACES OR ZEROES)                     43710002
437200         SET PS-RCVR-FOUND TO TRUE                                43720002
437300         PERFORM VARYING PV-COUNT FROM 1 BY 1 UNTIL               43730002
437400              PV-COUNT > 10 OR PS-NO-RCVR-FOUND                   43740002
437500             PERFORM 5120-OPEN-TRECVER-CSR                        43750002
437600             PERFORM 5125-FETCH-TRECVER-CSR                       43760002
437700                                                                  43770002
437800             MOVE RECVER-MAX-RCVR-NBR  TO PW-CONTROL-PANL-NBR-9   43780002
437900             DIVIDE PW-CONTROL-PANL-NBR-9 BY 9 GIVING PW-QUOTIENT 43790002
438000                                           REMAINDER  PW-REMAINDER43800002
438100             COMPUTE PW-CONTROL-CEHCK-DIG = ( 9 - PW-REMAINDER )  43810002
438200             COMPUTE RECEIV-RCVR-NBR = PW-CONTROL-KEYREC-9 * 1    43820002
438300             MOVE PW-CONTROL-KEYREC-9  TO ASC-AP-RCVR-NBR-N       43830002
438400                                          AAPRCVRO                43840002
438500             ADD +1                    TO RECVER-MAX-RCVR-NBR     43850002
438600             PERFORM 5130-DELETE-TRECVER-CSR                      43860002
438700             PERFORM 5135-INSERT-TRECVER                          43870002
438800             PERFORM 5140-CLOSE-TRECVER-CSR                       43880002
438900             INITIALIZE PV-DB2-COUNT                              43890002
439000             MOVE RECEIV-RCVR-NBR      TO DK-RCVR-NBR             43900002
439100*            PERFORM 3150-CHECK-DUPL-RCVR-NBR                     43910002
439200         END-PERFORM                                              43920002
439300**       IF PS-RCVR-FOUND                                         43930002
439400**           MOVE '5100-BUILD-RECEIVER-INFO'                      43940002
439500**                                    TO DP013-PARAGRAPH          43950002
439600**           MOVE 'MAX RETRIES EXCEEDED ON TRECVER CURSOR'        43960002
439700**                                    TO DP013-MESSAGE-TEXT (1)   43970002
439800**           MOVE SQLCA               TO DP013-SQLCA              43980002
439900**           MOVE 'TRECVER '          TO DP013-DB2-TABLE-NAME (1) 43990002
440000**           SET DP013-DB2-ABEND                                  44000002
440100**               DP013-XCTL-DISPLAY-RESTART                       44010002
440200**                                    TO TRUE                     44020002
440300**           PERFORM DP013-0000-PROCESS-ABEND                     44030002
440400**       END-IF                                                   44040002
440500     ELSE                                                         44050002
440600         MOVE ASC-AP-RCVR-NBR-N    TO RECEIV-RCVR-NBR             44060002
440700         MOVE RECEIV-RCVR-NBR      TO DK-RCVR-NBR                 44070002
440800     END-IF.                                                      44080002
440900                                                                  44090002
441000     IF  PS-NO-ERROR                                              44100002
441100         PERFORM 5110-INSERT-TRECEIV                              44110002
441200         IF SQLCODE = ZERO                                        44120002
441300             PERFORM 5111-INSERT-TPOSYNC                          44130002
441400         END-IF                                                   44140002
441500         PERFORM 5150-CHECK-FOR-TROUBLE                           44150002
441600     END-IF.                                                      44160002
441700                                                                  44170002
441800/                                                                 44180002
441900*---------------------------------------------------------------* 44190002
442000*  PERFORMS THE ACTUAL INSERT TO THE TRECEIV TABLE.             * 44200002
442100*---------------------------------------------------------------* 44210002
442200 5110-INSERT-TRECEIV.                                             44220002
442300                                                                  44230002
442400     PERFORM                                                      44240002
442500         WITH TEST AFTER                                          44250002
442600         VARYING PV-RETRY-COUNTER                                 44260002
442700         FROM 1 BY 1                                              44270002
442800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               44280002
442900             OR (SQLCODE = +0))                                   44290002
443000                                                                  44300002
443100         EXEC SQL                                                 44310002
443200              INSERT INTO TRECEIV                                 44320002
443300                     ( ORD_NBR                                    44330002
443400                      ,REC_SEQ_NBR                                44340002
443500                      ,CRE_TMST                                   44350002
443600                      ,CRE_UID                                    44360002
443700                      ,PO_VER_NBR                                 44370002
443800                      ,OPER_UNT_ID                                44380002
443900                      ,FCLTY_ID                                   44390002
444000                      ,STATUS_CDE                                 44400002
444100                      ,SYST_CRE_CDE                               44410002
444200                      ,REC_TYP_CDE                                44420002
444300                      ,VER_STATUS_CDE                             44430002
444400                      ,PACK_BY_ST_IND                             44440002
444500                      ,REC_TMST                                   44450002
444600                      ,EXPTED_CART_CNT                            44460002
444700                      ,ACTL_CART_CNT                              44470002
444800                      ,EXPTED_ITM_QTY                             44480002
444900                      ,ACTL_ITM_QTY                               44490002
445000                      ,RCVR_NBR                                   44500002
445100                      ,ML_POST_TMST                               44510002
445200                      ,FS_POST_TMST                               44520002
445300                      ,PRE_TKT_IND                                44530002
445400                      ,AD_INFO_DESC                               44540002
445500                      ,IN_TRBL_TMST                               44550002
445600                      ,IN_TRBL_MIN_CNT                            44560002
445700                      ,IN_TRBL_HOUR_CNT                           44570002
445800                      ,VERFYD_TMST                                44580002
445900                      ,RCVG_CLERK_INIT_ID                         44590002
446000                      ,REFER_BACK_SEQ_NBR                         44600002
446100                      ,AP_PRC_CDE                                 44610002
446200                      ,AP_PRC_DTE                                 44620002
446300                      ,MIS_DIRECT_IND                             44630002
446400                      ,IMPRT_IND                                  44640002
446500                      ,CRE_OPER_UNT_ID                            44650002
446600                      ,CRE_FCLTY_ID                               44660002
446700                      ,CURR_OPER_UNT_ID                           44670002
446800                      ,CURR_FCLTY_ID                              44680002
446900                      ,UPD_TMST                                   44690002
447000                      ,UPD_UID                                    44700002
447100                      ,UPD_PGM_ID                                 44710002
447200                      ,MKNG_APRN_PRT_TMST                         44720002
447300                      ,GOH_IND                                    44730002
447400                      ,AP_RVRSL_DTE                               44740002
447500                      ,PKGNG_CDE                                  44750002
447600                      )                                           44760002
447700             VALUES ( :RECEIV-ORD-NBR                             44770002
447800                     ,:RECEIV-REC-SEQ-NBR                         44780002
447900                     ,CURRENT TIMESTAMP                           44790002
448000                     ,:DP020-USERID                               44800002
448100                     ,:RECEIV-PO-VER-NBR                          44810002
448200                     ,:RECEIV-OPER-UNT-ID                         44820002
448300                     ,:RECEIV-FCLTY-ID                            44830002
448400                     ,:RECEIV-STATUS-CDE                          44840002
448500                     ,:RECEIV-SYST-CRE-CDE                        44850002
448600                     ,:RECEIV-REC-TYP-CDE                         44860002
448700                     ,:RECEIV-VER-STATUS-CDE                      44870002
448800                     ,:RECEIV-PACK-BY-ST-IND                      44880002
448900                     ,:RECEIV-REC-TMST                            44890002
449000                     ,:RECEIV-EXPTED-CART-CNT                     44900002
449100                     ,:RECEIV-ACTL-CART-CNT                       44910002
449200                     ,:RECEIV-EXPTED-ITM-QTY                      44920002
449300                     ,:RECEIV-ACTL-ITM-QTY                        44930002
449400                     ,:RECEIV-RCVR-NBR                            44940002
449500                     ,:RECEIV-ML-POST-TMST                        44950002
449600                     ,:RECEIV-FS-POST-TMST                        44960002
449700                     ,:RECEIV-PRE-TKT-IND                         44970002
449800                     ,:RECEIV-AD-INFO-DESC                        44980002
449900                     ,:RECEIV-IN-TRBL-TMST                        44990002
450000                     ,:RECEIV-IN-TRBL-MIN-CNT                     45000002
450100                     ,:RECEIV-IN-TRBL-HOUR-CNT                    45010002
450200                     ,:RECEIV-VERFYD-TMST                         45020002
450300                     ,:RECEIV-RCVG-CLERK-INIT-ID                  45030002
450400                     ,:RECEIV-REFER-BACK-SEQ-NBR                  45040002
450500                     ,:RECEIV-AP-PRC-CDE                          45050002
450600                     ,:RECEIV-AP-PRC-DTE                          45060002
450700                     ,:RECEIV-MIS-DIRECT-IND                      45070002
450800                     ,:RECEIV-IMPRT-IND                           45080002
450900                     ,:RECEIV-CRE-OPER-UNT-ID                     45090002
451000                     ,:RECEIV-CRE-FCLTY-ID                        45100002
451100                     ,:RECEIV-CURR-OPER-UNT-ID                    45110002
451200                     ,:RECEIV-CURR-FCLTY-ID                       45120002
451300                     ,CURRENT TIMESTAMP                           45130002
451400                     ,:RECEIV-UPD-UID                             45140002
451500                     ,:RECEIV-UPD-PGM-ID                          45150002
451600                     ,:RECEIV-MKNG-APRN-PRT-TMST                  45160002
451700                     ,:RECEIV-GOH-IND                             45170002
451800                     ,:PC-DEFAULT-9DATE                           45180002
451900                     ,:RECEIV-PKGNG-CDE                           45190002
452000                     )                                            45200002
452100         END-EXEC                                                 45210002
452200                                                                  45220002
452300         EVALUATE TRUE                                            45230002
452400             WHEN SQLCODE = +0                                    45240002
452410                 PERFORM 5115-INSERT-PO-TRACK                     45241042
452500             WHEN SQLCODE = -904                                  45250002
452600             WHEN SQLCODE = -913                                  45260002
452700                 CONTINUE                                         45270002
452800                                                                  45280002
452900             WHEN SQLWARN0 NOT = SPACE                            45290002
453000             WHEN SQLCODE < +0                                    45300002
453100             WHEN SQLCODE > +0                                    45310002
453200                 MOVE '5110-INSERT-TRECEIV'                       45320002
453300                                 TO DP013-PARAGRAPH               45330002
453400                 MOVE 'INSERT ON RECEIPTS TABLE'                  45340002
453500                                 TO DP013-MESSAGE-TEXT (1)        45350002
453600                 MOVE SQLCA      TO DP013-SQLCA                   45360002
453700                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      45370002
453800                     SET DP013-DB2-ABEND                          45380002
453900                         DP013-XCTL-DISPLAY-RESTART               45390002
454000                                     TO TRUE                      45400002
454100                 PERFORM DP013-0000-PROCESS-ABEND                 45410002
454200         END-EVALUATE                                             45420002
454300     END-PERFORM.                                                 45430002
454400                                                                  45440002
454500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45450002
454600             AND (SQLCODE NOT = +0)                               45460002
454700         MOVE '5110-INSERT-TRECEIV'                               45470002
454800                                  TO DP013-PARAGRAPH              45480002
454900         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECEIV'         45490002
455000                                  TO DP013-MESSAGE-TEXT (1)       45500002
455100         MOVE SQLCA               TO DP013-SQLCA                  45510002
455200         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     45520002
455300         SET DP013-DB2-ABEND                                      45530002
455400             DP013-XCTL-DISPLAY-RESTART                           45540002
455500                                  TO TRUE                         45550002
455600         PERFORM DP013-0000-PROCESS-ABEND                         45560002
455700     END-IF.                                                      45570002
455800                                                                  45580002
455900/                                                                 45590002
456000 5111-INSERT-TPOSYNC.                                             45600002
456100     EXEC SQL                                                     45610002
456200         INSERT INTO TPOSYNC                                      45620002
456300           ( PO_NBR                                               45630002
456400            ,LAST_SYNC_TMST                                       45640002
456500            ,SYNC_STAT_CDE                                        45650002
456600           )                                                      45660002
456700         VALUES                                                   45670002
456800           ( :RECEIV-ORD-NBR                                      45680002
456900           , CURRENT TIMESTAMP                                    45690002
457000           , 'N'                                                  45700002
457100           )                                                      45710002
457200     END-EXEC                                                     45720002
457300                                                                  45730002
457400     EVALUATE TRUE                                                45740002
457500         WHEN SQLCODE = ZERO                                      45750002
457600         WHEN SQLCODE = -803                                      45760002
457700                 CONTINUE                                         45770002
457800         WHEN SQLCODE = -904                                      45780002
457900         WHEN SQLCODE = -913                                      45790002
458000         WHEN SQLCODE = -911                                      45800002
458100         MOVE '5111-INSERT-TPOSYNC'                               45810002
458200                                 TO DP013-PARAGRAPH               45820002
458300         MOVE 'DB2 TIMEOUT ON INSERT ON TPOSYNC'                  45830002
458400                                  TO DP013-MESSAGE-TEXT (1)       45840002
458500         MOVE SQLCA               TO DP013-SQLCA                  45850002
458600         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     45860002
458700         SET DP013-DB2-ABEND                                      45870002
458800             DP013-XCTL-DISPLAY-RESTART                           45880002
458900                                  TO TRUE                         45890002
459000         PERFORM DP013-0000-PROCESS-ABEND                         45900002
459100                                                                  45910002
459200         WHEN SQLWARN0 NOT = SPACE                                45920002
459300         WHEN SQLCODE < ZERO                                      45930002
459400         WHEN SQLCODE > ZERO                                      45940002
459500             MOVE '5111-INSERT-TPOSYNC'                           45950002
459600                                 TO DP013-PARAGRAPH               45960002
459700             MOVE 'INSERT ON POSYNC TABLE'                        45970002
459800                                 TO DP013-MESSAGE-TEXT (1)        45980002
459900             MOVE SQLCA      TO DP013-SQLCA                       45990002
460000             MOVE 'TPOSYNC'  TO DP013-DB2-TABLE-NAME (1)          46000002
460100             SET DP013-DB2-ABEND                                  46010002
460200                 DP013-XCTL-DISPLAY-RESTART                       46020002
460300                                     TO TRUE                      46030002
460400             PERFORM DP013-0000-PROCESS-ABEND                     46040002
460500     END-EVALUATE.                                                46050002
460600/                                                                 46060002
460610                                                                  46061042
460620 5115-INSERT-PO-TRACK.                                            46062042
460630                                                                  46063042
460631     MOVE RECEIV-ORD-NBR           TO  RCT00017-PO-NBR.           46063142
460632     MOVE RECEIV-REC-SEQ-NBR       TO  RCT00017-RCVR-SEQ-NBR.     46063242
460640     MOVE RECEIV-OPER-UNT-ID       TO  RCT00017-LOC-NBR.          46064042
460641     MOVE ZEROES                   TO  RCT00017-DEST-LOC-NBR.     46064142
460642     MOVE '0N'                     TO  RCT00017-DC-FUNC-CDE.      46064244
460650     MOVE DP020-USERID             TO  RCT00017-CRE-BY-USR-ID.    46065042
460660     MOVE 'RCKCS266'               TO  RCT00017-CRE-BY-PGM-NM.    46066042
460670     MOVE 0                        TO  RCT00017-PO-LNE-NBR        46067042
460680                                       RCT00017-PREPK-ID          46068042
460690                                       RCT00017-QTY-TRKD-NBR      46069042
460691                                       RCT00017-PKSL-SEQ-NBR.     46069142
460692                                                                  46069242
460693     EXEC SQL                                                     46069342
460694          INSERT INTO RCT_PO_RCVR_TRKG                            46069442
460695                 ( PO_NBR                                         46069542
460696                  ,RCVR_SEQ_NBR                                   46069642
460697                  ,CRE_BY_USR_ID                                  46069742
460698                  ,CRE_TMST                                       46069842
460699                  ,DC_FUNC_CDE                                    46069942
460700                  ,LOC_NBR                                        46070042
460701                  ,PO_LNE_NBR                                     46070142
460702                  ,PREPK_ID                                       46070242
460703                  ,CRE_BY_PGM_NM                                  46070342
460704                  ,QTY_TRKD_NBR                                   46070442
460705                  ,LAST_UPD_TMST                                  46070542
460706                  ,PKSL_SEQ_NBR                                   46070642
460707                  ,DEST_LOC_NBR                                   46070742
460708                  )                                               46070842
460709         VALUES ( :RCT00017-PO-NBR                                46070942
460710                 ,:RCT00017-RCVR-SEQ-NBR                          46071042
460711                 ,:RCT00017-CRE-BY-USR-ID                         46071142
460712                 , CURRENT TIMESTAMP                              46071242
460713                 ,:RCT00017-DC-FUNC-CDE                           46071342
460714                 ,:RCT00017-LOC-NBR                               46071442
460715                 ,:RCT00017-PO-LNE-NBR                            46071542
460716                 ,:RCT00017-PREPK-ID                              46071642
460717                 ,:RCT00017-CRE-BY-PGM-NM                         46071742
460718                 ,:RCT00017-QTY-TRKD-NBR                          46071842
460719                 , CURRENT TIMESTAMP                              46071942
460720                 ,:RCT00017-PKSL-SEQ-NBR                          46072042
460721                 ,:RCT00017-DEST-LOC-NBR                          46072142
460722                 )                                                46072242
460723     END-EXEC.                                                    46072342
460724                                                                  46072442
460725     EVALUATE TRUE                                                46072542
460726         WHEN SQLCODE = +0                                        46072642
460727             CONTINUE                                             46072742
460728                                                                  46072842
460729         WHEN SQLWARN0 NOT = SPACE                                46072942
460730         WHEN SQLCODE < +0                                        46073042
460731         WHEN SQLCODE > +0                                        46073142
460732                                                                  46073242
460733             MOVE RCT00017-LOC-NBR      TO PV-DISP-OPER           46073342
460734             MOVE RCT00017-PO-NBR       TO PV-DISP-PO             46073442
460735             MOVE RCT00017-RCVR-SEQ-NBR TO PV-DISP-RCVR           46073542
460736                                                                  46073642
460737             MOVE '5115-INSERT-PO-TRACK'                          46073742
460738                             TO DP013-PARAGRAPH                   46073842
460739             MOVE 'INSERT PO TRACKING TABLE'                      46073942
460740                             TO DP013-MESSAGE-TEXT (1)            46074042
460741             STRING PV-DISP-OPER '-'                              46074142
460742                    PV-DISP-PO   '-'                              46074242
460743                    PV-DISP-RCVR                                  46074342
460744                    '  FUNC:' RCT00017-DC-FUNC-CDE                46074442
460745                                  DELIMITED BY SIZE               46074542
460746                             INTO DP013-MESSAGE-TEXT (2)          46074642
460747             MOVE SQLCA      TO DP013-SQLCA                       46074742
460748             MOVE 'RCT00017'  TO DP013-DB2-TABLE-NAME (1)         46074842
460749                 SET DP013-DB2-ABEND                              46074942
460750                     DP013-XCTL-DISPLAY-RESTART                   46075042
460751                                 TO TRUE                          46075142
460752             PERFORM DP013-0000-PROCESS-ABEND                     46075242
460753     END-EVALUATE.                                                46075342
460754                                                                  46075442
460755                                                                  46075542
460760*----------------------------------------------------------------*46076002
460800* OPEN THE TRECVER CURSOR                                        *46080002
460900*----------------------------------------------------------------*46090002
461000                                                                  46100002
461100 5120-OPEN-TRECVER-CSR.                                           46110002
461200                                                                  46120002
461300     EXEC SQL                                                     46130002
461400          DECLARE TRECVER-CSR CURSOR FOR                          46140002
461500           SELECT MAX_RCVR_NBR                                    46150002
461600           FROM   TRECVER                                         46160002
461700           WHERE  OPERCO_NBR = '03'                               46170002
461800           FOR UPDATE OF MAX_RCVR_NBR                             46180002
461900     END-EXEC.                                                    46190002
462000                                                                  46200002
462100     PERFORM                                                      46210002
462200         WITH TEST AFTER                                          46220002
462300         VARYING PV-RETRY-COUNTER                                 46230002
462400         FROM 1 BY 1                                              46240002
462500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               46250002
462600            OR (SQLCODE = +0))                                    46260002
462700                                                                  46270002
462800         EXEC SQL                                                 46280002
462900              OPEN TRECVER-CSR                                    46290002
463000         END-EXEC                                                 46300002
463100                                                                  46310002
463200         EVALUATE TRUE                                            46320002
463300             WHEN SQLCODE = +0                                    46330002
463400                  CONTINUE                                        46340002
463500             WHEN SQLCODE = -904                                  46350002
463600             WHEN SQLCODE = -913                                  46360002
463700                  CONTINUE                                        46370002
463800             WHEN SQLWARN0 NOT = SPACE                            46380002
463900             WHEN SQLCODE  NOT = +0                               46390002
464000                  MOVE '5120-OPEN-TRECVER-CSR'                    46400002
464100                                   TO DP013-PARAGRAPH             46410002
464200                  MOVE 'OPEN TRECVER CURSOR'                      46420002
464300                                   TO DP013-MESSAGE-TEXT (1)      46430002
464400                  MOVE SQLCA       TO DP013-SQLCA                 46440002
464500                  MOVE 'TRECVER'   TO DP013-DB2-TABLE-NAME (1)    46450002
464600                  SET DP013-DB2-ABEND                             46460002
464700                                   TO TRUE                        46470002
464800                  PERFORM DP013-0000-PROCESS-ABEND                46480002
464900         END-EVALUATE                                             46490002
465000     END-PERFORM.                                                 46500002
465100                                                                  46510002
465200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        46520002
465300             AND (SQLCODE NOT = +0)                               46530002
465400         MOVE '5120-OPEN-TRECVER-CSR' TO DP013-PARAGRAPH          46540002
465500         MOVE 'MAX RETRIES EXCEEDED FOR OPEN TRECVER CURSOR'      46550002
465600                                   TO DP013-MESSAGE-TEXT (1)      46560002
465700         MOVE SQLCA                TO DP013-SQLCA                 46570002
465800         SET DP013-DB2-ABEND       TO TRUE                        46580002
465900         PERFORM DP013-0000-PROCESS-ABEND                         46590002
466000     END-IF.                                                      46600002
466100                                                                  46610002
466200/                                                                 46620002
466300*----------------------------------------------------------------*46630002
466400*    FETCH A TRECVER ROW                                         *46640002
466500*----------------------------------------------------------------*46650002
466600                                                                  46660002
466700 5125-FETCH-TRECVER-CSR.                                          46670002
466800                                                                  46680002
466900     EXEC SQL                                                     46690002
467000          FETCH TRECVER-CSR                                       46700002
467100          INTO :RECVER-MAX-RCVR-NBR                               46710002
467200     END-EXEC                                                     46720002
467300                                                                  46730002
467400     EVALUATE TRUE                                                46740002
467500         WHEN SQLCODE = +0                                        46750002
467600              CONTINUE                                            46760002
467700                                                                  46770002
467800         WHEN SQLCODE = +100                                      46780002
467900              SET PS-EOF-TRECVER-CSR TO TRUE                      46790002
468000                                                                  46800002
468100         WHEN SQLWARN0 NOT = SPACE                                46810002
468200         WHEN SQLCODE < +0                                        46820002
468300         WHEN SQLCODE > +0                                        46830002
468400              MOVE '5125-FETCH-TRECVER-CSR'                       46840002
468500                                   TO DP013-PARAGRAPH             46850002
468600              MOVE 'FETCH TRECVER CURSOR'                         46860002
468700                                   TO DP013-MESSAGE-TEXT (1)      46870002
468800              MOVE SQLCA           TO DP013-SQLCA                 46880002
468900              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    46890002
469000              SET DP013-DB2-ABEND  TO TRUE                        46900002
469100              PERFORM DP013-0000-PROCESS-ABEND                    46910002
469200     END-EVALUATE.                                                46920002
469300                                                                  46930002
469400/                                                                 46940002
469500*----------------------------------------------------------------*46950002
469600*    UDPATE CURRENT CURSOR                                       *46960002
469700*----------------------------------------------------------------*46970002
469800                                                                  46980002
469900 5130-DELETE-TRECVER-CSR.                                         46990002
470000                                                                  47000002
470100     EXEC SQL                                                     47010002
470200          DELETE FROM TRECVER                                     47020002
470300            WHERE CURRENT OF TRECVER-CSR                          47030002
470400     END-EXEC                                                     47040002
470500                                                                  47050002
470600     EVALUATE TRUE                                                47060002
470700         WHEN SQLCODE = +0                                        47070002
470800              CONTINUE                                            47080002
470900                                                                  47090002
471000         WHEN SQLWARN0 NOT = SPACE                                47100002
471100         WHEN SQLCODE < +0                                        47110002
471200         WHEN SQLCODE > +0                                        47120002
471300              MOVE '5130-DELETE-TRECVER-CSR'                      47130002
471400                                   TO DP013-PARAGRAPH             47140002
471500              MOVE 'DELETE TRECVER CURSOR'                        47150002
471600                                   TO DP013-MESSAGE-TEXT (1)      47160002
471700              MOVE SQLCA           TO DP013-SQLCA                 47170002
471800              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    47180002
471900              SET DP013-DB2-ABEND  TO TRUE                        47190002
472000              PERFORM DP013-0000-PROCESS-ABEND                    47200002
472100     END-EVALUATE.                                                47210002
472200                                                                  47220002
472300/                                                                 47230002
472400*----------------------------------------------------------------*47240002
472500* INSERT THE TRECVER ROW                                         *47250002
472600*----------------------------------------------------------------*47260002
472700                                                                  47270002
472800 5135-INSERT-TRECVER.                                             47280002
472900                                                                  47290002
473000     PERFORM                                                      47300002
473100         WITH TEST AFTER                                          47310002
473200         VARYING PV-RETRY-COUNTER                                 47320002
473300         FROM 1 BY 1                                              47330002
473400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47340002
473500             OR (SQLCODE = +0))                                   47350002
473600                                                                  47360002
473700         EXEC SQL                                                 47370002
473800              INSERT INTO TRECVER                                 47380002
473900                     ( OPERCO_NBR                                 47390002
474000                      ,MAX_RCVR_NBR )                             47400002
474100              VALUES ( '03'                                       47410002
474200                      ,:RECVER-MAX-RCVR-NBR )                     47420002
474300         END-EXEC                                                 47430002
474400                                                                  47440002
474500         EVALUATE TRUE                                            47450002
474600             WHEN SQLCODE = +0                                    47460002
474700             WHEN SQLCODE = -904                                  47470002
474800             WHEN SQLCODE = -913                                  47480002
474900                 CONTINUE                                         47490002
475000                                                                  47500002
475100             WHEN SQLWARN0 NOT = SPACE                            47510002
475200             WHEN SQLCODE < +0                                    47520002
475300             WHEN SQLCODE > +0                                    47530002
475400                 MOVE '5315-INSERT-TRECVER'                       47540002
475500                                 TO DP013-PARAGRAPH               47550002
475600                 MOVE 'INSERT ON TRECVER TABLE   '                47560002
475700                                 TO DP013-MESSAGE-TEXT (1)        47570002
475800                 MOVE SQLCA      TO DP013-SQLCA                   47580002
475900                 MOVE 'TRECVER'  TO DP013-DB2-TABLE-NAME (1)      47590002
476000                     SET DP013-DB2-ABEND                          47600002
476100                         DP013-XCTL-DISPLAY-RESTART               47610002
476200                                     TO TRUE                      47620002
476300                 PERFORM DP013-0000-PROCESS-ABEND                 47630002
476400         END-EVALUATE                                             47640002
476500     END-PERFORM.                                                 47650002
476600                                                                  47660002
476700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        47670002
476800             AND (SQLCODE NOT = +0)                               47680002
476900         MOVE '5315-INSERT-TRECVER'                               47690002
477000                                  TO DP013-PARAGRAPH              47700002
477100         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECVER'         47710002
477200                                  TO DP013-MESSAGE-TEXT (1)       47720002
477300         MOVE SQLCA               TO DP013-SQLCA                  47730002
477400         MOVE 'TRECVER '          TO DP013-DB2-TABLE-NAME (1)     47740002
477500         SET DP013-DB2-ABEND                                      47750002
477600             DP013-XCTL-DISPLAY-RESTART                           47760002
477700                                  TO TRUE                         47770002
477800         PERFORM DP013-0000-PROCESS-ABEND                         47780002
477900     END-IF.                                                      47790002
478000                                                                  47800002
478100/                                                                 47810002
478200*----------------------------------------------------------------*47820002
478300* CLOSE THE TRECVER CURSOR                                       *47830002
478400*----------------------------------------------------------------*47840002
478500                                                                  47850002
478600 5140-CLOSE-TRECVER-CSR.                                          47860002
478700                                                                  47870002
478800     EXEC SQL                                                     47880002
478900          CLOSE TRECVER-CSR                                       47890002
479000     END-EXEC                                                     47900002
479100                                                                  47910002
479200     EVALUATE TRUE                                                47920002
479300         WHEN SQLCODE = +0                                        47930002
479400              CONTINUE                                            47940002
479500         WHEN SQLWARN0 NOT = SPACE                                47950002
479600         WHEN SQLCODE  NOT = +0                                   47960002
479700              MOVE '5140-CLOSE-TRECVER-CSR'                       47970002
479800                                   TO DP013-PARAGRAPH             47980002
479900              MOVE 'CLOSE TRECVER CURSOR'                         47990002
480000                                   TO DP013-MESSAGE-TEXT (1)      48000002
480100              MOVE SQLCA           TO DP013-SQLCA                 48010002
480200              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    48020002
480300              SET DP013-DB2-ABEND  TO TRUE                        48030002
480400              PERFORM DP013-0000-PROCESS-ABEND                    48040002
480500     END-EVALUATE.                                                48050002
480600                                                                  48060002
480700/                                                                 48070002
480800 5150-CHECK-FOR-TROUBLE.                                          48080002
480900                                                                  48090002
481000     INITIALIZE TM500-FIELDS.                                     48100002
481100                                                                  48110002
481200     SET  TM500-CREATE-AUTO        TO TRUE.                       48120002
481300     SET  TM500-PO-LEVEL           TO TRUE.                       48130002
481400     SET  TM500-NO-DETAILS         TO TRUE.                       48140002
481500                                                                  48150002
481600     MOVE RECEIV-ORD-NBR           TO TM500-PO-NBR.               48160002
481700     MOVE RECEIV-OPER-UNT-ID       TO TM500-OPER-UNT-ID.          48170002
481800     MOVE RECEIV-FCLTY-ID          TO TM500-FCLTY-ID.             48180002
481900     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            48190002
482000     MOVE ASC-VEND-SHIP-DTE-ISO    TO TM500-VEND-SHIP-DTE.        48200002
482100     MOVE RECEIV-REC-SEQ-NBR       TO TM500-REC-SEQ-NBR.          48210002
482200                                                                  48220002
482300     EXEC CICS                                                    48230002
482400         LINK PROGRAM  (PC-TROUBLE-RTN)                           48240002
482500              COMMAREA (TM500-FIELDS)                             48250002
482600              LENGTH   (PC-TROUBLE-RTN-LENGTH)                    48260002
482700     END-EXEC.                                                    48270002
482800                                                                  48280002
482900     IF TM500-CALL-SUCCESSFUL        OR                           48290002
483000        TM500-TPURCHS-SELECT-NOT-FND OR                           48300002
483100        TM500-DUPLICATE-TROUBLE      OR                           48310002
483200        TM500-TTRBNTF-UPDATE-NOT-FND                              48320002
483300         CONTINUE                                                 48330002
483400     ELSE                                                         48340002
483500         MOVE '5150-CHECK-FOR-TROUBLE '                           48350002
483600                         TO DP013-PARAGRAPH                       48360002
483700         MOVE 'UNSUCCESSFUL CALL TO TROUBLE RTN'                  48370002
483800                         TO DP013-MESSAGE-TEXT (1)                48380002
483900         MOVE TM500-RETURN-MSG                                    48390002
484000                         TO DP013-MESSAGE-TEXT (2)                48400002
484100         MOVE TM500-SQLCA                                         48410002
484200                         TO DP013-SQLCA                           48420002
484300         SET DP013-DB2-ABEND                                      48430002
484400             DP013-XCTL-DISPLAY-RESTART                           48440002
484500                         TO TRUE                                  48450002
484600         PERFORM DP013-0000-PROCESS-ABEND                         48460002
484700     END-IF.                                                      48470002
484800                                                                  48480002
484900/                                                                 48490002
485000 5300-BUILD-ZERO-LINE-WORK-ORD.                                   48500002
485100                                                                  48510002
485200     INITIALIZE DCLTWRKORD.                                       48520002
485300                                                                  48530002
485400     MOVE ASC-PO-NBR-N           TO WRKORD-ORD-NBR.               48540002
485500     MOVE ASC-REC-SEQ-NBR        TO WRKORD-RCVR-SEQ-NBR.          48550002
485600     MOVE ASC-CURR-OPER-UNT-ID   TO WRKORD-OPER-UNT-ID.           48560002
485700***  MOVE ASC-CRE-OPER-UNT-ID-N  TO WRKORD-OPER-UNT-ID.           48570002
485800     MOVE ASC-CRE-FCLTY-ID-N     TO WRKORD-FCLTY-ID.              48580002
485900     MOVE +1                     TO WRKORD-WORK-ORD-SEQ-NBR.      48590002
486000     MOVE ZERO                   TO WRKORD-ACTL-CART-CNT.         48600002
486100     MOVE ASC-EXPTED-CART-CNT-N  TO WRKORD-EXPTED-CART-CNT.       48610002
486200     MOVE 'A'                    TO WRKORD-VER-STATUS-CDE.        48620002
486300     MOVE 'IP'                   TO WRKORD-STAT-CDE.              48630002
486400     MOVE 'N'                    TO WRKORD-WORK-ORD-DISTR-IND.    48640002
486500     MOVE ASC-OPER-SET-ID-N      TO WRKORD-OPER-SET-ID.           48650002
486600                                                                  48660002
486700     PERFORM 5305-INACTIVATE-TWRKORD.                             48670002
486800     PERFORM 5310-INSERT-TWRKORD.                                 48680002
486900                                                                  48690002
487000     MOVE +0                     TO PV-WO-INSTR-SEQ-NBR.          48700002
487100     MOVE 'N'                    TO PS-TOSOPFA-CURSOR-SW.         48710002
487200     MOVE 'Y'                    TO PS-INSTRUCTION-SW.            48720002
487300                                                                  48730002
487400     IF  ASC-OPER-SET-ID = (SPACES OR ZEROES)                     48740002
487500                                                                  48750002
487600** DMH - BEGIN - 07/25/08                                         48760002
487700         MOVE  ASC-CURR-OPER-UNT-ID                               48770002
487800           TO  DK-CURR-OPER-UNT-ID                                48780002
487900** DMH - BEGIN - 07/25/08                                         48790002
488000                                                                  48800002
488100         PERFORM 3120-GET-OPER-SET-INFO                           48810002
488200         IF  SQLCODE = +0                                         48820002
488300             MOVE DCFAAS-OPER-SET-ID   TO ASC-OPER-SET-ID-N       48830002
488400                                          DK-OPER-SET-ID          48840002
488500         ELSE                                                     48850002
488600             PERFORM 3130-GET-OPER-SET-ID                         48860002
488700                MOVE COCNTL-DFLT-OPER-SET-ID                      48870002
488800                                       TO ASC-OPER-SET-ID-N       48880002
488900                                          DK-OPER-SET-ID          48890002
489000             PERFORM 3090-VALIDATE-OPER-SET-ID                    48900002
489100         END-IF                                                   48910002
489200     ELSE                                                         48920002
489300         MOVE ASC-OPER-SET-ID TO DK-OPER-SET-ID                   48930002
489400     END-IF.                                                      48940002
489500                                                                  48950002
489600** DMH - BEGIN - 10/20/08                                         48960002
489700     MOVE  ASC-CURR-OPER-UNT-ID                                   48970002
489800           TO  DK-CURR-OPER-UNT-ID.                               48980002
489900** DMH - BEGIN - 10/20/08                                         48990002
490000                                                                  49000002
490100     PERFORM 5320-OPEN-TOSOPFA-CSR.                               49010002
490200     PERFORM 5330-FETCH-TOSOPFA-CSR.                              49020002
490300                                                                  49030002
490400     PERFORM UNTIL PS-EOF-TOSOPFA-CSR                             49040002
490500        PERFORM 5400-BUILD-WORK-ORDER-INSTR                       49050002
490600        PERFORM 5330-FETCH-TOSOPFA-CSR                            49060002
490700     END-PERFORM.                                                 49070002
490800                                                                  49080002
490900     PERFORM 5340-CLOSE-TOSOPFA-CSR.                              49090002
491000                                                                  49100002
491100/                                                                 49110002
491200 5305-INACTIVATE-TWRKORD.                                         49120002
491300                                                                  49130002
491400         EXEC SQL                                                 49140002
491500           UPDATE TWRKORD                                         49150002
491600              SET VER_STATUS_CDE   =  :PC-I                       49160002
491700           WHERE                                                  49170002
491800                 ORD_NBR           = :WRKORD-ORD-NBR              49180002
491900            AND  RCVR_SEQ_NBR      = :WRKORD-RCVR-SEQ-NBR         49190002
492000            AND  ORD_LNE_NBR       = :WRKORD-ORD-LNE-NBR          49200002
492100            AND  WORK_ORD_SEQ_NBR  = :WRKORD-WORK-ORD-SEQ-NBR     49210002
492200            AND  OPER_UNT_ID       = :WRKORD-OPER-UNT-ID          49220002
492300            AND  FCLTY_ID          = :WRKORD-FCLTY-ID             49230002
492400         END-EXEC.                                                49240002
492500                                                                  49250002
492600         EVALUATE TRUE                                            49260002
492700             WHEN SQLCODE = +0                                    49270002
492800             WHEN SQLCODE = +100                                  49280002
492900                 CONTINUE                                         49290002
493000                                                                  49300002
493100             WHEN SQLWARN0 NOT = SPACES                           49310002
493200             WHEN SQLCODE < +0                                    49320002
493300             WHEN SQLCODE > +0                                    49330002
493400                 MOVE '5305-INACTIVATE-TWRKORD'                   49340002
493500                                   TO DP013-PARAGRAPH             49350002
493600                 MOVE 'UPDATE VER STATUS CODE ON TWRKORD'         49360002
493700                                   TO DP013-MESSAGE-TEXT(1)       49370002
493800                 MOVE SQLCA        TO DP013-SQLCA                 49380002
493900                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    49390002
494000                 SET DP013-DB2-ABEND                              49400002
494100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           49410002
494200                 PERFORM DP013-0000-PROCESS-ABEND                 49420002
494300         END-EVALUATE.                                            49430002
494400/                                                                 49440002
494500 5310-INSERT-TWRKORD.                                             49450002
494600                                                                  49460002
494700     PERFORM                                                      49470002
494800         WITH TEST AFTER                                          49480002
494900         VARYING PV-RETRY-COUNTER                                 49490002
495000         FROM 1 BY 1                                              49500002
495100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49510002
495200             OR (SQLCODE = +0))                                   49520002
495300                                                                  49530002
495400         EXEC SQL                                                 49540002
495500              INSERT INTO TWRKORD                                 49550002
495600                     ( ORD_NBR                                    49560002
495700                      ,RCVR_SEQ_NBR                               49570002
495800                      ,ORD_LNE_NBR                                49580002
495900                      ,WORK_ORD_SEQ_NBR                           49590002
496000                      ,OPER_UNT_ID                                49600002
496100                      ,FCLTY_ID                                   49610002
496200                      ,CRE_TMST                                   49620002
496300                      ,VER_STATUS_CDE                             49630002
496400                      ,CRE_UID_ID                                 49640002
496500                      ,EXPTED_CART_CNT                            49650002
496600                      ,ACTL_CART_CNT                              49660002
496700                      ,EXPTED_ITM_CNT                             49670002
496800                      ,ACTL_ITM_CNT                               49680002
496900                      ,STAT_CDE                                   49690002
497000                      ,WORK_ORD_DISTR_IND                         49700002
497100                      ,OPER_SET_ID )                              49710002
497200              VALUES ( :WRKORD-ORD-NBR                            49720002
497300                      ,:WRKORD-RCVR-SEQ-NBR                       49730002
497400                      ,:WRKORD-ORD-LNE-NBR                        49740002
497500                      ,:WRKORD-WORK-ORD-SEQ-NBR                   49750002
497600                      ,:WRKORD-OPER-UNT-ID                        49760002
497700                      ,:WRKORD-FCLTY-ID                           49770002
497800                      ,CURRENT TIMESTAMP                          49780002
497900                      ,:WRKORD-VER-STATUS-CDE                     49790002
498000                      ,:DP020-USERID                              49800002
498100                      ,:WRKORD-EXPTED-CART-CNT                    49810002
498200                      ,:WRKORD-ACTL-CART-CNT                      49820002
498300                      ,:WRKORD-EXPTED-ITM-CNT                     49830002
498400                      ,:WRKORD-ACTL-ITM-CNT                       49840002
498500                      ,:WRKORD-STAT-CDE                           49850002
498600                      ,:WRKORD-WORK-ORD-DISTR-IND                 49860002
498700                      ,:WRKORD-OPER-SET-ID )                      49870002
498800         END-EXEC                                                 49880002
498900                                                                  49890002
499000         EVALUATE TRUE                                            49900002
499100             WHEN SQLCODE = +0                                    49910002
499200             WHEN SQLCODE = -904                                  49920002
499300             WHEN SQLCODE = -913                                  49930002
499400                 CONTINUE                                         49940002
499500                                                                  49950002
499600             WHEN SQLWARN0 NOT = SPACE                            49960002
499700             WHEN SQLCODE < +0                                    49970002
499800             WHEN SQLCODE > +0                                    49980002
499900                 MOVE '5310-INSERT-TWRKORD'                       49990002
500000                                 TO DP013-PARAGRAPH               50000002
500100                 MOVE 'INSERT ON WORK ORDER TABLE'                50010002
500200                                 TO DP013-MESSAGE-TEXT (1)        50020002
500300                 MOVE SQLCA      TO DP013-SQLCA                   50030002
500400                 MOVE 'TWRKORD'  TO DP013-DB2-TABLE-NAME (1)      50040002
500500                     SET DP013-DB2-ABEND                          50050002
500600                         DP013-XCTL-DISPLAY-RESTART               50060002
500700                                     TO TRUE                      50070002
500800                 PERFORM DP013-0000-PROCESS-ABEND                 50080002
500900         END-EVALUATE                                             50090002
501000     END-PERFORM.                                                 50100002
501100                                                                  50110002
501200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50120002
501300             AND (SQLCODE NOT = +0)                               50130002
501400         MOVE '5310-INSERT-TWRKORD'                               50140002
501500                                  TO DP013-PARAGRAPH              50150002
501600         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TWRKORD'         50160002
501700                                  TO DP013-MESSAGE-TEXT (1)       50170002
501800         MOVE SQLCA               TO DP013-SQLCA                  50180002
501900         MOVE 'TWRKORD '          TO DP013-DB2-TABLE-NAME (1)     50190002
502000         SET DP013-DB2-ABEND                                      50200002
502100             DP013-XCTL-DISPLAY-RESTART                           50210002
502200                                  TO TRUE                         50220002
502300         PERFORM DP013-0000-PROCESS-ABEND                         50230002
502400     END-IF.                                                      50240002
502500                                                                  50250002
502600/                                                                 50260002
502700*----------------------------------------------------------------*50270002
502800* OPEN THE TOSOPFA CURSOR                                        *50280002
502900*----------------------------------------------------------------*50290002
503000                                                                  50300002
503100 5320-OPEN-TOSOPFA-CSR.                                           50310002
503200                                                                  50320002
503300     EXEC SQL                                                     50330002
503400          DECLARE TOSOPFA-CSR CURSOR FOR                          50340002
503500           SELECT OPER_SET_ID                                     50350002
503600                 ,OPER_ID                                         50360002
503700                 ,OPER_UNT_ID                                     50370002
503800                 ,FCLTY_ID                                        50380002
503900                 ,FCLTY_AREA_ID                                   50390002
504000                 ,PRC_FCLTY_AREA_ID                               50400002
504100                 ,SCRN_SEQ_NBR                                    50410002
504200           FROM   TOSOPFA                                         50420002
504300           WHERE  OPER_SET_ID    = :DK-OPER-SET-ID                50430002
504400***          AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                50440002
504500             AND  OPER_UNT_ID    = :DK-CURR-OPER-UNT-ID           50450002
504600             AND  FCLTY_ID       = :DK-FCLTY-ID                   50460002
504700             AND  VER_STATUS_CDE = 'A'                            50470002
504800           ORDER BY SCRN_SEQ_NBR                                  50480002
504900     END-EXEC.                                                    50490002
505000                                                                  50500002
505100     PERFORM                                                      50510002
505200         WITH TEST AFTER                                          50520002
505300         VARYING PV-RETRY-COUNTER                                 50530002
505400         FROM 1 BY 1                                              50540002
505500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               50550002
505600            OR (SQLCODE = +0))                                    50560002
505700                                                                  50570002
505800         EXEC SQL                                                 50580002
505900              OPEN TOSOPFA-CSR                                    50590002
506000         END-EXEC                                                 50600002
506100                                                                  50610002
506200         EVALUATE TRUE                                            50620002
506300             WHEN SQLCODE = +0                                    50630002
506400                  CONTINUE                                        50640002
506500             WHEN SQLCODE = -904                                  50650002
506600             WHEN SQLCODE = -913                                  50660002
506700                  CONTINUE                                        50670002
506800             WHEN SQLWARN0 NOT = SPACE                            50680002
506900             WHEN SQLCODE  NOT = +0                               50690002
507000                  MOVE '5320-OPEN-TOSOPFA-CSR'                    50700002
507100                                   TO DP013-PARAGRAPH             50710002
507200                  MOVE 'OPEN TOSOPFA CURSOR'                      50720002
507300                                   TO DP013-MESSAGE-TEXT (1)      50730002
507400                  MOVE SQLCA       TO DP013-SQLCA                 50740002
507500                  MOVE 'TOSOPFA'   TO DP013-DB2-TABLE-NAME (1)    50750002
507600                  SET DP013-DB2-ABEND                             50760002
507700                                   TO TRUE                        50770002
507800                  PERFORM DP013-0000-PROCESS-ABEND                50780002
507900         END-EVALUATE                                             50790002
508000     END-PERFORM.                                                 50800002
508100                                                                  50810002
508200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50820002
508300             AND (SQLCODE NOT = +0)                               50830002
508400         MOVE '5320-OPEN-TOSOPFA-CSR' TO DP013-PARAGRAPH          50840002
508500         MOVE 'MAX RETRIES EXCEEDED FOR OPEN TOSOPFA CURSOR'      50850002
508600                                   TO DP013-MESSAGE-TEXT (1)      50860002
508700         MOVE SQLCA                TO DP013-SQLCA                 50870002
508800         SET DP013-DB2-ABEND       TO TRUE                        50880002
508900         PERFORM DP013-0000-PROCESS-ABEND                         50890002
509000     END-IF.                                                      50900002
509100                                                                  50910002
509200/                                                                 50920002
509300*----------------------------------------------------------------*50930002
509400*    FETCH A TOSOPFA ROW                                         *50940002
509500*----------------------------------------------------------------*50950002
509600                                                                  50960002
509700 5330-FETCH-TOSOPFA-CSR.                                          50970002
509800                                                                  50980002
509900     EXEC SQL                                                     50990002
510000          FETCH TOSOPFA-CSR                                       51000002
510100          INTO :OSOPFA-OPER-SET-ID                                51010002
510200              ,:OSOPFA-OPER-ID                                    51020002
510300              ,:OSOPFA-OPER-UNT-ID                                51030002
510400              ,:OSOPFA-FCLTY-ID                                   51040002
510500              ,:OSOPFA-FCLTY-AREA-ID                              51050002
510600              ,:OSOPFA-PRC-FCLTY-AREA-ID                          51060002
510700              ,:OSOPFA-SCRN-SEQ-NBR                               51070002
510800     END-EXEC                                                     51080002
510900                                                                  51090002
511000     EVALUATE TRUE                                                51100002
511100         WHEN SQLCODE = +0                                        51110002
511200              CONTINUE                                            51120002
511300                                                                  51130002
511400         WHEN SQLCODE = +100                                      51140002
511500              SET PS-EOF-TOSOPFA-CSR TO TRUE                      51150002
511600                                                                  51160002
511700         WHEN SQLWARN0 NOT = SPACE                                51170002
511800         WHEN SQLCODE < +0                                        51180002
511900         WHEN SQLCODE > +0                                        51190002
512000              MOVE '5330-FETCH-TOSOPFA-CSR'                       51200002
512100                                   TO DP013-PARAGRAPH             51210002
512200              MOVE 'FETCH TOSOPFA CURSOR'                         51220002
512300                                   TO DP013-MESSAGE-TEXT (1)      51230002
512400              MOVE SQLCA           TO DP013-SQLCA                 51240002
512500              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    51250002
512600              SET DP013-DB2-ABEND  TO TRUE                        51260002
512700              PERFORM DP013-0000-PROCESS-ABEND                    51270002
512800     END-EVALUATE.                                                51280002
512900                                                                  51290002
513000/                                                                 51300002
513100*----------------------------------------------------------------*51310002
513200* CLOSE THE TOSOPFA CURSOR                                       *51320002
513300*----------------------------------------------------------------*51330002
513400                                                                  51340002
513500 5340-CLOSE-TOSOPFA-CSR.                                          51350002
513600                                                                  51360002
513700     EXEC SQL                                                     51370002
513800          CLOSE TOSOPFA-CSR                                       51380002
513900     END-EXEC                                                     51390002
514000                                                                  51400002
514100     EVALUATE TRUE                                                51410002
514200         WHEN SQLCODE = +0                                        51420002
514300              CONTINUE                                            51430002
514400         WHEN SQLWARN0 NOT = SPACE                                51440002
514500         WHEN SQLCODE  NOT = +0                                   51450002
514600              MOVE '5340-CLOSE-TOSOPFA-CSR'                       51460002
514700                                   TO DP013-PARAGRAPH             51470002
514800              MOVE 'CLOSE TOSOPFA CURSOR'                         51480002
514900                                   TO DP013-MESSAGE-TEXT (1)      51490002
515000              MOVE SQLCA           TO DP013-SQLCA                 51500002
515100              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    51510002
515200              SET DP013-DB2-ABEND  TO TRUE                        51520002
515300              PERFORM DP013-0000-PROCESS-ABEND                    51530002
515400     END-EVALUATE.                                                51540002
515500                                                                  51550002
515600/                                                                 51560002
515700 5400-BUILD-WORK-ORDER-INSTR.                                     51570002
515800                                                                  51580002
515900     INITIALIZE DCLTWKORIN.                                       51590002
516000                                                                  51600002
516100     MOVE ASC-PO-NBR-N           TO WKORIN-ORD-NBR.               51610002
516200     MOVE ASC-REC-SEQ-NBR        TO WKORIN-RCVR-SEQ-NBR.          51620002
516300     MOVE +1                     TO WKORIN-WORK-ORD-SEQ-NBR.      51630002
516400     ADD +1                      TO PV-WO-INSTR-SEQ-NBR.          51640002
516500     MOVE PV-WO-INSTR-SEQ-NBR    TO WKORIN-WO-INSTR-SEQ-NBR.      51650002
516600     MOVE 'A'                    TO WKORIN-VER-STATUS-CDE.        51660002
516700***  MOVE ASC-CRE-OPER-UNT-ID-N  TO WKORIN-OPER-UNT-ID.           51670002
516800     MOVE ASC-CURR-OPER-UNT-ID-N TO WKORIN-OPER-UNT-ID.           51680002
516900     MOVE ASC-CRE-FCLTY-ID-N     TO WKORIN-FCLTY-ID.              51690002
517000     MOVE OSOPFA-OPER-ID         TO WKORIN-OPER-ID.               51700002
517100     MOVE OSOPFA-FCLTY-AREA-ID   TO WKORIN-FCLTY-AREA-ID.         51710002
517200     MOVE OSOPFA-PRC-FCLTY-AREA-ID                                51720002
517300                                 TO WKORIN-PRC-FCLTY-AREA-ID.     51730002
517400     MOVE OSOPFA-SCRN-SEQ-NBR    TO WKORIN-SCREEN-SEQ-NBR.        51740002
517500     IF  PS-FIRST-INSTRUCTION                                     51750002
517600         MOVE 'N'                TO PS-INSTRUCTION-SW             51760002
517700         MOVE ASC-EXPTED-CART-CNT-N                               51770002
517800                                 TO WKORIN-EXPTED-CART-CNT        51780002
517900         MOVE ZERO                                                51790002
518000                                 TO WKORIN-ACTL-CART-CNT          51800002
518100     END-IF.                                                      51810002
518200     MOVE 'N'                    TO WKORIN-ALLOC-IND              51820002
518300                                    WKORIN-REPACK-IND.            51830002
518400     MOVE '9999-09-09-09.09.09.000000'                            51840002
518500                                 TO WKORIN-STRT-TMST              51850002
518600                                    WKORIN-STOP-TMST.             51860002
518700                                                                  51870002
518800     PERFORM 5405-INACTIVATE-TWKORIN.                             51880002
518900     PERFORM 5410-INSERT-TWKORIN.                                 51890002
519000                                                                  51900002
519100 5405-INACTIVATE-TWKORIN.                                         51910002
519200                                                                  51920002
519300     EXEC SQL                                                     51930002
519400          UPDATE                                                  51940002
519500                 TWKORIN                                          51950002
519600             SET                                                  51960002
519700                 VER_STATUS_CDE      =  :PC-I                     51970002
519800           WHERE                                                  51980002
519900                 ORD_NBR             =  :WKORIN-ORD-NBR           51990002
520000             AND RCVR_SEQ_NBR        =  :WKORIN-RCVR-SEQ-NBR      52000002
520100             AND ORD_LNE_NBR         =  :WKORIN-ORD-LNE-NBR       52010002
520200             AND WORK_ORD_SEQ_NBR    =  :WKORIN-WORK-ORD-SEQ-NBR  52020002
520300             AND WO_INSTR_SEQ_NBR    =  :WKORIN-WO-INSTR-SEQ-NBR  52030002
520400             AND VER_STATUS_CDE      =  :PC-A                     52040002
520500     END-EXEC.                                                    52050002
520600                                                                  52060002
520700     EVALUATE TRUE                                                52070002
520800         WHEN SQLCODE = ZERO                                      52080002
520900         WHEN SQLCODE = +100                                      52090002
521000              CONTINUE                                            52100002
521100         WHEN SQLWARN0 NOT = SPACES                               52110002
521200         WHEN SQLCODE NOT EQUAL ZERO                              52120002
521300              MOVE '5405-INACTIVATE-TWKORIN'                      52130002
521400                                   TO DP013-PARAGRAPH             52140002
521500              MOVE '"LOGICAL" DELETE; SET STATUS TO I'            52150002
521600                                   TO DP013-MESSAGE-TEXT (1)      52160002
521700              MOVE SQLCA           TO DP013-SQLCA                 52170002
521800              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    52180002
521900              SET DP013-DB2-ABEND                                 52190002
522000                  DP013-XCTL-DISPLAY-RESTART                      52200002
522100                                   TO TRUE                        52210002
522200              PERFORM DP013-0000-PROCESS-ABEND                    52220002
522300     END-EVALUATE.                                                52230002
522400/                                                                 52240002
522500 5410-INSERT-TWKORIN.                                             52250002
522600                                                                  52260002
522700     PERFORM                                                      52270002
522800         WITH TEST AFTER                                          52280002
522900         VARYING PV-RETRY-COUNTER                                 52290002
523000         FROM 1 BY 1                                              52300002
523100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               52310002
523200             OR (SQLCODE = +0))                                   52320002
523300                                                                  52330002
523400         EXEC SQL                                                 52340002
523500              INSERT INTO TWKORIN                                 52350002
523600                     ( ORD_NBR                                    52360002
523700                      ,RCVR_SEQ_NBR                               52370002
523800                      ,ORD_LNE_NBR                                52380002
523900                      ,WORK_ORD_SEQ_NBR                           52390002
524000                      ,OPER_UNT_ID                                52400002
524100                      ,FCLTY_ID                                   52410002
524200                      ,WO_INSTR_SEQ_NBR                           52420002
524300                      ,CRE_TMST                                   52430002
524400                      ,VER_STATUS_CDE                             52440002
524500                      ,CRE_UID_ID                                 52450002
524600                      ,OPER_ID                                    52460002
524700                      ,FCLTY_AREA_ID                              52470002
524800                      ,PRC_FCLTY_AREA_ID                          52480002
524900                      ,EXPTED_CART_CNT                            52490002
525000                      ,ACTL_CART_CNT                              52500002
525100                      ,ALLOC_IND                                  52510002
525200                      ,REPACK_IND                                 52520002
525300                      ,STRT_TMST                                  52530002
525400                      ,STOP_TMST                                  52540002
525500                      ,SCREEN_SEQ_NBR                             52550002
525600                      ,LNE_LOC_CDE                                52560002
525700                      ,REC_SEL_IND )                              52570002
525800              VALUES ( :WKORIN-ORD-NBR                            52580002
525900                      ,:WKORIN-RCVR-SEQ-NBR                       52590002
526000                      ,:WKORIN-ORD-LNE-NBR                        52600002
526100                      ,:WKORIN-WORK-ORD-SEQ-NBR                   52610002
526200                      ,:WKORIN-OPER-UNT-ID                        52620002
526300                      ,:WKORIN-FCLTY-ID                           52630002
526400                      ,:WKORIN-WO-INSTR-SEQ-NBR                   52640002
526500                      ,CURRENT TIMESTAMP                          52650002
526600                      ,:WKORIN-VER-STATUS-CDE                     52660002
526700                      ,:DP020-USERID                              52670002
526800                      ,:WKORIN-OPER-ID                            52680002
526900                      ,:WKORIN-FCLTY-AREA-ID                      52690002
527000                      ,:WKORIN-PRC-FCLTY-AREA-ID                  52700002
527100                      ,:WKORIN-EXPTED-CART-CNT                    52710002
527200                      ,:WKORIN-ACTL-CART-CNT                      52720002
527300                      ,:WKORIN-ALLOC-IND                          52730002
527400                      ,:WKORIN-REPACK-IND                         52740002
527500                      ,:WKORIN-STRT-TMST                          52750002
527600                      ,:WKORIN-STOP-TMST                          52760002
527700                      ,:WKORIN-SCREEN-SEQ-NBR                     52770002
527800                      ,:WKORIN-LNE-LOC-CDE                        52780002
527900                      ,:WKORIN-REC-SEL-IND )                      52790002
528000         END-EXEC                                                 52800002
528100                                                                  52810002
528200         EVALUATE TRUE                                            52820002
528300             WHEN SQLCODE = +0                                    52830002
528400             WHEN SQLCODE = -904                                  52840002
528500             WHEN SQLCODE = -913                                  52850002
528600                 CONTINUE                                         52860002
528700                                                                  52870002
528800             WHEN SQLWARN0 NOT = SPACE                            52880002
528900             WHEN SQLCODE < +0                                    52890002
529000             WHEN SQLCODE > +0                                    52900002
529100                 MOVE '5410-INSERT-TWKORIN'                       52910002
529200                                 TO DP013-PARAGRAPH               52920002
529300                 MOVE 'INSERT ON WORK ORDER INSTRUCTION TABLE'    52930002
529400                                 TO DP013-MESSAGE-TEXT (1)        52940002
529500                 MOVE SQLCA      TO DP013-SQLCA                   52950002
529600                 MOVE 'TWKORIN'  TO DP013-DB2-TABLE-NAME (1)      52960002
529700                     SET DP013-DB2-ABEND                          52970002
529800                         DP013-XCTL-DISPLAY-RESTART               52980002
529900                                     TO TRUE                      52990002
530000                 PERFORM DP013-0000-PROCESS-ABEND                 53000002
530100         END-EVALUATE                                             53010002
530200     END-PERFORM.                                                 53020002
530300                                                                  53030002
530400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        53040002
530500             AND (SQLCODE NOT = +0)                               53050002
530600         MOVE '5410-INSERT-TWKORIN'                               53060002
530700                                  TO DP013-PARAGRAPH              53070002
530800         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TWKORIN'         53080002
530900                                  TO DP013-MESSAGE-TEXT (1)       53090002
531000         MOVE SQLCA               TO DP013-SQLCA                  53100002
531100         MOVE 'TWKORIN '          TO DP013-DB2-TABLE-NAME (1)     53110002
531200         SET DP013-DB2-ABEND                                      53120002
531300             DP013-XCTL-DISPLAY-RESTART                           53130002
531400                                  TO TRUE                         53140002
531500         PERFORM DP013-0000-PROCESS-ABEND                         53150002
531600     END-IF.                                                      53160002
531700                                                                  53170002
531800/                                                                 53180002
531900/                                                                 53190002
532000 5500-GET-SHORT-TROUBLE.                                          53200002
532100                                                                  53210002
532200     PERFORM                                                      53220002
532300         WITH TEST AFTER                                          53230002
532400         VARYING PV-RETRY-COUNTER                                 53240002
532500         FROM 1 BY 1                                              53250002
532600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               53260002
532700                   OR (SQLCODE = +0)                              53270002
532800                   OR (SQLCODE = -811)                            53280002
532900                   OR (SQLCODE = +100))                           53290002
533000                                                                  53300002
533100         EXEC SQL                                                 53310002
533200              SELECT  B.TRBL_SHT_DESC                             53320002
533300                INTO :TRBRSN-TRBL-SHT-DESC                        53330002
533400                FROM  TTRBNTF A                                   53340002
533500                    , TTRBRSN B                                   53350002
533600               WHERE  (A.PO_NBR          =  :DK-PO-NBR            53360002
533700                 AND   A.PO_LNE_NBR      =  0000                  53370002
533800                 AND   A.REC_SEQ_NBR     =  :DK-REC-SEQ-NBR       53380002
533900                 AND   A.FCLTY_ID        =  :DK-FCLTY-ID          53390002
534000                 AND   A.OPER_UNT_ID     =  :DK-OPER-UNT-ID       53400002
534100                 AND   A.RESOLVED_IND    IN ('N', 'I')            53410002
534200                 AND   A.TRBL_RSN_CDE    =  B.TRBL_RSN_CDE)       53420002
534300         END-EXEC                                                 53430002
534400                                                                  53440002
534500         EVALUATE TRUE                                            53450002
534600             WHEN SQLCODE = +0                                    53460002
534700             WHEN SQLCODE = +100                                  53470002
534800             WHEN SQLCODE = -904                                  53480002
534900             WHEN SQLCODE = -913                                  53490002
535000                 CONTINUE                                         53500002
535100                                                                  53510002
535200             WHEN SQLCODE = -811                                  53520002
535300                 SET PS-MULT-TROUBLE TO TRUE                      53530002
535400             WHEN SQLWARN0 NOT = SPACES                           53540002
535500             WHEN SQLCODE < +0                                    53550002
535600             WHEN SQLCODE > +0                                    53560002
535700                 MOVE '5500-GET-SHORT-TROUBLE'                    53570002
535800                                 TO DP013-PARAGRAPH               53580002
535900                 MOVE 'SELECT SHORT TROUBE DESCRIPTION'           53590002
536000                                 TO DP013-MESSAGE-TEXT (1)        53600002
536100                 MOVE SQLCA      TO DP013-SQLCA                   53610002
536200                 MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)      53620002
536300                 MOVE 'TTRBRSN'  TO DP013-DB2-TABLE-NAME (2)      53630002
536400                 SET DP013-DB2-ABEND                              53640002
536500                                 TO TRUE                          53650002
536600                 SET DP013-XCTL-DISPLAY-RESTART                   53660002
536700                                 TO TRUE                          53670002
536800                 PERFORM DP013-0000-PROCESS-ABEND                 53680002
536900         END-EVALUATE                                             53690002
537000     END-PERFORM.                                                 53700002
537100                                                                  53710002
537200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        53720002
537300             AND (SQLCODE NOT = +0)                               53730002
537400         MOVE '5500-GET-SHORT-TROUBLE'                            53740002
537500                                 TO DP013-PARAGRAPH               53750002
537600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     53760002
537700                                 TO DP013-MESSAGE-TEXT (1)        53770002
537800         MOVE 'SHT TROUBLE DESC' TO DP013-MESSAGE-TEXT (2)        53780002
537900         MOVE SQLCA              TO DP013-SQLCA                   53790002
538000         MOVE 'TTRBNTF'          TO DP013-DB2-TABLE-NAME (1)      53800002
538100         MOVE 'TTRBRSN'          TO DP013-DB2-TABLE-NAME (1)      53810002
538200         SET DP013-DB2-ABEND     TO TRUE                          53820002
538300         SET DP013-XCTL-DISPLAY-RESTART                           53830002
538400                                 TO TRUE                          53840002
538500         PERFORM DP013-0000-PROCESS-ABEND                         53850002
538600     END-IF.                                                      53860002
538700                                                                  53870002
538800                                                                  53880002
538900*----------------------------------------------------------------*53890002
539000* UPDATE THE PACKSLIP HEADER INFORMATION WITH THE RECEVIER SEQ   *53900002
539100* NUMBER AND SHIPT ID.                                           *53910002
539200*----------------------------------------------------------------*53920002
539300                                                                  53930002
539400 5500-UPDATE-PKSLIPS.                                             53940002
539500                                                                  53950002
539600     PERFORM UNTIL PS-LIST-END                                    53960002
539700         PERFORM 5600-UPDATE-TPKSLIP                              53970002
539800         PERFORM 2110-GET-NEXT-RECORD                             53980002
539900     END-PERFORM.                                                 53990002
540000                                                                  54000002
540100 5600-UPDATE-TPKSLIP.                                             54010002
540200                                                                  54020002
540300     MOVE ASC-REC-SEQ-NBR  TO PKSLIP-REC-SEQ-NBR.                 54030002
540310     MOVE ASC-COMPLETE-PRO-NBR TO PKSLIP-PRO-NBR.                 54031034
540400                                                                  54040002
540500     PERFORM                                                      54050002
540600         WITH TEST AFTER                                          54060002
540700         VARYING PV-RETRY-COUNTER                                 54070002
540800         FROM 1 BY 1                                              54080002
540900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               54090002
541000             OR (SQLCODE = +0))                                   54100002
541100                                                                  54110002
541200         EXEC SQL                                                 54120002
541300              UPDATE TPKSLIP                                      54130002
541400                 SET REC_SEQ_NBR    = :PKSLIP-REC-SEQ-NBR         54140002
541500                    ,SHIPT_ID       = :ASC-SHIPT-ID               54150002
541510                    ,PRO_NBR        = :PKSLIP-PRO-NBR             54151034
541600               WHERE PO_NBR         = :DK-PO-NBR                  54160002
541700                 AND SEQ_NBR        = :ASC-SEQ-NBR                54170002
541800                 AND VER_STAT_CDE   = :PC-ACTIVE                  54180002
541900         END-EXEC                                                 54190002
542000                                                                  54200002
542100         EVALUATE TRUE                                            54210002
542200             WHEN SQLCODE = +0                                    54220002
542300             WHEN SQLCODE = -904                                  54230002
542400             WHEN SQLCODE = -913                                  54240002
542500                  CONTINUE                                        54250002
542600                                                                  54260002
542700             WHEN SQLWARN0 NOT = SPACES                           54270002
542800             WHEN SQLCODE < +0                                    54280002
542900             WHEN SQLCODE > +0                                    54290002
543000                  MOVE SPACES TO PV-MESSAGE                       54300002
543100                  MOVE DK-PO-NBR TO PV-MESSAGE1                   54310002
543200                  MOVE ASC-SEQ-NBR TO PV-MESSAGE2                 54320002
543300                  MOVE '5600-UPDATE-TPKSLIP'                      54330002
543400                                   TO DP013-PARAGRAPH             54340002
543500                  MOVE 'UNSUCCESSFUL UPDATE FOR TPKSLIP'          54350002
543600                                   TO DP013-MESSAGE-TEXT (1)      54360002
543700                  MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (1)      54370002
543800                  MOVE SQLCA       TO DP013-SQLCA                 54380002
543900                  MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)    54390002
544000                  SET DP013-DB2-ABEND                             54400002
544100                      DP013-XCTL-DISPLAY-RESTART                  54410002
544200                                   TO TRUE                        54420002
544300                  PERFORM DP013-0000-PROCESS-ABEND                54430002
544400         END-EVALUATE                                             54440002
544500     END-PERFORM.                                                 54450002
544600                                                                  54460002
544700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        54470002
544800             AND (SQLCODE NOT = +0)                               54480002
544900         MOVE '5600-UPDATE-TPKSLIP'                               54490002
545000                                   TO DP013-PARAGRAPH             54500002
545100         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE ON TPKSLIP'        54510002
545200                                   TO DP013-MESSAGE-TEXT (1)      54520002
545300         MOVE SQLCA                TO DP013-SQLCA                 54530002
545400         MOVE 'TPKSLIP '           TO DP013-DB2-TABLE-NAME (1)    54540002
545500         SET DP013-DB2-ABEND                                      54550002
545600             DP013-XCTL-DISPLAY-RESTART                           54560002
545700                                   TO TRUE                        54570002
545800         PERFORM DP013-0000-PROCESS-ABEND                         54580002
545900     END-IF.                                                      54590002
546000                                                                  54600002
546100/                                                                 54610002
546200*----------------------------------------------------------------*54620002
546300*  ASC-ADD-NEW-SHIP IS SET WHEN COMMING BACK FROM THE MULTSHIPMENT54630002
546400*  LIST WHEN THE ORIGINAL SHIPMENT LISTED IS SELECTED.  WHEN THIS 54640002
546500*  SWITCH IS SET WE KNOW WE CAN JUST ADD THE SHIPMENT AS IS.  IF  54650002
546600*  THIS SWITCH IS NOT SET WE NEED TO DETERMINE IF THE SHIPMENT    54660002
546700*  CURRENTLY EXISTS.                                              54670002
546800*----------------------------------------------------------------*54680002
546900                                                                  54690002
547000 6000-CREATE-SHIPMENT.                                            54700002
547100                                                                  54710002
547200     MOVE ASC-PO-NBR         TO DK-PO-NBR.                        54720002
547300     MOVE ASC-SCAC-ID        TO DK-SCAC-ID.                       54730002
547400                                                                  54740002
547500     IF ASC-ADD-NEW-SHIP                                          54750002
547600        PERFORM 6010-CREATE-NEW-SHIPMENT                          54760002
547700        SET ASC-SKIP-CHECKS TO TRUE                               54770002
547800     ELSE                                                         54780002
547900        PERFORM 4005-GET-SHIPMENT-INFO                            54790002
548000        IF PS-NO-ERROR                                            54800002
548100           IF ASC-SHIPMENT-EXIST                                  54810002
548200              PERFORM 6005-COMPARE-FIELDS                         54820002
548300           ELSE                                                   54830002
548400              IF ASC-ADD-SHIPMENT                                 54840002
548500                 PERFORM 6010-CREATE-NEW-SHIPMENT                 54850002
548600              ELSE                                                54860002
548700                 CONTINUE                                         54870002
548800              END-IF                                              54880002
548900           END-IF                                                 54890002
549000        END-IF                                                    54900002
549100     END-IF.                                                      54910002
549200*----------------------------------------------------------------*54920002
549300*  CHECK THE VENDOR SHIP DATE AND CARRIER SHIP DATE TO SEE IF    *54930002
549400*  THEY ARE EQUAL TO THE TABLE SHIPMENT VALUES.  IF NOT THIS IS  *54940002
549500*  AN ERROR.                                                     *54950002
549600*                                                                *54960002
549700*  IF A VEHICL NUBMER WAS ENTERED AND THE VEHICLE NUMBER ON THE  *54970002
549800*  TABLE IS NOT FILLED IN (EQUAL TO NULL) THE VEHICL TABLE IS CHEC54980002
549900*  TO SEE IF THE TRIP ENTERED EXISTS.  IF IT DOES AND THE CURRENT*54990002
550000*  TRIP ID IS EQUAL TO NULLS THEN LINK THE VEHICLE (TRIP) TO THE *55000002
550100*  CURRENT SHIPMENT.  IF IT DOES EXISTS AND THE CURRENT TRIP ID IS55010002
550200*  FILLED IN (ALREADY ATTACHED TO A TRIP) IT WILL BE DETERMINED IF55020002
550300*  THIS SHIPMENT CAN BE LINKED TO THE EXISTING TRIP..  IF THE    *55030002
550400*  VEHICLE DOES NOT EXISTS THEN A NEW ROW IS INSERTED TO THE     *55040002
550500*  TVEHICL TABLE.                                                 55050002
550600*                                                                *55060002
550700*  IF A VEHICL NUMBER WAS ENTERED AND THE VEHICLE NUMBER ON THE  *55070002
550800*  TABLE IS FILLED IN (NOT EQUAL TO NULL) THE VEHCILE NUMBER IS  *55080002
550900*  COMPARE TO THE VEHICLE NUMBER ON THE TABLE.  IF THERE IS A    *55090002
551000*  DIFFERENCE THERE IS AN ERROR.                                  55100002
551100*----------------------------------------------------------------*55110002
551200                                                                  55120002
551300 6005-COMPARE-FIELDS.                                             55130002
551400                                                                  55140002
551500                                                                  55150002
551600     IF ASC-VEND-SHIP-DTE > SPACES                                55160002
551700        IF SHIPMT-VEND-SHIP-DTE = (SPACES OR ZEROES OR            55170002
551800                                   '0001-01-01')                  55180002
551900           SET PS-UPD-TSHIPMT-VNDSHP TO TRUE                      55190002
552000        ELSE                                                      55200002
552100           MOVE SHIPMT-VEND-SHIP-DTE TO PV-DB2-DATE               55210002
552200           MOVE PV-DB2-DATE-CC       TO PV-INPUT-DATE-CC          55220002
552300           MOVE PV-DB2-DATE-YY       TO PV-INPUT-DATE-YY          55230002
552400           MOVE PV-DB2-DATE-MM       TO PV-INPUT-DATE-MM          55240002
552500           MOVE PV-DB2-DATE-DD       TO PV-INPUT-DATE-DD          55250002
552600           IF PV-INPUT-DATE = ASC-VEND-SHIP-DTE                   55260002
552700              CONTINUE                                            55270002
552800           ELSE                                                   55280002
552900              MOVE DP015-RED             TO AVSHMMC               55290002
553000                                            AVSHDDC               55300002
553100                                            AVSHYYC               55310002
553200              MOVE DP015-REVERSE         TO AVSHMMH               55320002
553300                                            AVSHDDH               55330002
553400                                            AVSHYYH               55340002
553500              MOVE -1                    TO AVSHMML               55350002
553600              MOVE DP015-UNP-ALP-BRT-OFF TO AVSHMMA               55360002
553700                                            AVSHDDA               55370002
553800                                            AVSHYYA               55380002
553900              MOVE PC-TSYMSG-01050       TO DP020-MSG-NUMBER      55390002
554000              MOVE PV-INPUT-DATE         TO DP020-MSG-TEXT        55400002
554100              SET PS-ERROR                                        55410002
554200                  DP020-MSG-FATAL        TO TRUE                  55420002
554300           END-IF                                                 55430002
554400        END-IF                                                    55440002
554500     END-IF.                                                      55450002
554600                                                                  55460002
554700     IF ASC-CARR-SHIP-DTE > SPACES                                55470002
554800        IF VHTRIP-OWNR-SCAC-SHIP-DTE = (SPACES OR ZEROES OR       55480002
554900                                        '0001-01-01')             55490002
555000           SET PS-UPD-TVHTRIP-CARSHP TO TRUE                      55500002
555100        ELSE                                                      55510002
555200           MOVE VHTRIP-OWNR-SCAC-SHIP-DTE TO PV-DB2-DATE          55520002
555300           MOVE PV-DB2-DATE-CC       TO PV-INPUT-DATE-CC          55530002
555400           MOVE PV-DB2-DATE-YY       TO PV-INPUT-DATE-YY          55540002
555500           MOVE PV-DB2-DATE-MM       TO PV-INPUT-DATE-MM          55550002
555600           MOVE PV-DB2-DATE-DD       TO PV-INPUT-DATE-DD          55560002
555700           IF PV-INPUT-DATE = ASC-CARR-SHIP-DTE                   55570002
555800              CONTINUE                                            55580002
555900           ELSE                                                   55590002
556000              MOVE DP015-RED             TO ASHPMMC               55600002
556100                                            ASHPDDC               55610002
556200                                            ASHPYYC               55620002
556300              MOVE DP015-REVERSE         TO ASHPMMH               55630002
556400                                            ASHPDDH               55640002
556500                                            ASHPYYH               55650002
556600              MOVE -1                    TO ASHPMML               55660002
556700              MOVE DP015-UNP-ALP-BRT-OFF TO ASHPMMA               55670002
556800                                            ASHPDDA               55680002
556900                                            ASHPYYA               55690002
557000              MOVE PC-TSYMSG-01051       TO DP020-MSG-NUMBER      55700002
557100              MOVE PV-INPUT-DATE         TO DP020-MSG-TEXT        55710002
557200              SET PS-ERROR                                        55720002
557300                  DP020-MSG-FATAL        TO TRUE                  55730002
557400           END-IF                                                 55740002
557500        END-IF                                                    55750002
557600     END-IF.                                                      55760002
557700                                                                  55770002
557800     IF PS-NO-ERROR                                               55780002
557900        IF ASC-VEH-NBR > SPACES                                   55790002
558000           IF DN-VEH-NBR = -1                                     55800002
558100              PERFORM 6015-CHECK-TRIP                             55810002
558200              IF PS-FOUND                                         55820002
558300                 IF DN-TRIP-ID = -1                               55830002
558400                    PERFORM 6060-UPDATE-TVEHICL                   55840002
558500                    PERFORM 7005-UPDATE-TSHIPMT-VEHNBR            55850002
558600                 ELSE                                             55860002
558700                    MOVE VEHICL-CURR-TRIP-ID TO DK-TRIP-ID        55870002
558800                    PERFORM 4040-CHECK-TRIP-STATUS                55880002
558900                    IF ASC-SHIPT-STATUS-OK                        55890002
559000                       MOVE ASC-TRIP-ID TO PV-TRIP-ID-OLD         55900002
559100                       MOVE VEHICL-CURR-TRIP-ID TO ASC-TRIP-ID    55910002
559200                       SET PS-NO-UPD-TVHTRIP-CARSHP TO TRUE       55920002
559300                       PERFORM 7007-UPDATE-TSHIPMT-TRIPID         55930002
559400                       MOVE 0 TO PV-COUNT                         55940002
559500                       PERFORM 7020-GET-COUNT                     55950002
559600                       IF PV-COUNT > 0                            55960002
559700                          CONTINUE                                55970002
559800                       ELSE                                       55980002
559900                           SET PS-DELETE-VHTRIP TO TRUE           55990002
560000                           PERFORM 6095-INSERT-TAUTRIP            56000002
560100                           PERFORM 7030-DELETE-TVHTRIP            56010002
560200                           SET PS-UPDATE-VHTRIP TO TRUE           56020002
560300                       END-IF                                     56030002
560400                    ELSE                                          56040002
560500                       MOVE PC-TSYMSG-01015 TO DP020-MSG-NUMBER   56050002
560600                       MOVE TRIPST-TRIP-STATUS-CDE                56060002
560700                                            TO DP020-MSG-TEXT     56070002
560800                       SET DP020-MSG-FATAL                        56080002
560900                           PS-ERROR         TO TRUE               56090002
561000                       MOVE DP015-RED       TO ASCACC             56100002
561100                                               ATRLNBRC           56110002
561200                    END-IF                                        56120002
561300                 END-IF                                           56130002
561400              ELSE                                                56140002
561500                 PERFORM 6050-INSERT-TVEHICL                      56150002
561600              END-IF                                              56160002
561700           ELSE                                                   56170002
561800              IF ASC-VEH-NBR = VHTRIP-VEH-NBR                     56180002
561900                 CONTINUE                                         56190002
562000              ELSE                                                56200002
562100                 MOVE DP015-RED             TO ATRLNBRC           56210002
562200                 MOVE DP015-REVERSE         TO ATRLNBRH           56220002
562300                 MOVE -1                    TO ATRLNBRL           56230002
562400                 MOVE DP015-UNP-ALP-BRT-OFF TO ATRLNBRA           56240002
562500                 MOVE PC-TSYMSG-01052       TO DP020-MSG-NUMBER   56250002
562600                 MOVE VHTRIP-VEH-NBR        TO DP020-MSG-TEXT     56260002
562700                 SET PS-ERROR                                     56270002
562800                     DP020-MSG-FATAL        TO TRUE               56280002
562900              END-IF                                              56290002
563000           END-IF                                                 56300002
563100        END-IF                                                    56310002
563200     END-IF.                                                      56320002
563300                                                                  56330002
563400     IF PS-NO-ERROR                                               56340002
563500        IF PS-UPD-TSHIPMT-PROBOL                                  56350002
563600           PERFORM 7006-UPDATE-TSHIPMT-PROBOL                     56360002
563700        END-IF                                                    56370002
563800        IF PS-UPD-TSHIPMT-VNDSHP                                  56380002
563900           PERFORM 7000-UPDATE-TSHIPMT-VNDSHP                     56390002
564000        END-IF                                                    56400002
564100        IF PS-UPD-TVHTRIP-CARSHP                                  56410002
564200           PERFORM 7010-UPDATE-TVHTRIP                            56420002
564300        END-IF                                                    56430002
564400        IF PS-AUD-TSHIPMT                                         56440002
564500           PERFORM 6035-INSERT-TAUSHIP                            56450002
564600        END-IF                                                    56460002
564700        IF PS-AUD-TVHTRIP                                         56470002
564800           PERFORM 6095-INSERT-TAUTRIP                            56480002
564900        END-IF                                                    56490002
565000     END-IF.                                                      56500002
565100*----------------------------------------------------------------*56510002
565200*  IF A VEHICLE NUMBER WAS ENTERED THE TVEHICL TABLE IS READ TO  *56520002
565300*  DETERMINE IF A TRIP ALREADY EXISTS FOR THIS VEHICLE NUMBER.   *56530002
565400*  IF THE VEHICLE IS FOUND AND NO TRIP EXISTS (EQUAL TO NULL)    *56540002
565500*  CREATE THE NEW TRIP AND UPDATE THE CURRENT TRIP ID ON THE     *56550002
565600*  VEHICLE TABLE.  IF THE VEHICL IS FOUND ON THE TVEHICL TABLE   *56560002
565700*  AND A TRIP DOES EXIST (NOT EQUAL TO NULL) CHECK THE TRIP STATUS56570002
565800*  IF THE TRIP STATUS IS ENROUTE THEN LINK THE SHIPMENT TO THE   *56580002
565900*  EXISTING TRIP.  IF THE TRIP STATUS IS OTHER THAN ENROUTE THEN *56590002
566000*  THIS IS AN ERROR.                                              56600002
566100*  IF THE TVEHICL ROW IS NOT FOUND THEN IT IS INSERTED.           56610002
566200*  IF NO ERROR HAS OCCUREC WHEN CHECKING THE TRIP INFORMATION, A *56620002
566300*  SHIPMENT IS THEN CREATED                                       56630002
566400*----------------------------------------------------------------*56640002
566500                                                                  56650002
566600 6010-CREATE-NEW-SHIPMENT.                                        56660002
566700                                                                  56670002
566800     IF ASC-VEH-NBR > SPACES                                      56680002
566900        PERFORM 6015-CHECK-TRIP                                   56690002
567000        IF PS-FOUND                                               56700002
567100           IF DN-TRIP-ID = -1                                     56710002
567200              PERFORM 6017-CREATE-TRIP                            56720002
567300              PERFORM 6060-UPDATE-TVEHICL                         56730002
567400           ELSE                                                   56740002
567500              MOVE VEHICL-CURR-TRIP-ID TO DK-TRIP-ID              56750002
567600              PERFORM 4040-CHECK-TRIP-STATUS                      56760002
567700              IF ASC-SHIPT-STATUS-OK                              56770002
567800                 MOVE VEHICL-CURR-TRIP-ID TO ASC-TRIP-ID          56780002
567900              ELSE                                                56790002
568000                 MOVE PC-TSYMSG-01015 TO DP020-MSG-NUMBER         56800002
568100                 MOVE TRIPST-TRIP-STATUS-CDE                      56810002
568200                                      TO DP020-MSG-TEXT           56820002
568300                 SET DP020-MSG-FATAL                              56830002
568400                     PS-ERROR         TO TRUE                     56840002
568500                 MOVE DP015-RED       TO ASCACC                   56850002
568600                                         ATRLNBRC                 56860002
568700              END-IF                                              56870002
568800           END-IF                                                 56880002
568900        ELSE                                                      56890002
569000           PERFORM 6017-CREATE-TRIP                               56900002
569100           PERFORM 6050-INSERT-TVEHICL                            56910002
569200        END-IF                                                    56920002
569300     ELSE                                                         56930002
569400        PERFORM 6017-CREATE-TRIP                                  56940002
569500     END-IF.                                                      56950002
569600                                                                  56960002
569700     IF PS-NO-ERROR                                               56970002
569800        PERFORM 8100-GET-RANDOM-NUMBER                            56980002
569900        PERFORM 8300-READ-DUPL-TSHIPMT                            56990002
570000             WITH TEST AFTER                                      57000002
570100             UNTIL PV-SHIPMT-COUNT = 0                            57010002
570200        MOVE PV-CURR-SHIPT-ID TO ASC-SHIPT-ID                     57020002
570300                                                                  57030002
570400        PERFORM 6020-INSERT-TSHIPMT                               57040002
570500                                                                  57050002
570600        SET PS-SHPTPO-NOT-FOUND TO TRUE                           57060002
570700     END-IF.                                                      57070002
570800                                                                  57080002
570900 6015-CHECK-TRIP.                                                 57090002
571000                                                                  57100002
571100     MOVE ASC-SCAC-ID  TO DK-SCAC-ID.                             57110002
571200                                                                  57120002
571300     PERFORM WITH TEST AFTER                                      57130002
571400         VARYING PV-RETRY-COUNTER                                 57140002
571500         FROM 1 BY 1                                              57150002
571600         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 57160002
571700                 OR SQLCODE = 0                                   57170002
571800                 OR SQLCODE = +100)                               57180002
571900                                                                  57190002
572000         EXEC SQL                                                 57200002
572100             SELECT CURR_STATUS_CDE                               57210002
572200                   ,CURR_TRIP_ID                                  57220002
572300             INTO   :VEHICL-CURR-STATUS-CDE                       57230002
572400                   ,:VEHICL-CURR-TRIP-ID :DN-TRIP-ID              57240002
572500             FROM   TVEHICL                                       57250002
572600             WHERE  VEH_NBR       = :ASC-VEH-NBR                  57260002
572700               AND  OWNER_SCAC_ID = :DK-SCAC-ID                   57270002
572800         END-EXEC                                                 57280002
572900                                                                  57290002
573000         EVALUATE TRUE                                            57300002
573100             WHEN SQLCODE = ZERO                                  57310002
573200             WHEN SQLCODE = +100                                  57320002
573300             WHEN SQLCODE = -904                                  57330002
573400             WHEN SQLCODE = -913                                  57340002
573500                 CONTINUE                                         57350002
573600             WHEN SQLWARN0 NOT = SPACES                           57360002
573700             WHEN SQLCODE NOT EQUAL ZERO                          57370002
573800                 MOVE SPACES TO PV-MESSAGE                        57380002
573900                 MOVE ASC-VEH-NBR TO PV-MESSAGE1                  57390002
574000                 MOVE DK-SCAC-ID  TO PV-MESSAGE2                  57400002
574100                 MOVE '6015-CHECK-TRIP '                          57410002
574200                                 TO DP013-PARAGRAPH               57420002
574300                 MOVE 'CHECK TRIP EXISTANCE'                      57430002
574400                                 TO DP013-MESSAGE-TEXT(1)         57440002
574500                 MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT(2)         57450002
574600                 MOVE SQLCA      TO DP013-SQLCA                   57460002
574700                 MOVE 'TVEHICL'  TO DP013-DB2-TABLE-NAME(1)       57470002
574800                 SET DP013-DB2-ABEND                              57480002
574900                                 TO TRUE                          57490002
575000                 SET DP013-NO-ROLLBACK                            57500002
575100                                 TO TRUE                          57510002
575200                 SET DP013-XCTL-DISPLAY-RESTART                   57520002
575300                                 TO TRUE                          57530002
575400                 PERFORM DP013-0000-PROCESS-ABEND                 57540002
575500         END-EVALUATE                                             57550002
575600     END-PERFORM.                                                 57560002
575700                                                                  57570002
575800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         57580002
575900             AND (SQLCODE NOT = +0)                               57590002
576000         MOVE '6015-CHECK-TRIP '                                  57600002
576100                                 TO DP013-PARAGRAPH               57610002
576200         MOVE 'CHECK TRIP EXISTANCE' TO DP013-MESSAGE-TEXT(1)     57620002
576300         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    57630002
576400                                 TO DP013-MESSAGE-TEXT(2)         57640002
576500         MOVE SQLCA              TO DP013-SQLCA                   57650002
576600         MOVE 'TVEHICL'          TO DP013-DB2-TABLE-NAME(1)       57660002
576700         SET DP013-DB2-ABEND     TO TRUE                          57670002
576800         SET DP013-NO-ROLLBACK   TO TRUE                          57680002
576900         SET DP013-XCTL-DISPLAY-RESTART                           57690002
577000                                 TO TRUE                          57700002
577100         PERFORM DP013-0000-PROCESS-ABEND                         57710002
577200     END-IF.                                                      57720002
577300                                                                  57730002
577400     EVALUATE TRUE                                                57740002
577500         WHEN SQLCODE = ZERO                                      57750002
577600              SET PS-FOUND TO TRUE                                57760002
577700         WHEN SQLCODE = +100                                      57770002
577800              SET PS-NOT-FOUND TO TRUE                            57780002
577900     END-EVALUATE.                                                57790002
578000                                                                  57800002
578100*----------------------------------------------------------------*57810002
578200*  GENERATE A NEW TRIP ID AND CREATE THE TVHTRIP ENTRY            57820002
578300*                                                                 57830002
578400*----------------------------------------------------------------*57840002
578500 6017-CREATE-TRIP.                                                57850002
578600                                                                  57860002
578700     PERFORM 8100-GET-RANDOM-NUMBER.                              57870002
578800                                                                  57880002
578900     PERFORM 8200-READ-DUPL-TVHTRIP                               57890002
579000          WITH TEST AFTER                                         57900002
579100          UNTIL PV-VHTRIP-COUNT = 0.                              57910002
579200                                                                  57920002
579300     MOVE PV-CURR-TRIP-ID TO ASC-TRIP-ID.                         57930002
579400                                                                  57940002
579500     PERFORM 6090-INSERT-TVHTRIP.                                 57950002
579600                                                                  57960002
579700*----------------------------------------------------------------*57970002
579800*  INSERT A ROW TO THE SHIPTMENT TABLE                            57980002
579900*                                                                 57990002
580000*----------------------------------------------------------------*58000002
580100 6020-INSERT-TSHIPMT.                                             58010002
580200                                                                  58020002
580300     INITIALIZE DCLTSHIPMT.                                       58030002
580400                                                                  58040002
580500     MOVE ASC-TRIP-ID              TO SHIPMT-TRIP-ID.             58050002
580600     MOVE ASC-SHIPT-ID             TO SHIPMT-SHIPT-ID.            58060002
580700     MOVE 'PA'                     TO SHIPMT-CRT-SRC-CDE.         58070002
580800     MOVE ASC-SCAC-ID              TO SHIPMT-PRO-SCAC-ID          58080002
580900                                      SHIPMT-ORIG-SCAC-ID.        58090002
581000     MOVE ASC-PRO-NBR              TO SHIPMT-PRO-NBR.             58100002
581100     MOVE ASC-BOL-NBR              TO SHIPMT-BOL-NBR.             58110002
581200     MOVE ASC-COMPLETE-PRO-NBR     TO SHIPMT-COMPLETE-PRO-NBR.    58120002
581300     MOVE ASC-COMPLETE-BOL-NBR     TO SHIPMT-COMPLETE-BOL-NBR.    58130002
581400     MOVE +1                       TO SHIPMT-SHIPT-TYP-CDE.       58140002
581500     MOVE 'CTN'                    TO SHIPMT-PKG-TYP-CDE          58150002
581600     MOVE SPACES                   TO SHIPMT-FRGT-TERMS-CDE       58160002
581700     MOVE ASC-EXPTED-CART-CNT      TO SHIPMT-EXPTED-PKG-QTY.      58170002
581800* CT 11/11/11 - START WR40574                                     58180010
581900     MOVE ASC-CAN                  TO SHIPMT-CARR-AUTH-ID.        58190016
582000* CT 11/11/11 - END   WR40574                                     58200010
582100     MOVE ZEROES                   TO SHIPMT-FRGT-CHG-AMT         58210002
582200                                      SHIPMT-EXPTED-PLT-QTY       58220002
582300     IF ASC-VEND-SHIP-DTE = SPACES                                58230002
582400        MOVE PC-DEFAULT-DATE       TO SHIPMT-VEND-SHIP-DTE        58240002
582500     ELSE                                                         58250002
582600        MOVE ASC-VEND-SHIP-MM      TO PV-DB2-DATE-MM              58260002
582700        MOVE ASC-VEND-SHIP-DD      TO PV-DB2-DATE-DD              58270002
582800        MOVE ASC-VEND-SHIP-CCYY    TO PV-DB2-DATE-CCYY            58280002
582900        MOVE '-'                   TO PV-DB2-DASH-1               58290002
583000                                      PV-DB2-DASH-2               58300002
583100        MOVE PV-DB2-DATE           TO SHIPMT-VEND-SHIP-DTE        58310002
583200     END-IF.                                                      58320002
583300                                                                  58330002
583400     MOVE PC-CURRENT-PROGRAM-NAME  TO SHIPMT-LAST-UPD-PGM-ID.     58340002
583500     MOVE PC-DEFAULT-DATE          TO SHIPMT-CARR-LAST-UPD-DTE    58350002
583600                                      SHIPMT-CONFIRM-DTE          58360002
583700                                      SHIPMT-PROCESSED-DTE        58370002
583800                                      SHIPMT-VEND-LAST-UPD-DTE.   58380002
583900     MOVE PC-DEFAULT-TIME          TO SHIPMT-CARR-LAST-UPD-TIME   58390002
584000                                      SHIPMT-CONFIRM-TIME         58400002
584100                                      SHIPMT-VEND-LAST-UPD-TIME.  58410002
584200     MOVE ZEROES                   TO SHIPMT-CARR-CART-CT         58420002
584300                                      SHIPMT-VEND-CART-CT.        58430002
584400     MOVE ASC-VEH-NBR              TO SHIPMT-VEH-NBR.             58440002
584500     MOVE SPACES                   TO SHIPMT-AUTH-NBR.            58450002
584600     MOVE PC-DEFAULT-DATE          TO SHIPMT-AUTH-DTE.            58460002
584700                                                                  58470002
584800* CT 11/11/11 - ADDED CARR-AUTH-ID BELOW WR40574                  58480010
584900     PERFORM                                                      58490002
585000         WITH TEST AFTER                                          58500002
585100         VARYING PV-RETRY-COUNTER                                 58510002
585200         FROM 1 BY 1                                              58520002
585300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               58530002
585400             OR (SQLCODE = +0))                                   58540002
585500                                                                  58550002
585600         EXEC SQL                                                 58560002
585700             INSERT  INTO TSHIPMT                                 58570002
585800                   ( TRIP_ID                                      58580002
585900                    ,SHIPT_ID                                     58590002
586000                    ,CRT_SRC_CDE                                  58600002
586100                    ,LAST_UPD_UID                                 58610002
586200                    ,PRO_SCAC_ID                                  58620002
586300                    ,PRO_NBR                                      58630002
586400                    ,BOL_NBR                                      58640002
586500                    ,SHIPPER_NME                                  58650002
586600                    ,SHIPT_TYP_CDE                                58660002
586700                    ,PKG_TYP_CDE                                  58670002
586800                    ,EXPTED_PKG_QTY                               58680002
586900                    ,FRGT_CHG_AMT                                 58690002
587000                    ,FRGT_TERMS_CDE                               58700002
587100                    ,EXPTED_PLT_QTY                               58710002
587200                    ,VEND_SHIP_DTE                                58720002
587300                    ,EST_AR_TMST                                  58730002
587400                    ,ORIG_SCAC_ID                                 58740002
587500                    ,LAST_UPD_PGM_ID                              58750002
587600                    ,CRE_USER_ID                                  58760002
587700                    ,CARR_CART_CT                                 58770002
587800                    ,CARR_LAST_UPD_DTE                            58780002
587900                    ,CARR_LAST_UPD_TIME                           58790002
588000                    ,VEND_CART_CT                                 58800002
588100                    ,VEND_LAST_UPD_DTE                            58810002
588200                    ,VEND_LAST_UPD_TIME                           58820002
588300                    ,VEH_NBR                                      58830002
588400                    ,AUTH_NBR                                     58840002
588500                    ,AUTH_DTE                                     58850002
588600                    ,CONFIRM_DTE                                  58860002
588700                    ,CONFIRM_TIME                                 58870002
588800                    ,COMPLETE_PRO_NBR                             58880002
588900                    ,COMPLETE_BOL_NBR                             58890002
589000                    ,PROCESSED_DTE                                58900003
589100                    ,CARR_AUTH_ID )                               58910009
589200             VALUES                                               58920002
589300                   ( :SHIPMT-TRIP-ID                              58930002
589400                    ,:SHIPMT-SHIPT-ID                             58940002
589500                    ,:SHIPMT-CRT-SRC-CDE                          58950002
589600                    ,:DP020-USERID                                58960002
589700                    ,:SHIPMT-PRO-SCAC-ID                          58970002
589800                    ,:SHIPMT-PRO-NBR                              58980002
589900                    ,:SHIPMT-BOL-NBR                              58990002
590000                    ,:SHIPMT-SHIPPER-NME                          59000002
590100                    ,:SHIPMT-SHIPT-TYP-CDE                        59010002
590200                    ,:SHIPMT-PKG-TYP-CDE                          59020002
590300                    ,:SHIPMT-EXPTED-PKG-QTY                       59030002
590400                    ,:SHIPMT-FRGT-CHG-AMT                         59040002
590500                    ,:SHIPMT-FRGT-TERMS-CDE                       59050002
590600                    ,:SHIPMT-EXPTED-PLT-QTY                       59060002
590700                    ,:SHIPMT-VEND-SHIP-DTE                        59070002
590800                    ,CURRENT TIMESTAMP                            59080002
590900                    ,:SHIPMT-ORIG-SCAC-ID                         59090002
591000                    ,:PC-CURRENT-PROGRAM-NAME                     59100002
591100                    ,:DP020-USERID                                59110002
591200                    ,:SHIPMT-CARR-CART-CT                         59120002
591300                    ,:PC-DEFAULT-DATE                             59130002
591400                    ,:PC-DEFAULT-TIME                             59140002
591500                    ,:SHIPMT-VEND-CART-CT                         59150002
591600                    ,:PC-DEFAULT-DATE                             59160002
591700                    ,:PC-DEFAULT-TIME                             59170002
591800                    ,:SHIPMT-VEH-NBR                              59180002
591900                    ,:SHIPMT-AUTH-NBR                             59190002
592000                    ,:SHIPMT-AUTH-DTE                             59200002
592100                    ,:PC-DEFAULT-DATE                             59210002
592200                    ,:PC-DEFAULT-TIME                             59220002
592300                    ,:SHIPMT-COMPLETE-PRO-NBR                     59230002
592400                    ,:SHIPMT-COMPLETE-BOL-NBR                     59240002
592500                    ,:SHIPMT-PROCESSED-DTE                        59250003
592600                    ,:SHIPMT-CARR-AUTH-ID)                        59260007
592700         END-EXEC                                                 59270002
592800                                                                  59280002
592900         EVALUATE TRUE                                            59290002
593000             WHEN SQLCODE = +0                                    59300002
593100             WHEN SQLCODE = -904                                  59310002
593200             WHEN SQLCODE = -913                                  59320002
593300                 CONTINUE                                         59330002
593400                                                                  59340002
593500             WHEN SQLWARN0 NOT = SPACES                           59350002
593600             WHEN SQLCODE < +0                                    59360002
593700             WHEN SQLCODE > +0                                    59370002
593800                 MOVE SPACES TO PV-MESSAGE                        59380002
593900                 MOVE SHIPMT-SHIPT-ID TO PV-MESSAGE1              59390002
594000                 MOVE SHIPMT-TRIP-ID  TO PV-MESSAGE2              59400002
594100                 MOVE SHIPMT-PRO-SCAC-ID TO PV-MESSAGE3           59410002
594200                 MOVE '6020-INSERT-TSHIPMT'                       59420002
594300                                   TO DP013-PARAGRAPH             59430002
594400                 MOVE 'INSERT A ROW ON TSHIPMT'                   59440002
594500                                   TO DP013-MESSAGE-TEXT(1)       59450002
594600                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       59460002
594700                 MOVE SPACES TO PV-MESSAGE                        59470002
594800                 MOVE SHIPMT-PRO-NBR  TO PV-MESSAGE1              59480002
594900                 MOVE SHIPMT-BOL-NBR  TO PV-MESSAGE2              59490002
595000                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(3)       59500002
595100                 MOVE SQLCA        TO DP013-SQLCA                 59510002
595200                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    59520002
595300                 SET DP013-DB2-ABEND                              59530002
595400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           59540002
595500                 PERFORM DP013-0000-PROCESS-ABEND                 59550002
595600         END-EVALUATE                                             59560002
595700     END-PERFORM.                                                 59570002
595800                                                                  59580002
595900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        59590002
596000             AND (SQLCODE NOT = +0)                               59600002
596100         MOVE '6030-INSERT-TSHIPMT'                               59610002
596200                                   TO DP013-PARAGRAPH             59620002
596300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              59630002
596400                                   TO DP013-MESSAGE-TEXT (1)      59640002
596500         MOVE 'TO INSERT A TSHIPMT ROW'                           59650002
596600                                   TO DP013-MESSAGE-TEXT (2)      59660002
596700         MOVE SQLCA                TO DP013-SQLCA                 59670002
596800         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    59680002
596900         SET DP013-DB2-ABEND                                      59690002
597000             DP013-XCTL-DISPLAY-RESTART                           59700002
597100                                   TO TRUE                        59710002
597200         PERFORM DP013-0000-PROCESS-ABEND                         59720002
597300     END-IF.                                                      59730002
597400                                                                  59740002
597500     EVALUATE TRUE                                                59750002
597600         WHEN SQLCODE = ZERO                                      59760002
597700              PERFORM 6045-INSERT-TSHIPST                         59770002
597800              PERFORM 6035-INSERT-TAUSHIP                         59780002
597900     END-EVALUATE.                                                59790002
598000 EJECT                                                            59800002
598100*----------------------------------------------------------------*59810002
598200*  INSERT A ROW TO THE SHIPTMENT AUDIT TABLE                      59820002
598300*----------------------------------------------------------------*59830002
598400 6035-INSERT-TAUSHIP.                                             59840002
598500                                                                  59850002
598600     INITIALIZE DCLTAUSHIP.                                       59860002
598700                                                                  59870002
598800     PERFORM                                                      59880002
598900         WITH TEST AFTER                                          59890002
599000         VARYING PV-RETRY-COUNTER                                 59900002
599100         FROM 1 BY 1                                              59910002
599200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               59920002
599300             OR (SQLCODE = +0))                                   59930002
599400                                                                  59940002
599500         EXEC SQL                                                 59950002
599600             SELECT  A.TRIP_ID                                    59960002
599700                    ,A.SHIPT_ID                                   59970002
599800                    ,A.CRT_SRC_CDE                                59980002
599900                    ,A.LAST_UPD_DTE                               59990002
600000                    ,A.LAST_UPD_TME                               60000002
600100                    ,A.LAST_UPD_UID                               60010002
600200                    ,A.PRO_SCAC_ID                                60020002
600300                    ,A.PRO_NBR                                    60030002
600400                    ,A.BOL_NBR                                    60040002
600500                    ,A.SHIPPER_NME                                60050002
600600                    ,A.SHIPT_TYP_CDE                              60060002
600700                    ,A.EXPTED_GRO_WGHT                            60070002
600800                    ,A.PKG_TYP_CDE                                60080002
600900                    ,A.EXPTED_PKG_QTY                             60090002
601000                    ,A.FRGT_CHG_AMT                               60100002
601100                    ,A.FRGT_TERMS_CDE                             60110002
601200                    ,A.EXPTED_PLT_QTY                             60120002
601300                    ,A.VEND_SHIP_DTE                              60130002
601400                    ,A.EST_AR_TMST                                60140002
601500                    ,A.ORIG_SCAC_ID                               60150002
601600                    ,A.LAST_UPD_PGM_ID                            60160002
601700                    ,A.CRE_USER_ID                                60170002
601800                    ,A.CARR_CART_CT                               60180002
601900                    ,A.CARR_LAST_UPD_DTE                          60190002
602000                    ,A.CARR_LAST_UPD_TIME                         60200002
602100                    ,A.VEND_CART_CT                               60210002
602200                    ,A.VEND_LAST_UPD_DTE                          60220002
602300                    ,A.VEND_LAST_UPD_TIME                         60230002
602400                    ,A.VEH_NBR                                    60240002
602500                    ,A.AUTH_NBR                                   60250002
602600                    ,A.AUTH_DTE                                   60260002
602700                    ,A.CONFIRM_DTE                                60270002
602800                    ,A.CONFIRM_TIME                               60280002
602900                    ,A.COMPLETE_PRO_NBR                           60290002
603000                    ,A.COMPLETE_BOL_NBR                           60300002
603100                    ,A.PROCESSED_DTE                              60310002
603200                    ,A.INVC_NBR                                   60320002
603300                    ,A.CARR_AUTH_ID                               60330007
603400            INTO     :SHIPMT-TRIP-ID                              60340002
603500                       :DN-TRIP-ID                                60350002
603600                    ,:SHIPMT-SHIPT-ID                             60360002
603700                    ,:SHIPMT-CRT-SRC-CDE                          60370002
603800                    ,:SHIPMT-LAST-UPD-DTE                         60380002
603900                    ,:SHIPMT-LAST-UPD-TME                         60390002
604000                    ,:SHIPMT-LAST-UPD-UID                         60400002
604100                    ,:SHIPMT-PRO-SCAC-ID                          60410002
604200                    ,:SHIPMT-PRO-NBR                              60420002
604300                    ,:SHIPMT-BOL-NBR                              60430002
604400                    ,:SHIPMT-SHIPPER-NME                          60440002
604500                    ,:SHIPMT-SHIPT-TYP-CDE                        60450002
604600                    ,:SHIPMT-EXPTED-GRO-WGHT                      60460002
604700                    ,:SHIPMT-PKG-TYP-CDE                          60470002
604800                    ,:SHIPMT-EXPTED-PKG-QTY                       60480002
604900                    ,:SHIPMT-FRGT-CHG-AMT                         60490002
605000                    ,:SHIPMT-FRGT-TERMS-CDE                       60500002
605100                    ,:SHIPMT-EXPTED-PLT-QTY                       60510002
605200                    ,:SHIPMT-VEND-SHIP-DTE                        60520002
605300                    ,:SHIPMT-EST-AR-TMST                          60530002
605400                       :DN-EST-AR-TMST                            60540002
605500                    ,:SHIPMT-ORIG-SCAC-ID                         60550002
605600                    ,:SHIPMT-LAST-UPD-PGM-ID                      60560002
605700                    ,:SHIPMT-CRE-USER-ID                          60570002
605800                    ,:SHIPMT-CARR-CART-CT                         60580002
605900                    ,:SHIPMT-CARR-LAST-UPD-DTE                    60590002
606000                    ,:SHIPMT-CARR-LAST-UPD-TIME                   60600002
606100                    ,:SHIPMT-VEND-CART-CT                         60610002
606200                    ,:SHIPMT-VEND-LAST-UPD-DTE                    60620002
606300                    ,:SHIPMT-VEND-LAST-UPD-TIME                   60630002
606400                    ,:SHIPMT-VEH-NBR                              60640002
606500                    ,:SHIPMT-AUTH-NBR                             60650002
606600                    ,:SHIPMT-AUTH-DTE                             60660002
606700                    ,:SHIPMT-CONFIRM-DTE                          60670002
606800                    ,:SHIPMT-CONFIRM-TIME                         60680002
606900                    ,:SHIPMT-COMPLETE-PRO-NBR                     60690002
607000                    ,:SHIPMT-COMPLETE-BOL-NBR                     60700002
607100                    ,:SHIPMT-PROCESSED-DTE                        60710002
607200                    ,:SHIPMT-INVC-NBR                             60720002
607300                    ,:SHIPMT-CARR-AUTH-ID                         60730007
607400           FROM   TSHIPMT A                                       60740002
607500           WHERE  A.SHIPT_ID         = :SHIPMT-SHIPT-ID           60750002
607600         END-EXEC                                                 60760002
607700                                                                  60770002
607800         EVALUATE TRUE                                            60780002
607900             WHEN SQLCODE = +0                                    60790002
608000             WHEN SQLCODE = -904                                  60800002
608100             WHEN SQLCODE = -913                                  60810002
608200                 CONTINUE                                         60820002
608300                                                                  60830002
608400             WHEN SQLWARN0 NOT = SPACES                           60840002
608500             WHEN SQLCODE < +0                                    60850002
608600             WHEN SQLCODE > +0                                    60860002
608700                 MOVE '6035-INSERT-TAUSHIP'                       60870002
608800                                   TO DP013-PARAGRAPH             60880002
608900                 MOVE 'SELECT A TSHIPMT ROW   '                   60890002
609000                                   TO DP013-MESSAGE-TEXT(1)       60900002
609100                 MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    60910002
609200                 MOVE SQLCA        TO DP013-SQLCA                 60920002
609300                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    60930002
609400                 SET DP013-DB2-ABEND                              60940002
609500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           60950002
609600                 PERFORM DP013-0000-PROCESS-ABEND                 60960002
609700         END-EVALUATE                                             60970002
609800     END-PERFORM.                                                 60980002
609900                                                                  60990002
610000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        61000002
610100             AND (SQLCODE NOT = +0)                               61010002
610200         MOVE '6035-INSERT-TAUSHIP'                               61020002
610300                                   TO DP013-PARAGRAPH             61030002
610400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              61040002
610500                                   TO DP013-MESSAGE-TEXT (1)      61050002
610600         MOVE 'TO SELECT A TSHIPMT ROW'                           61060002
610700                                   TO DP013-MESSAGE-TEXT (2)      61070002
610800         MOVE SQLCA                TO DP013-SQLCA                 61080002
610900         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    61090002
611000         SET DP013-DB2-ABEND                                      61100002
611100             DP013-XCTL-DISPLAY-RESTART                           61110002
611200                                   TO TRUE                        61120002
611300         PERFORM DP013-0000-PROCESS-ABEND                         61130002
611400     END-IF.                                                      61140002
611500                                                                  61150002
611600* CT 11/11/11 - ADDED CARR-AUTH-ID BELOW WR40574                  61160010
611700     PERFORM                                                      61170002
611800         WITH TEST AFTER                                          61180002
611900         VARYING PV-RETRY-COUNTER                                 61190002
612000         FROM 1 BY 1                                              61200002
612100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               61210002
612200             OR (SQLCODE = +0))                                   61220002
612300                                                                  61230002
612400         EXEC SQL                                                 61240002
612500             INSERT  INTO TAUSHIP                                 61250002
612600                    (TRIP_ID                                      61260002
612700                    ,SHIPT_ID                                     61270002
612800                    ,CRT_SRC_CDE                                  61280002
612900                    ,LAST_UPD_DTE                                 61290002
613000                    ,LAST_UPD_TME                                 61300002
613100                    ,LAST_UPD_UID                                 61310002
613200                    ,PRO_SCAC_ID                                  61320002
613300                    ,PRO_NBR                                      61330002
613400                    ,BOL_NBR                                      61340002
613500                    ,SHIPPER_NME                                  61350002
613600                    ,SHIPT_TYP_CDE                                61360002
613700                    ,EXPTED_GRO_WGHT                              61370002
613800                    ,PKG_TYP_CDE                                  61380002
613900                    ,EXPTED_PKG_QTY                               61390002
614000                    ,FRGT_CHG_AMT                                 61400002
614100                    ,FRGT_TERMS_CDE                               61410002
614200                    ,EST_AR_TMST                                  61420002
614300                    ,VEND_SHIP_DTE                                61430002
614400                    ,EXPTED_PLT_QTY                               61440002
614500                    ,ORIG_SCAC_ID                                 61450002
614600                    ,LAST_UPD_PGM_ID                              61460002
614700                    ,CRE_USER_ID                                  61470002
614800                    ,CARR_CART_CT                                 61480002
614900                    ,CARR_LAST_UPD_DTE                            61490002
615000                    ,CARR_LAST_UPD_TIME                           61500002
615100                    ,VEND_CART_CT                                 61510002
615200                    ,VEND_LAST_UPD_DTE                            61520002
615300                    ,VEND_LAST_UPD_TIME                           61530002
615400                    ,VEH_NBR                                      61540002
615500                    ,AUTH_NBR                                     61550002
615600                    ,AUTH_DTE                                     61560002
615700                    ,CONFIRM_DTE                                  61570002
615800                    ,CONFIRM_TIME                                 61580002
615900                    ,AUD_STATUS_CDE                               61590002
616000                    ,PROCESSED_DTE                                61600002
616100                    ,INVC_NBR                                     61610003
616200                    ,CARR_AUTH_ID )                               61620007
616300            VALUES  (:SHIPMT-TRIP-ID                              61630002
616400                       :DN-TRIP-ID                                61640002
616500                    ,:SHIPMT-SHIPT-ID                             61650002
616600                    ,:SHIPMT-CRT-SRC-CDE                          61660002
616700                    ,:SHIPMT-LAST-UPD-DTE                         61670002
616800                    ,:SHIPMT-LAST-UPD-TME                         61680002
616900                    ,:SHIPMT-LAST-UPD-UID                         61690002
617000                    ,:SHIPMT-PRO-SCAC-ID                          61700002
617100                    ,:SHIPMT-COMPLETE-PRO-NBR                     61710002
617200                    ,:SHIPMT-COMPLETE-BOL-NBR                     61720002
617300                    ,:SHIPMT-SHIPPER-NME                          61730002
617400                    ,:SHIPMT-SHIPT-TYP-CDE                        61740002
617500                    ,:SHIPMT-EXPTED-GRO-WGHT                      61750002
617600                    ,:SHIPMT-PKG-TYP-CDE                          61760002
617700                    ,:SHIPMT-EXPTED-PKG-QTY                       61770002
617800                    ,:SHIPMT-FRGT-CHG-AMT                         61780002
617900                    ,:SHIPMT-FRGT-TERMS-CDE                       61790002
618000                    ,:SHIPMT-EST-AR-TMST                          61800002
618100                       :DN-EST-AR-TMST                            61810002
618200                    ,:SHIPMT-VEND-SHIP-DTE                        61820002
618300                    ,:SHIPMT-EXPTED-PLT-QTY                       61830002
618400                    ,:SHIPMT-ORIG-SCAC-ID                         61840002
618500                    ,:SHIPMT-LAST-UPD-PGM-ID                      61850002
618600                    ,:SHIPMT-CRE-USER-ID                          61860002
618700                    ,:SHIPMT-CARR-CART-CT                         61870002
618800                    ,:SHIPMT-CARR-LAST-UPD-DTE                    61880002
618900                    ,:SHIPMT-CARR-LAST-UPD-TIME                   61890002
619000                    ,:SHIPMT-VEND-CART-CT                         61900002
619100                    ,:SHIPMT-VEND-LAST-UPD-DTE                    61910002
619200                    ,:SHIPMT-VEND-LAST-UPD-TIME                   61920002
619300                    ,:SHIPMT-VEH-NBR                              61930002
619400                    ,:SHIPMT-AUTH-NBR                             61940002
619500                    ,:SHIPMT-AUTH-DTE                             61950002
619600                    ,:SHIPMT-CONFIRM-DTE                          61960002
619700                    ,:SHIPMT-CONFIRM-TIME                         61970002
619800                    ,:SHIPST-SHIPT-STATUS-CDE                     61980002
619900                    ,:SHIPMT-PROCESSED-DTE                        61990002
620000                    ,:SHIPMT-INVC-NBR                             62000003
620100                    ,:SHIPMT-CARR-AUTH-ID )                       62010007
620200         END-EXEC                                                 62020002
620300                                                                  62030002
620400                                                                  62040002
620500         EVALUATE TRUE                                            62050002
620600             WHEN SQLCODE = +0                                    62060002
620700             WHEN SQLCODE = -904                                  62070002
620800             WHEN SQLCODE = -913                                  62080002
620900                 CONTINUE                                         62090002
621000                                                                  62100002
621100             WHEN SQLWARN0 NOT = SPACES                           62110002
621200             WHEN SQLCODE < +0                                    62120002
621300             WHEN SQLCODE > +0                                    62130002
621400                 MOVE '6035-INSERT-TAUSHIP'                       62140002
621500                                   TO DP013-PARAGRAPH             62150002
621600                 MOVE 'INSERT A ROW ON TAUSHIP'                   62160002
621700                                   TO DP013-MESSAGE-TEXT(1)       62170002
621800                 MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)    62180002
621900                 MOVE SQLCA        TO DP013-SQLCA                 62190002
622000                 MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)    62200002
622100                 SET DP013-DB2-ABEND                              62210002
622200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           62220002
622300                 PERFORM DP013-0000-PROCESS-ABEND                 62230002
622400         END-EVALUATE                                             62240002
622500     END-PERFORM.                                                 62250002
622600                                                                  62260002
622700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        62270002
622800             AND (SQLCODE NOT = +0)                               62280002
622900         MOVE '6035-INSERT-TAUSHIP'                               62290002
623000                                   TO DP013-PARAGRAPH             62300002
623100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              62310002
623200                                   TO DP013-MESSAGE-TEXT (1)      62320002
623300         MOVE 'TO INSERT A TAUSHIP ROW'                           62330002
623400                                   TO DP013-MESSAGE-TEXT (2)      62340002
623500         MOVE SQLCA                TO DP013-SQLCA                 62350002
623600         MOVE 'TAUSHIP'            TO DP013-DB2-TABLE-NAME (1)    62360002
623700         SET DP013-DB2-ABEND                                      62370002
623800             DP013-XCTL-DISPLAY-RESTART                           62380002
623900                                   TO TRUE                        62390002
624000         PERFORM DP013-0000-PROCESS-ABEND                         62400002
624100     END-IF.                                                      62410002
624200                                                                  62420002
624300*----------------------------------------------------------------*62430002
624400*  INSERT A ROW TO THE TRIP STATUS TABLE                          62440002
624500*                                                                 62450002
624600*----------------------------------------------------------------*62460002
624700 6040-INSERT-TTRIPST.                                             62470002
624800                                                                  62480002
624900     INITIALIZE DCLTTRIPST.                                       62490002
625000                                                                  62500002
625100     MOVE ASC-TRIP-ID              TO TRIPST-TRIP-ID.             62510002
625200     MOVE 'EN'                     TO TRIPST-TRIP-STATUS-CDE.     62520002
625300     MOVE ASC-CRE-OPER-UNT-ID      TO TRIPST-OPER-UNT-ID.         62530002
625400     MOVE ASC-CRE-FCLTY-ID         TO TRIPST-FCLTY-ID.            62540002
625500     MOVE SPACES                   TO TRIPST-FCLTY-AREA-ID.       62550002
625600                                                                  62560002
625700     PERFORM                                                      62570002
625800         WITH TEST AFTER                                          62580002
625900         VARYING PV-RETRY-COUNTER                                 62590002
626000         FROM 1 BY 1                                              62600002
626100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               62610002
626200             OR (SQLCODE = +0))                                   62620002
626300                                                                  62630002
626400         EXEC SQL                                                 62640002
626500             INSERT  INTO TTRIPST                                 62650002
626600                   ( TRIP_ID                                      62660002
626700                    ,TRIP_STATUS_CDE                              62670002
626800                    ,STATUS_UID                                   62680002
626900                    ,OPER_UNT_ID                                  62690002
627000                    ,FCLTY_ID                                     62700002
627100                    ,FCLTY_AREA_ID )                              62710002
627200             VALUES                                               62720002
627300                   ( :TRIPST-TRIP-ID                              62730002
627400                    ,:TRIPST-TRIP-STATUS-CDE                      62740002
627500                    ,:DP020-USERID                                62750002
627600                    ,:TRIPST-OPER-UNT-ID                          62760002
627700                    ,:TRIPST-FCLTY-ID                             62770002
627800                    ,:TRIPST-FCLTY-AREA-ID )                      62780002
627900         END-EXEC                                                 62790002
628000                                                                  62800002
628100         EVALUATE TRUE                                            62810002
628200             WHEN SQLCODE = +0                                    62820002
628300             WHEN SQLCODE = -904                                  62830002
628400             WHEN SQLCODE = -913                                  62840002
628500                 CONTINUE                                         62850002
628600                                                                  62860002
628700             WHEN SQLWARN0 NOT = SPACES                           62870002
628800             WHEN SQLCODE < +0                                    62880002
628900             WHEN SQLCODE > +0                                    62890002
629000                 MOVE SPACES TO PV-MESSAGE                        62900002
629100                 MOVE TRIPST-TRIP-ID TO PV-MESSAGE1               62910002
629200                 MOVE TRIPST-TRIP-STATUS-CDE TO PV-MESSAGE2       62920002
629300                 MOVE '6040-INSERT-TTRIPST'                       62930002
629400                                   TO DP013-PARAGRAPH             62940002
629500                 MOVE 'INSERT A ROW ON TTRIPST'                   62950002
629600                                   TO DP013-MESSAGE-TEXT(1)       62960002
629700                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       62970002
629800                 MOVE SQLCA        TO DP013-SQLCA                 62980002
629900                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    62990002
630000                 SET DP013-DB2-ABEND                              63000002
630100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           63010002
630200                 PERFORM DP013-0000-PROCESS-ABEND                 63020002
630300         END-EVALUATE                                             63030002
630400     END-PERFORM.                                                 63040002
630500                                                                  63050002
630600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        63060002
630700             AND (SQLCODE NOT = +0)                               63070002
630800         MOVE '6040-INSERT-TTRIPST'                               63080002
630900                                   TO DP013-PARAGRAPH             63090002
631000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              63100002
631100                                   TO DP013-MESSAGE-TEXT (1)      63110002
631200         MOVE 'TO INSERT A TTRIPST ROW'                           63120002
631300                                   TO DP013-MESSAGE-TEXT (2)      63130002
631400         MOVE SQLCA                TO DP013-SQLCA                 63140002
631500         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    63150002
631600         SET DP013-DB2-ABEND                                      63160002
631700             DP013-XCTL-DISPLAY-RESTART                           63170002
631800                                   TO TRUE                        63180002
631900         PERFORM DP013-0000-PROCESS-ABEND                         63190002
632000     END-IF.                                                      63200002
632100                                                                  63210002
632200/                                                                 63220002
632300*----------------------------------------------------------------*63230002
632400*  INSERT A ROW TO THE SHIPMENT STATUS TABLE                      63240002
632500*                                                                 63250002
632600*----------------------------------------------------------------*63260002
632700 6045-INSERT-TSHIPST.                                             63270002
632800                                                                  63280002
632900     INITIALIZE DCLTSHIPST.                                       63290002
633000                                                                  63300002
633100     MOVE ASC-SHIPT-ID             TO SHIPST-SHIPT-ID.            63310002
633200     MOVE 'EN'                     TO SHIPST-SHIPT-STATUS-CDE.    63320002
633300                                                                  63330002
633400     PERFORM                                                      63340002
633500         WITH TEST AFTER                                          63350002
633600         VARYING PV-RETRY-COUNTER                                 63360002
633700         FROM 1 BY 1                                              63370002
633800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               63380002
633900             OR (SQLCODE = +0))                                   63390002
634000                                                                  63400002
634100         EXEC SQL                                                 63410002
634200             INSERT  INTO TSHIPST                                 63420002
634300                   ( SHIPT_ID                                     63430002
634400                    ,SHIPT_STATUS_CDE                             63440002
634500                    ,STATUS_UID )                                 63450002
634600             VALUES                                               63460002
634700                   ( :SHIPST-SHIPT-ID                             63470002
634800                    ,:SHIPST-SHIPT-STATUS-CDE                     63480002
634900                    ,:DP020-USERID )                              63490002
635000         END-EXEC                                                 63500002
635100                                                                  63510002
635200         EVALUATE TRUE                                            63520002
635300             WHEN SQLCODE = +0                                    63530002
635400             WHEN SQLCODE = -904                                  63540002
635500             WHEN SQLCODE = -913                                  63550002
635600                 CONTINUE                                         63560002
635700                                                                  63570002
635800             WHEN SQLWARN0 NOT = SPACES                           63580002
635900             WHEN SQLCODE < +0                                    63590002
636000             WHEN SQLCODE > +0                                    63600002
636100                 MOVE SPACES TO PV-MESSAGE                        63610002
636200                 MOVE SHIPST-SHIPT-ID TO PV-MESSAGE1              63620002
636300                 MOVE SHIPST-SHIPT-STATUS-CDE TO PV-MESSAGE2      63630002
636400                 MOVE '6045-INSERT-TSHIPST'                       63640002
636500                                   TO DP013-PARAGRAPH             63650002
636600                 MOVE 'INSERT A ROW ON TSHIPST'                   63660002
636700                                   TO DP013-MESSAGE-TEXT(1)       63670002
636800                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       63680002
636900                 MOVE SQLCA        TO DP013-SQLCA                 63690002
637000                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    63700002
637100                 SET DP013-DB2-ABEND                              63710002
637200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           63720002
637300                 PERFORM DP013-0000-PROCESS-ABEND                 63730002
637400         END-EVALUATE                                             63740002
637500     END-PERFORM.                                                 63750002
637600                                                                  63760002
637700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        63770002
637800             AND (SQLCODE NOT = +0)                               63780002
637900         MOVE '6045-INSERT-TSHIPST'                               63790002
638000                                   TO DP013-PARAGRAPH             63800002
638100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              63810002
638200                                   TO DP013-MESSAGE-TEXT (1)      63820002
638300         MOVE 'TO INSERT A TSHIPST ROW'                           63830002
638400                                   TO DP013-MESSAGE-TEXT (2)      63840002
638500         MOVE SQLCA                TO DP013-SQLCA                 63850002
638600         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    63860002
638700         SET DP013-DB2-ABEND                                      63870002
638800             DP013-XCTL-DISPLAY-RESTART                           63880002
638900                                   TO TRUE                        63890002
639000         PERFORM DP013-0000-PROCESS-ABEND                         63900002
639100     END-IF.                                                      63910002
639200                                                                  63920002
639300 EJECT                                                            63930002
639400*----------------------------------------------------------------*63940002
639500*  INSERT A ROW TO THE VEHICLE TABLE                              63950002
639600*                                                                 63960002
639700*----------------------------------------------------------------*63970002
639800 6050-INSERT-TVEHICL.                                             63980002
639900                                                                  63990002
640000     INITIALIZE DCLTVEHICL.                                       64000002
640100                                                                  64010002
640200     MOVE ASC-SCAC-ID              TO VEHICL-OWNER-SCAC-ID        64020002
640300                                      DK-SCAC-ID.                 64030002
640400     MOVE ASC-VEH-NBR              TO VEHICL-VEH-NBR              64040002
640500                                      DK-VEH-NBR.                 64050002
640600     MOVE 'PA'                     TO VEHICL-CRT-SRC-CDE.         64060002
640700     MOVE 'RCV'                    TO VEHICL-USAGE-CDE.           64070002
640800     MOVE 'TR'                     TO VEHICL-VEH-TYP-CDE.         64080002
640900     MOVE 'EN'                     TO VEHICL-CURR-STATUS-CDE.     64090002
641000     MOVE ASC-CRE-OPER-UNT-ID      TO VEHICL-CURR-OPER-UNT-ID.    64100002
641100     MOVE ASC-CRE-FCLTY-ID         TO VEHICL-CURR-FCLTY-ID.       64110002
641200     MOVE ASC-TRIP-ID              TO VEHICL-CURR-TRIP-ID.        64120002
641300     MOVE +1                       TO DN-TRIP-ID.                 64130002
641400                                                                  64140002
641500     PERFORM                                                      64150002
641600         WITH TEST AFTER                                          64160002
641700         VARYING PV-RETRY-COUNTER                                 64170002
641800         FROM 1 BY 1                                              64180002
641900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               64190002
642000             OR (SQLCODE = +0))                                   64200002
642100                                                                  64210002
642200         EXEC SQL                                                 64220002
642300             INSERT  INTO TVEHICL                                 64230002
642400                   ( OWNER_SCAC_ID                                64240002
642500                    ,VEH_NBR                                      64250002
642600                    ,CRT_SRC_CDE                                  64260002
642700                    ,LAST_UPD_UID                                 64270002
642800                    ,USAGE_CDE                                    64280002
642900                    ,VEH_TYP_CDE                                  64290002
643000                    ,CURR_STATUS_CDE                              64300002
643100                    ,CURR_STATUS_DTE                              64310002
643200                    ,CURR_STATUS_TME                              64320002
643300                    ,CURR_OPER_UNT_ID                             64330002
643400                    ,CURR_FCLTY_ID                                64340002
643500                    ,CURR_TRIP_ID )                               64350002
643600             VALUES                                               64360002
643700                   ( :VEHICL-OWNER-SCAC-ID                        64370002
643800                    ,:VEHICL-VEH-NBR                              64380002
643900                    ,:VEHICL-CRT-SRC-CDE                          64390002
644000                    ,:DP020-USERID                                64400002
644100                    ,:VEHICL-USAGE-CDE                            64410002
644200                    ,:VEHICL-VEH-TYP-CDE                          64420002
644300                    ,:VEHICL-CURR-STATUS-CDE                      64430002
644400                    ,CURRENT DATE                                 64440002
644500                    ,CURRENT TIME                                 64450002
644600                    ,:VEHICL-CURR-OPER-UNT-ID                     64460002
644700                    ,:VEHICL-CURR-FCLTY-ID                        64470002
644800                    ,:VEHICL-CURR-TRIP-ID :DN-TRIP-ID)            64480002
644900         END-EXEC                                                 64490002
645000                                                                  64500002
645100         EVALUATE TRUE                                            64510002
645200             WHEN SQLCODE = +0                                    64520002
645300             WHEN SQLCODE = -904                                  64530002
645400             WHEN SQLCODE = -913                                  64540002
645500                 CONTINUE                                         64550002
645600                                                                  64560002
645700             WHEN SQLWARN0 NOT = SPACES                           64570002
645800             WHEN SQLCODE < +0                                    64580002
645900             WHEN SQLCODE > +0                                    64590002
646000                 MOVE SPACES TO PV-MESSAGE                        64600002
646100                 MOVE VEHICL-OWNER-SCAC-ID TO PV-MESSAGE1         64610002
646200                 MOVE VEHICL-VEH-NBR       TO PV-MESSAGE2         64620002
646300                 MOVE '6050-INSERT-TVEHICL'                       64630002
646400                                   TO DP013-PARAGRAPH             64640002
646500                 MOVE 'INSERT A ROW ON TVEHICL'                   64650002
646600                                   TO DP013-MESSAGE-TEXT(1)       64660002
646700                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       64670002
646800                 MOVE SQLCA        TO DP013-SQLCA                 64680002
646900                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    64690002
647000                 SET DP013-DB2-ABEND                              64700002
647100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           64710002
647200                 PERFORM DP013-0000-PROCESS-ABEND                 64720002
647300         END-EVALUATE                                             64730002
647400     END-PERFORM.                                                 64740002
647500                                                                  64750002
647600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        64760002
647700             AND (SQLCODE NOT = +0)                               64770002
647800         MOVE '6050-INSERT-TVEHICL'                               64780002
647900                                   TO DP013-PARAGRAPH             64790002
648000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              64800002
648100                                   TO DP013-MESSAGE-TEXT (1)      64810002
648200         MOVE 'TO INSERT A TVEHICL ROW'                           64820002
648300                                   TO DP013-MESSAGE-TEXT (2)      64830002
648400         MOVE SQLCA                TO DP013-SQLCA                 64840002
648500         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    64850002
648600         SET DP013-DB2-ABEND                                      64860002
648700             DP013-XCTL-DISPLAY-RESTART                           64870002
648800                                   TO TRUE                        64880002
648900         PERFORM DP013-0000-PROCESS-ABEND                         64890002
649000     END-IF.                                                      64900002
649100                                                                  64910002
649200     IF SQLCODE = ZERO                                            64920002
649300        PERFORM 6055-INSERT-TAUVHCL                               64930002
649400     END-IF.                                                      64940002
649500 EJECT                                                            64950002
649600*----------------------------------------------------------------*64960002
649700*  INSERT A ROW TO THE VEHICLE AUDIT TABLE                        64970002
649800*                                                                 64980002
649900*----------------------------------------------------------------*64990002
650000 6055-INSERT-TAUVHCL.                                             65000002
650100                                                                  65010002
650200     INITIALIZE DCLTAUVHCL.                                       65020002
650300                                                                  65030002
650400     PERFORM                                                      65040002
650500         WITH TEST AFTER                                          65050002
650600         VARYING PV-RETRY-COUNTER                                 65060002
650700         FROM 1 BY 1                                              65070002
650800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               65080002
650900             OR (SQLCODE = +0))                                   65090002
651000                                                                  65100002
651100         EXEC SQL                                                 65110002
651200             SELECT  OWNER_SCAC_ID                                65120002
651300                    ,VEH_NBR                                      65130002
651400                    ,CRT_SRC_CDE                                  65140002
651500                    ,LAST_UPD_DTE                                 65150002
651600                    ,LAST_UPD_TME                                 65160002
651700                    ,LAST_UPD_UID                                 65170002
651800                    ,USAGE_CDE                                    65180002
651900                    ,VEH_TYP_CDE                                  65190002
652000                    ,CURR_STATUS_CDE                              65200002
652100                    ,CURR_STATUS_DTE                              65210002
652200                    ,CURR_STATUS_TME                              65220002
652300                    ,CURR_OPER_UNT_ID                             65230002
652400                    ,CURR_FCLTY_ID                                65240002
652500                    ,CURR_FAC_AREA_ID                             65250002
652600                    ,CURR_LOC_DTE                                 65260002
652700                    ,CURR_LOC_TME                                 65270002
652800                    ,CURR_TRIP_ID                                 65280002
652900                    ,VEH_SIZE_CDE                                 65290002
653000            INTO     :VEHICL-OWNER-SCAC-ID                        65300002
653100                    ,:VEHICL-VEH-NBR                              65310002
653200                    ,:VEHICL-CRT-SRC-CDE                          65320002
653300                    ,:VEHICL-LAST-UPD-DTE                         65330002
653400                    ,:VEHICL-LAST-UPD-TME                         65340002
653500                    ,:VEHICL-LAST-UPD-UID                         65350002
653600                    ,:VEHICL-USAGE-CDE                            65360002
653700                    ,:VEHICL-VEH-TYP-CDE                          65370002
653800                    ,:VEHICL-CURR-STATUS-CDE                      65380002
653900                    ,:VEHICL-CURR-STATUS-DTE                      65390002
654000                    ,:VEHICL-CURR-STATUS-TME                      65400002
654100                    ,:VEHICL-CURR-OPER-UNT-ID                     65410002
654200                    ,:VEHICL-CURR-FCLTY-ID                        65420002
654300                    ,:VEHICL-CURR-FAC-AREA-ID                     65430002
654400                    ,:VEHICL-CURR-LOC-DTE                         65440002
654500                    ,:VEHICL-CURR-LOC-TME                         65450002
654600                    ,:VEHICL-CURR-TRIP-ID                         65460002
654700                       :DN-CURR-TRIP-ID                           65470002
654800                    ,:VEHICL-VEH-SIZE-CDE                         65480002
654900           FROM   TVEHICL                                         65490002
655000           WHERE  VEH_NBR       = :ASC-VEH-NBR                    65500002
655100             AND  OWNER_SCAC_ID = :ASC-SCAC-ID                    65510002
655200         END-EXEC                                                 65520002
655300                                                                  65530002
655400         EVALUATE TRUE                                            65540002
655500             WHEN SQLCODE = +0                                    65550002
655600             WHEN SQLCODE = -904                                  65560002
655700             WHEN SQLCODE = -913                                  65570002
655800                 CONTINUE                                         65580002
655900                                                                  65590002
656000             WHEN SQLWARN0 NOT = SPACES                           65600002
656100             WHEN SQLCODE < +0                                    65610002
656200             WHEN SQLCODE > +0                                    65620002
656300                 MOVE SPACES TO PV-MESSAGE                        65630002
656400                 MOVE DK-VEH-NBR TO PV-MESSAGE1                   65640002
656500                 MOVE DK-SCAC-ID TO PV-MESSAGE2                   65650002
656600                 MOVE '6055-INSERT-TAUVHCL'                       65660002
656700                                   TO DP013-PARAGRAPH             65670002
656800                 MOVE 'SELECT A TVEHICL ROW   '                   65680002
656900                                   TO DP013-MESSAGE-TEXT(1)       65690002
657000                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       65700002
657100                 MOVE SQLCA        TO DP013-SQLCA                 65710002
657200                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    65720002
657300                 SET DP013-DB2-ABEND                              65730002
657400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           65740002
657500                 PERFORM DP013-0000-PROCESS-ABEND                 65750002
657600         END-EVALUATE                                             65760002
657700     END-PERFORM.                                                 65770002
657800                                                                  65780002
657900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        65790002
658000             AND (SQLCODE NOT = +0)                               65800002
658100         MOVE '6055-INSERT-TAUVHCL'                               65810002
658200                                   TO DP013-PARAGRAPH             65820002
658300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              65830002
658400                                   TO DP013-MESSAGE-TEXT (1)      65840002
658500         MOVE 'TO SELECT A TVEHICL ROW'                           65850002
658600                                   TO DP013-MESSAGE-TEXT (2)      65860002
658700         MOVE SQLCA                TO DP013-SQLCA                 65870002
658800         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    65880002
658900         SET DP013-DB2-ABEND                                      65890002
659000             DP013-XCTL-DISPLAY-RESTART                           65900002
659100                                   TO TRUE                        65910002
659200         PERFORM DP013-0000-PROCESS-ABEND                         65920002
659300     END-IF.                                                      65930002
659400                                                                  65940002
659500                                                                  65950002
659600     PERFORM                                                      65960002
659700         WITH TEST AFTER                                          65970002
659800         VARYING PV-RETRY-COUNTER                                 65980002
659900         FROM 1 BY 1                                              65990002
660000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               66000002
660100             OR (SQLCODE = +0))                                   66010002
660200                                                                  66020002
660300         EXEC SQL                                                 66030002
660400             INSERT  INTO TAUVHCL                                 66040002
660500                    (OWNER_SCAC_ID                                66050002
660600                    ,VEH_NBR                                      66060002
660700                    ,CRT_SRC_CDE                                  66070002
660800                    ,LAST_UPD_DTE                                 66080002
660900                    ,LAST_UPD_TME                                 66090002
661000                    ,LAST_UPD_UID                                 66100002
661100                    ,USAGE_CDE                                    66110002
661200                    ,VEH_TYP_CDE                                  66120002
661300                    ,CURR_STATUS_CDE                              66130002
661400                    ,CURR_STATUS_DTE                              66140002
661500                    ,CURR_STATUS_TME                              66150002
661600                    ,CURR_OPER_UNT_ID                             66160002
661700                    ,CURR_FCLTY_ID                                66170002
661800                    ,CURR_FAC_AREA_ID                             66180002
661900                    ,CURR_LOC_DTE                                 66190002
662000                    ,CURR_LOC_TME                                 66200002
662100                    ,CURR_TRIP_ID                                 66210002
662200                    ,VEH_SIZE_CDE)                                66220002
662300            VALUES  (:VEHICL-OWNER-SCAC-ID                        66230002
662400                    ,:VEHICL-VEH-NBR                              66240002
662500                    ,:VEHICL-CRT-SRC-CDE                          66250002
662600                    ,:VEHICL-LAST-UPD-DTE                         66260002
662700                    ,:VEHICL-LAST-UPD-TME                         66270002
662800                    ,:VEHICL-LAST-UPD-UID                         66280002
662900                    ,:VEHICL-USAGE-CDE                            66290002
663000                    ,:VEHICL-VEH-TYP-CDE                          66300002
663100                    ,:VEHICL-CURR-STATUS-CDE                      66310002
663200                    ,:VEHICL-CURR-STATUS-DTE                      66320002
663300                    ,:VEHICL-CURR-STATUS-TME                      66330002
663400                    ,:VEHICL-CURR-OPER-UNT-ID                     66340002
663500                    ,:VEHICL-CURR-FCLTY-ID                        66350002
663600                    ,:VEHICL-CURR-FAC-AREA-ID                     66360002
663700                    ,:VEHICL-CURR-LOC-DTE                         66370002
663800                    ,:VEHICL-CURR-LOC-TME                         66380002
663900                    ,:VEHICL-CURR-TRIP-ID                         66390002
664000                       :DN-CURR-TRIP-ID                           66400002
664100                    ,:VEHICL-VEH-SIZE-CDE)                        66410002
664200         END-EXEC                                                 66420002
664300                                                                  66430002
664400         EVALUATE TRUE                                            66440002
664500             WHEN SQLCODE = +0                                    66450002
664600             WHEN SQLCODE = -904                                  66460002
664700             WHEN SQLCODE = -913                                  66470002
664800                 CONTINUE                                         66480002
664900                                                                  66490002
665000             WHEN SQLWARN0 NOT = SPACES                           66500002
665100             WHEN SQLCODE < +0                                    66510002
665200             WHEN SQLCODE > +0                                    66520002
665300                 MOVE SPACES TO PV-MESSAGE                        66530002
665400                 MOVE DK-VEH-NBR TO PV-MESSAGE1                   66540002
665500                 MOVE DK-SCAC-ID TO PV-MESSAGE2                   66550002
665600                 MOVE '6055-INSERT-TAUVHCL'                       66560002
665700                                   TO DP013-PARAGRAPH             66570002
665800                 MOVE 'INSERT A ROW ON TAUVHCL'                   66580002
665900                                   TO DP013-MESSAGE-TEXT(1)       66590002
666000                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       66600002
666100                 MOVE SQLCA        TO DP013-SQLCA                 66610002
666200                 MOVE 'TAUVHCL'    TO DP013-DB2-TABLE-NAME (1)    66620002
666300                 SET DP013-DB2-ABEND                              66630002
666400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           66640002
666500                 PERFORM DP013-0000-PROCESS-ABEND                 66650002
666600         END-EVALUATE                                             66660002
666700     END-PERFORM.                                                 66670002
666800                                                                  66680002
666900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        66690002
667000             AND (SQLCODE NOT = +0)                               66700002
667100         MOVE '6055-INSERT-TAUVHCL'                               66710002
667200                                   TO DP013-PARAGRAPH             66720002
667300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              66730002
667400                                   TO DP013-MESSAGE-TEXT (1)      66740002
667500         MOVE 'TO INSERT A TAUVHCL ROW'                           66750002
667600                                   TO DP013-MESSAGE-TEXT (2)      66760002
667700         MOVE SQLCA                TO DP013-SQLCA                 66770002
667800         MOVE 'TAUVHCL'            TO DP013-DB2-TABLE-NAME (1)    66780002
667900         SET DP013-DB2-ABEND                                      66790002
668000             DP013-XCTL-DISPLAY-RESTART                           66800002
668100                                   TO TRUE                        66810002
668200         PERFORM DP013-0000-PROCESS-ABEND                         66820002
668300     END-IF.                                                      66830002
668400                                                                  66840002
668500 EJECT                                                            66850002
668600*----------------------------------------------------------------*66860002
668700*  LINK THE NEW SHIPMENT TO THE VEHICLE BY UPDATING THE CURRENT   66870002
668800*  INFORMATION ON TVEHICL                                         66880002
668900*                                                                 66890002
669000*----------------------------------------------------------------*66900002
669100 6060-UPDATE-TVEHICL.                                             66910002
669200                                                                  66920002
669300     MOVE ASC-CRE-OPER-UNT-ID   TO VEHICL-CURR-OPER-UNT-ID.       66930002
669400     MOVE ASC-CRE-FCLTY-ID      TO VEHICL-CURR-FCLTY-ID.          66940002
669500                                                                  66950002
669600     PERFORM                                                      66960002
669700         WITH TEST AFTER                                          66970002
669800         VARYING PV-RETRY-COUNTER                                 66980002
669900         FROM 1 BY 1                                              66990002
670000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               67000002
670100             OR (SQLCODE = +0))                                   67010002
670200                                                                  67020002
670300         EXEC SQL                                                 67030002
670400             UPDATE  TVEHICL                                      67040002
670500              SET  LAST_UPD_DTE       =  CURRENT DATE             67050002
670600                  ,LAST_UPD_TME       =  CURRENT TIME             67060002
670700                  ,LAST_UPD_UID       = :DP020-USERID             67070002
670800                  ,CURR_STATUS_CDE    = 'EN'                      67080002
670900                  ,CURR_STATUS_DTE    =  CURRENT DATE             67090002
671000                  ,CURR_STATUS_TME    =  CURRENT TIME             67100002
671100                  ,CURR_OPER_UNT_ID   = :VEHICL-CURR-OPER-UNT-ID  67110002
671200                  ,CURR_FCLTY_ID      = :VEHICL-CURR-FCLTY-ID     67120002
671300                  ,CURR_TRIP_ID       = :ASC-TRIP-ID              67130002
671400              WHERE OWNER_SCAC_ID     = :ASC-SCAC-ID              67140002
671500                AND VEH_NBR           = :ASC-VEH-NBR              67150002
671600         END-EXEC                                                 67160002
671700                                                                  67170002
671800         EVALUATE TRUE                                            67180002
671900             WHEN SQLCODE = +0                                    67190002
672000             WHEN SQLCODE = -904                                  67200002
672100             WHEN SQLCODE = -913                                  67210002
672200                 CONTINUE                                         67220002
672300                                                                  67230002
672400             WHEN SQLWARN0 NOT = SPACES                           67240002
672500             WHEN SQLCODE < +0                                    67250002
672600             WHEN SQLCODE > +0                                    67260002
672700                 MOVE SPACES TO PV-MESSAGE                        67270002
672800                 MOVE DK-SCAC-ID TO PV-MESSAGE1                   67280002
672900                 MOVE ASC-VEH-NBR TO PV-MESSAGE2                  67290002
673000                 MOVE '6060-UPDATE-TVEHICL'                       67300002
673100                                   TO DP013-PARAGRAPH             67310002
673200                 MOVE 'UPDATE A ROW ON TVEHICL'                   67320002
673300                                   TO DP013-MESSAGE-TEXT(1)       67330002
673400                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       67340002
673500                 MOVE SQLCA        TO DP013-SQLCA                 67350002
673600                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    67360002
673700                 SET DP013-DB2-ABEND                              67370002
673800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           67380002
673900                 PERFORM DP013-0000-PROCESS-ABEND                 67390002
674000         END-EVALUATE                                             67400002
674100     END-PERFORM.                                                 67410002
674200                                                                  67420002
674300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        67430002
674400             AND (SQLCODE NOT = +0)                               67440002
674500         MOVE '6060-UPDATE-TVEHICL'                               67450002
674600                                   TO DP013-PARAGRAPH             67460002
674700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              67470002
674800                                   TO DP013-MESSAGE-TEXT (1)      67480002
674900         MOVE 'TO UPDATE A TVEHICL ROW'                           67490002
675000                                   TO DP013-MESSAGE-TEXT (2)      67500002
675100         MOVE SQLCA                TO DP013-SQLCA                 67510002
675200         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    67520002
675300         SET DP013-DB2-ABEND                                      67530002
675400             DP013-XCTL-DISPLAY-RESTART                           67540002
675500                                   TO TRUE                        67550002
675600         PERFORM DP013-0000-PROCESS-ABEND                         67560002
675700     END-IF.                                                      67570002
675800                                                                  67580002
675900     EVALUATE TRUE                                                67590002
676000        WHEN SQLCODE = +0                                         67600002
676100             PERFORM 6055-INSERT-TAUVHCL                          67610002
676200     END-EVALUATE.                                                67620002
676300                                                                  67630002
676400*----------------------------------------------------------------*67640002
676500*  INSERT THE PO TO THE SHIPEMENT PO ASSOCIATION TABLE            67650002
676600*----------------------------------------------------------------*67660002
676700 6070-INSERT-TSHPTPO.                                             67670002
676800                                                                  67680002
676900     INITIALIZE DCLTSHPTPO.                                       67690002
677000                                                                  67700002
677100     MOVE ASC-SHIPT-ID             TO SHPTPO-SHIPT-ID.            67710002
677200     MOVE ASC-PO-NBR               TO SHPTPO-PO-NBR               67720002
677300                                      DK-PO-NBR.                  67730002
677400     MOVE ASC-REC-SEQ-NBR          TO SHPTPO-REC-SEQ-NBR.         67740002
677500     MOVE ASC-EXPTED-CART-CNT      TO SHPTPO-EXPTED-CART-CNT.     67750002
677600     MOVE ZEROES                   TO SHPTPO-ACTL-CART-CNT        67760002
677700                                      SHPTPO-DMG-CART-CNT.        67770002
677800     MOVE 'N'                      TO SHPTPO-PKSL-IND.            67780002
677900     MOVE ASC-ENT-NAME-DESC        TO SHPTPO-VEND-NAME.           67790002
678000     MOVE ZEROES                   TO SHPTPO-FRGT-CHG-AMT.        67800002
678100     MOVE 'Y'                      TO SHPTPO-PRIM-SHIPT-IND.      67810002
678200                                                                  67820002
678300     PERFORM                                                      67830002
678400         WITH TEST AFTER                                          67840002
678500         VARYING PV-RETRY-COUNTER                                 67850002
678600         FROM 1 BY 1                                              67860002
678700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               67870002
678800             OR (SQLCODE = +0))                                   67880002
678900*                                                                 67890002
679000         EXEC SQL                                                 67900002
679100             INSERT  INTO TSHPTPO                                 67910002
679200                    (SHIPT_ID                                     67920002
679300                    ,PO_NBR                                       67930002
679400                    ,REC_SEQ_NBR                                  67940002
679500                    ,EXPTED_CART_CNT                              67950002
679600                    ,ACTL_CART_CNT                                67960002
679700                    ,DMG_CART_CNT                                 67970002
679800                    ,PKSL_IND                                     67980002
679900                    ,VEND_NAME                                    67990002
680000                    ,FRGT_CHG_AMT                                 68000002
680100                    ,LAST_UPD_PGM_ID                              68010002
680200                    ,CRE_USER_ID                                  68020002
680300                    ,CARR_LAST_UPD_DTE                            68030002
680400                    ,CARR_LAST_UPD_TIME                           68040002
680500                    ,VEND_LAST_UPD_DTE                            68050002
680600                    ,VEND_LAST_UPD_TIME                           68060002
680700                    ,LAST_UPD_USER_ID                             68070002
680800                    ,PRIM_SHIPT_IND                               68080002
680900                    ,SPLT_XMIT_IND                                68090002
681000                    ,SPLT_XMIT_DTE                                68100002
681100                    ,SPLT_XMIT_TM )                               68110002
681200             VALUES                                               68120002
681300                    (:SHPTPO-SHIPT-ID                             68130002
681400                    ,:SHPTPO-PO-NBR                               68140002
681500                    ,:SHPTPO-REC-SEQ-NBR                          68150002
681600                    ,:SHPTPO-EXPTED-CART-CNT                      68160002
681700                    ,:SHPTPO-ACTL-CART-CNT                        68170002
681800                    ,:SHPTPO-DMG-CART-CNT                         68180002
681900                    ,:SHPTPO-PKSL-IND                             68190002
682000                    ,:SHPTPO-VEND-NAME                            68200002
682100                    ,:SHPTPO-FRGT-CHG-AMT                         68210002
682200                    ,:PC-CURRENT-PROGRAM-NAME                     68220002
682300                    ,:DP020-USERID                                68230002
682400                    ,:PC-DEFAULT-DATE                             68240002
682500                    ,:PC-DEFAULT-TIME                             68250002
682600                    ,:PC-DEFAULT-DATE                             68260002
682700                    ,:PC-DEFAULT-TIME                             68270002
682800                    ,:DP020-USERID                                68280002
682900                    ,:SHPTPO-PRIM-SHIPT-IND                       68290002
683000                    ,:SHPTPO-SPLT-XMIT-IND                        68300002
683100                    ,:PC-DEFAULT-DATE                             68310002
683200                    ,:PC-DEFAULT-TIME )                           68320002
683300         END-EXEC                                                 68330002
683400*                                                                 68340002
683500         EVALUATE TRUE                                            68350002
683600             WHEN SQLCODE = +0                                    68360002
683700             WHEN SQLCODE = -904                                  68370002
683800             WHEN SQLCODE = -913                                  68380002
683900                 CONTINUE                                         68390002
684000                                                                  68400002
684100             WHEN SQLWARN0 NOT = SPACES                           68410002
684200             WHEN SQLCODE < +0                                    68420002
684300             WHEN SQLCODE > +0                                    68430002
684400                 MOVE SPACES TO PV-MESSAGE                        68440002
684500                 MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1              68450002
684600                 MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2              68460002
684700                 MOVE '6070-INSERT-TSHPTPO'                       68470002
684800                                   TO DP013-PARAGRAPH             68480002
684900                 MOVE 'INSERT A ROW ON TSHPTPO'                   68490002
685000                                   TO DP013-MESSAGE-TEXT(1)       68500002
685100                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       68510002
685200                 MOVE SQLCA        TO DP013-SQLCA                 68520002
685300                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    68530002
685400                 SET DP013-DB2-ABEND                              68540002
685500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           68550002
685600                 PERFORM DP013-0000-PROCESS-ABEND                 68560002
685700         END-EVALUATE                                             68570002
685800     END-PERFORM.                                                 68580002
685900                                                                  68590002
686000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        68600002
686100             AND (SQLCODE NOT = +0)                               68610002
686200         MOVE '6070-INSERT-TSHPTPO'                               68620002
686300                                   TO DP013-PARAGRAPH             68630002
686400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              68640002
686500                                   TO DP013-MESSAGE-TEXT (1)      68650002
686600         MOVE 'TO INSERT A TSHPTPO ROW'                           68660002
686700                                   TO DP013-MESSAGE-TEXT (2)      68670002
686800         MOVE SQLCA                TO DP013-SQLCA                 68680002
686900         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    68690002
687000         SET DP013-DB2-ABEND                                      68700002
687100             DP013-XCTL-DISPLAY-RESTART                           68710002
687200                                   TO TRUE                        68720002
687300         PERFORM DP013-0000-PROCESS-ABEND                         68730002
687400     END-IF.                                                      68740002
687500                                                                  68750002
687600     EVALUATE TRUE                                                68760002
687700         WHEN SQLCODE = ZERO                                      68770002
687800              MOVE PC-A TO PV-TRN-CDE                             68780002
687900              PERFORM 6075-INSERT-TAUSHPO                         68790002
688000     END-EVALUATE.                                                68800002
688100                                                                  68810002
688200 EJECT                                                            68820002
688300*----------------------------------------------------------------*68830002
688400*  INSERT THE PO TO THE SHIPEMENT PO ASSOCIATION AUDIT TABLE      68840002
688500*                                                                 68850002
688600*  PERFORMED FROM 5000-INSERT-TAUSHPO                             68860002
688700*----------------------------------------------------------------*68870002
688800                                                                  68880002
688900 6075-INSERT-TAUSHPO.                                             68890002
689000                                                                  68900002
689100     PERFORM                                                      68910002
689200         WITH TEST AFTER                                          68920002
689300         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     68930002
689400         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            68940002
689500                (SQLCODE = ZERO)   OR                             68950002
689600                (SQLCODE = +100)                                  68960002
689700*                                                                 68970002
689800         EXEC SQL                                                 68980002
689900             SELECT SHIPT_ID,                                     68990002
690000                    PO_NBR,                                       69000002
690100                    REC_SEQ_NBR,                                  69010002
690200                    EXPTED_CART_CNT,                              69020002
690300                    ACTL_CART_CNT,                                69030002
690400                    DMG_CART_CNT,                                 69040002
690500                    PKSL_IND,                                     69050002
690600                    VEND_NAME,                                    69060002
690700                    FRGT_CHG_AMT,                                 69070002
690800                    LAST_UPD_PGM_ID,                              69080002
690900                    CRE_USER_ID,                                  69090002
691000                    CARR_CART_CT,                                 69100002
691100                    CARR_LAST_UPD_DTE,                            69110002
691200                    CARR_LAST_UPD_TIME,                           69120002
691300                    VEND_CART_CT,                                 69130002
691400                    VEND_LAST_UPD_DTE,                            69140002
691500                    VEND_LAST_UPD_TIME,                           69150002
691600                    CRE_TMST,                                     69160002
691700                    LAST_UPD_DTE,                                 69170002
691800                    LAST_UPD_TIME,                                69180002
691900                    LAST_UPD_USER_ID,                             69190002
692000                    PRIM_SHIPT_IND                                69200002
692100                   ,SPLT_XMIT_IND                                 69210002
692200                   ,SPLT_XMIT_DTE                                 69220002
692300                   ,SPLT_XMIT_TM                                  69230002
692400               INTO :SHPTPO-SHIPT-ID,                             69240002
692500                    :SHPTPO-PO-NBR,                               69250002
692600                    :SHPTPO-REC-SEQ-NBR,                          69260002
692700                    :SHPTPO-EXPTED-CART-CNT,                      69270002
692800                    :SHPTPO-ACTL-CART-CNT,                        69280002
692900                    :SHPTPO-DMG-CART-CNT,                         69290002
693000                    :SHPTPO-PKSL-IND,                             69300002
693100                    :SHPTPO-VEND-NAME,                            69310002
693200                    :SHPTPO-FRGT-CHG-AMT,                         69320002
693300                    :SHPTPO-LAST-UPD-PGM-ID,                      69330002
693400                    :SHPTPO-CRE-USER-ID,                          69340002
693500                    :SHPTPO-CARR-CART-CT,                         69350002
693600                    :SHPTPO-CARR-LAST-UPD-DTE,                    69360002
693700                    :SHPTPO-CARR-LAST-UPD-TIME,                   69370002
693800                    :SHPTPO-VEND-CART-CT,                         69380002
693900                    :SHPTPO-VEND-LAST-UPD-DTE,                    69390002
694000                    :SHPTPO-VEND-LAST-UPD-TIME,                   69400002
694100                    :SHPTPO-CRE-TMST,                             69410002
694200                    :SHPTPO-LAST-UPD-DTE,                         69420002
694300                    :SHPTPO-LAST-UPD-TIME,                        69430002
694400                    :SHPTPO-LAST-UPD-USER-ID,                     69440002
694500                    :SHPTPO-PRIM-SHIPT-IND                        69450002
694600                   ,:SHPTPO-SPLT-XMIT-IND                         69460002
694700                   ,:SHPTPO-SPLT-XMIT-DTE                         69470002
694800                   ,:SHPTPO-SPLT-XMIT-TM                          69480002
694900               FROM TSHPTPO                                       69490002
695000              WHERE SHIPT_ID = :ASC-SHIPT-ID                      69500002
695100                AND PO_NBR   = :DK-PO-NBR                         69510002
695200         END-EXEC                                                 69520002
695300*                                                                 69530002
695400         EVALUATE TRUE                                            69540002
695500             WHEN SQLCODE = ZERO                                  69550002
695600             WHEN SQLCODE = +100                                  69560002
695700             WHEN SQLCODE = -904                                  69570002
695800             WHEN SQLCODE = -913                                  69580002
695900                 CONTINUE                                         69590002
696000                                                                  69600002
696100             WHEN SQLWARN0 NOT = SPACE                            69610002
696200             WHEN SQLCODE  NOT = +0                               69620002
696300                  MOVE SPACES TO PV-MESSAGE                       69630002
696400                  MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1             69640002
696500                  MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2             69650002
696600                  MOVE '6075-INSERT-TAUSHPO'                      69660002
696700                                   TO DP013-PARAGRAPH             69670002
696800                  MOVE 'SELECT TSHPTPO DATA'                      69680002
696900                                   TO DP013-MESSAGE-TEXT (1)      69690002
697000                  MOVE PV-MESSAGE  TO DP013-MESSAGE-TEXT (2)      69700002
697100                  MOVE SQLCA       TO DP013-SQLCA                 69710002
697200                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    69720002
697300                  SET DP013-DB2-ABEND                             69730002
697400                                   TO TRUE                        69740002
697500                  PERFORM DP013-0000-PROCESS-ABEND                69750002
697600         END-EVALUATE                                             69760002
697700                                                                  69770002
697800     END-PERFORM.                                                 69780002
697900                                                                  69790002
698000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        69800002
698100             AND (SQLCODE NOT = +0)                               69810002
698200         MOVE '6075-INSERT-TAUSHPO'                               69820002
698300                                   TO DP013-PARAGRAPH             69830002
698400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TAUSHPO'           69840002
698500                                   TO DP013-MESSAGE-TEXT (1)      69850002
698600         MOVE SQLCA                TO DP013-SQLCA                 69860002
698700         SET DP013-DB2-ABEND       TO TRUE                        69870002
698800         PERFORM DP013-0000-PROCESS-ABEND                         69880002
698900     END-IF.                                                      69890002
699000                                                                  69900002
699100     MOVE PV-TRN-CDE               TO AUSHPO-TRN-CDE              69910002
699200     PERFORM                                                      69920002
699300         WITH TEST AFTER                                          69930002
699400         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     69940002
699500         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            69950002
699600                 SQLCODE = ZERO                                   69960002
699700*                                                                 69970002
699800         EXEC SQL                                                 69980002
699900             INSERT INTO TAUSHPO                                  69990002
700000                   (SHIPT_ID,                                     70000002
700100                    PO_NBR,                                       70010002
700200                    REC_SEQ_NBR,                                  70020002
700300                    EXPTED_CART_CNT,                              70030002
700400                    ACTL_CART_CNT,                                70040002
700500                    DMG_CART_CNT,                                 70050002
700600                    PKSL_IND,                                     70060002
700700                    VEND_NAME,                                    70070002
700800                    FRGT_CHG_AMT,                                 70080002
700900                    LAST_UPD_PGM_ID,                              70090002
701000                    CRE_USER_ID,                                  70100002
701100                    CARR_CART_CT,                                 70110002
701200                    CARR_LAST_UPD_DTE,                            70120002
701300                    CARR_LAST_UPD_TIME,                           70130002
701400                    VEND_CART_CT,                                 70140002
701500                    VEND_LAST_UPD_DTE,                            70150002
701600                    VEND_LAST_UPD_TIME,                           70160002
701700                    CRE_TMST,                                     70170002
701800                    LAST_UPD_DTE,                                 70180002
701900                    LAST_UPD_TIME,                                70190002
702000                    LAST_UPD_USER_ID,                             70200002
702100                    PRIM_SHIPT_IND                                70210002
702200                   ,SPLT_XMIT_IND                                 70220002
702300                   ,SPLT_XMIT_DTE                                 70230002
702400                   ,SPLT_XMIT_TM                                  70240002
702500                   ,TRN_CDE )                                     70250002
702600             VALUES                                               70260002
702700                  (:SHPTPO-SHIPT-ID,                              70270002
702800                   :SHPTPO-PO-NBR,                                70280002
702900                   :SHPTPO-REC-SEQ-NBR,                           70290002
703000                   :SHPTPO-EXPTED-CART-CNT,                       70300002
703100                   :SHPTPO-ACTL-CART-CNT,                         70310002
703200                   :SHPTPO-DMG-CART-CNT,                          70320002
703300                   :SHPTPO-PKSL-IND,                              70330002
703400                   :SHPTPO-VEND-NAME,                             70340002
703500                   :SHPTPO-FRGT-CHG-AMT,                          70350002
703600                   :SHPTPO-LAST-UPD-PGM-ID,                       70360002
703700                   :SHPTPO-CRE-USER-ID,                           70370002
703800                   :SHPTPO-CARR-CART-CT,                          70380002
703900                   :SHPTPO-CARR-LAST-UPD-DTE,                     70390002
704000                   :SHPTPO-CARR-LAST-UPD-TIME,                    70400002
704100                   :SHPTPO-VEND-CART-CT,                          70410002
704200                   :SHPTPO-VEND-LAST-UPD-DTE,                     70420002
704300                   :SHPTPO-VEND-LAST-UPD-TIME,                    70430002
704400                   :SHPTPO-CRE-TMST,                              70440002
704500                   :SHPTPO-LAST-UPD-DTE,                          70450002
704600                   :SHPTPO-LAST-UPD-TIME,                         70460002
704700                   :SHPTPO-LAST-UPD-USER-ID,                      70470002
704800                   :SHPTPO-PRIM-SHIPT-IND                         70480002
704900                  ,:SHPTPO-SPLT-XMIT-IND                          70490002
705000                  ,:SHPTPO-SPLT-XMIT-DTE                          70500002
705100                  ,:SHPTPO-SPLT-XMIT-TM                           70510002
705200                  ,:AUSHPO-TRN-CDE )                              70520002
705300         END-EXEC                                                 70530002
705400*                                                                 70540002
705500         EVALUATE TRUE                                            70550002
705600             WHEN SQLCODE = +0                                    70560002
705700             WHEN SQLCODE = -904                                  70570002
705800             WHEN SQLCODE = -913                                  70580002
705900                 CONTINUE                                         70590002
706000                                                                  70600002
706100             WHEN SQLWARN0 NOT = SPACES                           70610002
706200             WHEN SQLCODE < +0                                    70620002
706300             WHEN SQLCODE > +0                                    70630002
706400                 MOVE SPACES TO PV-MESSAGE                        70640002
706500                 MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1              70650002
706600                 MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2              70660002
706700                 MOVE '5005-INSERT-TAUSHPO'                       70670002
706800                                   TO DP013-PARAGRAPH             70680002
706900                 MOVE 'INSERT A ROW ON TAUSHPO'                   70690002
707000                                   TO DP013-MESSAGE-TEXT(1)       70700002
707100                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       70710002
707200                 MOVE SQLCA        TO DP013-SQLCA                 70720002
707300                 MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)    70730002
707400                 SET DP013-DB2-ABEND                              70740002
707500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           70750002
707600                 PERFORM DP013-0000-PROCESS-ABEND                 70760002
707700         END-EVALUATE                                             70770002
707800     END-PERFORM.                                                 70780002
707900                                                                  70790002
708000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        70800002
708100             AND (SQLCODE NOT = +0)                               70810002
708200         MOVE '6075-INSERT-TAUSHPO'                               70820002
708300                                   TO DP013-PARAGRAPH             70830002
708400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              70840002
708500                                   TO DP013-MESSAGE-TEXT (1)      70850002
708600         MOVE 'TO INSERT A TAUSHPO ROW'                           70860002
708700                                   TO DP013-MESSAGE-TEXT (2)      70870002
708800         MOVE SQLCA                TO DP013-SQLCA                 70880002
708900         MOVE 'TAUSHPO'            TO DP013-DB2-TABLE-NAME (1)    70890002
709000         SET DP013-DB2-ABEND                                      70900002
709100             DP013-XCTL-DISPLAY-RESTART                           70910002
709200                                   TO TRUE                        70920002
709300         PERFORM DP013-0000-PROCESS-ABEND                         70930002
709400     END-IF.                                                      70940002
709500                                                                  70950002
709600*----------------------------------------------------------------*70960002
709700*  UPDATE THE RECEIVER SEQUENCE NUMBER ON THE SHIP/PO TABLE       70970002
709800*----------------------------------------------------------------*70980002
709900 6080-UPDATE-TSHPTPO.                                             70990002
710000                                                                  71000002
710100                                                                  71010002
710200     PERFORM                                                      71020002
710300         WITH TEST AFTER                                          71030002
710400         VARYING PV-RETRY-COUNTER                                 71040002
710500         FROM 1 BY 1                                              71050002
710600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               71060002
710700             OR (SQLCODE = +0))                                   71070002
710800                                                                  71080002
710900         EXEC SQL                                                 71090002
711000             UPDATE  TSHPTPO                                      71100002
711100               SET   LAST_UPD_PGM_ID   = :PC-CURRENT-PROGRAM-NAME 71110002
711200                    ,LAST_UPD_DTE      = CURRENT DATE             71120002
711300                    ,LAST_UPD_TIME     = CURRENT TIME             71130002
711400                    ,LAST_UPD_USER_ID  = :DP020-USERID            71140002
711500                    ,REC_SEQ_NBR       = :SHPTPO-REC-SEQ-NBR      71150002
711600                    ,EXPTED_CART_CNT   = :SHPTPO-EXPTED-CART-CNT  71160002
711700             WHERE  SHIPT_ID    = :ASC-SHIPT-ID                   71170002
711800             AND    PO_NBR      = :DK-PO-NBR                      71180002
711900         END-EXEC                                                 71190002
712000                                                                  71200002
712100         EVALUATE TRUE                                            71210002
712200             WHEN SQLCODE = +0                                    71220002
712300             WHEN SQLCODE = -904                                  71230002
712400             WHEN SQLCODE = -913                                  71240002
712500                 CONTINUE                                         71250002
712600                                                                  71260002
712700             WHEN SQLWARN0 NOT = SPACES                           71270002
712800             WHEN SQLCODE < +0                                    71280002
712900             WHEN SQLCODE > +0                                    71290002
713000                 MOVE SPACES TO PV-MESSAGE                        71300002
713100                 MOVE ASC-SHIPT-ID TO PV-MESSAGE1                 71310002
713200                 MOVE DK-PO-NBR   TO PV-MESSAGE2                  71320002
713300                 MOVE '6080-UPDATE-TSHPTPO'                       71330002
713400                                   TO DP013-PARAGRAPH             71340002
713500                 MOVE 'UPDATE A ROW ON TSHPTPO'                   71350002
713600                                   TO DP013-MESSAGE-TEXT(1)       71360002
713700                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       71370002
713800                 MOVE SQLCA        TO DP013-SQLCA                 71380002
713900                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    71390002
714000                 SET DP013-DB2-ABEND                              71400002
714100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           71410002
714200                 PERFORM DP013-0000-PROCESS-ABEND                 71420002
714300         END-EVALUATE                                             71430002
714400     END-PERFORM.                                                 71440002
714500                                                                  71450002
714600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        71460002
714700             AND (SQLCODE NOT = +0)                               71470002
714800         MOVE '6080-UPDATE-TSHPTPO'                               71480002
714900                                   TO DP013-PARAGRAPH             71490002
715000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              71500002
715100                                   TO DP013-MESSAGE-TEXT (1)      71510002
715200         MOVE 'TO UPDATE A TSHPTPO ROW'                           71520002
715300                                   TO DP013-MESSAGE-TEXT (2)      71530002
715400         MOVE SQLCA                TO DP013-SQLCA                 71540002
715500         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    71550002
715600         SET DP013-DB2-ABEND                                      71560002
715700             DP013-XCTL-DISPLAY-RESTART                           71570002
715800                                   TO TRUE                        71580002
715900         PERFORM DP013-0000-PROCESS-ABEND                         71590002
716000     END-IF.                                                      71600002
716100                                                                  71610002
716200     EVALUATE TRUE                                                71620002
716300         WHEN SQLCODE = ZERO                                      71630002
716400              MOVE PC-U            TO PV-TRN-CDE                  71640002
716500              PERFORM 6075-INSERT-TAUSHPO                         71650002
716600     END-EVALUATE.                                                71660002
716700                                                                  71670002
716800 EJECT                                                            71680002
716900*----------------------------------------------------------------*71690002
717000*  INSERT A ROW TO THE TRIP TABLE                                 71700002
717100*----------------------------------------------------------------*71710002
717200 6090-INSERT-TVHTRIP.                                             71720002
717300                                                                  71730002
717400     INITIALIZE DCLTVHTRIP.                                       71740002
717500                                                                  71750002
717600     MOVE DK-SCAC-ID               TO VHTRIP-OWNER-SCAC-ID.       71760002
717700                                                                  71770002
717800     IF ASC-VEH-NBR = SPACES                                      71780002
717900        MOVE -1            TO DN-VEH-NBR                          71790002
718000     ELSE                                                         71800002
718100        MOVE +1            TO DN-VEH-NBR                          71810002
718200        MOVE ASC-VEH-NBR   TO VHTRIP-VEH-NBR                      71820002
718300     END-IF.                                                      71830002
718400                                                                  71840002
718500     MOVE ASC-TRIP-ID              TO VHTRIP-TRIP-ID              71850002
718600                                      VHTRIP-REF-TRIP-ID          71860002
718700                                      DK-TRIP-ID.                 71870002
718800     MOVE 'PA'                     TO VHTRIP-CRT-SRC-CDE.         71880002
718900     MOVE SPACES                   TO VHTRIP-MANIFEST-NBR         71890002
719000                                      VHTRIP-PLND-ACTVY-CDE.      71900002
719100     MOVE ZEROES                   TO VHTRIP-PLND-TRIP-SEQ.       71910002
719200     MOVE ASC-CARR-SHIP-MM         TO PV-DB2-DATE-MM.             71920002
719300     MOVE ASC-CARR-SHIP-DD         TO PV-DB2-DATE-DD.             71930002
719400     MOVE ASC-CARR-SHIP-CCYY       TO PV-DB2-DATE-CCYY.           71940002
719500     MOVE '-'                      TO PV-DB2-DASH-1               71950002
719600                                      PV-DB2-DASH-2.              71960002
719700     MOVE PV-DB2-DATE              TO VHTRIP-OWNR-SCAC-SHIP-DTE.  71970002
719800                                                                  71980002
719900     PERFORM                                                      71990002
720000         WITH TEST AFTER                                          72000002
720100         VARYING PV-RETRY-COUNTER                                 72010002
720200         FROM 1 BY 1                                              72020002
720300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               72030002
720400             OR (SQLCODE = +0))                                   72040002
720500                                                                  72050002
720600         EXEC SQL                                                 72060002
720700             INSERT  INTO TVHTRIP                                 72070002
720800                   ( OWNER_SCAC_ID                                72080002
720900                    ,VEH_NBR                                      72090002
721000                    ,TRIP_ID                                      72100002
721100                    ,CRT_SRC_CDE                                  72110002
721200                    ,LAST_UPD_UID                                 72120002
721300                    ,MANIFEST_NBR                                 72130002
721400                    ,PLND_TRIP_SEQ                                72140002
721500                    ,PLND_ACTVY_CDE                               72150002
721600                    ,OWNR_SCAC_SHIP_DTE                           72160002
721700                    ,REF_TRIP_ID                                  72170002
721800                    ,EST_AR_TMST                                  72180002
721900                    ,SPLT_XMIT_IND                                72190002
722000                    ,SPLT_XMIT_DTE                                72200002
722100                    ,SPLT_XMIT_TM )                               72210002
722200             VALUES                                               72220002
722300                   ( :VHTRIP-OWNER-SCAC-ID                        72230002
722400                    ,:VHTRIP-VEH-NBR :DN-VEH-NBR                  72240002
722500                    ,:VHTRIP-TRIP-ID                              72250002
722600                    ,:VHTRIP-CRT-SRC-CDE                          72260002
722700                    ,:DP020-USERID                                72270002
722800                    ,:VHTRIP-MANIFEST-NBR                         72280002
722900                    ,:VHTRIP-PLND-TRIP-SEQ                        72290002
723000                    ,:VHTRIP-PLND-ACTVY-CDE                       72300002
723100                    ,:PC-DEFAULT-DATE                             72310002
723200                    ,:VHTRIP-REF-TRIP-ID                          72320002
723300                    ,CURRENT TIMESTAMP                            72330002
723400                    ,:VHTRIP-SPLT-XMIT-IND                        72340002
723500                    ,:PC-DEFAULT-DATE                             72350002
723600                    ,:PC-DEFAULT-TIME )                           72360002
723700         END-EXEC                                                 72370002
723800                                                                  72380002
723900         EVALUATE TRUE                                            72390002
724000             WHEN SQLCODE = +0                                    72400002
724100             WHEN SQLCODE = -904                                  72410002
724200             WHEN SQLCODE = -913                                  72420002
724300                 CONTINUE                                         72430002
724400                                                                  72440002
724500             WHEN SQLWARN0 NOT = SPACES                           72450002
724600             WHEN SQLCODE < +0                                    72460002
724700             WHEN SQLCODE > +0                                    72470002
724800                 MOVE SPACES TO PV-MESSAGE                        72480002
724900                 MOVE VHTRIP-OWNER-SCAC-ID TO PV-MESSAGE1         72490002
725000                 MOVE VHTRIP-VEH-NBR       TO PV-MESSAGE2         72500002
725100                 MOVE VHTRIP-TRIP-ID       TO PV-MESSAGE3         72510002
725200                 MOVE '6090-INSERT-TVHTRIP'                       72520002
725300                                   TO DP013-PARAGRAPH             72530002
725400                 MOVE 'INSERT A ROW ON TVHTRIP'                   72540002
725500                                   TO DP013-MESSAGE-TEXT(1)       72550002
725600                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       72560002
725700                 MOVE SQLCA        TO DP013-SQLCA                 72570002
725800                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    72580002
725900                 SET DP013-DB2-ABEND                              72590002
726000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           72600002
726100                 PERFORM DP013-0000-PROCESS-ABEND                 72610002
726200         END-EVALUATE                                             72620002
726300     END-PERFORM.                                                 72630002
726400                                                                  72640002
726500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        72650002
726600             AND (SQLCODE NOT = +0)                               72660002
726700         MOVE '6090-INSERT-TVHTRIP'                               72670002
726800                                   TO DP013-PARAGRAPH             72680002
726900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              72690002
727000                                   TO DP013-MESSAGE-TEXT (1)      72700002
727100         MOVE 'TO INSERT A TVHTRIP ROW'                           72710002
727200                                   TO DP013-MESSAGE-TEXT (2)      72720002
727300         MOVE SQLCA                TO DP013-SQLCA                 72730002
727400         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    72740002
727500         SET DP013-DB2-ABEND                                      72750002
727600             DP013-XCTL-DISPLAY-RESTART                           72760002
727700                                   TO TRUE                        72770002
727800         PERFORM DP013-0000-PROCESS-ABEND                         72780002
727900     END-IF.                                                      72790002
728000                                                                  72800002
728100     EVALUATE TRUE                                                72810002
728200         WHEN SQLCODE = ZERO                                      72820002
728300              PERFORM 6040-INSERT-TTRIPST                         72830002
728400              PERFORM 6095-INSERT-TAUTRIP                         72840002
728500     END-EVALUATE.                                                72850002
728600                                                                  72860002
728700*----------------------------------------------------------------*72870002
728800*  INSERT A ROW TO THE TRIP AUDIT TABLE                           72880002
728900*                                                                 72890002
729000*----------------------------------------------------------------*72900002
729100 6095-INSERT-TAUTRIP.                                             72910002
729200                                                                  72920002
729300                                                                  72930002
729400     INITIALIZE DCLTAUTRIP.                                       72940002
729500                                                                  72950002
729600     PERFORM                                                      72960002
729700         WITH TEST AFTER                                          72970002
729800         VARYING PV-RETRY-COUNTER                                 72980002
729900         FROM 1 BY 1                                              72990002
730000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               73000002
730100             OR (SQLCODE = +0))                                   73010002
730200                                                                  73020002
730300         EXEC SQL                                                 73030002
730400             SELECT  OWNER_SCAC_ID                                73040002
730500                    ,VEH_NBR                                      73050002
730600                    ,TRIP_ID                                      73060002
730700                    ,TRIP_BEG_DTE                                 73070002
730800                    ,TRIP_BEG_TME                                 73080002
730900                    ,CRT_SRC_CDE                                  73090002
731000                    ,LAST_UPD_DTE                                 73100002
731100                    ,LAST_UPD_TME                                 73110002
731200                    ,LAST_UPD_UID                                 73120002
731300                    ,MANIFEST_NBR                                 73130002
731400                    ,PLND_TRIP_SEQ                                73140002
731500                    ,PLND_ACTVY_CDE                               73150002
731600                    ,OWNR_SCAC_SHIP_DTE                           73160002
731700                    ,REF_TRIP_ID                                  73170002
731800                    ,EST_AR_TMST                                  73180002
731900                    ,SPLT_XMIT_IND                                73190002
732000                    ,SPLT_XMIT_DTE                                73200002
732100                    ,SPLT_XMIT_TM                                 73210002
732200            INTO     :VHTRIP-OWNER-SCAC-ID                        73220002
732300                    ,:VHTRIP-VEH-NBR                              73230002
732400                       :DN-VEH-NBR                                73240002
732500                    ,:VHTRIP-TRIP-ID                              73250002
732600                    ,:VHTRIP-TRIP-BEG-DTE                         73260002
732700                    ,:VHTRIP-TRIP-BEG-TME                         73270002
732800                    ,:VHTRIP-CRT-SRC-CDE                          73280002
732900                    ,:VHTRIP-LAST-UPD-DTE                         73290002
733000                    ,:VHTRIP-LAST-UPD-TME                         73300002
733100                    ,:VHTRIP-LAST-UPD-UID                         73310002
733200                    ,:VHTRIP-MANIFEST-NBR                         73320002
733300                    ,:VHTRIP-PLND-TRIP-SEQ                        73330002
733400                    ,:VHTRIP-PLND-ACTVY-CDE                       73340002
733500                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   73350002
733600                    ,:VHTRIP-REF-TRIP-ID                          73360002
733700                    ,:VHTRIP-EST-AR-TMST                          73370002
733800                           :DN-EST-AR-TMST                        73380002
733900                    ,:VHTRIP-SPLT-XMIT-IND                        73390002
734000                    ,:VHTRIP-SPLT-XMIT-DTE                        73400002
734100                    ,:VHTRIP-SPLT-XMIT-TM                         73410002
734200           FROM   TVHTRIP                                         73420002
734300           WHERE  OWNER_SCAC_ID = :DK-SCAC-ID                     73430002
734400             AND  TRIP_ID       = :DK-TRIP-ID                     73440002
734500         END-EXEC                                                 73450002
734600                                                                  73460002
734700         EVALUATE TRUE                                            73470002
734800             WHEN SQLCODE = +0                                    73480002
734900             WHEN SQLCODE = -904                                  73490002
735000             WHEN SQLCODE = -913                                  73500002
735100                 CONTINUE                                         73510002
735200                                                                  73520002
735300             WHEN SQLWARN0 NOT = SPACES                           73530002
735400             WHEN SQLCODE < +0                                    73540002
735500             WHEN SQLCODE > +0                                    73550002
735600                 MOVE SPACES TO PV-MESSAGE                        73560002
735700                 MOVE DK-SCAC-ID    TO PV-MESSAGE1                73570002
735800                 MOVE DK-TRIP-ID    TO PV-MESSAGE2                73580002
735900                 MOVE '6095-INSERT-TAUTRIP'                       73590002
736000                                   TO DP013-PARAGRAPH             73600002
736100                 MOVE 'SELECT A ROW ON TVHTRIP'                   73610002
736200                                   TO DP013-MESSAGE-TEXT(1)       73620002
736300                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       73630002
736400                 MOVE SQLCA        TO DP013-SQLCA                 73640002
736500                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    73650002
736600                 SET DP013-DB2-ABEND                              73660002
736700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           73670002
736800                 PERFORM DP013-0000-PROCESS-ABEND                 73680002
736900         END-EVALUATE                                             73690002
737000     END-PERFORM.                                                 73700002
737100                                                                  73710002
737200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        73720002
737300             AND (SQLCODE NOT = +0)                               73730002
737400         MOVE '6095-INSERT-TAUTRIP'                               73740002
737500                                   TO DP013-PARAGRAPH             73750002
737600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              73760002
737700                                   TO DP013-MESSAGE-TEXT (1)      73770002
737800         MOVE 'TO SELECT A TVHTRIP ROW'                           73780002
737900                                   TO DP013-MESSAGE-TEXT (2)      73790002
738000         MOVE SQLCA                TO DP013-SQLCA                 73800002
738100         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    73810002
738200         SET DP013-DB2-ABEND                                      73820002
738300             DP013-XCTL-DISPLAY-RESTART                           73830002
738400                                   TO TRUE                        73840002
738500         PERFORM DP013-0000-PROCESS-ABEND                         73850002
738600     END-IF.                                                      73860002
738700                                                                  73870002
738800     MOVE 'PA'                     TO VHTRIP-CRT-SRC-CDE.         73880002
738900                                                                  73890002
739000     IF PS-DELETE-VHTRIP                                          73900002
739100         EXEC SQL                                                 73910002
739200             SET :PV-DB2-CURRENT-DATE = CURRENT DATE              73920002
739300         END-EXEC                                                 73930002
739400                                                                  73940002
739500         EXEC SQL                                                 73950002
739600             SET :PV-DB2-CURRENT-TIME = CURRENT TIME              73960002
739700         END-EXEC                                                 73970002
739800                                                                  73980002
739900         MOVE PV-DB2-CURRENT-DATE  TO VHTRIP-LAST-UPD-DTE         73990002
740000         MOVE PV-DB2-CURRENT-TIME  TO VHTRIP-LAST-UPD-TME         74000002
740100         MOVE DP020-USERID         TO VHTRIP-LAST-UPD-UID         74010002
740200     END-IF.                                                      74020002
740300                                                                  74030002
740400     PERFORM                                                      74040002
740500         WITH TEST AFTER                                          74050002
740600         VARYING PV-RETRY-COUNTER                                 74060002
740700         FROM 1 BY 1                                              74070002
740800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               74080002
740900             OR (SQLCODE = +0))                                   74090002
741000                                                                  74100002
741100         EXEC SQL                                                 74110002
741200             INSERT  INTO TAUTRIP                                 74120002
741300                    (OWNER_SCAC_ID                                74130002
741400                    ,VEH_NBR                                      74140002
741500                    ,TRIP_ID                                      74150002
741600                    ,TRIP_BEG_DTE                                 74160002
741700                    ,TRIP_BEG_TME                                 74170002
741800                    ,CRT_SRC_CDE                                  74180002
741900                    ,LAST_UPD_DTE                                 74190002
742000                    ,LAST_UPD_TME                                 74200002
742100                    ,LAST_UPD_UID                                 74210002
742200                    ,MANIFEST_NBR                                 74220002
742300                    ,PLND_TRIP_SEQ                                74230002
742400                    ,PLND_ACTVY_CDE                               74240002
742500                    ,OWNR_SCAC_SHIP_DTE                           74250002
742600                    ,REF_TRIP_ID                                  74260002
742700                    ,EST_AR_TMST                                  74270002
742800                    ,AUD_STATUS_CDE                               74280002
742900                    ,SPLT_XMIT_IND                                74290002
743000                    ,SPLT_XMIT_DTE                                74300002
743100                    ,SPLT_XMIT_TM )                               74310002
743200            VALUES  (:VHTRIP-OWNER-SCAC-ID                        74320002
743300                    ,:VHTRIP-VEH-NBR                              74330002
743400                       :DN-VEH-NBR                                74340002
743500                    ,:VHTRIP-TRIP-ID                              74350002
743600                    ,:VHTRIP-TRIP-BEG-DTE                         74360002
743700                    ,:VHTRIP-TRIP-BEG-TME                         74370002
743800                    ,:VHTRIP-CRT-SRC-CDE                          74380002
743900                    ,:VHTRIP-LAST-UPD-DTE                         74390002
744000                    ,:VHTRIP-LAST-UPD-TME                         74400002
744100                    ,:VHTRIP-LAST-UPD-UID                         74410002
744200                    ,:VHTRIP-MANIFEST-NBR                         74420002
744300                    ,:VHTRIP-PLND-TRIP-SEQ                        74430002
744400                    ,:VHTRIP-PLND-ACTVY-CDE                       74440002
744500                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   74450002
744600                    ,:VHTRIP-REF-TRIP-ID                          74460002
744700                    ,:VHTRIP-EST-AR-TMST                          74470002
744800                           :DN-EST-AR-TMST                        74480002
744900                    ,:TRIPST-TRIP-STATUS-CDE                      74490002
745000                    ,:VHTRIP-SPLT-XMIT-IND                        74500002
745100                    ,:VHTRIP-SPLT-XMIT-DTE                        74510002
745200                    ,:VHTRIP-SPLT-XMIT-TM )                       74520002
745300         END-EXEC                                                 74530002
745400         EVALUATE TRUE                                            74540002
745500             WHEN SQLCODE = +0                                    74550002
745600             WHEN SQLCODE = -904                                  74560002
745700             WHEN SQLCODE = -913                                  74570002
745800                 CONTINUE                                         74580002
745900                                                                  74590002
746000             WHEN SQLWARN0 NOT = SPACES                           74600002
746100             WHEN SQLCODE < +0                                    74610002
746200             WHEN SQLCODE > +0                                    74620002
746300                 MOVE SPACES TO PV-MESSAGE                        74630002
746400                 MOVE DK-SCAC-ID    TO PV-MESSAGE1                74640002
746500                 MOVE DK-TRIP-ID    TO PV-MESSAGE2                74650002
746600                 MOVE '6095-INSERT-TAUTRIP'                       74660002
746700                                   TO DP013-PARAGRAPH             74670002
746800                 MOVE 'INSERT A ROW ON TAUTRIP'                   74680002
746900                                   TO DP013-MESSAGE-TEXT(1)       74690002
747000                 MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)       74700002
747100                 MOVE SQLCA        TO DP013-SQLCA                 74710002
747200                 MOVE 'TAUTRIP'    TO DP013-DB2-TABLE-NAME (1)    74720002
747300                 SET DP013-DB2-ABEND                              74730002
747400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           74740002
747500                 PERFORM DP013-0000-PROCESS-ABEND                 74750002
747600         END-EVALUATE                                             74760002
747700     END-PERFORM.                                                 74770002
747800                                                                  74780002
747900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        74790002
748000             AND (SQLCODE NOT = +0)                               74800002
748100         MOVE '6095-INSERT-TAUTRIP'                               74810002
748200                                   TO DP013-PARAGRAPH             74820002
748300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              74830002
748400                                   TO DP013-MESSAGE-TEXT (1)      74840002
748500         MOVE 'TO INSERT A TAUTRIP ROW'                           74850002
748600                                   TO DP013-MESSAGE-TEXT (2)      74860002
748700         MOVE SQLCA                TO DP013-SQLCA                 74870002
748800         MOVE 'TAUTRIP'            TO DP013-DB2-TABLE-NAME (1)    74880002
748900         SET DP013-DB2-ABEND                                      74890002
749000             DP013-XCTL-DISPLAY-RESTART                           74900002
749100                                   TO TRUE                        74910002
749200         PERFORM DP013-0000-PROCESS-ABEND                         74920002
749300     END-IF.                                                      74930002
749400                                                                  74940002
749500 7000-UPDATE-TSHIPMT-VNDSHP.                                      74950002
749600                                                                  74960002
749700     MOVE ASC-VEND-SHIP-DTE    TO PV-INPUT-DATE.                  74970002
749800     MOVE PV-INPUT-DATE-MM     TO PV-DB2-DATE-MM.                 74980002
749900     MOVE PV-INPUT-DATE-DD     TO PV-DB2-DATE-DD.                 74990002
750000     MOVE PV-INPUT-DATE-CC     TO PV-DB2-DATE-CC.                 75000002
750100     MOVE PV-INPUT-DATE-YY     TO PV-DB2-DATE-YY.                 75010002
750200     MOVE '-'                  TO PV-DB2-DASH-1                   75020002
750300                                  PV-DB2-DASH-2.                  75030002
750400     MOVE PV-DB2-DATE          TO SHIPMT-VEND-SHIP-DTE.           75040002
750500                                                                  75050002
750600     PERFORM                                                      75060002
750700         WITH TEST AFTER                                          75070002
750800         VARYING PV-RETRY-COUNTER                                 75080002
750900         FROM 1 BY 1                                              75090002
751000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               75100002
751100                   OR (SQLCODE = ZERO))                           75110002
751200                                                                  75120002
751300         EXEC SQL                                                 75130002
751400            UPDATE TSHIPMT                                        75140002
751500               SET VEND_SHIP_DTE   = :SHIPMT-VEND-SHIP-DTE        75150002
751600                  ,LAST_UPD_DTE    = CURRENT DATE                 75160002
751700                  ,LAST_UPD_TME    = CURRENT TIME                 75170002
751800                  ,LAST_UPD_UID    = :DP020-USERID                75180002
751900                  ,LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME     75190002
752000               WHERE SHIPT_ID      = :SHIPMT-SHIPT-ID             75200002
752100         END-EXEC                                                 75210002
752200                                                                  75220002
752300         EVALUATE TRUE                                            75230002
752400             WHEN SQLCODE = ZERO                                  75240002
752500             WHEN SQLCODE = -904                                  75250002
752600             WHEN SQLCODE = -913                                  75260002
752700                 CONTINUE                                         75270002
752800                                                                  75280002
752900             WHEN SQLWARN0 NOT = SPACES                           75290002
753000             WHEN SQLCODE < ZERO                                  75300002
753100             WHEN SQLCODE > ZERO                                  75310002
753200                 MOVE '7000-UPDATE-TSHIPMT'                       75320002
753300                                 TO DP013-PARAGRAPH               75330002
753400                 MOVE 'UPDATE SHIPMENT'                           75340002
753500                                 TO DP013-MESSAGE-TEXT (1)        75350002
753600                 MOVE SHIPMT-SHIPT-ID                             75360002
753700                                 TO DP013-MESSAGE-TEXT (2)        75370002
753800                 MOVE SQLCA      TO DP013-SQLCA                   75380002
753900                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      75390002
754000                 SET DP013-DB2-ABEND                              75400002
754100                                 TO TRUE                          75410002
754200                 SET DP013-XCTL-DISPLAY-RESTART                   75420002
754300                                 TO TRUE                          75430002
754400                 PERFORM DP013-0000-PROCESS-ABEND                 75440002
754500         END-EVALUATE                                             75450002
754600     END-PERFORM.                                                 75460002
754700                                                                  75470002
754800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        75480002
754900             AND (SQLCODE NOT = +0)                               75490002
755000         MOVE '7000-UPDATE-TSHIPMT'                               75500002
755100                                 TO DP013-PARAGRAPH               75510002
755200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     75520002
755300                                 TO DP013-MESSAGE-TEXT (1)        75530002
755400         MOVE 'VEND SHIP DATE'   TO DP013-MESSAGE-TEXT (2)        75540002
755500         MOVE SQLCA              TO DP013-SQLCA                   75550002
755600         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      75560002
755700         SET DP013-DB2-ABEND     TO TRUE                          75570002
755800         SET DP013-XCTL-DISPLAY-RESTART                           75580002
755900                                 TO TRUE                          75590002
756000         PERFORM DP013-0000-PROCESS-ABEND                         75600002
756100     END-IF.                                                      75610002
756200                                                                  75620002
756300     IF SQLCODE = +0                                              75630002
756400        SET PS-AUD-TSHIPMT TO TRUE                                75640002
756500     END-IF.                                                      75650002
756600                                                                  75660002
756700 7005-UPDATE-TSHIPMT-VEHNBR.                                      75670002
756800                                                                  75680002
756900     PERFORM                                                      75690002
757000         WITH TEST AFTER                                          75700002
757100         VARYING PV-RETRY-COUNTER                                 75710002
757200         FROM 1 BY 1                                              75720002
757300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               75730002
757400                   OR (SQLCODE = ZERO))                           75740002
757500                                                                  75750002
757600         EXEC SQL                                                 75760002
757700            UPDATE TSHIPMT                                        75770002
757800               SET VEH_NBR         = :ASC-VEH-NBR                 75780002
757900                  ,LAST_UPD_DTE    = CURRENT DATE                 75790002
758000                  ,LAST_UPD_TME    = CURRENT TIME                 75800002
758100                  ,LAST_UPD_UID    = :DP020-USERID                75810002
758200                  ,LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME     75820002
758300               WHERE SHIPT_ID      = :SHIPMT-SHIPT-ID             75830002
758400         END-EXEC                                                 75840002
758500                                                                  75850002
758600         EVALUATE TRUE                                            75860002
758700             WHEN SQLCODE = ZERO                                  75870002
758800             WHEN SQLCODE = -904                                  75880002
758900             WHEN SQLCODE = -913                                  75890002
759000                 CONTINUE                                         75900002
759100                                                                  75910002
759200             WHEN SQLWARN0 NOT = SPACES                           75920002
759300             WHEN SQLCODE < ZERO                                  75930002
759400             WHEN SQLCODE > ZERO                                  75940002
759500                 MOVE '7005-UPDATE-TSHIPMT-VEHNBR'                75950002
759600                                 TO DP013-PARAGRAPH               75960002
759700                 MOVE 'UPDATE SHIPMENT'                           75970002
759800                                 TO DP013-MESSAGE-TEXT (1)        75980002
759900                 MOVE SHIPMT-SHIPT-ID                             75990002
760000                                 TO DP013-MESSAGE-TEXT (2)        76000002
760100                 MOVE SQLCA      TO DP013-SQLCA                   76010002
760200                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      76020002
760300                 SET DP013-DB2-ABEND                              76030002
760400                                 TO TRUE                          76040002
760500                 SET DP013-XCTL-DISPLAY-RESTART                   76050002
760600                                 TO TRUE                          76060002
760700                 PERFORM DP013-0000-PROCESS-ABEND                 76070002
760800         END-EVALUATE                                             76080002
760900     END-PERFORM.                                                 76090002
761000                                                                  76100002
761100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        76110002
761200             AND (SQLCODE NOT = +0)                               76120002
761300         MOVE '7005-UPDATE-TSHIPMT-VEHNBR'                        76130002
761400                                 TO DP013-PARAGRAPH               76140002
761500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     76150002
761600                                 TO DP013-MESSAGE-TEXT (1)        76160002
761700         MOVE 'VEND SHIP DATE'   TO DP013-MESSAGE-TEXT (2)        76170002
761800         MOVE SQLCA              TO DP013-SQLCA                   76180002
761900         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      76190002
762000         SET DP013-DB2-ABEND     TO TRUE                          76200002
762100         SET DP013-XCTL-DISPLAY-RESTART                           76210002
762200                                 TO TRUE                          76220002
762300         PERFORM DP013-0000-PROCESS-ABEND                         76230002
762400     END-IF.                                                      76240002
762500                                                                  76250002
762600     IF SQLCODE = +0                                              76260002
762700        SET PS-AUD-TSHIPMT TO TRUE                                76270002
762800     END-IF.                                                      76280002
762900                                                                  76290002
763000 7006-UPDATE-TSHIPMT-PROBOL.                                      76300029
763100* CT 03/20/11 - ADDED CARR-AUTH-ID BELOW WR40574                  76310029
763200                                                                  76320002
763300     PERFORM                                                      76330002
763400         WITH TEST AFTER                                          76340002
763500         VARYING PV-RETRY-COUNTER                                 76350002
763600         FROM 1 BY 1                                              76360002
763700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               76370002
763800                   OR (SQLCODE = ZERO))                           76380002
763900                                                                  76390002
764000         EXEC SQL                                                 76400002
764100            UPDATE TSHIPMT                                        76410002
764200               SET PRO_NBR         = :ASC-PRO-NBR                 76420002
764300                  ,BOL_NBR         = :ASC-BOL-NBR                 76430002
764400                  ,LAST_UPD_DTE    = CURRENT DATE                 76440002
764500                  ,LAST_UPD_TME    = CURRENT TIME                 76450002
764600                  ,LAST_UPD_UID    = :DP020-USERID                76460002
764700                  ,LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME     76470002
764800                  ,COMPLETE_PRO_NBR  = :ASC-COMPLETE-PRO-NBR      76480002
764900                  ,COMPLETE_BOL_NBR  = :ASC-COMPLETE-BOL-NBR      76490002
765000                  ,CARR_AUTH_ID      = :ASC-CAN                   76500030
765100               WHERE SHIPT_ID      = :SHIPMT-SHIPT-ID             76510002
765200         END-EXEC                                                 76520002
765300                                                                  76530002
765400         EVALUATE TRUE                                            76540002
765500             WHEN SQLCODE = ZERO                                  76550002
765600             WHEN SQLCODE = -904                                  76560002
765700             WHEN SQLCODE = -913                                  76570002
765800                 CONTINUE                                         76580002
765900                                                                  76590002
766000             WHEN SQLWARN0 NOT = SPACES                           76600002
766100             WHEN SQLCODE < ZERO                                  76610002
766200             WHEN SQLCODE > ZERO                                  76620002
766300                 MOVE '7006-UPDATE-TSHIPMT-PROBOL'                76630002
766400                                 TO DP013-PARAGRAPH               76640002
766500                 MOVE 'UPDATE SHIPMENT'                           76650002
766600                                 TO DP013-MESSAGE-TEXT (1)        76660002
766700                 MOVE SHIPMT-SHIPT-ID                             76670002
766800                                 TO DP013-MESSAGE-TEXT (2)        76680002
766900                 MOVE SQLCA      TO DP013-SQLCA                   76690002
767000                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      76700002
767100                 SET DP013-DB2-ABEND                              76710002
767200                                 TO TRUE                          76720002
767300                 SET DP013-XCTL-DISPLAY-RESTART                   76730002
767400                                 TO TRUE                          76740002
767500                 PERFORM DP013-0000-PROCESS-ABEND                 76750002
767600         END-EVALUATE                                             76760002
767700     END-PERFORM.                                                 76770002
767800                                                                  76780002
767900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        76790002
768000             AND (SQLCODE NOT = +0)                               76800002
768100         MOVE '7006-UPDATE-TSHIPMT-PROBOL'                        76810002
768200                                 TO DP013-PARAGRAPH               76820002
768300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     76830002
768400                                 TO DP013-MESSAGE-TEXT (1)        76840002
768500         MOVE 'VEND SHIP DATE'   TO DP013-MESSAGE-TEXT (2)        76850002
768600         MOVE SQLCA              TO DP013-SQLCA                   76860002
768700         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      76870002
768800         SET DP013-DB2-ABEND     TO TRUE                          76880002
768900         SET DP013-XCTL-DISPLAY-RESTART                           76890002
769000                                 TO TRUE                          76900002
769100         PERFORM DP013-0000-PROCESS-ABEND                         76910002
769200     END-IF.                                                      76920002
769300                                                                  76930002
769400     IF SQLCODE = +0                                              76940002
769500        SET PS-AUD-TSHIPMT TO TRUE                                76950002
769600     END-IF.                                                      76960002
769700                                                                  76970002
769800 7007-UPDATE-TSHIPMT-TRIPID.                                      76980002
769900                                                                  76990002
770000     PERFORM                                                      77000002
770100         WITH TEST AFTER                                          77010002
770200         VARYING PV-RETRY-COUNTER                                 77020002
770300         FROM 1 BY 1                                              77030002
770400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               77040002
770500                   OR (SQLCODE = ZERO))                           77050002
770600                                                                  77060002
770700         EXEC SQL                                                 77070002
770800            UPDATE TSHIPMT                                        77080002
770900               SET TRIP_ID         = :ASC-TRIP-ID                 77090002
771000                  ,LAST_UPD_DTE    = CURRENT DATE                 77100002
771100                  ,LAST_UPD_TME    = CURRENT TIME                 77110002
771200                  ,LAST_UPD_UID    = :DP020-USERID                77120002
771300                  ,LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME     77130002
771400               WHERE SHIPT_ID      = :SHIPMT-SHIPT-ID             77140002
771500         END-EXEC                                                 77150002
771600                                                                  77160002
771700         EVALUATE TRUE                                            77170002
771800             WHEN SQLCODE = ZERO                                  77180002
771900             WHEN SQLCODE = -904                                  77190002
772000             WHEN SQLCODE = -913                                  77200002
772100                 CONTINUE                                         77210002
772200                                                                  77220002
772300             WHEN SQLWARN0 NOT = SPACES                           77230002
772400             WHEN SQLCODE < ZERO                                  77240002
772500             WHEN SQLCODE > ZERO                                  77250002
772600                 MOVE '7007-UPDATE-TSHIPMT-TRIPID'                77260002
772700                                 TO DP013-PARAGRAPH               77270002
772800                 MOVE 'UPDATE SHIPMENT'                           77280002
772900                                 TO DP013-MESSAGE-TEXT (1)        77290002
773000                 MOVE SHIPMT-SHIPT-ID                             77300002
773100                                 TO DP013-MESSAGE-TEXT (2)        77310002
773200                 MOVE SQLCA      TO DP013-SQLCA                   77320002
773300                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      77330002
773400                 SET DP013-DB2-ABEND                              77340002
773500                                 TO TRUE                          77350002
773600                 SET DP013-XCTL-DISPLAY-RESTART                   77360002
773700                                 TO TRUE                          77370002
773800                 PERFORM DP013-0000-PROCESS-ABEND                 77380002
773900         END-EVALUATE                                             77390002
774000     END-PERFORM.                                                 77400002
774100                                                                  77410002
774200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        77420002
774300             AND (SQLCODE NOT = +0)                               77430002
774400         MOVE '7007-UPDATE-TSHIPMT-TRIPID'                        77440002
774500                                 TO DP013-PARAGRAPH               77450002
774600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     77460002
774700                                 TO DP013-MESSAGE-TEXT (1)        77470002
774800         MOVE 'VEND SHIP DATE'   TO DP013-MESSAGE-TEXT (2)        77480002
774900         MOVE SQLCA              TO DP013-SQLCA                   77490002
775000         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      77500002
775100         SET DP013-DB2-ABEND     TO TRUE                          77510002
775200         SET DP013-XCTL-DISPLAY-RESTART                           77520002
775300                                 TO TRUE                          77530002
775400         PERFORM DP013-0000-PROCESS-ABEND                         77540002
775500     END-IF.                                                      77550002
775600                                                                  77560002
775700     IF SQLCODE = +0                                              77570002
775800        SET PS-AUD-TSHIPMT TO TRUE                                77580002
775900     END-IF.                                                      77590002
776000                                                                  77600002
776100 7010-UPDATE-TVHTRIP.                                             77610002
776200                                                                  77620002
776300     MOVE ASC-CARR-SHIP-DTE    TO PV-INPUT-DATE.                  77630002
776400     MOVE PV-INPUT-DATE-MM     TO PV-DB2-DATE-MM.                 77640002
776500     MOVE PV-INPUT-DATE-DD     TO PV-DB2-DATE-DD.                 77650002
776600     MOVE PV-INPUT-DATE-CC     TO PV-DB2-DATE-CC.                 77660002
776700     MOVE PV-INPUT-DATE-YY     TO PV-DB2-DATE-YY.                 77670002
776800     MOVE '-'                  TO PV-DB2-DASH-1                   77680002
776900                                  PV-DB2-DASH-2.                  77690002
777000     MOVE PV-DB2-DATE          TO VHTRIP-OWNR-SCAC-SHIP-DTE.      77700002
777100                                                                  77710002
777200     PERFORM                                                      77720002
777300         WITH TEST AFTER                                          77730002
777400         VARYING PV-RETRY-COUNTER                                 77740002
777500         FROM 1 BY 1                                              77750002
777600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               77760002
777700                   OR (SQLCODE = ZERO))                           77770002
777800                                                                  77780002
777900         EXEC SQL                                                 77790002
778000            UPDATE TVHTRIP                                        77800002
778100               SET OWNR_SCAC_SHIP_DTE                             77810002
778200                                   = :VHTRIP-OWNR-SCAC-SHIP-DTE   77820002
778300                  ,LAST_UPD_DTE    = CURRENT DATE                 77830002
778400                  ,LAST_UPD_TME    = CURRENT TIME                 77840002
778500                  ,LAST_UPD_UID    = :DP020-USERID                77850002
778600               WHERE TRIP_ID       = :SHIPMT-TRIP-ID              77860002
778700         END-EXEC                                                 77870002
778800                                                                  77880002
778900         EVALUATE TRUE                                            77890002
779000             WHEN SQLCODE = ZERO                                  77900002
779100             WHEN SQLCODE = -904                                  77910002
779200             WHEN SQLCODE = -913                                  77920002
779300                 CONTINUE                                         77930002
779400                                                                  77940002
779500             WHEN SQLWARN0 NOT = SPACES                           77950002
779600             WHEN SQLCODE < ZERO                                  77960002
779700             WHEN SQLCODE > ZERO                                  77970002
779800                 MOVE '7010-UPDATE-TVHTRIP'                       77980002
779900                                 TO DP013-PARAGRAPH               77990002
780000                 MOVE 'UPDATE TRIP'                               78000002
780100                                 TO DP013-MESSAGE-TEXT (1)        78010002
780200                 MOVE SHIPMT-TRIP-ID                              78020002
780300                                 TO DP013-MESSAGE-TEXT (2)        78030002
780400                 MOVE SQLCA      TO DP013-SQLCA                   78040002
780500                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME (1)      78050002
780600                 SET DP013-DB2-ABEND                              78060002
780700                                 TO TRUE                          78070002
780800                 SET DP013-XCTL-DISPLAY-RESTART                   78080002
780900                                 TO TRUE                          78090002
781000                 PERFORM DP013-0000-PROCESS-ABEND                 78100002
781100         END-EVALUATE                                             78110002
781200     END-PERFORM.                                                 78120002
781300                                                                  78130002
781400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        78140002
781500             AND (SQLCODE NOT = +0)                               78150002
781600         MOVE '7010-UPDATE-TVHTRIP'                               78160002
781700                                 TO DP013-PARAGRAPH               78170002
781800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     78180002
781900                                 TO DP013-MESSAGE-TEXT (1)        78190002
782000         MOVE 'TVHTRIP'          TO DP013-MESSAGE-TEXT (2)        78200002
782100         MOVE SQLCA              TO DP013-SQLCA                   78210002
782200         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME (1)      78220002
782300         SET DP013-DB2-ABEND     TO TRUE                          78230002
782400         SET DP013-XCTL-DISPLAY-RESTART                           78240002
782500                                 TO TRUE                          78250002
782600         PERFORM DP013-0000-PROCESS-ABEND                         78260002
782700     END-IF.                                                      78270002
782800                                                                  78280002
782900     IF SQLCODE = +0                                              78290002
783000        SET PS-AUD-TVHTRIP TO TRUE                                78300002
783100     END-IF.                                                      78310002
783200                                                                  78320002
783300 7020-GET-COUNT.                                                  78330002
783400                                                                  78340002
783500     PERFORM                                                      78350002
783600         WITH TEST AFTER                                          78360002
783700         VARYING PV-RETRY-COUNTER                                 78370002
783800         FROM 1 BY 1                                              78380002
783900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               78390002
784000                   OR (SQLCODE = ZERO)                            78400002
784100                   OR (SQLCODE = +100))                           78410002
784200                                                                  78420002
784300         EXEC SQL                                                 78430002
784400            SELECT COUNT(*)                                       78440002
784500             INTO :PV-COUNT                                       78450002
784600             FROM  TSHIPMT                                        78460002
784700             WHERE TRIP_ID      = :PV-TRIP-ID-OLD                 78470002
784800         END-EXEC                                                 78480002
784900                                                                  78490002
785000         EVALUATE TRUE                                            78500002
785100             WHEN SQLCODE = ZERO                                  78510002
785200             WHEN SQLCODE = +100                                  78520002
785300             WHEN SQLCODE = -904                                  78530002
785400             WHEN SQLCODE = -913                                  78540002
785500                 CONTINUE                                         78550002
785600                                                                  78560002
785700             WHEN SQLWARN0 NOT = SPACES                           78570002
785800             WHEN SQLCODE < ZERO                                  78580002
785900             WHEN SQLCODE > ZERO                                  78590002
786000                 MOVE '7020-GET-COUNT'                            78600002
786100                                 TO DP013-PARAGRAPH               78610002
786200                 MOVE 'SELECT COUNT FOR TRIP  '                   78620002
786300                                 TO DP013-MESSAGE-TEXT (1)        78630002
786400                 MOVE PV-TRIP-ID-OLD                              78640002
786500                                 TO DP013-MESSAGE-TEXT (2)        78650002
786600                 MOVE SQLCA      TO DP013-SQLCA                   78660002
786700                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      78670002
786800                 SET DP013-DB2-ABEND                              78680002
786900                                 TO TRUE                          78690002
787000                 SET DP013-XCTL-DISPLAY-RESTART                   78700002
787100                                 TO TRUE                          78710002
787200                 PERFORM DP013-0000-PROCESS-ABEND                 78720002
787300         END-EVALUATE                                             78730002
787400     END-PERFORM.                                                 78740002
787500                                                                  78750002
787600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        78760002
787700             AND (SQLCODE NOT = +0)                               78770002
787800         MOVE '7020-GET-COUNT'                                    78780002
787900                                 TO DP013-PARAGRAPH               78790002
788000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     78800002
788100                                 TO DP013-MESSAGE-TEXT (1)        78810002
788200         MOVE 'COUNT         '   TO DP013-MESSAGE-TEXT (2)        78820002
788300         MOVE SQLCA              TO DP013-SQLCA                   78830002
788400         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      78840002
788500         SET DP013-DB2-ABEND     TO TRUE                          78850002
788600         SET DP013-XCTL-DISPLAY-RESTART                           78860002
788700                                 TO TRUE                          78870002
788800         PERFORM DP013-0000-PROCESS-ABEND                         78880002
788900     END-IF.                                                      78890002
789000                                                                  78900002
789100 7030-DELETE-TVHTRIP.                                             78910002
789200                                                                  78920002
789300     PERFORM                                                      78930002
789400         WITH TEST AFTER                                          78940002
789500         VARYING PV-RETRY-COUNTER                                 78950002
789600         FROM 1 BY 1                                              78960002
789700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               78970002
789800                   OR (SQLCODE = ZERO))                           78980002
789900                                                                  78990002
790000         EXEC SQL                                                 79000002
790100            DELETE                                                79010002
790200             FROM TVHTRIP                                         79020002
790300             WHERE TRIP_ID     = :PV-TRIP-ID-OLD                  79030002
790400         END-EXEC                                                 79040002
790500                                                                  79050002
790600         EVALUATE TRUE                                            79060002
790700             WHEN SQLCODE = ZERO                                  79070002
790800             WHEN SQLCODE = -904                                  79080002
790900             WHEN SQLCODE = -913                                  79090002
791000                 CONTINUE                                         79100002
791100                                                                  79110002
791200             WHEN SQLWARN0 NOT = SPACES                           79120002
791300             WHEN SQLCODE < ZERO                                  79130002
791400             WHEN SQLCODE > ZERO                                  79140002
791500                 MOVE '7030-DELETE-TVHTRIP'                       79150002
791600                                 TO DP013-PARAGRAPH               79160002
791700                 MOVE 'DELETE TRIP '                              79170002
791800                                 TO DP013-MESSAGE-TEXT (1)        79180002
791900                 MOVE PV-TRIP-ID-OLD                              79190002
792000                                 TO DP013-MESSAGE-TEXT (2)        79200002
792100                 MOVE SQLCA      TO DP013-SQLCA                   79210002
792200                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME (1)      79220002
792300                 SET DP013-DB2-ABEND                              79230002
792400                                 TO TRUE                          79240002
792500                 SET DP013-XCTL-DISPLAY-RESTART                   79250002
792600                                 TO TRUE                          79260002
792700                 PERFORM DP013-0000-PROCESS-ABEND                 79270002
792800         END-EVALUATE                                             79280002
792900     END-PERFORM.                                                 79290002
793000                                                                  79300002
793100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        79310002
793200             AND (SQLCODE NOT = +0)                               79320002
793300         MOVE '7030-DELETE-TVHTRIP'                               79330002
793400                                 TO DP013-PARAGRAPH               79340002
793500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO DELETE'     79350002
793600                                 TO DP013-MESSAGE-TEXT (1)        79360002
793700         MOVE 'TRIP          '   TO DP013-MESSAGE-TEXT (2)        79370002
793800         MOVE SQLCA              TO DP013-SQLCA                   79380002
793900         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME (1)      79390002
794000         SET DP013-DB2-ABEND     TO TRUE                          79400002
794100         SET DP013-XCTL-DISPLAY-RESTART                           79410002
794200                                 TO TRUE                          79420002
794300         PERFORM DP013-0000-PROCESS-ABEND                         79430002
794400     END-IF.                                                      79440002
794500                                                                  79450002
794600                                                                  79460002
794700*----------------------------------------------------------------*79470002
794800*  RETREIVE A RANDMON NUMBER                                     *79480002
794900*----------------------------------------------------------------*79490002
795000 8100-GET-RANDOM-NUMBER.                                          79500002
795100                                                                  79510002
795200     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     79520002
795300                                                                  79530002
795400     CALL PC-RANDNBR-PGM USING DFHEIBLK                           79540002
795500                               DFHCOMMAREA                        79550002
795600                               DP902-RANDNBR-ROUTINE-FIELDS.      79560002
795700                                                                  79570002
795800     IF  DP902-SUCCESSFUL                                         79580002
795900         NEXT SENTENCE                                            79590002
796000     ELSE                                                         79600002
796100         MOVE '8100-GET-RANDOM-NUMBER'  TO DP013-PARAGRAPH        79610002
796200         MOVE 'CALL TO DPKUT902 FAILED'                           79620002
796300                                   TO DP013-MESSAGE-TEXT(1)       79630002
796400         SET DP013-XCTL-DISPLAY-RESTART                           79640002
796500                                   TO TRUE                        79650002
796600         PERFORM DP013-0000-PROCESS-ABEND                         79660002
796700     END-IF.                                                      79670002
796800  EJECT                                                           79680002
796900                                                                  79690002
797000 8200-READ-DUPL-TVHTRIP.                                          79700002
797100                                                                  79710002
797200     MOVE DP902-RANDOM-NUMBER   TO PV-CURR-TRIP-ID.               79720002
797300                                                                  79730002
797400     PERFORM                                                      79740002
797500         WITH TEST AFTER                                          79750002
797600         VARYING PV-RETRY-COUNTER                                 79760002
797700         FROM 1 BY 1                                              79770002
797800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               79780002
797900             OR (SQLCODE = +0))                                   79790002
798000                                                                  79800002
798100         EXEC SQL                                                 79810002
798200              SELECT COUNT(*)                                     79820002
798300               INTO :PV-VHTRIP-COUNT                              79830002
798400                FROM  TVHTRIP                                     79840002
798500               WHERE (TRIP_ID         = :PV-CURR-TRIP-ID)         79850002
798600         END-EXEC                                                 79860002
798700                                                                  79870002
798800         EVALUATE TRUE                                            79880002
798900             WHEN SQLCODE = +0                                    79890002
799000             WHEN SQLCODE = -904                                  79900002
799100             WHEN SQLCODE = -913                                  79910002
799200                 CONTINUE                                         79920002
799300                                                                  79930002
799400             WHEN SQLWARN0 NOT = SPACES                           79940002
799500             WHEN SQLCODE < +0                                    79950002
799600             WHEN SQLCODE > +0                                    79960002
799700                 MOVE '8200-READ-DUPL-TVHTRIP'                    79970002
799800                                   TO DP013-PARAGRAPH             79980002
799900                 MOVE 'GET COUNT OF TRIPS'                        79990002
800000                                   TO DP013-MESSAGE-TEXT(1)       80000002
800100                 MOVE PV-CURR-TRIP-ID                             80010002
800200                                   TO DP013-MESSAGE-TEXT(2)       80020002
800300                 MOVE SQLCA        TO DP013-SQLCA                 80030002
800400                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    80040002
800500                 SET DP013-DB2-ABEND                              80050002
800600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           80060002
800700                 PERFORM DP013-0000-PROCESS-ABEND                 80070002
800800         END-EVALUATE                                             80080002
800900     END-PERFORM.                                                 80090002
801000                                                                  80100002
801100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        80110002
801200             AND (SQLCODE NOT = +0)                               80120002
801300         MOVE '8200-READ-DUPL-TVHTRIP'                            80130002
801400                                   TO DP013-PARAGRAPH             80140002
801500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              80150002
801600                                   TO DP013-MESSAGE-TEXT (1)      80160002
801700         MOVE 'TO COUNT TVHTRIP ROWS'                             80170002
801800                                   TO DP013-MESSAGE-TEXT (2)      80180002
801900         MOVE SQLCA                TO DP013-SQLCA                 80190002
802000         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    80200002
802100         SET DP013-DB2-ABEND                                      80210002
802200             DP013-XCTL-DISPLAY-RESTART                           80220002
802300                                   TO TRUE                        80230002
802400         PERFORM DP013-0000-PROCESS-ABEND                         80240002
802500     END-IF.                                                      80250002
802600                                                                  80260002
802700     IF PV-VHTRIP-COUNT > 0                                       80270002
802800         PERFORM 8100-GET-RANDOM-NUMBER                           80280002
802900     END-IF.                                                      80290002
803000                                                                  80300002
803100 8300-READ-DUPL-TSHIPMT.                                          80310002
803200                                                                  80320002
803300     MOVE DP902-RANDOM-NUMBER   TO PV-CURR-SHIPT-ID.              80330002
803400                                                                  80340002
803500     PERFORM                                                      80350002
803600         WITH TEST AFTER                                          80360002
803700         VARYING PV-RETRY-COUNTER                                 80370002
803800         FROM 1 BY 1                                              80380002
803900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               80390002
804000             OR (SQLCODE = +0))                                   80400002
804100                                                                  80410002
804200         EXEC SQL                                                 80420002
804300              SELECT COUNT(*)                                     80430002
804400               INTO :PV-SHIPMT-COUNT                              80440002
804500                FROM  TSHIPMT                                     80450002
804600               WHERE (SHIPT_ID        = :PV-CURR-SHIPT-ID)        80460002
804700         END-EXEC                                                 80470002
804800                                                                  80480002
804900         EVALUATE TRUE                                            80490002
805000             WHEN SQLCODE = +0                                    80500002
805100             WHEN SQLCODE = -904                                  80510002
805200             WHEN SQLCODE = -913                                  80520002
805300                 CONTINUE                                         80530002
805400                                                                  80540002
805500             WHEN SQLWARN0 NOT = SPACES                           80550002
805600             WHEN SQLCODE < +0                                    80560002
805700             WHEN SQLCODE > +0                                    80570002
805800                 MOVE '8300-READ-DUPL-TVHTRIP'                    80580002
805900                                   TO DP013-PARAGRAPH             80590002
806000                 MOVE 'GET COUNT OF TRIPS'                        80600002
806100                                   TO DP013-MESSAGE-TEXT(1)       80610002
806200                 MOVE PV-CURR-SHIPT-ID                            80620002
806300                                   TO DP013-MESSAGE-TEXT(2)       80630002
806400                 MOVE SQLCA        TO DP013-SQLCA                 80640002
806500                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    80650002
806600                 SET DP013-DB2-ABEND                              80660002
806700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           80670002
806800                 PERFORM DP013-0000-PROCESS-ABEND                 80680002
806900         END-EVALUATE                                             80690002
807000     END-PERFORM.                                                 80700002
807100                                                                  80710002
807200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        80720002
807300             AND (SQLCODE NOT = +0)                               80730002
807400         MOVE '8300-READ-DUPL-TVHTRIP'                            80740002
807500                                   TO DP013-PARAGRAPH             80750002
807600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              80760002
807700                                   TO DP013-MESSAGE-TEXT (1)      80770002
807800         MOVE 'TO COUNT TVHTRIP ROWS'                             80780002
807900                                   TO DP013-MESSAGE-TEXT (2)      80790002
808000         MOVE SQLCA                TO DP013-SQLCA                 80800002
808100         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    80810002
808200         SET DP013-DB2-ABEND                                      80820002
808300             DP013-XCTL-DISPLAY-RESTART                           80830002
808400                                   TO TRUE                        80840002
808500         PERFORM DP013-0000-PROCESS-ABEND                         80850002
808600     END-IF.                                                      80860002
808700                                                                  80870002
808800     IF PV-SHIPMT-COUNT > 0                                       80880002
808900         PERFORM 8100-GET-RANDOM-NUMBER                           80890002
809000     END-IF.                                                      80900002
809100                                                                  80910002
809200*----------------------------------------------------------------*80920002
809300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *80930002
809400*----------------------------------------------------------------*80940002
809500 9100-READ-SEL-QUEUE.                                             80950002
809600     EXEC CICS                                                    80960002
809700         READQ TS                                                 80970002
809800             QUEUE (ASC-SEL-QUEUE-NAME)                           80980002
809900             INTO  (RC013-DC-SELECT-RECORD)                       80990002
810000             ITEM  (ASC-SEL-ITEM)                                 81000002
810100             RESP  (PV-CICS-RESPONSE)                             81010002
810200     END-EXEC.                                                    81020002
810300                                                                  81030002
810400     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   81040002
810500         CONTINUE                                                 81050002
810600     ELSE                                                         81060002
810700         SET DP013-LOGIC-ABEND                                    81070002
810800             DP013-NO-ROLLBACK     TO TRUE                        81080002
810900         MOVE '9100-READ-SEL-QUEUE'                               81090002
811000                                   TO DP013-PARAGRAPH             81100002
811100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   81110002
811200                                   TO DP013-MESSAGE-TEXT (1)      81120002
811300         PERFORM DP013-0000-PROCESS-ABEND                         81130002
811400     END-IF.                                                      81140002
811500                                                                  81150002
811600                                                                  81160002
811700*----------------------------------------------------------------*81170002
811800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *81180002
811900*----------------------------------------------------------------*81190002
812000 9200-REWRITE-SEL-QUEUE.                                          81200002
812100     EXEC CICS                                                    81210002
812200          WRITEQ TS                                               81220002
812300              QUEUE  (ASC-SEL-QUEUE-NAME)                         81230002
812400              FROM   (RC013-DC-SELECT-RECORD)                     81240002
812500              ITEM   (ASC-SEL-ITEM)                               81250002
812600              RESP   (PV-CICS-RESPONSE)                           81260002
812700              REWRITE                                             81270002
812800     END-EXEC.                                                    81280002
812900                                                                  81290002
813000     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       81300002
813100         CONTINUE                                                 81310002
813200     ELSE                                                         81320002
813300         SET DP013-CICS-ABEND                                     81330002
813400             DP013-NO-ROLLBACK     TO TRUE                        81340002
813500         MOVE '9200-REWRITE-SEL-QUEUE'                            81350002
813600                                   TO DP013-PARAGRAPH             81360002
813700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   81370002
813800                                   TO DP013-MESSAGE-TEXT (1)      81380002
813900         PERFORM DP013-0000-PROCESS-ABEND                         81390002
814000     END-IF.                                                      81400002
814100/                                                                 81410002
814200*----------------------------------------------------------------*81420002
814300*    ABEND PROCESSOR MODULE                                      *81430002
814400*----------------------------------------------------------------*81440002
814500                                                                  81450002
814600     COPY DPPD013.                                                81460002
814700                                                                  81470002
814800/                                                                 81480002
814900*----------------------------------------------------------------*81490002
815000*    CICS ARCHITECTURE DATE TIME MODULE                          *81500002
815100*----------------------------------------------------------------*81510002
815200                                                                  81520002
815300     COPY DPPD017.                                                81530002
815400                                                                  81540002
815500     MOVE DP017-CURRENT-YMD-YEAR    TO DP017-EDITED-MDY-YEAR.     81550002
