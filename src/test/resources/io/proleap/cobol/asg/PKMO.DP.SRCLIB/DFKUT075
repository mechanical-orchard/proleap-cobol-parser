000100 ID  DIVISION.                                                    00010000
000200 PROGRAM-ID.         DFKUT075                                     00020000
000300 AUTHOR.             LINDA GRIESBACH                              00030000
000400 INSTALLATION.       KOHL'S CORPORATION.                          00040000
000500 DATE-WRITTEN.       MAY 1999.                                    00050000
000600 DATE-COMPILED.                                                   00060000
000700***************************************************************** 00070000
000800* THIS PROGRAM CREATES THE STORE ADMINISTRATION "WEEKLY ACTUAL  * 00080000
000900* STORE SALES" USING DB2 TABLE TDADPTS.                         * 00090000
000901* 09/2005 -- PROGRAM CHANGED TO USE THE NEW FLASH TABLES,       * 00090100
000902*            SPECIFICALLY DFT_ML_FINCL_SUM, INSTEAD OF TDADPTS. * 00090200
000903*---------------------------------------------------------------* 00090300
000904* HISTORY LOG:                                                  * 00090400
000905*===============================================================* 00090500
000906* DATE: 12/07/99                                                * 00090600
000907* PROGRAMMER: PAT DOYLE                                         * 00090700
000908* DESCRIPTION:                                                  * 00090800
000909*    FIXED LOGIC WHICH GETS BEGINNING AND ENDING FISCAL DATES.  * 00090900
000910*    IT WAS NOT WORKING CORRECTLY FOR DECEMBER.                 * 00091000
000911***************************************************************** 00091100
000912* DATE: 02/12/04                                                * 00091200
000913* PROGRAMMER: STEVEN NOWAK                                      * 00091300
000914* DESCRIPTION: WR# 26583                                        * 00091400
000915*  CHANGE TO TABLE TDADPTS, RECOMPILE TO PULL IN CHNGD DCLGEN   * 00091500
000916*                                                               * 00091600
000917***************************************************************** 00091700
000911***************************************************************** 00091804
000912* DATE: 07/16/2012                                              * 00091904
000913* PROGRAMMER: COGNIZANT                                           00092004
000914* DESCRIPTION: INC#INC000002252890                              * 00092104
000915*  CHNAGED THE QUERY TO INCLUDE ORDERBY STR_NBR TO FETCH THE    * 00092204
000916*  STORE RECORDS CORRECTLY TO POPULATE THE OUTPUT FILE.         * 00092304
000916*  THIS CHNAGE WAS NEEDED AFTER THE IPL                         * 00092405
000916*  FOR DB2*                                                       00092504
000917***************************************************************** 00092604
000918 ENVIRONMENT DIVISION.                                            00092704
000919 CONFIGURATION SECTION.                                           00092804
000920 SOURCE-COMPUTER.        IBM-370.                                 00092904
000921 OBJECT-COMPUTER.        IBM-370.                                 00093004
000922 INPUT-OUTPUT SECTION.                                            00093104
000930 FILE-CONTROL.                                                    00093204
000940     SELECT WKLY-STORE-SALES-FILE                                 00093304
000950         ASSIGN TO OUT01.                                         00093404
000960                                                                  00093504
000970 DATA DIVISION.                                                   00093604
000980 FILE SECTION.                                                    00093704
000990 FD  WKLY-STORE-SALES-FILE                                        00093804
001000     RECORDING MODE IS F                                          00093904
001100     LABEL RECORDS ARE STANDARD                                   00094000
001200     RECORD CONTAINS 91 CHARACTERS                                00095000
001300     BLOCK  CONTAINS  0 RECORDS                                   00096000
001400     DATA RECORD IS WKLY-STORE-SALES-RCD.                         00097000
001500 01  WKLY-STORE-SALES-RCD        PIC X(91).                       00098000
001600                                                                  00099000
001700 WORKING-STORAGE SECTION.                                         00100000
001800 01  SWITCHES.                                                    00110000
001900     05  DFT-ML-FINCL-SUM-SW     PIC X      VALUE 'N'.            00120000
002000         88  EOF-DFT-ML-FINCL-SUM           VALUE 'Y'.            00130000
002100         88  NOT-EOF-DFT-ML-FINCL-SUM       VALUE 'N'.            00140000
002200     05  FETCH-SW                PIC X      VALUE 'Y'.            00150000
002300         88  FIRST-FETCH                    VALUE 'Y'.            00160000
002400         88  NOT-FIRST-FETCH                VALUE 'N'.            00170000
002500     05  PRINT-SW                PIC X      VALUE 'Y'.            00180000
002600         88  FIRST-PRINT                    VALUE 'Y'.            00190000
002700         88  NOT-FIRST-PRINT                VALUE 'N'.            00200000
002800     05  FISCAL-PER-SW           PIC X      VALUE 'Y'.            00210000
002900         88  CURR-FISCAL-PER                VALUE 'Y'.            00220000
003000         88  NOT-CURR-FISCAL-PER            VALUE 'N'.            00230000
003100                                                                  00240000
003200 01  PROGRAM-VARIABLES.                                           00250000
003300     05  CC-CONTROL-CARD.                                         00260000
003400         10  CC-MTH              PIC X(3).                        00270000
003500         10  FILLER              PIC X(1).                        00280000
003600         10  CC-YEAR             PIC X(4).                        00290000
003700         10  FILLER              PIC X(72).                       00300000
003800     05  SAVE-FISCAL-DATE.                                        00310000
003900         10  SAVE-FISCAL-YR.                                      00320000
004000             15  SAVE-FISCAL-CC  PIC X(2).                        00330000
004100             15  SAVE-FISCAL-YY  PIC X(2).                        00340000
004200         10  SAVE-FISCAL-MTH     PIC X(2).                        00350000
004300         10  SAVE-FISCAL-DY      PIC X(2).                        00360000
004400     05  PV-SAVE-FIRST-FISCAL-PER-DAY                             00370000
004500                                 PIC X(10).                       00380000
004600     05  PV-SAVE-LAST-FISCAL-PER-DAY                              00390000
004700                                 PIC X(10).                       00400000
004800     05  PV-SAVE-DATE-PLUS-7     PIC X(10).                       00410000
004900     05  PV-SAVE-DATE-PLUS-14    PIC X(10).                       00420000
005000     05  PV-SAVE-DATE-PLUS-21    PIC X(10).                       00430000
005100     05  PV-SAVE-DATE-PLUS-28    PIC X(10).                       00440000
005200     05  PV-RCDS-READ            PIC S9(9)      VALUE 0 COMP-3.   00450000
005300     05  PV-RCDS-WRITTEN         PIC S9(9)      VALUE 0 COMP-3.   00460000
005400     05  PV-DISPLAY-READ         PIC ZZZ,ZZZ,ZZ9.                 00470000
005500     05  PV-DISPLAY-WRITTEN      PIC ZZZ,ZZZ,ZZ9.                 00480000
005600     05  ABEND-CODE              PIC S9(4)      VALUE 0 COMP SYNC.00490000
005700     05  PV-DATE-SENT            PIC X(10).                       00500000
005800     05  PV-SALES-WK1            PIC S9(11)V9(2) VALUE 0 COMP-3.  00510003
005900     05  PV-SALES-WK2            PIC S9(11)V9(2) VALUE 0 COMP-3.  00520003
006000     05  PV-SALES-WK3            PIC S9(11)V9(2) VALUE 0 COMP-3.  00530003
006100     05  PV-SALES-WK4            PIC S9(11)V9(2) VALUE 0 COMP-3.  00540003
006200     05  PV-SALES-WK5            PIC S9(11)V9(2) VALUE 0 COMP-3.  00550003
006300     05  PV-SAVE-STORE-NUM       PIC S9(4) COMP.                  00560000
006400     05  PV-SAVE-WEEK-DAY        PIC 9(1).                        00570000
006500                                                                  00580000
006600 01  OUTPUT-FILE-HEADER-LINE.                                     00590000
006700     05  FILLER                  PIC X(5)       VALUE 'STORE'.    00600000
006800     05  FILLER                  PIC X(1)       VALUE ','.        00610000
006900     05  FILLER                  PIC X(10)      VALUE             00620000
007000                                                'STORE NAME'.     00630000
007100     05  FILLER                  PIC X(1)       VALUE ','.        00640000
007200     05  WEEK1.                                                   00650000
007300         10  FILLER              PIC X(4)       VALUE 'WEEK'.     00660000
007400         10  WEEK1-FISCALNBR     PIC 9(2).                        00670000
007500     05  FILLER                  PIC X(1)       VALUE ','.        00680000
007600     05  WEEK2.                                                   00690000
007700         10  FILLER              PIC X(4)       VALUE 'WEEK'.     00700000
007800         10  WEEK2-FISCALNBR     PIC 9(2).                        00710000
007900     05  FILLER                  PIC X(1)       VALUE ','.        00720000
008000     05  WEEK3.                                                   00730000
008100         10  FILLER              PIC X(4)       VALUE 'WEEK'.     00740000
008200         10  WEEK3-FISCALNBR     PIC 9(2).                        00750000
008300     05  FILLER                  PIC X(1)       VALUE ','.        00760000
008400     05  WEEK4.                                                   00770000
008500         10  FILLER              PIC X(4)       VALUE 'WEEK'.     00780000
008600         10  WEEK4-FISCALNBR     PIC 9(2).                        00790000
008700     05  POSSIBLE-WEEK5.                                          00800000
008800         10  WEEK5-HEADING       PIC X(5).                        00810000
008900         10  WEEK5-FISCALNBR     PIC 9(2).                        00820000
009000         10  WEEK5-FISCALNBRX REDEFINES WEEK5-FISCALNBR           00830000
009100                                 PIC X(2).                        00840000
009200     05  FILLER                  PIC X(29)      VALUE SPACES.     00850000
009300                                                                  00860000
009400     COPY DFRD025.                                                00870000
009500                                                                  00880000
009600******************************************************************00890000
009700*    CALENDAR MODULE INCLUDE                                     *00900000
009800******************************************************************00910000
009900     COPY DPWS500.                                                00920000
010000                                                                  00930000
010010*  DB2 TABLE DFT_ML_FINCL_SUM - DAILY FLASH FINANCIAL SUMMARY     00940000
010020*  TABLE.                                                         00950000
010100     EXEC SQL                                                     00960000
010200        INCLUDE DFT00002                                          00970000
010300     END-EXEC.                                                    00980000
010400                                                                  00990000
010500*  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       01000000
010600     EXEC SQL                                                     01010000
010700        INCLUDE XST00001                                          01020000
010800     END-EXEC.                                                    01030000
010900                                                                  01040000
011000*   DB2 COMMUNICATION AREA                                        01050000
011100     EXEC SQL                                                     01060000
011200        INCLUDE SQLCA                                             01070000
011300     END-EXEC.                                                    01080000
011400                                                                  01090000
011500*   DB2 COMMUNICATION AREA2                                       01100000
011600     COPY SQLCA2.                                                 01110000
011700                                                                  01120000
011800*   STORE SALES DB2 SELECT                                        01130000
011900     EXEC SQL                                                     01140000
012000       DECLARE STORE_SALES CURSOR FOR                             01150000
012100        SELECT SLS_DTE                                            01160000
012200              ,STR_NBR                                            01170000
012300              ,SUM(DLY_DOL_AMT)                                   01180001
012500        FROM DFT_ML_FINCL_SUM                                     01190000
012600        WHERE SLS_DTE      BETWEEN :PV-SAVE-FIRST-FISCAL-PER-DAY  01200000
012700                               AND :PV-SAVE-LAST-FISCAL-PER-DAY   01210000
012710         AND  DLY_DOL_AMT       <> 0                              01220000
012800        GROUP BY STR_NBR, SLS_DTE                                 01230002
I52890        ORDER BY STR_NBR                                          01231004
012900     END-EXEC.                                                    01240000
013000                                                                  01250000
013100     EJECT                                                        01260000
013200 PROCEDURE DIVISION.                                              01270000
013300 M0000-MAINLINE.                                                  01280000
013400                                                                  01290000
013500     PERFORM A1000-INITIALIZATION                                 01300000
013600        THRU A1000-EXIT.                                          01310000
013700                                                                  01320000
013800     PERFORM B1000-BUILD-WKLY-SALES                               01330000
013900        THRU B1000-EXIT                                           01340000
014000        UNTIL EOF-DFT-ML-FINCL-SUM.                               01350000
014100                                                                  01360000
014200     PERFORM C1000-CLOSE-FILES                                    01370000
014300        THRU C1000-EXIT.                                          01380000
014400                                                                  01390000
014500 M0000-EXIT.                                                      01400000
014600     EXIT.                                                        01410000
014700     STOP RUN.                                                    01420000
014800                                                                  01430000
014900                                                                  01440000
015000 A1000-INITIALIZATION.                                            01450000
015100                                                                  01460000
015200     OPEN OUTPUT WKLY-STORE-SALES-FILE.                           01470000
015300                                                                  01480000
015400     INITIALIZE WEEK1-FISCALNBR                                   01490000
015500                WEEK2-FISCALNBR                                   01500000
015600                WEEK3-FISCALNBR                                   01510000
015700                WEEK4-FISCALNBR                                   01520000
015800                WEEK5-FISCALNBR                                   01530000
015900                DF025-STORE-NBR                                   01540000
016000                DF025-STORE-NAME                                  01550000
016100                DF025-STORE-SALES-WK1                             01560000
016200                DF025-STORE-SALES-WK2                             01570000
016300                DF025-STORE-SALES-WK3                             01580000
016400                DF025-STORE-SALES-WK4                             01590000
016500                DF025-STORE-SALES-WK5-SEP                         01600000
016600                DF025-STORE-SALES-WK5.                            01610000
016700                                                                  01620000
016800     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01630000
016900                                                                  01640000
017000     PERFORM A1100-COMPUTE-DATE-INFO                              01650000
017100        THRU A1100-EXIT.                                          01660000
017200                                                                  01670000
017300     EXEC SQL                                                     01680000
017400         OPEN STORE_SALES                                         01690000
017500     END-EXEC.                                                    01700000
017600                                                                  01710000
017700     IF SQLCODE < 0                                               01720000
017800         DISPLAY 'OPEN UNSUCCESSFUL FOR DFT_ML_FINCL_SUM'         01730000
017900         PERFORM U9980-SQL-ERROR                                  01740000
018000            THRU U9980-EXIT                                       01750000
018100     END-IF.                                                      01760000
018200                                                                  01770000
018300     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01780000
018400           SQLWARN0 = 'W'                                         01790000
018500         DISPLAY 'OPEN WARNING FOR DFT_ML_FINCL_SUM'              01800000
018600         PERFORM U9990-SQL-WARNING                                01810000
018700            THRU U9990-EXIT                                       01820000
018800     END-IF.                                                      01830000
018900                                                                  01840000
019000 A1000-EXIT.                                                      01850000
019100     EXIT.                                                        01860000
019200                                                                  01870000
019300                                                                  01880000
019400 A1100-COMPUTE-DATE-INFO.                                         01890000
019500                                                                  01900000
019600     MOVE CC-YEAR TO SAVE-FISCAL-YR.                              01910000
019700                                                                  01920000
019800     MOVE '15' TO SAVE-FISCAL-DY.                                 01930000
019900                                                                  01940000
020000     IF CC-MTH = 'JAN'                                            01950000
020100         MOVE '01' TO SAVE-FISCAL-MTH                             01960000
020200     ELSE IF CC-MTH = 'FEB'                                       01970000
020300         MOVE '02' TO SAVE-FISCAL-MTH                             01980000
020400     ELSE IF CC-MTH = 'MAR'                                       01990000
020500         MOVE '03' TO SAVE-FISCAL-MTH                             02000000
020600     ELSE IF CC-MTH = 'APR'                                       02010000
020700         MOVE '04' TO SAVE-FISCAL-MTH                             02020000
020800     ELSE IF CC-MTH = 'MAY'                                       02030000
020900         MOVE '05' TO SAVE-FISCAL-MTH                             02040000
021000     ELSE IF CC-MTH = 'JUN'                                       02050000
021100         MOVE '06' TO SAVE-FISCAL-MTH                             02060000
021200     ELSE IF CC-MTH = 'JUL'                                       02070000
021300         MOVE '07' TO SAVE-FISCAL-MTH                             02080000
021400     ELSE IF CC-MTH = 'AUG'                                       02090000
021500         MOVE '08' TO SAVE-FISCAL-MTH                             02100000
021600     ELSE IF CC-MTH = 'SEP'                                       02110000
021700         MOVE '09' TO SAVE-FISCAL-MTH                             02120000
021800     ELSE IF CC-MTH = 'OCT'                                       02130000
021900         MOVE '10' TO SAVE-FISCAL-MTH                             02140000
022000     ELSE IF CC-MTH = 'NOV'                                       02150000
022100         MOVE '11' TO SAVE-FISCAL-MTH                             02160000
022200     ELSE                                                         02170000
022300         MOVE '12' TO SAVE-FISCAL-MTH.                            02180000
022400                                                                  02190000
022500**  DETERMINE THE FISCAL MONTH BEGIN AND END DATES                02200000
022600                                                                  02210000
022700     INITIALIZE DPG51 DPG52 DPG53                                 02220000
022800                DPG54 DPG55 DPG56.                                02230000
022900                                                                  02240000
023000     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02250000
023100     SET DPG52-LK-DTE-ISO          TO TRUE.                       02260000
023200     MOVE SAVE-FISCAL-DATE         TO DPG52-DB2-ISO-DATE.         02270000
023300     INITIALIZE PV-DATE-SENT.                                     02280000
023400     MOVE DPG52-DB2-ISO-DATE       TO PV-DATE-SENT.               02290000
023500                                                                  02300000
023600     PERFORM A1200-CALL-DPKUT500                                  02310000
023700        THRU A1200-EXIT.                                          02320000
023800                                                                  02330000
023900     MOVE DPG56-FIRST-FP-DB2-ISO-FMT                              02340000
024000           TO PV-SAVE-FIRST-FISCAL-PER-DAY.                       02350000
024100     MOVE DPG56-LAST-FP-DB2-ISO-FMT                               02360000
024200           TO PV-SAVE-LAST-FISCAL-PER-DAY.                        02370000
024300     DISPLAY '** BEGINNING DATE: ' PV-SAVE-FIRST-FISCAL-PER-DAY.  02380000
024400     DISPLAY '** ENDING DATE:    ' PV-SAVE-LAST-FISCAL-PER-DAY.   02390000
024500                                                                  02400000
024600     INITIALIZE DPG51 DPG52 DPG53                                 02410000
024700                DPG54 DPG55 DPG56.                                02420000
024800                                                                  02430000
024900     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02440000
025000     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       02450000
025100     MOVE PV-SAVE-FIRST-FISCAL-PER-DAY TO                         02460000
025200                         DPG52-DB2-ISO-DATE-FMT.                  02470000
025300     INITIALIZE PV-DATE-SENT.                                     02480000
025400     MOVE DPG52-DB2-ISO-DATE-FMT   TO PV-DATE-SENT.               02490000
025500                                                                  02500000
025600     PERFORM A1200-CALL-DPKUT500                                  02510000
025700        THRU A1200-EXIT.                                          02520000
025800                                                                  02530000
025900     MOVE DPG56-FISCAL-WEEK-NBR  TO WEEK1-FISCALNBR.              02540000
026000                                                                  02550000
026100**  NEXT DETERMINE THE BEGIN WEEK DATES FOR THE REMAINING         02560000
026200**  WEEKS OF THE FISCAL MONTH                                     02570000
026300                                                                  02580000
026400     INITIALIZE DPG51 DPG52 DPG53                                 02590000
026500                DPG54 DPG55 DPG56.                                02600000
026600                                                                  02610000
026700     SET DPG51-ACTUAL-CALENDAR-ONLY    TO TRUE.                   02620000
026800     SET DPG51-INCREMENT-DATE          TO TRUE.                   02630000
026900     MOVE 7 TO DPG51-INCR-DECR-DAYS-9.                            02640000
027000     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   02650000
027100     MOVE PV-SAVE-FIRST-FISCAL-PER-DAY TO DPG52-DB2-ISO-DATE-FMT. 02660000
027200     INITIALIZE PV-DATE-SENT.                                     02670000
027300     MOVE DPG52-DB2-ISO-DATE-FMT       TO PV-DATE-SENT.           02680000
027400                                                                  02690000
027500     PERFORM A1200-CALL-DPKUT500                                  02700000
027600        THRU A1200-EXIT.                                          02710000
027700                                                                  02720000
027800     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-SAVE-DATE-PLUS-7.          02730000
027900                                                                  02740000
028000                                                                  02750000
028100     INITIALIZE DPG51 DPG52 DPG53                                 02760000
028200                DPG54 DPG55 DPG56.                                02770000
028300                                                                  02780000
028400     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   02790000
028500     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   02800000
028600     MOVE PV-SAVE-DATE-PLUS-7          TO DPG52-DB2-ISO-DATE-FMT. 02810000
028700     INITIALIZE PV-DATE-SENT.                                     02820000
028800     MOVE DPG52-DB2-ISO-DATE-FMT       TO PV-DATE-SENT.           02830000
028900                                                                  02840000
029000     PERFORM A1200-CALL-DPKUT500                                  02850000
029100        THRU A1200-EXIT.                                          02860000
029200                                                                  02870000
029300     MOVE DPG56-FISCAL-WEEK-NBR  TO WEEK2-FISCALNBR.              02880000
029400                                                                  02890000
029500****************                                                  02900000
029600                                                                  02910000
029700     INITIALIZE DPG51 DPG52 DPG53                                 02920000
029800                DPG54 DPG55 DPG56.                                02930000
029900                                                                  02940000
030000     SET DPG51-ACTUAL-CALENDAR-ONLY    TO TRUE.                   02950000
030100     SET DPG51-INCREMENT-DATE          TO TRUE.                   02960000
030200     MOVE 14 TO DPG51-INCR-DECR-DAYS-9.                           02970000
030300     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   02980000
030400     MOVE PV-SAVE-FIRST-FISCAL-PER-DAY TO DPG52-DB2-ISO-DATE-FMT. 02990000
030500                                                                  03000000
030600     PERFORM A1200-CALL-DPKUT500                                  03010000
030700        THRU A1200-EXIT.                                          03020000
030800                                                                  03030000
030900     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-SAVE-DATE-PLUS-14.         03040000
031000                                                                  03050000
031100                                                                  03060000
031200     INITIALIZE DPG51 DPG52 DPG53                                 03070000
031300                DPG54 DPG55 DPG56.                                03080000
031400                                                                  03090000
031500     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   03100000
031600     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   03110000
031700     MOVE PV-SAVE-DATE-PLUS-14         TO DPG52-DB2-ISO-DATE-FMT. 03120000
031800     INITIALIZE PV-DATE-SENT.                                     03130000
031900     MOVE DPG52-DB2-ISO-DATE-FMT       TO PV-DATE-SENT.           03140000
032000                                                                  03150000
032100     PERFORM A1200-CALL-DPKUT500                                  03160000
032200        THRU A1200-EXIT.                                          03170000
032300                                                                  03180000
032310     MOVE DPG56-FISCAL-WEEK-NBR  TO WEEK3-FISCALNBR.              03190000
032320                                                                  03200000
032330****************                                                  03210000
032340                                                                  03220000
032350     INITIALIZE DPG51 DPG52 DPG53                                 03230000
032360                DPG54 DPG55 DPG56.                                03231000
032370                                                                  03232000
032380     SET DPG51-ACTUAL-CALENDAR-ONLY    TO TRUE.                   03233000
032381     SET DPG51-INCREMENT-DATE          TO TRUE.                   03234000
032382     MOVE 21 TO DPG51-INCR-DECR-DAYS-9.                           03235000
032383     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   03236000
032384     MOVE PV-SAVE-FIRST-FISCAL-PER-DAY TO DPG52-DB2-ISO-DATE-FMT. 03237000
032385                                                                  03238000
032386     PERFORM A1200-CALL-DPKUT500                                  03238100
032387        THRU A1200-EXIT.                                          03238200
032388                                                                  03238300
032389     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-SAVE-DATE-PLUS-21.         03238400
032390                                                                  03238500
032391                                                                  03238600
032392     INITIALIZE DPG51 DPG52 DPG53                                 03238700
032393                DPG54 DPG55 DPG56.                                03238800
032394                                                                  03238900
032395     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   03239000
032396     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   03239100
032397     MOVE PV-SAVE-DATE-PLUS-21         TO DPG52-DB2-ISO-DATE-FMT. 03239200
032398     INITIALIZE PV-DATE-SENT.                                     03239300
032399     MOVE DPG52-DB2-ISO-DATE-FMT       TO PV-DATE-SENT.           03239400
032400                                                                  03239500
032401     PERFORM A1200-CALL-DPKUT500                                  03239600
032402        THRU A1200-EXIT.                                          03239700
032403                                                                  03239800
032404     MOVE DPG56-FISCAL-WEEK-NBR  TO WEEK4-FISCALNBR.              03239900
032405                                                                  03240000
032406****************                                                  03240100
032407                                                                  03240200
032408     INITIALIZE DPG51 DPG52 DPG53                                 03240300
032409                DPG54 DPG55 DPG56.                                03240400
032410                                                                  03240500
032411     SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                    03240600
032412     SET DPG51-INCREMENT-DATE         TO TRUE.                    03240700
032413     MOVE 28 TO DPG51-INCR-DECR-DAYS-9.                           03240800
032414     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    03240900
032415     MOVE PV-SAVE-FIRST-FISCAL-PER-DAY                            03241000
032416                                 TO DPG52-DB2-ISO-DATE-FMT.       03241100
032417                                                                  03241200
032418     PERFORM A1200-CALL-DPKUT500                                  03241300
032419        THRU A1200-EXIT.                                          03241400
032420                                                                  03241500
032421     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-SAVE-DATE-PLUS-28.         03241600
032422                                                                  03241700
032423                                                                  03241800
032424     INITIALIZE DPG51 DPG52 DPG53                                 03241900
032425                DPG54 DPG55 DPG56.                                03242000
032426                                                                  03242100
032427     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   03242200
032428     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   03242300
032429     MOVE PV-SAVE-DATE-PLUS-28         TO DPG52-DB2-ISO-DATE-FMT. 03242400
032430     INITIALIZE PV-DATE-SENT.                                     03242500
032431     MOVE DPG52-DB2-ISO-DATE-FMT       TO PV-DATE-SENT.           03242600
032432                                                                  03242700
032433     PERFORM A1200-CALL-DPKUT500                                  03242800
032434        THRU A1200-EXIT.                                          03242900
032435                                                                  03243000
032436     IF PV-SAVE-DATE-PLUS-28 < PV-SAVE-LAST-FISCAL-PER-DAY        03243100
032437         MOVE ',WEEK'                TO WEEK5-HEADING             03243200
032438         MOVE DPG56-FISCAL-WEEK-NBR  TO WEEK5-FISCALNBR           03243300
032439     ELSE                                                         03243400
032440         INITIALIZE WEEK5-HEADING                                 03243500
032441                    WEEK5-FISCALNBRX                              03243600
032442     END-IF.                                                      03243700
032443                                                                  03243800
032444 A1100-EXIT.                                                      03243900
032445     EXIT.                                                        03244000
032446                                                                  03244100
032447                                                                  03244200
032448 A1200-CALL-DPKUT500.                                             03244300
032449                                                                  03244400
032450     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          03244500
032451                                             DPG53 DPG54          03244600
032452                                             DPG55 DPG56.         03244700
032453                                                                  03244800
032454     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  03244900
032455         DISPLAY '** ABEND **'                                    03245000
032456         DISPLAY '** PROGRAM = DFKUT075'                          03245100
032457         DISPLAY 'DATE = ' PV-DATE-SENT                           03245200
032458         DISPLAY DPG54-ERROR-MESSAGE                              03245300
032459         MOVE 4019 TO ABEND-CODE                                  03245400
032460         CALL 'ILBOABN0' USING ABEND-CODE                         03245500
032461     END-IF.                                                      03245600
032462                                                                  03245700
032463 A1200-EXIT.                                                      03245800
032464     EXIT.                                                        03245900
032465                                                                  03246000
032466                                                                  03246100
032467 B1000-BUILD-WKLY-SALES.                                          03246200
032468                                                                  03246300
032469     PERFORM B1100-FETCH-STORE-SALES                              03246400
032470        THRU B1100-EXIT.                                          03246500
032471                                                                  03246600
032472     IF EOF-DFT-ML-FINCL-SUM                                      03246700
032473         PERFORM B1300-SELECT-XST00001                            03246800
032474            THRU B1300-EXIT                                       03246900
032475         PERFORM B1400-WRITE-SALES-RCD                            03247000
032476            THRU B1400-EXIT                                       03247100
032477         GO TO B1000-EXIT                                         03247200
032478     END-IF.                                                      03247300
032479                                                                  03247400
032480     IF FIRST-FETCH                                               03247500
032490       OR DFT00002-STR-NBR = PV-SAVE-STORE-NUM                    03247600
032500         PERFORM B1200-ADD-SALES                                  03247700
032600            THRU B1200-EXIT                                       03247800
032700     ELSE                                                         03247900
032800         PERFORM B1300-SELECT-XST00001                            03248000
032900            THRU B1300-EXIT                                       03249000
033000         PERFORM B1400-WRITE-SALES-RCD                            03250000
033100            THRU B1400-EXIT                                       03260000
033200         PERFORM B1200-ADD-SALES                                  03270000
033300            THRU B1200-EXIT                                       03280000
033400     END-IF.                                                      03290000
033500                                                                  03300000
033600 B1000-EXIT.                                                      03310000
033700     EXIT.                                                        03320000
033800                                                                  03330000
033900                                                                  03340000
034000 B1100-FETCH-STORE-SALES.                                         03350000
034100                                                                  03360000
034200     EXEC SQL                                                     03370000
034300         FETCH STORE_SALES                                        03380000
034400             INTO :DFT00002-SLS-DTE                               03390000
034500                 ,:DFT00002-STR-NBR                               03400000
034600                 ,:DFT00002-DLY-DOL-AMT                           03410000
034800     END-EXEC.                                                    03420000
034900                                                                  03430000
035000     IF SQLCODE < 0                                               03440000
035100         DISPLAY 'FETCH UNSUCCESSFUL FOR DFT_ML_FINCL_SUM'        03450000
035200         PERFORM U9980-SQL-ERROR                                  03460000
035300            THRU U9980-EXIT                                       03470000
035400     END-IF.                                                      03480000
035500                                                                  03490000
035600     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               03500000
035700           SQLWARN0 = 'W'                                         03510000
035800         DISPLAY 'FETCH WARNING FOR DFT_ML_FINCL_SUM'             03520000
035900         PERFORM U9990-SQL-WARNING                                03530000
036000            THRU U9990-EXIT                                       03540000
036100     END-IF.                                                      03550000
036200                                                                  03560000
036300     IF SQLCODE = +100                                            03570000
036400         SET EOF-DFT-ML-FINCL-SUM TO TRUE                         03580000
036500         GO TO B1100-EXIT                                         03590000
036600     END-IF.                                                      03600000
036700                                                                  03610000
036800     ADD 1 TO PV-RCDS-READ.                                       03620000
036900                                                                  03630000
037000 B1100-EXIT.                                                      03640000
037100     EXIT.                                                        03650000
037200                                                                  03660000
037300                                                                  03670000
037400 B1200-ADD-SALES.                                                 03680000
037500                                                                  03690000
037600     IF FIRST-FETCH                                               03700000
037700         MOVE DFT00002-STR-NBR TO PV-SAVE-STORE-NUM               03710000
037800         SET NOT-FIRST-FETCH   TO TRUE                            03720000
037900     END-IF.                                                      03730000
038000                                                                  03740000
038100     IF DFT00002-SLS-DTE < PV-SAVE-DATE-PLUS-7                    03750000
038200         ADD DFT00002-DLY-DOL-AMT TO PV-SALES-WK1                 03760000
038400     ELSE                                                         03770000
038500         IF DFT00002-SLS-DTE < PV-SAVE-DATE-PLUS-14               03780000
038600             ADD DFT00002-DLY-DOL-AMT                             03790000
038700                                  TO PV-SALES-WK2                 03800000
038800         ELSE                                                     03810000
038900             IF DFT00002-SLS-DTE < PV-SAVE-DATE-PLUS-21           03820000
039000                 ADD DFT00002-DLY-DOL-AMT                         03830000
039100                                  TO PV-SALES-WK3                 03840000
039200             ELSE                                                 03850000
039300                 IF DFT00002-SLS-DTE < PV-SAVE-DATE-PLUS-28       03860000
039400                     ADD DFT00002-DLY-DOL-AMT                     03870000
039500                                  TO PV-SALES-WK4                 03880000
039600                 ELSE                                             03890000
039700                     ADD DFT00002-DLY-DOL-AMT                     03900000
039800                                  TO PV-SALES-WK5                 03910000
039900                 END-IF                                           03920000
040000             END-IF                                               03930000
040100         END-IF                                                   03940000
040200     END-IF.                                                      03950000
040300                                                                  03960000
040400 B1200-EXIT.                                                      03970000
040500     EXIT.                                                        03980000
040600                                                                  03990000
040700                                                                  04000000
040800 B1300-SELECT-XST00001.                                           04010000
040900                                                                  04020000
041000     EXEC SQL                                                     04030000
041100         SELECT LOC_10_ABBR_NM                                    04040000
041200         INTO :XST00001-LOC-10-ABBR-NM                            04050000
041300         FROM XST_LOC                                             04060000
041400         WHERE LOC_NBR     = :PV-SAVE-STORE-NUM                   04070000
041500           AND LOC_TYP_CDE = 'DS'                                 04080000
041600     END-EXEC.                                                    04090000
041700                                                                  04100000
041800     IF SQLCODE < 0                                               04110000
041900         DISPLAY 'FETCH UNSUCCESSFUL FOR DB2 TABLE XST00001'      04120000
042000         PERFORM U9980-SQL-ERROR                                  04130000
042100            THRU U9980-EXIT                                       04140000
042200     END-IF.                                                      04150000
042300                                                                  04160000
042400     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               04170000
042500           SQLWARN0 = 'W'                                         04180000
042600         DISPLAY 'FETCH WARNING FOR DB2 TABLE XST00001'           04190000
042700         PERFORM U9990-SQL-WARNING                                04200000
042800            THRU U9990-EXIT                                       04210000
042900     END-IF.                                                      04220000
043000                                                                  04230000
043100     IF SQLCODE = +100                                            04240000
043200         GO TO B1300-EXIT                                         04250000
043300     ELSE                                                         04260000
043400         MOVE XST00001-LOC-10-ABBR-NM TO DF025-STORE-NAME         04270000
043500     END-IF.                                                      04280000
043600                                                                  04290000
043700 B1300-EXIT.                                                      04300000
043800     EXIT.                                                        04310000
043900                                                                  04320000
044000                                                                  04330000
044100 B1400-WRITE-SALES-RCD.                                           04340000
044200                                                                  04350000
044300     IF FIRST-PRINT                                               04360000
044400         WRITE WKLY-STORE-SALES-RCD FROM OUTPUT-FILE-HEADER-LINE  04370000
044500         SET NOT-FIRST-PRINT TO TRUE                              04380000
044600     END-IF.                                                      04390000
044700                                                                  04400000
044800     MOVE PV-SAVE-STORE-NUM TO DF025-STORE-NBR.                   04410000
044900                                                                  04420000
045000     IF PV-SALES-WK1 > 0                                          04430000
045100         MOVE PV-SALES-WK1 TO DF025-STORE-SALES-WK1               04440000
045200     ELSE                                                         04450000
045300         INITIALIZE DF025-ST-SALES-WK1                            04460000
045400     END-IF.                                                      04470000
045410     IF PV-SALES-WK2 > 0                                          04480000
045420         MOVE PV-SALES-WK2 TO DF025-STORE-SALES-WK2               04490000
045430     ELSE                                                         04500000
045431         INITIALIZE DF025-ST-SALES-WK2                            04510000
045432     END-IF.                                                      04520000
045433     IF PV-SALES-WK3 > 0                                          04530000
045434         MOVE PV-SALES-WK3 TO DF025-STORE-SALES-WK3               04540000
045435     ELSE                                                         04541000
045436         INITIALIZE DF025-ST-SALES-WK3                            04542000
045437     END-IF.                                                      04543000
045438     IF PV-SALES-WK4 > 0                                          04543100
045439         MOVE PV-SALES-WK4 TO DF025-STORE-SALES-WK4               04543200
045440     ELSE                                                         04543300
045450         INITIALIZE DF025-ST-SALES-WK4                            04543400
045460     END-IF.                                                      04543500
045470     IF PV-SALES-WK5 > 0                                          04543600
045480         MOVE ','          TO DF025-STORE-SALES-WK5-SEP           04543700
045490         MOVE PV-SALES-WK5 TO DF025-STORE-SALES-WK5               04543800
045500     ELSE                                                         04543900
045600         INITIALIZE DF025-STORE-SALES-WK5-SEP                     04544000
045700                    DF025-ST-SALES-WK5                            04545000
045800     END-IF.                                                      04546000
045900                                                                  04547000
046000     WRITE WKLY-STORE-SALES-RCD FROM DF025-RECORD.                04548000
046100                                                                  04549000
046200     ADD 1 TO PV-RCDS-WRITTEN.                                    04550000
046300                                                                  04560000
046400     MOVE DFT00002-STR-NBR  TO PV-SAVE-STORE-NUM.                 04570000
046500                                                                  04580000
046600     INITIALIZE DF025-STORE-NBR                                   04590000
046700                DF025-STORE-NAME                                  04600000
046800                DF025-STORE-SALES-WK1                             04610000
046900                DF025-STORE-SALES-WK2                             04620000
047000                DF025-STORE-SALES-WK3                             04630000
047100                DF025-STORE-SALES-WK4                             04640000
047200                DF025-STORE-SALES-WK5                             04650000
047300                PV-SALES-WK1                                      04660000
047400                PV-SALES-WK2                                      04670000
047500                PV-SALES-WK3                                      04680000
047600                PV-SALES-WK4                                      04690000
047601                PV-SALES-WK5.                                     04700000
047602                                                                  04710000
047603 B1400-EXIT.                                                      04720000
047604     EXIT.                                                        04730000
047605                                                                  04740000
047606                                                                  04750000
047607 C1000-CLOSE-FILES.                                               04760000
047608                                                                  04760100
047609     MOVE PV-RCDS-READ    TO PV-DISPLAY-READ.                     04760200
047610     MOVE PV-RCDS-WRITTEN TO PV-DISPLAY-WRITTEN.                  04760300
047620                                                                  04760400
047630     DISPLAY '******************************************'         04760500
047640     DISPLAY '**  PROGRAM:  DFKUT075'                             04760600
047650     DISPLAY '**'                                                 04760700
047660     DISPLAY '**  RECORDS READ:     ' PV-DISPLAY-READ             04760800
047670     DISPLAY '**  RECORDS WRITTEN:  ' PV-DISPLAY-WRITTEN          04760900
047680     DISPLAY '******************************************'         04761000
047690                                                                  04762000
047700     CLOSE WKLY-STORE-SALES-FILE.                                 04763000
047800                                                                  04764000
047900     EXEC SQL                                                     04765000
048000         CLOSE STORE_SALES                                        04766000
048100     END-EXEC.                                                    04767000
048200                                                                  04768000
048300     IF SQLCODE < 0                                               04769000
048400         DISPLAY 'CLOSE UNSUCCESSFUL FOR DFT_ML_FINCL_SUM'        04770000
048500         PERFORM U9980-SQL-ERROR                                  04780000
048600            THRU U9980-EXIT                                       04790000
048700     END-IF.                                                      04800000
048800                                                                  04810000
048900     IF SQLCODE > 0 OR SQLWARN0 = 'W'                             04820000
049000         DISPLAY 'CLOSE WARNING FOR DFT_ML_FINCL_SUM'             04830000
049100         PERFORM U9990-SQL-WARNING                                04840000
049200            THRU U9990-EXIT                                       04850000
049300     END-IF.                                                      04860000
049400                                                                  04870000
049500 C1000-EXIT.                                                      04880000
049600     EXIT.                                                        04890000
049700                                                                  04900000
049800                                                                  04910000
049900 U9980-SQL-ERROR.                                                 04920000
050000                                                                  04930000
050100     MOVE SQLCODE    TO SQLCODE2.                                 04940000
050200     MOVE SQLERRD(3) TO SQLERRD3.                                 04950000
050300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 04960000
050400     DISPLAY '** PROGRAM        ** = DFKUT075'.                   04970000
050500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  04980000
050600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  04990000
050700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05000000
050800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05010000
050900                                                                  05020000
051000     MOVE 4013 TO ABEND-CODE.                                     05030000
051100     CALL 'ILBOABN0' USING ABEND-CODE.                            05040000
051200                                                                  05050000
051300 U9980-EXIT.                                                      05060000
051400     EXIT.                                                        05070000
051500                                                                  05080000
051600                                                                  05090000
051700 U9990-SQL-WARNING.                                               05100000
051800                                                                  05110000
051900     MOVE SQLCODE    TO SQLCODE2.                                 05120000
052000     MOVE SQLERRD(3) TO SQLERRD3.                                 05130000
052100     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05140000
052200     DISPLAY '** PROGRAM        ** = DFKUT075'.                   05150000
052300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05160000
052400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05170000
052500     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05180000
052600     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  05190000
052700     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  05200000
052800     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  05210000
052900     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  05220000
053000     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  05230000
053100     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  05240000
053200     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  05250000
053300                                                                  05260000
053400     MOVE 4013 TO ABEND-CODE.                                     05270000
053500     CALL 'ILBOABN0' USING ABEND-CODE.                            05280000
053600                                                                  05290000
053700 U9990-EXIT.                                                      05300000
053800     EXIT.                                                        05310000
