000100 IDENTIFICATION DIVISION.                                         03/21/95
000200 PROGRAM-ID.    CNKCS208.                                         CNKCS208
000300 AUTHOR.        TOM RUSKA. G&R.                                      LV007
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS208
000500 DATE-WRITTEN.  05-14-93.                                         CNKCS208
000600 DATE-COMPILED.                                                   CNKCS208
000700                                                                  CNKCS208
000800*---------------------------------------------------------------* CNKCS208
000900*    TRANID      - Y208                                         * CNKCS208
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * CNKCS208
001100*    DESCRIPTION - ASSIGN DEPT/CLASS FACILITY LOCATION          * CNKCS208
001200*    MAPSET      - CNKM208                                      * CNKCS208
001300*                                                               * CNKCS208
001400*    THIS PROGRAM WILL ADD, UPDATE OR DELETE A PREVIOUSLY       * CNKCS208
001500*    DEFINED FACILITY LOCATION TO DEPARTMENT/CLASSES.           * CNKCS208
001600*                                                               * CNKCS208
001700*---------------------------------------------------------------* CNKCS208
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455                 
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263455* MAKING THE CALL DYNAMIC VS STATIC.                                      
263455*----------------------------------------------------------------*        
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001800                                                                  CNKCS208
001900 ENVIRONMENT DIVISION.                                            CNKCS208
002000 DATA DIVISION.                                                   CNKCS208
002100                                                                  CNKCS208
002200/                                                                 CNKCS208
002300 WORKING-STORAGE SECTION.                                         CNKCS208
002400                                                                  CNKCS208
002500 01  DK-DB2-KEYS.                                                 CNKCS208
002600     05  DK-OPER-UNT-ID                 PIC S9(04) COMP.          CNKCS208
002700     05  DK-FCLTY-ID                    PIC S9(04) COMP.          CNKCS208
002800     05  DK-AREA-ID                     PIC  X(06).               CNKCS208
002900     05  DK-DEPT-NBR                    PIC  X(03).               CNKCS208
003000     05  DK-CL-NBR                      PIC  X(02).               CNKCS208
003100     05  DK-TYPE                        PIC  X(02).               CNKCS208
003200     05  DK-RANK                        PIC  S9(04) COMP.         CNKCS208
003300     05  DK-OPER-SET-ID                 PIC  S9(04) COMP.         CNKCS208
003400                                                                  CNKCS208
003500 01  DN-DB2-NULL-INDICATORS.                                      CNKCS208
003600     05  DN-FCLTY-AREA-ID               PIC S9(04) VALUE +0       CNKCS208
003700                                                    COMP.         CNKCS208
003800                                                                  CNKCS208
003900 01  PC-PROGRAM-CONSTANTS.                                        CNKCS208
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         CNKCS208
004100                                                    'CN208A  '.   CNKCS208
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         CNKCS208
004300                                                    'CNKM208 '.   CNKCS208
004400     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     CNKCS208
004500                                                    COMP.         CNKCS208
004600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         CNKCS208
004700                                                    'CNKCS208'.   CNKCS208
004800     05  PC-INTER-APPL-CODES.                                     CNKCS208
004900         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(01)  VALUE '1'.    CNKCS208
005000         10  PC-INTER-APPL-ADD          PIC  X(01)  VALUE '2'.    CNKCS208
005100         10  PC-INTER-APPL-UPDATE       PIC  X(01)  VALUE '3'.    CNKCS208
005200         10  PC-INTER-APPL-DELETE       PIC  X(01)  VALUE '4'.    CNKCS208
005300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      CNKCS208
005400                                                    COMP-3.       CNKCS208
005500                                                                  CNKCS208
005600     05  PC-TSYMSG-NUMBERS.                                       CNKCS208
005700         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. CNKCS208
005800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. CNKCS208
005900         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. CNKCS208
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. CNKCS208
006100         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. CNKCS208
006200         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. CNKCS208
006300         10  PC-TSYMSG-00045            PIC  9(05)  VALUE  00045. CNKCS208
006400         10  PC-TSYMSG-00047            PIC  9(05)  VALUE  00047. CNKCS208
006500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. CNKCS208
006600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. CNKCS208
006700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. CNKCS208
006800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. CNKCS208
006900         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. CNKCS208
007000         10  PC-TSYMSG-00110            PIC  9(05)  VALUE  00110. CNKCS208
007100         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. CNKCS208
007200         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. CNKCS208
007300         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. CNKCS208
007400         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. CNKCS208
007500         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. CNKCS208
007600         10  PC-TSYMSG-00387            PIC  9(05)  VALUE  00387. CNKCS208
007700         10  PC-TSYMSG-00476            PIC  9(05)  VALUE  00476. CNKCS208
007800         10  PC-TSYMSG-00987            PIC  9(05)  VALUE  00987.    CL**6
007900                                                                  CNKCS208
008000 01  PS-PROGRAM-SWITCHES.                                         CNKCS208
008100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    CNKCS208
008200         88  PS-NO-ERROR                            VALUE 'Y'.    CNKCS208
008300         88  PS-ERROR                               VALUE 'N'.    CNKCS208
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    CNKCS208
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    CNKCS208
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    CNKCS208
008700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    CNKCS208
008800         88  PS-DONE                                VALUE 'Y'.    CNKCS208
008900         88  PS-NOT-DONE                            VALUE 'N'.    CNKCS208
009000     05  PS-EOF-TDCFAAS-CSR-SW          PIC  X(01)  VALUE 'N'.    CNKCS208
009100         88  PS-EOF-TDCFAAS-CSR                     VALUE 'Y'.    CNKCS208
009200     05  PS-ASSIGN-ERROR-SW             PIC  X(01)  VALUE 'N'.    CNKCS208
009300         88  PS-ASSIGN-ERROR                        VALUE 'Y'.    CNKCS208
009400     05  PS-FCLTY-AREA-CHGD-SW          PIC  X(01)  VALUE 'N'.    CNKCS208
009500         88  PS-FCLTY-AREA-CHGD                     VALUE 'Y'.    CNKCS208
009600                                                                  CNKCS208
009700 01  PV-PROGRAM-VARIABLES.                                        CNKCS208
009800     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      CNKCS208
009900                                                    COMP SYNC.    CNKCS208
010000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      CNKCS208
010100                                                    COMP SYNC.    CNKCS208
010200     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      CNKCS208
010300                                                    COMP-3.       CNKCS208
010400     05  PV-UPD-COUNTER                 PIC S9(09)  VALUE +0      CNKCS208
010500                                                    COMP-3.       CNKCS208
010600     05  PV-RANK-NBR                    PIC S9(04)  VALUE +0      CNKCS208
010700                                                    COMP-3.       CNKCS208
010800     05  PV-HOLD-TDCFAAS                PIC X(25)   VALUE SPACES. CNKCS208
010900                                                                  CNKCS208
011000*---------------------------------------------------------------* CNKCS208
011100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * CNKCS208
011200*---------------------------------------------------------------* CNKCS208
011300                                                                  CNKCS208
011400     COPY CNWS005.                                                CNKCS208
011500                                                                  CNKCS208
011600/                                                                 CNKCS208
011700*---------------------------------------------------------------* CNKCS208
011800*    MAP LAYOUT                                                 * CNKCS208
011900*---------------------------------------------------------------* CNKCS208
012000                                                                  CNKCS208
012100     COPY CNKM208.                                                CNKCS208
012200                                                                  CNKCS208
012300/                                                                 CNKCS208
012400*---------------------------------------------------------------* CNKCS208
012500*    ATTRIBUTE SETTINGS COPYBOOK.                               * CNKCS208
012600*---------------------------------------------------------------* CNKCS208
012700                                                                  CNKCS208
012800     COPY DPWS015.                                                CNKCS208
012900                                                                  CNKCS208
013000*---------------------------------------------------------------* CNKCS208
013100*    FUNCTION KEYS COPYBOOK.                                    * CNKCS208
013200*---------------------------------------------------------------* CNKCS208
013300                                                                  CNKCS208
013400     COPY DPWS016.                                                CNKCS208
013500                                                                  CNKCS208
013600*---------------------------------------------------------------* CNKCS208
013700*    NUMERIC EDIT LAYOUT.                                       * CNKCS208
013800*---------------------------------------------------------------* CNKCS208
013900                                                                  CNKCS208
014000     COPY DPWS010I.                                               CNKCS208
014100                                                                  CNKCS208
014200/                                                                 CNKCS208
014300*---------------------------------------------------------------* CNKCS208
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * CNKCS208
014500*---------------------------------------------------------------* CNKCS208
014600                                                                  CNKCS208
014700     COPY DPWS030.                                                CNKCS208
CICS       COPY DPWS930.                                                CNKCS208
014900/                                                                 CNKCS208
015000*---------------------------------------------------------------* CNKCS208
015100*    STANDARD COMMAREA.                                         * CNKCS208
015200*---------------------------------------------------------------* CNKCS208
015300                                                                  CNKCS208
015400     COPY DPWS020.                                                CNKCS208
015500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS208
015600                                                                  CNKCS208
015700*---------------------------------------------------------------* CNKCS208
015800* INTER-APPLICATION COMMAREA.                                   * CNKCS208
015900*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * CNKCS208
016000*             SPEC SCREEN.                                      * CNKCS208
016100*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * CNKCS208
016200*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * CNKCS208
016300*---------------------------------------------------------------* CNKCS208
016400                                                                  CNKCS208
016500         10  INTER-APPL-COMM-AREA       PIC X(200).               CNKCS208
016600     COPY CNWS001.                                                CNKCS208
016700     COPY CNWS003.                                                CNKCS208
016800*---------------------------------------------------------------* CNKCS208
016900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * CNKCS208
017000*---------------------------------------------------------------* CNKCS208
017100         10  ASC-SPECIFIC-COMMAREA.                               CNKCS208
017200             15  ASC-INT-APPL-FORMAT-IND PIC X(01).               CNKCS208
017300             15  ASC-ACTION-SW          PIC X(03).                CNKCS208
017400                 88  ASC-ADD-PENDING    VALUE 'ADD'.              CNKCS208
017500                 88  ASC-DELETE-PENDING VALUE 'DEL'.              CNKCS208
017600                 88  ASC-UPDATE-PENDING VALUE 'UPD'.              CNKCS208
017700                 88  ASC-ASSIGN-ALL     VALUE 'ALL'.              CNKCS208
017800             15  ASC-DELETE-SUCCESSFUL-SW  PIC X(01).             CNKCS208
017900                 88  ASC-DELETE-SUCCESSFUL VALUE 'Y'.             CNKCS208
018000             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            CNKCS208
018100                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            CNKCS208
018200                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            CNKCS208
018300             15  ASC-OPER-UNT-ID        PIC 9(04).                CNKCS208
018400             15  ASC-FCLTY-ID           PIC 9(04).                CNKCS208
018500             15  ASC-FCLTY-NME          PIC X(25).                CNKCS208
018600             15  ASC-DEPT-NBR           PIC X(03).                CNKCS208
018700             15  ASC-CL-NBR             PIC X(02).                CNKCS208
018800             15  ASC-TYPE               PIC X(02).                CNKCS208
018900             15  ASC-AREA-ID            PIC X(06).                CNKCS208
019000             15  ASC-RANK               PIC X(01).                CNKCS208
019100             15  ASC-RANK-N REDEFINES ASC-RANK                    CNKCS208
019200                                        PIC 9(01).                CNKCS208
019300             15  ASC-DESC               PIC X(30).                CNKCS208
019400             15  ASC-OPER-SET-ID        PIC X(03).                CNKCS208
019500             15  ASC-OPER-SET-ID-N REDEFINES ASC-OPER-SET-ID      CNKCS208
019600                                        PIC 9(03).                CNKCS208
019700             15  ASC-OPER-SET-DESC      PIC X(25).                CNKCS208
019800             15  ASC-USE-SELECTION-QUEUE-IND                      CNKCS208
019900                                        PIC  X(01).               CNKCS208
020000                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    CNKCS208
020100             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               CNKCS208
020200             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       CNKCS208
020300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     CNKCS208
020400                                        PIC S9(09)  COMP-3.       CNKCS208
020500             15  ASC-SEL-SUB            PIC S9(04)  COMP.         CNKCS208
020600             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         CNKCS208
020700                                                                  CNKCS208
020800/                                                                 CNKCS208
020900*---------------------------------------------------------------* CNKCS208
021000*    ABEND PROCESSING COPYBOOK.                                 * CNKCS208
021100*---------------------------------------------------------------* CNKCS208
021200                                                                  CNKCS208
021300     COPY DPWS013.                                                CNKCS208
021400                                                                  CNKCS208
021500/                                                                 CNKCS208
021600*---------------------------------------------------------------* CNKCS208
021700*    DB2 AREA FOR THE FACILITY LOCATION TABLE                   * CNKCS208
021800*---------------------------------------------------------------* CNKCS208
021900     EXEC SQL                                                     CNKCS208
022000          INCLUDE TFLAREA                                         CNKCS208
022100     END-EXEC.                                                    CNKCS208
022200                                                                  CNKCS208
022300/                                                                 CNKCS208
022400*---------------------------------------------------------------* CNKCS208
022500*    COPYBOOK USED WHEN CALLING XLKUT071                        * CNKCS208
022600*---------------------------------------------------------------* CNKCS208
022700     COPY XLWS071.                                                CNKCS208
023000                                                                  CNKCS208
023100/                                                                 CNKCS208
023200*---------------------------------------------------------------* CNKCS208
023300*    DB2 AREA FOR THE DEPARTMENT/CLASS FACILITY LOCATION TABLE  * CNKCS208
023400*---------------------------------------------------------------* CNKCS208
023500     EXEC SQL                                                     CNKCS208
023600          INCLUDE TDCFAAS                                         CNKCS208
023700     END-EXEC.                                                    CNKCS208
023800                                                                  CNKCS208
023900/                                                                 CNKCS208
024000*----------------------------------------------------------------*CNKCS208
024100*    DB2 AREA FOR OPERATION SET TABLE                            *CNKCS208
024200*----------------------------------------------------------------*CNKCS208
024300                                                                  CNKCS208
024400     EXEC SQL                                                     CNKCS208
024500          INCLUDE TOPRSET                                         CNKCS208
024600     END-EXEC.                                                    CNKCS208
024700                                                                  CNKCS208
024800/                                                                 CNKCS208
024900*----------------------------------------------------------------*CNKCS208
025000*    DB2 AREA FOR OPERATION SET/FACILITY TABLE                   *CNKCS208
025100*----------------------------------------------------------------*CNKCS208
025200                                                                  CNKCS208
025300     EXEC SQL                                                     CNKCS208
025400          INCLUDE TOSOPFA                                         CNKCS208
025500     END-EXEC.                                                    CNKCS208
025600                                                                  CNKCS208
025700/                                                                 CNKCS208
025800*----------------------------------------------------------------*CNKCS208
025900*    DB2 AREA FOR WORK ORDER TABLE                               *CNKCS208
026000*----------------------------------------------------------------*CNKCS208
026100                                                                  CNKCS208
026200     EXEC SQL                                                     CNKCS208
026300          INCLUDE TWRKORD                                         CNKCS208
026400     END-EXEC.                                                    CNKCS208
026500                                                                  CNKCS208
026600/                                                                 CNKCS208
026700*---------------------------------------------------------------* CNKCS208
026800*    DB2 AREA FOR COMMUNICATIONS                                * CNKCS208
026900*---------------------------------------------------------------* CNKCS208
027000     EXEC SQL                                                     CNKCS208
027100          INCLUDE SQLCA                                           CNKCS208
027200     END-EXEC.                                                    CNKCS208
027300                                                                  CNKCS208
027400/                                                                 CNKCS208
027500*---------------------------------------------------------------* CNKCS208
027600*    CURSOR TO SELECT ALL ROWS ON DEPT-CL-NBR FACILITY TABLE    * CNKCS208
027700*---------------------------------------------------------------* CNKCS208
027800                                                                  CNKCS208
027900     EXEC SQL                                                     CNKCS208
028000          DECLARE TDCFAAS-CSR CURSOR FOR                          CNKCS208
028100           SELECT OPER_UNT_ID                                     CNKCS208
028200                 ,FCLTY_ID                                        CNKCS208
028300                 ,DEPT_NBR                                        CNKCS208
028400                 ,CL_NBR                                          CNKCS208
028500                 ,FCLTY_LOC_TYP_CDE                               CNKCS208
028600                 ,RANK_NBR                                        CNKCS208
028700                 ,FCLTY_AREA_ID                                   CNKCS208
028800             FROM TDCFAAS                                         CNKCS208
028900            WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID            CNKCS208
029000              AND  FCLTY_ID          = :DK-FCLTY-ID               CNKCS208
029100              AND  DEPT_NBR          = :DK-DEPT-NBR               CNKCS208
029200              AND  CL_NBR            = :DK-CL-NBR                 CNKCS208
029300              AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                   CNKCS208
029400         ORDER BY RANK_NBR                                        CNKCS208
029500     END-EXEC.                                                    CNKCS208
029600                                                                  CNKCS208
029700/                                                                 CNKCS208
029800 LINKAGE SECTION.                                                 CNKCS208
029900                                                                  CNKCS208
030000 01  DFHCOMMAREA.                                                 CNKCS208
030100     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS208
030200                                        DEPENDING ON EIBCALEN.    CNKCS208
030300         10  FILLER                     PIC X.                    CNKCS208
030400                                                                  CNKCS208
030500/                                                                 CNKCS208
030600 PROCEDURE DIVISION.                                              CNKCS208
030700*---------------------------------------------------------------* CNKCS208
030800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * CNKCS208
030900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * CNKCS208
031000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * CNKCS208
031100*---------------------------------------------------------------* CNKCS208
031200 0000-MAIN-MODULE.                                                CNKCS208
031300                                                                  CNKCS208
031400     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS208
031500                                                                  CNKCS208
031600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       CNKCS208
031700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          CNKCS208
031800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         CNKCS208
031900                                                                  CNKCS208
032000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       CNKCS208
032100                                                                  CNKCS208
032200     MOVE LENGTH OF CN208AI        TO DP030-MAP-LENGTH (1).       CNKCS208
032300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     CNKCS208
032400                                                                  CNKCS208
032500     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS208
032600     PERFORM 1000-CONTROL-PROCESSING                              CNKCS208
032700                                                                  CNKCS208
032800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     CNKCS208
032900     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS208
033000                                                                  CNKCS208
033100*---------------------------------------------------------------* CNKCS208
033200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * CNKCS208
033300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * CNKCS208
033400*---------------------------------------------------------------* CNKCS208
033500 0001-CALL-CICS-ARCH-API.                                         CNKCS208
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
033700                                    DFHCOMMAREA                           
033800                                    DP030-CICS-API-FIELDS                 
033900                                    DP020-STANDARD-COMMAREA               
034000                                    CN208AI.                              
034100                                                                  CNKCS208
034200     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS208
034300         CONTINUE                                                 CNKCS208
034400     ELSE                                                         CNKCS208
034500         SET DP013-NO-ROLLBACK                                    CNKCS208
034600             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
034700             DP013-CICS-ABEND      TO TRUE                        CNKCS208
034800         MOVE '0001-CALL-CICS-ARCH-API'                           CNKCS208
034900                                   TO DP013-PARAGRAPH             CNKCS208
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
035200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      CNKCS208
035300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
035400     END-IF.                                                      CNKCS208
035500                                                                  CNKCS208
035600*----------------------------------------------------------------*CNKCS208
035700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *CNKCS208
035800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *CNKCS208
035900*----------------------------------------------------------------*CNKCS208
036000                                                                  CNKCS208
036100 1000-CONTROL-PROCESSING.                                         CNKCS208
036200                                                                  CNKCS208
036300     EVALUATE TRUE                                                CNKCS208
036400         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS208
036500              PERFORM 1100-FIND-OBJECT-KEYS                       CNKCS208
036600              IF  PS-ERROR                                        CNKCS208
036700                  CONTINUE                                        CNKCS208
036800              ELSE                                                CNKCS208
036900                  IF  ASC-ADD-PENDING                             CNKCS208
037000                      PERFORM 1200-INIT-ADD-SCREEN                CNKCS208
037100                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        CNKCS208
037200                      PERFORM 3200-RESET-ATTRIBUTES               CNKCS208
037300                  ELSE                                            CNKCS208
037400                      PERFORM 4000-BUILD-INITIAL-PANEL            CNKCS208
037500                      PERFORM 3200-RESET-ATTRIBUTES               CNKCS208
037600                      IF  SQLCODE = +100                          CNKCS208
037700                          SET DP020-NEXT-ACT-APPL-ERROR           CNKCS208
037800                                         TO TRUE                  CNKCS208
037900                          MOVE PC-TSYMSG-00148                    CNKCS208
038000                                         TO DP020-MSG-NUMBER      CNKCS208
038100                          SET DP020-MSG-INFORMATIONAL             CNKCS208
038200                                         TO TRUE                  CNKCS208
038300                      ELSE                                        CNKCS208
038400                          IF  ASC-DELETE-PENDING                  CNKCS208
038500                              MOVE PC-TSYMSG-00004                CNKCS208
038600                                         TO DP020-MSG-NUMBER      CNKCS208
038700                              SET DP020-MSG-INFORMATIONAL         CNKCS208
038800                                         TO TRUE                  CNKCS208
038900                          END-IF                                  CNKCS208
039000                      END-IF                                      CNKCS208
039100                  END-IF                                          CNKCS208
039200              END-IF                                              CNKCS208
039300                                                                  CNKCS208
039400         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS208
039500             PERFORM 2000-PROCESS-PANEL                           CNKCS208
039600                                                                  CNKCS208
039700         WHEN DP020-NEXT-ACT-RETURN                               CNKCS208
039800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS208
039900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS208
040000                                                                  CNKCS208
040100         WHEN OTHER                                               CNKCS208
040200             SET DP013-LOGIC-ABEND TO TRUE                        CNKCS208
040300             SET DP013-NO-ROLLBACK TO TRUE                        CNKCS208
040400             MOVE '1000-CONTROL-PROCESSING'                       CNKCS208
040500                                   TO DP013-PARAGRAPH             CNKCS208
040600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   CNKCS208
040700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
040800             MOVE DP020-NEXT-APPL-ACTIVITY                        CNKCS208
040900                                   TO DP013-MESSAGE-TEXT(2)       CNKCS208
041000             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS208
041100     END-EVALUATE.                                                CNKCS208
041200                                                                  CNKCS208
041300/                                                                 CNKCS208
041400*----------------------------------------------------------------*CNKCS208
041500*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *CNKCS208
041600*  INTER-APPLICATION FORMAT CODE.                                *CNKCS208
041700*----------------------------------------------------------------*CNKCS208
041800 1100-FIND-OBJECT-KEYS.                                           CNKCS208
041900                                                                  CNKCS208
042000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            CNKCS208
042100                                                                  CNKCS208
042200     MOVE DP020-INT-APPL-FORMAT-IND                               CNKCS208
042300                                   TO ASC-INT-APPL-FORMAT-IND.    CNKCS208
042400                                                                  CNKCS208
042500     EVALUATE DP020-INT-APPL-FORMAT-IND                           CNKCS208
042600         WHEN PC-INTER-APPL-CRIT-SPEC                             CNKCS208
042700             MOVE CN001-OPER-UNT-ID TO ASC-OPER-UNT-ID            CNKCS208
042800             MOVE CN001-FCLTY-ID    TO ASC-FCLTY-ID               CNKCS208
042900             SET ASC-ADD-PENDING   TO TRUE                        CNKCS208
043000                                                                  CNKCS208
043100         WHEN PC-INTER-APPL-ADD                                   CNKCS208
043200             IF  CN003-NUMBER-OF-SELECTED-ITEMS > ZERO            CNKCS208
043300                 MOVE PC-TSYMSG-00112                             CNKCS208
043400                                   TO DP020-MSG-NUMBER            CNKCS208
043500                 SET DP020-MSG-WARNING                            CNKCS208
043600                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS208
043700                     PS-ERROR      TO TRUE                        CNKCS208
043800             ELSE                                                 CNKCS208
043900                 SET ASC-ADD-PENDING                              CNKCS208
044000                                   TO TRUE                        CNKCS208
044100                 MOVE CN003-OPER-UNT-ID                           CNKCS208
044200                                   TO ASC-OPER-UNT-ID             CNKCS208
044300                 MOVE CN003-FCLTY-ID                              CNKCS208
044400                                   TO ASC-FCLTY-ID                CNKCS208
044500             END-IF                                               CNKCS208
044600                                                                  CNKCS208
044700         WHEN PC-INTER-APPL-UPDATE                                CNKCS208
044800             IF  CN003-NUMBER-OF-SELECTED-ITEMS = ZERO            CNKCS208
044900                 MOVE PC-TSYMSG-00057                             CNKCS208
045000                                   TO DP020-MSG-NUMBER            CNKCS208
045100                 SET DP020-MSG-WARNING                            CNKCS208
045200                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS208
045300                     PS-ERROR      TO TRUE                        CNKCS208
045400             ELSE                                                 CNKCS208
045500                 SET ASC-UPDATE-PENDING                           CNKCS208
045600                                       TO TRUE                    CNKCS208
045700                 SET ASC-USE-SELECTION-QUEUE                      CNKCS208
045800                                       TO TRUE                    CNKCS208
045900                 MOVE CN003-NUMBER-OF-SELECTED-ITEMS              CNKCS208
046000                                   TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS208
046100                 MOVE CN003-NUMBER-OF-TS-ITEMS                    CNKCS208
046200                                       TO ASC-NUMBER-OF-TS-ITEMS  CNKCS208
046300                 MOVE CN003-SEL-QUEUE-NAME                        CNKCS208
046400                                       TO ASC-SEL-QUEUE-NAME      CNKCS208
046500                 PERFORM 1120-PREPARE-LIST-ENTRY                  CNKCS208
046600             END-IF                                               CNKCS208
046700                                                                  CNKCS208
046800         WHEN PC-INTER-APPL-DELETE                                CNKCS208
046900             IF  CN003-NUMBER-OF-SELECTED-ITEMS = ZERO            CNKCS208
047000                 MOVE PC-TSYMSG-00057                             CNKCS208
047100                                   TO DP020-MSG-NUMBER            CNKCS208
047200                 SET DP020-MSG-WARNING                            CNKCS208
047300                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS208
047400                     PS-ERROR      TO TRUE                        CNKCS208
047500             ELSE                                                 CNKCS208
047600             IF  CN003-NUMBER-OF-SELECTED-ITEMS > 1               CNKCS208
047700                 MOVE PC-TSYMSG-00047                             CNKCS208
047800                                   TO DP020-MSG-NUMBER            CNKCS208
047900                 SET DP020-MSG-WARNING                            CNKCS208
048000                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS208
048100                     PS-ERROR      TO TRUE                        CNKCS208
048200             ELSE                                                 CNKCS208
048300                 SET ASC-DELETE-PENDING                           CNKCS208
048400                                       TO TRUE                    CNKCS208
048500                 SET ASC-USE-SELECTION-QUEUE                      CNKCS208
048600                                       TO TRUE                    CNKCS208
048700                 MOVE CN003-NUMBER-OF-SELECTED-ITEMS              CNKCS208
048800                                   TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS208
048900                 MOVE CN003-NUMBER-OF-TS-ITEMS                    CNKCS208
049000                                       TO ASC-NUMBER-OF-TS-ITEMS  CNKCS208
049100                 MOVE CN003-SEL-QUEUE-NAME                        CNKCS208
049200                                       TO ASC-SEL-QUEUE-NAME      CNKCS208
049300                 PERFORM 1120-PREPARE-LIST-ENTRY                  CNKCS208
049400             END-IF                                               CNKCS208
049500             END-IF                                               CNKCS208
049600                                                                  CNKCS208
049700         WHEN OTHER                                               CNKCS208
049800             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            CNKCS208
049900             SET DP020-MSG-FATAL                                  CNKCS208
050000                 DP020-NEXT-ACT-APPL-ERROR                        CNKCS208
050100                 PS-ERROR          TO TRUE                        CNKCS208
050200     END-EVALUATE.                                                CNKCS208
050300                                                                  CNKCS208
050400/                                                                 CNKCS208
050500*----------------------------------------------------------------*CNKCS208
050600* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *CNKCS208
050700* STORAGE QUEUE PASSED FROM THE LIST.                            *CNKCS208
050800*----------------------------------------------------------------*CNKCS208
050900 1120-PREPARE-LIST-ENTRY.                                         CNKCS208
051000                                                                  CNKCS208
051100     MOVE CN005-MAX-ITEMS          TO ASC-SEL-SUB.                CNKCS208
051200     MOVE ZERO                     TO ASC-SEL-ITEM.               CNKCS208
051300     PERFORM 2110-GET-NEXT-RECORD.                                CNKCS208
051400                                                                  CNKCS208
051500/                                                                 CNKCS208
051600*----------------------------------------------------------------*CNKCS208
051700* INITIALIZE SCREEN FIELDS FOR AN ADD                            *CNKCS208
051800*----------------------------------------------------------------*CNKCS208
051900 1200-INIT-ADD-SCREEN.                                            CNKCS208
052000                                                                  CNKCS208
052100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       CNKCS208
052200                                                                  CNKCS208
052300     MOVE -1                       TO ADEPTL.                     CNKCS208
052400                                                                  CNKCS208
052500     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
052600     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
052700     PERFORM 4200-GET-STORE-INFORMATION.                          CNKCS208
053000                                                                  CNKCS208
053100     INITIALIZE ASC-DEPT-NBR                                      CNKCS208
053200                ASC-CL-NBR                                        CNKCS208
053300                ASC-TYPE                                          CNKCS208
053400                ASC-AREA-ID                                       CNKCS208
053500                ASC-RANK                                          CNKCS208
053600                ASC-DESC                                          CNKCS208
053700                ASC-OPER-SET-ID                                   CNKCS208
053800                ASC-OPER-SET-DESC.                                CNKCS208
053900                                                                  CNKCS208
054000     MOVE 1                        TO ASC-RANK-N                  CNKCS208
054100                                      ASC-OPER-SET-ID-N.          CNKCS208
054200     MOVE +1                       TO ARANKL.                     CNKCS208
054300                                                                  CNKCS208
054400/                                                                 CNKCS208
054500*----------------------------------------------------------------*CNKCS208
054600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *CNKCS208
054700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *CNKCS208
054800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *CNKCS208
054900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *CNKCS208
055000* FUNCTION KEYS CAN GET THIS FAR.                                *CNKCS208
055100*----------------------------------------------------------------*CNKCS208
055200                                                                  CNKCS208
055300 2000-PROCESS-PANEL.                                              CNKCS208
055400                                                                  CNKCS208
055500     EVALUATE TRUE                                                CNKCS208
055600         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS208
055700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS208
055800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS208
055900                                                                  CNKCS208
056000         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS208
056100* IF FACILITY CHANGES, REFRESH FACILITY DESCRIPTION               CNKCS208
056200             IF  ALOCL > ZERO                                     CNKCS208
056300             AND ALOCI NOT = ASC-AREA-ID                          CNKCS208
056400                 MOVE ASC-OPER-UNT-ID TO DK-OPER-UNT-ID           CNKCS208
056500                 MOVE ASC-FCLTY-ID    TO DK-FCLTY-ID              CNKCS208
056600                 MOVE ALOCI        TO ASC-AREA-ID                 CNKCS208
056700                                      DK-AREA-ID                  CNKCS208
056800                 PERFORM 4300-SELECT-TFLAREA                      CNKCS208
056900                 MOVE FLAREA-FCLTY-AREA-DESC                      CNKCS208
057000                                   TO ASC-DESC                    CNKCS208
057100                                      ADESCO                      CNKCS208
057200             END-IF                                               CNKCS208
057300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS208
057400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS208
057500                                                                  CNKCS208
057600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    CNKCS208
057700             IF (ASC-ADD-PENDING                                  CNKCS208
057800             AND ASC-ADD-NOT-SUCCESSFUL)                          CNKCS208
057900                 PERFORM 1200-INIT-ADD-SCREEN                     CNKCS208
058000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             CNKCS208
058100                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS208
058200             ELSE                                                 CNKCS208
058300                 SET DP030-DONT-ERASE                             CNKCS208
058400                     DP030-SEND-DATAONLY (PC-APPL-MAP)            CNKCS208
058500                                   TO TRUE                        CNKCS208
058600                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS208
058700                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS208
058800             END-IF                                               CNKCS208
058900                                                                  CNKCS208
059000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             CNKCS208
059100             IF  ASC-USE-SELECTION-QUEUE                          CNKCS208
059200                 PERFORM 2110-GET-NEXT-RECORD                     CNKCS208
059300                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS208
059400                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS208
059500             ELSE                                                 CNKCS208
059600*                --- BOTTOM OF LIST ---                           CNKCS208
059700                 MOVE PC-TSYMSG-00070                             CNKCS208
059800                                   TO DP020-MSG-NUMBER            CNKCS208
059900                 SET DP020-MSG-INFORMATIONAL                      CNKCS208
060000                                   TO TRUE                        CNKCS208
060100             END-IF                                               CNKCS208
060200                                                                  CNKCS208
060300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             CNKCS208
060400             IF  ASC-USE-SELECTION-QUEUE                          CNKCS208
060500                 PERFORM 2120-GET-PREV-RECORD                     CNKCS208
060600                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS208
060700                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS208
060800             ELSE                                                 CNKCS208
060900*                --- TOP OF LIST ---                              CNKCS208
061000                 MOVE PC-TSYMSG-00069                             CNKCS208
061100                                   TO DP020-MSG-NUMBER            CNKCS208
061200                 SET DP020-MSG-INFORMATIONAL                      CNKCS208
061300                                   TO TRUE                        CNKCS208
061400             END-IF                                               CNKCS208
061500                                                                  CNKCS208
061600         WHEN OTHER                                               CNKCS208
061700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS208
061800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS208
061900             IF  PS-NO-ERROR                                      CNKCS208
062000                 SET DP030-CONTINUE-GO                            CNKCS208
062100                                   TO TRUE                        CNKCS208
062200                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS208
062300             ELSE                                                 CNKCS208
062400                 SET DP030-OVERRIDE-GO                            CNKCS208
062500                                   TO TRUE                        CNKCS208
062600             END-IF                                               CNKCS208
062700     END-EVALUATE.                                                CNKCS208
062800                                                                  CNKCS208
062900/                                                                 CNKCS208
063000*----------------------------------------------------------------*CNKCS208
063100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*CNKCS208
063200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *CNKCS208
063300* CICS ARCHITECTURE API.                                         *CNKCS208
063400*----------------------------------------------------------------*CNKCS208
063500 2100-CHECK-FUNCTION-KEY.                                         CNKCS208
063600                                                                  CNKCS208
063700     EVALUATE TRUE                                                CNKCS208
063800         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS208
063900             CONTINUE                                             CNKCS208
064000                                                                  CNKCS208
064100         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    CNKCS208
064200             IF  ASC-DELETE-PENDING                               CNKCS208
064300             AND ASC-DELETE-SUCCESSFUL                            CNKCS208
064400                 MOVE PC-TSYMSG-00116                             CNKCS208
064500                                   TO DP020-MSG-NUMBER            CNKCS208
064600                 SET DP020-MSG-FATAL                              CNKCS208
064700                     PS-ERROR      TO TRUE                        CNKCS208
064800                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS208
064900             ELSE                                                 CNKCS208
065000                 IF  ASC-DELETE-PENDING                           CNKCS208
065100                     SET DP030-CONTINUE-GO                        CNKCS208
065200                                   TO TRUE                        CNKCS208
065300                     PERFORM 7000-DELETE-ASSIGNMENT               CNKCS208
065400                 ELSE                                             CNKCS208
065500                     IF  ASC-ASSIGN-ALL                           CNKCS208
065600                         SET DP030-CONTINUE-GO                    CNKCS208
065700                                   TO TRUE                        CNKCS208
065800                         PERFORM 8000-ASSIGN-ALL                  CNKCS208
065900                     END-IF                                       CNKCS208
066000                 END-IF                                           CNKCS208
066100             END-IF                                               CNKCS208
066200                                                                  CNKCS208
066300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              CNKCS208
066400             SET DP030-CONTINUE-GO TO TRUE                        CNKCS208
066500             PERFORM 5000-ADD-ASSIGNMENT                          CNKCS208
066600                                                                  CNKCS208
066700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              CNKCS208
066800             SET DP030-CONTINUE-GO TO TRUE                        CNKCS208
066900             PERFORM 6000-UPDATE-ASSIGNMENT                       CNKCS208
067000                                                                  CNKCS208
067100         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              CNKCS208
067200             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            CNKCS208
067300             SET DP020-MSG-INFORMATIONAL                          CNKCS208
067400                 ASC-ASSIGN-ALL    TO TRUE                        CNKCS208
067500             PERFORM 3200-RESET-ATTRIBUTES                        CNKCS208
067600                                                                  CNKCS208
067700         WHEN OTHER                                               CNKCS208
067800             SET DP013-NO-ROLLBACK                                CNKCS208
067900                 DP013-XCTL-DISPLAY-RESTART                       CNKCS208
068000                 DP013-CICS-ABEND  TO TRUE                        CNKCS208
068100             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS208
068200                                   TO DP013-PARAGRAPH             CNKCS208
068300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS208
068400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
068500             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS208
068600     END-EVALUATE.                                                CNKCS208
068700                                                                  CNKCS208
068800/                                                                 CNKCS208
068900 2110-GET-NEXT-RECORD.                                            CNKCS208
069000                                                                  CNKCS208
069100     ADD +1                        TO ASC-SEL-SUB.                CNKCS208
069200     IF  ASC-SEL-SUB > CN005-MAX-ITEMS                            CNKCS208
069300         ADD +1                    TO ASC-SEL-ITEM                CNKCS208
069400         MOVE +1                   TO ASC-SEL-SUB                 CNKCS208
069500     END-IF.                                                      CNKCS208
069600                                                                  CNKCS208
069700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                CNKCS208
069800         PERFORM 9100-READ-SEL-QUEUE                              CNKCS208
069900         IF  CN005-ITEM (ASC-SEL-SUB) > ZERO                      CNKCS208
070000             MOVE CN005-OPER-UNT-ID (ASC-SEL-SUB)                 CNKCS208
070100                                   TO ASC-OPER-UNT-ID             CNKCS208
070200             MOVE CN005-FCLTY-ID (ASC-SEL-SUB)                    CNKCS208
070300                                   TO ASC-FCLTY-ID                CNKCS208
070400             MOVE CN005-DEPT-NBR (ASC-SEL-SUB)                    CNKCS208
070500                                   TO ASC-DEPT-NBR                CNKCS208
070600             MOVE CN005-CL-NBR (ASC-SEL-SUB)                      CNKCS208
070700                                   TO ASC-CL-NBR                  CNKCS208
070800             MOVE CN005-TYPE  (ASC-SEL-SUB)                       CNKCS208
070900                                   TO ASC-TYPE                    CNKCS208
071000             MOVE CN005-RANK (ASC-SEL-SUB)                        CNKCS208
071100                                   TO ASC-RANK-N                  CNKCS208
071200             SET CN005-INQ (ASC-SEL-SUB)                          CNKCS208
071300                                   TO TRUE                        CNKCS208
071400             PERFORM 9200-REWRITE-LIST-QUEUE                      CNKCS208
071500         ELSE                                                     CNKCS208
071600             SUBTRACT +1 FROM ASC-SEL-SUB                         CNKCS208
071700*            --- BOTTOM OF LIST ---                               CNKCS208
071800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            CNKCS208
071900             SET DP020-MSG-INFORMATIONAL                          CNKCS208
072000                                   TO TRUE                        CNKCS208
072100         END-IF                                                   CNKCS208
072200     ELSE                                                         CNKCS208
072300         SUBTRACT +1 FROM ASC-SEL-ITEM                            CNKCS208
072400         MOVE CN005-MAX-ITEMS      TO ASC-SEL-SUB                 CNKCS208
072500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            CNKCS208
072600         SET DP020-MSG-INFORMATIONAL                              CNKCS208
072700                                   TO TRUE                        CNKCS208
072800     END-IF.                                                      CNKCS208
072900                                                                  CNKCS208
073000/                                                                 CNKCS208
073100 2120-GET-PREV-RECORD.                                            CNKCS208
073200                                                                  CNKCS208
073300     SUBTRACT +1 FROM ASC-SEL-SUB.                                CNKCS208
073400     IF  ASC-SEL-SUB < +1                                         CNKCS208
073500         SUBTRACT +1 FROM ASC-SEL-ITEM                            CNKCS208
073600         MOVE CN005-MAX-ITEMS      TO ASC-SEL-SUB                 CNKCS208
073700     END-IF.                                                      CNKCS208
073800                                                                  CNKCS208
073900     IF  ASC-SEL-ITEM > ZERO                                      CNKCS208
074000         PERFORM 9100-READ-SEL-QUEUE                              CNKCS208
074100         MOVE CN005-OPER-UNT-ID (ASC-SEL-SUB)                     CNKCS208
074200                                   TO ASC-OPER-UNT-ID             CNKCS208
074300         MOVE CN005-FCLTY-ID (ASC-SEL-SUB)                        CNKCS208
074400                                   TO ASC-FCLTY-ID                CNKCS208
074500         MOVE CN005-DEPT-NBR (ASC-SEL-SUB)                        CNKCS208
074600                                   TO ASC-DEPT-NBR                CNKCS208
074700         MOVE CN005-CL-NBR (ASC-SEL-SUB)                          CNKCS208
074800                                   TO ASC-CL-NBR                  CNKCS208
074900         MOVE CN005-RANK (ASC-SEL-SUB)                            CNKCS208
075000                                   TO ASC-RANK-N                  CNKCS208
075100         MOVE CN005-TYPE (ASC-SEL-SUB)                            CNKCS208
075200                                   TO ASC-TYPE                    CNKCS208
075300     ELSE                                                         CNKCS208
075400         MOVE +1                   TO ASC-SEL-ITEM                CNKCS208
075500                                      ASC-SEL-SUB                 CNKCS208
075600*        --- TOP OF LIST ---                                      CNKCS208
075700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            CNKCS208
075800         SET DP020-MSG-INFORMATIONAL                              CNKCS208
075900                                   TO TRUE                        CNKCS208
076000     END-IF.                                                      CNKCS208
076100                                                                  CNKCS208
076200/                                                                 CNKCS208
076300*----------------------------------------------------------------*CNKCS208
076400*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *CNKCS208
076500*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *CNKCS208
076600*----------------------------------------------------------------*CNKCS208
076700 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS208
076800                                                                  CNKCS208
076900     IF  ADEPTL > ZERO                                            CNKCS208
077000         MOVE ADEPTI               TO ASC-DEPT-NBR                CNKCS208
077100     ELSE                                                         CNKCS208
077200         IF  ADEPTF = DP015-ERASE-EOF                             CNKCS208
077300             MOVE SPACES           TO ASC-DEPT-NBR                CNKCS208
077400         END-IF                                                   CNKCS208
077500     END-IF.                                                      CNKCS208
077600                                                                  CNKCS208
077700     IF  ACLASL > ZERO                                            CNKCS208
077800         MOVE ACLASI               TO ASC-CL-NBR                  CNKCS208
077900     ELSE                                                         CNKCS208
078000         IF  ACLASF = DP015-ERASE-EOF                             CNKCS208
078100             MOVE SPACES           TO ASC-CL-NBR                  CNKCS208
078200         END-IF                                                   CNKCS208
078300     END-IF.                                                      CNKCS208
078400                                                                  CNKCS208
078500     IF  ATYPEL > ZERO                                            CNKCS208
078600         MOVE ATYPEI               TO ASC-TYPE                    CNKCS208
078700     ELSE                                                         CNKCS208
078800         IF  ATYPEF = DP015-ERASE-EOF                             CNKCS208
078900             MOVE SPACES           TO ASC-TYPE                    CNKCS208
079000         END-IF                                                   CNKCS208
079100     END-IF.                                                      CNKCS208
079200                                                                  CNKCS208
079300     IF  ALOCL > ZERO                                             CNKCS208
079400         MOVE ALOCI                TO ASC-AREA-ID                 CNKCS208
079500         SET PS-FCLTY-AREA-CHGD    TO TRUE                        CNKCS208
079600     ELSE                                                         CNKCS208
079700         IF  ALOCF = DP015-ERASE-EOF                              CNKCS208
079800             MOVE SPACES           TO ASC-AREA-ID                 CNKCS208
079900             SET PS-FCLTY-AREA-CHGD                               CNKCS208
080000                                   TO TRUE                        CNKCS208
080100         END-IF                                                   CNKCS208
080200     END-IF.                                                      CNKCS208
080300                                                                  CNKCS208
080400     IF  ARANKL > ZERO                                            CNKCS208
080500         MOVE ARANKI               TO ASC-RANK                    CNKCS208
080600     ELSE                                                         CNKCS208
080700         IF  ARANKF = DP015-ERASE-EOF                             CNKCS208
080800             MOVE SPACES           TO ASC-RANK                    CNKCS208
080900         END-IF                                                   CNKCS208
081000     END-IF.                                                      CNKCS208
081100                                                                  CNKCS208
081200     IF  AOPSETL > ZERO                                           CNKCS208
081300         MOVE AOPSETI              TO ASC-OPER-SET-ID             CNKCS208
081400     ELSE                                                         CNKCS208
081500         IF  AOPSETF = DP015-ERASE-EOF                            CNKCS208
081600             MOVE SPACES           TO ASC-OPER-SET-ID             CNKCS208
081700         END-IF                                                   CNKCS208
081800     END-IF.                                                      CNKCS208
081900                                                                  CNKCS208
082000/                                                                 CNKCS208
082100*----------------------------------------------------------------*CNKCS208
082200*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *CNKCS208
082300*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *CNKCS208
082400*----------------------------------------------------------------*CNKCS208
082500 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS208
082600                                                                  CNKCS208
082700     PERFORM 3200-RESET-ATTRIBUTES.                               CNKCS208
082800                                                                  CNKCS208
082900     IF  ASC-OPER-SET-ID > (SPACES OR ZEROES)                     CNKCS208
083000         MOVE ASC-OPER-SET-ID    TO DP010I-UNEDITED-FIELD         CNKCS208
083100         MOVE LENGTH OF ASC-OPER-SET-ID                           CNKCS208
083200                                 TO DP010I-MAXIMUM-DIGITS         CNKCS208
083300         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       CNKCS208
083400         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS208
083500                                 TO TRUE                          CNKCS208
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
083700         IF  DP010I-ERROR-DETECTED                                CNKCS208
083800             SET PS-ERROR                                         CNKCS208
083900                 DP020-MSG-FATAL TO TRUE                          CNKCS208
084000             MOVE PC-TSYMSG-00008                                 CNKCS208
084100                                 TO DP020-MSG-NUMBER              CNKCS208
084200             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS208
084300                                 TO AOPSETA                       CNKCS208
084400             MOVE DP015-RED      TO AOPSETC                       CNKCS208
084500             MOVE DP015-REVERSE  TO AOPSETH                       CNKCS208
084600             MOVE -1             TO AOPSETL                       CNKCS208
084700             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
084800                                 TO TRUE                          CNKCS208
084900         ELSE                                                     CNKCS208
085000             MOVE DP010I-NUMERIC-FIELD                            CNKCS208
085100                                 TO ASC-OPER-SET-ID-N             CNKCS208
085200                                    DK-OPER-SET-ID                CNKCS208
085300             MOVE ASC-OPER-SET-ID                                 CNKCS208
085400                                 TO AOPSETO                       CNKCS208
085500             PERFORM 3030-VALIDATE-OPER-SET-ID                    CNKCS208
085600             IF  SQLCODE = +100                                   CNKCS208
085700                 SET PS-ERROR                                     CNKCS208
085800                     DP020-MSG-FATAL     TO TRUE                  CNKCS208
085900                 MOVE SPACES             TO ASC-OPER-SET-DESC        CL**4
086000                                            AOPSDESO                 CL**4
086100                 MOVE PC-TSYMSG-00987    TO DP020-MSG-NUMBER         CL**6
086200                 MOVE DP015-UNP-ALP-BRT-OFF                       CNKCS208
086300                                         TO AOPSETA               CNKCS208
086400                 MOVE DP015-RED          TO AOPSETC               CNKCS208
086500                 MOVE DP015-REVERSE      TO AOPSETH               CNKCS208
086600                 MOVE -1                 TO AOPSETL               CNKCS208
086700                 SET DP030-SET-CURSOR-APPL-1                      CNKCS208
086800                                         TO TRUE                  CNKCS208
086900             ELSE                                                 CNKCS208
087000                 MOVE OPRSET-OPER-SET-DESC                        CNKCS208
087100                                         TO ASC-OPER-SET-DESC     CNKCS208
087200                                            AOPSDESO              CNKCS208
087300             END-IF                                               CNKCS208
087400         END-IF                                                      CL**4
087500     ELSE                                                            CL**4
087600         MOVE SPACES                     TO ASC-OPER-SET-DESC        CL**4
087700                                            AOPSDESO                 CL**4
087800     END-IF.                                                      CNKCS208
087900                                                                  CNKCS208
088000     IF  ASC-RANK = SPACES                                        CNKCS208
088100         SET PS-ERROR              TO TRUE                        CNKCS208
088200         SET DP020-MSG-FATAL       TO TRUE                        CNKCS208
088300         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS208
088400         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS208
088500                                   TO ARANKA                      CNKCS208
088600         MOVE DP015-RED            TO ARANKC                      CNKCS208
088700         MOVE DP015-REVERSE        TO ARANKH                      CNKCS208
088800         MOVE -1                   TO ARANKL                      CNKCS208
088900         SET DP030-SET-CURSOR-APPL-1                              CNKCS208
089000                                   TO TRUE                        CNKCS208
089100     END-IF.                                                      CNKCS208
089200                                                                  CNKCS208
089300     IF  ASC-ADD-PENDING                                          CNKCS208
089400         IF  ASC-AREA-ID = SPACES                                 CNKCS208
089500             SET PS-ERROR              TO TRUE                    CNKCS208
089600             SET DP020-MSG-FATAL       TO TRUE                    CNKCS208
089700             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        CNKCS208
089800             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS208
089900                                       TO ALOCA                   CNKCS208
090000             MOVE DP015-RED            TO ALOCC                   CNKCS208
090100             MOVE DP015-REVERSE        TO ALOCH                   CNKCS208
090200             MOVE -1                   TO ALOCL                   CNKCS208
090300             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
090400                                       TO TRUE                    CNKCS208
090500         END-IF                                                   CNKCS208
090600     END-IF.                                                      CNKCS208
090700                                                                  CNKCS208
090800     IF  ASC-CL-NBR = SPACES                                      CNKCS208
090900         SET PS-ERROR              TO TRUE                        CNKCS208
091000         SET DP020-MSG-FATAL       TO TRUE                        CNKCS208
091100         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS208
091200         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS208
091300                                   TO ACLASA                      CNKCS208
091400         MOVE DP015-RED            TO ACLASC                      CNKCS208
091500         MOVE DP015-REVERSE        TO ACLASH                      CNKCS208
091600         MOVE -1                   TO ACLASL                      CNKCS208
091700         SET DP030-SET-CURSOR-APPL-1                              CNKCS208
091800                                   TO TRUE                        CNKCS208
091900     END-IF.                                                      CNKCS208
092000                                                                  CNKCS208
092100     IF  ASC-DEPT-NBR = SPACES                                    CNKCS208
092200         SET PS-ERROR              TO TRUE                        CNKCS208
092300         SET DP020-MSG-FATAL       TO TRUE                        CNKCS208
092400         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS208
092500         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS208
092600                                   TO ADEPTA                      CNKCS208
092700         MOVE DP015-RED            TO ADEPTC                      CNKCS208
092800         MOVE DP015-REVERSE        TO ADEPTH                      CNKCS208
092900         MOVE -1                   TO ADEPTL                      CNKCS208
093000         SET DP030-SET-CURSOR-APPL-1                              CNKCS208
093100                                   TO TRUE                        CNKCS208
093200     END-IF.                                                      CNKCS208
093300                                                                  CNKCS208
093400     IF  ASC-RANK > SPACES                                        CNKCS208
093500         MOVE ASC-RANK             TO DP010I-UNEDITED-FIELD       CNKCS208
093600         MOVE LENGTH OF ASC-RANK   TO DP010I-MAXIMUM-DIGITS       CNKCS208
093700         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     CNKCS208
093800         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS208
093900                                   TO TRUE                        CNKCS208
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
094100         IF  DP010I-ERROR-DETECTED                                CNKCS208
094200             SET PS-ERROR                                         CNKCS208
094300                 DP020-MSG-FATAL   TO TRUE                        CNKCS208
094400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            CNKCS208
094500             MOVE DP015-UNP-NUM-BRT-OFF                           CNKCS208
094600                                   TO ARANKA                      CNKCS208
094700             MOVE DP015-RED        TO ARANKC                      CNKCS208
094800             MOVE DP015-REVERSE    TO ARANKH                      CNKCS208
094900             MOVE -1               TO ARANKL                      CNKCS208
095000             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
095100                                   TO TRUE                        CNKCS208
095200         ELSE                                                     CNKCS208
095300             MOVE DP010I-NUMERIC-FIELD                            CNKCS208
095400                                   TO ASC-RANK-N                  CNKCS208
095500             MOVE ASC-RANK         TO ARANKO                      CNKCS208
095600         END-IF                                                   CNKCS208
095700     END-IF.                                                      CNKCS208
095800                                                                  CNKCS208
095900     IF  ASC-AREA-ID > SPACES                                     CNKCS208
096000         MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID              CNKCS208
096100         MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID                 CNKCS208
096200         MOVE ASC-AREA-ID          TO DK-AREA-ID                  CNKCS208
096300         MOVE ASC-TYPE             TO DK-TYPE                     CNKCS208
096400         PERFORM 3010-SELECT-TFLAREA                              CNKCS208
096500         IF  SQLCODE = +100                                       CNKCS208
096600             SET PS-ERROR          TO TRUE                        CNKCS208
096700             SET DP020-MSG-FATAL   TO TRUE                        CNKCS208
096800             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            CNKCS208
096900             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS208
097000                                   TO ALOCA                       CNKCS208
097100             MOVE DP015-RED        TO ALOCC                       CNKCS208
097200             MOVE DP015-REVERSE    TO ALOCH                       CNKCS208
097300             MOVE -1               TO ALOCL                       CNKCS208
097400             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
097500                                   TO TRUE                        CNKCS208
097600         ELSE                                                     CNKCS208
097700             IF  FLAREA-DEPT-CL-IND = 'N'                         CNKCS208
097800                 SET PS-ERROR      TO TRUE                        CNKCS208
097900                 SET DP020-MSG-FATAL                              CNKCS208
098000                                   TO TRUE                        CNKCS208
098100                 MOVE PC-TSYMSG-00387                             CNKCS208
098200                                   TO DP020-MSG-NUMBER            CNKCS208
098300                 MOVE DP015-UNP-ALP-BRT-OFF                       CNKCS208
098400                                   TO ALOCA                       CNKCS208
098500                 MOVE DP015-RED    TO ALOCC                       CNKCS208
098600                 MOVE DP015-REVERSE TO ALOCH                      CNKCS208
098700                 MOVE -1           TO ALOCL                       CNKCS208
098800                 SET DP030-SET-CURSOR-APPL-1                      CNKCS208
098900                                   TO TRUE                        CNKCS208
099000             END-IF                                               CNKCS208
099100         END-IF                                                   CNKCS208
099200     END-IF.                                                      CNKCS208
099300                                                                  CNKCS208
099400*  CHECK TO SEE IF THIS LOCATION IS ALREADY ASSIGNED TO THE       CNKCS208
099500*  SAME DEPT/CLASS WITH A DIFFERENT RANKING                       CNKCS208
099600                                                                  CNKCS208
099700     IF  ASC-DELETE-PENDING                                       CNKCS208
099800         CONTINUE                                                 CNKCS208
099900     ELSE                                                         CNKCS208
100000         IF (PS-NO-ERROR) AND (ASC-AREA-ID > SPACES) AND          CNKCS208
100100            (PS-FCLTY-AREA-CHGD)                                  CNKCS208
100200             INITIALIZE PV-DB2-COUNT                              CNKCS208
100300             MOVE ASC-OPER-UNT-ID  TO DK-OPER-UNT-ID              CNKCS208
100400             MOVE ASC-FCLTY-ID     TO DK-FCLTY-ID                 CNKCS208
100500             MOVE ASC-DEPT-NBR     TO DK-DEPT-NBR                 CNKCS208
100600             MOVE ASC-CL-NBR       TO DK-CL-NBR                   CNKCS208
100700             MOVE ASC-AREA-ID      TO DK-AREA-ID                  CNKCS208
100800             PERFORM 3020-COUNT-TDCFAAS                           CNKCS208
100900             IF  PV-DB2-COUNT > +0                                CNKCS208
101000                 SET PS-ERROR         TO TRUE                     CNKCS208
101100                 SET DP020-MSG-FATAL  TO TRUE                     CNKCS208
101200                 MOVE PC-TSYMSG-00476 TO DP020-MSG-NUMBER         CNKCS208
101300                 MOVE DP015-UNP-ALP-BRT-OFF                       CNKCS208
101400                                      TO ALOCA                    CNKCS208
101500                 MOVE DP015-RED       TO ALOCC                    CNKCS208
101600                 MOVE DP015-REVERSE   TO ALOCH                    CNKCS208
101700                 MOVE -1              TO ALOCL                    CNKCS208
101800                 SET DP030-SET-CURSOR-APPL-1                      CNKCS208
101900                                      TO TRUE                     CNKCS208
102000             END-IF                                               CNKCS208
102100         END-IF                                                   CNKCS208
102200     END-IF.                                                      CNKCS208
102300                                                                  CNKCS208
102400     IF  ASC-ADD-PENDING                                          CNKCS208
102500         INITIALIZE PV-DB2-COUNT                                  CNKCS208
102600         MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID              CNKCS208
102700         MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID                 CNKCS208
102800         MOVE ASC-DEPT-NBR         TO DK-DEPT-NBR                 CNKCS208
102900         MOVE ASC-CL-NBR           TO DK-CL-NBR                   CNKCS208
103000         PERFORM 7100-COUNT-TDCFAAS                               CNKCS208
103100         IF  PV-DB2-COUNT = +0                                    CNKCS208
103200             SET PS-ERROR          TO TRUE                        CNKCS208
103300             SET DP020-MSG-FATAL   TO TRUE                        CNKCS208
103400             MOVE PC-TSYMSG-00110  TO DP020-MSG-NUMBER            CNKCS208
103500             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS208
103600                                   TO ADEPTA                      CNKCS208
103700                                      ACLASA                      CNKCS208
103800             MOVE DP015-RED        TO ADEPTC                      CNKCS208
103900                                      ACLASC                      CNKCS208
104000             MOVE DP015-REVERSE    TO ADEPTH                      CNKCS208
104100                                      ACLASH                      CNKCS208
104200             MOVE -1               TO ADEPTL                      CNKCS208
104300             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
104400                                   TO TRUE                        CNKCS208
104500         END-IF                                                   CNKCS208
104600     END-IF.                                                      CNKCS208
104700                                                                  CNKCS208
104800     IF  PS-NO-ERROR                                              CNKCS208
104900         EVALUATE TRUE                                            CNKCS208
105000             WHEN ASC-ADD-PENDING                                 CNKCS208
105100                 MOVE -1           TO ADEPTL                      CNKCS208
105200                 SET DP030-SET-CURSOR-APPL-1                      CNKCS208
105300                                   TO TRUE                        CNKCS208
105400             WHEN ASC-UPDATE-PENDING                              CNKCS208
105500                 MOVE -1           TO AOPSETL                     CNKCS208
105600                 SET DP030-SET-CURSOR-APPL-1                      CNKCS208
105700                                   TO TRUE                        CNKCS208
105800             WHEN ASC-DELETE-PENDING                              CNKCS208
105900                 SET DP030-SET-CURSOR-TRAILER                     CNKCS208
106000                                   TO TRUE                        CNKCS208
106100         END-EVALUATE                                             CNKCS208
106200     END-IF.                                                      CNKCS208
106300                                                                  CNKCS208
106400/                                                                 CNKCS208
106500*----------------------------------------------------------------*CNKCS208
106600*    VALIDATE THE FACILITY LOCATION ENTERED                      *CNKCS208
106700*----------------------------------------------------------------*CNKCS208
106800                                                                  CNKCS208
106900 3010-SELECT-TFLAREA.                                             CNKCS208
107000                                                                  CNKCS208
107100     PERFORM                                                      CNKCS208
107200         WITH TEST AFTER                                          CNKCS208
107300         VARYING PV-RETRY-COUNTER                                 CNKCS208
107400         FROM 1 BY 1                                              CNKCS208
107500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
107600            OR  (SQLCODE = +0)                                    CNKCS208
107700            OR  (SQLCODE = +100))                                 CNKCS208
107800                                                                  CNKCS208
107900         EXEC SQL                                                 CNKCS208
108000             SELECT DEPT_CL_IND                                   CNKCS208
108100              INTO :FLAREA-DEPT-CL-IND                            CNKCS208
108200              FROM TFLAREA                                        CNKCS208
108300             WHERE  OPER_UNT_ID        = :DK-OPER-UNT-ID          CNKCS208
108400               AND  FCLTY_ID           = :DK-FCLTY-ID             CNKCS208
108500               AND  FCLTY_AREA_ID      = :DK-AREA-ID              CNKCS208
108600               AND  FCLTY_LOC_TYP_CDE  = :DK-TYPE                 CNKCS208
108700         END-EXEC                                                 CNKCS208
108800                                                                  CNKCS208
108900         EVALUATE TRUE                                            CNKCS208
109000             WHEN SQLCODE = +0                                    CNKCS208
109100             WHEN SQLCODE = +100                                  CNKCS208
109200             WHEN SQLCODE = -904                                  CNKCS208
109300             WHEN SQLCODE = -913                                  CNKCS208
109400                  CONTINUE                                        CNKCS208
109500             WHEN SQLWARN0 NOT = SPACE                            CNKCS208
109600             WHEN SQLCODE < +0                                    CNKCS208
109700             WHEN SQLCODE > +0                                    CNKCS208
109800                  MOVE '3010-SELECT-TFLAREA'                      CNKCS208
109900                                   TO DP013-PARAGRAPH             CNKCS208
110000                  MOVE 'SELECT ON TFLAREA'                        CNKCS208
110100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
110200                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS208
110300                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)    CNKCS208
110400                  SET DP013-DB2-ABEND                             CNKCS208
110500                      DP013-XCTL-DISPLAY-RESTART                  CNKCS208
110600                                   TO TRUE                        CNKCS208
110700                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
110800         END-EVALUATE                                             CNKCS208
110900     END-PERFORM.                                                 CNKCS208
111000                                                                  CNKCS208
111100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
111200         MOVE '3010-SELECT-TFLAREA'                               CNKCS208
111300                                   TO DP013-PARAGRAPH             CNKCS208
111400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   CNKCS208
111500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
111600         MOVE 'ON TABLE TFLAREA '  TO DP013-MESSAGE-TEXT (2)      CNKCS208
111700         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
111800         SET DP013-DB2-ABEND                                      CNKCS208
111900             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
112000                                   TO TRUE                        CNKCS208
112100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
112200     END-IF.                                                      CNKCS208
112300                                                                  CNKCS208
112400/                                                                 CNKCS208
112500*----------------------------------------------------------------*CNKCS208
112600*    CHECK TO SEE IF THIS LOCATION IS ALREADY ASSIGNED TO A      *CNKCS208
112700*    DEPT/CLASS.                                                 *CNKCS208
112800*----------------------------------------------------------------*CNKCS208
112900                                                                  CNKCS208
113000 3020-COUNT-TDCFAAS.                                              CNKCS208
113100                                                                  CNKCS208
113200     PERFORM                                                      CNKCS208
113300         WITH TEST AFTER                                          CNKCS208
113400         VARYING PV-RETRY-COUNTER                                 CNKCS208
113500         FROM 1 BY 1                                              CNKCS208
113600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
113700            OR  (SQLCODE = +0)                                    CNKCS208
113800            OR  (SQLCODE = +100))                                 CNKCS208
113900                                                                  CNKCS208
114000         EXEC SQL                                                 CNKCS208
114100             SELECT COUNT(*)                                      CNKCS208
114200              INTO :PV-DB2-COUNT                                  CNKCS208
114300              FROM TDCFAAS                                        CNKCS208
114400             WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID                CNKCS208
114500               AND FCLTY_ID      = :DK-FCLTY-ID                   CNKCS208
114600               AND DEPT_NBR      = :DK-DEPT-NBR                   CNKCS208
114700               AND CL_NBR        = :DK-CL-NBR                     CNKCS208
114800               AND FCLTY_AREA_ID = :DK-AREA-ID                    CNKCS208
114900         END-EXEC                                                 CNKCS208
115000                                                                  CNKCS208
115100         EVALUATE TRUE                                            CNKCS208
115200             WHEN SQLCODE = +0                                    CNKCS208
115300             WHEN SQLCODE = +100                                  CNKCS208
115400             WHEN SQLCODE = -904                                  CNKCS208
115500             WHEN SQLCODE = -913                                  CNKCS208
115600                  CONTINUE                                        CNKCS208
115700             WHEN SQLWARN0 NOT = SPACE                            CNKCS208
115800             WHEN SQLCODE < +0                                    CNKCS208
115900             WHEN SQLCODE > +0                                    CNKCS208
116000                  MOVE '3020-COUNT-TDCFAAS'                       CNKCS208
116100                                   TO DP013-PARAGRAPH             CNKCS208
116200                  MOVE 'COUNT ON TDCFAAS'                         CNKCS208
116300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
116400                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS208
116500                  MOVE 'TDCFAAS'   TO DP013-DB2-TABLE-NAME (1)    CNKCS208
116600                  SET DP013-DB2-ABEND                             CNKCS208
116700                      DP013-XCTL-DISPLAY-RESTART                  CNKCS208
116800                                   TO TRUE                        CNKCS208
116900                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
117000         END-EVALUATE                                             CNKCS208
117100     END-PERFORM.                                                 CNKCS208
117200                                                                  CNKCS208
117300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
117400         MOVE '3020-COUNT-TDCFAAS'                                CNKCS208
117500                                   TO DP013-PARAGRAPH             CNKCS208
117600         MOVE 'MAX RETRIES EXCEEDED FOR COUNT'                    CNKCS208
117700                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
117800         MOVE 'ON TABLE TDCFAAS '  TO DP013-MESSAGE-TEXT (2)      CNKCS208
117900         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
118000         SET DP013-DB2-ABEND                                      CNKCS208
118100             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
118200                                   TO TRUE                        CNKCS208
118300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
118400     END-IF.                                                      CNKCS208
118500                                                                  CNKCS208
118600/                                                                 CNKCS208
118700*----------------------------------------------------------------*CNKCS208
118800*  VALIDATE THE OPERATION SET ID ENTERED                         *CNKCS208
118900*----------------------------------------------------------------*CNKCS208
119000                                                                  CNKCS208
119100 3030-VALIDATE-OPER-SET-ID.                                       CNKCS208
119200                                                                  CNKCS208
119300     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**3
119400     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**3
119500                                                                     CL**3
119600     PERFORM                                                      CNKCS208
119700         WITH TEST AFTER                                          CNKCS208
119800         VARYING PV-RETRY-COUNTER                                 CNKCS208
119900         FROM 1 BY 1                                              CNKCS208
120000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
120100                   OR (SQLCODE = +0)                              CNKCS208
120200                   OR (SQLCODE = +100))                           CNKCS208
120300                                                                  CNKCS208
120400         EXEC SQL                                                 CNKCS208
120500            SELECT  OPER_SET_DESC                                 CNKCS208
120600              INTO :OPRSET-OPER-SET-DESC                          CNKCS208
120700              FROM  TOPRSET                                       CNKCS208
120800             WHERE  OPER_SET_ID    = :DK-OPER-SET-ID              CNKCS208
120900               AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 CL**2
121000               AND  FCLTY_ID       = :DK-FCLTY-ID                    CL**2
121100               AND  VER_STATUS_CDE = 'A'                          CNKCS208
121200         END-EXEC                                                 CNKCS208
121300                                                                  CNKCS208
121400         EVALUATE TRUE                                            CNKCS208
121500             WHEN SQLCODE = +0                                    CNKCS208
121600             WHEN SQLCODE = +100                                  CNKCS208
121700             WHEN SQLCODE = -904                                  CNKCS208
121800             WHEN SQLCODE = -913                                  CNKCS208
121900                 CONTINUE                                         CNKCS208
122000                                                                  CNKCS208
122100             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
122200             WHEN SQLCODE < +0                                    CNKCS208
122300             WHEN SQLCODE > +0                                    CNKCS208
122400                 MOVE '3030-VALIDATE-OPER-SET-ID'                 CNKCS208
122500                                 TO DP013-PARAGRAPH               CNKCS208
122600                 MOVE 'SELECT OPERATION SET ID'                   CNKCS208
122700                                 TO DP013-MESSAGE-TEXT (1)        CNKCS208
122800                 MOVE SQLCA      TO DP013-SQLCA                   CNKCS208
122900                 MOVE 'TOPRSET'  TO DP013-DB2-TABLE-NAME (1)      CNKCS208
123000                 SET DP013-DB2-ABEND                              CNKCS208
123100                                 TO TRUE                          CNKCS208
123200                 SET DP013-XCTL-DISPLAY-RESTART                   CNKCS208
123300                                 TO TRUE                          CNKCS208
123400                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
123500         END-EVALUATE                                             CNKCS208
123600     END-PERFORM.                                                 CNKCS208
123700                                                                  CNKCS208
123800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
123900         MOVE '3030-VALIDATE-OPER-SET-ID'                         CNKCS208
124000                                 TO DP013-PARAGRAPH               CNKCS208
124100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS208
124200                                 TO DP013-MESSAGE-TEXT (1)        CNKCS208
124300         MOVE 'ON TOPRSET    '   TO DP013-MESSAGE-TEXT (2)        CNKCS208
124400         MOVE SQLCA              TO DP013-SQLCA                   CNKCS208
124500         MOVE 'TOPRSET'          TO DP013-DB2-TABLE-NAME (1)      CNKCS208
124600         SET DP013-DB2-ABEND     TO TRUE                          CNKCS208
124700         SET DP013-XCTL-DISPLAY-RESTART                           CNKCS208
124800                                 TO TRUE                          CNKCS208
124900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
125000     END-IF.                                                      CNKCS208
125100                                                                  CNKCS208
125200/                                                                 CNKCS208
125300*----------------------------------------------------------------*CNKCS208
125400*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *CNKCS208
125500*----------------------------------------------------------------*CNKCS208
125600                                                                  CNKCS208
125700 3200-RESET-ATTRIBUTES.                                           CNKCS208
125800                                                                  CNKCS208
125900     IF  ASC-ADD-PENDING                                          CNKCS208
126000         MOVE DP015-UNP-ALP-NOR-OFF TO ADEPTA                     CNKCS208
126100                                       ACLASA                     CNKCS208
126200                                       ATYPEA                     CNKCS208
126300                                       ALOCA                      CNKCS208
126400                                       ARANKA                     CNKCS208
126500                                       AOPSETA                    CNKCS208
126600         MOVE DP015-GREEN           TO ADEPTC                     CNKCS208
126700                                       ACLASC                     CNKCS208
126800                                       ATYPEC                     CNKCS208
126900                                       ALOCC                      CNKCS208
127000                                       ARANKC                     CNKCS208
127100                                       AOPSETC                    CNKCS208
127200         MOVE DP015-UNDERLINE       TO ADEPTH                     CNKCS208
127300                                       ACLASH                     CNKCS208
127400                                       ATYPEH                     CNKCS208
127500                                       ALOCH                      CNKCS208
127600                                       ARANKH                     CNKCS208
127700                                       AOPSETH                    CNKCS208
127800     ELSE                                                         CNKCS208
127900     IF  ASC-UPDATE-PENDING                                       CNKCS208
128000         MOVE DP015-PRO-NOR-OFF     TO ADEPTA                     CNKCS208
128100                                       ACLASA                     CNKCS208
128200                                       ATYPEA                     CNKCS208
128300                                       ARANKA                     CNKCS208
128400         MOVE DP015-UNP-ALP-NOR-OFF TO ALOCA                      CNKCS208
128500                                       AOPSETA                    CNKCS208
128600         MOVE DP015-BLUE            TO ADEPTC                     CNKCS208
128700                                       ACLASC                     CNKCS208
128800                                       ATYPEC                     CNKCS208
128900                                       ARANKC                     CNKCS208
129000         MOVE DP015-GREEN           TO ALOCC                      CNKCS208
129100                                       AOPSETC                    CNKCS208
129200         MOVE DP015-HL-OFF          TO ADEPTH                     CNKCS208
129300                                       ACLASH                     CNKCS208
129400                                       ATYPEH                     CNKCS208
129500                                       ARANKH                     CNKCS208
129600         MOVE DP015-UNDERLINE       TO ALOCH                      CNKCS208
129700                                       AOPSETH                    CNKCS208
129800     ELSE                                                         CNKCS208
129900     IF  ASC-DELETE-PENDING                                       CNKCS208
130000         MOVE DP015-PRO-NOR-OFF     TO ADEPTA                     CNKCS208
130100                                       ACLASA                     CNKCS208
130200                                       ATYPEA                     CNKCS208
130300                                       ALOCA                      CNKCS208
130400                                       ARANKA                     CNKCS208
130500                                       AOPSETA                    CNKCS208
130600         MOVE DP015-BLUE            TO ADEPTC                     CNKCS208
130700                                       ACLASC                     CNKCS208
130800                                       ATYPEC                     CNKCS208
130900                                       ALOCC                      CNKCS208
131000                                       ARANKC                     CNKCS208
131100                                       AOPSETC                    CNKCS208
131200         MOVE DP015-HL-OFF          TO ADEPTH                     CNKCS208
131300                                       ACLASH                     CNKCS208
131400                                       ATYPEH                     CNKCS208
131500                                       ALOCH                      CNKCS208
131600                                       ARANKH                     CNKCS208
131700                                       AOPSETH.                   CNKCS208
131800                                                                  CNKCS208
131900/                                                                 CNKCS208
132000*----------------------------------------------------------------*CNKCS208
132100*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *CNKCS208
132200*    ENTRY.                                                      *CNKCS208
132300*----------------------------------------------------------------*CNKCS208
132400                                                                  CNKCS208
132500 4000-BUILD-INITIAL-PANEL.                                        CNKCS208
132600                                                                  CNKCS208
132800     INITIALIZE DCLTDCFAAS                                        CNKCS208
132900                DCLTFLAREA.                                       CNKCS208
133000                                                                  CNKCS208
133100     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
133200     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
133310     PERFORM 4200-GET-STORE-INFORMATION.                          CNKCS208
133600                                                                  CNKCS208
133700     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
133800     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
133900     MOVE ASC-DEPT-NBR             TO DK-DEPT-NBR.                CNKCS208
134000     MOVE ASC-CL-NBR               TO DK-CL-NBR.                  CNKCS208
134100     MOVE ASC-TYPE                 TO DK-TYPE.                    CNKCS208
134200     MOVE ASC-RANK                 TO DK-RANK.                    CNKCS208
134300     PERFORM 4110-SELECT-TOPRSET.                                 CNKCS208
134400                                                                  CNKCS208
134500     PERFORM 4100-SELECT-TDCFAAS.                                 CNKCS208
134600                                                                  CNKCS208
134700     IF  DN-FCLTY-AREA-ID = -1                                    CNKCS208
134800         MOVE SPACES               TO ASC-AREA-ID                 CNKCS208
134900                                      ASC-DESC                    CNKCS208
135000     ELSE                                                         CNKCS208
135100         MOVE DCFAAS-FCLTY-AREA-ID TO ASC-AREA-ID                 CNKCS208
135200         MOVE ASC-AREA-ID          TO DK-AREA-ID                  CNKCS208
135300         PERFORM 4300-SELECT-TFLAREA                              CNKCS208
135400         MOVE FLAREA-FCLTY-AREA-DESC                              CNKCS208
135500                                   TO ASC-DESC                    CNKCS208
135600     END-IF.                                                      CNKCS208
135700                                                                  CNKCS208
135800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS208
135900                                                                  CNKCS208
136000/                                                                 CNKCS208
136100*----------------------------------------------------------------*CNKCS208
136200* SELECT A ROW FROM THE DEPARTMENT/CLASS FACILITY LOCATION TABLE *CNKCS208
136300*----------------------------------------------------------------*CNKCS208
136400 4100-SELECT-TDCFAAS.                                             CNKCS208
136500                                                                  CNKCS208
136600     PERFORM                                                      CNKCS208
136700         WITH TEST AFTER                                          CNKCS208
136800         VARYING PV-RETRY-COUNTER                                 CNKCS208
136900         FROM 1 BY 1                                              CNKCS208
137000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
137100            OR (SQLCODE = +0)                                     CNKCS208
137200            OR (SQLCODE = +100))                                  CNKCS208
137300                                                                  CNKCS208
137400         EXEC SQL                                                 CNKCS208
137500           SELECT  FCLTY_AREA_ID                                  CNKCS208
137600             INTO :DCFAAS-FCLTY-AREA-ID                           CNKCS208
137700                    :DN-FCLTY-AREA-ID                             CNKCS208
137800             FROM  TDCFAAS                                        CNKCS208
137900            WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID            CNKCS208
138000              AND  FCLTY_ID          = :DK-FCLTY-ID               CNKCS208
138100              AND  DEPT_NBR          = :DK-DEPT-NBR               CNKCS208
138200              AND  CL_NBR            = :DK-CL-NBR                 CNKCS208
138300              AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                   CNKCS208
138400              AND  RANK_NBR          = :DK-RANK                   CNKCS208
138500         END-EXEC                                                 CNKCS208
138600                                                                  CNKCS208
138700         EVALUATE TRUE                                            CNKCS208
138800             WHEN SQLCODE = +0                                    CNKCS208
138900             WHEN SQLCODE = +100                                  CNKCS208
139000                 CONTINUE                                         CNKCS208
139100             WHEN SQLCODE = -904                                  CNKCS208
139200             WHEN SQLCODE = -913                                  CNKCS208
139300                 CONTINUE                                         CNKCS208
139400             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
139500             WHEN SQLCODE < ZERO                                  CNKCS208
139600             WHEN SQLCODE > ZERO                                  CNKCS208
139700                 MOVE '4100-SELECT-TDCFAAS'                       CNKCS208
139800                                   TO DP013-PARAGRAPH             CNKCS208
139900                 MOVE 'SELECT DEPT/CLASS TICKET FORMAT'           CNKCS208
140000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
140100                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
140200                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
140300                 SET DP013-DB2-ABEND                              CNKCS208
140400                     DP013-XCTL-DISPLAY-RESTART                   CNKCS208
140500                                   TO TRUE                        CNKCS208
140600                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
140700         END-EVALUATE                                             CNKCS208
140800     END-PERFORM.                                                 CNKCS208
140900                                                                  CNKCS208
141000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
141100         MOVE '4100-SELECT-TDCFAAS'                               CNKCS208
141200                                   TO DP013-PARAGRAPH             CNKCS208
141300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS208
141400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
141500         MOVE 'ON TABLE TDCFAAS'   TO DP013-MESSAGE-TEXT (2)      CNKCS208
141600         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
141700         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
141800         SET DP013-DB2-ABEND                                      CNKCS208
141900             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
142000                                   TO TRUE                        CNKCS208
142100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
142200     END-IF.                                                      CNKCS208
142300                                                                  CNKCS208
142400/                                                                 CNKCS208
142500*----------------------------------------------------------------*CNKCS208
142600*    RETRIEVE OPERATION SET DESCRIPTION                          *CNKCS208
142700*----------------------------------------------------------------*CNKCS208
142800 4110-SELECT-TOPRSET.                                             CNKCS208
142900                                                                  CNKCS208
143000     PERFORM                                                      CNKCS208
143100         WITH TEST AFTER                                          CNKCS208
143200         VARYING PV-RETRY-COUNTER                                 CNKCS208
143300         FROM 1 BY 1                                              CNKCS208
143400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
143500             OR (SQLCODE = +0)                                    CNKCS208
143600             OR (SQLCODE = +100))                                 CNKCS208
143700                                                                  CNKCS208
143800         EXEC SQL                                                 CNKCS208
143900            SELECT  A.OPER_SET_ID                                 CNKCS208
144000                   ,B.OPER_SET_DESC                               CNKCS208
144100              INTO :WRKORD-OPER-SET-ID                            CNKCS208
144200                  ,:OPRSET-OPER-SET-DESC                          CNKCS208
144300              FROM  TDCFAAS A                                     CNKCS208
144400                   ,TOPRSET B                                     CNKCS208
144500             WHERE  A.OPER_UNT_ID     = :DK-OPER-UNT-ID           CNKCS208
144600               AND  A.FCLTY_ID        = :DK-FCLTY-ID              CNKCS208
144700               AND  DEPT_NBR          = :DK-DEPT-NBR              CNKCS208
144800               AND  CL_NBR            = :DK-CL-NBR                CNKCS208
144900               AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                  CNKCS208
145000               AND  RANK_NBR          = :DK-RANK                  CNKCS208
145100               AND  A.OPER_UNT_ID     = B.OPER_UNT_ID             CNKCS208
145200               AND  A.FCLTY_ID        = B.FCLTY_ID                CNKCS208
145300               AND  A.OPER_SET_ID     = B.OPER_SET_ID             CNKCS208
145400         END-EXEC                                                 CNKCS208
145500                                                                  CNKCS208
145600         EVALUATE TRUE                                            CNKCS208
145700             WHEN SQLCODE = +0                                    CNKCS208
145800                  MOVE WRKORD-OPER-SET-ID   TO ASC-OPER-SET-ID-N  CNKCS208
145900                  MOVE OPRSET-OPER-SET-DESC TO ASC-OPER-SET-DESC  CNKCS208
146000                                                                  CNKCS208
146100             WHEN SQLCODE = +100                                  CNKCS208
146200                  MOVE SPACES               TO ASC-OPER-SET-ID       CL**7
146300                                               ASC-OPER-SET-DESC     CL**7
146400             WHEN SQLCODE = -904                                  CNKCS208
146500             WHEN SQLCODE = -913                                  CNKCS208
146600                  CONTINUE                                        CNKCS208
146700                                                                  CNKCS208
146800             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
146900             WHEN SQLCODE < +0                                    CNKCS208
147000             WHEN SQLCODE > +0                                    CNKCS208
147100                  MOVE '4110-SELECT-TOPRSET'                      CNKCS208
147200                                  TO DP013-PARAGRAPH              CNKCS208
147300                  MOVE 'UNSUCCESSFUL SELECT ON TOPRSET  '         CNKCS208
147400                                  TO DP013-MESSAGE-TEXT (1)       CNKCS208
147500                  MOVE SQLCA      TO DP013-SQLCA                  CNKCS208
147600                  MOVE 'TDCFAAS ' TO DP013-DB2-TABLE-NAME (1)     CNKCS208
147700                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)     CNKCS208
147800                  SET DP013-DB2-ABEND                             CNKCS208
147900                      DP013-XCTL-DISPLAY-RESTART                  CNKCS208
148000                                  TO TRUE                         CNKCS208
148100                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
148200         END-EVALUATE                                             CNKCS208
148300     END-PERFORM.                                                 CNKCS208
148400                                                                  CNKCS208
148500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
148600         MOVE '4110-SEELCT-TOPRSET   '                            CNKCS208
148700                                  TO DP013-PARAGRAPH              CNKCS208
148800         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TOPRSET  '       CNKCS208
148900                                  TO DP013-MESSAGE-TEXT (1)       CNKCS208
149000         MOVE SQLCA               TO DP013-SQLCA                  CNKCS208
149100         MOVE 'TDCFAAS '          TO DP013-DB2-TABLE-NAME (1)     CNKCS208
149200         MOVE 'TOPRSET '          TO DP013-DB2-TABLE-NAME (2)     CNKCS208
149300         SET DP013-DB2-ABEND                                      CNKCS208
149400             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
149500                                  TO TRUE                         CNKCS208
149600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
149700     END-IF.                                                      CNKCS208
149800                                                                  CNKCS208
149900/                                                                 CNKCS208
155310                                                                  18470003
155320****************************************************************  18480003
155330*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
155340*                                                              *  18500003
155350****************************************************************  18510003
155360                                                                  18520003
155370 4200-GET-STORE-INFORMATION.                                      18530003
155380                                                                  18540003
155390     INITIALIZE XL071-COMMAREA.                                   18550003
155391     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
155392                                                                  18570003
155393     CALL XL071-LOCATION-MODULE USING                             18580003
155394                                DFHEIBLK                          18590003
155395                                XL071-COMMAREA                    18600003
155396                                XL071-COMMAREA-REC.               18610003
155397                                                                  18620003
155398     EVALUATE TRUE                                                18630003
155399         WHEN XL071-NO-ERRORS                                     18640003
155400         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
155401              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
155402                                                                  18670003
155403         WHEN XL071-LOC-NOT-FOUND                                 18680003
155404              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
155405                                                                  18700003
155406         WHEN OTHER                                               18710003
155407              MOVE '4200-GET-STORE-INFORMATION'                   18720003
155408                                  TO DP013-PARAGRAPH              18730003
155409              STRING 'SELECT STORE NUMBER - '                             
155410                      XL071-LOCATION-NUMBER                               
155411                     ' - BAD RETURN CODE FROM XLKUT071 - '                
155412                      XL071-RETURN-CODE                                   
155413                      DELIMITED BY SIZE                                   
155414                      INTO DP013-MESSAGE-TEXT (1)                         
155415              STRING 'BAD SQLCODE - '                                     
155416                      XL071-SQLCODE                                       
155417                     ' - '                                                
155418                      XL071-DB2-TABLE                                     
155419                      DELIMITED BY SIZE                                   
155420                      INTO DP013-MESSAGE-TEXT (2)                         
155421              MOVE XL071-SQLCA     TO DP013-SQLCA                         
155422              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
155429              MOVE XL071-SQLCODE TO SQLCODE                       18800003
155432              SET DP013-DB2-ABEND                                 18830003
155433                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
155434              PERFORM DP013-0000-PROCESS-ABEND                    18850003
155435                                                                  18860003
155436     END-EVALUATE.                                                18870003
155440                                                                  CNKCS208
155500/                                                                 CNKCS208
155600*----------------------------------------------------------------*CNKCS208
155700*    READ FACILITY LOCATION TABLE                                *CNKCS208
155800*----------------------------------------------------------------*CNKCS208
155900 4300-SELECT-TFLAREA.                                             CNKCS208
156000                                                                  CNKCS208
156100     PERFORM                                                      CNKCS208
156200         WITH TEST AFTER                                          CNKCS208
156300         VARYING PV-RETRY-COUNTER                                 CNKCS208
156400         FROM 1 BY 1                                              CNKCS208
156500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
156600            OR  (SQLCODE = +0)                                    CNKCS208
156700            OR  (SQLCODE = +100))                                 CNKCS208
156800                                                                  CNKCS208
156900         EXEC SQL                                                 CNKCS208
157000             SELECT FCLTY_AREA_DESC                               CNKCS208
157100                   ,DEPT_CL_IND                                   CNKCS208
157200              INTO :FLAREA-FCLTY-AREA-DESC                        CNKCS208
157300                  ,:FLAREA-DEPT-CL-IND                            CNKCS208
157400              FROM TFLAREA                                        CNKCS208
157500             WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID               CNKCS208
157600               AND  FCLTY_ID      = :DK-FCLTY-ID                  CNKCS208
157700               AND  FCLTY_AREA_ID = :DK-AREA-ID                   CNKCS208
157800         END-EXEC                                                 CNKCS208
157900                                                                  CNKCS208
158000         EVALUATE TRUE                                            CNKCS208
158100             WHEN SQLCODE = +0                                    CNKCS208
158200             WHEN SQLCODE = +100                                  CNKCS208
158300             WHEN SQLCODE = -904                                  CNKCS208
158400             WHEN SQLCODE = -913                                  CNKCS208
158500                  CONTINUE                                        CNKCS208
158600             WHEN SQLWARN0 NOT = SPACE                            CNKCS208
158700             WHEN SQLCODE < +0                                    CNKCS208
158800             WHEN SQLCODE > +0                                    CNKCS208
158900                  MOVE '4300-SELECT-TFLAREA'                      CNKCS208
159000                                   TO DP013-PARAGRAPH             CNKCS208
159100                  MOVE 'SELECT ON TFLAREA'                        CNKCS208
159200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
159300                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS208
159400                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)    CNKCS208
159500                  SET DP013-DB2-ABEND                             CNKCS208
159600                      DP013-XCTL-DISPLAY-RESTART                  CNKCS208
159700                                   TO TRUE                        CNKCS208
159800                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
159900         END-EVALUATE                                             CNKCS208
160000     END-PERFORM.                                                 CNKCS208
160100                                                                  CNKCS208
160200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
160300         MOVE '4300-SELECT-TFLAREA'                               CNKCS208
160400                                   TO DP013-PARAGRAPH             CNKCS208
160500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   CNKCS208
160600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
160700         MOVE 'ON TABLE TFLAREA '  TO DP013-MESSAGE-TEXT (2)      CNKCS208
160800         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
160900         SET DP013-DB2-ABEND                                      CNKCS208
161000             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
161100                                   TO TRUE                        CNKCS208
161200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
161300     END-IF.                                                      CNKCS208
161400                                                                  CNKCS208
161500/                                                                 CNKCS208
161600*----------------------------------------------------------------*CNKCS208
161700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *CNKCS208
161800*----------------------------------------------------------------*CNKCS208
161900                                                                  CNKCS208
162000 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS208
162100                                                                  CNKCS208
162200     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     CNKCS208
162300     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    CNKCS208
162400     MOVE ASC-FCLTY-NME            TO AFDESCO.                    CNKCS208
162500     MOVE ASC-DEPT-NBR             TO ADEPTO.                     CNKCS208
162600     MOVE ASC-CL-NBR               TO ACLASO.                     CNKCS208
162700     MOVE ASC-TYPE                 TO ATYPEO.                     CNKCS208
162800     MOVE ASC-AREA-ID              TO ALOCO.                      CNKCS208
162900     MOVE ASC-RANK                 TO ARANKO.                     CNKCS208
163000     MOVE ASC-DESC                 TO ADESCO.                     CNKCS208
163100     MOVE ASC-OPER-SET-ID          TO AOPSETO.                    CNKCS208
163200     MOVE ASC-OPER-SET-DESC        TO AOPSDESO.                   CNKCS208
163300                                                                  CNKCS208
163400     IF ASC-UPDATE-PENDING                                        CNKCS208
163500        MOVE -1                    TO AOPSETL                     CNKCS208
163600        SET DP030-SET-CURSOR-APPL-1                               CNKCS208
163700                                   TO TRUE                        CNKCS208
163800     END-IF.                                                      CNKCS208
163900                                                                  CNKCS208
164000/                                                                 CNKCS208
164100*----------------------------------------------------------------*CNKCS208
164200* ADD A ROW TO THE DEPARTMENT/CLASS FACILITY LOCATION TABLE      *CNKCS208
164300*----------------------------------------------------------------*CNKCS208
164400 5000-ADD-ASSIGNMENT.                                             CNKCS208
164500                                                                  CNKCS208
164600     INITIALIZE DCLTDCFAAS.                                       CNKCS208
164700                                                                  CNKCS208
164800     IF  ASC-AREA-ID = SPACES                                     CNKCS208
164900         MOVE -1                   TO DN-FCLTY-AREA-ID            CNKCS208
165000     ELSE                                                         CNKCS208
165100         MOVE +1                   TO DN-FCLTY-AREA-ID            CNKCS208
165200     END-IF.                                                      CNKCS208
165300                                                                  CNKCS208
165400     MOVE ASC-RANK-N               TO DK-RANK.                    CNKCS208
165500                                                                  CNKCS208
165600     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
165700     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
165800     MOVE ASC-OPER-SET-ID-N        TO DK-OPER-SET-ID.             CNKCS208
165900                                                                  CNKCS208
166000     PERFORM 5100-INSERT-TDCFAAS.                                 CNKCS208
166100                                                                  CNKCS208
166200     IF  SQLCODE = +0                                             CNKCS208
166300         MOVE PC-TSYMSG-00034      TO DP020-MSG-NUMBER            CNKCS208
166400         SET DP020-MSG-INFORMATIONAL                              CNKCS208
166500             ASC-ADD-SUCCESSFUL    TO TRUE                        CNKCS208
166600         IF  ASC-USE-SELECTION-QUEUE                              CNKCS208
166700             PERFORM 5200-UPDATE-SELECTION-QUEUE                  CNKCS208
166800         END-IF                                                   CNKCS208
166900     ELSE                                                         CNKCS208
167000         IF  SQLCODE = -803                                       CNKCS208
167100             SET PS-ERROR          TO TRUE                        CNKCS208
167200             SET DP020-MSG-FATAL   TO TRUE                        CNKCS208
167300             MOVE PC-TSYMSG-00117  TO DP020-MSG-NUMBER            CNKCS208
167400             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS208
167500                                   TO ADEPTA                      CNKCS208
167600                                      ACLASA                      CNKCS208
167700                                      ATYPEA                      CNKCS208
167800                                      ARANKA                      CNKCS208
167900             MOVE DP015-RED        TO ADEPTC                      CNKCS208
168000                                      ACLASC                      CNKCS208
168100                                      ATYPEC                      CNKCS208
168200                                      ARANKC                      CNKCS208
168300             MOVE DP015-REVERSE    TO ADEPTH                      CNKCS208
168400                                      ACLASH                      CNKCS208
168500                                      ATYPEH                      CNKCS208
168600                                      ARANKH                      CNKCS208
168700             MOVE -1               TO ARANKL                      CNKCS208
168800             SET DP030-SET-CURSOR-APPL-1                          CNKCS208
168900                                   TO TRUE                        CNKCS208
169000         END-IF                                                   CNKCS208
169100     END-IF.                                                      CNKCS208
169200                                                                  CNKCS208
169300/                                                                 CNKCS208
169400*----------------------------------------------------------------*CNKCS208
169500*  INSERT A ROW ON THE DEPARTMENT/CLASS FACILITY LOCATION TABLE  *CNKCS208
169600*----------------------------------------------------------------*CNKCS208
169700 5100-INSERT-TDCFAAS.                                             CNKCS208
169800                                                                  CNKCS208
169900     PERFORM                                                      CNKCS208
170000         WITH TEST AFTER                                          CNKCS208
170100         VARYING PV-RETRY-COUNTER                                 CNKCS208
170200         FROM 1 BY 1                                              CNKCS208
170300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
170400             OR (SQLCODE = +0)                                    CNKCS208
170500             OR (SQLCODE = -803))                                 CNKCS208
170600                                                                  CNKCS208
170700         EXEC SQL                                                 CNKCS208
170800             INSERT  INTO TDCFAAS                                 CNKCS208
170900                    (OPER_UNT_ID                                  CNKCS208
171000                    ,FCLTY_ID                                     CNKCS208
171100                    ,DEPT_NBR                                     CNKCS208
171200                    ,CL_NBR                                       CNKCS208
171300                    ,FCLTY_LOC_TYP_CDE                            CNKCS208
171400                    ,RANK_NBR                                     CNKCS208
171500                    ,FCLTY_AREA_ID                                CNKCS208
171600                    ,OPER_SET_ID)                                 CNKCS208
171700            VALUES  (:DK-OPER-UNT-ID                              CNKCS208
171800                    ,:DK-FCLTY-ID                                 CNKCS208
171900                    ,:ASC-DEPT-NBR                                CNKCS208
172000                    ,:ASC-CL-NBR                                  CNKCS208
172100                    ,:ASC-TYPE                                    CNKCS208
172200                    ,:DK-RANK                                     CNKCS208
172300                    ,:ASC-AREA-ID                                 CNKCS208
172400                       :DN-FCLTY-AREA-ID                          CNKCS208
172500                    ,:DK-OPER-SET-ID)                             CNKCS208
172600         END-EXEC                                                 CNKCS208
172700                                                                  CNKCS208
172800         EVALUATE TRUE                                            CNKCS208
172900             WHEN SQLCODE = +0                                    CNKCS208
173000             WHEN SQLCODE = -803                                  CNKCS208
173100             WHEN SQLCODE = -904                                  CNKCS208
173200             WHEN SQLCODE = -913                                  CNKCS208
173300                 CONTINUE                                         CNKCS208
173400             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
173500             WHEN SQLCODE < +0                                    CNKCS208
173600             WHEN SQLCODE > +0                                    CNKCS208
173700                 MOVE '5100-INSERT-TDCFAAS'                       CNKCS208
173800                                   TO DP013-PARAGRAPH             CNKCS208
173900                 MOVE 'INSERT A ROW ON TDCFAAS'                   CNKCS208
174000                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
174100                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
174200                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
174300                 SET DP013-DB2-ABEND                              CNKCS208
174400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS208
174500                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
174600         END-EVALUATE                                             CNKCS208
174700     END-PERFORM.                                                 CNKCS208
174800                                                                  CNKCS208
174900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
175000         MOVE '5100-INSERT-TDCFAAS'                               CNKCS208
175100                                   TO DP013-PARAGRAPH             CNKCS208
175200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS208
175300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
175400         MOVE 'TO INSERT A TDCFAAS ROW'                           CNKCS208
175500                                   TO DP013-MESSAGE-TEXT (2)      CNKCS208
175600         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
175700         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
175800         SET DP013-DB2-ABEND                                      CNKCS208
175900             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
176000                                   TO TRUE                        CNKCS208
176100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
176200     END-IF.                                                      CNKCS208
176300                                                                  CNKCS208
176400/                                                                 CNKCS208
176500*----------------------------------------------------------------*CNKCS208
176600* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *CNKCS208
176700* OBJECT WAS UDPATED.                                            *CNKCS208
176800*----------------------------------------------------------------*CNKCS208
176900                                                                  CNKCS208
177000 5200-UPDATE-SELECTION-QUEUE.                                     CNKCS208
177100                                                                  CNKCS208
177200     PERFORM 9100-READ-SEL-QUEUE.                                 CNKCS208
177300                                                                  CNKCS208
177400     IF  ASC-DELETE-SUCCESSFUL                                    CNKCS208
177500         SET CN005-DEL (ASC-SEL-SUB)                              CNKCS208
177600                                   TO TRUE                        CNKCS208
177700     ELSE                                                         CNKCS208
177800         IF  PS-ERROR OR PS-ASSIGN-ERROR                          CNKCS208
177900             SET CN005-ERR (ASC-SEL-SUB)                          CNKCS208
178000                                   TO TRUE                        CNKCS208
178100         ELSE                                                     CNKCS208
178200             SET CN005-UPD (ASC-SEL-SUB)                          CNKCS208
178300                                   TO TRUE                        CNKCS208
178400         END-IF                                                   CNKCS208
178500     END-IF.                                                      CNKCS208
178600                                                                  CNKCS208
178700     PERFORM 9200-REWRITE-LIST-QUEUE.                             CNKCS208
178800                                                                  CNKCS208
178900/                                                                 CNKCS208
179000*----------------------------------------------------------------*CNKCS208
179100* ASSIGN THE FACILITY FOR THE SELECTED ROW                       *CNKCS208
179200*----------------------------------------------------------------*CNKCS208
179300 6000-UPDATE-ASSIGNMENT.                                          CNKCS208
179400                                                                  CNKCS208
179500     IF  ASC-AREA-ID = SPACES                                     CNKCS208
179600         MOVE -1                   TO DN-FCLTY-AREA-ID            CNKCS208
179700     ELSE                                                         CNKCS208
179800         MOVE +1                   TO DN-FCLTY-AREA-ID            CNKCS208
179900     END-IF.                                                      CNKCS208
180000                                                                  CNKCS208
180100     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
180200     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
180300     MOVE ASC-DEPT-NBR             TO DK-DEPT-NBR.                CNKCS208
180400     MOVE ASC-CL-NBR               TO DK-CL-NBR.                  CNKCS208
180500     MOVE ASC-TYPE                 TO DK-TYPE.                    CNKCS208
180600     MOVE ASC-RANK                 TO DK-RANK.                    CNKCS208
180700     MOVE ASC-OPER-SET-ID-N        TO DK-OPER-SET-ID.             CNKCS208
180800                                                                  CNKCS208
180900*  CHECK TO SEE IF ASSIGNMENT IS VALID FOR THE TYPE ON AN         CNKCS208
181000*  ASSIGN ALL FUNCTION                                            CNKCS208
181100     IF  ASC-ASSIGN-ALL                                           CNKCS208
181200     AND ASC-AREA-ID > SPACES                                     CNKCS208
181300         MOVE 'N'                  TO PS-ASSIGN-ERROR-SW          CNKCS208
181400         MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID                 CNKCS208
181500         MOVE ASC-AREA-ID          TO DK-AREA-ID                  CNKCS208
181600         MOVE ASC-TYPE             TO DK-TYPE                     CNKCS208
181700         PERFORM 3010-SELECT-TFLAREA                              CNKCS208
181800         IF  SQLCODE = +100                                       CNKCS208
181900             SET PS-ASSIGN-ERROR   TO TRUE                        CNKCS208
182000         ELSE                                                     CNKCS208
182100             IF  FLAREA-DEPT-CL-IND = 'N'                         CNKCS208
182200                 SET PS-ASSIGN-ERROR TO TRUE                      CNKCS208
182300             END-IF                                               CNKCS208
182400         END-IF                                                   CNKCS208
182500     END-IF.                                                      CNKCS208
182600                                                                  CNKCS208
182700     IF (ASC-ASSIGN-ALL AND PS-ASSIGN-ERROR)                      CNKCS208
182800     OR  PS-ERROR                                                 CNKCS208
182900         CONTINUE                                                 CNKCS208
183000     ELSE                                                         CNKCS208
183100         PERFORM 6100-UPDATE-TDCFAAS                              CNKCS208
183200     END-IF.                                                      CNKCS208
183300                                                                  CNKCS208
183400     MOVE PC-TSYMSG-00059          TO DP020-MSG-NUMBER.           CNKCS208
183500     SET DP020-MSG-INFORMATIONAL   TO TRUE.                       CNKCS208
183600                                                                  CNKCS208
183700     IF  ASC-USE-SELECTION-QUEUE                                  CNKCS208
183800         PERFORM 5200-UPDATE-SELECTION-QUEUE                      CNKCS208
183900     END-IF.                                                      CNKCS208
184000                                                                  CNKCS208
184100/                                                                 CNKCS208
184200*----------------------------------------------------------------*CNKCS208
184300*  UPDATE THE ROW ON THE DEPT/CLASS FACILITY LOCATION TABLE      *CNKCS208
184400*----------------------------------------------------------------*CNKCS208
184500 6100-UPDATE-TDCFAAS.                                             CNKCS208
184600                                                                  CNKCS208
184700     PERFORM                                                      CNKCS208
184800         WITH TEST AFTER                                          CNKCS208
184900         VARYING PV-RETRY-COUNTER                                 CNKCS208
185000         FROM 1 BY 1                                              CNKCS208
185100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
185200             OR (SQLCODE = +0))                                   CNKCS208
185300                                                                  CNKCS208
185400         EXEC SQL                                                 CNKCS208
185500             UPDATE TDCFAAS                                       CNKCS208
185600               SET  FCLTY_AREA_ID = :ASC-AREA-ID                  CNKCS208
185700                                      :DN-FCLTY-AREA-ID           CNKCS208
185800                   ,OPER_SET_ID   = :DK-OPER-SET-ID               CNKCS208
185900              WHERE  OPER_UNT_ID       = :DK-OPER-UNT-ID          CNKCS208
186000                AND  FCLTY_ID          = :DK-FCLTY-ID             CNKCS208
186100                AND  DEPT_NBR          = :DK-DEPT-NBR             CNKCS208
186200                AND  CL_NBR            = :DK-CL-NBR               CNKCS208
186300                AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                 CNKCS208
186400                AND  RANK_NBR          = :DK-RANK                 CNKCS208
186500         END-EXEC                                                 CNKCS208
186600                                                                  CNKCS208
186700         EVALUATE TRUE                                            CNKCS208
186800             WHEN SQLCODE = +0                                    CNKCS208
186900             WHEN SQLCODE = -904                                  CNKCS208
187000             WHEN SQLCODE = -913                                  CNKCS208
187100                 CONTINUE                                         CNKCS208
187200             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
187300             WHEN SQLCODE < +0                                    CNKCS208
187400             WHEN SQLCODE > +0                                    CNKCS208
187500                 MOVE '6100-UPDATE-TDCFAAS'                       CNKCS208
187600                                   TO DP013-PARAGRAPH             CNKCS208
187700                 MOVE 'UPDATE A ROW ON TDCFAAS'                   CNKCS208
187800                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
187900                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
188000                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
188100                 SET DP013-DB2-ABEND                              CNKCS208
188200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS208
188300                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
188400         END-EVALUATE                                             CNKCS208
188500     END-PERFORM.                                                 CNKCS208
188600                                                                  CNKCS208
188700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
188800         MOVE '6100-UPDATE-TDCFAAS'                               CNKCS208
188900                                   TO DP013-PARAGRAPH             CNKCS208
189000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS208
189100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
189200         MOVE 'TO UPDATE A TDCFAAS ROW'                           CNKCS208
189300                                   TO DP013-MESSAGE-TEXT (2)      CNKCS208
189400         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
189500         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
189600         SET DP013-DB2-ABEND                                      CNKCS208
189700             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
189800                                   TO TRUE                        CNKCS208
189900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
190000     END-IF.                                                      CNKCS208
190100                                                                  CNKCS208
190200/                                                                 CNKCS208
190300*----------------------------------------------------------------*CNKCS208
190400*    CHECK TO SEE IF THERE ARE ANY OTHER ASSIGNMENTS ASSIGNED    *CNKCS208
190500*    FOR A GIVEN DEPT/CLASS WITHIN A FACILITY. IF SO, THE ROW    *CNKCS208
190600*    MAY BE DELETED. OTHERWISE, SET THE LOCATION ID TO NULL AND  *CNKCS208
190700*    UPDATE.                                                     *CNKCS208
190800*    IF THE ROW WAS DELETED, THE REMAINING ROWS MUST BE RE-RANKED*CNKCS208
190900*    IN ASCENDING RANK SEQEUNCE.                                 *CNKCS208
191000*----------------------------------------------------------------*CNKCS208
191100                                                                  CNKCS208
191200 7000-DELETE-ASSIGNMENT.                                          CNKCS208
191300                                                                  CNKCS208
191400     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             CNKCS208
191500     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                CNKCS208
191600     MOVE ASC-DEPT-NBR             TO DK-DEPT-NBR.                CNKCS208
191700     MOVE ASC-CL-NBR               TO DK-CL-NBR.                  CNKCS208
191800     MOVE ASC-TYPE                 TO DK-TYPE.                    CNKCS208
191900     MOVE ASC-RANK                 TO DK-RANK.                    CNKCS208
192000                                                                  CNKCS208
192100     INITIALIZE PV-DB2-COUNT.                                     CNKCS208
192200     PERFORM 7100-COUNT-TDCFAAS.                                  CNKCS208
192300                                                                  CNKCS208
192400     IF PV-DB2-COUNT > +1                                         CNKCS208
192500        PERFORM 7200-DELETE-TDCFAAS                               CNKCS208
192600        MOVE 1                     TO PV-RANK-NBR                 CNKCS208
192700        MOVE SPACES                TO PV-HOLD-TDCFAAS             CNKCS208
192800        MOVE 'N'                   TO PS-EOF-TDCFAAS-CSR-SW       CNKCS208
192900        PERFORM 7400-OPEN-TDCFAAS                                 CNKCS208
193000        PERFORM 7500-FETCH-TDCFAAS                                CNKCS208
193100        PERFORM UNTIL PS-EOF-TDCFAAS-CSR                          CNKCS208
193200           IF DCFAAS-RANK-NBR = PV-RANK-NBR                       CNKCS208
193300              CONTINUE                                            CNKCS208
193400           ELSE                                                   CNKCS208
193500              MOVE DCFAAS-OPER-UNT-ID                             CNKCS208
193600                                   TO DK-OPER-UNT-ID              CNKCS208
193700              MOVE DCFAAS-FCLTY-ID                                CNKCS208
193800                                   TO DK-FCLTY-ID                 CNKCS208
193900              MOVE DCFAAS-DEPT-NBR TO DK-DEPT-NBR                 CNKCS208
194000              MOVE DCFAAS-CL-NBR                                  CNKCS208
194100                                   TO DK-CL-NBR                   CNKCS208
194200              MOVE DCFAAS-FCLTY-LOC-TYP-CDE                       CNKCS208
194300                                   TO DK-TYPE                     CNKCS208
194400              MOVE DCFAAS-RANK-NBR TO DK-RANK                     CNKCS208
194500              PERFORM 7200-DELETE-TDCFAAS                         CNKCS208
194600              MOVE PV-HOLD-TDCFAAS TO DCLTDCFAAS                  CNKCS208
194700              MOVE PV-RANK-NBR     TO DCFAAS-RANK-NBR             CNKCS208
194800              IF  DCFAAS-FCLTY-AREA-ID = SPACES                   CNKCS208
194900                  MOVE -1          TO DN-FCLTY-AREA-ID            CNKCS208
195000              ELSE                                                CNKCS208
195100                  MOVE +1          TO DN-FCLTY-AREA-ID            CNKCS208
195200              END-IF                                              CNKCS208
195300              PERFORM 7600-INSERT-TDCFAAS                         CNKCS208
195400           END-IF                                                 CNKCS208
195500           PERFORM 7500-FETCH-TDCFAAS                             CNKCS208
195600           ADD  1                  TO PV-RANK-NBR                 CNKCS208
195700        END-PERFORM                                               CNKCS208
195800        PERFORM 7700-CLOSE-TDCFAAS                                CNKCS208
195900     ELSE                                                         CNKCS208
196000        MOVE -1                    TO DN-FCLTY-AREA-ID            CNKCS208
196100        PERFORM 7300-UPDATE-TDCFAAS                               CNKCS208
196200     END-IF.                                                      CNKCS208
196300                                                                  CNKCS208
196400     MOVE PC-TSYMSG-00115          TO DP020-MSG-NUMBER.           CNKCS208
196500     SET DP020-MSG-INFORMATIONAL                                  CNKCS208
196600         ASC-DELETE-SUCCESSFUL     TO TRUE.                       CNKCS208
196700                                                                  CNKCS208
196800     IF  ASC-USE-SELECTION-QUEUE                                  CNKCS208
196900         PERFORM 5200-UPDATE-SELECTION-QUEUE                      CNKCS208
197000     END-IF.                                                      CNKCS208
197100                                                                  CNKCS208
197200/                                                                 CNKCS208
197300*----------------------------------------------------------------*CNKCS208
197400*    CHECK TO SEE IF HOW MANY ROWS ARE ASSIGNED TO THIS          *CNKCS208
197500*    DEPT/CLASS FOR THIS FACILITY LOCATION                       *CNKCS208
197600*----------------------------------------------------------------*CNKCS208
197700                                                                  CNKCS208
197800 7100-COUNT-TDCFAAS.                                              CNKCS208
197900                                                                  CNKCS208
198000     PERFORM                                                      CNKCS208
198100         WITH TEST AFTER                                          CNKCS208
198200         VARYING PV-RETRY-COUNTER                                 CNKCS208
198300         FROM 1 BY 1                                              CNKCS208
198400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
198500            OR  (SQLCODE = +0)                                    CNKCS208
198600            OR  (SQLCODE = +100))                                 CNKCS208
198700                                                                  CNKCS208
198800         EXEC SQL                                                 CNKCS208
198900             SELECT COUNT(*)                                      CNKCS208
199000              INTO :PV-DB2-COUNT                                  CNKCS208
199100              FROM TDCFAAS                                        CNKCS208
199200             WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                  CNKCS208
199300               AND FCLTY_ID    = :DK-FCLTY-ID                     CNKCS208
199400               AND DEPT_NBR    = :DK-DEPT-NBR                     CNKCS208
199500               AND CL_NBR      = :DK-CL-NBR                       CNKCS208
199600         END-EXEC                                                 CNKCS208
199700                                                                  CNKCS208
199800         EVALUATE TRUE                                            CNKCS208
199900             WHEN SQLCODE = +0                                    CNKCS208
200000             WHEN SQLCODE = +100                                  CNKCS208
200100             WHEN SQLCODE = -904                                  CNKCS208
200200             WHEN SQLCODE = -913                                  CNKCS208
200300                  CONTINUE                                        CNKCS208
200400             WHEN SQLWARN0 NOT = SPACE                            CNKCS208
200500             WHEN SQLCODE < +0                                    CNKCS208
200600             WHEN SQLCODE > +0                                    CNKCS208
200700                  MOVE '7100-COUNT-TDCFAAS'                       CNKCS208
200800                                   TO DP013-PARAGRAPH             CNKCS208
200900                  MOVE 'COUNT ON TDCFAAS'                         CNKCS208
201000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
201100                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS208
201200                  MOVE 'TDCFAAS'   TO DP013-DB2-TABLE-NAME (1)    CNKCS208
201300                  SET DP013-DB2-ABEND                             CNKCS208
201400                      DP013-XCTL-DISPLAY-RESTART                  CNKCS208
201500                                   TO TRUE                        CNKCS208
201600                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
201700         END-EVALUATE                                             CNKCS208
201800     END-PERFORM.                                                 CNKCS208
201900                                                                  CNKCS208
202000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
202100         MOVE '7100-COUNT-TDCFAAS'                                CNKCS208
202200                                   TO DP013-PARAGRAPH             CNKCS208
202300         MOVE 'MAX RETRIES EXCEEDED FOR COUNT'                    CNKCS208
202400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
202500         MOVE 'ON TABLE TDCFAAS '  TO DP013-MESSAGE-TEXT (2)      CNKCS208
202600         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
202700         SET DP013-DB2-ABEND                                      CNKCS208
202800             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
202900                                   TO TRUE                        CNKCS208
203000         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
203100     END-IF.                                                      CNKCS208
203200                                                                  CNKCS208
203300/                                                                 CNKCS208
203400*----------------------------------------------------------------*CNKCS208
203500*  DELETE THE ROW ON THE DEPARTMENT/CLASS FACILITY LOCATION TABLE*CNKCS208
203600*----------------------------------------------------------------*CNKCS208
203700 7200-DELETE-TDCFAAS.                                             CNKCS208
203800                                                                  CNKCS208
203900     PERFORM                                                      CNKCS208
204000         WITH TEST AFTER                                          CNKCS208
204100         VARYING PV-RETRY-COUNTER                                 CNKCS208
204200         FROM 1 BY 1                                              CNKCS208
204300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
204400             OR (SQLCODE = +0))                                   CNKCS208
204500                                                                  CNKCS208
204600         EXEC SQL                                                 CNKCS208
204700             DELETE FROM TDCFAAS                                  CNKCS208
204800             WHERE OPER_UNT_ID       = :DK-OPER-UNT-ID            CNKCS208
204900              AND  FCLTY_ID          = :DK-FCLTY-ID               CNKCS208
205000              AND  DEPT_NBR          = :DK-DEPT-NBR               CNKCS208
205100              AND  CL_NBR            = :DK-CL-NBR                 CNKCS208
205200              AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                   CNKCS208
205300              AND  RANK_NBR          = :DK-RANK                   CNKCS208
205400         END-EXEC                                                 CNKCS208
205500                                                                  CNKCS208
205600         EVALUATE TRUE                                            CNKCS208
205700             WHEN SQLCODE = +0                                    CNKCS208
205800             WHEN SQLCODE = -904                                  CNKCS208
205900             WHEN SQLCODE = -913                                  CNKCS208
206000                 CONTINUE                                         CNKCS208
206100             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
206200             WHEN SQLCODE < +0                                    CNKCS208
206300             WHEN SQLCODE > +0                                    CNKCS208
206400                 MOVE '7200-DELETE-TDCFAAS'                       CNKCS208
206500                                   TO DP013-PARAGRAPH             CNKCS208
206600                 MOVE 'DELETE ROW ON TDCFAAS'                     CNKCS208
206700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
206800                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
206900                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
207000                 SET DP013-DB2-ABEND                              CNKCS208
207100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS208
207200                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
207300         END-EVALUATE                                             CNKCS208
207400     END-PERFORM.                                                 CNKCS208
207500                                                                  CNKCS208
207600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
207700         MOVE '7200-DELETE-TDCFAAS'                               CNKCS208
207800                                   TO DP013-PARAGRAPH             CNKCS208
207900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS208
208000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
208100         MOVE 'TO DELETE TDCFAAS ROW'                             CNKCS208
208200                                   TO DP013-MESSAGE-TEXT (2)      CNKCS208
208300         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
208400         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
208500         SET DP013-DB2-ABEND                                      CNKCS208
208600             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
208700                                   TO TRUE                        CNKCS208
208800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
208900     END-IF.                                                      CNKCS208
209000                                                                  CNKCS208
209100/                                                                 CNKCS208
209200*----------------------------------------------------------------*CNKCS208
209300*  UPDATE THE ROW ON THE DEPARTMENT/CLASS FACILITY LOCATION TABLE*CNKCS208
209400*----------------------------------------------------------------*CNKCS208
209500 7300-UPDATE-TDCFAAS.                                             CNKCS208
209600                                                                  CNKCS208
209700     PERFORM                                                      CNKCS208
209800         WITH TEST AFTER                                          CNKCS208
209900         VARYING PV-RETRY-COUNTER                                 CNKCS208
210000         FROM 1 BY 1                                              CNKCS208
210100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
210200             OR (SQLCODE = +0))                                   CNKCS208
210300                                                                  CNKCS208
210400         EXEC SQL                                                 CNKCS208
210500             UPDATE TDCFAAS                                       CNKCS208
210600               SET  FCLTY_AREA_ID = :DCFAAS-FCLTY-AREA-ID         CNKCS208
210700                                      :DN-FCLTY-AREA-ID           CNKCS208
210800             WHERE OPER_UNT_ID       = :DK-OPER-UNT-ID            CNKCS208
210900              AND  FCLTY_ID          = :DK-FCLTY-ID               CNKCS208
211000              AND  DEPT_NBR          = :DK-DEPT-NBR               CNKCS208
211100              AND  CL_NBR            = :DK-CL-NBR                 CNKCS208
211200              AND  FCLTY_LOC_TYP_CDE = :DK-TYPE                   CNKCS208
211300              AND  RANK_NBR          = :DK-RANK                   CNKCS208
211400         END-EXEC                                                 CNKCS208
211500                                                                  CNKCS208
211600         EVALUATE TRUE                                            CNKCS208
211700             WHEN SQLCODE = +0                                    CNKCS208
211800             WHEN SQLCODE = -904                                  CNKCS208
211900             WHEN SQLCODE = -913                                  CNKCS208
212000                 CONTINUE                                         CNKCS208
212100             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
212200             WHEN SQLCODE < +0                                    CNKCS208
212300             WHEN SQLCODE > +0                                    CNKCS208
212400                 MOVE '7300-UPDATE-TDCFAAS'                       CNKCS208
212500                                   TO DP013-PARAGRAPH             CNKCS208
212600                 MOVE 'UPDATE ROW ON TDCFAAS'                     CNKCS208
212700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
212800                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
212900                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
213000                 SET DP013-DB2-ABEND                              CNKCS208
213100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS208
213200                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
213300         END-EVALUATE                                             CNKCS208
213400     END-PERFORM.                                                 CNKCS208
213500                                                                  CNKCS208
213600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
213700         MOVE '7300-UPDATE-TDCFAAS'                               CNKCS208
213800                                   TO DP013-PARAGRAPH             CNKCS208
213900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS208
214000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
214100         MOVE 'TO UPDATE TDCFAAS ROW'                             CNKCS208
214200                                   TO DP013-MESSAGE-TEXT (2)      CNKCS208
214300         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
214400         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
214500         SET DP013-DB2-ABEND                                      CNKCS208
214600             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
214700                                   TO TRUE                        CNKCS208
214800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
214900     END-IF.                                                      CNKCS208
215000                                                                  CNKCS208
215100/                                                                 CNKCS208
215200*----------------------------------------------------------------*CNKCS208
215300*  OPEN CURSOR ON TABLE TDCFAAS TO SELECT ALL COLUMNS            *CNKCS208
215400*----------------------------------------------------------------*CNKCS208
215500 7400-OPEN-TDCFAAS.                                               CNKCS208
215600                                                                  CNKCS208
215700     PERFORM                                                      CNKCS208
215800         WITH TEST AFTER                                          CNKCS208
215900         VARYING PV-RETRY-COUNTER                                 CNKCS208
216000         FROM 1 BY 1                                              CNKCS208
216100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
216200            OR (SQLCODE = +0))                                    CNKCS208
216300                                                                  CNKCS208
216400         EXEC SQL                                                 CNKCS208
216500             OPEN TDCFAAS-CSR                                     CNKCS208
216600         END-EXEC                                                 CNKCS208
216700                                                                  CNKCS208
216800         EVALUATE TRUE                                            CNKCS208
216900             WHEN SQLCODE = +0                                    CNKCS208
217000                  CONTINUE                                        CNKCS208
217100             WHEN SQLCODE = -904                                  CNKCS208
217200             WHEN SQLCODE = -913                                  CNKCS208
217300                  CONTINUE                                        CNKCS208
217400             WHEN SQLWARN0 NOT = SPACE                            CNKCS208
217500             WHEN SQLCODE  NOT = +0                               CNKCS208
217600                  MOVE '7400-OPEN-TDCFAAS'                        CNKCS208
217700                                   TO DP013-PARAGRAPH             CNKCS208
217800                  MOVE 'OPEN TDCFAAS-CSR CURSOR'                  CNKCS208
217900                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
218000                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS208
218100                  MOVE 'TDCFAAS'   TO DP013-DB2-TABLE-NAME (1)    CNKCS208
218200                  SET DP013-DB2-ABEND                             CNKCS208
218300                                   TO TRUE                        CNKCS208
218400                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS208
218500         END-EVALUATE                                             CNKCS208
218600     END-PERFORM.                                                 CNKCS208
218700                                                                  CNKCS208
218800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
218900         MOVE '7400-OPEN-TDCFAAS'  TO DP013-PARAGRAPH             CNKCS208
219000         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              CNKCS208
219100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
219200         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
219300         SET DP013-DB2-ABEND       TO TRUE                        CNKCS208
219400         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
219500     END-IF.                                                      CNKCS208
219600                                                                  CNKCS208
219700/                                                                 CNKCS208
219800*----------------------------------------------------------------*CNKCS208
219900*    FETCH A ROW                                                 *CNKCS208
220000*----------------------------------------------------------------*CNKCS208
220100                                                                  CNKCS208
220200 7500-FETCH-TDCFAAS.                                              CNKCS208
220300                                                                  CNKCS208
220400     EXEC SQL                                                     CNKCS208
220500         FETCH TDCFAAS-CSR                                        CNKCS208
220600          INTO :DCFAAS-OPER-UNT-ID                                CNKCS208
220700              ,:DCFAAS-FCLTY-ID                                   CNKCS208
220800              ,:DCFAAS-DEPT-NBR                                   CNKCS208
220900              ,:DCFAAS-CL-NBR                                     CNKCS208
221000              ,:DCFAAS-FCLTY-LOC-TYP-CDE                          CNKCS208
221100              ,:DCFAAS-RANK-NBR                                   CNKCS208
221200              ,:DCFAAS-FCLTY-AREA-ID                              CNKCS208
221300                 :DN-FCLTY-AREA-ID                                CNKCS208
221400     END-EXEC.                                                    CNKCS208
221500                                                                  CNKCS208
221600     EVALUATE TRUE                                                CNKCS208
221700         WHEN SQLCODE = +0                                        CNKCS208
221800              MOVE DCLTDCFAAS      TO PV-HOLD-TDCFAAS             CNKCS208
221900         WHEN SQLCODE = +100                                      CNKCS208
222000              SET PS-EOF-TDCFAAS-CSR                              CNKCS208
222100                                   TO TRUE                        CNKCS208
222200         WHEN SQLWARN0 NOT = SPACE                                CNKCS208
222300         WHEN SQLCODE < +0                                        CNKCS208
222400         WHEN SQLCODE > +0                                        CNKCS208
222500              MOVE '7700-FETCH-TDCFAAS'                           CNKCS208
222600                                   TO DP013-PARAGRAPH             CNKCS208
222700              MOVE 'FETCH TDCFAAS CURSOR'                         CNKCS208
222800                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
222900              MOVE SQLCA           TO DP013-SQLCA                 CNKCS208
223000              MOVE 'TDCFAAS'       TO DP013-DB2-TABLE-NAME (1)    CNKCS208
223100              SET DP013-DB2-ABEND  TO TRUE                        CNKCS208
223200              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS208
223300     END-EVALUATE.                                                CNKCS208
223400                                                                  CNKCS208
223500/                                                                 CNKCS208
223600*----------------------------------------------------------------*CNKCS208
223700*  INSERT A ROW ON THE DEPARTMENT/CLASS FACILITY LOCATION TABLE  *CNKCS208
223800*----------------------------------------------------------------*CNKCS208
223900 7600-INSERT-TDCFAAS.                                             CNKCS208
224000                                                                  CNKCS208
224100     PERFORM                                                      CNKCS208
224200         WITH TEST AFTER                                          CNKCS208
224300         VARYING PV-RETRY-COUNTER                                 CNKCS208
224400         FROM 1 BY 1                                              CNKCS208
224500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS208
224600             OR (SQLCODE = +0)                                    CNKCS208
224700             OR (SQLCODE = -803))                                 CNKCS208
224800                                                                  CNKCS208
224900         EXEC SQL                                                 CNKCS208
225000             INSERT  INTO TDCFAAS                                 CNKCS208
225100                    (OPER_UNT_ID                                  CNKCS208
225200                    ,FCLTY_ID                                     CNKCS208
225300                    ,DEPT_NBR                                     CNKCS208
225400                    ,CL_NBR                                       CNKCS208
225500                    ,FCLTY_LOC_TYP_CDE                            CNKCS208
225600                    ,RANK_NBR                                     CNKCS208
225700                    ,FCLTY_AREA_ID                                CNKCS208
225800                    ,OPER_SET_ID)                                 CNKCS208
225900            VALUES  (:DCFAAS-OPER-UNT-ID                          CNKCS208
226000                    ,:DCFAAS-FCLTY-ID                             CNKCS208
226100                    ,:DCFAAS-DEPT-NBR                             CNKCS208
226200                    ,:DCFAAS-CL-NBR                               CNKCS208
226300                    ,:DCFAAS-FCLTY-LOC-TYP-CDE                    CNKCS208
226400                    ,:DCFAAS-RANK-NBR                             CNKCS208
226500                    ,:DCFAAS-FCLTY-AREA-ID                        CNKCS208
226600                       :DN-FCLTY-AREA-ID                          CNKCS208
226700                    ,:DCFAAS-OPER-SET-ID)                         CNKCS208
226800         END-EXEC                                                 CNKCS208
226900                                                                  CNKCS208
227000         EVALUATE TRUE                                            CNKCS208
227100             WHEN SQLCODE = +0                                    CNKCS208
227200             WHEN SQLCODE = -803                                  CNKCS208
227300             WHEN SQLCODE = -904                                  CNKCS208
227400             WHEN SQLCODE = -913                                  CNKCS208
227500                 CONTINUE                                         CNKCS208
227600             WHEN SQLWARN0 NOT = SPACES                           CNKCS208
227700             WHEN SQLCODE < +0                                    CNKCS208
227800             WHEN SQLCODE > +0                                    CNKCS208
227900                 MOVE '7600-INSERT-TDCFAAS'                       CNKCS208
228000                                   TO DP013-PARAGRAPH             CNKCS208
228100                 MOVE 'INSERT A ROW ON TDCFAAS'                   CNKCS208
228200                                   TO DP013-MESSAGE-TEXT(1)       CNKCS208
228300                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS208
228400                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)    CNKCS208
228500                 SET DP013-DB2-ABEND                              CNKCS208
228600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS208
228700                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS208
228800         END-EVALUATE                                             CNKCS208
228900     END-PERFORM.                                                 CNKCS208
229000                                                                  CNKCS208
229100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS208
229200         MOVE '7600-INSERT-TDCFAAS'                               CNKCS208
229300                                   TO DP013-PARAGRAPH             CNKCS208
229400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS208
229500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
229600         MOVE 'TO INSERT A TDCFAAS ROW'                           CNKCS208
229700                                   TO DP013-MESSAGE-TEXT (2)      CNKCS208
229800         MOVE SQLCA                TO DP013-SQLCA                 CNKCS208
229900         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)    CNKCS208
230000         SET DP013-DB2-ABEND                                      CNKCS208
230100             DP013-XCTL-DISPLAY-RESTART                           CNKCS208
230200                                   TO TRUE                        CNKCS208
230300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
230400     END-IF.                                                      CNKCS208
230500                                                                  CNKCS208
230600/                                                                 CNKCS208
230700*----------------------------------------------------------------*CNKCS208
230800* CLOSE THE TDCFAAS CURSOR.                                      *CNKCS208
230900*----------------------------------------------------------------*CNKCS208
231000                                                                  CNKCS208
231100 7700-CLOSE-TDCFAAS.                                              CNKCS208
231200                                                                  CNKCS208
231300     EXEC SQL                                                     CNKCS208
231400         CLOSE TDCFAAS-CSR                                        CNKCS208
231500     END-EXEC.                                                    CNKCS208
231600                                                                  CNKCS208
231700     EVALUATE TRUE                                                CNKCS208
231800         WHEN SQLCODE = +0                                        CNKCS208
231900              CONTINUE                                            CNKCS208
232000         WHEN SQLWARN0 NOT = SPACE                                CNKCS208
232100         WHEN SQLCODE  NOT = +0                                   CNKCS208
232200              MOVE '7700-CLOSE-TDCFAAS'                           CNKCS208
232300                                   TO DP013-PARAGRAPH             CNKCS208
232400              MOVE 'CLOSE TDCFAAS-CSR CURSOR'                     CNKCS208
232500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
232600              MOVE SQLCA           TO DP013-SQLCA                 CNKCS208
232700              MOVE 'TDCFAAS'       TO DP013-DB2-TABLE-NAME (1)    CNKCS208
232800              SET DP013-DB2-ABEND  TO TRUE                        CNKCS208
232900              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS208
233000     END-EVALUATE.                                                CNKCS208
233100                                                                  CNKCS208
233200/                                                                 CNKCS208
233300*----------------------------------------------------------------*CNKCS208
233400* APPLY THE ASSIGNMENT TO ALL SELECTED ROWS ON THE DEPARTMENT/   *CNKCS208
233500* CLASS FACILITY LOCATION TABLE                                  *CNKCS208
233600*----------------------------------------------------------------*CNKCS208
233700 8000-ASSIGN-ALL.                                                 CNKCS208
233800                                                                  CNKCS208
233900     PERFORM VARYING PV-UPD-COUNTER FROM 1 BY 1                   CNKCS208
234000               UNTIL PV-UPD-COUNTER > ASC-NUMBER-OF-SELECTED-ITEMSCNKCS208
234100         PERFORM 6000-UPDATE-ASSIGNMENT                           CNKCS208
234200         PERFORM 2110-GET-NEXT-RECORD                             CNKCS208
234300     END-PERFORM.                                                 CNKCS208
234400                                                                  CNKCS208
234500     MOVE PC-TSYMSG-00059          TO DP020-MSG-NUMBER.           CNKCS208
234600     SET DP020-MSG-INFORMATIONAL   TO TRUE.                       CNKCS208
234700                                                                  CNKCS208
234800/                                                                 CNKCS208
234900*----------------------------------------------------------------*CNKCS208
235000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *CNKCS208
235100*----------------------------------------------------------------*CNKCS208
235200                                                                  CNKCS208
235300 9100-READ-SEL-QUEUE.                                             CNKCS208
235400     EXEC CICS                                                    CNKCS208
235500         READQ TS                                                 CNKCS208
235600             QUEUE (ASC-SEL-QUEUE-NAME)                           CNKCS208
235700             INTO  (CN005-TS-SEL-REC)                             CNKCS208
235800             ITEM  (ASC-SEL-ITEM)                                 CNKCS208
235900             RESP  (PV-CICS-RESPONSE)                             CNKCS208
236000     END-EXEC.                                                    CNKCS208
236100                                                                  CNKCS208
236200     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   CNKCS208
236300         CONTINUE                                                 CNKCS208
236400     ELSE                                                         CNKCS208
236500         SET DP013-LOGIC-ABEND                                    CNKCS208
236600             DP013-NO-ROLLBACK     TO TRUE                        CNKCS208
236700         MOVE '9100-READ-SEL-QUEUE'                               CNKCS208
236800                                   TO DP013-PARAGRAPH             CNKCS208
236900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   CNKCS208
237000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
237100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
237200     END-IF.                                                      CNKCS208
237300                                                                  CNKCS208
237400/                                                                 CNKCS208
237500*----------------------------------------------------------------*CNKCS208
237600* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *CNKCS208
237700*----------------------------------------------------------------*CNKCS208
237800 9200-REWRITE-LIST-QUEUE.                                         CNKCS208
237900                                                                  CNKCS208
238000     EXEC CICS                                                    CNKCS208
238100          WRITEQ TS                                               CNKCS208
238200              QUEUE  (ASC-SEL-QUEUE-NAME)                         CNKCS208
238300              FROM   (CN005-TS-SEL-REC)                           CNKCS208
238400              ITEM   (ASC-SEL-ITEM)                               CNKCS208
238500              RESP   (PV-CICS-RESPONSE)                           CNKCS208
238600              REWRITE                                             CNKCS208
238700     END-EXEC.                                                    CNKCS208
238800                                                                  CNKCS208
238900     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               CNKCS208
239000         SET DP013-CICS-ABEND                                     CNKCS208
239100             DP013-NO-ROLLBACK     TO TRUE                        CNKCS208
239200         MOVE '9200-REWRITE-LIST-QUEUE'                           CNKCS208
239300                                   TO DP013-PARAGRAPH             CNKCS208
239400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   CNKCS208
239500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS208
239600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS208
239700     END-IF.                                                      CNKCS208
239800                                                                  CNKCS208
239900/                                                                 CNKCS208
240000*----------------------------------------------------------------*CNKCS208
240100*    ABEND PROCESSOR MODULE                                      *CNKCS208
240200*----------------------------------------------------------------*CNKCS208
240300                                                                  CNKCS208
240400     COPY DPPD013.                                                CNKCS208
