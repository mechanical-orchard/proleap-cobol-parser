000100*-----------------------*                                         00010023
000200 IDENTIFICATION DIVISION.                                         00020023
000300*-----------------------*                                         00030023
000400 PROGRAM-ID.    VNKCS031.                                         00040023
000500 AUTHOR.        JACK KRAMER.                                      00050023
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060023
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070023
000800*---------------------------------------------------------------* 00080023
000900*    V031 - VENDOR RELATIONSHIP LIST PROGRAM.                   * 00090023
001000*                                                               * 00100023
001100*    THIS PROGRAM GENERATES A LIST OF VENDOR RELATIONSHIPS. ONE * 00110023
001200*    OR MORE RELATIONSHIPS CAN BE SELECTED FOR INQUIRY, OR TO   * 00120023
001300*    BE ADDED TO, OR EXPIRED FROM THE VENDOR BEING PROCESSED.   * 00130023
001400*                                                               * 00140023
001401*CHANGE LOG:                                                    * 00140133
001410*  DATE  09/07/2021                                             * 00141033
001420*            - CHANGE CALL OF DPKUT100 TO                       * 00142033
001430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00143033
001440*              MAKING THE CALL DYNAMIC VS STATIC                * 00144033
001450*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00145035
001460*                                                               * 00146033
001410*  DATE  01/05/2025                                             * 00147036
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00148036
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00149236
001500*---------------------------------------------------------------* 00150023
001600 ENVIRONMENT DIVISION.                                            00160023
001700 DATA DIVISION.                                                   00170023
001800                                                                  00180023
001900 WORKING-STORAGE SECTION.                                         00190023
002000                                                                  00200023
002100 01  DK-DB2-KEYS.                                                 00210023
002200     15  DK-ENT-ID                      PIC S9(09)  COMP.         00220023
002300     15  DK-RLTNSHP-CDE                 PIC XX.                   00230023
002400                                                                  00240023
002500 01  PC-PROGRAM-CONSTANTS.                                        00250023
002600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00260023
002700                                                    'VN031A  '.   00270023
002800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00280023
002900                                                    'VNKM031 '.   00290023
003000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00300023
003100                                                    'VNKCS031'.   00310023
003200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00320023
003300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00330023
003400     05  PC-INTER-APPL-CODES.                                     00340023
003500         10 PC-INTER-APPL-VEND-DTL      PIC  X(01)  VALUE '1'.    00350023
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00360023
003700                                                    COMP SYNC.    00370023
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380023
003900                                                    COMP SYNC.    00390023
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400023
004100                                                    +1000000      00410023
004200                                                    COMP-3.       00420023
004300     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00430023
004400                                                    COMP SYNC.    00440023
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450023
004600                                                    COMP-3.       00460023
004700     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00470023
004800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00480023
004900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00490023
005000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00500023
005100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00510023
005200     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00520023
005300                                                    '9999-12-31'. 00530023
005400                                                                  00540023
005500     05  PC-TSYMSG-NUMBERS.                                       00550023
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00560023
005700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00570023
005800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00580023
005900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00590023
006000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00600023
006100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00610023
006200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00620023
006300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00630023
006400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00640023
006500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00650023
006600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00660023
006700         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00670023
006800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00680023
006900         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  00690023
007000         10  PC-TSYMSG-03374            PIC  9(05)  VALUE 03374.  00700023
007100         10  PC-TSYMSG-03630            PIC  9(05)  VALUE 03630.  00710025
007200         10  PC-TSYMSG-03632            PIC  9(05)  VALUE 03632.  00720027
007300         10  PC-TSYMSG-03634            PIC  9(05)  VALUE 03634.  00730029
007400         10  PC-TSYMSG-03635            PIC  9(05)  VALUE 03635.  00740029
007500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00750023
007600                                                                  00760023
007700 01  PS-PROGRAM-SWITCHES.                                         00770023
007800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00780023
007900         88  PS-NO-ERROR                            VALUE 'Y'.    00790023
008000         88  PS-ERROR                               VALUE 'N'.    00800023
008100     05  PS-VALID-SELECT-SW             PIC  X(01)  VALUE 'N'.    00810023
008200         88  PS-NO-VALID-SELECT                     VALUE 'N'.    00820023
008300         88  PS-VALID-SELECT                        VALUE 'Y'.    00830023
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00840023
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00850023
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00860023
008700                                                                  00870023
008800 01  PV-PROGRAM-VARIABLES.                                        00880023
008900     05  PV-SUB                         PIC S9(04)  VALUE +0      00890023
009000                                                    COMP SYNC.    00900023
009100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00910023
009200                                                    COMP SYNC.    00920023
009300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00930023
009400                                                    COMP-3.       00940023
009500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00950023
009600                                                    COMP-3.       00960023
009700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00970023
009800                                                    COMP-3.       00980023
009900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00990023
010000                                                    COMP-3.       01000023
010100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01010023
010200                                                    COMP-3.       01020023
010300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01030023
010400                                                    COMP-3.       01040023
010500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01050023
010600                                                    COMP-3.       01060023
010700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01070023
010800                                                    COMP SYNC.    01080023
010900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01090023
011000                                                    COMP SYNC.    01100023
011100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01110023
011200                                                    COMP SYNC.    01120023
011300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01130023
011400                                                    COMP SYNC.    01140023
011500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01150023
011600                                                    COMP SYNC.    01160023
011700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01170023
011800                                                    COMP SYNC.    01180023
011900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01190023
012000                                                    COMP SYNC.    01200023
012100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01210023
012200                                                    COMP SYNC.    01220023
012300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01230023
012400                                                    COMP SYNC.    01240023
012500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01250023
012600                                                    COMP SYNC.    01260023
012700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01270023
012800                                                    COMP SYNC.    01280023
012900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01290023
013000                                                    COMP SYNC.    01300023
013100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01310023
013200                                                    COMP SYNC.    01320023
013300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01330023
013400                                                    COMP SYNC.    01340023
013500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01350023
013600                                                    COMP SYNC.    01360023
013700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01370023
013800                                                    COMP SYNC.    01380023
013900     05  PV-COUNT                       PIC S9(05)  VALUE +0      01390023
014000                                                    COMP-3.       01400023
014100     05  PV-DISPLAY-COUNT               PIC S9(05)  VALUE +0.     01410023
014200     05  PV-DUMMY-SELECT                PIC X       VALUE SPACE.  01420025
014300     05  PV-ONE                         PIC X       VALUE SPACE.  01430025
014400***************************************************************** 01440023
014500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01450023
014600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01460023
014700**  APPLICATION-SPECIFIC COMMAREA.                              * 01470023
014800***************************************************************** 01480023
014900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01490023
015000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01500023
015100     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01510023
015200                                        INDEXED BY LQW-IDX.       01520023
015300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01530023
015400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01540023
015500         10  LQW-SELECTED-SW            PIC  X(01).               01550023
015600             88  LQW-SELECT                         VALUE 'S'.    01560023
015700             88  LQW-DESELECT                       VALUE ' '.    01570023
015800         10  LQW-ACTION                 PIC  X(03).               01580023
015900         10  LQW-RLTNSHP-CDE            PIC  X(02).               01590023
016000         10  LQW-RLTNSHP-NAME           PIC  X(30).               01600023
016100         10  LQW-COUNT                  PIC S9(05) COMP-3.        01610023
016200                                                                  01620023
016300*---------------------------------------------------------------* 01630023
016400*  RECORD LAYOUT FOR THE VENDOR RELATIONSHIP TEMP STORAGE QUEUE * 01640023
016500*---------------------------------------------------------------* 01650023
016600     COPY VNWS021.                                                01660023
016700                                                                  01670023
016800*---------------------------------------------------------------* 01680023
016900*    MAP LAYOUT                                                 * 01690023
017000*---------------------------------------------------------------* 01700023
017100     COPY VNKM031.                                                01710023
017200                                                                  01720023
017300 01  MR-OCCURS-LAYOUT                   REDEFINES  VN031AO.       01730023
017400     05  FILLER                         PIC X(74).                01740023
017500     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01750023
017600         10  MR-SELECTL                 PIC S9(04) COMP.          01760023
017700         10  MR-SELECTA                 PIC  X(01).               01770023
017800         10  MR-SELECTC                 PIC  X(01).               01780023
017900         10  MR-SELECTH                 PIC  X(01).               01790023
018000         10  MR-SELECTI                 PIC  X(01).               01800023
018100                                                                  01810023
018200         10  MR-ACTIONL                 PIC S9(04) COMP.          01820023
018300         10  MR-ACTIONA                 PIC  X(01).               01830023
018400         10  MR-ACTIONC                 PIC  X(01).               01840023
018500         10  MR-ACTIONH                 PIC  X(01).               01850023
018600         10  MR-ACTION                  PIC  X(03).               01860023
018700                                                                  01870023
018800         10  MR-RLTNSHP-NAMEL           PIC S9(04) COMP.          01880023
018900         10  MR-RLTNSHP-NAMEA           PIC  X(01).               01890023
019000         10  MR-RLTNSHP-NAMEC           PIC  X(01).               01900023
019100         10  MR-RLTNSHP-NAMEH           PIC  X(01).               01910023
019200         10  MR-RLTNSHP-NAME            PIC  X(30).               01920023
019300                                                                  01930023
019400         10  MR-COUNTL                  PIC S9(04) COMP.          01940023
019500         10  MR-COUNTA                  PIC  X(01).               01950023
019600         10  MR-COUNTC                  PIC  X(01).               01960023
019700         10  MR-COUNTH                  PIC  X(01).               01970023
019800         10  MR-COUNT-X.                                          01980023
019900             15  MR-COUNT               PIC  ZZZZZ.               01990023
020000                                                                  02000023
020100*---------------------------------------------------------------* 02010023
020200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02020023
020300*---------------------------------------------------------------* 02030023
020400     COPY DPWS015.                                                02040023
020500                                                                  02050023
020600*---------------------------------------------------------------* 02060023
020700*    FUNCTION KEYS COPYBOOK.                                    * 02070023
020800*---------------------------------------------------------------* 02080023
020900     COPY DPWS016.                                                02090023
021000                                                                  02100023
021100*---------------------------------------------------------------* 02110023
021200*    NUMERIC EDIT LAYOUT.                                       * 02120023
021300*---------------------------------------------------------------* 02130023
021400     COPY DPWS010I.                                               02140023
021500                                                                  02150023
021600*---------------------------------------------------------------* 02160023
021700*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02170036
021800*---------------------------------------------------------------* 02180023
021900     COPY DPWS030.                                                02190023
021900     COPY DPWS930.                                                02191036
022000                                                                  02200023
022100*---------------------------------------------------------------* 02210023
022200*    STANDARD COMMAREA.                                         * 02220023
022300*---------------------------------------------------------------* 02230023
022400     COPY DPWS020.                                                02240023
022500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02250023
022600*---------------------------------------------------------------* 02260023
022700* INTER-APPLICATION COMMAREA.                                   * 02270023
022800*   VNWS004 - IS THE INPUT LAYOUT WHEN COMING FROM THE VENDOR   * 02280023
022900*             HEADER SCREENS.                                   * 02290023
023000*   VNWS020 - IS THE INPUT LAYOUT FOR THE LIST PROGRAM AND THE  * 02300023
023100*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 02310023
023200*---------------------------------------------------------------* 02320023
023300         10  INTER-APPL-COMM-AREA       PIC X(200).               02330023
023400     COPY VNWS004.                                                02340023
023500     COPY VNWS020.                                                02350023
023600         10  ASC-SPECIFIC-COMMAREA.                               02360023
023700             15  ASC-LIST-KEYS.                                   02370023
023800                 20  ASC-KEY-ENT-ID                  PIC S9(09)   02380023
023900                                                     COMP.        02390023
024000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02400023
024100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02410023
024200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02420023
024300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02430023
024400                                                                  02440023
024500                 20  ASC-ITEM-ARRAY.                              02450023
024600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02460023
024700                         30  ASC-LIST-ITEM-NUMBER                 02470023
024800                                                     PIC S9(09)   02480023
024900                                                     COMP-3.      02490023
025000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02500023
025100                             88  ASC-VALID-SELECT    VALUE ' '    02510023
025200                                                           'S'    02520023
025300                                                           'B'    02530023
025400                                                           'E'.   02540023
025500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02550023
025600                             88  ASC-TEMP-SELECT     VALUE 'S'.   02560023
025700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02570023
025800                             88  ASC-TEMP-END        VALUE 'E'.   02580023
025900                         30  ASC-SELECTED-SW         PIC  X(01).  02590023
026000                             88  ASC-NO-SELECT       VALUE ' '.   02600023
026100                             88  ASC-SELECT          VALUE 'S'.   02610023
026200                             88  ASC-BEGIN           VALUE 'B'.   02620023
026300                             88  ASC-END             VALUE 'E'.   02630023
026400                         30  ASC-ACTION              PIC  X(03).  02640023
026500                         30  ASC-RLTNSHP-CDE         PIC  X(02).  02650023
026600                         30  ASC-RLTNSHP-NAME        PIC  X(30).  02660023
026700                         30  ASC-COUNT               PIC S9(05)   02670023
026800                                                          COMP-3. 02680023
026900                                                                  02690023
027000             15  ASC-BLK-SUB                         PIC S9(04)   02700023
027100                                                          COMP    02710023
027200                                                          SYNC.   02720023
027300             15  ASC-ITEM-SUB                        PIC S9(04)   02730023
027400                                                          COMP    02740023
027500                                                          SYNC.   02750023
027600             15  ASC-SEL-SUB                         PIC S9(04)   02760023
027700                                                          COMP.   02770023
027800             15  ASC-SEL-ITEM                        PIC S9(04)   02780023
027900                                                          COMP.   02790023
028000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02800023
028100                                                          COMP-3. 02810023
028200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02820023
028300                                                          COMP-3. 02830023
028400             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02840023
028500                                                          COMP-3. 02850023
028600             15  ASC-FIRST-ITEM-IN-ERROR             PIC S9(09)   02860023
028700                                                          COMP-3. 02870023
028800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02880023
028900                                                          COMP-3. 02890023
029000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02900023
029100                                                          COMP-3. 02910023
029200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02920023
029300                                                          COMP-3. 02930023
029400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02940023
029500                                                          COMP    02950023
029600                                                          SYNC.   02960023
029700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02970023
029800                                                          COMP-3. 02980023
029900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02990023
030000                                                          COMP-3. 03000023
030100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03010023
030200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03020023
030300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03030023
030400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03040023
030500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03050023
030600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03060023
030700             15  ASC-LONGNAME-FOUND-SW               PIC  X(01).  03070025
030800                 88  ASC-LONGNAME-FOUND              VALUE 'Y'.   03080025
030900                 88  ASC-LONGNAME-NOT-FOUND          VALUE 'N'.   03090025
031000             15  ASC-LIST-QUEUE-NAME.                             03100023
031100                 20  ASC-LIST-TERM-ID                PIC  X(04).  03110023
031200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03120023
031300                                                          COMP-3. 03130023
031400                 20  ASC-LIST-SEQ                    PIC  9(01).  03140023
031500             15  ASC-SEL-QUEUE-NAME-OUT.                          03150023
031600                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  03160023
031700                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   03170023
031800                                                          COMP-3. 03180023
031900                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  03190023
032000                                                                  03200023
032100             15  ASC-START-ITEM-REQUEST.                          03210023
032200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03220023
032300             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  03230023
032400                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   03240023
032500             15  ASC-DISPLAY-ENT-ID                  PIC  9(05).  03250023
032600             15  ASC-VENDOR-NAME                     PIC  X(30).  03260023
032700             15  ASC-VENDOR-ID                       PIC  X(09).  03270023
032800                                                                  03280023
032900*---------------------------------------------------------------* 03290023
033000*    ABEND PROCESSING COPYBOOK.                                 * 03300023
033100*---------------------------------------------------------------* 03310023
033200     COPY DPWS013.                                                03320023
033300                                                                  03330023
033400*---------------------------------------------------------------* 03340023
033500*    DB2 AREA FOR TENTNME                                       * 03350023
033600*---------------------------------------------------------------* 03360023
033700     EXEC SQL                                                     03370023
033800          INCLUDE TENTNME                                         03380023
033900     END-EXEC.                                                    03390023
034000                                                                  03400023
034100*---------------------------------------------------------------* 03410023
034200*    DB2 AREA FOR TEXTENT                                       * 03420023
034300*---------------------------------------------------------------* 03430023
034400     EXEC SQL                                                     03440023
034500          INCLUDE TEXTENT                                         03450023
034600     END-EXEC.                                                    03460023
034700                                                                  03470023
034800*---------------------------------------------------------------* 03480023
034900*    DB2 AREA FOR VNT_VND_RLTNSHP                               * 03490023
035000*---------------------------------------------------------------* 03500023
035100     EXEC SQL                                                     03510023
035200          INCLUDE VNT00000                                        03520023
035300     END-EXEC.                                                    03530023
035400                                                                  03540023
035500*---------------------------------------------------------------* 03550023
035600*    DB2 AREA FOR VNT_RLTNSHP_CDE                               * 03560023
035700*---------------------------------------------------------------* 03570023
035800     EXEC SQL                                                     03580023
035900          INCLUDE VNT00002                                        03590023
036000     END-EXEC.                                                    03600023
036100                                                                  03610023
036200*--------------------------------------------------------------*  03620025
036300* TABLE USED FOR EXISTENCE CHECKING                            *  03630025
036400*--------------------------------------------------------------*  03640025
036500     EXEC SQL                                                     03650025
036600          INCLUDE SYSDUMMY                                        03660025
036700     END-EXEC.                                                    03670025
036800                                                                  03680025
036900*---------------------------------------------------------------* 03690023
037000*    DB2 AREA FOR COMMUNICATIONS                                * 03700023
037100*---------------------------------------------------------------* 03710023
037200     EXEC SQL                                                     03720023
037300          INCLUDE SQLCA                                           03730023
037400     END-EXEC.                                                    03740023
037500                                                                  03750023
037600*---------------------------------------------------------------* 03760023
037700*   CURSOR TO SELECT VENDOR RELATIONSHIPS                       * 03770023
037800*---------------------------------------------------------------* 03780023
037900                                                                  03790023
038000     EXEC SQL                                                     03800023
038100         DECLARE RELATIONSHIP-CSR CURSOR FOR                      03810023
038200            SELECT VC.VND_RLTNSHP_CDE                             03820023
038300                  ,VC.VND_RLTNSHP_DESC                            03830023
038400                  ,COALESCE(VT1.COUNT,0)                          03840023
038500            FROM VNT_RLTNSHP_CDE VC                               03850023
038600             LEFT OUTER JOIN                                      03860023
038700           (SELECT B.VND_RLTNSHP_CDE                              03870023
038800                  ,COUNT (*) AS COUNT                             03880023
038900            FROM VNT_VND_RLTNSHP  B                               03890023
039000             WHERE ENT_ID = :DK-ENT-ID                            03900023
039100               AND EFF_END_DTE = :PC-MAX-DATE                     03910023
039200          GROUP BY B.VND_RLTNSHP_CDE) AS VT1                      03920023
039300               ON  VT1.VND_RLTNSHP_CDE = VC.VND_RLTNSHP_CDE       03930023
039400             WHERE ACTV_IND = 'Y'                                 03940023
039500          ORDER BY VC.VND_RLTNSHP_DESC                            03950023
039600                                                                  03960023
039700     END-EXEC.                                                    03970023
039800                                                                  03980023
039900 LINKAGE SECTION.                                                 03990023
040000                                                                  04000023
040100 01  DFHCOMMAREA.                                                 04010023
040200     05  FILLER  OCCURS 1 TO 4072 TIMES                           04020023
040300                 DEPENDING ON EIBCALEN.                           04030023
040400         10  FILLER  PIC X.                                       04040023
040500                                                                  04050023
040600 PROCEDURE DIVISION.                                              04060023
040700***************************************************************** 04070023
040800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04080023
040900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04090023
041000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04100023
041100***************************************************************** 04110023
041200 0000-MAIN-MODULE.                                                04120023
041300                                                                  04130023
041400     INITIALIZE DP030-CICS-API-FIELDS.                            04140023
041500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04150023
041600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04160023
041700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04170023
041800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04180023
041900     MOVE LENGTH OF VN031AI        TO DP030-MAP-LENGTH (1).       04190023
042000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04200023
042100     PERFORM 0001-CALL-CICS-ARCH-API.                             04210023
042200                                                                  04220023
042300     PERFORM 1000-CONTROL-PROCESSING                              04230023
042400                                                                  04240023
042500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04250023
042600     PERFORM 0001-CALL-CICS-ARCH-API.                             04260023
042700                                                                  04270023
042800***************************************************************** 04280023
042900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04290023
043000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04300023
043100***************************************************************** 04310023
043200 0001-CALL-CICS-ARCH-API.                                         04320023
043300                                                                  04330023
043400*    CALL 'DPKCS030' USING DFHEIBLK                               04340036
043400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04341036
043500                           DFHCOMMAREA                            04350023
043600                           DP030-CICS-API-FIELDS                  04360023
043700                           DP020-STANDARD-COMMAREA                04370023
043800                           VN031AI.                               04380023
043900                                                                  04390023
044000     IF  DP030-RC-CALL-SUCCESSFUL                                 04400023
044100         CONTINUE                                                 04410023
044200     ELSE                                                         04420023
044300         SET DP013-NO-ROLLBACK                                    04430023
044400             DP013-XCTL-DISPLAY-RESTART                           04440023
044500             DP013-CICS-ABEND      TO TRUE                        04450023
044600         MOVE '0001-CALL-CICS-ARCH-API'                           04460023
044700                                   TO DP013-PARAGRAPH             04470023
044800*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04480036
044900*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04490037
044800         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04491036
044900-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04492036
045000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04500023
045100         PERFORM DP013-0000-PROCESS-ABEND                         04510023
045200     END-IF.                                                      04520023
045300                                                                  04530023
045400*----------------------------------------------------------------*04540023
045500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04550023
045600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04560023
045700*                                                                *04570023
045800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04580023
045900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04590023
046000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04600023
046100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04610023
046200*----------------------------------------------------------------*04620023
046300 1000-CONTROL-PROCESSING.                                         04630023
046400                                                                  04640023
046500     EVALUATE TRUE                                                04650023
046600         WHEN DP020-NEXT-ACT-INITIAL                              04660023
046700             INITIALIZE ASC-SPECIFIC-COMMAREA                     04670023
046800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04680023
046900                                      ASC-SEL-TERM-ID-OUT         04690023
047000             MOVE DP020-SRC-TASK-NUMBER                           04700023
047100                                   TO ASC-LIST-TASK-NUMBER        04710023
047200                                      ASC-SEL-TASK-NUMBER-OUT     04720023
047300             MOVE PC-LIST-QUEUE-SEQ                               04730023
047400                                   TO ASC-LIST-SEQ                04740023
047500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             04750023
047600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04760023
047700             IF  PS-COMMAREA-NOT-VALID                            04770023
047800                 SET DP020-MSG-FATAL                              04780023
047900                     DP020-NEXT-ACT-APPL-ERROR                    04790023
048000                                   TO TRUE                        04800023
048100             ELSE                                                 04810023
048200                 PERFORM 4000-BUILD-INITIAL-PANEL                 04820023
048300                 IF ASC-NUMBER-OF-ITEMS-READ = ZERO               04830023
048400                     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE        04840023
048500                     MOVE PC-TSYMSG-00148                         04850023
048600                                   TO DP020-MSG-NUMBER            04860023
048700                     SET DP020-MSG-WARNING TO TRUE                04870023
048800                 END-IF                                           04880023
048900             END-IF                                               04890023
049000                                                                  04900023
049100         WHEN DP020-NEXT-ACT-READ-MAP                             04910023
049200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04920023
049300                                   TO PV-TOP-ITEM                 04930023
049400             PERFORM 2000-PROCESS-PANEL                           04940023
049500                                                                  04950023
049600         WHEN DP020-NEXT-ACT-RETURN                               04960023
049700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04970023
049800                                   TO PV-TOP-ITEM                 04980023
049900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04990023
050000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05000023
050100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05010023
050200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05020023
050300                                                                  05030023
050400         WHEN OTHER                                               05040023
050500             SET DP013-LOGIC-ABEND TO TRUE                        05050023
050600             SET DP013-NO-ROLLBACK TO TRUE                        05060023
050700             MOVE '1000-CONTROL-PROCESSING'                       05070023
050800                                   TO DP013-PARAGRAPH             05080023
050900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05090023
051000                                   TO DP013-MESSAGE-TEXT(1)       05100023
051100             PERFORM DP013-0000-PROCESS-ABEND                     05110023
051200     END-EVALUATE.                                                05120023
051300                                                                  05130023
051400*----------------------------------------------------------------*05140023
051500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05150023
051600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05160023
051700*----------------------------------------------------------------*05170023
051800 1100-PROCESS-INTER-APPL-COMM.                                    05180023
051900                                                                  05190023
052000     MOVE SPACE TO ASC-START-ITEM-REQUEST.                        05200023
052100     EVALUATE DP020-INT-APPL-FORMAT-IND                           05210023
052200         WHEN PC-INTER-APPL-VEND-DTL                              05220023
052300             MOVE VN004-ENT-ID TO ASC-KEY-ENT-ID                  05230023
052400                                  DK-ENT-ID                       05240023
052500             PERFORM 1110-SELECT-ENTERPRISE-NAME                  05250023
052600                                                                  05260023
052700         WHEN OTHER                                               05270023
052800             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            05280023
052900             SET PS-COMMAREA-NOT-VALID                            05290023
053000                                   TO TRUE                        05300023
053100     END-EVALUATE.                                                05310023
053200                                                                  05320023
053300 1110-SELECT-ENTERPRISE-NAME.                                     05330023
053400                                                                  05340023
053500     PERFORM                                                      05350023
053600         WITH TEST AFTER                                          05360023
053700         VARYING PV-RETRY-COUNTER                                 05370023
053800         FROM 1 BY 1                                              05380023
053900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05390023
054000            OR (SQLCODE = +0))                                    05400023
054100                                                                  05410023
054200         EXEC SQL                                                 05420023
054300             SELECT A.ENT_NAME_DESC                               05430023
054400                  , B.DUN_NBR                                     05440023
054500              INTO  :ENTNME-ENT-NAME-DESC                         05450023
054600                  , :EXTENT-DUN-NBR                               05460023
054700              FROM  TENTNME A                                     05470023
054800                 ,  TEXTENT B                                     05480023
054900              WHERE A.ENT_ID   = :DK-ENT-ID                       05490023
055000                AND A.ENT_ID   = B.ENT_ID                         05500023
055100                AND A.TYPE_CDE = '01'                             05510023
055200         END-EXEC                                                 05520023
055300                                                                  05530023
055400         EVALUATE TRUE                                            05540023
055500             WHEN SQLCODE = ZERO                                  05550023
055600             WHEN SQLCODE = +100                                  05560023
055700             WHEN SQLCODE = -904                                  05570023
055800             WHEN SQLCODE = -913                                  05580023
055900                 CONTINUE                                         05590023
056000             WHEN SQLWARN0 NOT = SPACES                           05600023
056100             WHEN SQLCODE < ZERO                                  05610023
056200             WHEN SQLCODE > ZERO                                  05620023
056300                 MOVE '1110-SELECT-ENTERPRISE-NAME'               05630023
056400                                   TO DP013-PARAGRAPH             05640023
056500                 MOVE 'SELECT ENTERPRISE NAME'                    05650023
056600                                   TO DP013-MESSAGE-TEXT (1)      05660023
056700                 MOVE SQLCA        TO DP013-SQLCA                 05670023
056800                 MOVE 'TENTNME'    TO DP013-SQLCA                 05680023
056900                 SET DP013-DB2-ABEND                              05690023
057000                     DP013-XCTL-DISPLAY-RESTART                   05700023
057100                                   TO TRUE                        05710023
057200                 PERFORM DP013-0000-PROCESS-ABEND                 05720023
057300         END-EVALUATE                                             05730023
057400     END-PERFORM.                                                 05740023
057500                                                                  05750023
057600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05760023
057700         MOVE '1110-SELECT-ENTERPRISE-NAME'                       05770023
057800                                   TO DP013-PARAGRAPH             05780023
057900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05790023
058000                                   TO DP013-MESSAGE-TEXT (1)      05800023
058100         MOVE 'ENTERPRISE NAME'    TO DP013-MESSAGE-TEXT (2)      05810023
058200         MOVE SQLCA                TO DP013-SQLCA                 05820023
058300         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    05830023
058400         SET DP013-DB2-ABEND                                      05840023
058500             DP013-XCTL-DISPLAY-RESTART                           05850023
058600                                   TO TRUE                        05860023
058700         PERFORM DP013-0000-PROCESS-ABEND                         05870023
058800     END-IF.                                                      05880023
058900                                                                  05890023
059000     IF SQLCODE = ZERO                                            05900023
059100          SET PS-COMMAREA-VALID    TO TRUE                        05910023
059200          MOVE ENTNME-ENT-NAME-DESC                               05920023
059300                                   TO ASC-VENDOR-NAME             05930023
059400          MOVE EXTENT-DUN-NBR      TO ASC-VENDOR-ID               05940023
059500     ELSE                                                         05950023
059600          MOVE PC-TSYMSG-00398     TO DP020-MSG-NUMBER            05960023
059700          SET PS-COMMAREA-NOT-VALID                               05970023
059800                                   TO TRUE                        05980023
059900     END-IF.                                                      05990023
060000                                                                  06000023
060100*----------------------------------------------------------------*06010023
060200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06020023
060300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06030023
060400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06040023
060500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06050023
060600* FUNCTION KEYS CAN GET THIS FAR.                                *06060023
060700*----------------------------------------------------------------*06070023
060800 2000-PROCESS-PANEL.                                              06080023
060900                                                                  06090023
061000     EVALUATE TRUE                                                06100023
061100         WHEN DP020-SRC-AID = DP016-CLEAR                         06110023
061200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06120023
061300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06130023
061400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06140023
061500                                                                  06150023
061600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06160023
061700             MOVE ASC-KEY-ENT-ID   TO DK-ENT-ID                   06170023
061800             PERFORM 2050-DELETE-LIST-QUEUE                       06180023
061900             PERFORM 4000-BUILD-INITIAL-PANEL                     06190023
062000                                                                  06200023
062100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06210023
062200             PERFORM 2140-DESELECT-ALL-ITEMS                      06220023
062300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06230023
062400                                                                  06240023
062500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06250023
062600             PERFORM 2150-SELECT-ALL-ITEMS                        06260023
062700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06270023
062800                                                                  06280023
062900         WHEN OTHER                                               06290023
063000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06300026
063100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06310023
063200             IF  PS-NO-ERROR                                      06320023
063300                 SET DP030-CONTINUE-GO                            06330023
063400                                   TO TRUE                        06340023
063500                 PERFORM 2100-CHECK-FUNCTION-KEY                  06350023
063600             ELSE                                                 06360023
063700                 SET DP030-OVERRIDE-GO                            06370023
063800                                 TO TRUE                          06380023
063900             END-IF                                               06390023
064000     END-EVALUATE.                                                06400023
064100                                                                  06410023
064200*----------------------------------------------------------------*06420023
064300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06430023
064400*----------------------------------------------------------------*06440023
064500 2050-DELETE-LIST-QUEUE.                                          06450023
064600                                                                  06460023
064700     EXEC CICS                                                    06470023
064800         DELETEQ TS                                               06480023
064900             QUEUE (ASC-LIST-QUEUE-NAME)                          06490023
065000             RESP  (PV-CICS-RESP)                                 06500023
065100     END-EXEC.                                                    06510023
065200                                                                  06520023
065300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06530023
065400        (PV-CICS-RESP = DFHRESP(QIDERR))                          06540023
065500         CONTINUE                                                 06550023
065600     ELSE                                                         06560023
065700         SET DP013-CICS-ABEND      TO TRUE                        06570023
065800         SET DP013-NO-ROLLBACK     TO TRUE                        06580023
065900                                                                  06590023
066000         MOVE '2050-DELETE-LIST-QUEUE'                            06600023
066100                                   TO DP013-PARAGRAPH             06610023
066200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06620023
066300                                   TO DP013-MESSAGE-TEXT (1)      06630023
066400         PERFORM DP013-0000-PROCESS-ABEND                         06640023
066500     END-IF.                                                      06650023
066600                                                                  06660023
066700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06670023
066800                                                                  06680023
066900*----------------------------------------------------------------*06690023
067000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06700023
067100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06710023
067200* CICS ARCHITECTURE API.                                         *06720023
067300*----------------------------------------------------------------*06730023
067400 2100-CHECK-FUNCTION-KEY.                                         06740023
067500                                                                  06750023
067600     EVALUATE TRUE                                                06760023
067700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06770023
067800             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06780023
067900                 PERFORM 2900-PREPARE-COMMAREA                    06790023
068000                 PERFORM 2500-CHECK-PARTNER-STATS                 06800026
068100             ELSE                                                 06810023
068200                 SET DP030-SET-CURSOR-APPL-1                      06820023
068300                     DP030-OVERRIDE-GO   TO TRUE                  06830023
068400*      ---- A LIST ITEM MUST BE SELECTED   -----------            06840023
068500                 MOVE PC-TSYMSG-00057                             06850023
068600                                   TO DP020-MSG-NUMBER            06860023
068700                 SET DP020-MSG-FATAL                              06870023
068800                                   TO TRUE                        06880023
068900                 MOVE -1  TO MR-SELECTL (1)                       06890023
069000             END-IF                                               06900023
069100                                                                  06910023
069200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06920025
069300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06930025
069400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06940025
069500                 SET PS-NO-VALID-SELECT    TO TRUE                06950025
069600                 PERFORM 2300-SELECTION-EDITS                     06960025
069700                 IF PS-VALID-SELECT                               06970025
069800                     PERFORM 2900-PREPARE-COMMAREA                06980025
069900                     IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)    06990029
070000                        PERFORM 2500-CHECK-PARTNER-STATS          07000029
070100                     END-IF                                       07010029
070200                 ELSE                                             07020025
070300                     SET DP030-OVERRIDE-GO                        07030025
070400                         DP030-SET-CURSOR-APPL-1                  07040025
070500                         DP020-MSG-FATAL  TO TRUE                 07050025
070600                     MOVE -1  TO MR-SELECTL (1)                   07060025
070700                     MOVE PC-TSYMSG-03374 TO DP020-MSG-NUMBER     07070025
070800                 END-IF                                           07080025
070900             ELSE                                                 07090025
071000                 SET DP030-SET-CURSOR-APPL-1                      07100025
071100                     DP030-OVERRIDE-GO   TO TRUE                  07110025
071200*      ---- A LIST ITEM MUST BE SELECTED   -----------            07120025
071300                 MOVE PC-TSYMSG-00057                             07130025
071400                                   TO DP020-MSG-NUMBER            07140025
071500                 SET DP020-MSG-FATAL                              07150025
071600                                   TO TRUE                        07160025
071700                 MOVE -1  TO MR-SELECTL (1)                       07170025
071800             END-IF                                               07180025
071900                                                                  07190025
072000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07200025
072100             MOVE +1               TO PV-TOP-ITEM                 07210025
072200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07220025
072300             PERFORM 3200-RESET-ATTRIBUTES                        07230025
072400                                                                  07240025
072500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07250025
072600             PERFORM 2110-BROWSE-BACKWARD                         07260025
072700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07270025
072800             PERFORM 3200-RESET-ATTRIBUTES                        07280025
072900                                                                  07290025
073000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07300025
073100             PERFORM 2120-BROWSE-FORWARD                          07310025
073200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07320025
073300             PERFORM 3200-RESET-ATTRIBUTES                        07330025
073400                                                                  07340025
073500         WHEN DP020-SRC-AID = DP016-ENTER                         07350025
073600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07360025
073700             IF  PS-ERROR                                         07370025
073800                 CONTINUE                                         07380025
073900             ELSE                                                 07390025
074000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07400025
074100             END-IF                                               07410025
074200                                                                  07420025
074300         WHEN OTHER                                               07430025
074400             SET DP013-NO-ROLLBACK                                07440025
074500                 DP013-XCTL-DISPLAY-RESTART                       07450025
074600                 DP013-CICS-ABEND  TO TRUE                        07460025
074700             MOVE '2100-CHECK-FUNCTION-KEY'                       07470025
074800                                   TO DP013-PARAGRAPH             07480025
074900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07490025
075000                                   TO DP013-MESSAGE-TEXT (1)      07500025
075100             PERFORM DP013-0000-PROCESS-ABEND                     07510025
075200     END-EVALUATE.                                                07520025
075300                                                                  07530025
075400*----------------------------------------------------------------*07540025
075500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07550025
075600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07560025
075700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07570025
075800*    MESSAGE.                                                    *07580025
075900*----------------------------------------------------------------*07590025
076000 2110-BROWSE-BACKWARD.                                            07600025
076100                                                                  07610025
076200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07620025
076300         GIVING PV-TOP-ITEM.                                      07630025
076400                                                                  07640025
076500     IF  ((PV-TOP-ITEM < +1)                                      07650025
076600       OR (PV-TOP-ITEM = +1))                                     07660025
076700         MOVE +1                   TO PV-TOP-ITEM                 07670025
076800*        -- TOP OF LIST --                                        07680025
076900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07690025
077000         SET DP020-MSG-INFORMATIONAL TO TRUE                      07700025
077100     END-IF.                                                      07710025
077200                                                                  07720025
077300*----------------------------------------------------------------*07730025
077400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07740025
077500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07750025
077600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07760025
077700*----------------------------------------------------------------*07770025
077800 2120-BROWSE-FORWARD.                                             07780025
077900                                                                  07790025
078000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07800025
078100         GIVING PV-TOP-ITEM.                                      07810025
078200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07820025
078300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07830025
078400                                   TO PV-TOP-ITEM                 07840025
078500*        -- BOTTOM OF LIST --                                     07850025
078600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07860025
078700         SET DP020-MSG-INFORMATIONAL                              07870025
078800                                   TO TRUE                        07880025
078900     ELSE                                                         07890025
079000         COMPUTE PV-BOTTOM-ITEM =                                 07900025
079100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07910025
079200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07920025
079300*            -- BOTTOM OF LIST --                                 07930025
079400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07940025
079500             SET DP020-MSG-INFORMATIONAL                          07950025
079600                                   TO TRUE                        07960025
079700         END-IF                                                   07970025
079800     END-IF.                                                      07980025
079900                                                                  07990025
080000*----------------------------------------------------------------*08000025
080100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08010025
080200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08020025
080300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08030025
080400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08040025
080500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08050025
080600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08060025
080700*----------------------------------------------------------------*08070025
080800 2130-CHECK-FOR-JUMP-BROWSE.                                      08080025
080900                                                                  08090025
081000     SET PS-NO-ERROR               TO TRUE.                       08100025
081100     IF (ASC-START-ITEM-REQUEST = SPACE)                          08110025
081200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08120025
081300                                   TO PV-TOP-ITEM                 08130025
081400     ELSE                                                         08140025
081500         MOVE ASC-START-ITEM-REQUEST                              08150025
081600                                   TO DP010I-UNEDITED-FIELD       08160025
081700         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08170025
081800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08180025
081900         SET DP010I-NEGATIVE-NOT-ALLOWED                          08190025
082000                                   TO TRUE                        08200025
082110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08211033
082120                         USING DP010I-NUMERIC-EDIT-AREA           08212033
082200                                                                  08220025
082300         IF  NOT DP010I-ERROR-DETECTED                            08230025
082400             MOVE DP010I-NUMERIC-FIELD                            08240025
082500                                   TO  ASC-START-ITEM-REQUEST-N   08250025
082600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08260025
082700                 IF  ASC-START-ITEM-REQUEST-N >                   08270025
082800                                          ASC-NUMBER-OF-ITEMS-READ08280025
082900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08290025
083000                     COMPUTE PV-TOP-ITEM =                        08300025
083100                             ASC-NUMBER-OF-ITEMS-READ             08310025
083200                             - PC-ITEMS-PER-PANEL + 1             08320025
083300                     IF  PV-TOP-ITEM < +1                         08330025
083400                         MOVE +1   TO PV-TOP-ITEM                 08340025
083500                         MOVE PC-TSYMSG-00070                     08350025
083600                                   TO DP020-MSG-NUMBER            08360025
083700                         SET DP020-MSG-INFORMATIONAL              08370025
083800                                   TO TRUE                        08380025
083900                     END-IF                                       08390025
084000                 ELSE                                             08400025
084100                     MOVE ASC-START-ITEM-REQUEST-N                08410025
084200                                   TO PV-TOP-ITEM                 08420025
084300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08430025
084400                     COMPUTE PV-BOTTOM-ITEM =                     08440025
084500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08450025
084600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08460025
084700*                        -- BOTTOM OF LIST --                     08470025
084800                         MOVE PC-TSYMSG-00070                     08480025
084900                                   TO DP020-MSG-NUMBER            08490025
085000                         SET DP020-MSG-INFORMATIONAL              08500025
085100                                   TO TRUE                        08510025
085200                     END-IF                                       08520025
085300                 END-IF                                           08530025
085400             ELSE                                                 08540025
085500*                --- VALUE OUT OF RANGE ----                      08550025
085600                 MOVE PC-TSYMSG-00101                             08560025
085700                                   TO DP020-MSG-NUMBER            08570025
085800                 MOVE -1           TO ASTRTITL                    08580025
085900                 SET DP030-SET-CURSOR-APPL-1                      08590025
086000                                   TO TRUE                        08600025
086100                 MOVE DP015-REVERSE                               08610025
086200                                   TO ASTRTITH                    08620025
086300                 MOVE DP015-RED    TO ASTRTITC                    08630025
086400                 MOVE DP015-UNP-NUM-BRT-MDT                       08640025
086500                                   TO ASTRTITA                    08650025
086600                 SET DP020-MSG-FATAL                              08660025
086700                                   TO TRUE                        08670025
086800                 SET PS-ERROR      TO TRUE                        08680025
086900             END-IF                                               08690025
087000                                                                  08700025
087100         ELSE                                                     08710025
087200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08720025
087300             MOVE -1               TO ASTRTITL                    08730025
087400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08740025
087500             MOVE DP015-REVERSE    TO ASTRTITH                    08750025
087600             MOVE DP015-RED        TO ASTRTITC                    08760025
087700             MOVE DP015-UNP-NUM-BRT-MDT                           08770025
087800                                   TO ASTRTITA                    08780025
087900             SET DP020-MSG-FATAL   TO TRUE                        08790025
088000             SET PS-ERROR          TO TRUE                        08800025
088100         END-IF                                                   08810025
088200     END-IF.                                                      08820025
088300                                                                  08830025
088400*----------------------------------------------------------------*08840025
088500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08850025
088600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08860025
088700*----------------------------------------------------------------*08870025
088800 2140-DESELECT-ALL-ITEMS.                                         08880025
088900                                                                  08890025
089000     MOVE +1                       TO ASC-BLK-SUB.                08900025
089100                                                                  08910025
089200     PERFORM 2141-CLEAR-SELECTED-INDS                             08920025
089300         VARYING ASC-ITEM-SUB                                     08930025
089400         FROM 1 BY 1                                              08940025
089500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08950025
089600                                                                  08960025
089700     ADD +1                        TO ASC-BLK-SUB.                08970025
089800                                                                  08980025
089900     PERFORM 2141-CLEAR-SELECTED-INDS                             08990025
090000         VARYING ASC-ITEM-SUB                                     09000025
090100         FROM 1 BY 1                                              09010025
090200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09020025
090300                                                                  09030025
090400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09040025
090500                                   TO PV-LIST-ITEM-NUMBER.        09050025
090600                                                                  09060025
090700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09070025
090800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09080025
090900                                                                  09090025
091000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09100025
091100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09110025
091200         MOVE +1                   TO ASC-BLK-SUB                 09120025
091300                                                                  09130025
091400         PERFORM 5100-WRITE-TEMP-STORAGE                          09140025
091500                                                                  09150025
091600         MOVE +1                   TO PV-BLOCK-NUMBER             09160025
091700                                                                  09170025
091800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09180025
091900             PV-FIRST-BLOCK-IN-ARRAY - 1                          09190025
092000                                                                  09200025
092100         PERFORM                                                  09210025
092200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09220025
092300                                                                  09230025
092400             PERFORM 4410-READ-TEMP-STORAGE                       09240025
092500                                                                  09250025
092600             PERFORM 2141-CLEAR-SELECTED-INDS                     09260025
092700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09270025
092800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09280025
092900                                                                  09290025
093000             PERFORM 5100-WRITE-TEMP-STORAGE                      09300025
093100                                                                  09310025
093200             ADD +1                TO PV-BLOCK-NUMBER             09320025
093300                                                                  09330025
093400         END-PERFORM                                              09340025
093500                                                                  09350025
093600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09360025
093700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09370025
093800                                                                  09380025
093900         PERFORM                                                  09390025
094000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09400025
094100                   ASC-HIGHEST-BLOCK-WRITTEN                      09410025
094200                                                                  09420025
094300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09430025
094400                                   TO PV-BLOCK-NUMBER             09440025
094500                                                                  09450025
094600             PERFORM 4410-READ-TEMP-STORAGE                       09460025
094700                                                                  09470025
094800             PERFORM 2141-CLEAR-SELECTED-INDS                     09480025
094900                 VARYING ASC-ITEM-SUB                             09490025
095000                 FROM 1 BY 1                                      09500025
095100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09510025
095200                                                                  09520025
095300             PERFORM 5100-WRITE-TEMP-STORAGE                      09530025
095400                                                                  09540025
095500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09550025
095600                                                                  09560025
095700         END-PERFORM                                              09570025
095800                                                                  09580025
095900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09590025
096000                                   TO PV-BLOCK-NUMBER             09600025
096100                                                                  09610025
096200         PERFORM 4410-READ-TEMP-STORAGE                           09620025
096300     END-IF.                                                      09630025
096400                                                                  09640025
096500     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS09650025
096600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 09660025
096700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09670025
096800                                                                  09680025
096900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09690025
097000                                                                  09700025
097100*----------------------------------------------------------------*09710025
097200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09720025
097300*----------------------------------------------------------------*09730025
097400 2141-CLEAR-SELECTED-INDS.                                        09740025
097500                                                                  09750025
097600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09760025
097700             NOT EQUAL ZERO                                       09770025
097800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09780025
097900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09790025
098000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09800025
098100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09810025
098200                                   TO TRUE                        09820025
098300         END-IF                                                   09830025
098400     END-IF.                                                      09840025
098500                                                                  09850025
098600*----------------------------------------------------------------*09860025
098700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09870025
098800*  FOR ALL ITEMS.                                                *09880025
098900*----------------------------------------------------------------*09890025
099000 2150-SELECT-ALL-ITEMS.                                           09900025
099100                                                                  09910025
099200     MOVE +1                       TO ASC-BLK-SUB.                09920025
099300                                                                  09930025
099400     PERFORM 2151-SET-SELECTED-INDS                               09940025
099500         VARYING ASC-ITEM-SUB                                     09950025
099600         FROM 1 BY 1                                              09960025
099700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09970025
099800                                                                  09980025
099900     ADD +1                        TO ASC-BLK-SUB.                09990025
100000                                                                  10000025
100100     PERFORM 2151-SET-SELECTED-INDS                               10010025
100200         VARYING ASC-ITEM-SUB                                     10020025
100300         FROM 1 BY 1                                              10030025
100400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10040025
100500                                                                  10050025
100600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10060025
100700                                   TO PV-LIST-ITEM-NUMBER.        10070025
100800                                                                  10080025
100900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10090025
101000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10100025
101100                                                                  10110025
101200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10120025
101300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10130025
101400         MOVE +1                   TO ASC-BLK-SUB                 10140025
101500                                                                  10150025
101600         PERFORM 5100-WRITE-TEMP-STORAGE                          10160025
101700                                                                  10170025
101800         MOVE +1                   TO PV-BLOCK-NUMBER             10180025
101900                                                                  10190025
102000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10200025
102100             PV-FIRST-BLOCK-IN-ARRAY - 1                          10210025
102200                                                                  10220025
102300         PERFORM                                                  10230025
102400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10240025
102500                                                                  10250025
102600             PERFORM 4410-READ-TEMP-STORAGE                       10260025
102700                                                                  10270025
102800             PERFORM 2151-SET-SELECTED-INDS                       10280025
102900                 VARYING ASC-ITEM-SUB                             10290025
103000                 FROM 1 BY 1                                      10300025
103100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10310025
103200                                                                  10320025
103300             PERFORM 5100-WRITE-TEMP-STORAGE                      10330025
103400                                                                  10340025
103500             ADD +1                TO PV-BLOCK-NUMBER             10350025
103600                                                                  10360025
103700         END-PERFORM                                              10370025
103800                                                                  10380025
103900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10390025
104000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10400025
104100                                                                  10410025
104200         PERFORM                                                  10420025
104300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10430025
104400                   ASC-HIGHEST-BLOCK-WRITTEN                      10440025
104500                                                                  10450025
104600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10460025
104700                                   TO PV-BLOCK-NUMBER             10470025
104800                                                                  10480025
104900             PERFORM 4410-READ-TEMP-STORAGE                       10490025
105000                                                                  10500025
105100             PERFORM 2151-SET-SELECTED-INDS                       10510025
105200                 VARYING ASC-ITEM-SUB                             10520025
105300                 FROM 1 BY 1                                      10530025
105400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10540025
105500                                                                  10550025
105600             PERFORM 5100-WRITE-TEMP-STORAGE                      10560025
105700                                                                  10570025
105800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10580025
105900                                                                  10590025
106000         END-PERFORM                                              10600025
106100                                                                  10610025
106200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10620025
106300                                   TO PV-BLOCK-NUMBER             10630025
106400                                                                  10640025
106500         PERFORM 4410-READ-TEMP-STORAGE                           10650025
106600     END-IF.                                                      10660025
106700                                                                  10670025
106800                                                                  10680025
106900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10690025
107000                       ASC-NUMBER-OF-SELECTED-ITEMS.              10700025
107100                                                                  10710025
107200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10720025
107300                                                                  10730025
107400*----------------------------------------------------------------*10740025
107500*    MARK EACH ITEM AS BEING SELECTED.                           *10750025
107600*----------------------------------------------------------------*10760025
107700 2151-SET-SELECTED-INDS.                                          10770025
107800                                                                  10780025
107900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10790025
108000             NOT EQUAL ZERO                                       10800025
108100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10810025
108200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10820025
108300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10830025
108400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10840025
108500                               TO  TRUE                           10850025
108600         END-IF                                                   10860025
108700     END-IF.                                                      10870025
108800                                                                  10880025
108900***************************************************************** 10890025
109000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    * 10900025
109100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. * 10910025
109200***************************************************************** 10920025
109300 2200-MOVE-SCREEN-TO-COMMAREA.                                    10930025
109400                                                                  10940025
109500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10950025
109600     MOVE +1                       TO PV-SUB.                     10960025
109700                                                                  10970025
109800     PERFORM 3100-SET-SUBSCRIPTS.                                 10980025
109900     IF  ASTRTITL > ZERO                                          10990025
110000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11000025
110100     ELSE                                                         11010025
110200         IF  ASTRTITF = DP015-ERASE-EOF                           11020025
110300             INITIALIZE ASC-START-ITEM-REQUEST                    11030025
110400         END-IF                                                   11040025
110500     END-IF.                                                      11050025
110600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11060025
110700         VARYING PV-SUB                                           11070025
110800         FROM 1 BY 1                                              11080025
110900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11090025
111000                                                                  11100025
111100***************************************************************** 11110025
111200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA* 11120025
111300***************************************************************** 11130025
111400 2210-MOVE-LINES-TO-COMMAREA.                                     11140025
111500                                                                  11150025
111600     IF  MR-SELECTL (PV-SUB) > ZERO                               11160025
111700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11170025
111800         MOVE MR-SELECTI (PV-SUB)                                 11180025
111900                                   TO ASC-TEMP-SELECTED-SW        11190025
112000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11200025
112100     ELSE                                                         11210025
112200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11220025
112300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11230025
112400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11240025
112500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11250025
112600         END-IF                                                   11260025
112700     END-IF.                                                      11270025
112800     ADD +1                        TO ASC-ITEM-SUB.               11280025
112900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11290025
113000         ADD +1                    TO ASC-BLK-SUB                 11300025
113100         MOVE +1                   TO ASC-ITEM-SUB                11310025
113200     END-IF.                                                      11320025
113300                                                                  11330025
113400*----------------------------------------------------------------*11340025
113500* DRIVE THE EDIT CHECK PROCESS FOR ITEMS SELECTED FOR 'INQUIRE'  *11350025
113600* OR 'UPDATE'                                                    *11360025
113700*----------------------------------------------------------------*11370025
113800 2300-SELECTION-EDITS.                                            11380025
113900     MOVE +1                   TO  ASC-BLK-SUB.                   11390025
114000     PERFORM 5100-WRITE-TEMP-STORAGE.                             11400025
114100     ADD +1                    TO  ASC-BLK-SUB.                   11410025
114200     PERFORM 5100-WRITE-TEMP-STORAGE.                             11420025
114300     PERFORM 2310-CHECK-SELECTS                                   11430025
114400         VARYING PV-ITEM                                          11440025
114500         FROM 1 BY 1                                              11450025
114600         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         11460025
114700                                                                  11470025
114800*----------------------------------------------------------------*11480025
114900* READ A LIST QUEUE RECORD AND CHECK THAT THE RELATIONSHIP HAS   *11490025
115000* A CURRENTLY EFFECTIVE OR AN EXPIRED ROW FOR THIS VENDOR        *11500025
115100*----------------------------------------------------------------*11510025
115200 2310-CHECK-SELECTS.                                              11520025
115300     PERFORM 6112-READ-LIST-QUEUE.                                11530025
115400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       11540025
115500         PERFORM                                                  11550025
115600         VARYING LQW-IDX                                          11560025
115700         FROM 1 BY 1                                              11570025
115800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            11580025
115900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          11590025
116000             IF  LQW-SELECT (LQW-IDX)                             11600025
116100                 MOVE ASC-KEY-ENT-ID            TO DK-ENT-ID      11610025
116200                 MOVE LQW-RLTNSHP-CDE (LQW-IDX) TO DK-RLTNSHP-CDE 11620025
116300                 PERFORM 2400-CHECK-EFFECTIVE                     11630025
116400             END-IF                                               11640025
116500         END-PERFORM                                              11650025
116600     END-IF.                                                      11660025
116700                                                                  11670025
116800*----------------------------------------------------------------*11680025
116900* CHECK FOR A CURRENTLY EFFECTIVE ROW FOR THE VENDOR BEING       *11690025
117000* PROCESSED, AND THE SELECTED RELATIONSHIP.                      *11700025
117100*----------------------------------------------------------------*11710025
117200 2400-CHECK-EFFECTIVE.                                            11720025
117300     PERFORM                                                      11730025
117400         WITH TEST AFTER                                          11740025
117500         VARYING PV-RETRY-COUNTER                                 11750025
117600         FROM 1 BY 1                                              11760025
117700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11770025
117800                   OR (SQLCODE = ZERO)                            11780025
117900                   OR (SQLCODE = +100)                            11790025
118000                   OR (SQLCODE = -811))                           11800025
118100                                                                  11810025
118200         EXEC SQL                                                 11820025
118300             SELECT  '1'                                          11830025
118400               INTO  :PV-DUMMY-SELECT                             11840025
118500               FROM VNT_VND_RLTNSHP                               11850025
118600              WHERE ENT_ID = :DK-ENT-ID                           11860025
118700                AND VND_RLTNSHP_CDE = :DK-RLTNSHP-CDE             11870025
118800                AND EFF_END_DTE = :PC-MAX-DATE                    11880025
118900         END-EXEC                                                 11890025
119000                                                                  11900025
119100         EVALUATE TRUE                                            11910025
119200             WHEN SQLCODE = ZERO                                  11920025
119300             WHEN SQLCODE = -811                                  11930025
119400                 SET PS-VALID-SELECT    TO TRUE                   11940025
119500             WHEN SQLCODE = +100                                  11950025
119600             WHEN SQLCODE = -904                                  11960025
119700             WHEN SQLCODE = -913                                  11970025
119800                 CONTINUE                                         11980025
119900             WHEN SQLWARN0 NOT = SPACES                           11990025
120000             WHEN SQLCODE < ZERO                                  12000025
120100             WHEN SQLCODE > ZERO                                  12010025
120200                 MOVE '2400-CHECK-EFFECTIVE'                      12020025
120300                                   TO DP013-PARAGRAPH             12030025
120400                 MOVE 'SELECT RELATIONSHIP DATA FOR ENT:'         12040025
120500                                   TO DP013-MESSAGE-TEXT (1)      12050025
120600                 MOVE DK-ENT-ID    TO ASC-DISPLAY-ENT-ID          12060025
120700                 MOVE ASC-DISPLAY-ENT-ID                          12070025
120800                                   TO DP013-MESSAGE-TEXT (2)      12080025
120900                 MOVE SQLCA        TO DP013-SQLCA                 12090025
121000                 MOVE 'VNT_VND_RLTNSHP'                           12100025
121100                                   TO DP013-DB2-TABLE-NAME (1)    12110025
121200                 SET DP013-DB2-ABEND                              12120025
121300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12130025
121400                 PERFORM DP013-0000-PROCESS-ABEND                 12140025
121500         END-EVALUATE                                             12150025
121600     END-PERFORM.                                                 12160025
121700                                                                  12170025
121800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12180025
121900         MOVE '2400-CHECK-EFFECTIVE' TO DP013-PARAGRAPH           12190025
122000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12200025
122100                                   TO DP013-MESSAGE-TEXT (1)      12210025
122200         MOVE 'RELATIONSHIP FOR ENT-ID'                           12220025
122300                                   TO DP013-MESSAGE-TEXT (2)      12230025
122400         MOVE DK-ENT-ID            TO ASC-DISPLAY-ENT-ID          12240025
122500         MOVE ASC-DISPLAY-ENT-ID   TO DP013-MESSAGE-TEXT (3)      12250025
122600         MOVE SQLCA                TO DP013-SQLCA                 12260025
122700         MOVE 'VNT_VND_RLTNSHP'    TO DP013-DB2-TABLE-NAME (1)    12270025
122800         SET DP013-DB2-ABEND                                      12280025
122900             DP013-XCTL-DISPLAY-RESTART                           12290025
123000                                   TO TRUE                        12300025
123100         PERFORM DP013-0000-PROCESS-ABEND                         12310025
123200     END-IF.                                                      12320025
123300                                                                  12330025
123400*----------------------------------------------------------------*12340026
123500* CHECK IF ENT-ID BEING PROCESSED IS A PARTNER TYPE OF IMPORT    *12350030
123600* PARENT (S2) OR FACTORY (FA) THAT IS IN RMS PO AND HAS A LONG   *12360030
123700* NAME.  THE ADD OR UPDATE OF A RELATIONSHIP WILL BE BLOCKED     *12370030
123800* UNTIL THE PARTNER (S2, FA) HAS A LONGNAME AND IS IN RMS PO.    *12380030
123900*----------------------------------------------------------------*12390030
124000 2500-CHECK-PARTNER-STATS.                                        12400030
124100     MOVE SPACE TO ASC-LONGNAME-FOUND-SW.                         12410032
124200                                                                  12420030
124300     PERFORM 3320-GET-VENDOR-INFO.                                12430032
124400                                                                  12440032
124500     IF EXTENT-PRTNR-IND = 'Y'                                    12450030
124600        IF EXTENT-PRTNR-TYP-CDE = 'S2' OR 'FA'                    12460030
124700           IF EXTENT-VND-IN-RMS-IND = 'Y'                         12470030
124800              PERFORM 3330-CHECK-LONGNAME-EXISTENCE               12480030
124900              IF ASC-LONGNAME-NOT-FOUND                           12490030
125000                 SET PS-ERROR          TO TRUE                    12500030
125100                 SET DP030-OVERRIDE-GO                            12510030
125200                     DP030-SET-CURSOR-APPL-1                      12520030
125300                     DP020-MSG-FATAL  TO TRUE                     12530030
125400                 MOVE -1  TO MR-SELECTL (1)                       12540030
125500                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        12550030
125600***      --- CANNOT ADD A RELATIONSHIP UNTIL A LONG NAME          12560030
125700***      --- HAS BEEN ADDED                                       12570030
125800                    MOVE PC-TSYMSG-03630  TO DP020-MSG-NUMBER     12580030
125900                 END-IF                                           12590030
126000                 IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)        12600030
126100***      --- CANNOT UPDATE A RELATIONSHIP UNTIL A LONG NAME       12610030
126200***      --- HAS BEEN ADDED                                       12620030
126300                    MOVE PC-TSYMSG-03634  TO DP020-MSG-NUMBER     12630030
126400                 END-IF                                           12640030
126500              END-IF                                              12650030
126600           ELSE                                                   12660030
126700              SET PS-ERROR          TO TRUE                       12670030
126800              SET DP030-OVERRIDE-GO                               12680030
126900                  DP030-SET-CURSOR-APPL-1                         12690030
127000                  DP020-MSG-FATAL  TO TRUE                        12700030
127100              MOVE -1  TO MR-SELECTL (1)                          12710030
127200              IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)           12720030
127300***      --- CANNOT ADD A RELATIONSHIP BECAUSE PARTNER (S2, FA)   12730031
127400***      --- IS NOT IN RMS PO                                     12740031
127500                 MOVE PC-TSYMSG-03632  TO DP020-MSG-NUMBER        12750030
127600              END-IF                                              12760030
127700              IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)           12770030
127800***      --- CANNOT UPDATE A RELATIONSHIP BECAUSE PARTNER         12780030
127900***      --- (S2, FA) IS NOT IN RMS PO                            12790031
128000                 MOVE PC-TSYMSG-03635  TO DP020-MSG-NUMBER        12800030
128100              END-IF                                              12810030
128200           END-IF                                                 12820030
128300        END-IF                                                    12830030
128400     END-IF.                                                      12840030
128500                                                                  12850030
128600***************************************************************** 12860030
128700** PREPARE THE INTER-APPL-COMMAREA FOR THE NEXT SCREEN          * 12870030
128800***************************************************************** 12880030
128900 2900-PREPARE-COMMAREA.                                           12890030
129000     INITIALIZE VN020-INTER-APPL-COMMAREA.                        12900030
129100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            12910030
129200                            TO VN020-NUMBER-OF-SELECTED-ITEMS.    12920030
129300     MOVE ASC-KEY-ENT-ID    TO VN020-ENT-ID.                      12930030
129400     MOVE ASC-VENDOR-NAME   TO VN020-VENDOR-NAME.                 12940030
129500     MOVE ASC-VENDOR-ID     TO VN020-VENDOR-ID.                   12950030
129600     PERFORM 5000-PREPARE-SEL-QUEUE.                              12960030
129700                                                                  12970030
129800***************************************************************** 12980030
129900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      * 12990030
130000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). * 13000030
130100***************************************************************** 13010030
130200 3000-EDIT-DATA-IN-COMMAREA.                                      13020030
130300                                                                  13030030
130400     SET PS-NO-ERROR               TO TRUE.                       13040030
130500     PERFORM 3200-RESET-ATTRIBUTES.                               13050030
130600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13060030
130700**                                                                13070030
130800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13080030
130900* EDITTING IS DONE FROM THE BOTTOM UP.                            13090030
131000**                                                                13100030
131100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13110030
131200         ASC-ITEMS-DISPLAYED - 1.                                 13120030
131300     PERFORM 3100-SET-SUBSCRIPTS.                                 13130030
131400     PERFORM 3300-EDIT-SELECTIONS                                 13140030
131500         VARYING PV-SUB                                           13150030
131600         FROM PV-SUB BY -1                                        13160030
131700         UNTIL PV-SUB < +1                                        13170030
131800                                                                  13180030
131900     IF  PS-NO-ERROR                                              13190030
132000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13200030
132100     END-IF.                                                      13210030
132200                                                                  13220030
132300     IF  ((PS-NO-ERROR)                                           13230030
132400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13240030
132500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13250030
132600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13260030
132700     END-IF.                                                      13270030
132800                                                                  13280030
132900*----------------------------------------------------------------*13290030
133000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13300030
133100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13310030
133200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13320030
133300*                                                                *13330030
133400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13340030
133500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13350030
133600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13360030
133700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13370030
133800*----------------------------------------------------------------*13380030
133900 3100-SET-SUBSCRIPTS.                                             13390030
134000                                                                  13400030
134100     COMPUTE ASC-ITEM-SUB =                                       13410030
134200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13420030
134300                                                                  13430030
134400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13440030
134500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13450030
134600                                                                  13460030
134700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13470030
134800     ELSE                                                         13480030
134900         MOVE +1                     TO ASC-BLK-SUB               13490030
135000     END-IF.                                                      13500030
135100                                                                  13510030
135200***************************************************************** 13520030
135300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     * 13530030
135400***************************************************************** 13540030
135500 3200-RESET-ATTRIBUTES.                                           13550030
135600                                                                  13560030
135700     MOVE DP015-UNP-NUM-NOR-OFF TO ASTRTITA.                      13570030
135800     MOVE DP015-GREEN           TO ASTRTITC.                      13580030
135900     MOVE DP015-UNDERLINE       TO ASTRTITH.                      13590030
136000                                                                  13600030
136100     IF DP020-NEXT-ACT-RETURN OR                                  13610030
136200        DP020-NEXT-ACT-READ-MAP                                   13620030
136300         PERFORM VARYING PV-SUB  FROM 1 BY 1                      13630030
136400                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             13640030
136500                  MOVE DP015-UNP-ALP-NOR-OFF                      13650030
136600                                       TO MR-SELECTA (PV-SUB)     13660030
136700                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     13670030
136800                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     13680030
136900         END-PERFORM                                              13690030
137000     ELSE                                                         13700030
137100         PERFORM VARYING PV-SUB  FROM 1 BY 1                      13710030
137200                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              13720030
137300                  MOVE DP015-UNP-ALP-NOR-OFF                      13730030
137400                                       TO MR-SELECTA (PV-SUB)     13740030
137500                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     13750030
137600                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     13760030
137700         END-PERFORM.                                             13770030
137800                                                                  13780030
137900***************************************************************** 13790030
138000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    * 13800030
138100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   * 13810030
138200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    * 13820030
138300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             * 13830030
138400***************************************************************** 13840030
138500 3300-EDIT-SELECTIONS.                                            13850030
138600                                                                  13860030
138700     EVALUATE TRUE                                                13870030
138800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13880030
138900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13890030
139000                 CONTINUE                                         13900030
139100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13910030
139200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13920030
139300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13930030
139400                 MOVE ASC-TEMP-SELECTED-SW                        13940030
139500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13950030
139600                                TO ASC-SELECTED-SW                13960030
139700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13970030
139800             END-IF                                               13980030
139900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13990030
140000                 = SPACE                                          14000030
140100             EVALUATE TRUE                                        14010030
140200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14020030
140300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14030030
140400                     MOVE SPACE TO ASC-SELECTED-SW                14040030
140500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14050030
140600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14060030
140700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14070030
140800                     MOVE SPACE TO ASC-SELECTED-SW                14080030
140900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14090030
141000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14100030
141100                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14110030
141200                     MOVE SPACE TO ASC-SELECTED-SW                14120030
141300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14130030
141400             END-EVALUATE                                         14140030
141500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14150030
141600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14160030
141700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14170030
141800             END-IF                                               14180030
141900             PERFORM 3310-EDIT-RANGE                              14190030
142000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14200030
142100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14210030
142200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14220030
142300             END-IF                                               14230030
142400             PERFORM 3310-EDIT-RANGE                              14240030
142500         WHEN OTHER                                               14250030
142600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14260030
142700             SET DP020-MSG-FATAL    TO TRUE                       14270030
142800             MOVE -1                TO MR-SELECTL (PV-SUB)        14280030
142900             SET DP030-SET-CURSOR-APPL-1                          14290030
143000                                    TO TRUE                       14300030
143100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14310030
143200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14320030
143300             SET PS-ERROR TO TRUE                                 14330030
143400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14340030
143500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14350030
143600                 MOVE SPACE         TO ASC-SELECTED-SW            14360030
143700                                        (ASC-BLK-SUB ASC-ITEM-SUB)14370030
143800             END-IF                                               14380030
143900     END-EVALUATE.                                                14390030
144000                                                                  14400030
144100     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14410030
144200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14420030
144300     IF  ASC-ITEM-SUB < 1                                         14430030
144400         SUBTRACT +1 FROM ASC-BLK-SUB                             14440030
144500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14450030
144600     END-IF.                                                      14460030
144700                                                                  14470030
144800***************************************************************** 14480030
144900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      * 14490030
145000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    * 14500030
145100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)* 14510030
145200** THE ENDING.                                                  * 14520030
145300***************************************************************** 14530030
145400 3310-EDIT-RANGE.                                                 14540030
145500                                                                  14550030
145600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14560030
145700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14570030
145800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14580030
145900                                   TO ASC-SELECTED-SW             14590030
146000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14600030
146100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14610030
146200         ELSE                                                     14620030
146300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14630030
146400                 CONTINUE                                         14640030
146500             ELSE                                                 14650030
146600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14660030
146700                 MOVE PC-TSYMSG-00054                             14670030
146800                                   TO DP020-MSG-NUMBER            14680030
146900                 SET DP020-MSG-FATAL                              14690030
147000                                   TO TRUE                        14700030
147100                 MOVE -1           TO MR-SELECTL (PV-SUB)         14710030
147200                 SET DP030-SET-CURSOR-APPL-1                      14720030
147300                                   TO TRUE                        14730030
147400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14740030
147500                 MOVE DP015-UNDERLINE                             14750030
147600                                   TO MR-SELECTH (PV-SUB)         14760030
147700                 SET PS-ERROR      TO TRUE                        14770030
147800             END-IF                                               14780030
147900         END-IF                                                   14790030
148000     ELSE                                                         14800030
148100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14810030
148200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14820030
148300                                   TO ASC-SELECTED-SW             14830030
148400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14840030
148500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14850030
148600         ELSE                                                     14860030
148700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14870030
148800                 CONTINUE                                         14880030
148900             ELSE                                                 14890030
149000*                -- ONLY ONE END-OF-RANGE ALLOWED --              14900030
149100                 MOVE PC-TSYMSG-00055                             14910030
149200                                   TO DP020-MSG-NUMBER            14920030
149300                 SET DP020-MSG-FATAL                              14930030
149400                                   TO TRUE                        14940030
149500                 MOVE -1           TO MR-SELECTL (PV-SUB)         14950030
149600                 SET DP030-SET-CURSOR-APPL-1                      14960030
149700                                   TO TRUE                        14970030
149800                 SET PS-ERROR      TO TRUE                        14980030
149900             END-IF                                               14990030
150000         END-IF                                                   15000030
150100     END-IF.                                                      15010030
150200                                                                  15020030
150300*----------------------------------------------------------------*15030030
150400* SELECT THE VENDOR INFO FOR THE ENTID BEING PROCESSED.          *15040030
150500*----------------------------------------------------------------*15050030
150600 3320-GET-VENDOR-INFO.                                            15060030
150700     PERFORM                                                      15070030
150800         WITH TEST AFTER                                          15080030
150900         VARYING PV-RETRY-COUNTER                                 15090030
151000         FROM 1 BY 1                                              15100030
151100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15110030
151200                   OR (SQLCODE = ZERO))                           15120030
151300                                                                  15130030
151400         EXEC SQL                                                 15140030
151500             SELECT PRTNR_IND                                     15150030
151600                   ,VND_IN_RMS_IND                                15160030
151700                   ,PRTNR_TYP_CDE                                 15170030
151800              INTO  :EXTENT-PRTNR-IND                             15180030
151900                   ,:EXTENT-VND-IN-RMS-IND                        15190030
152000                   ,:EXTENT-PRTNR-TYP-CDE                         15200030
152100              FROM  TEXTENT                                       15210030
152200             WHERE  ENT_ID   = :ASC-KEY-ENT-ID                    15220030
152300         END-EXEC                                                 15230030
152400                                                                  15240030
152500         EVALUATE TRUE                                            15250030
152600             WHEN SQLCODE = ZERO                                  15260030
152700             WHEN SQLCODE = -904                                  15270030
152800             WHEN SQLCODE = -913                                  15280030
152900                 CONTINUE                                         15290030
153000             WHEN SQLWARN0 NOT = SPACES                           15300030
153100             WHEN SQLCODE < ZERO                                  15310030
153200             WHEN SQLCODE > ZERO                                  15320030
153300                 MOVE '3320-GET-VENDOR-INFO     '                 15330030
153400                                   TO DP013-PARAGRAPH             15340030
153500                 MOVE 'SELECT VENDOR NUMBER'                      15350030
153600                                   TO DP013-MESSAGE-TEXT (1)      15360030
153700                 MOVE SQLCA        TO DP013-SQLCA                 15370030
153800                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    15380030
153900                 SET DP013-DB2-ABEND                              15390030
154000                     DP013-XCTL-DISPLAY-RESTART                   15400030
154100                                   TO TRUE                        15410030
154200                 PERFORM DP013-0000-PROCESS-ABEND                 15420030
154300         END-EVALUATE                                             15430030
154400     END-PERFORM.                                                 15440030
154500*                                                                 15450030
154600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15460030
154700         MOVE '3320-GET-VENDOR-INFO     '                         15470030
154800                                   TO DP013-PARAGRAPH             15480030
154900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     15490030
155000                                   TO DP013-MESSAGE-TEXT (1)      15500030
155100         MOVE 'VENDOR NUMBER'      TO DP013-MESSAGE-TEXT (2)      15510030
155200         MOVE SQLCA                TO DP013-SQLCA                 15520030
155300         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    15530030
155400         SET DP013-DB2-ABEND                                      15540030
155500             DP013-XCTL-DISPLAY-RESTART                           15550030
155600                                   TO TRUE                        15560030
155700         PERFORM DP013-0000-PROCESS-ABEND                         15570030
155800     END-IF.                                                      15580030
155900                                                                  15590030
156000*----------------------------------------------------------------*15600030
156100*  CHECK FOR IF TYPE CODE FOR LONG NAME EXISTS ON TENTNME FOR THE 15610030
156200*  VENDOR BEING PROCESSED.                                        15620030
156300*----------------------------------------------------------------*15630030
156400 3330-CHECK-LONGNAME-EXISTENCE.                                   15640030
156500     PERFORM                                                      15650030
156600         WITH TEST AFTER                                          15660030
156700         VARYING PV-RETRY-COUNTER                                 15670030
156800         FROM 1 BY 1                                              15680030
156900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15690030
157000                   OR (SQLCODE = ZERO)                            15700030
157100                   OR (SQLCODE = +100)                            15710030
157200                   OR (SQLCODE = -811))                           15720030
157300                                                                  15730030
157400         EXEC SQL                                                 15740030
157500           SELECT '1'                                             15750030
157600            INTO  :PV-ONE                                         15760030
157700             FROM SYSIBM.SYSDUMMY1 X                              15770030
157800            WHERE EXISTS (SELECT 1                                15780030
157900                            FROM TENTNME                          15790030
158000                           WHERE ENT_ID = :ASC-KEY-ENT-ID         15800030
158100                             AND TYPE_CDE = '05'                  15810030
158200                             AND X.IBMREQD = X.IBMREQD)           15820030
158300         END-EXEC                                                 15830030
158400                                                                  15840030
158500         EVALUATE TRUE                                            15850030
158600             WHEN SQLCODE = ZERO                                  15860030
158700             WHEN SQLCODE = -811                                  15870030
158800                 SET ASC-LONGNAME-FOUND TO TRUE                   15880030
158900             WHEN SQLCODE = +100                                  15890030
159000                 SET ASC-LONGNAME-NOT-FOUND TO TRUE               15900030
159100             WHEN SQLCODE = -904                                  15910030
159200             WHEN SQLCODE = -913                                  15920030
159300                 CONTINUE                                         15930030
159400             WHEN SQLWARN0 NOT = SPACES                           15940030
159500             WHEN SQLCODE < ZERO                                  15950030
159600             WHEN SQLCODE > ZERO                                  15960030
159700                 MOVE '3330-CHECK-LONGNAME-EXISTENCE'             15970030
159800                                   TO DP013-PARAGRAPH             15980030
159900                 MOVE 'CHECK IF LONG NAME ALREADY EXISTS'         15990030
160000                                   TO DP013-MESSAGE-TEXT (1)      16000030
160100                 MOVE SPACE        TO DP013-MESSAGE-TEXT (2)      16010030
160200                 MOVE SQLCA        TO DP013-SQLCA                 16020030
160300                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)    16030030
160400                 SET DP013-DB2-ABEND                              16040030
160500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16050030
160600                 PERFORM DP013-0000-PROCESS-ABEND                 16060030
160700         END-EVALUATE                                             16070030
160800     END-PERFORM.                                                 16080030
160900                                                                  16090030
161000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16100030
161100         MOVE '3330-CHECK-LONGNAME-EXISTENCE'                     16110030
161200                                   TO DP013-PARAGRAPH             16120030
161300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CHECK '     16130030
161400                                   TO DP013-MESSAGE-TEXT (1)      16140030
161500         MOVE 'FOR LONG NAME EXISTENCE '                          16150030
161600                                   TO DP013-MESSAGE-TEXT (2)      16160030
161700         MOVE SPACE                TO DP013-MESSAGE-TEXT (3)      16170030
161800         MOVE SQLCA                TO DP013-SQLCA                 16180030
161900         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    16190030
162000         SET DP013-DB2-ABEND                                      16200030
162100             DP013-XCTL-DISPLAY-RESTART                           16210030
162200                                   TO TRUE                        16220030
162300         PERFORM DP013-0000-PROCESS-ABEND                         16230030
162400     END-IF.                                                      16240030
162500                                                                  16250030
162600***************************************************************** 16260030
162700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    * 16270030
162800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  * 16280030
162900***************************************************************** 16290030
163000 3400-CHECK-RANGE-SEQUENCE.                                       16300030
163100                                                                  16310030
163200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16320030
163300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16330030
163400       AND  ASC-START-OF-SELECTED-RANGE >                         16340030
163500                                         ASC-END-OF-SELECTED-RANGE16350030
163600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16360030
163700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16370030
163800         SET DP020-MSG-FATAL TO TRUE                              16380030
163900         SET PS-ERROR TO TRUE                                     16390030
164000         PERFORM 3410-POSITION-AT-ERROR                           16400030
164100     END-IF.                                                      16410030
164200                                                                  16420030
164300***************************************************************** 16430030
164400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    * 16440030
164500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR * 16450030
164600** SHOULD BE POSITIONED ON A RANGE ERROR.                       * 16460030
164700***************************************************************** 16470030
164800 3410-POSITION-AT-ERROR.                                          16480030
164900                                                                  16490030
165000     SET DP030-SET-CURSOR-APPL-1                                  16500030
165100                                   TO TRUE.                       16510030
165200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16520030
165300                    - PV-TOP-ITEM + 1.                            16530030
165400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16540030
165500         CONTINUE                                                 16550030
165600     ELSE                                                         16560030
165700         MOVE -1                   TO MR-SELECTL (PV-SUB)         16570030
165800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16580030
165900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16590030
166000     END-IF.                                                      16600030
166100                                                                  16610030
166200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16620030
166300                    - PV-TOP-ITEM + 1.                            16630030
166400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16640030
166500         CONTINUE                                                 16650030
166600     ELSE                                                         16660030
166700         MOVE -1                   TO MR-SELECTL (PV-SUB)         16670030
166800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16680030
166900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16690030
167000     END-IF.                                                      16700030
167100                                                                  16710030
167200*----------------------------------------------------------------*16720030
167300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16730030
167400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16740030
167500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16750030
167600*----------------------------------------------------------------*16760030
167700 3500-MARK-RANGE-AS-SELECTED.                                     16770030
167800                                                                  16780030
167900     MOVE +1                       TO  ASC-BLK-SUB.               16790030
168000     PERFORM 3510-MARK-SELECTED-INDS                              16800030
168100         VARYING ASC-ITEM-SUB                                     16810030
168200         FROM 1 BY 1                                              16820030
168300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16830030
168400                                                                  16840030
168500     ADD +1                        TO ASC-BLK-SUB.                16850030
168600     PERFORM 3510-MARK-SELECTED-INDS                              16860030
168700         VARYING ASC-ITEM-SUB                                     16870030
168800         FROM 1 BY 1                                              16880030
168900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16890030
169000                                                                  16900030
169100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16910030
169200                                   TO  PV-LIST-ITEM-NUMBER.       16920030
169300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16930030
169400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16940030
169500               PC-ITEMS-PER-PANEL).                               16950030
169600                                                                  16960030
169700     MOVE ASC-START-OF-SELECTED-RANGE                             16970030
169800                                   TO PV-START-OF-SELECTED-RANGE. 16980030
169900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16990030
170000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17000030
170100               PC-ITEMS-PER-PANEL).                               17010030
170200                                                                  17020030
170300     MOVE ASC-END-OF-SELECTED-RANGE                               17030030
170400                                   TO  PV-END-OF-SELECTED-RANGE.  17040030
170500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17050030
170600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17060030
170700               PC-ITEMS-PER-PANEL).                               17070030
170800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17080030
170900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17090030
171000                                                                  17100030
171100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17110030
171200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17120030
171300         MOVE +1                   TO ASC-BLK-SUB                 17130030
171400         PERFORM 5100-WRITE-TEMP-STORAGE                          17140030
171500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17150030
171600             PV-FIRST-BLOCK-IN-ARRAY - 1                          17160030
171700                                                                  17170030
171800         PERFORM                                                  17180030
171900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17190030
172000                   PV-PREV-BLOCK-IN-ARRAY                         17200030
172100             MOVE PV-FIRST-BLOCK-IN-RANGE                         17210030
172200                                   TO PV-BLOCK-NUMBER             17220030
172300             PERFORM 4410-READ-TEMP-STORAGE                       17230030
172400             PERFORM 3510-MARK-SELECTED-INDS                      17240030
172500                 VARYING ASC-ITEM-SUB                             17250030
172600                 FROM 1 BY 1                                      17260030
172700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17270030
172800             PERFORM 5100-WRITE-TEMP-STORAGE                      17280030
172900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17290030
173000         END-PERFORM                                              17300030
173100                                                                  17310030
173200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17320030
173300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17330030
173400         PERFORM                                                  17340030
173500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17350030
173600                   PV-LAST-BLOCK-IN-RANGE                         17360030
173700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17370030
173800                                   TO PV-BLOCK-NUMBER             17380030
173900             PERFORM 4410-READ-TEMP-STORAGE                       17390030
174000             PERFORM 3510-MARK-SELECTED-INDS                      17400030
174100                 VARYING ASC-ITEM-SUB                             17410030
174200                 FROM 1 BY 1                                      17420030
174300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17430030
174400             PERFORM 5100-WRITE-TEMP-STORAGE                      17440030
174500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17450030
174600         END-PERFORM                                              17460030
174700                                                                  17470030
174800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17480030
174900                                   TO PV-BLOCK-NUMBER             17490030
175000         PERFORM 4410-READ-TEMP-STORAGE                           17500030
175100     END-IF.                                                      17510030
175200                                                                  17520030
175300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17530030
175400                                      ASC-END-OF-SELECTED-RANGE.  17540030
175500                                                                  17550030
175600*----------------------------------------------------------------*17560030
175700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17570030
175800*----------------------------------------------------------------*17580030
175900 3510-MARK-SELECTED-INDS.                                         17590030
176000                                                                  17600030
176100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17610030
176200                                ASC-ITEM-SUB) >                   17620030
176300         ASC-START-OF-SELECTED-RANGE)                             17630030
176400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17640030
176500                                ASC-ITEM-SUB) =                   17650030
176600         ASC-START-OF-SELECTED-RANGE)                             17660030
176700                                                                  17670030
176800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17680030
176900                                    ASC-ITEM-SUB) <               17690030
177000             ASC-END-OF-SELECTED-RANGE)                           17700030
177100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17710030
177200                                    ASC-ITEM-SUB) =               17720030
177300             ASC-END-OF-SELECTED-RANGE)                           17730030
177400                                                                  17740030
177500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17750030
177600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17760030
177700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17770030
177800                               TO TRUE                            17780030
177900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17790030
178000                               TO TRUE                            17800030
178100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17810030
178200             END-IF                                               17820030
178300         END-IF                                                   17830030
178400     END-IF.                                                      17840030
178500                                                                  17850030
178600*----------------------------------------------------------------*17860030
178700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17870030
178800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17880030
178900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17890030
179000*    DISPLAY THE PANEL TO USER.                                  *17900030
179100*----------------------------------------------------------------*17910030
179200 4000-BUILD-INITIAL-PANEL.                                        17920030
179300                                                                  17930030
179400     INITIALIZE ASC-BLOCK-ENTRIES (1)                             17940030
179500                ASC-BLOCK-ENTRIES (2).                            17950030
179600     MOVE +1 TO ASC-BLK-SUB.                                      17960030
179700     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            17970030
179800     MOVE ZERO TO ASC-ITEM-SUB                                    17980030
179900                  ASC-NUMBER-OF-ITEMS-READ                        17990030
180000                  ASC-NUMBER-OF-SELECTED-ITEMS                    18000030
180100                  ASC-HIGHEST-BLOCK-WRITTEN                       18010030
180200                  ASC-START-OF-SELECTED-RANGE                     18020030
180300                  ASC-END-OF-SELECTED-RANGE                       18030030
180400                  ASC-ITEM-AT-TOP-OF-PANEL.                       18040030
180500     MOVE ASC-KEY-ENT-ID TO DK-ENT-ID.                            18050030
180600                                                                  18060030
180700     PERFORM 4010-OPEN-CURSOR.                                    18070030
180800                                                                  18080030
180900     PERFORM 4300-READ-ITEMS-FROM-DB.                             18090030
181000                                                                  18100030
181100     PERFORM 4020-CLOSE-CURSOR.                                   18110030
181200                                                                  18120030
181300     MOVE +1 TO PV-TOP-ITEM.                                      18130030
181400                                                                  18140030
181500     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           18150030
181600         SET DP030-SET-CURSOR-TRAILER TO TRUE                     18160030
181700     ELSE                                                         18170030
181800         MOVE -1 TO MR-SELECTL (1)                                18180030
181900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18190030
182000     END-IF.                                                      18200030
182100                                                                  18210030
182200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18220030
182300                                                                  18230030
182400 4010-OPEN-CURSOR.                                                18240030
182500                                                                  18250030
182600     PERFORM                                                      18260030
182700         WITH TEST AFTER                                          18270030
182800         VARYING PV-RETRY-COUNTER                                 18280030
182900         FROM 1 BY 1                                              18290030
183000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18300030
183100                   OR (SQLCODE = ZERO))                           18310030
183200                                                                  18320030
183300         EXEC SQL                                                 18330030
183400             OPEN RELATIONSHIP-CSR                                18340030
183500         END-EXEC                                                 18350030
183600                                                                  18360030
183700         EVALUATE TRUE                                            18370030
183800             WHEN SQLCODE = ZERO                                  18380030
183900             WHEN SQLCODE = -904                                  18390030
184000             WHEN SQLCODE = -913                                  18400030
184100                 CONTINUE                                         18410030
184200                                                                  18420030
184300             WHEN SQLWARN0 NOT = SPACES                           18430030
184400             WHEN SQLCODE < ZERO                                  18440030
184500             WHEN SQLCODE > ZERO                                  18450030
184600                 MOVE '4010-OPEN-CURSOR'                          18460030
184700                                   TO DP013-PARAGRAPH             18470030
184800                 MOVE 'OPEN VENDOR RELATIONSHIP CURSOR - '        18480030
184900                                   TO DP013-MESSAGE-TEXT (1)      18490030
185000                 MOVE SQLCA        TO DP013-SQLCA                 18500030
185100                 MOVE 'VNT_VND_RLTNSHP_CDE'                       18510030
185200                                   TO DP013-DB2-TABLE-NAME (1)    18520030
185300                 SET DP013-DB2-ABEND                              18530030
185400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18540030
185500                 PERFORM DP013-0000-PROCESS-ABEND                 18550030
185600         END-EVALUATE                                             18560030
185700     END-PERFORM.                                                 18570030
185800                                                                  18580030
185900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18590030
186000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18600030
186100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18610030
186200                                   TO DP013-MESSAGE-TEXT (1)      18620030
186300         MOVE SQLCA                TO DP013-SQLCA                 18630030
186400         MOVE 'VNT_VND_RLTNSHP_CDE' TO DP013-DB2-TABLE-NAME (1)   18640030
186500         SET DP013-DB2-ABEND                                      18650030
186600             DP013-XCTL-DISPLAY-RESTART                           18660030
186700                                   TO TRUE                        18670030
186800         PERFORM DP013-0000-PROCESS-ABEND                         18680030
186900     END-IF.                                                      18690030
187000                                                                  18700030
187100 4020-CLOSE-CURSOR.                                               18710030
187200                                                                  18720030
187300     EXEC SQL                                                     18730030
187400         CLOSE RELATIONSHIP-CSR                                   18740030
187500     END-EXEC                                                     18750030
187600                                                                  18760030
187700     EVALUATE TRUE                                                18770030
187800         WHEN SQLCODE = ZERO                                      18780030
187900             CONTINUE                                             18790030
188000                                                                  18800030
188100         WHEN SQLWARN0 NOT = SPACES                               18810030
188200         WHEN SQLCODE < ZERO                                      18820030
188300         WHEN SQLCODE > ZERO                                      18830030
188400             MOVE '4020-CLOSE-CURSOR'                             18840030
188500                               TO DP013-PARAGRAPH                 18850030
188600             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               18860030
188700                               TO DP013-MESSAGE-TEXT (1)          18870030
188800             MOVE SQLCA        TO DP013-SQLCA                     18880030
188900             MOVE 'VNT_VND_RLTNSHP_CDE'                           18890030
189000                               TO DP013-DB2-TABLE-NAME (1)        18900030
189100             SET DP013-DB2-ABEND                                  18910030
189200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18920030
189300             PERFORM DP013-0000-PROCESS-ABEND                     18930030
189400     END-EVALUATE.                                                18940030
189500                                                                  18950030
189600*---------------------------------------------------------------* 18960030
189700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE   * 18970030
189800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,    * 18980030
189900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND * 18990030
190000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE    * 19000030
190100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                  * 19010030
190200*---------------------------------------------------------------* 19020030
190300                                                                  19030030
190400 4300-READ-ITEMS-FROM-DB.                                         19040030
190500                                                                  19050030
190600     PERFORM                                                      19060030
190700         VARYING PV-READ-COUNT                                    19070030
190800         FROM 1 BY 1                                              19080030
190900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19090030
191000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19100030
191100                                                                  19110030
191200         PERFORM 4310-FETCH                                       19120030
191300                                                                  19130030
191400         IF  ASC-ITEMS-LEFT-ON-DB                                 19140030
191500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19150030
191600                 ADD +1            TO ASC-ITEM-SUB                19160030
191700             ELSE                                                 19170030
191800                 ADD +1            TO ASC-BLK-SUB                 19180030
191900                 MOVE +1           TO ASC-ITEM-SUB                19190030
192000                                                                  19200030
192100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19210030
192200                     MOVE +1       TO ASC-BLK-SUB                 19220030
192300                     SET ASC-BLOCK-MODIFIED (1)                   19230030
192400                                   TO TRUE                        19240030
192500                     PERFORM 5100-WRITE-TEMP-STORAGE              19250030
192600                     MOVE ASC-BLOCK-ENTRIES                       19260030
192700                               (PC-MAX-BLOCKS-IN-ARRAY)           19270030
192800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19280030
192900                     ADD +1        TO ASC-BLK-SUB                 19290030
193000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19300030
193100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19310030
193200                                   TO TRUE                        19320030
193300                 END-IF                                           19330030
193400             END-IF                                               19340030
193500             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 19350030
193600             MOVE ASC-NUMBER-OF-ITEMS-READ                        19360030
193700                                      TO ASC-LIST-ITEM-NUMBER     19370030
193800                                        (ASC-BLK-SUB ASC-ITEM-SUB)19380030
193900             MOVE VNT00000-VND-RLTNSHP-CDE TO ASC-RLTNSHP-CDE     19390030
194000                                        (ASC-BLK-SUB ASC-ITEM-SUB)19400030
194100             MOVE VNT00002-VND-RLTNSHP-DESC TO ASC-RLTNSHP-NAME   19410030
194200                                        (ASC-BLK-SUB ASC-ITEM-SUB)19420030
194300             MOVE PV-COUNT TO ASC-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)19430030
194400         END-IF                                                   19440030
194500     END-PERFORM.                                                 19450030
194600                                                                  19460030
194700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           19470030
194800         MOVE +1 TO ASC-BLK-SUB                                   19480030
194900                                                                  19490030
195000         PERFORM 5100-WRITE-TEMP-STORAGE                          19500030
195100                                                                  19510030
195200         ADD  +1 TO ASC-BLK-SUB                                   19520030
195300                                                                  19530030
195400         PERFORM 5100-WRITE-TEMP-STORAGE                          19540030
195500                                                                  19550030
195600         MOVE 1 TO ASC-BLK-SUB                                    19560030
195700                   PV-BLOCK-NUMBER                                19570030
195800                                                                  19580030
195900         PERFORM 4410-READ-TEMP-STORAGE                           19590030
196000                                                                  19600030
196100         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              19610030
196200             MOVE 2 TO ASC-BLK-SUB                                19620030
196300                       PV-BLOCK-NUMBER                            19630030
196400                                                                  19640030
196500             PERFORM 4410-READ-TEMP-STORAGE                       19650030
196600         END-IF                                                   19660030
196700     END-IF.                                                      19670030
196800*----------------------------------------------------------------*19680030
196900*----------------------------------------------------------------*19690030
197000                                                                  19700030
197100 4310-FETCH.                                                      19710030
197200                                                                  19720030
197300     EXEC SQL                                                     19730030
197400             FETCH RELATIONSHIP-CSR                               19740030
197500              INTO :VNT00000-VND-RLTNSHP-CDE                      19750030
197600                  ,:VNT00002-VND-RLTNSHP-DESC                     19760030
197700                  ,:PV-COUNT                                      19770030
197800     END-EXEC                                                     19780030
197900                                                                  19790030
198000     EVALUATE TRUE                                                19800030
198100         WHEN SQLCODE = ZERO                                      19810030
198200         WHEN SQLCODE = +100                                      19820030
198300              CONTINUE                                            19830030
198400                                                                  19840030
198500         WHEN SQLWARN0 NOT = SPACE                                19850030
198600         WHEN SQLCODE NOT = ZERO                                  19860030
198700              MOVE '4310-FETCH-CURSOR'                            19870030
198800                               TO DP013-PARAGRAPH                 19880030
198900              MOVE 'FETCH VENDOR RELATIONSHIP CURSOR'             19890030
199000                               TO DP013-MESSAGE-TEXT (1)          19900030
199100              MOVE SQLCA       TO DP013-SQLCA                     19910030
199200              SET DP013-DB2-ABEND                                 19920030
199300                               TO TRUE                            19930030
199400              PERFORM DP013-0000-PROCESS-ABEND                    19940030
199500     END-EVALUATE.                                                19950030
199600                                                                  19960030
199700     IF SQLCODE = +100                                            19970030
199800         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     19980030
199900                                                                  19990030
200000*----------------------------------------------------------------*20000030
200100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20010030
200200*----------------------------------------------------------------*20020030
200300 4400-MOVE-COMMAREA-TO-SCREEN.                                    20030030
200400                                                                  20040030
200500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20050030
200600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20060030
200700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20070030
200800             MOVE +1    TO ASC-BLK-SUB                            20080030
200900             PERFORM 5100-WRITE-TEMP-STORAGE                      20090030
201000             ADD +1     TO ASC-BLK-SUB                            20100030
201100             PERFORM 5100-WRITE-TEMP-STORAGE                      20110030
201200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20120030
201300                 GIVING PV-BLOCK-NUMBER                           20130030
201400                 REMAINDER PV-REMAINDER                           20140030
201500             IF  PV-REMAINDER > ZERO                              20150030
201600                 ADD +1 TO PV-BLOCK-NUMBER                        20160030
201700             END-IF                                               20170030
201800             MOVE +1    TO ASC-BLK-SUB                            20180030
201900             PERFORM 4410-READ-TEMP-STORAGE                       20190030
202000             ADD +1     TO ASC-BLK-SUB                            20200030
202100                           PV-BLOCK-NUMBER                        20210030
202200             PERFORM 4410-READ-TEMP-STORAGE                       20220030
202300     END-IF.                                                      20230030
202400     MOVE +1            TO ASC-BLK-SUB.                           20240030
202500     COMPUTE ASC-ITEM-SUB =                                       20250030
202600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20260030
202700         + PC-ITEMS-PER-PANEL).                                   20270030
202800                                                                  20280030
202900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20290030
203000         ADD +1         TO ASC-BLK-SUB                            20300030
203100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20310030
203200     END-IF.                                                      20320030
203300                                                                  20330030
203400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20340030
203500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20350030
203600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20360030
203700     PERFORM 4420-FORMAT-LIST-LINES                               20370030
203800         VARYING PV-SUB                                           20380030
203900         FROM PC-ITEMS-PER-PANEL BY -1                            20390030
204000         UNTIL PV-SUB < +1.                                       20400030
204100                                                                  20410030
204200     COMPUTE ASC-ITEMS-DISPLAYED =                                20420030
204300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20430030
204400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20440030
204500                                      ASTRTITO.                   20450030
204600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20460030
204700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20470030
204800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20480030
204900                                   TO ASELITO.                    20490030
205000     MOVE ASC-VENDOR-NAME          TO AVENDO.                     20500030
205100                                                                  20510030
205200     IF  DP020-MSG-NUMBER-X = SPACE                               20520030
205300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20530030
205400*            --- MORE ITEMS TO DISPLAY ----                       20540030
205500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20550030
205600             SET DP020-MSG-INFORMATIONAL TO TRUE                  20560030
205700         END-IF                                                   20570030
205800     END-IF.                                                      20580030
205900                                                                  20590030
206000*----------------------------------------------------------------*20600030
206100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20610030
206200*----------------------------------------------------------------*20620030
206300 4410-READ-TEMP-STORAGE.                                          20630030
206400                                                                  20640030
206500     EXEC CICS                                                    20650030
206600         READQ TS                                                 20660030
206700             QUEUE (ASC-LIST-QUEUE-NAME)                          20670030
206800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20680030
206900             ITEM  (PV-BLOCK-NUMBER)                              20690030
207000             RESP  (PV-CICS-RESP)                                 20700030
207100     END-EXEC.                                                    20710030
207200                                                                  20720030
207300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20730030
207400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20740030
207500         CONTINUE                                                 20750030
207600     ELSE                                                         20760030
207700         SET DP013-CICS-ABEND     TO TRUE                         20770030
207800         SET DP013-NO-ROLLBACK    TO TRUE                         20780030
207900         MOVE '4410-READ-TEMP-STORAGE'                            20790030
208000                                  TO DP013-PARAGRAPH              20800030
208100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20810030
208200                                  TO DP013-MESSAGE-TEXT(1)        20820030
208300         PERFORM DP013-0000-PROCESS-ABEND                         20830030
208400     END-IF.                                                      20840030
208500                                                                  20850030
208600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20860030
208700                                                                  20870030
208800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20880030
208900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20890030
209000     END-IF.                                                      20900030
209100                                                                  20910030
209200*----------------------------------------------------------------*20920030
209300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20930030
209400*----------------------------------------------------------------*20940030
209500 4420-FORMAT-LIST-LINES.                                          20950030
209600                                                                  20960030
209700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       20970030
209800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20980030
209900         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA        (PV-SUB)     20990030
210000         MOVE SPACES            TO MR-SELECTI        (PV-SUB)     21000030
210100                                   MR-ACTION         (PV-SUB)     21010030
210200                                   MR-RLTNSHP-NAME   (PV-SUB)     21020030
210300                                   MR-COUNT-X        (PV-SUB)     21030030
210400     ELSE                                                         21040030
210500         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       21050030
210600                                                           > SPACE21060030
210700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21070030
210800                                            TO MR-SELECTI (PV-SUB)21080030
210900         ELSE                                                     21090030
211000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21100030
211100                                            TO MR-SELECTI (PV-SUB)21110030
211200         END-IF                                                   21120030
211300                                                                  21130030
211400         IF  DP030-SET-CURSOR-TRAILER                             21140030
211500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21150030
211600                 > SPACE)                                         21160030
211700               OR (PV-SUB = 1))                                   21170030
211800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21180030
211900                MOVE -1          TO MR-SELECTL (PV-SUB)           21190030
212000             END-IF                                               21200030
212100         END-IF                                                   21210030
212200                                                                  21220030
212300         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            21230030
212400             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB) TO21240030
212500                                     MR-ACTION         (PV-SUB)   21250030
212600             MOVE ASC-RLTNSHP-NAME   (ASC-BLK-SUB ASC-ITEM-SUB) TO21260030
212700                                     MR-RLTNSHP-NAME   (PV-SUB)   21270030
212800             MOVE ASC-COUNT          (ASC-BLK-SUB ASC-ITEM-SUB) TO21280030
212900                                     PV-DISPLAY-COUNT             21290030
213000             MOVE PV-DISPLAY-COUNT TO                             21300030
213100                                     MR-COUNT          (PV-SUB)   21310030
213200         END-IF                                                   21320030
213300     END-IF.                                                      21330030
213400                                                                  21340030
213500     SUBTRACT +1 FROM ASC-ITEM-SUB                                21350030
213600                                                                  21360030
213700     IF ASC-ITEM-SUB < + 1                                        21370030
213800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21380030
213900         MOVE +1                 TO ASC-BLK-SUB                   21390030
214000     END-IF.                                                      21400030
214100                                                                  21410030
214200***************************************************************** 21420030
214300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   * 21430030
214400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      * 21440030
214500** ISSUE A WARNING.                                             * 21450030
214600***************************************************************** 21460030
214700 4430-CHECK-FOR-BEGIN-AND-END.                                    21470030
214800                                                                  21480030
214900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21490030
215000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21500030
215100*            -- NO END-OF-RANGE SPECFIED ---                      21510030
215200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21520030
215300             SET DP020-MSG-WARNING TO TRUE                        21530030
215400             PERFORM 4431-POSITION-AT-WARNING                     21540030
215500         END-IF                                                   21550030
215600     ELSE                                                         21560030
215700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21570030
215800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21580030
215900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21590030
216000             SET DP020-MSG-WARNING TO TRUE                        21600030
216100             PERFORM 4431-POSITION-AT-WARNING                     21610030
216200         END-IF                                                   21620030
216300     END-IF.                                                      21630030
216400                                                                  21640030
216500***************************************************************** 21650030
216600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  * 21660030
216700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   * 21670030
216800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        * 21680030
216900** POSITION THE CURSOR THERE.                                   * 21690030
217000***************************************************************** 21700030
217100 4431-POSITION-AT-WARNING.                                        21710030
217200                                                                  21720030
217300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21730030
217400                    - PV-TOP-ITEM + 1.                            21740030
217500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21750030
217600         CONTINUE                                                 21760030
217700     ELSE                                                         21770030
217800         SET DP030-SET-CURSOR-APPL-1                              21780030
217900                                   TO TRUE                        21790030
218000         MOVE -1                   TO MR-SELECTL (PV-SUB)         21800030
218100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21810030
218200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21820030
218300     END-IF.                                                      21830030
218400                                                                  21840030
218500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21850030
218600                    - PV-TOP-ITEM + 1.                            21860030
218700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21870030
218800         CONTINUE                                                 21880030
218900     ELSE                                                         21890030
219000         SET DP030-SET-CURSOR-APPL-1                              21900030
219100                                   TO TRUE                        21910030
219200         MOVE -1                   TO MR-SELECTL (PV-SUB)         21920030
219300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21930030
219400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21940030
219500     END-IF.                                                      21950030
219600                                                                  21960030
219700*----------------------------------------------------------------*21970030
219800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21980030
219900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21990030
220000* FOR THE SELECTED ITEMS QUEUE.                                  *22000030
220100*                                                                *22010030
220200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22020030
220300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22030030
220400* THE ARRAY IS FULL.                                             *22040030
220500*----------------------------------------------------------------*22050030
220600 5000-PREPARE-SEL-QUEUE.                                          22060030
220700                                                                  22070030
220800     MOVE +1                   TO  ASC-BLK-SUB.                   22080030
220900     PERFORM 5100-WRITE-TEMP-STORAGE.                             22090030
221000     ADD +1                    TO  ASC-BLK-SUB.                   22100030
221100     PERFORM 5100-WRITE-TEMP-STORAGE.                             22110030
221200                                                                  22120030
221300     MOVE ASC-SEL-QUEUE-NAME-OUT                                  22130030
221400                               TO  VN020-SEL-QUEUE-NAME.          22140030
221500     PERFORM 6010-DELETE-SEL-QUEUE.                               22150030
221600                                                                  22160030
221700                                                                  22170030
221800     SET VN021-IDX             TO  1.                             22180030
221900     MOVE ZERO                 TO VN020-NUMBER-OF-TS-ITEMS.       22190030
222000     INITIALIZE VN021-SELECTED-ITEM-ARRAY.                        22200030
222100                                                                  22210030
222200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22220030
222300             VARYING PV-ITEM                                      22230030
222400             FROM 1 BY 1                                          22240030
222500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22250030
222600                                                                  22260030
222700     IF  VN021-IDX > 1                                            22270030
222800         PERFORM 5205-WRITE-SEL-QUEUE                             22280030
222900         ADD +1                TO VN020-NUMBER-OF-TS-ITEMS        22290030
223000     END-IF.                                                      22300030
223100                                                                  22310030
223200*----------------------------------------------------------------*22320030
223300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22330030
223400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22340030
223500*----------------------------------------------------------------*22350030
223600 5100-WRITE-TEMP-STORAGE.                                         22360030
223700                                                                  22370030
223800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22380030
223900                                   TO PV-LIST-ITEM-NUMBER.        22390030
224000     COMPUTE PV-BLOCK-NUMBER =                                    22400030
224100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22410030
224200                                                                  22420030
224300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22430030
224400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22440030
224500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22450030
224600             PERFORM 5105-REWRITE-ASC-LISTQ                       22460030
224700         END-IF                                                   22470030
224800     ELSE                                                         22480030
224900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22490030
225000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22500030
225100         PERFORM 5110-WRITE-ASC-LISTQ                             22510030
225200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22520030
225300     END-IF.                                                      22530030
225400                                                                  22540030
225500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22550030
225600                                                                  22560030
225700***************************************************************** 22570030
225800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    * 22580030
225900** SPECIFIC COMMAREA.                                           * 22590030
226000***************************************************************** 22600030
226100 5105-REWRITE-ASC-LISTQ.                                          22610030
226200                                                                  22620030
226300     EXEC CICS                                                    22630030
226400         WRITEQ TS                                                22640030
226500             QUEUE (ASC-LIST-QUEUE-NAME)                          22650030
226600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22660030
226700             ITEM  (PV-BLOCK-NUMBER)                              22670030
226800             REWRITE                                              22680030
226900             RESP  (PV-CICS-RESP)                                 22690030
227000     END-EXEC.                                                    22700030
227100                                                                  22710030
227200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22720030
227300         CONTINUE                                                 22730030
227400     ELSE                                                         22740030
227500         SET DP013-CICS-ABEND            TO TRUE                  22750030
227600         SET DP013-NO-ROLLBACK           TO TRUE                  22760030
227700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22770030
227800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22780030
227900                                         TO DP013-MESSAGE-TEXT(1) 22790030
228000         PERFORM DP013-0000-PROCESS-ABEND                         22800030
228100     END-IF.                                                      22810030
228200                                                                  22820030
228300***************************************************************** 22830030
228400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      * 22840030
228500** SPECIFIC COMMAREA.                                           * 22850030
228600***************************************************************** 22860030
228700 5110-WRITE-ASC-LISTQ.                                            22870030
228800                                                                  22880030
228900     EXEC CICS                                                    22890030
229000         WRITEQ TS                                                22900030
229100             QUEUE (ASC-LIST-QUEUE-NAME)                          22910030
229200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22920030
229300             ITEM  (PV-BLOCK-NUMBER)                              22930030
229400             RESP  (PV-CICS-RESP)                                 22940030
229500     END-EXEC.                                                    22950030
229600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22960030
229700         SET DP013-CICS-ABEND      TO TRUE                        22970030
229800         SET DP013-NO-ROLLBACK     TO TRUE                        22980030
229900         MOVE '5110-WRITE-ASC-LISTQ'                              22990030
230000                                   TO DP013-PARAGRAPH             23000030
230100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23010030
230200                                   TO DP013-MESSAGE-TEXT(1)       23020030
230300         PERFORM DP013-0000-PROCESS-ABEND                         23030030
230400     END-IF.                                                      23040030
230500                                                                  23050030
230600*----------------------------------------------------------------*23060030
230700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23070030
230800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23080030
230900*----------------------------------------------------------------*23090030
231000 5200-FILL-SEL-QUEUE-RECORD.                                      23100030
231100                                                                  23110030
231200     PERFORM 6112-READ-LIST-QUEUE.                                23120030
231300                                                                  23130030
231400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23140030
231500         PERFORM                                                  23150030
231600         VARYING LQW-IDX                                          23160030
231700         FROM 1 BY 1                                              23170030
231800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23180030
231900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23190030
232000                                                                  23200030
232100             IF  LQW-SELECT (LQW-IDX)                             23210030
232200                 SET ASC-UPDATE-TSQ                               23220030
232300                               TO TRUE                            23230030
232400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              23240030
232500                               TO VN021-ITEM (VN021-IDX)          23250030
232600                 MOVE LQW-RLTNSHP-CDE (LQW-IDX)                   23260030
232700                               TO VN021-RLTNSHP-CDE               23270030
232800                                    (VN021-IDX)                   23280030
232900                 MOVE LQW-RLTNSHP-NAME (LQW-IDX)                  23290030
233000                               TO VN021-RLTNSHP-NAME              23300030
233100                                    (VN021-IDX)                   23310030
233200                 MOVE SPACE    TO VN021-ACTION-SW (VN021-IDX)     23320030
233300                 SET VN021-IDX UP BY 1                            23330030
233400                 IF  VN021-IDX > VN021-MAX-ITEMS                  23340030
233500                     PERFORM 5205-WRITE-SEL-QUEUE                 23350030
233600                     ADD +1    TO VN020-NUMBER-OF-TS-ITEMS        23360030
233700                     INITIALIZE VN021-SELECTED-ITEM-ARRAY         23370030
233800                     SET VN021-IDX TO  1                          23380030
233900                 END-IF                                           23390030
234000             END-IF                                               23400030
234100         END-PERFORM                                              23410030
234200     END-IF.                                                      23420030
234300                                                                  23430030
234400*----------------------------------------------------------------*23440030
234500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23450030
234600*----------------------------------------------------------------*23460030
234700 5205-WRITE-SEL-QUEUE.                                            23470030
234800                                                                  23480030
234900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23490030
235000                                   TO VN021-SELECTED-ITEMS.       23500030
235100                                                                  23510030
235200     EXEC CICS                                                    23520030
235300          WRITEQ TS                                               23530030
235400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      23540030
235500              FROM  (VN021-RELATIONSHIP-REC)                      23550030
235600              ITEM  (PV-SEL-QUEUE-ITEM)                           23560030
235700              RESP  (PV-CICS-RESP)                                23570030
235800     END-EXEC.                                                    23580030
235900                                                                  23590030
236000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23600030
236100         CONTINUE                                                 23610030
236200     ELSE                                                         23620030
236300         SET DP013-CICS-ABEND      TO TRUE                        23630030
236400         SET DP013-NO-ROLLBACK     TO TRUE                        23640030
236500         MOVE '5205-WRITE-SEL-QUEUE'                              23650030
236600                                   TO DP013-PARAGRAPH             23660030
236700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23670030
236800                                   TO DP013-MESSAGE-TEXT(1)       23680030
236900         PERFORM DP013-0000-PROCESS-ABEND                         23690030
237000     END-IF.                                                      23700030
237100 EJECT                                                            23710030
237200***************************************************************** 23720030
237300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, * 23730030
237400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT * 23740030
237500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    * 23750030
237600** THE USER.                                                    * 23760030
237700***************************************************************** 23770030
237800 6000-REFRESH-PANEL-FROM-TEMP.                                    23780030
237900                                                                  23790030
238000     IF  ASC-UPDATE-TSQ                                           23800030
238100         SET ASC-NO-TSQ-UPDATE TO TRUE                            23810030
238200         MOVE ZERO                 TO PV-SAVE-ITEM                23820030
238300                                      PV-SEL-QUEUE-ITEM           23830030
238400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23840030
238500                                   TO PV-HOLD-SELECTED-ITEMS      23850030
238600         PERFORM 6100-UPDATE-TSQ                                  23860030
238700             UNTIL PV-ITEMS-PROCESSED >                           23870030
238800                                     ASC-NUMBER-OF-SELECTED-ITEMS 23880030
238900         PERFORM 6010-DELETE-SEL-QUEUE                            23890030
239000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23900030
239100                    ASC-BLOCK-ENTRIES (2)                         23910030
239200     END-IF.                                                      23920030
239300                                                                  23930030
239400*---------------------------------------------------------------* 23940030
239500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.              * 23950030
239600*---------------------------------------------------------------* 23960030
239700 6010-DELETE-SEL-QUEUE.                                           23970030
239800                                                                  23980030
239900     EXEC CICS                                                    23990030
240000         DELETEQ TS                                               24000030
240100             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       24010030
240200             RESP  (PV-CICS-RESP)                                 24020030
240300     END-EXEC.                                                    24030030
240400                                                                  24040030
240500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24050030
240600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24060030
240700         CONTINUE                                                 24070030
240800     ELSE                                                         24080030
240900         SET DP013-CICS-ABEND TO TRUE                             24090030
241000         SET DP013-NO-ROLLBACK TO TRUE                            24100030
241100         MOVE '6010-DELETE-SEL-QUEUE'                             24110030
241200                        TO DP013-PARAGRAPH                        24120030
241300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24130030
241400                        TO DP013-MESSAGE-TEXT (1)                 24140030
241500         PERFORM DP013-0000-PROCESS-ABEND                         24150030
241600     END-IF.                                                      24160030
241700                                                                  24170030
241800*----------------------------------------------------------------*24180030
241900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24190030
242000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24200030
242100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24210030
242200*    THE TEMP QUEUE.                                             *24220030
242300*----------------------------------------------------------------*24230030
242400 6100-UPDATE-TSQ.                                                 24240030
242500                                                                  24250030
242600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24260030
242700     PERFORM 6105-READ-SEL-QUEUE.                                 24270030
242800     PERFORM                                                      24280030
242900         VARYING VN021-IDX                                        24290030
243000         FROM 1 BY 1                                              24300030
243100         UNTIL ((PV-ITEMS-PROCESSED >                             24310030
243200                              PV-HOLD-SELECTED-ITEMS)             24320030
243300         OR (VN021-IDX GREATER THAN VN021-MAX-ITEMS))             24330030
243400         IF  VN021-ACTION-SW (VN021-IDX) > SPACE                  24340030
243500             PERFORM 6110-PROCESS-ITEMS                           24350030
243600         END-IF                                                   24360030
243700         ADD +1                TO PV-ITEMS-PROCESSED              24370030
243800     END-PERFORM.                                                 24380030
243900                                                                  24390030
244000     PERFORM 6111-WRITE-LIST-QUEUE.                               24400030
244100                                                                  24410030
244200*----------------------------------------------------------------*24420030
244300*    READ THE LIST QUEUE RECORD.                                 *24430030
244400*----------------------------------------------------------------*24440030
244500 6105-READ-SEL-QUEUE.                                             24450030
244600                                                                  24460030
244700     EXEC CICS                                                    24470030
244800          READQ TS                                                24480030
244900              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      24490030
245000              INTO  (VN021-RELATIONSHIP-REC)                      24500030
245100              ITEM  (PV-SEL-QUEUE-ITEM)                           24510030
245200              RESP  (PV-CICS-RESP)                                24520030
245300     END-EXEC.                                                    24530030
245400                                                                  24540030
245500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24550030
245600         CONTINUE                                                 24560030
245700     ELSE                                                         24570030
245800         SET DP013-CICS-ABEND      TO  TRUE                       24580030
245900         SET DP013-NO-ROLLBACK     TO  TRUE                       24590030
246000         MOVE '6105-READ-SEL-QUEUE'                               24600030
246100                                   TO  DP013-PARAGRAPH            24610030
246200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24620030
246300                                   TO  DP013-MESSAGE-TEXT(1)      24630030
246400         PERFORM DP013-0000-PROCESS-ABEND                         24640030
246500     END-IF.                                                      24650030
246600                                                                  24660030
246700*----------------------------------------------------------------*24670030
246800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24680030
246900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY. CALCULATE *24690030
247000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24700030
247100*----------------------------------------------------------------*24710030
247200 6110-PROCESS-ITEMS.                                              24720030
247300                                                                  24730030
247400     COMPUTE PV-ITEM = 1 + ((VN021-ITEM (VN021-IDX) - 1)          24740030
247500                     / PC-ITEMS-PER-PANEL).                       24750030
247600                                                                  24760030
247700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24770030
247800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24780030
247900             PERFORM 6111-WRITE-LIST-QUEUE                        24790030
248000         END-IF                                                   24800030
248100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24810030
248200                                                                  24820030
248300         PERFORM 6112-READ-LIST-QUEUE                             24830030
248400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24840030
248500             CONTINUE                                             24850030
248600         END-IF                                                   24860030
248700     END-IF.                                                      24870030
248800                                                                  24880030
248900     COMPUTE PV-SUB = (VN021-ITEM (VN021-IDX)                     24890030
249000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24900030
249100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24910030
249200     MOVE LQW-SELECTED-SW (PV-SUB)                                24920030
249300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24930030
249400     EVALUATE TRUE                                                24940030
249500         WHEN VN021-ADD (VN021-IDX)                               24950030
249600              MOVE PC-ADD      TO LQW-ACTION (PV-SUB)             24960030
249700                                                                  24970030
249800         WHEN VN021-INQ (VN021-IDX)                               24980030
249900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24990030
250000                                                                  25000030
250100         WHEN VN021-UPD (VN021-IDX)                               25010030
250200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             25020030
250300                                                                  25030030
250400         WHEN VN021-DEL (VN021-IDX)                               25040030
250500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25050030
250600                                                                  25060030
250700         WHEN VN021-ERR (VN021-IDX)                               25070030
250800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25080030
250900     END-EVALUATE.                                                25090030
251000                                                                  25100030
251100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25110030
251200                                                                  25120030
251300*----------------------------------------------------------------*25130030
251400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25140030
251500*----------------------------------------------------------------*25150030
251600 6111-WRITE-LIST-QUEUE.                                           25160030
251700                                                                  25170030
251800     EXEC CICS                                                    25180030
251900         WRITEQ TS                                                25190030
252000             QUEUE (ASC-LIST-QUEUE-NAME)                          25200030
252100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25210030
252200             ITEM  (PV-SAVE-ITEM)                                 25220030
252300             REWRITE                                              25230030
252400             RESP  (PV-CICS-RESP)                                 25240030
252500     END-EXEC.                                                    25250030
252600                                                                  25260030
252700     IF  PV-CICS-RESP = DFHRESP (NORMAL) OR                       25270030
252800         PV-CICS-RESP = DFHRESP (ITEMERR)                         25280030
252900         CONTINUE                                                 25290030
253000     ELSE                                                         25300030
253100         SET DP013-CICS-ABEND  TO  TRUE                           25310030
253200         SET DP013-NO-ROLLBACK TO  TRUE                           25320030
253300         MOVE '6111-WRITE-LIST-QUEUE'                             25330030
253400                               TO  DP013-PARAGRAPH                25340030
253500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25350030
253600                               TO  DP013-MESSAGE-TEXT(1)          25360030
253700         PERFORM DP013-0000-PROCESS-ABEND                         25370030
253800     END-IF.                                                      25380030
253900                                                                  25390030
254000*----------------------------------------------------------------*25400030
254100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25410030
254200*----------------------------------------------------------------*25420030
254300 6112-READ-LIST-QUEUE.                                            25430030
254400                                                                  25440030
254500     EXEC CICS                                                    25450030
254600         READQ TS                                                 25460030
254700             QUEUE (ASC-LIST-QUEUE-NAME)                          25470030
254800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25480030
254900             ITEM  (PV-ITEM)                                      25490030
255000             RESP  (PV-CICS-RESP)                                 25500030
255100     END-EXEC.                                                    25510030
255200                                                                  25520030
255300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25530030
255400         CONTINUE                                                 25540030
255500     ELSE                                                         25550030
255600         SET DP013-CICS-ABEND        TO TRUE                      25560030
255700         SET DP013-NO-ROLLBACK       TO TRUE                      25570030
255800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25580030
255900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25590030
256000                                     TO DP013-MESSAGE-TEXT(1)     25600030
256100         PERFORM DP013-0000-PROCESS-ABEND                         25610030
256200     END-IF.                                                      25620030
256300                                                                  25630030
256400*---------------------------------------------------------------- 25640030
256500*    ABEND PROCESSOR MODULE                                       25650030
256600*---------------------------------------------------------------- 25660030
256700     COPY DPPD013.                                                25670030
256800*---------------------------------------------------------------- 25680030
