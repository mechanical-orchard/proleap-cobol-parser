000100*-----------------------*                                         03/19/93
000200 IDENTIFICATION DIVISION.                                         DPKCS040
000300*-----------------------*                                            LV067
000400 PROGRAM-ID.    TRKCS302.                                            CL**1
000500 AUTHOR.        MARGARET MORRISON.                                   CL**1
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
000700 DATE-WRITTEN.  FEBRUARY 1999.                                       CL**1
000800 DATE-COMPILED.                                                      CL**1
000900                                                                     CL**1
001000*---------------------------------------------------------------*    CL**1
001100*    Y302 - IMPORTS CONTAINER-UPC HISTORY                       *    CL**1
001200*                                                               *    CL**1
001300*    THIS PROGRAM DISPLAYS THE CONTAINER UPC HISTORY OF A       *    CL**1
001310*    SELECTED PURCHASE ORDER.  THE COLUMN THAT WAS CHANGED,     *         
001320*    DATE & TIME OF CHANGE, AND THE CURRENT AND PREVIOUS VALUES *         
001330*    OF THE COLUMN ARE DISPLAYED.                               *         
001700*                                                               *    CL**1
001800*---------------------------------------------------------------*    CL**1
001801*  11/04/2003 TKMA643 - VISWA KARUTURI                          *    CL**1
001802*     REMOVED LOGIC THAT PERTAINS TO COLUMNS FRGT_CHRG_AMT,     *    CL**1
001803*     CONSLR_CHRG_AMT AND INV_1ST_COST_AMT FROM TIMCNUP/TAUCNUP.*    CL**1
001804*     ADDED LOGIN FOR NEW COLUMNS SKU_NBR AND ASN_PKGING_CDE ON *    CL**1
001805*     TIMCNUP/TAUCNUP TABLES.                                   *    CL**1
001806*---------------------------------------------------------------*    CL**1
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              *         
001300*     DATE:    10/30/2014                                       *         
001300*                                                               *         
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# *         
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/30/2014    *         
003250*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                     CL**1
002000 ENVIRONMENT DIVISION.                                               CL**1
002100                                                                     CL**1
002200 DATA DIVISION.                                                      CL**1
002300                                                                     CL**1
002400 WORKING-STORAGE SECTION.                                            CL**1
002500                                                                     CL**1
002501 01  DK-DB2-KEYS.                                                         
002502     15  DK-CONTNR-NBR                  PIC  X(12)  VALUE SPACES.         
002503     15  DK-CONTNR-SEQ-NBR              PIC  S9(04) COMP                  
002504                                             VALUE ZERO.                  
002505     15  DK-PO-NBR                      PIC  S9(09) COMP                  
002506                                             VALUE ZERO.                  
002507     15  DK-VS-NBR                      PIC  X(20)  VALUE SPACES.         
002520     15  DK-UPC-NBR                     PIC  S9(15)V COMP-3               
002521                                             VALUE ZERO.                  
002530                                                                          
002600 01  PC-PROGRAM-CONSTANTS.                                           CL**1
002700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
002800                                                    'TR302A  '.      CL**2
002900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
003000                                                    'TRKM302 '.      CL**2
003100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
003200                                                    'TRKCS302'.      CL**2
003300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
003400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
003500     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.         CL**2
003600     05  PC-CNTR-MANIFEST-FORMAT        PIC  X(01)  VALUE '3'.       CL**1
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12        CL**2
003900                                                    COMP SYNC.       CL**1
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2         CL**1
004100                                                    COMP SYNC.       CL**1
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
004300                                                    +1000000         CL**1
004400                                                    COMP-3.          CL**1
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5         CL**1
004600                                                    COMP SYNC.       CL**1
004700     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
004800                                                     COMP-3.         CL**1
004810     05  PC-INIT-DATE                   PIC X(10)    VALUE                
004820                                                   '0001-01-01'.          
004830     05  PC-INIT-TIME                   PIC X(05)    VALUE                
004840                                                   '00.00'.               
004850     05  PC-SLASH                       PIC X(01)    VALUE '/'.           
004860     05  PC-COLON                       PIC X(01)    VALUE ':'.           
004900                                                                     CL**8
005000 01  PC-TSYMSG-NUMBERS.                                              CL**1
005100     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
005200     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**1
005300     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
005400     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
005500     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**1
005600     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.     CL*41
005700     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.     CL*66
005800     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.     CL*41
005900                                                                     CL**8
006000 01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
006100     05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
006200                                                     COMP SYNC.      CL**1
006300                                                                     CL**1
006400 01  PS-PROGRAM-SWITCHES.                                            CL**1
006500     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.      CL**1
006600         88  PS-NO-ERROR                             VALUE 'Y'.      CL**1
006700         88  PS-ERROR                                VALUE 'N'.      CL**1
006800     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**1
006900         88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**1
007000         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**1
007100     05  PS-TIMCNUP-ROW-SW              PIC X(01)    VALUE 'N'.      CL**1
007200         88  PS-TIMCNUP-ROW                          VALUE 'Y'.      CL**1
007300         88  PS-TIMCNUP-ROW-NO                       VALUE 'N'.      CL**1
007400                                                                     CL**1
007500 01  PV-PROGRAM-VARIABLES.                                           CL**1
007501     05  PV-RETRY-COUNTER               PIC S9(04)   VALUE +0             
007510                                                     COMP SYNC.           
007600     05  PV-REMAINDER                   PIC S9(04)   VALUE +0        CL**1
007700                                                     COMP SYNC.      CL**1
007800     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0        CL**1
007900                                                     COMP-3.         CL**1
008000     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
008100                                                     COMP-3.         CL**1
008200     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL*58
008300                                                     COMP-3.         CL*58
008400     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
008500                                                     COMP SYNC.      CL**1
008600     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0        CL**1
008700                                                     COMP SYNC.      CL**1
008800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
008900                                                     COMP SYNC.      CL**1
009000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
009100                                                     COMP SYNC.      CL**1
009200     05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
009300                                                                     CL*42
009400     05  PV-FORMAT-DATE.                                                  
009500         10  PV-FORMAT-MM               PIC XX.                           
009600         10  PV-FORMAT-SLASH1           PIC X        VALUE '/'.           
009700         10  PV-FORMAT-DD               PIC XX.                           
009710         10  PV-FORMAT-SLASH2           PIC X        VALUE '/'.           
009720         10  PV-FORMAT-YY               PIC XX.                           
009730                                                                          
009740     05  PV-FORMAT-TIME.                                                  
009750         10  PV-FORMAT-HOUR             PIC XX.                           
009760         10  PV-FORMAT-COLON            PIC X        VALUE ':'.           
009770         10  PV-FORMAT-MIN              PIC XX.                           
009771                                                                          
009790     05  PV-HOLD-BEFORE-VALUE           PIC X(30)    VALUE SPACES.        
009791     05  PV-HOLD-BEFORE-VALUE-V         PIC Z(08)9.99 VALUE ZERO.         
009792     05  PV-HOLD-BEFORE-VALUE-V4        PIC Z(08)9.9999                   
009793                                                     VALUE ZERO.          
009794     05  PV-HOLD-BEFORE-VALUE-N         PIC Z(08)9   VALUE ZERO.          
009795     05  PV-HOLD-AFTER-VALUE            PIC X(30)    VALUE SPACES.        
009796     05  PV-HOLD-AFTER-VALUE-V          PIC Z(08)9.99 VALUE ZERO.         
009797     05  PV-HOLD-AFTER-VALUE-V4         PIC Z(08)9.9999                   
009798                                                     VALUE ZERO.          
009799     05  PV-HOLD-AFTER-VALUE-N          PIC Z(08)9   VALUE ZERO.          
009800     05  PV-HOLD-FIELD-NAME             PIC X(20)    VALUE SPACES.        
009801                                                                          
009802     05  PV-PREVIOUS-VALUES.                                              
009803         10  PV-PREV-PO-LNE-NBR         PIC S9(09)      VALUE +0          
009804                                                        COMP.             
009805         10  PV-PREV-UPC-CART-CNT       PIC S9(09)      VALUE +0          
009806                                                        COMP.             
009807         10  PV-PREV-UPC-CBMT-QTY       PIC S9(07)V9(2) VALUE +0          
009808                                                        COMP-3.           
009809         10  PV-PREV-UPC-WT-KGRM-QTY    PIC S9(09)      VALUE +0          
009810                                                        COMP.             
009811         10  PV-PREV-UPC-UNT-QTY        PIC S9(09)      VALUE +0          
009812                                                        COMP.             
009813         10  PV-PREV-SKU-NBR            PIC  S9(8)V     VALUE +0          
009814                                                        COMP-3.           
009815         10  PV-PREV-ASN-PKGNG-CDE      PIC   X(2)  VALUE SPACES.         
009819         10  PV-PREV-LAST-UPD-BY-USR-ID PIC X(08)   VALUE SPACES.         
009820         10  PV-PREV-LAST-UPD-TMST      PIC X(26)   VALUE SPACES.         
009830                                                                          
009900*---------------------------------------------------------------*    CL**1
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *    CL**1
010100*---------------------------------------------------------------*    CL**1
010200                                                                     CL**1
010300     COPY DPWS030.                                                   CL*67
CICS       COPY DPWS930.                                                   CL*67
010400 EJECT                                                               CL**1
010401*---------------------------------------------------------------*         
010402*    NUMERIC EDIT LAYOUT.                                       *         
010403*---------------------------------------------------------------*         
010404                                                                          
010405     COPY DPWS010I.                                                       
010406                                                                          
010410 EJECT                                                                    
010500*---------------------------------------------------------------*    CL**1
010600*    STANDARD COMMAREA.                                         *    CL**1
010700*---------------------------------------------------------------*    CL**1
010800                                                                     CL**1
010900     COPY DPWS020.                                                   CL**1
011000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
011100                                                                     CL**1
011101*---------------------------------------------------------------* 03000099
011102* INTER-APPLICATION COMMAREA.                                   * 03010099
011103*   TRWS116 - IS THE INPUT LAYOUT WHEN COMING FROM THE CONTAINER* 03020099
011104*             MANIFEST SCREEN.                                  * 03030099
011109*---------------------------------------------------------------* 03060099
011110                                                                  03070099
011111         10  INTER-APPL-COMM-AREA       PIC X(200).               03080099
011112     COPY TRWS116.                                                03090099
011115                                                                  03110099
011116*---------------------------------------------------------------* 03120099
011117*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03130099
011118*---------------------------------------------------------------* 03140099
011120         10  ASC-SPECIFIC-COMMAREA.                               03150099
012300             15  ASC-LIST-KEYS.                                      CL**1
012310                 20  ASC-KEY-CONTNR-NBR              PIC  X(12).          
012400                 20  ASC-KEY-CONTNR-SEQ-NBR          PIC S9(04)      CL**1
012500                                                         COMP.       CL**1
012600                 20  ASC-KEY-PO-NBR                  PIC S9(09)           
012700                                                         COMP.            
012710                 20  ASC-KEY-VS-NBR                  PIC X(20).           
012720                 20  ASC-KEY-COLOR                   PIC X(10).           
012730                 20  ASC-KEY-SIZE                    PIC X(10).           
012740                 20  ASC-KEY-UPC-NBR                 PIC 9(15)V           
012750                                                         COMP-3.          
012800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                   CL**1
012810                 20  ASC-ITEM-ARRAY.                                      
013100                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.           CL**2
013102                         30  ASC-LIST-ITEM-NUMBER                         
013103                                                     PIC S9(09)           
013104                                                     COMP-3.              
013105                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).          
013106                             88  ASC-VALID-SELECT    VALUE ' '            
013107                                                           'S'            
013108                                                           'B'            
013109                                                           'E'.           
013110                             88  ASC-TEMP-NO-SELECT  VALUE ' '.           
013111                             88  ASC-TEMP-SELECT     VALUE 'S'.           
013112                             88  ASC-TEMP-BEGIN      VALUE 'B'.           
013113                             88  ASC-TEMP-END        VALUE 'E'.           
013114                         30  ASC-SELECTED-SW         PIC  X(01).          
013115                             88  ASC-NO-SELECT       VALUE ' '.           
013116                             88  ASC-SELECT          VALUE 'S'.           
013117                             88  ASC-BEGIN           VALUE 'B'.           
013118                             88  ASC-END             VALUE 'E'.           
013130                         30  ASC-DATA                PIC  X(20).          
013140                         30  ASC-USERID              PIC  X(08).          
013200                         30  ASC-DATE                PIC  X(08).     CL*11
013400                         30  ASC-TIME                PIC  X(05).     CL*18
013410                         30  ASC-VALUE               PIC  X(30).          
013500                                                                     CL**1
013600             15  ASC-BLK-SUB                         PIC S9(04)      CL**1
013700                                                         COMP        CL**1
013800                                                         SYNC.       CL**1
013900             15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
014000                                                         COMP        CL**1
014100                                                         SYNC.       CL**1
014200             15  ASC-SEL-SUB                         PIC S9(04)      CL*41
014300                                                         COMP.       CL*41
014400             15  ASC-SEL-ITEM                        PIC S9(04)      CL*41
014500                                                         COMP.       CL*41
014600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
014700                                                         COMP-3.     CL**1
014800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
014900                                                         COMP-3.     CL**1
015000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)      CL*41
015100                                                         COMP-3.     CL*41
015200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
015300                                                         COMP-3.     CL**1
015400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
015500                                                         COMP-3.     CL**1
015600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
015700                                                         COMP-3.     CL**1
015800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
015900                                                         COMP        CL**1
016000                                                         SYNC.       CL**1
016100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
016200                                                         COMP-3.     CL**1
016300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
016400                                                         COMP-3.     CL**1
016500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
016600                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'.    CL**1
016700                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'.    CL**1
016800             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).     CL*41
016900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.    CL*41
018400             15  ASC-DTL-QUEUE-NAME.                                 CL**2
018500                 20  ASC-DTL-TERM-ID                 PIC  X(04).     CL**2
018600                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)      CL**2
018700                                                         COMP-3.     CL**2
018800                 20  ASC-DTL-SEQ                     PIC  9(01).     CL**2
018900                                                                     CL**1
019000             15  ASC-START-ITEM-REQUEST.                             CL**1
019100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).     CL**1
019200                                                                     CL**1
019300     EJECT                                                           CL**1
020100*---------------------------------------------------------------*    CL**1
020200*    ABEND PROCESSING COPYBOOK.                                 *    CL**1
020300*---------------------------------------------------------------*    CL**1
020400                                                                     CL**1
020500     COPY DPWS013.                                                   CL**1
020600                                                                     CL**1
020700     EJECT                                                           CL**1
020800*---------------------------------------------------------------*    CL**1
020900*    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
021000*---------------------------------------------------------------*    CL**1
021100                                                                     CL**1
021200     COPY DPWS015.                                                   CL**1
021300                                                                     CL**1
021400*---------------------------------------------------------------*    CL**1
021500*    FUNCTION KEYS COPYBOOK.                                    *    CL**1
021600*---------------------------------------------------------------*    CL**1
021700                                                                     CL**1
021800     COPY DPWS016.                                                   CL**1
021900                                                                     CL**1
022600*---------------------------------------------------------------*    CL**1
022700*    MAP LAYOUT                                                 *    CL**1
022800*---------------------------------------------------------------*    CL**1
022900                                                                     CL**1
023000     COPY TRKM302.                                                   CL**1
023100                                                                     CL**8
023200 01  MR-OCCURS-LAYOUT          REDEFINES  TR302AO.                   CL**1
023320*PS 10/30/2014 CHANGE STARTS                                         CL**1
023320     05  FILLER                PIC X(147).                           CL**1
023320*PS 10/30/2014 CHANGE ENDS                                           CL**1
023400     05  MR-SCROLL-AREA OCCURS 12 TIMES.                             CL**1
023500         10  MR-DATAL          PIC S9(04) COMP.                      CL**1
023600         10  MR-DATAA          PIC  X(01).                           CL**1
023700         10  MR-DATAC          PIC  X(01).                           CL**1
023800         10  MR-DATAH          PIC  X(01).                           CL**1
023900         10  MR-DATA           PIC  X(20).                           CL**1
023901                                                                          
023902         10  MR-USERIDL        PIC S9(04) COMP.                      CL**1
023903         10  MR-USERIDA        PIC  X(01).                           CL**1
023904         10  MR-USERIDC        PIC  X(01).                           CL**1
023905         10  MR-USERIDH        PIC  X(01).                           CL**1
023906         10  MR-USERID         PIC  X(08).                           CL**1
023907                                                                          
023910         10  MR-DATEL          PIC S9(04) COMP.                      CL**1
023920         10  MR-DATEA          PIC  X(01).                           CL**1
023930         10  MR-DATEC          PIC  X(01).                           CL**1
023940         10  MR-DATEH          PIC  X(01).                           CL**1
023950         10  MR-DATE           PIC  X(08).                           CL**1
023960                                                                          
023970         10  MR-TIMEL          PIC S9(04) COMP.                      CL**1
023980         10  MR-TIMEA          PIC  X(01).                           CL**1
023990         10  MR-TIMEC          PIC  X(01).                           CL**1
023991         10  MR-TIMEH          PIC  X(01).                           CL**1
023992         10  MR-TIME           PIC  X(05).                           CL**1
024000                                                                     CL**1
024020         10  MR-VALUEL         PIC S9(04) COMP.                      CL**1
024030         10  MR-VALUEA         PIC  X(01).                           CL**1
024040         10  MR-VALUEC         PIC  X(01).                           CL**1
024050         10  MR-VALUEH         PIC  X(01).                           CL**1
024060         10  MR-VALUE          PIC  X(30).                           CL**1
024070                                                                     CL**1
024100 EJECT                                                               CL**1
024200*---------------------------------------------------------------*    CL**1
024300*    DB2 AREA FOR CONTAINER UPC TABLE                           *    CL**1
024400*---------------------------------------------------------------*    CL**1
024500     EXEC SQL                                                        CL**1
024600          INCLUDE TIMCNUP                                            CL**1
024700     END-EXEC.                                                       CL**1
024800*---------------------------------------------------------------*    CL**1
024900*    DB2 AREA FOR CONTAINER UPC AUDIT TABLE                     *    CL**1
025000*---------------------------------------------------------------*    CL**1
025100     EXEC SQL                                                        CL**1
025200          INCLUDE TAUCNUP                                            CL**1
025300     END-EXEC.                                                       CL**1
025400*---------------------------------------------------------------*    CL**1
025500*    DB2 AREA FOR COMMUNICATIONS                                *    CL**1
025600*---------------------------------------------------------------*    CL**1
025700     EXEC SQL                                                        CL**1
025800          INCLUDE SQLCA                                              CL**1
025900     END-EXEC.                                                       CL**1
026000                                                                     CL**1
026100*---------------------------------------------------------------*    CL**1
026200*    CURSOR TO OBTAIN CONTAINER UPC HISTORY INFORMATION         *    CL**1
026300*---------------------------------------------------------------*    CL**1
026400                                                                     CL**1
026500     EXEC SQL                                                        CL**1
026600          DECLARE UPC-CSR CURSOR                                     CL**1
026700          FOR SELECT                                                      
026800                A.PO_LNE_NBR                                              
026810              , A.UPC_CART_CNT                                            
026900              , A.UPC_CBMT_QTY                                            
027000              , A.UPC_WT_KGRM_QTY                                         
027001              , A.UPC_UNT_QTY                                             
027005              , A.LAST_UPD_BY_USR_ID                                      
027006              , A.LAST_UPD_TMST                                           
027007              , A.SKU_NBR                                                 
027008              , A.ASN_PKGNG_CDE                                           
027100          FROM                                                       CL**1
027200                TAUCNUP  A                                           CL**1
027300          WHERE                                                      CL**1
027310                A.PO_NBR          = :DK-PO-NBR                            
027320            AND A.CONTNR_ID       = :DK-CONTNR-NBR                        
027330            AND A.CONTNR_SEQ_NBR  = :DK-CONTNR-SEQ-NBR                    
027350            AND A.UPC_NBR         = :DK-UPC-NBR                           
027500          ORDER BY                                                   CL**1
027600                A.LAST_UPD_TMST DESC                                 CL**1
027800     END-EXEC.                                                       CL**1
027900                                                                     CL**1
028000 EJECT                                                               CL**1
028100 LINKAGE SECTION.                                                    CL**1
028200                                                                     CL**1
028300 01  DFHCOMMAREA.                                                    CL**1
028400     05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
028500                                        DEPENDING ON EIBCALEN.       CL**1
028600         10  FILLER                     PIC X.                       CL**1
028700                                                                     CL**1
028800 EJECT                                                               CL**1
028900 PROCEDURE DIVISION.                                                 CL**1
029000                                                                     CL**1
029100 0000-MAIN-MODULE.                                                   CL**1
029200                                                                     CL**8
029300     INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
029400     MOVE +1                      TO DP030-NUMBER-OF-MAPS.           CL**1
029500     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.              CL**1
029600     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).             CL**1
029700     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                           CL**1
029800     MOVE LENGTH OF TR302AI       TO DP030-MAP-LENGTH (1).           CL**1
029900     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).         CL**1
030000     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030100                                                                     CL**8
030200     PERFORM 1000-CONTROL-PROCESSING.                                CL**1
030300                                                                     CL**8
030400     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).         CL**1
030500     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030600                                                                     CL**1
030700*----------------------------------------------------------------*   CL*63
030800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *   CL*63
030900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *   CL*63
031000*----------------------------------------------------------------*   CL*63
031100                                                                     CL*63
031200 0001-CALL-CICS-ARCH-API.                                            CL**1
031300                                                                     CL**8
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                         CL**1
031500                                    DFHCOMMAREA                           
031600                                    DP030-CICS-API-FIELDS                 
031700                                    DP020-STANDARD-COMMAREA               
031800                                    TR302AI.                              
031900                                                                     CL**8
032000     IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
032100         CONTINUE                                                    CL**1
032200     ELSE                                                            CL**1
032300         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
032400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL**1
032500         SET DP013-CICS-ABEND TO TRUE                                CL**1
032600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH           CL**1
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O   CL**1
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)         CL**1
032900         MOVE DP030-RETURN-CODE                                      CL**1
033000                               TO DP013-MESSAGE-TEXT (3)             CL**1
033100         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
033200     END-IF.                                                         CL**1
033300                                                                     CL**8
033400*----------------------------------------------------------------*   CL**1
033500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *   CL**1
033600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *   CL**1
033700*                                                                *   CL**1
033800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *   CL**1
033900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *   CL**1
034000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *   CL**1
034100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *   CL**1
034200*----------------------------------------------------------------*   CL**1
034300                                                                     CL**1
034400 1000-CONTROL-PROCESSING.                                            CL**1
034500                                                                     CL**1
034600     EVALUATE TRUE                                                   CL**1
034700         WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
034800             MOVE EIBTRMID          TO ASC-DTL-TERM-ID               CL**2
034900             MOVE DP020-SRC-TASK-NUMBER                              CL**1
035000                                    TO ASC-DTL-TASK-NUMBER           CL**2
035100             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                   CL**2
035200             PERFORM 1100-PROCESS-INTER-APPL-COMM                    CL**1
035300***-----$TEMPLATE NOTE$-------------------------------------------   CL**1
035400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,   CL**1
035500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO     CL**1
035600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.   CL**1
035700***---------------------------------------------------------------   CL**1
035800             IF  PS-COMMAREA-NOT-VALID                               CL**1
035900***              MOVE PC-TSYMSG-99901                                CL**1
036000***                            TO  DP020-MSG-NUMBER                  CL**1
036100***              SET DP020-MSG-FATAL                                 CL**1
036200***                            TO  TRUE                              CL**1
036300                 SET DP020-NEXT-ACT-APPL-ERROR                       CL**1
036400                               TO  TRUE                              CL**1
036500             ELSE                                                    CL**1
036600                 PERFORM 2050-DELETE-DETAIL-QUEUE                    CL*56
036700                 PERFORM 4000-BUILD-INITIAL-PANEL                    CL**1
036800             END-IF                                                  CL**1
036900                                                                     CL**1
037000         WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
037100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
037200                               TO PV-TOP-ITEM                        CL**1
037300             PERFORM 2000-PROCESS-PANEL                              CL**1
037400                                                                     CL**1
037500         WHEN DP020-NEXT-ACT-RETURN                                  CL**1
037600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
037700                               TO PV-TOP-ITEM                        CL**1
037800             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL           CL**1
037900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
038000                                                                     CL**1
038100         WHEN OTHER                                                  CL**1
038200             SET DP013-LOGIC-ABEND TO TRUE                           CL**1
038300             SET DP013-NO-ROLLBACK TO TRUE                           CL**1
038400             MOVE '1000-CONTROL-PROCESSING'                          CL**1
038500                               TO  DP013-PARAGRAPH                   CL**1
038600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
038700                               TO  DP013-MESSAGE-TEXT(1)             CL**1
038800             PERFORM DP013-0000-PROCESS-ABEND                        CL**1
038900     END-EVALUATE.                                                   CL**1
039000                                                                     CL**1
039100 EJECT                                                               CL**1
039200*----------------------------------------------------------------*   CL**1
039300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *   CL**1
039400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *   CL**1
039500*----------------------------------------------------------------*   CL**1
039600                                                                     CL**1
039700 1100-PROCESS-INTER-APPL-COMM.                                       CL**1
039800                                                                     CL**1
039900     SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
040000     INITIALIZE ASC-SPECIFIC-COMMAREA.                               CL**1
040100     MOVE SPACE                TO ASC-START-ITEM-REQUEST.            CL**1
040110                                                                          
040200     EVALUATE DP020-INT-APPL-FORMAT-IND                                   
040300         WHEN PC-CNTR-MANIFEST-FORMAT                                     
040301             MOVE TR116-CONTNR-NO     TO ASC-KEY-CONTNR-NBR               
040303                                         DK-CONTNR-NBR                    
040304             MOVE TR116-CONTNR-SEQ-NO TO ASC-KEY-CONTNR-SEQ-NBR           
040310                                         DK-CONTNR-SEQ-NBR                
040320             MOVE TR116-PO-NBR        TO ASC-KEY-PO-NBR                   
040330                                         DK-PO-NBR                        
040340             MOVE TR116-VS-NBR        TO ASC-KEY-VS-NBR                   
040350                                         DK-VS-NBR                        
040360             MOVE TR116-COLOR         TO ASC-KEY-COLOR                    
040370             MOVE TR116-SIZE          TO ASC-KEY-SIZE                     
040380             MOVE TR116-UPC-NBR       TO ASC-KEY-UPC-NBR                  
040390                                         DK-UPC-NBR                       
042100         WHEN OTHER                                                       
042500             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER                    
042700             SET DP020-MSG-FATAL   TO TRUE                                
042800             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        
043000     END-EVALUATE.                                                        
043100                                                                          
046500*----------------------------------------------------------------*   CL**1
046600*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *   CL**1
046700*    ON WHAT FUNCTION KEY WAS SELECTED.                          *   CL**1
046800*----------------------------------------------------------------*   CL**1
046900                                                                     CL**1
047000 2000-PROCESS-PANEL.                                                 CL**1
047100                                                                     CL**8
047200     EVALUATE TRUE                                                   CL**1
047300         WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
047400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**1
047500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
047600             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
047700                                                                     CL**1
047800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
048010             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR                 
048020             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR             
048030             MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR                     
048040             MOVE ASC-KEY-VS-NBR         TO DK-VS-NBR                     
048050             MOVE ASC-KEY-UPC-NBR        TO DK-UPC-NBR                    
048100             PERFORM 2050-DELETE-DETAIL-QUEUE                        CL*44
048200             PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
048300             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
051800                                                                     CL**5
051900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL*11
052000             MOVE +1 TO PV-TOP-ITEM                                  CL*11
052100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
052200             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
052300                                                                     CL*11
052400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL*11
052500             PERFORM 2110-BROWSE-BACKWARD                            CL*11
052600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
052700             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
052800                                                                     CL*11
052900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL*11
053000             PERFORM 2120-BROWSE-FORWARD                             CL*11
053100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
053200             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
053300                                                                     CL*11
053400         WHEN DP020-SRC-AID = DP016-ENTER                            CL*11
053500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                      CL*11
053600             IF  PS-ERROR                                            CL*11
053700                 CONTINUE                                            CL*11
053800             ELSE                                                    CL*11
053900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL*11
054000                 PERFORM 3200-RESET-ATTRIBUTES                       CL*44
054100             END-IF                                                  CL*11
054200                                                                     CL*11
054300         WHEN OTHER                                                  CL*11
054400             SET DP013-NO-ROLLBACK TO TRUE                           CL*11
054500             SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*11
054600             SET DP013-CICS-ABEND TO TRUE                            CL*11
054700             MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH            CL*11
054800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL*11
054900                                   TO DP013-MESSAGE-TEXT (1)         CL*11
055000             PERFORM DP013-0000-PROCESS-ABEND                        CL*11
055100                                                                     CL*11
055200     END-EVALUATE.                                                   CL*11
055300 EJECT                                                               CL**1
055400*----------------------------------------------------------------*   CL**1
055500*    DELETE THE TEMPORARY STORAGE QUEUE.                         *   CL**1
055600*----------------------------------------------------------------*   CL**1
055700                                                                     CL**1
055800 2050-DELETE-DETAIL-QUEUE.                                           CL**6
055900                                                                     CL**1
056000     EXEC CICS                                                       CL**1
056100         DELETEQ TS                                                  CL**1
056200             QUEUE (ASC-DTL-QUEUE-NAME)                              CL**6
056300             RESP  (PV-CICS-RESP)                                    CL**1
056400     END-EXEC.                                                       CL**1
056500                                                                     CL**1
056600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                          CL**1
056700        (PV-CICS-RESP = DFHRESP(QIDERR))                             CL**1
056800         CONTINUE                                                    CL**1
056900     ELSE                                                            CL**1
057000         SET DP013-CICS-ABEND TO TRUE                                CL**1
057100         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
057200                                                                     CL**1
057300         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH          CL**6
057400         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'     CL**6
057500                        TO DP013-MESSAGE-TEXT (1)                    CL**1
057600         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
057700     END-IF.                                                         CL**1
057800                                                                     CL**1
057900     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                           CL**1
058000 EJECT                                                               CL**1
058100*----------------------------------------------------------------*   CL**1
058200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *   CL**1
058300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *   CL**1
058400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *   CL**1
058500*    MESSAGE.                                                    *   CL**1
058600*----------------------------------------------------------------*   CL**1
058700                                                                     CL**1
058800 2110-BROWSE-BACKWARD.                                               CL**1
058900                                                                     CL**8
059000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL       CL**1
059100         GIVING PV-TOP-ITEM.                                         CL**1
059200                                                                     CL**8
059300     IF  PV-TOP-ITEM < +1                                            CL**1
059400         MOVE +1              TO PV-TOP-ITEM                         CL**1
059500*        -- TOP OF LIST --                                           CL**1
059600         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                    CL**1
059700         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
059800     END-IF.                                                         CL**1
059900                                                                     CL**1
060000 EJECT                                                               CL**1
060100                                                                     CL**8
060200*----------------------------------------------------------------*   CL*58
060300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *   CL*58
060400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *   CL*58
060500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *   CL*58
060600*----------------------------------------------------------------*   CL*58
060700                                                                     CL*58
060800 2120-BROWSE-FORWARD.                                                CL*58
060900                                                                     CL*58
061000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                 CL*58
061100         GIVING PV-TOP-ITEM.                                         CL*58
061200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                      CL*58
061300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL*58
061400                                   TO PV-TOP-ITEM                    CL*58
061500*        -- BOTTOM OF LIST --                                        CL*58
061600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER               CL*58
061700         SET DP020-MSG-INFORMATIONAL                                 CL*58
061800                                   TO TRUE                           CL*58
061900     ELSE                                                            CL*58
062000         COMPUTE PV-BOTTOM-ITEM =                                    CL*58
062100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                    CL*58
062200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ               CL*58
062300*            -- BOTTOM OF LIST --                                    CL*58
062400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER               CL*58
062500             SET DP020-MSG-INFORMATIONAL                             CL*58
062600                                   TO TRUE                           CL*58
062700         END-IF                                                      CL*58
062800     END-IF.                                                         CL*58
062900 EJECT                                                               CL*58
063000*----------------------------------------------------------------*   CL**1
063100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *   CL**1
063200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *   CL**1
063300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *   CL**1
063400*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *   CL**1
063500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *   CL**1
063600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *   CL**1
063700*----------------------------------------------------------------*   CL**1
063800                                                                     CL**1
063900 2130-CHECK-FOR-JUMP-BROWSE.                                         CL*58
064000                                                                     CL*58
064100     IF ASTRTITL > ZERO                                              CL*58
064200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST         CL*58
064300     ELSE                                                            CL*58
064400         IF ASTRTITF = DP015-ERASE-EOF                               CL*58
064500             INITIALIZE ASC-START-ITEM-REQUEST                       CL*58
064600         END-IF                                                      CL*58
064700     END-IF.                                                         CL*58
064800                                                                     CL*58
064900     SET PS-NO-ERROR               TO TRUE.                          CL*58
065000     IF (ASC-START-ITEM-REQUEST = SPACE)                             CL*58
065100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL*58
065200                                   TO PV-TOP-ITEM                    CL*58
065300     ELSE                                                            CL*58
065400         MOVE ASC-START-ITEM-REQUEST                                 CL*58
065500                                   TO DP010I-UNEDITED-FIELD          CL*58
065600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS          CL*58
065700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS        CL*58
065800         SET DP010I-NEGATIVE-NOT-ALLOWED                             CL*58
065900                                   TO TRUE                           CL*58
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
066100                                                                     CL*58
066200         IF  NOT DP010I-ERROR-DETECTED                               CL*58
066300             MOVE DP010I-NUMERIC-FIELD                               CL*58
066400                                   TO  ASC-START-ITEM-REQUEST-N      CL*58
066500             IF  ASC-START-ITEM-REQUEST-N > ZERO                     CL*58
066600                 IF  ASC-START-ITEM-REQUEST-N >                      CL*58
066700                                          ASC-NUMBER-OF-ITEMS-READ   CL*58
066800                     MOVE SPACE TO ASC-START-ITEM-REQUEST            CL*58
066900                     COMPUTE PV-TOP-ITEM =                           CL*58
067000                             ASC-NUMBER-OF-ITEMS-READ                CL*58
067100                             - PC-ITEMS-PER-PANEL + 1                CL*58
067200                     IF  PV-TOP-ITEM < +1                            CL*58
067300                         MOVE +1   TO PV-TOP-ITEM                    CL*58
067400                         MOVE PC-TSYMSG-00070                        CL*58
067500                                   TO DP020-MSG-NUMBER               CL*58
067600                         SET DP020-MSG-INFORMATIONAL                 CL*58
067700                                   TO TRUE                           CL*58
067800                     END-IF                                          CL*58
067900                 ELSE                                                CL*58
068000                     MOVE ASC-START-ITEM-REQUEST-N                   CL*58
068100                                   TO PV-TOP-ITEM                    CL*58
068200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST         CL*58
068300                     COMPUTE PV-BOTTOM-ITEM =                        CL*58
068400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1        CL*58
068500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ   CL*58
068600*                        -- BOTTOM OF LIST --                        CL*58
068700                         MOVE PC-TSYMSG-00070                        CL*58
068800                                   TO DP020-MSG-NUMBER               CL*58
068900                         SET DP020-MSG-INFORMATIONAL                 CL*58
069000                                   TO TRUE                           CL*58
069100                     END-IF                                          CL*58
069200                 END-IF                                              CL*58
069300             ELSE                                                    CL*58
069400*                --- VALUE OUT OF RANGE ----                         CL*58
069500                 MOVE PC-TSYMSG-00101                                CL*58
069600                                   TO DP020-MSG-NUMBER               CL*58
069700                 MOVE -1           TO ASTRTITL                       CL*58
069800                 SET DP030-SET-CURSOR-APPL-1                         CL*58
069900                                   TO TRUE                           CL*58
070000                 MOVE DP015-REVERSE                                  CL*58
070100                                   TO ASTRTITH                       CL*58
070200                 MOVE DP015-RED    TO ASTRTITC                       CL*58
070300                 MOVE DP015-UNP-NUM-BRT-MDT                          CL*58
070400                                   TO ASTRTITA                       CL*58
070500                 SET DP020-MSG-FATAL                                 CL*58
070600                                   TO TRUE                           CL*58
070700                 SET PS-ERROR      TO TRUE                           CL*58
070800             END-IF                                                  CL*58
070900                                                                     CL*58
071000         ELSE                                                        CL*58
071100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER               CL*58
071200             MOVE -1               TO ASTRTITL                       CL*58
071300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                     CL*58
071400             MOVE DP015-REVERSE    TO ASTRTITH                       CL*58
071500             MOVE DP015-RED        TO ASTRTITC                       CL*58
071600             MOVE DP015-UNP-NUM-BRT-MDT                              CL*58
071700                                   TO ASTRTITA                       CL*58
071800             SET DP020-MSG-FATAL   TO TRUE                           CL*58
071900             SET PS-ERROR          TO TRUE                           CL*58
072000         END-IF                                                      CL*58
072100     END-IF.                                                         CL*58
072300                                                                     CL**1
072400*----------------------------------------------------------------*   CL**1
072500*    RESET THE MAP FIELD ATTRIBUTES.                             *   CL**1
072900*----------------------------------------------------------------*   CL**1
078900 3200-RESET-ATTRIBUTES.                                              CL**1
079000                                                                     CL**8
079100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                      CL**1
079200     MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
079300     MOVE DP015-UNDERLINE          TO ASTRTITH.                      CL**1
079400     MOVE -1                       TO ASTRTITL.                      CL*62
079500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                          CL*62
079600                                                                     CL**8
079900*----------------------------------------------------------------*   CL**1
080000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
080100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
080200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
080300*    DISPLAY THE PANEL TO USER.                                  *   CL**1
080400*----------------------------------------------------------------*   CL**1
080500                                                                     CL**1
080600 4000-BUILD-INITIAL-PANEL.                                           CL**1
080700                                                                     CL**1
080800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)               CL**1
080900                                 ASC-BLOCK-ENTRIES (2).              CL**1
081000     MOVE +1                 TO  ASC-BLK-SUB.                        CL**1
081100     SET ASC-ITEMS-LEFT-ON-DB                                        CL**1
081200                             TO  TRUE.                               CL**1
081300                                                                     CL**1
081400     MOVE +0                 TO  ASC-ITEM-SUB                        CL**1
081500                                 ASC-NUMBER-OF-ITEMS-READ            CL**1
081600                                 ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
081700                                 ASC-HIGHEST-BLOCK-WRITTEN           CL**1
081800                                 ASC-START-OF-SELECTED-RANGE         CL**1
081900                                 ASC-END-OF-SELECTED-RANGE           CL**1
082000                                 ASC-ITEM-AT-TOP-OF-PANEL.           CL**1
082100                                                                     CL**1
082410     PERFORM 4030-SELECT-TIMCNUP.                                         
082420                                                                          
082421     IF PS-TIMCNUP-ROW-NO                                                 
082422         CONTINUE                                                         
082423     ELSE                                                                 
082430         PERFORM 4040-MOVE-TIMCNUP-TO-HOLD                                
082500         PERFORM 4010-OPEN-CURSOR                                         
082700         PERFORM 4300-READ-ITEMS-FROM-DB                                  
082900         PERFORM 4020-CLOSE-CURSOR                                        
082910     END-IF.                                                              
083000                                                                          
083100     MOVE +1                 TO  PV-TOP-ITEM.                             
083200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
083300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                            
083400         SET DP020-MSG-FATAL   TO  TRUE                              CL**1
083410*--------NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED---           
083500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
083600     ELSE                                                            CL**1
083700         MOVE -1             TO ASTRTITL                             CL**1
083800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                         CL**1
083900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        CL**1
084000     END-IF.                                                         CL**1
084100 EJECT                                                               CL**1
084200*----------------------------------------------------------------*   CL**1
084300* OPEN THE UPC CURSOR.                                           *   CL*12
084400*----------------------------------------------------------------*   CL**1
084500                                                                     CL**1
084600 4010-OPEN-CURSOR.                                                   CL**1
084700                                                                     CL**1
084800     EXEC SQL                                                        CL*64
084900          OPEN UPC-CSR                                               CL*64
085000     END-EXEC.                                                       CL*64
085100                                                                     CL*64
085200     EVALUATE TRUE                                                   CL*64
085300         WHEN SQLCODE = ZERO                                         CL*64
085400              CONTINUE                                               CL*64
085500         WHEN SQLWARN0 NOT EQUAL SPACE                               CL*64
085600         WHEN SQLCODE NOT EQUAL ZERO                                 CL*64
085700              MOVE '4010-OPEN-CURSOR'                                CL*64
085800                           TO  DP013-PARAGRAPH                       CL*64
085900              MOVE 'OPEN UPC CURSOR'                                 CL*64
086000                           TO  DP013-MESSAGE-TEXT (1)                CL*64
086100              MOVE SQLCA   TO  DP013-SQLCA                           CL*64
086200              SET DP013-DB2-ABEND                                    CL*64
086300                           TO  TRUE                                  CL*64
086400              PERFORM DP013-0000-PROCESS-ABEND                       CL*64
086500     END-EVALUATE.                                                   CL*64
086600                                                                     CL**1
086700 EJECT                                                               CL**1
086800*----------------------------------------------------------------*   CL**1
086900* CLOSE THE UPC CURSOR.                                          *   CL*12
087000*----------------------------------------------------------------*   CL**1
087100                                                                     CL**1
087200 4020-CLOSE-CURSOR.                                                  CL**1
087300                                                                     CL**1
087400     EXEC SQL                                                        CL*64
087500         CLOSE UPC-CSR                                               CL*64
087600     END-EXEC.                                                       CL*64
087700                                                                     CL*64
087800     EVALUATE TRUE                                                   CL*64
087900         WHEN SQLCODE = ZERO                                         CL*64
088000              CONTINUE                                               CL*64
088100         WHEN SQLWARN0 NOT EQUAL SPACE                               CL*64
088200         WHEN SQLCODE NOT EQUAL ZERO                                 CL*64
088300              MOVE '4020-CLOSE-CURSOR'                               CL*64
088400                           TO  DP013-PARAGRAPH                       CL*64
088500              MOVE 'CLOSE UPC CURSOR'                                CL*64
088600                           TO  DP013-MESSAGE-TEXT (1)                CL*64
088700              MOVE SQLCA   TO  DP013-SQLCA                           CL*64
088800              SET DP013-DB2-ABEND                                    CL*64
088900                           TO  TRUE                                  CL*64
089000              PERFORM DP013-0000-PROCESS-ABEND                       CL*64
089100     END-EVALUATE.                                                   CL*64
089200                                                                     CL**1
089300 EJECT                                                               CL**1
089302*----------------------------------------------------------------*   CL**1
089305* SELECT A ROW FROM THE CONTAINER UPC TABLE (TIMCNUP).           *        
089307*----------------------------------------------------------------*   CL**1
089308 4030-SELECT-TIMCNUP.                                                     
089309                                                                          
089310     PERFORM                                                              
089311         WITH TEST AFTER                                                  
089312         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
089313         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
089314                 SQLCODE = ZERO                     OR                    
089315                 SQLCODE = +100                                           
089316                                                                          
089317         EXEC SQL                                                         
089324             SELECT PO_LNE_NBR,                                           
089325                    UPC_CART_CNT,                                         
089326                    UPC_CBMT_QTY,                                         
089327                    UPC_WT_KGRM_QTY,                                      
089328                    UPC_UNT_QTY,                                          
089333                    LAST_UPD_BY_USR_ID,                                   
089334                    LAST_UPD_TMST,                                        
089335                    SKU_NBR,                                              
089336                    ASN_PKGNG_CDE                                         
089341              INTO :IMCNUP-PO-LNE-NBR,                                    
089342                   :IMCNUP-UPC-CART-CNT,                                  
089343                   :IMCNUP-UPC-CBMT-QTY,                                  
089344                   :IMCNUP-UPC-WT-KGRM-QTY,                               
089345                   :IMCNUP-UPC-UNT-QTY,                                   
089350                   :IMCNUP-LAST-UPD-BY-USR-ID,                            
089360                   :IMCNUP-LAST-UPD-TMST,                                 
089370                   :IMCNUP-SKU-NBR,                                       
089380                   :IMCNUP-ASN-PKGNG-CDE                                  
089417                                                                          
089418               FROM TIMCNUP                                               
089419              WHERE CONTNR_ID        = :DK-CONTNR-NBR                     
089420                AND CONTNR_SEQ_NBR   = :DK-CONTNR-SEQ-NBR                 
089421                AND PO_NBR           = :DK-PO-NBR                         
089423                AND UPC_NBR          = :DK-UPC-NBR                        
089424         END-EXEC                                                         
089425                                                                          
089426         EVALUATE TRUE                                            00117861
089427             WHEN SQLCODE = -904                                  00118161
089428             WHEN SQLCODE = -913                                  00118261
089429                 CONTINUE                                         00118361
089430             WHEN SQLCODE = ZERO                                  00118461
089432                  SET PS-TIMCNUP-ROW TO TRUE                              
089433             WHEN SQLCODE = +100                                  00118661
089434                  SET PS-TIMCNUP-ROW-NO TO TRUE                           
089435             WHEN SQLWARN0 NOT = SPACES                           00118861
089436             WHEN SQLCODE < ZERO                                  00118961
089437             WHEN SQLCODE > ZERO                                  00119061
089438                 MOVE '4030-SELECT-TIMCNUP'                       00119161
089439                                   TO DP013-PARAGRAPH             00119261
089440                 MOVE 'SQL ERROR SELECTING CONTNR UPC'            00119361
089441                                   TO DP013-MESSAGE-TEXT (1)      00119461
089442                 MOVE SQLCA        TO DP013-SQLCA                 00119561
089443                 MOVE 'TIMCNUP '   TO DP013-DB2-TABLE-NAME (1)    00119661
089444                 SET DP013-DB2-ABEND                              00119761
089445                     DP013-XCTL-DISPLAY-RESTART TO TRUE           00119861
089446                 PERFORM DP013-0000-PROCESS-ABEND                 00119961
089447         END-EVALUATE                                             00120061
089448     END-PERFORM.                                                 00120161
089449*                                                                 00120261
089450     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        00120361
089451         MOVE '4030-SELECT-TIMCNUP'                               00120461
089452                                   TO DP013-PARAGRAPH             00120561
089453         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT UPC' 00120661
089454                                   TO DP013-MESSAGE-TEXT (1)      00120761
089455         MOVE SQLCA                TO DP013-SQLCA                 00120861
089456         MOVE 'TIMCNUP '           TO DP013-DB2-TABLE-NAME (1)    00120961
089457         SET DP013-DB2-ABEND                                      00121061
089458             DP013-XCTL-DISPLAY-RESTART                           00121161
089459                                   TO TRUE                        00121261
089460         PERFORM DP013-0000-PROCESS-ABEND                         00121361
089461     END-IF.                                                      00121461
089462                                                                  00123222
089463 EJECT                                                            00123361
089464*----------------------------------------------------------------*   CL**1
089465* MOVE SELECTED TIMCNUP VALUES TO HOLD FIELDS FOR COMPARISON.    *        
089466*----------------------------------------------------------------*   CL**1
089467 4040-MOVE-TIMCNUP-TO-HOLD.                                               
089468                                                                          
089469     MOVE IMCNUP-PO-LNE-NBR         TO PV-PREV-PO-LNE-NBR.                
089470     MOVE IMCNUP-UPC-CART-CNT       TO PV-PREV-UPC-CART-CNT.              
089471     MOVE IMCNUP-UPC-CBMT-QTY       TO PV-PREV-UPC-CBMT-QTY.              
089472     MOVE IMCNUP-UPC-WT-KGRM-QTY    TO PV-PREV-UPC-WT-KGRM-QTY.           
089473     MOVE IMCNUP-UPC-UNT-QTY        TO PV-PREV-UPC-UNT-QTY.               
089491     MOVE IMCNUP-LAST-UPD-BY-USR-ID TO                                    
089492                                    PV-PREV-LAST-UPD-BY-USR-ID.           
089493     MOVE IMCNUP-LAST-UPD-TMST      TO PV-PREV-LAST-UPD-TMST.             
089494     MOVE IMCNUP-SKU-NBR            TO PV-PREV-SKU-NBR.                   
089495     MOVE IMCNUP-ASN-PKGNG-CDE      TO PV-PREV-ASN-PKGNG-CDE.             
089500                                                                          
089520*----------------------------------------------------------------*   CL**1
089530*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *   CL**1
089600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *   CL**1
089700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *   CL**1
089800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *   CL**1
089900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *   CL**1
090000*                                                                *   CL**1
090100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *   CL**1
090200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *   CL**1
090300*    UPON INITIALIZATION.                                        *   CL**1
090400*----------------------------------------------------------------*   CL**1
090500                                                                     CL**1
090600 4300-READ-ITEMS-FROM-DB.                                            CL**1
090700                                                                     CL**1
092100     PERFORM                                                         CL**1
092200         VARYING PV-READ-COUNT                                       CL**1
092300         FROM 1 BY 1                                                 CL**1
092400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                       CL**1
092500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                            CL**1
092600                                                                     CL**1
092700         PERFORM 4310-FETCH                                          CL**1
092800                                                                     CL**1
092900         IF  ASC-ITEMS-LEFT-ON-DB                                    CL**1
093010             PERFORM 4330-CHECK-FOR-CHANGES                               
095700         END-IF                                                      CL**1
095800     END-PERFORM.                                                    CL**1
095900                                                                     CL**1
096000     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                                   
096900         MOVE +1                       TO  ASC-BLK-SUB                    
097000         PERFORM 5100-WRITE-TEMP-STORAGE                                  
097100         ADD +1                        TO  ASC-BLK-SUB                    
097200         PERFORM 5100-WRITE-TEMP-STORAGE                                  
097300                                                                          
097400         MOVE 1                        TO  ASC-BLK-SUB                    
097500                                           PV-BLOCK-NUMBER                
097600         PERFORM 4410-READ-TEMP-STORAGE                                   
097700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
097800              MOVE 2                    TO  ASC-BLK-SUB                   
097900                                            PV-BLOCK-NUMBER               
098000              PERFORM 4410-READ-TEMP-STORAGE                              
098010         END-IF                                                           
098100     END-IF.                                                              
098200 EJECT                                                                    
098300*----------------------------------------------------------------*   CL**1
098400*    FETCH THE UPC CURSOR.                                       *   CL*61
098500*----------------------------------------------------------------*   CL**1
098600                                                                     CL**1
098700 4310-FETCH.                                                         CL**1
098800                                                                     CL**1
098900     PERFORM                                                         CL**1
099000         WITH TEST AFTER                                             CL**1
099100         VARYING PV-SQL-SUB                                          CL**1
099200         FROM 1 BY 1                                                 CL**1
099300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
099400            OR SQLCODE = 0                                           CL**1
099500            OR SQLCODE = +100                                        CL**1
099600                                                                     CL**1
099700         EXEC SQL                                                    CL*15
099800              FETCH UPC-CSR                                          CL*15
099900              INTO                                                   CL*15
100000                    :AUCNUP-PO-LNE-NBR                                    
100010                  , :AUCNUP-UPC-CART-CNT                                  
100100                  , :AUCNUP-UPC-CBMT-QTY                                  
100200                  , :AUCNUP-UPC-WT-KGRM-QTY                               
100210                  , :AUCNUP-UPC-UNT-QTY                                   
100232                  , :AUCNUP-LAST-UPD-BY-USR-ID                            
100233                  , :AUCNUP-LAST-UPD-TMST                                 
100234                  , :AUCNUP-SKU-NBR                                       
100235                  , :AUCNUP-ASN-PKGNG-CDE                                 
100300         END-EXEC                                                    CL*15
100400                                                                     CL**1
100500         EVALUATE TRUE                                               CL**1
100600             WHEN SQLCODE = ZERO                                     CL**1
100700             WHEN SQLCODE = +100                                     CL**1
100800             WHEN SQLCODE = -904                                     CL**1
100900             WHEN SQLCODE = -913                                     CL**1
101000                  CONTINUE                                           CL**1
101100             WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
101200             WHEN SQLCODE NOT EQUAL ZERO                             CL**1
101300                  MOVE '4310-FETCH-CURSOR'                           CL**1
101400                               TO  DP013-PARAGRAPH                   CL**1
101500                  MOVE 'FETCH UPC CURSOR'                            CL**1
101600                               TO  DP013-MESSAGE-TEXT (1)            CL**1
101700                  MOVE SQLCA   TO  DP013-SQLCA                       CL**1
101800                  SET DP013-DB2-ABEND                                CL**1
101900                               TO  TRUE                              CL**1
102000                  PERFORM DP013-0000-PROCESS-ABEND                   CL**1
102100         END-EVALUATE                                                CL**1
102200     END-PERFORM.                                                    CL**1
102300                                                                     CL**1
102400     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
102500         MOVE '4310-FETCH-CURSOR'                                    CL**1
102600                               TO  DP013-PARAGRAPH                   CL**1
102700         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
102800                               TO  DP013-MESSAGE-TEXT (1)            CL**1
102900         MOVE SQLCA            TO  DP013-SQLCA                       CL**1
103000         SET DP013-DB2-ABEND   TO  TRUE                              CL**1
103100         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
103200     END-IF.                                                         CL**1
103300                                                                     CL**1
103400     IF  SQLCODE EQUAL +100                                          CL**1
103500         SET ASC-NO-ITEMS-LEFT-ON-DB                                 CL**1
103600                               TO  TRUE                              CL**1
103700     END-IF.                                                         CL**1
103800                                                                     CL**1
103900 EJECT                                                               CL**1
104000*----------------------------------------------------------------*   CL*30
104100*    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *   CL*32
104200*----------------------------------------------------------------*   CL*30
104300                                                                     CL*30
104400 4320-GET-SUB.                                                       CL*30
104500                                                                     CL*30
104600     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                           CL*30
104700         ADD +1            TO  ASC-ITEM-SUB                          CL*30
104800     ELSE                                                            CL*30
104900         ADD +1            TO  ASC-BLK-SUB                           CL*30
105000         MOVE +1           TO  ASC-ITEM-SUB                          CL*30
105100                                                                     CL*30
105200         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                    CL*30
105300             MOVE +1       TO  ASC-BLK-SUB                           CL*30
105400             PERFORM 5100-WRITE-TEMP-STORAGE                         CL*30
105500             MOVE ASC-BLOCK-ENTRIES                                  CL*30
105600                       (PC-MAX-BLOCKS-IN-ARRAY)                      CL*30
105700             TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                     CL*30
105800             ADD +1        TO  ASC-BLK-SUB                           CL*30
105900             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)              CL*30
106000         END-IF                                                      CL*30
106100     END-IF.                                                         CL*30
106200                                                                     CL*30
106300     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.                  CL*30
106400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL*33
106500                                      (ASC-BLK-SUB                   CL*33
106600                                       ASC-ITEM-SUB).                CL*50
106610                                                                     CL*33
106620*----------------------------------------------------------------*   CL*30
106630*    COMPARE THE PREVIOUS VALUES TO THE CURRENT TAUCNPO VALUES   *   CL*32
106631*    TO SEE WHAT CHANGES OCCURRED.                               *        
106640*----------------------------------------------------------------*   CL*30
106650 4330-CHECK-FOR-CHANGES.                                             CL*30
106660                                                                     CL*30
106670     IF AUCNUP-PO-LNE-NBR NOT EQUAL PV-PREV-PO-LNE-NBR                    
106680         MOVE PV-PREV-PO-LNE-NBR        TO PV-HOLD-AFTER-VALUE-N          
106690         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106700         MOVE AUCNUP-PO-LNE-NBR         TO PV-HOLD-BEFORE-VALUE-N         
106710         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106711         MOVE 'PO LINE NBR         '    TO PV-HOLD-FIELD-NAME             
106712         PERFORM 4340-PROCESS-CHANGES                                     
106713     END-IF.                                                              
106714                                                                          
106720     IF AUCNUP-UPC-CART-CNT NOT EQUAL PV-PREV-UPC-CART-CNT                
106721         MOVE PV-PREV-UPC-CART-CNT      TO PV-HOLD-AFTER-VALUE-N          
106722         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106723         MOVE AUCNUP-UPC-CART-CNT       TO PV-HOLD-BEFORE-VALUE-N         
106724         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106725         MOVE 'CTN                 '    TO PV-HOLD-FIELD-NAME             
106726         PERFORM 4340-PROCESS-CHANGES                                     
106727     END-IF.                                                              
106728                                                                          
106729     IF AUCNUP-UPC-CBMT-QTY NOT EQUAL PV-PREV-UPC-CBMT-QTY                
106730         MOVE PV-PREV-UPC-CBMT-QTY      TO PV-HOLD-AFTER-VALUE-V          
106731         MOVE PV-HOLD-AFTER-VALUE-V     TO PV-HOLD-AFTER-VALUE            
106732         MOVE AUCNUP-UPC-CBMT-QTY       TO PV-HOLD-BEFORE-VALUE-V         
106733         MOVE PV-HOLD-BEFORE-VALUE-V    TO PV-HOLD-BEFORE-VALUE           
106734         MOVE 'CBM                 '    TO PV-HOLD-FIELD-NAME             
106735         PERFORM 4340-PROCESS-CHANGES                                     
106736     END-IF.                                                              
106737                                                                          
106738     IF AUCNUP-UPC-WT-KGRM-QTY NOT EQUAL PV-PREV-UPC-WT-KGRM-QTY          
106739         MOVE PV-PREV-UPC-WT-KGRM-QTY   TO PV-HOLD-AFTER-VALUE-N          
106740         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106741         MOVE AUCNUP-UPC-WT-KGRM-QTY    TO PV-HOLD-BEFORE-VALUE-N         
106742         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106743         MOVE 'KGS                 '    TO PV-HOLD-FIELD-NAME             
106744         PERFORM 4340-PROCESS-CHANGES                                     
106745     END-IF.                                                              
106746                                                                          
106747     IF AUCNUP-UPC-UNT-QTY    NOT EQUAL PV-PREV-UPC-UNT-QTY               
106748         MOVE PV-PREV-UPC-UNT-QTY       TO PV-HOLD-AFTER-VALUE-N          
106749         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106750         MOVE AUCNUP-UPC-UNT-QTY        TO PV-HOLD-BEFORE-VALUE-N         
106751         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106752         MOVE 'UNITS               '    TO PV-HOLD-FIELD-NAME             
106753         PERFORM 4340-PROCESS-CHANGES                                     
106754     END-IF.                                                              
106755                                                                          
106756     IF AUCNUP-SKU-NBR NOT EQUAL PV-PREV-SKU-NBR                          
106757         MOVE PV-PREV-SKU-NBR           TO PV-HOLD-AFTER-VALUE-N          
106758         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106759         MOVE AUCNUP-SKU-NBR            TO PV-HOLD-BEFORE-VALUE-N         
106760         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106761         MOVE 'SKU NBR             '    TO PV-HOLD-FIELD-NAME             
106762         PERFORM 4340-PROCESS-CHANGES                                     
106763     END-IF.                                                              
106764                                                                          
106765     IF AUCNUP-ASN-PKGNG-CDE NOT EQUAL PV-PREV-ASN-PKGNG-CDE              
106766         MOVE PV-PREV-ASN-PKGNG-CDE     TO PV-HOLD-AFTER-VALUE            
106767         MOVE AUCNUP-ASN-PKGNG-CDE      TO PV-HOLD-BEFORE-VALUE           
106768         MOVE 'ASN PKGNG CDE       '    TO PV-HOLD-FIELD-NAME             
106769         PERFORM 4340-PROCESS-CHANGES                                     
106770     END-IF.                                                              
106780                                                                          
106784     PERFORM 4345-MOVE-TAUCNUP-TO-HOLD.                                   
106785                                                                     CL*33
106788*----------------------------------------------------------------*   CL*30
106789*    FORMAT DATE AND TIME FROM LAST UPDATED TIMESTAMP.           *   CL*32
106790*----------------------------------------------------------------*   CL*30
106791 4335-FORMAT-LAST-UPD-TMST.                                          CL*30
106792                                                                     CL*30
106793     IF PV-PREV-LAST-UPD-TMST(1:10) EQUAL PC-INIT-DATE                    
106794         MOVE SPACES                      TO PV-FORMAT-DATE               
106795     ELSE                                                                 
106796         MOVE PV-PREV-LAST-UPD-TMST(9:2)  TO PV-FORMAT-DD                 
106797         MOVE PV-PREV-LAST-UPD-TMST(6:2)  TO PV-FORMAT-MM                 
106798         MOVE PV-PREV-LAST-UPD-TMST(3:2)  TO PV-FORMAT-YY                 
106799         MOVE PC-SLASH                    TO PV-FORMAT-SLASH1             
106800                                             PV-FORMAT-SLASH2             
106801     END-IF.                                                              
106802                                                                          
106803     IF PV-PREV-LAST-UPD-TMST(12:5) EQUAL PC-INIT-TIME                    
106804         MOVE SPACES                      TO PV-FORMAT-TIME               
106805     ELSE                                                                 
106806         MOVE PV-PREV-LAST-UPD-TMST(12:2) TO PV-FORMAT-HOUR               
106807         MOVE PV-PREV-LAST-UPD-TMST(15:2) TO PV-FORMAT-MIN                
106808         MOVE PC-COLON                    TO PV-FORMAT-COLON              
106809     END-IF.                                                              
106810                                                                          
106811*----------------------------------------------------------------*   CL*30
106812*    PROCESS THE CHANGES THAT WERE FOUND FOR THE AUDIT ROW.      *   CL*32
106813*----------------------------------------------------------------*   CL*30
106814 4340-PROCESS-CHANGES.                                               CL*30
106815                                                                     CL*30
106817     PERFORM 4320-GET-SUB.                                                
106818                                                                          
106819     MOVE PV-HOLD-FIELD-NAME   TO ASC-DATA                                
106820                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106821     MOVE PV-PREV-LAST-UPD-BY-USR-ID TO                                   
106822                                  ASC-USERID                              
106823                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106824     PERFORM 4335-FORMAT-LAST-UPD-TMST.                                   
106825     MOVE PV-FORMAT-DATE       TO ASC-DATE                                
106826                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106827     MOVE PV-FORMAT-TIME       TO ASC-TIME                                
106828                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106829                                                                          
106830     IF PV-HOLD-AFTER-VALUE = SPACES                                      
106831         MOVE 'NO DATA'            TO ASC-VALUE                           
106832                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
106833     ELSE                                                                 
106834         MOVE PV-HOLD-AFTER-VALUE TO ASC-VALUE                            
106835                                    (ASC-BLK-SUB ASC-ITEM-SUB)            
106836     END-IF.                                                              
106837                                                                          
106838     PERFORM 4320-GET-SUB.                                                
106839                                                                          
106840     MOVE SPACES               TO ASC-DATA                                
106841                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106842                                  ASC-USERID                              
106843                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106844                                  ASC-DATE                                
106845                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106846                                  ASC-TIME                                
106847                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106848                                                                          
106849     IF PV-HOLD-BEFORE-VALUE = SPACES                                     
106850         MOVE 'NO DATA'            TO ASC-VALUE                           
106851                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
106852     ELSE                                                                 
106853         MOVE PV-HOLD-BEFORE-VALUE  TO ASC-VALUE                          
106854                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
106855     END-IF.                                                              
106856                                                                          
106857*----------------------------------------------------------------*   CL**1
106858* MOVE TAUCNUP VALUES TO HOLD FIELDS FOR COMPARISON.             *        
106859*----------------------------------------------------------------*   CL**1
106860 4345-MOVE-TAUCNUP-TO-HOLD.                                               
106861                                                                          
106868     MOVE AUCNUP-PO-LNE-NBR         TO PV-PREV-PO-LNE-NBR.                
106869     MOVE AUCNUP-UPC-CART-CNT       TO PV-PREV-UPC-CART-CNT.              
106870     MOVE AUCNUP-UPC-CBMT-QTY       TO PV-PREV-UPC-CBMT-QTY.              
106871     MOVE AUCNUP-UPC-WT-KGRM-QTY    TO PV-PREV-UPC-WT-KGRM-QTY.           
106872     MOVE AUCNUP-UPC-UNT-QTY        TO PV-PREV-UPC-UNT-QTY.               
106876     MOVE AUCNUP-LAST-UPD-BY-USR-ID TO                                    
106877                                    PV-PREV-LAST-UPD-BY-USR-ID.           
106878     MOVE AUCNUP-LAST-UPD-TMST      TO PV-PREV-LAST-UPD-TMST.             
106879     MOVE AUCNUP-SKU-NBR            TO PV-PREV-SKU-NBR.                   
106880     MOVE AUCNUP-ASN-PKGNG-CDE      TO PV-PREV-ASN-PKGNG-CDE.             
106890                                                                          
106925*----------------------------------------------------------------*   CL**1
106930*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *   CL**1
107000*----------------------------------------------------------------*   CL**1
107200 4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
107300                                                                     CL**8
107400     MOVE ASC-KEY-CONTNR-NBR     TO ACNTNRO.                         CL*53
107500     MOVE ASC-KEY-PO-NBR         TO APONBRO.                         CL*53
107600     MOVE ASC-KEY-VS-NBR         TO AVSNBRO.                              
107610     MOVE ASC-KEY-COLOR          TO ACOLORO.                              
107620     MOVE ASC-KEY-SIZE           TO ASIZEO.                               
107630     MOVE ASC-KEY-UPC-NBR        TO AUPCO.                                
107700                                                                     CL*53
107800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                CL**1
107900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))             CL**1
108000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))             CL**1
108100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                CL**1
108200                 GIVING PV-BLOCK-NUMBER                              CL**1
108300                 REMAINDER PV-REMAINDER                              CL**1
108400             IF  PV-REMAINDER > ZERO                                 CL**1
108500                 ADD +1 TO PV-BLOCK-NUMBER                           CL**1
108600             END-IF                                                  CL**1
108700             MOVE +1    TO ASC-BLK-SUB                               CL**1
108800             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
108900             ADD +1     TO ASC-BLK-SUB                               CL**1
109000                           PV-BLOCK-NUMBER                           CL**1
109100             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
109200     END-IF.                                                         CL**1
109300     MOVE +1                       TO ASC-BLK-SUB.                   CL**1
109400     COMPUTE ASC-ITEM-SUB =                                          CL**1
109500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                 CL**1
109600         + PC-ITEMS-PER-PANEL).                                      CL**1
109700                                                                     CL**8
109800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
109900         ADD +1   TO ASC-BLK-SUB                                     CL**1
110000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
110100     END-IF.                                                         CL**1
110200                                                                     CL**8
110300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                              CL**1
110400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                   CL**1
110500     PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
110600         VARYING PS-SUB                                              CL**1
110700         FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
110800         UNTIL PS-SUB < +1.                                          CL**1
110900                                                                     CL**8
111000     COMPUTE ASC-ITEMS-DISPLAYED =                                   CL**1
111100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).             CL**1
111200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
111300                                      ASTRTITO.                      CL**1
111400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                       CL**1
111500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                       CL**1
111600                                                                     CL*36
111700     IF  DP020-MSG-NUMBER-X = SPACE                                  CL*65
111800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ     CL*65
111900*            --- MORE ITEMS TO DISPLAY ----                          CL*65
112000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER               CL*65
112100             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL*65
112200         END-IF                                                      CL*65
112300     END-IF.                                                         CL*65
112400                                                                     CL*65
112500*----------------------------------------------------------------*   CL**1
112600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *   CL**1
112700*----------------------------------------------------------------*   CL**1
112800                                                                     CL**1
112900 4410-READ-TEMP-STORAGE.                                             CL**1
113000                                                                     CL**1
113100     EXEC CICS                                                       CL**1
113200         READQ TS                                                    CL**1
113300             QUEUE (ASC-DTL-QUEUE-NAME)                              CL*17
113400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
113500             ITEM  (PV-BLOCK-NUMBER)                                 CL**1
113600             RESP  (PV-CICS-RESP)                                    CL**1
113700     END-EXEC.                                                       CL**1
113800                                                                     CL**1
113900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                          CL**1
114000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                        CL**1
114100         CONTINUE                                                    CL**1
114200     ELSE                                                            CL**1
114300         SET DP013-CICS-ABEND TO  TRUE                               CL**1
114400         SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
114500         MOVE '4410-READ-TEMP-STORAGE'                               CL**1
114600                               TO  DP013-PARAGRAPH                   CL**1
114700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'         CL**1
114800                               TO  DP013-MESSAGE-TEXT(1)             CL**1
114900         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
115000     END-IF.                                                         CL**1
115100                                                                     CL**1
115200*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL*17
115300                                                                     CL**8
115400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                            CL**1
115500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                  CL**1
115600     END-IF.                                                         CL**1
115700 EJECT                                                               CL**1
115800*----------------------------------------------------------------*   CL**1
115900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *   CL**1
116000*----------------------------------------------------------------*   CL**1
116100                                                                     CL**1
116200 4420-FORMAT-LIST-LINES.                                             CL**1
116300                                                                     CL**8
116400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ         CL**1
116500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                   CL**1
116600         MOVE SPACES            TO MR-DATA   (PS-SUB)                CL*17
116601                                   MR-USERID (PS-SUB)                     
116610                                   MR-DATE   (PS-SUB)                     
116620                                   MR-TIME   (PS-SUB)                     
116630                                   MR-VALUE  (PS-SUB)                     
116700     ELSE                                                            CL**1
116800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL              CL**1
116900             MOVE ASC-DATA      (ASC-BLK-SUB ASC-ITEM-SUB)                
117000                                TO MR-DATA (PS-SUB)                       
117001             MOVE ASC-USERID    (ASC-BLK-SUB ASC-ITEM-SUB)                
117002                                TO MR-USERID (PS-SUB)                     
117010             MOVE ASC-DATE      (ASC-BLK-SUB ASC-ITEM-SUB)                
117020                                TO MR-DATE (PS-SUB)                       
117030             MOVE ASC-TIME      (ASC-BLK-SUB ASC-ITEM-SUB)                
117040                                TO MR-TIME (PS-SUB)                       
117050             MOVE ASC-VALUE     (ASC-BLK-SUB ASC-ITEM-SUB)                
117060                                TO MR-VALUE (PS-SUB)                      
117100         END-IF                                                      CL**1
117200     END-IF.                                                         CL**1
117300     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL*25
117400     IF  ASC-ITEM-SUB < + 1                                          CL**1
117500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                     CL**1
117600         MOVE +1                 TO ASC-BLK-SUB                      CL**1
117700     END-IF.                                                         CL**1
117800                                                                     CL**8
117900*----------------------------------------------------------------*   CL**1
118000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *   CL**1
118100*----------------------------------------------------------------*   CL**1
118200                                                                     CL**1
118300 5100-WRITE-TEMP-STORAGE.                                            CL**1
118400                                                                     CL**8
118500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                        CL**1
118600                               TO  PV-LIST-ITEM-NUMBER.              CL**1
118700     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                              CL*23
118800         ASC-HIGHEST-BLOCK-WRITTEN + 1.                              CL*51
118900                                                                     CL*51
119000     EXEC CICS                                                       CL*51
119100         WRITEQ TS                                                   CL*51
119200             QUEUE (ASC-DTL-QUEUE-NAME)                              CL*51
119300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL*51
119400             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                        CL*51
119500             RESP  (PV-CICS-RESP)                                    CL*51
119600     END-EXEC.                                                       CL*51
119700                                                                     CL*51
119800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                         CL*51
119900         SET DP013-CICS-ABEND                                        CL*51
120000                       TO  TRUE                                      CL*51
120100         SET DP013-NO-ROLLBACK                                       CL*51
120200                       TO  TRUE                                      CL*51
120300         MOVE '5100-WRITE-TEMP-STORAGE'                              CL*51
120400                       TO  DP013-PARAGRAPH                           CL*51
120500         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'          CL*51
120600                       TO  DP013-MESSAGE-TEXT(1)                     CL*51
120700         PERFORM DP013-0000-PROCESS-ABEND                            CL*51
120800     END-IF.                                                         CL*51
120900     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.                CL*51
121000                                                                     CL**1
121100 EJECT                                                               CL**1
126000*----------------------------------------------------------------*   CL**1
126100*    ABEND PROCESSOR MODULE                                      *   CL**1
126200*----------------------------------------------------------------*   CL**1
126300                                                                     CL**1
126400     COPY DPPD013.                                                   CL**1
