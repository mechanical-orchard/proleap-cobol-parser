000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400*  SET TIMESTAMP RANGE FOR TUPLDER MONITOR                        00040000
000500***************************************************************** 00050000
000600*                                                                 00060000
000700 PROGRAM-ID.    PCKUT081.                                         00070000
000800 AUTHOR.        DENISE HAHN.                                      00080000
000900 INSTALLATION.  KOHLS.                                            00090000
001000 DATE-WRITTEN   AUGUST 2007.                                      00100000
001100 DATE-COMPILED.                                                   00110000
001200                                                                  00120000
001300***************************************************************** 00130000
001400*    THIS PROGRAM WILL SET THE TIMESTAMP RANGE FOR THE TUPLDER  * 00140000
001500*    MONITOR:                                                   * 00150000
001600*     FROM TIMESTAMP IS FROM THE PREVIOUS TIMESTAMP RANGE       * 00160000
001700*     TO   TIMESTAMP IS THE CURRENT TIMESTAMP                   * 00170000
001800*                                                               * 00180000
001900***************************************************************** 00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200                                                                  00220000
002300 FILE-CONTROL.                                                    00230000
002400                                                                  00240000
002500     SELECT LAST-RUN-FILE                                         00250000
002600         ASSIGN TO INP01.                                         00260000
002700                                                                  00270000
002800     SELECT TIMESTAMP-FILE                                        00280000
002900         ASSIGN TO OUT01.                                         00290000
003000                                                                  00300000
003100     SELECT THIS-RUN-FILE                                         00310000
003200         ASSIGN TO OUT02.                                         00320000
003300                                                                  00330000
003400***************************************************************** 00340000
003500 DATA DIVISION.                                                   00350000
003600***************************************************************** 00360000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  LAST-RUN-FILE                                                00390000
004000     RECORDING MODE IS F                                          00400000
004100     BLOCK CONTAINS 0 RECORDS                                     00410000
004200     LABEL RECORDS ARE STANDARD.                                  00420000
004300                                                                  00430000
004400 01  LAST-RUN-DATE-REC            PIC X(80).                      00440000
004500                                                                  00450000
004600 FD  TIMESTAMP-FILE                                               00460000
004700     RECORDING MODE IS F                                          00470000
004800     BLOCK CONTAINS 0 RECORDS                                     00480000
004900     LABEL RECORDS ARE STANDARD.                                  00490000
005000                                                                  00500000
005100 01  TIMESTAMP-RECORD             PIC X(80).                      00510000
005200                                                                  00520000
005300 FD  THIS-RUN-FILE                                                00530000
005400     RECORDING MODE IS F                                          00540000
005500     BLOCK CONTAINS 0 RECORDS                                     00550000
005600     LABEL RECORDS ARE STANDARD.                                  00560000
005700                                                                  00570000
005800 01  THIS-RUN-DATE-REC            PIC X(80).                      00580000
005900                                                                  00590000
006000                                                                  00600000
006100***************************************************************** 00610000
006200 WORKING-STORAGE SECTION.                                         00620000
006300                                                                  00630000
006400 01  PC-PROGRAM-CONSTANTS.                                        00640000
006500     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PCKUT081'.00650000
006600                                                                  00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-THIS-TIMESTAMP            PIC X(26) VALUE SPACES.     00680000
006900     05  PV-LAST-TIMESTAMP            PIC X(26) VALUE SPACES.     00690000
007000     05  PV-SQL-RETURN-CD             PIC -9(04).                 00700000
007100     05  PV-DISPLAY-ERR               PIC -9(04).                 00710000
007200     05  PV-PREV-UPLD-TRN-CDE         PIC X(01).                  00720000
007300     05  PV-CURR-UPLD-TRN-CDE         PIC X(01).                  00730000
007400                                                                  00740000
007500 01  PV-ABEND-FIELDS.                                             00750000
007600     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00760000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770000
007800     05  PV-DB2-MESSAGE               PIC  X(50) VALUE SPACES.    00780000
007900     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00790000
008000                                                 VALUE +0.        00800000
008100                                                                  00810000
008200 01  TIMESTAMP-REC-OUT.                                           00820000
008300     05  FILLER                       PIC X(1)    VALUE SPACES.   00830000
008400     05  TR-FROM-TIMESTAMP            PIC X(26)   VALUE SPACES.   00840000
008500     05  FILLER                       PIC X(1)    VALUE SPACES.   00850000
008600     05  TR-TO-TIMESTAMP              PIC X(26)   VALUE SPACES.   00860000
008700     05  FILLER                       PIC X(26)   VALUE SPACES.   00870000
008800                                                                  00880000
008900                                                                  00890000
009000*** COMMUNICATION AREA FOR DB2                                    00900000
009100     EXEC SQL                                                     00910000
009200          INCLUDE SQLCA                                           00920000
009300     END-EXEC.                                                    00930000
009400                                                                  00940000
009500     COPY DPWS004.                                                00950000
009600                                                                  00960000
009700                                                                  00970000
009800***************************************************************** 00980000
009900 PROCEDURE DIVISION.                                              00990000
010000***************************************************************** 01000000
010100                                                                  01010000
010200     OPEN INPUT  LAST-RUN-FILE                                    01020000
010300          OUTPUT TIMESTAMP-FILE                                   01030000
010400          OUTPUT THIS-RUN-FILE.                                   01040000
010500                                                                  01050000
010600     PERFORM 1000-GET-CURRENT-TMST.                               01060000
010700     PERFORM 1010-READ-LAST-RUN-DATE.                             01070000
010800                                                                  01080000
010900     PERFORM 3000-WRITE-THIS-RUN-DATE.                            01090000
011000     PERFORM 3020-WRITE-TIMESTAMP.                                01100000
011100                                                                  01110000
011200     CLOSE LAST-RUN-FILE                                          01120000
011300           TIMESTAMP-FILE                                         01130000
011400           THIS-RUN-FILE.                                         01140000
011500                                                                  01150000
011600     GOBACK.                                                      01160000
011700                                                                  01170000
011800***************************************************************** 01180000
011900*  GET THE CURRENT TIMESTAMP                                      01190000
012000***************************************************************** 01200000
012100 1000-GET-CURRENT-TMST.                                           01210000
012200                                                                  01220000
012300     EXEC SQL                                                     01230000
012400         SET :PV-THIS-TIMESTAMP = CURRENT TIMESTAMP               01240000
012500     END-EXEC.                                                    01250000
012600                                                                  01260000
012700                                                                  01270000
012800***************************************************************** 01280000
012900*  READ THE DATASET WITH THE LAST RUN DATE IN IT                  01290000
013000***************************************************************** 01300000
013100 1010-READ-LAST-RUN-DATE.                                         01310000
013200                                                                  01320000
013300     READ LAST-RUN-FILE                                           01330000
013400            AT END                                                01340000
013500               MOVE 'MISSING LAST RUN DATE DATASET'               01350000
013600                                TO PV-DB2-MESSAGE                 01360000
013700               MOVE '1010-READ-LAST-RUN-DATE'                     01370000
013800                                TO PV-ABEND-PARAGRAPH             01380000
013900               MOVE 'INP01'     TO PV-ABEND-TABLE                 01390000
014000               PERFORM 9100-SQL-ABEND                             01400000
014100     END-READ.                                                    01410000
014200                                                                  01420000
014300     MOVE LAST-RUN-DATE-REC(1:26)  TO PV-LAST-TIMESTAMP.          01430000
014400                                                                  01440000
014500                                                                  01450000
014600***************************************************************** 01460000
014700*  WRITE OUT THE DATASET WITH THE CURRENT RUN DATE, FOR NEXT RUN  01470000
014800***************************************************************** 01480000
014900 3000-WRITE-THIS-RUN-DATE.                                        01490000
015000                                                                  01500000
015100     MOVE PV-THIS-TIMESTAMP     TO THIS-RUN-DATE-REC.             01510000
015200     WRITE THIS-RUN-DATE-REC.                                     01520000
015300                                                                  01530000
015400                                                                  01540000
015500******************************************************************01550000
015600*  CREATE TIMESTAMP RANGE FILE TO BE USED WHEN CHECKING           01560000
015700*  TUPLDER IN ADDITIONAL STEPS IN THE JOB                         01570000
015800******************************************************************01580000
015900 3020-WRITE-TIMESTAMP.                                            01590000
016000                                                                  01600000
016100                                                                  01610000
016210     MOVE PV-LAST-TIMESTAMP     TO TR-FROM-TIMESTAMP.             01621002
016300     MOVE PV-THIS-TIMESTAMP     TO TR-TO-TIMESTAMP.               01630002
016400                                                                  01640000
016500     WRITE TIMESTAMP-RECORD                                       01650001
016510      FROM TIMESTAMP-REC-OUT.                                     01651001
016600                                                                  01660000
016700     DISPLAY 'DATE RANGE: ' TIMESTAMP-REC-OUT.                    01670000
016800                                                                  01680000
016900                                                                  01690000
017000 9100-SQL-ABEND.                                                  01700000
017100******************************************************************01710000
017200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    01720000
017300*  ERROR OR WARNING CODE OCCURS.                                  01730000
017400******************************************************************01740000
017500     DISPLAY '9100-SQL-ABEND'.                                    01750000
017600     DISPLAY '** ABEND     **'.                                   01760000
017700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                01770000
017800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             01780000
017900     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 01790000
018000     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 01800000
018100     COPY DPPD004.                                                01810000
018200                                                                  01820000
018300     MOVE +4013                  TO PV-ABEND-CODE.                01830000
018400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01840000
018500                                                                  01850000
