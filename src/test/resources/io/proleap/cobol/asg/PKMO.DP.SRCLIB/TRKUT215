000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.    TRKUT215.                                                 
000600 AUTHOR.        TKMABCZ.                                                  
000700 INSTALLATION.  KOHLS.                                                    
000800 DATE-WRITTEN   JUNE 2015.                                                
000900 DATE-COMPILED.                                                           
001000                                                                          
      ***********************************************                           
001200* this program takes custom proprietary file as an input                  
001300* and then separates the pre-entry id records from rest of the            
001310* custom entry records.                                                   
      * two output files are generated -  1) pre-entry custom records           
      *                                   2) custom entry id records            
001340******************************************************************        
001350 ENVIRONMENT DIVISION.                                                    
001360******************************************************************        
001370 CONFIGURATION SECTION.                                                   
001380 SOURCE-COMPUTER.        IBM-3090.                                        
001390 OBJECT-COMPUTER.        IBM-3090.                                        
001400                                                                          
001500 INPUT-OUTPUT SECTION.                                                    
001600 FILE-CONTROL.                                                            
001700                                                                          
001800     SELECT TR017-CUSTOM-INPUT-FILE                                       
001900         ASSIGN TO INP01.                                                 
002000                                                                          
002100     SELECT TR017-CUSTOM-OUTPUT-FILE                                      
002200         ASSIGN TO OUT01.                                                 
                                                                                
002100     SELECT TR017-pre-entry-file                                          
002200         ASSIGN TO OUT02.                                                 
002300                                                                          
002700******************************************************************        
002800 DATA DIVISION.                                                           
002900******************************************************************        
003000                                                                          
003100 FILE SECTION.                                                            
003200                                                                          
003300 FD  TR017-CUSTOM-INPUT-FILE                                              
003400     RECORDING MODE IS F                                                  
003500     LABEL RECORDS ARE STANDARD                                           
003600     RECORD CONTAINS 300                                                  
003700     BLOCK CONTAINS 0 RECORDS                                             
003800     DATA RECORD IS INPUT-RECORD.                                         
003900                                                                          
004000 01  TR017-CUSTOM-RECORD          PIC  X(300).                            
004100                                                                          
004200 FD  TR017-CUSTOM-OUTPUT-FILE                                             
004300     RECORDING MODE IS F                                                  
004400     LABEL RECORDS ARE STANDARD                                           
004500     RECORD CONTAINS 300                                                  
004510     BLOCK CONTAINS 0 RECORDS                                             
004520     DATA RECORD IS OUTPUT-RECORD.                                        
004530                                                                          
004531 01  TR017-CUSTOM-OUT-RECORD   PIC  X(300).                               
004532                                                                          
004200 FD  TR017-PRE-ENTRY-FILE                                                 
004300     RECORDING MODE IS F                                                  
004400     LABEL RECORDS ARE STANDARD                                           
004500     RECORD CONTAINS 300                                                  
004510     BLOCK CONTAINS 0 RECORDS                                             
004520     DATA RECORD IS OUTPUT-RECORD1.                                       
004530                                                                          
004531 01  TR017-PRE-ENTRY-RECORD   PIC  X(300).                                
004532                                                                          
004560******************************************************************        
004570 WORKING-STORAGE SECTION.                                                 
004580******************************************************************        
004590 01  PS-PROGRAM-SWITCHES.                                                 
004600     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.               
004700         88  PS-EOF-INPUT                        VALUE 'Y'.               
004800         88  PS-NOT-EOF-INPUT                    VALUE 'N'.               
004900*    05  PS-FIRST-RECORD-SW           PIC X(01)  VALUE 'Y'.               
005000*        88  PS-FIRST-RECORD                     VALUE 'Y'.               
005100*        88  PS-FIRST-RECORD-NO                  VALUE 'N'.               
005401                                                                          
005402 01  PC-PROGRAM-CONSTANTS.                                                
005403     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'trkut215'.         
005404     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.               
005419                                                                          
005420 01  PV-PROGRAM-VARIABLES.                                                
005421     05  PV-RECORDS-READ              PIC 9(09)  VALUE ZERO.              
005422     05  PV-PRE-ENTRY-REC             PIC 9(09)  VALUE ZERO.              
005424     05  PV-CUSTOM-ENTRY-NUM          PIC 9(09)  VALUE ZERO.              
005423     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.            
005804                                                                          
005805 01  PV-ABEND-FIELDS.                                                     
005806     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0                 
005807                                                 COMP SYNC.               
005809     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.            
005810     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.            
005811     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.            
005812     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.            
005843                                                                          
005844******************************************************************        
005845*  CUSTOM PROPRIETARY FILE LAYOUT                                         
005846******************************************************************        
005847     COPY TRRD017.                                                        
005843                                                                          
005844******************************************************************        
005845*  DB2 FORMATTED MESSAGE AREA                                             
005846******************************************************************        
005847     COPY DPWS004.                                                        
005848*                                                                         
008520******************************************************************        
008530 PROCEDURE DIVISION.                                                      
008540******************************************************************        
008550 0000-PROGRAM-MAINLINE.                                                   
008560                                                                          
008570     OPEN INPUT  TR017-CUSTOM-INPUT-FILE                                  
008580          OUTPUT TR017-CUSTOM-OUTPUT-FILE                                 
                       TR017-PRE-ENTRY-FILE.                                    
008600                                                                          
008900     PERFORM 7000-READ-INPUT-FILE.                                        
009000                                                                          
009100     PERFORM 2000-PROCESS-INPUT-FILE                                      
009200         UNTIL PS-EOF-INPUT.                                              
009300                                                                          
009400     PERFORM 9000-EOJ.                                                    
009500                                                                          
009600     STOP RUN.                                                            
009700                                                                          
011400******************************************************************        
011500* PROCESS INPUT RECORDS -  CHECK INPUT RECORDS FOR PRE ENTRY  *           
011600******************************************************************        
011700 2000-PROCESS-INPUT-FILE.                                                 
011800     MOVE '2000-PROCESS-INPUT-FILE.'   TO PV-ABEND-PARAGRAPH.             
011900                                                                          
           IF TR017-ENF-CSTM-ENTR-ID(12:1) = 'P'                                
               PERFORM 8000-WRITE-PRE-ENTRY-RECORD                              
           ELSE                                                                 
               PERFORM 9000-WRITE-OUTPUT-RECORD                                 
           END-IF.                                                              
016500                                                                          
016600     PERFORM 7000-READ-INPUT-FILE.                                        
016700                                                                          
009800******************************************************************        
009900* READS RECORD FROM THE INPUT FILE                                        
010000******************************************************************        
010100 7000-READ-INPUT-FILE.                                                    
010200     MOVE '7000-READ-INPUT-FILE.'      TO  PV-ABEND-PARAGRAPH.            
010300                                                                          
010400     READ TR017-CUSTOM-INPUT-FILE                                         
010500          INTO TR017-REC-TYP-ENF                                          
010600            AT END                                                        
010700               SET PS-EOF-INPUT     TO TRUE                               
010800                                                                          
010900            NOT AT END                                                    
011000               SET PS-NOT-EOF-INPUT TO TRUE                               
011100               ADD +1 TO PV-RECORDS-READ                                  
011200     END-READ.                                                            
011300                                                                          
050903******************************************************************        
050904* WRITES THE PRE ENTRY RECORDS OUTPUT RECORDS                    *        
050905******************************************************************        
050906 8000-WRITE-PRE-ENTRY-RECORD.                                             
050908     MOVE '8000-WRITE-PRE-ENTRY-RECORD.' TO PV-ABEND-PARAGRAPH.           
050910                                                                          
050912     WRITE TR017-PRE-ENTRY-RECORD FROM TR017-REC-TYP-ENF.                 
050918                                                                          
050919     ADD  1  TO  PV-PRE-ENTRY-REC.                                        
050920                                                                          
050903******************************************************************        
050904* WRITES THE CUSTOM ENTRY RECORDS OUTPUT RECORDS                 *        
050905******************************************************************        
050906 9000-WRITE-OUTPUT-RECORD.                                                
                                                                                
050908     MOVE '9000-WRITE-OUTPUT-RECORD.' TO PV-ABEND-PARAGRAPH.              
050910                                                                          
050912     WRITE TR017-CUSTOM-OUT-RECORD  FROM TR017-REC-TYP-ENF.               
050918                                                                          
050919     ADD  1  TO  PV-CUSTOM-ENTRY-NUM.                                     
050920                                                                          
050905******************************************************************        
050921 9000-EOJ.                                                                
050923                                                                          
050924     CLOSE TR017-CUSTOM-INPUT-FILE                                        
050925           TR017-CUSTOM-OUTPUT-FILE                                       
                 TR017-PRE-ENTRY-FILE.                                          
                                                                                
050928     DISPLAY ' RECORDS READ    = ' PV-RECORDS-READ                        
0r0929     DISPLAY ' PRE ENTRY RECORDS = ' PV-PRE-ENTRY-REC.                    
0r0929     DISPLAY ' custom entry rcdS = ' PV-CUSTOM-ENTRY-NUM.                 
                                                                                
      *    IF PV-PRE-ENTRY-REC = ZERO                                           
      *        MOVE 1 TO RETURN-CODE.                                           
050930                                                                          
050931******************************************************************        
050932* ABEND PROCEDURE                                                *        
050933******************************************************************        
050934*9999-SQL-ABEND.                                                          
050936*    DISPLAY '** PROGRAM ABEND   ** = ' PC-PROGRAM-NAME.                  
050937*    DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.               
050944*    CALL 'ILBOABN0'   USING PV-ABEND-CODE.                               
050945                                                                          
