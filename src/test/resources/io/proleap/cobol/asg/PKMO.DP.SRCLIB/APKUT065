000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT065.                                        00020000
000300 AUTHOR.         MIKE BESKE.                                      00030000
000400 DATE-WRITTEN.   OCTOBER 1997.                                    00040000
000500 DATE-COMPILED.                                                   00050000
000600****************************************************************  00060000
000700* COBOL 2 WITH SQL                                             *  00070000
000710*--------------------------------------------------------------*  00071000
000720*   CREATE ADJUSTMENT JOURNAL ENTRIES FOR IMPORT ACTUAL COSTS  *  00072000
000730*--------------------------------------------------------------*  00073000
000740* THIS PROGRAM GENERATES ADJUSTMENT JOURNAL ENTRIES NEEDED TO  *  00074000
000750* CHARGE THE BUYER DEPARTMENTS FOR THE ACTUAL LANDED COST      *  00075000
000760* COMPONENTS THAT WERE PREPAID FOR IMPORTS POS.  IT WILL ALSO  *  00076000
000770* AUTOMATICALLY POST THE INTERNAL LOADS AND RELIEVE THE        *  00077000
000780* CLEARING ACCOUNT OF THE PREPAID FIRST COST.                  *  00078000
000790*--------------------------------------------------------------*  00079000
000800* INPUT:                                                       *  00080000
000900*  1. INVOICE ACTUAL COSTS             (APRD062)               *  00090000
001000*  2. RECEIVING TOTAL COSTS            (APRD033)               *  00100000
001100*  3. RELEASED PO/STORES               (TPOSTRR)               *  00110000
001200*  4. AP CONTROL TABLE                 (TAPCNTL)               *  00120000
001300*                                                              *  00130000
001400* OUTPUT:                                                      *  00140000
001500*  1. ADJUSTMENT TRANSACTION           (APRD045)               *  00150000
001600*--------------------------------------------------------------*  00160000
001700* CHANGE LOG:                                                   * 00170000
001800* 11/17/97   INITIAL VERSION.   WR4164                          * 00180000
001900*                                                               * 00190000
002000* 12/10/97 - ADDED LOGIC TO MOVE THE CLASS NUMBER FROM THE AP033* 00200000
002100*            TO THE TR-CLASSNO WHEN CREATING TRANSACTIONS FOR   * 00210000
002200*            TRANCODES '37' AND '40'.                           * 00220000
002300*        BY: NANCY EILBES                           WR 4164     * 00230000
002400*                                                               * 00240000
002500* 01/16/98 - CHANGED THE MOVE STATEMENT IN PARAGRAPH C400 TO    * 00250000
002600*            MOVE AP062-INV-NET-COST-AMT TO TR-INVAMT INSTEAD OF* 00260000
002700*            AP062-INV-1ST-COST-AMT.  THIS NEW FIELD CONTAINS   * 00270000
002800*            THE TRUE NET COST.                                 * 00280000
002900*        BY: MARK BURNSIDE                          WR 4164     * 00290000
003000*                                                               * 00300000
003100* 03/16/98 - CHANGED THE WAY THE DOCNO IS FORMATTED.  INSTEAD OF* 00310000
003200*            USING 'P' AND ALL 9 DIGITS OF THE PO NUMBER, THE   * 00320000
003300*            DOCNO WILL BE 'P' AND THE LAST 7 DIGITS OF THE PO  * 00330000
003400*            NUMBER.  THIS MATCHS THE WAY THE DOCNO IS FORMATTED* 00340000
003500*            IN CLASS DISTRIBUTION (APKUP254).                  * 00350000
003600*        BY: MIKE BESKE                             WR 4164     * 00360000
003700*                                                               * 00370000
003800* 04/07/98 - ADDED CODE THAT WILL MOVE THE PO NUMBER TO THE     * 00380000
003900*            TR-PONUMB. THIS CODE WAS INADVERTENTLY DELETED     * 00390000
004000*            WHEN THE LAST MODIFICATION TOOK PLACE.             * 00400000
004100*        BY: MIKE BESKE                             PITS 176525 * 00410000
004200*                                                               * 00420000
004300* 04/16/98 - MODIFIED THE CODE TO MAKE THE LANDED COST LOAD     * 00430000
004400*            1.5% RATHER THAN 1.0%.                             * 00440000
004500*        BY: ROBIN BERNOSKI                         WR          * 00450000
004600*                                                               * 00460000
004700* 04/16/98 - MODIFIED THE PO_CSR WITH AN ADDITIONAL WHERE       * 00470000
004800*            CONDITION: STR_NBR = 0.  THIS WILL RESOLVE THE     * 00480000
004900*            PROBLEM OF THE CURSOR SELECTING POS THAT ARE BULK  * 00490000
005000*            BUT THE RECEIVING SYSTEM TREATED THE PO AS A BY-   * 00500000
005100*            STORE PO.  THIS WAS CAUSING PROBLEMS WHEN IMPORT   * 00510000
005200*            WRITE OFFS WERE PROCESSED.  THE CURSOR WAS FINDING * 00520000
005300*            MULTIPLE ROWS ON TPOSTRR BECAUSE OF THE PROBLEM    * 00530000
005400*            CAUSED BY THE RECEIVER SYSTEM.                     * 00540000
005500*        BY: MIKE BESKE                             PITS 211220 * 00550000
005600*                                                               * 00560000
005700*   08/26/98                                                    * 00570000
005800*        CHANGE LRECL FOR APRD033 FROM 135 TO 150.              * 00580000
005900*   MADE BY:  CHRIS KUNSTMANN                  PITS/WR#:4164    * 00590000
006000*                                                               * 00600000
006100*   11/12/98                                                    * 00610000
006200*        CHANGED THE OUTPUT COPYBOOK FROM APTRAN TO APRD045,    * 00620000
006300*        REMOVED ALL JULIAN DATE PROCESSING AND ADDED THE       * 00630000
006400*        TTRANCDE TABLE TO ACCESS/VERIFY INFORMATION REGARDING  * 00640000
006500*        THE TRANSACTIONS BEING GENERATED.  THESE CHANGES WERE  * 00650000
006600*        MADE SO AS THE PROCESSING INTERFACES WITH THE          * 00660000
006700*        PEOPLESOFT SOFTWARE.                                   * 00670000
006800*   MADE BY:  ROBIN BERNOSKI                   PITS/WR#:4164    * 00680000
006900*                                                               * 00690000
007000* 04/09/99 - CHANGED LOGIC IN C200-FORMAT-LIFUNG-TRANS PARA.    * 00700000
007100*            REMOVED HARD-CODED PERCENTAGES AND USE THE         * 00710000
007200*            AP062-1ST-COST-LOAD-PCT AND AP033-LCL-LOAD-PCT     * 00720000
007300*            FIELDS TO CALCULATE THE TR-INVAMT. IF THE LCL      * 00730000
007400*            AMOUNT IS ZERO, DON'T WRITE THE RECORDS.           * 00740000
007500*        BY: CHRIS KUNSTMANN                        WR#:4164    * 00750000
007600*                                                               * 00760000
007700*  08/25/2000                                                   * 00770000
007800*      ADDED LOGIC TO PROCESS THE NEW MOS FIELDS. THE NEW       * 00780000
007900*      FIELD IS HANDLED THE SAME WAY THE NEW STORE DISCOUNT     * 00790000
008000*      IS HANDLED.                                              * 00800000
008100*  MADE BY: JILL JUEL                        WR# 20224          * 00810000
008200*                                                               * 00820000
008300* 07/24/2001                                                    * 00830000
008400*     INCREASED RECORD SIZE OF OUTPUT RECORD FROM 400 TO 500.   * 00840000
008500*     THIS WAS CHANGED BECAUSE COPYBOOK APRD045 WAS INCREASED   * 00850000
008600*     TO 500.  ALSO, CHANGED NAME OF OUTPUT FILE FROM 'PURCHASE * 00860000
008700*     JOURNAL' TO 'ADJUSTMENT JOURNAL' AND THE OUTPUT'S FILE    * 00870000
008800*     NAME FROM AP045-TRANS TO IMPORT-ADJ.                      * 00880000
008900* MADE BY: ALEXIS KEIKER                     WR#: 22467         * 00890000
009000*                                                               * 00900000
009100* 05/16/2002                                                    * 00910000
009200*     CHANGE MADE:  NI-SKU CHANGES.  THE 3 BYTE SKU-SEQ FIELD   * 00920000
009300*     IS REPLACED WITH A NUMERIC 8 BYTE SKU FIELD.  CHANGES     * 00930000
009400*     MADE TO PARAGRAPH C200.  INITIALIZED AP045-GL-ACCT-NBR    * 00940000
009500*     FOR MERCHANDISE TRAN CODES '40' AND '37'.                 * 00950000
009600* MADE BY:  KEVIN CATLIN                     WR#: 21278         * 00960000
009700*                                                               * 00970000
009800*     INCORPORATED WITH ABOVE CHANGES: REMOVED TPURCHS AND      * 00980000
009900*     TENTNME TABLES FROM S200 AND PROGRAM.  THEY WERE BEING    * 00990000
010000*     USED WITH TEXTENT TO RETRIEVE ENT-ID AND WEREN'T NEEDED.  * 01000000
010100* MADE BY:  NANCY EILBES                     WR#: 21278         * 01010000
010200*                                                               * 01020000
010300* 08/08/2002                                                    * 01030000
010400*     LIFUNG HANGER EXPENSE PROCESSING. CORRECTED CODE THAT     * 01040000
010500*     CREATES DOC-NBR WITH A SUFFIX.  THE STRING PROCEDURE      * 01050000
010600*     SHOULD BE DONE AFTER THE VALUE IS MOVED TO THE SUFFIX AND * 01060000
010700*     BEFORE THE TRANSACTION RECORD IS WRITTEN.  REMOVED THIS   * 01070000
010800*     FROM PARAGRAPH P100 AND PLACED THIS BEFORE THE WRITES.    * 01080000
010900* MADE BY:  KEVIN CATLIN                     WR#: 23254         * 01090000
011000*                                                               * 01100000
011100*   DATE  09/17/2003                                            * 01110000
011200*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 01120000
011300*       CHANGE TO COPYBOOK APRD045.                             * 01130000
011400*       MADE BY: MIKE BESKE              WR/IR #: WR21316       * 01140000
011500*                                                               * 01150000
011600*   DATE  04/22/2004                                            * 01160000
011700*       CHANGE MADE: CHANGED MANY HARD CODED STORE NUMBER VALUES* 01170000
011800*       FROM ALPHA TO NUMERIC VALUES THAT ARE BEING MOVED TO    * 01180000
011900*       AP045-STR-NBR.                                          * 01190000
012000*       MADE BY: MIKE BESKE              WR/IR #: WR25805       * 01200000
012100*                                                               * 01210000
012200*   DATE  03/11/2007                                            * 01220000
012300*       CHANGE MADE: MATCH BY DC -- REPLACED THE STR_NBR = 0 IN * 01230000
012400*       THE WHERE CLAUSE OF THE PO_CSR CURSOR WITH              * 01240000
012500*       MTCH_LVL_CDE = 'P'.                                     * 01250000
012600*       MADE BY: KRYSTEN LEARY           WR/IR #: WR21578       * 01260000
012700*                                                               * 01270000
012800*   DATE  02/04/2008                                            * 01280000
012900*       CHANGE MADE: PROCESS LOAD TRANSACTIONS FOR PRIVATE LBL  * 01290000
013000*       PURCHASE ORDERS WHEN BEING JOURNALIZED. IN C100,        * 01300000
013010*       MODIFIED TO PROCESS LOAD-TYP-CDE. IN C200, REMOVED      * 01301000
013020*       OBSOLETE CODE RELATING TO LANDED COST LOAD. CREATED NEW * 01302000
013030*       PARAGRAPH C500 FROM C200 TO PROCESS TWO TRANSACTIONS.   * 01303000
013040*       1ST TRANS CREATES THE LOAD ACCOUNT IN GL. THE 2ND TRANS * 01304000
013050*       CHARGES THE MERCHANDISE LEDGER FOR ACTUAL LOAD AMOUNT.  * 01305000
013060*       MADE BY: IRMA NAVA               WR/IR #: WR32664       * 01306000
013070*                                                               * 01307000
013080*   DATE  08/31/2010                                            * 01308000
013090*       CHANGE MADE: BREAKDOWN AP TRAN CODES TO LOCATION LEVEL. * 01309000
013100*       ADDED LOGIC TO WRITE COSTS TO APRD058 FORMAT FILE       * 01310000
013101*       WHICH WILL BE USED TO GENERATE TRAN CODES 37, 40, AND   * 01310100
013102*       4A.  THE ACTUAL GENERATION OF TRAN CODES IS THEN DONE   * 01310200
013103*       IN APKUP254.                                            * 01310300
013104*       COPYBOOK APRD058 WAS ADDED TO HOLD THE COST DATA FOR    * 01310400
013105*       ACTUAL LOADED COST, PRIVATE LABEL LOAD, AND FIRST COST  * 01310500
013106*       LOAD.  CODE TO GENERATE THE TRAN CODES 37, 40, AND 4A   * 01310600
013107*       WAS REMOVED FROM THE FOLLOWING PARGRAPHS;               * 01310700
013108*       C200-, C300-, AND C500.  ALSO ADDED CODE TO B100- TO    * 01310800
013109*       HANDLE INITIALIZATION OF NEW RECORD, APRD058 AS WELL    * 01310900
013110*       AS OPEN OUTPUT FILE, AND NEW PARAPGRAPH W200- WAS ADDED * 01311000
013111*       TO WRITE NEW OUTPUT RECORD.                             * 01311100
013112*       MADE BY: ROLF NOHE               WR/IR #: WR38002       * 01311200
013113*                                                               * 01311302
013114* DATE  11/04/2014                                              * 01311402
013115*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                   * 01311502
013116*     EXTENDED PO# FROM 7 TO 9.                                 * 01311602
013117*     MADE BY: COGNIZANT               WR/IR #: CHG0094517      * 01311702
013118*                                                               * 01311807
013119* DATE  11/21/2019                                              * 01311907
013120*     CHANGE MADE: ADDED LOGIC IN C100-PROCESS-RCVR-FILE TO     * 01312007
013121*     CHECK IF THE TOTAL 1ST COST AMOUNT EXCEEDS THE LIMIT OF   * 01312107
013122*     THE SIZE OF THE DISTRIB LINE AMOUNT.  WHEN IT DOES, THE   * 01312207
013123*     THE AMOUNT IS ALLOCATED ACROSS MULTIPLE ADJUSTMENTS SO    * 01312307
013124*     THE ENTIRE AMOUNT WILL BE REPRESENTED INSTEAD OF BEING    * 01312407
013125*     TRUNCATED. A SUFFIX WILL BE ADDED TO THE DOC NUMBER FOR   * 01312507
013126*     UNIQUENESS.                                               * 01312607
013127*     MADE BY: NANCY EILBES            WR/IR #: CHG0236101      * 01312707
013128*                                                               * 01312809
013129* DATE  03/07/2024                                              * 01312909
013130*     CHANGE MADE: PEPSI INVOICING. INCREASED RECORD LENGTH FOR * 01313009
013131*     THE APRD058 FILE.                                         * 01313109
013132*     MADE BY: NANCY EILBES            WR/IR #: CHG0301938      * 01313209
013133*---------------------------------------------------------------* 01313300
013134                                                                  01313400
013135 ENVIRONMENT DIVISION.                                            01313500
013136 CONFIGURATION SECTION.                                           01313600
013137 SOURCE-COMPUTER.    IBM-3090.                                    01313700
013138 OBJECT-COMPUTER.    IBM-3090.                                    01313800
013139                                                                  01313900
013140 INPUT-OUTPUT SECTION.                                            01314000
013141 FILE-CONTROL.                                                    01314100
013142     SELECT INVC-COSTS-FILE               ASSIGN TO UT-S-INP01.   01314200
013150     SELECT RCVR-COSTS-FILE               ASSIGN TO UT-S-INP02.   01315000
013160     SELECT IMPORT-ADJ-FILE               ASSIGN TO UT-S-OUT01.   01316000
013170     SELECT IMPORT-COST-FILE              ASSIGN TO UT-S-OUT02.   01317000
013180                                                                  01318000
013190 DATA DIVISION.                                                   01319000
013200 FILE SECTION.                                                    01320000
013300                                                                  01330000
013400 FD  INVC-COSTS-FILE                                              01340000
013500     RECORDING MODE IS F                                          01350000
013600     LABEL RECORDS ARE STANDARD                                   01360000
013700     DATA RECORD IS INVC-COSTS-REC.                               01370000
013800 01  INVC-COSTS-REC.                                              01380000
013900     05 FILLER                        PIC  X(150).                01390000
014000                                                                  01400000
014100 FD  RCVR-COSTS-FILE                                              01410000
014200     RECORDING MODE IS F                                          01420000
014300     LABEL RECORDS ARE STANDARD                                   01430000
014400     DATA RECORD IS RCVR-COSTS-REC.                               01440000
014500 01  RCVR-COSTS-REC.                                              01450000
014600     05 FILLER                        PIC  X(150).                01460000
014700                                                                  01470000
014800 FD  IMPORT-ADJ-FILE                                              01480000
014900     RECORDING MODE IS F                                          01490000
015000     LABEL RECORDS ARE STANDARD                                   01500000
015100     BLOCK CONTAINS 0 RECORDS                                     01510000
015200     DATA RECORD IS IMPORT-ADJ-REC.                               01520000
015300 01  IMPORT-ADJ-REC.                                              01530000
015400     05 FILLER                        PIC  X(500).                01540000
015500                                                                  01550000
015600 FD  IMPORT-COST-FILE                                             01560000
015700     RECORDING MODE IS F                                          01570000
015800     LABEL RECORDS ARE STANDARD                                   01580000
015900     BLOCK CONTAINS 0 RECORDS                                     01590000
016000     DATA RECORD IS IMPORT-COST-REC.                              01600000
016100 01  IMPORT-COST-REC.                                             01610000
016200     05 FILLER                        PIC  X(125).                01620008
016300                                                                  01630000
016400 WORKING-STORAGE SECTION.                                         01640000
016500                                                                  01650000
016600 01  PC-PROGRAM-CONSTANTS.                                        01660000
016700     05  FILLER                  PIC  X(30)  VALUE                01670000
016800         '** BEGINING OF APKUT065 W/S **'.                        01680000
016900                                                                  01690000
017000     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT065'.    01700000
017010     05  PC-DISTRIB-LINE-LIMIT   PIC S9(7)V9(2) VALUE 9999999.99  01701004
017020                                               COMP-3.            01702004
017100                                                                  01710000
017200 01  PV-PROGRAM-VARIABLES.                                        01720000
017300     05  PV-HOLD-PO-NBR          PIC S9(09)       VALUE ZEROS     01730000
017400                                             COMP.                01740000
017500     05  PV-CLASSNO              PIC  X(03).                      01750000
017600     05  PV-DOC-SUFFIX           PIC  X(03)       VALUE SPACES.   01760000
017601     05  PV-SUFFIX-COUNT         PIC  9(01)       VALUE ZERO.     01760104
017610     05  PV-SUFFIX-2.                                             01761004
017620         10  PV-SUFFIX-2-SLASH   PIC  X(01)       VALUE '/'.      01762004
017630         10  PV-SUFFIX-2-CNT     PIC  X(01).                      01763004
017700     05  PV-HOLD-TRN-CDE         PIC  X(02)       VALUE SPACES.   01770000
017800     05  PV-TRN-TYP-CDE          PIC  X(03)       VALUE SPACES.   01780000
017900     05  PV-GL-ACCT-NBR          PIC  X(06)       VALUE SPACES.   01790000
018000     05  PV-PSTG-TYP-CDE         PIC  X(02)       VALUE SPACES.   01800000
018100     05  PV-PO-IN-PROCESS-9      PIC 9(09)        VALUE ZEROS.    01810000
018200     05  PV-PO-IN-PROCESS-X REDEFINES PV-PO-IN-PROCESS-9.         01820000
018400         10  PV-PO-X             PIC X(09).                       01840002
018500     05  PV-CLEARING-AMT         PIC S9(09)V9(2)  VALUE ZEROS     01850004
018501                                             COMP-3.              01850105
018510     05  PV-PO-TOT-EST-COST      PIC S9(09)V9(3)  VALUE ZEROS     01851004
018600                                             COMP-3.              01860000
018700     05  PV-ACCT1330-TOT-CM      PIC S9(11)V9(2)  VALUE ZEROS     01870000
018800                                             COMP-3.              01880000
018900     05  PV-ACCT1330-TOT-DM      PIC S9(11)V9(2)  VALUE ZEROS     01890000
019000                                             COMP-3.              01900000
019100     05  PV-DATE-TIME-FIELDS.                                     01910000
019200         10  PV-CURRENT-DATE         PIC  X(10)  VALUE SPACES.    01920000
019300         10  PV-CURR-DB2-DATE.                                    01930000
019400             15  PV-CURR-DB2-CENT    PIC  9(02)  VALUE 19.        01940000
019500             15  PV-CURR-DB2-YEAR    PIC  9(02)  VALUE ZEROS.     01950000
019600             15  FILLER              PIC  X(01)  VALUE '-'.       01960000
019700             15  PV-CURR-DB2-MONTH   PIC  9(02)  VALUE ZEROS.     01970000
019800             15  FILLER              PIC  X(01)  VALUE '-'.       01980000
019900             15  PV-CURR-DB2-DAY     PIC  9(02)  VALUE ZEROS.     01990000
020000         10  PV-ENTRTME.                                          02000000
020100             15  PV-HOURS            PIC  X(02)  VALUE ZEROS.     02010000
020200             15  PV-MINUTES          PIC  X(02)  VALUE ZEROS.     02020000
020300             15  PV-SECONDS          PIC  X(02)  VALUE ZEROS.     02030000
020400         10  PV-TIME-OF-DAY          PIC  X(06)  VALUE SPACES.    02040005
020500         10  FILLER REDEFINES PV-TIME-OF-DAY.                     02050000
020600             15  PV-DAY-HOUR         PIC  X(02).                  02060000
020700             15  PV-DAY-MINUTE       PIC  X(02).                  02070000
020800             15  PV-DAY-SECOND       PIC  X(02).                  02080000
020900         10  PV-TIME.                                             02090000
021000             15  FILLER              PIC  X(01)     VALUE '-'.    02100000
021100             15  PV-TIME-HOUR        PIC  9(02)     VALUE ZEROS.  02110000
021200             15  FILLER              PIC  X(01)     VALUE '.'.    02120000
021300             15  PV-TIME-MINUTE      PIC  9(02)     VALUE ZEROS.  02130000
021400             15  FILLER              PIC  X(01)     VALUE '.'.    02140000
021500             15  PV-TIME-SECOND      PIC  9(02)     VALUE ZEROS.  02150000
021600             15  FILLER              PIC  X(01)     VALUE '.'.    02160000
021700             15  PV-TIME-MIL         PIC  X(06)   VALUE '999999'. 02170000
021800     05  PV-BTCH-NBR.                                             02180000
021900         10  PV-BTCH-DTE             PIC X(10)      VALUE SPACE.  02190000
022000         10  PV-BTCH-SRC-CDE         PIC X(03)      VALUE SPACE.  02200000
022100         10  PV-SEQ-NBR              PIC X(02)      VALUE SPACE.  02210000
022200                                                                  02220000
022300     05  PV-COUNTERS                         COMP-3.              02230000
022400         10  PV-COUNT-POCSR-READ       PIC  9(07).                02240000
022500         10  PV-COUNT-INVC-READ        PIC  9(07).                02250000
022600         10  PV-COUNT-RCVR-READ        PIC  9(07).                02260000
022700         10  PV-COUNT-ENT-WROTE        PIC  9(07).                02270000
022800         10  PV-COUNT-IMCST-WROTE      PIC  9(07).                02280000
022900                                                                  02290000
023000 01  PS-PROGRAM-SWITCHES.                                         02300000
023100     05  PS-END-OF-INVOICES-SW   PIC X(01)        VALUE 'N'.      02310000
023200         88  END-OF-INVOICES                      VALUE 'Y'.      02320000
023300     05  PS-END-OF-PO-CSR-SW     PIC X(01)        VALUE 'N'.      02330000
023400         88  NEW-PO-CSR                           VALUE 'N'.      02340000
023500         88  END-OF-PO-CSR                        VALUE 'Y'.      02350000
023600     05  PS-END-OF-RCVR-FILE-SW   PIC X(01)       VALUE 'N'.      02360000
023700         88  END-OF-RCVR-FILE                     VALUE 'Y'.      02370000
023800     05  PS-END-OF-ELC-VAR-SW    PIC X(01)        VALUE 'N'.      02380000
023900         88  END-OF-ELC-VAR                       VALUE 'Y'.      02390000
024000     05  PS-ELC-COSTS-FOUND-SW   PIC X(01)        VALUE 'N'.      02400000
024100         88  ELC-COSTS-NOT-FOUND                  VALUE 'N'.      02410000
024200         88  ELC-COSTS-FOUND                      VALUE 'Y'.      02420000
024300                                                                  02430000
024400*--------------------------------------------------------------*  02440000
024500*  COMMUNICATIONS AREA2 FOR DB2                                *  02450000
024600*--------------------------------------------------------------*  02460000
024700     COPY SQLCA2.                                                 02470000
024800                                                                  02480000
024900     EXEC SQL                                                     02490000
025000          INCLUDE SQLCA                                           02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300*--------------------------------------------------------------*  02530000
025400*  RELEASED PO/STORES TABLE                                    *  02540000
025500*--------------------------------------------------------------*  02550000
025600     EXEC SQL                                                     02560000
025700          INCLUDE TPOSTRR                                         02570000
025800     END-EXEC.                                                    02580000
025900                                                                  02590000
026000*--------------------------------------------------------------*  02600000
026100*  AP CONTROL TABLE                                            *  02610000
026200*--------------------------------------------------------------*  02620000
026300     EXEC SQL                                                     02630000
026400          INCLUDE TAPCNTL                                         02640000
026500     END-EXEC.                                                    02650000
026600                                                                  02660000
026700*--------------------------------------------------------------*  02670000
026800*  AP TRANCODE TABLE                                           *  02680000
026900*--------------------------------------------------------------*  02690000
027000     EXEC SQL                                                     02700000
027100          INCLUDE TTRNCDE                                         02710000
027200     END-EXEC.                                                    02720000
027300                                                                  02730000
027400*--------------------------------------------------------------*  02740000
027500*     TEXTENT TABLE                                            *  02750000
027600*--------------------------------------------------------------*  02760000
027700     EXEC SQL                                                     02770000
027800          INCLUDE TEXTENT                                         02780000
027900     END-EXEC.                                                    02790000
028000                                                                  02800000
028100                                                                  02810000
028200*----------------------------------------------------------------*02820000
028300* PO_CSR SELECTS ALL BULK POS ON TPOSTRR THAT WERE BATCH MATCHED *02830000
028400* AND PROCESSED DURING THE BATCH PROCESS.  THE ROWS THAT FIT THE *02840000
028500* THIS CRITERIA WILL BE USED TO FIND ANY MATCHES ON THE IMPORT   *02850000
028600* COSTS FILE.                                                    *02860000
028700*----------------------------------------------------------------*02870000
028800     EXEC SQL                                                     02880000
028900       DECLARE PO_CSR CURSOR FOR                                  02890000
029000         SELECT PO_NBR                                            02900000
029100           FROM TPOSTRR                                           02910000
029200          WHERE CRE_PRC_CDE         = 'B'                         02920000
029300            AND STATUS_CDE          = ' '                         02930000
029400            AND MTCH_LVL_CDE        = 'P'                         02940000
029500       ORDER BY PO_NBR                                            02950000
029600     END-EXEC.                                                    02960000
029700                                                                  02970000
029800*--------------------------------------------------------------*  02980000
029900* IMPORT PO RECEIVING TOTAL COSTS RECORD LAYOUT                *  02990000
030000*--------------------------------------------------------------*  03000000
030100     COPY APRD033.                                                03010000
030200                                                                  03020000
030300*--------------------------------------------------------------*  03030000
030400* IMPORT PO - INVOICE ACTUAL AND ESTIMATED COST RECORD LAYOUT  *  03040000
030500*--------------------------------------------------------------*  03050000
030600     COPY APRD062.                                                03060000
030700                                                                  03070000
030800*--------------------------------------------------------------*  03080000
030900* IMPORT PO - TRANSACTION FILE OF ADJUSTMENT JOURNAL ENTRIES.  *  03090000
031000*--------------------------------------------------------------*  03100000
031100     COPY APRD045.                                                03110000
031200                                                                  03120000
031300*--------------------------------------------------------------*  03130000
031400* IMPORT PO - IMPORT COST INVOICE FILE.                        *  03140000
031500*--------------------------------------------------------------*  03150000
031600     COPY APRD058.                                                03160000
031700                                                                  03170000
031800*--------------------------------------------------------------*  03180000
031900* WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE *  03190000
032000*--------------------------------------------------------------*  03200000
032100     COPY DPWS500.                                                03210000
032200                                                                  03220000
032300*--------------------------------------------------------------*  03230000
032400* ABEND DATA AREAS                                             *  03240000
032500*--------------------------------------------------------------*  03250000
032600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          03260000
032700                                             COMP SYNC.           03270000
032800     88  AC-BAD-DATA                         VALUE +4003.         03280000
032900     88  AC-DB2-ERROR                        VALUE +4013.         03290000
033000     88  AC-DATE-ERROR                       VALUE +4019.         03300000
033100                                                                  03310000
033200 01  ABEND-AREAS.                                                 03320000
033300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                03330000
033400             '*****       ABEND'.                                 03340000
033500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                03350000
033600             '*****   PROGRAM: APKUT065'.                         03360000
033700     05  AA-PARAGRAPH-LIT.                                        03370000
033800         10  FILLER              PIC  X(17)  VALUE                03380000
033900             '***** PARAGRAPH: '.                                 03390000
034000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        03400000
034100     05  AA-MESSAGE-LINE.                                         03410000
034200         10  FILLER              PIC  X(06)  VALUE '*****'.       03420000
034300         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        03430000
034400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                03440000
034500             '*****    DB2 ERROR'.                                03450000
034600     05  AA-DB2-OPERATION-LIT.                                    03460000
034700         10  FILLER              PIC  X(17)  VALUE                03470000
034800             '***** OPERATION: '.                                 03480000
034900         10  AA-DB2-OPERATION.                                    03490000
035000             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        03500000
035100             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        03510000
035200     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        03520000
035300     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        03530000
035400     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        03540000
035500     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        03550000
035600                                                                  03560000
035700*--------------------------------------------------------------*  03570000
035800* SQLCA FORMATTED MESSAGE AREA                                 *  03580000
035810*--------------------------------------------------------------*  03581000
035820     COPY DPWS004.                                                03582000
035830                                                                  03583000
035840 01  FILLER                      PIC  X(25)  VALUE                03584000
035850     '** END OF APKUT065 W/S **'.                                 03585000
035860                                                                  03586000
035870 PROCEDURE DIVISION.                                              03587000
035880 A100-MAIN.                                                       03588000
035890                                                                  03589000
035900     PERFORM B100-HOUSEKEEPING.                                   03590000
036000     PERFORM B200-PROCESS-POS                                     03600000
036100       UNTIL END-OF-INVOICES                                      03610000
036200         OR  END-OF-PO-CSR.                                       03620000
036300     PERFORM B300-END-PROGRAM.                                    03630000
036400     GOBACK.                                                      03640000
036500                                                                  03650000
036600*--------------------------------------------------------------*  03660000
036700* INITIALIZATION PROCESS AND INITIAL READS FOR BOTH INPUTS.    *  03670000
036800*--------------------------------------------------------------*  03680000
036900 B100-HOUSEKEEPING.                                               03690000
037000                                                                  03700000
037100     OPEN INPUT  INVC-COSTS-FILE                                  03710000
037200                 RCVR-COSTS-FILE                                  03720000
037300          OUTPUT IMPORT-ADJ-FILE                                  03730000
037400          OUTPUT IMPORT-COST-FILE.                                03740000
037500                                                                  03750000
037600     INITIALIZE DCLTPOSTRR                                        03760000
037700                DCLTAPCNTL                                        03770000
037800                AP033-RECORD                                      03780000
037900                AP062-RECORD                                      03790000
038000                AP045-TRANSACTION-FILE                            03800000
038100                AP045-DETAIL-FIELDS                               03810000
038200                AP058-RECORD                                      03820000
038300                AA-DB2-TABLE-1                                    03830000
038400                AA-DB2-TABLE-2                                    03840000
038500                AA-DB2-TABLE-3                                    03850000
038600                AA-DB2-TABLE-4                                    03860000
038700                PV-COUNTERS.                                      03870000
038800                                                                  03880000
038810     MOVE ZEROES TO AP058-IC-ACTL-LANDED-COST-AMT.                03881001
038820     MOVE ZEROES TO AP058-IC-PRIVATE-LBL-LOAD-AMT.                03882001
038830     MOVE ZEROES TO AP058-IC-FIRST-COST-LOAD-AMT.                 03883001
038840                                                                  03884001
038900     MOVE 'APKUT065'             TO AP045-ENTR-ID.                03890000
039000     ACCEPT PV-TIME-OF-DAY       FROM TIME.                       03900000
039100     MOVE PV-DAY-HOUR            TO PV-TIME-HOUR.                 03910000
039200     MOVE PV-DAY-MINUTE          TO PV-TIME-MINUTE.               03920000
039300     MOVE PV-DAY-SECOND          TO PV-TIME-SECOND.               03930000
039400     MOVE PV-TIME                TO AP045-ENTR-TME.               03940000
039500                                                                  03950000
039600     SET AP045-DETAIL-RECORD     TO TRUE.                         03960000
039700                                                                  03970000
039800     PERFORM Y100-GET-TRANS-DATE.                                 03980000
039900     MOVE APCNTL-BTCH-PRC-DTE    TO PV-CURRENT-DATE.              03990000
040000                                                                  04000000
040100     PERFORM X100-OPEN-PO-CSR.                                    04010000
040200                                                                  04020000
040300     PERFORM F100-FETCH-PO-CSR.                                   04030000
040400     IF END-OF-PO-CSR                                             04040000
040500         DISPLAY '* * * * * * * * * * * * * * * * * * '           04050000
040600         DISPLAY 'NO POSTRR DATA TO PROCESS '                     04060000
040700         DISPLAY '* * * * * * * * * * * * * * * * * * '           04070000
040800         DISPLAY 'END OF CURSOR ON FIRST FETCH OF POSTRR CURSOR  '04080000
040900         DISPLAY 'END OF PROCESSING             '                 04090000
041000     END-IF.                                                      04100000
041100                                                                  04110000
041200     PERFORM R100-READ-INVOICES.                                  04120000
041300     IF END-OF-INVOICES                                           04130000
041400         DISPLAY 'END OF FILE CONDITION ON '                      04140000
041500                 'FIRST READ OF INVOICE COST FILE '               04150000
041600         DISPLAY 'END OF PROCESSING             '                 04160000
041700     END-IF.                                                      04170000
041800                                                                  04180000
041900     PERFORM R200-READ-RCVR-COSTS.                                04190000
042000     IF END-OF-RCVR-FILE                                          04200000
042100         DISPLAY 'END OF FILE CONDITION ON '                      04210000
042200                 'FIRST READ OF RECEIVER COST FILE'               04220000
042300         DISPLAY 'END OF PROCESSING             '                 04230000
042400     END-IF.                                                      04240000
042500                                                                  04250000
042600*--------------------------------------------------------------*  04260000
042700* CONTROLS THE PROCESSING OF EACH PO AS FOLLOWS:               *  04270000
042800*                                                              *  04280000
042900* - BUMPS PO_CSR AGAINST AP062(INVOICE COSTS) FILE TO FIND A   *  04290000
043000*   MATCH ON PO NUMBER.                                        *  04300000
043100* - WHEN A MATCH IS FOUND:                                     *  04310000
043200* - FORMAT THE FIELDS FOR THIS PO THAT WILL NOT CHANGE.        *  04320000
043300* - PROCESS AP033 (RCVR COSTS) FOR THE PO.                     *  04330000
043400*--------------------------------------------------------------*  04340000
043500 B200-PROCESS-POS.                                                04350000
043600                                                                  04360000
043700     IF POSTRR-PO-NBR > AP062-PO-NBR                              04370000
043800        PERFORM R100-READ-INVOICES                                04380000
043900     ELSE                                                         04390000
044000        IF POSTRR-PO-NBR < AP062-PO-NBR                           04400000
044100           PERFORM F100-FETCH-PO-CSR                              04410000
044200        ELSE                                                      04420000
044300                                                                  04430000
044400* FORMAT THE FIELDS FOR THIS PO THAT WILL NOT CHANGE              04440000
044500           MOVE AP062-PO-NBR   TO PV-HOLD-PO-NBR                  04450000
044600                                  PV-PO-IN-PROCESS-9              04460000
044700           PERFORM P100-FORMAT-COMMON-FIELDS                      04470000
044800                                                                  04480000
044900* PROCESS AP033 (RECEIVER COSTS) FOR THE PO, AND CREATE THE       04490000
045000* PJ ENTRIES                                                      04500000
045100           PERFORM C100-PROCESS-RCVR-FILE                         04510000
045200             UNTIL AP033-PO-NBR > POSTRR-PO-NBR                   04520000
045300               OR  END-OF-RCVR-FILE                               04530000
045400                                                                  04540000
045500* JUST PROCESSED THE MATCHING PO, GET NEW INPUTS                  04550000
045600           PERFORM R100-READ-INVOICES                             04560000
045700           PERFORM F100-FETCH-PO-CSR                              04570000
045800        END-IF                                                    04580000
045900     END-IF.                                                      04590000
046000                                                                  04600000
046100*--------------------------------------------------------------*  04610000
046200* ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.        *  04620000
046300*--------------------------------------------------------------*  04630000
046400 B300-END-PROGRAM.                                                04640000
046500                                                                  04650000
046600     DISPLAY 'POSTRR ROWS FETCHED    = ' PV-COUNT-POCSR-READ.     04660000
046700     DISPLAY 'PO INVC COSTS READ     = ' PV-COUNT-INVC-READ.      04670000
046800     DISPLAY 'PO RCVR COSTS READ     = ' PV-COUNT-RCVR-READ.      04680000
046900     DISPLAY ' '                                                  04690000
047000                                                                  04700000
047100     DISPLAY 'TOTAL AJ TRANS WRITTEN = ' PV-COUNT-ENT-WROTE.      04710000
047200     DISPLAY 'TOTAL IMPT CST WRITTEN = ' PV-COUNT-IMCST-WROTE.    04720000
047300                                                                  04730000
047400     PERFORM X110-CLOSE-PO-CSR.                                   04740000
047500                                                                  04750000
047600     CLOSE INVC-COSTS-FILE                                        04760000
047700           RCVR-COSTS-FILE                                        04770000
047800           IMPORT-ADJ-FILE                                        04780000
047900           IMPORT-COST-FILE.                                      04790000
048000                                                                  04800000
048100*--------------------------------------------------------------*  04810000
048200* PROCESS AP033 (RECEIVER COSTS) FOR THE PO BEING PROCESSED    *  04820000
048300* AND CREATE THE PJ TRANSACTIONS.                              *  04830000
048400* - IF THE LOAD TYPE IS LIFUNG, CREATE ENTRIES FOR THE FIRST   *  04840000
048500*   COST LOAD.                                                 *  04850000
048600* - IF THE LOAD TYPE IS PRIVATE LABEL, CREATE ENTRIES FOR THE  *  04860000
048700*   PRIVATE LABEL LOAD.                                        *  04870000
048800* - FOR ALL VENDORS, CREATE ENTRIES FOR THE ACTUAL COSTS       *  04880000
048900*   OTHER THAN FIRST COST.                                     *  04890000
049000* - FOR ALL VENDORS, CREATE CLEARING ACCOUNT ENTRY FOR         *  04900000
049100*   THE TOTAL OF THE FIRST COST INVOICES.  THIS WILL           *  04910000
049200*   RELIEVE THE CLEARING ACCOUNT OF THIS PREPAYMENT.           *  04920000
049300*--------------------------------------------------------------*  04930000
049400 C100-PROCESS-RCVR-FILE.                                          04940000
049500                                                                  04950000
049600     IF AP033-PO-NBR = POSTRR-PO-NBR                              04960000
049700        EVALUATE TRUE                                             04970000
049800            WHEN AP062-LIFUNG-LOAD                                04980000
049900                PERFORM C200-FORMAT-LIFUNG-TRANS                  04990000
050000            WHEN AP062-PRIVATE-LABEL-LOAD                         05000000
050100                PERFORM C500-FORMAT-PRIVATE-LABEL-LOAD            05010000
050200            WHEN AP062-NO-LOAD-TO-APPLY                           05020000
050300                CONTINUE                                          05030000
050400        END-EVALUATE                                              05040000
050500        PERFORM C300-FORMAT-ACTL-COSTS-ENT                        05050000
050501        PERFORM UNTIL AP062-INV-NET-COST-AMT = 0                  05050104
050510           IF AP062-INV-NET-COST-AMT > PC-DISTRIB-LINE-LIMIT      05051004
050520              MOVE PC-DISTRIB-LINE-LIMIT TO PV-CLEARING-AMT       05052004
050530              SUBTRACT PC-DISTRIB-LINE-LIMIT                      05053004
050540                  FROM AP062-INV-NET-COST-AMT                     05054004
050601              ADD 1 TO PV-SUFFIX-COUNT                            05060104
050602              MOVE PV-SUFFIX-COUNT TO PV-SUFFIX-2-CNT             05060204
050603              MOVE '/'             TO PV-SUFFIX-2-SLASH           05060304
050604              PERFORM C400-FORMAT-CLEARING-ENT                    05060404
050610           ELSE                                                   05061004
050620              MOVE AP062-INV-NET-COST-AMT TO PV-CLEARING-AMT      05062004
050631              MOVE SPACES TO PV-SUFFIX-2                          05063104
050632              PERFORM C400-FORMAT-CLEARING-ENT                    05063204
050633              MOVE ZERO TO AP062-INV-NET-COST-AMT                 05063306
050634                           PV-SUFFIX-COUNT                        05063406
050640           END-IF                                                 05064004
050650        END-PERFORM                                               05065004
050700        PERFORM W200-WRITE-IMPORT-COST-INV                        05070000
050800     END-IF.                                                      05080000
050900                                                                  05090000
051000     PERFORM R200-READ-RCVR-COSTS.                                05100000
051100                                                                  05110000
051200*--------------------------------------------------------------*  05120000
051300* FOR LIFUNG ONLY, FORMAT ENTRIES FOR THE FIRST COST LOAD.     *  05130000
051400* THE LOAD PERCENT WAS DETERMINED IN AN EARLIER PROGRAM        *  05140000
051500* AND PASSED IN THE AP062-1ST-COST-LOAD-PCT FIELD.             *  05150000
051600* THE 40 ENTRY WILL CHARGE THE MERCHANDISE DEPARTMENT.         *  05160000
051700*--------------------------------------------------------------*  05170000
051800 C200-FORMAT-LIFUNG-TRANS.                                        05180000
051900                                                                  05190000
052000     MOVE '66'                     TO PV-HOLD-TRN-CDE.            05200000
052100     PERFORM S100-SELECT-DOC-TYPE.                                05210000
052200     MOVE PV-HOLD-TRN-CDE          TO AP045-AP-TRN-CDE.           05220000
052300     MOVE PV-TRN-TYP-CDE           TO AP045-TRN-TYP-CDE.          05230000
052400     MOVE PV-PSTG-TYP-CDE          TO AP045-PSTG-TYP-CDE.         05240000
052500     MOVE 90                       TO AP045-STR-NBR.              05250000
052600     INITIALIZE                       AP045-CL-NBR.               05260000
052700     INITIALIZE                       AP045-DEPT-NBR.             05270000
052800     MOVE '10311'                  TO AP045-GL-ACCT-NBR.          05280000
052900     MOVE PV-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE.      05290000
053000     MOVE 'FCL'                    TO PV-DOC-SUFFIX.              05300000
053100     STRING PV-PO-X        DELIMITED BY SIZE                      05310000
053200            PV-DOC-SUFFIX  DELIMITED BY SIZE                      05320000
053300            INTO AP045-DOC-NBR.                                   05330000
053400     INITIALIZE                       AP045-SKU-NBR.              05340000
053500     COMPUTE AP045-GRO-COST-AMT = (AP062-INV-1ST-COST-AMT *       05350000
053600                          AP062-1ST-COST-LOAD-PCT) + .005.        05360000
053700                                                                  05370000
053800     COMPUTE AP045-DTL-TERM-DISC-AMT = (AP045-GRO-COST-AMT *      05380000
053900                          AP045-TERM-DISC-PCT) + .005.            05390000
054000                                                                  05400000
054100     COMPUTE AP045-DTL-NW-STR-DISC-AMT = (AP045-GRO-COST-AMT *    05410000
054200                          AP045-NW-STR-DISC-PCT) + .005.          05420000
054300                                                                  05430000
054400     COMPUTE AP045-DTL-TRD-DISC-AMT = (AP045-GRO-COST-AMT *       05440000
054500                          AP045-TRD-DISC-PCT) + .005.             05450000
054600                                                                  05460000
054700     COMPUTE AP045-DTL-MOS-DISC-AMT = (AP045-GRO-COST-AMT *       05470000
054800                          AP045-MOS-DISC-PCT) + .005.             05480000
054900                                                                  05490000
055000     COMPUTE AP045-NET-COST-AMT = (AP045-GRO-COST-AMT             05500000
055100                                  + AP045-FRGT-AMT                05510000
055200                                  + AP045-MISC-CHRG-AMT           05520000
055300                                  - AP045-DTL-TERM-DISC-AMT       05530000
055400                                  - AP045-DTL-NW-STR-DISC-AMT     05540000
055500                                  - AP045-DTL-TRD-DISC-AMT        05550000
055600                                  - AP045-DTL-MOS-DISC-AMT).      05560000
055700     IF AP045-PSTG-TYP-CDE = 'CR'                                 05570000
055800        PERFORM D100-REVERSE-SIGN                                 05580000
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100     PERFORM W100-WRITE-AJ-TRANS.                                 05610000
056200                                                                  05620000
056300     MOVE AP045-PO-NBR             TO AP058-PO-NBR.               05630000
056400     MOVE 4                        TO AP058-RECORD-TYPE.          05640000
056500                                                                  05650000
056600     COMPUTE AP058-IC-FIRST-COST-LOAD-AMT =                       05660000
056700       (AP062-INV-1ST-COST-AMT * AP062-1ST-COST-LOAD-PCT) + .005. 05670000
056800                                                                  05680000
056900                                                                  05690000
057000*--------------------------------------------------------------*  05700000
057100* FORMAT THE ACTUAL COSTS OTHER THAN FIRST COST AND WRITE      *  05710000
057200* THEM (ONLY IF THE AMOUNT IS GREATER THAN ZERO).              *  05720000
057300* THE FIRST ENTRY IS AGAINST THE MERCHANDISE DEPARTMENT.       *  05730000
057400* THE SECOND ENTRY IS AN OFFSET OF THE ABOVE AMOUNT            *  05740000
057500* TO THE CLEARING ACCOUNT.                                     *  05750000
057600*--------------------------------------------------------------*  05760000
057700 C300-FORMAT-ACTL-COSTS-ENT.                                      05770000
057800                                                                  05780000
057900     COMPUTE AP045-GRO-COST-AMT =                                 05790000
058000         (AP062-INV-TOT-COST-AMT - AP062-INV-1ST-COST-AMT).       05800000
058100                                                                  05810000
058200     IF AP045-GRO-COST-AMT > ZERO                                 05820000
058300                                                                  05830000
058400        MOVE AP045-PO-NBR             TO AP058-PO-NBR             05840000
058500        MOVE 4                        TO AP058-RECORD-TYPE        05850000
058600        MOVE AP045-GRO-COST-AMT       TO                          05860000
058700                AP058-IC-ACTL-LANDED-COST-AMT                     05870000
058800                                                                  05880000
058900                                                                  05890000
059000                                                                  05900000
059100        MOVE '74'                     TO PV-HOLD-TRN-CDE          05910000
059200        PERFORM S100-SELECT-DOC-TYPE                              05920000
059300        MOVE PV-HOLD-TRN-CDE          TO AP045-AP-TRN-CDE         05930000
059400        MOVE PV-TRN-TYP-CDE           TO AP045-TRN-TYP-CDE        05940000
059500        MOVE PV-PSTG-TYP-CDE          TO AP045-PSTG-TYP-CDE       05950000
059600        MOVE PV-GL-ACCT-NBR           TO AP045-GL-ACCT-NBR        05960000
059700        MOVE 90                       TO AP045-STR-NBR            05970000
059800        INITIALIZE                       AP045-CL-NBR             05980000
059900        INITIALIZE                       AP045-DEPT-NBR           05990000
060000        MOVE PV-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE    06000000
060100        MOVE 'ALC'                    TO PV-DOC-SUFFIX            06010000
060200        STRING PV-PO-X        DELIMITED BY SIZE                   06020000
060300               PV-DOC-SUFFIX  DELIMITED BY SIZE                   06030000
060400               INTO AP045-DOC-NBR                                 06040000
060500                                                                  06050000
060600        COMPUTE AP045-GRO-COST-AMT =                              06060000
060700         (AP062-INV-TOT-COST-AMT - AP062-INV-1ST-COST-AMT)        06070000
060800                                                                  06080000
060900        COMPUTE AP045-DTL-TERM-DISC-AMT =                         06090000
061000         (AP045-GRO-COST-AMT * AP045-TERM-DISC-PCT) + .005        06100000
061100                                                                  06110000
061200        COMPUTE AP045-DTL-NW-STR-DISC-AMT =                       06120000
061300         (AP045-GRO-COST-AMT * AP045-NW-STR-DISC-PCT) + .005      06130000
061400                                                                  06140000
061500        COMPUTE AP045-DTL-TRD-DISC-AMT =                          06150000
061600         (AP045-GRO-COST-AMT * AP045-TRD-DISC-PCT) + .005         06160000
061700                                                                  06170000
061800        COMPUTE AP045-DTL-MOS-DISC-AMT =                          06180000
061900         (AP045-GRO-COST-AMT * AP045-MOS-DISC-PCT) + .005         06190000
062000                                                                  06200000
062100        COMPUTE AP045-NET-COST-AMT = ( AP045-GRO-COST-AMT         06210000
062200                                     + AP045-FRGT-AMT             06220000
062300                                     + AP045-MISC-CHRG-AMT        06230000
062400                                     - AP045-DTL-TERM-DISC-AMT    06240000
062500                                     - AP045-DTL-NW-STR-DISC-AMT  06250000
062600                                     - AP045-DTL-TRD-DISC-AMT     06260000
062700                                     - AP045-DTL-MOS-DISC-AMT)    06270000
062800                                                                  06280000
062900        IF AP045-PSTG-TYP-CDE = 'CR'                              06290000
063000           PERFORM D100-REVERSE-SIGN                              06300000
063100        END-IF                                                    06310000
063200        PERFORM W100-WRITE-AJ-TRANS                               06320000
063300     END-IF.                                                      06330000
063400                                                                  06340000
063500                                                                  06350000
063600*--------------------------------------------------------------*  06360000
063700* FORMAT CLEARING ACCOUNT ENTRY FOR THE TOTAL OF THE FIRST     *  06370000
063800* COST INVOICES.  THIS WILL RELIEVE THE CLEARING ACCOUNT OF    *  06380000
063900* THIS PREPAYMENT.                                             *  06390000
064000*--------------------------------------------------------------*  06400000
064100 C400-FORMAT-CLEARING-ENT.                                        06410000
064200                                                                  06420000
064300     MOVE 90                      TO AP045-STR-NBR.               06430000
064400     INITIALIZE                       AP045-DEPT-NBR.             06440000
064500     INITIALIZE                       AP045-CL-NBR.               06450000
064600     MOVE '74'                     TO PV-HOLD-TRN-CDE.            06460000
064700     PERFORM S100-SELECT-DOC-TYPE                                 06470000
064800     MOVE PV-HOLD-TRN-CDE          TO AP045-AP-TRN-CDE.           06480000
064900     MOVE PV-TRN-TYP-CDE           TO AP045-TRN-TYP-CDE.          06490000
065000     MOVE PV-PSTG-TYP-CDE          TO AP045-PSTG-TYP-CDE.         06500000
065100     MOVE PV-GL-ACCT-NBR           TO AP045-GL-ACCT-NBR.          06510000
065200     MOVE PV-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE.      06520000
065300     MOVE 'CLR'                    TO PV-DOC-SUFFIX.              06530000
065400     STRING PV-PO-X        DELIMITED BY SIZE                      06540000
065500            PV-DOC-SUFFIX  DELIMITED BY SIZE                      06550000
065510            PV-SUFFIX-2    DELIMITED BY SIZE                      06551004
065600            INTO AP045-DOC-NBR.                                   06560000
065700     MOVE PV-CLEARING-AMT          TO AP045-GRO-COST-AMT.         06570004
065800                                                                  06580000
065900     COMPUTE AP045-DTL-TERM-DISC-AMT =                            06590000
066000        (AP045-GRO-COST-AMT * AP045-TERM-DISC-PCT) + .005.        06600000
066100                                                                  06610000
066200     COMPUTE AP045-DTL-NW-STR-DISC-AMT =                          06620000
066300        (AP045-GRO-COST-AMT * AP045-NW-STR-DISC-PCT) + .005.      06630000
066400                                                                  06640000
066500     COMPUTE AP045-DTL-TRD-DISC-AMT =                             06650000
066600        (AP045-GRO-COST-AMT * AP045-TRD-DISC-PCT) + .005.         06660000
066700                                                                  06670000
066800     COMPUTE AP045-DTL-MOS-DISC-AMT =                             06680000
066900        (AP045-GRO-COST-AMT * AP045-MOS-DISC-PCT) + .005.         06690000
067000                                                                  06700000
067100     COMPUTE AP045-NET-COST-AMT = ( AP045-GRO-COST-AMT            06710000
067200                                  + AP045-FRGT-AMT                06720000
067300                                  + AP045-MISC-CHRG-AMT           06730000
067400                                  - AP045-DTL-TERM-DISC-AMT       06740000
067500                                  - AP045-DTL-NW-STR-DISC-AMT     06750000
067600                                  - AP045-DTL-TRD-DISC-AMT        06760000
067700                                  - AP045-DTL-MOS-DISC-AMT).      06770000
067800                                                                  06780000
067900     IF AP045-PSTG-TYP-CDE = 'CR'                                 06790000
068000        PERFORM D100-REVERSE-SIGN                                 06800000
068100     END-IF.                                                      06810000
068200     PERFORM W100-WRITE-AJ-TRANS.                                 06820000
068300                                                                  06830000
068400*----------------------------------------------------------------*06840000
068500* FOR PRIVATE LABEL PURCHASE ORDERS, CREATE PRIVATE LABEL LOAD.  *06850000
068600* CREATES A TRANSACTION TO CREDIT THE LOAD ACCOUNT IN GL.        *06860000
068700* CHARGES THE MERCHANDISE LEDGER FOR THE ACTUAL LOAD AMOUNT.     *06870000
068800*----------------------------------------------------------------*06880000
068900 C500-FORMAT-PRIVATE-LABEL-LOAD.                                  06890000
069000                                                                  06900000
069100     MOVE '6N'                     TO PV-HOLD-TRN-CDE.            06910000
069200     PERFORM S100-SELECT-DOC-TYPE.                                06920000
069300     MOVE PV-HOLD-TRN-CDE          TO AP045-AP-TRN-CDE.           06930000
069400     MOVE PV-TRN-TYP-CDE           TO AP045-TRN-TYP-CDE.          06940000
069500     MOVE PV-PSTG-TYP-CDE          TO AP045-PSTG-TYP-CDE.         06950000
069600     MOVE 90                       TO AP045-STR-NBR.              06960000
069700     INITIALIZE                       AP045-CL-NBR.               06970000
069800     INITIALIZE                       AP045-DEPT-NBR.             06980000
069900     MOVE '10336'                  TO AP045-GL-ACCT-NBR.          06990000
070000     MOVE PV-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE.      07000000
070100     MOVE 'PLL'                    TO PV-DOC-SUFFIX.              07010000
070200     STRING PV-PO-X        DELIMITED BY SIZE                      07020000
070300            PV-DOC-SUFFIX  DELIMITED BY SIZE                      07030000
070400            INTO AP045-DOC-NBR.                                   07040000
070500     INITIALIZE                       AP045-SKU-NBR.              07050000
070600     COMPUTE AP045-GRO-COST-AMT = (AP062-INV-1ST-COST-AMT *       07060000
070700                          AP062-1ST-COST-LOAD-PCT) + .005.        07070000
070800                                                                  07080000
070900     COMPUTE AP045-DTL-TERM-DISC-AMT = (AP045-GRO-COST-AMT *      07090000
071000                          AP045-TERM-DISC-PCT) + .005.            07100000
071100                                                                  07110000
071200     COMPUTE AP045-DTL-NW-STR-DISC-AMT = (AP045-GRO-COST-AMT *    07120000
071300                          AP045-NW-STR-DISC-PCT) + .005.          07130000
071400                                                                  07140000
071500     COMPUTE AP045-DTL-TRD-DISC-AMT = (AP045-GRO-COST-AMT *       07150000
071600                          AP045-TRD-DISC-PCT) + .005.             07160000
071700                                                                  07170000
071800     COMPUTE AP045-DTL-MOS-DISC-AMT = (AP045-GRO-COST-AMT *       07180000
071900                          AP045-MOS-DISC-PCT) + .005.             07190000
072000                                                                  07200000
072100     COMPUTE AP045-NET-COST-AMT = (AP045-GRO-COST-AMT             07210000
072200                                  + AP045-FRGT-AMT                07220000
072300                                  + AP045-MISC-CHRG-AMT           07230000
072400                                  - AP045-DTL-TERM-DISC-AMT       07240000
072500                                  - AP045-DTL-NW-STR-DISC-AMT     07250000
072600                                  - AP045-DTL-TRD-DISC-AMT        07260000
072700                                  - AP045-DTL-MOS-DISC-AMT).      07270000
072800     IF AP045-PSTG-TYP-CDE = 'CR'                                 07280000
072900        PERFORM D100-REVERSE-SIGN                                 07290000
073000     END-IF.                                                      07300000
073100                                                                  07310000
073200     PERFORM W100-WRITE-AJ-TRANS.                                 07320000
073300                                                                  07330000
073400     MOVE AP045-PO-NBR             TO AP058-PO-NBR.               07340000
073500     MOVE 4                        TO AP058-RECORD-TYPE.          07350000
073600     COMPUTE AP058-IC-PRIVATE-LBL-LOAD-AMT =                      07360000
073700       (AP062-INV-1ST-COST-AMT * AP062-1ST-COST-LOAD-PCT) + .005. 07370000
073800                                                                  07380000
073900*--------------------------------------------------------------*  07390000
074000* MULTIPLY BY NEGATIVE ONE IN ORDER TO REVERSE THE SIGN ON THE *  07400000
074100* AMOUNT FIELDS.                                               *  07410000
074200*--------------------------------------------------------------*  07420000
074300 D100-REVERSE-SIGN.                                               07430000
074400                                                                  07440000
074500     MULTIPLY -1 BY AP045-GRO-COST-AMT.                           07450000
074600     MULTIPLY -1 BY AP045-DTL-TERM-DISC-AMT.                      07460000
074700     MULTIPLY -1 BY AP045-DTL-NW-STR-DISC-AMT.                    07470000
074800     MULTIPLY -1 BY AP045-DTL-TRD-DISC-AMT.                       07480000
074900     MULTIPLY -1 BY AP045-NET-COST-AMT.                           07490000
075000     MULTIPLY -1 BY AP045-FRGT-AMT.                               07500000
075100     MULTIPLY -1 BY AP045-MISC-CHRG-AMT.                          07510000
075200     MULTIPLY -1 BY AP045-DTL-MOS-DISC-AMT.                       07520000
075300                                                                  07530000
075400*--------------------------------------------------------------*  07540000
075500* RETRIEVES THE ELC CURSOR DATA                                *  07550000
075600*--------------------------------------------------------------*  07560000
075700 F100-FETCH-PO-CSR.                                               07570000
075800                                                                  07580000
075900     EXEC SQL                                                     07590000
076000         FETCH   PO_CSR                                           07600000
076100         INTO    :POSTRR-PO-NBR                                   07610000
076200     END-EXEC.                                                    07620000
076300                                                                  07630000
076400     EVALUATE TRUE                                                07640000
076500         WHEN SQLCODE = ZERO                                      07650000
076600             ADD 1 TO PV-COUNT-POCSR-READ                         07660000
076700                                                                  07670000
076800         WHEN SQLCODE = +100                                      07680000
076900             SET END-OF-PO-CSR TO TRUE                            07690000
077000             INITIALIZE POSTRR-PO-NBR                             07700000
077100                                                                  07710000
077200         WHEN SQLWARN0 NOT = SPACES                               07720000
077300         WHEN SQLCODE  NOT = ZERO                                 07730000
077400             MOVE 'F100-FETCH-PO-CSR' TO AA-PARAGRAPH-NAME        07740000
077500             MOVE 'UNSUCCESSFUL FETCH ON PO_CSR'                  07750000
077600                                 TO AA-DB2-OPERATION              07760000
077700             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                07770000
077800             PERFORM Z998-DB2-ABEND                               07780000
077900     END-EVALUATE.                                                07790000
078000                                                                  07800000
078100*--------------------------------------------------------------*  07810000
078200* FORMAT THE COMMON FIELDS FOR THE ADJUSTMENT JOURNAL FILE     *  07820000
078300* WRITE THE RECORD TO THE OUTPUT FILE.                         *  07830000
078400*--------------------------------------------------------------*  07840000
078500 P100-FORMAT-COMMON-FIELDS.                                       07850000
078600                                                                  07860000
078700     MOVE AP062-VENDOR-NBR       TO AP045-VND-NBR.                07870000
078800     MOVE AP062-PO-NBR           TO AP045-PO-NBR.                 07880000
078900     MOVE PV-CURRENT-DATE        TO AP045-DOC-DTE                 07890000
079000                                    AP045-ENTR-DTE                07900000
079100                                    AP045-INV-CUTOFF-DTE.         07910000
079200     MOVE AP062-VENDOR-NAME      TO AP045-ENT-NME-DESC.           07920000
079300                                                                  07930000
079400     SET AP045-ORGN-IMPORT         TO TRUE.                       07940000
079500                                                                  07950000
079600     MOVE SPACES                   TO AP045-BAR-CDE.              07960000
079700     MOVE PV-CURRENT-DATE          TO AP045-PS-BTCH-DTE.          07970000
079800     MOVE PV-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE.      07980000
079900     MOVE '00'                     TO AP045-PS-BTCH-SEQ-NBR.      07990000
080000     MOVE APCNTL-CURR-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR.         08000000
080100     MOVE APCNTL-CURR-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR.         08010000
080200     MOVE APCNTL-CURR-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR.         08020000
080300     PERFORM S200-GET-VENDOR-ID.                                  08030000
080400     MOVE EXTENT-ENT-ID            TO AP045-ENT-ID.               08040000
080500     MOVE ZEROS                    TO AP045-TERM-DISC-PCT.        08050000
080600                                                                  08060000
080700*--------------------------------------------------------------*  08070000
080800* READ THE IMPORT PO INVOICE COST FILE                         *  08080000
080900*--------------------------------------------------------------*  08090000
081000 R100-READ-INVOICES.                                              08100000
081100                                                                  08110000
081200     MOVE 'R100-READ-INVOICES'   TO AA-PARAGRAPH-NAME.            08120000
081300                                                                  08130000
081400     IF NOT END-OF-INVOICES                                       08140000
081500        READ INVC-COSTS-FILE INTO AP062-RECORD                    08150000
081600          AT END  SET END-OF-INVOICES TO TRUE.                    08160000
081700                                                                  08170000
081800     IF NOT END-OF-INVOICES                                       08180000
081900        ADD 1 TO PV-COUNT-INVC-READ.                              08190000
082000                                                                  08200000
082100*--------------------------------------------------------------*  08210000
082200* READ THE RECEIVER COSTS FILE.                                *  08220000
082300*--------------------------------------------------------------*  08230000
082400 R200-READ-RCVR-COSTS.                                            08240000
082500                                                                  08250000
082600     MOVE 'R200-READ-RCVR-COSTS'  TO AA-PARAGRAPH-NAME.           08260000
082700                                                                  08270000
082800     IF NOT END-OF-RCVR-FILE                                      08280000
082900        READ RCVR-COSTS-FILE INTO AP033-RECORD                    08290000
083000          AT END  SET END-OF-RCVR-FILE TO TRUE.                   08300000
083100                                                                  08310000
083200     IF NOT END-OF-RCVR-FILE                                      08320000
083300        ADD 1 TO PV-COUNT-RCVR-READ.                              08330000
083400                                                                  08340000
083500*--------------------------------------------------------------*  08350000
083600* GETS THE DOCUMENT TYPE FOR EACH TRANCODE PROCESSED           *  08360000
083700*--------------------------------------------------------------*  08370000
083800 S100-SELECT-DOC-TYPE.                                            08380000
083900                                                                  08390000
084000     MOVE 'S100-SELECT-DOC-CODE'        TO AA-PARAGRAPH-NAME.     08400000
084100                                                                  08410000
084200     EXEC SQL                                                     08420000
084300         SELECT TRN_TYP_CDE                                       08430000
084400              , GL_ACCT_NBR                                       08440000
084500              , PSTG_TYP_CDE                                      08450000
084600              , BTCH_SRC_CDE                                      08460000
084700           INTO :TRNCDE-TRN-TYP-CDE                               08470000
084800              , :TRNCDE-GL-ACCT-NBR                               08480000
084900              , :TRNCDE-PSTG-TYP-CDE                              08490000
085000              , :TRNCDE-BTCH-SRC-CDE                              08500000
085100           FROM TTRNCDE                                           08510000
085200          WHERE AP_TRN_CDE = :PV-HOLD-TRN-CDE                     08520000
085300            AND EFF_STRT_DTE <= :PV-CURRENT-DATE                  08530000
085400            AND EFF_END_DTE  >= :PV-CURRENT-DATE                  08540000
085500     END-EXEC.                                                    08550000
085600                                                                  08560000
085700     EVALUATE TRUE                                                08570000
085800           WHEN SQLCODE = ZERO                                    08580000
085900               MOVE TRNCDE-TRN-TYP-CDE  TO PV-TRN-TYP-CDE         08590000
086000               MOVE TRNCDE-GL-ACCT-NBR  TO PV-GL-ACCT-NBR         08600000
086100               MOVE TRNCDE-PSTG-TYP-CDE TO PV-PSTG-TYP-CDE        08610000
086200               MOVE TRNCDE-BTCH-SRC-CDE TO PV-BTCH-SRC-CDE        08620000
086300                     CONTINUE                                     08630000
086400           WHEN SQLWARN0 NOT = SPACES                             08640000
086500           WHEN SQLCODE  NOT = ZERO                               08650000
086600               MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION     08660000
086700               MOVE 'TTRNCDE'             TO AA-DB2-TABLE-1       08670000
086800               PERFORM Z998-DB2-ABEND                             08680000
086900     END-EVALUATE.                                                08690000
087000                                                                  08700000
087100*--------------------------------------------------------------*  08710000
087200* RETRIEVES VENDOR ID FOR PO BEING PROCESSED.                  *  08720000
087300*--------------------------------------------------------------*  08730000
087400 S200-GET-VENDOR-ID.                                              08740000
087500                                                                  08750000
087600     MOVE 'S200-GET-VENDOR-ID' TO AA-PARAGRAPH-NAME.              08760000
087700                                                                  08770000
087800     EXEC SQL                                                     08780000
087900         SELECT  ENT_ID                                           08790000
088000           INTO :EXTENT-ENT-ID                                    08800000
088100           FROM TEXTENT                                           08810000
088200          WHERE DUN_NBR = :AP062-VENDOR-NBR                       08820000
088300     END-EXEC.                                                    08830000
088400                                                                  08840000
088500     EVALUATE TRUE                                                08850000
088600         WHEN SQLCODE = ZERO                                      08860000
088700             CONTINUE                                             08870000
088800                                                                  08880000
088900         WHEN SQLCODE = +100                                      08890000
089000             CONTINUE                                             08900000
089100                                                                  08910000
089200         WHEN SQLWARN0 NOT = SPACES                               08920000
089300         WHEN SQLCODE  NOT = ZERO                                 08930000
089400               MOVE 'UNSUCCESSFUL SELECT FOR ENT-ID '             08940000
089500                                 TO AA-DB2-OPERATION              08950000
089600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                08960000
089700             PERFORM Z998-DB2-ABEND                               08970000
089800     END-EVALUATE.                                                08980000
089900                                                                  08990000
090000*--------------------------------------------------------------*  09000000
090100* WRITE THE ADJUSTMENT JOURNAL TRANSACTION RECORDS TO THE FILE *  09010000
090200*--------------------------------------------------------------*  09020000
090300 W100-WRITE-AJ-TRANS.                                             09030000
090400                                                                  09040000
090500     WRITE IMPORT-ADJ-REC FROM AP045-TRANSACTION-FILE.            09050000
090600     ADD 1 TO PV-COUNT-ENT-WROTE.                                 09060000
090700                                                                  09070000
090800*--------------------------------------------------------------*  09080000
090900* WRITE THE IMPORT COST INVOICE INFO TO THE FILE               *  09090000
091000*--------------------------------------------------------------*  09100000
091100 W200-WRITE-IMPORT-COST-INV.                                      09110000
092400                                                                  09240000
092500     WRITE IMPORT-COST-REC FROM AP058-RECORD.                     09250000
092600     ADD 1 TO PV-COUNT-IMCST-WROTE.                               09260000
092700     INITIALIZE AP058-RECORD.                                     09270000
092701     MOVE ZEROES TO AP058-IC-ACTL-LANDED-COST-AMT.                09270100
092702     MOVE ZEROES TO AP058-IC-PRIVATE-LBL-LOAD-AMT.                09270200
092710     MOVE ZEROES TO AP058-IC-FIRST-COST-LOAD-AMT.                 09271000
092800                                                                  09280000
092900*--------------------------------------------------------------*  09290000
093000* OPEN PO_CSR CURSOR.                                          *  09300000
093100*--------------------------------------------------------------*  09310000
093200 X100-OPEN-PO-CSR.                                                09320000
093300                                                                  09330000
093400     EXEC SQL                                                     09340000
093500         OPEN PO_CSR                                              09350000
093600     END-EXEC.                                                    09360000
093700                                                                  09370000
093800     EVALUATE TRUE                                                09380000
093900         WHEN SQLCODE = ZERO                                      09390000
094000             SET NEW-PO-CSR      TO TRUE                          09400000
094100                                                                  09410000
094200         WHEN SQLWARN0 NOT = SPACES                               09420000
094300         WHEN SQLCODE  NOT = ZERO                                 09430000
094400            MOVE 'X100-OPEN-PO-CSR' TO AA-PARAGRAPH-NAME          09440000
094500            MOVE 'UNSUCCESSFUL OPEN ON PO_CSR' TO AA-DB2-OPERATION09450000
094600            MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                 09460000
094700            PERFORM Z998-DB2-ABEND                                09470000
094800     END-EVALUATE.                                                09480000
094900                                                                  09490000
095000                                                                  09500000
095100*--------------------------------------------------------------*  09510000
095200* CLOSE THE PO_CSR CURSOR                                      *  09520000
095300*--------------------------------------------------------------*  09530000
095400 X110-CLOSE-PO-CSR.                                               09540000
095500                                                                  09550000
095600     EXEC SQL                                                     09560000
095700         CLOSE PO_CSR                                             09570000
095800     END-EXEC.                                                    09580000
095900                                                                  09590000
096000       EVALUATE TRUE                                              09600000
096100           WHEN SQLCODE = ZERO                                    09610000
096200                CONTINUE                                          09620000
096300           WHEN SQLWARN0 NOT = SPACES                             09630000
096400           WHEN SQLCODE  NOT = ZERO                               09640000
096500              MOVE 'X110-CLOSE-PO-CSR' TO AA-PARAGRAPH-NAME       09650000
096600              MOVE 'UNSUCCESSFUL CLOSE PO_CSR' TO AA-DB2-OPERATION09660000
096700              MOVE 'TPOSTRR'    TO AA-DB2-TABLE-1                 09670000
096800              PERFORM Z998-DB2-ABEND                              09680000
096900       END-EVALUATE.                                              09690000
097000                                                                  09700000
097100*--------------------------------------------------------------*  09710000
097200* RETRIEVES THE PAYMENT BATCH DATE FROM THE AP CONTROL TABLE   *  09720000
097300* NOTE:  A NOT FOUND CONDITION WILL CAUSE AN ABEND.            *  09730000
097400*--------------------------------------------------------------*  09740000
097500 Y100-GET-TRANS-DATE.                                             09750000
097600                                                                  09760000
097700     EXEC SQL                                                     09770000
097800         SELECT  BTCH_PRC_DTE                                     09780000
097900                ,CURR_PSTG_FYR_NBR                                09790000
098000                ,CURR_PSTG_FMN_NBR                                09800000
098100                ,CURR_PSTG_FWK_NBR                                09810000
098200         INTO   :APCNTL-BTCH-PRC-DTE                              09820000
098300               ,:APCNTL-CURR-PSTG-FYR-NBR                         09830000
098400               ,:APCNTL-CURR-PSTG-FMN-NBR                         09840000
098500               ,:APCNTL-CURR-PSTG-FWK-NBR                         09850000
098600         FROM TAPCNTL                                             09860000
098700     END-EXEC.                                                    09870000
098800                                                                  09880000
098900     EVALUATE TRUE                                                09890000
099000         WHEN SQLCODE = ZERO                                      09900000
099100              CONTINUE                                            09910000
099200                                                                  09920000
099300         WHEN SQLWARN0 NOT = SPACES                               09930000
099400         WHEN SQLCODE  NOT = ZERO                                 09940000
099500         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        09950000
099600                                 TO AA-DB2-OPERATION              09960000
099700         MOVE 'TAPCNTL'          TO AA-DB2-TABLE-1                09970000
099800         PERFORM Z998-DB2-ABEND                                   09980000
099900     END-EVALUATE.                                                09990000
100000                                                                  10000000
100100*--------------------------------------------------------------*  10010000
100200* ABEND ROUTINE FOR DB2 ERRORS                                 *  10020000
100300*--------------------------------------------------------------*  10030000
100400 Z998-DB2-ABEND.                                                  10040000
100500                                                                  10050000
100600     DISPLAY AA-ABEND-LIT.                                        10060000
100700     DISPLAY AA-DB2-ERROR-LIT.                                    10070000
100800     DISPLAY AA-PROGRAM-LIT.                                      10080000
100900     DISPLAY AA-PARAGRAPH-LIT.                                    10090000
101000     DISPLAY AA-DB2-OPERATION-LIT.                                10100000
101100     DISPLAY AA-DB2-TABLE-1.                                      10110000
101200     DISPLAY AA-DB2-TABLE-2.                                      10120000
101300     DISPLAY AA-DB2-TABLE-3.                                      10130000
101400     DISPLAY AA-DB2-TABLE-4.                                      10140000
101500     DISPLAY '*****                PO = ' PV-HOLD-PO-NBR.         10150000
101600     SET AC-DB2-ERROR TO TRUE.                                    10160000
101700                                                                  10170000
101800     COPY DPPD004.                                                10180000
101900                                                                  10190000
102000     CALL 'ILBOABN0' USING ABEND-CODE.                            10200000
102100                                                                  10210000
