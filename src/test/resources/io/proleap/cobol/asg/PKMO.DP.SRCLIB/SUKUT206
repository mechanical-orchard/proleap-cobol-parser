000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT206.                                         00050000
000600 AUTHOR.        RON KRIER.                                        00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   MAY 2022.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL BE USED TO CREATE A COMMA DELIMITED FILE     00120000
001300*  THAT WILL CONTAIN CARTON INFORMATION FOR CARTONS THAT WERE     00130000
001400*  MANIFESTED TO A SHIPPED TRAILER.                               00140000
001500*                                                                 00150000
001600*  THE FILE WILL TAKE EACH CARTON AND THEN GENERATE RECORDS       00160000
001700*  FOR ANY ACTIVITY FOUND AGAINST THE CARTON THROUGH OUR          00170000
001800*  SYSTEM.  EACH RECORD WILL BE AN ACTIVITY AGAINST THE CARTON    00180000
001900*  AND WILL CONTAIN A DESCRIPTION OF THE ACTIVITY, THE DATE/TIME  00190000
002000*  THE ACTIVITY TOOK PLACE AND BY WHAT DC.                        00200000
002100*  SOME EXAMPLES OF THE DIFFERENT TYPES OF ACTIVITY ARE:          00210000
002200*    RF CHECKIN                                                   00220000
002300*    PNA CHECKIN                                                  00230000
002400*    CARTON AUDIT START                                           00240000
002500*    CARTON AUDIT STOP                                            00250000
002600*                                                                 00260000
002700*  THE COPYBOOK FOR THE OUTPUT FILE WILL BE SURD173.              00270000
002800*                                                                 00280000
002900*  THE INPUT FILE WILL BE A FILE FROM A DAILY EXTRACT THAT        00290000
003000*  CONTAINS CARTONS THAT WERE ON TRAILERS THAT WERE DC SHIPPED    00300000
003100*  THE PREVIOUS DAY.  THE COPYBOOK FOR THE INPUT FILE IS SURD117. 00310000
003200*                                                                 00320000
003300*  THE FILE WILL BE SENT TO A THIRD PARTY CONSULTING FIRM         00330000
003400*  WORKING WITH THE LOGISTICS BUSINESS TEAM FOR DOING LABOR       00340000
003500*  STUDIES.                                                       00350000
003600******************************************************************00360000
003700                                                                  00370000
003800******************************************************************00380000
003900 ENVIRONMENT DIVISION.                                            00390000
004000******************************************************************00400000
004100                                                                  00410000
004200 CONFIGURATION SECTION.                                           00420000
004300                                                                  00430000
004400 SOURCE-COMPUTER.        IBM-3090.                                00440000
004500 OBJECT-COMPUTER.        IBM-3090.                                00450000
004600                                                                  00460000
004700 INPUT-OUTPUT SECTION.                                            00470000
004800                                                                  00480000
004900 FILE-CONTROL.                                                    00490000
005000                                                                  00500000
005100     SELECT SU-DC-SHIP-SML-FILE                                   00510000
005200         ASSIGN TO INP01.                                         00520000
005300                                                                  00530000
005400     SELECT SU-SML-ACTIVITY-FILE                                  00540000
005500         ASSIGN TO OUT01.                                         00550000
005600                                                                  00560000
005700******************************************************************00570000
005800 DATA DIVISION.                                                   00580000
005900******************************************************************00590000
006000                                                                  00600000
006100 FILE SECTION.                                                    00610000
006200                                                                  00620000
006300 FD  SU-DC-SHIP-SML-FILE                                          00630000
006400     RECORDING MODE IS F                                          00640000
006500     LABEL RECORDS ARE STANDARD                                   00650000
006600     BLOCK CONTAINS 0 RECORDS.                                    00660000
006700 01  SU-DC-SHIP-SML-FILE-RECORD       PIC  X(550).                00670000
006800                                                                  00680000
006900                                                                  00690000
007000 FD  SU-SML-ACTIVITY-FILE                                         00700000
007100     RECORDING MODE IS F                                          00710000
007200     BLOCK CONTAINS 0 RECORDS                                     00720000
007300     LABEL RECORDS ARE STANDARD.                                  00730000
007400                                                                  00740000
007500 01  SU-SML-ACTIVITY-FILE-RECORD      PIC  X(100).                00750001
007600                                                                  00760000
007700                                                                  00770000
007800******************************************************************00780000
007900 WORKING-STORAGE SECTION.                                         00790000
008000******************************************************************00800000
008100                                                                  00810000
008200                                                                  00820000
008300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00830000
008400                                                   COMP SYNC.     00840000
008500                                                                  00850000
008600                                                                  00860000
008700 01  DK-DB2-KEYS.                                                 00870000
008800     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00880000
008900                                                   COMP SYNC.     00890000
009000     05  DK-LOC-ID                   PIC S9(04)    VALUE +0       00900000
009100                                                   COMP SYNC.     00910000
009200     05  DK-SHIPT-UNT-ID             PIC S9(18)    VALUE +0       00920002
009300                                                   COMP-3.        00930002
009310     05  DK-SHIPT-UNT-ID-ORIG        PIC S9(18)    VALUE +0       00931034
009320                                                   COMP-3.        00932034
009400     05  DK-TRIP-ID                  PIC S9(09)    VALUE +0       00940012
009500                                                   COMP SYNC.     00950012
009600                                                                  00960002
009700 01  PC-PROGRAM-CONSTANTS.                                        00970000
009800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00980000
009900         'SUKUT206'.                                              00990000
010000     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3.      01000025
010100     05  PC-PROGRESSIVE-READ-LIMIT   PIC S9(09)    COMP           01010005
010200                                                   VALUE 10000.   01020053
010210     05  PC-COMMA                    PIC  X(01)    VALUE ','.     01021049
010300 01  PS-PROGRAM-SWITCHES.                                         01030000
010400     05  PS-EOF-INPUT-FILE-SW        PIC  X(01)    VALUE 'N'.     01040002
010500         88  PS-EOF-INPUT-FILE                     VALUE 'Y'.     01050002
010600         88  PS-NOT-EOF-INPUT-FILE                 VALUE 'N'.     01060002
010700     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01070000
010800         88  PS-END-OF-CURSOR                      VALUE 'Y'.     01080000
010900         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     01090000
011000     05  PS-DC-EXTACT-SW             PIC  X(01)    VALUE 'N'.     01100005
011100         88  PS-DC-EXTRACT-YES                     VALUE 'Y'.     01110005
011200         88  PS-DC-EXTRACT-NO                      VALUE 'N'.     01120005
011300     05  PS-OTBND-CART-SW            PIC  X(01)    VALUE 'N'.     01130008
011400         88  PS-OTBND-CART-FOUND                   VALUE 'Y'.     01140008
011500         88  PS-OTBND-CART-NOT-FOUND               VALUE 'N'.     01150008
011600     05  PS-DOOR-FOUND-SW            PIC  X(01)    VALUE 'N'.     01160012
011700         88  PS-DOOR-FOUND                         VALUE 'Y'.     01170012
011800         88  PS-DOOR-NOT-FOUND                     VALUE 'N'.     01180012
011900                                                                  01190005
012000 01  PV-PROGRAM-VARIABLES.                                        01200000
012100     05  PV-INPUT-READ-COUNT         PIC S9(09) COMP.             01210003
012200     05  PV-INPUT-BYPASS-COUNT       PIC S9(09) COMP.             01220005
012300     05  PV-INPUT-PROCESS-COUNT      PIC S9(09) COMP.             01230005
012400     05  PV-PROGRESSIVE-READ-COUNT   PIC S9(09) COMP.             01240005
012500     05  PV-OUTPUT-WRITE-COUNT       PIC S9(09) COMP.             01250003
012600     05  PV-DISP-NBR                 PIC ZZZ,ZZZ,ZZ9.             01260005
012700     05  PV-DISP-DC-NBR              PIC ZZZ9.                    01270005
012800     05  PV-DISP-TRIP-ID             PIC ZZZZZZZZZ9.              01280012
012810     05  PV-DISP-SHIPT-UNT           PIC 9(18)  VALUE ZERO.       01281034
012900     05  PV-HOLD-SML-NBR             PIC 9(18)  VALUE ZERO.       01290007
013000                                                                  01300003
013100     05  PV-FORMAT-SML-NBR.                                       01310007
013200         10  PV-FORMAT-SML-1-4       PIC X(04)  VALUE '0000'.     01320007
013300         10  PV-FORMAT-SML-5-22      PIC 9(18)  VALUE ZERO.       01330007
013400                                                                  01340007
013500     05  PV-HOLD-TMST.                                            01350007
013600         10  PV-HOLD-TMST-YYYY       PIC 9(04).                   01360007
013700         10  PV-HOLD-TMST-DASH1      PIC X(01).                   01370007
013800         10  PV-HOLD-TMST-MM         PIC 9(02).                   01380007
013900         10  PV-HOLD-TMST-DASH2      PIC X(01).                   01390007
014000         10  PV-HOLD-TMST-DD         PIC 9(02).                   01400007
014100         10  PV-HOLD-TMST-DASH3      PIC X(01).                   01410007
014200         10  PV-HOLD-TMST-HH         PIC 9(02).                   01420007
014300         10  PV-HOLD-TMST-PERIOD1    PIC X(01).                   01430007
014400         10  PV-HOLD-TMST-MI         PIC 9(02).                   01440007
014500         10  PV-HOLD-TMST-PERIOD2    PIC X(01).                   01450007
014600         10  PV-HOLD-TMST-SS         PIC 9(02).                   01460007
014700         10  PV-HOLD-TMST-PERIOD3    PIC X(01).                   01470007
014800         10  PV-HOLD-TMST-NNNNNN     PIC 9(06).                   01480007
014900                                                                  01490009
015000     05  PV-HOLD-DATE.                                            01500009
015100         10  PV-HOLD-DATE-YYYY       PIC 9(04).                   01510009
015200         10  PV-HOLD-DATE-DASH1      PIC X(01).                   01520009
015300         10  PV-HOLD-DATE-MM         PIC 9(02).                   01530009
015400         10  PV-HOLD-DATE-DASH2      PIC X(01).                   01540009
015500         10  PV-HOLD-DATE-DD         PIC 9(02).                   01550009
015600                                                                  01560009
015700     05  PV-HOLD-TIME.                                            01570009
015800         10  PV-HOLD-TIME-HH         PIC 9(02).                   01580009
015900         10  PV-HOLD-TIME-PERIOD1    PIC X(01).                   01590009
016000         10  PV-HOLD-TIME-MI         PIC 9(02).                   01600009
016100         10  PV-HOLD-TIME-PERIOD2    PIC X(01).                   01610009
016200         10  PV-HOLD-TIME-SS         PIC 9(02).                   01620009
016300                                                                  01630007
016400     05  PV-HOLD-CRE-TMST            PIC X(26).                   01640010
016500     05  PV-HOLD-CRE-TIMEZN-TMST     PIC X(26).                   01650010
016501                                                                  01650137
016550                                                                  01655037
016551     05  PV-BAR-CODE-MSG-LBL.                                     01655145
016552         10 PV-BRCDE-PRINT-TXT           PIC  X(11).              01655245
016553         10 FILLER                       PIC  X(01).              01655345
016554         10 PV-BAR-CODE-TXT              PIC  X(10).              01655445
016555                                                                  01655545
016560     05  PV-CARTON-AUDIT-ACTIVITY.                                01656045
016570         10 PV-CRTN-AUD-STRT-STOP        PIC  X(18).              01657045
016580         10 FILLER                       PIC  X(01).              01658050
016590         10 PV-CRTN-AUD-TYPE             PIC  X(04).              01659045
016591         10 FILLER                       PIC  X(01).              01659145
016592         10 PV-CRTN-AUD-PRMPT            PIC  X(06).              01659245
016593                                                                  01659345
016600     05  PV-MAX-ERROR-COUNT          PIC S9(09) COMP.             01660000
016700     05  PV-BYPASS-PARM-CNT          PIC S9(09)  COMP.            01670000
016800     05  PV-CSR-AUDIT-PROMPT-CDE     PIC  X(1).                   01680039
018100                                                                  01810039
018200     05  PV-PREV-OPER-UNT-ID         PIC S9(4) COMP.              01820039
018900                                                                  01890039
019000     05  PV-TOTAL-ERROR-CNT          PIC  9(09)    VALUE ZERO.    01900039
019100     05  PV-ERROR-COUNT              PIC  9(09)    VALUE ZERO.    01910039
019200     05  PV-BYPASS-COUNT             PIC  9(09)    VALUE ZERO.    01920039
019300     05  PV-COUNTER                  PIC S9(04)    VALUE ZERO.    01930039
019400                                                                  01940039
019500     05  PV-OPER-UNT-ID-DISP.                                     01950039
019600         10  PV-OPER-UNT-ID-N        PIC 9(04)     VALUE ZERO.    01960039
019700                                                                  01970039
020400     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   02040039
020500                                                    COMP SYNC.    02050039
020600     05  PV-NULL-IND-2                  PIC S9(04)  VALUE ZEROS   02060039
020700                                                    COMP SYNC.    02070039
020800     05  PV-NULL-IND-3                  PIC S9(04)  VALUE ZEROS   02080039
020900                                                    COMP SYNC.    02090039
021000                                                                  02100039
021100 01  PV-ABEND-VARIABLES.                                          02110039
021200     05  PV-SQLCODE                  PIC S9(9).                   02120039
021300     05  PV-DISPLAY-SQLCODE          PIC -999.                    02130039
021400     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT206'.  02140039
021500     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      02150039
021600     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      02160039
021700     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      02170039
021800     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      02180039
021900     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      02190039
022000     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      02200039
022100     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      02210039
022200     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      02220039
022300     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      02230039
022400                                                                  02240039
022500******************************************************************02250039
022600** SHIPPED TRAILER CARTON FILE                                  **02260039
022700******************************************************************02270039
022800     COPY SURD117.                                                02280039
022900                                                                  02290039
023000******************************************************************02300039
023100** SML OUTPUT ACTIVITY FILE                                     **02310039
023200******************************************************************02320039
023300     COPY SURD173.                                                02330039
023400                                                                  02340039
023500******************************************************************02350039
023600** DB2 FORMATTED MESSAGE AREA                                   **02360039
023700******************************************************************02370039
023800     COPY DPWS004.                                                02380039
023900                                                                  02390039
024000******************************************************************02400039
024100** COMMUNICATIONS AREA FOR DB2                                  **02410039
024200******************************************************************02420039
024300     EXEC SQL                                                     02430039
024400          INCLUDE SQLCA                                           02440039
024500     END-EXEC.                                                    02450039
024600                                                                  02460039
024700******************************************************************02470039
024800** CARTON DIVERT TABLE                                          **02480039
024900******************************************************************02490039
025000     EXEC SQL                                                     02500039
025100          INCLUDE TSUCRDV                                         02510039
025200     END-EXEC.                                                    02520039
025300                                                                  02530039
025400******************************************************************02540039
025500** INBOUND CARTON LOCATION TABLE                                **02550039
025600******************************************************************02560039
025700     EXEC SQL                                                     02570039
025800          INCLUDE TSHUNLO                                         02580039
025900     END-EXEC.                                                    02590039
026000                                                                  02600039
026100******************************************************************02610039
026200** LABEL PRINT DATA TABLE                                       **02620039
026300******************************************************************02630039
026400     EXEC SQL                                                     02640039
026500          INCLUDE TLBPTDA                                         02650039
026600     END-EXEC.                                                    02660039
026700                                                                  02670039
026800******************************************************************02680039
026900** CARTON AUDIT TABLE                                           **02690039
027000******************************************************************02700039
027100     EXEC SQL                                                     02710039
027200          INCLUDE TSUATRN                                         02720039
027300     END-EXEC.                                                    02730039
027400                                                                  02740039
027410******************************************************************02741039
027420** CARTON AUDIT HEADER TABLE                                    **02742039
027430******************************************************************02743039
027440     EXEC SQL                                                     02744039
027450          INCLUDE TSUNAUD                                         02745039
027460     END-EXEC.                                                    02746039
027470                                                                  02747039
027480******************************************************************02748039
027490** PROMPTED CARTON AUDIT TABLE (SUT_PO_AUD_REQ)                 **02749039
027491******************************************************************02749139
027492     EXEC SQL                                                     02749239
027493          INCLUDE SUT00015                                        02749339
027494     END-EXEC.                                                    02749439
027495                                                                  02749539
027500******************************************************************02750039
027600** CARTON DIRECTIVE TRACKING TABLE (SUT_CART_DIRV_TRKG)         **02760039
027700******************************************************************02770039
027800     EXEC SQL                                                     02780039
027900          INCLUDE SUT00102                                        02790039
028000     END-EXEC.                                                    02800039
028100                                                                  02810039
028200******************************************************************02820039
028300** OUTBOUND CARTON TABLE (SUT_OTBND_CART)                       **02830039
028400******************************************************************02840039
028500     EXEC SQL                                                     02850039
028600          INCLUDE SUT00024                                        02860039
028700     END-EXEC.                                                    02870039
028800                                                                  02880039
028900******************************************************************02890039
029000** OUTBOUND CARTON LOCATION TABLE (SUT_OTBND_LOC)               **02900039
029100******************************************************************02910039
029200     EXEC SQL                                                     02920039
029300          INCLUDE SUT00027                                        02930039
029400     END-EXEC.                                                    02940039
029500                                                                  02950039
029600******************************************************************02960039
029700** TKRPRPM PARM TABLE                                           **02970039
029800******************************************************************02980039
029900     EXEC SQL                                                     02990039
030000          INCLUDE TKRPRPM                                         03000039
030100     END-EXEC.                                                    03010039
030200                                                                  03020039
030300******************************************************************03030039
030400*  MASTER CARTON CONTENTS TABLE (SUT_MSTR_SHIPT_CNT)              03040039
030500******************************************************************03050039
030600     EXEC SQL                                                     03060039
030700         INCLUDE SUT00099                                         03070039
030800     END-EXEC.                                                    03080039
030900                                                                  03090039
031000******************************************************************03100039
031100*  CHILD TO MASTER CARTON ACTION TYPE (SUT_ACTN_TYP)              03110039
031200******************************************************************03120039
031300     EXEC SQL                                                     03130039
031400         INCLUDE SUT00100                                         03140039
031500     END-EXEC.                                                    03150039
031600                                                                  03160039
032310******************************************************************03231039
032320*  OUTBOUND TRIP STATUS                                           03232039
032330******************************************************************03233039
032340     EXEC SQL                                                     03234039
032350         INCLUDE TSUOBTS                                          03235039
032360     END-EXEC.                                                    03236039
032370                                                                  03237039
032400******************************************************************03240039
032500* OUTBOUND CARTON LOCATION CURSOR                                 03250039
032600******************************************************************03260039
032700     EXEC SQL                                                     03270039
032800          DECLARE OTBND-LOC-CSR CURSOR  FOR                       03280039
032900           SELECT A.SCN_CDE                                       03290039
033000                , A.CRE_TMST                                      03300039
033100                , A.ACTV_CDE                                      03310039
033200                , A.CRE_USR_ID                                    03320039
033300                , A.LOC_NBR                                       03330039
033400                , A.CRE_TMST - B.FUNC_QTY HOURS                   03340039
033410                , A.OTBND_TRIP_ID                                 03341055
033500             FROM                                                 03350039
033600                   SUT_OTBND_LOC A                                03360039
033700                ,  TKRPRPM B                                      03370039
033800             WHERE SHIPT_UNT_ID          = :DK-SHIPT-UNT-ID       03380039
033900               AND NOT (SCN_CDE          IN ('RECV','USED','ERDM')03390039
034000                OR      CRE_USR_ID       = 'PCKUT074')            03400039
034100               AND B.SYS_PRC_FUNC_CDE    = 'TIMEZN'               03410039
034200               AND B.INTFC_SYS_CDE       = 'KHL'                  03420039
034300               AND B.LOC_ID              = A.LOC_NBR              03430039
034400            WITH UR                                               03440039
034500     END-EXEC.                                                    03450039
034600                                                                  03460039
034700******************************************************************03470039
034800* CARTON DIVERT CURSOR                                            03480039
034900******************************************************************03490039
035000     EXEC SQL                                                     03500039
035100          DECLARE DIVERT-CSR CURSOR  FOR                          03510039
035200           SELECT OPER_UNT_ID                                     03520039
035300                , DIVERT_TMST                                     03530039
035400                , DOOR_ID                                         03540039
035500             FROM                                                 03550039
035600                   TSUCRDV                                        03560039
035700             WHERE SHIPT_UNT_ID          = :DK-SHIPT-UNT-ID       03570039
035800            WITH UR                                               03580039
035900     END-EXEC.                                                    03590039
036000                                                                  03600039
036100******************************************************************03610039
036200* CARTON DIRECTIVE CURSOR                                         03620039
036300******************************************************************03630039
036400     EXEC SQL                                                     03640039
036500          DECLARE DIRECTIVE-CSR CURSOR FOR                        03650039
036600           SELECT OPER_UNT_ID                                     03660039
036700                , CRE_TMST                                        03670039
036800                , DIRV_RSN_CDE                                    03680039
036810                , CNVYR_PRC_ACTN_NM                               03681039
036900             FROM                                                 03690039
037000                   SUT_CART_DIRV_TRKG                             03700039
037100             WHERE SHIPT_UNT_ID          = :DK-SHIPT-UNT-ID       03710039
037200            WITH UR                                               03720039
037300     END-EXEC.                                                    03730039
037400                                                                  03740039
037500                                                                  03750039
037510******************************************************************03751039
037520* MASTER CARTON CURSOR                                            03752039
037530******************************************************************03753039
037540     EXEC SQL                                                     03754039
037550       DECLARE MSTR-CRTN-CSR CURSOR FOR                           03755039
037552         SELECT  A.CRE_TMST                                       03755240
037553              ,  B.ACTN_TYP_DES                                   03755340
037554           FROM  SUT_MSTR_SHIPT_CNT A                             03755440
037555                ,SUT_ACTN_TYP B                                   03755540
037556                                                                  03755640
037557          WHERE  A.CHLD_SHIPT_UNT_ID  =  :DK-SHIPT-UNT-ID         03755740
037558                 AND A.ACTN_TYP_CDE   = B.ACTN_TYP_CDE            03755840
037559          WITH UR                                                 03755940
037600     END-EXEC.                                                    03760039
037601                                                                  03760139
037602                                                                  03760239
037603******************************************************************03760339
037621******************************************************************03762139
037622* CARTON AUDIT CURSOR                                             03762239
037623******************************************************************03762339
037625     EXEC SQL                                                     03762539
037626          DECLARE AUDIT-DATA-CSR CURSOR FOR                       03762639
037627           SELECT T1.AUD_CNTL_NBR, T1.UNT_AUD_STRT_TMST           03762739
037628                , T1.UNT_AUD_STP_TMST, T1.OPER_UNT_ID             03762846
037629                , T1.AUD_TYP_CDE                                  03762939
037630                , IFNULL(T2.PROMPTED_AUDIT,'N') AS PROMPT_CDE     03763039
037631           FROM                                                   03763139
037632           (SELECT A.UNT_AUD_STRT_TMST                            03763239
037633                 , A.UNT_AUD_STP_TMST                             03763339
037634                 , B.OPER_UNT_ID                                  03763448
037635                 , A.AUD_CNTL_NBR                                 03763539
037636                 , B.AUD_TYP_CDE                                  03763639
037638              FROM TSUATRN  A                                     03763839
037639                 , TSUNAUD  B                                     03763939
037640             WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID-ORIG       03764039
037641               AND B.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03764139
037642           ) AS T1                                                03764239
037643           LEFT OUTER JOIN                                        03764339
037645           (SELECT A.AUD_CNTL_NBR                                 03764539
037646                 , 'Y' AS PROMPTED_AUDIT                          03764639
037648              FROM TSUATRN  A                                     03764839
037649                 , TSUNAUD  B                                     03764939
037650                 , SUT_PO_AUD_REQ C                               03765039
037651             WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID-ORIG       03765140
037652               AND B.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03765239
037653               AND C.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03765339
037654           ) AS T2                                                03765439
037655                ON T2.AUD_CNTL_NBR  = T1.AUD_CNTL_NBR             03765539
037656            WITH UR                                               03765639
037657     END-EXEC.                                                    03765739
037658                                                                  03765839
037659******************************************************************03765939
037660* LABEL PRINT CURSOR                                              03766039
037661******************************************************************03766139
037662     EXEC SQL                                                     03766239
037663          DECLARE LABEL-PRT-CSR CURSOR FOR                        03766339
037664           SELECT A.OPER_UNT_ID                                   03766439
037665                 ,A.CRE_TMST                                      03766539
037666                 ,A.LBL_PRT_BTCH_ID                               03766639
037667                 ,A.CART_ACTN_CDE                                 03766739
037668                 ,A.CART_LBL_TYP_CDE                              03766839
037669                 ,A.BRCDE_NBR                                     03766939
037670                 ,A.SU_MSSG_DAT_IND                               03767042
037671                 ,A.SU_FRE_ASTRA_IND                              03767142
037672                 ,A.MISDIR_OPER_UNT_ID                            03767254
037673             FROM                                                 03767354
037674                   TLBPTDA  A                                     03767454
037675             WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID-ORIG       03767554
037676            WITH UR                                               03767654
037677     END-EXEC.                                                    03767754
037678                                                                  03767854
037679                                                                  03767954
037680******************************************************************03768039
037700 PROCEDURE DIVISION.                                              03770039
037800******************************************************************03780039
037900                                                                  03790039
038000******************************************************************03800039
038100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     03810039
038200*      PROGRAM.                                                   03820039
038300******************************************************************03830039
038400 0000-PROGRAM-MAINLINE.                                           03840039
038500                                                                  03850039
038600     DISPLAY 'START OF PROGRAM SUKUT206'.                         03860040
038700                                                                  03870039
038800     PERFORM 1000-INITIALIZE.                                     03880039
038900                                                                  03890039
039000     PERFORM 2000-PROCESS-INPUT-FILE                              03900039
039100       UNTIL PS-EOF-INPUT-FILE.                                   03910039
039200                                                                  03920039
039300     MOVE PV-INPUT-READ-COUNT   TO PV-DISP-NBR.                   03930039
039400     DISPLAY ' '.                                                 03940039
039500     DISPLAY 'INPUT RECORD READ COUNT...: '                       03950039
039600             PV-DISP-NBR.                                         03960039
039700     MOVE PV-INPUT-PROCESS-COUNT TO PV-DISP-NBR.                  03970039
039800     DISPLAY ' '.                                                 03980039
039900     DISPLAY 'INPUT RECORD PROCESS COUNT: '                       03990039
040000             PV-DISP-NBR.                                         04000039
040100     MOVE PV-INPUT-BYPASS-COUNT TO PV-DISP-NBR.                   04010039
040200     DISPLAY ' '.                                                 04020039
040300     DISPLAY 'INPUT RECORD BYPASS COUNT.: '                       04030039
040400             PV-DISP-NBR.                                         04040039
040500     MOVE PV-OUTPUT-WRITE-COUNT TO PV-DISP-NBR.                   04050039
040600     DISPLAY 'OUTPUT RECORD WRITE COUNT.: '                       04060039
040700             PV-DISP-NBR.                                         04070039
040800                                                                  04080039
040900     CLOSE SU-DC-SHIP-SML-FILE                                    04090039
041000           SU-SML-ACTIVITY-FILE.                                  04100039
041100                                                                  04110039
041200     STOP RUN.                                                    04120039
041300                                                                  04130039
041400                                                                  04140039
041500***************************************************************** 04150039
041600*  INITIALIZATION PARAGRAPH                                       04160039
041700***************************************************************** 04170039
041800 1000-INITIALIZE.                                                 04180039
041900                                                                  04190039
042000     OPEN INPUT SU-DC-SHIP-SML-FILE                               04200039
042100         OUTPUT SU-SML-ACTIVITY-FILE.                             04210039
042200                                                                  04220039
042300     PERFORM 8000-READ-INPUT.                                     04230039
042400                                                                  04240039
042500     IF  PS-EOF-INPUT-FILE                                        04250039
042600         DISPLAY ' '                                              04260039
042700         DISPLAY '** INPUT FILE IS EMPTY **'                      04270039
042800     ELSE                                                         04280039
042900         MOVE SU117-OPER-UNT-ID TO DK-OPER-UNT-ID                 04290039
043000                                   PV-PREV-OPER-UNT-ID            04300039
043100         SET PS-DC-EXTRACT-NO TO TRUE                             04310039
043200         PERFORM 7000-CHECK-FOR-EXTRACT                           04320039
043300     END-IF.                                                      04330039
043400                                                                  04340039
043500                                                                  04350039
043600******************************************************************04360039
043700* PROCESS THE INPUT RECORD                                        04370039
043800******************************************************************04380039
043900 2000-PROCESS-INPUT-FILE.                                         04390039
044000                                                                  04400039
044100     IF  SU117-OPER-UNT-ID = PV-PREV-OPER-UNT-ID                  04410039
044200         IF  PS-DC-EXTRACT-YES                                    04420039
044300             ADD +1 TO PV-INPUT-PROCESS-COUNT                     04430039
044400             PERFORM 2400-PROCESS-RECORD                          04440039
044500         ELSE                                                     04450039
044600             ADD +1 TO PV-INPUT-BYPASS-COUNT                      04460039
044700         END-IF                                                   04470039
044800     ELSE                                                         04480039
044900         MOVE SU117-OPER-UNT-ID TO DK-OPER-UNT-ID                 04490039
045000                                   PV-PREV-OPER-UNT-ID            04500039
045100         SET PS-DC-EXTRACT-NO TO TRUE                             04510039
045200         PERFORM 7000-CHECK-FOR-EXTRACT                           04520039
045300         IF  PS-DC-EXTRACT-YES                                    04530039
045400             ADD +1 TO PV-INPUT-PROCESS-COUNT                     04540039
045500             PERFORM 2400-PROCESS-RECORD                          04550039
045600         ELSE                                                     04560039
045700             ADD +1 TO PV-INPUT-BYPASS-COUNT                      04570039
045800         END-IF                                                   04580039
045900     END-IF.                                                      04590039
046000                                                                  04600039
046100     PERFORM 8000-READ-INPUT.                                     04610039
046200                                                                  04620039
046300******************************************************************04630039
046400* PROCESS THE INPUT RECORD TO THE OUTPUT FILE                     04640039
046500******************************************************************04650039
046600 2400-PROCESS-RECORD.                                             04660039
046700                                                                  04670039
046800     PERFORM 2800-CREATE-FROM-INPUT-RECORD.                       04680039
046900                                                                  04690039
047000     PERFORM 3200-CREATE-FROM-OTBND-CART.                         04700039
047100                                                                  04710039
047200     PERFORM 3600-CREATE-FROM-OTBND-LOC.                          04720039
047300                                                                  04730039
047400     PERFORM 4000-CREATE-FROM-CARTON-DIVERT.                      04740039
047500                                                                  04750039
047900     PERFORM 4400-CREATE-FROM-CRTN-DRCTV.                         04790039
048000                                                                  04800039
048100     PERFORM 4800-CREATE-FROM-MSTR-CARTON                         04810044
048410                                                                  04841039
048500     IF  SUT00024-ORIG-CART-ID = DK-SHIPT-UNT-ID                  04850039
048600     OR  SUT00024-ORIG-CART-ID = 0                                04860039
048700         NEXT SENTENCE                                            04870039
048800     ELSE                                                         04880039
048820         MOVE SUT00024-ORIG-CART-ID TO DK-SHIPT-UNT-ID-ORIG       04882039
048830         PERFORM 5200-CREATE-FROM-AUDIT-DATA                      04883039
048900         PERFORM 5400-CREATE-FROM-LABEL-PRINT                     04890039
049000*        PERFORM 5800-CREATE-FROM-INBND-LOC                       04900039
049100     END-IF.                                                      04910039
049200                                                                  04920039
049300                                                                  04930039
049400******************************************************************04940039
049500* THIS PARAGRAPH WILL TAKE DATA FROM THE INPUT RECORD AND        *04950039
049600* CREATE OUTPUT RECORDS BASED ON FIELDS THAT INDICATE ACTIVITY   *04960039
049700* AGAINST THE CARTON.                                            *04970039
049800******************************************************************04980039
049900 2800-CREATE-FROM-INPUT-RECORD.                                   04990039
050000                                                                  05000039
050100     MOVE SU117-SML-NBR        TO PV-FORMAT-SML-5-22.             05010039
050200     MOVE SU117-OPER-UNT-ID    TO SU173-ACTIVITY-AT-DC-NBR.       05020039
050300     MOVE PV-FORMAT-SML-NBR    TO SU173-CARTON-ID.                05030039
050400     MOVE 'TRAILER SHIP'       TO SU173-CARTON-ACTIVITY.          05040039
050500     MOVE SU117-TRIP-SHIP-TMST TO PV-HOLD-TMST.                   05050039
050600     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME.                        05060039
050700     PERFORM 8200-WRITE-OUTPUT.                                   05070039
050800                                                                  05080039
050900                                                                  05090039
051000******************************************************************05100039
051100* GENERATE ACTIVITY DATA FROM OUTBOUND CARTON TABLE INFO         *05110039
051200******************************************************************05120039
051300 3200-CREATE-FROM-OTBND-CART.                                     05130039
051400                                                                  05140039
051500     MOVE SU117-SML-NBR TO DK-SHIPT-UNT-ID.                       05150039
051600     SET PS-OTBND-CART-NOT-FOUND TO TRUE.                         05160039
051700     PERFORM 3220-SELECT-OTBND-CART.                              05170039
051800     IF  PS-OTBND-CART-FOUND                                      05180039
051900         PERFORM 3240-FORMAT-OTBN-CART-DATA                       05190039
052000     END-IF.                                                      05200039
052100                                                                  05210039
052200******************************************************************05220039
052300* SELECT FROM OUTBOUND CARTON TABLE                              *05230039
052400******************************************************************05240039
052500 3220-SELECT-OTBND-CART.                                          05250039
052600                                                                  05260039
052700     EXEC SQL                                                     05270039
052800         SELECT  A.CART_SRC_CDE                                   05280039
052900              ,  A.CRE_DTE                                        05290039
053000              ,  A.CRE_TM                                         05300039
053100              ,  A.CRE_PGM_NM                                     05310039
053200              ,  A.ORGN_LOC_NBR                                   05320039
053300              ,  A.ORIG_CART_ID                                   05330039
053400              ,  TIMESTAMP(A.CRE_DTE,A.CRE_TM)                    05340039
053500              ,  TIMESTAMP(A.CRE_DTE,A.CRE_TM) - B.FUNC_QTY HOURS 05350039
053600           INTO  :SUT00024-CART-SRC-CDE                           05360039
053700              ,  :SUT00024-CRE-DTE                                05370039
053800              ,  :SUT00024-CRE-TM                                 05380039
053900              ,  :SUT00024-CRE-PGM-NM                             05390039
054000              ,  :SUT00024-ORGN-LOC-NBR                           05400039
054100              ,  :SUT00024-ORIG-CART-ID                           05410039
054200              ,  :PV-HOLD-CRE-TMST                                05420039
054300              ,  :PV-HOLD-CRE-TIMEZN-TMST                         05430039
054400           FROM  SUT_OTBND_CART A                                 05440039
054500              ,  TKRPRPM B                                        05450039
054600           WHERE A.SHIPT_UNT_ID        = :DK-SHIPT-UNT-ID         05460039
054700             AND B.SYS_PRC_FUNC_CDE    = 'TIMEZN'                 05470039
054800             AND B.INTFC_SYS_CDE       = 'KHL'                    05480039
054900             AND B.LOC_ID              = A.ORGN_LOC_NBR           05490039
055000         WITH UR                                                  05500039
055100     END-EXEC                                                     05510039
055200                                                                  05520039
055300     EVALUATE TRUE                                                05530039
055400         WHEN SQLCODE = ZERO                                      05540039
055500              SET PS-OTBND-CART-FOUND TO TRUE                     05550039
055600         WHEN SQLCODE = +100                                      05560039
055700              SET PS-OTBND-CART-NOT-FOUND TO TRUE                 05570039
055800         WHEN SQLWARN0 NOT = SPACES                               05580039
055900         WHEN SQLCODE < ZERO                                      05590039
056000         WHEN SQLCODE > ZERO                                      05600039
056100             MOVE '3220-SELECT-OTBND-CART         '               05610039
056200                             TO PV-ABEND-PARAGRAPH                05620039
056300             MOVE 'SELECT OUTBOUND CARTON DATA    '               05630039
056400                             TO PV-ABEND-OPER-MESSAGE-1           05640039
056500             MOVE 'SUT_OTBND_CART' TO PV-ABEND-TABLE-1            05650039
056600             DISPLAY 'SUKUT206 - PARAGRAPH: '                     05660039
056700                     '3220-SELECT-OTBND-CART'                     05670039
056800             DISPLAY 'SML NUMBER: '                               05680039
056900                     PV-FORMAT-SML-NBR                            05690039
057000             PERFORM 9100-SQL-ABEND                               05700039
057100                                                                  05710039
057200     END-EVALUATE.                                                05720039
057300                                                                  05730039
057400                                                                  05740039
057500******************************************************************05750039
057600* THIS WILL CONTROL THE FORMAT OF THE DATA FROM THE OUTBOUND     *05760039
057700* CARTON TABLE BASED ON THE CARTON SOURCE CODE.                  *05770039
057800******************************************************************05780039
057900 3240-FORMAT-OTBN-CART-DATA.                                      05790039
058000                                                                  05800039
058100     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        05810039
058200                                                                  05820039
058300     IF  SUT00024-CART-SRC-CDE = 'ASN'                            05830039
058400         PERFORM 3260-FORMAT-ASN-CART-DATA                        05840039
058500     END-IF.                                                      05850039
058600                                                                  05860039
058700     IF  SUT00024-CART-SRC-CDE = 'P2L'                            05870039
058800     OR  SUT00024-CART-SRC-CDE = 'JWL'                            05880039
058900         PERFORM 3280-FORMAT-P2L-CART-DATA                        05890039
059000     END-IF.                                                      05900039
059100                                                                  05910039
059200     IF  SUT00024-CART-SRC-CDE = '3WD'                            05920039
059300         PERFORM 3300-FORMAT-3WD-CART-DATA                        05930039
059400     END-IF.                                                      05940039
059500                                                                  05950039
059600     IF  SUT00024-CART-SRC-CDE = 'CPS'                            05960039
059700         PERFORM 3320-FORMAT-CPS-CART-DATA                        05970039
059800     END-IF.                                                      05980039
059900                                                                  05990039
060000     IF  SUT00024-CART-SRC-CDE = 'DMG'                            06000039
060100         PERFORM 3340-FORMAT-DMG-CART-DATA                        06010039
060200     END-IF.                                                      06020039
060300                                                                  06030039
060400     IF  SUT00024-CART-SRC-CDE = 'FXR'                            06040039
060500         PERFORM 3360-FORMAT-FXR-CART-DATA                        06050039
060600     END-IF.                                                      06060039
060700                                                                  06070039
060800     IF  SUT00024-CART-SRC-CDE = 'RDM'                            06080039
060900         PERFORM 3380-FORMAT-RDM-CART-DATA                        06090039
061000     END-IF.                                                      06100039
061100                                                                  06110039
061200     IF  SUT00024-CART-SRC-CDE = 'SMO'                            06120039
061300         PERFORM 3400-FORMAT-SMO-CART-DATA                        06130039
061400     END-IF.                                                      06140039
061500                                                                  06150039
061600     IF  SUT00024-CART-SRC-CDE = 'WMC'                            06160039
061700     OR  SUT00024-CART-SRC-CDE = 'WMU'                            06170039
061800         PERFORM 3420-FORMAT-EFC-CART-DATA                        06180039
061900     END-IF.                                                      06190039
062000                                                                  06200039
062100     IF  SU173-CARTON-ACTIVITY = ' '                              06210039
062200         DISPLAY 'NO HANDLING FOR OUTBOUND CARTON SOURCE CODE: '  06220039
062300                 SUT00024-CART-SRC-CDE                            06230039
062400         DISPLAY 'SML NUMBER: ' PV-FORMAT-SML-NBR                 06240039
062500     ELSE                                                         06250039
062600         MOVE SUT00024-ORGN-LOC-NBR TO                            06260039
062700              SU173-ACTIVITY-AT-DC-NBR                            06270039
062800         PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                     06280039
062900         PERFORM 8200-WRITE-OUTPUT                                06290039
063000     END-IF.                                                      06300039
063100                                                                  06310039
063200                                                                  06320039
063300******************************************************************06330039
063400* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *06340039
063500* INFO FOR THE ASN SOURCE CODE.                                  *06350039
063600******************************************************************06360039
063700 3260-FORMAT-ASN-CART-DATA.                                       06370039
063800                                                                  06380039
063900     IF  SUT00024-CRE-PGM-NM = 'SUKRF502'                         06390039
064000         MOVE 'RF CHECKIN' TO SU173-CARTON-ACTIVITY               06400039
064100     ELSE                                                         06410039
064200         IF  SUT00024-CRE-PGM-NM = 'SUKCS771'                     06420039
064300             MOVE 'PNA CHECKIN' TO SU173-CARTON-ACTIVITY          06430039
064400         ELSE                                                     06440039
064500             MOVE 'UNKNOWN CHECKIN' TO SU173-CARTON-ACTIVITY      06450039
064600         END-IF                                                   06460039
064700     END-IF.                                                      06470039
064800                                                                  06480039
064900     MOVE PV-HOLD-CRE-TMST     TO PV-HOLD-TMST.                   06490039
065000                                                                  06500039
065100                                                                  06510039
065200******************************************************************06520039
065300* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *06530039
065400* INFO FOR THE PACK-TO-LIGHT/JEWELRY SOURCE CODE.                *06540039
065500******************************************************************06550039
065600 3280-FORMAT-P2L-CART-DATA.                                       06560039
065700                                                                  06570039
065800     IF  SUT00024-CART-SRC-CDE = 'JWL'                            06580039
065900         MOVE 'OPEN IN JWL P2L' TO SU173-CARTON-ACTIVITY          06590039
066000     ELSE                                                         06600039
066100         MOVE 'OPEN IN P2L    ' TO SU173-CARTON-ACTIVITY          06610039
066200     END-IF.                                                      06620039
066300                                                                  06630039
066400     MOVE PV-HOLD-CRE-TIMEZN-TMST TO PV-HOLD-TMST.                06640039
066500                                                                  06650039
066600                                                                  06660039
066700******************************************************************06670039
066800* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *06680039
066900* INFO FOR THE THIRD PARTY CREATED SML SOURCE CODE.              *06690039
067000******************************************************************06700039
067100 3300-FORMAT-3WD-CART-DATA.                                       06710039
067200                                                                  06720039
067300     MOVE '3RD PARTY CREATE' TO SU173-CARTON-ACTIVITY.            06730039
067400                                                                  06740039
067500     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       06750039
067600                                                                  06760039
067700                                                                  06770039
067800******************************************************************06780039
067900* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *06790039
068000* INFO FOR THE MANUAL CASEPACK SPLIT SOURCE CODE.                *06800039
068100******************************************************************06810039
068200 3320-FORMAT-CPS-CART-DATA.                                       06820039
068300                                                                  06830039
068400     MOVE 'MANUAL CHECKIN' TO SU173-CARTON-ACTIVITY.              06840039
068500                                                                  06850039
068600     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       06860039
068700                                                                  06870039
068800                                                                  06880039
068900******************************************************************06890039
069000* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *06900039
069100* INFO FOR THE DAMAGED CARTON SOURCE CODE.                       *06910039
069200******************************************************************06920039
069300 3340-FORMAT-DMG-CART-DATA.                                       06930039
069400                                                                  06940039
069500     MOVE 'DAMAGED CARTON CREATE' TO SU173-CARTON-ACTIVITY.       06950039
069600                                                                  06960039
069700     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       06970039
069800                                                                  06980039
069900                                                                  06990039
070000******************************************************************07000039
070100* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *07010039
070200* INFO FOR THE FAST TRANSFER SOURCE CODE.                        *07020039
070300******************************************************************07030039
070400 3360-FORMAT-FXR-CART-DATA.                                       07040039
070500                                                                  07050039
070600     MOVE 'FAST TRANSFER CARTON CREATE' TO SU173-CARTON-ACTIVITY. 07060039
070700                                                                  07070039
070800     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       07080039
070900                                                                  07090039
071000                                                                  07100039
071100******************************************************************07110039
071200* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *07120039
071300* INFO FOR THE CENTRAL STOCK SOURCE CODE.                        *07130039
071400******************************************************************07140039
071500 3380-FORMAT-RDM-CART-DATA.                                       07150039
071600                                                                  07160039
071700     MOVE 'CENTRAL STOCK CARTON CREATE' TO SU173-CARTON-ACTIVITY. 07170039
071800                                                                  07180039
071900     MOVE PV-HOLD-CRE-TIMEZN-TMST TO PV-HOLD-TMST.                07190039
072000                                                                  07200039
072100                                                                  07210039
072200******************************************************************07220039
072300* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *07230039
072400* INFO FOR THE PACK-BY-STORE SMOOTHING SOURCE CODE.              *07240039
072500******************************************************************07250039
072600 3400-FORMAT-SMO-CART-DATA.                                       07260039
072700                                                                  07270039
072800     MOVE 'PBS SMOOTHING CARTON CREATE' TO SU173-CARTON-ACTIVITY. 07280039
072900                                                                  07290039
073000     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       07300039
073100                                                                  07310039
073200                                                                  07320039
073300******************************************************************07330039
073400* THIS WILL FORMAT THE DATA FROM THE OUTBOUND CARTON TABLE       *07340039
073500* INFO FOR THE EFC GENERATED SOURCE CODE.                        *07350039
073600******************************************************************07360039
073700 3420-FORMAT-EFC-CART-DATA.                                       07370039
073800                                                                  07380039
073900     MOVE 'EFC CREATED CARTON' TO SU173-CARTON-ACTIVITY.          07390039
074000                                                                  07400039
074100     MOVE PV-HOLD-CRE-TMST TO PV-HOLD-TMST.                       07410039
074200                                                                  07420039
074300                                                                  07430039
074400******************************************************************07440039
074500* THIS WILL CONTROL THE FORMATTING OF DATA FROM THE OUTBOUND     *07450039
074600* LOCATION TABLE BASED ON THE SCAN CODE.                         *07460039
074700******************************************************************07470039
074800 3600-CREATE-FROM-OTBND-LOC.                                      07480039
074900                                                                  07490039
075000     SET PS-NOT-END-OF-CURSOR TO TRUE.                            07500039
075100                                                                  07510039
075200     PERFORM 3610-OPEN-OTBND-LOC-CSR.                             07520039
075300     PERFORM 3620-FETCH-OTBND-LOC-CSR.                            07530039
075400                                                                  07540039
075500     PERFORM 3640-PROCESS-OTBND-LOC-CSR                           07550039
075600       UNTIL PS-END-OF-CURSOR.                                    07560039
075700                                                                  07570039
075800     PERFORM 3630-CLOSE-OTBND-LOC-CSR.                            07580039
075900                                                                  07590039
076000                                                                  07600039
076100******************************************************************07610039
076200* OPEN THE OUTBOUND CARTON LOCATION TABLE CURSOR                 *07620039
076300******************************************************************07630039
076400 3610-OPEN-OTBND-LOC-CSR.                                         07640039
076500                                                                  07650039
076600     PERFORM WITH TEST AFTER                                      07660039
076700       VARYING PV-COUNTER FROM 1 BY 1                             07670039
076800         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    07680039
076900                SQLCODE = ZERO)                                   07690039
077000                                                                  07700039
077100         EXEC SQL                                                 07710039
077200              OPEN OTBND-LOC-CSR                                  07720039
077300         END-EXEC                                                 07730039
077400                                                                  07740039
077500         EVALUATE TRUE                                            07750039
077600             WHEN SQLCODE = +0                                    07760039
077700             WHEN SQLCODE = -904                                  07770039
077800             WHEN SQLCODE = -911                                  07780039
077900             WHEN SQLCODE = -913                                  07790039
078000                 CONTINUE                                         07800039
078100             WHEN SQLWARN0 NOT EQUAL SPACE                        07810039
078200             WHEN SQLCODE NOT EQUAL ZERO                          07820039
078300                 MOVE '3610-OPEN-OTBND-LOC-CSR'                   07830039
078400                                      TO PV-ABEND-PARAGRAPH       07840039
078500                 MOVE 'ERROR OPENING OUTBOUND LOC CURSOR'         07850039
078600                                      TO PV-ABEND-OPER-MESSAGE-1  07860039
078700                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         07870039
078800                         PV-FORMAT-SML-NBR                        07880039
078900                                         DELIMITED BY SIZE        07890039
079000                                   INTO PV-ABEND-OPER-MESSAGE-2   07900039
079100                 MOVE 'SUT_OTBND_LOC' TO PV-ABEND-TABLE-1         07910039
079200                 PERFORM 9100-SQL-ABEND                           07920039
079300         END-EVALUATE                                             07930039
079400     END-PERFORM.                                                 07940039
079500                                                                  07950039
079600     IF  PV-COUNTER > PC-MAX-RETRIES                              07960039
079700         MOVE '3610-OPEN-OTBND-LOC-CSR'                           07970039
079800                                      TO PV-ABEND-PARAGRAPH       07980039
079900         MOVE 'MAX RETRIES ERROR OPENING OUTBOUND LOC CURSOR'     07990039
080000                                      TO PV-ABEND-OPER-MESSAGE-1  08000039
080100         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 08010039
080200                PV-FORMAT-SML-NBR                                 08020039
080300                                DELIMITED BY SIZE                 08030039
080400                                   INTO PV-ABEND-OPER-MESSAGE-2   08040039
080500         MOVE 'SUT_OTBND_LOC' TO PV-ABEND-TABLE-1                 08050039
080600         PERFORM 9100-SQL-ABEND                                   08060039
080700     END-IF.                                                      08070039
080800                                                                  08080039
080900                                                                  08090039
081000******************************************************************08100039
081100* FETCH THE OTBOUND LOCATION TABLE CURSOR                        *08110039
081200******************************************************************08120039
081300 3620-FETCH-OTBND-LOC-CSR.                                        08130039
081400                                                                  08140039
081500     EXEC SQL                                                     08150039
081600          FETCH OTBND-LOC-CSR                                     08160039
081700           INTO :SUT00027-SCN-CDE                                 08170039
081800              , :SUT00027-CRE-TMST                                08180039
081900              , :SUT00027-ACTV-CDE                                08190039
082000              , :SUT00027-CRE-USR-ID                              08200039
082100              , :SUT00027-LOC-NBR                                 08210039
082200              , :PV-HOLD-CRE-TIMEZN-TMST                          08220039
082300              , :SUT00027-OTBND-TRIP-ID :PV-NULL-IND-1            08230039
082400     END-EXEC.                                                    08240039
082500                                                                  08250039
082600     EVALUATE TRUE                                                08260039
082700       WHEN SQLCODE = ZERO                                        08270039
082800       WHEN SQLCODE = -305                                        08280039
082900           IF  PV-NULL-IND-1 = -1                                 08290039
083000               MOVE ZEROS TO SUT00027-OTBND-TRIP-ID               08300039
083100           END-IF                                                 08310039
083200       WHEN SQLCODE = +100                                        08320039
083300           SET PS-END-OF-CURSOR      TO TRUE                      08330039
083400       WHEN SQLWARN0 NOT EQUAL SPACE                              08340039
083500       WHEN SQLCODE NOT EQUAL ZERO                                08350039
083600           MOVE '3620-FETCH-OTBND-LOC-CSR'                        08360039
083700                                     TO PV-ABEND-PARAGRAPH        08370039
083800           MOVE 'FETCH OUTBOUND LOC CURSOR'                       08380039
083900                                     TO PV-ABEND-OPER-MESSAGE-1   08390039
084000           STRING 'SML NUMBER: '  DELIMITED BY SIZE               08400039
084100                  PV-FORMAT-SML-NBR                               08410039
084200                                  DELIMITED BY SIZE               08420039
084300                                   INTO PV-ABEND-OPER-MESSAGE-2   08430039
084400           MOVE 'SUT_OTBND_LOC' TO PV-ABEND-TABLE-1               08440039
084500           PERFORM 9100-SQL-ABEND                                 08450039
084600     END-EVALUATE.                                                08460039
084700                                                                  08470039
084800                                                                  08480039
084900******************************************************************08490039
085000* CLOSE OUTBOUND LOCATION TABLE CURSOR                           *08500039
085100******************************************************************08510039
085200 3630-CLOSE-OTBND-LOC-CSR.                                        08520039
085300                                                                  08530039
085400     PERFORM WITH TEST AFTER                                      08540039
085500       VARYING PV-COUNTER FROM 1 BY 1                             08550039
085600         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    08560039
085700                SQLCODE = ZERO)                                   08570039
085800                                                                  08580039
085900         EXEC SQL                                                 08590039
086000              CLOSE OTBND-LOC-CSR                                 08600039
086100         END-EXEC                                                 08610039
086200                                                                  08620039
086300         EVALUATE TRUE                                            08630039
086400             WHEN SQLCODE = +0                                    08640039
086500             WHEN SQLCODE = -904                                  08650039
086600             WHEN SQLCODE = -911                                  08660039
086700             WHEN SQLCODE = -913                                  08670039
086800                 CONTINUE                                         08680039
086900             WHEN SQLWARN0 NOT EQUAL SPACE                        08690039
087000             WHEN SQLCODE NOT EQUAL ZERO                          08700039
087100                 MOVE '3630-CLOSE-OTBND-LOC-CSR'                  08710039
087200                                      TO PV-ABEND-PARAGRAPH       08720039
087300                 MOVE 'ERROR CLOSE OUTBOUND LOC CURSOR'           08730039
087400                                      TO PV-ABEND-OPER-MESSAGE-1  08740039
087500                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         08750039
087600                         PV-FORMAT-SML-NBR                        08760039
087700                                         DELIMITED BY SIZE        08770039
087800                                   INTO PV-ABEND-OPER-MESSAGE-2   08780039
087900                 MOVE 'SUT_OTBND_LOC' TO PV-ABEND-TABLE-1         08790039
088000                 PERFORM 9100-SQL-ABEND                           08800039
088100         END-EVALUATE                                             08810039
088200     END-PERFORM.                                                 08820039
088300                                                                  08830039
088400     IF  PV-COUNTER > PC-MAX-RETRIES                              08840039
088500         MOVE '3630-CLOSE-OTBND-LOC-CSR'                          08850039
088600                                      TO PV-ABEND-PARAGRAPH       08860039
088700         MOVE 'MAX RETRIES ERROR CLOSE OUTBOUND LOC CURSOR'       08870039
088800                                      TO PV-ABEND-OPER-MESSAGE-1  08880039
088900         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 08890039
089000                PV-FORMAT-SML-NBR                                 08900039
089100                                DELIMITED BY SIZE                 08910039
089200                                   INTO PV-ABEND-OPER-MESSAGE-2   08920039
089300         MOVE 'SUT_OTBND_LOC' TO PV-ABEND-TABLE-1                 08930039
089400         PERFORM 9100-SQL-ABEND                                   08940039
089500     END-IF.                                                      08950039
089600                                                                  08960039
089700                                                                  08970039
089800******************************************************************08980039
089900* CONTROL THE PROCESSING OF THE OUTBOUND LOCATION TABLE CURSOR   *08990039
090000* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *09000039
090100******************************************************************09010039
090200 3640-PROCESS-OTBND-LOC-CSR.                                      09020039
090300                                                                  09030039
090400     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        09040039
090500                                                                  09050039
090600     IF  SUT00027-SCN-CDE = 'LTP'                                 09060039
090700         MOVE PV-HOLD-CRE-TIMEZN-TMST TO PV-HOLD-TMST             09070039
090800         IF  SUT00024-CART-SRC-CDE = 'JWL'                        09080039
090900             MOVE 'CLOSE IN JWL P2L' TO SU173-CARTON-ACTIVITY     09090039
091000         ELSE                                                     09100039
091100             MOVE 'CLOSE IN P2L' TO SU173-CARTON-ACTIVITY         09110039
091200         END-IF                                                   09120039
091300     END-IF.                                                      09130039
091400                                                                  09140039
091500     IF  SUT00027-SCN-CDE = 'SHOF'                                09150039
091600         MOVE SUT00027-CRE-TMST TO PV-HOLD-TMST                   09160039
091700         IF  SUT00027-OTBND-TRIP-ID > 0                           09170039
091800             MOVE SUT00027-OTBND-TRIP-ID TO DK-TRIP-ID            09180039
091900             SET PS-DOOR-NOT-FOUND TO TRUE                        09190039
092000             PERFORM 3650-FIND-DOOR-NBR                           09200039
092100             IF  PS-DOOR-FOUND                                    09210039
092200                 STRING 'SCAN OFF TRLR AT DOOR '                  09220039
092300                                             DELIMITED BY SIZE    09230039
092400                        SUOBTS-DOOR-ID DELIMITED BY SIZE          09240039
092500                        INTO SU173-CARTON-ACTIVITY                09250039
092600             ELSE                                                 09260039
092700                 MOVE 'SCAN OFF TRLR AT DOOR UNKNOWN' TO          09270039
092800                       SU173-CARTON-ACTIVITY                      09280039
092900             END-IF                                               09290039
093000         ELSE                                                     09300039
093100             MOVE 'SCAN OFF TRLR AT DOOR UNKNOWN' TO              09310039
093200                   SU173-CARTON-ACTIVITY                          09320039
093300         END-IF                                                   09330039
093400     END-IF.                                                      09340039
093500                                                                  09350039
093600     IF  SUT00027-SCN-CDE = 'SHON'                                09360051
093700         MOVE SUT00027-CRE-TMST TO PV-HOLD-TMST                   09370039
093800         IF  SUT00027-OTBND-TRIP-ID > 0                           09380039
093900             MOVE SUT00027-OTBND-TRIP-ID TO DK-TRIP-ID            09390039
094000             SET PS-DOOR-NOT-FOUND TO TRUE                        09400039
094100             PERFORM 3650-FIND-DOOR-NBR                           09410039
094200             IF  PS-DOOR-FOUND                                    09420039
094300                 STRING 'SCAN ON TRLR AT DOOR '                   09430039
094400                                             DELIMITED BY SIZE    09440039
094500                        SUOBTS-DOOR-ID DELIMITED BY SIZE          09450039
094600                        INTO SU173-CARTON-ACTIVITY                09460039
094700             ELSE                                                 09470039
094800                 MOVE 'SCAN ON TRLR AT DOOR UNKNOWN' TO           09480039
094900                       SU173-CARTON-ACTIVITY                      09490039
095000             END-IF                                               09500039
095100         ELSE                                                     09510039
095200             MOVE 'SCAN ON TRLR AT DOOR UNKNOWN' TO               09520039
095300                   SU173-CARTON-ACTIVITY                          09530039
095400         END-IF                                                   09540039
095500     END-IF.                                                      09550039
095600                                                                  09560039
095700     IF  SUT00027-SCN-CDE = 'NUSE'                                09570039
095800         MOVE SUT00027-CRE-TMST TO PV-HOLD-TMST                   09580039
095900         MOVE 'SML NOT USED SCAN' TO                              09590039
096000              SU173-CARTON-ACTIVITY                               09600039
096100     END-IF.                                                      09610039
096200                                                                  09620039
096300     IF  SUT00027-SCN-CDE = 'RCLM'                                09630039
096400         MOVE SUT00027-CRE-TMST TO PV-HOLD-TMST                   09640039
096500         MOVE 'SML RECLAIMED SCAN' TO                             09650039
096600              SU173-CARTON-ACTIVITY                               09660039
096700     END-IF.                                                      09670039
096800                                                                  09680039
096900     IF  SU173-CARTON-ACTIVITY = ' '                              09690039
097000         DISPLAY 'NO HANDLING FOR OUTBOUND LOC SCAN CODE: '       09700039
097100                 SUT00027-SCN-CDE                                 09710039
097200         DISPLAY 'SML NUMBER: ' PV-FORMAT-SML-NBR                 09720039
097300     ELSE                                                         09730039
097400         MOVE SUT00027-LOC-NBR TO                                 09740039
097500              SU173-ACTIVITY-AT-DC-NBR                            09750039
097600         PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                     09760039
097700         PERFORM 8200-WRITE-OUTPUT                                09770039
097800     END-IF.                                                      09780039
097900                                                                  09790039
098000     PERFORM 3620-FETCH-OTBND-LOC-CSR.                            09800039
098100                                                                  09810039
098200                                                                  09820039
098300******************************************************************09830039
098400* GET THE DOOR NUMBER THAT THE TRAILER WAS IN AT THE TIME THE    *09840039
098500* CARTON WAS SCANNED OFF OR ON THE TRAILER.                      *09850039
098600******************************************************************09860039
098700 3650-FIND-DOOR-NBR.                                              09870039
098800                                                                  09880039
098900     EXEC SQL                                                     09890039
099000         SELECT OTBND_STAT_TMST                                   09900039
099100              , DOOR_ID                                           09910039
099200           INTO :SUOBTS-OTBND-STAT-TMST                           09920039
099300              , :SUOBTS-DOOR-ID                                   09930039
099400           FROM TSUOBTS                                           09940039
099500         WHERE OTBND_TRIP_ID     = :DK-TRIP-ID                    09950039
099600           AND OTBND_STAT_TMST  <= :SUT00027-CRE-TMST             09960039
099700           AND TRIP_STAT_CDE     = 'DO'                           09970039
099800         ORDER BY OTBND_STAT_TMST DESC                            09980039
099900         WITH UR                                                  09990039
100000     END-EXEC                                                     10000039
100100                                                                  10010039
100200     EVALUATE TRUE                                                10020039
100300         WHEN SQLCODE = ZERO                                      10030039
100400         WHEN SQLCODE = -811                                      10040039
100500             SET PS-DOOR-FOUND TO TRUE                            10050039
100600         WHEN SQLCODE = +100                                      10060039
100700             SET PS-DOOR-NOT-FOUND TO TRUE                        10070039
100800         WHEN SQLWARN0 NOT = SPACES                               10080039
100900         WHEN SQLCODE < ZERO                                      10090039
101000         WHEN SQLCODE > ZERO                                      10100039
101100             MOVE '3650-FIND-DOOR-NBR'                            10110039
101200                                  TO PV-ABEND-PARAGRAPH           10120039
101300             MOVE 'SELECT OF OUTBOUND TRIP STATUS TABLE'          10130039
101400                                  TO PV-ABEND-OPER-MESSAGE-1      10140039
101500             MOVE DK-TRIP-ID TO PV-DISP-TRIP-ID                   10150039
101600             STRING 'SML NUMBER: '  DELIMITED BY SIZE             10160039
101700                     PV-FORMAT-SML-NBR                            10170039
101800                                     DELIMITED BY SIZE            10180039
101900                               INTO PV-ABEND-OPER-MESSAGE-2       10190039
102000             STRING 'TRIP NUMBER: '  DELIMITED BY SIZE            10200039
102100                     PV-DISP-TRIP-ID                              10210039
102200                                     DELIMITED BY SIZE            10220039
102300                               INTO PV-ABEND-OPER-MESSAGE-3       10230039
102400             MOVE 'TSUOBTS' TO PV-ABEND-TABLE-1                   10240039
102500             PERFORM 9100-SQL-ABEND                               10250039
102600                                                                  10260039
102700     END-EVALUATE.                                                10270039
102800                                                                  10280039
102900                                                                  10290039
103000******************************************************************10300039
103100* THIS WILL CONTROL THE FORMATTING OF DATA FROM THE CARTON       *10310039
103200* DIVERT TABLE.                                                  *10320039
103300******************************************************************10330039
103400 4000-CREATE-FROM-CARTON-DIVERT.                                  10340039
103500                                                                  10350039
103600     SET PS-NOT-END-OF-CURSOR TO TRUE.                            10360039
103700                                                                  10370039
103800     PERFORM 4010-OPEN-DIVERT-CSR.                                10380039
103900     PERFORM 4020-FETCH-DIVERT-CSR.                               10390039
104000                                                                  10400039
104100     PERFORM 4040-PROCESS-DIVERT-CSR                              10410039
104200       UNTIL PS-END-OF-CURSOR.                                    10420039
104300                                                                  10430039
104400     PERFORM 4030-CLOSE-DIVERT-CSR.                               10440039
104500                                                                  10450039
104600                                                                  10460039
104700******************************************************************10470039
104800* OPEN THE CARTON DIVERT TABLE CURSOR                            *10480039
104900******************************************************************10490039
105000 4010-OPEN-DIVERT-CSR.                                            10500039
105100                                                                  10510039
105200     PERFORM WITH TEST AFTER                                      10520039
105300       VARYING PV-COUNTER FROM 1 BY 1                             10530039
105400         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    10540039
105500                SQLCODE = ZERO)                                   10550039
105600                                                                  10560039
105700         EXEC SQL                                                 10570039
105800              OPEN DIVERT-CSR                                     10580039
105900         END-EXEC                                                 10590039
106000                                                                  10600039
106100         EVALUATE TRUE                                            10610039
106200             WHEN SQLCODE = +0                                    10620039
106300             WHEN SQLCODE = -904                                  10630039
106400             WHEN SQLCODE = -911                                  10640039
106500             WHEN SQLCODE = -913                                  10650039
106600                 CONTINUE                                         10660039
106700             WHEN SQLWARN0 NOT EQUAL SPACE                        10670039
106800             WHEN SQLCODE NOT EQUAL ZERO                          10680039
106900                 MOVE '4010-OPEN-DIVERT-CSR'                      10690039
107000                                      TO PV-ABEND-PARAGRAPH       10700039
107100                 MOVE 'ERROR OPENING CARTON DIVERT CURSOR'        10710039
107200                                      TO PV-ABEND-OPER-MESSAGE-1  10720039
107300                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         10730039
107400                         PV-FORMAT-SML-NBR                        10740039
107500                                         DELIMITED BY SIZE        10750039
107600                                   INTO PV-ABEND-OPER-MESSAGE-2   10760039
107700                 MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1               10770039
107800                 PERFORM 9100-SQL-ABEND                           10780039
107900         END-EVALUATE                                             10790039
108000     END-PERFORM.                                                 10800039
108100                                                                  10810039
108200     IF  PV-COUNTER > PC-MAX-RETRIES                              10820039
108300         MOVE '4010-OPEN-DIVERT-CSR'                              10830039
108400                                      TO PV-ABEND-PARAGRAPH       10840039
108500         MOVE 'MAX RETRIES ERROR OPENING CARTON DIVERT CURSOR'    10850039
108600                                      TO PV-ABEND-OPER-MESSAGE-1  10860039
108700         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 10870039
108800                PV-FORMAT-SML-NBR                                 10880039
108900                                DELIMITED BY SIZE                 10890039
109000                                   INTO PV-ABEND-OPER-MESSAGE-2   10900039
109100         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       10910039
109200         PERFORM 9100-SQL-ABEND                                   10920039
109300     END-IF.                                                      10930039
109400                                                                  10940039
109500                                                                  10950039
109600******************************************************************10960039
109700* FETCH THE CARTON DIVERT TALBE CURSOR                           *10970039
109800******************************************************************10980039
109900 4020-FETCH-DIVERT-CSR.                                           10990039
110000                                                                  11000039
110100     EXEC SQL                                                     11010039
110200          FETCH DIVERT-CSR                                        11020039
110300           INTO :SUCRDV-OPER-UNT-ID                               11030039
110400              , :SUCRDV-DIVERT-TMST                               11040039
110500              , :SUCRDV-DOOR-ID                                   11050039
110600     END-EXEC.                                                    11060039
110700                                                                  11070039
110800     EVALUATE TRUE                                                11080039
110900       WHEN SQLCODE = ZERO                                        11090039
111000           CONTINUE                                               11100039
111100       WHEN SQLCODE = +100                                        11110039
111200           SET PS-END-OF-CURSOR      TO TRUE                      11120039
111300       WHEN SQLWARN0 NOT EQUAL SPACE                              11130039
111400       WHEN SQLCODE NOT EQUAL ZERO                                11140039
111500           MOVE '4020-FETCH-DIVERT-CSR'                           11150039
111600                                     TO PV-ABEND-PARAGRAPH        11160039
111700           MOVE 'FETCH CARTON DIVERT CURSOR'                      11170039
111800                                     TO PV-ABEND-OPER-MESSAGE-1   11180039
111900           STRING 'SML NUMBER: '  DELIMITED BY SIZE               11190039
112000                  PV-FORMAT-SML-NBR                               11200039
112100                                  DELIMITED BY SIZE               11210039
112200                                   INTO PV-ABEND-OPER-MESSAGE-2   11220039
112300           MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                     11230039
112400           PERFORM 9100-SQL-ABEND                                 11240039
112500     END-EVALUATE.                                                11250039
112600                                                                  11260039
112700                                                                  11270039
112800******************************************************************11280039
112900* CLOSE CARTON DIVERT TABLE CURSOR                               *11290039
113000******************************************************************11300039
113100 4030-CLOSE-DIVERT-CSR.                                           11310039
113200                                                                  11320039
113300     PERFORM WITH TEST AFTER                                      11330039
113400       VARYING PV-COUNTER FROM 1 BY 1                             11340039
113500         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    11350039
113600                SQLCODE = ZERO)                                   11360039
113700                                                                  11370039
113800         EXEC SQL                                                 11380039
113900              CLOSE DIVERT-CSR                                    11390039
114000         END-EXEC                                                 11400039
114100                                                                  11410039
114200         EVALUATE TRUE                                            11420039
114300             WHEN SQLCODE = +0                                    11430039
114400             WHEN SQLCODE = -904                                  11440039
114500             WHEN SQLCODE = -911                                  11450039
114600             WHEN SQLCODE = -913                                  11460039
114700                 CONTINUE                                         11470039
114800             WHEN SQLWARN0 NOT EQUAL SPACE                        11480039
114900             WHEN SQLCODE NOT EQUAL ZERO                          11490039
115000                 MOVE '4030-CLOSE-DIVERT-CSR'                     11500039
115100                                      TO PV-ABEND-PARAGRAPH       11510039
115200                 MOVE 'ERROR CLOSE CARTON DIVERT CURSOR'          11520039
115300                                      TO PV-ABEND-OPER-MESSAGE-1  11530039
115400                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         11540039
115500                         PV-FORMAT-SML-NBR                        11550039
115600                                         DELIMITED BY SIZE        11560039
115700                                   INTO PV-ABEND-OPER-MESSAGE-2   11570039
115800                 MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1               11580039
115900                 PERFORM 9100-SQL-ABEND                           11590039
116000         END-EVALUATE                                             11600039
116100     END-PERFORM.                                                 11610039
116200                                                                  11620039
116300     IF  PV-COUNTER > PC-MAX-RETRIES                              11630039
116400         MOVE '4030-CLOSE-DIVERT-CSR'                             11640039
116500                                      TO PV-ABEND-PARAGRAPH       11650039
116600         MOVE 'MAX RETRIES ERROR CLOSE CARTON DIVERT CURSOR'      11660039
116700                                      TO PV-ABEND-OPER-MESSAGE-1  11670039
116800         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 11680039
116900                PV-FORMAT-SML-NBR                                 11690039
117000                                DELIMITED BY SIZE                 11700039
117100                                   INTO PV-ABEND-OPER-MESSAGE-2   11710039
117200         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       11720039
117300         PERFORM 9100-SQL-ABEND                                   11730039
117400     END-IF.                                                      11740039
117500                                                                  11750039
117600                                                                  11760039
117700******************************************************************11770039
117800* CONTROL THE PROCESSING OF THE CARTON DIVERT TABLE CURSOR       *11780039
117900* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *11790039
118000******************************************************************11800039
118100 4040-PROCESS-DIVERT-CSR.                                         11810039
118110                                                                  11811056
118200     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        11820056
118210                                                                  11821056
118300     STRING 'DIVERT TO DOOR ' DELIMITED BY SIZE                   11830039
118400            SUCRDV-DOOR-ID DELIMITED BY SIZE                      11840039
118500            INTO SU173-CARTON-ACTIVITY.                           11850039
118600     MOVE SUCRDV-OPER-UNT-ID TO                                   11860039
118700          SU173-ACTIVITY-AT-DC-NBR.                               11870039
118800     MOVE SUCRDV-DIVERT-TMST TO PV-HOLD-TMST.                     11880039
118900                                                                  11890039
119000     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME.                        11900039
119100                                                                  11910039
119200     PERFORM 8200-WRITE-OUTPUT.                                   11920039
119300                                                                  11930039
119400     PERFORM 4020-FETCH-DIVERT-CSR.                               11940039
119500                                                                  11950039
119600                                                                  11960039
119700******************************************************************11970039
119800* THIS WILL CONTROL THE FORMATTING OF DATA FROM THE CARTON       *11980039
119900* DIRECTIVE TABLE.                                               *11990039
120000******************************************************************12000039
120100 4400-CREATE-FROM-CRTN-DRCTV.                                     12010039
120200                                                                  12020039
120300     SET PS-NOT-END-OF-CURSOR TO TRUE.                            12030039
120400                                                                  12040039
120500     PERFORM 4410-OPEN-DIRECTIVE-CSR.                             12050039
120600     PERFORM 4420-FETCH-DIRECTIVE-CSR.                            12060039
120700                                                                  12070039
120800     PERFORM 4440-PROCESS-DIRECTIVE-CSR                           12080039
120900       UNTIL PS-END-OF-CURSOR.                                    12090039
121000                                                                  12100039
121100     PERFORM 4430-CLOSE-DIRECTIVE-CSR.                            12110039
121200                                                                  12120039
121300                                                                  12130039
121400******************************************************************12140039
121500* OPEN THE CARTON DIRECTIVE TABLE CURSOR                         *12150039
121600******************************************************************12160039
121700 4410-OPEN-DIRECTIVE-CSR.                                         12170039
121800                                                                  12180039
121900     PERFORM WITH TEST AFTER                                      12190039
122000       VARYING PV-COUNTER FROM 1 BY 1                             12200039
122100         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    12210039
122200                SQLCODE = ZERO)                                   12220039
122300                                                                  12230039
122400         EXEC SQL                                                 12240039
122500              OPEN DIRECTIVE-CSR                                  12250039
122600         END-EXEC                                                 12260039
122700                                                                  12270039
122800         EVALUATE TRUE                                            12280039
122900             WHEN SQLCODE = +0                                    12290039
123000             WHEN SQLCODE = -904                                  12300039
123100             WHEN SQLCODE = -911                                  12310039
123200             WHEN SQLCODE = -913                                  12320039
123300                 CONTINUE                                         12330039
123400             WHEN SQLWARN0 NOT EQUAL SPACE                        12340039
123500             WHEN SQLCODE NOT EQUAL ZERO                          12350039
123600                 MOVE '4410-OPEN-DIRECTIVE-CSR'                   12360039
123700                                      TO PV-ABEND-PARAGRAPH       12370039
123800                 MOVE 'ERROR OPENING CARTON DIRECTIVE CURSOR'     12380039
123900                                      TO PV-ABEND-OPER-MESSAGE-1  12390039
124000                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         12400039
124100                         PV-FORMAT-SML-NBR                        12410039
124200                                         DELIMITED BY SIZE        12420039
124300                                   INTO PV-ABEND-OPER-MESSAGE-2   12430039
124400                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    12440039
124500                 PERFORM 9100-SQL-ABEND                           12450039
124600         END-EVALUATE                                             12460039
124700     END-PERFORM.                                                 12470039
124800                                                                  12480039
124900     IF  PV-COUNTER > PC-MAX-RETRIES                              12490039
125000         MOVE '4410-OPEN-DIRECTIVE-CSR'                           12500039
125100                                      TO PV-ABEND-PARAGRAPH       12510039
125200         MOVE 'MAX RETRIES ERROR OPENING CARTON DIRECTIVE CURSOR' 12520039
125300                                      TO PV-ABEND-OPER-MESSAGE-1  12530039
125400         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 12540039
125500                PV-FORMAT-SML-NBR                                 12550039
125600                                DELIMITED BY SIZE                 12560039
125700                                   INTO PV-ABEND-OPER-MESSAGE-2   12570039
125800         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       12580039
125900         PERFORM 9100-SQL-ABEND                                   12590039
126000     END-IF.                                                      12600039
126100                                                                  12610039
126200                                                                  12620039
126300******************************************************************12630039
126400* FETCH THE CARTON DIRECTIVE TALBE CURSOR                        *12640039
126500******************************************************************12650039
126600 4420-FETCH-DIRECTIVE-CSR.                                        12660039
126700                                                                  12670039
126800     EXEC SQL                                                     12680039
126900          FETCH DIRECTIVE-CSR                                     12690039
127000           INTO :SUT00102-OPER-UNT-ID                             12700039
127100              , :SUT00102-CRE-TMST                                12710039
127200              , :SUT00102-DIRV-RSN-CDE                            12720039
127210              , :SUT00102-CNVYR-PRC-ACTN-NM                       12721039
127300     END-EXEC.                                                    12730039
127400                                                                  12740039
127500     EVALUATE TRUE                                                12750039
127600       WHEN SQLCODE = ZERO                                        12760039
127700           CONTINUE                                               12770039
127800       WHEN SQLCODE = +100                                        12780039
127900           SET PS-END-OF-CURSOR      TO TRUE                      12790039
128000       WHEN SQLWARN0 NOT EQUAL SPACE                              12800039
128100       WHEN SQLCODE NOT EQUAL ZERO                                12810039
128200           MOVE '4420-FETCH-DIRECTIVE-CSR'                        12820039
128300                                     TO PV-ABEND-PARAGRAPH        12830039
128400           MOVE 'FETCH CARTON DIRECTIVE CURSOR'                   12840039
128500                                     TO PV-ABEND-OPER-MESSAGE-1   12850039
128600           STRING 'SML NUMBER: '  DELIMITED BY SIZE               12860039
128700                  PV-FORMAT-SML-NBR                               12870039
128800                                  DELIMITED BY SIZE               12880039
128900                                   INTO PV-ABEND-OPER-MESSAGE-2   12890039
129000           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          12900039
129100           PERFORM 9100-SQL-ABEND                                 12910039
129200     END-EVALUATE.                                                12920039
129300                                                                  12930039
129400                                                                  12940039
129500******************************************************************12950039
129600* CLOSE CARTON DIRECTIVE TABLE CURSOR                            *12960039
129700******************************************************************12970039
129800 4430-CLOSE-DIRECTIVE-CSR.                                        12980039
129900                                                                  12990039
130000     PERFORM WITH TEST AFTER                                      13000039
130100       VARYING PV-COUNTER FROM 1 BY 1                             13010039
130200         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    13020039
130300                SQLCODE = ZERO)                                   13030039
130400                                                                  13040039
130500         EXEC SQL                                                 13050039
130600              CLOSE DIRECTIVE-CSR                                 13060039
130700         END-EXEC                                                 13070039
130800                                                                  13080039
130900         EVALUATE TRUE                                            13090039
131000             WHEN SQLCODE = +0                                    13100039
131100             WHEN SQLCODE = -904                                  13110039
131200             WHEN SQLCODE = -911                                  13120039
131300             WHEN SQLCODE = -913                                  13130039
131400                 CONTINUE                                         13140039
131500             WHEN SQLWARN0 NOT EQUAL SPACE                        13150039
131600             WHEN SQLCODE NOT EQUAL ZERO                          13160039
131700                 MOVE '4430-CLOSE-DIRECTIVE-CSR'                  13170039
131800                                      TO PV-ABEND-PARAGRAPH       13180039
131900                 MOVE 'ERROR CLOSE CARTON DIRECTIVE CURSOR'       13190039
132000                                      TO PV-ABEND-OPER-MESSAGE-1  13200039
132100                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         13210039
132200                         PV-FORMAT-SML-NBR                        13220039
132300                                         DELIMITED BY SIZE        13230039
132400                                   INTO PV-ABEND-OPER-MESSAGE-2   13240039
132500                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    13250039
132600                 PERFORM 9100-SQL-ABEND                           13260039
132700         END-EVALUATE                                             13270039
132800     END-PERFORM.                                                 13280039
132900                                                                  13290039
133000     IF  PV-COUNTER > PC-MAX-RETRIES                              13300039
133100         MOVE '4430-CLOSE-DIRECTIVE-CSR'                          13310039
133200                                      TO PV-ABEND-PARAGRAPH       13320039
133300         MOVE 'MAX RETRIES ERROR CLOSE CARTON DIRECTIVE CURSOR'   13330039
133400                                      TO PV-ABEND-OPER-MESSAGE-1  13340039
133500         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 13350039
133600                PV-FORMAT-SML-NBR                                 13360039
133700                                DELIMITED BY SIZE                 13370039
133800                                   INTO PV-ABEND-OPER-MESSAGE-2   13380039
133900         MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1            13390039
134000         PERFORM 9100-SQL-ABEND                                   13400039
134100     END-IF.                                                      13410039
134200                                                                  13420039
134300                                                                  13430039
134400******************************************************************13440039
134500* CONTROL THE PROCESSING OF THE CARTON DIRECTIVE TABLE CURSOR    *13450039
134600* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *13460039
134700******************************************************************13470039
134800 4440-PROCESS-DIRECTIVE-CSR.                                      13480039
134900                                                                  13490039
135000     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        13500039
135001                                                                  13500139
135010     MOVE SUT00102-OPER-UNT-ID TO                                 13501039
135020          SU173-ACTIVITY-AT-DC-NBR.                               13502039
135030     MOVE SUT00102-CRE-TMST TO PV-HOLD-TMST.                      13503039
135100                                                                  13510039
135110     IF  SUT00102-DIRV-RSN-CDE = 'AU%'                            13511039
135111     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       13511139
135120         MOVE '100% AUDIT NEEDED DIRECTIVE   '                    13512039
135121              TO SU173-CARTON-ACTIVITY                            13512139
135122     END-IF.                                                      13512239
135130                                                                  13513039
135140     IF  SUT00102-DIRV-RSN-CDE = 'AUN'                            13514039
135150         MOVE 'AUDIT NO LONGER NEED DIRECTIVE'                    13515039
135160              TO SU173-CARTON-ACTIVITY                            13516039
135170     END-IF.                                                      13517039
135180                                                                  13518039
135190     IF  SUT00102-DIRV-RSN-CDE = 'AUP'                            13519039
135191         MOVE 'AUDIT PASS RELEASE DIRECTIVE  '                    13519139
135192              TO SU173-CARTON-ACTIVITY                            13519239
135193     END-IF.                                                      13519339
135194                                                                  13519439
135195     IF  SUT00102-DIRV-RSN-CDE = 'AUQ'                            13519539
135196         MOVE 'QA AUDIT NEEDED DIRECTIVE     '                    13519639
135197              TO SU173-CARTON-ACTIVITY                            13519739
135198     END-IF.                                                      13519839
135199                                                                  13519939
135200     IF  SUT00102-DIRV-RSN-CDE = 'AUR'                            13520039
135201     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       13520139
135203         MOVE 'REWORK AUDIT NEEDED DIRECTIVE '                    13520339
135204              TO SU173-CARTON-ACTIVITY                            13520439
135205     END-IF.                                                      13520539
135206                                                                  13520639
135207     IF  SUT00102-DIRV-RSN-CDE = 'AUU'                            13520739
135208     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       13520839
135209         MOVE 'WAIT ON AUDIT RESULT DIRECTIVE'                    13520939
135210              TO SU173-CARTON-ACTIVITY                            13521039
135211     END-IF.                                                      13521139
135212                                                                  13521239
135213     IF  SUT00102-DIRV-RSN-CDE = 'BRC'                            13521339
135214         MOVE 'ROUTE VIA BARCORD DIRECTIVE   '                    13521439
135215              TO SU173-CARTON-ACTIVITY                            13521539
135216     END-IF.                                                      13521639
135217                                                                  13521739
135218     IF  SUT00102-DIRV-RSN-CDE = 'RCL'                            13521839
135219     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       13521939
135220         MOVE 'CARTON RECLAIMED DIRECTIVE    '                    13522039
135221              TO SU173-CARTON-ACTIVITY                            13522139
135222     END-IF.                                                      13522239
135223                                                                  13522339
135224     IF  SUT00102-DIRV-RSN-CDE = 'RFD'                            13522439
135225         MOVE 'CARTON TO BE TAGGED DIRECTIVE '                    13522539
135226              TO SU173-CARTON-ACTIVITY                            13522639
135227     END-IF.                                                      13522739
135228                                                                  13522839
135229     IF  SUT00102-DIRV-RSN-CDE = 'RLC'                            13522939
135230         MOVE 'CARTON RELEASE AUDIT DIRECTIVE'                    13523039
135231              TO SU173-CARTON-ACTIVITY                            13523139
135232     END-IF.                                                      13523239
135233                                                                  13523339
135234     IF  SUT00102-DIRV-RSN-CDE = 'RLF'                            13523439
135235         MOVE 'CARTON MANUAL RELEASE DIRECTVE'                    13523539
135236              TO SU173-CARTON-ACTIVITY                            13523639
135237     END-IF.                                                      13523739
135238                                                                  13523839
135239     IF  SUT00102-DIRV-RSN-CDE = 'RLO'                            13523939
135240     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       13524039
135241         MOVE 'CARTON ONLINE RELEASE DIRECTVE'                    13524139
135242              TO SU173-CARTON-ACTIVITY                            13524239
135250     END-IF.                                                      13525039
135800                                                                  13580039
142900     IF  SU173-CARTON-ACTIVITY = ' '                              14290039
142910         IF  SUT00102-CNVYR-PRC-ACTN-NM = 'DELETE'                14291039
142920             IF  SUT00102-DIRV-RSN-CDE = 'RLO'                    14292039
142930             OR  SUT00102-DIRV-RSN-CDE = 'AUR'                    14293039
142931             OR  SUT00102-DIRV-RSN-CDE = 'RCL'                    14293139
142932             OR  SUT00102-DIRV-RSN-CDE = 'AU%'                    14293239
142933             OR  SUT00102-DIRV-RSN-CDE = 'AUU'                    14293339
142934                 NEXT SENTENCE                                    14293439
142940             ELSE                                                 14294039
143000                 DISPLAY 'NO HANDLING FOR CARTON '                14300039
143010                         'RELEASE DIRECTIVE: '                    14301039
143100                         SUT00102-DIRV-RSN-CDE                    14310039
143200                 DISPLAY 'SML NUMBER: ' PV-FORMAT-SML-NBR         14320039
143201             END-IF                                               14320139
143210         ELSE                                                     14321039
143220             DISPLAY 'NO HANDLING FOR CARTON '                    14322039
143230                     'RELEASE DIRECTIVE: '                        14323039
143240                     SUT00102-DIRV-RSN-CDE                        14324039
143250             DISPLAY 'SML NUMBER: ' PV-FORMAT-SML-NBR             14325039
143260         END-IF                                                   14326039
143300     ELSE                                                         14330039
143600         PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                     14360039
143700         PERFORM 8200-WRITE-OUTPUT                                14370039
143800     END-IF.                                                      14380039
143900                                                                  14390039
143910     PERFORM 4420-FETCH-DIRECTIVE-CSR.                            14391039
144100                                                                  14410039
144200                                                                  14420039
144210******************************************************************14421039
144220* THIS WILL CONTROL THE FORMATTING OF DATA FOR THE MASTER CARTON *14422039
144230******************************************************************14423039
144240 4800-CREATE-FROM-MSTR-CARTON.                                    14424039
144250                                                                  14425039
144260     SET PS-NOT-END-OF-CURSOR TO TRUE.                            14426039
144270                                                                  14427039
144280     PERFORM 4810-OPEN-MSTR-CRTN-CSR.                             14428039
144290     PERFORM 4820-FETCH-MSTR-CRTN-CSR.                            14429039
144291                                                                  14429139
144292     PERFORM 4840-PROCESS-MSTR-CRTN-CSR                           14429239
144293       UNTIL PS-END-OF-CURSOR.                                    14429339
144294                                                                  14429439
144295     PERFORM 4830-CLOSE-MSTR-CRTN-CSR.                            14429539
144296                                                                  14429639
144297                                                                  14429739
144298******************************************************************14429839
144299* OPEN THE CARTON MSTR-CRTN TABLE CURSOR                         *14429939
144300******************************************************************14430039
144301 4810-OPEN-MSTR-CRTN-CSR.                                         14430139
144302                                                                  14430239
144303     PERFORM WITH TEST AFTER                                      14430339
144304       VARYING PV-COUNTER FROM 1 BY 1                             14430439
144305         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14430539
144306                SQLCODE = ZERO)                                   14430639
144307                                                                  14430739
144308         EXEC SQL                                                 14430839
144309              OPEN MSTR-CRTN-CSR                                  14430939
144310         END-EXEC                                                 14431039
144311                                                                  14431139
144312         EVALUATE TRUE                                            14431239
144313             WHEN SQLCODE = +0                                    14431339
144314             WHEN SQLCODE = -904                                  14431439
144315             WHEN SQLCODE = -911                                  14431539
144316             WHEN SQLCODE = -913                                  14431639
144317                 CONTINUE                                         14431739
144318             WHEN SQLWARN0 NOT EQUAL SPACE                        14431839
144319             WHEN SQLCODE NOT EQUAL ZERO                          14431939
144320                 MOVE '4810-OPEN-MSTR-CRTN-CSR'                   14432039
144321                                      TO PV-ABEND-PARAGRAPH       14432139
144322                 MOVE 'ERROR OPENING CARTON MSTR-CRTN CURSOR'     14432239
144323                                      TO PV-ABEND-OPER-MESSAGE-1  14432339
144324                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         14432439
144325                         PV-FORMAT-SML-NBR                        14432539
144326                                         DELIMITED BY SIZE        14432639
144327                                   INTO PV-ABEND-OPER-MESSAGE-2   14432739
144328                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    14432839
144329                 PERFORM 9100-SQL-ABEND                           14432939
144330         END-EVALUATE                                             14433039
144331     END-PERFORM.                                                 14433139
144332                                                                  14433239
144333     IF  PV-COUNTER > PC-MAX-RETRIES                              14433339
144334         MOVE '4810-OPEN-MSTR-CRTN-CSR'                           14433439
144335                                      TO PV-ABEND-PARAGRAPH       14433539
144336         MOVE 'MAX RETRIES ERROR OPENING CARTON MSTR-CRTN CURSOR' 14433639
144337                                      TO PV-ABEND-OPER-MESSAGE-1  14433739
144338         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 14433839
144339                PV-FORMAT-SML-NBR                                 14433939
144340                                DELIMITED BY SIZE                 14434039
144341                                   INTO PV-ABEND-OPER-MESSAGE-2   14434139
144342         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       14434239
144343         PERFORM 9100-SQL-ABEND                                   14434339
144344     END-IF.                                                      14434439
144345                                                                  14434539
144346                                                                  14434639
144347******************************************************************14434739
144348* FETCH THE CARTON MSTR-CRTN TALBE CURSOR                        *14434839
144349******************************************************************14434939
144350 4820-FETCH-MSTR-CRTN-CSR.                                        14435039
144351                                                                  14435139
144352     EXEC SQL                                                     14435239
144353          FETCH MSTR-CRTN-CSR                                     14435339
144355           INTO :SUT00099-CRE-TMST                                14435540
144356              , :SUT00100-ACTN-TYP-DES                            14435640
144357     END-EXEC.                                                    14435739
144358                                                                  14435839
144359     EVALUATE TRUE                                                14435939
144360       WHEN SQLCODE = ZERO                                        14436039
144361           CONTINUE                                               14436139
144362       WHEN SQLCODE = +100                                        14436239
144363           SET PS-END-OF-CURSOR      TO TRUE                      14436339
144364       WHEN SQLWARN0 NOT EQUAL SPACE                              14436439
144365       WHEN SQLCODE NOT EQUAL ZERO                                14436539
144366           MOVE '4820-FETCH-MSTR-CRTN-CSR'                        14436639
144367                                     TO PV-ABEND-PARAGRAPH        14436739
144368           MOVE 'FETCH CARTON MSTR-CRTN CURSOR'                   14436839
144369                                     TO PV-ABEND-OPER-MESSAGE-1   14436939
144370           STRING 'SML NUMBER: '  DELIMITED BY SIZE               14437039
144371                  PV-FORMAT-SML-NBR                               14437139
144372                                  DELIMITED BY SIZE               14437239
144373                                   INTO PV-ABEND-OPER-MESSAGE-2   14437339
144374           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          14437439
144375           PERFORM 9100-SQL-ABEND                                 14437539
144376     END-EVALUATE.                                                14437639
144377                                                                  14437739
144378                                                                  14437839
144379******************************************************************14437939
144380* CLOSE CARTON MSTR-CRTN TABLE CURSOR                            *14438039
144381******************************************************************14438139
144382 4830-CLOSE-MSTR-CRTN-CSR.                                        14438239
144383                                                                  14438339
144384     PERFORM WITH TEST AFTER                                      14438439
144385       VARYING PV-COUNTER FROM 1 BY 1                             14438539
144386         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14438639
144387                SQLCODE = ZERO)                                   14438739
144388                                                                  14438839
144389         EXEC SQL                                                 14438939
144390              CLOSE MSTR-CRTN-CSR                                 14439039
144391         END-EXEC                                                 14439139
144392                                                                  14439239
144393         EVALUATE TRUE                                            14439339
144394             WHEN SQLCODE = +0                                    14439439
144395             WHEN SQLCODE = -904                                  14439539
144396             WHEN SQLCODE = -911                                  14439639
144397             WHEN SQLCODE = -913                                  14439739
144398                 CONTINUE                                         14439839
144399             WHEN SQLWARN0 NOT EQUAL SPACE                        14439939
144400             WHEN SQLCODE NOT EQUAL ZERO                          14440039
144401                 MOVE '4830-CLOSE-MSTR-CRTN-CSR'                  14440139
144402                                      TO PV-ABEND-PARAGRAPH       14440239
144403                 MOVE 'ERROR CLOSE CARTON MSTR-CRTN CURSOR'       14440339
144404                                      TO PV-ABEND-OPER-MESSAGE-1  14440439
144405                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         14440539
144406                         PV-FORMAT-SML-NBR                        14440639
144407                                         DELIMITED BY SIZE        14440739
144408                                   INTO PV-ABEND-OPER-MESSAGE-2   14440839
144409                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    14440939
144410                 PERFORM 9100-SQL-ABEND                           14441039
144411         END-EVALUATE                                             14441139
144412     END-PERFORM.                                                 14441239
144413                                                                  14441339
144414     IF  PV-COUNTER > PC-MAX-RETRIES                              14441439
144415         MOVE '4830-CLOSE-MSTR-CRTN-CSR'                          14441539
144416                                      TO PV-ABEND-PARAGRAPH       14441639
144417         MOVE 'MAX RETRIES ERROR CLOSE CARTON MSTR-CRTN CURSOR'   14441739
144418                                      TO PV-ABEND-OPER-MESSAGE-1  14441839
144419         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 14441939
144420                PV-FORMAT-SML-NBR                                 14442039
144421                                DELIMITED BY SIZE                 14442139
144422                                   INTO PV-ABEND-OPER-MESSAGE-2   14442239
144423         MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1            14442339
144424         PERFORM 9100-SQL-ABEND                                   14442439
144425     END-IF.                                                      14442539
144426                                                                  14442639
144427                                                                  14442739
144428******************************************************************14442839
144429* CONTROL THE PROCESSING OF THE MASTER CARTON CURSOR             *14442939
144430* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *14443039
144431******************************************************************14443139
144432 4840-PROCESS-MSTR-CRTN-CSR.                                      14443239
144433                                                                  14443339
144434     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        14443439
144435                                                                  14443539
144436*    MOVE SUT00024-ORGN-LOC-NBR TO                                14443640
144437*         SU173-ACTIVITY-AT-DC-NBR.                               14443740
144438*                                                                 14443840
144439     MOVE SUT00100-ACTN-TYP-DES       TO                          14443940
144440           SU173-CARTON-ACTIVITY.                                 14444039
144441                                                                  14444139
144442     MOVE SUT00099-CRE-TMST TO PV-HOLD-TMST.                      14444239
144447                                                                  14444739
144448     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                         14444839
144449     PERFORM 8200-WRITE-OUTPUT                                    14444939
144450                                                                  14445039
144451     PERFORM 4820-FETCH-MSTR-CRTN-CSR.                            14445139
144452                                                                  14445239
144453******************************************************************14445339
144454* THIS WILL CONTROL THE FORMATING OF DATA FOR THE AUDIT DATA     *14445439
144455******************************************************************14445539
144456 5200-CREATE-FROM-AUDIT-DATA.                                     14445639
144457                                                                  14445739
144458     SET PS-NOT-END-OF-CURSOR TO TRUE.                            14445839
144459                                                                  14445939
144460     PERFORM 5210-OPEN-AUDIT-DATA-CSR.                            14446039
144461     PERFORM 5220-FETCH-AUDIT-DATA-CSR.                           14446139
144462                                                                  14446239
144463     PERFORM 5240-PROCESS-AUDIT-DATA-CSR                          14446339
144464       UNTIL PS-END-OF-CURSOR.                                    14446439
144465                                                                  14446539
144466     PERFORM 5230-CLOSE-AUDIT-DATA-CSR.                           14446639
144467                                                                  14446739
144468                                                                  14446839
144469******************************************************************14446939
144470* OPEN THE CARTON AUDIT-DATA TABLE CURSOR                        *14447039
144471******************************************************************14447139
144472 5210-OPEN-AUDIT-DATA-CSR.                                        14447239
144473                                                                  14447339
144474     PERFORM WITH TEST AFTER                                      14447439
144475       VARYING PV-COUNTER FROM 1 BY 1                             14447539
144476         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14447639
144477                SQLCODE = ZERO)                                   14447739
144478                                                                  14447839
144479         EXEC SQL                                                 14447939
144480              OPEN AUDIT-DATA-CSR                                 14448039
144481         END-EXEC                                                 14448139
144482                                                                  14448239
144483         EVALUATE TRUE                                            14448339
144484             WHEN SQLCODE = +0                                    14448439
144485             WHEN SQLCODE = -904                                  14448539
144486             WHEN SQLCODE = -911                                  14448639
144487             WHEN SQLCODE = -913                                  14448739
144488                 CONTINUE                                         14448839
144489             WHEN SQLWARN0 NOT EQUAL SPACE                        14448939
144490             WHEN SQLCODE NOT EQUAL ZERO                          14449039
144491                 MOVE '5210-OPEN-AUDIT-DATA-CSR'                  14449139
144492                                      TO PV-ABEND-PARAGRAPH       14449239
144493                 MOVE 'ERROR OPENING CARTON AUDIT-DATA CURSOR'    14449339
144494                                      TO PV-ABEND-OPER-MESSAGE-1  14449439
144495                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         14449539
144496                         PV-FORMAT-SML-NBR                        14449639
144497                                         DELIMITED BY SIZE        14449739
144498                                   INTO PV-ABEND-OPER-MESSAGE-2   14449839
144499                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    14449939
144500                 PERFORM 9100-SQL-ABEND                           14450039
144501         END-EVALUATE                                             14450139
144502     END-PERFORM.                                                 14450239
144503                                                                  14450339
144504     IF  PV-COUNTER > PC-MAX-RETRIES                              14450439
144505         MOVE '5210-OPEN-AUDIT-DATA-CSR'                          14450539
144506                                      TO PV-ABEND-PARAGRAPH       14450639
144507         MOVE 'MAX RETRIES ERROR OPENING CARTON AUDIT-DATA CURSOR'14450739
144508                                      TO PV-ABEND-OPER-MESSAGE-1  14450839
144509         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 14450939
144510                PV-FORMAT-SML-NBR                                 14451039
144511                                DELIMITED BY SIZE                 14451139
144512                                   INTO PV-ABEND-OPER-MESSAGE-2   14451239
144513         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       14451339
144514         PERFORM 9100-SQL-ABEND                                   14451439
144515     END-IF.                                                      14451539
144516                                                                  14451639
144517                                                                  14451739
144518******************************************************************14451839
144519* FETCH THE CARTON AUDIT-DATA TALBE CURSOR                       *14451939
144520******************************************************************14452039
144521 5220-FETCH-AUDIT-DATA-CSR.                                       14452139
144522                                                                  14452239
144523     EXEC SQL                                                     14452339
144524          FETCH AUDIT-DATA-CSR                                    14452439
144525           INTO :SUATRN-AUD-CNTL-NBR                              14452539
144526              , :SUATRN-UNT-AUD-STRT-TMST                         14452639
144527              , :SUATRN-UNT-AUD-STP-TMST                          14452739
144528              , :SUNAUD-OPER-UNT-ID                               14452846
144529              , :SUNAUD-AUD-TYP-CDE                               14452939
144530              , :PV-CSR-AUDIT-PROMPT-CDE                          14453039
144531     END-EXEC.                                                    14453139
144532                                                                  14453239
144533     EVALUATE TRUE                                                14453339
144534       WHEN SQLCODE = ZERO                                        14453439
144535           CONTINUE                                               14453539
144536       WHEN SQLCODE = +100                                        14453639
144537           SET PS-END-OF-CURSOR      TO TRUE                      14453739
144538       WHEN SQLWARN0 NOT EQUAL SPACE                              14453839
144539       WHEN SQLCODE NOT EQUAL ZERO                                14453939
144540           MOVE '5220-FETCH-AUDIT-DATA-CSR'                       14454039
144541                                     TO PV-ABEND-PARAGRAPH        14454139
144542           MOVE 'FETCH CARTON AUDIT-DATA CURSOR'                  14454239
144543                                     TO PV-ABEND-OPER-MESSAGE-1   14454339
144544           STRING 'SML NUMBER: '  DELIMITED BY SIZE               14454439
144545                  PV-FORMAT-SML-NBR                               14454539
144546                                  DELIMITED BY SIZE               14454639
144547                                   INTO PV-ABEND-OPER-MESSAGE-2   14454739
144548           MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1          14454839
144549           PERFORM 9100-SQL-ABEND                                 14454939
144550     END-EVALUATE.                                                14455039
144551                                                                  14455139
144552                                                                  14455239
144553******************************************************************14455339
144554* CLOSE CARTON AUDIT-DATA TABLE CURSOR                           *14455439
144555******************************************************************14455539
144556 5230-CLOSE-AUDIT-DATA-CSR.                                       14455639
144557                                                                  14455739
144558     PERFORM WITH TEST AFTER                                      14455839
144559       VARYING PV-COUNTER FROM 1 BY 1                             14455939
144560         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14456039
144561                SQLCODE = ZERO)                                   14456139
144562                                                                  14456239
144563         EXEC SQL                                                 14456339
144564              CLOSE AUDIT-DATA-CSR                                14456439
144565         END-EXEC                                                 14456539
144566                                                                  14456639
144567         EVALUATE TRUE                                            14456739
144568             WHEN SQLCODE = +0                                    14456839
144569             WHEN SQLCODE = -904                                  14456939
144570             WHEN SQLCODE = -911                                  14457039
144571             WHEN SQLCODE = -913                                  14457139
144572                 CONTINUE                                         14457239
144573             WHEN SQLWARN0 NOT EQUAL SPACE                        14457339
144574             WHEN SQLCODE NOT EQUAL ZERO                          14457439
144575                 MOVE '5230-CLOSE-AUDIT-DATA-CSR'                 14457539
144576                                      TO PV-ABEND-PARAGRAPH       14457639
144577                 MOVE 'ERROR CLOSE CARTON AUDIT-DATA CURSOR'      14457739
144578                                      TO PV-ABEND-OPER-MESSAGE-1  14457839
144579                 STRING 'SML NUMBER: '  DELIMITED BY SIZE         14457939
144580                         PV-FORMAT-SML-NBR                        14458039
144581                                         DELIMITED BY SIZE        14458139
144582                                   INTO PV-ABEND-OPER-MESSAGE-2   14458239
144583                 MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1    14458339
144584                 PERFORM 9100-SQL-ABEND                           14458439
144585         END-EVALUATE                                             14458539
144586     END-PERFORM.                                                 14458639
144587                                                                  14458739
144588     IF  PV-COUNTER > PC-MAX-RETRIES                              14458839
144589         MOVE '5230-CLOSE-AUDIT-DATA-CSR'                         14458939
144590                                      TO PV-ABEND-PARAGRAPH       14459039
144591         MOVE 'MAX RETRIES ERROR CLOSE CARTON AUDIT-DATA CURSOR'  14459139
144592                                      TO PV-ABEND-OPER-MESSAGE-1  14459239
144593         STRING 'SML NUMBER: '  DELIMITED BY SIZE                 14459339
144594                PV-FORMAT-SML-NBR                                 14459439
144595                                DELIMITED BY SIZE                 14459539
144596                                   INTO PV-ABEND-OPER-MESSAGE-2   14459639
144597         MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1            14459739
144598         PERFORM 9100-SQL-ABEND                                   14459839
144599     END-IF.                                                      14459939
144600                                                                  14460039
144601                                                                  14460139
144602******************************************************************14460239
144603* CONTROL THE PROCESSING OF THE CARTON AUDIT CURSOR              *14460339
144604* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *14460439
144605******************************************************************14460539
144606 5240-PROCESS-AUDIT-DATA-CSR.                                     14460639
144607                                                                  14460739
144608     MOVE SPACES TO SU173-CARTON-ACTIVITY                         14460850
144609                    PV-CARTON-AUDIT-ACTIVITY.                     14460950
144610                                                                  14461050
144611     MOVE 'CARTON AUDIT START '    TO PV-CRTN-AUD-STRT-STOP       14461146
144612                                                                  14461239
144614     IF PV-CSR-AUDIT-PROMPT-CDE  =  'Y'                           14461446
144615        MOVE 'SYSTM'                  TO PV-CRTN-AUD-PRMPT        14461546
144616     ELSE                                                         14461646
144617        MOVE 'MANUAL'                 TO PV-CRTN-AUD-PRMPT        14461746
144618     END-IF                                                       14461846
144619                                                                  14461946
144621                                                                  14462146
144622     EVALUATE TRUE                                                14462246
144623       WHEN SUNAUD-AUD-TYP-CDE  = '01'                            14462346
144624            MOVE   '100%'            TO PV-CRTN-AUD-TYPE          14462446
144625       WHEN SUNAUD-AUD-TYP-CDE  = '02'                            14462546
144626            MOVE   'SPOT'            TO PV-CRTN-AUD-TYPE          14462646
144627       WHEN SUNAUD-AUD-TYP-CDE  = '03'                            14462746
144628            MOVE   'RWRK'            TO PV-CRTN-AUD-TYPE          14462846
144629     END-EVALUATE                                                 14462946
144630                                                                  14463046
144631     MOVE  PV-CARTON-AUDIT-ACTIVITY  TO SU173-CARTON-ACTIVITY     14463146
144632                                                                  14463246
144633     MOVE SUNAUD-OPER-UNT-ID      TO                              14463346
144634          SU173-ACTIVITY-AT-DC-NBR.                               14463446
144635                                                                  14463546
144636     MOVE SUATRN-UNT-AUD-STRT-TMST TO PV-HOLD-TMST.               14463646
144637                                                                  14463739
144640                                                                  14464039
144641     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                         14464139
144642     PERFORM 8200-WRITE-OUTPUT                                    14464239
144643                                                                  14464339
144644*****************************************************             14464439
144645                                                                  14464539
144646     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        14464639
144647                                                                  14464739
144648     MOVE 'CARTON AUDIT STOP '       TO PV-CRTN-AUD-STRT-STOP     14464847
144649     MOVE  PV-CARTON-AUDIT-ACTIVITY  TO SU173-CARTON-ACTIVITY     14464947
144650                                                                  14465046
144651     MOVE SUNAUD-OPER-UNT-ID      TO                              14465146
144652          SU173-ACTIVITY-AT-DC-NBR.                               14465239
144653                                                                  14465339
144654     MOVE SUATRN-UNT-AUD-STP-TMST  TO PV-HOLD-TMST.               14465439
144655                                                                  14465545
144657                                                                  14465745
144658     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                         14465845
144659     PERFORM 8200-WRITE-OUTPUT                                    14465945
144660                                                                  14466045
144661     PERFORM 5220-FETCH-AUDIT-DATA-CSR.                           14466145
144662                                                                  14466245
144663******************************************************************14466345
144664* THIS WILL CONTROL THE FORMATING OF DATA FROM LABEL PRINTIG     *14466445
144665******************************************************************14466545
144666 5400-CREATE-FROM-LABEL-PRINT.                                    14466645
144667                                                                  14466745
144668     SET PS-NOT-END-OF-CURSOR TO TRUE.                            14466845
144669                                                                  14466945
144670     PERFORM 5410-OPEN-LABEL-PRT-CSR.                             14467045
144671     PERFORM 5420-FETCH-LABEL-PRT-CSR.                            14467145
144672                                                                  14467245
144673     PERFORM 5440-PROCESS-LABEL-PRT-CSR                           14467345
144674       UNTIL PS-END-OF-CURSOR.                                    14467445
144675                                                                  14467545
144676     PERFORM 5430-CLOSE-LABEL-PRT-CSR.                            14467645
144677                                                                  14467745
144678                                                                  14467845
144679******************************************************************14467945
144680* OPEN THE CARTON LABEL-PRT TABLE CURSOR                         *14468045
144681******************************************************************14468145
144682 5410-OPEN-LABEL-PRT-CSR.                                         14468245
144683                                                                  14468345
144684     PERFORM WITH TEST AFTER                                      14468445
144685       VARYING PV-COUNTER FROM 1 BY 1                             14468545
144686         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14468645
144687                SQLCODE = ZERO)                                   14468745
144688                                                                  14468845
144689         EXEC SQL                                                 14468945
144690              OPEN LABEL-PRT-CSR                                  14469045
144691         END-EXEC                                                 14469145
144692                                                                  14469245
144693         EVALUATE TRUE                                            14469345
144694             WHEN SQLCODE = +0                                    14469445
144695             WHEN SQLCODE = -904                                  14469545
144696             WHEN SQLCODE = -911                                  14469645
144697             WHEN SQLCODE = -913                                  14469745
144698                 CONTINUE                                         14469845
144699             WHEN SQLWARN0 NOT EQUAL SPACE                        14469945
144700             WHEN SQLCODE NOT EQUAL ZERO                          14470045
144701                 MOVE DK-SHIPT-UNT-ID-ORIG  TO PV-DISP-SHIPT-UNT  14470145
144702                 MOVE '5410-OPEN-LABEL-PRT-CSR'                   14470245
144703                                      TO PV-ABEND-PARAGRAPH       14470345
144704                 MOVE 'ERROR OPENING CARTON LABEL-PRT CURSOR'     14470445
144705                                      TO PV-ABEND-OPER-MESSAGE-1  14470545
144706                 STRING 'SHIPT UNT ID: ' DELIMITED BY SIZE        14470645
144707                         PV-DISP-SHIPT-UNT                        14470745
144708                                         DELIMITED BY SIZE        14470845
144709                                   INTO PV-ABEND-OPER-MESSAGE-2   14470945
144710                 MOVE 'TLBPTDA' TO PV-ABEND-TABLE-1               14471045
144711                 PERFORM 9100-SQL-ABEND                           14471145
144712         END-EVALUATE                                             14471245
144713     END-PERFORM.                                                 14471345
144714                                                                  14471445
144715     IF  PV-COUNTER > PC-MAX-RETRIES                              14471545
144716         MOVE '5410-OPEN-LABEL-PRT-CSR'                           14471645
144717                                      TO PV-ABEND-PARAGRAPH       14471745
144718         MOVE 'MAX RETRIES ERROR OPENING CARTON LABEL-PRT CURSOR' 14471845
144719                                      TO PV-ABEND-OPER-MESSAGE-1  14471945
144720         STRING 'SHIPT UNT ID: ' DELIMITED BY SIZE                14472045
144721                PV-DISP-SHIPT-UNT                                 14472145
144722                                DELIMITED BY SIZE                 14472245
144723                                   INTO PV-ABEND-OPER-MESSAGE-2   14472345
144724         MOVE 'TSUCRDV' TO PV-ABEND-TABLE-1                       14472445
144725         PERFORM 9100-SQL-ABEND                                   14472545
144726     END-IF.                                                      14472645
144727                                                                  14472745
144728                                                                  14472845
144729******************************************************************14472945
144730* FETCH THE CARTON LABEL-PRT TALBE CURSOR                        *14473045
144731******************************************************************14473145
144732 5420-FETCH-LABEL-PRT-CSR.                                        14473245
144733                                                                  14473345
144734     EXEC SQL                                                     14473445
144735          FETCH LABEL-PRT-CSR                                     14473545
144736           INTO :LBPTDA-OPER-UNT-ID                               14473645
144737              , :LBPTDA-CRE-TMST                                  14473745
144738              , :LBPTDA-LBL-PRT-BTCH-ID                           14473845
144739              , :LBPTDA-CART-ACTN-CDE                             14473945
144740              , :LBPTDA-CART-LBL-TYP-CDE                          14474045
144741              , :LBPTDA-BRCDE-NBR                                 14474145
144742              , :LBPTDA-SU-MSSG-DAT-IND                           14474245
144743              , :LBPTDA-SU-FRE-ASTRA-IND                          14474345
144744              , :LBPTDA-MISDIR-OPER-UNT-ID                        14474454
144745     END-EXEC.                                                    14474554
144746                                                                  14474654
144747     EVALUATE TRUE                                                14474754
144748       WHEN SQLCODE = ZERO                                        14474854
144749           CONTINUE                                               14474954
144750       WHEN SQLCODE = +100                                        14475054
144751           SET PS-END-OF-CURSOR      TO TRUE                      14475154
144752       WHEN SQLWARN0 NOT EQUAL SPACE                              14475254
144753       WHEN SQLCODE NOT EQUAL ZERO                                14475354
144754           MOVE DK-SHIPT-UNT-ID-ORIG  TO PV-DISP-SHIPT-UNT        14475454
144755           MOVE '5420-FETCH-LABEL-PRT-CSR'                        14475554
144756                                     TO PV-ABEND-PARAGRAPH        14475654
144757           MOVE 'FETCH CARTON LABEL-PRT CURSOR'                   14475754
144758                                     TO PV-ABEND-OPER-MESSAGE-1   14475854
144759           STRING 'SHIPT UNT ID: ' DELIMITED BY SIZE              14475954
144760                  PV-DISP-SHIPT-UNT                               14476054
144761                                  DELIMITED BY SIZE               14476154
144762                                   INTO PV-ABEND-OPER-MESSAGE-2   14476254
144763           MOVE 'TLBPTDA' TO PV-ABEND-TABLE-1                     14476354
144764           PERFORM 9100-SQL-ABEND                                 14476454
144765     END-EVALUATE.                                                14476554
144766                                                                  14476654
144767                                                                  14476754
144768******************************************************************14476854
144769* CLOSE CARTON LABEL-PRT TABLE CURSOR                            *14476954
144770******************************************************************14477054
144771 5430-CLOSE-LABEL-PRT-CSR.                                        14477154
144772                                                                  14477254
144773     PERFORM WITH TEST AFTER                                      14477354
144774       VARYING PV-COUNTER FROM 1 BY 1                             14477454
144775         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    14477554
144776                SQLCODE = ZERO)                                   14477654
144777                                                                  14477754
144778         EXEC SQL                                                 14477854
144779              CLOSE LABEL-PRT-CSR                                 14477954
144780         END-EXEC                                                 14478054
144781                                                                  14478154
144782         EVALUATE TRUE                                            14478254
144783             WHEN SQLCODE = +0                                    14478354
144784             WHEN SQLCODE = -904                                  14478454
144785             WHEN SQLCODE = -911                                  14478554
144786             WHEN SQLCODE = -913                                  14478654
144787                 CONTINUE                                         14478754
144788             WHEN SQLWARN0 NOT EQUAL SPACE                        14478854
144789             WHEN SQLCODE NOT EQUAL ZERO                          14478954
144790                 MOVE DK-SHIPT-UNT-ID-ORIG  TO PV-DISP-SHIPT-UNT  14479054
144791                 MOVE '5430-CLOSE-LABEL-PRT-CSR'                  14479154
144792                                      TO PV-ABEND-PARAGRAPH       14479254
144793                 MOVE 'ERROR CLOSE CARTON LABEL-PRT CURSOR'       14479354
144794                                      TO PV-ABEND-OPER-MESSAGE-1  14479454
144795                 STRING 'SHIPT UNT ID: ' DELIMITED BY SIZE        14479554
144796                         PV-DISP-SHIPT-UNT                        14479654
144797                                         DELIMITED BY SIZE        14479754
144798                                   INTO PV-ABEND-OPER-MESSAGE-2   14479854
144799                 MOVE 'TLBPTDA' TO PV-ABEND-TABLE-1               14479954
144800                 PERFORM 9100-SQL-ABEND                           14480054
144801         END-EVALUATE                                             14480154
144802     END-PERFORM.                                                 14480254
144803                                                                  14480354
144804     IF  PV-COUNTER > PC-MAX-RETRIES                              14480454
144805         MOVE '5430-CLOSE-LABEL-PRT-CSR'                          14480554
144806                                      TO PV-ABEND-PARAGRAPH       14480654
144807         MOVE 'MAX RETRIES ERROR CLOSE CARTON LABEL-PRT CURSOR'   14480754
144808                                      TO PV-ABEND-OPER-MESSAGE-1  14480854
144809         STRING 'SHIPT UNT ID: ' DELIMITED BY SIZE                14480954
144810                PV-DISP-SHIPT-UNT                                 14481054
144811                                DELIMITED BY SIZE                 14481154
144812                                   INTO PV-ABEND-OPER-MESSAGE-2   14481254
144813         MOVE 'TLBPTDA' TO PV-ABEND-TABLE-1                       14481354
144814         PERFORM 9100-SQL-ABEND                                   14481454
144815     END-IF.                                                      14481554
144816                                                                  14481654
144817                                                                  14481754
144818******************************************************************14481854
144819* CONTROL THE PROCESSING OF THE MASTER CARTON CURSOR             *14481954
144820* TO BUILD THE DATA FOR THE CARTON ACTIVITY OUTPUT FILE          *14482054
144821******************************************************************14482154
144822 5440-PROCESS-LABEL-PRT-CSR.                                      14482254
144823                                                                  14482354
144824     MOVE SPACES TO SU173-CARTON-ACTIVITY.                        14482454
144825     IF  LBPTDA-OPER-UNT-ID > 0                                   14482554
144826         MOVE LBPTDA-OPER-UNT-ID    TO                            14482654
144827                 SU173-ACTIVITY-AT-DC-NBR                         14482754
144828     ELSE                                                         14482854
144830         MOVE LBPTDA-MISDIR-OPER-UNT-ID TO                        14483054
144831                 SU173-ACTIVITY-AT-DC-NBR                         14483154
144832     END-IF                                                       14483254
144833                                                                  14483354
144834     MOVE LBPTDA-CRE-TMST  TO PV-HOLD-TMST.                       14483454
144835                                                                  14483554
144836     IF LBPTDA-LBL-PRT-BTCH-ID  > 0                               14483654
144837        IF LBPTDA-CART-ACTN-CDE = 'Q'                             14483754
144838           MOVE 'RF AUDIT LABEL PRINT ' TO SU173-CARTON-ACTIVITY  14483854
144839        ELSE                                                      14483954
144840           IF LBPTDA-CART-LBL-TYP-CDE = 'S' AND                   14484054
144841              LBPTDA-SU-MSSG-DAT-IND  = ' ' AND                   14484154
144842              LBPTDA-SU-FRE-ASTRA-IND = ' '                       14484254
144843                MOVE 'RF LABEL PRINT' TO   SU173-CARTON-ACTIVITY  14484354
144844           ELSE                                                   14484454
144845                MOVE SPACES            TO PV-BAR-CODE-MSG-LBL     14484554
144846                MOVE LBPTDA-BRCDE-NBR  TO PV-BAR-CODE-TXT         14484654
144847                MOVE 'RF PRINT '       TO PV-BRCDE-PRINT-TXT      14484754
144848                MOVE PV-BAR-CODE-MSG-LBL TO                       14484854
144849                                        SU173-CARTON-ACTIVITY     14484954
144850           END-IF                                                 14485054
144851        END-IF                                                    14485154
144852     ELSE                                                         14485254
144853        IF LBPTDA-CART-ACTN-CDE = 'Q'                             14485354
144854           MOVE 'PNA AUDIT LABEL PRINT ' TO SU173-CARTON-ACTIVITY 14485454
144855        ELSE                                                      14485554
144856           IF LBPTDA-CART-LBL-TYP-CDE = 'S' AND                   14485654
144857              LBPTDA-SU-MSSG-DAT-IND  = ' ' AND                   14485754
144858              LBPTDA-SU-FRE-ASTRA-IND = ' '                       14485854
144859                MOVE 'PNA LABEL PRINT' TO   SU173-CARTON-ACTIVITY 14485954
144860           ELSE                                                   14486054
144861                MOVE SPACES            TO PV-BAR-CODE-MSG-LBL     14486154
144862                MOVE LBPTDA-BRCDE-NBR  TO PV-BAR-CODE-TXT         14486254
144863                MOVE 'PNA PRINT '       TO PV-BRCDE-PRINT-TXT     14486354
144864                MOVE PV-BAR-CODE-MSG-LBL TO                       14486454
144865                                        SU173-CARTON-ACTIVITY     14486554
144866           END-IF                                                 14486654
144867        END-IF                                                    14486754
144868     END-IF.                                                      14486854
144869                                                                  14486954
144870     PERFORM 7200-FORMAT-OUTPUT-DATE-TIME                         14487054
144871     PERFORM 8200-WRITE-OUTPUT                                    14487154
144872                                                                  14487254
144873     PERFORM 5420-FETCH-LABEL-PRT-CSR.                            14487354
144874                                                                  14487454
144875******************************************************************14487554
144876* CHECK TO SEE IF THE DATA ON THE INPUT FILE FOR THE DC IS TURNED 14487654
144877* ON FOR BEING EXTRACTED BY THIS PROGRAM.                         14487754
144878******************************************************************14487854
144879 7000-CHECK-FOR-EXTRACT.                                          14487954
144880                                                                  14488039
144900     EXEC SQL                                                     14490039
145000         SELECT  FUNC_TXT                                         14500039
145100           INTO :KRPRPM-FUNC-TXT                                  14510039
145200           FROM  TKRPRPM                                          14520039
145300           WHERE LOC_ID              = :DK-OPER-UNT-ID            14530039
145400             AND INTFC_SYS_CDE       = 'KHL'                      14540039
145500             AND SYS_PRC_FUNC_CDE    = 'DLCDPL'                   14550039
145600             AND FUNC_PRC_STAT_CDE   = 'AC'                       14560039
145700             AND FUNC_BEG_TMST      <= CURRENT TIMESTAMP          14570039
145800             AND FUNC_END_TMST      >= CURRENT TIMESTAMP          14580039
145900           WITH UR                                                14590039
146000     END-EXEC                                                     14600039
146100                                                                  14610039
146200     EVALUATE TRUE                                                14620039
146300         WHEN SQLCODE = ZERO                                      14630039
146400              SET PS-DC-EXTRACT-YES TO TRUE                       14640039
146500              MOVE DK-OPER-UNT-ID TO PV-DISP-DC-NBR               14650039
146600              DISPLAY ' '                                         14660039
146700              DISPLAY 'DC '                                       14670039
146800                      PV-DISP-DC-NBR                              14680039
146900                      ' IS SET UP FOR DATA EXTRACT'               14690039
147000         WHEN SQLCODE = +100                                      14700039
147100              MOVE DK-OPER-UNT-ID TO PV-DISP-DC-NBR               14710039
147200              DISPLAY ' '                                         14720039
147300              DISPLAY 'DC '                                       14730039
147400                      PV-DISP-DC-NBR                              14740039
147500                      ' IS NOT SET UP FOR DATA EXTRACT'           14750039
147600         WHEN SQLWARN0 NOT = SPACES                               14760039
147700         WHEN SQLCODE < ZERO                                      14770039
147800         WHEN SQLCODE > ZERO                                      14780039
147900             MOVE '7000-CHECK-FOR-EXTRACT         '               14790039
148000                             TO PV-ABEND-PARAGRAPH                14800039
148100             MOVE 'CHECK DC FOR EXTRACTING DATA   '               14810039
148200                             TO PV-ABEND-OPER-MESSAGE-1           14820039
148300             MOVE 'TKRPRPM ' TO PV-ABEND-TABLE-1                  14830039
148400             PERFORM 9100-SQL-ABEND                               14840039
148500                                                                  14850039
148600     END-EVALUATE.                                                14860039
148700                                                                  14870039
148800                                                                  14880039
148900******************************************************************14890039
149000*  THIS WILL FORMAT THE HOLD TIMESTAMP FIELD INTO THE DATE-TIME  *14900039
149100*  FIELD IN THE OUTPUT RECORD.                                   *14910039
149200******************************************************************14920039
149300 7200-FORMAT-OUTPUT-DATE-TIME.                                    14930039
149400                                                                  14940039
149500     MOVE '-'          TO SU173-DASH-01                           14950039
149600                          SU173-DASH-02.                          14960039
149700     MOVE ':'          TO SU173-COLON-01                          14970039
149800                          SU173-COLON-02.                         14980039
149900     MOVE SPACE        TO SU173-SPACE-01.                         14990039
150000                                                                  15000039
150100     MOVE PV-HOLD-TMST-YYYY   TO SU173-ACTIVITY-YYYY.             15010039
150200     MOVE PV-HOLD-TMST-MM     TO SU173-ACTIVITY-MM.               15020039
150300     MOVE PV-HOLD-TMST-DD     TO SU173-ACTIVITY-DD.               15030039
150400     MOVE PV-HOLD-TMST-HH     TO SU173-ACTIVITY-HH.               15040039
150500     MOVE PV-HOLD-TMST-MI     TO SU173-ACTIVITY-MI.               15050039
150600     MOVE PV-HOLD-TMST-SS     TO SU173-ACTIVITY-SS.               15060039
150700                                                                  15070039
150710     MOVE  PC-COMMA           TO SU173-COMMA-01                   15071049
150720                                 SU173-COMMA-02                   15072049
150730                                 SU173-COMMA-03                   15073049
150740                                 SU173-COMMA-04.                  15074049
150800******************************************************************15080039
150900*  READ THE DC SHIPPED SML FILE                                  *15090039
151000******************************************************************15100039
151100 8000-READ-INPUT.                                                 15110039
151200                                                                  15120039
151300     READ SU-DC-SHIP-SML-FILE                                     15130039
151400       INTO SU117-EXTRACT-RECORD                                  15140039
151500         AT END                                                   15150039
151600           SET PS-EOF-INPUT-FILE TO TRUE                          15160039
151700         NOT AT END                                               15170039
151800           ADD 1                  TO PV-INPUT-READ-COUNT          15180039
151900                                     PV-PROGRESSIVE-READ-COUNT    15190039
152000           IF  PV-PROGRESSIVE-READ-COUNT =                        15200039
152100               PC-PROGRESSIVE-READ-LIMIT                          15210039
152200               MOVE PV-INPUT-READ-COUNT TO PV-DISP-NBR            15220039
152300               DISPLAY 'PROGRESSIVE READ COUNT IS: '              15230039
152400                       PV-DISP-NBR                                15240039
152500               MOVE ZEROS TO PV-PROGRESSIVE-READ-COUNT            15250039
152600           END-IF                                                 15260039
152700     END-READ.                                                    15270039
152800                                                                  15280039
152900                                                                  15290039
153000******************************************************************15300039
153100*  WRITE THE OUTPUT RECORD                                       *15310039
153200******************************************************************15320039
153300 8200-WRITE-OUTPUT.                                               15330039
153400                                                                  15340039
153500     WRITE SU-SML-ACTIVITY-FILE-RECORD                            15350039
153600      FROM SU173-EXTRACT-RECORD.                                  15360039
153700                                                                  15370039
153800     ADD +1 TO PV-OUTPUT-WRITE-COUNT.                             15380039
153900                                                                  15390039
154000                                                                  15400039
154100******************************************************************15410039
154200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    15420039
154300*  ERROR OR WARNING CODE OCCURS.                                  15430039
154400******************************************************************15440039
154500 9100-SQL-ABEND.                                                  15450039
154600     MOVE SQLCODE    TO PV-SQLCODE.                               15460039
154700     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       15470039
154800                                                                  15480039
154900     DISPLAY '9100-SQL-ABEND'.                                    15490039
155000     DISPLAY '** ABEND              **'.                          15500039
155100     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    15510039
155200     DISPLAY '** PROGRAM            ** = ' PC-CURRENT-PROGRAM-NAME15520039
155300     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    15530039
155400     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      15540039
155500     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      15550039
155600     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      15560039
155700     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      15570039
155800     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-115580039
155900     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-215590039
156000     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-315600039
156100     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-415610039
156200     DISPLAY '**                    ** = '                        15620039
156300                                                                  15630039
156400******************************************************************15640039
156500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    15650039
156600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         15660039
156700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     15670039
156800* FORMAT.                                                         15680039
156900******************************************************************15690039
157000     COPY DPPD004.                                                15700039
157100                                                                  15710039
157200     MOVE +4013                  TO ABEND-CODE.                   15720039
157300     CALL 'ILBOABN0' USING ABEND-CODE.                            15730039
