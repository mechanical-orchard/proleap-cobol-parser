000100 IDENTIFICATION DIVISION.                                         00010019
000200 PROGRAM-ID.    TRKCS144.                                         00020019
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030019
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040019
000500 DATE-WRITTEN.  06-04-93.                                         00050019
000600 DATE-COMPILED.                                                   00060019
000700                                                                  00070019
000800*---------------------------------------------------------------* 00080019
000900*    Y144 - TRAFFIC FREIGHT MAINTENANCE                         * 00090019
001000*                                                               * 00100019
001100*    THIS PROGRAM WILL MAINTAIN THE FREIGHT CHARGE, TERMS AND   * 00110019
001200*    TOTAL WEIGHT FOR A FREIGHT BILL.                           * 00120019
001300*                                                               * 00130019
001400*    NO RECORDS CAN BE SELECTED.                                * 00140019
001500*                                                               * 00150019
001510* 07/30/2010  EKTA AGRAWAL             TKID: TKMAV49            * 00160019
001520*             MODIFIED TO DISPLAY THE TRIP ID AND WAREHOUSE     * 00170019
001530*             CARTON COUNT TO THE SCREEN.                       * 00180019
001540*             CHANGES TAGGED AS EA 07/30/2010                   * 00190019
001550*---------------------------------------------------------------* 00200019
001551* CHANGED 12-02-2011 CHRSITINE TWIEHAUS      WR40574              00210022
001552*         ADDED CARR-AUTH-ID                                      00220022
001553*---------------------------------------------------------------* 00230022
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00232026
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00233026
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00234026
263697*---------------------------------------------------------------* 00235026
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00236027
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00237027
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00238027
CICS  *-----------------------------------------------------------------00239027
001560                                                                  00240019
001580 ENVIRONMENT DIVISION.                                            00250019
001590                                                                  00260019
001600 DATA DIVISION.                                                   00270019
001700                                                                  00280019
001800 WORKING-STORAGE SECTION.                                         00290019
001900                                                                  00300019
002000 01  DK-DB2-KEYS.                                                 00310019
002100     05  DK-PO-NBR                      PIC  S9(09) COMP.         00320019
002200     05  DK-ORD-NBR                     PIC  S9(09) COMP.         00330019
002300     05  DK-REC-SEQ-NBR                 PIC  S9(09) COMP.         00340019
002400     05  DK-PRO-NBR                     PIC  X(22).               00350019
002500     05  DK-OWNER-SCAC-ID               PIC  X(04).               00360019
002600     05  DK-SHIPT-ID                    PIC  S9(09) COMP.         00370019
002700     05  DK-SHIPMT-SHIPT-ID             PIC  S9(09) COMP.         00380019
002800     05  DK-TRIP-ID                     PIC  S9(09) COMP.         00390019
002900                                                                  00400019
003000 01  DN-DB2-NULL-INDICATORS.                                      00410019
003100     05  DN-VEH-NBR                     PIC S9(04) VALUE +0       00420019
003200                                                    COMP.         00430019
003300     05  DN-TRIP-ID                     PIC S9(4)  VALUE +0       00440019
003400                                                    COMP.         00450019
003500     05  DN-SHIP-EST-AR-TMST            PIC S9(4)  VALUE +0       00460019
003600                                                    COMP.         00470019
003700 01  PA-PROGRAM-ACCUMULATORS.                                     00480019
003800     05  PA-TOT-DMG-CART-CNT          PIC S9(09)    COMP-3        00490019
003900                                                 VALUE +0.        00500019
004000     05  PA-TOT-FRGT-CHG              PIC S9(09)V99 COMP-3        00510019
004100                                                 VALUE +0.        00520019
004200     05  PA-SUM-CALC-FRGT-CHG         PIC S9(09)V99 COMP-3        00530019
004300                                                 VALUE +0.        00540019
004400     05  PA-TOT-FRGT-CHG-AMT          PIC S9(09)V99 COMP-3        00550019
004500                                                 VALUE +0.        00560019
004600     05  PA-DIFFERENCE                PIC S9(09)V99 COMP-3        00570019
004700                                                 VALUE +0.        00580019
004800     05  PA-CALC-FRGT-CHG1            PIC S9V9(07)  COMP-3        00590019
004900                                                 VALUE +0.        00600019
005000     05  PA-CALC-FRGT-CHG2            PIC S9(06)V99 COMP-3        00610019
005100                                                 VALUE +0.        00620019
005200                                                                  00630019
005300 01  PC-PROGRAM-CONSTANTS.                                        00640019
005400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00650019
005500                                                    'TR144A  '.   00660019
005600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00670019
005700                                                    'TRKM144 '.   00680019
005800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00690019
005900                                                    'TRKCS144'.   00700019
006000     05  PC-DPKCS060                    PIC  X(08)  VALUE         00710019
006100                                                    'DPKCS060'.   00720019
006200     05  PC-ONE                         PIC  X(02)  VALUE  '01'.  00730019
006300     05  PC-DPKUT500-PGM                PIC  X(08)  VALUE         00740019
006400                                                    'DPKUT500'.   00750019
006500     05  PC-U                           PIC  X(01)  VALUE 'U'.    00760019
006600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00770019
006700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00780019
006800     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00790019
006900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00800019
007000     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00810019
007100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00820019
007200                                                    COMP SYNC.    00830019
007300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00840019
007400                                                    COMP SYNC.    00850019
007500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00860019
007600                                                    +1000000      00870019
007700                                                    COMP-3.       00880019
007800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00890019
007900                                                    COMP SYNC.    00900019
008000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00910019
008100                                                    COMP-3.       00920019
008200     05  PC-DEFAULT-DTE                 PIC  X(10)                00930019
008300                                             VALUE '0001-01-01'.  00940019
008400                                                                  00950019
008500     05  PC-MULT                        PIC X(04)  VALUE 'MULT'.  00960019
008600     05  PC-REC-VERIFIED-MSG            PIC X(48)  VALUE          00970019
008700         'NOT ALL RECEIVERS VERIFIED FOR THIS FREIGHT BILL'.      00980019
008800                                                                  00990019
008900     05  PC-TSYMSG-NUMBERS.                                       01000019
009000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01010019
009100         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  01020019
009200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01030019
009300         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  01040019
009400         10  PC-TSYMSG-00010            PIC  9(05)  VALUE 00010.  01050019
009500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01060019
009600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01070019
009700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01080019
009800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01090019
009900         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  01100019
010000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01110019
010100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01120019
010200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01130019
010300         10  PC-TSYMSG-00460            PIC  9(05)  VALUE 00460.  01140019
010400         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  01150019
010500                                                                  01160019
010600 01  PS-PROGRAM-SWITCHES.                                         01170019
010700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01180019
010800         88  PS-NO-ERROR                            VALUE 'Y'.    01190019
010900         88  PS-ERROR                               VALUE 'N'.    01200019
011000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01210019
011100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01220019
011200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01230019
011300     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    01240019
011400         88  PS-LIST-END                            VALUE 'Y'.    01250019
011500         88  PS-NO-LIST-END                         VALUE 'N'.    01260019
011600     05  PS-EOF-UPD-RECEIVER-CSR-SW     PIC  X(01)  VALUE 'N'.    01270019
011700         88  PS-EOF-UPD-RECEIVER                    VALUE 'Y'.    01280019
011800                                                                  01290019
011900     05  PS-VE-STATUS-SW              PIC X(01)  VALUE 'N'.       01300019
012000         88  PS-VE-STATUS-YES                    VALUE 'Y'.       01310019
012100         88  PS-VE-STATUS-NO                     VALUE 'N'.       01320019
012200     05  PS-VALID-DATE-SW             PIC X(01)  VALUE 'N'.       01330019
012300         88  PS-VALID-DATE                       VALUE 'Y'.       01340019
012400         88  PS-INVALID-DATE                     VALUE 'N'.       01350019
012500     05  PS-MULTIPLE-SHIPMENTS-SW     PIC X(01)  VALUE 'S'.       01360019
012600         88  PS-MULTIPLE-SHIPMENTS               VALUE 'M'.       01370019
012700         88  PS-SINGLE-SHIPMENT                  VALUE 'S'.       01380019
012800                                                                  01390019
012900                                                                  01400019
013000 01  PV-PROGRAM-VARIABLES.                                        01410019
013100     05  PV-SUB                         PIC S9(04)   VALUE +0     01420019
013200                                                     COMP SYNC.   01430019
013300     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01440019
013400                                                     COMP SYNC.   01450019
013500     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01460019
013600                                                     COMP-3.      01470019
013700     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01480019
013800                                                     COMP-3.      01490019
013900     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01500019
014000                                                     COMP-3.      01510019
014100     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01520019
014200                                                     COMP SYNC.   01530019
014300     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01540019
014400                                                     COMP SYNC.   01550019
014500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01560019
014600                                                     COMP SYNC.   01570019
014700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01580019
014800                                                     COMP SYNC.   01590019
014900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01600019
015000                                                    COMP SYNC.    01610019
015100     05  PV-SHIPT-ID                    PIC S9(09)  VALUE +0      01620019
015200                                                    COMP SYNC.    01630019
015300     05  PV-PREV-SHIPT-ID               PIC S9(09)  VALUE +0      01640019
015400                                                    COMP SYNC.    01650019
015500     05  PV-DEFAULT-YEAR.                                         01660019
015600         10  PV-DEFAULT-CC              PIC  9(02).               01670019
015700         10  PV-DEFAULT-YY              PIC  9(02).               01680019
015800     05  PV-EIB-DATE                    PIC  9(07).               01690019
015900     05  FILLER REDEFINES PV-EIB-DATE.                            01700019
016000         10  FILLER                     PIC  9(02).               01710019
016100         10  PV-EIB-YY                  PIC  9(02).               01720019
016200         10  FILLER                     PIC  9(03).               01730019
016300     05  PV-REC-SEQ-NBR                 PIC  9(09).               01740019
016400                                                                  01750019
016500     05  PV-OLD-RCVR-NBR              PIC  9(9).                  01760019
016600     05  PV-OLD-RCVR-NBR-R REDEFINES PV-OLD-RCVR-NBR.             01770019
016700         10  PV-OLD-RCVR-NBR-1        PIC X(01).                  01780019
016800         10  PV-OLD-RCVR-NBR-2-8      PIC X(07).                  01790019
016900         10  PV-OLD-RCVR-NBR-9        PIC X(01).                  01800019
017000     05  PV-DEPT-NBR                  PIC  X(04).                 01810019
017100     05  PV-DEPT-NBR-N REDEFINES                                  01820019
017200         PV-DEPT-NBR                  PIC  9(04).                 01830019
017300* EA 07/30/2010                                                   01840019
017400     05  WS-PRCSD-CARTONS             PIC S9(9) VALUE ZERO        01850019
017500                                                COMP.             01860019
017600* EA 07/30/2010                                                   01870019
017700 01  PV-TRKCS141-COMMAREA.                                        01880019
017800     05  PV-CA-OWNER-SCAC-ID       PIC X(04).                     01890019
017900     05  PV-CA-PRO-NBR             PIC X(22).                     01900019
018000     05  PV-CA-PRINTER             PIC X(08).                     01910019
018100                                                                  01920019
018200/                                                                 01930019
018300*---------------------------------------------------------------* 01940019
018400*    MAP LAYOUT                                                 * 01950019
018500*---------------------------------------------------------------* 01960019
018600                                                                  01970019
018700     COPY TRKM144.                                                01980019
018800                                                                  01990019
018900 01  MR-OCCURS-LAYOUT                   REDEFINES  TR144AO.       02000019
019000     05  FILLER                         PIC X(48).                02010019
019100                                                                  02020019
019200     05  MR-PRINTERL                    PIC S9(04) COMP.          02030019
019300     05  MR-PRINTERA                    PIC X(01).                02040019
019400     05  MR-PRINTERC                    PIC X(01).                02050019
019500     05  MR-PRINTERH                    PIC X(01).                02060019
019600     05  MR-PRINTER                     PIC X(08).                02070019
019700                                                                  02080019
019800     05  MR-INVL                        PIC S9(04) COMP.          02090019
019900     05  MR-INVA                        PIC X(01).                02100019
020000     05  MR-INVC                        PIC X(01).                02110019
020100     05  MR-INVH                        PIC X(01).                02120019
020200     05  MR-INV                         PIC X(15).                02130019
020300                                                                  02140019
020400     05  MR-MONTHL                      PIC S9(04) COMP.          02150019
020500     05  MR-MONTHA                      PIC X(01).                02160019
020600     05  MR-MONTHC                      PIC X(01).                02170019
020700     05  MR-MONTHH                      PIC X(01).                02180019
020800     05  MR-MONTH                       PIC X(02).                02190019
020900                                                                  02200019
021000     05  MR-DAYL                        PIC S9(04) COMP.          02210019
021100     05  MR-DAYA                        PIC X(01).                02220019
021200     05  MR-DAYC                        PIC X(01).                02230019
021300     05  MR-DAYH                        PIC X(01).                02240019
021400     05  MR-DAY                         PIC X(02).                02250019
021500                                                                  02260019
021600     05  MR-YEARL                       PIC S9(04) COMP.          02270019
021700     05  MR-YEARA                       PIC X(01).                02280019
021800     05  MR-YEARC                       PIC X(01).                02290019
021900     05  MR-YEARH                       PIC X(01).                02300019
022000     05  MR-YEAR                        PIC X(04).                02310019
022100                                                                  02320019
022200     05  MR-OSCACL                      PIC S9(04) COMP.          02330019
022300     05  MR-OSCACA                      PIC X(01).                02340019
022400     05  MR-OSCACC                      PIC X(01).                02350019
022500     05  MR-OSCACH                      PIC X(01).                02360019
022600     05  MR-OSCAC                       PIC X(04).                02370019
022700                                                                  02380019
022800     05  MR-PROL                        PIC S9(04) COMP.          02390019
022900     05  MR-PROA                        PIC X(01).                02400019
023000     05  MR-PROC                        PIC X(01).                02410019
023100     05  MR-PROH                        PIC X(01).                02420019
023200     05  MR-PRO-NBR                     PIC X(22).                02430019
023300                                                                  02440019
023400     05  MR-SCACL                       PIC S9(04) COMP.          02450019
023500     05  MR-SCACA                       PIC X(01).                02460019
023600     05  MR-SCACC                       PIC X(01).                02470019
023700     05  MR-SCACH                       PIC X(01).                02480019
023800     05  MR-OWNER-SCAC-ID               PIC X(04).                02490019
023900                                                                  02500019
024000     05  MR-TRLRL                       PIC S9(04) COMP.          02510019
024100     05  MR-TRLRA                       PIC X(01).                02520019
024200     05  MR-TRLRC                       PIC X(01).                02530019
024300     05  MR-TRLRH                       PIC X(01).                02540019
024400     05  MR-VEH-NBR                     PIC X(10).                02550019
024500                                                                  02560019
024600     05  MR-FCHGL                       PIC S9(04) COMP.          02570019
024700     05  MR-FCHGA                       PIC X(01).                02580019
024800     05  MR-FCHGC                       PIC X(01).                02590019
024900     05  MR-FCHGH                       PIC X(01).                02600019
025000     05  MR-FRGT-CHG-X.                                           02610019
025100         10  MR-FRGT-CHG                PIC ZZZZZ9.99.            02620019
025200                                                                  02630019
025300     05  MR-TERML                       PIC S9(04) COMP.          02640019
025400     05  MR-TERMA                       PIC X(01).                02650019
025500     05  MR-TERMC                       PIC X(01).                02660019
025600     05  MR-TERMH                       PIC X(01).                02670019
025700     05  MR-TERMS                       PIC X(01).                02680019
025800                                                                  02690019
025900     05  MR-WGHTL                       PIC S9(04) COMP.          02700019
026000     05  MR-WGHTA                       PIC X(01).                02710019
026100     05  MR-WGHTC                       PIC X(01).                02720019
026200     05  MR-WGHTH                       PIC X(01).                02730019
026300     05  MR-FRGT-WGHT-X.                                          02740019
026400         10  MR-FRGT-WGHT               PIC ZZZZZ9.               02750019
026500* EA 07/30/2010                                                   02760019
026501                                                                  02770019
026502     05  MR-TRIPL                       PIC S9(04) COMP.          02780019
026503     05  MR-TRIPA                       PIC X(01).                02790019
026504     05  MR-TRIPC                       PIC X(01).                02800019
026505     05  MR-TRIPH                       PIC X(01).                02810019
026506     05  MR-WHSE-TRIP-X.                                          02820019
026507         10  MR-WHSE-TRIP               PIC ZZZZZZZZZ.            02830019
026508                                                                  02840019
026509                                                                  02850019
026510     05  MR-WCTNL                       PIC S9(04) COMP.          02860019
026520     05  MR-WCTNA                       PIC X(01).                02870019
026530     05  MR-WCTNC                       PIC X(01).                02880019
026540     05  MR-WCTNH                       PIC X(01).                02890019
026550     05  MR-WHSE-WCTN-X.                                          02900019
026560         10  MR-WHSE-WCTN               PIC ZZZZZZZ.              02910019
026570                                                                  02920019
026580* EA 07/30/2010                                                   02930019
026590     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02940019
026600         10  MR-PO-NBRL                 PIC S9(04) COMP.          02950019
026700         10  MR-PO-NBRA                 PIC X(01).                02960019
026800         10  MR-PO-NBRC                 PIC X(01).                02970019
026900         10  MR-PO-NBRH                 PIC X(01).                02980019
044600** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  02990025
027000         10  MR-PO-NBR                  PIC X(08).                03000025
027100                                                                  03010019
027200         10  MR-DC-NBRL                 PIC S9(04) COMP.          03020019
027300         10  MR-DC-NBRA                 PIC X(01).                03030019
027400         10  MR-DC-NBRC                 PIC X(01).                03040019
027500         10  MR-DC-NBRH                 PIC X(01).                03050019
027600         10  MR-DC-NBR                  PIC X(04).                03060019
027700                                                                  03070019
027800         10  MR-REC-SEQ-NBRL            PIC S9(04) COMP.          03080019
027900         10  MR-REC-SEQ-NBRA            PIC X(01).                03090019
028000         10  MR-REC-SEQ-NBRC            PIC X(01).                03100019
028100         10  MR-REC-SEQ-NBRH            PIC X(01).                03110019
028200         10  MR-REC-SEQ-NBR             PIC X(04).                03120019
028300                                                                  03130019
028400         10  MR-DEPTL                   PIC S9(04) COMP.          03140019
028500         10  MR-DEPTA                   PIC X(01).                03150019
028600         10  MR-DEPTC                   PIC X(01).                03160019
028700         10  MR-DEPTH                   PIC X(01).                03170019
028800         10  MR-DEPT                    PIC X(04).                03180019
028900                                                                  03190019
029000         10  MR-CLASSL                  PIC S9(04) COMP.          03200019
029100         10  MR-CLASSA                  PIC X(01).                03210019
029200         10  MR-CLASSC                  PIC X(01).                03220019
029300         10  MR-CLASSH                  PIC X(01).                03230019
029400         10  MR-CLASS                   PIC X(04).                03240019
029500                                                                  03250019
029600         10  MR-CTN-CNTL                PIC S9(04) COMP.          03260019
029700         10  MR-CTN-CNTA                PIC X(01).                03270019
029800         10  MR-CTN-CNTC                PIC X(01).                03280019
029900         10  MR-CTN-CNTH                PIC X(01).                03290019
030000         10  MR-CTN-CNT-X.                                        03300019
030100             15  MR-CTN-CNT             PIC ZZZ9.                 03310019
030200                                                                  03320019
030300         10  MR-ADJ-CNTL                PIC S9(04) COMP.          03330019
030400         10  MR-ADJ-CNTA                PIC X(01).                03340019
030500         10  MR-ADJ-CNTC                PIC X(01).                03350019
030600         10  MR-ADJ-CNTH                PIC X(01).                03360019
030700         10  MR-ADJ-CNT-X.                                        03370019
030800             15  MR-ADJ-CNT             PIC ZZZ9.                 03380019
030900                                                                  03390019
031000         10  MR-DMG-CNTL                PIC S9(04) COMP.          03400019
031100         10  MR-DMG-CNTA                PIC X(01).                03410019
031200         10  MR-DMG-CNTC                PIC X(01).                03420019
031300         10  MR-DMG-CNTH                PIC X(01).                03430019
031400         10  MR-DMG-CNT-X.                                        03440019
031500             15  MR-DMG-CNT             PIC ZZZ9.                 03450019
031600                                                                  03460019
031700         10  MR-CHGSL                   PIC S9(04) COMP.          03470019
031800         10  MR-CHGSA                   PIC X(01).                03480019
031900         10  MR-CHGSC                   PIC X(01).                03490019
032000         10  MR-CHGSH                   PIC X(01).                03500019
032100         10  MR-CHGS-X.                                           03510019
032200             15  MR-CHARGES             PIC ZZZZ9.99.             03520019
032300                                                                  03530019
032400     05  MR-TOT-CTN-CNTL                PIC S9(04) COMP.          03540019
032500     05  MR-TOT-CTN-CNTA                PIC X(01).                03550019
032600     05  MR-TOT-CTN-CNTC                PIC X(01).                03560019
032700     05  MR-TOT-CTN-CNTH                PIC X(01).                03570019
032800     05  MR-TOT-CTN-CNT-X.                                        03580019
032900         10  MR-TOT-CTN-CNT             PIC ZZZZ9.                03590019
033000                                                                  03600019
033100     05  MR-TOT-ADJ-CNTL                PIC S9(04) COMP.          03610019
033200     05  MR-TOT-ADJ-CNTA                PIC X(01).                03620019
033300     05  MR-TOT-ADJ-CNTC                PIC X(01).                03630019
033400     05  MR-TOT-ADJ-CNTH                PIC X(01).                03640019
033500     05  MR-TOT-ADJ-CNT-X.                                        03650019
033600         10  MR-TOT-ADJ-CNT             PIC ZZZZ9.                03660019
033700                                                                  03670019
033800     05  MR-TOT-DMG-CNTL                PIC S9(04) COMP.          03680019
033900     05  MR-TOT-DMG-CNTA                PIC X(01).                03690019
034000     05  MR-TOT-DMG-CNTC                PIC X(01).                03700019
034100     05  MR-TOT-DMG-CNTH                PIC X(01).                03710019
034200     05  MR-TOT-DMG-CNT-X.                                        03720019
034300         10  MR-TOT-DMG-CNT             PIC ZZZZ9.                03730019
034400                                                                  03740019
034500     05  MR-TOT-CHGSL                   PIC S9(04) COMP.          03750019
034600     05  MR-TOT-CHGSA                   PIC X(01).                03760019
034700     05  MR-TOT-CHGSC                   PIC X(01).                03770019
034800     05  MR-TOT-CHGSH                   PIC X(01).                03780019
034900     05  MR-TOT-CHGS-X.                                           03790019
035000         10  MR-TOT-CHGS                PIC ZZZZZ9.99.            03800019
035100                                                                  03810019
035200/                                                                 03820019
035300*---------------------------------------------------------------* 03830019
035400*    ABEND PROCESSING COPYBOOK.                                 * 03840019
035500*---------------------------------------------------------------* 03850019
035600     COPY DPWS013.                                                03860019
035700                                                                  03870019
035800/                                                                 03880019
035900*---------------------------------------------------------------* 03890019
036000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03900019
036100*---------------------------------------------------------------* 03910019
036200     COPY DPWS015.                                                03920019
036300                                                                  03930019
036400*---------------------------------------------------------------* 03940019
036500*    FUNCTION KEYS COPYBOOK.                                    * 03950019
036600*---------------------------------------------------------------* 03960019
036700     COPY DPWS016.                                                03970019
036800                                                                  03980019
036900*----------------------------------------------------------------*03990019
037000*    COMMAREA COPYBOOK TO LINK TO DPKCS060 - PRINT DEST VALIDATION04000019
037100*----------------------------------------------------------------*04010019
037200                                                                  04020019
037300     COPY DPWS072.                                                04030019
037400                                                                  04040019
037500*---------------------------------------------------------------* 04050019
037600*    NUMERIC EDIT LAYOUT.                                       * 04060019
037700*---------------------------------------------------------------* 04070019
037800     COPY DPWS010I.                                               04080019
037900                                                                  04090019
038000/                                                                 04100019
038100*---------------------------------------------------------------* 04110019
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04120027
038300*---------------------------------------------------------------* 04130019
038400     COPY DPWS030.                                                04140019
CICS       COPY DPWS930.                                                04150027
038600/                                                                 04160019
038700*---------------------------------------------------------------* 04170019
038800*    STANDARD COMMAREA.                                         * 04180019
038900*---------------------------------------------------------------* 04190019
039000     COPY DPWS020.                                                04200019
039100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04210019
039200                                                                  04220019
039300*---------------------------------------------------------------* 04230019
039400* INTER-APPLICATION COMMAREA.                                   * 04240019
039500*---------------------------------------------------------------* 04250019
039600                                                                  04260019
039700         10  INTER-APPL-COMM-AREA       PIC X(200).               04270019
039800     COPY TRWS013.                                                04280019
039900     COPY TRWS014.                                                04290019
040000*---------------------------------------------------------------* 04300019
040100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04310019
040200*---------------------------------------------------------------* 04320019
040300         10  ASC-SPECIFIC-COMMAREA.                               04330019
040400             15  ASC-LIST-KEYS.                                   04340019
040500                 20  ASC-KEY-OWNER-SCAC-ID PIC X(04).             04350019
040600                 20  ASC-KEY-PRO-NBR    PIC X(22).                04360019
040700             15  ASC-COMPLETE-PRO-NBR   PIC X(22).                04370019
040800             15  ASC-VEH-NBR            PIC X(10).                04380019
040900             15  ASC-SHIPT-ID-L         PIC S9(09)  COMP.         04390019
041000             15  ASC-PO-NBR-L           PIC S9(09)  COMP.         04400019
041100             15  ASC-REC-SEQ-NBR-L      PIC S9(09)  COMP.         04410019
041200             15  ASC-FRGT-CHG           PIC X(09).                04420019
041300             15  ASC-FRGT-CHG-N         PIC 9(06)V99.             04430019
041400             15  ASC-TERMS              PIC X(01).                04440019
041500             15  ASC-FRGT-WGHT          PIC X(06).                04450019
041600             15  ASC-FRGT-WGHT-N REDEFINES ASC-FRGT-WGHT          04460019
041700                                        PIC 9(06).                04470019
041701* EA 07/30/2010                                                   04480019
041702             15  ASC-WHSE-TRIP          PIC X(09).                04490019
041703             15  ASC-WHSE-TRIP-N REDEFINES ASC-WHSE-TRIP          04500019
041704                                        PIC 9(09).                04510019
041705             15  ASC-WHSE-WCTN          PIC X(07).                04520019
041706             15  ASC-WHSE-WCTN-N REDEFINES ASC-WHSE-WCTN          04530019
041707                                        PIC 9(07).                04540019
041708* EA 07/30/2010                                                   04550019
041709             15  ASC-TOT-CTN            PIC X(05).                04560019
041710             15  ASC-TOT-CTN-N REDEFINES ASC-TOT-CTN              04570019
041720                                        PIC 9(05).                04580019
041730             15  ASC-TOT-CTN-1          PIC X(05).                04590019
041740             15  ASC-TOT-CTN-1-N REDEFINES ASC-TOT-CTN-1          04600019
041750                                        PIC 9(05).                04610019
041760             15  ASC-TOT-ADJ            PIC X(05).                04620019
041770             15  ASC-TOT-ADJ-N REDEFINES ASC-TOT-ADJ              04630019
041780                                        PIC 9(05).                04640019
041790             15  ASC-TOT-DMG            PIC X(05).                04650019
041800             15  ASC-TOT-DMG-N REDEFINES ASC-TOT-DMG              04660019
041900                                        PIC 9(05).                04670019
042000             15  ASC-TOT-CHGS           PIC X(08).                04680019
042100             15  ASC-TOT-CHGS-N REDEFINES ASC-TOT-CHGS            04690019
042200                                        PIC 9(06)V99.             04700019
042300             15  ASC-ORIG-SCAC-ID       PIC X(04).                04710019
042400             15  ASC-PROCESSED-DTE.                               04720019
042500                 20  ASC-PROCESSED-YY       PIC X(04).            04730019
042600                 20  FILLER                 PIC X(01).            04740019
042700                 20  ASC-PROCESSED-MM       PIC X(02).            04750019
042800                 20  FILLER                 PIC X(01).            04760019
042900                 20  ASC-PROCESSED-DD       PIC X(02).            04770019
043000             15  ASC-OLD-PROCESSED-YY   PIC X(04).                04780019
043100             15  ASC-INVC-NBR           PIC X(15).                04790019
043200             15  ASC-PRINTER-ID-X.                                04800019
043300                 20  ASC-PRINTER-ID          PIC  9(08).          04810019
043400                 20  FILLER REDEFINES ASC-PRINTER-ID.             04820019
043500                     25  ASC-PRINTER-ID-1-1  PIC  X(01).          04830019
043600                     25  ASC-PRINTER-ID-2-8  PIC  X(07).          04840019
043700                     25  ASC-PRINTER-ID-2-8-N REDEFINES           04850019
043800                         ASC-PRINTER-ID-2-8  PIC  9(07).          04860019
043900             15  ASC-TOT-CART-CNT            PIC S9(09)    COMP-3.04870019
044000             15  ASC-TOT-ACTL-CART-CNT       PIC S9(09)    COMP-3.04880019
044100             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           04890019
044200                 20  ASC-ITEM-ARRAY.                              04900019
044300                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04910019
044400                         30  ASC-LIST-ITEM-NUMBER                 04920019
044500                                        PIC S9(09) COMP-3.        04930019
044600** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  04940025
044600                         30  ASC-PO-NBR     PIC 9(08).            04950025
044700                         30  ASC-DC-NBR     PIC X(04).            04960019
044800                         30  ASC-REC-SEQ-NBR PIC 9(04).           04970019
044900*GB01/27/2011            30  ASC-OLD-RCVR.                        04980021
045000*                            35  ASC-OLD-RCVR-NBR   PIC X(07).    04990020
045100*                            35  ASC-OLD-RCVR-DASH  PIC X(01).    05000020
045200*GB                          35  ASC-OLD-RCVR-CKDG  PIC X(01).    05010021
045300                         30  ASC-DEPT       PIC 9(04).            05020019
045400                         30  ASC-CLASS      PIC 9(04).            05030019
045500                         30  ASC-CTN-CNT    PIC 9(04).            05040019
045600                         30  ASC-ADJ-CNT    PIC 9(04).            05050019
045700                         30  ASC-DMG-CNT    PIC 9(04).            05060019
045800                         30  ASC-CHGS       PIC 9(05)V99.         05070019
045900                                                                  05080019
046000             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     05090019
046100             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     05100019
046200             15  ASC-SEL-SUB            PIC S9(04) COMP SYNC.     05110019
046300             15  ASC-SEL-ITEM           PIC S9(04) COMP SYNC.     05120019
046400             15  ASC-NUMBER-OF-ITEMS-READ                         05130019
046500                                        PIC S9(09) COMP-3.        05140019
046600             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        05150019
046700             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        05160019
046800             15  ASC-ITEM-AT-TOP-OF-PANEL                         05170019
046900                                        PIC S9(09) COMP-3.        05180019
047000             15  ASC-ITEM-AT-BOT-OF-PANEL                         05190019
047100                                        PIC S9(09) COMP-3.        05200019
047200             15  ASC-HIGHEST-BLOCK-WRITTEN                        05210019
047300                                        PIC S9(04) COMP SYNC.     05220019
047400             15  ASC-ITEMS-LEFT-INDICATOR                         05230019
047500                                        PIC  X(01).               05240019
047600                 88  ASC-ITEMS-LEFT-ON-DB     VALUE 'Y'.          05250019
047700                 88  ASC-NO-ITEMS-LEFT-ON-DB  VALUE 'N'.          05260019
047800             15  ASC-USE-SELECTION-QUEUE-IND                      05270019
047900                                        PIC  X(01).               05280019
048000                 88  ASC-USE-SELECTION-QUEUE  VALUE 'Y'.          05290019
048100             15  ASC-DTL-QUEUE-NAME.                              05300019
048200                 20  ASC-DTL-TERM-ID     PIC  X(04).              05310019
048300                 20  ASC-DTL-TASK-NUMBER PIC S9(05) COMP-3.       05320019
048400                 20  ASC-DTL-SEQ         PIC  9(01).              05330019
048500             15  ASC-SEL-QUEUE-NAME.                              05340019
048600                 20  ASC-SEL-TERM-ID     PIC  X(04).              05350019
048700                 20  ASC-SEL-TASK-NUMBER PIC S9(05) COMP-3.       05360019
048800                 20  ASC-SEL-SEQ         PIC  9(01).              05370019
048900                                                                  05380019
049000             15  ASC-START-ITEM-REQUEST.                          05390019
049100                 20  ASC-START-ITEM-REQUEST-N                     05400019
049200                                        PIC 9(07).                05410019
049300                                                                  05420019
049400/                                                                 05430019
049500*---------------------------------------------------------------* 05440019
049600*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 05450019
049700*---------------------------------------------------------------* 05460019
049800     COPY TRWS015.                                                05470019
049900                                                                  05480019
050000/                                                                 05490019
050100*----------------------------------------------------------------*05500019
050200*  WORK AREA PASSED IN CALL TO DPKUT500                          *05510019
050300*----------------------------------------------------------------*05520019
050400     COPY DPWS500.                                                05530019
050500                                                                  05540019
050600/                                                                 05550019
050700*                                                                 05560019
050800*  DCLGEN FOR THE DB2 RECEIVER TABLE                              05570019
050900*                                                                 05580019
051000     EXEC SQL                                                     05590019
051100         INCLUDE TRECEIV                                          05600019
051200     END-EXEC.                                                    05610019
051300                                                                  05620019
051400/                                                                 05630019
051500*                                                                 05640019
051600*  DCLGEN FOR THE DB2 VEHICLE TRIP TABLE                          05650019
051700*                                                                 05660019
051800     EXEC SQL                                                     05670019
051900         INCLUDE TVHTRIP                                          05680019
052000     END-EXEC.                                                    05690019
052100                                                                  05700019
052200/                                                                 05710019
052300*                                                                 05720019
052400*  DCLGEN FOR THE DB2 SHIPMENT PO TABLE                           05730019
052500*                                                                 05740019
052600     EXEC SQL                                                     05750019
052700         INCLUDE TSHPTPO                                          05760019
052800     END-EXEC.                                                    05770019
052900                                                                  05780019
053000/                                                                 05790019
053100*                                                                 05800019
053200*  DCLGEN FOR THE DB2 AUDIT SHIPMENT PO TABLE                     05810019
053300*                                                                 05820019
053400     EXEC SQL                                                     05830019
053500         INCLUDE TAUSHPO                                          05840019
053600     END-EXEC.                                                    05850019
053700                                                                  05860019
053800/                                                                 05870019
053900*                                                                 05880019
054000*  DCLGEN FOR THE DB2 SHIPMENT TABLE                              05890019
054100*                                                                 05900019
054200     EXEC SQL                                                     05910019
054300         INCLUDE TSHIPMT                                          05920019
054400     END-EXEC.                                                    05930019
054500                                                                  05940019
054600/                                                                 05950019
054700*---------------------------------------------------------------* 05960019
054800*    DB2 AREA FOR THE SHIPMENT AUDIT TABLE                      * 05970019
054900*---------------------------------------------------------------* 05980019
055000     EXEC SQL                                                     05990019
055100          INCLUDE TAUSHIP                                         06000019
055200     END-EXEC.                                                    06010019
055300                                                                  06020019
055400/                                                                 06030019
055500*---------------------------------------------------------------* 06040019
055600*    DB2 AREA FOR THE SHIPMENT STATUS TABLE                     * 06050019
055700*---------------------------------------------------------------* 06060019
055800     EXEC SQL                                                     06070019
055900          INCLUDE TSHIPST                                         06080019
056000     END-EXEC.                                                    06090019
056100                                                                  06100019
056200/                                                                 06110019
056300*                                                                 06120019
056400*  DCLGEN FOR THE DB2 PURCHASE ORDER LINE ITEM TABLE              06130019
056500*                                                                 06140019
056600     EXEC SQL                                                     06150019
056700         INCLUDE TPURITM                                          06160019
056800     END-EXEC.                                                    06170019
056900                                                                  06180019
057000/                                                                 06190019
057100*                                                                 06200019
057200*  DCLGEN FOR THE DB2 PURCHASE ORDER TABLE                        06210019
057300*                                                                 06220019
057400     EXEC SQL                                                     06230019
057500         INCLUDE TPURCHS                                          06240019
057600     END-EXEC.                                                    06250019
057700                                                                  06260019
057800/                                                                 06270019
057900*---------------------------------------------------------------* 06280019
058000*    DB2 AREA FOR THE SHIPMENT STATUS CODE TABLE                * 06290019
058100*---------------------------------------------------------------* 06300019
058200     EXEC SQL                                                     06310019
058300          INCLUDE TSHSTYP                                         06320019
058400     END-EXEC.                                                    06330019
058500                                                                  06340019
058600/                                                                 06350019
058700*---------------------------------------------------------------* 06360019
058800*    DB2 AREA FOR THE TSKXREF TABLE                             * 06370019
058900*---------------------------------------------------------------* 06380019
059000     EXEC SQL                                                     06390019
059100          INCLUDE TSKXREF                                         06400019
059200     END-EXEC.                                                    06410019
059300/                                                                 06420019
059400* EA 07/30/2010                                                   06430019
059500     EXEC SQL                                                     06440019
059600        INCLUDE SUT00024                                          06450019
059700     END-EXEC.                                                    06460019
059800                                                                  06470019
059900     EXEC SQL                                                     06480019
060000        INCLUDE SUT00027                                          06490019
060100     END-EXEC.                                                    06500019
060200                                                                  06510019
060300* EA 07/30/2010                                                   06520019
060400*---------------------------------------------------------------* 06530019
060500*    DB2 AREA FOR COMMUNICATIONS                                * 06540019
060600*---------------------------------------------------------------* 06550019
060700     EXEC SQL                                                     06560019
060800          INCLUDE SQLCA                                           06570019
060900     END-EXEC.                                                    06580019
061000                                                                  06590019
061100/                                                                 06600019
061200*---------------------------------------------------------------* 06610019
061300*  CURSOR TO SELECT ALL RECEIVERS FOR A FREIGHT BILL            * 06620019
061400*---------------------------------------------------------------* 06630019
061500* EA 07/30/2010  ADDED TRIP ID                                    06640019
061600     EXEC SQL                                                     06650019
061700         DECLARE RECEIVER-CSR CURSOR FOR                          06660019
061800             SELECT  DISTINCT                                     06670019
061900                     A.ORD_NBR                                    06680019
062000                    ,A.REC_SEQ_NBR                                06690019
062100                    ,A.RCVR_NBR                                   06700019
062200                    ,A.STATUS_CDE                                 06710019
062300                    ,A.EXPTED_CART_CNT                            06720019
062400                    ,A.ACTL_CART_CNT                              06730019
062500                    ,A.OPER_UNT_ID                                06740019
062600                    ,B.OWNER_SCAC_ID                              06750019
062700                    ,B.VEH_NBR                                    06760019
062800                    ,B.TRIP_ID                                    06770019
062900                    ,C.SHIPT_ID                                   06780019
063000                    ,C.PO_NBR                                     06790019
063100                    ,C.EXPTED_CART_CNT                            06800019
063200                    ,C.ACTL_CART_CNT                              06810019
063300                    ,C.DMG_CART_CNT                               06820019
063400                    ,C.FRGT_CHG_AMT                               06830019
063500                    ,D.FRGT_TERMS_CDE                             06840019
063600                    ,D.EXPTED_GRO_WGHT                            06850019
063700                    ,D.COMPLETE_PRO_NBR                           06860019
063800                    ,E.DEPT_NBR                                   06870019
063900               FROM TRECEIV A                                     06880019
064000                   ,TVHTRIP B                                     06890019
064100                   ,TSHPTPO C                                     06900019
064200                   ,TSHIPMT D                                     06910019
064300                   ,TPURCHS E                                     06920019
064400              WHERE D.PRO_NBR        = :DK-PRO-NBR                06930019
064500                AND D.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID          06940019
064600                AND A.VER_STATUS_CDE = 'A'                        06950019
064700                AND A.ORD_NBR      = C.PO_NBR                     06960019
064800                AND C.PO_NBR       = E.PO_NBR                     06970019
064900                AND E.VER_STATUS_CDE = 'A'                        06980019
065000                AND A.REC_SEQ_NBR  = C.REC_SEQ_NBR                06990019
065100                AND C.SHIPT_ID     = D.SHIPT_ID                   07000019
065200                AND D.TRIP_ID      = B.TRIP_ID                    07010019
065300           ORDER BY A.ORD_NBR                                     07020019
065400                   ,A.REC_SEQ_NBR                                 07030019
065500     END-EXEC.                                                    07040019
065600                                                                  07050019
065700/                                                                 07060019
065800*---------------------------------------------------------------* 07070019
065900*  CURSOR TO SELECT ALL RECEIVERS FOR A FREIGHT BILL FOR UPDATES* 07080019
066000*---------------------------------------------------------------* 07090019
066100                                                                  07100019
066200     EXEC SQL                                                     07110019
066300         DECLARE RECEIVER-UPD-CSR CURSOR FOR                      07120019
066400             SELECT A.ORD_NBR                                     07130019
066500                  , A.REC_SEQ_NBR                                 07140019
066600                  , A.EXPTED_CART_CNT                             07150019
066700                  , A.ACTL_CART_CNT                               07160019
066800                  , A.OPER_UNT_ID                                 07170019
066900                  , C.SHIPT_ID                                    07180019
067000                  , C.PO_NBR                                      07190019
067100                  , C.EXPTED_CART_CNT                             07200019
067200                  , C.ACTL_CART_CNT                               07210019
067300                  , D.SHIPT_ID                                    07220019
067400               FROM TRECEIV A,                                    07230019
067500                    TVHTRIP B,                                    07240019
067600                    TSHPTPO C,                                    07250019
067700                    TSHIPMT D                                     07260019
067800              WHERE D.PRO_NBR        = :DK-PRO-NBR                07270019
067900                AND D.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID          07280019
068000                AND A.VER_STATUS_CDE = 'A'                        07290019
068100                AND A.ORD_NBR      = C.PO_NBR                     07300019
068200                AND A.REC_SEQ_NBR  = C.REC_SEQ_NBR                07310019
068300                AND C.SHIPT_ID     = D.SHIPT_ID                   07320019
068400                AND D.TRIP_ID      = B.TRIP_ID                    07330019
068500           ORDER BY D.SHIPT_ID                                    07340019
068600     END-EXEC.                                                    07350019
068700                                                                  07360019
068800/                                                                 07370019
068900 LINKAGE SECTION.                                                 07380019
069000                                                                  07390019
069100 01  DFHCOMMAREA.                                                 07400019
069200     05  FILLER                         OCCURS  1 TO 4072 TIMES   07410019
069300                                        DEPENDING ON EIBCALEN.    07420019
069400         10  FILLER                     PIC X.                    07430019
069500                                                                  07440019
069600/                                                                 07450019
069700 PROCEDURE DIVISION.                                              07460019
069800*---------------------------------------------------------------* 07470019
069900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07480019
070000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07490019
070100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07500019
070200*---------------------------------------------------------------* 07510019
070300 0000-MAIN-MODULE.                                                07520019
070400                                                                  07530019
070500     INITIALIZE DP030-CICS-API-FIELDS.                            07540019
070600                                                                  07550019
070700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07560019
070800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07570019
070900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07580019
071000                                                                  07590019
071100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07600019
071200                                                                  07610019
071300     MOVE LENGTH OF TR144AI        TO DP030-MAP-LENGTH (1).       07620019
071400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07630019
071500                                                                  07640019
071600     PERFORM 0001-CALL-CICS-ARCH-API.                             07650019
071700     PERFORM 1000-CONTROL-PROCESSING                              07660019
071800                                                                  07670019
071900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07680019
072000     PERFORM 0001-CALL-CICS-ARCH-API.                             07690019
072100                                                                  07700019
072200*---------------------------------------------------------------* 07710019
072300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 07720019
072400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 07730019
072500*---------------------------------------------------------------* 07740019
072600 0001-CALL-CICS-ARCH-API.                                         07750019
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07760027
072800                                    DFHCOMMAREA                   07770027
072900                                    DP030-CICS-API-FIELDS         07780027
073000                                    DP020-STANDARD-COMMAREA       07790027
073100                                    TR144AI.                      07800027
073200                                                                  07810019
073300     IF  DP030-RC-CALL-SUCCESSFUL                                 07820019
073400         CONTINUE                                                 07830019
073500     ELSE                                                         07840019
073600         SET DP013-NO-ROLLBACK                                    07850019
073700             DP013-XCTL-DISPLAY-RESTART                           07860019
073800             DP013-CICS-ABEND      TO TRUE                        07870019
073900         MOVE '0001-CALL-CICS-ARCH-API'                           07880019
074000                                   TO DP013-PARAGRAPH             07890019
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07900027
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07910027
074300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07920019
074400         PERFORM DP013-0000-PROCESS-ABEND                         07930019
074500     END-IF.                                                      07940019
074600                                                                  07950019
074700*----------------------------------------------------------------*07960019
074800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07970019
074900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07980019
075000*                                                                *07990019
075100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *08000019
075200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *08010019
075300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08020019
075400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08030019
075500*----------------------------------------------------------------*08040019
075600                                                                  08050019
075700 1000-CONTROL-PROCESSING.                                         08060019
075800                                                                  08070019
075900     EVALUATE TRUE                                                08080019
076000         WHEN DP020-NEXT-ACT-INITIAL                              08090019
076100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08100019
076200             MOVE EIBTRMID         TO ASC-DTL-TERM-ID             08110019
076300             MOVE DP020-SRC-TASK-NUMBER                           08120019
076400                                   TO ASC-DTL-TASK-NUMBER         08130019
076500             MOVE PC-DTL-QUEUE-SEQ TO ASC-DTL-SEQ                 08140019
076600                                                                  08150019
076700***-----$TEMPLATE NOTE$-------------------------------------------08160019
076800*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,08170019
076900*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  08180019
077000*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.08190019
077100***---------------------------------------------------------------08200019
077200             IF  PS-COMMAREA-NOT-VALID                            08210019
077300                 SET DP020-NEXT-ACT-APPL-ERROR                    08220019
077400                                   TO TRUE                        08230019
077500             ELSE                                                 08240019
077600                 PERFORM 2050-DELETE-DETAIL-QUEUE                 08250019
077700                 PERFORM 4000-BUILD-INITIAL-PANEL                 08260019
077800                 PERFORM 3200-RESET-ATTRIBUTES                    08270019
077900             END-IF                                               08280019
078000                                                                  08290019
078100         WHEN DP020-NEXT-ACT-READ-MAP                             08300019
078200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08310019
078300                                   TO PV-TOP-ITEM                 08320019
078400             PERFORM 2000-PROCESS-PANEL                           08330019
078500                                                                  08340019
078600         WHEN DP020-NEXT-ACT-RETURN                               08350019
078700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08360019
078800                                   TO PV-TOP-ITEM                 08370019
078900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08380019
079000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08390019
079100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08400019
079200                                                                  08410019
079300         WHEN OTHER                                               08420019
079400             SET DP013-LOGIC-ABEND TO TRUE                        08430019
079500             SET DP013-NO-ROLLBACK TO TRUE                        08440019
079600             MOVE '1000-CONTROL-PROCESSING'                       08450019
079700                                   TO DP013-PARAGRAPH             08460019
079800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08470019
079900                                   TO DP013-MESSAGE-TEXT(1)       08480019
080000             PERFORM DP013-0000-PROCESS-ABEND                     08490019
080100     END-EVALUATE.                                                08500019
080200                                                                  08510019
080300/                                                                 08520019
080400*----------------------------------------------------------------*08530019
080500* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08540019
080600*----------------------------------------------------------------*08550019
080700                                                                  08560019
080800 1100-PROCESS-INTER-APPL-COMM.                                    08570019
080900                                                                  08580019
081000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            08590019
081100                                                                  08600019
081200     SET PS-COMMAREA-VALID         TO TRUE.                       08610019
081300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08620019
081400                                                                  08630019
081500     EVALUATE DP020-INT-APPL-FORMAT-IND                           08640019
081600         WHEN PC-CRIT-SPEC-FORMAT                                 08650019
081700              IF  TR013-PRO-NBR = SPACES                          08660019
081800              OR  TR013-OWNER-SCAC-ID = SPACES                    08670019
081900                  MOVE PC-TSYMSG-00460                            08680019
082000                                   TO DP020-MSG-NUMBER            08690019
082100                  SET DP020-MSG-FATAL                             08700019
082200                      DP020-NEXT-ACT-APPL-ERROR                   08710019
082300                      PS-COMMAREA-NOT-VALID                       08720019
082400                                   TO TRUE                        08730019
082500              ELSE                                                08740019
082600                  MOVE TR013-PRO-NBR                              08750019
082700                                   TO DK-PRO-NBR                  08760019
082800                                      ASC-KEY-PRO-NBR             08770019
082900                  MOVE TR013-OWNER-SCAC-ID                        08780019
083000                                   TO DK-OWNER-SCAC-ID            08790019
083100                                      ASC-KEY-OWNER-SCAC-ID       08800019
083200                  MOVE TR013-PRINTER-ID                           08810019
083300                                   TO ASC-PRINTER-ID-X            08820019
083400              END-IF                                              08830019
083500                                                                  08840019
083600         WHEN PC-LIST-FORMAT                                      08850019
083700              SET ASC-USE-SELECTION-QUEUE TO TRUE                 08860019
083800              MOVE TR014-NUMBER-OF-TS-ITEMS                       08870019
083900                                   TO ASC-NUMBER-OF-TS-ITEMS      08880019
084000              MOVE TR014-SEL-QUEUE-NAME                           08890019
084100                                   TO ASC-SEL-QUEUE-NAME          08900019
084200              PERFORM 1120-PREPARE-LIST-ENTRY                     08910019
084300                                                                  08920019
084400         WHEN OTHER                                               08930019
084500              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            08940019
084600              SET DP020-MSG-FATAL                                 08950019
084700                  DP020-NEXT-ACT-APPL-ERROR                       08960019
084800                                   TO TRUE                        08970019
084900     END-EVALUATE.                                                08980019
085000                                                                  08990019
085100/                                                                 09000019
085200*----------------------------------------------------------------*09010019
085300*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *09020019
085400*----------------------------------------------------------------*09030019
085500                                                                  09040019
085600 1120-PREPARE-LIST-ENTRY.                                         09050019
085700                                                                  09060019
085800     MOVE TR015-MAX-ITEMS          TO ASC-SEL-SUB.                09070019
085900     MOVE ZERO                     TO ASC-SEL-ITEM.               09080019
086000     PERFORM 2140-GET-NEXT-RECORD.                                09090019
086100                                                                  09100019
086200/                                                                 09110019
086300*----------------------------------------------------------------*09120019
086400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *09130019
086500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *09140019
086600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *09150019
086700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *09160019
086800* FUNCTION KEYS CAN GET THIS FAR.                                *09170019
086900*----------------------------------------------------------------*09180019
087000                                                                  09190019
087100 2000-PROCESS-PANEL.                                              09200019
087200     EVALUATE TRUE                                                09210019
087300         WHEN DP020-SRC-AID = DP016-CLEAR                         09220019
087400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09230019
087500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09240019
087600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09250019
087700                                                                  09260019
087800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09270019
087900             MOVE ASC-KEY-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID       09280019
088000             MOVE ASC-KEY-PRO-NBR       TO DK-PRO-NBR             09290019
088100             PERFORM 2050-DELETE-DETAIL-QUEUE                     09300019
088200             PERFORM 4000-BUILD-INITIAL-PANEL                     09310019
088300             PERFORM 3200-RESET-ATTRIBUTES                        09320019
088400                                                                  09330019
088500         WHEN OTHER                                               09340019
088600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09350019
088700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09360019
088800             IF PS-NO-ERROR                                       09370019
088900                PERFORM 2100-CHECK-FUNCTION-KEY                   09380019
089000             END-IF                                               09390019
089100     END-EVALUATE.                                                09400019
089200                                                                  09410019
089300/                                                                 09420019
089400*----------------------------------------------------------------*09430019
089500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09440019
089600*----------------------------------------------------------------*09450019
089700 2050-DELETE-DETAIL-QUEUE.                                        09460019
089800                                                                  09470019
089900     EXEC CICS                                                    09480019
090000         DELETEQ TS                                               09490019
090100           QUEUE (ASC-DTL-QUEUE-NAME)                             09500019
090200            RESP (PV-CICS-RESP)                                   09510019
090300     END-EXEC.                                                    09520019
090400                                                                  09530019
090500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09540019
090600        (PV-CICS-RESP = DFHRESP(QIDERR))                          09550019
090700         CONTINUE                                                 09560019
090800     ELSE                                                         09570019
090900         SET DP013-CICS-ABEND                                     09580019
091000             DP013-NO-ROLLBACK     TO TRUE                        09590019
091100                                                                  09600019
091200         MOVE '2050-DELETE-DTL-QUEUE'                             09610019
091300                                   TO DP013-PARAGRAPH             09620019
091400         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  09630019
091500                                   TO DP013-MESSAGE-TEXT (1)      09640019
091600         PERFORM DP013-0000-PROCESS-ABEND                         09650019
091700     END-IF.                                                      09660019
091800                                                                  09670019
091900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09680019
092000                                                                  09690019
092100/                                                                 09700019
092200*----------------------------------------------------------------*09710019
092300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09720019
092400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09730019
092500* CICS ARCHITECTURE API.                                         *09740019
092600*----------------------------------------------------------------*09750019
092700 2100-CHECK-FUNCTION-KEY.                                         09760019
092800                                                                  09770019
092900     EVALUATE TRUE                                                09780019
093000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09790019
093100             MOVE +1               TO PV-TOP-ITEM                 09800019
093200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09810019
093300                                                                  09820019
093400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09830019
093500             PERFORM 2110-BROWSE-BACKWARD                         09840019
093600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09850019
093700                                                                  09860019
093800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09870019
093900             PERFORM 2120-BROWSE-FORWARD                          09880019
094000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09890019
094100                                                                  09900019
094200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             09910019
094300             IF  ASC-USE-SELECTION-QUEUE                          09920019
094400                 PERFORM 2140-GET-NEXT-RECORD                     09930019
094500                 IF PS-LIST-END                                   09940019
094600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09950019
094700                     SET PS-NO-LIST-END                           09960019
094800                                   TO TRUE                        09970019
094900                 ELSE                                             09980019
095000                     PERFORM 2050-DELETE-DETAIL-QUEUE             09990019
095100                     PERFORM 4000-BUILD-INITIAL-PANEL             10000019
095200                 END-IF                                           10010019
095300                 PERFORM 3200-RESET-ATTRIBUTES                    10020019
095400             ELSE                                                 10030019
095500                 MOVE PC-TSYMSG-00070                             10040019
095600                                   TO DP020-MSG-NUMBER            10050019
095700                 SET DP020-MSG-INFORMATIONAL                      10060019
095800                                   TO TRUE                        10070019
095900             END-IF                                               10080019
096000                                                                  10090019
096100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             10100019
096200             IF  ASC-USE-SELECTION-QUEUE                          10110019
096300                 PERFORM 2150-GET-PREV-RECORD                     10120019
096400                 IF PS-LIST-END                                   10130019
096500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10140019
096600                     SET PS-NO-LIST-END                           10150019
096700                                   TO TRUE                        10160019
096800                 ELSE                                             10170019
096900                     PERFORM 2050-DELETE-DETAIL-QUEUE             10180019
097000                     PERFORM 4000-BUILD-INITIAL-PANEL             10190019
097100                 END-IF                                           10200019
097200                 PERFORM 3200-RESET-ATTRIBUTES                    10210019
097300             ELSE                                                 10220019
097400                 MOVE PC-TSYMSG-00069                             10230019
097500                                   TO DP020-MSG-NUMBER            10240019
097600                 SET DP020-MSG-INFORMATIONAL                      10250019
097700                                   TO TRUE                        10260019
097800             END-IF                                               10270019
097900                                                                  10280019
098000         WHEN DP020-SRC-AID = DP016-ENTER                         10290019
098100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10300019
098200             IF  PS-ERROR                                         10310019
098300                 CONTINUE                                         10320019
098400             ELSE                                                 10330019
098500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10340019
098600                 PERFORM 3200-RESET-ATTRIBUTES                    10350019
098700             END-IF                                               10360019
098800                                                                  10370019
098900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              10380019
099000              SET DP030-CONTINUE-GO TO TRUE                       10390019
099100              PERFORM 6000-UPDATE-FREIGHT-BILL                    10400019
099200              MOVE ASC-KEY-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID      10410019
099300              MOVE ASC-KEY-PRO-NBR       TO DK-PRO-NBR            10420019
099400              PERFORM 2050-DELETE-DETAIL-QUEUE                    10430019
099500              PERFORM 4000-BUILD-INITIAL-PANEL                    10440019
099600              PERFORM 3200-RESET-ATTRIBUTES                       10450019
099700              MOVE -1                   TO APRINTRL               10460019
099800              SET DP030-SET-CURSOR-APPL-1                         10470019
099900                                        TO TRUE                   10480019
100000                                                                  10490019
100100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              10500019
100200             PERFORM 7000-FORMAT-COMMAREA                         10510019
100300             PERFORM 7100-START-TRANID-Y141                       10520019
100400             MOVE PC-TSYMSG-00098                                 10530019
100500                                 TO DP020-MSG-NUMBER              10540019
100600             SET DP030-OVERRIDE-GO                                10550019
100700                 DP020-MSG-INFORMATIONAL                          10560019
100800                                 TO TRUE                          10570019
100900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10580019
101000                                                                  10590019
101100         WHEN OTHER                                               10600019
101200             SET DP013-NO-ROLLBACK                                10610019
101300                 DP013-XCTL-DISPLAY-RESTART                       10620019
101400                 DP013-CICS-ABEND  TO TRUE                        10630019
101500             MOVE '2100-CHECK-FUNCTION-KEY'                       10640019
101600                                   TO DP013-PARAGRAPH             10650019
101700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10660019
101800                                   TO DP013-MESSAGE-TEXT (1)      10670019
101900             PERFORM DP013-0000-PROCESS-ABEND                     10680019
102000     END-EVALUATE.                                                10690019
102100                                                                  10700019
102200/                                                                 10710019
102300*----------------------------------------------------------------*10720019
102400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10730019
102500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10740019
102600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10750019
102700*    MESSAGE.                                                    *10760019
102800*----------------------------------------------------------------*10770019
102900                                                                  10780019
103000 2110-BROWSE-BACKWARD.                                            10790019
103100                                                                  10800019
103200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10810019
103300         GIVING PV-TOP-ITEM.                                      10820019
103400                                                                  10830019
103500     IF  ((PV-TOP-ITEM < +1)                                      10840019
103600       OR (PV-TOP-ITEM = +1))                                     10850019
103700         MOVE +1                   TO PV-TOP-ITEM                 10860019
103800*        -- TOP OF LIST --                                        10870019
103900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10880019
104000         SET DP020-MSG-INFORMATIONAL                              10890019
104100                                   TO TRUE                        10900019
104200     END-IF.                                                      10910019
104300                                                                  10920019
104400/                                                                 10930019
104500*----------------------------------------------------------------*10940019
104600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10950019
104700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10960019
104800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10970019
104900*----------------------------------------------------------------*10980019
105000                                                                  10990019
105100 2120-BROWSE-FORWARD.                                             11000019
105200                                                                  11010019
105300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11020019
105400         GIVING PV-TOP-ITEM.                                      11030019
105500                                                                  11040019
105600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11050019
105700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11060019
105800                                   TO PV-TOP-ITEM                 11070019
105900*        -- BOTTOM OF LIST --                                     11080019
106000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11090019
106100         SET DP020-MSG-INFORMATIONAL                              11100019
106200                                   TO TRUE                        11110019
106300     ELSE                                                         11120019
106400         COMPUTE PV-BOTTOM-ITEM =                                 11130019
106500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11140019
106600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11150019
106700*            -- BOTTOM OF LIST --                                 11160019
106800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11170019
106900             SET DP020-MSG-INFORMATIONAL                          11180019
107000                                   TO TRUE                        11190019
107100         END-IF                                                   11200019
107200     END-IF.                                                      11210019
107300                                                                  11220019
107400/                                                                 11230019
107500*----------------------------------------------------------------*11240019
107600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11250019
107700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11260019
107800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11270019
107900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11280019
108000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11290019
108100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11300019
108200*----------------------------------------------------------------*11310019
108300                                                                  11320019
108400 2130-CHECK-FOR-JUMP-BROWSE.                                      11330019
108500                                                                  11340019
108600     IF ASTRTITL > ZERO                                           11350019
108700         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      11360019
108800     ELSE                                                         11370019
108900         IF ASTRTITF = DP015-ERASE-EOF                            11380019
109000             INITIALIZE ASC-START-ITEM-REQUEST                    11390019
109100         END-IF                                                   11400019
109200     END-IF.                                                      11410019
109300                                                                  11420019
109400     SET PS-NO-ERROR               TO TRUE.                       11430019
109500                                                                  11440019
109600     IF (ASC-START-ITEM-REQUEST = SPACE)                          11450019
109700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11460019
109800                                   TO PV-TOP-ITEM                 11470019
109900     ELSE                                                         11480019
110000         MOVE ASC-START-ITEM-REQUEST                              11490019
110100                                   TO DP010I-UNEDITED-FIELD       11500019
110200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11510019
110300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11520019
110400         SET DP010I-NEGATIVE-NOT-ALLOWED                          11530019
110500                                   TO TRUE                        11540019
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11551026
263697              USING DP010I-NUMERIC-EDIT-AREA                      11552026
110700                                                                  11560019
110800         IF  NOT DP010I-ERROR-DETECTED                            11570019
110900             MOVE DP010I-NUMERIC-FIELD                            11580019
111000                                   TO ASC-START-ITEM-REQUEST-N    11590019
111100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11600019
111200                 IF  ASC-START-ITEM-REQUEST-N >                   11610019
111300                                          ASC-NUMBER-OF-ITEMS-READ11620019
111400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11630019
111500                     COMPUTE PV-TOP-ITEM =                        11640019
111600                             ASC-NUMBER-OF-ITEMS-READ             11650019
111700                             - PC-ITEMS-PER-PANEL + 1             11660019
111800                     IF  PV-TOP-ITEM < +1                         11670019
111900                         MOVE +1   TO PV-TOP-ITEM                 11680019
112000                         MOVE PC-TSYMSG-00070                     11690019
112100                                   TO DP020-MSG-NUMBER            11700019
112200                         SET DP020-MSG-INFORMATIONAL              11710019
112300                                   TO TRUE                        11720019
112400                     END-IF                                       11730019
112500                 ELSE                                             11740019
112600                     MOVE ASC-START-ITEM-REQUEST-N                11750019
112700                                   TO PV-TOP-ITEM                 11760019
112800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11770019
112900                     COMPUTE PV-BOTTOM-ITEM =                     11780019
113000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11790019
113100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11800019
113200*                        -- BOTTOM OF LIST --                     11810019
113300                         MOVE PC-TSYMSG-00070                     11820019
113400                                   TO DP020-MSG-NUMBER            11830019
113500                         SET DP020-MSG-INFORMATIONAL              11840019
113600                                   TO TRUE                        11850019
113700                     END-IF                                       11860019
113800                 END-IF                                           11870019
113900             ELSE                                                 11880019
114000*                --- VALUE OUT OF RANGE ----                      11890019
114100                 MOVE PC-TSYMSG-00101                             11900019
114200                                   TO DP020-MSG-NUMBER            11910019
114300                 MOVE -1           TO ASTRTITL                    11920019
114400                 SET DP030-SET-CURSOR-APPL-1                      11930019
114500                                   TO TRUE                        11940019
114600                 MOVE DP015-REVERSE                               11950019
114700                                   TO ASTRTITH                    11960019
114800                 MOVE DP015-RED    TO ASTRTITC                    11970019
114900                 MOVE DP015-UNP-NUM-BRT-MDT                       11980019
115000                                   TO ASTRTITA                    11990019
115100                 SET DP020-MSG-FATAL                              12000019
115200                     PS-ERROR      TO TRUE                        12010019
115300             END-IF                                               12020019
115400                                                                  12030019
115500         ELSE                                                     12040019
115600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12050019
115700             MOVE -1               TO ASTRTITL                    12060019
115800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12070019
115900             MOVE DP015-REVERSE    TO ASTRTITH                    12080019
116000             MOVE DP015-RED        TO ASTRTITC                    12090019
116100             MOVE DP015-UNP-NUM-BRT-MDT                           12100019
116200                                   TO ASTRTITA                    12110019
116300             SET DP020-MSG-FATAL                                  12120019
116400                 PS-ERROR          TO TRUE                        12130019
116500         END-IF                                                   12140019
116600     END-IF.                                                      12150019
116700                                                                  12160019
116800/                                                                 12170019
116900*----------------------------------------------------------------*12180019
117000*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*12190019
117100*----------------------------------------------------------------*12200019
117200                                                                  12210019
117300 2140-GET-NEXT-RECORD.                                            12220019
117400                                                                  12230019
117500     ADD +1                       TO ASC-SEL-SUB.                 12240019
117600                                                                  12250019
117700     IF  ASC-SEL-SUB > TR015-MAX-ITEMS                            12260019
117800         ADD +1                   TO ASC-SEL-ITEM                 12270019
117900         MOVE +1                  TO ASC-SEL-SUB                  12280019
118000     END-IF.                                                      12290019
118100                                                                  12300019
118200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12310019
118300         PERFORM 9100-READ-SEL-QUEUE                              12320019
118400         IF  TR015-ITEM (ASC-SEL-SUB) > ZERO                      12330019
118500             MOVE TR015-PRO-NBR (ASC-SEL-SUB)                     12340019
118600                                  TO ASC-KEY-PRO-NBR              12350019
118700             MOVE TR015-OWNER-SCAC-ID(ASC-SEL-SUB)                12360019
118800                                  TO ASC-KEY-OWNER-SCAC-ID        12370019
118900             SET TR015-INQ (ASC-SEL-SUB) TO TRUE                  12380019
119000             PERFORM 9200-REWRITE-SEL-QUEUE                       12390019
119100         ELSE                                                     12400019
119200             SUBTRACT +1 FROM ASC-SEL-SUB                         12410019
119300             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             12420019
119400             SET DP020-MSG-INFORMATIONAL                          12430019
119500                 PS-LIST-END             TO TRUE                  12440019
119600         END-IF                                                   12450019
119700     ELSE                                                         12460019
119800         SUBTRACT +1 FROM ASC-SEL-ITEM                            12470019
119900         MOVE TR015-MAX-ITEMS     TO ASC-SEL-SUB                  12480019
120000         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             12490019
120100         SET DP020-MSG-INFORMATIONAL                              12500019
120200             PS-LIST-END             TO TRUE                      12510019
120300     END-IF.                                                      12520019
120400                                                                  12530019
120500/                                                                 12540019
120600*----------------------------------------------------------------*12550019
120700*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *12560019
120800*    PROCESSED.                                                  *12570019
120900*----------------------------------------------------------------*12580019
121000                                                                  12590019
121100 2150-GET-PREV-RECORD.                                            12600019
121200                                                                  12610019
121300     SUBTRACT +1 FROM ASC-SEL-SUB.                                12620019
121400                                                                  12630019
121500     IF  ASC-SEL-SUB < +1                                         12640019
121600         SUBTRACT +1 FROM ASC-SEL-ITEM                            12650019
121700         MOVE TR015-MAX-ITEMS     TO ASC-SEL-SUB                  12660019
121800     END-IF.                                                      12670019
121900                                                                  12680019
122000     IF  ASC-SEL-ITEM > ZERO                                      12690019
122100         PERFORM 9100-READ-SEL-QUEUE                              12700019
122200         MOVE TR015-PRO-NBR (ASC-SEL-SUB)                         12710019
122300                                  TO ASC-KEY-PRO-NBR              12720019
122400         MOVE TR015-OWNER-SCAC-ID(ASC-SEL-SUB)                    12730019
122500                                  TO ASC-KEY-OWNER-SCAC-ID        12740019
122600     ELSE                                                         12750019
122700         MOVE +1                  TO ASC-SEL-ITEM                 12760019
122800                                     ASC-SEL-SUB                  12770019
122900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             12780019
123000         SET DP020-MSG-INFORMATIONAL                              12790019
123100             PS-LIST-END             TO TRUE                      12800019
123200     END-IF.                                                      12810019
123300                                                                  12820019
123400/                                                                 12830019
123500*----------------------------------------------------------------*12840019
123600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12850019
123700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12860019
123800*----------------------------------------------------------------*12870019
123900 2200-MOVE-SCREEN-TO-COMMAREA.                                    12880019
124000                                                                  12890019
124100     IF  AINVL > ZERO                                             12900019
124200         IF  AINVI = SPACES                                       12910019
124300             MOVE SPACES           TO ASC-INVC-NBR                12920019
124400         ELSE                                                     12930019
124500             MOVE AINVI            TO ASC-INVC-NBR                12940019
124600         END-IF                                                   12950019
124700     ELSE                                                         12960019
124800         IF  AINVF = DP015-ERASE-EOF                              12970019
124900             MOVE SPACES           TO ASC-INVC-NBR                12980019
125000         END-IF                                                   12990019
125100     END-IF.                                                      13000019
125200                                                                  13010019
125300     IF  AMMDTEL > ZERO                                           13020019
125400         IF  AMMDTEI = SPACES                                     13030019
125500             MOVE SPACES           TO ASC-PROCESSED-MM            13040019
125600         ELSE                                                     13050019
125700             MOVE AMMDTEI          TO ASC-PROCESSED-MM            13060019
125800         END-IF                                                   13070019
125900     ELSE                                                         13080019
126000         IF  AMMDTEF = DP015-ERASE-EOF                            13090019
126100             MOVE SPACES           TO ASC-PROCESSED-MM            13100019
126200         END-IF                                                   13110019
126300     END-IF.                                                      13120019
126400                                                                  13130019
126500     IF  ADDDTEL > ZERO                                           13140019
126600         IF  ADDDTEI = SPACES                                     13150019
126700             MOVE SPACES           TO ASC-PROCESSED-DD            13160019
126800         ELSE                                                     13170019
126900             MOVE ADDDTEI          TO ASC-PROCESSED-DD            13180019
127000         END-IF                                                   13190019
127100     ELSE                                                         13200019
127200         IF  ADDDTEF = DP015-ERASE-EOF                            13210019
127300             MOVE SPACES           TO ASC-PROCESSED-DD            13220019
127400         END-IF                                                   13230019
127500     END-IF.                                                      13240019
127600                                                                  13250019
127700     IF  AYYDTEL > ZERO                                           13260019
127800         IF  AYYDTEI = SPACES                                     13270019
127900             MOVE SPACES           TO ASC-PROCESSED-YY            13280019
128000         ELSE                                                     13290019
128100             MOVE AYYDTEI          TO ASC-PROCESSED-YY            13300019
128200         END-IF                                                   13310019
128300     ELSE                                                         13320019
128400         IF  AYYDTEF = DP015-ERASE-EOF                            13330019
128500             MOVE SPACES           TO ASC-PROCESSED-YY            13340019
128600         END-IF                                                   13350019
128700     END-IF.                                                      13360019
128800                                                                  13370019
128900     IF  AFCHGL > ZERO                                            13380019
129000         IF  AFCHGI = SPACES                                      13390019
129100             MOVE SPACES           TO ASC-FRGT-CHG                13400019
129200             MOVE ZERO             TO ASC-FRGT-CHG-N              13410019
129300         ELSE                                                     13420019
129400             MOVE AFCHGI           TO ASC-FRGT-CHG                13430019
129500         END-IF                                                   13440019
129600     ELSE                                                         13450019
129700         IF  AFCHGF = DP015-ERASE-EOF                             13460019
129800             MOVE SPACES           TO ASC-FRGT-CHG                13470019
129900             MOVE ZERO             TO ASC-FRGT-CHG-N              13480019
130000         END-IF                                                   13490019
130100     END-IF.                                                      13500019
130200                                                                  13510019
130300     IF  ATERML > ZERO                                            13520019
130400         MOVE ATERMI               TO ASC-TERMS                   13530019
130500     ELSE                                                         13540019
130600         IF  ATERMF = DP015-ERASE-EOF                             13550019
130700             MOVE SPACES           TO ASC-TERMS                   13560019
130800         END-IF                                                   13570019
130900     END-IF.                                                      13580019
131000                                                                  13590019
131100     IF  AWGHTL > ZERO                                            13600019
131200         MOVE AWGHTI               TO ASC-FRGT-WGHT               13610019
131300     ELSE                                                         13620019
131400         IF  AWGHTF = DP015-ERASE-EOF                             13630019
131500             MOVE ZERO             TO ASC-FRGT-WGHT               13640019
131600         END-IF                                                   13650019
131700     END-IF.                                                      13660019
131800                                                                  13670019
131900     IF APRINTRL > ZERO                                           13680019
132000         MOVE APRINTRI             TO ASC-PRINTER-ID-X            13690019
132100     ELSE                                                         13700019
132200         IF APRINTRF = DP015-ERASE-EOF                            13710019
132300             MOVE SPACE            TO ASC-PRINTER-ID-X            13720019
132400         END-IF                                                   13730019
132500     END-IF.                                                      13740019
132600                                                                  13750019
132700/                                                                 13760019
132800*----------------------------------------------------------------*13770019
132900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *13780019
133000* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *13790019
133100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *13800019
133200*----------------------------------------------------------------*13810019
133300                                                                  13820019
133400 3000-EDIT-DATA-IN-COMMAREA.                                      13830019
133500                                                                  13840019
133600     PERFORM 3200-RESET-ATTRIBUTES.                               13850019
133700                                                                  13860019
133800     IF  ASC-FRGT-WGHT > SPACES                                   13870019
133900         MOVE ASC-FRGT-WGHT        TO DP010I-UNEDITED-FIELD       13880019
134000         MOVE LENGTH OF ASC-FRGT-WGHT TO DP010I-MAXIMUM-DIGITS    13890019
134100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     13900019
134200         SET DP010I-NEGATIVE-NOT-ALLOWED                          13910019
134300                                   TO TRUE                        13920019
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13931026
263697              USING DP010I-NUMERIC-EDIT-AREA                      13932026
134500         IF  DP010I-ERROR-DETECTED                                13940019
134600             SET PS-ERROR                                         13950019
134700                 DP020-MSG-FATAL   TO TRUE                        13960019
134800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13970019
134900             MOVE DP015-UNP-ALP-BRT-OFF                           13980019
135000                                   TO AWGHTA                      13990019
135100             MOVE DP015-RED        TO AWGHTC                      14000019
135200             MOVE DP015-REVERSE    TO AWGHTH                      14010019
135300             MOVE -1               TO AWGHTL                      14020019
135400             SET DP030-SET-CURSOR-APPL-1                          14030019
135500                                   TO TRUE                        14040019
135600         ELSE                                                     14050019
135700             MOVE DP010I-NUMERIC-FIELD                            14060019
135800                                   TO ASC-FRGT-WGHT-N             14070019
135900         END-IF                                                   14080019
136000     END-IF.                                                      14090019
136100                                                                  14100019
136200     IF  ASC-TERMS = 'C' OR 'P' OR ' ' OR 'F'                     14110019
136300         CONTINUE                                                 14120019
136400     ELSE                                                         14130019
136500         SET PS-ERROR              TO TRUE                        14140019
136600         SET DP020-MSG-FATAL       TO TRUE                        14150019
136700         MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER            14160019
136800         MOVE DP015-UNP-ALP-BRT-OFF                               14170019
136900                                   TO ATERMA                      14180019
137000         MOVE DP015-RED            TO ATERMC                      14190019
137100         MOVE DP015-REVERSE        TO ATERMH                      14200019
137200         MOVE -1                   TO ATERML                      14210019
137300         SET DP030-SET-CURSOR-APPL-1                              14220019
137400                                   TO TRUE                        14230019
137500     END-IF.                                                      14240019
137600                                                                  14250019
137700     IF  ASC-FRGT-WGHT-N = ZERO                                   14260019
137800     AND ASC-TERMS = 'C'                                          14270019
137900         SET PS-ERROR              TO TRUE                        14280019
138000         SET DP020-MSG-FATAL       TO TRUE                        14290019
138100         MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER            14300019
138200         MOVE DP015-UNP-ALP-BRT-OFF                               14310019
138300                                   TO AWGHTA                      14320019
138400         MOVE DP015-RED            TO AWGHTC                      14330019
138500         MOVE DP015-REVERSE        TO AWGHTH                      14340019
138600         MOVE -1                   TO AWGHTL                      14350019
138700         SET DP030-SET-CURSOR-APPL-1                              14360019
138800                                   TO TRUE                        14370019
138900     END-IF.                                                      14380019
139000                                                                  14390019
139100     IF  ASC-FRGT-CHG > SPACES                                    14400019
139200         MOVE ASC-FRGT-CHG         TO DP010I-UNEDITED-FIELD       14410019
139300         MOVE 6                    TO DP010I-MAXIMUM-DIGITS       14420019
139400         MOVE 2                    TO DP010I-MAXIMUM-DECIMALS     14430019
139500         SET DP010I-NEGATIVE-NOT-ALLOWED                          14440019
139600                                   TO TRUE                        14450019
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14461026
263697              USING DP010I-NUMERIC-EDIT-AREA                      14462026
139800         IF  DP010I-ERROR-DETECTED                                14470019
139900             SET PS-ERROR                                         14480019
140000                 DP020-MSG-FATAL   TO TRUE                        14490019
140100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14500019
140200             MOVE DP015-UNP-ALP-BRT-OFF                           14510019
140300                                   TO AFCHGA                      14520019
140400             MOVE DP015-RED        TO AFCHGC                      14530019
140500             MOVE DP015-REVERSE    TO AFCHGH                      14540019
140600             MOVE -1               TO AFCHGL                      14550019
140700             SET DP030-SET-CURSOR-APPL-1                          14560019
140800                                   TO TRUE                        14570019
140900         ELSE                                                     14580019
141000             MOVE DP010I-NUMERIC-FIELD                            14590019
141100                                   TO ASC-FRGT-CHG-N              14600019
141200             MOVE ASC-FRGT-CHG-N   TO AFCHGO                      14610019
141300             MOVE AFCHGO           TO ASC-FRGT-CHG                14620019
141400         END-IF                                                   14630019
141500     END-IF.                                                      14640019
141600                                                                  14650019
141700     IF  ASC-FRGT-CHG-N = ZERO                                    14660019
141800     AND ASC-TERMS = 'C'                                          14670019
141900         SET PS-ERROR              TO TRUE                        14680019
142000         SET DP020-MSG-FATAL       TO TRUE                        14690019
142100         MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER            14700019
142200         MOVE DP015-UNP-ALP-BRT-OFF                               14710019
142300                                   TO AFCHGA                      14720019
142400         MOVE DP015-RED            TO AFCHGC                      14730019
142500         MOVE DP015-REVERSE        TO AFCHGH                      14740019
142600         MOVE -1                   TO AFCHGL                      14750019
142700         SET DP030-SET-CURSOR-APPL-1                              14760019
142800                                   TO TRUE                        14770019
142900     END-IF.                                                      14780019
143000                                                                  14790019
143100     SET PS-INVALID-DATE TO TRUE.                                 14800019
143200     IF ASC-PROCESSED-DD > SPACE                                  14810019
143300     OR ASC-PROCESSED-MM > SPACE                                  14820019
143400         STRING ASC-PROCESSED-MM               DELIMITED BY SIZE  14830019
143500                ASC-PROCESSED-DD               DELIMITED BY SIZE  14840019
143600                ASC-PROCESSED-YY(3:2)          DELIMITED BY SIZE  14850019
143700                               INTO DPG52-LK-DATE-INPUT           14860019
143800        INITIALIZE DPG51                                          14870019
143900        SET DPG51-ACTUAL-CALENDAR-ONLY                            14880019
144000            DPG51-DO-NOT-INCR-DECR-DATE                           14890019
144100            DPG52-LK-DTE-GREG    TO TRUE                          14900019
144200        CALL PC-DPKUT500-PGM                                      14910019
144300                        USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56 14920019
144400        IF (DPG54-DATE-INVALID                                    14930019
144500        OR  DPG54-SEVERE-ERROR)                                   14940019
144600            SET PS-ERROR                                          14950019
144700                DP020-MSG-FATAL   TO TRUE                         14960019
144800            MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER             14970019
144900            MOVE DP015-UNP-ALP-BRT-MDT                            14980019
145000                                  TO AMMDTEA                      14990019
145100                                     ADDDTEA                      15000019
145200                                     AYYDTEA                      15010019
145300            MOVE DP015-RED        TO AMMDTEC                      15020019
145400                                     ADDDTEC                      15030019
145500                                     AYYDTEC                      15040019
145600            MOVE DP015-REVERSE    TO AMMDTEH                      15050019
145700                                     ADDDTEH                      15060019
145800                                     AYYDTEH                      15070019
145900            MOVE -1               TO AMMDTEL                      15080019
146000            SET DP030-SET-CURSOR-APPL-1                           15090019
146100                                  TO TRUE                         15100019
146200        ELSE                                                      15110019
146300            MOVE DPG55-DB2-ISO-DATE-FMT                           15120019
146400                                  TO ASC-PROCESSED-DTE            15130019
146500            SET PS-VALID-DATE TO TRUE                             15140019
146600        END-IF                                                    15150019
146700     ELSE                                                         15160019
146800        IF ASC-PROCESSED-YY NOT = ASC-OLD-PROCESSED-YY            15170019
146900            MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER             15180019
147000            MOVE ASC-PROCESSED-MM TO AMMDTEO                      15190019
147100            MOVE ASC-PROCESSED-DD TO ADDDTEO                      15200019
147200            MOVE ASC-PROCESSED-YY TO AYYDTEO                      15210019
147300        END-IF                                                    15220019
147400     END-IF.                                                      15230019
147500                                                                  15240019
147600     IF  DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   15250019
147700         IF  ASC-PRINTER-ID-X = SPACES OR ZEROES                  15260019
147800             SET PS-ERROR                                         15270019
147900                 DP020-MSG-FATAL TO TRUE                          15280019
148000             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             15290019
148100             MOVE DP015-UNP-ALP-BRT-OFF                           15300019
148200                                 TO MR-PRINTERA                   15310019
148300             MOVE DP015-RED      TO MR-PRINTERC                   15320019
148400             MOVE DP015-REVERSE  TO MR-PRINTERH                   15330019
148500             MOVE -1             TO MR-PRINTERL                   15340019
148600             SET DP030-SET-CURSOR-APPL-1                          15350019
148700                                 TO TRUE                          15360019
148800         END-IF                                                   15370019
148900         IF  ASC-PRINTER-ID-X = 'XXXXXXXX'                        15380019
149000             CONTINUE                                             15390019
149100         ELSE                                                     15400019
149200             IF  ASC-PRINTER-ID-1-1 = 'U'                         15410019
149300                 PERFORM 3210-EDIT-PRINTER-ID                     15420019
149400             ELSE                                                 15430019
149500                 SET PS-ERROR                                     15440019
149600                     DP020-MSG-FATAL TO TRUE                      15450019
149700                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         15460019
149800                 MOVE DP015-UNP-ALP-BRT-OFF                       15470019
149900                                    TO MR-PRINTERA                15480019
150000                 MOVE DP015-RED     TO MR-PRINTERC                15490019
150100                 MOVE DP015-REVERSE TO MR-PRINTERH                15500019
150200                 MOVE -1            TO MR-PRINTERL                15510019
150300                 SET DP030-SET-CURSOR-APPL-1                      15520019
150400                                    TO TRUE                       15530019
150500             END-IF                                               15540019
150600         END-IF                                                   15550019
150700     END-IF.                                                      15560019
150800                                                                  15570019
150900     IF  PS-NO-ERROR                                              15580019
151000         MOVE -1                   TO AFCHGL                      15590019
151100         SET DP030-SET-CURSOR-APPL-1                              15600019
151200                                   TO TRUE                        15610019
151300     END-IF.                                                      15620019
151400                                                                  15630019
151500/                                                                 15640019
151600*----------------------------------------------------------------*15650019
151700*  RESET THE ATTRIBUTES.                                         *15660019
151800*----------------------------------------------------------------*15670019
151900                                                                  15680019
152000 3200-RESET-ATTRIBUTES.                                           15690019
152100                                                                  15700019
152200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    15710019
152300                                      AFCHGA                      15720019
152400                                      ATERMA                      15730019
152500                                      AWGHTA                      15740019
152600                                      AMMDTEA                     15750019
152700                                      ADDDTEA                     15760019
152800                                      AYYDTEA.                    15770019
152900     MOVE DP015-GREEN              TO ASTRTITC                    15780019
153000                                      AFCHGC                      15790019
153100                                      ATERMC                      15800019
153200                                      AWGHTC                      15810019
153300                                      AMMDTEC                     15820019
153400                                      ADDDTEC                     15830019
153500                                      AYYDTEC.                    15840019
153600     MOVE DP015-UNDERLINE          TO ASTRTITH                    15850019
153700                                      AFCHGH                      15860019
153800                                      ATERMH                      15870019
153900                                      AWGHTH                      15880019
154000                                      AMMDTEH                     15890019
154100                                      ADDDTEH                     15900019
154200                                      AYYDTEH.                    15910019
154300                                                                  15920019
154400/                                                                 15930019
154500*----------------------------------------------------------------*15940019
154600*    CHECK THE PRINTER NUMBER FOR NUMERIC                        *15950019
154700*----------------------------------------------------------------*15960019
154800 3210-EDIT-PRINTER-ID.                                            15970019
154900                                                                  15980019
155000*            VALIDATE USING DPKCS060                              15990019
155100             MOVE ASC-PRINTER-ID-X                                16000019
155200                                     TO DP072-PRINTER-ID          16010019
155300             MOVE 'TRKCS141'         TO DP072-RPT-PGM-NME         16020019
155400             MOVE PC-ONE             TO DP072-RPT-PGM-TYP-ID      16030019
155500             MOVE DP020-OPER-UNT-ID  TO DP072-ORIGIN-OPER-UNT-ID  16040019
155600             MOVE DP020-OPER-UNT-ID  TO DP072-OPER-UNT-ID         16050019
155700             MOVE  1                 TO DP072-ORIGIN-FCLTY-ID     16060019
155800             MOVE  1                 TO DP072-FCLTY-ID            16070019
155900             SET DP072-VALIDATE     TO TRUE                       16080019
156000                                                                  16090019
156100             EXEC CICS                                            16100019
156200                 LINK PROGRAM  (PC-DPKCS060)                      16110019
156300                      COMMAREA (DP072-COMM-AREA)                  16120019
156400                      RESP     (PV-CICS-RESP)                     16130019
156500             END-EXEC                                             16140019
156600                                                                  16150019
156700             EVALUATE TRUE                                        16160019
156800                 WHEN PV-CICS-RESP = DFHRESP (NORMAL)             16170019
156900                     CONTINUE                                     16180019
157000                 WHEN OTHER                                       16190019
157100                       MOVE '3210-EDIT-PRINTER-ID'                16200019
157200                                            TO DP013-PARAGRAPH    16210019
157300                       MOVE PV-CICS-RESP                          16220019
157400                            TO DP013-MESSAGE-TEXT(1)              16230019
157500                       MOVE SQLCA           TO DP013-SQLCA        16240019
157600                       SET DP013-LINK-RETURN                      16250019
157700                           DP013-CICS-ABEND                       16260019
157800                           DP013-NO-ROLLBACK TO TRUE              16270019
157900                       PERFORM DP013-0000-PROCESS-ABEND           16280019
158000             END-EVALUATE                                         16290019
158100                                                                  16300019
158200             IF  DP072-PRTR-PRTR-TRK-STAT-CDE = 'A'               16310019
158300                 MOVE ASC-PRINTER-ID-X   TO APRINTRO              16320019
158400             ELSE                                                 16330019
158500                 SET PS-ERROR                                     16340019
158600                     DP020-MSG-FATAL                              16350019
158700                                  TO TRUE                         16360019
158800                 MOVE PC-TSYMSG-00746                             16370019
158900                                  TO DP020-MSG-NUMBER             16380019
159000                 MOVE DP015-UNP-ALP-BRT-MDT                       16390019
159100                                  TO APRINTRA                     16400019
159200                 MOVE DP015-RED   TO APRINTRC                     16410019
159300                 MOVE DP015-REVERSE                               16420019
159400                                  TO APRINTRH                     16430019
159500                 MOVE -1          TO APRINTRL                     16440019
159600                 SET DP030-SET-CURSOR-APPL-1                      16450019
159700                                  TO TRUE                         16460019
159800             END-IF.                                              16470019
159900                                                                  16480019
160000*                                                                 16490019
160100*    MOVE ASC-PRINTER-ID-2-8     TO DP010I-UNEDITED-FIELD.        16500019
160200*    MOVE +4                     TO DP010I-MAXIMUM-DIGITS.        16510019
160300*    MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      16520019
160400*                                                                 16530019
160500*    SET DP010I-NEGATIVE-NOT-ALLOWED                              16540019
160600*                                TO TRUE.                         16550019
160700*                                                                 16560019
263697*    CALL DP010I-NUMERIC-EDIT-ROUTINE                             16571026
263697*         USING DP010I-NUMERIC-EDIT-AREA.                         16572026
160900*                                                                 16580019
161000*    IF DP010I-ERROR-DETECTED                                     16590019
161100*        SET PS-ERROR                                             16600019
161200*            DP020-MSG-FATAL     TO TRUE                          16610019
161300*        MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              16620019
161400*        MOVE DP015-UNP-ALP-BRT-OFF                               16630019
161500*                                TO MR-PRINTERA                   16640019
161600*        MOVE DP015-RED          TO MR-PRINTERC                   16650019
161700*        MOVE DP015-REVERSE      TO MR-PRINTERH                   16660019
161800*        MOVE -1                 TO MR-PRINTERL                   16670019
161900*        SET DP030-SET-CURSOR-APPL-1                              16680019
162000*                                TO TRUE                          16690019
162100*    ELSE                                                         16700019
162200*        MOVE ASC-PRINTER-ID-X   TO MR-PRINTER                    16710019
162300*    END-IF.                                                      16720019
162400                                                                  16730019
162500/                                                                 16740019
162600*----------------------------------------------------------------*16750019
162700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16760019
162800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16770019
162900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16780019
163000*    DISPLAY THE PANEL TO USER.                                  *16790019
163100*----------------------------------------------------------------*16800019
163200                                                                  16810019
163300 4000-BUILD-INITIAL-PANEL.                                        16820019
163400                                                                  16830019
163500     INITIALIZE ASC-BLOCK-ENTRIES (1)                             16840019
163600                ASC-BLOCK-ENTRIES (2).                            16850019
163700                                                                  16860019
163800     MOVE +1                       TO ASC-BLK-SUB.                16870019
163900                                                                  16880019
164000     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       16890019
164100     SET PS-VE-STATUS-NO           TO TRUE.                       16900019
164200                                                                  16910019
164300     MOVE +0                       TO ASC-ITEM-SUB                16920019
164400                                      ASC-NUMBER-OF-ITEMS-READ    16930019
164500                                      ASC-HIGHEST-BLOCK-WRITTEN   16940019
164600                                      ASC-ITEM-AT-TOP-OF-PANEL    16950019
164700                                      ASC-SHIPT-ID-L              16960019
164800                                      ASC-PO-NBR-L                16970019
164900                                      ASC-REC-SEQ-NBR-L.          16980019
165000                                                                  16990019
165100     PERFORM 4100-PREPARE-CURSOR.                                 17000019
165200                                                                  17010019
165300     PERFORM 4010-OPEN-CURSOR.                                    17020019
165400                                                                  17030019
165500     PERFORM 4300-READ-ITEMS-FROM-DB.                             17040019
165600                                                                  17050019
165700     PERFORM 4020-CLOSE-CURSOR.                                   17060019
165800                                                                  17070019
165900     MOVE +1                       TO PV-TOP-ITEM.                17080019
166000                                                                  17090019
166100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17100019
166200         SET DP020-NEXT-ACT-APPL-ERROR                            17110019
166300             DP020-MSG-FATAL       TO TRUE                        17120019
166400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            17130019
166500     ELSE                                                         17140019
166600         MOVE -1                   TO AINVL                       17150019
166700         SET DP030-SET-CURSOR-APPL-1                              17160019
166800                                   TO TRUE                        17170019
166900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17180019
167000         PERFORM 3200-RESET-ATTRIBUTES                            17190019
167100     END-IF.                                                      17200019
167200                                                                  17210019
167300/                                                                 17220019
167400*----------------------------------------------------------------*17230019
167500* OPEN THE RECEIVER CURSOR                                       *17240019
167600*----------------------------------------------------------------*17250019
167700                                                                  17260019
167800 4010-OPEN-CURSOR.                                                17270019
167900                                                                  17280019
168000     PERFORM                                                      17290019
168100         WITH TEST AFTER                                          17300019
168200         VARYING PV-RETRY-COUNTER                                 17310019
168300         FROM 1 BY 1                                              17320019
168400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17330019
168500            OR (SQLCODE = +0))                                    17340019
168600                                                                  17350019
168700         EXEC SQL                                                 17360019
168800             OPEN RECEIVER-CSR                                    17370019
168900         END-EXEC                                                 17380019
169000                                                                  17390019
169100         EVALUATE TRUE                                            17400019
169200             WHEN SQLCODE = +0                                    17410019
169300                  CONTINUE                                        17420019
169400             WHEN SQLCODE = -904                                  17430019
169500             WHEN SQLCODE = -913                                  17440019
169600                  CONTINUE                                        17450019
169700             WHEN SQLWARN0 NOT = SPACE                            17460019
169800             WHEN SQLCODE  NOT = +0                               17470019
169900                  MOVE '4010-OPEN-CURSOR'                         17480019
170000                                   TO DP013-PARAGRAPH             17490019
170100                  MOVE 'OPEN RECEIVER-CSR CURSOR'                 17500019
170200                                   TO DP013-MESSAGE-TEXT (1)      17510019
170300                  MOVE SQLCA       TO DP013-SQLCA                 17520019
170400                  MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)    17530019
170500                  MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (2)    17540019
170600                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (3)    17550019
170700                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (4)    17560019
170800                  SET DP013-DB2-ABEND                             17570019
170900                                   TO TRUE                        17580019
171000                  PERFORM DP013-0000-PROCESS-ABEND                17590019
171100         END-EVALUATE                                             17600019
171200     END-PERFORM.                                                 17610019
171300                                                                  17620019
171400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17630019
171500         SQLCODE  NOT = +0                                        17640019
171600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17650019
171700         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              17660019
171800                                   TO DP013-MESSAGE-TEXT (1)      17670019
171900         MOVE SQLCA                TO DP013-SQLCA                 17680019
172000         SET DP013-DB2-ABEND       TO TRUE                        17690019
172100         PERFORM DP013-0000-PROCESS-ABEND                         17700019
172200     END-IF.                                                      17710019
172300                                                                  17720019
172400/                                                                 17730019
172500*----------------------------------------------------------------*17740019
172600* CLOSE THE RECEIVER CURSOR                                      *17750019
172700*----------------------------------------------------------------*17760019
172800                                                                  17770019
172900 4020-CLOSE-CURSOR.                                               17780019
173000                                                                  17790019
173100     EXEC SQL                                                     17800019
173200         CLOSE RECEIVER-CSR                                       17810019
173300     END-EXEC.                                                    17820019
173400                                                                  17830019
173500     EVALUATE TRUE                                                17840019
173600         WHEN SQLCODE = +0                                        17850019
173700              CONTINUE                                            17860019
173800         WHEN SQLWARN0 NOT = SPACE                                17870019
173900         WHEN SQLCODE  NOT = +0                                   17880019
174000              MOVE '4020-CLOSE-CURSOR'                            17890019
174100                                   TO DP013-PARAGRAPH             17900019
174200              MOVE 'CLOSE RECEIVER-CSR CURSOR'                    17910019
174300                                   TO DP013-MESSAGE-TEXT (1)      17920019
174400              MOVE SQLCA           TO DP013-SQLCA                 17930019
174500              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    17940019
174600              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    17950019
174700              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (3)    17960019
174800              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (4)    17970019
174900              SET DP013-DB2-ABEND  TO TRUE                        17980019
175000              PERFORM DP013-0000-PROCESS-ABEND                    17990019
175100     END-EVALUATE.                                                18000019
175200                                                                  18010019
175300/                                                                 18020019
175400*----------------------------------------------------------------*18030019
175500*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *18040019
175600*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *18050019
175700*----------------------------------------------------------------*18060019
175800                                                                  18070019
175900 4100-PREPARE-CURSOR.                                             18080019
176000                                                                  18090019
176100     EVALUATE DP020-INT-APPL-FORMAT-IND                           18100019
176200         WHEN PC-CRIT-SPEC-FORMAT                                 18110019
176300              MOVE TR013-PRO-NBR       TO DK-PRO-NBR              18120019
176400              MOVE TR013-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID        18130019
176500                                                                  18140019
176600         WHEN PC-LIST-FORMAT                                      18150019
176700              MOVE ASC-KEY-PRO-NBR       TO DK-PRO-NBR            18160019
176800              MOVE ASC-KEY-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID      18170019
176900     END-EVALUATE.                                                18180019
177000                                                                  18190019
177100/                                                                 18200019
177200*----------------------------------------------------------------*18210019
177300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18220019
177400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18230019
177500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18240019
177600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18250019
177700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18260019
177800*                                                                *18270019
177900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18280019
178000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18290019
178100*    UPON INITIALIZATION.                                        *18300019
178200*----------------------------------------------------------------*18310019
178300                                                                  18320019
178400 4300-READ-ITEMS-FROM-DB.                                         18330019
178500                                                                  18340019
178600     PERFORM 4320-SUM-AMOUNTS.                                    18350019
178700                                                                  18360019
178800     MOVE PA-TOT-DMG-CART-CNT      TO ASC-TOT-DMG-N.              18370019
178900     MOVE PA-TOT-FRGT-CHG          TO ASC-FRGT-CHG-N              18380019
179000                                      ASC-TOT-CHGS-N.             18390019
179100     MOVE ZERO                     TO ASC-TOT-CART-CNT            18400019
179200                                      ASC-TOT-ACTL-CART-CNT.      18410019
179300                                                                  18420019
179400     PERFORM 4340-GET-SHIPMT.                                     18430022
179500     IF SHIPMT-PROCESSED-DTE = PC-DEFAULT-DTE                     18440019
179600         MOVE SPACES               TO ASC-PROCESSED-DTE           18450019
179700         MOVE EIBDATE              TO PV-EIB-DATE                 18460019
179800         IF PV-EIB-YY > 90                                        18470019
179900             MOVE '19'             TO PV-DEFAULT-CC               18480019
180000         ELSE                                                     18490019
180100             MOVE '20'             TO PV-DEFAULT-CC               18500019
180200         END-IF                                                   18510019
180300         MOVE PV-EIB-YY            TO PV-DEFAULT-YY               18520019
180400         MOVE PV-DEFAULT-YEAR      TO ASC-PROCESSED-YY            18530019
180500                                      ASC-OLD-PROCESSED-YY        18540019
180600     ELSE                                                         18550019
180700         MOVE SHIPMT-PROCESSED-DTE TO ASC-PROCESSED-DTE           18560019
180800     END-IF.                                                      18570019
180900     MOVE SHIPMT-INVC-NBR          TO ASC-INVC-NBR.               18580019
181000     PERFORM 4360-GET-SHIPMT.                                     18590019
181100     IF SQLCODE = -811                                            18600019
181200         MOVE PC-MULT              TO ASC-ORIG-SCAC-ID            18610019
181300     ELSE                                                         18620019
181400         MOVE SHIPMT-ORIG-SCAC-ID  TO ASC-ORIG-SCAC-ID            18630019
181500     END-IF.                                                      18640019
181600                                                                  18650019
181700     MOVE +0                        TO ASC-TOT-CTN-1-N.           18660019
181800     PERFORM                                                      18670019
181900         VARYING PV-READ-COUNT                                    18680019
182000         FROM 1 BY 1                                              18690019
182100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18700019
182200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18710019
182300                                                                  18720019
182400         PERFORM 4310-FETCH                                       18730019
182500                                                                  18740019
182600         IF  ASC-ITEMS-LEFT-ON-DB                                 18750019
182700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18760019
182800                 ADD +1            TO ASC-ITEM-SUB                18770019
182900             ELSE                                                 18780019
183000                 ADD +1            TO ASC-BLK-SUB                 18790019
183100                 MOVE +1           TO ASC-ITEM-SUB                18800019
183200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18810019
183300                     MOVE +1       TO ASC-BLK-SUB                 18820019
183400                     PERFORM 5100-WRITE-TEMP-STORAGE              18830019
183500                     MOVE ASC-BLOCK-ENTRIES                       18840019
183600                               (PC-MAX-BLOCKS-IN-ARRAY)           18850019
183700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18860019
183800                     ADD +1        TO ASC-BLK-SUB                 18870019
183900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18880019
184000                 END-IF                                           18890019
184100             END-IF                                               18900019
184200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18910019
184300             IF DN-VEH-NBR NOT = -1                               18920019
184400                 MOVE VHTRIP-VEH-NBR   TO ASC-VEH-NBR             18930019
184500             END-IF                                               18940019
184501*EA 07/30/2010                                                    18950019
184502                 MOVE VHTRIP-TRIP-ID   TO ASC-WHSE-TRIP           18960019
184503                                          DK-TRIP-ID              18970019
184504                 PERFORM 4370-GET-WHSE-CTN                        18980019
184505*EA 07/30/2010                                                    18990019
184506             IF  SHIPMT-FRGT-TERMS-CDE = '0'                      19000019
184507                 MOVE SPACES       TO ASC-TERMS                   19010019
184508             ELSE                                                 19020019
184509                 MOVE SHIPMT-FRGT-TERMS-CDE                       19030019
184510                                   TO ASC-TERMS                   19040019
184520             END-IF                                               19050019
184530             MOVE SHIPMT-EXPTED-GRO-WGHT                          19060019
184540                                   TO ASC-FRGT-WGHT-N             19070019
184550                                                                  19080019
184560*            IF RECEIV-ACTL-CART-CNT > ZERO                       19090019
184570*                ADD RECEIV-ACTL-CART-CNT TO ASC-TOT-CTN-1-N      19100019
184580*            ELSE                                                 19110019
184590*                ADD RECEIV-EXPTED-CART-CNT TO ASC-TOT-CTN-1-N    19120019
184600*            END-IF                                               19130019
184700                                                                  19140019
184800             MOVE ASC-NUMBER-OF-ITEMS-READ                        19150019
184900                                   TO ASC-LIST-ITEM-NUMBER        19160019
185000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19170019
185100             MOVE RECEIV-REC-SEQ-NBR TO ASC-REC-SEQ-NBR           19180019
185200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19190019
185300                                        DK-REC-SEQ-NBR            19200019
185400*GB 01/27/11 MOVE RECEIV-RCVR-NBR    TO PV-OLD-RCVR-NBR           19210021
185500*            MOVE PV-OLD-RCVR-NBR-2-8 TO ASC-OLD-RCVR-NBR         19220021
185600*                                       (ASC-BLK-SUB ASC-ITEM-SUB)19230021
185700*            MOVE '-'                 TO ASC-OLD-RCVR-DASH        19240021
185800*                                       (ASC-BLK-SUB ASC-ITEM-SUB)19250021
185900*            MOVE PV-OLD-RCVR-NBR-9   TO ASC-OLD-RCVR-CKDG        19260021
186000*01/27/2011                             (ASC-BLK-SUB ASC-ITEM-SUB)19270021
186100             MOVE SHPTPO-PO-NBR    TO ASC-PO-NBR                  19280019
186200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19290019
186300                                      DK-PO-NBR                   19300019
186400             MOVE RECEIV-OPER-UNT-ID  TO ASC-DC-NBR               19310019
186500                                        (ASC-BLK-SUB ASC-ITEM-SUB)19320019
186600             PERFORM 4330-GET-MAJOR-CLASS                         19330019
186700             IF  SQLCODE = +100                                   19340019
186800                 MOVE ZEROS              TO ASC-DEPT              19350019
186900                                        (ASC-BLK-SUB ASC-ITEM-SUB)19360019
187000                                            ASC-CLASS             19370019
187100                                        (ASC-BLK-SUB ASC-ITEM-SUB)19380019
187200             ELSE                                                 19390019
187300                 MOVE PURCHS-DEPT-NBR    TO PV-DEPT-NBR-N         19400019
187400                 MOVE PV-DEPT-NBR-N      TO ASC-DEPT              19410019
187500                                        (ASC-BLK-SUB ASC-ITEM-SUB)19420019
187600                 MOVE SKXREF-CLASS       TO ASC-CLASS             19430019
187700                                        (ASC-BLK-SUB ASC-ITEM-SUB)19440019
187800             END-IF                                               19450019
187900             SET PS-SINGLE-SHIPMENT TO TRUE                       19460019
188000             PERFORM 4350-SELECT-TSHIPMT                          19470019
188100             IF PS-MULTIPLE-SHIPMENTS                             19480019
188200                 MOVE SHPTPO-EXPTED-CART-CNT TO ASC-CTN-CNT       19490019
188300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19500019
188400                 ADD  SHPTPO-EXPTED-CART-CNT TO ASC-TOT-CART-CNT  19510019
188500                 MOVE SHPTPO-ACTL-CART-CNT   TO ASC-ADJ-CNT       19520019
188600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19530019
188700                 ADD  SHPTPO-ACTL-CART-CNT                        19540019
188800                                        TO ASC-TOT-ACTL-CART-CNT  19550019
188900                 IF SHPTPO-ACTL-CART-CNT > ZERO                   19560019
189000                     ADD  SHPTPO-ACTL-CART-CNT                    19570019
189100                                             TO ASC-TOT-CTN-1-N   19580019
189200                 ELSE                                             19590019
189300                     ADD  SHPTPO-EXPTED-CART-CNT                  19600019
189400                                             TO ASC-TOT-CTN-1-N   19610019
189500                 END-IF                                           19620019
189600             ELSE                                                 19630019
189700                 MOVE RECEIV-EXPTED-CART-CNT TO ASC-CTN-CNT       19640019
189800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19650019
189900                 ADD  RECEIV-EXPTED-CART-CNT TO ASC-TOT-CART-CNT  19660019
190000                 MOVE RECEIV-ACTL-CART-CNT   TO ASC-ADJ-CNT       19670019
190100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19680019
190200                 ADD  RECEIV-ACTL-CART-CNT                        19690019
190300                                        TO ASC-TOT-ACTL-CART-CNT  19700019
190400                 IF RECEIV-ACTL-CART-CNT > ZERO                   19710019
190500                     ADD RECEIV-ACTL-CART-CNT TO ASC-TOT-CTN-1-N  19720019
190600                 ELSE                                             19730019
190700                     ADD RECEIV-EXPTED-CART-CNT TO ASC-TOT-CTN-1-N19740019
190800                 END-IF                                           19750019
190900             END-IF                                               19760019
191000             MOVE SHPTPO-DMG-CART-CNT        TO ASC-DMG-CNT       19770019
191100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19780019
191200             MOVE SHPTPO-FRGT-CHG-AMT        TO ASC-CHGS          19790019
191300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19800019
191400             MOVE SHIPMT-COMPLETE-PRO-NBR                         19810019
191500                                      TO ASC-COMPLETE-PRO-NBR     19820019
191600             IF RECEIV-STATUS-CDE NOT = 'VE'                      19830019
191700                 SET PS-VE-STATUS-YES TO TRUE                     19840019
191800             END-IF                                               19850019
191900         END-IF                                                   19860019
192000     END-PERFORM.                                                 19870019
192100                                                                  19880019
192200     IF ASC-NO-ITEMS-LEFT-ON-DB                                   19890019
192300         MOVE SHPTPO-SHIPT-ID      TO ASC-SHIPT-ID-L              19900019
192400         MOVE SHPTPO-PO-NBR        TO ASC-PO-NBR-L                19910019
192500         MOVE RECEIV-REC-SEQ-NBR   TO ASC-REC-SEQ-NBR-L           19920019
192600     END-IF.                                                      19930019
192700                                                                  19940019
192800     MOVE ASC-TOT-CART-CNT         TO ASC-TOT-CTN-N.              19950019
192900     MOVE ASC-TOT-ACTL-CART-CNT    TO ASC-TOT-ADJ-N.              19960019
193000                                                                  19970019
193100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19980019
193200         MOVE +1                   TO ASC-BLK-SUB                 19990019
193300         PERFORM 5100-WRITE-TEMP-STORAGE                          20000019
193400         ADD +1                    TO ASC-BLK-SUB                 20010019
193500         PERFORM 5100-WRITE-TEMP-STORAGE                          20020019
193600         MOVE 1                    TO ASC-BLK-SUB                 20030019
193700                                      PV-BLOCK-NUMBER             20040019
193800         PERFORM 4410-READ-TEMP-STORAGE                           20050019
193900         IF  ASC-HIGHEST-BLOCK-WRITTEN > 1                        20060019
194000             MOVE 2                TO ASC-BLK-SUB                 20070019
194100                                      PV-BLOCK-NUMBER             20080019
194200             PERFORM 4410-READ-TEMP-STORAGE                       20090019
194300         END-IF                                                   20100019
194400     END-IF.                                                      20110019
194500                                                                  20120019
194600/                                                                 20130019
194700*----------------------------------------------------------------*20140019
194800*    FETCH A RECEIVER ROW                                        *20150019
194900*----------------------------------------------------------------*20160019
195000                                                                  20170019
195100 4310-FETCH.                                                      20180019
195200                                                                  20190019
195300     EXEC SQL                                                     20200019
195400          FETCH  RECEIVER-CSR                                     20210019
195500           INTO :RECEIV-ORD-NBR                                   20220019
195600               ,:RECEIV-REC-SEQ-NBR                               20230019
195700               ,:RECEIV-RCVR-NBR                                  20240019
195800               ,:RECEIV-STATUS-CDE                                20250019
195900               ,:RECEIV-EXPTED-CART-CNT                           20260019
196000               ,:RECEIV-ACTL-CART-CNT                             20270019
196100               ,:RECEIV-OPER-UNT-ID                               20280019
196200               ,:VHTRIP-OWNER-SCAC-ID                             20290019
196300               ,:VHTRIP-VEH-NBR:DN-VEH-NBR                        20300019
196400               ,:VHTRIP-TRIP-ID                                   20310019
196500               ,:SHPTPO-SHIPT-ID                                  20320019
196600               ,:SHPTPO-PO-NBR                                    20330019
196700               ,:SHPTPO-EXPTED-CART-CNT                           20340019
196800               ,:SHPTPO-ACTL-CART-CNT                             20350019
196900               ,:SHPTPO-DMG-CART-CNT                              20360019
197000               ,:SHPTPO-FRGT-CHG-AMT                              20370019
197100               ,:SHIPMT-FRGT-TERMS-CDE                            20380019
197200               ,:SHIPMT-EXPTED-GRO-WGHT                           20390019
197300               ,:SHIPMT-COMPLETE-PRO-NBR                          20400019
197400               ,:PURCHS-DEPT-NBR                                  20410019
197500     END-EXEC.                                                    20420019
197600                                                                  20430019
197700     EVALUATE TRUE                                                20440019
197800         WHEN SQLCODE = +0                                        20450019
197900              CONTINUE                                            20460019
198000         WHEN SQLCODE = +100                                      20470019
198100              SET ASC-NO-ITEMS-LEFT-ON-DB                         20480019
198200                                   TO TRUE                        20490019
198300         WHEN SQLWARN0 NOT = SPACE                                20500019
198400         WHEN SQLCODE < +0                                        20510019
198500         WHEN SQLCODE > +0                                        20520019
198600              MOVE '4310-FETCH-CURSOR'                            20530019
198700                                   TO DP013-PARAGRAPH             20540019
198800              MOVE 'FETCH RECEIVER CURSOR'                        20550019
198900                                   TO DP013-MESSAGE-TEXT (1)      20560019
199000              MOVE SQLCA           TO DP013-SQLCA                 20570019
199100              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    20580019
199200              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    20590019
199300              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (3)    20600019
199400              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (4)    20610019
199500              SET DP013-DB2-ABEND  TO TRUE                        20620019
199600              PERFORM DP013-0000-PROCESS-ABEND                    20630019
199700     END-EVALUATE.                                                20640019
199800                                                                  20650019
199900/                                                                 20660019
200000*----------------------------------------------------------------*20670019
200100* CALCULATE THE TOTAL FREIGHT CHARGES AND WEIGHT                 *20680019
200200*----------------------------------------------------------------*20690019
200300                                                                  20700019
200400 4320-SUM-AMOUNTS.                                                20710019
200500                                                                  20720019
200600     PERFORM                                                      20730019
200700         WITH TEST AFTER                                          20740019
200800         VARYING PV-RETRY-COUNTER                                 20750019
200900         FROM 1 BY 1                                              20760019
201000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20770019
201100            OR (SQLCODE = +0)                                     20780019
201200            OR (SQLCODE = +100)                                   20790019
201300            OR (SQLCODE = -305))                                  20800019
201400                                                                  20810019
201500         EXEC SQL                                                 20820019
201600             SELECT SUM(C.FRGT_CHG_AMT)                           20830019
201700                   ,SUM(C.DMG_CART_CNT)                           20840019
201800              INTO  :PA-TOT-FRGT-CHG                              20850019
201900                   ,:PA-TOT-DMG-CART-CNT                          20860019
202000               FROM TRECEIV A                                     20870019
202100                   ,TVHTRIP B                                     20880019
202200                   ,TSHPTPO C                                     20890019
202300                   ,TSHIPMT D                                     20900019
202400              WHERE D.PRO_NBR        = :DK-PRO-NBR                20910019
202500                AND D.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID          20920019
202600                AND A.VER_STATUS_CDE = 'A'                        20930019
202700                AND A.ORD_NBR     = C.PO_NBR                      20940019
202800                AND A.REC_SEQ_NBR = C.REC_SEQ_NBR                 20950019
202900                AND C.SHIPT_ID    = D.SHIPT_ID                    20960019
203000                AND D.TRIP_ID     = B.TRIP_ID                     20970019
203100         END-EXEC                                                 20980019
203200                                                                  20990019
203300         EVALUATE TRUE                                            21000019
203400             WHEN SQLCODE = +0                                    21010019
203500             WHEN SQLCODE = +100                                  21020019
203600             WHEN SQLCODE = -305                                  21030019
203700             WHEN SQLCODE = -904                                  21040019
203800             WHEN SQLCODE = -913                                  21050019
203900                 CONTINUE                                         21060019
204000             WHEN SQLWARN0 NOT = SPACE                            21070019
204100             WHEN SQLCODE < +0                                    21080019
204200             WHEN SQLCODE > +0                                    21090019
204300                 MOVE '4220-SUM-TSHPTPO'                          21100019
204400                                 TO DP013-PARAGRAPH               21110019
204500                 MOVE 'SUM TO GET TOTAL AMOUNTS      '            21120019
204600                                 TO DP013-MESSAGE-TEXT (1)        21130019
204700                 MOVE SQLCA      TO DP013-SQLCA                   21140019
204800                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      21150019
204900                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME (2)      21160019
205000                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (3)      21170019
205100                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (4)      21180019
205200                     SET DP013-DB2-ABEND                          21190019
205300                         DP013-XCTL-DISPLAY-RESTART               21200019
205400                                     TO TRUE                      21210019
205500                 PERFORM DP013-0000-PROCESS-ABEND                 21220019
205600         END-EVALUATE                                             21230019
205700     END-PERFORM.                                                 21240019
205800                                                                  21250019
205900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    21260019
206000         SQLCODE  NOT = +0                                        21270019
206100         MOVE '4320-SUM-AMOUNTS'   TO DP013-PARAGRAPH             21280019
206200         MOVE 'MAX RETRIES EXCEEDED FOR SUM FOR TOTAL AMOUNTS'    21290019
206300                                   TO DP013-MESSAGE-TEXT (1)      21300019
206400         MOVE SQLCA                TO DP013-SQLCA                 21310019
206500         SET DP013-DB2-ABEND       TO TRUE                        21320019
206600         PERFORM DP013-0000-PROCESS-ABEND                         21330019
206700     END-IF.                                                      21340019
206800                                                                  21350019
206900/                                                                 21360019
207000*----------------------------------------------------------------*21370019
207100*    GET THE CLASS NUMBER                                        *21380019
207200*----------------------------------------------------------------*21390019
207300 4330-GET-MAJOR-CLASS.                                            21400019
207400                                                                  21410019
207500     PERFORM                                                      21420019
207600         WITH TEST AFTER                                          21430019
207700         VARYING PV-RETRY-COUNTER                                 21440019
207800         FROM 1 BY 1                                              21450019
207900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21460019
208000             OR (SQLCODE = +0)                                    21470019
208100             OR (SQLCODE = +100))                                 21480019
208200                                                                  21490019
208300         EXEC SQL                                                 21500019
208400              SELECT B.CLASS                                      21510019
208500                INTO :SKXREF-CLASS                                21520019
208600                FROM TPURITM A,                                   21530019
208700                     TSKXREF B                                    21540019
208800               WHERE A.PO_NBR         = :SHPTPO-PO-NBR            21550019
208900                 AND A.VER_STATUS_CDE = 'A'                       21560019
209000                 AND A.ITM_NBR        = B.ITM_NBR                 21570019
209100                 AND A.PO_LNE_NBR =                               21580019
209200                      (SELECT MIN(B.PO_LNE_NBR)                   21590019
209300                       FROM   TPURITM B                           21600019
209400                       WHERE  B.PO_NBR = A.PO_NBR                 21610019
209500                         AND  B.VER_STATUS_CDE = 'A')             21620019
209600         END-EXEC                                                 21630019
209700                                                                  21640019
209800         EVALUATE TRUE                                            21650019
209900             WHEN SQLCODE = +0                                    21660019
210000             WHEN SQLCODE = +100                                  21670019
210100             WHEN SQLCODE = -904                                  21680019
210200             WHEN SQLCODE = -913                                  21690019
210300                  CONTINUE                                        21700019
210400                                                                  21710019
210500             WHEN SQLWARN0 NOT = SPACES                           21720019
210600             WHEN SQLCODE < +0                                    21730019
210700             WHEN SQLCODE > +0                                    21740019
210800                  MOVE '4330-GET-MAJOR-CLASS'                     21750019
210900                                  TO DP013-PARAGRAPH              21760019
211000                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           21770019
211100                                  TO DP013-MESSAGE-TEXT (1)       21780019
211200                  MOVE SQLCA      TO DP013-SQLCA                  21790019
211300                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     21800019
211400                  SET DP013-DB2-ABEND                             21810019
211500                      DP013-XCTL-DISPLAY-RESTART                  21820019
211600                                  TO TRUE                         21830019
211700                  PERFORM DP013-0000-PROCESS-ABEND                21840019
211800         END-EVALUATE                                             21850019
211900     END-PERFORM.                                                 21860019
212000                                                                  21870019
212100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    21880019
212200         SQLCODE  NOT = +0                                        21890019
212300         MOVE '4330-GET-MAJOR-CLASS'                              21900019
212400                                  TO DP013-PARAGRAPH              21910019
212500         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            21920019
212600                                  TO DP013-MESSAGE-TEXT (1)       21930019
212700         MOVE SQLCA               TO DP013-SQLCA                  21940019
212800         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     21950019
212900         SET DP013-DB2-ABEND                                      21960019
213000             DP013-XCTL-DISPLAY-RESTART                           21970019
213100                                  TO TRUE                         21980019
213200         PERFORM DP013-0000-PROCESS-ABEND                         21990019
213300     END-IF.                                                      22000019
213400/                                                                 22010019
213500*----------------------------------------------------------------*22020019
213600*    GET THE INVOICE INFO                                        *22030019
213700*----------------------------------------------------------------*22040019
213800 4340-GET-SHIPMT.                                                 22050019
213900                                                                  22060019
214000     PERFORM                                                      22070019
214100         WITH TEST AFTER                                          22080019
214200         VARYING PV-RETRY-COUNTER                                 22090019
214300         FROM 1 BY 1                                              22100019
214400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22110019
214500             OR (SQLCODE = +0)                                    22120019
214600             OR (SQLCODE = +100))                                 22130019
214700                                                                  22140019
214800         EXEC SQL                                                 22150019
214900              SELECT DISTINCT                                     22160019
215000                     D.PROCESSED_DTE                              22170019
215100                   , D.INVC_NBR                                   22180019
215200                INTO :SHIPMT-PROCESSED-DTE                        22190019
215300                   , :SHIPMT-INVC-NBR                             22200019
215400               FROM TRECEIV A                                     22210019
215500                   ,TVHTRIP B                                     22220019
215600                   ,TSHPTPO C                                     22230019
215700                   ,TSHIPMT D                                     22240019
215800              WHERE D.PRO_NBR        = :DK-PRO-NBR                22250019
215900                AND D.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID          22260019
216000                AND A.VER_STATUS_CDE = 'A'                        22270019
216100                AND A.ORD_NBR      = C.PO_NBR                     22280019
216200                AND A.REC_SEQ_NBR  = C.REC_SEQ_NBR                22290019
216300                AND C.SHIPT_ID     = D.SHIPT_ID                   22300019
216400                AND D.TRIP_ID      = B.TRIP_ID                    22310019
216500         END-EXEC                                                 22320019
216600                                                                  22330019
216700         EVALUATE TRUE                                            22340019
216800             WHEN SQLCODE = +0                                    22350019
216900             WHEN SQLCODE = +100                                  22360019
217000             WHEN SQLCODE = -904                                  22370019
217100             WHEN SQLCODE = -913                                  22380019
217200                  CONTINUE                                        22390019
217300                                                                  22400019
217400             WHEN SQLWARN0 NOT = SPACES                           22410019
217500             WHEN SQLCODE < +0                                    22420019
217600             WHEN SQLCODE > +0                                    22430019
217700                  MOVE '4340-GET-SHIPMT'                          22440019
217800                                  TO DP013-PARAGRAPH              22450019
217900                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT'           22460019
218000                                  TO DP013-MESSAGE-TEXT (1)       22470019
218100                  MOVE SQLCA      TO DP013-SQLCA                  22480019
218200                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     22490019
218300                  SET DP013-DB2-ABEND                             22500019
218400                      DP013-XCTL-DISPLAY-RESTART                  22510019
218500                                  TO TRUE                         22520019
218600                  PERFORM DP013-0000-PROCESS-ABEND                22530019
218700         END-EVALUATE                                             22540019
218800     END-PERFORM.                                                 22550019
218900                                                                  22560019
219000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    22570019
219100         SQLCODE  NOT = +0                                        22580019
219200         MOVE '4340-GET-SHIPMT '                                  22590019
219300                                  TO DP013-PARAGRAPH              22600019
219400         MOVE 'MAX RETRIES EXCEEDED ON SELECT TSHIPMT'            22610019
219500                                  TO DP013-MESSAGE-TEXT (1)       22620019
219600         MOVE SQLCA               TO DP013-SQLCA                  22630019
219700         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     22640019
219800         SET DP013-DB2-ABEND                                      22650019
219900             DP013-XCTL-DISPLAY-RESTART                           22660019
220000                                  TO TRUE                         22670019
220100         PERFORM DP013-0000-PROCESS-ABEND                         22680019
220200     END-IF.                                                      22690019
220300                                                                  22700019
220400/                                                                 22710019
220500*----------------------------------------------------------------*22720019
220600*    RETREIVE SHIPMENT INFO                                      *22730019
220700*----------------------------------------------------------------*22740019
220800 4350-SELECT-TSHIPMT.                                             22750019
220900                                                                  22760019
221000     PERFORM                                                      22770019
221100         WITH TEST AFTER                                          22780019
221200         VARYING PV-RETRY-COUNTER                                 22790019
221300         FROM 1 BY 1                                              22800019
221400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22810019
221500             OR (SQLCODE = +0)                                    22820019
221600             OR (SQLCODE = +100)                                  22830019
221700             OR (SQLCODE = -811))                                 22840019
221800                                                                  22850019
221900         EXEC SQL                                                 22860019
222000              SELECT  REC_SEQ_NBR                                 22870019
222100                INTO :SHPTPO-REC-SEQ-NBR                          22880019
222200                FROM  TSHPTPO                                     22890019
222300            WHERE   PO_NBR      = :SHPTPO-PO-NBR                  22900019
222400              AND   REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR             22910019
222500         END-EXEC                                                 22920019
222600                                                                  22930019
222700                                                                  22940019
222800         EVALUATE TRUE                                            22950019
222900             WHEN SQLCODE = +0                                    22960019
223000             WHEN SQLCODE = +100                                  22970019
223100             WHEN SQLCODE = -904                                  22980019
223200             WHEN SQLCODE = -913                                  22990019
223300                 CONTINUE                                         23000019
223400                                                                  23010019
223500             WHEN SQLCODE = -811                                  23020019
223600                  SET PS-MULTIPLE-SHIPMENTS                       23030019
223700                                   TO TRUE                        23040019
223800                                                                  23050019
223900             WHEN SQLWARN0 NOT = SPACES                           23060019
224000             WHEN SQLCODE < +0                                    23070019
224100             WHEN SQLCODE > +0                                    23080019
224200                  MOVE '4350-SELECT-TSHIPMT     '                 23090019
224300                                  TO DP013-PARAGRAPH              23100019
224400                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         23110019
224500                                  TO DP013-MESSAGE-TEXT (1)       23120019
224600                  MOVE SQLCA      TO DP013-SQLCA                  23130019
224700                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     23140019
224800                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2)     23150019
224900                  SET DP013-DB2-ABEND                             23160019
225000                      DP013-XCTL-DISPLAY-RESTART                  23170019
225100                                  TO TRUE                         23180019
225200                  PERFORM DP013-0000-PROCESS-ABEND                23190019
225300         END-EVALUATE                                             23200019
225400     END-PERFORM.                                                 23210019
225500                                                                  23220019
225600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    23230019
225700         SQLCODE  NOT = +0                                        23240019
225800         MOVE '4350-SELECT-TSHIPMT     '                          23250019
225900                                  TO DP013-PARAGRAPH              23260019
226000         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       23270019
226100                                  TO DP013-MESSAGE-TEXT (1)       23280019
226200         MOVE SQLCA               TO DP013-SQLCA                  23290019
226300         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     23300019
226400         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (2)     23310019
226500         SET DP013-DB2-ABEND                                      23320019
226600             DP013-XCTL-DISPLAY-RESTART                           23330019
226700                                  TO TRUE                         23340019
226800         PERFORM DP013-0000-PROCESS-ABEND                         23350019
226900     END-IF.                                                      23360019
227000                                                                  23370019
227100/                                                                 23380019
227200*----------------------------------------------------------------*23390019
227300*    GET THE ORIGIN SCAC                                         *23400019
227400*----------------------------------------------------------------*23410019
227500 4360-GET-SHIPMT.                                                 23420019
227600                                                                  23430019
227700     PERFORM                                                      23440019
227800         WITH TEST AFTER                                          23450019
227900         VARYING PV-RETRY-COUNTER                                 23460019
228000         FROM 1 BY 1                                              23470019
228100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23480019
228200             OR (SQLCODE = +0)                                    23490019
228300             OR (SQLCODE = +100)                                  23500019
228400             OR (SQLCODE = -811))                                 23510019
228500                                                                  23520019
228600         EXEC SQL                                                 23530019
228700              SELECT DISTINCT                                     23540019
228800                     ORIG_SCAC_ID                                 23550019
228900                INTO :SHIPMT-ORIG-SCAC-ID                         23560019
229000                FROM TSHIPMT                                      23570019
229100               WHERE PRO_NBR        = :DK-PRO-NBR                 23580019
229200                 AND PRO_SCAC_ID    = :DK-OWNER-SCAC-ID           23590019
229300         END-EXEC                                                 23600019
229400                                                                  23610019
229500         EVALUATE TRUE                                            23620019
229600             WHEN SQLCODE = +0                                    23630019
229700             WHEN SQLCODE = +100                                  23640019
229800             WHEN SQLCODE = -811                                  23650019
229900             WHEN SQLCODE = -904                                  23660019
230000             WHEN SQLCODE = -913                                  23670019
230100                  CONTINUE                                        23680019
230200                                                                  23690019
230300             WHEN SQLWARN0 NOT = SPACES                           23700019
230400             WHEN SQLCODE < +0                                    23710019
230500             WHEN SQLCODE > +0                                    23720019
230600                  MOVE '4360-GET-SHIPMT'                          23730019
230700                                  TO DP013-PARAGRAPH              23740019
230800                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT'           23750019
230900                                  TO DP013-MESSAGE-TEXT (1)       23760019
231000                  MOVE SQLCA      TO DP013-SQLCA                  23770019
231100                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     23780019
231200                  SET DP013-DB2-ABEND                             23790019
231300                      DP013-XCTL-DISPLAY-RESTART                  23800019
231400                                  TO TRUE                         23810019
231500                  PERFORM DP013-0000-PROCESS-ABEND                23820019
231600         END-EVALUATE                                             23830019
231700     END-PERFORM.                                                 23840019
231800                                                                  23850019
231900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    23860019
232000         SQLCODE  NOT = +0                                        23870019
232100         MOVE '4360-GET-SHIPMT '                                  23880019
232200                                  TO DP013-PARAGRAPH              23890019
232300         MOVE 'MAX RETRIES EXCEEDED ON SELECT TSHIPMT'            23900019
232400                                  TO DP013-MESSAGE-TEXT (1)       23910019
232500         MOVE SQLCA               TO DP013-SQLCA                  23920019
232600         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     23930019
232700         SET DP013-DB2-ABEND                                      23940019
232800             DP013-XCTL-DISPLAY-RESTART                           23950019
232900                                  TO TRUE                         23960019
233000         PERFORM DP013-0000-PROCESS-ABEND                         23970019
233100     END-IF.                                                      23980019
233200                                                                  23990019
233300/                                                                 24000019
233400* EA 07/30/2010                                                   24010019
233500*----------------------------------------------------------------*24020019
233600*    GET THE WHSE CTN                                            *24030019
233700*----------------------------------------------------------------*24040019
233800 4370-GET-WHSE-CTN.                                               24050019
233900                                                                  24060019
234000     INITIALIZE WS-PRCSD-CARTONS.                                 24070019
234100                                                                  24080019
234200     EXEC SQL                                                     24090019
234300        SELECT  COUNT (DISTINCT(A.SHIPT_UNT_ID))                  24100019
234400        INTO    :WS-PRCSD-CARTONS                                 24110019
234500        FROM    SUT_OTBND_LOC  A,                                 24120019
234510                SUT_OTBND_CART B                                  24130019
234520        WHERE   A.INBD_TRIP_ID = :DK-TRIP-ID                      24140019
234530          AND   A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                   24150019
234540          AND   A.SCN_CDE      = 'RECV'                           24160019
234541          AND   B.CART_SRC_CDE = 'RDM'                            24170019
234542        WITH UR                                                   24180019
234543     END-EXEC.                                                    24190019
234544                                                                  24200019
234545         EVALUATE TRUE                                            24210019
234546             WHEN SQLCODE = +0                                    24220019
234547                  MOVE WS-PRCSD-CARTONS TO ASC-WHSE-WCTN-N        24230019
234548             WHEN SQLCODE = +100                                  24240019
234549                  MOVE SPACE TO ASC-WHSE-WCTN                     24250019
234550             WHEN OTHER                                           24260019
234560                 MOVE '4370-GET-WHSE-CTN'                         24270019
234570                                  TO DP013-PARAGRAPH              24280019
234580                 MOVE 'UNSUCCESSFUL SELECT ON OTBND TABLES'       24290019
234590                                  TO DP013-MESSAGE-TEXT (1)       24300019
234600                 MOVE SQLCA      TO DP013-SQLCA                   24310019
234610                 MOVE 'SUT_OTBND_LOC' TO DP013-DB2-TABLE-NAME (1) 24320019
234611                 MOVE 'SUT_OTBND_CART' TO DP013-DB2-TABLE-NAME (2)24330019
234612                  SET DP013-DB2-ABEND                             24340019
234613                      DP013-XCTL-DISPLAY-RESTART                  24350019
234614                                  TO TRUE                         24360019
234615                  PERFORM DP013-0000-PROCESS-ABEND                24370019
234616         END-EVALUATE.                                            24380019
234617                                                                  24390019
234618* EA 07/30/2010                                                   24400019
234619*----------------------------------------------------------------*24410019
234620* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *24420019
234621*----------------------------------------------------------------*24430019
234622                                                                  24440019
234623 4400-MOVE-COMMAREA-TO-SCREEN.                                    24450019
234624                                                                  24460019
234625     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             24470019
234626         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          24480019
234627         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          24490019
234628             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             24500019
234629                 GIVING PV-BLOCK-NUMBER                           24510019
234630                 REMAINDER PV-REMAINDER                           24520019
234640             IF  PV-REMAINDER > ZERO                              24530019
234650                 ADD +1           TO PV-BLOCK-NUMBER              24540019
234660             END-IF                                               24550019
234670             MOVE +1              TO ASC-BLK-SUB                  24560019
234680             PERFORM 4410-READ-TEMP-STORAGE                       24570019
234690             ADD +1               TO ASC-BLK-SUB                  24580019
234700                                     PV-BLOCK-NUMBER              24590019
234800             PERFORM 4410-READ-TEMP-STORAGE                       24600019
234900     END-IF.                                                      24610019
235000                                                                  24620019
235100     MOVE +1                       TO ASC-BLK-SUB.                24630019
235200                                                                  24640019
235300     COMPUTE ASC-ITEM-SUB =                                       24650019
235400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              24660019
235500         + PC-ITEMS-PER-PANEL).                                   24670019
235600                                                                  24680019
235700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        24690019
235800         ADD +1                    TO ASC-BLK-SUB                 24700019
235900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24710019
236000     END-IF.                                                      24720019
236100                                                                  24730019
236200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24740019
236300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24750019
236400                                                                  24760019
236500     PERFORM 4420-FORMAT-LIST-LINES                               24770019
236600         VARYING PV-SUB                                           24780019
236700         FROM PC-ITEMS-PER-PANEL BY -1                            24790019
236800         UNTIL PV-SUB < +1.                                       24800019
236900                                                                  24810019
237000     COMPUTE ASC-ITEMS-DISPLAYED =                                24820019
237100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24830019
237200                                                                  24840019
237300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24850019
237400                                      ASTRTITO.                   24860019
237500                                                                  24870019
237600     MOVE ASC-COMPLETE-PRO-NBR     TO MR-PRO-NBR.                 24880019
237700     MOVE ASC-KEY-OWNER-SCAC-ID    TO MR-OWNER-SCAC-ID.           24890019
237800     MOVE ASC-VEH-NBR              TO MR-VEH-NBR.                 24900019
237900                                                                  24910019
238000     MOVE ASC-FRGT-CHG-N           TO MR-FRGT-CHG.                24920019
238100     MOVE ASC-TERMS                TO MR-TERMS.                   24930019
238200     MOVE ASC-FRGT-WGHT            TO MR-FRGT-WGHT.               24940019
238300* EA 07/30/2010                                                   24950019
238400     MOVE ASC-WHSE-TRIP            TO MR-WHSE-TRIP.               24960019
238500     MOVE ASC-WHSE-WCTN            TO MR-WHSE-WCTN.               24970019
238600* EA 07/30/2010                                                   24980019
238700     MOVE ASC-ORIG-SCAC-ID         TO MR-OSCAC.                   24990019
238800     MOVE ASC-PROCESSED-MM         TO MR-MONTH.                   25000019
238900     MOVE ASC-PROCESSED-DD         TO MR-DAY.                     25010019
239000     MOVE ASC-PROCESSED-YY         TO MR-YEAR.                    25020019
239100     MOVE ASC-INVC-NBR             TO MR-INV.                     25030019
239200     IF ASC-PRINTER-ID-X = '00000000'                             25040019
239300        CONTINUE                                                  25050019
239400     ELSE                                                         25060019
239500        MOVE ASC-PRINTER-ID-X    TO MR-PRINTER                    25070019
239600     END-IF.                                                      25080019
239700                                                                  25090019
239800                                                                  25100019
239900     MOVE ASC-TOT-CTN              TO MR-TOT-CTN-CNT.             25110019
240000     MOVE ASC-TOT-DMG              TO MR-TOT-DMG-CNT.             25120019
240100     MOVE ASC-TOT-ADJ              TO MR-TOT-ADJ-CNT.             25130019
240200     MOVE ASC-TOT-CHGS-N           TO MR-TOT-CHGS.                25140019
240300                                                                  25150019
240400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    25160019
240500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    25170019
240600                                                                  25180019
240700     IF  DP020-MSG-NUMBER-X = SPACE                               25190019
240800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25200019
240900*            --- MORE ITEMS TO DISPLAY ----                       25210019
241000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25220019
241100             SET DP020-MSG-INFORMATIONAL                          25230019
241200                                   TO TRUE                        25240019
241300         ELSE                                                     25250019
241400             IF PS-VE-STATUS-YES                                  25260019
241500                 MOVE PC-REC-VERIFIED-MSG TO DP020-MSG-MESSAGE    25270019
241600                 SET DP020-MSG-WARNING TO TRUE                    25280019
241700             END-IF                                               25290019
241800         END-IF                                                   25300019
241900     END-IF.                                                      25310019
242000                                                                  25320019
242100/                                                                 25330019
242200*----------------------------------------------------------------*25340019
242300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25350019
242400*----------------------------------------------------------------*25360019
242500                                                                  25370019
242600 4410-READ-TEMP-STORAGE.                                          25380019
242700                                                                  25390019
242800     EXEC CICS                                                    25400019
242900         READQ TS                                                 25410019
243000             QUEUE (ASC-DTL-QUEUE-NAME)                           25420019
243100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25430019
243200             ITEM  (PV-BLOCK-NUMBER)                              25440019
243300             RESP  (PV-CICS-RESP)                                 25450019
243400     END-EXEC.                                                    25460019
243500                                                                  25470019
243600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25480019
243700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25490019
243800         CONTINUE                                                 25500019
243900     ELSE                                                         25510019
244000         SET DP013-CICS-ABEND      TO TRUE                        25520019
244100         SET DP013-NO-ROLLBACK     TO TRUE                        25530019
244200         MOVE '4410-READ-TEMP-STORAGE'                            25540019
244300                                   TO DP013-PARAGRAPH             25550019
244400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25560019
244500                                   TO DP013-MESSAGE-TEXT(1)       25570019
244600         PERFORM DP013-0000-PROCESS-ABEND                         25580019
244700     END-IF.                                                      25590019
244800                                                                  25600019
244900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         25610019
245000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               25620019
245100     END-IF.                                                      25630019
245200                                                                  25640019
245300/                                                                 25650019
245400*----------------------------------------------------------------*25660019
245500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *25670019
245600*----------------------------------------------------------------*25680019
245700                                                                  25690019
245800 4420-FORMAT-LIST-LINES.                                          25700019
245900                                                                  25710019
246000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      25720019
246100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                25730019
246200         MOVE SPACES               TO MR-PRO-NBR                  25740019
246300                                      MR-OWNER-SCAC-ID            25750019
246400                                      MR-VEH-NBR                  25760019
246500                                      MR-FRGT-CHG-X               25770019
246600                                      MR-TERMS                    25780019
246700                                      MR-FRGT-WGHT-X              25790019
246800* EA 07/30/2010                                                   25800019
246900                                      MR-WHSE-TRIP-X              25810019
247000                                      MR-WHSE-WCTN-X              25820019
247100* EA 07/30/2010                                                   25830019
247200                                      MR-PO-NBR     (PV-SUB)      25840019
247300                                      MR-DC-NBR     (PV-SUB)      25850019
247400                                      MR-REC-SEQ-NBR (PV-SUB)     25860019
247500*                                     MR-OLD-RCVR-NBR (PV-SUB)    25870019
247600                                      MR-DEPT       (PV-SUB)      25880019
247700                                      MR-CLASS      (PV-SUB)      25890019
247800                                      MR-CTN-CNT-X  (PV-SUB)      25900019
247900                                      MR-ADJ-CNT-X  (PV-SUB)      25910019
248000                                      MR-DMG-CNT-X  (PV-SUB)      25920019
248100                                      MR-CHGS-X (PV-SUB)          25930019
248200     ELSE                                                         25940019
248300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           25950019
248400             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           25960019
248500                                   TO MR-PO-NBR (PV-SUB)          25970019
248600             MOVE ASC-DC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           25980019
248700                                   TO MR-DC-NBR (PV-SUB)          25990019
248800             MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      26000019
248900                                   TO MR-REC-SEQ-NBR (PV-SUB)     26010019
249000*            MOVE ASC-OLD-RCVR     (ASC-BLK-SUB ASC-ITEM-SUB)     26020019
249100*                                  TO MR-OLD-RCVR-NBR (PV-SUB)    26030019
249200             MOVE ASC-DEPT    (ASC-BLK-SUB ASC-ITEM-SUB)          26040019
249300                                   TO MR-DEPT (PV-SUB)            26050019
249400             MOVE ASC-CLASS   (ASC-BLK-SUB ASC-ITEM-SUB)          26060019
249500                                   TO MR-CLASS (PV-SUB)           26070019
249600             MOVE ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          26080019
249700                                   TO MR-CTN-CNT (PV-SUB)         26090019
249800             MOVE ASC-ADJ-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          26100019
249900                                   TO MR-ADJ-CNT (PV-SUB)         26110019
250000             MOVE ASC-DMG-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          26120019
250100                                   TO MR-DMG-CNT (PV-SUB)         26130019
250200             MOVE ASC-CHGS (ASC-BLK-SUB ASC-ITEM-SUB)             26140019
250300                                   TO MR-CHARGES (PV-SUB)         26150019
250400         END-IF                                                   26160019
250500     END-IF.                                                      26170019
250600                                                                  26180019
250700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               26190019
250800                                                                  26200019
250900     IF  ASC-ITEM-SUB < + 1                                       26210019
251000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                26220019
251100         MOVE +1                   TO ASC-BLK-SUB                 26230019
251200     END-IF.                                                      26240019
251300                                                                  26250019
251400                                                                  26260019
251500/                                                                 26270019
251600*----------------------------------------------------------------*26280019
251700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26290019
251800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26300019
251900*----------------------------------------------------------------*26310019
252000                                                                  26320019
252100 5100-WRITE-TEMP-STORAGE.                                         26330019
252200                                                                  26340019
252300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26350019
252400                                   TO PV-LIST-ITEM-NUMBER.        26360019
252500                                                                  26370019
252600     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           26380019
252700         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           26390019
252800                                                                  26400019
252900     EXEC CICS                                                    26410019
253000         WRITEQ TS                                                26420019
253100             QUEUE (ASC-DTL-QUEUE-NAME)                           26430019
253200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26440019
253300             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     26450019
253400             RESP  (PV-CICS-RESP)                                 26460019
253500     END-EXEC.                                                    26470019
253600                                                                  26480019
253700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26490019
253800         SET DP013-CICS-ABEND                                     26500019
253900             DP013-NO-ROLLBACK     TO TRUE                        26510019
254000         MOVE '5100-WRITE-TEMP-STORAGE'                           26520019
254100                                   TO DP013-PARAGRAPH             26530019
254200         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       26540019
254300                                   TO DP013-MESSAGE-TEXT(1)       26550019
254400         PERFORM DP013-0000-PROCESS-ABEND                         26560019
254500     END-IF.                                                      26570019
254600                                                                  26580019
254700     ADD +1                        TO ASC-HIGHEST-BLOCK-WRITTEN.  26590019
254800                                                                  26600019
254900/                                                                 26610019
255000*----------------------------------------------------------------*26620019
255100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *26630019
255200* OBJECT WAS UDPATED.                                            *26640019
255300*----------------------------------------------------------------*26650019
255400                                                                  26660019
255500 5200-UPDATE-SELECTION-QUEUE.                                     26670019
255600                                                                  26680019
255700     PERFORM 9100-READ-SEL-QUEUE.                                 26690019
255800                                                                  26700019
255900     SET TR015-UPD (ASC-SEL-SUB)   TO TRUE.                       26710019
256000                                                                  26720019
256100     PERFORM 9200-REWRITE-SEL-QUEUE.                              26730019
256200                                                                  26740019
256300/                                                                 26750019
256400*----------------------------------------------------------------*26760019
256500* APPLY THE CHANGES TO THE FREIGHT BILL                          *26770019
256600*----------------------------------------------------------------*26780019
256700 6000-UPDATE-FREIGHT-BILL.                                        26790019
256800                                                                  26800019
256900     MOVE ASC-KEY-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID.           26810019
257000     MOVE ASC-KEY-PRO-NBR          TO DK-PRO-NBR.                 26820019
257100                                                                  26830019
257200     MOVE 'N'                      TO PS-EOF-UPD-RECEIVER-CSR-SW. 26840019
257300     MOVE ZERO                     TO PA-SUM-CALC-FRGT-CHG        26850019
257400                                      PA-TOT-FRGT-CHG-AMT.        26860019
257500                                                                  26870019
257600     MOVE ASC-FRGT-WGHT-N          TO SHIPMT-EXPTED-GRO-WGHT.     26880019
257700     MOVE ASC-TERMS                TO SHIPMT-FRGT-TERMS-CDE.      26890019
257800                                                                  26900019
257900* TAKE THE AMOUNT ENTERED FOR THE TOTAL FREIGHT BILL AND SPILT    26910019
258000* IT PROPORTIONATELY AMONG ALL RECEIVERS FOR THAT FREIGHT BILL    26920019
258100* USE THE ADJUSTED CARTON COUNT IN THE CALCULATION IF IT IS       26930019
258200* DIFFERENT THAN THE CARTON COUNT.                                26940019
258300                                                                  26950019
258400     PERFORM 6100-OPEN-UPD-RECEIVER.                              26960019
258500     PERFORM 6200-FETCH-UPD-RECEIVER.                             26970019
258600                                                                  26980019
258700     PERFORM UNTIL PS-EOF-UPD-RECEIVER                            26990019
258800        IF PV-PREV-SHIPT-ID = ZERO                                27000019
258900            MOVE SHIPMT-SHIPT-ID TO PV-PREV-SHIPT-ID              27010019
259000        END-IF                                                    27020019
259100        IF SHIPMT-SHIPT-ID NOT = PV-PREV-SHIPT-ID                 27030019
259200            MOVE PA-SUM-CALC-FRGT-CHG TO SHIPMT-FRGT-CHG-AMT      27040019
259300            ADD PA-SUM-CALC-FRGT-CHG  TO PA-TOT-FRGT-CHG-AMT      27050019
259400            MOVE ZERO TO PA-SUM-CALC-FRGT-CHG                     27060019
259500        ELSE                                                      27070019
259600            MOVE ZERO TO SHIPMT-FRGT-CHG-AMT                      27080019
259700        END-IF                                                    27090019
259800        IF PS-VALID-DATE                                          27100019
259900            MOVE ASC-PROCESSED-DTE TO SHIPMT-PROCESSED-DTE        27110019
260000        ELSE                                                      27120019
260100            MOVE PC-DEFAULT-DTE    TO SHIPMT-PROCESSED-DTE        27130019
260200        END-IF                                                    27140019
260300        MOVE ASC-INVC-NBR    TO SHIPMT-INVC-NBR                   27150019
260400        MOVE PV-PREV-SHIPT-ID TO DK-SHIPMT-SHIPT-ID               27160019
260500        MOVE SHIPMT-SHIPT-ID TO PV-PREV-SHIPT-ID                  27170019
260600        PERFORM 6400-UPDATE-TSHIPMT                               27180019
260700        PERFORM 6700-SELECT-TSHIPST                               27190019
260800        PERFORM 8000-AUDIT-TSHIPMT                                27200019
260900        MOVE PV-PREV-SHIPT-ID TO SHIPMT-SHIPT-ID                  27210019
261000        MOVE ZEROES TO PA-CALC-FRGT-CHG1                          27220019
261100        SET PS-SINGLE-SHIPMENT TO TRUE                            27230019
261200        PERFORM 4350-SELECT-TSHIPMT                               27240019
261300        IF PS-MULTIPLE-SHIPMENTS                                  27250019
261400            IF SHPTPO-ACTL-CART-CNT > ZERO                        27260019
261500                COMPUTE PA-CALC-FRGT-CHG1 =                       27270019
261600                        SHPTPO-ACTL-CART-CNT / ASC-TOT-CTN-1-N    27280019
261700            ELSE                                                  27290019
261800                IF SHPTPO-EXPTED-CART-CNT > ZERO                  27300019
261900                     COMPUTE PA-CALC-FRGT-CHG1 =                  27310019
262000                         SHPTPO-EXPTED-CART-CNT / ASC-TOT-CTN-1-N 27320019
262100                END-IF                                            27330019
262200            END-IF                                                27340019
262300        ELSE                                                      27350019
262400            IF RECEIV-ACTL-CART-CNT > ZERO                        27360019
262500                COMPUTE PA-CALC-FRGT-CHG1 =                       27370019
262600                        RECEIV-ACTL-CART-CNT / ASC-TOT-CTN-1-N    27380019
262700            ELSE                                                  27390019
262800                IF RECEIV-EXPTED-CART-CNT > ZERO                  27400019
262900                     COMPUTE PA-CALC-FRGT-CHG1 =                  27410019
263000                          RECEIV-EXPTED-CART-CNT / ASC-TOT-CTN-1-N27420019
263100                END-IF                                            27430019
263200            END-IF                                                27440019
263300        END-IF                                                    27450019
263400*       IF RECEIV-ACTL-CART-CNT > ZERO                            27460019
263500*           COMPUTE PA-CALC-FRGT-CHG1 =                           27470019
263600*                   RECEIV-ACTL-CART-CNT / ASC-TOT-CTN-1-N        27480019
263700*       ELSE                                                      27490019
263800*           IF RECEIV-EXPTED-CART-CNT > ZERO                      27500019
263900*                COMPUTE PA-CALC-FRGT-CHG1 =                      27510019
264000*                       RECEIV-EXPTED-CART-CNT / ASC-TOT-CTN-1-N  27520019
264100*           END-IF                                                27530019
264200*       END-IF                                                    27540019
264300        COMPUTE PA-CALC-FRGT-CHG2 ROUNDED =                       27550019
264400                PA-CALC-FRGT-CHG1 * ASC-FRGT-CHG-N                27560019
264500        ADD  PA-CALC-FRGT-CHG2     TO PA-SUM-CALC-FRGT-CHG        27570019
264600        MOVE PA-CALC-FRGT-CHG2     TO SHPTPO-FRGT-CHG-AMT         27580019
264700        PERFORM 6450-UPDATE-TSHPTPO                               27590019
264800        PERFORM 6200-FETCH-UPD-RECEIVER                           27600019
264900     END-PERFORM.                                                 27610019
265000                                                                  27620019
265100     PERFORM 6300-CLOSE-UPD-RECEIVER.                             27630019
265200                                                                  27640019
265300     MOVE PV-PREV-SHIPT-ID     TO DK-SHIPMT-SHIPT-ID.             27650019
265400     MOVE PA-SUM-CALC-FRGT-CHG TO SHIPMT-FRGT-CHG-AMT.            27660019
265500     ADD PA-SUM-CALC-FRGT-CHG  TO PA-TOT-FRGT-CHG-AMT.            27670019
265600     IF PS-VALID-DATE                                             27680019
265700         MOVE ASC-PROCESSED-DTE TO SHIPMT-PROCESSED-DTE           27690019
265800     ELSE                                                         27700019
265900         MOVE PC-DEFAULT-DTE    TO SHIPMT-PROCESSED-DTE           27710019
266000     END-IF.                                                      27720019
266100     MOVE ASC-INVC-NBR    TO SHIPMT-INVC-NBR.                     27730019
266200     PERFORM 6400-UPDATE-TSHIPMT.                                 27740019
266300     PERFORM 6700-SELECT-TSHIPST.                                 27750019
266400     PERFORM 8000-AUDIT-TSHIPMT.                                  27760019
266500                                                                  27770019
266600* DUE TO ROUNDING ERRORS, THERE MAY BE INSTANCES WHERE THE        27780019
266700* SUM OF THE INDIVIDUAL CHARGES MAY BE DIFFERENT THAN WHAT WAS    27790019
266800* TYPED IN. IN THAT CASE, WE WILL ADD THE DIFFERENCE TO THE LAST  27800019
266900* SHIPMENT-ID FOR THAT FREIGHT BILL SO THAT WHEN A REFRESH IS     27810019
267000* REQUESTED, THE RECALCULATION OF THE TOTAL FEIGHT BILL WILL      27820019
267100* BE INDENTICAL TO WHAT WAS ORIGINALLY ENTERED.                   27830019
267200                                                                  27840019
267300     IF  ASC-FRGT-CHG-N NOT = PA-TOT-FRGT-CHG-AMT                 27850019
267400         SUBTRACT PA-TOT-FRGT-CHG-AMT  FROM                       27860019
267500                  ASC-FRGT-CHG-N GIVING PA-DIFFERENCE             27870019
267600*        PERFORM 6500-GET-LAST-SHIPMENT                           27880019
267700         PERFORM 6600-UPDATE-LAST-RECEIVER                        27890019
267800     END-IF.                                                      27900019
267900                                                                  27910019
268000     MOVE PC-TSYMSG-00059          TO DP020-MSG-NUMBER.           27920019
268100     SET DP020-MSG-INFORMATIONAL   TO TRUE.                       27930019
268200                                                                  27940019
268300     IF  ASC-USE-SELECTION-QUEUE                                  27950019
268400         PERFORM 5200-UPDATE-SELECTION-QUEUE                      27960019
268500     END-IF.                                                      27970019
268600                                                                  27980019
268700     PERFORM 8100-AUDIT-TSHPTPO.                                  27990019
268800/                                                                 28000019
268900*----------------------------------------------------------------*28010019
269000* OPEN THE RECEIVER CURSOR FOR UPDATES                           *28020019
269100*----------------------------------------------------------------*28030019
269200                                                                  28040019
269300 6100-OPEN-UPD-RECEIVER.                                          28050019
269400                                                                  28060019
269500     PERFORM                                                      28070019
269600         WITH TEST AFTER                                          28080019
269700         VARYING PV-RETRY-COUNTER                                 28090019
269800         FROM 1 BY 1                                              28100019
269900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28110019
270000            OR (SQLCODE = +0))                                    28120019
270100                                                                  28130019
270200         EXEC SQL                                                 28140019
270300             OPEN RECEIVER-UPD-CSR                                28150019
270400         END-EXEC                                                 28160019
270500                                                                  28170019
270600         EVALUATE TRUE                                            28180019
270700             WHEN SQLCODE = +0                                    28190019
270800                  CONTINUE                                        28200019
270900             WHEN SQLCODE = -904                                  28210019
271000             WHEN SQLCODE = -913                                  28220019
271100                  CONTINUE                                        28230019
271200             WHEN SQLWARN0 NOT = SPACE                            28240019
271300             WHEN SQLCODE  NOT = +0                               28250019
271400                  MOVE '6100-OPEN-UPD-RECEIVER'                   28260019
271500                                   TO DP013-PARAGRAPH             28270019
271600                  MOVE 'OPEN RECEIVER-UPD-CSR CURSOR'             28280019
271700                                   TO DP013-MESSAGE-TEXT (1)      28290019
271800                  MOVE SQLCA       TO DP013-SQLCA                 28300019
271900                  MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)    28310019
272000                  MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (2)    28320019
272100                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (3)    28330019
272200                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (4)    28340019
272300                  SET DP013-DB2-ABEND                             28350019
272400                                   TO TRUE                        28360019
272500                  PERFORM DP013-0000-PROCESS-ABEND                28370019
272600         END-EVALUATE                                             28380019
272700     END-PERFORM.                                                 28390019
272800                                                                  28400019
272900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    28410019
273000         SQLCODE  NOT = +0                                        28420019
273100         MOVE '6100-OPEN-UPD-RECEIVER'                            28430019
273200                                   TO DP013-PARAGRAPH             28440019
273300         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              28450019
273400                                   TO DP013-MESSAGE-TEXT (1)      28460019
273500         MOVE SQLCA                TO DP013-SQLCA                 28470019
273600         SET DP013-DB2-ABEND       TO TRUE                        28480019
273700         PERFORM DP013-0000-PROCESS-ABEND                         28490019
273800     END-IF.                                                      28500019
273900                                                                  28510019
274000/                                                                 28520019
274100*----------------------------------------------------------------*28530019
274200*    FETCH A PROOF OF DELIVER ROW                                *28540019
274300*----------------------------------------------------------------*28550019
274400                                                                  28560019
274500 6200-FETCH-UPD-RECEIVER.                                         28570019
274600                                                                  28580019
274700     EXEC SQL                                                     28590019
274800          FETCH  RECEIVER-UPD-CSR                                 28600019
274900           INTO  :RECEIV-ORD-NBR                                  28610019
275000               , :RECEIV-REC-SEQ-NBR                              28620019
275100               , :RECEIV-EXPTED-CART-CNT                          28630019
275200               , :RECEIV-ACTL-CART-CNT                            28640019
275300               , :RECEIV-OPER-UNT-ID                              28650019
275400               , :SHPTPO-SHIPT-ID                                 28660019
275500               , :SHPTPO-PO-NBR                                   28670019
275600               , :SHPTPO-EXPTED-CART-CNT                          28680019
275700               , :SHPTPO-ACTL-CART-CNT                            28690019
275800               , :SHIPMT-SHIPT-ID                                 28700019
275900     END-EXEC.                                                    28710019
276000                                                                  28720019
276100     EVALUATE TRUE                                                28730019
276200         WHEN SQLCODE = +0                                        28740019
276300              MOVE SHIPMT-SHIPT-ID TO PV-SHIPT-ID                 28750019
276400         WHEN SQLCODE = +100                                      28760019
276500              SET PS-EOF-UPD-RECEIVER                             28770019
276600                                   TO TRUE                        28780019
276700         WHEN SQLWARN0 NOT = SPACE                                28790019
276800         WHEN SQLCODE < +0                                        28800019
276900         WHEN SQLCODE > +0                                        28810019
277000              MOVE '6200-FETCH-UPD-RECEIVER'                      28820019
277100                                   TO DP013-PARAGRAPH             28830019
277200              MOVE 'FETCH TRECEIV CURSOR'                         28840019
277300                                   TO DP013-MESSAGE-TEXT (1)      28850019
277400              MOVE SQLCA           TO DP013-SQLCA                 28860019
277500              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    28870019
277600              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    28880019
277700              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (3)    28890019
277800              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (4)    28900019
277900              SET DP013-DB2-ABEND  TO TRUE                        28910019
278000              PERFORM DP013-0000-PROCESS-ABEND                    28920019
278100     END-EVALUATE.                                                28930019
278200                                                                  28940019
278300/                                                                 28950019
278400*----------------------------------------------------------------*28960019
278500* CLOSE THE PROOF OF DELIVER CURSOR TO GET RECEIVERS FOR UPDATES *28970019
278600*----------------------------------------------------------------*28980019
278700                                                                  28990019
278800 6300-CLOSE-UPD-RECEIVER.                                         29000019
278900                                                                  29010019
279000     EXEC SQL                                                     29020019
279100         CLOSE RECEIVER-UPD-CSR                                   29030019
279200     END-EXEC.                                                    29040019
279300                                                                  29050019
279400     EVALUATE TRUE                                                29060019
279500         WHEN SQLCODE = +0                                        29070019
279600              CONTINUE                                            29080019
279700         WHEN SQLWARN0 NOT = SPACE                                29090019
279800         WHEN SQLCODE  NOT = +0                                   29100019
279900              MOVE '6300-CLOSE-UPD-RECEIVER'                      29110019
280000                                   TO DP013-PARAGRAPH             29120019
280100              MOVE 'CLOSE RECEIVER-UPD-CSR CURSOR'                29130019
280200                                   TO DP013-MESSAGE-TEXT (1)      29140019
280300              MOVE SQLCA           TO DP013-SQLCA                 29150019
280400              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    29160019
280500              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    29170019
280600              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (3)    29180019
280700              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (4)    29190019
280800              SET DP013-DB2-ABEND  TO TRUE                        29200019
280900              PERFORM DP013-0000-PROCESS-ABEND                    29210019
281000     END-EVALUATE.                                                29220019
281100                                                                  29230019
281200/                                                                 29240019
281300*----------------------------------------------------------------*29250019
281400*  UPDATE THE ROW ON THE SHIPMENT TABLE                          *29260019
281500*----------------------------------------------------------------*29270019
281600 6400-UPDATE-TSHIPMT.                                             29280019
281700                                                                  29290019
281800     PERFORM                                                      29300019
281900         WITH TEST AFTER                                          29310019
282000         VARYING PV-RETRY-COUNTER                                 29320019
282100         FROM 1 BY 1                                              29330019
282200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29340019
282300             OR (SQLCODE = +0))                                   29350019
282400                                                                  29360019
282500         EXEC SQL                                                 29370019
282600             UPDATE TSHIPMT                                       29380019
282700               SET  FRGT_CHG_AMT    = :SHIPMT-FRGT-CHG-AMT        29390019
282800                   ,FRGT_TERMS_CDE  = :SHIPMT-FRGT-TERMS-CDE      29400019
282900                   ,EXPTED_GRO_WGHT = :SHIPMT-EXPTED-GRO-WGHT     29410019
283000                   ,PROCESSED_DTE   = :SHIPMT-PROCESSED-DTE       29420019
283100                   ,INVC_NBR        = :SHIPMT-INVC-NBR            29430019
283200             WHERE SHIPT_ID = :DK-SHIPMT-SHIPT-ID                 29440019
283300         END-EXEC                                                 29450019
283400                                                                  29460019
283500         EVALUATE TRUE                                            29470019
283600             WHEN SQLCODE = +0                                    29480019
283700             WHEN SQLCODE = -904                                  29490019
283800             WHEN SQLCODE = -913                                  29500019
283900                 CONTINUE                                         29510019
284000             WHEN SQLWARN0 NOT = SPACES                           29520019
284100             WHEN SQLCODE < +0                                    29530019
284200             WHEN SQLCODE > +0                                    29540019
284300                 MOVE '6400-UPDATE-TSHIPMT'                       29550019
284400                                   TO DP013-PARAGRAPH             29560019
284500                 MOVE 'UPDATE A ROW ON TSHIPMT'                   29570019
284600                                   TO DP013-MESSAGE-TEXT(1)       29580019
284700                 MOVE SQLCA        TO DP013-SQLCA                 29590019
284800                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    29600019
284900                 SET DP013-DB2-ABEND                              29610019
285000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29620019
285100                 PERFORM DP013-0000-PROCESS-ABEND                 29630019
285200         END-EVALUATE                                             29640019
285300     END-PERFORM.                                                 29650019
285400                                                                  29660019
285500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    29670019
285600         SQLCODE  NOT = +0                                        29680019
285700         MOVE '6400-UPDATE-TSHIPMT'                               29690019
285800                                   TO DP013-PARAGRAPH             29700019
285900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              29710019
286000                                   TO DP013-MESSAGE-TEXT (1)      29720019
286100         MOVE 'TO UPDATE A TSHIPMT ROW'                           29730019
286200                                   TO DP013-MESSAGE-TEXT (2)      29740019
286300         MOVE SQLCA                TO DP013-SQLCA                 29750019
286400         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    29760019
286500         SET DP013-DB2-ABEND                                      29770019
286600             DP013-XCTL-DISPLAY-RESTART                           29780019
286700                                   TO TRUE                        29790019
286800         PERFORM DP013-0000-PROCESS-ABEND                         29800019
286900     END-IF.                                                      29810019
287000                                                                  29820019
287100/                                                                 29830019
287200*----------------------------------------------------------------*29840019
287300*  UPDATE THE ROW ON THE SHPTPO TABLE                            *29850019
287400*----------------------------------------------------------------*29860019
287500 6450-UPDATE-TSHPTPO.                                             29870019
287600                                                                  29880019
287700     PERFORM                                                      29890019
287800         WITH TEST AFTER                                          29900019
287900         VARYING PV-RETRY-COUNTER                                 29910019
288000         FROM 1 BY 1                                              29920019
288100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29930019
288200             OR (SQLCODE = +0))                                   29940019
288300                                                                  29950019
288400         EXEC SQL                                                 29960019
288500             UPDATE TSHPTPO                                       29970019
288600               SET  FRGT_CHG_AMT     = :SHPTPO-FRGT-CHG-AMT       29980019
288700                  , LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME   29990019
288800                  , LAST_UPD_DTE     = CURRENT DATE               30000019
288900                  , LAST_UPD_TIME    = CURRENT TIME               30010019
289000                  , LAST_UPD_USER_ID = :DP020-USERID              30020019
289100             WHERE SHIPT_ID = :SHIPMT-SHIPT-ID                    30030019
289200               AND PO_NBR   = :RECEIV-ORD-NBR                     30040019
289300         END-EXEC                                                 30050019
289400                                                                  30060019
289500         EVALUATE TRUE                                            30070019
289600             WHEN SQLCODE = +0                                    30080019
289700             WHEN SQLCODE = -904                                  30090019
289800             WHEN SQLCODE = -913                                  30100019
289900                 CONTINUE                                         30110019
290000             WHEN SQLWARN0 NOT = SPACES                           30120019
290100             WHEN SQLCODE < +0                                    30130019
290200             WHEN SQLCODE > +0                                    30140019
290300                 MOVE '6450-UPDATE-TSHPTPO'                       30150019
290400                                   TO DP013-PARAGRAPH             30160019
290500                 MOVE 'UPDATE A ROW ON TSHPTPO'                   30170019
290600                                   TO DP013-MESSAGE-TEXT(1)       30180019
290700                 MOVE SQLCA        TO DP013-SQLCA                 30190019
290800                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    30200019
290900                 SET DP013-DB2-ABEND                              30210019
291000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30220019
291100                 PERFORM DP013-0000-PROCESS-ABEND                 30230019
291200         END-EVALUATE                                             30240019
291300     END-PERFORM.                                                 30250019
291400                                                                  30260019
291500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    30270019
291600         SQLCODE  NOT = +0                                        30280019
291700         MOVE '6450-UPDATE-TSHPTPO'                               30290019
291800                                   TO DP013-PARAGRAPH             30300019
291900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              30310019
292000                                   TO DP013-MESSAGE-TEXT (1)      30320019
292100         MOVE 'TO UPDATE A TSHPTPO ROW'                           30330019
292200                                   TO DP013-MESSAGE-TEXT (2)      30340019
292300         MOVE SQLCA                TO DP013-SQLCA                 30350019
292400         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    30360019
292500         SET DP013-DB2-ABEND                                      30370019
292600             DP013-XCTL-DISPLAY-RESTART                           30380019
292700                                   TO TRUE                        30390019
292800         PERFORM DP013-0000-PROCESS-ABEND                         30400019
292900     END-IF.                                                      30410019
293000                                                                  30420019
293100/                                                                 30430019
293200*----------------------------------------------------------------*30440019
293300* GET THE SHIPMENT ID FOR THE LAST RECEIVER FOR THIS FREIGHT BILL*30450019
293400*----------------------------------------------------------------*30460019
293500 6500-GET-LAST-SHIPMENT.                                          30470019
293600                                                                  30480019
293700     PERFORM                                                      30490019
293800         WITH TEST AFTER                                          30500019
293900         VARYING PV-RETRY-COUNTER                                 30510019
294000         FROM 1 BY 1                                              30520019
294100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30530019
294200             OR (SQLCODE = +0)                                    30540019
294300             OR (SQLCODE = +100))                                 30550019
294400                                                                  30560019
294500         EXEC SQL                                                 30570019
294600             SELECT A.ORD_NBR                                     30580019
294700                   ,A.REC_SEQ_NBR                                 30590019
294800                   ,C.SHIPT_ID                                    30600019
294900              INTO :DK-ORD-NBR                                    30610019
295000                  ,:DK-REC-SEQ-NBR                                30620019
295100                  ,:DK-SHIPT-ID                                   30630019
295200               FROM TRECEIV A                                     30640019
295300                   ,TVHTRIP B                                     30650019
295400                   ,TSHPTPO C                                     30660019
295500                   ,TSHIPMT D                                     30670019
295600              WHERE D.PRO_NBR        = :DK-PRO-NBR                30680019
295700                AND D.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID          30690019
295800                AND A.VER_STATUS_CDE = 'A'                        30700019
295900                AND A.ORD_NBR     = C.PO_NBR                      30710019
296000                AND A.REC_SEQ_NBR = C.REC_SEQ_NBR                 30720019
296100                AND C.SHIPT_ID    = D.SHIPT_ID                    30730019
296200                AND D.TRIP_ID     = B.TRIP_ID                     30740019
296300                AND A.REC_SEQ_NBR =                               30750019
296400                    (SELECT MAX(E.REC_SEQ_NBR)                    30760019
296500                       FROM TRECEIV E                             30770019
296600                           ,TVHTRIP F                             30780019
296700                           ,TSHPTPO G                             30790019
296800                           ,TSHIPMT H                             30800019
296900                      WHERE H.PRO_NBR        = :DK-PRO-NBR        30810019
297000                        AND H.PRO_SCAC_ID    = :DK-OWNER-SCAC-ID  30820019
297100                        AND E.VER_STATUS_CDE = 'A'                30830019
297200                        AND E.ORD_NBR     = G.PO_NBR              30840019
297300                        AND E.REC_SEQ_NBR = G.REC_SEQ_NBR         30850019
297400                        AND G.SHIPT_ID    = H.SHIPT_ID            30860019
297500                        AND H.TRIP_ID     = F.TRIP_ID)            30870019
297600         END-EXEC                                                 30880019
297700                                                                  30890019
297800         EVALUATE TRUE                                            30900019
297900             WHEN SQLCODE = +0                                    30910019
298000             WHEN SQLCODE = +100                                  30920019
298100             WHEN SQLCODE = -904                                  30930019
298200             WHEN SQLCODE = -913                                  30940019
298300                 CONTINUE                                         30950019
298400             WHEN SQLWARN0 NOT = SPACES                           30960019
298500             WHEN SQLCODE < +0                                    30970019
298600             WHEN SQLCODE > +0                                    30980019
298700                 MOVE '6500-GET-LAST-SHIPMENT'                    30990019
298800                                   TO DP013-PARAGRAPH             31000019
298900                 MOVE 'MAX REC SEQ NBR ON TRECEIV'                31010019
299000                                   TO DP013-MESSAGE-TEXT(1)       31020019
299100                 MOVE SQLCA        TO DP013-SQLCA                 31030019
299200                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    31040019
299300                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (2)    31050019
299400                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (3)    31060019
299500                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (4)    31070019
299600                 SET DP013-DB2-ABEND                              31080019
299700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31090019
299800                 PERFORM DP013-0000-PROCESS-ABEND                 31100019
299900         END-EVALUATE                                             31110019
300000     END-PERFORM.                                                 31120019
300100                                                                  31130019
300200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    31140019
300300         SQLCODE  NOT = +0                                        31150019
300400         MOVE '6500-GET-LAST-SHIPMENT'                            31160019
300500                                   TO DP013-PARAGRAPH             31170019
300600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              31180019
300700                                   TO DP013-MESSAGE-TEXT (1)      31190019
300800         MOVE 'TO GET LAST SHIPMENT ID'                           31200019
300900                                   TO DP013-MESSAGE-TEXT (2)      31210019
301000         MOVE SQLCA                TO DP013-SQLCA                 31220019
301100         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    31230019
301200         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (2)    31240019
301300         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (3)    31250019
301400         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (4)    31260019
301500         SET DP013-DB2-ABEND                                      31270019
301600             DP013-XCTL-DISPLAY-RESTART                           31280019
301700                                   TO TRUE                        31290019
301800         PERFORM DP013-0000-PROCESS-ABEND                         31300019
301900     END-IF.                                                      31310019
302000                                                                  31320019
302100/                                                                 31330019
302200*----------------------------------------------------------------*31340019
302300* UPDATE THE CHARGE FOR THE LAST SHIPMENT                        *31350019
302400*----------------------------------------------------------------*31360019
302500 6600-UPDATE-LAST-RECEIVER.                                       31370019
302600                                                                  31380019
302700     PERFORM                                                      31390019
302800         WITH TEST AFTER                                          31400019
302900         VARYING PV-RETRY-COUNTER                                 31410019
303000         FROM 1 BY 1                                              31420019
303100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31430019
303200             OR (SQLCODE = +0))                                   31440019
303300                                                                  31450019
303400         EXEC SQL                                                 31460019
303500             UPDATE TSHPTPO                                       31470019
303600               SET  FRGT_CHG_AMT  =  FRGT_CHG_AMT                 31480019
303700                                  + :PA-DIFFERENCE                31490019
303800                  , LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME   31500019
303900                  , LAST_UPD_DTE     = CURRENT DATE               31510019
304000                  , LAST_UPD_TIME    = CURRENT TIME               31520019
304100                  , LAST_UPD_USER_ID = :DP020-USERID              31530019
304200             WHERE SHIPT_ID    = :ASC-SHIPT-ID-L                  31540019
304300               AND PO_NBR      = :ASC-PO-NBR-L                    31550019
304400               AND REC_SEQ_NBR = :ASC-REC-SEQ-NBR-L               31560019
304500         END-EXEC                                                 31570019
304600                                                                  31580019
304700         EVALUATE TRUE                                            31590019
304800             WHEN SQLCODE = +0                                    31600019
304900             WHEN SQLCODE = -904                                  31610019
305000             WHEN SQLCODE = -913                                  31620019
305100                 CONTINUE                                         31630019
305200             WHEN SQLWARN0 NOT = SPACES                           31640019
305300             WHEN SQLCODE < +0                                    31650019
305400             WHEN SQLCODE > +0                                    31660019
305500                 MOVE '6600-UPDATE-LAST-RECEIVER'                 31670019
305600                                   TO DP013-PARAGRAPH             31680019
305700                 MOVE 'UPDATE A ROW ON TSHPTPO'                   31690019
305800                                   TO DP013-MESSAGE-TEXT(1)       31700019
305900                 MOVE SQLCA        TO DP013-SQLCA                 31710019
306000                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    31720019
306100                 SET DP013-DB2-ABEND                              31730019
306200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31740019
306300                 PERFORM DP013-0000-PROCESS-ABEND                 31750019
306400         END-EVALUATE                                             31760019
306500     END-PERFORM.                                                 31770019
306600                                                                  31780019
306700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    31790019
306800         SQLCODE  NOT = +0                                        31800019
306900         MOVE '6600-UPDATE-LAST-RECEIVER'                         31810019
307000                                   TO DP013-PARAGRAPH             31820019
307100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              31830019
307200                                   TO DP013-MESSAGE-TEXT (1)      31840019
307300         MOVE 'TO UPDATE A TSHPTPO ROW'                           31850019
307400                                   TO DP013-MESSAGE-TEXT (2)      31860019
307500         MOVE SQLCA                TO DP013-SQLCA                 31870019
307600         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    31880019
307700         SET DP013-DB2-ABEND                                      31890019
307800             DP013-XCTL-DISPLAY-RESTART                           31900019
307900                                   TO TRUE                        31910019
308000         PERFORM DP013-0000-PROCESS-ABEND                         31920019
308100     END-IF.                                                      31930019
308200                                                                  31940019
308300/                                                                 31950019
308400*----------------------------------------------------------------*31960019
308500*  SELECT LATEST SHIPMENT STATUS ROW                             *31970019
308600*----------------------------------------------------------------*31980019
308700 6700-SELECT-TSHIPST.                                             31990019
308800                                                                  32000019
308900     PERFORM                                                      32010019
309000         WITH TEST AFTER                                          32020019
309100         VARYING PV-RETRY-COUNTER                                 32030019
309200         FROM 1 BY 1                                              32040019
309300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32050019
309400             OR (SQLCODE = +0))                                   32060019
309500                                                                  32070019
309600         EXEC SQL                                                 32080019
309700             SELECT  A.SHIPT_STATUS_CDE                           32090019
309800             INTO    :SHIPST-SHIPT-STATUS-CDE                     32100019
309900           FROM   TSHIPST A                                       32110019
310000                 ,TSHSTYP B                                       32120019
310100           WHERE  A.SHIPT_ID   = :DK-SHIPMT-SHIPT-ID              32130019
310200             AND  B.PRTY_CDE =                                    32140019
310300                  (SELECT MAX(D.PRTY_CDE)                         32150019
310400                     FROM TSHIPST C                               32160019
310500                         ,TSHSTYP D                               32170019
310600                    WHERE C.SHIPT_ID         = A.SHIPT_ID         32180019
310700                      AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)32190019
310800             AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE         32200019
310900         END-EXEC                                                 32210019
311000                                                                  32220019
311100         EVALUATE TRUE                                            32230019
311200             WHEN SQLCODE = +0                                    32240019
311300             WHEN SQLCODE = -904                                  32250019
311400             WHEN SQLCODE = -913                                  32260019
311500                 CONTINUE                                         32270019
311600                                                                  32280019
311700             WHEN SQLWARN0 NOT = SPACES                           32290019
311800             WHEN SQLCODE < +0                                    32300019
311900             WHEN SQLCODE > +0                                    32310019
312000                 MOVE '6700-SELECT-TSHIPST'                       32320019
312100                                   TO DP013-PARAGRAPH             32330019
312200                 MOVE 'SELECT A TSHIPST ROW   '                   32340019
312300                                   TO DP013-MESSAGE-TEXT(1)       32350019
312400                 MOVE SQLCA        TO DP013-SQLCA                 32360019
312500                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    32370019
312600                 SET DP013-DB2-ABEND                              32380019
312700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32390019
312800                 PERFORM DP013-0000-PROCESS-ABEND                 32400019
312900         END-EVALUATE                                             32410019
313000     END-PERFORM.                                                 32420019
313100                                                                  32430019
313200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    32440019
313300         SQLCODE  NOT = +0                                        32450019
313400         MOVE '6700-SELECT-TSHIPST'                               32460019
313500                                   TO DP013-PARAGRAPH             32470019
313600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              32480019
313700                                   TO DP013-MESSAGE-TEXT (1)      32490019
313800         MOVE 'TO SELECT A TSHIPST ROW'                           32500019
313900                                   TO DP013-MESSAGE-TEXT (2)      32510019
314000         MOVE SQLCA                TO DP013-SQLCA                 32520019
314100         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    32530019
314200         SET DP013-DB2-ABEND                                      32540019
314300             DP013-XCTL-DISPLAY-RESTART                           32550019
314400                                   TO TRUE                        32560019
314500         PERFORM DP013-0000-PROCESS-ABEND                         32570019
314600     END-IF.                                                      32580019
314700                                                                  32590019
314800/                                                                 32600019
314900*----------------------------------------------------------------*32610019
315000*    START TRANID FOR TRKCS141 (PRINT FREIGHT BILL RECEIVER LIST)*32620019
315100*----------------------------------------------------------------*32630019
315200 7000-FORMAT-COMMAREA.                                            32640019
315300                                                                  32650019
315400     MOVE ASC-KEY-OWNER-SCAC-ID  TO PV-CA-OWNER-SCAC-ID.          32660019
315500     MOVE ASC-KEY-PRO-NBR        TO PV-CA-PRO-NBR.                32670019
315600     MOVE ASC-PRINTER-ID-X       TO PV-CA-PRINTER.                32680019
315700                                                                  32690019
315800/                                                                 32700019
315900*----------------------------------------------------------------*32710019
316000*    START TRANID FOR TRKCS141 (PRINT FREIGHT BILL RECEIVER LIST)*32720019
316100*----------------------------------------------------------------*32730019
316200 7100-START-TRANID-Y141.                                          32740019
316300                                                                  32750019
316400     EXEC CICS                                                    32760019
316500          START TRANSID ('Y141')                                  32770019
316600                FROM    (PV-TRKCS141-COMMAREA)                    32780019
316700                LENGTH  (34)                                      32790019
316800     END-EXEC.                                                    32800019
316900                                                                  32810019
317000/                                                                 32820019
317100*----------------------------------------------------------------*32830019
317200*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TSHIPMT AND WRITE      *32840019
317300*  TO THE AUDIT TABLE.                                           *32850019
317400*----------------------------------------------------------------*32860019
317500 8000-AUDIT-TSHIPMT.                                              32870019
317600                                                                  32880019
317700     INITIALIZE DCLTAUSHIP.                                       32890019
317800                                                                  32900019
317810* CLT 12/09/2011 WR40574 ADDED CARR-AUTH-ID BELOW                 32910023
317900     PERFORM                                                      32920019
318000         WITH TEST AFTER                                          32930019
318100         VARYING PV-RETRY-COUNTER                                 32940019
318200         FROM 1 BY 1                                              32950019
318300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32960019
318400             OR (SQLCODE = +0))                                   32970019
318500                                                                  32980019
318600         EXEC SQL                                                 32990019
318700             SELECT  TRIP_ID                                      33000019
318800                    ,SHIPT_ID                                     33010019
318900                    ,CRT_SRC_CDE                                  33020019
319000                    ,LAST_UPD_DTE                                 33030019
319100                    ,LAST_UPD_TME                                 33040019
319200                    ,LAST_UPD_UID                                 33050019
319300                    ,PRO_SCAC_ID                                  33060019
319400                    ,PRO_NBR                                      33070019
319500                    ,BOL_NBR                                      33080019
319600                    ,SHIPPER_NME                                  33090019
319700                    ,SHIPT_TYP_CDE                                33100019
319800                    ,EXPTED_GRO_WGHT                              33110019
319900                    ,PKG_TYP_CDE                                  33120019
320000                    ,EXPTED_PKG_QTY                               33130019
320100                    ,FRGT_CHG_AMT                                 33140019
320200                    ,FRGT_TERMS_CDE                               33150019
320300                    ,EXPTED_PLT_QTY                               33160019
320400                    ,VEND_SHIP_DTE                                33170019
320500                    ,EST_AR_TMST                                  33180019
320600                    ,ORIG_SCAC_ID                                 33190019
320700                    ,LAST_UPD_PGM_ID                              33200019
320800                    ,CRE_USER_ID                                  33210019
320900                    ,CARR_CART_CT                                 33220019
321000                    ,CARR_LAST_UPD_DTE                            33230019
321100                    ,CARR_LAST_UPD_TIME                           33240019
321200                    ,VEND_CART_CT                                 33250019
321300                    ,VEND_LAST_UPD_DTE                            33260019
321400                    ,VEND_LAST_UPD_TIME                           33270019
321500                    ,VEH_NBR                                      33280019
321600                    ,AUTH_NBR                                     33290019
321700                    ,AUTH_DTE                                     33300019
321800                    ,CONFIRM_DTE                                  33310019
321900                    ,CONFIRM_TIME                                 33320019
322000                    ,COMPLETE_PRO_NBR                             33330019
322100                    ,COMPLETE_BOL_NBR                             33340019
322200                    ,PROCESSED_DTE                                33350019
322300                    ,INVC_NBR                                     33360019
322310                    ,CARR_AUTH_ID                                 33370023
322400            INTO     :SHIPMT-TRIP-ID                              33380019
322500                       :DN-TRIP-ID                                33390019
322600                    ,:SHIPMT-SHIPT-ID                             33400019
322700                    ,:SHIPMT-CRT-SRC-CDE                          33410019
322800                    ,:SHIPMT-LAST-UPD-DTE                         33420019
322900                    ,:SHIPMT-LAST-UPD-TME                         33430019
323000                    ,:SHIPMT-LAST-UPD-UID                         33440019
323100                    ,:SHIPMT-PRO-SCAC-ID                          33450019
323200                    ,:SHIPMT-PRO-NBR                              33460019
323300                    ,:SHIPMT-BOL-NBR                              33470019
323400                    ,:SHIPMT-SHIPPER-NME                          33480019
323500                    ,:SHIPMT-SHIPT-TYP-CDE                        33490019
323600                    ,:SHIPMT-EXPTED-GRO-WGHT                      33500019
323700                    ,:SHIPMT-PKG-TYP-CDE                          33510019
323800                    ,:SHIPMT-EXPTED-PKG-QTY                       33520019
323900                    ,:SHIPMT-FRGT-CHG-AMT                         33530019
324000                    ,:SHIPMT-FRGT-TERMS-CDE                       33540019
324100                    ,:SHIPMT-EXPTED-PLT-QTY                       33550019
324200                    ,:SHIPMT-VEND-SHIP-DTE                        33560019
324300                    ,:SHIPMT-EST-AR-TMST                          33570019
324400                       :DN-SHIP-EST-AR-TMST                       33580019
324500                    ,:SHIPMT-ORIG-SCAC-ID                         33590019
324600                    ,:SHIPMT-LAST-UPD-PGM-ID                      33600019
324700                    ,:SHIPMT-CRE-USER-ID                          33610019
324800                    ,:SHIPMT-CARR-CART-CT                         33620019
324900                    ,:SHIPMT-CARR-LAST-UPD-DTE                    33630019
325000                    ,:SHIPMT-CARR-LAST-UPD-TIME                   33640019
325100                    ,:SHIPMT-VEND-CART-CT                         33650019
325200                    ,:SHIPMT-VEND-LAST-UPD-DTE                    33660019
325300                    ,:SHIPMT-VEND-LAST-UPD-TIME                   33670019
325400                    ,:SHIPMT-VEH-NBR                              33680019
325500                    ,:SHIPMT-AUTH-NBR                             33690019
325600                    ,:SHIPMT-AUTH-DTE                             33700019
325700                    ,:SHIPMT-CONFIRM-DTE                          33710019
325800                    ,:SHIPMT-CONFIRM-TIME                         33720019
325900                    ,:SHIPMT-COMPLETE-PRO-NBR                     33730019
326000                    ,:SHIPMT-COMPLETE-BOL-NBR                     33740019
326100                    ,:SHIPMT-PROCESSED-DTE                        33750019
326200                    ,:SHIPMT-INVC-NBR                             33760019
326210                    ,:SHIPMT-CARR-AUTH-ID                         33770024
326300           FROM   TSHIPMT                                         33780019
326400           WHERE  SHIPT_ID = :DK-SHIPMT-SHIPT-ID                  33790019
326500         END-EXEC                                                 33800019
326600                                                                  33810019
326700         EVALUATE TRUE                                            33820019
326800             WHEN SQLCODE = +0                                    33830019
326900             WHEN SQLCODE = -904                                  33840019
327000             WHEN SQLCODE = -913                                  33850019
327100                 CONTINUE                                         33860019
327200                                                                  33870019
327300             WHEN SQLWARN0 NOT = SPACES                           33880019
327400             WHEN SQLCODE < +0                                    33890019
327500             WHEN SQLCODE > +0                                    33900019
327600                 MOVE '8000-AUDIT-TSHIPMT'                        33910019
327700                                   TO DP013-PARAGRAPH             33920019
327800                 MOVE 'SELECT A TSHIPMT ROW   '                   33930019
327900                                   TO DP013-MESSAGE-TEXT(1)       33940019
328000                 MOVE SQLCA        TO DP013-SQLCA                 33950019
328100                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    33960019
328200                 SET DP013-DB2-ABEND                              33970019
328300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           33980019
328400                 PERFORM DP013-0000-PROCESS-ABEND                 33990019
328500         END-EVALUATE                                             34000019
328600     END-PERFORM.                                                 34010019
328700                                                                  34020019
328800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    34030019
328900         SQLCODE  NOT = +0                                        34040019
329000         MOVE '8000-AUDIT-TSHIPMT '                               34050019
329100                                   TO DP013-PARAGRAPH             34060019
329200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              34070019
329300                                   TO DP013-MESSAGE-TEXT (1)      34080019
329400         MOVE 'TO SELECT A TSHIPMT ROW'                           34090019
329500                                   TO DP013-MESSAGE-TEXT (2)      34100019
329600         MOVE SQLCA                TO DP013-SQLCA                 34110019
329700         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    34120019
329800         SET DP013-DB2-ABEND                                      34130019
329900             DP013-XCTL-DISPLAY-RESTART                           34140019
330000                                   TO TRUE                        34150019
330100         PERFORM DP013-0000-PROCESS-ABEND                         34160019
330200     END-IF.                                                      34170019
330300                                                                  34180019
330310* CLT 12/09/2011 WR40574 ADDED CARR-AUTH-ID BELOW                 34190023
330400     PERFORM                                                      34200019
330500         WITH TEST AFTER                                          34210019
330600         VARYING PV-RETRY-COUNTER                                 34220019
330700         FROM 1 BY 1                                              34230019
330800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               34240019
330900             OR (SQLCODE = +0))                                   34250019
331000                                                                  34260019
331100         EXEC SQL                                                 34270019
331200             INSERT  INTO TAUSHIP                                 34280019
331300                    (TRIP_ID                                      34290019
331400                    ,SHIPT_ID                                     34300019
331500                    ,CRT_SRC_CDE                                  34310019
331600                    ,LAST_UPD_DTE                                 34320019
331700                    ,LAST_UPD_TME                                 34330019
331800                    ,LAST_UPD_UID                                 34340019
331900                    ,PRO_SCAC_ID                                  34350019
332000                    ,PRO_NBR                                      34360019
332100                    ,BOL_NBR                                      34370019
332200                    ,SHIPPER_NME                                  34380019
332300                    ,SHIPT_TYP_CDE                                34390019
332400                    ,EXPTED_GRO_WGHT                              34400019
332500                    ,PKG_TYP_CDE                                  34410019
332600                    ,EXPTED_PKG_QTY                               34420019
332700                    ,FRGT_CHG_AMT                                 34430019
332800                    ,FRGT_TERMS_CDE                               34440019
332900                    ,EST_AR_TMST                                  34450019
333000                    ,VEND_SHIP_DTE                                34460019
333100                    ,EXPTED_PLT_QTY                               34470019
333200                    ,ORIG_SCAC_ID                                 34480019
333300                    ,LAST_UPD_PGM_ID                              34490019
333400                    ,CRE_USER_ID                                  34500019
333500                    ,CARR_CART_CT                                 34510019
333600                    ,CARR_LAST_UPD_DTE                            34520019
333700                    ,CARR_LAST_UPD_TIME                           34530019
333800                    ,VEND_CART_CT                                 34540019
333900                    ,VEND_LAST_UPD_DTE                            34550019
334000                    ,VEND_LAST_UPD_TIME                           34560019
334100                    ,VEH_NBR                                      34570019
334200                    ,AUTH_NBR                                     34580019
334300                    ,AUTH_DTE                                     34590019
334400                    ,CONFIRM_DTE                                  34600019
334500                    ,CONFIRM_TIME                                 34610019
334600                    ,PROCESSED_DTE                                34620019
334700                    ,INVC_NBR                                     34630019
334800                    ,AUD_STATUS_CDE                               34640023
334810                    ,CARR_AUTH_ID  )                              34650023
334900            VALUES  (:SHIPMT-TRIP-ID                              34660019
335000                       :DN-TRIP-ID                                34670019
335100                    ,:SHIPMT-SHIPT-ID                             34680019
335200                    ,:SHIPMT-CRT-SRC-CDE                          34690019
335300                    ,:SHIPMT-LAST-UPD-DTE                         34700019
335400                    ,:SHIPMT-LAST-UPD-TME                         34710019
335500                    ,:SHIPMT-LAST-UPD-UID                         34720019
335600                    ,:SHIPMT-PRO-SCAC-ID                          34730019
335700                    ,:SHIPMT-COMPLETE-PRO-NBR                     34740019
335800                    ,:SHIPMT-COMPLETE-BOL-NBR                     34750019
335900                    ,:SHIPMT-SHIPPER-NME                          34760019
336000                    ,:SHIPMT-SHIPT-TYP-CDE                        34770019
336100                    ,:SHIPMT-EXPTED-GRO-WGHT                      34780019
336200                    ,:SHIPMT-PKG-TYP-CDE                          34790019
336300                    ,:SHIPMT-EXPTED-PKG-QTY                       34800019
336400                    ,:SHIPMT-FRGT-CHG-AMT                         34810019
336500                    ,:SHIPMT-FRGT-TERMS-CDE                       34820019
336600                    ,:SHIPMT-EST-AR-TMST                          34830019
336700                       :DN-SHIP-EST-AR-TMST                       34840019
336800                    ,:SHIPMT-VEND-SHIP-DTE                        34850019
336900                    ,:SHIPMT-EXPTED-PLT-QTY                       34860019
337000                    ,:SHIPMT-ORIG-SCAC-ID                         34870019
337100                    ,:SHIPMT-LAST-UPD-PGM-ID                      34880019
337200                    ,:SHIPMT-CRE-USER-ID                          34890019
337300                    ,:SHIPMT-CARR-CART-CT                         34900019
337400                    ,:SHIPMT-CARR-LAST-UPD-DTE                    34910019
337500                    ,:SHIPMT-CARR-LAST-UPD-TIME                   34920019
337600                    ,:SHIPMT-VEND-CART-CT                         34930019
337700                    ,:SHIPMT-VEND-LAST-UPD-DTE                    34940019
337800                    ,:SHIPMT-VEND-LAST-UPD-TIME                   34950019
337900                    ,:SHIPMT-VEH-NBR                              34960019
338000                    ,:SHIPMT-AUTH-NBR                             34970019
338100                    ,:SHIPMT-AUTH-DTE                             34980019
338200                    ,:SHIPMT-CONFIRM-DTE                          34990019
338300                    ,:SHIPMT-CONFIRM-TIME                         35000019
338400                    ,:SHIPMT-PROCESSED-DTE                        35010019
338500                    ,:SHIPMT-INVC-NBR                             35020019
338600                    ,:SHIPST-SHIPT-STATUS-CDE                     35030023
338610                    ,:SHIPMT-CARR-AUTH-ID     )                   35040023
338700         END-EXEC                                                 35050019
338800                                                                  35060019
338900         EVALUATE TRUE                                            35070019
339000             WHEN SQLCODE = +0                                    35080019
339100             WHEN SQLCODE = -904                                  35090019
339200             WHEN SQLCODE = -913                                  35100019
339300                 CONTINUE                                         35110019
339400                                                                  35120019
339500             WHEN SQLWARN0 NOT = SPACES                           35130019
339600             WHEN SQLCODE < +0                                    35140019
339700             WHEN SQLCODE > +0                                    35150019
339800                 MOVE '8000-AUDIT-TSHIPMT '                       35160019
339900                                   TO DP013-PARAGRAPH             35170019
340000                 MOVE 'INSERT A ROW ON TAUSHIP'                   35180019
340100                                   TO DP013-MESSAGE-TEXT(1)       35190019
340200                 MOVE SQLCA        TO DP013-SQLCA                 35200019
340300                 MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)    35210019
340400                 SET DP013-DB2-ABEND                              35220019
340500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35230019
340600                 PERFORM DP013-0000-PROCESS-ABEND                 35240019
340700         END-EVALUATE                                             35250019
340800     END-PERFORM.                                                 35260019
340900                                                                  35270019
341000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    35280019
341100         SQLCODE  NOT = +0                                        35290019
341200         MOVE '8000-AUDIT-TSHIPMT'                                35300019
341300                                   TO DP013-PARAGRAPH             35310019
341400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              35320019
341500                                   TO DP013-MESSAGE-TEXT (1)      35330019
341600         MOVE 'TO INSERT A TAUSHIP ROW'                           35340019
341700                                   TO DP013-MESSAGE-TEXT (2)      35350019
341800         MOVE SQLCA                TO DP013-SQLCA                 35360019
341900         MOVE 'TAUSHIP'            TO DP013-DB2-TABLE-NAME (1)    35370019
342000         SET DP013-DB2-ABEND                                      35380019
342100             DP013-XCTL-DISPLAY-RESTART                           35390019
342200                                   TO TRUE                        35400019
342300         PERFORM DP013-0000-PROCESS-ABEND                         35410019
342400     END-IF.                                                      35420019
342500                                                                  35430019
342600***************************************************************** 35440019
342700*     INSERT A COPY OF THE SHPTPO ROW TO THE AUDIT TRAIL TABLE  * 35450019
342800*     AFTER INSERTING THE SHPTPO TABLE.                        *  35460019
342900***************************************************************** 35470019
343000                                                                  35480019
343100 8100-AUDIT-TSHPTPO.                                              35490019
343200                                                                  35500019
343300     PERFORM                                                      35510019
343400         WITH TEST AFTER                                          35520019
343500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     35530019
343600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            35540019
343700                (SQLCODE = ZERO)   OR                             35550019
343800                (SQLCODE = +100)                                  35560019
343900                                                                  35570019
344000         EXEC SQL                                                 35580019
344100             SELECT SHIPT_ID,                                     35590019
344200                    PO_NBR,                                       35600019
344300                    REC_SEQ_NBR,                                  35610019
344400                    EXPTED_CART_CNT,                              35620019
344500                    ACTL_CART_CNT,                                35630019
344600                    DMG_CART_CNT,                                 35640019
344700                    PKSL_IND,                                     35650019
344800                    VEND_NAME,                                    35660019
344900                    FRGT_CHG_AMT,                                 35670019
345000                    LAST_UPD_PGM_ID,                              35680019
345100                    CRE_USER_ID,                                  35690019
345200                    CARR_CART_CT,                                 35700019
345300                    CARR_LAST_UPD_DTE,                            35710019
345400                    CARR_LAST_UPD_TIME,                           35720019
345500                    VEND_CART_CT,                                 35730019
345600                    VEND_LAST_UPD_DTE,                            35740019
345700                    VEND_LAST_UPD_TIME,                           35750019
345800                    CRE_TMST,                                     35760019
345900                    LAST_UPD_DTE,                                 35770019
346000                    LAST_UPD_TIME,                                35780019
346100                    LAST_UPD_USER_ID,                             35790019
346200                    PRIM_SHIPT_IND                                35800019
346300                 ,  SPLT_XMIT_IND                                 35810019
346400                 ,  SPLT_XMIT_DTE                                 35820019
346500                 ,  SPLT_XMIT_TM                                  35830019
346600               INTO :SHPTPO-SHIPT-ID,                             35840019
346700                    :SHPTPO-PO-NBR,                               35850019
346800                    :SHPTPO-REC-SEQ-NBR,                          35860019
346900                    :SHPTPO-EXPTED-CART-CNT,                      35870019
347000                    :SHPTPO-ACTL-CART-CNT,                        35880019
347100                    :SHPTPO-DMG-CART-CNT,                         35890019
347200                    :SHPTPO-PKSL-IND,                             35900019
347300                    :SHPTPO-VEND-NAME,                            35910019
347400                    :SHPTPO-FRGT-CHG-AMT,                         35920019
347500                    :SHPTPO-LAST-UPD-PGM-ID,                      35930019
347600                    :SHPTPO-CRE-USER-ID,                          35940019
347700                    :SHPTPO-CARR-CART-CT,                         35950019
347800                    :SHPTPO-CARR-LAST-UPD-DTE,                    35960019
347900                    :SHPTPO-CARR-LAST-UPD-TIME,                   35970019
348000                    :SHPTPO-VEND-CART-CT,                         35980019
348100                    :SHPTPO-VEND-LAST-UPD-DTE,                    35990019
348200                    :SHPTPO-VEND-LAST-UPD-TIME,                   36000019
348300                    :SHPTPO-CRE-TMST,                             36010019
348400                    :SHPTPO-LAST-UPD-DTE,                         36020019
348500                    :SHPTPO-LAST-UPD-TIME,                        36030019
348600                    :SHPTPO-LAST-UPD-USER-ID,                     36040019
348700                    :SHPTPO-PRIM-SHIPT-IND                        36050019
348800                  , :SHPTPO-SPLT-XMIT-IND                         36060019
348900                  , :SHPTPO-SPLT-XMIT-DTE                         36070019
349000                  , :SHPTPO-SPLT-XMIT-TM                          36080019
349100               FROM TSHPTPO                                       36090019
349200              WHERE SHIPT_ID       = :SHIPMT-SHIPT-ID             36100019
349300                AND PO_NBR         = :RECEIV-ORD-NBR              36110019
349400         END-EXEC                                                 36120019
349500                                                                  36130019
349600         EVALUATE TRUE                                            36140019
349700             WHEN SQLCODE = ZERO                                  36150019
349800             WHEN SQLCODE = +100                                  36160019
349900             WHEN SQLCODE = -904                                  36170019
350000             WHEN SQLCODE = -913                                  36180019
350100                 CONTINUE                                         36190019
350200                                                                  36200019
350300             WHEN SQLWARN0 NOT = SPACE                            36210019
350400             WHEN SQLCODE  NOT = +0                               36220019
350500                  MOVE '8100-AUDIT-SHPTPO'                        36230019
350600                                   TO DP013-PARAGRAPH             36240019
350700                  MOVE 'SELECT SHPPTPO DATA'                      36250019
350800                                   TO DP013-MESSAGE-TEXT (1)      36260019
350900                  MOVE SQLCA       TO DP013-SQLCA                 36270019
351000                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    36280019
351100                  SET DP013-DB2-ABEND                             36290019
351200                                   TO TRUE                        36300019
351300                  PERFORM DP013-0000-PROCESS-ABEND                36310019
351400         END-EVALUATE                                             36320019
351500                                                                  36330019
351600     END-PERFORM.                                                 36340019
351700                                                                  36350019
351800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    36360019
351900         SQLCODE  NOT = +0                                        36370019
352000         MOVE '8100-AUDIT-SHPTPO'                                 36380019
352100                                   TO DP013-PARAGRAPH             36390019
352200         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TSHPTPO'           36400019
352300                                   TO DP013-MESSAGE-TEXT (1)      36410019
352400         MOVE SQLCA                TO DP013-SQLCA                 36420019
352500         SET DP013-DB2-ABEND       TO TRUE                        36430019
352600         PERFORM DP013-0000-PROCESS-ABEND                         36440019
352700     END-IF.                                                      36450019
352800                                                                  36460019
352900     PERFORM                                                      36470019
353000         WITH TEST AFTER                                          36480019
353100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     36490019
353200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            36500019
353300                 SQLCODE = ZERO                                   36510019
353400                                                                  36520019
353500         EXEC SQL                                                 36530019
353600             INSERT INTO TAUSHPO                                  36540019
353700                   (SHIPT_ID,                                     36550019
353800                    PO_NBR,                                       36560019
353900                    REC_SEQ_NBR,                                  36570019
354000                    EXPTED_CART_CNT,                              36580019
354100                    ACTL_CART_CNT,                                36590019
354200                    DMG_CART_CNT,                                 36600019
354300                    PKSL_IND,                                     36610019
354400                    VEND_NAME,                                    36620019
354500                    FRGT_CHG_AMT,                                 36630019
354600                    LAST_UPD_PGM_ID,                              36640019
354700                    CRE_USER_ID,                                  36650019
354800                    CARR_CART_CT,                                 36660019
354900                    CARR_LAST_UPD_DTE,                            36670019
355000                    CARR_LAST_UPD_TIME,                           36680019
355100                    VEND_CART_CT,                                 36690019
355200                    VEND_LAST_UPD_DTE,                            36700019
355300                    VEND_LAST_UPD_TIME,                           36710019
355400                    CRE_TMST,                                     36720019
355500                    LAST_UPD_DTE,                                 36730019
355600                    LAST_UPD_TIME,                                36740019
355700                    LAST_UPD_USER_ID,                             36750019
355800                    PRIM_SHIPT_IND                                36760019
355900                 ,  SPLT_XMIT_IND                                 36770019
356000                 ,  SPLT_XMIT_DTE                                 36780019
356100                 ,  SPLT_XMIT_TM                                  36790019
356200                 ,  TRN_CDE )                                     36800019
356300             VALUES                                               36810019
356400                  (:SHPTPO-SHIPT-ID,                              36820019
356500                   :SHPTPO-PO-NBR,                                36830019
356600                   :SHPTPO-REC-SEQ-NBR,                           36840019
356700                   :SHPTPO-EXPTED-CART-CNT,                       36850019
356800                   :SHPTPO-ACTL-CART-CNT,                         36860019
356900                   :SHPTPO-DMG-CART-CNT,                          36870019
357000                   :SHPTPO-PKSL-IND,                              36880019
357100                   :SHPTPO-VEND-NAME,                             36890019
357200                   :SHPTPO-FRGT-CHG-AMT,                          36900019
357300                   :SHPTPO-LAST-UPD-PGM-ID,                       36910019
357400                   :SHPTPO-CRE-USER-ID,                           36920019
357500                   :SHPTPO-CARR-CART-CT,                          36930019
357600                   :SHPTPO-CARR-LAST-UPD-DTE,                     36940019
357700                   :SHPTPO-CARR-LAST-UPD-TIME,                    36950019
357800                   :SHPTPO-VEND-CART-CT,                          36960019
357900                   :SHPTPO-VEND-LAST-UPD-DTE,                     36970019
358000                   :SHPTPO-VEND-LAST-UPD-TIME,                    36980019
358100                   :SHPTPO-CRE-TMST,                              36990019
358200                   :SHPTPO-LAST-UPD-DTE,                          37000019
358300                   :SHPTPO-LAST-UPD-TIME,                         37010019
358400                   :SHPTPO-LAST-UPD-USER-ID,                      37020019
358500                   :SHPTPO-PRIM-SHIPT-IND                         37030019
358600                 , :SHPTPO-SPLT-XMIT-IND                          37040019
358700                 , :SHPTPO-SPLT-XMIT-DTE                          37050019
358800                 , :SHPTPO-SPLT-XMIT-TM                           37060019
358900                 , :PC-U )                                        37070019
359000         END-EXEC                                                 37080019
359100                                                                  37090019
359200         EVALUATE TRUE                                            37100019
359300             WHEN SQLCODE = ZERO                                  37110019
359400             WHEN SQLCODE = -904                                  37120019
359500             WHEN SQLCODE = -913                                  37130019
359600                 CONTINUE                                         37140019
359700                                                                  37150019
359800             WHEN SQLWARN0 NOT = SPACE                            37160019
359900             WHEN SQLCODE  NOT = +0                               37170019
360000                  MOVE '8100-AUDIT-SHPTPO'                        37180019
360100                                   TO DP013-PARAGRAPH             37190019
360200                  MOVE 'INSERT TAUSHPO DATA'                      37200019
360300                                   TO DP013-MESSAGE-TEXT (1)      37210019
360400                  MOVE SQLCA       TO DP013-SQLCA                 37220019
360500                  MOVE 'TAUSHPO'   TO DP013-DB2-TABLE-NAME (1)    37230019
360600                  SET DP013-DB2-ABEND                             37240019
360700                                   TO TRUE                        37250019
360800                  PERFORM DP013-0000-PROCESS-ABEND                37260019
360900         END-EVALUATE                                             37270019
361000     END-PERFORM.                                                 37280019
361100                                                                  37290019
361200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    37300019
361300         SQLCODE  NOT = +0                                        37310019
361400         MOVE '8100-AUDIT-SHPTPO'                                 37320019
361500                                   TO DP013-PARAGRAPH             37330019
361600         MOVE 'MAX RETRIES EXCEEDED FOR INSERT TAUSHPO'           37340019
361700                                   TO DP013-MESSAGE-TEXT (1)      37350019
361800         MOVE SQLCA                TO DP013-SQLCA                 37360019
361900         SET DP013-DB2-ABEND       TO TRUE                        37370019
362000         PERFORM DP013-0000-PROCESS-ABEND                         37380019
362100     END-IF.                                                      37390019
362200                                                                  37400019
362300/                                                                 37410019
362400*----------------------------------------------------------------*37420019
362500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *37430019
362600*----------------------------------------------------------------*37440019
362700                                                                  37450019
362800 9100-READ-SEL-QUEUE.                                             37460019
362900     EXEC CICS                                                    37470019
363000         READQ TS                                                 37480019
363100             QUEUE (ASC-SEL-QUEUE-NAME)                           37490019
363200             INTO  (TR015-TS-SEL-REC)                             37500019
363300             ITEM  (ASC-SEL-ITEM)                                 37510019
363400             RESP  (PV-CICS-RESP)                                 37520019
363500     END-EXEC.                                                    37530019
363600                                                                  37540019
363700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37550019
363800         CONTINUE                                                 37560019
363900     ELSE                                                         37570019
364000         SET DP013-LOGIC-ABEND                                    37580019
364100             DP013-NO-ROLLBACK     TO TRUE                        37590019
364200         MOVE '9100-READ-SEL-QUEUE'                               37600019
364300                                   TO DP013-PARAGRAPH             37610019
364400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   37620019
364500                                   TO DP013-MESSAGE-TEXT (1)      37630019
364600         PERFORM DP013-0000-PROCESS-ABEND                         37640019
364700     END-IF.                                                      37650019
364800                                                                  37660019
364900/                                                                 37670019
365000*----------------------------------------------------------------*37680019
365100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *37690019
365200*----------------------------------------------------------------*37700019
365300 9200-REWRITE-SEL-QUEUE.                                          37710019
365400     EXEC CICS                                                    37720019
365500          WRITEQ TS                                               37730019
365600              QUEUE  (ASC-SEL-QUEUE-NAME)                         37740019
365700              FROM   (TR015-TS-SEL-REC)                           37750019
365800              ITEM   (ASC-SEL-ITEM)                               37760019
365900              RESP   (PV-CICS-RESP)                               37770019
366000              REWRITE                                             37780019
366100     END-EXEC.                                                    37790019
366200                                                                  37800019
366300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   37810019
366400         SET DP013-CICS-ABEND                                     37820019
366500             DP013-NO-ROLLBACK     TO TRUE                        37830019
366600         MOVE '9200-REWRITE-SEL-QUEUE'                            37840019
366700                                   TO DP013-PARAGRAPH             37850019
366800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   37860019
366900                                   TO DP013-MESSAGE-TEXT (1)      37870019
367000         PERFORM DP013-0000-PROCESS-ABEND                         37880019
367100     END-IF.                                                      37890019
367200                                                                  37900019
367300/                                                                 37910019
367400*----------------------------------------------------------------*37920019
367500*    ABEND PROCESSOR MODULE                                      *37930019
367600*----------------------------------------------------------------*37940019
367700                                                                  37950019
367800     COPY DPPD013.                                                37960019
