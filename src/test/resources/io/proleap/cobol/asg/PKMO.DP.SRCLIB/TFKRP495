      ******************************************************************00010013
       IDENTIFICATION DIVISION.                                         00020013
      ******************************************************************00030013
                                                                        00040013
       PROGRAM-ID.             TFKRP495.                                00050013
       AUTHOR.                 JACK KRAMER.                             00060013
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070013
       DATE-WRITTEN            JUNE 1997.                               00080013
       DATE-COMPILED.                                                   00090013
                                                                        00100013
      ******************************************************************00110013
      *    THIS PROGRAM PRODUCES A REPORT OF OFFSITE STORAGE TRANSFERS  00120013
      *  SORTED BY STORE, DEPARTMENT, CLASS, SKU & TRANSFER NUMBER.     00130013
      ******************************************************************00140013
      ******************************************************************00150013
      *  2/28/2003 - CHRIS ALBRIGHT                                     00151013
      *   PROCESS NONINTELLIGENT SKU.                                   00152013
      ******************************************************************00153013
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00154020
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00155020
      ***************************************************************** 00156020
      ******************************************************************00160013
       ENVIRONMENT DIVISION.                                            00170013
      ******************************************************************00180013
                                                                        00190013
       CONFIGURATION SECTION.                                           00200013
                                                                        00210013
       SOURCE-COMPUTER.        IBM-3090.                                00220013
       OBJECT-COMPUTER.        IBM-3090.                                00230013
                                                                        00240013
       INPUT-OUTPUT SECTION.                                            00250013
                                                                        00260013
       FILE-CONTROL.                                                    00270013
                                                                        00280013
           SELECT OFFSITE-STORAGE-FILE                                  00290013
               ASSIGN TO INP01                                          00300013
               FILE STATUS  IS PV-FILE-STATUS.                          00310013
                                                                        00320013
           SELECT TRANSFER-REPORT-FILE                                  00330013
               ASSIGN TO RPT01.                                         00340013
      *                                                                 00350013
      ******************************************************************00360013
       DATA DIVISION.                                                   00370013
      ******************************************************************00380013
                                                                        00390013
       FILE SECTION.                                                    00400013
                                                                        00410013
       FD  OFFSITE-STORAGE-FILE                                         00420013
           RECORDING MODE IS F                                          00430013
           LABEL RECORDS ARE STANDARD                                   00440013
           BLOCK CONTAINS 0 RECORDS.                                    00450013
                                                                        00460013
       01  OFFSITE-STORAGE-FILE-RECORD         PIC  X(60).              00470013
                                                                        00480013
       FD  TRANSFER-REPORT-FILE                                         00490013
           LABEL RECORDS ARE STANDARD                                   00500013
           RECORDING MODE IS F                                          00510013
           BLOCK CONTAINS 0 RECORDS                                     00520013
           RECORD CONTAINS 132 CHARACTERS                               00530013
           DATA RECORD IS TRANSFER-REPORT-RECORD.                       00540013
                                                                        00550013
       01  TRANSFER-REPORT-RECORD PIC X(132).                           00560013
      *                                                                 00570013
       WORKING-STORAGE SECTION.                                         00580013
                                                                        00590013
      *                                                                 00600013
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00610013
           COPY DPWS132O.                                               00620013
      *----------------------------------------------------------------*00630013
      *  RECORD LAYOUT FOR THE OFFSITE STORAGE FILE                     00640013
      *----------------------------------------------------------------*00650013
           COPY TFRD040.                                                00660013
           EJECT                                                        00670013
      *                                                                 00680013
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          00690013
                                       COMP SYNC.                       00700013
                                                                        00710013
       01  PS-PROGRAM-SWITCHES.                                         00720013
           05  PS-ITEMS-READ-SW        PIC X(01)    VALUE 'N'.          00730013
               88  PS-ITEMS-READ                    VALUE 'Y'.          00740013
               88  PS-NO-ITEMS-READ                 VALUE 'N'.          00750013
           05  PS-FIRST-STORE-SW       PIC X(01)    VALUE 'Y'.          00760013
               88  PS-FIRST-STORE                   VALUE 'Y'.          00770013
               88  PS-NOT-FIRST-STORE               VALUE 'N'.          00780013
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          00790013
               88  PS-FIRST-TIME                    VALUE 'Y'.          00800013
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          00810013
           05  PS-END-OF-OFFSITE-SW    PIC  X(01)   VALUE 'N'.          00820013
               88  PS-END-OF-OFFSITE-FILE           VALUE 'Y'.          00830013
               88  PS-NOT-END-OF-OFFSITE-FILE       VALUE 'N'.          00840013
                                                                        00850013
       01  PC-PROGRAM-CONSTANTS.                                        00860013
           05  PC-PROGRAM-NAME           PIC  X(08)  VALUE  'TFKRP495'. 00870013
           05  PC-GRAND-TOTAL            PIC  X(16)  VALUE              00880013
                                         '     GRAND TOTAL'.            00890013
           05  PC-STORE-TOTAL            PIC  X(16)  VALUE              00900013
                                         '     STORE TOTAL'.            00910013
           05  PC-PAGE-MAX               PIC  S9(03) VALUE  +60.        00920013
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00930013
                                                           COMP-3.      00940013
      ******  CONSTANTS TO CHECK MAJOR CLASS AND SUBCLASS LENGTH  ******00940114
022803     05  PC-099                    PIC  9(03)  VALUE 099.         00941014
022803     05  PC-100                    PIC  9(03)  VALUE 100.         00942014
                                                                        00950013
       01  PV-PROGRAM-VARIABLES.                                        00960013
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          00970013
                                       COMP SYNC.                       00980013
           05  PV-PAGE-COUNT           PIC 9(5)    VALUE ZERO.          00990013
           05  PV-ITEMS-READ           PIC 9(8)    VALUE ZERO.          01000013
           05  PV-FILE-STATUS          PIC  X(02)   VALUE SPACES.       01010013
               88  PV-FILE-SUCCESSFUL               VALUE '00'.         01020013
               88  PV-FILE-NOT-FOUND                VALUE '23'.         01030013
           05  PV-LINE-COUNT           PIC S9(4)   VALUE ZERO.          01040013
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 01050013
           05  PV-DB2-OPERATION                PIC X(30)   VALUE SPACE. 01060013
           05  PV-EXT-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01110013
           05  PV-DPT-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01120013
           05  PV-DPT-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01130013
           05  PV-DPT-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01140013
           05  PV-CMP-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01150013
           05  PV-CMP-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01160013
           05  PV-CMP-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01170013
           05  PV-STR-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01180013
           05  PV-STR-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01190013
           05  PV-STR-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01200013
       01  HV-HOLD-VARIABLES.                                           01210013
           05  HV-STORE-NBR            PIC 9(04)    VALUE ZERO.         01220013
022803     05  HV-DEPT                 PIC 9(03)    VALUE ZEROS.        01231014
                                                                        01240013
       01  BLANK-LINE                  PIC X(132)   VALUE SPACES.       01250013
                                                                        01260013
       01  END-OF-REPORT-LINE.                                          01270013
           05  FILLER                  PIC X(52)    VALUE SPACES.       01280013
           05  FILLER                  PIC X(26)    VALUE               01290013
               '   *** END OF REPORT ***'.                              01300013
           05  FILLER                  PIC X(54)    VALUE SPACES.       01310013
                                                                        01320013
       01  NO-DATA-LINE.                                                01330013
           05  FILLER                  PIC X(35)    VALUE SPACES.       01340013
           05  FILLER                  PIC X(45)    VALUE               01350013
               '****  NO DATA TO PROCESS FOR THIS REPORT  ***'.         01360013
                                                                        01370013
       01  CD-CURRENT-DATE.                                             01380013
           05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         01390013
           05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         01400013
           05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         01410013
                                                                        01420013
       01  CT-CURRENT-TIME.                                             01430013
           05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         01440013
           05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         01450013
           05  FILLER                  PIC 9(4)     VALUE ZERO.         01460013
                                                                        01470013
       01  HL2-HEADING-LINE-2.                                          01480013
           05  FILLER                  PIC X(48)    VALUE SPACES.       01490013
           05  FILLER                  PIC X(60)    VALUE               01500013
           'OFF-SITE STORAGE BY STORE/DEPT REPORT'.                     01510013
                                                                        01520013
       01  HL3-HEADING-LINE-3.                                          01530013
           05  FILLER                  PIC X(07)  VALUE 'STORE  '.      01540013
           05  HL3-STORE-NBR           PIC 9(04).                       01550022
           05  FILLER                  PIC X(01)  VALUE SPACE.          01560013
           05  HL3-STORE-NAME          PIC X(25)  VALUE SPACE.          01570013
                                                                        01580013
       01  HL4-HEADING-LINE-4.                                          01590013
022803     05  FILLER                  PIC X(12)  VALUE 'D/M/S'.        01611014
           05  FILLER                  PIC X(16)  VALUE 'SCN UPC'.      01620013
           05  FILLER                  PIC X(21)  VALUE 'SKU DESC'.     01630013
           05  FILLER                  PIC X(16)  VALUE 'STYLE'.        01640013
           05  FILLER                  PIC X(11)  VALUE 'COLOR'.        01650013
           05  FILLER                  PIC X(14)  VALUE 'SIZE'.         01660013
           05  FILLER                  PIC X(13)  VALUE 'QTY'.          01670013
100404     05  FILLER                  PIC X(10)  VALUE 'RTL'.          01680023
           05  FILLER                  PIC X(08)  VALUE 'EXT RTL'.      01690013
           05  FILLER                  PIC X(04)  VALUE 'DOC'.          01700013
           05  FILLER                  PIC X(07)  VALUE 'NUMBER'.       01710013
                                                                        01720013
       01  HL5-HEADING-LINE-5.                                          01730013
022803     05  FILLER                  PIC X(12)  VALUE '-----------'.  01751014
           05  FILLER                  PIC X(16)  VALUE                 01760013
                                       '---------------'.               01761013
           05  FILLER                  PIC X(21)  VALUE                 01770013
                                       '--------------------'.          01780013
           05  FILLER                  PIC X(16)  VALUE                 01790013
                                       '---------------'.               01800013
           05  FILLER                  PIC X(11)  VALUE '----------'.   01810013
           05  FILLER                  PIC X(11)  VALUE '----------'.   01820013
           05  FILLER                  PIC X(07)  VALUE '------'.       01830013
           05  FILLER                  PIC X(13)  VALUE                 01840013
                                       '------------'.                  01850013
100404     05  FILLER                  PIC X(14)  VALUE                 01860023
                                       '-------------'.                 01870023
           05  FILLER                  PIC X(11)  VALUE '----------'.   01880013
                                                                        01890013
       01  UL1-UNDERLINE-1.                                             01900013
           05  FILLER                  PIC X(87)  VALUE SPACE.          01910013
           05  FILLER                  PIC X(07)  VALUE '------'.       01920013
           05  FILLER                  PIC X(13)  VALUE                 01930013
                                       '------------'.                  01940013
100404     05  FILLER                  PIC X(13)  VALUE                 01950024
                                       '-------------'.                 01960024
                                                                        01970013
       01  UL2-UNDERLINE-2.                                             01980013
           05  FILLER                  PIC X(87)  VALUE SPACE.          01990013
           05  FILLER                  PIC X(07)  VALUE '======'.       02000013
           05  FILLER                  PIC X(13)  VALUE                 02010013
                                       '============'.                  02020013
           05  FILLER                  PIC X(14)  VALUE                 02030013
                                       '=============='.                02040013
                                                                        02050013
       01  DL1-DETAIL-LINE-1.                                           02060013
022803     05  DL1-DPT-CL-SUBCL.                                        02127014
               10  DL1-DEPT                   PIC 999.                  02128013
               10  FILLER                     PIC X(01)   VALUE SPACE.  02129013
               10  DL1-GROUP-1.                                         02129113
                   15 DL1-CLASS-1             PIC 99      VALUE ZEROS.  02129213
                   15 FILLER                  PIC X(01)   VALUE SPACE.  02129313
                   15 DL1-SUBCLASS-1          PIC 99      VALUE ZEROS.  02129413
                   15 FILLER                  PIC X(02)   VALUE SPACE.  02129513
               10  DL1-GROUP-2 REDEFINES DL1-GROUP-1.                   02129613
                   15 DL1-CLASS-2             PIC  99.                  02129713
                   15 DL1-FILLER-2A           PIC  X(01).               02129813
                   15 DL1-SUBCLASS-2          PIC  999.                 02129913
                   15 DL1-FILLER-2B           PIC  X(01).               02130013
               10  DL1-GROUP-3 REDEFINES DL1-GROUP-1.                   02130113
                   15 DL1-CLASS-3             PIC  999.                 02130213
                   15 DL1-FILLER-3A           PIC  X(01).               02130313
                   15 DL1-SUBCLASS-3          PIC  99.                  02130413
                   15 DL1-FILLER-3B           PIC  X(01).               02130513
               10  DL1-GROUP-4 REDEFINES DL1-GROUP-1.                   02130613
                   15 DL1-CLASS-4             PIC  999.                 02130713
                   15 DL1-FILLER-4A           PIC  X(01).               02130813
                   15 DL1-SUBCLASS-4          PIC  999.                 02130913
           05  FILLER                  PIC X(01)  VALUE SPACES.         02132013
022803     05  DL1-UPC                 PIC Z(15).                       02140015
           05  FILLER                  PIC X(01)  VALUE SPACES.         02150013
           05  DL1-DESC                PIC X(20).                       02160013
           05  FILLER                  PIC X(01)  VALUE SPACES.         02170013
           05  DL1-STYLE               PIC X(15).                       02180013
           05  FILLER                  PIC X(01)  VALUE SPACE.          02190013
           05  DL1-TOTALS-LITERAL.                                      02200013
               10  DL1-COLOR           PIC X(10).                       02210013
               10  FILLER              PIC X(01)  VALUE SPACE.          02220013
               10  DL1-SIZE            PIC X(10).                       02230013
           05  FILLER                  PIC X(01)  VALUE SPACE.          02240013
           05  DL1-QTY                 PIC Z(06).                       02250013
           05  DL1-RTL                 PIC ZZ,ZZZ,ZZZ.99                02270013
                                           BLANK WHEN ZERO.             02280013
           05  FILLER                  PIC X(01)  VALUE SPACE.          02290013
           05  DL1-EXT-RTL             PIC ZZ,ZZZ,ZZZ.99                02300023
                                           BLANK WHEN ZERO.             02310013
           05  FILLER                  PIC X(01)  VALUE SPACES.         02320013
           05  DL1-TRANSFER-NBR.                                        02330013
100404*        10  DL1-FR-STR-NBR      PIC 9(03).                       02340021
100404         10  DL1-FR-STR-NBR      PIC 9(04).                       02341021
               10  DL1-DASH1           PIC X(01)  VALUE SPACES.         02350013
               10  DL1-XFER-SEQ-NBR    PIC 9(06).                       02360013
      *---------------------------------------------------------------* 02371021
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 02372021
      *---------------------------------------------------------------* 02373021
           EXEC SQL                                                     02374021
100404          INCLUDE XST00001                                        02375021
           END-EXEC.                                                    02376021
      *---------------------------------------------------------------* 02377021
100404*    DB2 AREA FOR XST_SKU TABLE                                 * 02378021
      *---------------------------------------------------------------* 02379021
           EXEC SQL                                                     02380021
100404          INCLUDE XST00010                                        02390021
           END-EXEC.                                                    02400021
      *---------------------------------------------------------------* 02410021
100404*    DB2 AREA FOR XST_UPC TABLE                                 * 02420021
      *---------------------------------------------------------------* 02430021
           EXEC SQL                                                     02440021
100404          INCLUDE XST00012                                        02441021
           END-EXEC.                                                    02442021
      *---------------------------------------------------------------* 02443021
100404*    DB2 AREA FOR XST_VND_STYL TABLE                            * 02444021
      *---------------------------------------------------------------* 02445021
           EXEC SQL                                                     02446021
100404          INCLUDE XST00013                                        02447021
           END-EXEC.                                                    02448021
                                                                        02510013
           EXEC SQL                                                     02520013
               INCLUDE SQLCA                                            02530013
           END-EXEC.                                                    02540013
      *                                                                 02550013
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           02560013
      *  SQL CODES FOR DISPLAY                                          02570013
      *                                                                 02580013
           COPY SQLCA2.                                                 02590013
                                                                        02600013
      ******************************************************************02610013
       PROCEDURE DIVISION.                                              02620013
      ******************************************************************02630013
       0000-MAINLINE.                                                   02640013
           PERFORM 1000-INITIALIZE.                                     02650013
           PERFORM 2000-PROCESS-OFFSITE-FILE.                           02660013
                                                                        02670013
           IF PS-NO-ITEMS-READ                                          02680013
               PERFORM 8000-PRINT-HEADINGS                              02690013
               WRITE TRANSFER-REPORT-RECORD                             02700013
                   FROM NO-DATA-LINE                                    02710013
                   AFTER ADVANCING 2                                    02720013
           ELSE                                                         02730013
               PERFORM 8200-GRAND-TOTALS                                02740013
           END-IF.                                                      02750013
                                                                        02760013
           WRITE TRANSFER-REPORT-RECORD                                 02770013
               FROM END-OF-REPORT-LINE                                  02780013
               AFTER ADVANCING 2.                                       02790013
           CLOSE TRANSFER-REPORT-FILE                                   02800013
                 OFFSITE-STORAGE-FILE.                                  02810013
           STOP RUN.                                                    02820013
                                                                        02830013
      ******************************************************************02840013
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES,            02850013
      *  FILLING THE FIELDS OF THE STANDARD REPORT HEADER,              02860013
      *  READING FIRST RECORD, PRINT HEADINGS.                          02870013
      ******************************************************************02880013
                                                                        02890013
       1000-INITIALIZE.                                                 02900013
           OPEN OUTPUT TRANSFER-REPORT-FILE                             02910013
                INPUT  OFFSITE-STORAGE-FILE.                            02920013
           ACCEPT CD-CURRENT-DATE FROM DATE.                            02930013
           MOVE CD-CURRENT-YEAR TO DP132O-RUN-YEAR.                     02940013
           MOVE CD-CURRENT-MONTH TO DP132O-RUN-MONTH.                   02950013
           MOVE CD-CURRENT-DAY TO DP132O-RUN-DAY.                       02960013
           MOVE +90 TO PV-LINE-COUNT.                                   02970013
                                                                        02980013
           ACCEPT CT-CURRENT-TIME FROM TIME.                            02990013
           MOVE CT-CURRENT-HOUR TO DP132O-RUN-HOUR.                     03000013
           MOVE CT-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 03010013
           MOVE PC-PROGRAM-NAME              TO DP132O-PROGRAM-NAME.    03020013
           MOVE 1 TO DP132O-REPORT-NUMBER.                              03030013
                                                                        03040013
      ******************************************************************03050013
      * CONTROL THE PROCESSING OF THE RECEIVED TRANSFERS FILE           03060013
      ******************************************************************03070013
       2000-PROCESS-OFFSITE-FILE.                                       03080013
           PERFORM                                                      03090013
               UNTIL (PS-END-OF-OFFSITE-FILE)                           03100013
                                                                        03110013
               PERFORM 2100-READ-OFFSITE-FILE                           03120013
                                                                        03130013
               IF  PS-NOT-END-OF-OFFSITE-FILE                           03140013
                   ADD +1                    TO PV-ITEMS-READ           03150013
                   PERFORM 3000-PROCESS-DATA                            03160013
               END-IF                                                   03170013
           END-PERFORM.                                                 03180013
           IF PV-ITEMS-READ > 0                                         03190013
               SET PS-ITEMS-READ             TO TRUE                    03200013
               PERFORM 5100-STORE-TOTALS                                03210013
           END-IF.                                                      03220013
       EJECT                                                            03230013
      *----------------------------------------------------------------*03240013
      *  READ THE OFFSITE STORAGE TRANSFER FILE.                       *03250013
      *----------------------------------------------------------------*03260013
       2100-READ-OFFSITE-FILE.                                          03270013
           READ OFFSITE-STORAGE-FILE                                    03280013
             INTO TF040-OFFSITE-STORAGE-RECORD                          03290013
               AT END                                                   03300013
                 SET PS-END-OF-OFFSITE-FILE          TO TRUE            03310013
           END-READ.                                                    03320013
      ******************************************************************03330013
      * PROCESS THE REPORT DATA                                         03340013
      ******************************************************************03350013
       3000-PROCESS-DATA.                                               03360013
           IF TF040-FR-STR-NBR         NOT = HV-STORE-NBR               03370013
               PERFORM 5000-NEW-STORE                                   03380013
           END-IF.                                                      03390013
022803     IF TF040-DEPT              NOT = HV-DEPT                     03401014
               PERFORM 4000-DEPT-TOTALS                                 03410013
           END-IF.                                                      03420013
           MOVE SPACES                TO DL1-DETAIL-LINE-1.             03430013
           IF PV-LINE-COUNT > PC-PAGE-MAX                               03440013
               PERFORM 8000-PRINT-HEADINGS                              03450013
           END-IF.                                                      03460013
           MOVE TF040-FR-STR-NBR      TO DL1-FR-STR-NBR.                03481015
           MOVE TF040-XFER-SEQ-NBR    TO DL1-XFER-SEQ-NBR.              03490013
           MOVE TF040-DEPT            TO DL1-DEPT.                      03551021
           MOVE TF040-SCN-UPC-NBR     TO DL1-UPC.                       03557116
022803     IF TF040-CLASS < PC-100                                      03561818
              EVALUATE TRUE                                             03561918
              WHEN TF040-SUBCLASS < PC-100                              03562018
                MOVE TF040-CLASS TO DL1-CLASS-1                         03563018
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-1                   03564018
              WHEN TF040-SUBCLASS > PC-099                              03565018
                MOVE TF040-CLASS TO DL1-CLASS-2                         03566018
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-2                   03567018
                MOVE SPACES TO DL1-FILLER-2A                            03568018
                               DL1-FILLER-2B                            03569018
              END-EVALUATE                                              03569118
           ELSE IF                                                      03569218
              TF040-CLASS > PC-099                                      03569318
              EVALUATE TRUE                                             03569418
              WHEN TF040-SUBCLASS < PC-100                              03569518
                MOVE TF040-CLASS TO DL1-CLASS-3                         03569618
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-3                   03569718
                MOVE SPACES TO DL1-FILLER-3A                            03569818
                               DL1-FILLER-3B                            03569918
              WHEN TF040-SUBCLASS > PC-099                              03570018
                MOVE TF040-CLASS TO DL1-CLASS-4                         03570118
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-4                   03570218
                MOVE SPACES TO DL1-FILLER-4A                            03570318
              END-EVALUATE                                              03570418
           END-IF                                                       03570518
           END-IF                                                       03570618
           MOVE TF040-XFER-PRIC-AMT   TO DL1-RTL.                       03571013
           MOVE TF040-XFER-QTY        TO DL1-QTY.                       03580013
           MOVE '-'                   TO DL1-DASH1.                     03590013
           COMPUTE PV-EXT-RTL = TF040-XFER-PRIC-AMT * TF040-XFER-QTY.   03620013
           MOVE PV-EXT-RTL            TO DL1-EXT-RTL.                   03630013
100404     PERFORM 6000-READ-XST-UPC.                                   03631021
100404     MOVE XST00010-SKU-DESC      TO DL1-DESC.                     03632021
100404     MOVE XST00013-VS-NBR        TO DL1-STYLE.                    03633021
100404     MOVE XST00010-SIZE-DESC     TO DL1-SIZE.                     03634021
100404     MOVE XST00010-NRF-CLOR-DESC TO DL1-COLOR.                    03635021
           WRITE TRANSFER-REPORT-RECORD                                 03690013
               FROM DL1-DETAIL-LINE-1                                   03700013
               AFTER ADVANCING 1.                                       03710013
           ADD 1                      TO PV-LINE-COUNT.                 03720013
           ADD TF040-XFER-QTY         TO PV-DPT-QTY.                    03730013
           ADD TF040-XFER-PRIC-AMT    TO PV-DPT-RTL.                    03740013
           ADD PV-EXT-RTL             TO PV-DPT-EXT-RTL.                03750013
      ******************************************************************03760013
      *   DEPARTMENT TOTALS                                             03770013
      ******************************************************************03780013
       4000-DEPT-TOTALS.                                                03790013
           WRITE TRANSFER-REPORT-RECORD                                 03800013
               FROM UL1-UNDERLINE-1                                     03810013
               AFTER ADVANCING 1.                                       03820013
           MOVE SPACES                TO DL1-DETAIL-LINE-1              03830013
           MOVE PV-DPT-QTY            TO DL1-QTY                        03840013
           MOVE PV-DPT-RTL            TO DL1-RTL                        03850013
           MOVE PV-DPT-EXT-RTL        TO DL1-EXT-RTL.                   03860013
           WRITE TRANSFER-REPORT-RECORD                                 03870013
               FROM DL1-DETAIL-LINE-1                                   03880013
               AFTER ADVANCING 1.                                       03890013
           WRITE TRANSFER-REPORT-RECORD                                 03900013
               FROM BLANK-LINE                                          03910013
               AFTER ADVANCING 1.                                       03920013
           ADD  +3                    TO PV-LINE-COUNT.                 03930013
           ADD PV-DPT-QTY             TO PV-STR-QTY.                    03940013
           ADD PV-DPT-RTL             TO PV-STR-RTL.                    03950013
           ADD PV-DPT-EXT-RTL         TO PV-STR-EXT-RTL.                03960013
           MOVE ZEROES                TO PV-DPT-QTY                     03970013
                                         PV-DPT-RTL                     03980013
                                         PV-DPT-EXT-RTL.                03990013
022803     MOVE TF040-DEPT               TO HV-DEPT.                    04001014
      ******************************************************************04010013
      *   STORE NUMBER BREAK.                                           04020013
      ******************************************************************04030013
       5000-NEW-STORE.                                                  04040013
           IF PS-NOT-FIRST-STORE                                        04050013
               PERFORM 5100-STORE-TOTALS                                04060013
           ELSE                                                         04070013
               SET PS-NOT-FIRST-STORE    TO TRUE                        04080013
022803         MOVE TF040-DEPT           TO HV-DEPT                     04091014
           END-IF.                                                      04100013
           MOVE TF040-FR-STR-NBR         TO HV-STORE-NBR                04110013
                                            HL3-STORE-NBR               04120013
100404                                      XST00001-LOC-NBR.           04130021
           PERFORM 5200-READ-STORE.                                     04140013
100404     MOVE XST00001-LOC-NM       TO HL3-STORE-NAME.                04150021
      ******************************************************************04160013
      *    STORE TOTALS                                                 04170013
      ******************************************************************04180013
       5100-STORE-TOTALS.                                               04190013
           PERFORM 4000-DEPT-TOTALS.                                    04200013
           WRITE TRANSFER-REPORT-RECORD                                 04210013
               FROM UL1-UNDERLINE-1                                     04220013
               AFTER ADVANCING 1.                                       04230013
           MOVE SPACES                TO DL1-DETAIL-LINE-1              04240013
           MOVE PC-STORE-TOTAL        TO DL1-TOTALS-LITERAL.            04250013
           MOVE PV-STR-QTY            TO DL1-QTY                        04260013
           MOVE PV-STR-RTL            TO DL1-RTL                        04270013
           MOVE PV-STR-EXT-RTL        TO DL1-EXT-RTL.                   04280013
           WRITE TRANSFER-REPORT-RECORD                                 04290013
               FROM DL1-DETAIL-LINE-1                                   04300013
               AFTER ADVANCING 1.                                       04310013
           MOVE +90                   TO PV-LINE-COUNT.                 04320013
           ADD PV-STR-QTY             TO PV-CMP-QTY.                    04330013
           ADD PV-STR-RTL             TO PV-CMP-RTL.                    04340013
           ADD PV-STR-EXT-RTL         TO PV-CMP-EXT-RTL.                04350013
           MOVE ZEROES                TO PV-STR-QTY                     04360013
                                         PV-STR-RTL                     04370013
                                         PV-STR-EXT-RTL.                04380013
      *----------------------------------------------------------------*04390013
      *    GET THE STORE NAME.                                          04400013
      *----------------------------------------------------------------*04410013
       5200-READ-STORE.                                                 04420013
           PERFORM WITH TEST AFTER                                      04430013
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       04440013
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  04450013
                    OR SQLCODE = ZERO                                   04460013
                    OR SQLCODE = +100                                   04470013
               EXEC SQL                                                 04480013
100404             SELECT LOC_NM                                        04481021
100404                 INTO :XST00001-LOC-NM                            04482021
100404                 FROM XST_LOC                                     04483021
100404                 WHERE LOC_NBR = :XST00001-LOC-NBR                04484021
               END-EXEC                                                 04530013
               EVALUATE TRUE                                            04540013
                   WHEN SQLCODE = ZERO                                  04550013
                   WHEN SQLCODE = -904                                  04560013
                   WHEN SQLCODE = -913                                  04570013
                       CONTINUE                                         04580013
                   WHEN SQLCODE = +100                                  04590013
100404                 MOVE 'INVALID STORE'       TO XST00001-LOC-NM    04600021
                   WHEN OTHER                                           04610021
                       MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME  04640013
                       MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION  04650013
                       PERFORM 9100-SQL-ERROR                           04660013
               END-EVALUATE                                             04670013
           END-PERFORM.                                                 04680013
                                                                        04690013
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           04700013
               MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME          04710013
               MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION          04720013
               PERFORM 9100-SQL-ERROR                                   04730013
           END-IF.                                                      04740013
      ******************************************************************04750013
      * READ THE SKU TABLE FOR DESCRIPTION, STYLE, COLOR & SIZE.        04760013
      ******************************************************************04770013
100404 6000-READ-XST-UPC.                                               04780021
100404     INITIALIZE DCLXST00010                                       04781021
100404                DCLXST00013.                                      04782021
           PERFORM WITH TEST AFTER                                      04790013
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       04800013
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  04810013
                    OR SQLCODE = ZERO                                   04820013
                    OR SQLCODE = +100                                   04830013
               EXEC SQL                                                 04840013
100404             SELECT  B.SKU_DESC                                   04841021
100404                    ,B.SIZE_DESC                                  04842021
100404                    ,B.NRF_CLOR_DESC                              04843021
100404                    ,C.VS_NBR                                     04844021
100404               INTO  :XST00010-SKU-DESC                           04845021
100404                    ,:XST00010-SIZE-DESC                          04846021
100404                    ,:XST00010-NRF-CLOR-DESC                      04847021
100404                    ,:XST00013-VS-NBR                             04848021
100404               FROM  XST_UPC      A                               04849021
100404                    ,XST_SKU      B                               04849121
100404                    ,XST_VND_STYL C                               04849221
100404              WHERE A.UPC_NBR      =  :TF040-SCN-UPC-NBR          04849321
100404                AND A.LAST_ACTN_CDE IN ('A', 'U')                 04849421
100404                AND A.INTR_UPC_ID  =  B.INTR_UPC_ID               04849521
100404                AND B.STYL_ID      =  C.STYL_ID                   04849621
               END-EXEC                                                 04974013
                                                                        04980013
               EVALUATE TRUE                                            04990013
                   WHEN SQLCODE = ZERO                                  05000013
                   WHEN SQLCODE = -904                                  05010013
                   WHEN SQLCODE = -913                                  05020013
                     CONTINUE                                           05030013
                   WHEN SQLCODE = +100                                  05040013
100404               MOVE 'INVALID ITEM'       TO XST00010-SKU-DESC     05050021
                   WHEN OTHER                                           05060021
100404                 MOVE '6000-READ-XST-UPC'   TO PV-PARAGRAPH-NAME  05090021
                       MOVE 'READ THE UPC TABLE' TO PV-DB2-OPERATION    05100021
                       PERFORM 9100-SQL-ERROR                           05110013
               END-EVALUATE                                             05120013
           END-PERFORM.                                                 05130013
                                                                        05140013
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05150013
100404         MOVE '6000-READ-XST-UPC'   TO PV-PARAGRAPH-NAME          05160021
               MOVE 'READ THE UPC TABLE' TO PV-DB2-OPERATION            05170021
               PERFORM 9100-SQL-ERROR                                   05180013
           END-IF.                                                      05190013
      ******************************************************************05200013
      *  PRINT REPORT HEADINGS                                          05210013
      ******************************************************************05220013
                                                                        05230013
       8000-PRINT-HEADINGS.                                             05240013
           ADD 1 TO PV-PAGE-COUNT.                                      05250013
           MOVE 7             TO PV-LINE-COUNT.                         05260013
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    05270013
           SET PS-FIRST-TIME          TO TRUE.                          05280013
           WRITE TRANSFER-REPORT-RECORD                                 05290013
               FROM DP132O-STANDRD-HEADER-132-COLS                      05300013
               AFTER ADVANCING PAGE.                                    05310013
           WRITE TRANSFER-REPORT-RECORD                                 05320013
               FROM HL2-HEADING-LINE-2                                  05330013
               AFTER ADVANCING 1.                                       05340013
           WRITE TRANSFER-REPORT-RECORD                                 05350013
               FROM HL3-HEADING-LINE-3                                  05360013
               AFTER ADVANCING 1.                                       05370013
           WRITE TRANSFER-REPORT-RECORD                                 05380013
               FROM HL4-HEADING-LINE-4                                  05390013
               AFTER ADVANCING 2.                                       05400013
           WRITE TRANSFER-REPORT-RECORD                                 05410013
               FROM HL5-HEADING-LINE-5                                  05420013
               AFTER ADVANCING 1.                                       05430013
           WRITE TRANSFER-REPORT-RECORD                                 05440013
               FROM BLANK-LINE                                          05450013
               AFTER ADVANCING 1.                                       05460013
      ******************************************************************05470013
      *  GRAND TOTALS                                                   05480013
      ******************************************************************05490013
       8200-GRAND-TOTALS.                                               05500013
           WRITE TRANSFER-REPORT-RECORD                                 05510013
               FROM UL2-UNDERLINE-2                                     05520013
               AFTER ADVANCING 2.                                       05530013
           MOVE SPACES                TO DL1-DETAIL-LINE-1              05540013
           MOVE PC-GRAND-TOTAL        TO DL1-TOTALS-LITERAL.            05550013
           MOVE PV-CMP-QTY            TO DL1-QTY                        05560013
           MOVE PV-CMP-RTL            TO DL1-RTL                        05570013
           MOVE PV-CMP-EXT-RTL        TO DL1-EXT-RTL.                   05580013
           WRITE TRANSFER-REPORT-RECORD                                 05590013
               FROM DL1-DETAIL-LINE-1                                   05600013
               AFTER ADVANCING 1.                                       05610013
      ******************************************************************05620013
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *05630013
      *  PROGRAM.                                                      *05640013
      ******************************************************************05650013
       9100-SQL-ERROR.                                                  05660013
           MOVE SQLCODE TO SQLCODE2.                                    05670013
           MOVE SQLERRD(3) TO SQLERRD3.                                 05680013
           DISPLAY '** ABEND **'.                                       05690013
           DISPLAY 'TFKRP495 - SQL ERROR'.                              05700013
           DISPLAY '       SQLCODE = ' SQLCODE2.                        05710013
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        05720013
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        05730013
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        05740013
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        05750013
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        05760013
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        05770013
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        05780013
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        05790013
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        05800013
           DISPLAY                    '** PARAGRAPH ** = '              05810013
                                       PV-PARAGRAPH-NAME.               05820013
           DISPLAY                    '** OPERATION ** = '              05830013
                                       PV-DB2-OPERATION.                05840013
                                                                        05850013
           EXEC SQL                                                     05860013
               COMMIT                                                   05870013
           END-EXEC.                                                    05880013
                                                                        05890013
           MOVE +4013 TO ABEND-CODE.                                    05900013
           CALL 'ILBOABN0' USING ABEND-CODE.                            05910013
                                                                        05920013
