000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.             RVKUT022.                                00030000
000400 AUTHOR.                 AL PETERS.                               00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           NOVEMBER 2006.                           00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*                                                                 00090000
001000*  PROGRAM NARRATIVE:                                             00100000
001010*                                                                 00110000
001020*  TRANSFER FILES FOR GENCO                                       00120000
001030*  THIS PROGRAM WILL CREATE (3) FILES OF TRANSFER DATA TO GENCO.  00130000
001040*  EXTRACT DATA FOR: (1. HEADER (2. DETAIL (3. MARKER FILE.       00140000
W40134*  THE FOURTH FILE CREATED IS A DAILY GENCO TRANSFER REPORT FILE. 00150025
W40134*                                                                 00160025
W40134******************************************************************00170025
W40134*  CHANGE LOG.                                                    00180025
W40134*  DATE         CHANGED BY      DESC                              00190025
W40134*  -----------  --------------  ----------------------------------00200025
W40134*  10/30/2011   C. STRODTHOFF - GENCO / RTV UPGRADE. ADD MULTIPLE 00210031
W40134*                               RTV LOCS. REMOVE HARDCODED '811'. 00220031
W40134*                               CREATE NEW RPT FILE. REMOVE REPORT00230025
W40134*                               AND READ TCOCNTL FOR DATE.        00240031
W40134*                               PRJ ID 3219 - WR40134.            00250025
W40134******************************************************************00260025
W40134                                                                  00270025
001070 ENVIRONMENT DIVISION.                                            00280000
001080                                                                  00290000
001090 CONFIGURATION SECTION.                                           00300000
001100                                                                  00310000
001200 SOURCE-COMPUTER.                        IBM-3090.                00320000
001300 OBJECT-COMPUTER.                        IBM-3090.                00330000
001400                                                                  00340000
001500 INPUT-OUTPUT SECTION.                                            00350000
001600                                                                  00360000
001700 FILE-CONTROL.                                                    00370000
001800                                                                  00380000
001900     SELECT  TFRD-EXT-FILE                                        00390000
002000         ASSIGN TO INP01.                                         00400000
002100                                                                  00410000
002200     SELECT  TFRD-HDR-FILE                                        00420000
002300         ASSIGN TO OUT01.                                         00430000
002400                                                                  00440000
002500     SELECT  TFRD-DTL-FILE                                        00450000
002600         ASSIGN TO OUT02.                                         00460000
002700                                                                  00470000
002800     SELECT  TFRD-MARKER-FILE                                     00480000
002810         ASSIGN TO OUT03.                                         00490000
002820                                                                  00500000
002830     SELECT REPORT-FILE                                           00510000
W40134         ASSIGN TO OUT04.                                         00520025
002850******************************************************************00530000
002860 DATA DIVISION.                                                   00540000
002870******************************************************************00550000
002880                                                                  00560000
002890 FILE SECTION.                                                    00570000
002900*                                                                 00580000
003000 FD  TFRD-EXT-FILE                                                00590000
003100     RECORDING MODE IS F                                          00600000
003200     LABEL RECORDS ARE STANDARD                                   00610000
003300     BLOCK CONTAINS 0 RECORDS.                                    00620000
003400 01  TFRD-EXT-RECORD                  PIC  X(120).                00630000
003500*                                                                 00640000
003600*                                                                 00650000
003700 FD  TFRD-HDR-FILE                                                00660000
003800     RECORDING MODE IS F                                          00670000
003900     LABEL RECORDS ARE STANDARD                                   00680000
004000     BLOCK CONTAINS 0 RECORDS.                                    00690000
004100 01  TFRD-HDR-RECORD                  PIC  X(155).                00700000
004101*                                                                 00710000
004102*                                                                 00720000
004103 FD  TFRD-DTL-FILE                                                00730000
004104     RECORDING MODE IS F                                          00740000
004105     LABEL RECORDS ARE STANDARD                                   00750000
004106     BLOCK CONTAINS 0 RECORDS.                                    00760000
004107 01  TFRD-DTL-RECORD                  PIC  X(95).                 00770000
004108*                                                                 00780000
004109 FD  TFRD-MARKER-FILE                                             00790000
004110     RECORDING MODE IS F                                          00800000
004120     LABEL RECORDS ARE STANDARD                                   00810000
004130     BLOCK CONTAINS 0 RECORDS.                                    00820000
004140 01  TFRD-MARKER-RECORD               PIC  X(78).                 00830000
004150*                                                                 00840000
004160 FD  REPORT-FILE                                                  00850000
004161     RECORDING MODE F                                             00860000
004162     BLOCK CONTAINS 0 RECORDS                                     00870000
004163     LABEL RECORDS ARE OMITTED                                    00880000
004164     DATA RECORD IS REPORT-RECORD.                                00890000
W40134 01  REPORT-RECORD                    PIC X(75).                  00900025
004166*                                                                 00910000
004167 WORKING-STORAGE SECTION.                                         00920000
004913***************************************************************** 00930000
004914*    PROGRAM CONSTANTS                                            00940000
004915***************************************************************** 00950000
004916 01  PC-CONSTANTS.                                                00960000
004917     05  PC-CURRENT-PGM-RVKUT022      PIC  X(08) VALUE 'RVKUT022'.00970000
004918     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00980000
004919                                                 COMP SYNC.       00990000
005148******************************************************************01000000
005149**PROGRAM COUNTERS                                                01010000
005150******************************************************************01020000
005151 01  PC-PROGRAM-COUNTER.                                          01030000
005152     05  PC-REPORT-LINE-COUNTER          PIC 9(03) VALUE ZEROS.   01040000
005153     05  PC-PAGE-COUNTER                 PIC 9(03) VALUE ZEROS.   01050000
005154***************************************************************** 01060000
005155*    PROGRAM SWITCHES                                             01070000
005156***************************************************************** 01080000
005157 01  PS-SWITCHES.                                                 01090000
005158     05  PS-END-EXT-FILE-SWITCH       PIC  X(01) VALUE 'N'.       01100000
005159         88  PS-END-EXT-FILE                     VALUE 'Y'.       01110000
005160         88  PS-NOT-END-EXT-FILE                 VALUE 'N'.       01120000
005170     05  PS-WRITE-HEADER-SWITCH       PIC  X(01) VALUE 'N'.       01130000
005180         88  PS-WRITE-HEADER                     VALUE 'Y'.       01140000
005190         88  PS-DO-NOT-WRITE-HEADER              VALUE 'N'.       01150000
005200     05  PS-WRITE-DETAIL-SWITCH       PIC  X(01) VALUE 'N'.       01160000
005300         88  PS-WRITE-DETAIL                     VALUE 'Y'.       01170000
005400         88  PS-DO-NOT-WRITE-DETAIL              VALUE 'N'.       01180000
005500     05  PS-TTFMSTR-SWITCH            PIC  X(01) VALUE 'N'.       01190000
005600         88  PS-TTFMSTR-FOUND                    VALUE 'Y'.       01200000
005700         88  PS-TTFMSTR-NOTFND                   VALUE 'N'.       01210000
005710     05  PS-CNTR-DESC-SWITCH          PIC  X(01) VALUE 'N'.       01220000
005720         88  PS-CNTR-DESC-FOUND                  VALUE 'Y'.       01230000
005730         88  PS-CNTR-DESC-NOTFND                 VALUE 'N'.       01240000
005740     05  PS-VALID-HDR-SWITCH          PIC  X(01) VALUE 'N'.       01250000
005750         88  PS-VALID-HDR-FOUND                  VALUE 'Y'.       01260000
005760         88  PS-VALID-HDR-NOTFND                 VALUE 'N'.       01270000
005770     05  PS-VALID-DTL-SWITCH          PIC  X(01) VALUE 'N'.       01280000
005780         88  PS-VALID-DTL-FOUND                  VALUE 'Y'.       01290000
005790         88  PS-VALID-DTL-NOTFND                 VALUE 'N'.       01300000
005800                                                                  01310000
005900***************************************************************** 01320000
006000*    PROGRAM VARIABLES                                            01330000
006100***************************************************************** 01340000
006200 01  PV-VARIABLES.                                                01350000
006210     05  PV-KEY-FR-STR-NBR            PIC S9(04) VALUE +0         01360000
006220                                                 COMP SYNC.       01370000
006230     05  PV-KEY-SEQ-NBR               PIC S9(09) VALUE +0         01380000
006240                                                 COMP SYNC.       01390000
006250     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         01400000
006260                                                 COMP SYNC.       01410000
006270     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01420000
006280                                                 COMP SYNC.       01430000
006290     05  PV-REPORT-NUMBER             PIC  9(01) VALUE 1.         01440000
006300     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    01450000
006400     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    01460000
006500     05  PV-ABEND-TABLE-1             PIC  X(20) VALUE SPACES.    01470000
006600     05  PV-ABEND-TABLE-2             PIC  X(20) VALUE SPACES.    01480000
006700     05  PV-ABEND-TABLE-3             PIC  X(20) VALUE SPACES.    01490000
006800     05  PV-ABEND-TABLE-4             PIC  X(20) VALUE SPACES.    01500000
006900     05  PV-ABEND-TABLE-5             PIC  X(20) VALUE SPACES.    01510000
007000     05  PV-ERROR-MSG-1               PIC  X(60) VALUE SPACES.    01520000
007100     05  PV-ERROR-MSG-2               PIC  X(60) VALUE SPACES.    01530000
007200     05  PV-ERROR-MSG-3               PIC  X(60) VALUE SPACES.    01540000
007210     05  PV-ASTERISK-LINE             PIC  X(80) VALUE ALL '*'.   01550000
007220     05  PV-EXT-HDR-RECS-WRITTEN      PIC  9(09) VALUE ZERO.      01560000
007230     05  PV-EXT-DTL-RECS-WRITTEN      PIC  9(09) VALUE ZERO.      01570000
W40134     05  PV-EXT-RPT-RECS-WRITTEN      PIC  9(09) VALUE ZERO.      01580025
007240     05  PV-EXT-RECS-READ             PIC  9(09) VALUE ZERO.      01590000
007250     05  PV-EXT-HDR-MARKER-COUNT      PIC  9(09) VALUE ZERO.      01600000
007260     05  PV-EXT-DTL-MARKER-COUNT      PIC  9(09) VALUE ZERO.      01610000
007270                                                                  01620000
007280     05  PV-DOC-LOC-NBR-HOLD          PIC  S9(04) VALUE ZERO      01630000
007290                                                  COMP.           01640000
007300     05  PV-DOC-SEQ-NBR-HOLD          PIC  S9(09) VALUE ZERO      01650000
007400                                                  COMP.           01660000
007401     05  PV-XFER-DKEY-IDN             PIC 9(10).                  01670000
007402     05  PV-XFER-DKEY-IDX                                         01680000
007403         REDEFINES PV-XFER-DKEY-IDN   PIC X(10).                  01690000
007404                                                                  01700000
007405     05  PV-DOC-LOC-NBRN              PIC 9(04).                  01710000
007406     05  PV-DOC-LOC-NBRX REDEFINES PV-DOC-LOC-NBRN PIC X(04).     01720000
007407                                                                  01730000
007408     05  PV-DOC-SEQ-NBRN              PIC 9(09).                  01740000
007409     05  PV-DOC-SEQ-NBRX REDEFINES PV-DOC-SEQ-NBRN PIC X(09).     01750000
007410                                                                  01760000
007411     05  PV-SKU-NBRN                  PIC 9(10).                  01770000
007412     05  PV-SKU-NBRX REDEFINES PV-SKU-NBRN PIC X(10).             01780000
007413                                                                  01790000
007414     05  PV-FROM-STORE-NBRN           PIC  9(04).                 01800000
007415                                                                  01810000
007416     05  PV-TO-STORE-NBRN             PIC  9(04).                 01820000
007417                                                                  01830000
007418     05  PV-LOC-NBR                   PIC  S9(04) VALUE ZERO      01840000
007419                                                  COMP.           01850000
007420     05  PV-SEQ-NBR                   PIC  S9(09) VALUE ZERO      01860000
007421                                                  COMP.           01870000
007422     05  PV-CONT-NBR                  PIC  X(02)  VALUE SPACE.    01880000
007423     05  PV-CONTNR-TYP-CDE            PIC  X(02)  VALUE SPACE.    01890000
007424                                                                  01900000
007425     05  PV-RUN-DATE-CN               PIC  X(08)  VALUE SPACES.   01910000
007426     05  PV-RUN-TIME-CN               PIC  X(06)  VALUE SPACES.   01920000
007427                                                                  01930000
007428     05  PV-CURRENT-TMST-DB2          PIC X(26)   VALUE SPACE.    01940000
007429     05  PV-CURRENT-TMST.                                         01950000
007430         10  PV-CURR-DATE.                                        01960000
007431             15  PV-CURR-DATE-CC     PIC  9(02)    VALUE ZERO.    01970000
007432             15  PV-CURR-DATE-YY     PIC  9(02)    VALUE ZERO.    01980000
007433             15  PV-CURR-SLASH1      PIC  X        VALUE SPACE.   01990000
007434             15  PV-CURR-DATE-MM     PIC  9(02)    VALUE ZERO.    02000000
007435             15  PV-CURR-SLASH2      PIC  X        VALUE SPACE.   02010000
007436             15  PV-CURR-DATE-DD     PIC  9(02)    VALUE ZERO.    02020000
007437             15  PV-CURR-SLASH3      PIC  X        VALUE SPACE.   02030000
007438         10  PV-CURR-TIME.                                        02040000
007439             15  PV-CURR-TIME-HH     PIC  9(02)    VALUE ZERO.    02050000
007440             15  PV-CURR-TIME-P1     PIC  X        VALUE SPACE.   02060000
007441             15  PV-CURR-TIME-MM     PIC  9(02)    VALUE ZERO.    02070000
007442             15  PV-CURR-TIME-P2     PIC  X        VALUE SPACE.   02080000
007443             15  PV-CURR-TIME-SS     PIC  9(02)    VALUE ZERO.    02090000
007444             15  FILL                PIC  X(07)    VALUE SPACE.   02100000
007445                                                                  02110000
007446     05  PV-NULL-IND                 PIC  S9(4)    VALUE ZERO     02120000
007447                                                   COMP SYNC.     02130000
007448     05  PV-DB2-COUNT                PIC  S9(9)    VALUE ZERO     02140000
007449                                                   COMP-3.        02150000
007450                                                                  02160000
007451     05  PV-CURR-CCYY.                                            02170000
007452         10  PV-CURR-CC              PIC  X(02)    VALUE SPACE.   02180000
007453         10  PV-CURR-YY              PIC  X(02)    VALUE SPACE.   02190000
007454                                                                  02200000
007455     05  PV-DATE.                                                 02210000
007456         10  PV-DATE-CCYY            PIC  X(04)    VALUE SPACE.   02220000
007457         10  PV-DATE-MM              PIC  X(02)    VALUE SPACE.   02230000
007458         10  PV-DATE-DD              PIC  X(02)    VALUE SPACE.   02240000
007459                                                                  02250000
007460     05  PV-RPT-DATE.                                             02260000
007461         10  PV-RPT-CCYY             PIC  X(04)    VALUE SPACE.   02270000
007462         10  FILLER                  PIC  X(01)    VALUE '-'.     02280000
007463         10  PV-RPT-MM               PIC  X(02)    VALUE SPACE.   02290000
007464         10  FILLER                  PIC  X(01)    VALUE '-'.     02300000
007465         10  PV-RPT-DD               PIC  X(02)    VALUE SPACE.   02310000
007466                                                                  02320000
007467***** FILE NAME CONSISTS OF PV-CREATE-DATE_TRANMARK.MKR           02330000
007468*****     EXAMPLE: 20050317_TRANMARK.MKR                          02340000
007469     05  PV-FILE-NAME.                                            02350000
007470         10  PV-CREATE-DATE           PIC  X(08) VALUE SPACES.    02360000
007480         10  PV-UNDERSCORE            PIC  X(01) VALUE '_'.       02370000
007490         10  PV-TRANMARK-MKR          PIC  X(16) VALUE SPACES.    02380000
007500                                                                  02390000
007600***  MARKER FILE LAYOUT                                           02400000
007610     COPY RVRD029.                                                02410000
007620                                                                  02420000
007630***  TFRD HEADER FILE LAYOUT                                      02430000
007631     COPY RVRD038.                                                02440000
007632                                                                  02450000
007633***  TFRD DETAIL FILE LAYOUT                                      02460000
007634     COPY RVRD039.                                                02470000
007635                                                                  02480000
007636***  TFRD INPUT EXTRACT FILE LAYOUT                               02490000
007637     COPY TFRD054.                                                02500000
007638                                                                  02510000
W40134***  TFRD REPORT FILE LAYOUT                                      02520025
W40134     COPY RVRD061.                                                02530025
W40134                                                                  02540025
007649***  DATE ROUTINE COPYBOOK                                        02550000
007650***PARAMETER LIST FOR THE CALENDAR ROUTINE                        02560000
007651     COPY DPWS500.                                                02570000
007652                                                                  02580000
007653***  DB2 ABEND COPYBOOK                                           02590000
007654     COPY DPWS004.                                                02600000
007655                                                                  02610000
007656     EXEC SQL                                                     02620000
007657         INCLUDE SQLCA                                            02630000
007658     END-EXEC.                                                    02640000
007659                                                                  02650000
007660     COPY SQLCA2.                                                 02660000
007670                                                                  02670000
W40134*---------------------------------------------------------------* 02680029
W40134*    TCOCNTL TABLE                                              * 02690029
W40134*---------------------------------------------------------------* 02700029
W40134     EXEC SQL                                                     02710029
W40134         INCLUDE TCOCNTL                                          02720029
W40134     END-EXEC.                                                    02730029
W40134                                                                  02740029
007680*---------------------------------------------------------------* 02750000
007690*    DCLGEN FOR THE TRANSFER MASTER TABLE                       * 02760000
007700*---------------------------------------------------------------* 02770000
007800     EXEC SQL                                                     02780000
007900         INCLUDE TTFMSTR                                          02790000
008000     END-EXEC.                                                    02800000
008100                                                                  02810000
W40134*---------------------------------------------------------------* 02820025
W40134*    DCLGEN FOR THE LOGISTICS LOCATION TABLE                    * 02830025
W40134*---------------------------------------------------------------* 02840025
W40134     EXEC SQL                                                     02850025
W40134         INCLUDE XLT00010                                         02860025
W40134     END-EXEC.                                                    02870025
W40134                                                                  02880025
008200*---------------------------------------------------------------* 02890000
008300*    DCLGEN FOR THE TRANSFER SHIPPING CONTAINER CODE TABLE      * 02900000
008400*---------------------------------------------------------------* 02910000
008500     EXEC SQL                                                     02920000
008600         INCLUDE TTFSHCT                                          02930000
008700     END-EXEC.                                                    02940000
008800                                                                  02950000
008900 LINKAGE SECTION.                                                 02960000
009000                                                                  02970000
009100 PROCEDURE DIVISION.                                              02980000
009200***************************************************************** 02990000
009300*  MAINLINE LOGIC FOR PROGRAM                                     03000000
009400***************************************************************** 03010000
009500 0000-MAINLINE.                                                   03020000
009600     PERFORM 1000-INITIALIZE.                                     03030000
009700                                                                  03040000
009800     PERFORM 2000-PROCESS-EXT-FILE                                03050000
009900         UNTIL PS-END-EXT-FILE.                                   03060000
010000                                                                  03070000
010100     PERFORM 9000-EOJ.                                            03080000
010200                                                                  03090000
W40134     GOBACK.                                                      03100032
010400                                                                  03110000
010500***************************************************************** 03120000
010600*  INITIALIZATION PARAGRAPH                                       03130000
010700***************************************************************** 03140000
010800 1000-INITIALIZE.                                                 03150000
010900     OPEN INPUT  TFRD-EXT-FILE                                    03160000
011000          OUTPUT TFRD-HDR-FILE                                    03170000
011100                 TFRD-DTL-FILE                                    03180000
011200                 TFRD-MARKER-FILE                                 03190000
011300                 REPORT-FILE.                                     03200000
011400                                                                  03210000
W40134     PERFORM 5000-SELECT-TCOCNTL.                                 03220029
011600                                                                  03230000
W40134     DISPLAY 'COCNTL TABLE DATE  ====> ' COCNTL-BTCH-PRC-DTE.     03240029
011800                                                                  03250000
W40134     PERFORM 1100-POPULATE-DATES.                                 03260029
012000                                                                  03270000
012100******* TIME IS CONTAINED CURRENT-DATE IN POSITION 9 FOR 9        03280000
012200     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME-CN.           03290000
012300                                                                  03300000
012400     DISPLAY '****** RUN TIME  => ' PV-RUN-TIME-CN.               03310000
012500                                                                  03320000
012600** GET CURRENT TIMESTAMP                                          03330000
012700                                                                  03340000
012800     EXEC SQL                                                     03350000
012900         SET :PV-CURRENT-TMST-DB2 = CURRENT TIMESTAMP             03360000
013000     END-EXEC.                                                    03370000
013100                                                                  03380000
013200     EVALUATE TRUE                                                03390000
013300         WHEN SQLCODE = ZERO                                      03400000
013400             MOVE PV-CURRENT-TMST-DB2    TO PV-CURRENT-TMST       03410000
013500             MOVE PV-CURR-DATE-CC        TO PV-CURR-CC            03420000
013600             MOVE PV-CURR-DATE-YY        TO PV-CURR-YY            03430000
013700                                                                  03440000
013710                                                                  03450000
013720         WHEN OTHER                                               03460000
013730             MOVE '1000-INITIALIZATION'  TO PV-PARAGRAPH          03470000
013731             MOVE 'SET CURRENT TIMESTAMP'                         03480000
013732                                         TO PV-DB2-FUNCTION       03490000
013733             PERFORM 9200-SQL-ERROR                               03500000
013734         END-EVALUATE.                                            03510000
013735                                                                  03520000
013736                                                                  03530000
013737     SET PS-DO-NOT-WRITE-HEADER                                   03540000
013738         PS-DO-NOT-WRITE-DETAIL                                   03550000
013739         PS-TTFMSTR-NOTFND                                        03560000
013740         PS-CNTR-DESC-NOTFND                                      03570000
013741         PS-NOT-END-EXT-FILE TO TRUE.                             03580000
013742                                                                  03590000
013743     PERFORM 7000-READ-TFRD-EXT-INPUT.                            03600000
013744                                                                  03610000
W40134******************************************************************03620029
W40134**  POPULATE DATES FROM TCOCNTL TABLE.                            03630029
W40134******************************************************************03640029
W40134 1100-POPULATE-DATES.                                             03650029
W40134     MOVE COCNTL-BTCH-PRC-DTE  TO PV-RPT-DATE.                    03660029
W40134     MOVE PV-RPT-CCYY          TO PV-DATE-CCYY.                   03670029
W40134     MOVE PV-RPT-MM            TO PV-DATE-MM.                     03680029
W40134     MOVE PV-RPT-DD            TO PV-DATE-DD.                     03690029
W40134     MOVE PV-DATE              TO PV-RUN-DATE-CN.                 03700029
W40134                                                                  03710029
014038***************************************************************** 03720000
014039* PROCESS DATA FROM DAILY TRANSFER FILE AND WRITE OUTPUT RECORDS  03730000
014040***************************************************************** 03740000
014050 2000-PROCESS-EXT-FILE.                                           03750000
014060     IF  TFRD054-DOC-FROM-LOC-NBR NOT = PV-DOC-LOC-NBR-HOLD       03760000
014070         MOVE TFRD054-DOC-FROM-LOC-NBR TO PV-DOC-LOC-NBR-HOLD     03770000
014080         MOVE TFRD054-DOC-SEQ-NBR      TO PV-DOC-SEQ-NBR-HOLD     03780000
014090         SET PS-WRITE-HEADER           TO TRUE                    03790000
014100     END-IF.                                                      03800000
014200                                                                  03810000
014300     IF  TFRD054-DOC-SEQ-NBR NOT = PV-DOC-SEQ-NBR-HOLD            03820000
014301         MOVE TFRD054-DOC-SEQ-NBR      TO PV-DOC-SEQ-NBR-HOLD     03830000
014302         MOVE TFRD054-DOC-FROM-LOC-NBR TO PV-DOC-LOC-NBR-HOLD     03840000
014303         SET PS-WRITE-HEADER           TO TRUE                    03850000
014304     END-IF.                                                      03860000
014305                                                                  03870000
014306*CREATE HEADER AND DETAIL RECORD                                  03880000
014307     IF  PS-WRITE-HEADER                                          03890000
014308         PERFORM 7500-READ-TTFMSTR                                03900000
014309         IF PS-TTFMSTR-FOUND                                      03910000
014310             PERFORM 7600-BUILD-HEAD-EXTRACT                      03920000
014320             PERFORM 8000-WRITE-TRANSFER-HEADER                   03930000
014330             PERFORM 7700-BUILD-DETAIL-EXTRACT                    03940000
014340             PERFORM 8100-WRITE-EXT-DTL-OUTPUT                    03950012
W40134             PERFORM 8600-WRITE-EXT-RPT-OUTPUT                    03960025
014350         END-IF                                                   03970000
014360     ELSE                                                         03980000
014370*CREATE DETAIL RECORD ONLY                                        03990000
014380         PERFORM 7500-READ-TTFMSTR                                04000000
014390         IF PS-TTFMSTR-FOUND                                      04010000
014400             PERFORM 7700-BUILD-DETAIL-EXTRACT                    04020000
014410             PERFORM 8100-WRITE-EXT-DTL-OUTPUT                    04030000
W40134             PERFORM 8600-WRITE-EXT-RPT-OUTPUT                    04040025
014420         END-IF                                                   04050000
014421     END-IF.                                                      04060000
014422                                                                  04070000
014423     PERFORM 7000-READ-TFRD-EXT-INPUT.                            04080000
014424******************************************************************04090000
014425                                                                  04100000
014426***************************************************************** 04110000
014427*  READ THE EXTRACT DAILY TRANSFER FILE                           04120000
014428***************************************************************** 04130000
014429 7000-READ-TFRD-EXT-INPUT.                                        04140000
014430     READ TFRD-EXT-FILE                                           04150000
014440         INTO TFRD054-ML-DAILY-TRANSFER-FILE                      04160000
014450            AT END                                                04170000
014460               SET PS-END-EXT-FILE                                04180000
014470                          TO TRUE.                                04190000
014480     IF PS-NOT-END-EXT-FILE                                       04200000
014490         ADD 1    TO PV-EXT-RECS-READ                             04210000
014500     END-IF.                                                      04220000
W40134******************************************************************04230029
W40134*    READ THE CURRENT BATCH PROCESSING DATE FROM TCOCNTL          04240029
W40134******************************************************************04250029
W40134                                                                  04260029
W40134 5000-SELECT-TCOCNTL.                                             04270029
W40134                                                                  04280029
W40134     EXEC SQL                                                     04290029
W40134        SELECT  A.BTCH_PRC_DTE                                    04300029
W40134          INTO :COCNTL-BTCH-PRC-DTE                               04310029
W40134          FROM  TCOCNTL A                                         04320029
W40134          WHERE A.OPER_UNT_ID   =  90                             04330029
W40134     END-EXEC.                                                    04340029
W40134                                                                  04350029
W40134     EVALUATE TRUE                                                04360029
W40134                                                                  04370029
W40134         WHEN SQLCODE = ZEROS                                     04380029
W40134             CONTINUE                                             04390029
W40134         WHEN OTHER                                               04400029
W40134             MOVE '5000-SELECT-TCOCNTL'  TO PV-PARAGRAPH          04410029
W40134             DISPLAY '** ABEND **'                                04420029
W40134             DISPLAY '** PROGRAM = RVKUT022 **'                   04430029
W40134             MOVE 'SELECT TCOCNTL'       TO PV-ERROR-MSG-1        04440029
W40134             MOVE 'TCOCNTL'              TO PV-ABEND-TABLE-1      04450029
W40134             PERFORM 9200-SQL-ERROR                               04460029
W40134     END-EVALUATE.                                                04470029
W40134                                                                  04480029
014600******************************************************************04490000
W40134*  READ TTFMSTR AND XLT_LOC.                                      04500025
014800******************************************************************04510000
014900 7500-READ-TTFMSTR.                                               04520000
015000     INITIALIZE DCLTTFMSTR.                                       04530000
015100     SET PS-TTFMSTR-NOTFND         TO TRUE.                       04540000
015200     MOVE TFRD054-DOC-FROM-LOC-NBR TO PV-KEY-FR-STR-NBR.          04550000
015300     MOVE TFRD054-DOC-SEQ-NBR      TO PV-KEY-SEQ-NBR.             04560000
015400                                                                  04570000
015500     PERFORM                                                      04580000
015600         WITH TEST AFTER                                          04590000
015700         VARYING PV-RETRY-COUNTER                                 04600000
015800         FROM 1 BY 1                                              04610000
015900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04620000
016000                   OR (SQLCODE = ZERO)                            04630000
016100                   OR (SQLCODE = +100))                           04640000
016200         EXEC SQL                                                 04650000
016300              SELECT  XFER_DKEY_ID                                04660000
016400                  , XFER_TYP_CDE                                  04670000
016500                  , CONTNR_TYP_CDE                                04680000
016600                  , FR_STR_NBR                                    04690000
016700                  , XFER_SEQ_NBR                                  04700000
016800                  , TO_STR_NBR                                    04710000
016900                  , LG_TTE_1ST_SEAL_ID                            04720000
017000                  , LG_TTE_2ND_SEAL_ID                            04730000
017100                  , CLBK_NBR                                      04740000
W40134                  , LOC_NBR                                       04750025
017200              INTO  :TFMSTR-XFER-DKEY-ID                          04760000
017300                  , :TFMSTR-XFER-TYP-CDE                          04770000
017400                  , :TFMSTR-CONTNR-TYP-CDE                        04780000
017500                  , :TFMSTR-FR-STR-NBR                            04790000
017600                  , :TFMSTR-XFER-SEQ-NBR                          04800000
017700                  , :TFMSTR-TO-STR-NBR                            04810000
017800                  , :TFMSTR-LG-TTE-1ST-SEAL-ID                    04820000
017900                  , :TFMSTR-LG-TTE-2ND-SEAL-ID                    04830000
018000                  , :TFMSTR-CLBK-NBR                              04840000
W40134                  , :XLT00010-LOC-NBR                             04850025
W40134              FROM  TTFMSTR  A                                    04860025
W40134                   ,XLT_LOC  B                                    04870025
W40134              WHERE A.FR_STR_NBR   = :PV-KEY-FR-STR-NBR           04880025
W40134                AND A.XFER_SEQ_NBR = :PV-KEY-SEQ-NBR              04890025
W40134                AND A.XFER_TYP_CDE IN ('00', '01', '02')          04900025
W40134                AND A.TO_STR_NBR   = B.LOC_NBR                    04910025
W40134                AND B.LOC_TYP_CDE  = 'RV'                         04920025
W40134              ORDER BY                                            04930025
W40134                    A.FR_STR_NBR                                  04940025
W40134                   ,A.XFER_SEQ_NBR                                04950025
W40134                   ,B.LOC_NBR                                     04960025
018600         END-EXEC                                                 04970000
018700                                                                  04980000
018800         EVALUATE TRUE                                            04990000
018900             WHEN SQLCODE = ZERO                                  05000000
019000             WHEN SQLCODE = -904                                  05010000
019100             WHEN SQLCODE = -911                                  05020000
019200             WHEN SQLCODE = -913                                  05030000
019300                 SET PS-TTFMSTR-FOUND TO TRUE                     05040000
019400             WHEN SQLCODE = +100                                  05050000
019500                 SET PS-TTFMSTR-NOTFND TO TRUE                    05060000
019600             WHEN SQLWARN0 NOT EQUAL SPACE                        05070000
019700             WHEN SQLCODE NOT EQUAL ZERO                          05080000
019800                 DISPLAY '** ABEND **'                            05090000
019900                 DISPLAY '** PROGRAM = RVKUT022 **'               05100000
020000                 DISPLAY '** PARAGRAPH = '                        05110000
020100                         '7500-READ-TTFMSTR **'                   05120000
020200                 MOVE 'SELECT TTFMSTR'  TO PV-ERROR-MSG-1         05130000
020300                 MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-LOC-NBR     05140000
020400                 MOVE TFRD054-DOC-SEQ-NBR       TO PV-SEQ-NBR     05150000
020500                 MOVE 'TTFMSTR'       TO PV-ABEND-TABLE-1         05160000
020600                 PERFORM 9200-SQL-ERROR                           05170000
020700         END-EVALUATE                                             05180000
020800     END-PERFORM.                                                 05190000
020900                                                                  05200000
021000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05210000
021100         DISPLAY '** ABEND **'                                    05220000
021200         DISPLAY '** PROGRAM = RVKUT022 **'                       05230000
021300         DISPLAY '** PARAGRAPH = 7500-READ-TTFMSTR **'            05240000
021400         MOVE 'SELECT MAX RETRIES'                                05250000
021500                                        TO PV-ERROR-MSG-1         05260000
021600         MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-LOC-NBR             05270000
021700         MOVE TFRD054-DOC-SEQ-NBR       TO PV-SEQ-NBR             05280000
021800         MOVE 'TTFMSTR'               TO PV-ABEND-TABLE-1         05290000
021900         PERFORM 9200-SQL-ERROR                                   05300000
022000     END-IF.                                                      05310000
022100                                                                  05320000
022200******************************************************************05330000
022300*  READ TTFSHCT                                                   05340000
022400******************************************************************05350000
022500 7550-READ-TTFSHCT.                                               05360000
022600     INITIALIZE DCLTTFSHCT.                                       05370000
022700                                                                  05380000
022800     PERFORM                                                      05390000
022900         WITH TEST AFTER                                          05400000
023000         VARYING PV-RETRY-COUNTER                                 05410000
023100         FROM 1 BY 1                                              05420000
023200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05430000
023300                   OR (SQLCODE = ZERO)                            05440000
023400                   OR (SQLCODE = +100))                           05450000
023500         EXEC SQL                                                 05460000
023600              SELECT  CONTNR_TYP_CDE                              05470000
023700                  , CONTNR_TYP_DESC                               05480000
023800              INTO  :TFSHCT-CONTNR-TYP-CDE                        05490000
023900                  , :TFSHCT-CONTNR-TYP-DESC                       05500000
024000              FROM TTFSHCT                                        05510000
024100              WHERE CONTNR_TYP_CDE = :PV-CONTNR-TYP-CDE           05520000
024200         END-EXEC                                                 05530000
024300                                                                  05540000
024400         EVALUATE TRUE                                            05550000
024500             WHEN SQLCODE = ZERO                                  05560000
024600                 SET PS-CNTR-DESC-FOUND TO TRUE                   05570000
024700             WHEN SQLCODE = -904                                  05580000
024800             WHEN SQLCODE = -911                                  05590000
024900             WHEN SQLCODE = -913                                  05600000
025000                 SET PS-CNTR-DESC-NOTFND TO TRUE                  05610000
025100             WHEN SQLCODE = +100                                  05620000
025200                 SET PS-CNTR-DESC-NOTFND TO TRUE                  05630000
025300             WHEN SQLWARN0 NOT EQUAL SPACE                        05640000
025400             WHEN SQLCODE NOT EQUAL ZERO                          05650000
025500                 DISPLAY '** ABEND **'                            05660000
025600                 DISPLAY '** PROGRAM = RVKUT022 **'               05670000
025700                 DISPLAY '** PARAGRAPH = '                        05680000
025800                         '7550-READ-TTFSHCT **'                   05690000
025900                 MOVE 'SELECT TTFSHCT'  TO PV-ERROR-MSG-1         05700000
026000                 MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-LOC-NBR     05710000
026100                 MOVE TFRD054-DOC-SEQ-NBR       TO PV-SEQ-NBR     05720000
026200                 MOVE PV-CONTNR-TYP-CDE         TO PV-CONT-NBR    05730000
026300                 MOVE 'TTFSHCT'       TO PV-ABEND-TABLE-1         05740000
026400                 PERFORM 9200-SQL-ERROR                           05750000
026500         END-EVALUATE                                             05760000
026600     END-PERFORM.                                                 05770000
026700                                                                  05780000
026800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05790000
026900         DISPLAY '** ABEND **'                                    05800000
027000         DISPLAY '** PROGRAM = RVKUT022 **'                       05810000
027100         DISPLAY '** PARAGRAPH = 7550-READ-TTFSNCT **'            05820000
027200         MOVE 'SELECT MAX RETRIES'                                05830000
027300                                        TO PV-ERROR-MSG-1         05840000
027400         MOVE TFRD054-DOC-FROM-LOC-NBR  TO PV-LOC-NBR             05850000
027500         MOVE TFRD054-DOC-SEQ-NBR       TO PV-SEQ-NBR             05860000
027600         MOVE PV-CONTNR-TYP-CDE         TO PV-CONT-NBR            05870000
027700         MOVE 'TTFSHCT'               TO PV-ABEND-TABLE-1         05880000
027800         PERFORM 9200-SQL-ERROR                                   05890000
027900     END-IF.                                                      05900000
028000                                                                  05910000
028100                                                                  05920000
028200******************************************************************05930000
028300*  BUILD HEADER EXTRACT RECORD                                    05940000
028400******************************************************************05950000
028500 7600-BUILD-HEAD-EXTRACT.                                         05960000
028600                                                                  05970000
028700     SET PS-VALID-HDR-NOTFND TO TRUE.                             05980000
028800                                                                  05990000
028900     IF TFRD054-ADJ-RSN-CDE = 'VD'                                06000000
029000          MOVE 'D' TO RV038-ACD-INDICATOR                         06010000
029100          SET PS-VALID-HDR-FOUND   TO TRUE                        06020000
029200     END-IF.                                                      06030000
029300                                                                  06040000
029400     IF TFRD054-ADJ-RSN-CDE = 'CM'                                06050000
029500          MOVE 'A' TO RV038-ACD-INDICATOR                         06060000
029600          SET PS-VALID-HDR-FOUND   TO TRUE                        06070000
029700     END-IF.                                                      06080000
029800                                                                  06090000
029900     IF PS-VALID-HDR-FOUND                                        06100000
030000         MOVE TFMSTR-XFER-DKEY-ID      TO PV-XFER-DKEY-IDN        06110000
030100         MOVE PV-XFER-DKEY-IDX         TO RV038-KEY-ID-NBR        06120000
030110         MOVE TFRD054-DOC-FROM-LOC-NBR TO PV-DOC-LOC-NBRN         06130000
030111         MOVE PV-DOC-LOC-NBRX          TO RV038-NBR-STORE         06140000
030112         MOVE TFRD054-DOC-SEQ-NBR      TO PV-DOC-SEQ-NBRN         06150000
030113         MOVE PV-DOC-SEQ-NBRX(4:6)     TO RV038-NBR-SEQ           06160000
030114         MOVE TFMSTR-XFER-TYP-CDE      TO RV038-TYPE-CODE         06170000
030115         MOVE TFRD054-TYP-1ST-LNE-DESC TO RV038-TYPE-DESC         06180000
030116         MOVE TFRD054-FROM-LOC-NBR     TO PV-FROM-STORE-NBRN      06190000
030117         MOVE PV-FROM-STORE-NBRN       TO RV038-FROM-LOC-NBR      06200000
030118         MOVE TFRD054-TO-LOC-NBR       TO PV-TO-STORE-NBRN        06210000
030119         MOVE PV-TO-STORE-NBRN         TO RV038-TO-STORE-NBR      06220000
030120         MOVE TFMSTR-LG-TTE-1ST-SEAL-ID                           06230000
030121                                       TO RV038-SEAL-ID1          06240000
030122         MOVE TFMSTR-LG-TTE-2ND-SEAL-ID                           06250000
030123                                       TO RV038-SEAL-ID2          06260000
030124         MOVE TFMSTR-CONTNR-TYP-CDE    TO PV-CONTNR-TYP-CDE       06270000
030125         PERFORM 7550-READ-TTFSHCT                                06280000
030126         MOVE TFRD054-CREATE-DATE-YY   TO PV-DATE-CCYY            06290000
030127         MOVE TFRD054-CREATE-DATE-MM   TO PV-DATE-MM              06300000
030128         MOVE TFRD054-CREATE-DATE-DD   TO PV-DATE-DD              06310000
030129         MOVE PV-DATE                  TO RV038-TRAN-START-DATE   06320000
030130         MOVE TFRD054-RECEIVE-DATE-YY  TO PV-DATE-CCYY            06330000
030140         MOVE TFRD054-RECEIVE-DATE-MM  TO PV-DATE-MM              06340000
030141         MOVE TFRD054-RECEIVE-DATE-DD  TO PV-DATE-DD              06350000
030142         MOVE PV-DATE                  TO RV038-TRAN-END-DATE     06360000
030143         MOVE TFMSTR-CLBK-NBR          TO RV038-CALLBACK-NBR      06370000
030144         MOVE TFRD054-ADJ-RSN-CDE      TO RV038-ADJ-RSN-CODE      06380000
030145         MOVE 'X'                      TO RV038-ANCHOR-CONST      06390000
030146         IF PS-CNTR-DESC-FOUND                                    06400000
030147             MOVE TFSHCT-CONTNR-TYP-DESC                          06410000
030148                                       TO RV038-CONT-TYPE-DESC    06420000
030149         ELSE                                                     06430000
030150             MOVE SPACE                TO RV038-CONT-TYPE-DESC    06440000
030151         END-IF                                                   06450000
030152     ELSE                                                         06460000
030153         CONTINUE                                                 06470000
030154     END-IF.                                                      06480000
030155******************************************************************06490000
W40134*  BUILD DETAIL EXTRACT RECORD AND REPORT RECORD                  06500025
030157******************************************************************06510000
030158 7700-BUILD-DETAIL-EXTRACT.                                       06520000
W40134     INITIALIZE RV061-TRNSFR-REPORT-RECORD.                       06530025
030159                                                                  06540000
030160     SET PS-VALID-DTL-NOTFND TO TRUE.                             06550000
030161                                                                  06560000
030162     IF TFRD054-ADJ-RSN-CDE = 'VD'                                06570000
030163          MOVE 'D' TO RV039-ACD-INDICATOR                         06580000
030164          SET PS-VALID-DTL-FOUND   TO TRUE                        06590000
030165     END-IF.                                                      06600000
030166                                                                  06610000
030167     IF TFRD054-ADJ-RSN-CDE = 'CM'                                06620000
030168          MOVE 'A' TO RV039-ACD-INDICATOR                         06630000
030169          SET PS-VALID-DTL-FOUND   TO TRUE                        06640000
030170     END-IF.                                                      06650000
030171                                                                  06660000
W40134     MOVE TFRD054-BATCH-NBR        TO RV061-BATCH-NBR.            06670025
W40134     MOVE XLT00010-LOC-NBR         TO RV061-TO-LOC-NBR.           06680025
                                                                        06690014
      * TOTAL D&D TYPE CODE - ADD                                       06700011
           IF (TFMSTR-XFER-TYP-CDE = '00'                               06710011
               AND RV039-ACD-INDICATOR = 'A'                            06720011
               AND PS-VALID-DTL-FOUND)                                  06730011
W40134           MOVE 'A'                TO RV061-TRANSFER-TYPE         06740030
W40134                                      RV061-ACD-INDICATOR         06750030
           END-IF.                                                      06760011
      * TOTAL RTV TYPE CODE - ADD                                       06770011
           IF (TFMSTR-XFER-TYP-CDE = '01'                               06780011
               AND RV039-ACD-INDICATOR = 'A'                            06790011
               AND PS-VALID-DTL-FOUND)                                  06800011
W40134           MOVE 'B'                TO RV061-TRANSFER-TYPE         06810030
W40134           MOVE 'A'                TO RV061-ACD-INDICATOR         06820030
           END-IF.                                                      06830011
      * TOTAL CALLBACK TYPE CODE - ADD                                  06840011
           IF (TFMSTR-XFER-TYP-CDE = '02'                               06850011
               AND RV039-ACD-INDICATOR = 'A'                            06860011
               AND PS-VALID-DTL-FOUND)                                  06870011
W40134           MOVE 'C'                TO RV061-TRANSFER-TYPE         06880030
W40134           MOVE 'A'                TO RV061-ACD-INDICATOR         06890030
           END-IF.                                                      06900011
      * TOTAL D&D TYPE CODE - DELETE                                    06910011
           IF (TFMSTR-XFER-TYP-CDE = '00'                               06920011
               AND RV039-ACD-INDICATOR = 'D'                            06930011
               AND PS-VALID-DTL-FOUND)                                  06940011
W40134           MOVE 'A'                TO RV061-TRANSFER-TYPE         06950030
W40134           MOVE 'D'                TO RV061-ACD-INDICATOR         06960030
           END-IF.                                                      06970011
      * TOTAL RTV TYPE CODE - DELETE                                    06980011
           IF (TFMSTR-XFER-TYP-CDE = '01'                               06990011
               AND RV039-ACD-INDICATOR = 'D'                            07000011
               AND PS-VALID-DTL-FOUND)                                  07010011
W40134           MOVE 'B'                TO RV061-TRANSFER-TYPE         07020030
W40134           MOVE 'D'                TO RV061-ACD-INDICATOR         07030030
           END-IF.                                                      07040011
      * TOTAL CALLBACK TYPE CODE - DELETE                               07050011
           IF (TFMSTR-XFER-TYP-CDE = '02'                               07060011
               AND RV039-ACD-INDICATOR = 'D'                            07070011
               AND PS-VALID-DTL-FOUND)                                  07080011
W40134           MOVE 'C'                TO RV061-TRANSFER-TYPE         07090030
W40134           MOVE 'D'                TO RV061-ACD-INDICATOR         07100030
           END-IF.                                                      07110011
030223                                                                  07120000
030224     IF PS-VALID-DTL-FOUND                                        07130000
030225         MOVE TFMSTR-XFER-DKEY-ID      TO PV-XFER-DKEY-IDN        07140000
030226         MOVE PV-XFER-DKEY-IDX         TO RV039-KEY-ID-NBR        07150000
030227         MOVE TFRD054-DOC-FROM-LOC-NBR TO PV-DOC-LOC-NBRN         07160000
030228         MOVE PV-DOC-LOC-NBRX          TO RV039-NBR-STORE         07170000
030229         MOVE TFRD054-DOC-SEQ-NBR      TO PV-DOC-SEQ-NBRN         07180000
030230         MOVE PV-DOC-SEQ-NBRX(4:6)     TO RV039-NBR-SEQ           07190000
030231         MOVE TFRD054-DEPT             TO RV039-DEPT-NBR          07200000
030232         MOVE TFRD054-SUBCLASS         TO RV039-SUB-CL-NBR        07210000
030233         MOVE TFRD054-SKU-NBR          TO PV-SKU-NBRN             07220000
030234         MOVE PV-SKU-NBRX              TO RV039-SKU               07230000
030235         MOVE SPACE                    TO RV039-ITM-RAMT-SIGN     07240000
030236         MOVE TFRD054-ITEM-PRICE       TO RV039-ITM-RETAIL        07250000
W40134         MOVE TFRD054-EXTENDED-RETAIL  TO RV061-EXTENDED-RETAIL   07260025
030237         MOVE TFRD054-ITEM-QTY         TO RV039-ITM-QTY           07270000
030238         MOVE 'X'                      TO RV039-ANCHOR-CONST      07280000
030239     ELSE                                                         07290000
030240         CONTINUE                                                 07300000
030241     END-IF.                                                      07310000
030242***************************************************************** 07320000
030243*  WRITE TRANSFER HEADER OUTPUT FILE                              07330000
030244***************************************************************** 07340000
030245 8000-WRITE-TRANSFER-HEADER.                                      07350000
030246     IF PS-VALID-HDR-FOUND                                        07360000
030247         WRITE TFRD-HDR-RECORD                                    07370000
030248             FROM RV038-TFRD-HEADER-RECORD                        07380000
030249                                                                  07390000
030250         ADD 1                TO PV-EXT-HDR-MARKER-COUNT          07400000
030260         ADD 1                TO PV-EXT-HDR-RECS-WRITTEN          07410000
030270         SET PS-DO-NOT-WRITE-HEADER TO TRUE                       07420000
030280     END-IF.                                                      07430000
030290                                                                  07440000
030300                                                                  07450000
030400***************************************************************** 07460000
030500*  WRITE TRANSFER DETAIL OUTPUT FILE                              07470000
030501***************************************************************** 07480000
030502 8100-WRITE-EXT-DTL-OUTPUT.                                       07490000
030503     IF PS-VALID-DTL-FOUND                                        07500000
030504         WRITE TFRD-DTL-RECORD                                    07510000
030505             FROM RV039-TFRD-DETAIL-RECORD                        07520000
030506                                                                  07530000
030507         ADD 1                TO PV-EXT-DTL-MARKER-COUNT          07540000
030508         ADD 1                TO PV-EXT-DTL-RECS-WRITTEN          07550000
030509     END-IF.                                                      07560000
030510                                                                  07570000
030520***************************************************************** 07580000
030530*  CREATE MARKER FILE - BECAUSE 2 FILES ARE CREATED - 2 MARKER    07590000
030531*     RECORDS NEED TO BE WRITTEN                                  07600000
030532***************************************************************** 07610000
030533 8500-CREATE-MARKER.                                              07620000
030534     INITIALIZE RV029-MARKER-RECORD.                              07630000
030535     MOVE PV-RUN-DATE-CN          TO PV-CREATE-DATE.              07640000
030536     MOVE 'TRANSFER_HDR.DAT'      TO PV-TRANMARK-MKR.             07650000
030537     MOVE PV-FILE-NAME            TO RV029-FILE-NAME.             07660000
030538     MOVE PV-EXT-HDR-MARKER-COUNT TO RV029-RECORD-COUNT.          07670000
030539     MOVE PV-RUN-DATE-CN          TO RV029-BUILD-DATE.            07680000
030540     MOVE PV-RUN-TIME-CN          TO RV029-BUILD-TIME.            07690000
030541     MOVE 'X'                     TO RV029-ANCHOR-CONSTANT.       07700000
030542                                                                  07710000
030543     WRITE TFRD-MARKER-RECORD                                     07720000
030544                  FROM RV029-MARKER-RECORD.                       07730000
030545                                                                  07740000
030546     INITIALIZE RV029-MARKER-RECORD.                              07750000
030547     MOVE PV-RUN-DATE-CN          TO PV-CREATE-DATE.              07760000
030548     MOVE 'TRANSFER_DTL.DAT'      TO PV-TRANMARK-MKR.             07770000
030549     MOVE PV-FILE-NAME            TO RV029-FILE-NAME.             07780000
030550     MOVE PV-EXT-DTL-MARKER-COUNT TO RV029-RECORD-COUNT.          07790000
030551     MOVE PV-RUN-DATE-CN          TO RV029-BUILD-DATE.            07800000
030552     MOVE PV-RUN-TIME-CN          TO RV029-BUILD-TIME.            07810000
030553     MOVE 'X'                     TO RV029-ANCHOR-CONSTANT.       07820000
030554                                                                  07830000
030555     WRITE TFRD-MARKER-RECORD                                     07840000
030556                  FROM RV029-MARKER-RECORD.                       07850000
030557                                                                  07860000
W40134***************************************************************** 07870025
W40134*  WRITE TRANSFER REPORT OUTPUT FILE                              07880025
W40134***************************************************************** 07890025
W40134 8600-WRITE-EXT-RPT-OUTPUT.                                       07900025
W40134     IF PS-VALID-DTL-FOUND                                        07910025
W40134         WRITE REPORT-RECORD                                      07920025
W40134             FROM RV061-TRNSFR-REPORT-RECORD                      07930025
W40134                                                                  07940025
W40134         ADD 1                    TO PV-EXT-RPT-RECS-WRITTEN      07950025
W40134     END-IF.                                                      07960025
W40134                                                                  07970025
030680***************************************************************** 07980000
030690*  END OF JOB PROCESSING                                          07990000
030700***************************************************************** 08000000
030800 9000-EOJ.                                                        08010000
030900     PERFORM 8500-CREATE-MARKER.                                  08020000
031000                                                                  08030000
031005                                                                  08040000
031006     DISPLAY PV-ASTERISK-LINE                                     08050000
031007     DISPLAY 'EXT HEADER RECORDS WRITTEN ===>  '                  08060000
031008              PV-EXT-HDR-RECS-WRITTEN.                            08070000
031009     DISPLAY 'EXT DETAIL RECORDS WRITTEN ===>  '                  08080000
031010              PV-EXT-DTL-RECS-WRITTEN.                            08090000
031020     DISPLAY 'EXT MARKER HDR RECORD CNT  ===>  '                  08100000
031030              PV-EXT-HDR-MARKER-COUNT.                            08110000
031040     DISPLAY 'EXT MARKER DTL RECORD CNT  ===>  '                  08120000
031050              PV-EXT-DTL-MARKER-COUNT.                            08130000
W40134     DISPLAY 'EXT REPORT RECORDS WRITTEN ===>  '                  08140025
W40134              PV-EXT-RPT-RECS-WRITTEN.                            08150025
031060     DISPLAY 'EXT RECORDS READ           ===>  '                  08160000
031070              PV-EXT-RECS-READ.                                   08170000
031080                                                                  08180000
031090     CLOSE TFRD-EXT-FILE                                          08190000
031100           TFRD-HDR-FILE                                          08200000
031200           TFRD-DTL-FILE                                          08210000
031300           TFRD-MARKER-FILE                                       08220000
031400           REPORT-FILE.                                           08230000
031500                                                                  08240000
031600***************************************************************** 08250000
031700*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             08260000
031800***************************************************************** 08270000
031900 9200-SQL-ERROR.                                                  08280000
032000     CLOSE TFRD-EXT-FILE                                          08290000
032100           TFRD-HDR-FILE                                          08300000
032110           TFRD-DTL-FILE                                          08310000
032120           TFRD-MARKER-FILE                                       08320000
032130           REPORT-FILE.                                           08330000
032140                                                                  08340000
032150     MOVE SQLCODE                     TO SQLCODE2.                08350000
032160     MOVE SQLERRD(3)                  TO SQLERRD3.                08360000
032170                                                                  08370000
032180     DISPLAY '** ABEND **         ** = SQLERROR'.                 08380000
032190     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PGM-RVKUT022.        08390000
032200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   08400000
032300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                08410000
032400     DISPLAY '** LOC NBR   ** = ' PV-LOC-NBR.                     08420000
032500     DISPLAY '** SEQ NBR   ** = ' PV-SEQ-NBR.                     08430000
032600     DISPLAY '** CONTR NBR ** = ' PV-CONT-NBR.                    08440000
032700     DISPLAY '**           ** = ' PV-ABEND-TABLE-1.               08450000
032800     DISPLAY '**           ** = ' PV-ABEND-TABLE-2.               08460000
032900     DISPLAY '**           ** = ' PV-ABEND-TABLE-3.               08470000
033000     DISPLAY '**           ** = ' PV-ABEND-TABLE-4.               08480000
033100     DISPLAY '**           ** = ' PV-ABEND-TABLE-5.               08490000
033200     DISPLAY '**           ** = ' PV-ERROR-MSG-1                  08500000
033300     DISPLAY '**           ** = ' PV-ERROR-MSG-2                  08510000
033310     DISPLAY '**           ** = ' PV-ERROR-MSG-3                  08520000
033320                                                                  08530000
033330     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                08540000
033340     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                08550000
033350     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 08560000
033360     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                08570000
033370                                                                  08580000
033380     COPY DPPD004.                                                08590000
033390                                                                  08600000
033400     MOVE +4013                       TO PV-ABEND-CODE.           08610000
033500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08620000
033600                                                                  08630000
033700*************  END OF RVKUT022  ********************************  08640000
