000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.             WSKCS310.                                00040000
000500 AUTHOR.                 GERMAN BANDA.                            00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060000
000700 DATE-WRITTEN            MARCH,  2007.                            00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* MODULE THAT WILL PROCESS ALL THE PO/RECEIVER/LINE ON A TRIP     00100000
001100* AND THEN CALL THE MODULE TO VERIFY EACH LINE.                   00110000
001200* -- OUTBOUND CARTONS THE HAVE ZERO LINE NUMBERS WILL BE UPDATED  00120000
001300* -- CARTONS WILL BE INSERTED TO SUT_OTBND_PK FOR PREPK CARTONS   00130000
001400* -- ROWS WILL BE INSERTED TO TDISTHD                             00140000
001500* -- VERIFICATION MODULE IS CALLED                                00150000
001600******************************************************************00160000
001700******************************************************************00170000
001800* MM/DD/YYYY WHO & WHAT                                           00180000
001900* ---------- -----------------------------------------------------00190000
002000* 03/29/2010 FRANK WALA (FJW)                                     00200000
002100*            CHANGE PGM TO PASS THRU INPUT STORE-NUMBER AND DC-   00210000
002200*            LOCATION RATHER THAN USE '870' & '873' HARD-CODING.  00220000
002300*            ALSO, COMMENTED OUT 9999-FINAL-DUMP CODING - IT WAS  00230000
002400*            CAUSING A COMPILER WARNING.                          00240000
002500******************************************************************00250000
002600 ENVIRONMENT DIVISION.                                            00260000
002700 DATA DIVISION.                                                   00270000
002800******************************************************************00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000                                                                  00300000
003100 01  DK-DB2-KEYS.                                                 00310000
003200     05  DK-PO-NBR                PIC S9(09)  COMP.               00320000
003300     05  DK-PREPK-ID              PIC S9(04)  COMP.               00330000
003400     05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00340000
003500     05  DK-OPER-UNT-ID-2         PIC S9(04)  COMP.               00350000
003600     05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00360000
003700     05  DK-SHIPT-UNT-ID          PIC S9(18)V COMP-3.             00370000
003800     05  DK-ENT-ID                PIC S9(09)  COMP.               00380000
003900     05  DK-STR-DEST-NBR          PIC S9(4)   COMP.               00390000
004000     05  DK-RCVD-SHPMT-NBR        PIC  X(20).                     00400000
004100                                                                  00410000
004200 01  DN-DB2-NULL-INDICATORS.                                      00420000
004300     05  DN-SUM-NULL                PIC S9(04) COMP VALUE ZEROES. 00430000
004400     05  DN-SUM-NULL-UPC            PIC S9(04) COMP VALUE ZEROES. 00440000
004500*                                                                 00450000
004600******************************************************************00460000
004700* INPUT LAYOUT - RECEIPT PIX TRANSACTIONS FROM WMOS               00470000
004800******************************************************************00480000
004900     COPY WSRD014.                                                00490000
005000                                                                  00500000
005100******************************************************************00510000
005200* CALLED MODULES RECORD LAYOUT                                    00520000
005300******************************************************************00530000
005400     COPY WSWS007.                                                00540000
005500                                                                  00550000
005600******************************************************************00560000
005700* COMMAREA FOR VERIFICATION PROCESSING                            00570000
005800******************************************************************00580000
005900     COPY RCWS289.                                                00590000
006000                                                                  00600000
006100******************************************************************00610000
006200*  THIS COPYBOOK IS USED FOR THE VERIFICATION ELIGIBILITY        *00620000
006300*  MODULE.  THIS MODULE WILL BE USED TO DETERMINE IF AN ORDER    *00630000
006400*  CAN BE VERIFIED.  (RCKUT124)                                  *00640000
006500******************************************************************00650000
006600     COPY RCWS038.                                                00660000
006700                                                                  00670000
006800******************************************************************00680000
006900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00690000
007000******************************************************************00700000
007100     COPY DPWS013.                                                00710000
007200                                                                  00720000
007300*----------------------------------------------------------------*00730000
007400*  PROGRAM CONSTANTS                                             *00740000
007500*----------------------------------------------------------------*00750000
007600 01  PC-PROGRAM-CONSTANTS.                                        00760000
007700     05  PC-CURRENT-PROGRAM-NAME  PIC X(08)  VALUE 'WSKCS310'.    00770000
007800     05  PC-WM-CRTN-VERIF-TRIGGER PIC X(04)  VALUE 'W313'.        00780000
007900     05  PC-Y                     PIC X(01)  VALUE 'Y'.           00790000
008000     05  PC-DEFAULT-TMST          PIC X(26)  VALUE                00800000
008100                     '9999-09-09-09.09.09.999999'.                00810000
008200     05  PC-LOG-QUEUE             PIC  X(04)  VALUE 'CSSL'.       00820000
008300     05  PC-MSG-TABLE-SIZE            PIC S9(03) COMP-3 VALUE 200.00830000
008400     05  PC-RCKUT124               PIC X(08)  VALUE 'RCKUT124'.   00840000
008500                                                                  00850000
008600*----------------------------------------------------------------*00860000
008700*  PROGRAM SWITCHES                                              *00870000
008800*----------------------------------------------------------------*00880000
008900 01  PS-PROGRAM-SWITCHES.                                         00890000
009000     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00900000
009100         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00910000
009200         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00920000
009300     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00930000
009400         88  PS-ERROR                                VALUE 'Y'.   00940000
009500         88  PS-ERROR-NO                             VALUE 'N'.   00950000
009600     05  PS-DUMP-TO-LOG-SW               PIC X(01)   VALUE 'N'.   00960000
009700         88  PS-DONT-DUMP-TO-LOG                     VALUE 'N'.   00970000
009800         88  PS-DUMP-TO-LOG                          VALUE 'Y'.   00980000
009900     05  PS-FIRST-PREPK-FETCH-SW         PIC X(01)   VALUE 'Y'.   00990000
010000         88  PS-FIRST-PREPK-FETCH                    VALUE 'Y'.   01000000
010100         88  PS-FIRST-PREPK-FETCH-NO                 VALUE 'N'.   01010000
010200     05  PS-PREPK-ID-SEARCH-SW           PIC X(01)   VALUE ' '.   01020000
010300         88  PS-PREPK-ID-MATCH                       VALUE 'Y'.   01030000
010400         88  PS-PREPK-ID-MISMATCH                    VALUE 'N'.   01040000
010500     05  PS-NEW-PREPK-ID-FOUND-SW        PIC X(01)   VALUE 'Y'.   01050000
010600         88  PS-NEW-PREPK-FOUND-YES                  VALUE 'Y'.   01060000
010700         88  PS-NEW-PREPK-FOUND-NO                   VALUE 'N'.   01070000
010800     05  PS-PACK-SKU-FOUND-SW            PIC X(01)   VALUE 'N'.   01080000
010900         88  PS-PACK-SKU-FOUND                       VALUE 'Y'.   01090000
011000         88  PS-PACK-SKU-FOUND-NO                    VALUE 'N'.   01100000
011100     05  PS-ZERO-LINE-CRTN-CSR-SW        PIC X(01)   VALUE 'N'.   01110000
011200         88  PS-NOT-END-OF-ZERO-LINE-CRTN            VALUE 'N'.   01120000
011300         88  PS-END-OF-ZERO-LINE-CRTN                VALUE 'Y'.   01130000
011400     05  PS-PREPK-RCVR-ITM-CSR-SW        PIC X(01)   VALUE 'N'.   01140000
011500         88  PS-NOT-EO-PREPK-RCVR-ITM-CSR            VALUE 'N'.   01150000
011600         88  PS-END-OF-PREPK-RCVR-ITM-CSR            VALUE 'Y'.   01160000
011700     05  PS-PREPK-PO-ITM-CSR-SW          PIC X(01)   VALUE 'N'.   01170000
011800         88  PS-NOT-END-OF-PREPK-PO-ITM-CSR          VALUE 'N'.   01180000
011900         88  PS-END-OF-PREPK-PO-ITM-CSR              VALUE 'Y'.   01190000
012000     05  PS-OTBND-PACK-CSR-SW            PIC X(01)   VALUE 'N'.   01200000
012100         88  PS-NOT-END-OF-OTBND-PACK-CSR            VALUE 'N'.   01210000
012200         88  PS-END-OF-OTBND-PACK-CSR                VALUE 'Y'.   01220000
012300     05  PS-VERIF-LINE-CSR-SW            PIC X(01)   VALUE 'N'.   01230000
012400         88  PS-NOT-END-OF-VERIF-LINE-CSR            VALUE 'N'.   01240000
012500         88  PS-END-OF-VERIF-LINE-CSR                VALUE 'Y'.   01250000
012600     05  PS-PO-ITEM-PROCESS-UPD-SW       PIC X(01)   VALUE 'N'.   01260000
012700         88  PS-PO-ITEM-PROCESS-UPD-YES              VALUE 'Y'.   01270000
012800         88  PS-PO-ITEM-PROCESS-UPD-NO               VALUE 'N'.   01280000
012900     05  PS-START-VERIF-TRIGGER-SW       PIC X(01)   VALUE 'N'.   01290000
013000         88  PS-START-VERIF-TRIGGER-YES              VALUE 'Y'.   01300000
013100         88  PS-START-VERIF-TRIGGER-NO               VALUE 'N'.   01310000
013200     05  PS-SET-DRVR-LINE-Y-SW           PIC X(01)   VALUE 'N'.   01320000
013300         88  PS-SET-DRVR-LINE-YES                    VALUE 'Y'.   01330000
013400         88  PS-SET-DRVR-LINE-NO                     VALUE 'N'.   01340000
013500     05  PS-CRTN-UPC-CURSOR-SW           PIC X(01)   VALUE 'N'.   01350000
013600         88  PS-NOT-END-OF-CRTN-UPC-CSR              VALUE 'Y'.   01360000
013700         88  PS-END-OF-CRTN-UPC-CSR                  VALUE 'N'.   01370000
013800     05  PS-ZERO-LINE-FOUND-SW           PIC X(01)   VALUE 'N'.   01380000
013900         88  PS-ZERO-LINE-FOUND-NO                   VALUE 'N'.   01390000
014000         88  PS-ZERO-LINE-FOUND-YES                  VALUE 'Y'.   01400000
014100                                                                  01410000
014200*----------------------------------------------------------------*01420000
014300*  PROGRAM VARIABLES                                             *01430000
014400*----------------------------------------------------------------*01440000
014500 01  PV-PROGRAM-VARIABLES.                                        01450000
014600                                                                  01460000
014700     05  PV-DISPLAY-CARTON               PIC 9(18).               01470000
014800     05  PV-DISPLAY-PO-NBR               PIC 9(09).               01480000
014900     05  PV-DISPLAY-TRIP-ID              PIC 9(09).               01490000
015000     05  PV-DISPLAY-PKSLIP-SEQ           PIC 9(04).               01500000
015100     05  PV-DISPLAY-PREPK-ID             PIC 9(04).               01510000
015200     05  PV-DISPLAY-LINE-NBR             PIC 9(04).               01520000
015300     05  PV-DISPLAY-OPER-UNT-ID          PIC 9(04).               01530000
015400     05  PV-DISPLAY-DEST-OPER            PIC 9(04).               01540000
015500     05  PV-DISPLAY-SHIPMT-NBR           PIC X(20).               01550000
015600     05  PV-DISPLAY-INBND-TRIP-ID        PIC 9(09).               01560000
015700     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 9(04).               01570000
015800     05  PV-DISPLAY-SHIPT-UNT-ID         PIC 9(18).               01580000
015900     05  PV-DISPLAY-SQLCODE              PIC 9(04).               01590000
016000     05  PV-DISPLAY-TASK                 PIC 9(07).               01600000
016100     05  PV-DISPLAY-MSG-NBR              PIC 9(03).               01610000
016200     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           01620000
016300                                                 VALUE ZEROS.     01630000
016400                                                                  01640000
016500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACES.01650000
016600     05  PV-CALLING-PGM                  PIC  X(08).              01660000
016700     05  PV-UNION-TYPE                   PIC  X(01).              01670000
016800     05  PV-LINE-NUMBER                  PIC S9(09)  COMP.        01680000
016900     05  PV-MAX-LNE-NBR                  PIC S9(09)  COMP.        01690000
017000     05  PV-MAX-PREPK-ID                 PIC S9(4) COMP.          01700000
017100     05  PV-SWITCH-IND                   PIC  X(01).              01710000
017200     05  PV-PROGRAM-NAME                 PIC   X(08) VALUE SPACE. 01720000
017300     05  PV-PREPK-RATIO-CALC             PIC S9(2)V9(2) COMP-3.   01730000
017400                                                                  01740000
017500     05  PV-PACK-COUNT                   PIC  9(04)  VALUE ZEROS. 01750000
017600     05  PV-REMAINDER                    PIC  9(04)  VALUE ZEROS. 01760000
017700                                                                  01770000
017800     05  PV-CICS-MSG-AREA                PIC  X(80) VALUE SPACE.  01780000
017900     05  PV-CICS-RESPONSE                PIC S9(08) VALUE ZEROS   01790000
018000                                                    COMP SYNC.    01800000
018100     05  PV-EIBTASKN                     PIC Z(06)9.              01810000
018200     05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        01820000
018300                                                     VALUE ZERO.  01830000
018400     05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        01840000
018500                                                     VALUE ZERO.  01850000
018600     05  PV-UNT-QTY                      PIC  9(05)V99.           01860000
018700     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01870000
018800     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01880000
018900                                                     COMP.        01890000
019000     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01900000
019100                                                     COMP SYNC.   01910000
019200/                                                                 01920000
019300 01  PV-HOLD-FIELDS.                                              01930000
019400     05  PV-HOLD-PREPK-ID                PIC  S9(4) COMP.         01940000
019500     05  PV-HOLD-UNION-TYPE              PIC   X(1).              01950000
019600     05  PV-HOLD-ORD-LNE-NBR             PIC  S9(9) COMP.         01960000
019700     05  PV-HOLD-PREPK-RATO-QTY          PIC  S9(4) COMP.         01970000
019800     05  PV-HOLD-PREPK-RATIO-CALC        PIC  9(05)V99.           01980000
019900     05  PV-CURR-PREPK-RATIO-CALC        PIC  9(05)V99.           01990000
020000*****05  PV-CURR-PREPK-RATIO-CALC        PIC  9(07).              02000000
020100     05  PV-HOLD-PO-NBR                  PIC  S9(9) COMP.         02010000
020200     05  PV-HOLD-RCVR-NBR                PIC  S9(9) COMP.         02020000
020300     05  PV-USE-PACK-ID                  PIC  S9(4) COMP.         02030000
020400/                                                                 02040000
020500 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  02050000
020600     05  TS-INFO-QUEUE-NAME.                                      02060000
020700         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 02070000
020800         10  FILLER                      PIC  X(04)  VALUE 'INFO'.02080000
020900                                                                  02090000
021000/                                                                 02100000
021100 01  PT-MSG-TABLE.                                                02110000
021200     05  PT-MSG-LINES OCCURS 200 TIMES                            02120000
021300                              INDEXED BY PT-MSG-IDX.              02130000
021400         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       02140000
021500         10  PT-MSG-LINE                 PIC X(69).               02150000
021600                                                                  02160000
021700     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         02170000
021800                                                     VALUE ZERO.  02180000
021900     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  02190000
022000                                                     COMP SYNC.   02200000
022100                                                                  02210000
022200*---------------------------------------------------------------* 02220000
022300*    DB2 AREA FOR VEH TRIP TABLE                                * 02230000
022400*---------------------------------------------------------------* 02240000
022500     EXEC SQL                                                     02250000
022600          INCLUDE TVHTRIP                                         02260000
022700     END-EXEC.                                                    02270000
022800*---------------------------------------------------------------* 02280000
022900*    DB2 AREA FOR SHIPMENT PO TABLE                             * 02290000
023000*---------------------------------------------------------------* 02300000
023100     EXEC SQL                                                     02310000
023200          INCLUDE TSHPTPO                                         02320000
023300     END-EXEC.                                                    02330000
023400*---------------------------------------------------------------* 02340000
023500*    DB2 AREA FOR THE OUTBOUND UPC TABLE (SUT_OTBND_CART)       * 02350000
023600*---------------------------------------------------------------* 02360000
023700     EXEC SQL                                                     02370000
023800          INCLUDE SUT00024                                        02380000
023900     END-EXEC.                                                    02390000
024000*---------------------------------------------------------------* 02400000
024100*    DB2 AREA FOR THE OUTBOUND UPC TABLE (SUT_OTBND_UPC)        * 02410000
024200*---------------------------------------------------------------* 02420000
024300     EXEC SQL                                                     02430000
024400          INCLUDE SUT00028                                        02440000
024500     END-EXEC.                                                    02450000
024600*---------------------------------------------------------------* 02460000
024700*    DB2 AREA FOR THE OUTBOUND PACK TABLE (SUT_OTBND_PK)        * 02470000
024800*---------------------------------------------------------------* 02480000
024900     EXEC SQL                                                     02490000
025000          INCLUDE SUT00041                                        02500000
025100     END-EXEC.                                                    02510000
025200*---------------------------------------------------------------* 02520000
025300*    DB2 AREA FOR THE RECEIVER ITEM TABLE                       * 02530000
025400*---------------------------------------------------------------* 02540000
025500     EXEC SQL                                                     02550000
025600          INCLUDE TRECITM                                         02560000
025700     END-EXEC.                                                    02570000
025800*---------------------------------------------------------------* 02580000
025900*    DB2 AREA FOR THE RECEIVER STORE DISTRIBUTION               * 02590000
026000*---------------------------------------------------------------* 02600000
026100     EXEC SQL                                                     02610000
026200          INCLUDE TRECDIS                                         02620000
026300     END-EXEC.                                                    02630000
026400*---------------------------------------------------------------* 02640000
026500*    DB2 AREA FOR THE PO ITEM TABLE                             * 02650000
026600*---------------------------------------------------------------* 02660000
026700     EXEC SQL                                                     02670000
026800          INCLUDE TPURITM                                         02680000
026900     END-EXEC.                                                    02690000
027000*---------------------------------------------------------------* 02700000
027100*    DB2 AREA FOR THE PO PREPK  TABLE                           * 02710000
027200*---------------------------------------------------------------* 02720000
027300     EXEC SQL                                                     02730000
027400          INCLUDE TPOPRPK                                         02740000
027500     END-EXEC.                                                    02750000
027600*---------------------------------------------------------------* 02760000
027700*    DB2 AREA FOR THE DISTRIBUTION HEADER TABLE                 * 02770000
027800*---------------------------------------------------------------* 02780000
027900     EXEC SQL                                                     02790000
028000          INCLUDE TDISTHD                                         02800000
028100     END-EXEC.                                                    02810000
028200*---------------------------------------------------------------* 02820000
028300*    DB2 AREA FOR THE SHIPMENT TABLE                            * 02830000
028400*---------------------------------------------------------------* 02840000
028500     EXEC SQL                                                     02850000
028600         INCLUDE TSHIPMT                                          02860000
028700     END-EXEC.                                                    02870000
028800*---------------------------------------------------------------* 02880000
028900*    DB2 AREA FOR THE RECEIVER TABLE                            * 02890000
029000*---------------------------------------------------------------* 02900000
029100     EXEC SQL                                                     02910000
029200         INCLUDE TRECEIV                                          02920000
029300     END-EXEC.                                                    02930000
029400*---------------------------------------------------------------* 02940000
029500*    DB2 AREA FOR THE WST_SHPMT_XREF_HDR                        * 02950000
029600*---------------------------------------------------------------* 02960000
029700     EXEC SQL                                                     02970000
029800         INCLUDE WST00001                                         02980000
029900     END-EXEC.                                                    02990000
030000******************************************************************03000000
030100*  DB2 TABLE DECLARATION - WMS ATTRIBUTE DEFINTION                03010000
030200*      (WST_ATTR_DEFN)                                            03020000
030300******************************************************************03030000
030400     EXEC SQL                                                     03040000
030500          INCLUDE WST00009                                        03050000
030600     END-EXEC.                                                    03060000
030700                                                                  03070000
030800******************************************************************03080000
030900*  DB2 TABLE DECLARATION - WMS ATTRIBUTE ELEMENT                  03090000
031000*      (WST_ATTR_ELEM)                                            03100000
031100******************************************************************03110000
031200     EXEC SQL                                                     03120000
031300          INCLUDE WST00010                                        03130000
031400     END-EXEC.                                                    03140000
031500                                                                  03150000
031600******************************************************************03160000
031700*  DB2 TABLE DECLARATION -                                        03170000
031800*      (WST_INTGRTN_TYP)                                          03180000
031900******************************************************************03190000
032000     EXEC SQL                                                     03200000
032100          INCLUDE WST00008                                        03210000
032200     END-EXEC.                                                    03220000
032300                                                                  03230000
032400******************************************************************03240000
032500*  DB2 TABLE DECLARATION -                                        03250000
032600*      (XLV_SKU)                                                  03260000
032700******************************************************************03270000
032800     EXEC SQL                                                     03280000
032900          INCLUDE XLV00000                                        03290000
033000     END-EXEC.                                                    03300000
033100                                                                  03310000
033200******************************************************************03320000
033300*  DB2 TABLE DECLARATION -                                        03330000
033400*      (XLV_UPC)                                                  03340000
033500******************************************************************03350000
033600     EXEC SQL                                                     03360000
033700          INCLUDE XLV00003                                        03370000
033800     END-EXEC.                                                    03380000
033900                                                                  03390000
034000*----------------------------------------------------------------*03400000
034100*  COMMUNICATIONS AREA FOR DB2                                   *03410000
034200*----------------------------------------------------------------*03420000
034300     EXEC SQL                                                     03430000
034400         INCLUDE SQLCA                                            03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700                                                                  03470000
034800*-----------------------------------------------------------------03480000
034900*-----------------------------------------------------------------03490000
035000*  CARTON UPDATE CURSOR                                           03500000
035100*  CURSOR TO RETURN OTBND CARTONS THAT HAVE ZERO LINE NUMBERS     03510000
035200*-----------------------------------------------------------------03520000
035300     EXEC SQL                                                     03530000
035400       DECLARE ZERO-LINE-CRTN CURSOR FOR                          03540000
035500           SELECT DISTINCT                                        03550000
035600                C.PO_NBR                                          03560000
035700              , E.SHIPT_UNT_ID                                    03570000
035800          FROM  TVHTRIP A                                         03580000
035900              , TSHIPMT B                                         03590000
036000              , TSHPTPO C                                         03600000
036100              , TRECEIV D                                         03610000
036200              , SUT_OTBND_UPC E                                   03620000
036300          WHERE A.TRIP_ID           = :VHTRIP-TRIP-ID             03630000
036400            AND A.TRIP_ID           = B.TRIP_ID                   03640000
036500            AND C.SHIPT_ID          = B.SHIPT_ID                  03650000
036600            AND C.PO_NBR          = D.ORD_NBR                     03660000
036700            AND C.REC_SEQ_NBR     = D.REC_SEQ_NBR                 03670000
036800            AND C.PO_NBR          = E.TRN_NBR                     03680000
036900            AND C.REC_SEQ_NBR     = E.RCVR_SEQ_NBR                03690000
037000            AND E.TRN_LNE_NBR     = 0                             03700000
037100            AND D.VER_STATUS_CDE  = 'A'                           03710000
037200     END-EXEC.                                                    03720000
037300                                                                  03730000
037400*-----------------------------------------------------------------03740000
037500*-----------------------------------------------------------------03750000
037600*  RETURN PO/RCVR/LINES ON TRIP AND CALL VERIFICATION MODULE      03760000
037700*-----------------------------------------------------------------03770000
037800     EXEC SQL                                                     03780000
037900       DECLARE VERIF-LINE-CSR  CURSOR FOR                         03790000
038000           SELECT DISTINCT                                        03800000
038100                E.ORD_NBR                                         03810000
038200              , E.REC_SEQ_NBR                                     03820000
038300              , E.ORD_LNE_NBR                                     03830000
038400              , D.PKGNG_CDE                                       03840000
038500              , F.PREPK_DRV_LNE_CDE                               03850000
038600             , F.PREPK_ID                                         03860000
038700          FROM  TVHTRIP A                                         03870000
038800              , TSHIPMT B                                         03880000
038900              , TSHPTPO C                                         03890000
039000              , TRECEIV D                                         03900000
039100              , TRECDIS E                                         03910000
039200              , TRECITM F                                         03920000
039300          WHERE A.TRIP_ID         = :VHTRIP-TRIP-ID               03930000
039400            AND A.TRIP_ID         = B.TRIP_ID                     03940000
039500            AND C.SHIPT_ID        = B.SHIPT_ID                    03950000
039600            AND C.PO_NBR          = D.ORD_NBR                     03960000
039700            AND C.REC_SEQ_NBR     = D.REC_SEQ_NBR                 03970000
039800            AND C.PO_NBR          = F.ORD_NBR                     03980000
039900            AND C.REC_SEQ_NBR     = F.REC_SEQ_NBR                 03990000
040000            AND C.PO_NBR          = E.ORD_NBR                     04000000
040100            AND C.REC_SEQ_NBR     = E.REC_SEQ_NBR                 04010000
040200            AND E.ORD_LNE_NBR     = F.ORD_LNE_NBR                 04020000
040300            AND D.VER_STATUS_CDE  = 'A'                           04030000
040400            AND D.STATUS_CDE      <>  'VE'                        04040000
040500         GROUP BY                                                 04050000
040600                E.ORD_LNE_NBR                                     04060000
040700              , E.ORD_NBR                                         04070000
040800              , E.REC_SEQ_NBR                                     04080000
040900              , D.PKGNG_CDE                                       04090000
041000              ,F.PREPK_DRV_LNE_CDE                                04100000
041100              ,F.PREPK_ID                                         04110000
041200        ORDER BY E.ORD_NBR                                        04120000
041300              ,  E.REC_SEQ_NBR                                    04130000
041400              ,  F.PREPK_ID                                       04140000
041500              ,  F.PREPK_DRV_LNE_CDE                              04150000
041600              ,  E.ORD_LNE_NBR                                    04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900*-----------------------------------------------------------------04190000
042000*-----------------------------------------------------------------04200000
042100*  CURSOR TO DETERMINE PACK ID MATCHING THE RECEIVER ITEM DATA TO 04210000
042200*  THE OTBND CARTON ITEMS                                         04220000
042300*-----------------------------------------------------------------04230000
042400     EXEC SQL                                                     04240000
042500       DECLARE PREPK-RCVR-ITM-CSR CURSOR FOR                      04250000
042600         SELECT 'A'                                               04260000
042700               , A.ORD_LNE_NBR                                    04270000
042800               , A.PREPK_ID                                       04280000
042900               , A.PREPK_RATO_QTY                                 04290000
043000               , A.PREPK_RATO_QTY/A.PREPK_RATO_QTY                04300000
043100          FROM TRECITM A                                          04310000
043200         WHERE A.ORD_NBR         = :DK-PO-NBR                     04320000
043300             AND A.VER_STATUS_CDE  = 'A'                          04330000
043400             AND A.PREPK_ID        > 0                            04340000
043500       UNION                                                      04350000
043600         SELECT 'B'                                               04360000
043700               , A.ORD_LNE_NBR                                    04370000
043800               , A.PREPK_ID                                       04380000
043900               , D.SHPD_UNT_QTY                                   04390000
044000               , D.SHPD_UNT_QTY/A.PREPK_RATO_QTY                  04400000
044100          FROM TRECITM A                                          04410000
044200             , XLV_SKU B                                          04420000
044300             , XLV_UPC C                                          04430000
044400             , SUT_OTBND_UPC D                                    04440000
044500         WHERE A.ORD_NBR           = :DK-PO-NBR                   04450000
044600             AND A.ITM_NBR         = B.ITM_NBR                    04460000
044700             AND A.VER_STATUS_CDE  = 'A'                          04470000
044800             AND A.PREPK_ID        > 0                            04480000
044900             AND A.ORD_NBR         = D.TRN_NBR                    04490000
045000             AND B.INTR_UPC_ID     = C.INTR_UPC_ID                04500000
045100             AND C.UPC_NBR         = D.UPC_NBR                    04510000
045200             AND D.SHIPT_UNT_ID    = :SUT00028-SHIPT-UNT-ID       04520000
045300          ORDER BY 3,2,1                                          04530000
045400     END-EXEC.                                                    04540000
045500                                                                  04550000
045600*-----------------------------------------------------------------04560000
045700*  CURSOR TO DETERMINE PACK ID MATCHING THE PURCHASE ORDER DATA TO04570000
045800*  THE OTBND CARTON ITEMS                                         04580000
045900*-----------------------------------------------------------------04590000
046000     EXEC SQL                                                     04600000
046100       DECLARE PREPK-PO-ITM-CSR CURSOR FOR                        04610000
046200         SELECT 'A'                                               04620000
046300               , A.APP_PO_LNE_NBR                                 04630000
046400               , A.PO_PREPK_ID                                    04640000
046500               , A.PREPK_RATO_QTY                                 04650000
046600               , A.PREPK_RATO_QTY/A.PREPK_RATO_QTY                04660000
046700          FROM  TPURITM A                                         04670000
046800         WHERE A.PO_NBR          = :DK-PO-NBR                     04680000
046900             AND A.VER_STATUS_CDE  = 'A'                          04690000
047000       UNION                                                      04700000
047100         SELECT 'B'                                               04710000
047200               , A.APP_PO_LNE_NBR                                 04720000
047300               , A.PO_PREPK_ID                                    04730000
047400               , D.SHPD_UNT_QTY                                   04740000
047500               , D.SHPD_UNT_QTY/A.PREPK_RATO_QTY                  04750000
047600          FROM TPURITM A                                          04760000
047700             , XLV_SKU B                                          04770000
047800             , XLV_UPC C                                          04780000
047900             , SUT_OTBND_UPC D                                    04790000
048000         WHERE A.PO_NBR            = :DK-PO-NBR                   04800000
048100             AND A.ITM_NBR         = B.ITM_NBR                    04810000
048200             AND A.VER_STATUS_CDE  = 'A'                          04820000
048300             AND A.PO_NBR          = D.TRN_NBR                    04830000
048400             AND B.INTR_UPC_ID     = C.INTR_UPC_ID                04840000
048500             AND C.UPC_NBR         = D.UPC_NBR                    04850000
048600             AND D.SHIPT_UNT_ID    = :SUT00028-SHIPT-UNT-ID       04860000
048700          ORDER BY 3,2,1                                          04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000                                                                  04900000
049100*-----------------------------------------------------------------04910000
049200*  CURSOR TO SELECT ROWS FROM OTBND CARTON TO UPDATE WITH THE     04920000
049300*  CORRECT LINE NUMBER                                            04930000
049400*-----------------------------------------------------------------04940000
049500     EXEC SQL                                                     04950000
049600       DECLARE CRTN-UPC-CSR CURSOR FOR                            04960000
049700         SELECT  DISTINCT                                         04970000
049800                 A.ORD_LNE_NBR                                    04980000
049900             ,   C.UPC_NBR                                        04990000
050000             ,   D.RCVR_SEQ_NBR                                   05000000
050100          FROM TRECITM A                                          05010000
050200             , XLV_SKU B                                          05020000
050300             , XLV_UPC C                                          05030000
050400             , SUT_OTBND_UPC D                                    05040000
050500         WHERE A.ORD_NBR           = :DK-PO-NBR                   05050000
050600             AND A.ITM_NBR         = B.ITM_NBR                    05060000
050700             AND A.VER_STATUS_CDE  = 'A'                          05070000
050800             AND A.ORD_NBR         = D.TRN_NBR                    05080000
050900             AND B.INTR_UPC_ID     = C.INTR_UPC_ID                05090000
051000             AND C.UPC_NBR         = D.UPC_NBR                    05100000
051100             AND A.PREPK_ID        = :DK-PREPK-ID                 05110000
051200             AND D.SHIPT_UNT_ID    = :SUT00028-SHIPT-UNT-ID       05120000
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500                                                                  05150000
051600*-----------------------------------------------------------------05160000
051700*  CURSOR TO ADD PACK TO TRECITM AND TRECDIS TO RECEIVER          05170000
051800*-----------------------------------------------------------------05180000
051900     EXEC SQL                                                     05190000
052000       DECLARE PURITM-PACK-CSR CURSOR FOR                         05200000
052100         SELECT  PO_NBR                                           05210000
052200               , APP_PO_LNE_NBR                                   05220000
052300               , VER_NBR                                          05230000
052400               , A.ITM_NBR                                        05240000
052500               , UNT_RTL_PR_AMT                                   05250000
052600               , UNT_COST_AMT                                     05260000
052700               , GP_RTL_AMT                                       05270000
052800               , GP_QTY                                           05280000
052900               , SHPD_UNT_QTY                                     05290000
053000               , PREPK_RATO_QTY                                   05300000
053100          FROM TPURITM A                                          05310000
053200             , XLV_SKU B                                          05320000
053300             , XLV_UPC C                                          05330000
053400             , SUT_OTBND_UPC D                                    05340000
053500         WHERE A.PO_NBR            = :DK-PO-NBR                   05350000
053600             AND A.ITM_NBR         = B.ITM_NBR                    05360000
053700             AND A.VER_STATUS_CDE  = 'A'                          05370000
053800             AND A.PO_NBR          = D.TRN_NBR                    05380000
053900             AND B.INTR_UPC_ID     = C.INTR_UPC_ID                05390000
054000             AND C.UPC_NBR         = D.UPC_NBR                    05400000
054100             AND A.PO_PREPK_ID     = :DK-PREPK-ID                 05410000
054200             AND D.SHIPT_UNT_ID    = :SUT00028-SHIPT-UNT-ID       05420000
054300          ORDER BY A.APP_PO_LNE_NBR                               05430000
054400     END-EXEC.                                                    05440000
054500                                                                  05450000
054600                                                                  05460000
054700*-----------------------------------------------------------------05470000
054800*  CURSOR TO CREATE SUT_OTBND_PK DATA                             05480000
054900*-----------------------------------------------------------------05490000
055000     EXEC SQL                                                     05500000
055100       DECLARE OTBND-PACK-CSR CURSOR WITH HOLD FOR                05510000
055200           SELECT DISTINCT                                        05520000
055300                E.SHIPT_UNT_ID                                    05530000
055400              , E.TRN_NBR                                         05540000
055500              , E.RCVR_SEQ_NBR                                    05550000
055600              , E.SHPD_UNT_QTY                                    05560000
055700              , F.PREPK_RATO_QTY                                  05570000
055800             , F.PREPK_ID                                         05580000
055900          FROM  TVHTRIP A                                         05590000
056000              , TSHIPMT B                                         05600000
056100              , TSHPTPO C                                         05610000
056200              , TRECEIV D                                         05620000
056300              , SUT_OTBND_UPC E                                   05630000
056400              , TRECITM F                                         05640000
056500          WHERE A.TRIP_ID         = :VHTRIP-TRIP-ID               05650000
056600            AND A.TRIP_ID         = B.TRIP_ID                     05660000
056700            AND C.SHIPT_ID        = B.SHIPT_ID                    05670000
056800            AND C.PO_NBR          = D.ORD_NBR                     05680000
056900            AND C.REC_SEQ_NBR     = D.REC_SEQ_NBR                 05690000
057000            AND C.PO_NBR          = F.ORD_NBR                     05700000
057100            AND C.REC_SEQ_NBR     = F.REC_SEQ_NBR                 05710000
057200            AND C.PO_NBR          = E.TRN_NBR                     05720000
057300            AND C.REC_SEQ_NBR     = E.RCVR_SEQ_NBR                05730000
057400            AND E.TRN_LNE_NBR     = F.ORD_LNE_NBR                 05740000
057500            AND D.STATUS_CDE      <>  'VE'                        05750000
057600            AND D.PKGNG_CDE     IN ('M' , 'I')                    05760000
057700            AND F.PREPK_DRV_LNE_CDE = 'A'                         05770000
057800            AND D.VER_STATUS_CDE  = 'A'                           05780000
057900     END-EXEC.                                                    05790000
058000                                                                  05800000
058100******************************************************************05810000
058200 LINKAGE SECTION.                                                 05820000
058300******************************************************************05830000
058400 01  DFHCOMMAREA.                                                 05840000
058500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05850000
058600                                      DEPENDING ON EIBCALEN.      05860000
058700         10  FILLER                   PIC X.                      05870000
058800                                                                  05880000
058900******************************************************************05890000
059000 PROCEDURE DIVISION.                                              05900000
059100******************************************************************05910000
059200 0000-PROGRAM-MAINLINE.                                           05920000
059300     INITIALIZE                        WS007-RECEIPT-PIX-RECORD.  05930000
059400     MOVE DFHCOMMAREA              TO  WS007-RECEIPT-PIX-RECORD.  05940000
059500     MOVE WS007-WSRD014-RECORD     TO WS014-RECEIPT-PIX-RECORD.   05950000
059600                                                                  05960000
059700     MOVE WS007-CALLING-PROGRAM-NAME TO                           05970000
059800                                      PV-CALLING-PGM.             05980000
059900     MOVE SPACES                   TO PV-CICS-MSG-AREA.           05990000
060000     INITIALIZE PT-MSG-TABLE.                                     06000000
060100     MOVE 1                        TO PT-MSG-SEQ (PT-MSG-IDX).    06010000
060200     MOVE WS014-DC-LOCATION        TO DK-OPER-UNT-ID.             06020000
060300                                                                  06030000
060400     PERFORM 8000-CHECK-FOR-LOGGING.                              06040000
060500     IF PS-SHOW-DEBUG-INFO                                        06050000
060600         MOVE WS014-ORIG-SHIPMT-NBR  TO PV-DISPLAY-SHIPMT-NBR     06060000
060700         STRING   ' ' WS007-SRC-TASK-NUMBER                       06070000
060800                  ' WSKCS310 PROGRAM STARTED -'                   06080000
060900                  ' CALLED BY-'                                   06090000
061000                  PV-CALLING-PGM                                  06100000
061100                  ' SHIPMT NBR '                                  06110000
061200                  PV-DISPLAY-SHIPMT-NBR                           06120000
061300                  DELIMITED BY SIZE                               06130000
061400                                  INTO PV-CICS-MSG-AREA           06140000
061500         PERFORM 9990-WRITE-CICS                                  06150000
061600     END-IF.                                                      06160000
061700                                                                  06170000
061800     MOVE WS014-ORIG-SHIPMT-NBR    TO WST00001-EXT-SHP-ID.        06180000
061900                                                                  06190000
062000     PERFORM 1000-SELECT-TRIP.                                    06200000
062100** IF DUMMY SHIPMENT DO NOT VERIFY RECEIVERS                      06210000
062200** GB 6/1/07                                                      06220000
062300     IF WST00001-DMY-SEQ-NBR > 0                                  06230000
062400        CONTINUE                                                  06240000
062500     ELSE                                                         06250000
062600* JAK 08/2007 - ONLY DO PARAGRAPH 2000 IF THERE ARE NO ERRORS     06260000
062700****   PERFORM 2000-PROCESS-LINE-UPDATES                          06270000
062800       IF WS007-SUCCESSFUL                                        06280000
062900          PERFORM 2000-PROCESS-LINE-UPDATES                       06290000
063000       END-IF                                                     06300000
063100                                                                  06310000
063200       IF WS007-SUCCESSFUL                                        06320000
063300          PERFORM 6000-PROCESS-OTBND-PACK-CSR                     06330000
063400       END-IF                                                     06340000
063500                                                                  06350000
063600       IF WS007-SUCCESSFUL                                        06360000
063700          PERFORM 6600-PROCESS-VERIF                              06370000
063800       END-IF                                                     06380000
063900     END-IF.                                                      06390000
064000                                                                  06400000
064100     MOVE WS014-RECEIPT-PIX-RECORD      TO WS007-WSRD014-RECORD.  06410000
064200     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           06420000
064300     GOBACK.                                                      06430000
064400                                                                  06440000
064500*                                                                 06450000
064600*----------------------------------------------------------------*06460000
064700*-----------------------------------------------------------------06470000
064800 1000-SELECT-TRIP.                                                06480000
064900     IF PS-SHOW-DEBUG-INFO                                        06490000
065000         STRING   ' ' WS007-SRC-TASK-NUMBER                       06500000
065100                ' WSKCS310-1000-SELECT-TRIP   '                   06510000
065200         DELIMITED BY SIZE                                        06520000
065300         INTO PV-CICS-MSG-AREA                                    06530000
065400         PERFORM 9990-WRITE-CICS                                  06540000
065500         MOVE WS014-RECEIPT-PIX-RECORD                            06550000
065600           TO PV-CICS-MSG-AREA                                    06560000
065700         PERFORM 9990-WRITE-CICS                                  06570000
065800     END-IF.                                                      06580000
065900                                                                  06590000
066000                                                                  06600000
066100     EXEC SQL                                                     06610000
066200         SELECT  DISTINCT                                         06620000
066300                 INTR_TRIP_ID                                     06630000
066400              ,  DMY_SEQ_NBR                                      06640000
066500          INTO :WST00001-INTR-TRIP-ID                             06650000
066600            ,  :WST00001-DMY-SEQ-NBR                              06660000
066700           FROM WST_SHPMT_XREF_HDR                                06670000
066800          WHERE EXT_SHP_ID         =  :WST00001-EXT-SHP-ID        06680000
066900     END-EXEC.                                                    06690000
067000                                                                  06700000
067100     EVALUATE TRUE                                                06710000
067200         WHEN SQLCODE = ZERO                                      06720000
067300             MOVE WST00001-INTR-TRIP-ID  TO VHTRIP-TRIP-ID        06730000
067400         WHEN SQLWARN0 NOT = SPACES                               06740000
067500         WHEN SQLCODE NOT EQUAL ZERO                              06750000
067600             MOVE '1000-SELECT-TRIP  '                            06760000
067700                             TO DP013-PARAGRAPH                   06770000
067800             MOVE 'WSKCS310 - SELECT TRIP FROM SHIPMT '           06780000
067900                             TO DP013-MESSAGE-TEXT(1)             06790000
068000             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   06800000
068100             MOVE WST00001-EXT-SHP-ID TO                          06810000
068200                          PV-DISPLAY-SHIPMT-NBR                   06820000
068300             STRING 'WSKCS310- '       DELIMITED BY SIZE          06830000
068400                    'SQLCODE '         DELIMITED BY SIZE          06840000
068500               PV-DISPLAY-SQLCODE      DELIMITED BY SIZE          06850000
068600                    'SHIPMT '          DELIMITED BY SIZE          06860000
068700               PV-DISPLAY-SHIPMT-NBR   DELIMITED BY SIZE          06870000
068800                           INTO DP013-MESSAGE-TEXT(2)             06880000
068900             MOVE SQLCA      TO DP013-SQLCA                       06890000
069000             MOVE 'WST_SHPMT_XREF_HDR'                            06900000
069100                             TO DP013-DB2-TABLE-NAME(1)           06910000
069200             SET DP013-DB2-ABEND                                  06920000
069300                             TO TRUE                              06930000
069400             SET DP013-ROLLBACK                                   06940000
069500                             TO TRUE                              06950000
069600             PERFORM 9999-WRITE-CICS-LOG-MSG                      06960000
069700             SET PS-DUMP-TO-LOG       TO TRUE                     06970000
069800             SET WS007-INVALID-SQL TO TRUE                        06980000
069900* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         06990000
070000             MOVE SQLCODE TO WS007-SQLCODE                        07000000
070100             MOVE '1000-SELECT-TRIP' TO WS007-SQL-ERROR-PARA      07010000
070200     END-EVALUATE.                                                07020000
070300                                                                  07030000
070400 2000-PROCESS-LINE-UPDATES.                                       07040000
070500     IF PS-SHOW-DEBUG-INFO                                        07050000
070600         STRING   ' ' WS007-SRC-TASK-NUMBER                       07060000
070700                ' WSKCS310:2000-PROCESS-LINE-UPDATES  '           07070000
070800         DELIMITED BY SIZE                                        07080000
070900         INTO PV-CICS-MSG-AREA                                    07090000
071000         PERFORM 9990-WRITE-CICS                                  07100000
071100     END-IF.                                                      07110000
071200     SET WS007-SUCCESSFUL     TO TRUE.                            07120000
071300                                                                  07130000
071400*-----------------------------------------------------------------07140000
071500*  OPEN CURSOR TO RETURN CARTONS THAT HAVE A ZERO LINE NUMBER    -07150000
071600*-----------------------------------------------------------------07160000
071700     SET PS-NOT-END-OF-ZERO-LINE-CRTN  TO TRUE.                   07170000
071800     PERFORM 2100-OPEN-ZERO-LINE-CRTN                             07180000
071900                                                                  07190000
072000     PERFORM UNTIL PS-END-OF-ZERO-LINE-CRTN OR                    07200000
072100             NOT WS007-SUCCESSFUL                                 07210000
072200     PERFORM 2200-FETCH-ZERO-LINE-CRTN                            07220000
072300*-----------------------------------------------------------------07230000
072400*  OPEN CURSOR TO COMPARE CRTN ITEMS W/RECITMS TO DETERMINE PCK ID07240000
072500*-----------------------------------------------------------------07250000
072600     IF PS-ZERO-LINE-FOUND-YES                                    07260000
072700        SET PS-NOT-EO-PREPK-RCVR-ITM-CSR TO TRUE                  07270000
072800        PERFORM 3000-PROCESS-RCVR-ITM-CSR                         07280000
072900                                                                  07290000
073000*-----------------------------------------------------------------07300000
073100*  PACK ID FOUND -  PROCESS UPDATE OF OTBND CRTN UPC LINES        07310000
073200*  OTHERWISE CHECK CARTONS ITEMS AGAINST PURCHASE ORDER FOR PCK ID07320000
073300*  THEN UPDATE THE CRTN UPC LINES                                 07330000
073400*-----------------------------------------------------------------07340000
073500       IF PS-PREPK-ID-MATCH                                       07350000
073600          SET PS-NOT-END-OF-CRTN-UPC-CSR                          07360000
073700              PS-PO-ITEM-PROCESS-UPD-NO                           07370000
073800              PS-FIRST-PREPK-FETCH-NO    TO TRUE                  07380000
073900          MOVE PV-USE-PACK-ID TO DK-PREPK-ID                      07390000
074000          PERFORM 5000-PROCESS-CRTN-UPC-CSR                       07400000
074100       ELSE                                                       07410000
074200          PERFORM 4000-PROCESS-PREPK-PO-ITM-CSR                   07420000
074300          IF PS-PREPK-ID-MATCH                                    07430000
074400             SET PS-NOT-END-OF-PREPK-PO-ITM-CSR                   07440000
074500                 PS-FIRST-PREPK-FETCH-NO    TO TRUE               07450000
074600             MOVE PV-USE-PACK-ID TO DK-PREPK-ID                   07460000
074700             PERFORM 5000-PROCESS-CRTN-UPC-CSR                    07470000
074800          END-IF                                                  07480000
074900       END-IF                                                     07490000
075000                                                                  07500000
075100     END-IF                                                       07510000
075200     END-PERFORM.                                                 07520000
075300                                                                  07530000
075400     PERFORM 2300-CLOSE-ZERO-LINE-CRTN.                           07540000
075500                                                                  07550000
075600 2100-OPEN-ZERO-LINE-CRTN.                                        07560000
075700     IF PS-SHOW-DEBUG-INFO                                        07570000
075800         STRING   ' ' WS007-SRC-TASK-NUMBER                       07580000
075900                ' WSKCS310:2100-OPEN-ZERO-LINE-CRTN '             07590000
076000         DELIMITED BY SIZE                                        07600000
076100         INTO PV-CICS-MSG-AREA                                    07610000
076200         PERFORM 9990-WRITE-CICS                                  07620000
076300     END-IF.                                                      07630000
076400                                                                  07640000
076500     EXEC SQL                                                     07650000
076600          OPEN ZERO-LINE-CRTN                                     07660000
076700     END-EXEC.                                                    07670000
076800                                                                  07680000
076900     EVALUATE TRUE                                                07690000
077000         WHEN SQLCODE = ZERO                                      07700000
077100              CONTINUE                                            07710000
077200         WHEN SQLWARN0 NOT = SPACES                               07720000
077300         WHEN SQLCODE  < ZERO                                     07730000
077400         WHEN SQLCODE  > ZERO                                     07740000
077500             MOVE SQLCODE  TO PV-DISPLAY-SQLCODE                  07750000
077600             MOVE '2100-OPEN-ZERO-LINE-CRTN '                     07760000
077700                             TO DP013-PARAGRAPH                   07770000
077800             MOVE 'WSKCS310 - OPEN-ZERO-LINE-CRTN '               07780000
077900                             TO DP013-MESSAGE-TEXT(1)             07790000
078000             MOVE VHTRIP-TRIP-ID TO PV-DISPLAY-TRIP-ID            07800000
078100             STRING 'TRIP ID:'         DELIMITED BY SIZE          07810000
078200                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          07820000
078300                           INTO DP013-MESSAGE-TEXT(2)             07830000
078400             MOVE SQLCA      TO DP013-SQLCA                       07840000
078500             MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME(1)           07850000
078600             MOVE 'TRECEIV '      TO DP013-DB2-TABLE-NAME(1)      07860000
078700             SET DP013-DB2-ABEND                                  07870000
078800                             TO TRUE                              07880000
078900             SET DP013-ROLLBACK                                   07890000
079000                             TO TRUE                              07900000
079100             PERFORM 9999-WRITE-CICS-LOG-MSG                      07910000
079200             SET PS-DUMP-TO-LOG       TO TRUE                     07920000
079300             SET WS007-INVALID-SQL    TO TRUE                     07930000
079400* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         07940000
079500             MOVE SQLCODE             TO WS007-SQLCODE            07950000
079600             MOVE '2100-OPEN-ZERO-LINE-CRTN'                      07960000
079700                                      TO WS007-SQL-ERROR-PARA     07970000
079800     END-EVALUATE.                                                07980000
079900                                                                  07990000
080000 EJECT                                                            08000000
080100                                                                  08010000
080200                                                                  08020000
080300 2200-FETCH-ZERO-LINE-CRTN.                                       08030000
080400     IF PS-SHOW-DEBUG-INFO                                        08040000
080500         STRING   ' ' WS007-SRC-TASK-NUMBER                       08050000
080600                ' WSKCS310:2200-FETCH-ZERO-LINE-CRTN '            08060000
080700         DELIMITED BY SIZE                                        08070000
080800         INTO PV-CICS-MSG-AREA                                    08080000
080900         PERFORM 9990-WRITE-CICS                                  08090000
081000     END-IF.                                                      08100000
081100                                                                  08110000
081200     EXEC SQL                                                     08120000
081300          FETCH ZERO-LINE-CRTN                                    08130000
081400           INTO :SHPTPO-PO-NBR                                    08140000
081500             ,  :SUT00028-SHIPT-UNT-ID                            08150000
081600     END-EXEC.                                                    08160000
081700                                                                  08170000
081800     EVALUATE TRUE                                                08180000
081900         WHEN SQLCODE = ZERO                                      08190000
082000              MOVE  SHPTPO-PO-NBR TO DK-PO-NBR                    08200000
082100              SET PS-ZERO-LINE-FOUND-YES   TO TRUE                08210000
082200         WHEN SQLCODE = +100                                      08220000
082300              SET PS-ZERO-LINE-FOUND-NO                           08230000
082400                  PS-END-OF-ZERO-LINE-CRTN TO TRUE                08240000
082500         WHEN SQLWARN0 NOT = SPACES                               08250000
082600         WHEN SQLCODE NOT EQUAL ZERO                              08260000
082700             MOVE SQLCODE  TO PV-DISPLAY-SQLCODE                  08270000
082800             MOVE '2200-FETCH-ZERO-LINE-CRTN '                    08280000
082900                             TO DP013-PARAGRAPH                   08290000
083000             MOVE 'WSKCS310 -FETCH-ZERO-LINE-CRTN '               08300000
083100                             TO DP013-MESSAGE-TEXT(1)             08310000
083200             MOVE VHTRIP-TRIP-ID TO PV-DISPLAY-TRIP-ID            08320000
083300             STRING 'TRIP ID:'         DELIMITED BY SIZE          08330000
083400                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          08340000
083500                           INTO DP013-MESSAGE-TEXT(2)             08350000
083600             MOVE SQLCA      TO DP013-SQLCA                       08360000
083700             MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME(1)           08370000
083800             MOVE 'TRECEIV '      TO DP013-DB2-TABLE-NAME(1)      08380000
083900             SET DP013-DB2-ABEND                                  08390000
084000                             TO TRUE                              08400000
084100             SET DP013-ROLLBACK                                   08410000
084200                             TO TRUE                              08420000
084300             PERFORM 9999-WRITE-CICS-LOG-MSG                      08430000
084400             SET PS-DUMP-TO-LOG       TO TRUE                     08440000
084500             SET WS007-INVALID-SQL TO TRUE                        08450000
084600* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         08460000
084700             MOVE SQLCODE             TO WS007-SQLCODE            08470000
084800             MOVE '2200-FETCH-ZERO-LINE-CRTN'                     08480000
084900                                      TO WS007-SQL-ERROR-PARA     08490000
085000     END-EVALUATE.                                                08500000
085100                                                                  08510000
085200*----------------------------------------------------------------*08520000
085300* CLOSE THE LINE STORE CURSOR                                  *  08530000
085400*----------------------------------------------------------------*08540000
085500 2300-CLOSE-ZERO-LINE-CRTN.                                       08550000
085600     IF PS-SHOW-DEBUG-INFO                                        08560000
085700         STRING   ' ' WS007-SRC-TASK-NUMBER                       08570000
085800                ' WSKCS310:2300-CLOSE-ZERO-LINE-CRTN '            08580000
085900         DELIMITED BY SIZE                                        08590000
086000         INTO PV-CICS-MSG-AREA                                    08600000
086100         PERFORM 9990-WRITE-CICS                                  08610000
086200     END-IF.                                                      08620000
086300                                                                  08630000
086400     EXEC SQL                                                     08640000
086500          CLOSE ZERO-LINE-CRTN                                    08650000
086600     END-EXEC.                                                    08660000
086700                                                                  08670000
086800     EVALUATE TRUE                                                08680000
086900         WHEN SQLCODE = ZERO                                      08690000
087000              CONTINUE                                            08700000
087100         WHEN SQLWARN0 NOT = SPACES                               08710000
087200         WHEN SQLCODE  < ZERO                                     08720000
087300         WHEN SQLCODE  > ZERO                                     08730000
087400             MOVE '2300-CLOSE-ZERO-LINE-CRTN '                    08740000
087500                             TO DP013-PARAGRAPH                   08750000
087600             MOVE 'WSKCS310 -CLOSE-ZERO-LINE-CRTN '               08760000
087700                             TO DP013-MESSAGE-TEXT(1)             08770000
087800             MOVE VHTRIP-TRIP-ID TO PV-DISPLAY-TRIP-ID            08780000
087900             STRING 'TRIP ID:'         DELIMITED BY SIZE          08790000
088000                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          08800000
088100                           INTO DP013-MESSAGE-TEXT(2)             08810000
088200             MOVE SQLCA      TO DP013-SQLCA                       08820000
088300             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           08830000
088400             SET DP013-DB2-ABEND                                  08840000
088500                             TO TRUE                              08850000
088600             SET DP013-ROLLBACK                                   08860000
088700                             TO TRUE                              08870000
088800             PERFORM 9999-WRITE-CICS-LOG-MSG                      08880000
088900             SET PS-DUMP-TO-LOG       TO TRUE                     08890000
089000             SET WS007-INVALID-SQL TO TRUE                        08900000
089100* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         08910000
089200             MOVE SQLCODE             TO WS007-SQLCODE            08920000
089300             MOVE '2300-CLOSE-ZERO-LINE-CRTN'                     08930000
089400                                      TO WS007-SQL-ERROR-PARA     08940000
089500     END-EVALUATE.                                                08950000
089600                                                                  08960000
089700 3000-PROCESS-RCVR-ITM-CSR.                                       08970000
089710     IF PS-SHOW-DEBUG-INFO                                        08971001
089720         STRING   ' ' WS007-SRC-TASK-NUMBER                       08972001
089730                ' WSKCS310:3000-PROCESS-RCVR-ITM-CSR'             08973001
089740         DELIMITED BY SIZE                                        08974001
089750         INTO PV-CICS-MSG-AREA                                    08975001
089760         PERFORM 9990-WRITE-CICS                                  08976001
089770     END-IF.                                                      08977001
089780                                                                  08978001
089800                                                                  08980000
089900       PERFORM UNTIL PS-END-OF-PREPK-RCVR-ITM-CSR OR              08990000
090000                     NOT WS007-SUCCESSFUL                         09000000
090100          SET PS-FIRST-PREPK-FETCH       TO TRUE                  09010000
090200          MOVE SPACE TO PS-PREPK-ID-SEARCH-SW                     09020000
090300          INITIALIZE PV-HOLD-FIELDS                               09030000
090400          PERFORM 3100-OPEN-PREPK-RCVR-ITM-CSR                    09040000
090500          PERFORM 3200-FETCH-PREPK-RCVR-ITM-CSR                   09050000
090600                  UNTIL PS-END-OF-PREPK-RCVR-ITM-CSR OR           09060000
090700                        NOT WS007-SUCCESSFUL                      09070000
090800          PERFORM 3300-CLOSE-PREPK-RCVR-ITM-CSR                   09080000
090900       END-PERFORM.                                               09090000
091000                                                                  09100000
091100 3100-OPEN-PREPK-RCVR-ITM-CSR.                                    09110000
091200     IF PS-SHOW-DEBUG-INFO                                        09120000
091300         STRING   ' ' WS007-SRC-TASK-NUMBER                       09130000
091400                ' WSKCS310:3100-OPEN-PREPK-RCVR-ITM-CSR '         09140000
091500         DELIMITED BY SIZE                                        09150000
091600         INTO PV-CICS-MSG-AREA                                    09160000
091700         PERFORM 9990-WRITE-CICS                                  09170000
091800     END-IF.                                                      09180000
091900                                                                  09190000
092000     EXEC SQL                                                     09200000
092100          OPEN PREPK-RCVR-ITM-CSR                                 09210000
092200     END-EXEC.                                                    09220000
092300                                                                  09230000
092400     EVALUATE TRUE                                                09240000
092500         WHEN SQLCODE = ZERO                                      09250000
092600              CONTINUE                                            09260000
092700         WHEN SQLWARN0 NOT = SPACES                               09270000
092800         WHEN SQLCODE  < ZERO                                     09280000
092900         WHEN SQLCODE  > ZERO                                     09290000
093000             MOVE '3100-OPEN-PREPK-RCVR-ITM-CSR '                 09300000
093100                             TO DP013-PARAGRAPH                   09310000
093200             MOVE 'WSKCS310 - OPEN-PBS-VERF-CRTN-CSR'             09320000
093300                             TO DP013-MESSAGE-TEXT(1)             09330000
093400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 09340000
093500             MOVE SUT00028-SHIPT-UNT-ID  TO PV-DISPLAY-CARTON     09350000
093600             STRING 'PO NBR: '         DELIMITED BY SIZE          09360000
093700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          09370000
093800                  'CARTON ID '         DELIMITED BY SIZE          09380000
093900                 PV-DISPLAY-CARTON     DELIMITED BY SIZE          09390000
094000                           INTO DP013-MESSAGE-TEXT(2)             09400000
094100             MOVE SQLCA      TO DP013-SQLCA                       09410000
094200             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           09420000
094300             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(2)      09430000
094400             SET DP013-DB2-ABEND                                  09440000
094500                             TO TRUE                              09450000
094600             SET DP013-ROLLBACK                                   09460000
094700                             TO TRUE                              09470000
094800             PERFORM 9999-WRITE-CICS-LOG-MSG                      09480000
094900             SET PS-DUMP-TO-LOG       TO TRUE                     09490000
095000             SET WS007-INVALID-SQL TO TRUE                        09500000
095100* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         09510000
095200             MOVE SQLCODE             TO WS007-SQLCODE            09520000
095300             MOVE '3100-OPEN-PREPK-RCVR-ITM-CSR'                  09530000
095400                                      TO WS007-SQL-ERROR-PARA     09540000
095500     END-EVALUATE.                                                09550000
095600                                                                  09560000
095700 EJECT                                                            09570000
095800                                                                  09580000
095900                                                                  09590000
096000 3200-FETCH-PREPK-RCVR-ITM-CSR.                                   09600000
096100                                                                  09610000
096200     IF PS-SHOW-DEBUG-INFO                                        09620000
096300         STRING   ' ' WS007-SRC-TASK-NUMBER                       09630000
096400                ' WSKCS310:3200-FETCH-PREPK-RCVR-ITM-CSR '        09640000
096500         DELIMITED BY SIZE                                        09650000
096600         INTO PV-CICS-MSG-AREA                                    09660000
096700         PERFORM 9990-WRITE-CICS                                  09670000
096800     END-IF.                                                      09680000
096900                                                                  09690000
097000     EXEC SQL                                                     09700000
097100          FETCH PREPK-RCVR-ITM-CSR                                09710000
097200           INTO :PV-UNION-TYPE                                    09720000
097300             ,  :RECITM-ORD-LNE-NBR                               09730000
097400             ,  :RECITM-PREPK-ID                                  09740000
097500             ,  :RECITM-PREPK-RATO-QTY                            09750000
097600             ,  :PV-PREPK-RATIO-CALC                              09760000
097700     END-EXEC.                                                    09770000
097800                                                                  09780000
097900     EVALUATE TRUE                                                09790000
098000         WHEN SQLCODE = ZERO                                      09800000
098100            MOVE PV-PREPK-RATIO-CALC TO PV-CURR-PREPK-RATIO-CALC  09810000
098200            PERFORM 3500-CHECK-FOR-PACK-ID                        09820000
098300         WHEN SQLCODE = +100                                      09830000
098400              SET PS-END-OF-PREPK-RCVR-ITM-CSR TO TRUE            09840000
098500         WHEN SQLWARN0 NOT = SPACES                               09850000
098600         WHEN SQLCODE NOT EQUAL ZERO                              09860000
098700             MOVE '3200-FETCH-PREPK-RCVR-ITM-CSR '                09870000
098800                             TO DP013-PARAGRAPH                   09880000
098900             MOVE 'WSKCS310 -FETCH-PREPK-RCVR-ITM-CSR '           09890000
099000                             TO DP013-MESSAGE-TEXT(1)             09900000
099100             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 09910000
099200             MOVE SUT00028-SHIPT-UNT-ID                           09920000
099300                                   TO PV-DISPLAY-CARTON           09930000
099400             STRING 'PO NBR: '         DELIMITED BY SIZE          09940000
099500                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          09950000
099600                    'CARTON ID '       DELIMITED BY SIZE          09960000
099700               PV-DISPLAY-CARTON       DELIMITED BY SIZE          09970000
099800                           INTO DP013-MESSAGE-TEXT(2)             09980000
099900             MOVE SQLCA      TO DP013-SQLCA                       09990000
100000             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           10000000
100100             SET DP013-DB2-ABEND                                  10010000
100200                             TO TRUE                              10020000
100300             SET DP013-ROLLBACK                                   10030000
100400                             TO TRUE                              10040000
100500             PERFORM 9999-WRITE-CICS-LOG-MSG                      10050000
100600             SET PS-DUMP-TO-LOG       TO TRUE                     10060000
100700             SET WS007-INVALID-SQL    TO TRUE                     10070000
100800* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         10080000
100900             MOVE SQLCODE             TO WS007-SQLCODE            10090000
101000             MOVE '3200-FETCH-PREPK-RCVR-ITM-CSR'                 10100000
101100                                      TO WS007-SQL-ERROR-PARA     10110000
101200     END-EVALUATE.                                                10120000
101300                                                                  10130000
101400*----------------------------------------------------------------*10140000
101500* CLOSE THE LINE STORE CURSOR                                  *  10150000
101600*----------------------------------------------------------------*10160000
101700 3300-CLOSE-PREPK-RCVR-ITM-CSR.                                   10170000
101800     IF PS-SHOW-DEBUG-INFO                                        10180000
101900         STRING   ' ' WS007-SRC-TASK-NUMBER                       10190000
102000                ' WSKCS310:3300-CLOSE-PREPK-RCVR-ITM-CSR '        10200000
102100         DELIMITED BY SIZE                                        10210000
102200         INTO PV-CICS-MSG-AREA                                    10220000
102300         PERFORM 9990-WRITE-CICS                                  10230000
102400     END-IF.                                                      10240000
102500                                                                  10250000
102600     EXEC SQL                                                     10260000
102700          CLOSE PREPK-RCVR-ITM-CSR                                10270000
102800     END-EXEC.                                                    10280000
102900                                                                  10290000
103000     EVALUATE TRUE                                                10300000
103100         WHEN SQLCODE = ZERO                                      10310000
103200              CONTINUE                                            10320000
103300         WHEN SQLWARN0 NOT = SPACES                               10330000
103400         WHEN SQLCODE  < ZERO                                     10340000
103500         WHEN SQLCODE  > ZERO                                     10350000
103600             MOVE '3300-CLOSE-PREPK-RCVR-ITM-CSR '                10360000
103700                             TO DP013-PARAGRAPH                   10370000
103800             MOVE 'WSKCS310 -CLOSE-PBS-VERF-CRTN-CSR'             10380000
103900                             TO DP013-MESSAGE-TEXT(1)             10390000
104000             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 10400000
104100             MOVE SUT00028-SHIPT-UNT-ID                           10410000
104200                                   TO PV-DISPLAY-CARTON           10420000
104300             STRING 'PO NBR: '         DELIMITED BY SIZE          10430000
104400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          10440000
104500                    'CARTON ID '       DELIMITED BY SIZE          10450000
104600               PV-DISPLAY-CARTON       DELIMITED BY SIZE          10460000
104700                           INTO DP013-MESSAGE-TEXT(2)             10470000
104800             MOVE SQLCA      TO DP013-SQLCA                       10480000
104900             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           10490000
105000             SET DP013-DB2-ABEND                                  10500000
105100                             TO TRUE                              10510000
105200             SET DP013-ROLLBACK                                   10520000
105300                             TO TRUE                              10530000
105400             PERFORM 9999-WRITE-CICS-LOG-MSG                      10540000
105500             SET PS-DUMP-TO-LOG       TO TRUE                     10550000
105600             SET WS007-INVALID-SQL TO TRUE                        10560000
105700* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         10570000
105800             MOVE SQLCODE             TO WS007-SQLCODE            10580000
105900             MOVE '3300-CLOSE-PREPK-RCVR-ITM-CSR'                 10590000
106000                                      TO WS007-SQL-ERROR-PARA     10600000
106100     END-EVALUATE.                                                10610000
106200                                                                  10620000
106300 3500-CHECK-FOR-PACK-ID.                                          10630000
106310     IF PS-SHOW-DEBUG-INFO                                        10631001
106320         STRING   ' ' WS007-SRC-TASK-NUMBER                       10632001
106330                ' WSKCS310:3500-CHECK-FOR-PACK-ID   '             10633001
106340         DELIMITED BY SIZE                                        10634001
106350         INTO PV-CICS-MSG-AREA                                    10635001
106360         PERFORM 9990-WRITE-CICS                                  10636001
106370     END-IF.                                                      10637001
106380                                                                  10638001
106400                                                                  10640000
106500                                                                  10650000
106600      IF RECITM-PREPK-ID = PV-HOLD-PREPK-ID                       10660000
106700         CONTINUE                                                 10670000
106800      ELSE                                                        10680000
106900        IF (NOT PS-PREPK-ID-MISMATCH)                             10690000
107000           IF PS-FIRST-PREPK-FETCH                                10700000
107100              CONTINUE                                            10710000
107200           ELSE                                                   10720000
107300              SET PS-PREPK-ID-MATCH TO TRUE                       10730000
107400           END-IF                                                 10740000
107500        ELSE                                                      10750000
107600           SET PS-FIRST-PREPK-FETCH TO TRUE                       10760000
107700        END-IF                                                    10770000
107800      END-IF                                                      10780000
107900                                                                  10790000
108000      IF (RECITM-PREPK-ID = PV-HOLD-PREPK-ID)                     10800000
108100         AND PS-PREPK-ID-MISMATCH                                 10810000
108200         CONTINUE                                                 10820000
108300      ELSE                                                        10830000
108400        IF PS-FIRST-PREPK-FETCH                                   10840000
108500           IF PV-UNION-TYPE = 'B'                                 10850000
108600              SET PS-PREPK-ID-MISMATCH  TO TRUE                   10860000
108700           ELSE                                                   10870000
108800              MOVE SPACE TO PS-PREPK-ID-SEARCH-SW                 10880000
108900           END-IF                                                 10890000
109000           SET PS-FIRST-PREPK-FETCH-NO TO TRUE                    10900000
109100           MOVE RECITM-PREPK-ID TO  PV-HOLD-PREPK-ID              10910000
109200           MOVE PV-UNION-TYPE   TO  PV-HOLD-UNION-TYPE            10920000
109300           MOVE RECITM-ORD-LNE-NBR TO  PV-HOLD-ORD-LNE-NBR        10930000
109400           MOVE PV-CURR-PREPK-RATIO-CALC                          10940000
109500                            TO PV-HOLD-PREPK-RATIO-CALC           10950000
109600        ELSE                                                      10960000
109700          IF PV-UNION-TYPE = PV-HOLD-UNION-TYPE                   10970000
109800              SET PS-PREPK-ID-MISMATCH  TO TRUE                   10980000
109900          ELSE                                                    10990000
110000             MOVE PV-UNION-TYPE TO PV-HOLD-UNION-TYPE             11000000
110100             IF RECITM-PREPK-ID = PV-HOLD-PREPK-ID                11010000
110200               IF (RECITM-ORD-LNE-NBR = PV-HOLD-ORD-LNE-NBR)      11020000
110300                   AND                                            11030000
110400                  (PV-CURR-PREPK-RATIO-CALC                       11040000
110500                                       = PV-HOLD-PREPK-RATIO-CALC)11050000
110600                  MOVE RECITM-ORD-LNE-NBR TO PV-HOLD-ORD-LNE-NBR  11060000
110700                  MOVE PV-CURR-PREPK-RATIO-CALC TO                11070000
110800                                PV-HOLD-PREPK-RATIO-CALC          11080000
110900               ELSE                                               11090000
111000                   IF PV-UNION-TYPE = 'A'                         11100000
111100                      MOVE RECITM-ORD-LNE-NBR TO                  11110000
111200                                               PV-HOLD-ORD-LNE-NBR11120000
111300                      MOVE PV-CURR-PREPK-RATIO-CALC TO            11130000
111400                                PV-HOLD-PREPK-RATIO-CALC          11140000
111500                   ELSE                                           11150000
111600                      SET PS-PREPK-ID-MISMATCH TO TRUE            11160000
111700                   END-IF                                         11170000
111800               END-IF                                             11180000
111900             ELSE                                                 11190000
112000               IF PS-PREPK-ID-MATCH                               11200000
112100                 SET PS-END-OF-PREPK-RCVR-ITM-CSR TO TRUE         11210000
112200                 MOVE PV-HOLD-PREPK-ID TO PV-USE-PACK-ID          11220000
112300               ELSE                                               11230000
112400                 IF PV-UNION-TYPE = 'A'                           11240000
112500                   MOVE RECITM-PREPK-ID TO  PV-HOLD-PREPK-ID      11250000
112600                   MOVE PV-UNION-TYPE   TO  PV-HOLD-UNION-TYPE    11260000
112700                   MOVE RECITM-ORD-LNE-NBR TO  PV-HOLD-ORD-LNE-NBR11270000
112800                   MOVE PV-CURR-PREPK-RATIO-CALC                  11280000
112900                                    TO PV-HOLD-PREPK-RATIO-CALC   11290000
113000                 END-IF                                           11300000
113100               END-IF                                             11310000
113200             END-IF                                               11320000
113300          END-IF                                                  11330000
113400        END-IF.                                                   11340000
113500                                                                  11350000
113600                                                                  11360000
113700 4000-PROCESS-PREPK-PO-ITM-CSR.                                   11370000
113710     IF PS-SHOW-DEBUG-INFO                                        11371001
113720         STRING   ' ' WS007-SRC-TASK-NUMBER                       11372001
113730                ' WSKCS310:4000-PROCESS-PREPK-PO-ITM-CSR'         11373001
113740         DELIMITED BY SIZE                                        11374001
113750         INTO PV-CICS-MSG-AREA                                    11375001
113760         PERFORM 9990-WRITE-CICS                                  11376001
113770     END-IF.                                                      11377001
113780                                                                  11378001
113800                                                                  11380000
113900     SET PS-NOT-END-OF-PREPK-PO-ITM-CSR                           11390000
114000         PS-FIRST-PREPK-FETCH-NO    TO TRUE                       11400000
114100                                                                  11410000
114200     PERFORM 4100-OPEN-PREPK-PO-ITM-CSR                           11420000
114300     PERFORM 4200-FETCH-PREPK-PO-ITM-CSR                          11430000
114400             UNTIL PS-END-OF-PREPK-PO-ITM-CSR   OR                11440000
114500                   NOT WS007-SUCCESSFUL                           11450000
114600     PERFORM 4300-CLOSE-PREPK-PO-ITM-CSR.                         11460000
114700                                                                  11470000
114800 4100-OPEN-PREPK-PO-ITM-CSR.                                      11480000
114900     IF PS-SHOW-DEBUG-INFO                                        11490000
115000         STRING   ' ' WS007-SRC-TASK-NUMBER                       11500000
115100                ' WSKCS310:4100-OPEN-PREPK-PO-ITM-CSR '           11510000
115200         DELIMITED BY SIZE                                        11520000
115300         INTO PV-CICS-MSG-AREA                                    11530000
115400         PERFORM 9990-WRITE-CICS                                  11540000
115500     END-IF.                                                      11550000
115600                                                                  11560000
115700     EXEC SQL                                                     11570000
115800          OPEN PREPK-PO-ITM-CSR                                   11580000
115900     END-EXEC.                                                    11590000
116000                                                                  11600000
116100     EVALUATE TRUE                                                11610000
116200         WHEN SQLCODE = ZERO                                      11620000
116300              CONTINUE                                            11630000
116400         WHEN SQLWARN0 NOT = SPACES                               11640000
116500         WHEN SQLCODE  < ZERO                                     11650000
116600         WHEN SQLCODE  > ZERO                                     11660000
116700             MOVE '4100-OPEN-PREPK-PO-ITM-CSR '                   11670000
116800                             TO DP013-PARAGRAPH                   11680000
116900             MOVE 'WSKCS310 - OPEN-PBS-VERF-CRTN-CSR'             11690000
117000                             TO DP013-MESSAGE-TEXT(1)             11700000
117100             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 11710000
117200             STRING 'PO NBR: '         DELIMITED BY SIZE          11720000
117300                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          11730000
117400                           INTO DP013-MESSAGE-TEXT(2)             11740000
117500             MOVE SQLCA      TO DP013-SQLCA                       11750000
117600             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           11760000
117700             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(1)      11770000
117800             SET DP013-DB2-ABEND                                  11780000
117900                             TO TRUE                              11790000
118000             SET DP013-ROLLBACK                                   11800000
118100                             TO TRUE                              11810000
118200             PERFORM 9999-WRITE-CICS-LOG-MSG                      11820000
118300             SET PS-DUMP-TO-LOG       TO TRUE                     11830000
118400             SET WS007-INVALID-SQL TO TRUE                        11840000
118500* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         11850000
118600             MOVE SQLCODE             TO WS007-SQLCODE            11860000
118700             MOVE '4100-OPEN-PREPK-PO-ITM-CSR'                    11870000
118800                                      TO WS007-SQL-ERROR-PARA     11880000
118900     END-EVALUATE.                                                11890000
119000                                                                  11900000
119100 EJECT                                                            11910000
119200                                                                  11920000
119300                                                                  11930000
119400 4200-FETCH-PREPK-PO-ITM-CSR.                                     11940000
119500     IF PS-SHOW-DEBUG-INFO                                        11950000
119600         STRING   ' ' WS007-SRC-TASK-NUMBER                       11960000
119700                ' WSKCS310:4200-FETCH-PREPK-PO-ITM-CSR '          11970000
119800         DELIMITED BY SIZE                                        11980000
119900         INTO PV-CICS-MSG-AREA                                    11990000
120000         PERFORM 9990-WRITE-CICS                                  12000000
120100     END-IF.                                                      12010000
120200                                                                  12020000
120300     EXEC SQL                                                     12030000
120400          FETCH PREPK-PO-ITM-CSR                                  12040000
120500           INTO :PV-UNION-TYPE                                    12050000
120600             ,  :RECITM-ORD-LNE-NBR                               12060000
120700             ,  :RECITM-PREPK-ID                                  12070000
120800             ,  :RECITM-PREPK-RATO-QTY                            12080000
120900             ,  :PV-PREPK-RATIO-CALC                              12090000
121000     END-EXEC.                                                    12100000
121100                                                                  12110000
121200     EVALUATE TRUE                                                12120000
121300         WHEN SQLCODE = ZERO                                      12130000
121400            MOVE PV-PREPK-RATIO-CALC TO PV-CURR-PREPK-RATIO-CALC  12140000
121500            PERFORM 3500-CHECK-FOR-PACK-ID                        12150000
121600         WHEN SQLCODE = +100                                      12160000
121700              SET PS-END-OF-PREPK-PO-ITM-CSR TO TRUE              12170000
121800         WHEN SQLWARN0 NOT = SPACES                               12180000
121900         WHEN SQLCODE NOT EQUAL ZERO                              12190000
122000             MOVE '4200-FETCH-PREPK-PO-ITM-CSR '                  12200000
122100                             TO DP013-PARAGRAPH                   12210000
122200             MOVE 'WSKCS310 -FETCH-PBS-VERF-CRTN-CSR'             12220000
122300                             TO DP013-MESSAGE-TEXT(1)             12230000
122400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 12240000
122500             MOVE SUT00028-SHIPT-UNT-ID                           12250000
122600                                   TO PV-DISPLAY-CARTON           12260000
122700             STRING 'PO NBR: '         DELIMITED BY SIZE          12270000
122800                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          12280000
122900                    'CARTON ID '       DELIMITED BY SIZE          12290000
123000               PV-DISPLAY-CARTON       DELIMITED BY SIZE          12300000
123100                           INTO DP013-MESSAGE-TEXT(2)             12310000
123200             MOVE SQLCA      TO DP013-SQLCA                       12320000
123300             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           12330000
123400             SET DP013-DB2-ABEND                                  12340000
123500                             TO TRUE                              12350000
123600             SET DP013-ROLLBACK                                   12360000
123700                             TO TRUE                              12370000
123800             PERFORM 9999-WRITE-CICS-LOG-MSG                      12380000
123900             SET PS-DUMP-TO-LOG       TO TRUE                     12390000
124000             SET WS007-INVALID-SQL    TO TRUE                     12400000
124100* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         12410000
124200             MOVE SQLCODE             TO WS007-SQLCODE            12420000
124300             MOVE '4200-FETCH-PREPK-PO-ITM-CSR'                   12430000
124400                                      TO WS007-SQL-ERROR-PARA     12440000
124500     END-EVALUATE.                                                12450000
124600                                                                  12460000
124700*----------------------------------------------------------------*12470000
124800* CLOSE THE LINE STORE CURSOR                                  *  12480000
124900*----------------------------------------------------------------*12490000
125000 4300-CLOSE-PREPK-PO-ITM-CSR.                                     12500000
125100     IF PS-SHOW-DEBUG-INFO                                        12510000
125200         STRING   ' ' WS007-SRC-TASK-NUMBER                       12520000
125300                ' WSKCS310:4300-CLOSE-PREPK-PO-ITM-CSR '          12530000
125400         DELIMITED BY SIZE                                        12540000
125500         INTO PV-CICS-MSG-AREA                                    12550000
125600         PERFORM 9990-WRITE-CICS                                  12560000
125700     END-IF.                                                      12570000
125800                                                                  12580000
125900     EXEC SQL                                                     12590000
126000          CLOSE PREPK-PO-ITM-CSR                                  12600000
126100     END-EXEC.                                                    12610000
126200                                                                  12620000
126300     EVALUATE TRUE                                                12630000
126400         WHEN SQLCODE = ZERO                                      12640000
126500              CONTINUE                                            12650000
126600         WHEN SQLWARN0 NOT = SPACES                               12660000
126700         WHEN SQLCODE  < ZERO                                     12670000
126800         WHEN SQLCODE  > ZERO                                     12680000
126900             MOVE '4300-CLOSE-PREPK-PO-ITM-CSR '                  12690000
127000                             TO DP013-PARAGRAPH                   12700000
127100             MOVE 'WSKCS310 -CLOSE-PBS-VERF-CRTN-CSR'             12710000
127200                             TO DP013-MESSAGE-TEXT(1)             12720000
127300             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 12730000
127400             MOVE SUT00028-SHIPT-UNT-ID                           12740000
127500                                   TO PV-DISPLAY-CARTON           12750000
127600             STRING 'PO NBR: '         DELIMITED BY SIZE          12760000
127700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          12770000
127800                    'CARTON ID '       DELIMITED BY SIZE          12780000
127900               PV-DISPLAY-CARTON       DELIMITED BY SIZE          12790000
128000                           INTO DP013-MESSAGE-TEXT(2)             12800000
128100             MOVE SQLCA      TO DP013-SQLCA                       12810000
128200             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           12820000
128300             SET DP013-DB2-ABEND                                  12830000
128400                             TO TRUE                              12840000
128500             SET DP013-ROLLBACK                                   12850000
128600                             TO TRUE                              12860000
128700             PERFORM 9999-WRITE-CICS-LOG-MSG                      12870000
128800             SET PS-DUMP-TO-LOG       TO TRUE                     12880000
128900             SET WS007-INVALID-SQL    TO TRUE                     12890000
129000* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         12900000
129100             MOVE SQLCODE             TO WS007-SQLCODE            12910000
129200             MOVE '4300-CLOSE-PREPK-PO-ITM-CSR'                   12920000
129300                                      TO WS007-SQL-ERROR-PARA     12930000
129400     END-EVALUATE.                                                12940000
129500                                                                  12950000
129600 5000-PROCESS-CRTN-UPC-CSR.                                       12960000
129610     IF PS-SHOW-DEBUG-INFO                                        12961001
129620         STRING   ' ' WS007-SRC-TASK-NUMBER                       12962001
129630                ' WSKCS310:5000-PROCESS-CRTN-UPC-CSR    '         12963001
129640         DELIMITED BY SIZE                                        12964001
129650         INTO PV-CICS-MSG-AREA                                    12965001
129660         PERFORM 9990-WRITE-CICS                                  12966001
129670     END-IF.                                                      12967001
129680                                                                  12968001
129700      SET PS-NOT-END-OF-CRTN-UPC-CSR TO TRUE                      12970000
129800      PERFORM 5100-OPEN-CRTN-UPC-CSR                              12980000
129900      PERFORM 5200-FETCH-CRTN-UPC-CSR                             12990000
130000              UNTIL PS-END-OF-CRTN-UPC-CSR OR                     13000000
130100                    NOT WS007-SUCCESSFUL                          13010000
130200      PERFORM 5300-CLOSE-CRTN-UPC-CSR.                            13020000
130300                                                                  13030000
130400                                                                  13040000
130500 5100-OPEN-CRTN-UPC-CSR.                                          13050000
130600     IF PS-SHOW-DEBUG-INFO                                        13060000
130700         STRING   ' ' WS007-SRC-TASK-NUMBER                       13070000
130800                ' WSKCS310:5100-OPEN-CRTN-UPC-CSR '               13080000
130900         DELIMITED BY SIZE                                        13090000
131000         INTO PV-CICS-MSG-AREA                                    13100000
131100         PERFORM 9990-WRITE-CICS                                  13110000
131200     END-IF.                                                      13120000
131300                                                                  13130000
131400     EXEC SQL                                                     13140000
131500          OPEN CRTN-UPC-CSR                                       13150000
131600     END-EXEC.                                                    13160000
131700                                                                  13170000
131800     EVALUATE TRUE                                                13180000
131900         WHEN SQLCODE = ZERO                                      13190000
132000              CONTINUE                                            13200000
132100         WHEN SQLWARN0 NOT = SPACES                               13210000
132200         WHEN SQLCODE  < ZERO                                     13220000
132300         WHEN SQLCODE  > ZERO                                     13230000
132400             MOVE '5100-OPEN-CRTN-UPC-CSR '                       13240000
132500                             TO DP013-PARAGRAPH                   13250000
132600             MOVE 'WSKCS310 - OPEN-PBS-VERF-CRTN-CSR'             13260000
132700                             TO DP013-MESSAGE-TEXT(1)             13270000
132800             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 13280000
132900             STRING 'PO NBR: '         DELIMITED BY SIZE          13290000
133000                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          13300000
133100                           INTO DP013-MESSAGE-TEXT(2)             13310000
133200             MOVE SQLCA      TO DP013-SQLCA                       13320000
133300             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           13330000
133400             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(1)      13340000
133500             SET DP013-DB2-ABEND                                  13350000
133600                             TO TRUE                              13360000
133700             SET DP013-ROLLBACK                                   13370000
133800                             TO TRUE                              13380000
133900             PERFORM 9999-WRITE-CICS-LOG-MSG                      13390000
134000             SET PS-DUMP-TO-LOG       TO TRUE                     13400000
134100             SET WS007-INVALID-SQL TO TRUE                        13410000
134200* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         13420000
134300             MOVE SQLCODE             TO WS007-SQLCODE            13430000
134400             MOVE '5100-OPEN-CRTN-UPC-CSR'                        13440000
134500                                      TO WS007-SQL-ERROR-PARA     13450000
134600     END-EVALUATE.                                                13460000
134700                                                                  13470000
134800 EJECT                                                            13480000
134900                                                                  13490000
135000                                                                  13500000
135100 5200-FETCH-CRTN-UPC-CSR.                                         13510000
135200     IF PS-SHOW-DEBUG-INFO                                        13520000
135300         STRING   ' ' WS007-SRC-TASK-NUMBER                       13530000
135400                ' WSKCS310:5200-FETCH-CRTN-UPC-CSR '              13540000
135500         DELIMITED BY SIZE                                        13550000
135600         INTO PV-CICS-MSG-AREA                                    13560000
135700         PERFORM 9990-WRITE-CICS                                  13570000
135800     END-IF.                                                      13580000
135900                                                                  13590000
136000     EXEC SQL                                                     13600000
136100          FETCH CRTN-UPC-CSR                                      13610000
136200           INTO :PV-LINE-NUMBER                                   13620000
136300             ,  :SUT00028-UPC-NBR                                 13630000
136400             ,  :SUT00028-RCVR-SEQ-NBR                            13640000
136500     END-EXEC.                                                    13650000
136600                                                                  13660000
136700     EVALUATE TRUE                                                13670000
136800         WHEN SQLCODE = ZERO                                      13680000
136900            PERFORM 5500-UPDATE-OTBND-CRTN                        13690000
137000            IF PS-PO-ITEM-PROCESS-UPD-YES                         13700000
137100               PERFORM 5600-ADD-RECITM                            13710000
137200               PERFORM 5700-PREPARE-TRECDIS                       13720000
137300            END-IF                                                13730000
137400         WHEN SQLCODE = +100                                      13740000
137500              SET PS-END-OF-CRTN-UPC-CSR TO TRUE                  13750000
137600         WHEN SQLWARN0 NOT = SPACES                               13760000
137700         WHEN SQLCODE NOT EQUAL ZERO                              13770000
137800             MOVE '5200-FETCH-CRTN-UPC-CSR '                      13780000
137900                             TO DP013-PARAGRAPH                   13790000
138000             MOVE 'WSKCS310 -FETCH-PBS-VERF-CRTN-CSR'             13800000
138100                             TO DP013-MESSAGE-TEXT(1)             13810000
138200             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 13820000
138300             MOVE SUT00028-SHIPT-UNT-ID                           13830000
138400                                   TO PV-DISPLAY-CARTON           13840000
138500             STRING 'PO NBR: '         DELIMITED BY SIZE          13850000
138600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          13860000
138700                    'CARTON ID '       DELIMITED BY SIZE          13870000
138800               PV-DISPLAY-CARTON       DELIMITED BY SIZE          13880000
138900                           INTO DP013-MESSAGE-TEXT(2)             13890000
139000             MOVE SQLCA      TO DP013-SQLCA                       13900000
139100             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           13910000
139200             SET DP013-DB2-ABEND                                  13920000
139300                             TO TRUE                              13930000
139400             SET DP013-ROLLBACK                                   13940000
139500                             TO TRUE                              13950000
139600             PERFORM 9999-WRITE-CICS-LOG-MSG                      13960000
139700             SET PS-DUMP-TO-LOG       TO TRUE                     13970000
139800             SET WS007-INVALID-SQL    TO TRUE                     13980000
139900* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         13990000
140000             MOVE SQLCODE             TO WS007-SQLCODE            14000000
140100             MOVE '5200-FETCH-CRTN-UPC-CSR'                       14010000
140200                                      TO WS007-SQL-ERROR-PARA     14020000
140300     END-EVALUATE.                                                14030000
140400                                                                  14040000
140500*----------------------------------------------------------------*14050000
140600* CLOSE THE LINE STORE CURSOR                                  *  14060000
140700*----------------------------------------------------------------*14070000
140800 5300-CLOSE-CRTN-UPC-CSR.                                         14080000
140900     IF PS-SHOW-DEBUG-INFO                                        14090000
141000         STRING   ' ' WS007-SRC-TASK-NUMBER                       14100000
141100                ' WSKCS310:5300-CLOSE-CRTN-UPC-CSR '              14110000
141200         DELIMITED BY SIZE                                        14120000
141300         INTO PV-CICS-MSG-AREA                                    14130000
141400         PERFORM 9990-WRITE-CICS                                  14140000
141500     END-IF.                                                      14150000
141600                                                                  14160000
141700     EXEC SQL                                                     14170000
141800          CLOSE CRTN-UPC-CSR                                      14180000
141900     END-EXEC.                                                    14190000
142000                                                                  14200000
142100     EVALUATE TRUE                                                14210000
142200         WHEN SQLCODE = ZERO                                      14220000
142300              CONTINUE                                            14230000
142400         WHEN SQLWARN0 NOT = SPACES                               14240000
142500         WHEN SQLCODE  < ZERO                                     14250000
142600         WHEN SQLCODE  > ZERO                                     14260000
142700             MOVE '5300-CLOSE-CRTN-UPC-CSR '                      14270000
142800                             TO DP013-PARAGRAPH                   14280000
142900             MOVE 'WSKCS310 -CLOSE-CRTN-UPC-CSR '                 14290000
143000                             TO DP013-MESSAGE-TEXT(1)             14300000
143100             MOVE SUT00028-SHIPT-UNT-ID                           14310000
143200                                   TO PV-DISPLAY-CARTON           14320000
143300             STRING 'PO NBR: '         DELIMITED BY SIZE          14330000
143400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          14340000
143500                    'CARTON ID '       DELIMITED BY SIZE          14350000
143600               PV-DISPLAY-CARTON       DELIMITED BY SIZE          14360000
143700                           INTO DP013-MESSAGE-TEXT(2)             14370000
143800             MOVE SQLCA      TO DP013-SQLCA                       14380000
143900             MOVE 'SUT00028 ' TO DP013-DB2-TABLE-NAME(1)          14390000
144000             SET DP013-DB2-ABEND                                  14400000
144100                             TO TRUE                              14410000
144200             SET DP013-ROLLBACK                                   14420000
144300                             TO TRUE                              14430000
144400             PERFORM 9999-WRITE-CICS-LOG-MSG                      14440000
144500             SET PS-DUMP-TO-LOG       TO TRUE                     14450000
144600             SET WS007-INVALID-SQL TO TRUE                        14460000
144700* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         14470000
144800             MOVE SQLCODE             TO WS007-SQLCODE            14480000
144900             MOVE '5300-CLOSE-CRTN-UPC-CSR'                       14490000
145000                                      TO WS007-SQL-ERROR-PARA     14500000
145100     END-EVALUATE.                                                14510000
145200                                                                  14520000
145300 5500-UPDATE-OTBND-CRTN.                                          14530000
145310     IF PS-SHOW-DEBUG-INFO                                        14531001
145320         STRING   ' ' WS007-SRC-TASK-NUMBER                       14532001
145330                ' WSKCS310:5500-UPDATE-OTBND-CRTN       '         14533001
145340         DELIMITED BY SIZE                                        14534001
145350         INTO PV-CICS-MSG-AREA                                    14535001
145360         PERFORM 9990-WRITE-CICS                                  14536001
145370     END-IF.                                                      14537001
145380                                                                  14538001
145400                                                                  14540000
145500     EXEC SQL                                                     14550000
145600          UPDATE SUT_OTBND_UPC                                    14560000
145700            SET   TRN_LNE_NBR        = :PV-LINE-NUMBER            14570000
145800           WHERE  SHIPT_UNT_ID       = :SUT00028-SHIPT-UNT-ID     14580000
145900            AND   UPC_NBR            = :SUT00028-UPC-NBR          14590000
146000     END-EXEC.                                                    14600000
146100                                                                  14610000
146200                                                                  14620000
146300     EVALUATE TRUE                                                14630000
146400         WHEN SQLCODE = ZERO                                      14640000
146500              CONTINUE                                            14650000
146600         WHEN SQLWARN0 NOT = SPACES                               14660000
146700         WHEN SQLCODE  < ZERO                                     14670000
146800         WHEN SQLCODE  > ZERO                                     14680000
146900             MOVE SUT00028-SHIPT-UNT-ID                           14690000
147000                               TO PV-DISPLAY-CARTON               14700000
147100             MOVE '5500-UPDATE-OTBND-CRTN '                       14710000
147200                             TO DP013-PARAGRAPH                   14720000
147300             MOVE 'WSKCS310 -UPDATE OTBND CRTN  '                 14730000
147400                             TO DP013-MESSAGE-TEXT(1)             14740000
147500             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 14750000
147600             STRING 'PO NBR: '         DELIMITED BY SIZE          14760000
147700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          14770000
147800                 'SHIPT UNT ID '       DELIMITED BY SIZE          14780000
147900                  PV-DISPLAY-CARTON DELIMITED BY SIZE             14790000
148000                           INTO DP013-MESSAGE-TEXT(2)             14800000
148100             MOVE SQLCA      TO DP013-SQLCA                       14810000
148200             MOVE 'SUT00028 ' TO DP013-DB2-TABLE-NAME(1)          14820000
148300             SET DP013-DB2-ABEND                                  14830000
148400                             TO TRUE                              14840000
148500             SET DP013-ROLLBACK                                   14850000
148600                             TO TRUE                              14860000
148700             PERFORM 9999-WRITE-CICS-LOG-MSG                      14870000
148800             SET PS-DUMP-TO-LOG       TO TRUE                     14880000
148900             SET WS007-INVALID-SQL TO TRUE                        14890000
149000* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         14900000
149100             MOVE SQLCODE             TO WS007-SQLCODE            14910000
149200             MOVE '5500-UPDATE-OTBND-CRTN'                        14920000
149300                                      TO WS007-SQL-ERROR-PARA     14930000
149400     END-EVALUATE.                                                14940000
149500                                                                  14950000
149600 5600-ADD-RECITM.                                                 14960000
149610     IF PS-SHOW-DEBUG-INFO                                        14961001
149620         STRING   ' ' WS007-SRC-TASK-NUMBER                       14962001
149630                ' WSKCS310:5600-ADD-RECITM              '         14963001
149640         DELIMITED BY SIZE                                        14964001
149650         INTO PV-CICS-MSG-AREA                                    14965001
149660         PERFORM 9990-WRITE-CICS                                  14966001
149670     END-IF.                                                      14967001
149680                                                                  14968001
149700     PERFORM 5610-SETUP-RECITM-FIELDS.                            14970000
149800     PERFORM 5620-INSERT-RECITM.                                  14980000
149900                                                                  14990000
150000 5610-SETUP-RECITM-FIELDS.                                        15000000
150010     IF PS-SHOW-DEBUG-INFO                                        15001001
150020         STRING   ' ' WS007-SRC-TASK-NUMBER                       15002001
150030                ' WSKCS310:5610-SETUP-RECITM-FIELDS     '         15003001
150040         DELIMITED BY SIZE                                        15004001
150050         INTO PV-CICS-MSG-AREA                                    15005001
150060         PERFORM 9990-WRITE-CICS                                  15006001
150070     END-IF.                                                      15007001
150080                                                                  15008001
150100                                                                  15010000
150200     INITIALIZE DCLTRECITM.                                       15020000
150300     PERFORM 5615-SELECT-PURITM-INFO.                             15030000
150400                                                                  15040000
150500     MOVE PV-LINE-NUMBER         TO RECITM-ORD-LNE-NBR.           15050000
150600                                                                  15060000
150700     MOVE SUT00028-RCVR-SEQ-NBR  TO RECITM-REC-SEQ-NBR.           15070000
150800* FJW BEGIN 03/29/2010                                            15080000
150900*    MOVE 873                    TO RECITM-OPER-UNT-ID.           15090000
151000     MOVE WS014-STORE-NUMBER     TO RECITM-OPER-UNT-ID.           15100000
151100* FJW END   03/29/2010                                            15110000
151200     MOVE 1                      TO RECITM-FCLTY-ID.              15120000
151300                                                                  15130000
151400     MOVE PURITM-VER-NBR         TO RECITM-PO-VER-NBR.            15140000
151500     MOVE PURITM-ITM-NBR         TO RECITM-ITM-NBR.               15150000
151600     MOVE PURITM-UNT-RTL-PR-AMT  TO RECITM-UNT-RTL-AMT            15160000
151700     MOVE PURITM-UNT-COST-AMT    TO RECITM-UNT-COST-AMT           15170000
151800     MOVE PURITM-GP-RTL-AMT      TO RECITM-GP-RTL-AMT             15180000
151900     MOVE PURITM-GP-QTY          TO RECITM-GP-QTY                 15190000
152000     MOVE RECEIV-PRE-TKT-IND     TO RECITM-PRE-TKT-IND.           15200000
152100     MOVE SPACES                 TO RECITM-TKT-FMT-ID.            15210000
152200     MOVE 'IP'                   TO RECITM-STATUS-CDE.            15220000
152300     MOVE 1                      TO RECITM-EXPTED-CART-CNT.       15230000
152400     MOVE SUT00028-SHPD-UNT-QTY  TO RECITM-PKSL-ITM-QTY           15240000
152500                                    RECITM-DTL-CK-ITM-QTY.        15250000
152600     MOVE ZERO                   TO RECITM-ACTL-CART-CNT.         15260000
152700     MOVE '9999-09-09-09.09.09.999999'                            15270000
152800                                 TO RECITM-MKING-APRON-TMST       15280000
152900                                    RECITM-UPD-TMST.              15290000
153000     MOVE PURITM-PREPK-RATO-QTY TO  RECITM-PREPK-RATO-QTY.        15300000
153100                                                                  15310000
153200     MOVE DK-PREPK-ID           TO  RECITM-PREPK-ID.              15320000
153300     IF PS-SET-DRVR-LINE-YES                                      15330000
153400        MOVE 'A'                TO RECITM-PREPK-DRV-LNE-CDE       15340000
153500        SET PS-SET-DRVR-LINE-NO  TO TRUE                          15350000
153600     ELSE                                                         15360000
153700        MOVE SPACE              TO RECITM-PREPK-DRV-LNE-CDE       15370000
153800     END-IF                                                       15380000
153900     INITIALIZE                     RECITM-PREPK-ODD-UNT-QTY.     15390000
154000                                                                  15400000
154100 5615-SELECT-PURITM-INFO.                                         15410000
154200     IF PS-SHOW-DEBUG-INFO                                        15420000
154300         STRING   ' ' WS007-SRC-TASK-NUMBER                       15430000
154400                ' WSKCS310:5615-SELECT-PURITM-INFO '              15440000
154500         DELIMITED BY SIZE                                        15450000
154600         INTO PV-CICS-MSG-AREA                                    15460000
154700         PERFORM 9990-WRITE-CICS                                  15470000
154800         MOVE WS014-RECEIPT-PIX-RECORD                            15480000
154900           TO PV-CICS-MSG-AREA                                    15490000
155000         PERFORM 9990-WRITE-CICS                                  15500000
155100     END-IF.                                                      15510000
155200                                                                  15520000
155300                                                                  15530000
155400     EXEC SQL                                                     15540000
155500         SELECT  A.PO_NBR                                         15550000
155600               , A.APP_PO_LNE_NBR                                 15560000
155700               , A.VER_NBR                                        15570000
155800               , A.ITM_NBR                                        15580000
155900               , A.UNT_RTL_PR_AMT                                 15590000
156000               , A.UNT_COST_AMT                                   15600000
156100               , A.GP_RTL_AMT                                     15610000
156200               , A.GP_QTY                                         15620000
156300               , A.PREPK_RATO_QTY                                 15630000
156400               , D.SHPD_UNT_QTY                                   15640000
156500          INTO :PURITM-PO-NBR                                     15650000
156600             , :PURITM-APP-PO-LNE-NBR                             15660000
156700             , :PURITM-VER-NBR                                    15670000
156800             , :PURITM-ITM-NBR                                    15680000
156900             , :PURITM-UNT-RTL-PR-AMT                             15690000
157000             , :PURITM-UNT-COST-AMT                               15700000
157100             , :PURITM-GP-RTL-AMT                                 15710000
157200             , :PURITM-GP-QTY                                     15720000
157300             , :PURITM-PREPK-RATO-QTY                             15730000
157400             , :SUT00028-SHIPT-UNT-ID                             15740000
157500          FROM TPURITM A                                          15750000
157600             , XLV_SKU B                                          15760000
157700             , XLV_UPC C                                          15770000
157800             , SUT_OTBND_UPC D                                    15780000
157900         WHERE A.PO_NBR            = :DK-PO-NBR                   15790000
158000             AND A.ITM_NBR         = B.ITM_NBR                    15800000
158100             AND A.VER_STATUS_CDE  = 'A'                          15810000
158200             AND A.PO_NBR          = D.TRN_NBR                    15820000
158300             AND B.INTR_UPC_ID     = C.INTR_UPC_ID                15830000
158400             AND C.UPC_NBR         = D.UPC_NBR                    15840000
158500             AND A.PO_PREPK_ID     = :DK-PREPK-ID                 15850000
158600             AND D.SHIPT_UNT_ID    = :SUT00028-SHIPT-UNT-ID       15860000
158700             AND A.APP_PO_LNE_NBR  = :PV-LINE-NUMBER              15870000
158800     END-EXEC.                                                    15880000
158900                                                                  15890000
159000     EVALUATE TRUE                                                15900000
159100         WHEN SQLCODE = ZERO                                      15910000
159200              CONTINUE                                            15920000
159300         WHEN SQLCODE = +100                                      15930000
159400             MOVE WST00001-INTR-TRIP-ID  TO VHTRIP-TRIP-ID        15940000
159500         WHEN SQLWARN0 NOT = SPACES                               15950000
159600         WHEN SQLCODE NOT EQUAL ZERO                              15960000
159700             MOVE '5615-SELECT-PURITM-INFO '                      15970000
159800                             TO DP013-PARAGRAPH                   15980000
159900             MOVE 'WSKCS310 - SELECT TRIP FROM SHIPMT '           15990000
160000                             TO DP013-MESSAGE-TEXT(1)             16000000
160100             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 16010000
160200             MOVE SUT00028-SHIPT-UNT-ID  TO PV-DISPLAY-CARTON     16020000
160300             STRING 'PO NBR: '         DELIMITED BY SIZE          16030000
160400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          16040000
160500                    'CARTON ID '       DELIMITED BY SIZE          16050000
160600               PV-DISPLAY-CARTON       DELIMITED BY SIZE          16060000
160700                           INTO DP013-MESSAGE-TEXT(2)             16070000
160800             MOVE SQLCA      TO DP013-SQLCA                       16080000
160900             MOVE 'TPURITM '                                      16090000
161000                             TO DP013-DB2-TABLE-NAME(1)           16100000
161100             SET DP013-DB2-ABEND                                  16110000
161200                             TO TRUE                              16120000
161300             SET DP013-ROLLBACK                                   16130000
161400                             TO TRUE                              16140000
161500             PERFORM 9999-WRITE-CICS-LOG-MSG                      16150000
161600             SET PS-DUMP-TO-LOG       TO TRUE                     16160000
161700             SET WS007-INVALID-SQL TO TRUE                        16170000
161800* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         16180000
161900             MOVE SQLCODE             TO WS007-SQLCODE            16190000
162000             MOVE '5615-SELECT-PURITM-INFO'                       16200000
162100                                      TO WS007-SQL-ERROR-PARA     16210000
162200     END-EVALUATE.                                                16220000
162300                                                                  16230000
162400 5620-INSERT-RECITM.                                              16240000
162410     IF PS-SHOW-DEBUG-INFO                                        16241001
162420         STRING   ' ' WS007-SRC-TASK-NUMBER                       16242001
162430                ' WSKCS310:5620-INSERT-RECITM           '         16243001
162440         DELIMITED BY SIZE                                        16244001
162450         INTO PV-CICS-MSG-AREA                                    16245001
162460         PERFORM 9990-WRITE-CICS                                  16246001
162470     END-IF.                                                      16247001
162480                                                                  16248001
162500                                                                  16250000
162600     EXEC SQL                                                     16260000
162700         INSERT INTO TRECITM                                      16270000
162800               (ORD_NBR                                           16280000
162900             ,  ORD_LNE_NBR                                       16290000
163000             ,  REC_SEQ_NBR                                       16300000
163100             ,  OPER_UNT_ID                                       16310000
163200             ,  FCLTY_ID                                          16320000
163300             ,  CRE_TMST                                          16330000
163400             ,  CRE_UID                                           16340000
163500             ,  PO_VER_NBR                                        16350000
163600             ,  ITM_NBR                                           16360000
163700             ,  PRE_TKT_IND                                       16370000
163800             ,  TKT_FMT_ID                                        16380000
163900             ,  RTV_IND                                           16390000
164000             ,  STATUS_CDE                                        16400000
164100             ,  VER_STATUS_CDE                                    16410000
164200             ,  PKSL_ITM_QTY                                      16420000
164300             ,  DTL_CK_ITM_QTY                                    16430000
164400             ,  INNR_PACK_QTY                                     16440000
164500             ,  CASE_PACK_QTY                                     16450000
164600             ,  RTV_QTY                                           16460000
164700             ,  EXPTED_CART_CNT                                   16470000
164800             ,  ACTL_CART_CNT                                     16480000
164900             ,  MKING_APRON_TMST                                  16490000
165000             ,  UNT_COST_AMT                                      16500000
165100             ,  COLOR_DESC                                        16510000
165200             ,  SIZE_DESC                                         16520000
165300             ,  VEND_STYL_NAME                                    16530000
165400             ,  VEND_DESC                                         16540000
165500             ,  VERFYD_TMST                                       16550000
165600             ,  PKSL_NBR                                          16560000
165700             ,  REC_INV_LNE_NBR                                   16570000
165800             ,  DMG_ITM_QTY                                       16580000
165900             ,  UPD_TMST                                          16590000
166000             ,  UPD_UID                                           16600000
166100             ,  UPD_PGM_ID                                        16610000
166200             ,  RCPT_DISTR_UPD_CDE                                16620000
166300             ,  LAST_TRSCP_TMST                                   16630000
166400             ,  LAST_TRSCP_USR_ID                                 16640000
166500             ,  PREPK_ID                                          16650000
166600             ,  PREPK_RATO_QTY                                    16660000
166700             ,  PREPK_ODD_UNT_QTY                                 16670000
166800             ,  PREPK_DRV_LNE_CDE                                 16680000
166900             ,  UNT_RTL_AMT                                       16690000
167000             ,  GP_RTL_AMT                                        16700000
167100             ,  GP_QTY                                            16710000
167200             ,  ORIG_PKSL_ITM_QTY)                                16720000
167300        VALUES (:DK-PO-NBR                                        16730000
167400             ,  :RECITM-ORD-LNE-NBR                               16740000
167500             ,  :RECITM-REC-SEQ-NBR                               16750000
167600             ,  :RECITM-OPER-UNT-ID                               16760000
167700             ,  :RECITM-FCLTY-ID                                  16770000
167800             ,   CURRENT_TIMESTAMP                                16780000
167900             ,  :PC-CURRENT-PROGRAM-NAME                          16790000
168000             ,  :RECITM-PO-VER-NBR                                16800000
168100             ,  :RECITM-ITM-NBR                                   16810000
168200             ,  :RECITM-PRE-TKT-IND                               16820000
168300             ,  :RECITM-TKT-FMT-ID                                16830000
168400             ,  :RECITM-RTV-IND                                   16840000
168500             ,  :RECITM-STATUS-CDE                                16850000
168600             ,  'A'                                               16860000
168700             ,  :RECITM-PKSL-ITM-QTY                              16870000
168800             ,  :RECITM-DTL-CK-ITM-QTY                            16880000
168900             ,  :RECITM-INNR-PACK-QTY                             16890000
169000             ,  :RECITM-CASE-PACK-QTY                             16900000
169100             ,  :RECITM-RTV-QTY                                   16910000
169200             ,  :RECITM-EXPTED-CART-CNT                           16920000
169300             ,  :RECITM-ACTL-CART-CNT                             16930000
169400             ,  :RECITM-MKING-APRON-TMST                          16940000
169500             ,  :RECITM-UNT-COST-AMT                              16950000
169600             ,  :RECITM-COLOR-DESC                                16960000
169700             ,  :RECITM-SIZE-DESC                                 16970000
169800             ,  :RECITM-VEND-STYL-NAME                            16980000
169900             ,  :RECITM-VEND-DESC                                 16990000
170000             ,  CURRENT_TIMESTAMP                                 17000000
170100             ,  :RECITM-PKSL-NBR                                  17010000
170200             ,  :RECITM-REC-INV-LNE-NBR                           17020000
170300             ,  :RECITM-DMG-ITM-QTY                               17030000
170400             ,  :RECITM-UPD-TMST                                  17040000
170500             ,  :RECITM-UPD-UID                                   17050000
170600             ,  :RECITM-UPD-PGM-ID                                17060000
170700             ,  :RECITM-RCPT-DISTR-UPD-CDE                        17070000
170800             ,   CURRENT_TIMESTAMP                                17080000
170900             ,  :PC-CURRENT-PROGRAM-NAME                          17090000
171000             ,  :RECITM-PREPK-ID                                  17100000
171100             ,  :RECITM-PREPK-RATO-QTY                            17110000
171200             ,  :RECITM-PREPK-ODD-UNT-QTY                         17120000
171300             ,  :RECITM-PREPK-DRV-LNE-CDE                         17130000
171400             ,  :RECITM-UNT-RTL-AMT                               17140000
171500             ,  :RECITM-GP-RTL-AMT                                17150000
171600             ,  :RECITM-GP-QTY                                    17160000
171700             ,  0)                                                17170000
171800     END-EXEC.                                                    17180000
171900                                                                  17190000
172000     EVALUATE TRUE                                                17200000
172100         WHEN SQLCODE = ZERO                                      17210000
172200              CONTINUE                                            17220000
172300         WHEN SQLWARN0 NOT = SPACES                               17230000
172400         WHEN SQLCODE NOT EQUAL ZERO                              17240000
172500             MOVE '5620-INSERT-RECITM '                           17250000
172600                             TO DP013-PARAGRAPH                   17260000
172700             MOVE 'WSKCS310 - INSERT TO TRECITM  '                17270000
172800                             TO DP013-MESSAGE-TEXT(1)             17280000
172900             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 17290000
173000             MOVE SUT00028-SHIPT-UNT-ID  TO PV-DISPLAY-CARTON     17300000
173100             STRING 'PO NBR: '         DELIMITED BY SIZE          17310000
173200                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          17320000
173300                    'CARTON ID '       DELIMITED BY SIZE          17330000
173400               PV-DISPLAY-CARTON       DELIMITED BY SIZE          17340000
173500                           INTO DP013-MESSAGE-TEXT(2)             17350000
173600             MOVE SQLCA      TO DP013-SQLCA                       17360000
173700             MOVE 'TRECITM '                                      17370000
173800                             TO DP013-DB2-TABLE-NAME(1)           17380000
173900             SET DP013-DB2-ABEND                                  17390000
174000                             TO TRUE                              17400000
174100             SET DP013-ROLLBACK                                   17410000
174200                             TO TRUE                              17420000
174300             PERFORM 9999-WRITE-CICS-LOG-MSG                      17430000
174400             SET PS-DUMP-TO-LOG       TO TRUE                     17440000
174500             SET WS007-INVALID-SQL TO TRUE                        17450000
174600* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         17460000
174700             MOVE SQLCODE             TO WS007-SQLCODE            17470000
174800             MOVE '5620-INSERT-RECITM'                            17480000
174900                                      TO WS007-SQL-ERROR-PARA     17490000
175000     END-EVALUATE.                                                17500000
175100                                                                  17510000
175200 5700-PREPARE-TRECDIS.                                            17520000
175210     IF PS-SHOW-DEBUG-INFO                                        17521001
175220         STRING   ' ' WS007-SRC-TASK-NUMBER                       17522001
175230                ' WSKCS310:5700-PREPARE-TRECDIS         '         17523001
175240         DELIMITED BY SIZE                                        17524001
175250         INTO PV-CICS-MSG-AREA                                    17525001
175260         PERFORM 9990-WRITE-CICS                                  17526001
175270     END-IF.                                                      17527001
175280                                                                  17528001
175300     PERFORM 5710-SETUP-TRECDIS-FIELDS.                           17530000
175400     PERFORM 5720-INSERT-TRECDIS.                                 17540000
175500                                                                  17550000
175600 5710-SETUP-TRECDIS-FIELDS.                                       17560000
175610     IF PS-SHOW-DEBUG-INFO                                        17561001
175620         STRING   ' ' WS007-SRC-TASK-NUMBER                       17562001
175630                ' WSKCS310:5710-SETUP-TRECDIS-FIELDS    '         17563001
175640         DELIMITED BY SIZE                                        17564001
175650         INTO PV-CICS-MSG-AREA                                    17565001
175660         PERFORM 9990-WRITE-CICS                                  17566001
175670     END-IF.                                                      17567001
175680                                                                  17568001
175700                                                                  17570000
175800     INITIALIZE DCLTRECDIS.                                       17580000
175900                                                                  17590000
176000     MOVE DK-PO-NBR          TO RECDIS-ORD-NBR.                   17600000
176100     MOVE PV-LINE-NUMBER                                          17610000
176200                             TO RECDIS-ORD-LNE-NBR.               17620000
176300     MOVE SUT00028-RCVR-SEQ-NBR TO  RECDIS-REC-SEQ-NBR.           17630000
176400* FJW BEGIN 03/29/2010                                            17640000
176500*    MOVE 873                TO RECDIS-OPER-UNT-ID.               17650000
176600     MOVE WS014-STORE-NUMBER TO RECDIS-OPER-UNT-ID.               17660000
176700* FJW END   03/29/2010                                            17670000
176800     MOVE PC-CURRENT-PROGRAM-NAME                                 17680000
176900                             TO RECDIS-CRE-UID.                   17690000
177000     MOVE 'A'                TO RECDIS-VER-STATUS-CDE.            17700000
177100     MOVE SUT00028-SHPD-UNT-QTY TO  RECDIS-EXPTED-ITM-QTY         17710000
177200                                RECDIS-VERIFY-ITM-QTY             17720000
177300                                RECDIS-AP-VERIFY-ITM-QTY.         17730000
177400* FJW BEGIN 03/29/2010                                            17740000
177500*    MOVE 870                TO RECDIS-STR-NBR.                   17750000
177600     MOVE WS014-DC-LOCATION  TO RECDIS-STR-NBR.                   17760000
177700* FJW END   03/29/2010                                            17770000
177800     MOVE 1                  TO RECDIS-FCLTY-ID.                  17780000
177900     MOVE 1                  TO RECDIS-STR-FCLTY-ID.              17790000
178000                                                                  17800000
178100     MOVE '9999-09-09'       TO RECDIS-AP-PRC-DTE.                17810000
178200                                                                  17820000
178300                                                                  17830000
178400 5720-INSERT-TRECDIS.                                             17840000
178410     IF PS-SHOW-DEBUG-INFO                                        17841001
178420         STRING   ' ' WS007-SRC-TASK-NUMBER                       17842001
178430                ' WSKCS310:5720-INSERT-TRECDIS          '         17843001
178440         DELIMITED BY SIZE                                        17844001
178450         INTO PV-CICS-MSG-AREA                                    17845001
178460         PERFORM 9990-WRITE-CICS                                  17846001
178470     END-IF.                                                      17847001
178480                                                                  17848001
178500                                                                  17850000
178600     EXEC SQL                                                     17860000
178700          INSERT INTO TRECDIS                                     17870000
178800                 (ORD_NBR                                         17880000
178900               ,  ORD_LNE_NBR                                     17890000
179000               ,  REC_SEQ_NBR                                     17900000
179100               ,  OPER_UNT_ID                                     17910000
179200               ,  FCLTY_ID                                        17920000
179300               ,  CRE_TMST                                        17930000
179400               ,  CRE_UID                                         17940000
179500               ,  VER_STATUS_CDE                                  17950000
179600               ,  EXPTED_ITM_QTY                                  17960000
179700               ,  VERIFY_ITM_QTY                                  17970000
179800               ,  AP_VERIFY_ITM_QTY                               17980000
179900               ,  STR_NBR                                         17990000
180000               ,  STR_FCLTY_ID                                    18000000
180100               ,  PLAN_ITM_QTY                                    18010000
180200               ,  AP_PRC_CDE                                      18020000
180300               ,  AP_PRC_DTE)                                     18030000
180400          VALUES (:RECDIS-ORD-NBR                                 18040000
180500               ,  :RECDIS-ORD-LNE-NBR                             18050000
180600               ,  :RECDIS-REC-SEQ-NBR                             18060000
180700               ,  :RECDIS-OPER-UNT-ID                             18070000
180800               ,  :RECDIS-FCLTY-ID                                18080000
180900               ,  CURRENT_TIMESTAMP                               18090000
181000               ,  :RECDIS-CRE-UID                                 18100000
181100               ,  :RECDIS-VER-STATUS-CDE                          18110000
181200               ,  :RECDIS-EXPTED-ITM-QTY                          18120000
181300               ,  :RECDIS-VERIFY-ITM-QTY                          18130000
181400               ,  :RECDIS-AP-VERIFY-ITM-QTY                       18140000
181500               ,  :RECDIS-STR-NBR                                 18150000
181600               ,  :RECDIS-STR-FCLTY-ID                            18160000
181700               ,  :RECDIS-PLAN-ITM-QTY                            18170000
181800               ,  :RECDIS-AP-PRC-CDE                              18180000
181900               ,  :RECDIS-AP-PRC-DTE)                             18190000
182000     END-EXEC.                                                    18200000
182100                                                                  18210000
182200     EVALUATE TRUE                                                18220000
182300         WHEN SQLCODE = ZERO                                      18230000
182400              CONTINUE                                            18240000
182500         WHEN SQLWARN0 NOT = SPACES                               18250000
182600         WHEN SQLCODE NOT EQUAL ZERO                              18260000
182700             MOVE '5720-INSERT-TRECDIS '                          18270000
182800                             TO DP013-PARAGRAPH                   18280000
182900             MOVE 'WSKCS310 - INSERT TO TRECIDIS '                18290000
183000                             TO DP013-MESSAGE-TEXT(1)             18300000
183100             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 18310000
183200             MOVE SUT00028-SHIPT-UNT-ID  TO PV-DISPLAY-CARTON     18320000
183300             STRING 'PO NBR: '         DELIMITED BY SIZE          18330000
183400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          18340000
183500                           INTO DP013-MESSAGE-TEXT(2)             18350000
183600             MOVE SQLCA      TO DP013-SQLCA                       18360000
183700             MOVE 'TRECITM '                                      18370000
183800                             TO DP013-DB2-TABLE-NAME(1)           18380000
183900             SET DP013-DB2-ABEND                                  18390000
184000                             TO TRUE                              18400000
184100             SET DP013-ROLLBACK                                   18410000
184200                             TO TRUE                              18420000
184300             PERFORM 9999-WRITE-CICS-LOG-MSG                      18430000
184400             SET PS-DUMP-TO-LOG       TO TRUE                     18440000
184500             SET WS007-INVALID-SQL TO TRUE                        18450000
184600* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         18460000
184700             MOVE SQLCODE             TO WS007-SQLCODE            18470000
184800             MOVE '5720-INSERT-TRECDIS'                           18480000
184900                                      TO WS007-SQL-ERROR-PARA     18490000
185000     END-EVALUATE.                                                18500000
185100                                                                  18510000
185200 6000-PROCESS-OTBND-PACK-CSR.                                     18520000
185210     IF PS-SHOW-DEBUG-INFO                                        18521001
185220         STRING   ' ' WS007-SRC-TASK-NUMBER                       18522001
185230                ' WSKCS310:6000-PROCESS-OTBND-PACK-CSR  '         18523001
185240         DELIMITED BY SIZE                                        18524001
185250         INTO PV-CICS-MSG-AREA                                    18525001
185260         PERFORM 9990-WRITE-CICS                                  18526001
185270     END-IF.                                                      18527001
185280                                                                  18528001
185300      SET PS-NOT-END-OF-OTBND-PACK-CSR  TO TRUE                   18530000
185400      PERFORM 6100-OPEN-OTBND-PACK-CSR                            18540000
185500      PERFORM 6200-FETCH-OTBND-PACK-CSR                           18550000
185600              UNTIL PS-END-OF-OTBND-PACK-CSR OR                   18560000
185700                    NOT WS007-SUCCESSFUL                          18570000
185800      PERFORM 6300-CLOSE-OTBND-PACK-CSR.                          18580000
185900                                                                  18590000
186000 6100-OPEN-OTBND-PACK-CSR.                                        18600000
186100     IF PS-SHOW-DEBUG-INFO                                        18610000
186200         STRING   ' ' WS007-SRC-TASK-NUMBER                       18620000
186300                ' WSKCS310:6100-OPEN-OTBND-PACK-CSR '             18630000
186400         DELIMITED BY SIZE                                        18640000
186500         INTO PV-CICS-MSG-AREA                                    18650000
186600         PERFORM 9990-WRITE-CICS                                  18660000
186700     END-IF.                                                      18670000
186800                                                                  18680000
186900     EXEC SQL                                                     18690000
187000          OPEN OTBND-PACK-CSR                                     18700000
187100     END-EXEC.                                                    18710000
187200                                                                  18720000
187300     EVALUATE TRUE                                                18730000
187400         WHEN SQLCODE = ZERO                                      18740000
187500              CONTINUE                                            18750000
187600         WHEN SQLWARN0 NOT = SPACES                               18760000
187700         WHEN SQLCODE  < ZERO                                     18770000
187800         WHEN SQLCODE  > ZERO                                     18780000
187900             MOVE '6100-OPEN-OTBND-PACK-CSR '                     18790000
188000                             TO DP013-PARAGRAPH                   18800000
188100             MOVE 'WSKCS310 - OPEN-OTBND-PACK-CSR   '             18810000
188200                             TO DP013-MESSAGE-TEXT(1)             18820000
188300             MOVE VHTRIP-TRIP-ID  TO PV-DISPLAY-TRIP-ID           18830000
188400             STRING 'TRIP ID:'         DELIMITED BY SIZE          18840000
188500                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          18850000
188600                           INTO DP013-MESSAGE-TEXT(2)             18860000
188700             MOVE SQLCA      TO DP013-SQLCA                       18870000
188800             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           18880000
188900             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(1)      18890000
189000             SET DP013-DB2-ABEND                                  18900000
189100                             TO TRUE                              18910000
189200             SET DP013-ROLLBACK                                   18920000
189300                             TO TRUE                              18930000
189400             PERFORM 9999-WRITE-CICS-LOG-MSG                      18940000
189500             SET PS-DUMP-TO-LOG       TO TRUE                     18950000
189600             SET WS007-INVALID-SQL TO TRUE                        18960000
189700* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         18970000
189800             MOVE SQLCODE             TO WS007-SQLCODE            18980000
189900             MOVE '6100-OPEN-OTBND-PACK-CSR'                      18990000
190000                                      TO WS007-SQL-ERROR-PARA     19000000
190100     END-EVALUATE.                                                19010000
190200                                                                  19020000
190300 EJECT                                                            19030000
190400                                                                  19040000
190500                                                                  19050000
190600 6200-FETCH-OTBND-PACK-CSR.                                       19060000
190700     IF PS-SHOW-DEBUG-INFO                                        19070000
190800         STRING   ' ' WS007-SRC-TASK-NUMBER                       19080000
190900                ' WSKCS310:6200-FETCH-OTBND-PACK-CSR '            19090000
191000         DELIMITED BY SIZE                                        19100000
191100         INTO PV-CICS-MSG-AREA                                    19110000
191200         PERFORM 9990-WRITE-CICS                                  19120000
191300     END-IF.                                                      19130000
191400                                                                  19140000
191500     EXEC SQL                                                     19150000
191600          FETCH OTBND-PACK-CSR                                    19160000
191700           INTO :SUT00024-SHIPT-UNT-ID                            19170000
191800             ,  :RECEIV-ORD-NBR                                   19180000
191900             ,  :RECEIV-REC-SEQ-NBR                               19190000
192000             ,  :SUT00028-SHPD-UNT-QTY                            19200000
192100             ,  :RECITM-PREPK-RATO-QTY                            19210000
192200             ,  :RECITM-PREPK-ID                                  19220000
192300     END-EXEC.                                                    19230000
192400                                                                  19240000
192500     EVALUATE TRUE                                                19250000
192600         WHEN SQLCODE = ZERO                                      19260000
192700               PERFORM 6400-FORMAT-UPD-OTBND-PK                   19270000
192800         WHEN SQLCODE = +100                                      19280000
192900              SET PS-END-OF-OTBND-PACK-CSR TO TRUE                19290000
193000         WHEN SQLWARN0 NOT = SPACES                               19300000
193100         WHEN SQLCODE NOT EQUAL ZERO                              19310000
193200             MOVE '6200-FETCH-OTBND-PACK-CSR '                    19320000
193300                             TO DP013-PARAGRAPH                   19330000
193400             MOVE 'WSKCS310 -FETCH-OTBND-PACK-CSR   '             19340000
193500                             TO DP013-MESSAGE-TEXT(1)             19350000
193600             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 19360000
193700             MOVE SUT00024-SHIPT-UNT-ID                           19370000
193800                                   TO PV-DISPLAY-CARTON           19380000
193900             STRING 'PO NBR: '         DELIMITED BY SIZE          19390000
194000                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          19400000
194100                    'CARTON ID '       DELIMITED BY SIZE          19410000
194200              PV-DISPLAY-CARTON        DELIMITED BY SIZE          19420000
194300                           INTO DP013-MESSAGE-TEXT(2)             19430000
194400             MOVE SQLCA      TO DP013-SQLCA                       19440000
194500             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           19450000
194600             SET DP013-DB2-ABEND                                  19460000
194700                             TO TRUE                              19470000
194800             SET DP013-ROLLBACK                                   19480000
194900                             TO TRUE                              19490000
195000             PERFORM 9999-WRITE-CICS-LOG-MSG                      19500000
195100             SET PS-DUMP-TO-LOG       TO TRUE                     19510000
195200             PERFORM 9999-WRITE-CICS-LOG-MSG                      19520000
195300             SET PS-DUMP-TO-LOG       TO TRUE                     19530000
195400             SET WS007-INVALID-SQL    TO TRUE                     19540000
195500* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         19550000
195600             MOVE SQLCODE             TO WS007-SQLCODE            19560000
195700             MOVE '6200-FETCH-OTBND-PACK-CSR'                     19570000
195800                                      TO WS007-SQL-ERROR-PARA     19580000
195900     END-EVALUATE.                                                19590000
196000                                                                  19600000
196100*----------------------------------------------------------------*19610000
196200* CLOSE THE LINE STORE CURSOR                                  *  19620000
196300*----------------------------------------------------------------*19630000
196400 6300-CLOSE-OTBND-PACK-CSR.                                       19640000
196500     IF PS-SHOW-DEBUG-INFO                                        19650000
196600         STRING   ' ' WS007-SRC-TASK-NUMBER                       19660000
196700                ' WSKCS310:6300-CLOSE-OTBND-PACK-CSR '            19670000
196800         DELIMITED BY SIZE                                        19680000
196900         INTO PV-CICS-MSG-AREA                                    19690000
197000         PERFORM 9990-WRITE-CICS                                  19700000
197100     END-IF.                                                      19710000
197200                                                                  19720000
197300     EXEC SQL                                                     19730000
197400          CLOSE OTBND-PACK-CSR                                    19740000
197500     END-EXEC.                                                    19750000
197600                                                                  19760000
197700     EVALUATE TRUE                                                19770000
197800         WHEN SQLCODE = ZERO                                      19780000
197900              CONTINUE                                            19790000
198000         WHEN SQLWARN0 NOT = SPACES                               19800000
198100         WHEN SQLCODE  < ZERO                                     19810000
198200         WHEN SQLCODE  > ZERO                                     19820000
198300             MOVE '6300-CLOSE-OTBND-PACK-CSR '                    19830000
198400                             TO DP013-PARAGRAPH                   19840000
198500             MOVE 'WSKCS310 -CLOSE-OTBND-PACK-CSR '               19850000
198600                             TO DP013-MESSAGE-TEXT(1)             19860000
198700             MOVE VHTRIP-TRIP-ID  TO PV-DISPLAY-TRIP-ID           19870000
198800             STRING 'TRIP ID:'         DELIMITED BY SIZE          19880000
198900                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          19890000
199000                           INTO DP013-MESSAGE-TEXT(2)             19900000
199100             MOVE SQLCA      TO DP013-SQLCA                       19910000
199200             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           19920000
199300             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(1)      19930000
199400             MOVE SQLCA      TO DP013-SQLCA                       19940000
199500             MOVE 'SUT00028 ' TO DP013-DB2-TABLE-NAME(1)          19950000
199600             SET DP013-DB2-ABEND                                  19960000
199700                             TO TRUE                              19970000
199800             SET DP013-ROLLBACK                                   19980000
199900                             TO TRUE                              19990000
200000             PERFORM 9999-WRITE-CICS-LOG-MSG                      20000000
200100             SET PS-DUMP-TO-LOG       TO TRUE                     20010000
200200             SET WS007-INVALID-SQL TO TRUE                        20020000
200300* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         20030000
200400             MOVE SQLCODE             TO WS007-SQLCODE            20040000
200500             MOVE '6300-CLOSE-OTBND-PACK-CSR'                     20050000
200600                                      TO WS007-SQL-ERROR-PARA     20060000
200700     END-EVALUATE.                                                20070000
200800                                                                  20080000
200900 6400-FORMAT-UPD-OTBND-PK.                                        20090000
200910     IF PS-SHOW-DEBUG-INFO                                        20091001
200920         STRING   ' ' WS007-SRC-TASK-NUMBER                       20092001
200930                ' WSKCS310:6400-FORMAT-UPD-OTBND-PK     '         20093001
200940         DELIMITED BY SIZE                                        20094001
200950         INTO PV-CICS-MSG-AREA                                    20095001
200960         PERFORM 9990-WRITE-CICS                                  20096001
200970     END-IF.                                                      20097001
200980                                                                  20098001
201000                                                                  20100000
201100      DIVIDE SUT00028-SHPD-UNT-QTY BY RECITM-PREPK-RATO-QTY       20110000
201200                GIVING PV-PACK-COUNT REMAINDER PV-REMAINDER       20120000
201300      IF PV-REMAINDER = 0                                         20130000
201400         PERFORM 6400-SELECT-PACK-SKU                             20140000
201500         IF PS-PACK-SKU-FOUND                                     20150000
201600            PERFORM 6500-INSERT-OTBND-PK                          20160000
201700         END-IF                                                   20170000
201800      END-IF.                                                     20180000
201900                                                                  20190000
202000                                                                  20200000
202100 6400-SELECT-PACK-SKU.                                            20210000
202110     IF PS-SHOW-DEBUG-INFO                                        20211001
202120         STRING   ' ' WS007-SRC-TASK-NUMBER                       20212001
202130                ' WSKCS310:6400-SELECT-PACK-SKU         '         20213001
202140         DELIMITED BY SIZE                                        20214001
202150         INTO PV-CICS-MSG-AREA                                    20215001
202160         PERFORM 9990-WRITE-CICS                                  20216001
202170     END-IF.                                                      20217001
202180                                                                  20218001
202200                                                                  20220000
202300     SET PS-PACK-SKU-FOUND-NO    TO TRUE.                         20230000
202400                                                                  20240000
202500     EXEC SQL                                                     20250000
202600         SELECT PK_SKU_NBR                                        20260000
202700         INTO   :POPRPK-PK-SKU-NBR                                20270000
202800         FROM TPOPRPK                                             20280000
202900         WHERE  PO_NBR       = :RECEIV-ORD-NBR                    20290000
203000           AND  PO_PREPK_ID  = :RECITM-PREPK-ID                   20300000
203100     END-EXEC.                                                    20310000
203200                                                                  20320000
203300     EVALUATE TRUE                                                20330000
203400         WHEN SQLCODE = ZERO                                      20340000
203500              SET PS-PACK-SKU-FOUND TO TRUE                       20350000
203600         WHEN SQLCODE = +100                                      20360000
203700              SET PS-PACK-SKU-FOUND-NO  TO TRUE                   20370000
203800         WHEN SQLWARN0 NOT = SPACES                               20380000
203900         WHEN SQLCODE NOT EQUAL ZERO                              20390000
204000             MOVE '6400-SELECT-PACK-SKU '                         20400000
204100                             TO DP013-PARAGRAPH                   20410000
204200             MOVE 'WSKCS310 - SELECT PACK SKU  '                  20420000
204300                             TO DP013-MESSAGE-TEXT(1)             20430000
204400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 20440000
204500             MOVE RECITM-PREPK-ID TO PV-DISPLAY-PREPK-ID          20450000
204600             STRING 'PO NBR: '         DELIMITED BY SIZE          20460000
204700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          20470000
204800                    'PREPK ID '        DELIMITED BY SIZE          20480000
204900             PV-DISPLAY-PREPK-ID       DELIMITED BY SIZE          20490000
205000                           INTO DP013-MESSAGE-TEXT(2)             20500000
205100             MOVE SQLCA      TO DP013-SQLCA                       20510000
205200             MOVE 'TPOPRPK '                                      20520000
205300                             TO DP013-DB2-TABLE-NAME(1)           20530000
205400             SET DP013-DB2-ABEND                                  20540000
205500                             TO TRUE                              20550000
205600             SET DP013-ROLLBACK                                   20560000
205700                             TO TRUE                              20570000
205800             PERFORM 9999-WRITE-CICS-LOG-MSG                      20580000
205900             SET PS-DUMP-TO-LOG       TO TRUE                     20590000
206000             SET WS007-INVALID-SQL TO TRUE                        20600000
206100* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         20610000
206200             MOVE SQLCODE             TO WS007-SQLCODE            20620000
206300             MOVE '6400-SELECT-PACK-SKU'                          20630000
206400                                      TO WS007-SQL-ERROR-PARA     20640000
206500     END-EVALUATE.                                                20650000
206600                                                                  20660000
206700 6500-INSERT-OTBND-PK.                                            20670000
206710     IF PS-SHOW-DEBUG-INFO                                        20671001
206720         STRING   ' ' WS007-SRC-TASK-NUMBER                       20672001
206730                ' WSKCS310:6500-INSERT-OTBND-PK         '         20673001
206740         DELIMITED BY SIZE                                        20674001
206750         INTO PV-CICS-MSG-AREA                                    20675001
206760         PERFORM 9990-WRITE-CICS                                  20676001
206770     END-IF.                                                      20677001
206780                                                                  20678001
206800                                                                  20680000
206900     MOVE SUT00024-SHIPT-UNT-ID TO SUT00041-SHIPT-UNT-ID.         20690000
207000     MOVE SUT00028-SHPD-UNT-QTY TO SUT00041-SHPD-PK-QTY.          20700000
207100     MOVE RECEIV-ORD-NBR        TO SUT00041-TRN-NBR.              20710000
207200     MOVE RECEIV-REC-SEQ-NBR    TO SUT00041-RCVR-SEQ-NBR.         20720000
207300     MOVE 'PO'                  TO SUT00041-TRN-TYP-CDE.          20730000
207400     MOVE POPRPK-PK-SKU-NBR     TO SUT00041-PK-SKU-NBR.           20740000
207500     MOVE PV-PACK-COUNT         TO SUT00041-SHPD-PK-QTY.          20750000
207600                                                                  20760000
207700     EXEC SQL                                                     20770000
207800         INSERT INTO SUT_OTBND_PK                                 20780000
207900         (                                                        20790000
208000            SHIPT_UNT_ID                                          20800000
208100         ,  TRN_NBR                                               20810000
208200         ,  RCVR_SEQ_NBR                                          20820000
208300         ,  TRN_TYP_CDE                                           20830000
208400         ,  PK_SKU_NBR                                            20840000
208500         ,  SHPD_PK_QTY                                           20850000
208600         )                                                        20860000
208700         VALUES                                                   20870000
208800         (                                                        20880000
208900            :SUT00041-SHIPT-UNT-ID                                20890000
209000         ,  :SUT00041-TRN-NBR                                     20900000
209100         ,  :SUT00041-RCVR-SEQ-NBR                                20910000
209200         ,  :SUT00041-TRN-TYP-CDE                                 20920000
209300         ,  :SUT00041-PK-SKU-NBR                                  20930000
209400         ,  :SUT00041-SHPD-PK-QTY                                 20940000
209500         )                                                        20950000
209600     END-EXEC.                                                    20960000
209700                                                                  20970000
209800     EVALUATE TRUE                                                20980000
209900         WHEN SQLCODE = ZERO                                      20990000
210000         WHEN SQLCODE = +100                                      21000000
210100              CONTINUE                                            21010000
210200         WHEN SQLWARN0 NOT = SPACES                               21020000
210300         WHEN SQLCODE NOT EQUAL ZERO                              21030000
210400             MOVE '6500-INSERT-OTBND-PK '                         21040000
210500                             TO DP013-PARAGRAPH                   21050000
210600             MOVE 'WSKCS310 - INSERT OTBND PACK'                  21060000
210700                             TO DP013-MESSAGE-TEXT(1)             21070000
210800             MOVE SUT00041-TRN-NBR TO PV-DISPLAY-PO-NBR           21080000
210900             MOVE SUT00041-RCVR-SEQ-NBR                           21090000
211000                               TO PV-DISPLAY-RCVR-SEQ-NBR         21100000
211100             STRING 'PO NBR: '         DELIMITED BY SIZE          21110000
211200                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          21120000
211300                    'REC SEQ NBR '     DELIMITED BY SIZE          21130000
211400               PV-DISPLAY-RCVR-SEQ-NBR DELIMITED BY SIZE          21140000
211500                           INTO DP013-MESSAGE-TEXT(2)             21150000
211600             MOVE SQLCA      TO DP013-SQLCA                       21160000
211700             MOVE 'TPOPRPK '                                      21170000
211800                             TO DP013-DB2-TABLE-NAME(1)           21180000
211900             SET DP013-DB2-ABEND                                  21190000
212000                             TO TRUE                              21200000
212100             SET DP013-ROLLBACK                                   21210000
212200                             TO TRUE                              21220000
212300             PERFORM 9999-WRITE-CICS-LOG-MSG                      21230000
212400             SET PS-DUMP-TO-LOG       TO TRUE                     21240000
212500             SET WS007-INVALID-SQL TO TRUE                        21250000
212600* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         21260000
212700             MOVE SQLCODE             TO WS007-SQLCODE            21270000
212800             MOVE '6500-INSERT-OTBND-PK'                          21280000
212900                                      TO WS007-SQL-ERROR-PARA     21290000
213000     END-EVALUATE.                                                21300000
213100                                                                  21310000
213200 6600-PROCESS-VERIF.                                              21320000
213210     IF PS-SHOW-DEBUG-INFO                                        21321001
213220         STRING   ' ' WS007-SRC-TASK-NUMBER                       21322001
213230                ' WSKCS310:6600-PROCESS-VERIF           '         21323001
213240         DELIMITED BY SIZE                                        21324001
213250         INTO PV-CICS-MSG-AREA                                    21325001
213260         PERFORM 9990-WRITE-CICS                                  21326001
213270     END-IF.                                                      21327001
213280                                                                  21328001
213300                                                                  21330000
213400      PERFORM 6700-OPEN-VERIF-LINE-CSR                            21340000
213500      PERFORM 6800-FETCH-VERIF-LINE-CSR                           21350000
213600              UNTIL PS-END-OF-VERIF-LINE-CSR OR                   21360000
213700                    NOT WS007-SUCCESSFUL                          21370000
213800      PERFORM 6900-CLOSE-VERIF-LINE-CSR.                          21380000
213900                                                                  21390000
214000 6700-OPEN-VERIF-LINE-CSR.                                        21400000
214100     IF PS-SHOW-DEBUG-INFO                                        21410000
214200         STRING   ' ' WS007-SRC-TASK-NUMBER                       21420000
214300                ' WSKCS310:6700-OPEN-VERIF-LINE-CSR '             21430000
214400         DELIMITED BY SIZE                                        21440000
214500         INTO PV-CICS-MSG-AREA                                    21450000
214600         PERFORM 9990-WRITE-CICS                                  21460000
214700     END-IF.                                                      21470000
214800                                                                  21480000
214900     EXEC SQL                                                     21490000
215000          OPEN VERIF-LINE-CSR                                     21500000
215100     END-EXEC.                                                    21510000
215200                                                                  21520000
215300     EVALUATE TRUE                                                21530000
215400         WHEN SQLCODE = ZERO                                      21540000
215500              MOVE 0 TO PV-HOLD-PO-NBR                            21550000
215600              MOVE 0 TO PV-HOLD-RCVR-NBR                          21560000
215700              CONTINUE                                            21570000
215800         WHEN SQLWARN0 NOT = SPACES                               21580000
215900         WHEN SQLCODE  < ZERO                                     21590000
216000         WHEN SQLCODE  > ZERO                                     21600000
216100             MOVE '6700-OPEN-VERIF-LINE-CSR '                     21610000
216200                             TO DP013-PARAGRAPH                   21620000
216300             MOVE 'WSKCS310 - OPEN-VERIF-LINE-CSR   '             21630000
216400                             TO DP013-MESSAGE-TEXT(1)             21640000
216500             MOVE VHTRIP-TRIP-ID TO PV-DISPLAY-TRIP-ID            21650000
216600             STRING 'TRIP ID '         DELIMITED BY SIZE          21660000
216700                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          21670000
216800                           INTO DP013-MESSAGE-TEXT(2)             21680000
216900             MOVE SQLCA      TO DP013-SQLCA                       21690000
217000             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           21700000
217100             MOVE 'SUT_OTBND_UPC' TO DP013-DB2-TABLE-NAME(1)      21710000
217200             SET DP013-DB2-ABEND                                  21720000
217300                             TO TRUE                              21730000
217400             SET DP013-ROLLBACK                                   21740000
217500                             TO TRUE                              21750000
217600             PERFORM 9999-WRITE-CICS-LOG-MSG                      21760000
217700             SET PS-DUMP-TO-LOG       TO TRUE                     21770000
217800             SET WS007-INVALID-SQL TO TRUE                        21780000
217900* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         21790000
218000             MOVE SQLCODE             TO WS007-SQLCODE            21800000
218100             MOVE '6700-OPEN-VERIF-LINE-CSR'                      21810000
218200                                      TO WS007-SQL-ERROR-PARA     21820000
218300     END-EVALUATE.                                                21830000
218400                                                                  21840000
218500 EJECT                                                            21850000
218600                                                                  21860000
218700                                                                  21870000
218800 6800-FETCH-VERIF-LINE-CSR.                                       21880000
218900     IF PS-SHOW-DEBUG-INFO                                        21890000
219000         STRING   ' ' WS007-SRC-TASK-NUMBER                       21900000
219100                ' WSKCS310:6800-FETCH-VERIF-LINE-CSR '            21910000
219200         DELIMITED BY SIZE                                        21920000
219300         INTO PV-CICS-MSG-AREA                                    21930000
219400         PERFORM 9990-WRITE-CICS                                  21940000
219500     END-IF.                                                      21950000
219600                                                                  21960000
219700     EXEC SQL                                                     21970000
219800          FETCH VERIF-LINE-CSR                                    21980000
219900           INTO :RECEIV-ORD-NBR                                   21990000
220000             ,  :RECEIV-REC-SEQ-NBR                               22000000
220100             ,  :RECITM-ORD-LNE-NBR                               22010000
220200             ,  :RECEIV-PKGNG-CDE                                 22020000
220300             ,  :RECITM-PREPK-DRV-LNE-CDE                         22030000
220400             ,  :RECITM-PREPK-ID                                  22040000
220500     END-EXEC.                                                    22050000
220600                                                                  22060000
220700     EVALUATE TRUE                                                22070000
220800         WHEN SQLCODE = ZERO                                      22080000
220900               PERFORM 6850-INSERT-DIST-HEADER                    22090000
221000               IF WS007-SUCCESSFUL                                22100000
221100                  PERFORM 7100-CALL-RCKUT124-VEM                  22110000
221200                  IF PS-START-VERIF-TRIGGER-YES                   22120000
221300                      IF RC038-VERIFY-YES                         22130000
221400                          PERFORM 7000-LINK-TO-VERIF-MOD          22140000
221500                      END-IF                                      22150000
221600                  END-IF                                          22160000
221700               END-IF                                             22170000
221800         WHEN SQLCODE = +100                                      22180000
221900              SET PS-END-OF-VERIF-LINE-CSR TO TRUE                22190000
222000         WHEN SQLWARN0 NOT = SPACES                               22200000
222100         WHEN SQLCODE NOT EQUAL ZERO                              22210000
222200             MOVE '6800-FETCH-VERIF-LINE-CSR '                    22220000
222300                             TO DP013-PARAGRAPH                   22230000
222400             MOVE 'WSKCS310 -FETCH-VERIF-LINE-CSR   '             22240000
222500                             TO DP013-MESSAGE-TEXT(1)             22250000
222600             MOVE VHTRIP-TRIP-ID                                  22260000
222700                                 TO PV-DISPLAY-TRIP-ID            22270000
222800             STRING 'TRIP ID '         DELIMITED BY SIZE          22280000
222900                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          22290000
223000                           INTO DP013-MESSAGE-TEXT(2)             22300000
223100             MOVE SQLCA      TO DP013-SQLCA                       22310000
223200             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           22320000
223300             SET DP013-DB2-ABEND                                  22330000
223400                             TO TRUE                              22340000
223500             SET DP013-ROLLBACK                                   22350000
223600                             TO TRUE                              22360000
223700             PERFORM 9999-WRITE-CICS-LOG-MSG                      22370000
223800             SET PS-DUMP-TO-LOG       TO TRUE                     22380000
223900             SET WS007-INVALID-SQL    TO TRUE                     22390000
224000* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         22400000
224100             MOVE SQLCODE             TO WS007-SQLCODE            22410000
224200             MOVE '6800-FETCH-VERIF-LINE-CSR'                     22420000
224300                                      TO WS007-SQL-ERROR-PARA     22430000
224400             SET PS-DUMP-TO-LOG       TO TRUE                     22440000
224500             PERFORM 9999-WRITE-CICS-LOG-MSG                      22450000
224600     END-EVALUATE.                                                22460000
224700                                                                  22470000
224800                                                                  22480000
224900 6850-INSERT-DIST-HEADER.                                         22490000
224910     IF PS-SHOW-DEBUG-INFO                                        22491001
224920         STRING   ' ' WS007-SRC-TASK-NUMBER                       22492001
224930                ' WSKCS310:6850-INSERT-DIST-HEADER  '             22493001
224940         DELIMITED BY SIZE                                        22494001
224950         INTO PV-CICS-MSG-AREA                                    22495001
224960         PERFORM 9990-WRITE-CICS                                  22496001
224961                                                                  22496102
224962         MOVE RECEIV-ORD-NBR      TO PV-DISPLAY-PO-NBR            22496202
224963         MOVE RECEIV-REC-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR      22496302
224964         MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-LINE-NBR          22496402
224965         STRING   ' ' WS007-SRC-TASK-NUMBER                       22496502
224966                ' WSKCS310:'  PV-DISPLAY-PO-NBR                   22496602
224967                         '-'  PV-DISPLAY-RCVR-SEQ-NBR             22496702
224968                         '-'  PV-DISPLAY-LINE-NBR                 22496802
224969         DELIMITED BY SIZE                                        22496902
224970         INTO PV-CICS-MSG-AREA                                    22497002
224971         PERFORM 9990-WRITE-CICS                                  22497102
224972     END-IF.                                                      22497201
224980                                                                  22498001
225000      MOVE RECEIV-ORD-NBR        TO DISTHD-ORD-NBR                22500000
225100      MOVE RECEIV-REC-SEQ-NBR    TO DISTHD-RCVR-SEQ-NBR           22510000
225200      MOVE RECITM-ORD-LNE-NBR    TO DISTHD-ORD-LNE-NBR            22520000
225300      MOVE PC-DEFAULT-TMST       TO DISTHD-RSLTS-RCVD-TMST        22530000
225400                                    DISTHD-VRFD-TMST              22540000
225500                                    DISTHD-FCSE-CNFRMN-TMST       22550000
225600                                    DISTHD-DLT-REQ-TMST.          22560000
225700      MOVE PC-CURRENT-PROGRAM-NAME                                22570000
225800                                   TO DISTHD-CRE-USR-ID.          22580000
225900** CURSOR WILL RETURN THE DRIVER LINE LAST FOR PREPACKS           22590000
226000** DON'T CALL VERIFICATION UNTIL DRIVER LINE IS INSERTED TO       22600000
226100** TDISTHD                                                        22610000
226200                                                                  22620000
226300      IF RECEIV-PKGNG-CDE = 'M' OR 'I'                            22630000
226400         IF RECITM-PREPK-DRV-LNE-CDE  = 'A'                       22640000
226500            MOVE 'D'        TO                                    22650000
226600                                DISTHD-PREPK-LNE-PRC-CDE          22660000
226700            PERFORM 7200-SEL-MAX-RECITM-LNE                       22670000
226800            IF RECITM-PREPK-ID = PV-MAX-PREPK-ID                  22680000
226900               SET PS-START-VERIF-TRIGGER-YES TO TRUE             22690000
227000            END-IF                                                22700000
227100         ELSE                                                     22710000
227200               SET PS-START-VERIF-TRIGGER-NO  TO TRUE             22720000
227300               MOVE 'P'        TO                                 22730000
227400                                DISTHD-PREPK-LNE-PRC-CDE          22740000
227500         END-IF                                                   22750000
227600     ELSE                                                         22760000
227700**9/28/07 CHANGE TO CALL VERIF ONLY ONCE PER RECEIVER             22770000
227800         PERFORM 7200-SEL-MAX-RECITM-LNE                          22780000
227900         IF RECITM-ORD-LNE-NBR = PV-MAX-LNE-NBR                   22790000
228000            SET PS-START-VERIF-TRIGGER-YES TO TRUE                22800000
228100            MOVE SPACE      TO                                    22810000
228200                                DISTHD-PREPK-LNE-PRC-CDE          22820000
228300         END-IF                                                   22830000
228400     END-IF                                                       22840000
228500                                                                  22850000
228600     EXEC SQL                                                     22860000
228700          INSERT INTO TDISTHD                                     22870000
228800           ( ORD_NBR                                              22880000
228900            ,RCVR_SEQ_NBR                                         22890000
229000            ,ORD_LNE_NBR                                          22900000
229100            ,WRK_ORD_SEQ_NBR                                      22910000
229200            ,OPER_UNT_ID                                          22920000
229300            ,DISTRB_PRC_AREA_ID                                   22930000
229400            ,PRCG_STAT_CDE                                        22940000
229500            ,CRE_TMST                                             22950000
229600            ,RSLTS_RCVD_TMST                                      22960000
229700            ,VRFD_TMST                                            22970000
229800            ,PRC_AREA_MODU_ID                                     22980000
229900            ,CRE_USR_ID                                           22990000
230000            ,TOT_CART_CNT                                         23000000
230100            ,CART_DWNLD_DTE                                       23010000
230200            ,CART_DWNLD_TM                                        23020000
230300            ,CART_DWNLD_USR_ID                                    23030000
230400            ,FCSE_CART_CNT                                        23040000
230500            ,FCSE_LBL_TYP_CDE                                     23050000
230600            ,P2L_CART_CNT                                         23060000
230700            ,INPK_CART_CNT                                        23070000
230800            ,INPK_UNT_QTY                                         23080000
230900            ,INPK_CNVYB_IND                                       23090000
231000            ,OTPK_UNT_QTY                                         23100000
231100            ,SYS_CRE_CDE                                          23110000
231200            ,SPC_INSTR_DESC                                       23120000
231300            ,FCSE_CNFRMN_TMST                                     23130000
231400            ,CRE_LBL_OPT_CDE                                      23140000
231500            ,FCSE_FCLTY_AREA_ID                                   23150000
231600            ,ODD_CART_UNT_QTY                                     23160000
231700            ,DLT_REQ_TMST                                         23170000
231800            ,PREPK_LNE_PRC_CDE                                    23180000
231900            ,CAL_UNT_PRCD_QTY                                     23190000
232000            ,UCC128_DAT_USG_CDE                                   23200000
232100            ,P2L_SCN_CART_CNT                                     23210000
232200           )                                                      23220000
232300         VALUES (                                                 23230000
232400             :DISTHD-ORD-NBR                                      23240000
232500           , :DISTHD-RCVR-SEQ-NBR                                 23250000
232600           , :DISTHD-ORD-LNE-NBR                                  23260000
232700           , 1                                                    23270000
232800           , :DK-OPER-UNT-ID                                      23280000
232900           , 'P2L'                                                23290000
233000           , 'D'                                                  23300000
233100           ,  CURRENT TIMESTAMP                                   23310000
233200           , :DISTHD-RSLTS-RCVD-TMST                              23320000
233300           , :DISTHD-VRFD-TMST                                    23330000
233400           , ' '                                                  23340000
233500           , :DISTHD-CRE-USR-ID                                   23350000
233600           , 1                                                    23360000
233700           , CURRENT DATE                                         23370000
233800           , CURRENT TIME                                         23380000
233900           , :PC-CURRENT-PROGRAM-NAME                             23390000
234000           , 1                                                    23400000
234100           , 'X'                                                  23410000
234200           , 0                                                    23420000
234300           , 0                                                    23430000
234400           , 1                                                    23440000
234500           , 'N'                                                  23450000
234600           , 1                                                    23460000
234700           , 'F'                                                  23470000
234800           , ' '                                                  23480000
234900           , :DISTHD-FCSE-CNFRMN-TMST                             23490000
235000           , 'C'                                                  23500000
235100           , 'RECV'                                               23510000
235200           , 0                                                    23520000
235300           , :DISTHD-DLT-REQ-TMST                                 23530000
235400           , :DISTHD-PREPK-LNE-PRC-CDE                            23540000
235500           , 0                                                    23550000
235600           , 'N'                                                  23560000
235700           , 0                                                    23570000
235800         )                                                        23580000
235900     END-EXEC.                                                    23590000
236000                                                                  23600000
236100     EVALUATE TRUE                                                23610000
236200         WHEN SQLCODE = ZERO                                      23620000
236300              CONTINUE                                            23630000
236400         WHEN SQLCODE = -803                                      23640000
236500                                                                  23650003
236600              PERFORM 6860-SEL-TDISTHD                            23660000
236610                                                                  23661003
236700              IF DISTHD-TOT-CART-CNT   >  0                       23670000
236800                 MOVE SQLCODE        TO PV-DISPLAY-SQLCODE        23680003
237200                 MOVE DISTHD-ORD-NBR TO PV-DISPLAY-PO-NBR         23720000
237300                 MOVE DISTHD-RCVR-SEQ-NBR                         23730000
237400                                     TO PV-DISPLAY-RCVR-SEQ-NBR   23740000
237500                 MOVE DISTHD-ORD-LNE-NBR                          23750000
237600                                     TO PV-DISPLAY-LINE-NBR       23760000
237601                                                                  23760103
237602                 MOVE SPACES         TO PV-CICS-MSG-AREA          23760203
237603                 STRING   ' ' WS007-SRC-TASK-NUMBER               23760303
237604                          ' WSKCS310:6850-INSERT-DIST-HEADER'     23760403
237605                                        DELIMITED BY SIZE         23760503
237606                                   INTO PV-CICS-MSG-AREA          23760603
237608                 MOVE LENGTH OF PV-CICS-MSG-AREA                  23760803
237609                   TO PV-COMMAREA-LENGTH                          23760903
237610                 EXEC CICS                                        23761003
237611                      WRITEQ TD                                   23761103
237612                       QUEUE   ('CSSL')                           23761203
237613                        FROM   (PV-CICS-MSG-AREA)                 23761303
237614                      LENGTH   (PV-COMMAREA-LENGTH)               23761403
237615                        RESP   (PV-CICS-RESP)                     23761503
237616                 END-EXEC                                         23761603
237617                                                                  23761703
237618                 MOVE SPACES         TO PV-CICS-MSG-AREA          23761803
237619                 STRING   ' ' WS007-SRC-TASK-NUMBER               23761903
237620                          ' WSKCS310: '                           23762003
237700                        'PO:'           PV-DISPLAY-PO-NBR         23770005
237800                        '-'             PV-DISPLAY-RCVR-SEQ-NBR   23780003
238200                        '-'             PV-DISPLAY-LINE-NBR       23820003
238201                        ' TDISTHD SQL:' PV-DISPLAY-SQLCODE        23820104
238202                                        DELIMITED BY SIZE         23820203
238300                                   INTO PV-CICS-MSG-AREA          23830003
238310                 MOVE LENGTH OF PV-CICS-MSG-AREA                  23831003
238320                   TO PV-COMMAREA-LENGTH                          23832003
238330                 EXEC CICS                                        23833003
238340                      WRITEQ TD                                   23834003
238350                       QUEUE   ('CSSL')                           23835003
238360                        FROM   (PV-CICS-MSG-AREA)                 23836003
238370                      LENGTH   (PV-COMMAREA-LENGTH)               23837003
238380                        RESP   (PV-CICS-RESP)                     23838003
238390                 END-EXEC                                         23839003
238391                                                                  23839103
239700              ELSE                                                23970000
239800                 PERFORM 6875-UPDATE-DIST-HEADER                  23980000
239900              END-IF                                              23990000
239910                                                                  23991003
240000         WHEN SQLWARN0 NOT = SPACES                               24000000
240100         WHEN SQLCODE  < ZERO                                     24010000
240200         WHEN SQLCODE  > ZERO                                     24020000
240300             MOVE SQLCODE    TO PV-DISPLAY-SQLCODE                24030003
240310             MOVE '6850-INSERT-DIST-HEADER '                      24031003
240400                             TO DP013-PARAGRAPH                   24040000
240500             MOVE 'WSKCS310 -INSERT TDISTHD '                     24050000
240600                             TO DP013-MESSAGE-TEXT(1)             24060000
240700             MOVE DISTHD-ORD-NBR TO PV-DISPLAY-PO-NBR             24070000
240800             MOVE DISTHD-RCVR-SEQ-NBR                             24080000
240900                                 TO PV-DISPLAY-RCVR-SEQ-NBR       24090000
241000             MOVE DISTHD-ORD-LNE-NBR                              24100000
241100                                 TO PV-DISPLAY-LINE-NBR           24110000
241200             STRING 'PO:'           PV-DISPLAY-PO-NBR             24120003
241500                    '-'             PV-DISPLAY-RCVR-SEQ-NBR       24150003
241700                    '-'             PV-DISPLAY-LINE-NBR           24170003
241710                    ' SQL:'         PV-DISPLAY-SQLCODE            24171003
241720                                    DELIMITED BY SIZE             24172003
241800                               INTO DP013-MESSAGE-TEXT(2)         24180003
241900             MOVE SQLCA          TO DP013-SQLCA                   24190003
242000             MOVE 'TDISTHD  '    TO DP013-DB2-TABLE-NAME(1)       24200003
242100             SET DP013-DB2-ABEND                                  24210000
242200                             TO TRUE                              24220000
242300             SET DP013-ROLLBACK                                   24230000
242400                             TO TRUE                              24240000
242500             PERFORM 9999-WRITE-CICS-LOG-MSG                      24250000
242600             SET PS-DUMP-TO-LOG       TO TRUE                     24260000
242700             SET WS007-INVALID-SQL TO TRUE                        24270000
242800* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         24280000
242900             MOVE SQLCODE             TO WS007-SQLCODE            24290000
243000             MOVE '6850-INSERT-DIST-HEADER'                       24300000
243100                                      TO WS007-SQL-ERROR-PARA     24310000
243200     END-EVALUATE.                                                24320000
243300                                                                  24330000
243400 6860-SEL-TDISTHD.                                                24340000
243410     IF PS-SHOW-DEBUG-INFO                                        24341001
243420         STRING   ' ' WS007-SRC-TASK-NUMBER                       24342001
243430                ' WSKCS310:6860-SEL-TDISTHD         '             24343001
243440         DELIMITED BY SIZE                                        24344001
243450         INTO PV-CICS-MSG-AREA                                    24345001
243460         PERFORM 9990-WRITE-CICS                                  24346001
243470     END-IF.                                                      24347001
243480                                                                  24348001
243500     EXEC SQL                                                     24350000
243600         SELECT                                                   24360000
243700               TOT_CART_CNT                                       24370000
243800         INTO  :DISTHD-TOT-CART-CNT                               24380000
243900         FROM   TDISTHD                                           24390000
244000         WHERE  ORD_NBR      = :DISTHD-ORD-NBR                    24400000
244100          AND   RCVR_SEQ_NBR = :DISTHD-RCVR-SEQ-NBR               24410000
244200          AND   ORD_LNE_NBR  = :DISTHD-ORD-LNE-NBR                24420000
244300     END-EXEC                                                     24430000
244400                                                                  24440000
244500     EVALUATE TRUE                                                24450000
244600         WHEN SQLCODE = ZERO                                      24460000
244700         WHEN SQLCODE = +100                                      24470000
244800              CONTINUE                                            24480000
244900         WHEN SQLWARN0 NOT = SPACES                               24490000
245000         WHEN SQLCODE NOT EQUAL ZERO                              24500000
245100             MOVE '6860-SEL-TDISTHD '                             24510000
245200                             TO DP013-PARAGRAPH                   24520000
245300             MOVE 'WSKCS310 -SELECT TDISTHD '                     24530000
245400                             TO DP013-MESSAGE-TEXT(1)             24540000
245500             MOVE DISTHD-ORD-NBR TO PV-DISPLAY-PO-NBR             24550000
245600             MOVE DISTHD-RCVR-SEQ-NBR                             24560000
245700                                 TO PV-DISPLAY-RCVR-SEQ-NBR       24570000
245800             MOVE DISTHD-ORD-LNE-NBR                              24580000
245900                                 TO PV-DISPLAY-LINE-NBR           24590000
246000             STRING 'PO NBR: '         DELIMITED BY SIZE          24600000
246100                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          24610000
246200                 'REC SEQ NBR '        DELIMITED BY SIZE          24620000
246300                 PV-DISPLAY-RCVR-SEQ-NBR DELIMITED BY SIZE        24630000
246400                 'LINE '               DELIMITED BY SIZE          24640000
246500                 PV-DISPLAY-LINE-NBR   DELIMITED BY SIZE          24650000
246600                           INTO DP013-MESSAGE-TEXT(2)             24660000
246700             MOVE SQLCA      TO DP013-SQLCA                       24670000
246800             MOVE 'TDISTHD  ' TO DP013-DB2-TABLE-NAME(1)          24680000
246900             SET DP013-DB2-ABEND                                  24690000
247000                             TO TRUE                              24700000
247100             SET DP013-ROLLBACK                                   24710000
247200                             TO TRUE                              24720000
247300             PERFORM 9999-WRITE-CICS-LOG-MSG                      24730000
247400             SET PS-DUMP-TO-LOG       TO TRUE                     24740000
247500             SET WS007-INVALID-SQL TO TRUE                        24750000
247600             MOVE SQLCODE             TO WS007-SQLCODE            24760000
247700             MOVE '6860-SEL-TDISTHD '                             24770000
247800                                      TO WS007-SQL-ERROR-PARA     24780000
247900     END-EVALUATE.                                                24790000
248000                                                                  24800000
248100*----------------------------------------------------------------*24810000
248200*                                                                 24820000
248300*----------------------------------------------------------------*24830000
248400 6875-UPDATE-DIST-HEADER.                                         24840000
248410     IF PS-SHOW-DEBUG-INFO                                        24841001
248420         STRING   ' ' WS007-SRC-TASK-NUMBER                       24842001
248430                ' WSKCS310:6875-UPDATE-DIST-HEADER  '             24843001
248440         DELIMITED BY SIZE                                        24844001
248450         INTO PV-CICS-MSG-AREA                                    24845001
248460         PERFORM 9990-WRITE-CICS                                  24846001
248470     END-IF.                                                      24847001
248480                                                                  24848001
248500                                                                  24850000
248600     MOVE 1 TO DISTHD-WRK-ORD-SEQ-NBR.                            24860000
248700     MOVE DK-OPER-UNT-ID TO DISTHD-OPER-UNT-ID.                   24870000
248800     MOVE 'P2L' TO DISTHD-DISTRB-PRC-AREA-ID.                     24880000
248900     MOVE 'D' TO DISTHD-PRCG-STAT-CDE.                            24890000
249000     MOVE ' ' TO DISTHD-PRC-AREA-MODU-ID.                         24900000
249100     MOVE 1   TO DISTHD-TOT-CART-CNT.                             24910000
249200     MOVE 1   TO DISTHD-FCSE-CART-CNT.                            24920000
249300     MOVE 'X' TO DISTHD-FCSE-LBL-TYP-CDE.                         24930000
249400     MOVE 0   TO DISTHD-P2L-CART-CNT.                             24940000
249500     MOVE 0   TO DISTHD-INPK-CART-CNT.                            24950000
249600     MOVE 1   TO DISTHD-INPK-UNT-QTY.                             24960000
249700     MOVE 'N' TO DISTHD-INPK-CNVYB-IND.                           24970000
249800     MOVE 1   TO DISTHD-OTPK-UNT-QTY.                             24980000
249900     MOVE 'F' TO DISTHD-SYS-CRE-CDE.                              24990000
250000     MOVE 'C' TO DISTHD-CRE-LBL-OPT-CDE.                          25000000
250100     MOVE 'RECV' TO DISTHD-FCSE-FCLTY-AREA-ID.                    25010000
250200     MOVE ' '    TO DISTHD-SPC-INSTR-DESC.                        25020000
250300     MOVE 0      TO DISTHD-CAL-UNT-PRCD-QTY.                      25030000
250400     MOVE 'N'    TO DISTHD-UCC128-DAT-USG-CDE.                    25040000
250500     MOVE 0      TO DISTHD-P2L-SCN-CART-CNT.                      25050000
250600     EXEC SQL                                                     25060000
250700          UPDATE TDISTHD                                          25070000
250800             SET                                                  25080000
250900                 TOT_CART_CNT        = :DISTHD-TOT-CART-CNT       25090000
251000               , P2L_CART_CNT        = :DISTHD-P2L-CART-CNT       25100000
251100               , INPK_UNT_QTY        = :DISTHD-INPK-UNT-QTY       25110000
251200               , OTPK_UNT_QTY        = :DISTHD-OTPK-UNT-QTY       25120000
251300               , CART_DWNLD_USR_ID   = :DISTHD-CART-DWNLD-USR-ID  25130000
251400               , FCSE_CART_CNT       = :DISTHD-FCSE-CART-CNT      25140000
251500               , INPK_CART_CNT       = :DISTHD-INPK-CART-CNT      25150000
251600               , PRC_AREA_MODU_ID    = :DISTHD-PRC-AREA-MODU-ID   25160000
251700               , PRCG_STAT_CDE       = :DISTHD-PRCG-STAT-CDE      25170000
251800               , CRE_USR_ID          = :DISTHD-CRE-USR-ID         25180000
251900               , CART_DWNLD_DTE      =  CURRENT DATE              25190000
252000               , CART_DWNLD_TM       =  CURRENT TIME              25200000
252100               , FCSE_LBL_TYP_CDE    = :DISTHD-FCSE-LBL-TYP-CDE   25210000
252200               , INPK_CNVYB_IND      = :DISTHD-INPK-CNVYB-IND     25220000
252300               , SYS_CRE_CDE         = :DISTHD-SYS-CRE-CDE        25230000
252400               , CRE_TMST            =  CURRENT TIMESTAMP         25240000
252500               , FCSE_FCLTY_AREA_ID  = :DISTHD-FCSE-FCLTY-AREA-ID 25250000
252600               , CRE_LBL_OPT_CDE     = :DISTHD-CRE-LBL-OPT-CDE    25260000
252700               , ODD_CART_UNT_QTY    = :DISTHD-ODD-CART-UNT-QTY   25270000
252800               , PREPK_LNE_PRC_CDE   = :DISTHD-PREPK-LNE-PRC-CDE  25280000
252900               , CAL_UNT_PRCD_QTY    = :DISTHD-CAL-UNT-PRCD-QTY   25290000
253000               , UCC128_DAT_USG_CDE  = :DISTHD-UCC128-DAT-USG-CDE 25300000
253100               , VRTL_LBL_PRC_CNT    = :DISTHD-VRTL-LBL-PRC-CNT   25310000
253200           WHERE ORD_NBR             = :DISTHD-ORD-NBR            25320000
253300             AND RCVR_SEQ_NBR        = :DISTHD-RCVR-SEQ-NBR       25330000
253400             AND ORD_LNE_NBR         = :DISTHD-ORD-LNE-NBR        25340000
253500     END-EXEC.                                                    25350000
253600                                                                  25360000
253700     EVALUATE TRUE                                                25370000
253800         WHEN SQLCODE = ZERO                                      25380000
253900              CONTINUE                                            25390000
254000         WHEN SQLWARN0 NOT = SPACES                               25400000
254100         WHEN SQLCODE  < ZERO                                     25410000
254200         WHEN SQLCODE  > ZERO                                     25420000
254300             MOVE SQLCODE    TO PV-DISPLAY-SQLCODE                25430003
254310             MOVE '6875-UPDATE-DIST-HEADER '                      25431003
254400                             TO DP013-PARAGRAPH                   25440000
254500             MOVE 'WSKCS310 -UPDATE TDISTHD '                     25450000
254600                             TO DP013-MESSAGE-TEXT(1)             25460000
254700             MOVE DISTHD-ORD-NBR TO PV-DISPLAY-PO-NBR             25470000
254800             MOVE DISTHD-RCVR-SEQ-NBR                             25480000
254900                                 TO PV-DISPLAY-RCVR-SEQ-NBR       25490000
255000             MOVE DISTHD-ORD-LNE-NBR                              25500000
255100                                 TO PV-DISPLAY-LINE-NBR           25510000
255200             STRING 'PO:'           PV-DISPLAY-PO-NBR             25520003
255500                    '-'             PV-DISPLAY-RCVR-SEQ-NBR       25550003
255700                    '-'             PV-DISPLAY-LINE-NBR           25570003
255710                    ' SQL:'         PV-DISPLAY-SQLCODE            25571003
255720                                    DELIMITED BY SIZE             25572003
255800                           INTO DP013-MESSAGE-TEXT(2)             25580000
255900             MOVE SQLCA      TO DP013-SQLCA                       25590000
256000             MOVE 'TDISTHD  ' TO DP013-DB2-TABLE-NAME(1)          25600000
256100             SET DP013-DB2-ABEND                                  25610000
256200                             TO TRUE                              25620000
256300             SET DP013-ROLLBACK                                   25630000
256400                             TO TRUE                              25640000
256500             PERFORM 9999-WRITE-CICS-LOG-MSG                      25650000
256600             SET PS-DUMP-TO-LOG       TO TRUE                     25660000
256700             SET WS007-INVALID-SQL TO TRUE                        25670000
256800* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         25680000
256900             MOVE SQLCODE             TO WS007-SQLCODE            25690000
257000             MOVE '6875-UPDATE-DIST-HEADER'                       25700000
257100                                      TO WS007-SQL-ERROR-PARA     25710000
257200     END-EVALUATE.                                                25720000
257300*----------------------------------------------------------------*25730000
257400* CLOSE THE LINE STORE CURSOR                                  *  25740000
257500*----------------------------------------------------------------*25750000
257600 6900-CLOSE-VERIF-LINE-CSR.                                       25760000
257700     IF PS-SHOW-DEBUG-INFO                                        25770000
257800         STRING   ' ' WS007-SRC-TASK-NUMBER                       25780000
257900                ' WSKCS310:6900-CLOSE-VERIF-LINE-CSR '            25790000
258000         DELIMITED BY SIZE                                        25800000
258100         INTO PV-CICS-MSG-AREA                                    25810000
258200         PERFORM 9990-WRITE-CICS                                  25820000
258300     END-IF.                                                      25830000
258400                                                                  25840000
258500     EXEC SQL                                                     25850000
258600          CLOSE VERIF-LINE-CSR                                    25860000
258700     END-EXEC.                                                    25870000
258800                                                                  25880000
258900     EVALUATE TRUE                                                25890000
259000         WHEN SQLCODE = ZERO                                      25900000
259100              CONTINUE                                            25910000
259200         WHEN SQLWARN0 NOT = SPACES                               25920000
259300         WHEN SQLCODE  < ZERO                                     25930000
259400         WHEN SQLCODE  > ZERO                                     25940000
259500             MOVE '6900-CLOSE-VERIF-LINE-CSR '                    25950000
259600                             TO DP013-PARAGRAPH                   25960000
259700             MOVE 'WSKCS310 -CLOSE-VERIF-LINE-CSR '               25970000
259800                             TO DP013-MESSAGE-TEXT(1)             25980000
259900             MOVE VHTRIP-TRIP-ID                                  25990000
260000                                 TO PV-DISPLAY-TRIP-ID            26000000
260100             STRING 'TRIP ID '         DELIMITED BY SIZE          26010000
260200                 PV-DISPLAY-TRIP-ID    DELIMITED BY SIZE          26020000
260300                           INTO DP013-MESSAGE-TEXT(2)             26030000
260400             MOVE SQLCA      TO DP013-SQLCA                       26040000
260500             MOVE 'TRECITM  ' TO DP013-DB2-TABLE-NAME(1)          26050000
260600             SET DP013-DB2-ABEND                                  26060000
260700                             TO TRUE                              26070000
260800             SET DP013-ROLLBACK                                   26080000
260900                             TO TRUE                              26090000
261000             PERFORM 9999-WRITE-CICS-LOG-MSG                      26100000
261100             SET PS-DUMP-TO-LOG       TO TRUE                     26110000
261200             SET WS007-INVALID-SQL TO TRUE                        26120000
261300* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         26130000
261400             MOVE SQLCODE             TO WS007-SQLCODE            26140000
261500             MOVE '6900-CLOSE-VERIF-LINE-CSR'                     26150000
261600                                      TO WS007-SQL-ERROR-PARA     26160000
261700     END-EVALUATE.                                                26170000
261800                                                                  26180000
261900 6950-UPDATE-TDISTHD.                                             26190000
261910     IF PS-SHOW-DEBUG-INFO                                        26191001
261920         STRING   ' ' WS007-SRC-TASK-NUMBER                       26192001
261930                ' WSKCS310:6950-UPDATE-TDISTHD      '             26193001
261940         DELIMITED BY SIZE                                        26194001
261950         INTO PV-CICS-MSG-AREA                                    26195001
261960         PERFORM 9990-WRITE-CICS                                  26196001
261970     END-IF.                                                      26197001
261980                                                                  26198001
262000                                                                  26200000
262100     EXEC SQL                                                     26210000
262200         UPDATE TDISTHD                                           26220000
262300             SET PRCG_STAT_CDE   = :DISTHD-PRCG-STAT-CDE          26230000
262400               , VRFD_TMST       = :PC-DEFAULT-TMST               26240000
262500         WHERE  ORD_NBR             = :DISTHD-ORD-NBR             26250000
262600           AND  RCVR_SEQ_NBR        = :DISTHD-RCVR-SEQ-NBR        26260000
262700     END-EXEC.                                                    26270000
262800                                                                  26280000
262900     EVALUATE TRUE                                                26290000
263000         WHEN SQLCODE = ZERO                                      26300000
263100         WHEN SQLCODE = +100                                      26310000
263200              CONTINUE                                            26320000
263300         WHEN SQLWARN0 NOT = SPACES                               26330000
263400         WHEN SQLCODE NOT EQUAL ZERO                              26340000
263500             SET PS-ERROR             TO TRUE                     26350000
263600             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       26360000
263700             STRING   ' ' WS007-SRC-TASK-NUMBER                   26370000
263800                      ' WSKCS310:6950-'                           26380000
263900                      ' CALLED BY-'                               26390000
264000                      PV-CALLING-PGM                              26400000
264100                      '  SQLCODE='                                26410000
264200                      PV-DISPLAY-SQLCODE                          26420000
264300                      ' '                                         26430000
264400                      DELIMITED BY SIZE                           26440000
264500                                      INTO PV-CICS-MSG-AREA       26450000
264600             PERFORM 9999-WRITE-TO-CSSL                           26460000
264700             SET WS007-INVALID-SQL TO TRUE                        26470000
264800* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         26480000
264900             MOVE SQLCODE             TO WS007-SQLCODE            26490000
265000             MOVE '6950-UPDATE-TDISTHD'                           26500000
265100                                      TO WS007-SQL-ERROR-PARA     26510000
265200             PERFORM 9998-RETURN                                  26520000
265300     END-EVALUATE.                                                26530000
265400*----------------------------------------------------------------*26540000
265500*----------------------------------------------------------------*26550000
265600 7000-LINK-TO-VERIF-MOD.                                          26560000
265610     IF PS-SHOW-DEBUG-INFO                                        26561001
265620         STRING   ' ' WS007-SRC-TASK-NUMBER                       26562001
265630                ' WSKCS310:7000-LINK-TO-VERIF-MOD   '             26563001
265640         DELIMITED BY SIZE                                        26564001
265650         INTO PV-CICS-MSG-AREA                                    26565001
265660         PERFORM 9990-WRITE-CICS                                  26566001
265670     END-IF.                                                      26567001
265680                                                                  26568001
265700      INITIALIZE               RC289-COMMAREA-FOR-E200.           26570000
265800      MOVE RECEIV-ORD-NBR          TO   RC289-ORD-NBR             26580000
265900      MOVE RECEIV-REC-SEQ-NBR      TO   RC289-RCVR-SEQ-NBR        26590000
266000      MOVE RECITM-ORD-LNE-NBR      TO   RC289-ORD-LNE-NBR         26600000
266001                                                                  26600106
266010     IF PS-SHOW-DEBUG-INFO                                        26601006
266012        MOVE RC289-ORD-NBR         TO  PV-DISPLAY-PO-NBR          26601206
266013        MOVE RC289-RCVR-SEQ-NBR    TO  PV-DISPLAY-RCVR-SEQ-NBR    26601306
266016        MOVE RC289-ORD-LNE-NBR     TO  PV-DISPLAY-LINE-NBR        26601606
266022         STRING   ' ' WS007-SRC-TASK-NUMBER                       26602206
266030                ' WSKCS310:START W313 '                           26603006
266031                PV-DISPLAY-PO-NBR         '-'                     26603106
266032                PV-DISPLAY-RCVR-SEQ-NBR   '-'                     26603206
266033                PV-DISPLAY-LINE-NBR       '-'                     26603306
266040         DELIMITED BY SIZE                                        26604006
266050         INTO PV-CICS-MSG-AREA                                    26605006
266060         PERFORM 9990-WRITE-CICS                                  26606006
266070     END-IF.                                                      26607006
266100                                                                  26610000
266200      MOVE WS014-CRE-USER-ID       TO   RC289-USER-ID             26620000
266300      MOVE PC-CURRENT-PROGRAM-NAME TO   RC289-CALLING-PROGRAM     26630000
266400****  MOVE RECITM-ORD-LNE-NBR      TO   RC289-DC-FUNCTION-CODE    26640000
266500                                                                  26650000
266600                                                                  26660000
266700     EXEC CICS                                                    26670000
266800          START TRANSID (PC-WM-CRTN-VERIF-TRIGGER)                26680000
266900               FROM (RC289-COMMAREA-FOR-E200)                     26690000
267000     END-EXEC.                                                    26700000
267100*----------------------------------------------------------------*26710000
267200                                                                  26720000
267300******************************************************************26730000
267400*  CALL TO VEM (VERIFICATION ELIGIBILITY MODULE - RCKUT124)       26740000
267500******************************************************************26750000
267600 7100-CALL-RCKUT124-VEM.                                          26760000
267610     IF PS-SHOW-DEBUG-INFO                                        26761001
267620         STRING   ' ' WS007-SRC-TASK-NUMBER                       26762001
267630                ' WSKCS310:7100-CALL-RCKUT124-VEM   '             26763001
267640         DELIMITED BY SIZE                                        26764001
267650         INTO PV-CICS-MSG-AREA                                    26765001
267660         PERFORM 9990-WRITE-CICS                                  26766001
267670     END-IF.                                                      26767001
267680                                                                  26768001
267700                                                                  26770000
267800     INITIALIZE RC038-FIELDS.                                     26780000
267900     MOVE RECEIV-ORD-NBR       TO RC038-PO-NBR                    26790000
268000     MOVE RECEIV-REC-SEQ-NBR   TO RC038-REC-SEQ-NBR.              26800000
268100     MOVE WS014-CRE-USER-ID    TO RC038-USER-ID.                  26810000
268200     MOVE WS014-DC-LOCATION    TO RC038-OPER-UNT-ID.              26820000
268300     MOVE 1                    TO RC038-FCLTY-ID.                 26830000
268400     MOVE 'WSKCS310'           TO RC038-PROGRAM-NAME.             26840000
268500     SET RC038-PBS                                                26850000
268600         RC038-PROCESS-NO-UPDATE TO TRUE.                         26860000
268700     MOVE 'Y'                  TO RC038-VERIFY-SW.                26870000
268800     MOVE 'N'                  TO RC038-AUTOVE-PO-SW.             26880000
268900                                                                  26890000
269000     MOVE LENGTH OF RC038-FIELDS         TO PV-COMMAREA-LENGTH.   26900000
269100                                                                  26910000
269200     EXEC CICS                                                    26920000
269300         LINK PROGRAM  (PC-RCKUT124)                              26930000
269400              COMMAREA (RC038-FIELDS)                             26940000
269500              LENGTH   (PV-COMMAREA-LENGTH)                       26950000
269600              RESP     (PV-CICS-RESP)                             26960000
269700     END-EXEC.                                                    26970000
269800                                                                  26980000
269900     EVALUATE TRUE                                                26990000
270000         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     27000000
270100             IF  RC038-INVALID-SQL     OR                         27010000
270200                 RC038-DATABASE-BUSY                              27020000
270300                 MOVE '7100-CALL-RCKUT124-VEM'                    27030000
270400                                 TO DP013-PARAGRAPH               27040000
270500                 MOVE 'WSKCS310-BAD RETURN FROM RCKUT124 '        27050000
270600                                     TO DP013-MESSAGE-TEXT(1)     27060000
270700                 SET DP013-DB2-ABEND TO TRUE                      27070000
270800                 SET DP013-ROLLBACK  TO TRUE                      27080000
270900                 PERFORM 9999-WRITE-CICS-LOG-MSG                  27090000
271000                 SET PS-DUMP-TO-LOG  TO TRUE                      27100000
271100* JAK 08/2007 - LOAD ERROR PARA, CHG ERROR INDICATOR              27110000
271200*****            SET WS007-ERROR     TO TRUE                      27120000
271300                 SET WS007-VEM-ERROR     TO TRUE                  27130000
271400                 MOVE '7100-CALL-RCKUT124-VEM'                    27140000
271500                                         TO WS007-SQL-ERROR-PARA  27150000
271600             END-IF                                               27160000
271700             IF RC038-VERIFY-NO                                   27170000
271800                MOVE RC038-PO-NBR      TO DISTHD-ORD-NBR          27180000
271900                MOVE RC038-REC-SEQ-NBR TO DISTHD-RCVR-SEQ-NBR     27190000
272000                MOVE RC038-NO-VERIFY-REASON TO                    27200000
272100                                          DISTHD-PRCG-STAT-CDE    27210000
272200                PERFORM 6950-UPDATE-TDISTHD                       27220000
272300             END-IF                                               27230000
272400         WHEN OTHER                                               27240000
272500             MOVE PV-CICS-RESP          TO PV-DISPLAY-CICS-RESP   27250000
272600             STRING ' RCKUT129 (OTHER) -' DELIMITED BY SIZE       27260000
272700                    ' CICS RESP = '       DELIMITED BY SIZE       27270000
272800                    PV-DISPLAY-CICS-RESP  DELIMITED BY SIZE       27280000
272900                               INTO DP013-MESSAGE-TEXT(1)         27290000
273000             SET DP013-DB2-ABEND         TO TRUE                  27300000
273100             SET DP013-NO-ROLLBACK       TO TRUE                  27310000
273200             MOVE '7100-CALL-RCKUT124-VEM'                        27320000
273300                                 TO DP013-PARAGRAPH               27330000
273400             PERFORM 9999-WRITE-CICS-LOG-MSG                      27340000
273500             SET PS-DUMP-TO-LOG  TO TRUE                          27350000
273600* JAK 08/2007 - LOAD ERROR PARA, CHG ERROR INDICATOR              27360000
273700*****        SET WS007-ERROR     TO TRUE                          27370000
273800             SET WS007-VEM-ERROR     TO TRUE                      27380000
273900             MOVE '7100-CALL-RCKUT124-VEM'                        27390000
274000                                     TO WS007-SQL-ERROR-PARA      27400000
274100     END-EVALUATE.                                                27410000
274200                                                                  27420000
274300/                                                                 27430000
274400*                                                                *27440000
274500*----------------------------------------------------------------*27450000
274600                                                                  27460000
274700 7200-SEL-MAX-RECITM-LNE.                                         27470000
274710     IF PS-SHOW-DEBUG-INFO                                        27471001
274720         STRING   ' ' WS007-SRC-TASK-NUMBER                       27472001
274730                ' WSKCS310:7200-SEL-MAX-RECITM-LNE  '             27473001
274740         DELIMITED BY SIZE                                        27474001
274750         INTO PV-CICS-MSG-AREA                                    27475001
274760         PERFORM 9990-WRITE-CICS                                  27476001
274770     END-IF.                                                      27477001
274780                                                                  27478001
274800                                                                  27480000
274900     INITIALIZE PV-MAX-LNE-NBR                                    27490000
275000                                                                  27500000
275100     EXEC SQL                                                     27510000
275200         SELECT                                                   27520000
275300               MAX(ORD_LNE_NBR)                                   27530000
275400            ,  MAX(PREPK_ID)                                      27540000
275500         INTO  :PV-MAX-LNE-NBR                                    27550000
275600             , :PV-MAX-PREPK-ID                                   27560000
275700         FROM   TRECITM                                           27570000
275800         WHERE  ORD_NBR      = :RECEIV-ORD-NBR                    27580000
275900          AND   REC_SEQ_NBR  = :RECEIV-REC-SEQ-NBR                27590000
276000     END-EXEC                                                     27600000
276100                                                                  27610000
276200     EVALUATE TRUE                                                27620000
276300         WHEN SQLCODE = ZERO                                      27630000
276400         WHEN SQLCODE = +100                                      27640000
276500              CONTINUE                                            27650000
276600         WHEN SQLWARN0 NOT = SPACES                               27660000
276700         WHEN SQLCODE NOT EQUAL ZERO                              27670000
276800             SET PS-ERROR             TO TRUE                     27680000
276900             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       27690000
277000             STRING   ' ' WS007-SRC-TASK-NUMBER                   27700000
277100                      ' WSKCS310:7200-'                           27710000
277200                      ' CALLED BY-'                               27720000
277300                      PV-CALLING-PGM                              27730000
277400                      '  SQLCODE='                                27740000
277500                      PV-DISPLAY-SQLCODE                          27750000
277600                      ' '                                         27760000
277700                      DELIMITED BY SIZE                           27770000
277800                                      INTO PV-CICS-MSG-AREA       27780000
277900             PERFORM 9999-WRITE-TO-CSSL                           27790000
278000             SET WS007-INVALID-SQL TO TRUE                        27800000
278100             MOVE SQLCODE             TO WS007-SQLCODE            27810000
278200             MOVE '7200-SEL-MAX-RECITM-LNE '                      27820000
278300                                      TO WS007-SQL-ERROR-PARA     27830000
278400             PERFORM 9998-RETURN                                  27840000
278500     END-EVALUATE.                                                27850000
278600                                                                  27860000
278700                                                                  27870000
278800*----------------------------------------------------------------*27880000
278900                                                                  27890000
279000 8000-CHECK-FOR-LOGGING.                                          27900000
279010     IF PS-SHOW-DEBUG-INFO                                        27901001
279020         STRING   ' ' WS007-SRC-TASK-NUMBER                       27902001
279030                ' WSKCS310:8000-CHECK-FOR-LOGGING   '             27903001
279040         DELIMITED BY SIZE                                        27904001
279050         INTO PV-CICS-MSG-AREA                                    27905001
279060         PERFORM 9990-WRITE-CICS                                  27906001
279070     END-IF.                                                      27907001
279080                                                                  27908001
279100                                                                  27910000
279200                                                                  27920000
279300     EXEC SQL                                                     27930000
279400         SELECT A.INTGRTN_TYP_CDE                                 27940000
279500              , A.INTGRTN_TYP_DESC                                27950000
279600              , C.ATTR_ELEM_TXT    AS PROGRAM_NAME                27960000
279700              , D.ATTR_ELEM_TXT    AS SWITCH_IND                  27970000
279800         INTO  :WST00008-INTGRTN-TYP-CDE                          27980000
279900              ,:WST00008-INTGRTN-TYP-DESC                         27990000
280000              ,:PV-PROGRAM-NAME                                   28000000
280100              ,:PV-SWITCH-IND                                     28010000
280200         FROM   WST_INTGRTN_TYP   A                               28020000
280300              , WST_ATTR_DEFN     B                               28030000
280400              , WST_ATTR_ELEM     C                               28040000
280500              , WST_ATTR_ELEM     D                               28050000
280600         WHERE A.INTGRTN_TYP_CDE    =  'CSSLLOG'                  28060000
280700           AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          28070000
280800           AND B.ATTR_DEFN_SEQ_NBR  =  1                          28080000
280900           AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          28090000
281000           AND C.ATTR_DEFN_SEQ_NBR  =  1                          28100000
281100           AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE          28110000
281200           AND D.ATTR_DEFN_SEQ_NBR  =  2                          28120000
281300           AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR        28130000
281400           AND C.ATTR_ELEM_TXT      = 'WSKCS310'                  28140000
281500     END-EXEC                                                     28150000
281600                                                                  28160000
281700     EVALUATE TRUE                                                28170000
281800         WHEN SQLCODE = ZERO                                      28180000
281900              IF PV-SWITCH-IND = PC-Y                             28190000
282000                 SET PS-SHOW-DEBUG-INFO    TO TRUE                28200000
282100             ELSE                                                 28210000
282200                 SET PS-DONT-SHOW-DEBUG-INFO TO TRUE              28220000
282300             END-IF                                               28230000
282400                                                                  28240000
282500         WHEN SQLCODE = +100                                      28250000
282600             SET PS-DONT-SHOW-DEBUG-INFO TO TRUE                  28260000
282700         WHEN SQLWARN0 NOT = SPACES                               28270000
282800         WHEN SQLCODE NOT EQUAL ZERO                              28280000
282900             SET PS-ERROR             TO TRUE                     28290000
283000             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       28300000
283100             STRING   ' ' WS007-SRC-TASK-NUMBER                   28310000
283200                      ' WSKCS310:8000-'                           28320000
283300                      ' CALLED BY-'                               28330000
283400                      PV-CALLING-PGM                              28340000
283500                      '  SQLCODE='                                28350000
283600                      PV-DISPLAY-SQLCODE                          28360000
283700                      ' '                                         28370000
283800                      DELIMITED BY SIZE                           28380000
283900                                      INTO PV-CICS-MSG-AREA       28390000
284000             PERFORM 9999-WRITE-TO-CSSL                           28400000
284100             SET WS007-INVALID-SQL TO TRUE                        28410000
284200* JAK 08/2007 - LOAD SQLCODE & ERROR PARA                         28420000
284300             MOVE SQLCODE             TO WS007-SQLCODE            28430000
284400             MOVE '8000-CHECK-FOR-LOGGING'                        28440000
284500                                      TO WS007-SQL-ERROR-PARA     28450000
284600             PERFORM 9998-RETURN                                  28460000
284700     END-EVALUATE.                                                28470000
284800                                                                  28480000
284900                                                                  28490000
285000                                                                  28500000
285100 9990-WRITE-CICS.                                                 28510000
285200                                                                  28520000
285300* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  28530000
285400* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       28540000
285500* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 28550000
285600* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     28560000
285700* WRAPPED AROUND.                                                 28570000
285800                                                                  28580000
285900     EVALUATE TRUE                                                28590000
286000     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          28600000
286100         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 28610000
286200         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         28620000
286300         SET PT-MSG-IDX UP BY 1                                   28630000
286400     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          28640000
286500         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 28650000
286600         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         28660000
286700         SET PT-MSG-IDX               TO 1                        28670000
286800     END-EVALUATE                                                 28680000
286900                                                                  28690000
287000     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1              28700000
287100     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX)  28710000
287200                                                                  28720000
287300                                                                  28730000
287400*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    28740000
287500*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    28750000
287600*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              28760000
287700*                                                                 28770000
287800     IF PS-SHOW-DEBUG-INFO                                        28780000
287900         PERFORM 9991-WRITEQ                                      28790000
288000     END-IF                                                       28800000
288100     MOVE SPACES                      TO PV-CICS-MSG-AREA.        28810000
288200                                                                  28820000
288300                                                                  28830000
288400 9991-WRITEQ.                                                     28840000
288500     EXEC CICS                                                    28850000
288600         WRITEQ TD                                                28860000
288700         QUEUE(PC-LOG-QUEUE)                                      28870000
288800         FROM(PV-CICS-MSG-AREA)                                   28880000
288900         RESP(PV-CICS-RESPONSE)                                   28890000
289000     END-EXEC.                                                    28900000
289100                                                                  28910000
289200*-----------------------------------------------------------------28920000
289300*  RETURN TO CALLING PROGRAM                                      28930000
289400*-----------------------------------------------------------------28940000
289500 9998-RETURN.                                                     28950000
289600                                                                  28960000
289700     STRING   ' ' WS007-SRC-TASK-NUMBER                           28970000
289800              ' WSKCS310:9998-RETURN'                             28980000
289900         DELIMITED BY SIZE                                        28990000
290000         INTO PV-CICS-MSG-AREA.                                   29000000
290100     PERFORM 9990-WRITE-CICS.                                     29010000
290200*    MOVE WS014-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           29020000
290300     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           29030000
290400                                                                  29040000
290500     EXEC CICS                                                    29050000
290600          RETURN                                                  29060000
290700     END-EXEC.                                                    29070000
290800                                                                  29080000
290900                                                                  29090000
291000 9999-WRITE-TO-CSSL.                                              29100000
291100     STRING   ' ' WS007-SRC-TASK-NUMBER                           29110000
291200              ' WSKCS310:9999-WRITE-TO-CSSL'                      29120000
291300         DELIMITED BY SIZE                                        29130000
291400         INTO PV-CICS-MSG-AREA.                                   29140000
291500     PERFORM 9990-WRITE-CICS.                                     29150000
291600     MOVE LENGTH OF PV-CICS-MSG-AREA2                             29160000
291700       TO PV-COMMAREA-LENGTH                                      29170000
291800     EXEC CICS                                                    29180000
291900          WRITEQ TD                                               29190000
292000           QUEUE   ('CSSL')                                       29200000
292100            FROM   (PV-CICS-MSG-AREA2)                            29210000
292200          LENGTH   (PV-COMMAREA-LENGTH)                           29220000
292300            RESP   (PV-CICS-RESP)                                 29230000
292400     END-EXEC.                                                    29240000
292500                                                                  29250000
292600*                                                                 29260000
292700 9999-WRITE-CICS-LOG-MSG.                                         29270000
292800     STRING   ' ' WS007-SRC-TASK-NUMBER                           29280000
292900              ' WSKCS310:9999-WRITE-CICS-LOG-MSG'                 29290000
293000         DELIMITED BY SIZE                                        29300000
293100         INTO PV-CICS-MSG-AREA.                                   29310000
293200     PERFORM 9990-WRITE-CICS.                                     29320000
293300     MOVE 'WSKCS310'                 TO DP013-PROGRAM.            29330000
293400     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           29340000
293500     INITIALIZE DP013-SRC-TASK-NUMBER                             29350000
293600                DP013-STACK.                                      29360000
293700     SET DP013-LINK-RETURN           TO TRUE.                     29370000
293800                                                                  29380000
293900     EXEC CICS                                                    29390000
294000         LINK                                                     29400000
294100             PROGRAM   (DP013-NAME)                               29410000
294200             COMMAREA  (DP013-PARAMETERS)                         29420000
294300             LENGTH    (DP013-LENGTH)                             29430000
294400     END-EXEC.                                                    29440000
294500                                                                  29450000
294600* FJW BEGIN 03/29/2010                                            29460000
294700*9999-FINAL-DUMP.                                                 29470000
294800*  IF AN ERROR HAS OCCURRED, DUMP THE MESSAGE TABLE WHICH WILL    29480000
294900*  CONTAIN THE LAST 200 TRACE DISPLAYS.  IF THE TABLE EVER        29490000
295000*  OVERFLOW, YOU WILL SEE THE SEQUENCE NUMBERS WRAP.  UNUSED      29500000
295100*  OCCRENCES ARE NOT DISPLAYED.                                   29510000
295200*                                                                 29520000
295300*                                                                 29530000
295400*    STRING   ' ' WS007-SRC-TASK-NUMBER                           29540000
295500*             ' WSKCS310:9999-FINAL-DUMP'                         29550000
295600*        DELIMITED BY SIZE                                        29560000
295700*        INTO PV-CICS-MSG-AREA                                    29570000
295800*    PERFORM 9990-WRITE-CICS.                                     29580000
295900*                                                                 29590000
296000*    EXEC CICS ENQ                                                29600000
296100*        RESOURCE(PC-LOG-QUEUE)                                   29610000
296200*    END-EXEC                                                     29620000
296300*                                                                 29630000
296400*    MOVE PV-EIBTASKN             TO PV-DISPLAY-TASK.             29640000
296500*    PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 29650000
296600*                    PT-MSG-IDX > PC-MSG-TABLE-SIZE               29660000
296700*        IF PT-MSG-SEQ (PT-MSG-IDX) > ZERO                        29670000
296800*            MOVE PT-MSG-SEQ (PT-MSG-IDX)                         29680000
296900*                                 TO PV-DISPLAY-MSG-NBR           29690000
297000*            STRING   ' ' WS007-SRC-TASK-NUMBER                   29700000
297100*                     ' WSKCS310:'                                29710000
297200*                   ' ' PV-DISPLAY-TASK ' '                       29720000
297300*                 PV-DISPLAY-MSG-NBR ' '                          29730000
297400*                 PT-MSG-LINE (PT-MSG-IDX)                        29740000
297500*                 DELIMITED BY SIZE                               29750000
297600*                               INTO PV-CICS-MSG-AREA             29760000
297700*            PERFORM 9991-WRITEQ                                  29770000
297800*        END-IF                                                   29780000
297900*    END-PERFORM.                                                 29790000
298000*                                                                 29800000
298100*    SET PT-MSG-IDX               TO 1.                           29810000
298200*    SET PS-DONT-DUMP-TO-LOG      TO TRUE.                        29820000
298300*                                                                 29830000
298400*    EXEC CICS DEQ                                                29840000
298500*        RESOURCE(PC-LOG-QUEUE)                                   29850000
298600*    END-EXEC.                                                    29860000
298700* FJW END   03/29/2010                                            29870000
298800                                                                  29880000
