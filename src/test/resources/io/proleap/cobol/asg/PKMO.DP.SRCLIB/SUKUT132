000100 TITLE 'PULL DATA FOR ARCHIVE/PURGE OF PNA/TRAILER ASSOCIATION'.          
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    SUKUT132.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN   NOVEMBER 2008.                                            
000700 DATE-COMPILED.                                                           
000800 ENVIRONMENT DIVISION.                                                    
000900 CONFIGURATION SECTION.                                                   
001000 SOURCE-COMPUTER.        IBM-3090.                                        
001100 OBJECT-COMPUTER.        IBM-3090.                                        
001200                                                                          
001300 INPUT-OUTPUT SECTION.                                                    
001400 FILE-CONTROL.                                                            
001500                                                                          
001600     SELECT TRIP-ASGMT-UNLOAD-FILE                                        
001700         ASSIGN TO OUT01.                                                 
001800                                                                          
001900     SELECT WRKR-UNLOAD-FILE                                              
002000         ASSIGN TO OUT02.                                                 
002100                                                                          
002200     SELECT MTCH-UNLOAD-FILE                                              
002300         ASSIGN TO OUT03.                                                 
002400                                                                          
002500******************************************************************        
002600 DATA DIVISION.                                                           
002700 FILE SECTION.                                                            
002800                                                                          
002900 FD  TRIP-ASGMT-UNLOAD-FILE                                               
003000     RECORDING MODE IS F                                                  
003100     LABEL RECORDS ARE STANDARD                                           
003200     BLOCK CONTAINS 0 RECORDS.                                            
003300                                                                          
003400*    FROM SUT00110                                                        
003500 01  TRIP-ASGMT-UNLOAD-REC   PIC X(108).                                  
003600*                                                                         
003700*    FROM SUT00111                                                        
003800 FD  WRKR-UNLOAD-FILE                                                     
003900     RECORDING MODE IS F                                                  
004000     LABEL RECORDS ARE STANDARD                                           
004100     BLOCK CONTAINS 0 RECORDS.                                            
004200                                                                          
004300 01  WRKR-UNLOAD-REC   PIC  X(168).                                       
004400                                                                          
004500 FD  MTCH-UNLOAD-FILE                                                     
004600     RECORDING MODE IS F                                                  
004700     LABEL RECORDS ARE STANDARD                                           
004800     BLOCK CONTAINS 0 RECORDS.                                            
004900                                                                          
005000 01  MTCH-UNLOAD-REC   PIC  X(087).                                       
005100/                                                                         
005200 WORKING-STORAGE SECTION.                                                 
005300                                                                          
005400     COPY SURD025.                                                        
005500                                                                          
005600     COPY SURD026.                                                        
005700                                                                          
005800     COPY SURD094.                                                        
005900                                                                          
006000     COPY DPWS004.                                                        
006100*                                                                         
006200     EXEC SQL                                                             
006300         INCLUDE SUT00110                                                 
006400     END-EXEC.                                                            
006500                                                                          
006600     EXEC SQL                                                             
006700         INCLUDE SUT00111                                                 
006800     END-EXEC.                                                            
006900                                                                          
007000     EXEC SQL                                                             
007100         INCLUDE SUT00112                                                 
007200     END-EXEC.                                                            
007300                                                                          
007400     EXEC SQL                                                             
007500         INCLUDE TCOCNTL                                                  
007600     END-EXEC.                                                            
007700                                                                          
007800     EXEC SQL                                                             
007900         INCLUDE TKRPRPM                                                  
008000     END-EXEC.                                                            
008100                                                                          
008200     EXEC SQL                                                             
008300          INCLUDE SQLCA                                                   
008400     END-EXEC.                                                            
008500                                                                          
008600 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
008700                                                   COMP SYNC.             
008800                                                                          
008900 01  PS-PROGRAM-SWITCHES.                                                 
009000     05  PS-END-OF-DRIVE-CSR-SW       PIC  X(01) VALUE 'N'.               
009100         88  PS-END-DRIVE-CSR-YES                VALUE 'Y'.               
009200         88  PS-END-DRIVE-CSR-NO                 VALUE 'N'.               
009300     05  PS-END-OF-WRKR-CSR-SW        PIC  X(01) VALUE 'N'.               
009400         88  PS-END-WRKR-CSR-YES                 VALUE 'Y'.               
009500         88  PS-END-WRKR-CSR-NO                  VALUE 'N'.               
009600     05  PS-END-OF-MTCH-CSR-SW        PIC  X(01) VALUE 'N'.               
009700         88  PS-END-MTCH-CSR-YES                 VALUE 'Y'.               
009800         88  PS-END-MTCH-CSR-NO                  VALUE 'N'.               
009900                                                                          
010000 01  PC-PROGRAM-CONSTANTS.                                                
010100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT132'.         
010200                                                                          
010300 01  DK-DB2-VARIABLES.                                                    
010400     05  DK-PURGE-DATE                PIC X(10).                          
010500     05  DN-NULL-1                    PIC S9(04) COMP VALUE ZERO.         
010600     05  DN-NULL-2                    PIC S9(04) COMP VALUE ZERO.         
010700     05  DN-NULL-3                    PIC S9(04) COMP VALUE ZERO.         
010800     05  DN-NULL-4                    PIC S9(04) COMP VALUE ZERO.         
010900                                                                          
011000 01  PV-PROGRAM-VARIABLES.                                                
011100                                                                          
011200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.          
011300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.          
011400*    05  PV-READ-COUNTER             PIC  S9(9) COMP.                     
011500     05  PV-DRIVE-COUNTER            PIC  S9(9) COMP.                     
011600     05  PV-WRKR-READ-COUNTER        PIC  S9(9) COMP.                     
011700     05  PV-MTCH-READ-COUNTER        PIC  S9(9) COMP.                     
011800     05  PV-WRITE-DRIVE-COUNTER      PIC  S9(9) COMP.                     
011900     05  PV-WRITE-WRKR-COUNTER       PIC  S9(9) COMP.                     
012000     05  PV-WRITE-MTCH-COUNTER       PIC  S9(9) COMP.                     
012100     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.                     
012200     05  PV-FUNC-QTY                 PIC  S9(4) COMP.                     
012300/                                                                         
012400     EXEC SQL                                                             
012500         DECLARE DRIVE-CSR CURSOR FOR                                     
012600         SELECT                                                           
012700             OPER_UNT_ID                                                  
012800            ,ACM_LBL_STA_NBR                                              
012900            ,DOOR_ID                                                      
013000            ,INBD_TRIP_ID                                                 
013100            ,ASGD_STRT_TMST                                               
013200            ,ASGD_END_TMST                                                
013300            ,CRE_BY_USR_ID                                                
013400            ,UPDATE_BY_USERID                                             
013500            ,UPDATE_TIMESTAMP                                             
013600          FROM  SUT_PNA_TRIP_ASGMT                                        
013700         WHERE  DATE(UPDATE_TIMESTAMP) <= :DK-PURGE-DATE                  
013800     END-EXEC                                                             
013900                                                                          
014000                                                                          
014100     EXEC SQL                                                             
014200         DECLARE WRKR-CSR CURSOR FOR                                      
014300         SELECT                                                           
014400             OPER_UNT_ID                                                  
014500         ,   ACM_LBL_STA_NBR                                              
014600         ,   DOOR_ID                                                      
014700         ,   INBD_TRIP_ID                                                 
014800         ,   ASGD_STRT_TMST                                               
014900         ,   WRKR_STRT_TMST                                               
015000         ,   WRKR_END_TMST                                                
015100         ,   WRKR_USR_ID                                                  
015200         ,   CRE_BY_USR_ID                                                
015300         ,   CRE_TMST                                                     
015400         ,   UPDATE_BY_USERID                                             
015500         ,   UPDATE_TIMESTAMP                                             
015600          FROM  SUT_PNA_STA_WRKR                                          
015700     WHERE                                                                
015800             OPER_UNT_ID              = :SUT00110-OPER-UNT-ID             
015900         AND ACM_LBL_STA_NBR          = :SUT00110-ACM-LBL-STA-NBR         
016000         AND DOOR_ID                  = :SUT00110-DOOR-ID                 
016100         AND INBD_TRIP_ID             = :SUT00110-INBD-TRIP-ID            
016200         AND ASGD_STRT_TMST           = :SUT00110-ASGD-STRT-TMST          
016300                                                                          
016400     END-EXEC.                                                            
016500                                                                          
016600     EXEC SQL                                                             
016700         DECLARE MTCH-CSR CURSOR FOR                                      
016800         SELECT                                                           
016900              SHIPT_UNT_ID                                                
017000             ,CRE_MTCH_TMST                                               
017100             ,OPER_UNT_ID                                                 
017200             ,ACM_LBL_STA_NBR                                             
017300             ,DOOR_ID                                                     
017400             ,INBD_TRIP_ID                                                
017500             ,ASGD_STRT_TMST                                              
017600             ,CART_MTCH_CDE                                               
017700             ,CRE_BY_USR_ID                                               
017800          FROM  SUT_TRIP_MTCH_LVL                                         
017900     WHERE                                                                
018000             OPER_UNT_ID              = :SUT00110-OPER-UNT-ID             
018100         AND ACM_LBL_STA_NBR          = :SUT00110-ACM-LBL-STA-NBR         
018200         AND DOOR_ID                  = :SUT00110-DOOR-ID                 
018300         AND INBD_TRIP_ID             = :SUT00110-INBD-TRIP-ID            
018400         AND ASGD_STRT_TMST           = :SUT00110-ASGD-STRT-TMST          
018500     END-EXEC.                                                            
018600/                                                                         
018700 PROCEDURE DIVISION.                                                      
018800                                                                          
018900     PERFORM 1000-INITIALIZE.                                             
019000                                                                          
019100     PERFORM 2000-PROCESS-DRIVE-CSR                                       
019200             UNTIL PS-END-DRIVE-CSR-YES                                   
019300                                                                          
019400     PERFORM 9000-EOJ-ROUTINE.                                            
019500                                                                          
019600     GOBACK.                                                              
019700/                                                                         
019800 1000-INITIALIZE.                                                         
019900                                                                          
020000     OPEN OUTPUT TRIP-ASGMT-UNLOAD-FILE                                   
020100                 WRKR-UNLOAD-FILE                                         
020200                 MTCH-UNLOAD-FILE                                         
020300                                                                          
020400     DISPLAY '* * * * * * * * * * * '.                                    
020500     DISPLAY 'CURRENT PROGRAM ' PC-CURRENT-PROGRAM-NAME.                  
020600                                                                          
020700     PERFORM 7000-GET-PROCESS-DATE.                                       
020800     DISPLAY ' PROCESS DATE = ' COCNTL-BTCH-PRC-DTE                       
020900                                                                          
021000     PERFORM 7010-GET-OFFSET-DATE.                                        
021100     DISPLAY ' OFFSET DAYS = ' PV-FUNC-QTY                                
021200     DISPLAY ' PURGE DATE  = ' DK-PURGE-DATE.                             
021300     DISPLAY SPACES.                                                      
021400                                                                          
021500     PERFORM 7100-OPEN-DRIVE-CSR.                                         
021600     PERFORM 7110-FETCH-DRIVE-CSR.                                        
021700                                                                          
021800 2000-PROCESS-DRIVE-CSR.                                                  
021900                                                                          
022000     PERFORM 3000-BUILD-SU025-REC.                                        
022100     PERFORM 8000-WRITE-SU025-REC.                                        
022200                                                                          
022300     PERFORM 7200-OPEN-WRKR-CSR                                           
022400     PERFORM 7210-FETCH-WRKR-CSR                                          
022500                                                                          
022600     PERFORM UNTIL PS-END-WRKR-CSR-YES                                    
022700         PERFORM 3100-BUILD-SU026-REC                                     
022800         PERFORM 8100-WRITE-SU026-REC                                     
022900         PERFORM 7210-FETCH-WRKR-CSR                                      
023000     END-PERFORM.                                                         
023100                                                                          
023200     PERFORM 7220-CLOSE-WRKR-CSR                                          
023300                                                                          
023400     PERFORM 7300-OPEN-MTCH-CSR                                           
023500     PERFORM 7310-FETCH-MTCH-CSR                                          
023600                                                                          
023700     PERFORM UNTIL PS-END-MTCH-CSR-YES                                    
023800         PERFORM 3200-BUILD-SU094-REC                                     
023900         PERFORM 8200-WRITE-SU094-REC                                     
024000         PERFORM 7310-FETCH-MTCH-CSR                                      
024100     END-PERFORM.                                                         
024200                                                                          
024300     PERFORM 7320-CLOSE-MTCH-CSR                                          
024400                                                                          
024500     PERFORM 7110-FETCH-DRIVE-CSR.                                        
024600                                                                          
024700 3000-BUILD-SU025-REC.                                                    
024800                                                                          
024900     MOVE SUT00110-OPER-UNT-ID        TO SU025-OPER-UNT-ID                
025000     MOVE SUT00110-ACM-LBL-STA-NBR    TO SU025-ACM-LBL-STA-NBR            
025100     MOVE SUT00110-DOOR-ID            TO SU025-DOOR-ID                    
025200     MOVE SUT00110-INBD-TRIP-ID       TO SU025-INBD-TRIP-ID               
025300     MOVE SUT00110-ASGD-STRT-TMST     TO SU025-ASGD-STRT-TMST             
025400     MOVE SUT00110-ASGD-END-TMST      TO SU025-ASGD-END-TMST              
025500     MOVE SUT00110-CRE-BY-USR-ID      TO SU025-CRE-BY-USR-ID              
025600     MOVE SUT00110-UPDATE-BY-USERID   TO SU025-UPDATE-BY-USERID           
025700     MOVE SUT00110-UPDATE-TIMESTAMP   TO SU025-UPDATE-TIMESTAMP.          
025800                                                                          
025900 3100-BUILD-SU026-REC.                                                    
026000                                                                          
026100     MOVE SUT00111-OPER-UNT-ID        TO SU026-OPER-UNT-ID                
026200     MOVE SUT00111-ACM-LBL-STA-NBR    TO SU026-ACM-LBL-STA-NBR            
026300     MOVE SUT00111-DOOR-ID            TO SU026-DOOR-ID                    
026400     MOVE SUT00111-INBD-TRIP-ID       TO SU026-INBD-TRIP-ID               
026500     MOVE SUT00111-ASGD-STRT-TMST     TO SU026-ASGD-STRT-TMST             
026600     MOVE SUT00111-WRKR-STRT-TMST     TO SU026-WRKR-STRT-TMST             
026700     MOVE SUT00111-WRKR-END-TMST      TO SU026-WRKR-END-TMST              
026800     MOVE SUT00111-WRKR-USR-ID        TO SU026-WRKR-USR-ID                
026900     MOVE SUT00111-CRE-BY-USR-ID      TO SU026-CRE-BY-USR-ID              
027000     MOVE SUT00111-CRE-TMST           TO SU026-CRE-TMST                   
027100     MOVE SUT00111-UPDATE-BY-USERID   TO SU026-UPDATE-BY-USERID           
027200     MOVE SUT00111-UPDATE-TIMESTAMP   TO SU026-UPDATE-TIMESTAMP.          
027300                                                                          
027400 3200-BUILD-SU094-REC.                                                    
027500                                                                          
027600     MOVE SUT00112-SHIPT-UNT-ID       TO SU094-SHIPT-UNT-ID               
027700     MOVE SUT00112-CRE-MTCH-TMST      TO SU094-CRE-MTCH-TMST              
027800     MOVE SUT00112-OPER-UNT-ID        TO SU094-OPER-UNT-ID                
027900     MOVE SUT00112-ACM-LBL-STA-NBR    TO SU094-ACM-LBL-STA-NBR            
028000     MOVE SUT00112-DOOR-ID            TO SU094-DOOR-ID                    
028100     MOVE SUT00112-INBD-TRIP-ID       TO SU094-INBD-TRIP-ID               
028200     MOVE SUT00112-ASGD-STRT-TMST     TO SU094-ASGD-STRT-TMST             
028300     MOVE SUT00112-CART-MTCH-CDE      TO SU094-CART-MTCH-CDE              
028400     MOVE SUT00112-CRE-BY-USR-ID      TO SU094-CRE-BY-USR-ID.             
028500                                                                          
028600 7000-GET-PROCESS-DATE.                                                   
028700                                                                          
028800     MOVE '7000-GET-PROCESS-DATE'     TO PV-PARAGRAPH-NAME.               
028900                                                                          
029000     EXEC SQL                                                             
029100         SELECT                                                           
029200             BTCH_PRC_DTE                                                 
029300         INTO                                                             
029400             :COCNTL-BTCH-PRC-DTE                                         
029500         FROM                                                             
029600             TCOCNTL                                                      
029700         WHERE                                                            
029800             OPER_UNT_ID = 90                                             
029900         AND FCLTY_ID = 1                                                 
030000     END-EXEC.                                                            
030100                                                                          
030200     EVALUATE TRUE                                                        
030300         WHEN SQLCODE = ZERO                                              
030400             CONTINUE                                                     
030500         WHEN SQLWARN0 NOT = SPACES                                       
030600         WHEN SQLCODE < ZERO                                              
030700         WHEN SQLCODE > ZERO                                              
030800             MOVE '7000-GET-PROCESS-DATE' TO PV-PARAGRAPH-NAME            
030900             MOVE 'SELECT'        TO PV-DB2-OPERATION-ATTEMPTED           
031000             PERFORM 9100-SQL-ABEND                                       
031100     END-EVALUATE.                                                        
031200                                                                          
031300 7010-GET-OFFSET-DATE.                                                    
031400                                                                          
031500     MOVE '7010-GET-OFFSET-DATE'      TO PV-PARAGRAPH-NAME.               
031600                                                                          
031700     EXEC SQL                                                             
031800         SELECT                                                           
031900             FUNC_QTY                                                     
032000         ,   DATE(DAYS(:COCNTL-BTCH-PRC-DTE) - FUNC_QTY)                  
032100         INTO                                                             
032200             :PV-FUNC-QTY                                                 
032300           , :DK-PURGE-DATE                                               
032400         FROM                                                             
032500             TKRPRPM                                                      
032600         WHERE                                                            
032700             LOC_ID = 90                                                  
032800         AND INTFC_SYS_CDE = 'KHL'                                        
032900         AND SYS_PRC_FUNC_CDE = 'PTTPRG'                                  
033000         AND FUNC_PRC_STAT_CDE = 'AC'                                     
033100     END-EXEC.                                                            
033200                                                                          
033300     EVALUATE TRUE                                                        
033400         WHEN SQLCODE = ZERO                                              
033500             CONTINUE                                                     
033600         WHEN SQLWARN0 NOT = SPACES                                       
033700         WHEN SQLCODE < ZERO                                              
033800         WHEN SQLCODE > ZERO                                              
033900             MOVE '7000-GET-PROCESS-DATE' TO PV-PARAGRAPH-NAME            
034000             MOVE 'SELECT'        TO PV-DB2-OPERATION-ATTEMPTED           
034100             PERFORM 9100-SQL-ABEND                                       
034200     END-EVALUATE.                                                        
034300                                                                          
034400 7100-OPEN-DRIVE-CSR.                                                     
034500                                                                          
034600     MOVE '7100-OPEN-DRIVE-CSR'       TO PV-PARAGRAPH-NAME.               
034700                                                                          
034800     EXEC SQL                                                             
034900         OPEN DRIVE-CSR                                                   
035000     END-EXEC.                                                            
035100                                                                          
035200     EVALUATE TRUE                                                        
035300         WHEN SQLCODE = ZERO                                              
035400             SET PS-END-DRIVE-CSR-NO  TO TRUE                             
035500         WHEN SQLWARN0 NOT = SPACES                                       
035600         WHEN SQLCODE < ZERO                                              
035700         WHEN SQLCODE > ZERO                                              
035800             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED            
035900             PERFORM 9100-SQL-ABEND                                       
036000     END-EVALUATE.                                                        
036100                                                                          
036200 7110-FETCH-DRIVE-CSR.                                                    
036300                                                                          
036400     MOVE '7110-FETCH-DRIVE-CSR'      TO PV-PARAGRAPH-NAME.               
036500     INITIALIZE DCLSUT00110.                                              
036600                                                                          
036700     EXEC SQL                                                             
036800         FETCH DRIVE-CSR                                                  
036900         INTO                                                             
037000              :SUT00110-OPER-UNT-ID                                       
037100           ,  :SUT00110-ACM-LBL-STA-NBR                                   
037200           ,  :SUT00110-DOOR-ID                                           
037300           ,  :SUT00110-INBD-TRIP-ID                                      
037400           ,  :SUT00110-ASGD-STRT-TMST                                    
037500           ,  :SUT00110-ASGD-END-TMST                                     
037600           ,  :SUT00110-CRE-BY-USR-ID                                     
037700           ,  :SUT00110-UPDATE-BY-USERID:DN-NULL-1                        
037800           ,  :SUT00110-UPDATE-TIMESTAMP:DN-NULL-2                        
037900     END-EXEC.                                                            
038000                                                                          
038100     EVALUATE TRUE                                                        
038200         WHEN SQLCODE = ZERO                                              
038300             ADD 1                    TO PV-DRIVE-COUNTER                 
038400         WHEN SQLCODE = +100                                              
038500             SET PS-END-DRIVE-CSR-YES TO TRUE                             
038600         WHEN SQLWARN0 NOT = SPACES                                       
038700         WHEN SQLCODE < ZERO                                              
038800         WHEN SQLCODE > ZERO                                              
038900             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED           
039000             PERFORM 9100-SQL-ABEND                                       
039100     END-EVALUATE.                                                        
039200                                                                          
039300 7120-CLOSE-DRIVE-CSR.                                                    
039400                                                                          
039500     MOVE '7120-CLOSE-DRIVE-CSR' TO PV-PARAGRAPH-NAME                     
039600     EXEC SQL                                                             
039700         CLOSE DRIVE-CSR                                                  
039800     END-EXEC                                                             
039900                                                                          
040000     EVALUATE TRUE                                                        
040100         WHEN SQLCODE = ZERO                                              
040200             CONTINUE                                                     
040300         WHEN SQLWARN0 NOT = SPACES                                       
040400         WHEN SQLCODE < ZERO                                              
040500         WHEN SQLCODE > ZERO                                              
040600             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED           
040700             PERFORM 9100-SQL-ABEND                                       
040800     END-EVALUATE.                                                        
040900                                                                          
041000 7200-OPEN-WRKR-CSR.                                                      
041100                                                                          
041200     EXEC SQL                                                             
041300         OPEN WRKR-CSR                                                    
041400     END-EXEC.                                                            
041500                                                                          
041600     EVALUATE TRUE                                                        
041700         WHEN SQLCODE = ZERO                                              
041800             SET PS-END-WRKR-CSR-NO   TO TRUE                             
041900         WHEN SQLWARN0 NOT = SPACES                                       
042000         WHEN SQLCODE < ZERO                                              
042100         WHEN SQLCODE > ZERO                                              
042200             MOVE '7200-OPEN-WRKR-CSR '                                   
042300                                        TO PV-PARAGRAPH-NAME              
042400             MOVE 'OPEN WRKR-CSR  ' TO PV-DB2-OPERATION-ATTEMPTED         
042500             PERFORM 9100-SQL-ABEND                                       
042600     END-EVALUATE.                                                        
042700                                                                          
042800 7210-FETCH-WRKR-CSR.                                                     
042900                                                                          
043000     EXEC SQL                                                             
043100         FETCH WRKR-CSR                                                   
043200         INTO                                                             
043300        :SUT00111-OPER-UNT-ID                                             
043400      , :SUT00111-ACM-LBL-STA-NBR                                         
043500      , :SUT00111-DOOR-ID                                                 
043600      , :SUT00111-INBD-TRIP-ID                                            
043700      , :SUT00111-ASGD-STRT-TMST                                          
043800      , :SUT00111-WRKR-STRT-TMST                                          
043900      , :SUT00111-WRKR-END-TMST                                           
044000      , :SUT00111-WRKR-USR-ID                                             
044100      , :SUT00111-CRE-BY-USR-ID                                           
044200      , :SUT00111-CRE-TMST                                                
044300      , :SUT00111-UPDATE-BY-USERID:DN-NULL-3                              
044400      , :SUT00111-UPDATE-TIMESTAMP:DN-NULL-4                              
044500     END-EXEC                                                             
044600                                                                          
044700     EVALUATE TRUE                                                        
044800         WHEN SQLCODE = ZERO                                              
044900             ADD 1                    TO PV-WRKR-READ-COUNTER             
045000         WHEN SQLCODE = +100                                              
045100             SET PS-END-WRKR-CSR-YES  TO TRUE                             
045200         WHEN SQLWARN0 NOT = SPACES                                       
045300         WHEN SQLCODE < ZERO                                              
045400         WHEN SQLCODE > ZERO                                              
045500             MOVE '7210-FETCH-WRKR-CSR'                                   
045600                                        TO PV-PARAGRAPH-NAME              
045700             MOVE 'FETCH WRKR-CSR ' TO PV-DB2-OPERATION-ATTEMPTED         
045800             PERFORM 9100-SQL-ABEND                                       
045900     END-EVALUATE.                                                        
046000                                                                          
046100 7220-CLOSE-WRKR-CSR.                                                     
046200     EXEC SQL                                                             
046300         CLOSE WRKR-CSR                                                   
046400     END-EXEC.                                                            
046500                                                                          
046600     EVALUATE TRUE                                                        
046700         WHEN SQLCODE = ZERO                                              
046800             CONTINUE                                                     
046900         WHEN SQLWARN0 NOT = SPACES                                       
047000         WHEN SQLCODE < ZERO                                              
047100         WHEN SQLCODE > ZERO                                              
047200             MOVE '7220-CLOSE-WRKR-CSR' TO PV-PARAGRAPH-NAME              
047300             MOVE 'CLOSE WRKR-CSR ' TO PV-DB2-OPERATION-ATTEMPTED         
047400             PERFORM 9100-SQL-ABEND                                       
047500     END-EVALUATE.                                                        
047600                                                                          
047700 7300-OPEN-MTCH-CSR.                                                      
047800                                                                          
047900     EXEC SQL                                                             
048000         OPEN MTCH-CSR                                                    
048100     END-EXEC.                                                            
048200                                                                          
048300     EVALUATE TRUE                                                        
048400         WHEN SQLCODE = ZERO                                              
048500             SET PS-END-MTCH-CSR-NO   TO TRUE                             
048600         WHEN SQLWARN0 NOT = SPACES                                       
048700         WHEN SQLCODE < ZERO                                              
048800         WHEN SQLCODE > ZERO                                              
048900             MOVE '7300-OPEN-MTCH-CSR '                                   
049000                                        TO PV-PARAGRAPH-NAME              
049100             MOVE 'OPEN MTCH-CSR  ' TO PV-DB2-OPERATION-ATTEMPTED         
049200             PERFORM 9100-SQL-ABEND                                       
049300     END-EVALUATE.                                                        
049400                                                                          
049500 7310-FETCH-MTCH-CSR.                                                     
049600                                                                          
049700     EXEC SQL                                                             
049800         FETCH MTCH-CSR                                                   
049900         INTO                                                             
050000        :SUT00112-SHIPT-UNT-ID                                            
050100      , :SUT00112-CRE-MTCH-TMST                                           
050200      , :SUT00112-OPER-UNT-ID                                             
050300      , :SUT00112-ACM-LBL-STA-NBR                                         
050400      , :SUT00112-DOOR-ID                                                 
050500      , :SUT00112-INBD-TRIP-ID                                            
050600      , :SUT00112-ASGD-STRT-TMST                                          
050700      , :SUT00112-CART-MTCH-CDE                                           
050800      , :SUT00112-CRE-BY-USR-ID                                           
050900     END-EXEC                                                             
051000                                                                          
051100     EVALUATE TRUE                                                        
051200         WHEN SQLCODE = ZERO                                              
051300             ADD 1                    TO PV-MTCH-READ-COUNTER             
051400         WHEN SQLCODE = +100                                              
051500             SET PS-END-MTCH-CSR-YES  TO TRUE                             
051600         WHEN SQLWARN0 NOT = SPACES                                       
051700         WHEN SQLCODE < ZERO                                              
051800         WHEN SQLCODE > ZERO                                              
051900             MOVE '7310-FETCH-MTCH-CSR' TO PV-PARAGRAPH-NAME              
052000             MOVE 'FETCH MTCH-CSR'  TO PV-DB2-OPERATION-ATTEMPTED         
052100             PERFORM 9100-SQL-ABEND                                       
052200     END-EVALUATE.                                                        
052300                                                                          
052400 7320-CLOSE-MTCH-CSR.                                                     
052500     EXEC SQL                                                             
052600         CLOSE MTCH-CSR                                                   
052700     END-EXEC.                                                            
052800                                                                          
052900     EVALUATE TRUE                                                        
053000         WHEN SQLCODE = ZERO                                              
053100             CONTINUE                                                     
053200         WHEN SQLWARN0 NOT = SPACES                                       
053300         WHEN SQLCODE < ZERO                                              
053400         WHEN SQLCODE > ZERO                                              
053500             MOVE '7320-CLOSE-MTCH-CSR' TO PV-PARAGRAPH-NAME              
053600             MOVE 'CLOSE MTCH-CSR ' TO PV-DB2-OPERATION-ATTEMPTED         
053700             PERFORM 9100-SQL-ABEND                                       
053800     END-EVALUATE.                                                        
053900/                                                                         
054000 8000-WRITE-SU025-REC.                                                    
054100     WRITE TRIP-ASGMT-UNLOAD-REC FROM                                     
054200         SU025-TRIP-ASGMT-REC                                             
054300     ADD +1                           TO PV-WRITE-DRIVE-COUNTER.          
054400                                                                          
054500                                                                          
054600 8100-WRITE-SU026-REC.                                                    
054700                                                                          
054800     WRITE WRKR-UNLOAD-REC FROM                                           
054900         SU026-STA-WRKR-REC                                               
055000                                                                          
055100     ADD +1                           TO PV-WRITE-WRKR-COUNTER.           
055200                                                                          
055300 8200-WRITE-SU094-REC.                                                    
055400                                                                          
055500     WRITE MTCH-UNLOAD-REC FROM                                           
055600         SU094-RECORD                                                     
055700                                                                          
055800     ADD +1                           TO PV-WRITE-MTCH-COUNTER.           
055900/                                                                         
056000 9000-EOJ-ROUTINE.                                                        
056100                                                                          
056200     PERFORM 7120-CLOSE-DRIVE-CSR.                                        
056300                                                                          
056400     CLOSE TRIP-ASGMT-UNLOAD-FILE                                         
056500           WRKR-UNLOAD-FILE                                               
056600           MTCH-UNLOAD-FILE                                               
056700                                                                          
056800     MOVE PV-DRIVE-COUNTER               TO PV-DISPLAY-COUNT.             
056900     DISPLAY 'TRIP ASGMT ROWS READ           = ' PV-DISPLAY-COUNT.        
057000                                                                          
057100     MOVE PV-WRKR-READ-COUNTER           TO PV-DISPLAY-COUNT.             
057200     DISPLAY 'STA WRKR ROWS READ             = ' PV-DISPLAY-COUNT.        
057300                                                                          
057400     MOVE PV-MTCH-READ-COUNTER           TO PV-DISPLAY-COUNT.             
057500     DISPLAY 'STA MTCH ROWS READ             = ' PV-DISPLAY-COUNT.        
057600                                                                          
057700     MOVE PV-WRITE-DRIVE-COUNTER       TO PV-DISPLAY-COUNT.               
057800     DISPLAY 'TRIP ASGMT RECORDS WRITTEN     = ' PV-DISPLAY-COUNT.        
057900                                                                          
058000     MOVE PV-WRITE-WRKR-COUNTER        TO PV-DISPLAY-COUNT.               
058100     DISPLAY 'WRKR ASGMT RECORDS WRITTEN     = ' PV-DISPLAY-COUNT.        
058200                                                                          
058300     MOVE PV-WRITE-MTCH-COUNTER        TO PV-DISPLAY-COUNT.               
058400     DISPLAY 'TRIP MTCH RECORDS WRITTEN      = ' PV-DISPLAY-COUNT.        
058500     DISPLAY '* * * * * * * * * * * '.                                    
058600                                                                          
058700 9100-SQL-ABEND.                                                          
058800     DISPLAY '9100-SQL-ABEND'.                                            
058900     DISPLAY '** ABEND     **'.                                           
059000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
059100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
059200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
059300                                                                          
059400     COPY DPPD004.                                                        
059500                                                                          
059600     MOVE +4013                  TO ABEND-CODE.                           
059700     CALL 'ILBOABN0' USING ABEND-CODE.                                    
059800                                                                          
