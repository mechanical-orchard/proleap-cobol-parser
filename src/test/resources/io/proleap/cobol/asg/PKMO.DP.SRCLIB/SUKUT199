000100 IDENTIFICATION DIVISION.                                         00010061
000200 PROGRAM-ID.    SUKUT199.                                         00020062
000300 AUTHOR.        JIM ARENDT.                                       00030062
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040062
000500 DATE-WRITTEN.  SEPTEMBER, 2018.                                  00050062
000600 DATE-COMPILED.                                                   00060062
000700******************************************************************00070062
000800*  DB2                                                            00080062
000900* EXTRACT THE SML'S THAT ARE MANIFESTED TO STATUS 'DC'(CLOSED AT  00090062
001000* DC) TRAILERS.                                                   00100062
001100******************************************************************00110062
001200* DATE: 09/2018 MADE BY:JIM ARENDT  INITIAL IMPLEMENTATION        00120062
001300******************************************************************00130062
001400 ENVIRONMENT DIVISION.                                            00140062
001500 CONFIGURATION SECTION.                                           00150062
001600 SOURCE-COMPUTER.    IBM-3090.                                    00160062
001700 OBJECT-COMPUTER.    IBM-3090.                                    00170062
001800 INPUT-OUTPUT SECTION.                                            00180062
001900 FILE-CONTROL.                                                    00190062
002000                                                                  00200062
002220     SELECT INPUT-EXTRACT-DC-FILE                                 00222062
002230            ASSIGN TO INP01.                                      00223071
002240                                                                  00224062
002250     SELECT OUTPUT-SML-FILE                                       00225062
002260            ASSIGN TO OUT01.                                      00226062
002270                                                                  00227062
002280 DATA DIVISION.                                                   00228062
002290 FILE SECTION.                                                    00229062
002910                                                                  00291062
002920 FD  INPUT-EXTRACT-DC-FILE                                        00292062
002930     RECORDING MODE IS F                                          00293062
002940     LABEL RECORDS OMITTED                                        00294062
002950     BLOCK CONTAINS 0 RECORDS                                     00295062
002960     DATA RECORD IS INPUT-EXTRACT-DC-RECORD.                      00296062
002970 01  INPUT-EXTRACT-DC-RECORD             PIC  X(250).             00297062
002980                                                                  00298062
002990 FD  OUTPUT-SML-FILE                                              00299062
003000     RECORDING MODE IS F                                          00300062
003100     LABEL RECORDS OMITTED                                        00310062
003200     BLOCK CONTAINS 0 RECORDS                                     00320062
003300     DATA RECORD IS OUTPUT-SML-RECORD.                            00330062
003400 01  OUTPUT-SML-RECORD                   PIC  X(250).             00340062
003500                                                                  00350062
003600 WORKING-STORAGE SECTION.                                         00360062
003700                                                                  00370062
004500******************************************************************00450062
004600* PROGRAM CONSTANTS                                               00460062
004700******************************************************************00470062
004800 01  PC-CONSTANTS-FIELDS.                                         00480062
004900     05  PC-PGM-NAME                     PIC  X(08) VALUE         00490062
005000                                                    'SUKUT199'.   00500062
005100     05  PC-MAX-RETRIES                  PIC S9(03) VALUE +3      00510062
005200                                                    COMP-3.       00520062
005300                                                                  00530062
005400******************************************************************00540062
005500* PROGRAM VARIABLES                                               00550062
005600******************************************************************00560062
005700 01  PV-VARIABLE-FIELDS.                                          00570062
005800     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACE.  00580062
005900     05  PV-DB2-OPERATION                PIC  X(30) VALUE SPACE.  00590062
006000     05  PV-RETRY-COUNTER                PIC S9(04) VALUE ZEROS   00600062
006100                                                    COMP SYNC.    00610062
006200     05  PV-NULL-IND                     PIC S9(04) VALUE ZERO    00620062
006300                                                    COMP SYNC.    00630062
006400     05  PV-SHIPT-UNT-ID                 PIC S9(18)V VALUE ZERO   00640062
006401                                                     COMP-3.      00640162
006402     05  PV-DISPLAY-CARTON               PIC  9(20).              00640262
006403     05  PV-TRIP-ID                      PIC S9(09) COMP.         00640362
006430     05  PV-EDIT-FIELD                   PIC  ZZZ,ZZZ,ZZ9.        00643062
006440     05  PV-TIMESTAMP-DATE               PIC  X(10) VALUE SPACES. 00644062
006450     05  PV-TIMESTAMP-TIME               PIC  X(08) VALUE SPACES. 00645062
006460     05  PV-TIMESTAMP.                                            00646062
006470         10  PV-DATE-FIELD               PIC  X(10) VALUE SPACES. 00647062
006480         10  FILLER                      PIC  X(01) VALUE SPACES. 00648062
006490         10  PV-TIME-FIELD.                                       00649062
006500             15 PV-TIME-HH               PIC  X(02) VALUE SPACES. 00650062
006600             15 PV-TIME-COLON1           PIC  X(01) VALUE SPACES. 00660062
006610             15 PV-TIME-MM               PIC  X(02) VALUE SPACES. 00661062
006620             15 PV-TIME-COLON2           PIC  X(01) VALUE SPACES. 00662062
006630             15 PV-TIME-MM               PIC  X(02) VALUE SPACES. 00663062
006640         10  FILLER                      PIC  X(07) VALUE SPACES. 00664062
006650                                                                  00665062
006660******************************************************************00666062
006670* PROGRAM ACCUMULATORS                                            00667062
006680******************************************************************00668062
006690 01  PA-PROGRAM-ACCUMULATORS.                                     00669062
006700     05  PA-INPUT-RECORDS-READ           PIC  9(09) VALUE ZEROS.  00670062
006800     05  PA-DTL-RECORDS-READ             PIC  9(09) VALUE ZEROS.  00680062
006900     05  PA-DTL-REC-BYPASSED             PIC  9(09) VALUE ZEROS.  00690086
006920     05  PA-OUTPUT-RECS-WROTE            PIC  9(09) VALUE ZEROS.  00692073
006700     05  PA-CARTON-COUNT                 PIC  9(06) VALUE ZEROS.  00693095
007000                                                                  00700062
007100******************************************************************00710062
007200* PROGRAM SWITCHES                                                00720062
007300******************************************************************00730062
007400 01  PS-SWITCH-AREAS.                                             00740062
007500     05  PS-FIRST-TIME-SW                PIC  X(01) VALUE 'Y'.    00750062
007600         88  PS-FIRST-TIME-Y                        VALUE 'Y'.    00760062
007700         88  PS-FIRST-TIME-N                        VALUE 'N'.    00770062
007800     05  PS-END-OF-INPUT-FILE-SW         PIC  X(01) VALUE 'N'.    00780062
007900         88  PS-END-OF-INPUT-FILE                   VALUE 'Y'.    00790062
008000         88  PS-NOT-END-OF-FILE                     VALUE 'N'.    00800062
008100     05  PS-SML-CSR-EOF-SW               PIC  X(01) VALUE 'N'.    00810062
008200         88  PS-SML-CSR-EOF                         VALUE 'Y'.    00820062
008300         88  PS-SML-CSR-NOT-EOF                     VALUE 'N'.    00830062
008301     05  PS-FOUND-SW                     PIC  X(01) VALUE 'N'.    00830180
008302         88  PS-FOUND                               VALUE 'Y'.    00830280
008303         88  PS-NOT-FOUND                           VALUE 'N'.    00830380
008304     05  PS-SCAN-FOUND-SW                PIC  X(01) VALUE 'N'.    00830485
008305         88  PS-SCAN-FOUND                          VALUE 'Y'.    00830585
008306         88  PS-SCAN-NOT-FOUND                      VALUE 'N'.    00830685
008307     05  PS-RECORD-FOUND-SW              PIC  X(01) VALUE 'N'.    00830780
008308         88  PS-RECORD-FOUND                        VALUE 'Y'.    00830880
008309         88  PS-RECORD-NOT-FOUND                    VALUE 'N'.    00830980
008307     05  PS-PROCESS-SW                   PIC  X(01) VALUE 'N'.    00831089
008308         88  PS-PROCESS-SHIP                        VALUE 'P'.    00832089
008308         88  PS-PROCESS-SCAN                        VALUE 'N'.    00832189
008400                                                                  00840062
008500******************************************************************00850062
008600* ABEND INFORMATION                                               00860062
008700******************************************************************00870062
008800 01  ABEND-CODE                          PIC S9(04) VALUE ZEROS   00880062
008900                                                    COMP SYNC.    00890062
009000     88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  00900062
009100     88  ABEND-4002-READ-ERROR                      VALUE +4002.  00910062
009200     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  00920062
009300     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  00930062
009400     88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  00940062
009500     88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  00950062
009600     88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  00960062
009700     88  ABEND-4008-DATA-ERROR                      VALUE +4008.  00970062
009800     88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  00980062
009900     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  00990062
010000     88  ABEND-4019-CAL-SUB-ERROR                   VALUE +4019.  01000062
010100     88  ABEND-4020-MQ-ERROR                        VALUE +4020.  01010062
010200     88  ABEND-4444-FORCED-ABEND                    VALUE +4444.  01020062
010300                                                                  01030062
010800****ABEND ROUTINE INFORMATION                                     01080062
010900     COPY DPWS004.                                                01090062
011000                                                                  01100062
011100****INPUT/OUTPUT COPYBOOK                                         01110062
011200     COPY SURD163.                                                01120062
011300                                                                  01130062
012100******************************************************************01210062
012200* TABLE INCLUSIONS                                                01220062
012300******************************************************************01230062
012400                                                                  01240062
012500** SUT_OTBND_CART TABLE                                           01250062
012600     EXEC SQL INCLUDE SUT00024 END-EXEC.                          01260062
012700                                                                  01270062
012800** SUT_OTBND_LOC TABLE                                            01280062
012900     EXEC SQL INCLUDE SUT00027 END-EXEC.                          01290062
012910                                                                  01291074
012920** SUT_OTBND_UPC TABLE                                            01292074
012930     EXEC SQL INCLUDE SUT00028 END-EXEC.                          01293074
013000                                                                  01300062
013010** SUT_OTBND_STR_SCN                                              01301074
013020     EXEC SQL INCLUDE SUT00121 END-EXEC.                          01302074
013300                                                                  01330062
013400** CARTON DIVERT/OUTBOUND TRIP ASSOCIATION TABLE                  01340062
013500     EXEC SQL INCLUDE TSUCDOT END-EXEC.                           01350062
013600                                                                  01360062
013700** OUTBOUND TRAILER TRIP TABLE                                    01370062
013710     EXEC SQL INCLUDE TSUOBTR END-EXEC.                           01371062
013711                                                                  01371162
013712** OUTBOUND TRAILER TRIP STATUS TABLE                             01371262
013713     EXEC SQL INCLUDE TSUOBTS END-EXEC.                           01371362
013714                                                                  01371462
013715** OUTBOUND TRAILER TRIP STATUS CODE DEFINITION                   01371562
013716     EXEC SQL INCLUDE TSUOBSC END-EXEC.                           01371662
013717                                                                  01371762
013718** CARTON DIVERT FROM CONVEYOR SYSTEM TABLE                       01371862
013719     EXEC SQL INCLUDE TSUCRDV END-EXEC.                           01371962
013720                                                                  01372062
013721** DC DOOR TO STORE ASSOCIATION TABLE                             01372162
013722     EXEC SQL INCLUDE TCNDRST END-EXEC.                           01372262
013723                                                                  01372362
013724** DC DOOR TABLE                                                  01372462
013725     EXEC SQL INCLUDE TCNDCDR END-EXEC.                           01372562
013726                                                                  01372662
013727******************************************************************01372764
013728* VARIOUS CURSORS, SELECTS, AND WORKING STORAGE AREAS FOR         01372864
013729* RETRIEVING CARTONS                                              01372964
013730******************************************************************01373064
013731     COPY PCWS049.                                                01373164
013732     COPY PCWS050.                                                01373264
013733                                                                  01373364
013734** DB2 TABLE INCLUSION                                            01373462
013735     EXEC SQL INCLUDE SQLCA    END-EXEC.                          01373562
013736                                                                  01373662
013737******************************************************************01373763
013738****ABEND ROUTINE INFORMATION                                     01373863
013739     COPY SQLCA2.                                                 01373963
013740                                                                  01374063
013741 PROCEDURE DIVISION.                                              01374162
013742******************************************************************01374262
013750 0000-MAINLINE-PROCESSING.                                        01375062
013760                                                                  01376062
013770     PERFORM 1000-INITIALIZATION.                                 01377062
013780                                                                  01378062
013790     PERFORM 2000-PROCESS-INPUT-FILE                              01379062
013800       UNTIL PS-END-OF-INPUT-FILE.                                01380062
013900                                                                  01390062
014000     PERFORM 9000-WRAPUP.                                         01400062
014100     GOBACK.                                                      01410062
014200                                                                  01420062
014300******************************************************************01430062
014400* INITIALIZATION ROUTINE                                          01440062
014500******************************************************************01450062
014600 1000-INITIALIZATION.                                             01460062
014700                                                                  01470062
014800     DISPLAY ' '.                                                 01480062
014900     DISPLAY '*******************************************'.       01490062
015000     DISPLAY '***  PROGRAM NAME:  '  PC-PGM-NAME.                 01500062
015100     DISPLAY ' '.                                                 01510062
015200                                                                  01520062
015300     OPEN INPUT  INPUT-EXTRACT-DC-FILE                            01530071
015500          OUTPUT OUTPUT-SML-FILE.                                 01550062
015600                                                                  01560062
015900     PERFORM 1200-READ-INPUT-FILE.                                01590062
016000                                                                  01600062
018400******************************************************************01840062
018500* READ THE INPUT STATUS 'DC'(DC CLOSED) TRAILER FILE              01850071
018600******************************************************************01860062
018700 1200-READ-INPUT-FILE.                                            01870062
018800                                                                  01880062
018900     READ INPUT-EXTRACT-DC-FILE INTO SU163-EXTRACT-RECORD         01890062
019000        AT END                                                    01900062
019100           SET PS-END-OF-INPUT-FILE  TO TRUE.                     01910071
019200                                                                  01920062
019300     IF PS-END-OF-INPUT-FILE                                      01930062
019400         IF PS-FIRST-TIME-Y                                       01940062
019500            DISPLAY ' '                                           01950062
019600            DISPLAY '-- INPUT FILE MISSING --'                    01960062
019700            DISPLAY ' '                                           01970062
019800         END-IF                                                   01980062
019900     ELSE                                                         01990062
020000         ADD 1                       TO PA-INPUT-RECORDS-READ     02000071
020100         MOVE SU163-OTBND-TRIP-ID    TO PC049-DK-OTBND-TRIP-ID    02010071
020200         MOVE SU163-ORGN-OPER-UNT-ID TO PC049-DK-OPER-UNT-ID      02020071
020400         MOVE SU163-DEST-OPER-UNT-ID TO PC049-DK-TRLR-DEST        02040071
020600         SET PS-FIRST-TIME-N         TO TRUE                      02060071
020700     END-IF.                                                      02070062
020800                                                                  02080062
020900******************************************************************02090062
021000* PROCESS ALL THE RECORDS IN THE INPUT FILE                       02100062
021100******************************************************************02110062
021200 2000-PROCESS-INPUT-FILE.                                         02120062
021300                                                                  02130065
021330     PERFORM P4000-STRT-END-DVRT.                                 02133065
021340                                                                  02134065
021360     IF PC049-DIVERT-CUTOFFS-YES                                  02136065
021370        PERFORM 2100-CONTINUE                                     02137065
021372     ELSE                                                         02137278
021373        PERFORM 2200-CONTINUE                                     02137389
021375     END-IF.                                                      02137688
021376                                                                  02137788
006700     DISPLAY 'TRIP ID- ' SU163-OTBND-TRIP-ID                      02137893
006700             '  CARTON COUNT- '  PA-CARTON-COUNT.                 02138093
006700     MOVE ZERO          TO PA-CARTON-COUNT.                       02138193
021378                                                                  02138293
021377     PERFORM 1200-READ-INPUT-FILE.                                02138393
021378                                                                  02138493
021379******************************************************************02138593
021380 2100-CONTINUE.                                                   02139088
021400                                                                  02140065
021410     SET PC049-NOT-EOF-SHP-ACTV-CRTN TO TRUE.                     02141065
021500     PERFORM P7120-OPEN-SHP-ACTV-CRTN-CSR.                        02150062
021600                                                                  02160062
022100     PERFORM P7125-FETCH-SHP-ACTV-CRTN-CSR.                       02210089
022200     IF PC049-EOF-SHP-ACTV-CRTN                                   02220089
022300        CONTINUE                                                  02230089
022400                                                                  02240062
022500     ELSE                                                         02250089
022510        PERFORM 3000-SELECT-DATA                                  02251089
022510        SET PS-PROCESS-SHIP  TO TRUE                              02252089
022600        PERFORM 2300-PROCESS-RECORDS                              02260089
022700           UNTIL PC049-EOF-SHP-ACTV-CRTN                          02270089
022900     END-IF.                                                      02290062
023000                                                                  02300062
023100     PERFORM P7130-CLOSE-SHP-ACTV-CRTN-CSR.                       02310062
023200                                                                  02320062
023500******************************************************************02321088
021373 2200-CONTINUE.                                                   02330089
021400                                                                  02340088
057900     SET PC049-NOT-EOF-SCAN-CRTN TO TRUE.                         02340189
021500     PERFORM P7000-OPEN-SCAN-CRTN-CSR.                            02342088
021600                                                                  02343088
060400     PERFORM P7010-FETCH-SCAN-CRTN-CSR.                           02347189
057900     IF PC049-EOF-SCAN-CRTN                                       02347289
021373        DISPLAY '-- NO CARTONS MANIFESTED'                        02347389
021374                '   TRIP-ID='  SU163-OTBND-TRIP-ID                02347489
022400                                                                  02349288
022500     ELSE                                                         02349389
022510        PERFORM 3000-SELECT-DATA                                  02349489
022510        MOVE SPACES TO PC049-PV-REC-TYPE                          02349589
022510        SET PS-PROCESS-SCAN  TO TRUE                              02349689
022600        PERFORM 2300-PROCESS-RECORDS                              02349789
022700           UNTIL PC049-EOF-SCAN-CRTN                              02349889
023000                                                                  02349989
022900     END-IF.                                                      02350289
023000                                                                  02350389
065000     PERFORM P7020-CLOSE-SCAN-CRTN-CSR.                           02350490
023000                                                                  02350589
023500******************************************************************02351062
023600* POPULATE THE OUTPUT RECORD                                      02360062
023700******************************************************************02370062
023800 2300-PROCESS-RECORDS.                                            02380062
023810                                                                  02381071
006700     ADD 1                          TO PA-CARTON-COUNT            02382193
023820                                       PA-DTL-RECORDS-READ.       02382293
023821                                                                  02382373
023830     IF PC049-PV-TYP-ASSM                                         02383073
023840        ADD 1                       TO PA-DTL-REC-BYPASSED        02384073
023841                                                                  02384173
023850     ELSE                                                         02385073
023850        IF PS-PROCESS-SHIP                                        02386089
023900           MOVE SUCRDV-SHIPT-UNT-ID   TO PV-SHIPT-UNT-ID          02390089
024100                                         SU163-SHIPT-UNIT-ID      02410089
023850        ELSE                                                      02411089
023900           MOVE SUT00027-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID          02412089
024100                                         SU163-SHIPT-UNIT-ID      02413089
023850        END-IF                                                    02414089
024200        PERFORM 4010-RETRIEVE-CARTON-INFO                         02420073
024300                                                                  02430062
024310        IF PS-FOUND                                               02431080
024400           IF PS-PROCESS-SHIP                                     02440089
024400              MOVE SUCRDV-OPER-UNT-ID    TO SU163-STR-SCAN-LOC    02441089
024400           ELSE                                                   02442089
024400              MOVE SUT00027-LOC-NBR      TO SU163-STR-SCAN-LOC    02443090
024400           END-IF                                                 02444089
024500           MOVE PV-TIMESTAMP-DATE        TO SU163-SML-CRE-DTE     02450089
024600           MOVE PV-TIMESTAMP-TIME        TO SU163-SML-CRE-TM      02460089
024800           MOVE SUT00024-ACTV-IND        TO SU163-ACTV-IND        02480089
024900           MOVE SUT00024-ORIG-CART-ID    TO SU163-ORIG-CART-ID    02490089
025000           MOVE SUT00024-ORGN-LOC-NBR    TO SU163-SML-ORGN-LOC-NBR02500089
025100           MOVE SUT00024-DEST-LOC-NBR    TO SU163-SML-DEST-LOC-NBR02510089
025200           MOVE SUT00024-CART-SRC-CDE    TO SU163-CART-SRC-CDE    02520089
025210        END-IF                                                    02522080
025300                                                                  02530062
025600        IF SUOBTS-OTBND-STAT-TMST > SPACES                        02560073
025700           MOVE SUOBTS-OTBND-STAT-TMST TO PV-TIMESTAMP            02570073
025800           MOVE PV-DATE-FIELD          TO SU163-STR-SCAN-DATE     02580073
025900           MOVE ':'                    TO PV-TIME-COLON1          02590073
026000                                          PV-TIME-COLON2          02600073
026100           MOVE PV-TIME-FIELD          TO SU163-STR-SCAN-TIME     02610073
026110        ELSE                                                      02611078
026111           MOVE SPACES                 TO SU163-STR-SCAN-DATE     02611178
026114                                          SU163-STR-SCAN-TIME     02611478
026200        END-IF                                                    02620073
026300                                                                  02630062
026310        PERFORM 4000-SELECT-DATA                                  02631073
026320                                                                  02632073
026330        IF PS-RECORD-FOUND                                        02633073
026391           MOVE SUT00121-SCN-LOC-NBR  TO SU163-STR-SCAN-LOC       02639173
026392           MOVE SUT00121-SCN-TYP-CDE  TO SU163-STR-SCAN-TYPE-CDE  02639273
026393           MOVE SUT00121-ORIG-OTBND-TRIP-ID                       02639373
026394                                    TO SU163-STR-SCAN-ORIG-TRIP-ID02639473
026395           MOVE SUT00121-SCN-FR-MSTR-IND                          02639573
026396                                    TO SU163-STR-SCAN-FR-MSTR-IND 02639673
026397           PERFORM 2400-WRITE-OUTPUT-RECORD                       02639785
026398                                                                  02639885
026399        ELSE                                                      02639985
026400           IF PS-SCAN-NOT-FOUND                                   02640085
026401              MOVE ZEROES           TO SU163-STR-SCAN-LOC         02640186
026402                                       SU163-STR-SCAN-ORIG-TRIP-ID02640286
026403              MOVE SPACES           TO SU163-STR-SCAN-TYPE-CDE    02640386
026404                                       SU163-STR-SCAN-FR-MSTR-IND 02640486
026407              PERFORM 2400-WRITE-OUTPUT-RECORD                    02640785
026410           END-IF                                                 02641085
026411        END-IF                                                    02641185
026412                                                                  02641285
026420     END-IF.                                                      02642073
026500                                                                  02650062
024400     IF PS-PROCESS-SHIP                                           02651089
026600        PERFORM P7125-FETCH-SHP-ACTV-CRTN-CSR                     02660089
024400     ELSE                                                         02661089
060400        PERFORM P7010-FETCH-SCAN-CRTN-CSR                         02661189
024400     END-IF.                                                      02663089
026700                                                                  02670062
026800******************************************************************02680062
026900* WRITE THE OUTPUT RECORD                                         02690062
027000******************************************************************02700062
027100 2400-WRITE-OUTPUT-RECORD.                                        02710062
027200                                                                  02720062
027300     WRITE OUTPUT-SML-RECORD FROM SU163-EXTRACT-RECORD.           02730062
027400                                                                  02740062
027500     ADD +1              TO PA-OUTPUT-RECS-WROTE.                 02750062
027600                                                                  02760062
027700******************************************************************02770062
027800 3000-SELECT-DATA.                                                02780062
027900                                                                  02790062
028000     EXEC SQL                                                     02800062
028100        SELECT MAX(OTBND_STAT_TMST)                               02810062
028200          INTO :SUOBTS-OTBND-STAT-TMST                            02820062
028300          FROM TSUOBTS                                            02830062
028400         WHERE OTBND_TRIP_ID  = :PC049-DK-OTBND-TRIP-ID           02840070
028500           AND TRIP_STAT_CDE  = 'DC'                              02850062
028600         WITH UR                                                  02860062
028700     END-EXEC.                                                    02870062
028800                                                                  02880062
028900     EVALUATE TRUE                                                02890062
029000         WHEN SQLCODE = ZERO                                      02900062
029100             CONTINUE                                             02910062
029200                                                                  02920062
029300         WHEN SQLCODE = +100                                      02930062
029400             MOVE SPACES               TO SUOBTS-OTBND-STAT-TMST  02940062
029500                                                                  02950062
029600         WHEN SQLWARN0 NOT EQUAL SPACE                            02960062
029700         WHEN SQLCODE NOT EQUAL ZERO                              02970062
029800             DISPLAY ' ERROR TRIP-ID = '  PC049-DK-OTBND-TRIP-ID  02980070
029900             DISPLAY ' ERROR SHIP-UNT-ID= '                       02990062
030000                                          SUT00024-SHIPT-UNT-ID   03000062
030100             MOVE '3000-SELECT-DATA'   TO PV-PARAGRAPH-NAME       03010062
030200             MOVE 'ERROR SELECTING DATA'                          03020062
030300                                       TO PV-DB2-OPERATION        03030062
030400             SET ABEND-4002-READ-ERROR TO TRUE                    03040062
030500             PERFORM 9200-SQL-ABEND                               03050062
030600                                                                  03060062
030700     END-EVALUATE.                                                03070062
030800                                                                  03080062
030810******************************************************************03081072
030820 4000-SELECT-DATA.                                                03082072
030821                                                                  03082176
030822     SET PS-SCAN-FOUND         TO TRUE.                           03082285
030823     SET PS-RECORD-NOT-FOUND   TO TRUE.                           03082385
030830                                                                  03083073
030840     EXEC SQL                                                     03084072
030841        SELECT CRE_TMST                                           03084172
030850              ,SCN_LOC_NBR                                        03085072
030870              ,SCN_TYP_CDE                                        03087072
030880              ,ORIG_OTBND_TRIP_ID                                 03088072
030890              ,SCN_FR_MSTR_IND                                    03089072
030891          INTO :SUT00121-CRE-TMST                                 03089172
030892              ,:SUT00121-SCN-LOC-NBR                              03089272
030894              ,:SUT00121-SCN-TYP-CDE                              03089472
030895              ,:SUT00121-ORIG-OTBND-TRIP-ID                       03089572
030896               :PV-NULL-IND                                       03089672
030897              ,:SUT00121-SCN-FR-MSTR-IND                          03089772
030898          FROM SUT_OTBND_STR_SCN                                  03089872
030899         WHERE SHIPT_UNT_ID  = :PV-SHIPT-UNT-ID                   03089972
030900           AND SCN_TYP_CDE   IN ('SSAR','SSAU')                   03090085
030901             ORDER BY CRE_TMST DESC                               03090172
030902           FETCH FIRST 1 ROW ONLY                                 03090272
030903          WITH UR                                                 03090372
030904     END-EXEC.                                                    03090472
030905                                                                  03090572
030906     EVALUATE TRUE                                                03090672
030907         WHEN SQLCODE = ZERO                                      03090772
030908             SET PS-RECORD-FOUND       TO TRUE                    03090872
030909             IF PV-NULL-IND = -1                                  03090972
030910                MOVE ZEROES            TO                         03091072
030911                                       SUT00121-ORIG-OTBND-TRIP-ID03091172
030912             END-IF                                               03091272
030913                                                                  03091372
030914         WHEN SQLCODE = +100                                      03091472
030915             SET PS-SCAN-NOT-FOUND     TO TRUE                    03091585
030917                                                                  03091775
030918         WHEN SQLWARN0 NOT EQUAL SPACE                            03091875
030919         WHEN SQLCODE NOT EQUAL ZERO                              03091975
030920             DISPLAY ' ERROR TRIP-ID = '  PV-TRIP-ID              03092075
030921             MOVE PV-SHIPT-UNT-ID      TO PV-DISPLAY-CARTON       03092185
030922             DISPLAY ' ERROR SHIP-UNT-ID= '                       03092272
030923                                          PV-DISPLAY-CARTON       03092372
030924             MOVE '4000-SELECT-DATA'   TO PV-PARAGRAPH-NAME       03092472
030925             MOVE 'ERROR SELECTING DATA'                          03092572
030926                                       TO PV-DB2-OPERATION        03092672
030927             SET ABEND-4002-READ-ERROR TO TRUE                    03092772
030928             PERFORM 9200-SQL-ABEND                               03092872
030929                                                                  03092972
030930     END-EVALUATE.                                                03093072
030931                                                                  03093172
030940******************************************************************03094062
031000*  RETRIEVE OTBND_CART INFO                                       03100062
031100******************************************************************03110062
031200 4010-RETRIEVE-CARTON-INFO.                                       03120062
031300                                                                  03130062
031400     EXEC SQL                                                     03140062
031500         SELECT  ACTV_IND                                         03150062
031600                ,CART_SRC_CDE                                     03160062
031700                ,CRE_DTE                                          03170062
031800                ,CHAR(CRE_TM,JIS)                                 03180062
031900                ,ORGN_LOC_NBR                                     03190062
032000                ,DEST_LOC_NBR                                     03200062
032100                ,ORIG_CART_ID                                     03210062
032200          INTO  :SUT00024-ACTV-IND                                03220062
032300               ,:SUT00024-CART-SRC-CDE                            03230062
032400               ,:PV-TIMESTAMP-DATE                                03240062
032500               ,:PV-TIMESTAMP-TIME                                03250062
032600               ,:SUT00024-ORGN-LOC-NBR                            03260062
032700               ,:SUT00024-DEST-LOC-NBR                            03270062
032800               ,:SUT00024-ORIG-CART-ID                            03280062
032900          FROM  SUT_OTBND_CART                                    03290062
033000         WHERE  SHIPT_UNT_ID = :PV-SHIPT-UNT-ID                   03300062
033100           WITH UR                                                03310062
033200     END-EXEC.                                                    03320062
033300                                                                  03330062
033400     EVALUATE TRUE                                                03340062
033500         WHEN SQLCODE = ZERO                                      03350062
033510             SET PS-FOUND      TO TRUE                            03351080
033520                                                                  03352080
033600         WHEN SQLCODE = +100                                      03360062
033700             SET PS-NOT-FOUND  TO TRUE                            03370080
033800                                                                  03380062
033900         WHEN SQLWARN0 NOT = SPACES                               03390062
034000         WHEN SQLCODE < ZERO                                      03400062
034100         WHEN SQLCODE > ZERO                                      03410062
034200            MOVE '4010-RETRIEVE-CARTON-INFO'                      03420062
034300                                            TO PV-PARAGRAPH-NAME  03430062
034400            MOVE 'SELECT OTBNDCART'         TO PV-DB2-OPERATION   03440062
034500            MOVE PV-SHIPT-UNT-ID            TO PV-DISPLAY-CARTON  03450062
034600            DISPLAY 'CARTON BEING PROCESSED IS ' PV-DISPLAY-CARTON03460062
034700            PERFORM 9200-SQL-ABEND                                03470062
034800                                                                  03480062
034900     END-EVALUATE.                                                03490062
035000                                                                  03500062
035100******************************************************************03510062
035200* CLOSE INPUT/OUTPUT FILES AND DISPLAY PROGRAM COUNTS             03520062
035300******************************************************************03530062
035400 9000-WRAPUP.                                                     03540062
035500                                                                  03550062
035600     CLOSE INPUT-EXTRACT-DC-FILE                                  03560071
035800           OUTPUT-SML-FILE.                                       03580062
035900                                                                  03590062
036000     PERFORM 9100-DISPLAY-COUNTS.                                 03600062
036100                                                                  03610062
036200******************************************************************03620062
036300* DISPLAY PROGRAM COUNTS                                          03630062
036400******************************************************************03640062
036500 9100-DISPLAY-COUNTS.                                             03650062
036600                                                                  03660062
036700     MOVE PA-INPUT-RECORDS-READ             TO PV-EDIT-FIELD.     03670062
036800     DISPLAY ' INPUT RECORDS READ.......: '    PV-EDIT-FIELD.     03680062
036900                                                                  03690062
037000     MOVE PA-DTL-RECORDS-READ               TO PV-EDIT-FIELD.     03700062
037100     DISPLAY ' DETAIL CSR RECORDS READ..: '    PV-EDIT-FIELD.     03710062
037110                                                                  03711073
037120     MOVE PA-DTL-REC-BYPASSED               TO PV-EDIT-FIELD.     03712073
037130     DISPLAY ' DETAIL CSR RECORDS BYPASS: '    PV-EDIT-FIELD.     03713073
037200                                                                  03720062
037300     MOVE PA-OUTPUT-RECS-WROTE              TO PV-EDIT-FIELD.     03730062
037400     DISPLAY ' OUTPUT RECORDS WROTE.....: '    PV-EDIT-FIELD.     03740062
037500                                                                  03750062
037600     DISPLAY ' '.                                                 03760062
037700     DISPLAY '*******************************************'.       03770062
037800     DISPLAY ' '.                                                 03780062
037900                                                                  03790062
038000******************************************************************03800062
038100* ABEND ROUTINE FOR BAD SQL CALLS                                 03810062
038200******************************************************************03820062
038300 9200-SQL-ABEND.                                                  03830062
038400                                                                  03840062
038500     DISPLAY '** ABEND     **'.                                   03850062
038600     DISPLAY '** PROGRAM   ** = ' PC-PGM-NAME.                    03860062
038700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03870062
038800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               03880062
038900     DISPLAY '** SQLCODE   ** = ' SQLCODE.                        03890062
039000                                                                  03900062
039100***************************************************************** 03910062
039200*    COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED  03920062
039300*    TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.   03930062
039400***************************************************************** 03940062
039500     COPY DPPD004.                                                03950062
039600                                                                  03960062
039700     CALL 'ILBOABN0' USING ABEND-CODE.                            03970062
039800                                                                  03980062
039900***************************************************************** 03990062
040000* PCPD049 - PROCEDURE DIVISION USED TO DETERMINE TRAILER CONTENTS 04000062
040100***************************************************************** 04010062
040200     COPY PCPD049.                                                04020062
040300                                                                  04030062
