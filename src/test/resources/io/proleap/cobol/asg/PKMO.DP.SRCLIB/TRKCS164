000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS164.                                         00040099
000500 AUTHOR.        NIRMAL KUMAR.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  04/98.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y164 - PO RECEIVING LIST PROGRAM.                          * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL PO RECEIPTS BASED     * 00130099
001400*    ON THE RECEIPT DATE.                                       * 00140099
001500*                                                               * 00150099
001600*---------------------------------------------------------------* 00160099
001610***************************************************************** 00161099
001620* DATE  05/16/2011                                                00162099
001630*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL  00163099
001640*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR         00164099
001650*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC   00165099
001660*  AND TSKXREF.                                                   00166099
001670*  MADE BY: GERMAN BANDA                                          00167099
001680***************************************************************** 00168099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00169199
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00169299
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00169399
263697*---------------------------------------------------------------* 00169499
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00169599
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00169699
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00169799
CICS  *-----------------------------------------------------------------00169899
001700                                                                  00170099
001800 ENVIRONMENT DIVISION.                                            00180099
001900                                                                  00190099
002000 DATA DIVISION.                                                   00200099
002100                                                                  00210099
002200 WORKING-STORAGE SECTION.                                         00220099
002300                                                                  00230099
002400 01  DK-DB2-KEYS.                                                 00240099
002500     15  DK-PO-NBR                      PIC S9(09)  COMP.         00250099
002600                                                                  00260099
002700 01  PC-PROGRAM-CONSTANTS.                                        00270099
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280099
002900                                                    'TR164A  '.   00290099
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300099
003100                                                    'TRKM164 '.   00310099
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320099
003300                                                    'TRKCS164'.   00330099
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340099
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350099
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     00360099
003700                                                    COMP SYNC.    00370099
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380099
003900                                                    COMP SYNC.    00390099
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400099
004100                                                    +1000000      00410099
004200                                                    COMP-3.       00420099
004300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00430099
004400                                                    COMP SYNC.    00440099
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450099
004600                                                    COMP-3.       00460099
004700     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00470099
004800                                                    '0001-01-01'. 00480099
004900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00490099
005600                                                                  00560099
005700     05  PC-TSYMSG-NUMBERS.                                       00570099
005800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00580099
005900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00590099
006000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00600099
006100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00610099
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00620099
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00630099
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00640099
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00650099
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00660099
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00670099
006800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00680099
006900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00690099
007000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00700099
007100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00710099
007200                                                                  00720099
007300 01  PS-PROGRAM-SWITCHES.                                         00730099
007400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00740099
007500         88  PS-NO-ERROR                            VALUE 'Y'.    00750099
007600         88  PS-ERROR                               VALUE 'N'.    00760099
007700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00770099
007800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00780099
007900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00790099
008000                                                                  00800099
008100 01  PV-PROGRAM-VARIABLES.                                        00810099
008110     05  PV-DEPT-NBR                    PIC  X(04).               00811099
008120     05  PV-DEPT-NBR-N REDEFINES                                  00812099
008130         PV-DEPT-NBR                    PIC S9(04).               00813099
008200     05  PV-SUB                         PIC S9(04)  VALUE +0      00820099
008300                                                    COMP SYNC.    00830099
008400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00840099
008500                                                    COMP SYNC.    00850099
008600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00860099
008700                                                    COMP-3.       00870099
008800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00880099
008900                                                    COMP-3.       00890099
009000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00900099
009100                                                    COMP-3.       00910099
009200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00920099
009300                                                    COMP-3.       00930099
009400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00940099
009500                                                    COMP-3.       00950099
009600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00960099
009700                                                    COMP SYNC.    00970099
009800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00980099
009900                                                    COMP SYNC.    00990099
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000099
010100                                                    COMP SYNC.    01010099
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020099
010300                                                    COMP SYNC.    01030099
010400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01040099
010500                                                    COMP-3.       01050099
010600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01060099
010700                                                    COMP SYNC.    01070099
010800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01080099
010900                                                    COMP SYNC.    01090099
011000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01100099
011100                                                    COMP SYNC.    01110099
011200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01120099
011300                                                    COMP SYNC.    01130099
011400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01140099
011500                                                    COMP SYNC.    01150099
011600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01180099
011900                                                    COMP SYNC.    01190099
012000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01200099
012100                                                    COMP SYNC.    01210099
012200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01220099
012300                                                    COMP SYNC.    01230099
012400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01240099
012500                                                    COMP SYNC.    01250099
012600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01260099
012700                                                    COMP SYNC.    01270099
012800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01280099
012900                                                    COMP SYNC.    01290099
013000     05  PV-TAURCPO-CNT                 PIC S9(04)  VALUE +0      01300099
013100                                                    COMP SYNC.    01310099
013200     05  PV-TIMRCPO-CNT                 PIC S9(04)  VALUE +0      01320099
013201                                                    COMP SYNC.    01320199
013202     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      01320299
013203                                                    COMP.         01320399
013204     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      01320499
013205                                                    COMP.         01320599
013206     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      01320699
013207                                                    COMP.         01320799
013208     05  PV-DATE-BREAK.                                           01320899
013209         10 FILLER                      PIC  X(02).               01320999
013210         10 PV-DB-YY                    PIC  X(02).               01321099
013211         10 FILLER                      PIC  X(01).               01321199
013212         10 PV-DB-MM                    PIC  X(02).               01321299
013213         10 FILLER                      PIC  X(01).               01321399
013214         10 PV-DB-DD                    PIC  X(02).               01321499
013215     05  PV-DATE-DISPLAY.                                         01321599
013216         10 PV-DD-MM                    PIC  X(02).               01321699
013217         10 FILLER                      PIC  X(01)  VALUE '/'.    01321799
013218         10 PV-DD-DD                    PIC  X(02).               01321899
013219         10 FILLER                      PIC  X(01)  VALUE '/'.    01321999
013220         10 PV-DD-YY                    PIC  X(02).               01322099
013221     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01322199
013222     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01322299
013223                                                     COMP SYNC.   01322399
013224     05  PV-DISPLAY-PO-NBR              PIC  9(08) VALUE ZEROES.  01322499
013225     05  PV-DISPLAY-UNIT-COUNT          PIC  9(08) VALUE ZEROES.  01322599
013226     05  PV-DISPLAY-OTPK                PIC  9(04) VALUE ZEROES.  01322699
013227     05  PV-DISPLAY-ITEM-CART           PIC  9(08) VALUE ZEROES.  01322799
013228     05  PV-DISPLAY-CARTON-COUNT        PIC  9(08) VALUE ZEROES.  01322899
013230                                                                  01323099
013240*----------------------------------------------------------------*01324099
013250*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01325099
013260*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *01326099
013270*   APPLICATION-SPECIFIC COMMAREA.                               *01327099
013280*----------------------------------------------------------------*01328099
013290 01  LQW-LIST-QUEUE-WORK-AREA.                                    01329099
013300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01330099
013400     05  LQW-ITEM-ENTRIES               OCCURS 08   TIMES         01340099
013500                                        INDEXED BY  LQW-IDX.      01350099
013600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01360099
013700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01370099
013800         10  LQW-SELECTED-SW            PIC  X(01).               01380099
013900             88  LQW-SELECT                         VALUE 'S'.    01390099
014000             88  LQW-DESELECT                       VALUE ' '.    01400099
014100         10  LQW-ACTION                 PIC  X(03).               01410099
014200         10  LQW-RCP-DT                 PIC  X(10).               01420099
014300         10  LQW-TYPE                   PIC  X(03).               01430099
014400         10  LQW-VSL-NAME               PIC  X(18).               01440099
014500         10  LQW-TRIP-CODE              PIC  X(01).               01450099
014600         10  LQW-ETD                    PIC  X(05).               01460099
014700         10  LQW-UNTS                   PIC S9(09)  COMP.         01470099
014800         10  LQW-CTN                    PIC S9(04)  COMP.         01480099
014900         10  LQW-CBM                    PIC S9(4)V9(2) COMP-3.    01490099
015000         10  LQW-TRN-CNT                PIC  9(02).               01500099
015100         10  LQW-LAST-TRN               PIC  X(05).               01510099
015200         10  LQW-PO-RCVD-SEQ-NBR        PIC S9(04)  COMP.         01520099
015300                                                                  01530099
015400 EJECT                                                            01540099
015500*---------------------------------------------------------------* 01550099
015600*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.            01560099
015700*---------------------------------------------------------------* 01570099
015800                                                                  01580099
015900     COPY TRWS118.                                                01590099
016000                                                                  01600099
016100 EJECT                                                            01610099
016200*---------------------------------------------------------------* 01620099
016300*    MAP LAYOUT                                                 * 01630099
016400*---------------------------------------------------------------* 01640099
016500                                                                  01650099
016600     COPY TRKM164.                                                01660099
016700                                                                  01670099
016800 01  MR-OCCURS-LAYOUT                    REDEFINES  TR164AO.      01680099
016900     05  FILLER                          PIC X(260).              01690099
017000                                                                  01700099
017100     05  MR-SCROLL-AREA                  OCCURS 8 TIMES.          01710099
017200         10  MR-SELECTL                  PIC S9(04) COMP.         01720099
017300         10  MR-SELECTA                  PIC  X(01).              01730099
017400         10  MR-SELECTC                  PIC  X(01).              01740099
017500         10  MR-SELECTH                  PIC  X(01).              01750099
017600         10  MR-SELECTI                  PIC  X(01).              01760099
017700                                                                  01770099
017800         10  MR-ACTIONL                  PIC S9(04) COMP.         01780099
017900         10  MR-ACTIONA                  PIC  X(01).              01790099
018000         10  MR-ACTIONC                  PIC  X(01).              01800099
018100         10  MR-ACTIONH                  PIC  X(01).              01810099
018200         10  MR-ACTION                   PIC  X(03).              01820099
018300                                                                  01830099
018400         10  MR-RCP-DTL                  PIC S9(04) COMP.         01840099
018500         10  MR-RCP-DTA                  PIC  X(01).              01850099
018600         10  MR-RCP-DTC                  PIC  X(01).              01860099
018700         10  MR-RCP-DTH                  PIC  X(01).              01870099
018800         10  MR-RCP-DT                   PIC  X(05).              01880099
018900                                                                  01890099
019000         10  MR-TYPEL                    PIC S9(04) COMP.         01900099
019100         10  MR-TYPEA                    PIC  X(01).              01910099
019200         10  MR-TYPEC                    PIC  X(01).              01920099
019300         10  MR-TYPEH                    PIC  X(01).              01930099
019400         10  MR-TYPE                     PIC  X(03).              01940099
019500                                                                  01950099
019600         10  MR-VSL-NAMEL                PIC S9(04) COMP.         01960099
019700         10  MR-VSL-NAMEA                PIC  X(01).              01970099
019800         10  MR-VSL-NAMEC                PIC  X(01).              01980099
019900         10  MR-VSL-NAMEH                PIC  X(01).              01990099
020000         10  MR-VSL-NAME                 PIC  X(18).              02000099
020100                                                                  02010099
020200         10  MR-TRIP-CODEL               PIC S9(04) COMP.         02020099
020300         10  MR-TRIP-CODEA               PIC  X(01).              02030099
020400         10  MR-TRIP-CODEC               PIC  X(01).              02040099
020500         10  MR-TRIP-CODEH               PIC  X(01).              02050099
020600         10  MR-TRIP-CODE                PIC  X(01).              02060099
020700                                                                  02070099
020800         10  MR-ETDL                     PIC S9(04) COMP.         02080099
020900         10  MR-ETDA                     PIC  X(01).              02090099
021000         10  MR-ETDC                     PIC  X(01).              02100099
021100         10  MR-ETDH                     PIC  X(01).              02110099
021200         10  MR-ETD                      PIC  X(05).              02120099
021300                                                                  02130099
021400         10  MR-UNTSL                    PIC S9(04) COMP.         02140099
021500         10  MR-UNTSA                    PIC  X(01).              02150099
021600         10  MR-UNTSC                    PIC  X(01).              02160099
021700         10  MR-UNTSH                    PIC  X(01).              02170099
021800         10  MR-UNTS                     PIC  ZZZZZZZ9.           02180099
021900         10  MR-UNTS-X REDEFINES MR-UNTS PIC  X(08).              02190099
022000                                                                  02200099
022100         10  MR-CTNL                     PIC S9(04) COMP.         02210099
022200         10  MR-CTNA                     PIC  X(01).              02220099
022300         10  MR-CTNC                     PIC  X(01).              02230099
022400         10  MR-CTNH                     PIC  X(01).              02240099
022500         10  MR-CTN                      PIC  ZZZZ9.              02250099
022600         10  MR-CTN-X REDEFINES MR-CTN   PIC  X(05).              02260099
022700                                                                  02270099
022800         10  MR-CBML                     PIC S9(04) COMP.         02280099
022900         10  MR-CBMA                     PIC  X(01).              02290099
023000         10  MR-CBMC                     PIC  X(01).              02300099
023100         10  MR-CBMH                     PIC  X(01).              02310099
023200         10  MR-CBM                      PIC  ZZZ9.99.            02320099
023300         10  MR-CBM-X REDEFINES MR-CBM   PIC  X(07).              02330099
023400                                                                  02340099
023500         10  MR-TRN-CNTL                 PIC S9(04) COMP.         02350099
023600         10  MR-TRN-CNTA                 PIC  X(01).              02360099
023700         10  MR-TRN-CNTC                 PIC  X(01).              02370099
023800         10  MR-TRN-CNTH                 PIC  X(01).              02380099
023900         10  MR-TRN-CNT                  PIC  ZZ.                 02390099
024000                                                                  02400099
024100         10  MR-LAST-TRNL                PIC S9(04) COMP.         02410099
024200         10  MR-LAST-TRNA                PIC  X(01).              02420099
024300         10  MR-LAST-TRNC                PIC  X(01).              02430099
024400         10  MR-LAST-TRNH                PIC  X(01).              02440099
024500         10  MR-LAST-TRN                 PIC  X(05).              02450099
024600                                                                  02460099
024700     05  FILLER                          PIC  X(12).              02470099
024800                                                                  02480099
024900 EJECT                                                            02490099
025000*---------------------------------------------------------------* 02500099
025100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02510099
025200*---------------------------------------------------------------* 02520099
025300                                                                  02530099
025400     COPY DPWS015.                                                02540099
025500                                                                  02550099
025600 EJECT                                                            02560099
025700*---------------------------------------------------------------* 02570099
025800*    FUNCTION KEYS COPYBOOK.                                    * 02580099
025900*---------------------------------------------------------------* 02590099
026000                                                                  02600099
026100     COPY DPWS016.                                                02610099
026200                                                                  02620099
026300 EJECT                                                            02630099
026400*---------------------------------------------------------------* 02640099
026500*    NUMERIC EDIT LAYOUT.                                       * 02650099
026600*---------------------------------------------------------------* 02660099
026700                                                                  02670099
026800     COPY DPWS010I.                                               02680099
026900                                                                  02690099
027000 EJECT                                                            02700099
027100*---------------------------------------------------------------* 02710099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02720099
027300*---------------------------------------------------------------* 02730099
027400                                                                  02740099
027500     COPY DPWS030.                                                02750099
CICS       COPY DPWS930.                                                02760099
027700 EJECT                                                            02770099
027800*---------------------------------------------------------------* 02780099
027900*    STANDARD COMMAREA.                                         * 02790099
028000*---------------------------------------------------------------* 02800099
028100                                                                  02810099
028200     COPY DPWS020.                                                02820099
028300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02830099
028400                                                                  02840099
028500*---------------------------------------------------------------* 02850099
028600* INTER-APPLICATION COMMAREA.                                   * 02860099
028700*   TRWS105 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02870099
028800*             SPEC SCREEN OR SUMMARY.                           * 02880099
028900*   TRWS117 - IS THE OUTPUT LAYOUT WHEN GOING TO THE RECEIVING  * 02890099
029000*             PO HISTORY SCREEN.                                * 02900099
029100*---------------------------------------------------------------* 02910099
029200                                                                  02920099
029300         10  INTER-APPL-COMM-AREA       PIC X(200).               02930099
029400     COPY TRWS105.                                                02940099
029500     COPY TRWS117.                                                02950099
029600                                                                  02960099
029700*---------------------------------------------------------------* 02970099
029800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02980099
029900*---------------------------------------------------------------* 02990099
030000         10  ASC-SPECIFIC-COMMAREA.                               03000099
030100             15  ASC-LIST-KEYS.                                   03010099
030200                 20  ASC-KEY-PO-NBR                 PIC S9(09)    03020099
030300                                                    COMP.         03030099
030400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03040099
030500                 20  ASC-BLOCK-MODIFIED-SW          PIC  X(01).   03050099
030600                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    03060099
030700                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    03070099
030800                                                                  03080099
030900                 20  ASC-ITEM-ARRAY.                              03090099
031000                     25  ASC-ITEM-ENTRIES OCCURS 8 TIMES.         03100099
031100                         30  ASC-LIST-ITEM-NUMBER                 03110099
031200                                                    PIC S9(09)    03120099
031300                                                    COMP-3.       03130099
031400                         30  ASC-TEMP-SELECTED-SW   PIC  X(01).   03140099
031500                             88  ASC-VALID-SELECT   VALUE ' '     03150099
031600                                                          'S'     03160099
031700                                                          'B'     03170099
031800                                                          'E'.    03180099
031900                             88  ASC-TEMP-NO-SELECT VALUE ' '.    03190099
032000                             88  ASC-TEMP-SELECT    VALUE 'S'.    03200099
032100                             88  ASC-TEMP-BEGIN     VALUE 'B'.    03210099
032200                             88  ASC-TEMP-END       VALUE 'E'.    03220099
032300                         30  ASC-SELECTED-SW        PIC  X(01).   03230099
032400                             88  ASC-NO-SELECT      VALUE ' '.    03240099
032500                             88  ASC-SELECT         VALUE 'S'.    03250099
032600                             88  ASC-BEGIN          VALUE 'B'.    03260099
032700                             88  ASC-END            VALUE 'E'.    03270099
032800                         30  ASC-ACTION             PIC  X(03).   03280099
032900                         30  ASC-RCP-DT             PIC  X(10).   03290099
033000                         30  ASC-TYPE               PIC  X(03).   03300099
033100                         30  ASC-VSL-NAME           PIC  X(18).   03310099
033200                         30  ASC-TRIP-CODE          PIC  X(01).   03320099
033300                         30  ASC-ETD                PIC  X(05).   03330099
033400                         30  ASC-UNTS               PIC S9(09)    03340099
033500                                                    COMP.         03350099
033600                         30  ASC-CTN                PIC S9(04)    03360099
033700                                                    COMP.         03370099
033800                         30  ASC-CBM                PIC S9(4)V9(2)03380099
033900                                                    COMP-3.       03390099
034000                         30  ASC-TRN-CNT            PIC  9(02).   03400099
034100                         30  ASC-LAST-TRN           PIC  X(05).   03410099
034101                         30  ASC-PO-RCVD-SEQ-NBR    PIC S9(04)    03410199
034110                                                    COMP.         03411099
034200                                                                  03420099
034300             15  ASC-BLK-SUB                         PIC S9(04)   03430099
034400                                                          COMP    03440099
034500                                                          SYNC.   03450099
034600             15  ASC-ITEM-SUB                        PIC S9(04)   03460099
034700                                                          COMP    03470099
034800                                                          SYNC.   03480099
034900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03490099
035000                                                          COMP-3. 03500099
035100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03510099
035200                                                          COMP-3. 03520099
035300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03530099
035400                                                          COMP-3. 03540099
035500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03550099
035600                                                          COMP-3. 03560099
035700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03570099
035800                                                          COMP-3. 03580099
035900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03590099
036000                                                          COMP    03600099
036100                                                          SYNC.   03610099
036200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03620099
036300                                                          COMP-3. 03630099
036400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03640099
036500                                                          COMP-3. 03650099
036600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03660099
036700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03670099
036800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03680099
036900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03690099
037000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03700099
037100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03710099
037200             15  ASC-LIST-QUEUE-NAME.                             03720099
037300                 20  ASC-LIST-TERM-ID                PIC  X(04).  03730099
037400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03740099
037500                                                          COMP-3. 03750099
037600                 20  ASC-LIST-SEQ                    PIC  9(01).  03760099
037700             15  ASC-SEL-QUEUE-NAME.                              03770099
037800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03780099
037900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03790099
038000                                                          COMP-3. 03800099
038100                 20  ASC-SEL-SEQ                     PIC  9(01).  03810099
038200             15  ASC-START-ITEM-REQUEST.                          03820099
038300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03830099
038301             15  ASC-TOT-UNITS                       PIC  S9(08). 03830199
038302             15  ASC-TOT-CARTONS                     PIC  S9(05). 03830299
038310             15  ASC-TOT-CBM                   PIC  S9(04)V9(02). 03831099
038400                                                                  03840099
038500 EJECT                                                            03850099
038600*---------------------------------------------------------------* 03860099
038700*    ABEND PROCESSING COPYBOOK.                                 * 03870099
038800*---------------------------------------------------------------* 03880099
038900                                                                  03890099
039000     COPY DPWS013.                                                03900099
039100                                                                  03910099
039200 EJECT                                                            03920099
039300*---------------------------------------------------------------* 03930099
039400*    DB2 AREA FOR TPURCHS                                       * 03940099
039500*---------------------------------------------------------------* 03950099
039600     EXEC SQL                                                     03960099
039700          INCLUDE TPURCHS                                         03970099
039800     END-EXEC.                                                    03980099
039900*---------------------------------------------------------------* 03990099
040000*    DB2 AREA FOR TPLNSHP                                       * 04000099
040100*---------------------------------------------------------------* 04010099
040200     EXEC SQL                                                     04020099
040300          INCLUDE TPLNSHP                                         04030099
040400     END-EXEC.                                                    04040099
040500*---------------------------------------------------------------* 04050099
040600*    DB2 AREA FOR TENTNME                                       * 04060099
040700*---------------------------------------------------------------* 04070099
040800     EXEC SQL                                                     04080099
040900          INCLUDE TENTNME                                         04090099
041000     END-EXEC.                                                    04100099
041100*---------------------------------------------------------------* 04110099
041200*    DB2 AREA FOR TPURITM                                       * 04120099
041300*---------------------------------------------------------------* 04130099
041400     EXEC SQL                                                     04140099
041500          INCLUDE TPURITM                                         04150099
041600     END-EXEC.                                                    04160099
041700*---------------------------------------------------------------* 04170099
041800*    DB2 AREA FOR TIMRCPO                                       * 04180099
041900*---------------------------------------------------------------* 04190099
042000     EXEC SQL                                                     04200099
042100          INCLUDE TIMRCPO                                         04210099
042200     END-EXEC.                                                    04220099
042300*---------------------------------------------------------------* 04230099
042400*    DB2 AREA FOR TAURCPO                                       * 04240099
042500*---------------------------------------------------------------* 04250099
042600     EXEC SQL                                                     04260099
042700          INCLUDE TAURCPO                                         04270099
042800     END-EXEC.                                                    04280099
042900*----------------------------------------------------------------*04290099
043000*    DB2 AREA FOR THE TSKXREF TABLE                              *04300099
043100*----------------------------------------------------------------*04310099
043200     EXEC SQL                                                     04320099
043300          INCLUDE TSKXREF                                         04330099
043400     END-EXEC.                                                    04340099
043410*----------------------------------------------------------------*04341099
043420*    DB2 AREA FOR THE TUPC TABLE                                 *04342099
043430*----------------------------------------------------------------*04343099
043440     EXEC SQL                                                     04344099
043450          INCLUDE TUPC                                            04345099
043460     END-EXEC.                                                    04346099
043470*---------------------------------------------------------------* 04347099
043480*    DB2 AREA FOR XLT_SKU                                       * 04348099
043490*---------------------------------------------------------------* 04349099
043491     EXEC SQL                                                     04349199
043492          INCLUDE XLT00003                                        04349299
043493     END-EXEC.                                                    04349399
043494*---------------------------------------------------------------* 04349499
043495*    DB2 AREA FOR XLT_VND_STYL                                  * 04349599
043496*---------------------------------------------------------------* 04349699
043497     EXEC SQL                                                     04349799
043498          INCLUDE XLT00004                                        04349899
043499     END-EXEC.                                                    04349999
043500*---------------------------------------------------------------* 04350099
043600*    DB2 AREA FOR COMMUNICATIONS                                * 04360099
043700*---------------------------------------------------------------* 04370099
043800     EXEC SQL                                                     04380099
043900          INCLUDE SQLCA                                           04390099
044000     END-EXEC.                                                    04400099
044100*---------------------------------------------------------------* 04410099
044200*    CURSOR FOR PO RECEIVING LIST.                              * 04420099
044300*---------------------------------------------------------------* 04430099
044400                                                                  04440099
044500     EXEC SQL                                                     04450099
044600          DECLARE  RECEIPTS-CSR CURSOR                            04460099
044700              FOR  SELECT                                         04470099
044800                   PO_RCVD_DELY_TMST                              04480099
044900                 , PO_RCVD_SEQ_NBR                                04490099
045000                 , PO_CART_CNT                                    04500099
045100                 , PO_CBMT_QTY                                    04510099
045200                 , PO_UNT_QTY                                     04520099
045300                 , ORGN_SHPD_FR_CDE                               04530099
045400                 , IMPRT_VEH_NM                                   04540099
045500                 , DPRTR_TMST                                     04550099
045600                 , POE_DELY_TMST                                  04560099
045700                 , TRIP_TYP_CDE                                   04570099
045800                 , LAST_UPD_TMST                                  04580099
045900            FROM   TIMRCPO                                        04590099
046000           WHERE   PO_NBR         = :DK-PO-NBR                    04600099
046100        ORDER BY   PO_RCVD_DELY_TMST                              04610099
046200     END-EXEC.                                                    04620099
046300                                                                  04630099
046400 EJECT                                                            04640099
046500*----------------------------------------------------------------*04650099
046600*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *04660099
046700*----------------------------------------------------------------*04670099
046800                                                                  04680099
046900     EXEC SQL                                                     04690099
047000          DECLARE  OUTR-PCK-CSR CURSOR                            04700099
047100             FOR   SELECT                                         04710099
047200                   A.UNT_QTY                                      04720099
047300                ,  A.OUTR_PK_QTY                                  04730099
047400             FROM  TPURITM  A                                     04740099
047700             WHERE A.PO_NBR         = :DK-PO-NBR                  04770099
048010             AND   A.VER_STATUS_CDE = 'A'                         04801099
048020             FOR   FETCH ONLY                                     04802099
048030     END-EXEC.                                                    04803099
048100                                                                  04810099
048200 EJECT                                                            04820099
048300*----------------------------------------------------------------*04830099
048400 LINKAGE SECTION.                                                 04840099
048500                                                                  04850099
048600 01  DFHCOMMAREA.                                                 04860099
048700     05  FILLER                         OCCURS  1 TO 4072 TIMES   04870099
048800                                        DEPENDING ON EIBCALEN.    04880099
048900         10  FILLER                     PIC X.                    04890099
049000                                                                  04900099
049100 EJECT                                                            04910099
049200*----------------------------------------------------------------*04920099
049300 PROCEDURE DIVISION.                                              04930099
049400*----------------------------------------------------------------*04940099
049500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *04950099
049600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *04960099
049700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *04970099
049800*----------------------------------------------------------------*04980099
049900 0000-MAIN-MODULE.                                                04990099
050000                                                                  05000099
050100     INITIALIZE DP030-CICS-API-FIELDS.                            05010099
050200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05020099
050300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05030099
050400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05040099
050500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05050099
050600     MOVE LENGTH OF TR164AI        TO DP030-MAP-LENGTH (1).       05060099
050700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05070099
050800     PERFORM 0001-CALL-CICS-ARCH-API.                             05080099
050900*                                                                 05090099
051000     PERFORM 1000-CONTROL-PROCESSING                              05100099
051100*                                                                 05110099
051200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05120099
051300     PERFORM 0001-CALL-CICS-ARCH-API.                             05130099
051400                                                                  05140099
051500*----------------------------------------------------------------*05150099
051600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *05160099
051700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *05170099
051800*----------------------------------------------------------------*05180099
051900 0001-CALL-CICS-ARCH-API.                                         05190099
052000                                                                  05200099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05210099
052200                                    DFHCOMMAREA                   05220099
052300                                    DP030-CICS-API-FIELDS         05230099
052400                                    DP020-STANDARD-COMMAREA       05240099
052500                                    TR164AI.                      05250099
052600*                                                                 05260099
052700     IF  DP030-RC-CALL-SUCCESSFUL                                 05270099
052800         CONTINUE                                                 05280099
052900     ELSE                                                         05290099
053000         SET DP013-NO-ROLLBACK                                    05300099
053100             DP013-XCTL-DISPLAY-RESTART                           05310099
053200             DP013-CICS-ABEND      TO TRUE                        05320099
053300         MOVE '0001-CALL-CICS-ARCH-API'                           05330099
053400                                   TO DP013-PARAGRAPH             05340099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05350099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05360099
053700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05370099
053800         PERFORM DP013-0000-PROCESS-ABEND                         05380099
053900     END-IF.                                                      05390099
054000                                                                  05400099
054100 EJECT                                                            05410099
054200*----------------------------------------------------------------*05420099
054300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05430099
054400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05440099
054500*                                                                *05450099
054600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05460099
054700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05470099
054800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05480099
054900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05490099
055000*----------------------------------------------------------------*05500099
055100 1000-CONTROL-PROCESSING.                                         05510099
055200                                                                  05520099
055300     EVALUATE TRUE                                                05530099
055400         WHEN DP020-NEXT-ACT-INITIAL                              05540099
055500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05550099
055600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05560099
055700                                      ASC-SEL-TERM-ID             05570099
055800             MOVE DP020-SRC-TASK-NUMBER                           05580099
055900                                   TO ASC-LIST-TASK-NUMBER        05590099
056000                                      ASC-SEL-TASK-NUMBER         05600099
056100             MOVE PC-LIST-QUEUE-SEQ                               05610099
056200                                   TO ASC-LIST-SEQ                05620099
056300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05630099
056400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05640099
056500*-------$TEMPLATE NOTE$------------------------------------------*05650099
056600* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,* 05660099
056700* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO *  05670099
056800* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.* 05680099
056900*----------------------------------------------------------------*05690099
057000             IF  PS-COMMAREA-NOT-VALID                            05700099
057100                 SET DP020-NEXT-ACT-APPL-ERROR                    05710099
057200                                   TO TRUE                        05720099
057300             ELSE                                                 05730099
057400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05740099
057500             END-IF                                               05750099
057600                                                                  05760099
057700         WHEN DP020-NEXT-ACT-READ-MAP                             05770099
057800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05780099
057900                                   TO PV-TOP-ITEM                 05790099
058000             PERFORM 2000-PROCESS-PANEL                           05800099
058100                                                                  05810099
058200         WHEN DP020-NEXT-ACT-RETURN                               05820099
058300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05830099
058400                                   TO PV-TOP-ITEM                 05840099
058500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05850099
058600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05860099
058700             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05870099
058800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05880099
058900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05890099
059000                                                                  05900099
059100         WHEN OTHER                                               05910099
059200             SET DP013-LOGIC-ABEND TO TRUE                        05920099
059300             SET DP013-NO-ROLLBACK TO TRUE                        05930099
059400             MOVE '1000-CONTROL-PROCESSING'                       05940099
059500                                   TO DP013-PARAGRAPH             05950099
059600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05960099
059700                                   TO DP013-MESSAGE-TEXT(1)       05970099
059800             PERFORM DP013-0000-PROCESS-ABEND                     05980099
059900     END-EVALUATE.                                                05990099
060000                                                                  06000099
060100 EJECT                                                            06010099
060200*----------------------------------------------------------------*06020099
060300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06030099
060400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06040099
060500*----------------------------------------------------------------*06050099
060600 1100-PROCESS-INTER-APPL-COMM.                                    06060099
060700                                                                  06070099
060800     SET PS-COMMAREA-VALID         TO TRUE.                       06080099
060900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06090099
061000                                                                  06100099
061100     IF  DP020-NAV-KEY-DATA > SPACE                               06110099
061200         MOVE DP020-NAV-KEY-DATA   TO ASC-KEY-PO-NBR              06120099
061300                                      DK-PO-NBR                   06130099
061400     ELSE                                                         06140099
061500         MOVE TR105-PO-NBR         TO ASC-KEY-PO-NBR              06150099
061600                                      DK-PO-NBR                   06160099
061700     END-IF.                                                      06170099
061800                                                                  06180099
061900 EJECT                                                            06190099
062000*----------------------------------------------------------------*06200099
062100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06210099
062200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06220099
062300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06230099
062400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06240099
062500* FUNCTION KEYS CAN GET THIS FAR.                                *06250099
062600*----------------------------------------------------------------*06260099
062700 2000-PROCESS-PANEL.                                              06270099
062800                                                                  06280099
062900     EVALUATE TRUE                                                06290099
063000         WHEN DP020-SRC-AID = DP016-CLEAR                         06300099
063100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06310099
063200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06320099
063300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06330099
063400                                                                  06340099
063500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06350099
063600             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06360099
063700             PERFORM 2050-DELETE-LIST-QUEUE                       06370099
063800             PERFORM 4000-BUILD-INITIAL-PANEL                     06380099
063900                                                                  06390099
064000         WHEN OTHER                                               06400099
064100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06410099
064200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06420099
064300             IF  PS-NO-ERROR                                      06430099
064400                 SET DP030-CONTINUE-GO                            06440099
064500                                 TO TRUE                          06450099
064600                 PERFORM 2100-CHECK-FUNCTION-KEY                  06460099
064700             ELSE                                                 06470099
064800                 SET DP030-OVERRIDE-GO                            06480099
064900                                 TO TRUE                          06490099
065000             END-IF                                               06500099
065100     END-EVALUATE.                                                06510099
065200                                                                  06520099
065300 EJECT                                                            06530099
065400*----------------------------------------------------------------*06540099
065500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06550099
065600*----------------------------------------------------------------*06560099
065700 2050-DELETE-LIST-QUEUE.                                          06570099
065800                                                                  06580099
065900     EXEC CICS                                                    06590099
066000         DELETEQ TS                                               06600099
066100             QUEUE (ASC-LIST-QUEUE-NAME)                          06610099
066200             RESP  (PV-CICS-RESP)                                 06620099
066300     END-EXEC.                                                    06630099
066400                                                                  06640099
066500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06650099
066600        (PV-CICS-RESP = DFHRESP(QIDERR))                          06660099
066700         CONTINUE                                                 06670099
066800     ELSE                                                         06680099
066900         SET DP013-CICS-ABEND      TO TRUE                        06690099
067000         SET DP013-NO-ROLLBACK     TO TRUE                        06700099
067100                                                                  06710099
067200         MOVE '2050-DELETE-LIST-QUEUE'                            06720099
067300                                   TO DP013-PARAGRAPH             06730099
067400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06740099
067500                                   TO DP013-MESSAGE-TEXT (1)      06750099
067600         PERFORM DP013-0000-PROCESS-ABEND                         06760099
067700     END-IF.                                                      06770099
067800                                                                  06780099
067900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06790099
068000                                                                  06800099
068100 EJECT                                                            06810099
068200*----------------------------------------------------------------*06820099
068300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06830099
068400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06840099
068500* CICS ARCHITECTURE API.                                         *06850099
068600*----------------------------------------------------------------*06860099
068700 2100-CHECK-FUNCTION-KEY.                                         06870099
068800                                                                  06880099
068900     EVALUATE TRUE                                                06890099
069000                                                                  06900099
069100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06910099
069110         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06911099
069200            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                   06920099
069300              INITIALIZE         TR117-INTER-APPL-COMMAREA        06930099
069400              MOVE ASC-KEY-PO-NBR TO TR117-PO-NBR                 06940099
069410              MOVE IMRCPO-PO-RCVD-SEQ-NBR TO TR117-PO-SEQ-NBR     06941099
069500              PERFORM 5000-PREPARE-SEL-QUEUE                      06950099
069600            ELSE                                                  06960099
069700              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 06970099
069800                SET DP030-OVERRIDE-GO TO TRUE                     06980099
069900                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         06990099
070000                SET DP020-MSG-WARNING TO TRUE                     07000099
070100              ELSE                                                07010099
070200                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               07020099
070300                  SET DP030-OVERRIDE-GO TO TRUE                   07030099
070400                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       07040099
070500                  SET DP020-MSG-WARNING TO TRUE                   07050099
070600                END-IF                                            07060099
070700              END-IF                                              07070099
070800            END-IF                                                07080099
070900                                                                  07090099
071000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07100099
071100             MOVE +1               TO PV-TOP-ITEM                 07110099
071200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07120099
071300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07130099
071400             PERFORM 3200-RESET-ATTRIBUTES                        07140099
071500                                                                  07150099
071600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07160099
071700             PERFORM 2110-BROWSE-BACKWARD                         07170099
071800             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07180099
071900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07190099
072000             PERFORM 3200-RESET-ATTRIBUTES                        07200099
072100                                                                  07210099
072200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07220099
072300             PERFORM 2120-BROWSE-FORWARD                          07230099
072400             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   07240099
072500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07250099
072600                                                                  07260099
072700         WHEN DP020-SRC-AID = DP016-ENTER                         07270099
072800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07280099
072900             IF  PS-ERROR                                         07290099
073000                 CONTINUE                                         07300099
073100             ELSE                                                 07310099
073200                 MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR               07320099
073300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07330099
073400                 PERFORM 3200-RESET-ATTRIBUTES                    07340099
073500             END-IF                                               07350099
073600                                                                  07360099
073700         WHEN OTHER                                               07370099
073800             SET DP013-NO-ROLLBACK                                07380099
073900                 DP013-XCTL-DISPLAY-RESTART                       07390099
074000                 DP013-CICS-ABEND  TO TRUE                        07400099
074100             MOVE '2100-CHECK-FUNCTION-KEY'                       07410099
074200                                   TO DP013-PARAGRAPH             07420099
074300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07430099
074400                                   TO DP013-MESSAGE-TEXT (1)      07440099
074500             PERFORM DP013-0000-PROCESS-ABEND                     07450099
074600     END-EVALUATE.                                                07460099
074700                                                                  07470099
074800 EJECT                                                            07480099
074900*----------------------------------------------------------------*07490099
075000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07500099
075100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07510099
075200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07520099
075300*    MESSAGE.                                                    *07530099
075400*----------------------------------------------------------------*07540099
075500 2110-BROWSE-BACKWARD.                                            07550099
075600                                                                  07560099
075700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07570099
075800         GIVING PV-TOP-ITEM.                                      07580099
075900*                                                                 07590099
076000     IF  ((PV-TOP-ITEM < +1)                                      07600099
076100       OR (PV-TOP-ITEM = +1))                                     07610099
076200         MOVE +1                   TO PV-TOP-ITEM                 07620099
076300*------- TOP OF LIST --------                                     07630099
076400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07640099
076500         SET DP020-MSG-INFORMATIONAL TO TRUE                      07650099
076600     END-IF.                                                      07660099
076700                                                                  07670099
076800 EJECT                                                            07680099
076900*----------------------------------------------------------------*07690099
077000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07700099
077100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07710099
077200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07720099
077300*----------------------------------------------------------------*07730099
077400 2120-BROWSE-FORWARD.                                             07740099
077500                                                                  07750099
077600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07760099
077700         GIVING PV-TOP-ITEM.                                      07770099
077800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07780099
077900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07790099
078000                                   TO PV-TOP-ITEM                 07800099
078100*------- BOTTOM OF LIST -----------                               07810099
078200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07820099
078300         SET DP020-MSG-INFORMATIONAL                              07830099
078400                                   TO TRUE                        07840099
078500     ELSE                                                         07850099
078600         COMPUTE PV-BOTTOM-ITEM =                                 07860099
078700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07870099
078800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07880099
078900*----------- BOTTOM OF LIST ---------                             07890099
079000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07900099
079100             SET DP020-MSG-INFORMATIONAL                          07910099
079200                                   TO TRUE                        07920099
079300         END-IF                                                   07930099
079400     END-IF.                                                      07940099
079500                                                                  07950099
079600 EJECT                                                            07960099
079700*----------------------------------------------------------------*07970099
079800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07980099
079900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07990099
080000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08000099
080100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08010099
080200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08020099
080300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08030099
080400*----------------------------------------------------------------*08040099
080500 2130-CHECK-FOR-JUMP-BROWSE.                                      08050099
080600                                                                  08060099
080700     SET PS-NO-ERROR               TO TRUE.                       08070099
080800     IF (ASC-START-ITEM-REQUEST = SPACE)                          08080099
080900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08090099
081000                                   TO PV-TOP-ITEM                 08100099
081100     ELSE                                                         08110099
081200         MOVE ASC-START-ITEM-REQUEST                              08120099
081300                                   TO DP010I-UNEDITED-FIELD       08130099
081400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08140099
081500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08150099
081600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08160099
081700                                   TO TRUE                        08170099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08181099
263697              USING DP010I-NUMERIC-EDIT-AREA                      08182099
081900                                                                  08190099
082000         IF  NOT DP010I-ERROR-DETECTED                            08200099
082100             MOVE DP010I-NUMERIC-FIELD                            08210099
082200                                   TO  ASC-START-ITEM-REQUEST-N   08220099
082300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08230099
082400                 IF  ASC-START-ITEM-REQUEST-N >                   08240099
082500                                          ASC-NUMBER-OF-ITEMS-READ08250099
082600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08260099
082700                     COMPUTE PV-TOP-ITEM =                        08270099
082800                             ASC-NUMBER-OF-ITEMS-READ             08280099
082900                             - PC-ITEMS-PER-PANEL + 1             08290099
083000                     IF  PV-TOP-ITEM < +1                         08300099
083100                         MOVE +1   TO PV-TOP-ITEM                 08310099
083200                         MOVE PC-TSYMSG-00070                     08320099
083300                                   TO DP020-MSG-NUMBER            08330099
083400                         SET DP020-MSG-INFORMATIONAL              08340099
083500                                   TO TRUE                        08350099
083600                     END-IF                                       08360099
083700                 ELSE                                             08370099
083800                     MOVE ASC-START-ITEM-REQUEST-N                08380099
083900                                   TO PV-TOP-ITEM                 08390099
084000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08400099
084100                     COMPUTE PV-BOTTOM-ITEM =                     08410099
084200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08420099
084300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08430099
084400*----------------------- BOTTOM OF LIST --------------            08440099
084500                         MOVE PC-TSYMSG-00070                     08450099
084600                                   TO DP020-MSG-NUMBER            08460099
084700                         SET DP020-MSG-INFORMATIONAL              08470099
084800                                   TO TRUE                        08480099
084900                     END-IF                                       08490099
085000                 END-IF                                           08500099
085100             ELSE                                                 08510099
085200*--------------- VALUE OUT OF RANGE ------------------            08520099
085300                 MOVE PC-TSYMSG-00101                             08530099
085400                                   TO DP020-MSG-NUMBER            08540099
085500                 MOVE -1           TO ASTRTITL                    08550099
085600                 SET DP030-SET-CURSOR-APPL-1                      08560099
085700                                   TO TRUE                        08570099
085800                 MOVE DP015-REVERSE                               08580099
085900                                   TO ASTRTITH                    08590099
086000                 MOVE DP015-RED    TO ASTRTITC                    08600099
086100                 MOVE DP015-UNP-NUM-BRT-MDT                       08610099
086200                                   TO ASTRTITA                    08620099
086300                 SET DP020-MSG-FATAL                              08630099
086400                                   TO TRUE                        08640099
086500                 SET PS-ERROR      TO TRUE                        08650099
086600             END-IF                                               08660099
086700                                                                  08670099
086800         ELSE                                                     08680099
086900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08690099
087000             MOVE -1               TO ASTRTITL                    08700099
087100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08710099
087200             MOVE DP015-REVERSE    TO ASTRTITH                    08720099
087300             MOVE DP015-RED        TO ASTRTITC                    08730099
087400             MOVE DP015-UNP-NUM-BRT-MDT                           08740099
087500                                   TO ASTRTITA                    08750099
087600             SET DP020-MSG-FATAL   TO TRUE                        08760099
087700             SET PS-ERROR          TO TRUE                        08770099
087800         END-IF                                                   08780099
087900     END-IF.                                                      08790099
088000                                                                  08800099
088100 EJECT                                                            08810099
088200*----------------------------------------------------------------*08820099
088300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08830099
088400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08840099
088500*----------------------------------------------------------------*08850099
088600 2140-DESELECT-ALL-ITEMS.                                         08860099
088700                                                                  08870099
088800     MOVE +1                       TO ASC-BLK-SUB.                08880099
088900                                                                  08890099
089000     PERFORM 2141-CLEAR-SELECTED-INDS                             08900099
089100         VARYING ASC-ITEM-SUB                                     08910099
089200         FROM 1 BY 1                                              08920099
089300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08930099
089400                                                                  08940099
089500     ADD +1                        TO ASC-BLK-SUB.                08950099
089600                                                                  08960099
089700     PERFORM 2141-CLEAR-SELECTED-INDS                             08970099
089800         VARYING ASC-ITEM-SUB                                     08980099
089900         FROM 1 BY 1                                              08990099
090000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09000099
090100                                                                  09010099
090200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09020099
090300                                   TO PV-LIST-ITEM-NUMBER.        09030099
090400                                                                  09040099
090500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09050099
090600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09060099
090700                                                                  09070099
090800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09080099
090900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09090099
091000         MOVE +1                   TO ASC-BLK-SUB                 09100099
091100                                                                  09110099
091200         PERFORM 5100-WRITE-TEMP-STORAGE                          09120099
091300                                                                  09130099
091400         MOVE +1                   TO PV-BLOCK-NUMBER             09140099
091500                                                                  09150099
091600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09160099
091700             PV-FIRST-BLOCK-IN-ARRAY - 1                          09170099
091800                                                                  09180099
091900         PERFORM                                                  09190099
092000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09200099
092100                                                                  09210099
092200             PERFORM 4410-READ-TEMP-STORAGE                       09220099
092300                                                                  09230099
092400             PERFORM 2141-CLEAR-SELECTED-INDS                     09240099
092500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09250099
092600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09260099
092700                                                                  09270099
092800             PERFORM 5100-WRITE-TEMP-STORAGE                      09280099
092900                                                                  09290099
093000             ADD +1                TO PV-BLOCK-NUMBER             09300099
093100                                                                  09310099
093200         END-PERFORM                                              09320099
093300                                                                  09330099
093400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09340099
093500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09350099
093600                                                                  09360099
093700         PERFORM                                                  09370099
093800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09380099
093900                   ASC-HIGHEST-BLOCK-WRITTEN                      09390099
094000                                                                  09400099
094100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09410099
094200                                   TO PV-BLOCK-NUMBER             09420099
094300                                                                  09430099
094400             PERFORM 4410-READ-TEMP-STORAGE                       09440099
094500                                                                  09450099
094600             PERFORM 2141-CLEAR-SELECTED-INDS                     09460099
094700                 VARYING ASC-ITEM-SUB                             09470099
094800                 FROM 1 BY 1                                      09480099
094900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09490099
095000                                                                  09500099
095100             PERFORM 5100-WRITE-TEMP-STORAGE                      09510099
095200                                                                  09520099
095300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09530099
095400                                                                  09540099
095500         END-PERFORM                                              09550099
095600                                                                  09560099
095700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09570099
095800                                   TO PV-BLOCK-NUMBER             09580099
095900                                                                  09590099
096000         PERFORM 4410-READ-TEMP-STORAGE                           09600099
096100     END-IF.                                                      09610099
096200                                                                  09620099
096300     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS09630099
096400                                      ASC-START-OF-SELECTED-RANGE 09640099
096500                                      ASC-END-OF-SELECTED-RANGE.  09650099
096600                                                                  09660099
096700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09670099
096800                                                                  09680099
096900 EJECT                                                            09690099
097000*----------------------------------------------------------------*09700099
097100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09710099
097200*----------------------------------------------------------------*09720099
097300 2141-CLEAR-SELECTED-INDS.                                        09730099
097400                                                                  09740099
097500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09750099
097600             NOT EQUAL ZERO                                       09760099
097700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09770099
097800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09780099
097900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09790099
098000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09800099
098100                                   TO TRUE                        09810099
098200         END-IF                                                   09820099
098300     END-IF.                                                      09830099
098400                                                                  09840099
098500 EJECT                                                            09850099
098600*----------------------------------------------------------------*09860099
098700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09870099
098800*  FOR ALL ITEMS.                                                *09880099
098900*----------------------------------------------------------------*09890099
099000 2150-SELECT-ALL-ITEMS.                                           09900099
099100                                                                  09910099
099200     MOVE +1                       TO ASC-BLK-SUB.                09920099
099300                                                                  09930099
099400     PERFORM 2151-SET-SELECTED-INDS                               09940099
099500         VARYING ASC-ITEM-SUB                                     09950099
099600         FROM 1 BY 1                                              09960099
099700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09970099
099800                                                                  09980099
099900     ADD +1                        TO ASC-BLK-SUB.                09990099
100000                                                                  10000099
100100     PERFORM 2151-SET-SELECTED-INDS                               10010099
100200         VARYING ASC-ITEM-SUB                                     10020099
100300         FROM 1 BY 1                                              10030099
100400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10040099
100500                                                                  10050099
100600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10060099
100700                                   TO PV-LIST-ITEM-NUMBER.        10070099
100800                                                                  10080099
100900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10090099
101000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10100099
101100                                                                  10110099
101200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10120099
101300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10130099
101400         MOVE +1                   TO ASC-BLK-SUB                 10140099
101500                                                                  10150099
101600         PERFORM 5100-WRITE-TEMP-STORAGE                          10160099
101700                                                                  10170099
101800         MOVE +1                   TO PV-BLOCK-NUMBER             10180099
101900                                                                  10190099
102000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10200099
102100             PV-FIRST-BLOCK-IN-ARRAY - 1                          10210099
102200                                                                  10220099
102300         PERFORM                                                  10230099
102400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10240099
102500                                                                  10250099
102600             PERFORM 4410-READ-TEMP-STORAGE                       10260099
102700                                                                  10270099
102800             PERFORM 2151-SET-SELECTED-INDS                       10280099
102900                 VARYING ASC-ITEM-SUB                             10290099
103000                 FROM 1 BY 1                                      10300099
103100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10310099
103200                                                                  10320099
103300             PERFORM 5100-WRITE-TEMP-STORAGE                      10330099
103400                                                                  10340099
103500             ADD +1                TO PV-BLOCK-NUMBER             10350099
103600                                                                  10360099
103700         END-PERFORM                                              10370099
103800                                                                  10380099
103900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10390099
104000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10400099
104100                                                                  10410099
104200         PERFORM                                                  10420099
104300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10430099
104400                   ASC-HIGHEST-BLOCK-WRITTEN                      10440099
104500                                                                  10450099
104600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10460099
104700                                   TO PV-BLOCK-NUMBER             10470099
104800                                                                  10480099
104900             PERFORM 4410-READ-TEMP-STORAGE                       10490099
105000                                                                  10500099
105100             PERFORM 2151-SET-SELECTED-INDS                       10510099
105200                 VARYING ASC-ITEM-SUB                             10520099
105300                 FROM 1 BY 1                                      10530099
105400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10540099
105500                                                                  10550099
105600             PERFORM 5100-WRITE-TEMP-STORAGE                      10560099
105700                                                                  10570099
105800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10580099
105900                                                                  10590099
106000         END-PERFORM                                              10600099
106100                                                                  10610099
106200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10620099
106300                                   TO PV-BLOCK-NUMBER             10630099
106400                                                                  10640099
106500         PERFORM 4410-READ-TEMP-STORAGE                           10650099
106600     END-IF.                                                      10660099
106700                                                                  10670099
106800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10680099
106900                       ASC-NUMBER-OF-SELECTED-ITEMS.              10690099
107000                                                                  10700099
107100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10710099
107200                                                                  10720099
107300 EJECT                                                            10730099
107400*----------------------------------------------------------------*10740099
107500*    MARK EACH ITEM AS BEING SELECTED.                           *10750099
107600*----------------------------------------------------------------*10760099
107700 2151-SET-SELECTED-INDS.                                          10770099
107800                                                                  10780099
107900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10790099
108000             NOT EQUAL ZERO                                       10800099
108100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10810099
108200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10820099
108300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10830099
108400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10840099
108500                               TO  TRUE                           10850099
108600         END-IF                                                   10860099
108700     END-IF.                                                      10870099
108800                                                                  10880099
108900 EJECT                                                            10890099
109000                                                                  10900099
109100*----------------------------------------------------------------*10910099
109200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *10920099
109300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *10930099
109400*----------------------------------------------------------------*10940099
109500 2200-MOVE-SCREEN-TO-COMMAREA.                                    10950099
109600                                                                  10960099
109700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10970099
109800     MOVE +1                       TO PV-SUB.                     10980099
109900*                                                                 10990099
110000     PERFORM 3100-SET-SUBSCRIPTS.                                 11000099
110100     IF  ASTRTITL > ZERO                                          11010099
110200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11020099
110300     ELSE                                                         11030099
110400         IF  ASTRTITF = DP015-ERASE-EOF                           11040099
110500             INITIALIZE ASC-START-ITEM-REQUEST                    11050099
110600         END-IF                                                   11060099
110700     END-IF.                                                      11070099
110800                                                                  11080099
110900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11090099
111000         VARYING PV-SUB                                           11100099
111100         FROM 1 BY 1                                              11110099
111200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11120099
111300                                                                  11130099
111400 EJECT                                                            11140099
111500*----------------------------------------------------------------*11150099
111600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11160099
111700*----------------------------------------------------------------*11170099
111800 2210-MOVE-LINES-TO-COMMAREA.                                     11180099
111900                                                                  11190099
112000     IF  MR-SELECTL (PV-SUB) > ZERO                               11200099
112100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11210099
112200         MOVE MR-SELECTI (PV-SUB)                                 11220099
112300                                   TO ASC-TEMP-SELECTED-SW        11230099
112400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11240099
112500     ELSE                                                         11250099
112600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11260099
112700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11270099
112800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11280099
112900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11290099
113000         END-IF                                                   11300099
113100     END-IF.                                                      11310099
113200     ADD +1                        TO ASC-ITEM-SUB.               11320099
113300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11330099
113400         ADD  +1                   TO ASC-BLK-SUB                 11340099
113500         MOVE +1                   TO ASC-ITEM-SUB                11350099
113600     END-IF.                                                      11360099
113700                                                                  11370099
113800 EJECT                                                            11380099
113900*----------------------------------------------------------------*11390099
114000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *11400099
114100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *11410099
114200*----------------------------------------------------------------*11420099
114300 3000-EDIT-DATA-IN-COMMAREA.                                      11430099
114400                                                                  11440099
114500     SET PS-NO-ERROR               TO TRUE.                       11450099
114600     PERFORM 3200-RESET-ATTRIBUTES.                               11460099
114700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11470099
114800*----------------------------------------------------------------*11480099
114900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED. *            11490099
115000* EDITTING IS DONE FROM THE BOTTOM UP. *                          11500099
115100*----------------------------------------------------------------*11510099
115200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11520099
115300         ASC-ITEMS-DISPLAYED - 1.                                 11530099
115400     PERFORM 3100-SET-SUBSCRIPTS.                                 11540099
115500     PERFORM 3300-EDIT-SELECTIONS                                 11550099
115600         VARYING PV-SUB                                           11560099
115700         FROM PV-SUB BY -1                                        11570099
115800         UNTIL PV-SUB < +1.                                       11580099
115900*                                                                 11590099
116000     IF  PS-NO-ERROR                                              11600099
116100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11610099
116200     END-IF.                                                      11620099
116300*                                                                 11630099
116400     IF  ((PS-NO-ERROR)                                           11640099
116500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11650099
116600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11660099
116700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11670099
116800     END-IF.                                                      11680099
116801                                                                  11680199
116802 EJECT                                                            11680299
116803                                                                  11680399
116804 EJECT                                                            11680499
116805*----------------------------------------------------------------*11680599
116806*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11680699
116807*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11680799
116808*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11680899
116809*                                                                *11680999
116810*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11681099
116820*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11682099
116830*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11683099
116840*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11684099
116850*----------------------------------------------------------------*11685099
116860 3100-SET-SUBSCRIPTS.                                             11686099
116870                                                                  11687099
116880     COMPUTE ASC-ITEM-SUB =                                       11688099
116890         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11689099
116900                                                                  11690099
117000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11700099
117100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11710099
117200                                                                  11720099
117300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11730099
117400     ELSE                                                         11740099
117500         MOVE +1                     TO ASC-BLK-SUB               11750099
117600     END-IF.                                                      11760099
117700                                                                  11770099
117800 EJECT                                                            11780099
117900*----------------------------------------------------------------*11790099
118000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *11800099
118100*----------------------------------------------------------------*11810099
118200 3200-RESET-ATTRIBUTES.                                           11820099
118300                                                                  11830099
118400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11840099
118500     MOVE DP015-GREEN              TO ASTRTITC.                   11850099
118600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11860099
118700*                                                                 11870099
118800     PERFORM                                                      11880099
118900         VARYING PV-SUB                                           11890099
119000         FROM 1 BY 1                                              11900099
119100         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   11910099
119200                         ASC-ITEMS-DISPLAYED)                     11920099
119300         MOVE DP015-UNP-ALP-NOR-OFF                               11930099
119400                                   TO MR-SELECTA (PV-SUB)         11940099
119500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11950099
119600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11960099
119700     END-PERFORM.                                                 11970099
119800                                                                  11980099
119900 EJECT                                                            11990099
120000*----------------------------------------------------------------*12000099
120100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *12010099
120200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *12020099
120300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *12030099
120400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *12040099
120500*----------------------------------------------------------------*12050099
120600 3300-EDIT-SELECTIONS.                                            12060099
120700                                                                  12070099
120800     EVALUATE TRUE                                                12080099
120900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12090099
121000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12100099
121100                 CONTINUE                                         12110099
121200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12120099
121300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12130099
121400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12140099
121500                 MOVE ASC-TEMP-SELECTED-SW                        12150099
121600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12160099
121700                                TO ASC-SELECTED-SW                12170099
121800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12180099
121900             END-IF                                               12190099
122000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12200099
122100                                = SPACE                           12210099
122200             EVALUATE TRUE                                        12220099
122300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12230099
122400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12240099
122500                     MOVE SPACE TO ASC-SELECTED-SW                12250099
122600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12260099
122700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12270099
122800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12280099
122900                     MOVE SPACE TO ASC-SELECTED-SW                12290099
123000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12300099
123100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12310099
123200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12320099
123300                     MOVE SPACE TO ASC-SELECTED-SW                12330099
123400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12340099
123500             END-EVALUATE                                         12350099
123600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12360099
123700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12370099
123800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12380099
123900             END-IF                                               12390099
124000             PERFORM 3310-EDIT-RANGE                              12400099
124100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12410099
124200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12420099
124300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12430099
124400             END-IF                                               12440099
124500             PERFORM 3310-EDIT-RANGE                              12450099
124600         WHEN OTHER                                               12460099
124700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12470099
124800             SET DP020-MSG-FATAL    TO TRUE                       12480099
124900             MOVE -1                TO MR-SELECTL (PV-SUB)        12490099
125000             SET DP030-SET-CURSOR-APPL-1                          12500099
125100                                    TO TRUE                       12510099
125200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12520099
125300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12530099
125400             SET PS-ERROR TO TRUE                                 12540099
125500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12550099
125600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12560099
125700                 MOVE SPACE         TO ASC-SELECTED-SW            12570099
125800                                        (ASC-BLK-SUB ASC-ITEM-SUB)12580099
125900             END-IF                                               12590099
126000     END-EVALUATE.                                                12600099
126100                                                                  12610099
126200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12620099
126300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12630099
126400     IF  ASC-ITEM-SUB < 1                                         12640099
126500         SUBTRACT +1 FROM ASC-BLK-SUB                             12650099
126600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12660099
126700     END-IF.                                                      12670099
126800                                                                  12680099
126900 EJECT                                                            12690099
127000*----------------------------------------------------------------*12700099
127100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *12710099
127200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *12720099
127300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *12730099
127400*  THE ENDING.                                                   *12740099
127500*----------------------------------------------------------------*12750099
127600 3310-EDIT-RANGE.                                                 12760099
127700                                                                  12770099
127800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12780099
127900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12790099
128000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12800099
128100                                   TO ASC-SELECTED-SW             12810099
128200                                        (ASC-BLK-SUB ASC-ITEM-SUB)12820099
128300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12830099
128400         ELSE                                                     12840099
128500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12850099
128600                 CONTINUE                                         12860099
128700             ELSE                                                 12870099
128800*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          12880099
128900                 MOVE PC-TSYMSG-00054                             12890099
129000                                   TO DP020-MSG-NUMBER            12900099
129100                 SET DP020-MSG-FATAL                              12910099
129200                                   TO TRUE                        12920099
129300                 MOVE -1           TO MR-SELECTL (PV-SUB)         12930099
129400                 SET DP030-SET-CURSOR-APPL-1                      12940099
129500                                   TO TRUE                        12950099
129600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12960099
129700                 MOVE DP015-UNDERLINE                             12970099
129800                                   TO MR-SELECTH (PV-SUB)         12980099
129900                 SET PS-ERROR      TO TRUE                        12990099
130000             END-IF                                               13000099
130100         END-IF                                                   13010099
130200     ELSE                                                         13020099
130300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13030099
130400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13040099
130500                                   TO ASC-SELECTED-SW             13050099
130600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13060099
130700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13070099
130800         ELSE                                                     13080099
130900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13090099
131000                 CONTINUE                                         13100099
131100             ELSE                                                 13110099
131200*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            13120099
131300                 MOVE PC-TSYMSG-00055                             13130099
131400                                   TO DP020-MSG-NUMBER            13140099
131500                 SET DP020-MSG-FATAL                              13150099
131600                                   TO TRUE                        13160099
131700                 MOVE -1           TO MR-SELECTL (PV-SUB)         13170099
131800                 SET DP030-SET-CURSOR-APPL-1                      13180099
131900                                   TO TRUE                        13190099
132000                 SET PS-ERROR      TO TRUE                        13200099
132100             END-IF                                               13210099
132200         END-IF                                                   13220099
132300     END-IF.                                                      13230099
132400                                                                  13240099
132500 EJECT                                                            13250099
132600*----------------------------------------------------------------*13260099
132700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *13270099
132800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *13280099
132900*----------------------------------------------------------------*13290099
133000 3400-CHECK-RANGE-SEQUENCE.                                       13300099
133100                                                                  13310099
133200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13320099
133300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13330099
133400       AND  ASC-START-OF-SELECTED-RANGE >                         13340099
133500                                         ASC-END-OF-SELECTED-RANGE13350099
133600*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                13360099
133700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13370099
133800         SET DP020-MSG-FATAL TO TRUE                              13380099
133900         SET PS-ERROR TO TRUE                                     13390099
134000         PERFORM 3410-POSITION-AT-ERROR                           13400099
134100     END-IF.                                                      13410099
134200                                                                  13420099
134300 EJECT                                                            13430099
134400*----------------------------------------------------------------*13440099
134500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *13450099
134600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *13460099
134700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *13470099
134800*----------------------------------------------------------------*13480099
134900 3410-POSITION-AT-ERROR.                                          13490099
135000                                                                  13500099
135100     SET DP030-SET-CURSOR-APPL-1                                  13510099
135200                                   TO TRUE.                       13520099
135300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13530099
135400                    - PV-TOP-ITEM + 1.                            13540099
135500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13550099
135600         CONTINUE                                                 13560099
135700     ELSE                                                         13570099
135800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13580099
135900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13590099
136000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13600099
136100     END-IF.                                                      13610099
136200*                                                                 13620099
136300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13630099
136400                    - PV-TOP-ITEM + 1.                            13640099
136500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13650099
136600         CONTINUE                                                 13660099
136700     ELSE                                                         13670099
136800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13680099
136900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13690099
137000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13700099
137100     END-IF.                                                      13710099
137200                                                                  13720099
137300 EJECT                                                            13730099
137400*----------------------------------------------------------------*13740099
137500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13750099
137600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13760099
137700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13770099
137800*----------------------------------------------------------------*13780099
137900 3500-MARK-RANGE-AS-SELECTED.                                     13790099
138000                                                                  13800099
138100     MOVE +1                       TO  ASC-BLK-SUB.               13810099
138200     PERFORM 3510-MARK-SELECTED-INDS                              13820099
138300         VARYING ASC-ITEM-SUB                                     13830099
138400         FROM 1 BY 1                                              13840099
138500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13850099
138600                                                                  13860099
138700     ADD +1                        TO ASC-BLK-SUB.                13870099
138800     PERFORM 3510-MARK-SELECTED-INDS                              13880099
138900         VARYING ASC-ITEM-SUB                                     13890099
139000         FROM 1 BY 1                                              13900099
139100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13910099
139200                                                                  13920099
139300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13930099
139400                                   TO  PV-LIST-ITEM-NUMBER.       13940099
139500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13950099
139600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13960099
139700               PC-ITEMS-PER-PANEL).                               13970099
139800                                                                  13980099
139900     MOVE ASC-START-OF-SELECTED-RANGE                             13990099
140000                                   TO PV-START-OF-SELECTED-RANGE. 14000099
140100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14010099
140200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14020099
140300               PC-ITEMS-PER-PANEL).                               14030099
140400                                                                  14040099
140500     MOVE ASC-END-OF-SELECTED-RANGE                               14050099
140600                                   TO  PV-END-OF-SELECTED-RANGE.  14060099
140700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14070099
140800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14080099
140900               PC-ITEMS-PER-PANEL).                               14090099
141000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14100099
141100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14110099
141200                                                                  14120099
141300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14130099
141400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14140099
141500         MOVE +1                   TO ASC-BLK-SUB                 14150099
141600         PERFORM 5100-WRITE-TEMP-STORAGE                          14160099
141700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14170099
141800             PV-FIRST-BLOCK-IN-ARRAY - 1                          14180099
141900                                                                  14190099
142000         PERFORM                                                  14200099
142100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14210099
142200                   PV-PREV-BLOCK-IN-ARRAY                         14220099
142300             MOVE PV-FIRST-BLOCK-IN-RANGE                         14230099
142400                                   TO PV-BLOCK-NUMBER             14240099
142500             PERFORM 4410-READ-TEMP-STORAGE                       14250099
142600             PERFORM 3510-MARK-SELECTED-INDS                      14260099
142700                 VARYING ASC-ITEM-SUB                             14270099
142800                 FROM 1 BY 1                                      14280099
142900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14290099
143000             PERFORM 5100-WRITE-TEMP-STORAGE                      14300099
143100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14310099
143200         END-PERFORM                                              14320099
143300                                                                  14330099
143400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14340099
143500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14350099
143600         PERFORM                                                  14360099
143700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14370099
143800                   PV-LAST-BLOCK-IN-RANGE                         14380099
143900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14390099
144000                                   TO PV-BLOCK-NUMBER             14400099
144100             PERFORM 4410-READ-TEMP-STORAGE                       14410099
144200             PERFORM 3510-MARK-SELECTED-INDS                      14420099
144300                 VARYING ASC-ITEM-SUB                             14430099
144400                 FROM 1 BY 1                                      14440099
144500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14450099
144600             PERFORM 5100-WRITE-TEMP-STORAGE                      14460099
144700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14470099
144800         END-PERFORM                                              14480099
144900                                                                  14490099
145000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14500099
145100                                   TO PV-BLOCK-NUMBER             14510099
145200         PERFORM 4410-READ-TEMP-STORAGE                           14520099
145300     END-IF.                                                      14530099
145400                                                                  14540099
145500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14550099
145600                                      ASC-END-OF-SELECTED-RANGE.  14560099
145700                                                                  14570099
145800 EJECT                                                            14580099
145900*----------------------------------------------------------------*14590099
146000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14600099
146100*----------------------------------------------------------------*14610099
146200 3510-MARK-SELECTED-INDS.                                         14620099
146300                                                                  14630099
146400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14640099
146500                                ASC-ITEM-SUB) >                   14650099
146600         ASC-START-OF-SELECTED-RANGE)                             14660099
146700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14670099
146800                                ASC-ITEM-SUB) =                   14680099
146900         ASC-START-OF-SELECTED-RANGE)                             14690099
147000                                                                  14700099
147100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14710099
147200                                    ASC-ITEM-SUB) <               14720099
147300             ASC-END-OF-SELECTED-RANGE)                           14730099
147400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14740099
147500                                    ASC-ITEM-SUB) =               14750099
147600             ASC-END-OF-SELECTED-RANGE)                           14760099
147700                                                                  14770099
147800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14780099
147900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14790099
148000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14800099
148100                               TO TRUE                            14810099
148200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14820099
148300                               TO TRUE                            14830099
148400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14840099
148500             END-IF                                               14850099
148600         END-IF                                                   14860099
148700     END-IF.                                                      14870099
148800                                                                  14880099
148900 EJECT                                                            14890099
149000*----------------------------------------------------------------*14900099
149100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14910099
149200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14920099
149300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14930099
149400*    DISPLAY THE PANEL TO USER.                                  *14940099
149500*----------------------------------------------------------------*14950099
149600 4000-BUILD-INITIAL-PANEL.                                        14960099
149700                                                                  14970099
149800     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             14980099
149900                                ASC-BLOCK-ENTRIES (2)             14990099
149901                                ASC-TOT-UNITS                     14990199
149902                                ASC-TOT-CARTONS                   14990299
149910                                ASC-TOT-CBM.                      14991099
150000     MOVE +1                 TO ASC-BLK-SUB.                      15000099
150100     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        15010099
150200     SET ASC-ITEMS-LEFT-ON-DB                                     15020099
150300                             TO TRUE.                             15030099
150400                                                                  15040099
150500     MOVE +0                 TO ASC-ITEM-SUB                      15050099
150600                                ASC-NUMBER-OF-ITEMS-READ          15060099
150700                                ASC-NUMBER-OF-SELECTED-ITEMS      15070099
150800                                ASC-HIGHEST-BLOCK-WRITTEN         15080099
150900                                ASC-START-OF-SELECTED-RANGE       15090099
151000                                ASC-END-OF-SELECTED-RANGE         15100099
151100                                ASC-ITEM-AT-TOP-OF-PANEL.         15110099
151200     PERFORM 4010-OPEN-CURSOR.                                    15120099
151300                                                                  15130099
151400     PERFORM 4300-READ-ITEMS-FROM-DB.                             15140099
151500                                                                  15150099
151600     PERFORM 4020-CLOSE-CURSOR.                                   15160099
151700                                                                  15170099
151800     MOVE +1                   TO  PV-TOP-ITEM.                   15180099
151900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15190099
152000         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15200099
152100         SET DP020-MSG-FATAL   TO  TRUE                           15210099
152200*------- PURCHASE ORDER DOES NOT EXIST                            15220099
152300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15230099
152400     ELSE                                                         15240099
152500         MOVE -1               TO MR-SELECTL (1)                  15250099
152600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      15260099
152700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15270099
152800     END-IF.                                                      15280099
152900                                                                  15290099
153000 EJECT                                                            15300099
153100*----------------------------------------------------------------*15310099
153200*   OPEN THE PO-RECEIPTS CURSOR.                                 *15320099
153300*----------------------------------------------------------------*15330099
153400 4010-OPEN-CURSOR.                                                15340099
153500                                                                  15350099
153600     PERFORM                                                      15360099
153700         WITH TEST AFTER                                          15370099
153800         VARYING PV-RETRY-COUNTER                                 15380099
153900         FROM 1 BY 1                                              15390099
154000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15400099
154100                   OR (SQLCODE = ZERO))                           15410099
154200*                                                                 15420099
154300         MOVE 'CURSOR:  RECEIPTS-CSR' TO DP013-MESSAGE-TEXT (2)   15430099
154400                                                                  15440099
154500         EXEC SQL                                                 15450099
154600              OPEN RECEIPTS-CSR                                   15460099
154700         END-EXEC                                                 15470099
154800*                                                                 15480099
154900         EVALUATE TRUE                                            15490099
155000             WHEN SQLCODE = ZERO                                  15500099
155100             WHEN SQLCODE = -904                                  15510099
155200             WHEN SQLCODE = -913                                  15520099
155300                 CONTINUE                                         15530099
155400             WHEN SQLWARN0 NOT = SPACES                           15540099
155500             WHEN SQLCODE < ZERO                                  15550099
155600             WHEN SQLCODE > ZERO                                  15560099
155700                 MOVE '4010-OPEN-CURSOR'                          15570099
155800                                   TO DP013-PARAGRAPH             15580099
155900                 MOVE 'OPEN RECEIPTS CURSOR - '                   15590099
156000                                   TO DP013-MESSAGE-TEXT (1)      15600099
156100                 MOVE SQLCA        TO DP013-SQLCA                 15610099
156200                 MOVE 'TIMRCPO '   TO DP013-DB2-TABLE-NAME (1)    15620099
156300                 SET DP013-DB2-ABEND                              15630099
156400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15640099
156500                 PERFORM DP013-0000-PROCESS-ABEND                 15650099
156600         END-EVALUATE                                             15660099
156700     END-PERFORM.                                                 15670099
156800*                                                                 15680099
156900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15690099
157000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15700099
157100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15710099
157200                                   TO DP013-MESSAGE-TEXT (1)      15720099
157300         MOVE SQLCA                TO DP013-SQLCA                 15730099
157400         MOVE 'TIMRCPO '           TO DP013-DB2-TABLE-NAME (1)    15740099
157500         SET DP013-DB2-ABEND                                      15750099
157600             DP013-XCTL-DISPLAY-RESTART                           15760099
157700                                   TO TRUE                        15770099
157800         PERFORM DP013-0000-PROCESS-ABEND                         15780099
157900     END-IF.                                                      15790099
158000                                                                  15800099
158100 EJECT                                                            15810099
158200*----------------------------------------------------------------*15820099
158300*   CLOSE THE PO-RECEIPTS CURSOR.                                *15830099
158400*----------------------------------------------------------------*15840099
158500 4020-CLOSE-CURSOR.                                               15850099
158600                                                                  15860099
158700     EXEC SQL                                                     15870099
158800          CLOSE RECEIPTS-CSR                                      15880099
158900     END-EXEC.                                                    15890099
159000*                                                                 15900099
159100     EVALUATE TRUE                                                15910099
159200         WHEN SQLCODE = ZERO                                      15920099
159300             CONTINUE                                             15930099
159400         WHEN SQLWARN0 NOT = SPACES                               15940099
159500         WHEN SQLCODE < ZERO                                      15950099
159600         WHEN SQLCODE > ZERO                                      15960099
159700             MOVE '4020-CLOSE-CURSOR'                             15970099
159800                               TO DP013-PARAGRAPH                 15980099
159900             MOVE 'CLOSE RECEIPTS CURSOR '                        15990099
160000                               TO DP013-MESSAGE-TEXT (1)          16000099
160100             MOVE SQLCA        TO DP013-SQLCA                     16010099
160200             MOVE 'TIMRCPO '   TO DP013-DB2-TABLE-NAME (1)        16020099
160300             SET DP013-DB2-ABEND                                  16030099
160400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16040099
160500             PERFORM DP013-0000-PROCESS-ABEND                     16050099
160600     END-EVALUATE.                                                16060099
160700                                                                  16070099
160800 EJECT                                                            16080099
160900*----------------------------------------------------------------*16090099
161000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16100099
161100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16110099
161200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16120099
161300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16130099
161400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16140099
161500*                                                                *16150099
161600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16160099
161700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16170099
161800*    UPON INITIALIZATION.                                        *16180099
161900*----------------------------------------------------------------*16190099
162000 4300-READ-ITEMS-FROM-DB.                                         16200099
162100                                                                  16210099
162200     PERFORM                                                      16220099
162300         VARYING PV-READ-COUNT                                    16230099
162400         FROM 1 BY 1                                              16240099
162500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16250099
162600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16260099
162700                                                                  16270099
162800         PERFORM 4310-FETCH                                       16280099
162900                                                                  16290099
163000         IF  ASC-ITEMS-LEFT-ON-DB                                 16300099
163100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16310099
163200                 ADD +1            TO ASC-ITEM-SUB                16320099
163300             ELSE                                                 16330099
163400                 ADD +1            TO ASC-BLK-SUB                 16340099
163500                 MOVE +1           TO ASC-ITEM-SUB                16350099
163600                                                                  16360099
163700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16370099
163800                     MOVE +1       TO ASC-BLK-SUB                 16380099
163900                     SET ASC-BLOCK-MODIFIED (1)                   16390099
164000                                   TO TRUE                        16400099
164100                     PERFORM 5100-WRITE-TEMP-STORAGE              16410099
164200                     MOVE ASC-BLOCK-ENTRIES                       16420099
164300                               (PC-MAX-BLOCKS-IN-ARRAY)           16430099
164400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16440099
164500                     ADD +1        TO ASC-BLK-SUB                 16450099
164600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16460099
164700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16470099
164800                                   TO  TRUE                       16480099
164900                 END-IF                                           16490099
165000             END-IF                                               16500099
165100             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   16510099
165200             MOVE ASC-NUMBER-OF-ITEMS-READ                        16520099
165300                                   TO  ASC-LIST-ITEM-NUMBER       16530099
165400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16540099
165500             MOVE IMRCPO-PO-UNT-QTY                               16550099
165600                                   TO  ASC-UNTS                   16560099
165700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16570099
165701             ADD IMRCPO-PO-UNT-QTY                                16570199
165710                                   TO  ASC-TOT-UNITS              16571099
165800             MOVE IMRCPO-PO-CART-CNT                              16580099
165900                                   TO  ASC-CTN                    16590099
166000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16600099
166010             ADD IMRCPO-PO-CART-CNT                               16601099
166020                                   TO  ASC-TOT-CARTONS            16602099
166100             MOVE IMRCPO-PO-CBMT-QTY                              16610099
166200                                   TO  ASC-CBM                    16620099
166300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16630099
166310             ADD IMRCPO-PO-CBMT-QTY                               16631099
166320                                   TO  ASC-TOT-CBM                16632099
166400             MOVE IMRCPO-ORGN-SHPD-FR-CDE                         16640099
166500                                   TO  ASC-TYPE                   16650099
166600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16660099
166700             MOVE IMRCPO-IMPRT-VEH-NM                             16670099
166800                                   TO  ASC-VSL-NAME               16680099
166900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16690099
167000             MOVE IMRCPO-TRIP-TYP-CDE                             16700099
167100                                   TO  ASC-TRIP-CODE              16710099
167200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16720099
167201             MOVE IMRCPO-PO-RCVD-SEQ-NBR                          16720199
167202                                   TO  ASC-PO-RCVD-SEQ-NBR        16720299
167210                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16721099
167300             PERFORM 4340-SELECT-TAURCPO-CNT                      16730099
167400             PERFORM 4350-SELECT-TIMRCPO-CNT                      16740099
167500             ADD  PV-TAURCPO-CNT PV-TIMRCPO-CNT                   16750099
167600             GIVING  ASC-TRN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)       16760099
167700*                                                                 16770099
167701             MOVE IMRCPO-PO-RCVD-DELY-TMST (1:10)                 16770199
167702                                   TO  ASC-RCP-DT                 16770299
167710                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16771099
168900*                                                                 16890099
169000             IF  IMRCPO-DPRTR-TMST (1:10)       = SPACES  OR      16900099
169100                                                  PC-INIT-DATE    16910099
169200                 MOVE SPACES       TO  ASC-ETD                    16920099
169300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16930099
169400             ELSE                                                 16940099
169500                 STRING  IMRCPO-DPRTR-TMST (6:2) '/'              16950099
169600                         IMRCPO-DPRTR-TMST (9:2)                  16960099
169700                         DELIMITED BY SIZE                        16970099
169800                                 INTO ASC-ETD                     16980099
169900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16990099
170000             END-IF                                               17000099
170100*                                                                 17010099
170200             IF  IMRCPO-LAST-UPD-TMST (1:10)                      17020099
170300                                          = SPACES OR PC-INIT-DATE17030099
170400                MOVE SPACES         TO ASC-LAST-TRN               17040099
170500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17050099
170600             ELSE                                                 17060099
170700                STRING  IMRCPO-LAST-UPD-TMST(6:2) '/'             17070099
170800                        IMRCPO-LAST-UPD-TMST(9:2)                 17080099
170900                        DELIMITED BY SIZE                         17090099
171000                                  INTO ASC-LAST-TRN               17100099
171100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17110099
171200             END-IF                                               17120099
171300         END-IF                                                   17130099
171400     END-PERFORM.                                                 17140099
171500*                                                                 17150099
171600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17160099
171700         MOVE +1               TO ASC-BLK-SUB                     17170099
171800         PERFORM 5100-WRITE-TEMP-STORAGE                          17180099
171900         ADD +1                TO ASC-BLK-SUB                     17190099
172000         PERFORM 5100-WRITE-TEMP-STORAGE                          17200099
172100                                                                  17210099
172200         MOVE 1                TO ASC-BLK-SUB                     17220099
172300                                  PV-BLOCK-NUMBER                 17230099
172400         PERFORM 4410-READ-TEMP-STORAGE                           17240099
172500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17250099
172600             MOVE 2            TO ASC-BLK-SUB                     17260099
172700                                  PV-BLOCK-NUMBER                 17270099
172800             PERFORM 4410-READ-TEMP-STORAGE                       17280099
172900         END-IF                                                   17290099
173000     END-IF.                                                      17300099
173100                                                                  17310099
173200 EJECT                                                            17320099
173300*----------------------------------------------------------------*17330099
173400*    FETCH THE PO-RECEIPTS CURSOR.                               *17340099
173500*----------------------------------------------------------------*17350099
173600 4310-FETCH.                                                      17360099
173700                                                                  17370099
173800     EXEC SQL                                                     17380099
173900          FETCH  RECEIPTS-CSR                                     17390099
174000          INTO  :IMRCPO-PO-RCVD-DELY-TMST                         17400099
174100              , :IMRCPO-PO-RCVD-SEQ-NBR                           17410099
174200              , :IMRCPO-PO-CART-CNT                               17420099
174300              , :IMRCPO-PO-CBMT-QTY                               17430099
174400              , :IMRCPO-PO-UNT-QTY                                17440099
174500              , :IMRCPO-ORGN-SHPD-FR-CDE                          17450099
174600              , :IMRCPO-IMPRT-VEH-NM                              17460099
174700              , :IMRCPO-DPRTR-TMST                                17470099
174800              , :IMRCPO-POE-DELY-TMST                             17480099
174900              , :IMRCPO-TRIP-TYP-CDE                              17490099
175000              , :IMRCPO-LAST-UPD-TMST                             17500099
175100     END-EXEC.                                                    17510099
175200*                                                                 17520099
175300     EVALUATE TRUE                                                17530099
175400         WHEN SQLCODE = ZERO                                      17540099
175500         WHEN SQLCODE = +100                                      17550099
175600              CONTINUE                                            17560099
175700         WHEN SQLWARN0 NOT = SPACE                                17570099
175800         WHEN SQLCODE NOT = ZERO                                  17580099
175900              MOVE '4310-FETCH-CURSOR'                            17590099
176000                               TO DP013-PARAGRAPH                 17600099
176100              MOVE 'FETCH BOOKING CURSOR'                         17610099
176200                               TO DP013-MESSAGE-TEXT (1)          17620099
176300              MOVE SQLCA       TO DP013-SQLCA                     17630099
176400              SET DP013-DB2-ABEND                                 17640099
176500                               TO TRUE                            17650099
176600              PERFORM DP013-0000-PROCESS-ABEND                    17660099
176700     END-EVALUATE.                                                17670099
176800*                                                                 17680099
176900     IF  SQLCODE EQUAL +100                                       17690099
177000         SET ASC-NO-ITEMS-LEFT-ON-DB                              17700099
177100                                   TO TRUE                        17710099
177200     END-IF.                                                      17720099
177300                                                                  17730099
177400 EJECT                                                            17740099
177500*----------------------------------------------------------------*17750099
177600*        FORMAT THE DB2 DATE TO MM/DD/YY.                        *17760099
177700*----------------------------------------------------------------*17770099
177800 4320-PROCESS-DATE.                                               17780099
177900                                                                  17790099
178000     MOVE PV-DB-MM          TO  PV-DD-MM.                         17800099
178100     MOVE PV-DB-DD          TO  PV-DD-DD.                         17810099
178200     MOVE PV-DB-YY          TO  PV-DD-YY.                         17820099
178300                                                                  17830099
178400 EJECT                                                            17840099
178500*----------------------------------------------------------------*17850099
178600*    SELECT COUNT FROM TAURCPO                                   *17860099
178700*----------------------------------------------------------------*17870099
178800 4340-SELECT-TAURCPO-CNT.                                         17880099
178900                                                                  17890099
179000     EXEC SQL                                                     17900099
179100         SELECT                                                   17910099
179200                 COUNT (*)                                        17920099
179300         INTO   :PV-TAURCPO-CNT                                   17930099
179400         FROM    TAURCPO                                          17940099
179500         WHERE   PO_NBR          = :DK-PO-NBR                     17950099
179600           AND   PO_RCVD_SEQ_NBR = :IMRCPO-PO-RCVD-SEQ-NBR        17960099
179700     END-EXEC.                                                    17970099
179800*                                                                 17980099
179900     EVALUATE TRUE                                                17990099
180000         WHEN SQLCODE = ZERO                                      18000099
180100         WHEN SQLCODE = +100                                      18010099
180200              CONTINUE                                            18020099
180300         WHEN SQLWARN0 NOT = SPACE                                18030099
180400         WHEN SQLCODE NOT  = ZERO                                 18040099
180500              MOVE '4340-SELECT-TAURCPO-CNT'                      18050099
180600                               TO DP013-PARAGRAPH                 18060099
180700              MOVE 'SQL ERROR SELECTING COUNT FROM TAURCPO'       18070099
180800                               TO DP013-MESSAGE-TEXT (1)          18080099
180900              MOVE SQLCA       TO DP013-SQLCA                     18090099
181000              SET DP013-DB2-ABEND                                 18100099
181100                               TO TRUE                            18110099
181200              PERFORM DP013-0000-PROCESS-ABEND                    18120099
181300     END-EVALUATE.                                                18130099
181400                                                                  18140099
181500 EJECT                                                            18150099
181600*----------------------------------------------------------------*18160099
181700*    SELECT COUNT FROM TIMCNTK                                   *18170099
181800*----------------------------------------------------------------*18180099
181900 4350-SELECT-TIMRCPO-CNT.                                         18190099
182000                                                                  18200099
182100     EXEC SQL                                                     18210099
182200         SELECT COUNT(*)                                          18220099
182300         INTO  :PV-TIMRCPO-CNT                                    18230099
182400         FROM   TIMRCPO                                           18240099
182500         WHERE  PO_NBR          = :DK-PO-NBR                      18250099
182600           AND  PO_RCVD_SEQ_NBR = :IMRCPO-PO-RCVD-SEQ-NBR         18260099
182700     END-EXEC.                                                    18270099
182800*                                                                 18280099
182900     EVALUATE TRUE                                                18290099
183000         WHEN SQLCODE = ZERO                                      18300099
183100         WHEN SQLCODE = +100                                      18310099
183200              CONTINUE                                            18320099
183300         WHEN SQLWARN0 NOT = SPACE                                18330099
183400         WHEN SQLCODE NOT = ZERO                                  18340099
183500              MOVE '4350-SELECT-TIMRCPO-CNT'                      18350099
183600                               TO DP013-PARAGRAPH                 18360099
183700              MOVE 'SQL ERROR SELECTING COUNT FROM TIMRCPO'       18370099
183800                               TO DP013-MESSAGE-TEXT (1)          18380099
183900              MOVE SQLCA       TO DP013-SQLCA                     18390099
184000              SET DP013-DB2-ABEND                                 18400099
184100                               TO TRUE                            18410099
184200              PERFORM DP013-0000-PROCESS-ABEND                    18420099
184300     END-EVALUATE.                                                18430099
184400                                                                  18440099
184500 EJECT                                                            18450099
184600*----------------------------------------------------------------*18460099
184700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18470099
184800*----------------------------------------------------------------*18480099
184900 4400-MOVE-COMMAREA-TO-SCREEN.                                    18490099
185000                                                                  18500099
185100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18510099
185200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18520099
185300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18530099
185400             MOVE +1    TO ASC-BLK-SUB                            18540099
185500             PERFORM 5100-WRITE-TEMP-STORAGE                      18550099
185600             ADD +1     TO ASC-BLK-SUB                            18560099
185700             PERFORM 5100-WRITE-TEMP-STORAGE                      18570099
185800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18580099
185900                 GIVING PV-BLOCK-NUMBER                           18590099
186000                 REMAINDER PV-REMAINDER                           18600099
186100             IF  PV-REMAINDER > ZERO                              18610099
186200                 ADD +1 TO PV-BLOCK-NUMBER                        18620099
186300             END-IF                                               18630099
186400             MOVE +1    TO ASC-BLK-SUB                            18640099
186500             PERFORM 4410-READ-TEMP-STORAGE                       18650099
186600             ADD +1     TO ASC-BLK-SUB                            18660099
186700                           PV-BLOCK-NUMBER                        18670099
186800             PERFORM 4410-READ-TEMP-STORAGE                       18680099
186900     END-IF.                                                      18690099
187000     MOVE +1            TO ASC-BLK-SUB.                           18700099
187100     COMPUTE ASC-ITEM-SUB =                                       18710099
187200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18720099
187300         + PC-ITEMS-PER-PANEL).                                   18730099
187400*                                                                 18740099
187500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18750099
187600         ADD +1         TO ASC-BLK-SUB                            18760099
187700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18770099
187800     END-IF.                                                      18780099
187900*                                                                 18790099
188000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18800099
188100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18810099
188200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18820099
188300     PERFORM 4420-FORMAT-LIST-LINES                               18830099
188400         VARYING PV-SUB                                           18840099
188500         FROM PC-ITEMS-PER-PANEL BY -1                            18850099
188600         UNTIL PV-SUB < +1.                                       18860099
188700*                                                                 18870099
188800     COMPUTE ASC-ITEMS-DISPLAYED =                                18880099
188900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18890099
189000*                                                                 18900099
189100     PERFORM 4401-SELECT-PO-DETAILS.                              18910099
189200     PERFORM 4402-SELECT-AD-DTE.                                  18920099
189300     PERFORM 4403-SELECT-VND-STYL.                                18930099
189400     PERFORM 4404-OPEN-OUTR-PCK-CSR.                              18940099
189500     PERFORM 4405-FETCH-OUTR-PCK.                                 18950099
189600     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                             18960099
189700     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            18970099
189800*                                                                 18980099
189900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18990099
190000                                      ASTRTITO.                   19000099
190100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19010099
190200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19020099
190300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19030099
190400                                   TO ASELITO.                    19040099
190401     MOVE ASC-TOT-CARTONS          TO ATOTCNTO.                   19040199
190402     MOVE ASC-TOT-UNITS            TO ATOTUNTO.                   19040299
190410     MOVE ASC-TOT-CBM              TO ATOTCBMO.                   19041099
190500*                                                                 19050099
190600     IF  DP020-MSG-NUMBER-X = SPACE                               19060099
190700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19070099
190800*----------- MORE ITEMS TO DISPLAY --------                       19080099
190900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19090099
191000             SET DP020-MSG-INFORMATIONAL TO TRUE                  19100099
191100         END-IF                                                   19110099
191200     END-IF.                                                      19120099
191300                                                                  19130099
191400 EJECT                                                            19140099
191500*----------------------------------------------------------------*19150099
191600*    SELECT PO DETAILS.                                          *19160099
191700*----------------------------------------------------------------*19170099
191800 4401-SELECT-PO-DETAILS.                                          19180099
191900                                                                  19190099
192000     PERFORM                                                      19200099
192100         WITH TEST AFTER                                          19210099
192200         VARYING PV-RETRY-COUNTER                                 19220099
192300         FROM 1 BY 1                                              19230099
192400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19240099
192500            OR  (SQLCODE = ZERO)                                  19250099
192600            OR  (SQLCODE = +100))                                 19260099
192700                                                                  19270099
192800         EXEC SQL                                                 19280099
192900              SELECT A.DEPT_NBR,                                  19290099
193000                     A.OTB_PER_NBR,                               19300099
193100                     A.TOT_UNT_QTY,                               19310099
193200                     A.PROD_CNTRY_CDE,                            19320099
193300                     B.ENT_NAME_DESC,                             19330099
193400                     C.CAN_IFNOT_SHIP_DTE,                        19340099
193500                     C.EXT_CAN_DTE,                               19350099
193600                     C.STRT_FCTRY_DTE,                            19360099
193700                     C.LAST_FCTRY_DTE,                            19370099
193800                     C.DONT_SHIP_BEF_DTE,                         19380099
193900                     C.FOB_CDE,                                   19390099
194000                     C.POE_CDE                                    19400099
194100              INTO  :PURCHS-DEPT-NBR,                             19410099
194200                    :PURCHS-OTB-PER-NBR,                          19420099
194300                    :PURCHS-TOT-UNT-QTY,                          19430099
194400                    :PURCHS-PROD-CNTRY-CDE,                       19440099
194500                    :ENTNME-ENT-NAME-DESC,                        19450099
194600                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   19460099
194700                    :PLNSHP-EXT-CAN-DTE,                          19470099
194800                    :PLNSHP-STRT-FCTRY-DTE,                       19480099
194900                    :PLNSHP-LAST-FCTRY-DTE,                       19490099
195000                    :PLNSHP-DONT-SHIP-BEF-DTE,                    19500099
195100                    :PLNSHP-FOB-CDE,                              19510099
195200                    :PLNSHP-POE-CDE                               19520099
195300              FROM   TPURCHS A,                                   19530099
195400                     TENTNME B,                                   19540099
195500                     TPLNSHP C                                    19550099
195600              WHERE  A.PO_NBR         = :DK-PO-NBR                19560099
195700                AND  A.VER_STATUS_CDE = 'A'                       19570099
195800                AND  B.ENT_ID         =  A.ENT_ID                 19580099
195900                AND  B.TYPE_CDE       = '01'                      19590099
196000                AND  C.PO_NBR         =  A.PO_NBR                 19600099
196100                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE         19610099
196200         END-EXEC                                                 19620099
196300*                                                                 19630099
196400         EVALUATE TRUE                                            19640099
196500             WHEN SQLCODE = ZERO                                  19650099
196600             WHEN SQLCODE = +100                                  19660099
196700             WHEN SQLCODE = -904                                  19670099
196800             WHEN SQLCODE = -913                                  19680099
196900                 CONTINUE                                         19690099
197000             WHEN SQLWARN0 NOT = SPACES                           19700099
197100             WHEN SQLCODE < ZERO                                  19710099
197200             WHEN SQLCODE > ZERO                                  19720099
197300                 MOVE '4401-SELECT-PO-DETAILS'                    19730099
197400                                   TO DP013-PARAGRAPH             19740099
197500                 MOVE 'SQL ERROR SELECTING PO DETAILS'            19750099
197600                                   TO DP013-MESSAGE-TEXT (1)      19760099
197700                 MOVE SQLCA        TO DP013-SQLCA                 19770099
197800                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    19780099
197900                 SET DP013-DB2-ABEND                              19790099
198000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19800099
198100                 PERFORM DP013-0000-PROCESS-ABEND                 19810099
198200         END-EVALUATE                                             19820099
198300     END-PERFORM.                                                 19830099
198400*                                                                 19840099
198500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19850099
198600         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      19860099
198700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  19870099
198800                                   TO DP013-MESSAGE-TEXT (1)      19880099
198900         MOVE SQLCA                TO DP013-SQLCA                 19890099
199000         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    19900099
199100         SET DP013-DB2-ABEND                                      19910099
199200             DP013-XCTL-DISPLAY-RESTART                           19920099
199300                                   TO TRUE                        19930099
199400         PERFORM DP013-0000-PROCESS-ABEND                         19940099
199500     END-IF.                                                      19950099
199600                                                                  19960099
199700 EJECT                                                            19970099
199800*----------------------------------------------------------------*19980099
199900*     SELECT AD DATE FROM TPURITM                                *19990099
200000*----------------------------------------------------------------*20000099
200100 4402-SELECT-AD-DTE.                                              20010099
200200                                                                  20020099
200300     PERFORM                                                      20030099
200400         WITH TEST AFTER                                          20040099
200500         VARYING PV-RETRY-COUNTER                                 20050099
200600         FROM 1 BY 1                                              20060099
200700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20070099
200800         OR     (SQLCODE = ZERO)                                  20080099
200900         OR     (SQLCODE = +100))                                 20090099
201000                                                                  20100099
201100         EXEC SQL                                                 20110099
201200              SELECT                                              20120099
201300                     MIN(AD_EVNT_DTE)                             20130099
201400              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            20140099
201500              FROM   TPURITM                                      20150099
201600              WHERE  PO_NBR         = :DK-PO-NBR                  20160099
201700                AND  VER_STATUS_CDE = 'A'                         20170099
201800                AND  AD_EVNT_DTE   ^= '0001-01-01'                20180099
201900         END-EXEC                                                 20190099
202000*                                                                 20200099
202100         EVALUATE TRUE                                            20210099
202200             WHEN SQLCODE = ZERO                                  20220099
202300             WHEN SQLCODE = +100                                  20230099
202400             WHEN SQLCODE = -904                                  20240099
202500             WHEN SQLCODE = -913                                  20250099
202600                  CONTINUE                                        20260099
202700             WHEN SQLWARN0 NOT = SPACE                            20270099
202800             WHEN SQLCODE NOT = ZERO                              20280099
202900                  MOVE '4402-SELECT-AD-DTE'                       20290099
203000                                   TO DP013-PARAGRAPH             20300099
203100                  MOVE 'SQL ERROR SELECTING AD DATE'              20310099
203200                                   TO DP013-MESSAGE-TEXT (1)      20320099
203300                  MOVE SQLCA       TO DP013-SQLCA                 20330099
203400                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    20340099
203500                  SET DP013-DB2-ABEND                             20350099
203600                      DP013-XCTL-DISPLAY-RESTART TO TRUE          20360099
203700                  PERFORM DP013-0000-PROCESS-ABEND                20370099
203800         END-EVALUATE                                             20380099
203900     END-PERFORM.                                                 20390099
204000*                                                                 20400099
204100     IF SQLCODE EQUAL + 0                                         20410099
204200        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK               20420099
204300        PERFORM 4320-PROCESS-DATE                                 20430099
204400        MOVE PV-DATE-DISPLAY       TO AADDTO                      20440099
204500     ELSE                                                         20450099
204600        MOVE SPACES                TO AADDTO                      20460099
204700     END-IF.                                                      20470099
204800*                                                                 20480099
204900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20490099
205000         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH             20500099
205100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA20510099
205200-             'TE'                 TO DP013-MESSAGE-TEXT (1)      20520099
205300         MOVE SQLCA                TO DP013-SQLCA                 20530099
205400         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    20540099
205500         SET DP013-DB2-ABEND                                      20550099
205600             DP013-XCTL-DISPLAY-RESTART                           20560099
205700                                   TO TRUE                        20570099
205800         PERFORM DP013-0000-PROCESS-ABEND                         20580099
205900     END-IF.                                                      20590099
206000                                                                  20600099
206100 EJECT                                                            20610099
206110*----------------------------------------------------------------*20611099
206120*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *20612099
206130*----------------------------------------------------------------*20613099
206140 4403-SELECT-VND-STYL.                                            20614099
206150                                                                  20615099
206160     PERFORM                                                      20616099
206170         WITH TEST AFTER                                          20617099
206180         VARYING PV-RETRY-COUNTER                                 20618099
206190         FROM 1 BY 1                                              20619099
206191         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20619199
206192            OR  (SQLCODE = ZERO)                                  20619299
206193            OR  (SQLCODE = +100)                                  20619399
206194            OR  (SQLCODE = -811))                                 20619499
206195                                                                  20619599
206196         EXEC SQL                                                 20619699
206197              SELECT   DISTINCT                                   20619799
206198                       VS_NBR                                     20619899
206199                INTO   :XLT00004-VS-NBR                           20619999
206200                FROM   TPURITM A                                  20620099
206201                   ,   XLT_SKU B                                  20620199
206202                   ,   XLT_VND_STYL C                             20620299
206203               WHERE   A.PO_NBR       = :DK-PO-NBR                20620399
206204                 AND   A.VER_STATUS_CDE = 'A'                     20620499
206205                 AND   A.ITM_NBR = B.ITM_NBR                      20620599
206206                 AND   B.STYL_ID = C.STYL_ID                      20620699
206207         END-EXEC                                                 20620799
206208                                                                  20620899
206209         EVALUATE TRUE                                            20620999
206210             WHEN SQLCODE = ZERO                                  20621099
206211             WHEN SQLCODE = +100                                  20621199
206212             WHEN SQLCODE = -811                                  20621299
206213             WHEN SQLCODE = -904                                  20621399
206214             WHEN SQLCODE = -913                                  20621499
206215                 CONTINUE                                         20621599
206216             WHEN SQLWARN0 NOT = SPACES                           20621699
206217             WHEN SQLCODE < ZERO                                  20621799
206218             WHEN SQLCODE > ZERO                                  20621899
206219                 MOVE '4403-SELECT-VND-STYL'                      20621999
206220                                     TO DP013-PARAGRAPH           20622099
206221                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'          20622199
206222                                     TO DP013-MESSAGE-TEXT (1)    20622299
206223                 MOVE SQLCA          TO DP013-SQLCA               20622399
206224                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)  20622499
206225                 SET DP013-DB2-ABEND                              20622599
206226                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20622699
206227                 PERFORM DP013-0000-PROCESS-ABEND                 20622799
206228         END-EVALUATE                                             20622899
206229     END-PERFORM.                                                 20622999
206230*                                                                 20623099
206231     IF  SQLCODE EQUAL +0                                         20623199
206232         MOVE XLT00004-VS-NBR       TO AVNDSTYO                   20623299
206233     ELSE                                                         20623399
206234         IF  SQLCODE EQUAL -811                                   20623499
206235             MOVE '*MULTIPLES*'     TO AVNDSTYO                   20623599
206236         END-IF                                                   20623699
206237     END-IF.                                                      20623799
206238*                                                                 20623899
206239     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20623999
206240         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH        20624099
206241         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO20624199
206242-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)      20624299
206243         MOVE SQLCA                TO DP013-SQLCA                 20624399
206244         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)    20624499
206245         SET DP013-DB2-ABEND                                      20624599
206246             DP013-XCTL-DISPLAY-RESTART                           20624699
206247                                   TO TRUE                        20624799
206248         PERFORM DP013-0000-PROCESS-ABEND                         20624899
206249     END-IF.                                                      20624999
206250                                                                  20625099
206251 EJECT                                                            20625199
212700*----------------------------------------------------------------*21270099
212800*     OPEN THE OUTER PACK CURSOR                                 *21280099
212900*----------------------------------------------------------------*21290099
213000 4404-OPEN-OUTR-PCK-CSR.                                          21300099
213100                                                                  21310099
213200     PERFORM                                                      21320099
213300         WITH TEST AFTER                                          21330099
213400         VARYING PV-RETRY-COUNTER                                 21340099
213500         FROM 1 BY 1                                              21350099
213600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21360099
213700            OR  (SQLCODE = ZERO))                                 21370099
213800*                                                                 21380099
213900         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   21390099
214000                                                                  21400099
214100         EXEC SQL                                                 21410099
214200              OPEN OUTR-PCK-CSR                                   21420099
214300         END-EXEC                                                 21430099
214400*                                                                 21440099
214500         EVALUATE TRUE                                            21450099
214600             WHEN SQLCODE = ZERO                                  21460099
214700             WHEN SQLCODE = -904                                  21470099
214800             WHEN SQLCODE = -913                                  21480099
214900                 CONTINUE                                         21490099
215000             WHEN SQLWARN0 NOT = SPACES                           21500099
215100             WHEN SQLCODE < ZERO                                  21510099
215200             WHEN SQLCODE > ZERO                                  21520099
215300                 MOVE '4404-OPEN-OUTR-PCK-CSR'                    21530099
215400                                   TO DP013-PARAGRAPH             21540099
215500                 MOVE 'OPEN OUTER-PACK CURSOR - '                 21550099
215600                                   TO DP013-MESSAGE-TEXT (1)      21560099
215700                 MOVE SQLCA        TO DP013-SQLCA                 21570099
215800                 MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)    21580099
215900                 SET DP013-DB2-ABEND                              21590099
216000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21600099
216100                 PERFORM DP013-0000-PROCESS-ABEND                 21610099
216200         END-EVALUATE                                             21620099
216300     END-PERFORM.                                                 21630099
216400*                                                                 21640099
216500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21650099
216600         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       21660099
216700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   21670099
216800                                   TO DP013-MESSAGE-TEXT (1)      21680099
216900         MOVE SQLCA                TO DP013-SQLCA                 21690099
217000         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    21700099
217100         SET DP013-DB2-ABEND                                      21710099
217200             DP013-XCTL-DISPLAY-RESTART                           21720099
217300                                   TO TRUE                        21730099
217400         PERFORM DP013-0000-PROCESS-ABEND                         21740099
217500     END-IF.                                                      21750099
217600                                                                  21760099
217700 EJECT                                                            21770099
217800*----------------------------------------------------------------*21780099
217900*     FETCH THE OUTER PACK QUANTITY                              *21790099
218000*----------------------------------------------------------------*21800099
218100 4405-FETCH-OUTR-PCK.                                             21810099
218200                                                                  21820099
218300     PERFORM                                                      21830099
218400         WITH TEST AFTER                                          21840099
218500         VARYING PV-RETRY-COUNTER                                 21850099
218600         FROM 1 BY 1                                              21860099
218700         UNTIL (SQLCODE = +100)                                   21870099
218800                                                                  21880099
218900         EXEC SQL                                                 21890099
219000              FETCH OUTR-PCK-CSR                                  21900099
219100              INTO  :PURITM-UNT-QTY                               21910099
219200                 ,  :PURITM-OUTR-PK-QTY                           21920099
219300         END-EXEC                                                 21930099
219400*                                                                 21940099
219500         EVALUATE TRUE                                            21950099
219600             WHEN SQLCODE = ZERO                                  21960099
219700             WHEN SQLCODE = +100                                  21970099
219800                  CONTINUE                                        21980099
219900             WHEN SQLWARN0 NOT = SPACE                            21990099
220000             WHEN SQLCODE NOT = ZERO                              22000099
220100                  MOVE '4405-FETCH-OUTR-PCK'                      22010099
220200                                   TO DP013-PARAGRAPH             22020099
220300                  MOVE 'FETCH OUTER-PACK CURSOR'                  22030099
220400                                   TO DP013-MESSAGE-TEXT (1)      22040099
220500                  MOVE SQLCA       TO DP013-SQLCA                 22050099
220600                  SET DP013-DB2-ABEND                             22060099
220700                                   TO TRUE                        22070099
220800                  PERFORM DP013-0000-PROCESS-ABEND                22080099
220900         END-EVALUATE                                             22090099
221000*                                                                 22100099
221100         IF  SQLCODE EQUAL +0                                     22110099
221200             IF PURITM-OUTR-PK-QTY = 0                            22120099
221300                DIVIDE 1 INTO PURITM-UNT-QTY                      22130099
221400                GIVING PV-ITEM-CART-CNT ROUNDED                   22140099
221500             ELSE                                                 22150099
221600                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     22160099
221700                GIVING PV-ITEM-CART-CNT ROUNDED                   22170099
221800             END-IF                                               22180099
221900             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               22190099
222000         END-IF                                                   22200099
222120     END-PERFORM.                                                 22212099
222200                                                                  22220099
222300 EJECT                                                            22230099
222400*----------------------------------------------------------------*22240099
222500*     CLOSE THE OUTER PACK CURSOR                                *22250099
222600*----------------------------------------------------------------*22260099
222700 4406-CLOSE-OUTR-PCK-CSR.                                         22270099
222800                                                                  22280099
222900     EXEC SQL                                                     22290099
223000          CLOSE OUTR-PCK-CSR                                      22300099
223100     END-EXEC.                                                    22310099
223200*                                                                 22320099
223300     EVALUATE TRUE                                                22330099
223400         WHEN SQLCODE = ZERO                                      22340099
223500             CONTINUE                                             22350099
223600         WHEN SQLWARN0 NOT = SPACES                               22360099
223700         WHEN SQLCODE < ZERO                                      22370099
223800         WHEN SQLCODE > ZERO                                      22380099
223900             MOVE '4406-CLOSE-OUTR-PCK-CSR'                       22390099
224000                               TO DP013-PARAGRAPH                 22400099
224100             MOVE 'CLOSE OUTER-PACK CURSOR '                      22410099
224200                               TO DP013-MESSAGE-TEXT (1)          22420099
224300             MOVE SQLCA        TO DP013-SQLCA                     22430099
224400             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        22440099
224500             SET DP013-DB2-ABEND                                  22450099
224600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22460099
224700             PERFORM DP013-0000-PROCESS-ABEND                     22470099
224800     END-EVALUATE.                                                22480099
224900                                                                  22490099
225000 EJECT                                                            22500099
225100*----------------------------------------------------------------*22510099
225200*    MOVE PO DETAILS TO SCREEN.                                  *22520099
225300*----------------------------------------------------------------*22530099
225400 4407-MOVE-PO-DTLS-TO-SCR.                                        22540099
225500                                                                  22550099
225600     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   22560099
225700     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.             22570099
225710     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    22571099
225800     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     22580099
225900     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    22590099
226000     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                   22600099
226100     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  22610099
226200     MOVE PLNSHP-FOB-CDE            TO AFOBO.                     22620099
226300     MOVE PLNSHP-POE-CDE            TO APOEO.                     22630099
226400     MOVE PV-PO-CART-CNT            TO ACTNSO.                    22640099
226500*                                                                 22650099
226600     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE               22660099
226700        MOVE SPACES                 TO ACANDTO                    22670099
226800     ELSE                                                         22680099
226900        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            22690099
227000                                    TO PV-DATE-BREAK              22700099
227100        PERFORM 4320-PROCESS-DATE                                 22710099
227200        MOVE PV-DATE-DISPLAY        TO ACANDTO                    22720099
227300     END-IF.                                                      22730099
227400*                                                                 22740099
227500     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE               22750099
227600        MOVE SPACES                 TO AXCANDTO                   22760099
227700     ELSE                                                         22770099
227800        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK              22780099
227900        PERFORM 4320-PROCESS-DATE                                 22790099
228000        MOVE PV-DATE-DISPLAY        TO AXCANDTO                   22800099
228100     END-IF.                                                      22810099
228200*                                                                 22820099
228300     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE               22830099
228400        MOVE SPACES                 TO ASTXFDTO                   22840099
228500     ELSE                                                         22850099
228600        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK              22860099
228700        PERFORM 4320-PROCESS-DATE                                 22870099
228800        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                   22880099
228900     END-IF.                                                      22890099
229000*                                                                 22900099
229100     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE               22910099
229200        MOVE SPACES                 TO ALTXFDTO                   22920099
229300     ELSE                                                         22930099
229400        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK              22940099
229500        PERFORM 4320-PROCESS-DATE                                 22950099
229600        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                   22960099
229700     END-IF.                                                      22970099
229800*                                                                 22980099
229900     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE               22990099
230000        MOVE SPACES                 TO ADSHBEFO                   23000099
230100     ELSE                                                         23010099
230200        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             23020099
230300                                    TO PV-DATE-BREAK              23030099
230400        PERFORM 4320-PROCESS-DATE                                 23040099
230500        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                   23050099
230600     END-IF.                                                      23060099
230700                                                                  23070099
230800 EJECT                                                            23080099
230900*----------------------------------------------------------------*23090099
231000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23100099
231100*----------------------------------------------------------------*23110099
231200 4410-READ-TEMP-STORAGE.                                          23120099
231300                                                                  23130099
231400     EXEC CICS                                                    23140099
231500         READQ TS                                                 23150099
231600             QUEUE (ASC-LIST-QUEUE-NAME)                          23160099
231700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23170099
231800             ITEM  (PV-BLOCK-NUMBER)                              23180099
231900             RESP  (PV-CICS-RESP)                                 23190099
232000     END-EXEC.                                                    23200099
232100                                                                  23210099
232200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23220099
232300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23230099
232400         CONTINUE                                                 23240099
232500     ELSE                                                         23250099
232600         SET DP013-CICS-ABEND     TO TRUE                         23260099
232700         SET DP013-NO-ROLLBACK    TO TRUE                         23270099
232800         MOVE '4410-READ-TEMP-STORAGE'                            23280099
232900                                  TO DP013-PARAGRAPH              23290099
233000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23300099
233100                                  TO DP013-MESSAGE-TEXT(1)        23310099
233200         PERFORM DP013-0000-PROCESS-ABEND                         23320099
233300     END-IF.                                                      23330099
233400                                                                  23340099
233500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23350099
233600*                                                                 23360099
233700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23370099
233800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23380099
233900     END-IF.                                                      23390099
234000                                                                  23400099
234100 EJECT                                                            23410099
234200*----------------------------------------------------------------*23420099
234300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23430099
234400*----------------------------------------------------------------*23440099
234500 4420-FORMAT-LIST-LINES.                                          23450099
234600                                                                  23460099
234700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23470099
234800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23480099
234900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        23490099
235000         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        23500099
235100         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        23510099
235200                                    MR-ACTION     (PV-SUB)        23520099
235300                                    MR-RCP-DT     (PV-SUB)        23530099
235400                                    MR-VSL-NAME   (PV-SUB)        23540099
235500                                    MR-ETD        (PV-SUB)        23550099
235600                                    MR-LAST-TRN   (PV-SUB)        23560099
235700                                    MR-TYPE       (PV-SUB)        23570099
235800                                    MR-TRIP-CODE  (PV-SUB)        23580099
235900                                    MR-CTN-X      (PV-SUB)        23590099
236000                                    MR-CBM-X      (PV-SUB)        23600099
236100                                    MR-UNTS-X     (PV-SUB)        23610099
236200                                                                  23620099
236300         MOVE ZEROS              TO MR-TRN-CNT  (PV-SUB)          23630099
236400     ELSE                                                         23640099
236500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23650099
236600                                                   > SPACE        23660099
236700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23670099
236800                                 TO MR-SELECTI (PV-SUB)           23680099
236900         ELSE                                                     23690099
237000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23700099
237100                                 TO MR-SELECTI (PV-SUB)           23710099
237101         END-IF                                                   23710199
237102*                                                                 23710299
237103         IF DP030-SET-CURSOR-TRAILER                              23710399
237104            IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23710499
237105                > SPACE)                                          23710599
237106              OR (PV-SUB = 1))                                    23710699
237107               SET DP030-SET-CURSOR-APPL-1 TO TRUE                23710799
237108               MOVE -1        TO MR-SELECTL (PV-SUB)              23710899
237109            END-IF                                                23710999
237110         END-IF                                                   23711099
237120*                                                                 23712099
237130         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23713099
237140             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         23714099
237150                               TO MR-ACTION (PV-SUB)              23715099
237160             MOVE ASC-UNTS     (ASC-BLK-SUB ASC-ITEM-SUB)         23716099
237170                               TO MR-UNTS (PV-SUB)                23717099
237180                                                                  23718099
237191             IF ASC-RCP-DT  (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL      23719199
237192                        SPACES OR PC-INIT-DATE                    23719299
237193                 MOVE SPACES TO MR-RCP-DT  (PV-SUB)               23719399
237194             ELSE                                                 23719499
237195                 STRING  ASC-RCP-DT                               23719599
237196                          (ASC-BLK-SUB ASC-ITEM-SUB) (6:2) '/'    23719699
237197                         ASC-RCP-DT                               23719799
237198                          (ASC-BLK-SUB ASC-ITEM-SUB) (9:2)        23719899
237199                            DELIMITED BY SIZE                     23719999
237200                              INTO MR-RCP-DT (PV-SUB)             23720099
237201             END-IF                                               23720199
237202                                                                  23720299
237210             MOVE ASC-CTN      (ASC-BLK-SUB ASC-ITEM-SUB)         23721099
237300                               TO MR-CTN (PV-SUB)                 23730099
237400             MOVE ASC-CBM      (ASC-BLK-SUB ASC-ITEM-SUB)         23740099
237500                               TO MR-CBM (PV-SUB)                 23750099
237600             MOVE ASC-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)         23760099
237700                               TO MR-TYPE (PV-SUB)                23770099
237800             MOVE ASC-VSL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         23780099
237900                               TO MR-VSL-NAME (PV-SUB)            23790099
238000             MOVE ASC-ETD      (ASC-BLK-SUB ASC-ITEM-SUB)         23800099
238100                               TO MR-ETD (PV-SUB)                 23810099
238200             MOVE ASC-LAST-TRN (ASC-BLK-SUB ASC-ITEM-SUB)         23820099
238300                               TO MR-LAST-TRN (PV-SUB)            23830099
238400             MOVE ASC-TRIP-CODE(ASC-BLK-SUB ASC-ITEM-SUB)         23840099
238500                               TO MR-TRIP-CODE (PV-SUB)           23850099
238600             MOVE ASC-TRN-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)         23860099
238700                               TO MR-TRN-CNT (PV-SUB)             23870099
238800         END-IF                                                   23880099
238900     END-IF.                                                      23890099
239000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23900099
239100     IF  ASC-ITEM-SUB < + 1                                       23910099
239200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23920099
239300         MOVE +1                 TO ASC-BLK-SUB                   23930099
239400     END-IF.                                                      23940099
239500                                                                  23950099
239600 EJECT                                                            23960099
239700*----------------------------------------------------------------*23970099
239800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *23980099
239900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *23990099
240000*  ISSUE A WARNING.                                              *24000099
240100*----------------------------------------------------------------*24010099
240200 4430-CHECK-FOR-BEGIN-AND-END.                                    24020099
240300                                                                  24030099
240400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24040099
240500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24050099
240600*----------- NO END-OF-RANGE SPECFIED ---                         24060099
240700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24070099
240800             SET DP020-MSG-WARNING TO TRUE                        24080099
240900             PERFORM 4431-POSITION-AT-WARNING                     24090099
241000         END-IF                                                   24100099
241100     ELSE                                                         24110099
241200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24120099
241300*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   24130099
241400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24140099
241500             SET DP020-MSG-WARNING TO TRUE                        24150099
241600             PERFORM 4431-POSITION-AT-WARNING                     24160099
241700         END-IF                                                   24170099
241800     END-IF.                                                      24180099
241900                                                                  24190099
242000 EJECT                                                            24200099
242100*----------------------------------------------------------------*24210099
242200*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24220099
242300*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24230099
242400*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24240099
242500*  POSITION THE CURSOR THERE.                                    *24250099
242600*----------------------------------------------------------------*24260099
242700 4431-POSITION-AT-WARNING.                                        24270099
242800                                                                  24280099
242900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24290099
243000                    - PV-TOP-ITEM + 1.                            24300099
243100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24310099
243200         CONTINUE                                                 24320099
243300     ELSE                                                         24330099
243400         SET DP030-SET-CURSOR-APPL-1                              24340099
243500                                   TO TRUE                        24350099
243600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24360099
243700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24370099
243800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24380099
243900     END-IF.                                                      24390099
244000*                                                                 24400099
244100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24410099
244200                    - PV-TOP-ITEM + 1.                            24420099
244300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24430099
244400         CONTINUE                                                 24440099
244500     ELSE                                                         24450099
244600         SET DP030-SET-CURSOR-APPL-1                              24460099
244700                                   TO TRUE                        24470099
244800         MOVE -1                   TO MR-SELECTL (PV-SUB)         24480099
244900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24490099
245000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24500099
245100     END-IF.                                                      24510099
245200                                                                  24520099
245300 EJECT                                                            24530099
245400*----------------------------------------------------------------*24540099
245500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24550099
245600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24560099
245700* FOR THE SELECTED ITEMS QUEUE.                                  *24570099
245800*                                                                *24580099
245900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24590099
246000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24600099
246100* THE ARRAY IS FULL.                                             *24610099
246200*----------------------------------------------------------------*24620099
246300 5000-PREPARE-SEL-QUEUE.                                          24630099
246400                                                                  24640099
246500     MOVE +1                   TO  ASC-BLK-SUB.                   24650099
246600     PERFORM 5100-WRITE-TEMP-STORAGE.                             24660099
246700     ADD +1                    TO  ASC-BLK-SUB.                   24670099
246800     PERFORM 5100-WRITE-TEMP-STORAGE.                             24680099
246900     MOVE ASC-SEL-QUEUE-NAME   TO  TR117-SEL-QUEUE-NAME.          24690099
247000     PERFORM 6010-DELETE-SEL-QUEUE.                               24700099
247100                                                                  24710099
247200     SET ASC-UPDATE-TSQ        TO  TRUE.                          24720099
247300                                                                  24730099
247400     SET TR118-IDX             TO  1.                             24740099
247500     MOVE ZERO                 TO TR117-NUMBER-OF-TS-ITEMS.       24750099
247600     INITIALIZE TR118-SELECTED-ITEM-ARRAY.                        24760099
247700                                                                  24770099
247800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24780099
247900             VARYING PV-ITEM                                      24790099
248000             FROM 1 BY 1                                          24800099
248100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24810099
248200                                                                  24820099
248300     IF  TR118-IDX > 1                                            24830099
248400         PERFORM 5205-WRITE-SEL-QUEUE                             24840099
248500         ADD +1                    TO TR117-NUMBER-OF-TS-ITEMS    24850099
248600     END-IF.                                                      24860099
248700                                                                  24870099
248800 5001-PREPARE-SEL-QUEUE.                                          24880099
248900                                                                  24890099
249000     MOVE +1                   TO  ASC-BLK-SUB.                   24900099
249100     PERFORM 5100-WRITE-TEMP-STORAGE.                             24910099
249200     ADD +1                    TO  ASC-BLK-SUB.                   24920099
249300     PERFORM 5100-WRITE-TEMP-STORAGE.                             24930099
249400     MOVE ASC-SEL-QUEUE-NAME   TO  TR117-SEL-QUEUE-NAME.          24940099
249500     PERFORM 6010-DELETE-SEL-QUEUE.                               24950099
249600                                                                  24960099
249700     SET ASC-UPDATE-TSQ        TO  TRUE.                          24970099
249800                                                                  24980099
249900     SET TR118-IDX             TO  1.                             24990099
250000     MOVE ZERO                 TO TR117-NUMBER-OF-TS-ITEMS.       25000099
250100     INITIALIZE TR118-SELECTED-ITEM-ARRAY.                        25010099
250200                                                                  25020099
250300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25030099
250400             VARYING PV-ITEM                                      25040099
250500             FROM 1 BY 1                                          25050099
250600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25060099
250700                                                                  25070099
250800     IF  TR118-IDX > 1                                            25080099
250900         PERFORM 5205-WRITE-SEL-QUEUE                             25090099
251000         ADD +1                    TO TR117-NUMBER-OF-TS-ITEMS    25100099
251100     END-IF.                                                      25110099
251200                                                                  25120099
251300 EJECT                                                            25130099
251400*----------------------------------------------------------------*25140099
251500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25150099
251600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25160099
251700*----------------------------------------------------------------*25170099
251800 5100-WRITE-TEMP-STORAGE.                                         25180099
251900                                                                  25190099
252000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25200099
252100                                   TO PV-LIST-ITEM-NUMBER.        25210099
252200     COMPUTE PV-BLOCK-NUMBER =                                    25220099
252300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25230099
252400                                                                  25240099
252500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25250099
252600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25260099
252700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25270099
252800             PERFORM 5105-REWRITE-ASC-LISTQ                       25280099
252900         END-IF                                                   25290099
253000     ELSE                                                         25300099
253100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25310099
253200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25320099
253300         PERFORM 5110-WRITE-ASC-LISTQ                             25330099
253400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25340099
253500     END-IF.                                                      25350099
253600                                                                  25360099
253700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25370099
253800                                                                  25380099
253900 EJECT                                                            25390099
254000*----------------------------------------------------------------*25400099
254100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *25410099
254200*  SPECIFIC COMMAREA.                                            *25420099
254300*----------------------------------------------------------------*25430099
254400 5105-REWRITE-ASC-LISTQ.                                          25440099
254500                                                                  25450099
254600     EXEC CICS                                                    25460099
254700         WRITEQ TS                                                25470099
254800             QUEUE (ASC-LIST-QUEUE-NAME)                          25480099
254900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25490099
255000             ITEM  (PV-BLOCK-NUMBER)                              25500099
255100             REWRITE                                              25510099
255200             RESP  (PV-CICS-RESP)                                 25520099
255300     END-EXEC.                                                    25530099
255400                                                                  25540099
255500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25550099
255600         CONTINUE                                                 25560099
255700     ELSE                                                         25570099
255800         SET DP013-CICS-ABEND            TO TRUE                  25580099
255900         SET DP013-NO-ROLLBACK           TO TRUE                  25590099
256000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25600099
256100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25610099
256200                                         TO DP013-MESSAGE-TEXT(1) 25620099
256300         PERFORM DP013-0000-PROCESS-ABEND                         25630099
256400     END-IF.                                                      25640099
256500                                                                  25650099
256600 EJECT                                                            25660099
256700*----------------------------------------------------------------*25670099
256800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *25680099
256900*  SPECIFIC COMMAREA.                                            *25690099
257000*----------------------------------------------------------------*25700099
257100 5110-WRITE-ASC-LISTQ.                                            25710099
257200                                                                  25720099
257300     EXEC CICS                                                    25730099
257400         WRITEQ TS                                                25740099
257500             QUEUE (ASC-LIST-QUEUE-NAME)                          25750099
257600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25760099
257700             ITEM  (PV-BLOCK-NUMBER)                              25770099
257800             RESP  (PV-CICS-RESP)                                 25780099
257900     END-EXEC.                                                    25790099
258000                                                                  25800099
258100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25810099
258200         SET DP013-CICS-ABEND      TO TRUE                        25820099
258300         SET DP013-NO-ROLLBACK     TO TRUE                        25830099
258400         MOVE '5110-WRITE-ASC-LISTQ'                              25840099
258500                                   TO DP013-PARAGRAPH             25850099
258600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25860099
258700                                   TO DP013-MESSAGE-TEXT(1)       25870099
258800         PERFORM DP013-0000-PROCESS-ABEND                         25880099
258900     END-IF.                                                      25890099
259000                                                                  25900099
259100 EJECT                                                            25910099
259200*----------------------------------------------------------------*25920099
259300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25930099
259400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25940099
259500*----------------------------------------------------------------*25950099
259600 5200-FILL-SEL-QUEUE-RECORD.                                      25960099
259700                                                                  25970099
259800     PERFORM 6112-READ-LIST-QUEUE.                                25980099
259900                                                                  25990099
260000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26000099
260100         PERFORM                                                  26010099
260200         VARYING LQW-IDX                                          26020099
260300         FROM 1 BY 1                                              26030099
260400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26040099
260500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26050099
260600                                                                  26060099
260700             IF  LQW-SELECT (LQW-IDX)                             26070099
260800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26080099
260900                                     TO TR118-ITEM (TR118-IDX)    26090099
261000                 MOVE LQW-PO-RCVD-SEQ-NBR  (LQW-IDX)  TO          26100099
261100                                 TR118-PO-SEQ-NBR (TR118-IDX)     26110099
261200                                 TR117-PO-SEQ-NBR                 26120099
261300                 MOVE LQW-TYPE        (LQW-IDX)      TO           26130099
261400                               TR118-ORGN-SHPD-FR-TYP (TR118-IDX) 26140099
261500                                 TR117-ORGN-SHPD-FR-TYP           26150099
261600                 MOVE LQW-RCP-DT      (LQW-IDX)      TO           26160099
261700                                   TR118-DELY-DTE     (TR118-IDX) 26170099
261800                                   TR117-DELY-DTE                 26180099
261900                                                                  26190099
262000                 MOVE 'I'           TO TR118-ACTION-SW (TR118-IDX)26200099
262100                 SET TR118-IDX UP BY 1                            26210099
262200                 IF  TR118-IDX > TR118-MAX-ITEMS                  26220099
262300                     PERFORM 5205-WRITE-SEL-QUEUE                 26230099
262400                     ADD +1        TO TR117-NUMBER-OF-TS-ITEMS    26240099
262500                     INITIALIZE TR118-SELECTED-ITEM-ARRAY         26250099
262600                     SET TR118-IDX TO  1                          26260099
262700                 END-IF                                           26270099
262800             END-IF                                               26280099
262900         END-PERFORM                                              26290099
263000     END-IF.                                                      26300099
263100                                                                  26310099
263200 EJECT                                                            26320099
263300*----------------------------------------------------------------*26330099
263400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26340099
263500*----------------------------------------------------------------*26350099
263600 5205-WRITE-SEL-QUEUE.                                            26360099
263700                                                                  26370099
263800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26380099
263900                                   TO TR118-SELECTED-ITEMS.       26390099
264000                                                                  26400099
264100     EXEC CICS                                                    26410099
264200          WRITEQ TS                                               26420099
264300             QUEUE (ASC-SEL-QUEUE-NAME)                           26430099
264400             FROM  (TR118-PO-SELECT-RECORD)                       26440099
264500             ITEM  (PV-SEL-QUEUE-ITEM)                            26450099
264600             RESP  (PV-CICS-RESP)                                 26460099
264700     END-EXEC.                                                    26470099
264800                                                                  26480099
264900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26490099
265000         CONTINUE                                                 26500099
265100     ELSE                                                         26510099
265200         SET DP013-CICS-ABEND      TO TRUE                        26520099
265300         SET DP013-NO-ROLLBACK     TO TRUE                        26530099
265400         MOVE '5205-WRITE-SEL-QUEUE'                              26540099
265500                                   TO DP013-PARAGRAPH             26550099
265600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26560099
265700                                   TO DP013-MESSAGE-TEXT(1)       26570099
265800         PERFORM DP013-0000-PROCESS-ABEND                         26580099
265900     END-IF.                                                      26590099
266000                                                                  26600099
266100 EJECT                                                            26610099
266200*----------------------------------------------------------------*26620099
266300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *26630099
266400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *26640099
266500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *26650099
266600*  THE USER.                                                     *26660099
266700*----------------------------------------------------------------*26670099
266800 6000-REFRESH-PANEL-FROM-TEMP.                                    26680099
266900                                                                  26690099
267000     IF  ASC-UPDATE-TSQ                                           26700099
267100         SET ASC-NO-TSQ-UPDATE TO TRUE                            26710099
267200         MOVE ZERO                 TO PV-SAVE-ITEM                26720099
267300                                      PV-SEL-QUEUE-ITEM           26730099
267400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26740099
267500                                   TO PV-HOLD-SELECTED-ITEMS      26750099
267600         MOVE +1                   TO PV-ITEMS-PROCESSED          26760099
267700         PERFORM 6100-UPDATE-TSQ                                  26770099
267800             UNTIL PV-ITEMS-PROCESSED >                           26780099
267900                                     PV-HOLD-SELECTED-ITEMS       26790099
268000         PERFORM 6010-DELETE-SEL-QUEUE                            26800099
268100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26810099
268200                    ASC-BLOCK-ENTRIES (2)                         26820099
268300     END-IF.                                                      26830099
268400                                                                  26840099
268500 EJECT                                                            26850099
268600*----------------------------------------------------------------*26860099
268700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26870099
268800*----------------------------------------------------------------*26880099
268900 6010-DELETE-SEL-QUEUE.                                           26890099
269000                                                                  26900099
269100     EXEC CICS                                                    26910099
269200         DELETEQ TS                                               26920099
269300             QUEUE (ASC-SEL-QUEUE-NAME)                           26930099
269400             RESP  (PV-CICS-RESP)                                 26940099
269500     END-EXEC.                                                    26950099
269600*                                                                 26960099
269700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26970099
269800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26980099
269900         CONTINUE                                                 26990099
270000     ELSE                                                         27000099
270100         SET DP013-CICS-ABEND TO TRUE                             27010099
270200         SET DP013-NO-ROLLBACK TO TRUE                            27020099
270300         MOVE '6010-DELETE-SEL-QUEUE'                             27030099
270400                        TO DP013-PARAGRAPH                        27040099
270500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27050099
270600                        TO DP013-MESSAGE-TEXT (1)                 27060099
270700         PERFORM DP013-0000-PROCESS-ABEND                         27070099
270800     END-IF.                                                      27080099
270900                                                                  27090099
271000 EJECT                                                            27100099
271100*----------------------------------------------------------------*27110099
271200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27120099
271300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27130099
271400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27140099
271500*    THE TEMP QUEUE.                                             *27150099
271600*----------------------------------------------------------------*27160099
271700 6100-UPDATE-TSQ.                                                 27170099
271800                                                                  27180099
271900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27190099
272000     PERFORM 6105-READ-SEL-QUEUE.                                 27200099
272100     PERFORM                                                      27210099
272200         VARYING TR118-IDX                                        27220099
272300         FROM 1 BY 1                                              27230099
272400         UNTIL ((PV-ITEMS-PROCESSED >                             27240099
272500                              PV-HOLD-SELECTED-ITEMS)             27250099
272600         OR (TR118-IDX GREATER THAN TR118-MAX-ITEMS))             27260099
272700         IF  TR118-ACTION-SW (TR118-IDX) > SPACE                  27270099
272800             PERFORM 6110-PROCESS-ITEMS                           27280099
272900         END-IF                                                   27290099
273000         ADD +1                TO PV-ITEMS-PROCESSED              27300099
273100     END-PERFORM.                                                 27310099
273200     PERFORM 6111-WRITE-LIST-QUEUE.                               27320099
273300                                                                  27330099
273400 EJECT                                                            27340099
273500*----------------------------------------------------------------*27350099
273600*    READ THE LIST QUEUE RECORD.                                 *27360099
273700*----------------------------------------------------------------*27370099
273800 6105-READ-SEL-QUEUE.                                             27380099
273900                                                                  27390099
274000     EXEC CICS                                                    27400099
274100          READQ TS                                                27410099
274200             QUEUE (ASC-SEL-QUEUE-NAME)                           27420099
274300             INTO  (TR118-PO-SELECT-RECORD)                       27430099
274400             ITEM  (PV-SEL-QUEUE-ITEM)                            27440099
274500             RESP  (PV-CICS-RESP)                                 27450099
274600     END-EXEC.                                                    27460099
274700*                                                                 27470099
274800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27480099
274900         CONTINUE                                                 27490099
275000     ELSE                                                         27500099
275100         SET DP013-CICS-ABEND      TO  TRUE                       27510099
275200         SET DP013-NO-ROLLBACK     TO  TRUE                       27520099
275300         MOVE '6105-READ-SEL-QUEUE'                               27530099
275400                                   TO  DP013-PARAGRAPH            27540099
275500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27550099
275600                                   TO  DP013-MESSAGE-TEXT(1)      27560099
275700         PERFORM DP013-0000-PROCESS-ABEND                         27570099
275800     END-IF.                                                      27580099
275900                                                                  27590099
276000 EJECT                                                            27600099
276100*----------------------------------------------------------------*27610099
276200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27620099
276300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27630099
276400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27640099
276500*----------------------------------------------------------------*27650099
276600 6110-PROCESS-ITEMS.                                              27660099
276700                                                                  27670099
276800     COMPUTE PV-ITEM = 1 + ((TR118-ITEM (TR118-IDX) - 1)          27680099
276900                     / PC-ITEMS-PER-PANEL).                       27690099
277000                                                                  27700099
277100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27710099
277200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27720099
277300             PERFORM 6111-WRITE-LIST-QUEUE                        27730099
277400         END-IF                                                   27740099
277500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27750099
277600                                                                  27760099
277700         PERFORM 6112-READ-LIST-QUEUE                             27770099
277800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27780099
277900             CONTINUE                                             27790099
278000         END-IF                                                   27800099
278100     END-IF.                                                      27810099
278200                                                                  27820099
278300     COMPUTE PV-SUB = (TR118-ITEM (TR118-IDX)                     27830099
278400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27840099
278500     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        27850099
278600     MOVE LQW-SELECTED-SW (PV-SUB)                                27860099
278700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  27870099
278800                                                                  27880099
278900     IF TR118-INQ (TR118-IDX)                                     27890099
279000        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             27900099
279100     END-IF.                                                      27910099
279200                                                                  27920099
279300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27930099
279400                                                                  27940099
279500 EJECT                                                            27950099
279600*----------------------------------------------------------------*27960099
279700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27970099
279800*----------------------------------------------------------------*27980099
279900 6111-WRITE-LIST-QUEUE.                                           27990099
280000                                                                  28000099
280100     EXEC CICS                                                    28010099
280200         WRITEQ TS                                                28020099
280300             QUEUE (ASC-LIST-QUEUE-NAME)                          28030099
280400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28040099
280500             ITEM  (PV-SAVE-ITEM)                                 28050099
280600             REWRITE                                              28060099
280700             RESP  (PV-CICS-RESP)                                 28070099
280800     END-EXEC.                                                    28080099
280900*                                                                 28090099
281000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28100099
281100         CONTINUE                                                 28110099
281200     ELSE                                                         28120099
281300         SET DP013-CICS-ABEND  TO  TRUE                           28130099
281400         SET DP013-NO-ROLLBACK TO  TRUE                           28140099
281500         MOVE '6111-WRITE-LIST-QUEUE'                             28150099
281600                               TO  DP013-PARAGRAPH                28160099
281700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28170099
281800                               TO  DP013-MESSAGE-TEXT(1)          28180099
281900         PERFORM DP013-0000-PROCESS-ABEND                         28190099
282000     END-IF.                                                      28200099
282100                                                                  28210099
282200 EJECT                                                            28220099
282300*----------------------------------------------------------------*28230099
282400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28240099
282500*----------------------------------------------------------------*28250099
282600 6112-READ-LIST-QUEUE.                                            28260099
282700                                                                  28270099
282800     EXEC CICS                                                    28280099
282900         READQ TS                                                 28290099
283000             QUEUE (ASC-LIST-QUEUE-NAME)                          28300099
283100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28310099
283200             ITEM  (PV-ITEM)                                      28320099
283300             RESP  (PV-CICS-RESP)                                 28330099
283400     END-EXEC.                                                    28340099
283500*                                                                 28350099
283600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28360099
283700         CONTINUE                                                 28370099
283800     ELSE                                                         28380099
283900         SET DP013-CICS-ABEND        TO TRUE                      28390099
284000         SET DP013-NO-ROLLBACK       TO TRUE                      28400099
284100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28410099
284200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28420099
284300                                     TO DP013-MESSAGE-TEXT(1)     28430099
284400         PERFORM DP013-0000-PROCESS-ABEND                         28440099
284500     END-IF.                                                      28450099
284600                                                                  28460099
284700 EJECT                                                            28470099
284800*----------------------------------------------------------------*28480099
284900*    ABEND PROCESSOR MODULE                                      *28490099
285000*----------------------------------------------------------------*28500099
285100                                                                  28510099
285200     COPY DPPD013.                                                28520099
