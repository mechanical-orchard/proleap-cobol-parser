000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    POKCS101.                                         00030000
000400 AUTHOR.        DAVE COLOMBO - COMPUWARE.                         00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  05/27/99.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*---------------------------------------------------------------* 00090000
001000*    TRANID      - W101                                         * 00100000
001100*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2              * 00110000
001200*    DESCRIPTION - PURCHASE ORDER SET INQUIRY                   * 00120000
001300*    MAPSET      - POKM101                                      * 00130000
001400*                                                               * 00140000
001500*    THIS PROGRAM DISPLAY INFORMATION FOR A SET.                * 00150000
001600*                                                               * 00160000
001700*---------------------------------------------------------------* 00170000
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00171035
CICS  *                                                               * 00172034
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00173034
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00174034
      *---------------------------------------------------------------* 00175038
      *  CHANGED 03/24/2023    BY BOB MCASEY      WR: CHG0286952      * 00177038
      *                                                               * 00178038
      *  REMOVE POG REFERENCES                                        * 00179038
001700*---------------------------------------------------------------* 00179136
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 DATA DIVISION.                                                   00200000
002100                                                                  00210000
002200 WORKING-STORAGE SECTION.                                         00220000
002300                                                                  00230000
002400 01  DK-DB2-KEYS.                                                 00240000
002500     05  DK-SHORT-NME                 PIC X(05)  VALUE SPACES.    00250000
002600     05  DK-YEAR                      PIC X(04)  VALUE SPACES.    00260000
002700     05  DK-TYP-CDE                   PIC X(03)  VALUE SPACES.    00270000
002800                                                                  00280000
002900 01  PC-PROGRAM-CONSTANTS.                                        00290000
003000     05  PC-TRANS-ID                  PIC X(04)  VALUE 'W101'.    00300000
003100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'POKCS101'.00310000
003200     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'PO101A  '.00320000
003300     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'POKM101 '.00330000
003400     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00340000
003500                                                 COMP.            00350000
003600     05  PC-DEFAULT-DATE              PIC X(10)  VALUE            00360000
003700                                                 '9999-09-09'.    00370000
003800     05  PC-INTER-APPL-CODES.                                     00380000
003900         10  PC-INTER-APPL-CRIT       PIC X(01)  VALUE ' '.       00390000
004000         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '1'.       00400000
004100                                                                  00410000
004200     05  PC-TSYMSG-NUMBERS.                                       00420000
004300         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00430000
004400         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00440000
004500         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     00450000
004600                                                                  00460000
004700 01  PS-PROGRAM-SWITCHES.                                         00470000
004800     05  PS-COMMAREA-SW               PIC  X(01) VALUE 'N'.       00480000
004900         88  PS-COMMAREA-VALID                   VALUE 'Y'.       00490000
005000         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       00500000
005100     05  PS-LIST-END-SW               PIC X(01)  VALUE 'N'.       00510000
005200         88  PS-LIST-END                         VALUE 'Y'.       00520000
005300         88  PS-NO-LIST-END                      VALUE 'N'.       00530000
005400                                                                  00540000
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0         00560000
005700                                                 COMP SYNC.       00570000
005800     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00580000
005900                                                 COMP SYNC.       00590000
006000                                                                  00600000
006100     05  PV-9999-9                    PIC  9(04).                 00610000
006101     05  PV-9999-X REDEFINES PV-9999-9.                           00610100
006102         10  PV-9999-X-1-2            PIC  X(02).                 00610200
006103         10  PV-9999-X-3-4            PIC  X(02).                 00610300
006110                                                                  00611000
006120     05  PV-DB2-DATE                  PIC  X(10).                 00612000
006200     05  FILLER  REDEFINES PV-DB2-DATE.                           00620000
006300         10  PV-DB2-DATE-CC           PIC  X(02).                 00630000
006400         10  PV-DB2-DATE-YY           PIC  X(02).                 00640000
006500         10  FILLER                   PIC  X(01).                 00650000
006600         10  PV-DB2-DATE-MM           PIC  X(02).                 00660000
006700         10  FILLER                   PIC  X(01).                 00670000
006800         10  PV-DB2-DATE-DD           PIC  X(02).                 00680000
006900     05  PV-DISPLAY-DATE.                                         00690000
007000         10  PV-DISPLAY-DATE-MM       PIC  X(02).                 00700000
007100         10  FILLER                   PIC  X(01) VALUE '/'.       00710000
007200         10  PV-DISPLAY-DATE-DD       PIC  X(02).                 00720000
007300         10  FILLER                   PIC  X(01) VALUE '/'.       00730000
007400         10  PV-DISPLAY-DATE-YY       PIC  X(02).                 00740000
007500 EJECT                                                            00750000
007600*----------------------------------------------------------------*00760000
007700*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *00770000
007800*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *00780000
007900*----------------------------------------------------------------*00790000
008000                                                                  00800000
008100     COPY POWS077.                                                00810000
008200                                                                  00820000
008300 EJECT                                                            00830000
008400                                                                  00840000
008500*----------------------------------------------------------------*00850000
008600*    MAP LAYOUT                                                  *00860000
008700*----------------------------------------------------------------*00870000
008800                                                                  00880000
008900     COPY POKM101.                                                00890000
009000                                                                  00900000
009100 EJECT                                                            00910000
009200*----------------------------------------------------------------*00920000
009300*    ATTRIBUTE SETTINGS COPYBOOK.                                *00930000
009400*----------------------------------------------------------------*00940000
009500                                                                  00950000
009600     COPY DPWS015.                                                00960000
009700                                                                  00970000
009800 EJECT                                                            00980000
009900*----------------------------------------------------------------*00990000
010000*    FUNCTION KEYS COPYBOOK                                      *01000000
010100*----------------------------------------------------------------*01010000
010200                                                                  01020000
010300     COPY DPWS016.                                                01030000
010400                                                                  01040000
010500 EJECT                                                            01050000
010600*----------------------------------------------------------------*01060000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.           *01070034
010900*----------------------------------------------------------------*01090000
011000     COPY DPWS030.                                                01100000
CICS       COPY DPWS930.                                                01101034
011100                                                                  01110000
011200 EJECT                                                            01120000
011300*----------------------------------------------------------------*01130000
011400*    STANDARD COMMAREA.                                          *01140000
011500*----------------------------------------------------------------*01150000
011600                                                                  01160000
011700     COPY DPWS020.                                                01170000
011800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01180000
011900                                                                  01190000
012000*----------------------------------------------------------------*01200000
012100*    INTER-APPLICATION COMMAREA.                                 *01210000
012200*----------------------------------------------------------------*01220000
012300                                                                  01230000
012400         10  INTER-APPL-COMM-AREA PIC X(200).                     01240000
012500     COPY POWS078.                                                01250000
012600                                                                  01260000
012700*----------------------------------------------------------------*01270000
012800*    SPECIFIC COMMMAREA FOR POKCS101.                            *01280000
012900*----------------------------------------------------------------*01290000
013000         10  ASC-SPECIFIC-COMMAREA.                               01300000
013100             15  ASC-USE-SELECTION-QUEUE-IND                      01310000
013200                                           PIC X(01).             01320000
013300                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        01330000
013400             15  ASC-SEL-QUEUE-NAME        PIC X(08).             01340000
013500             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01350000
013600             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01360000
013700                                           PIC S9(09) COMP-3.     01370000
013800             15  ASC-SEL-SUB               PIC S9(04) COMP.       01380000
013900             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01390000
014000             15  ASC-KEY-FIELDS.                                  01400000
014100                 20  ASC-KEY-SHORT-NME      PIC X(05).            01410000
014200                 20  ASC-KEY-YEAR           PIC X(04).            01420000
014300             15  ASC-SCREEN-FIELDS.                               01430000
014400                 20  ASC-TYP-CDE            PIC X(03).            01440000
014410                 20  ASC-DIVERT-PFX         PIC X(02).            01441000
014500                 20  ASC-LONG-NME           PIC X(25).            01450000
014600                 20  ASC-STR-STUP-BEG-DTE   PIC X(08).            01460000
014700                 20  ASC-STR-STUP-END-DTE   PIC X(08).            01470000
014800                 20  ASC-STR-RLSE-BEG-DTE   PIC X(08).            01480000
014900                 20  ASC-STR-RLSE-END-DTE   PIC X(08).            01490000
015000                 20  ASC-LAST-UPD-USR-ID    PIC X(08).            01500000
015100                 20  ASC-LAST-UPD-TMST      PIC X(08).            01510000
015200                 20  ASC-TYP-CDE-DESC       PIC X(25).            01520000
015210                 20  ASC-FIXTURE-ID-USE    PIC X(01).             01521000
015220                 20  ASC-POG-SET-YEAR      PIC X(04).             01522000
015230                 20  ASC-POG-SET-YEAR-NUM REDEFINES               01523000
015240                        ASC-POG-SET-YEAR   PIC 9(04).             01524000
015250                 20  ASC-POG-SET-SHRT-NME  PIC X(05).             01525000
                       20  ASC-PO-RCPT-RPTG-IND  PIC X(01).             01526033
015300                                                                  01530000
015400 EJECT                                                            01540000
015500*----------------------------------------------------------------*01550000
015600*    ABEND PROCESSING COPYBOOK.                                  *01560000
015700*----------------------------------------------------------------*01570000
015800                                                                  01580000
015900     COPY DPWS013.                                                01590000
016000 EJECT                                                            01600000
016100******************************************************************01610000
016200*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           01620000
016300******************************************************************01630000
016400     COPY DPWS410.                                                01640000
016500                                                                  01650000
016600*----------------------------------------------------------------*01660000
016700*    SYSTEM MESSAGE COPYBOOK                                     *01670000
016800*----------------------------------------------------------------*01680000
016900                                                                  01690000
017000     COPY DPRD507I.                                               01700000
017100 EJECT                                                            01710000
017200                                                                  01720000
017300*----------------------------------------------------------------*01730000
017400*    DB2 SQL COMMUNICATION AREA                                   01740000
017500*----------------------------------------------------------------*01750000
017600     EXEC SQL                                                     01760000
017700          INCLUDE SQLCA                                           01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000 EJECT                                                            01800000
018100*----------------------------------------------------------------*01810000
018200*    DB2 DCLGEN FOR SEASONAL SET TABLE                            01820000
018300*----------------------------------------------------------------*01830000
018400     EXEC SQL                                                     01840000
018500          INCLUDE TSEASET                                         01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800 EJECT                                                            01880000
018900*----------------------------------------------------------------*01890000
019000*    DB2 DCLGEN FOR SEASONAL SET TYPE CODE TABLE                  01900000
019100*----------------------------------------------------------------*01910000
019200     EXEC SQL                                                     01920000
019300          INCLUDE TSSTYCD                                         01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019600 EJECT                                                            01960000
019700 LINKAGE SECTION.                                                 01970000
019800                                                                  01980000
019900 01  DFHCOMMAREA.                                                 01990000
020000     05  FILLER                       OCCURS  1 TO 4072 TIMES     02000000
020100                                      DEPENDING ON EIBCALEN.      02010000
020200         10  FILLER                   PIC X.                      02020000
020300                                                                  02030000
020400 EJECT                                                            02040000
020500 PROCEDURE DIVISION.                                              02050000
020600                                                                  02060000
020700*----------------------------------------------------------------*02070000
020800*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *02080000
020900*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *02090000
021000*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *02100000
021100*                                                                *02110000
021200*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *02120000
021300*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *02130000
021400*----------------------------------------------------------------*02140000
021500 0000-MAIN-MODULE.                                                02150000
021600                                                                  02160000
021700     INITIALIZE DP030-CICS-API-FIELDS.                            02170000
021800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02180000
021900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02190000
022000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02200000
022100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02210000
022200     MOVE LENGTH OF PO101AI        TO DP030-MAP-LENGTH (1).       02220000
022300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02230000
022400     PERFORM 0001-CALL-CICS-ARCH-API.                             02240000
022500                                                                  02250000
022600     PERFORM 1000-CONTROL-PROCESSING.                             02260000
022700                                                                  02270000
022800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02280000
022900     PERFORM 0001-CALL-CICS-ARCH-API.                             02290000
023000                                                                  02300000
023100 EJECT                                                            02310000
023200 0001-CALL-CICS-ARCH-API.                                         02320000
023300                                                                  02330000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02340034
023500                                    DFHCOMMAREA                   02350034
023600                                    DP030-CICS-API-FIELDS         02360034
023700                                    DP020-STANDARD-COMMAREA       02370034
023800                                    PO101AI.                      02380034
023900                                                                  02390000
024000     IF  DP030-RC-CALL-SUCCESSFUL                                 02400000
024100         CONTINUE                                                 02410000
024200     ELSE                                                         02420000
024300         SET DP013-NO-ROLLBACK                                    02430000
024400             DP013-XCTL-DISPLAY-RESTART                           02440000
024500             DP013-CICS-ABEND      TO TRUE                        02450000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           02460034
024700                                   TO DP013-PARAGRAPH             02470000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02480034
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02490034
025000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02500000
025100         PERFORM DP013-0000-PROCESS-ABEND                         02510000
025200     END-IF.                                                      02520000
025300                                                                  02530000
025400 EJECT                                                            02540000
025500*----------------------------------------------------------------*02550000
025600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02560000
025700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02570000
025800*----------------------------------------------------------------*02580000
025900                                                                  02590000
026000 1000-CONTROL-PROCESSING.                                         02600000
026100                                                                  02610000
026200     EVALUATE TRUE                                                02620000
026300         WHEN DP020-NEXT-ACT-INITIAL                              02630000
026400              PERFORM 1100-PROCESS-INTER-APPL-COMM                02640000
026500              IF  PS-COMMAREA-NOT-VALID                           02650000
026600                  CONTINUE                                        02660000
026700              ELSE                                                02670000
026800                  PERFORM 4000-BUILD-INITIAL-PANEL                02680000
026900              END-IF                                              02690000
027000                                                                  02700000
027100         WHEN DP020-NEXT-ACT-READ-MAP                             02710000
027200              PERFORM 2000-PROCESS-PANEL                          02720000
027300                                                                  02730000
027400         WHEN DP020-NEXT-ACT-RETURN                               02740000
027500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                02750000
027600                                                                  02760000
027700         WHEN OTHER                                               02770000
027800              SET DP013-LOGIC-ABEND                               02780000
027900                  DP013-NO-ROLLBACK TO TRUE                       02790000
028000              MOVE '1000-CONTROL-PROCESSING'                      02800000
028100                                    TO DP013-PARAGRAPH            02810000
028200              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  02820000
028300                                    TO DP013-MESSAGE-TEXT(1)      02830000
028400              MOVE DP020-NEXT-APPL-ACTIVITY                       02840000
028500                                    TO DP013-MESSAGE-TEXT(2)      02850000
028600              PERFORM DP013-0000-PROCESS-ABEND                    02860000
028700     END-EVALUATE.                                                02870000
028800                                                                  02880000
028900 EJECT                                                            02890000
029000*----------------------------------------------------------------*02900000
029100*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *02910000
029200*    INTER-APPLICATION FORMAT CODE.                              *02920000
029300*                                                                *02930000
029400*    PERFORM SPECIFIC VALIDATIONS FOR EACH "MODE" AND BASED      *02940000
029500*    ON WHERE THE PROGRAM WAS INITIATED FROM.                    *02950000
029600*----------------------------------------------------------------*02960000
029700 1100-PROCESS-INTER-APPL-COMM.                                    02970000
029800                                                                  02980000
029900     SET PS-COMMAREA-VALID            TO TRUE.                    02990000
030000                                                                  03000000
030100     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03010000
030200                                                                  03020000
030300     EVALUATE DP020-INT-APPL-FORMAT-IND                           03030000
030400                                                                  03040000
030500         WHEN PC-INTER-APPL-LIST                                  03050000
030600             SET ASC-USE-SELECTION-QUEUE                          03060000
030700                                 TO TRUE                          03070000
030800             MOVE PO078-NUMBER-OF-SELECTED-ITEMS                  03080000
030900                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  03090000
031000             MOVE PO078-NUMBER-OF-TS-ITEMS                        03100000
031100                                 TO ASC-NUMBER-OF-TS-ITEMS        03110000
031200             MOVE PO078-SEL-QUEUE-NAME                            03120000
031300                                 TO ASC-SEL-QUEUE-NAME            03130000
031400             PERFORM 1120-PREPARE-LIST-ENTRY                      03140000
031500                                                                  03150000
031600         WHEN OTHER                                               03160000
031700             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             03170000
031800             SET PS-COMMAREA-NOT-VALID                            03180000
031900                 DP020-MSG-FATAL                                  03190000
032000                 DP020-NEXT-ACT-APPL-ERROR                        03200000
032100                                 TO TRUE                          03210000
032200                                                                  03220000
032300     END-EVALUATE.                                                03230000
032400                                                                  03240000
032500 EJECT                                                            03250000
032600*----------------------------------------------------------------*03260000
032700*    ENTRY IS FROM A LIST.  GET THE PO NUMBER FROM THE           *03270000
032800*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *03280000
032900*----------------------------------------------------------------*03290000
033000 1120-PREPARE-LIST-ENTRY.                                         03300000
033100                                                                  03310000
033200     MOVE PO077-MAX-ITEMS          TO ASC-SEL-SUB.                03320000
033300     MOVE ZERO                     TO ASC-SEL-ITEM.               03330000
033400     PERFORM 2110-GET-NEXT-SET.                                   03340000
033500                                                                  03350000
033600 EJECT                                                            03360000
033700*----------------------------------------------------------------*03370000
033800*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*03380000
033900*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*03390000
034000*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *03400000
034100*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *03410000
034200*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *03420000
034300*----------------------------------------------------------------*03430000
034400                                                                  03440000
034500 2000-PROCESS-PANEL.                                              03450000
034600                                                                  03460000
034700     EVALUATE TRUE                                                03470000
034800                                                                  03480000
034900         WHEN DP020-SRC-AID = DP016-CLEAR                         03490000
035000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03500000
035100                                                                  03510000
035200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03520000
035300             INITIALIZE ASC-SCREEN-FIELDS                         03530000
035400             MOVE ASC-KEY-SHORT-NME                               03540000
035500                                   TO DK-SHORT-NME                03550000
035600             MOVE ASC-KEY-YEAR     TO DK-YEAR                     03560000
035700             PERFORM 4000-BUILD-INITIAL-PANEL                     03570000
035800                                                                  03580000
035900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03590000
036000             IF  ASC-USE-SELECTION-QUEUE                          03600000
036100                 PERFORM 2110-GET-NEXT-SET                        03610000
036200                 IF PS-LIST-END                                   03620000
036300                    SET PS-NO-LIST-END                            03630000
036400                                   TO TRUE                        03640000
036500                 ELSE                                             03650000
036600                    PERFORM 4000-BUILD-INITIAL-PANEL              03660000
036700                 END-IF                                           03670000
036800             ELSE                                                 03680000
036900*                --- BOTTOM OF LIST ---                           03690000
037000                 MOVE PC-TSYMSG-00070                             03700000
037100                                   TO DP020-MSG-NUMBER            03710000
037200                 SET DP020-MSG-INFORMATIONAL                      03720000
037300                     PS-LIST-END   TO TRUE                        03730000
037400             END-IF                                               03740000
037500                                                                  03750000
037600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03760000
037700             IF  ASC-USE-SELECTION-QUEUE                          03770000
037800                 PERFORM 2120-GET-PREV-SET                        03780000
037900                 IF PS-LIST-END                                   03790000
038000                    SET PS-NO-LIST-END                            03800000
038100                                   TO TRUE                        03810000
038200                 ELSE                                             03820000
038300                    PERFORM 4000-BUILD-INITIAL-PANEL              03830000
038400                 END-IF                                           03840000
038500             ELSE                                                 03850000
038600*                --- TOP OF LIST ---                              03860000
038700                 MOVE PC-TSYMSG-00069                             03870000
038800                                   TO DP020-MSG-NUMBER            03880000
038900                 SET DP020-MSG-INFORMATIONAL                      03890000
039000                     PS-LIST-END   TO TRUE                        03900000
039100             END-IF                                               03910000
039200                                                                  03920000
039300         WHEN OTHER                                               03930000
039400             PERFORM 2100-CHECK-FUNCTION-KEY                      03940000
039500     END-EVALUATE.                                                03950000
039600                                                                  03960000
039700 EJECT                                                            03970000
039800*----------------------------------------------------------------*03980000
039900*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *03990000
040000*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*04000000
040100*    FROM THE CICS ARCHITECTURE API.                             *04010000
040200*----------------------------------------------------------------*04020000
040300                                                                  04030000
040400 2100-CHECK-FUNCTION-KEY.                                         04040000
040500                                                                  04050000
040600     EVALUATE TRUE                                                04060000
040700         WHEN DP020-SRC-AID = DP016-ENTER                         04070000
040800             CONTINUE                                             04080000
040900                                                                  04090000
041000         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               04100000
041100             CONTINUE                                             04110000
041200                                                                  04120000
041300         WHEN OTHER                                               04130000
041400             SET DP013-NO-ROLLBACK                                04140000
041500                 DP013-XCTL-DISPLAY-RESTART                       04150000
041600                 DP013-CICS-ABEND  TO TRUE                        04160000
041700             MOVE '2100-CHECK-FUNCTION-KEY'                       04170000
041800                                   TO DP013-PARAGRAPH             04180000
041900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04190000
042000                                   TO DP013-MESSAGE-TEXT (1)      04200000
042100             PERFORM DP013-0000-PROCESS-ABEND                     04210000
042200     END-EVALUATE.                                                04220000
042300                                                                  04230000
042400 EJECT                                                            04240000
042500*----------------------------------------------------------------*04250000
042600*    GET THE PO NUMBER (KEY) OF THE NEXT SELECTED OBJECT         *04260000
042700*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *04270000
042800*----------------------------------------------------------------*04280000
042900 2110-GET-NEXT-SET.                                               04290000
043000                                                                  04300000
043100     ADD +1                        TO ASC-SEL-SUB.                04310000
043200     IF  ASC-SEL-SUB > PO077-MAX-ITEMS                            04320000
043300         ADD +1                    TO ASC-SEL-ITEM                04330000
043400         MOVE +1                   TO ASC-SEL-SUB                 04340000
043500     END-IF.                                                      04350000
043600                                                                  04360000
043700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04370000
043800         PERFORM 9100-READ-SEL-QUEUE                              04380000
043900         IF  PO077-ITEM (ASC-SEL-SUB) > ZERO                      04390000
044000             INITIALIZE ASC-SCREEN-FIELDS                         04400000
044100             MOVE PO077-SHORT-NME (ASC-SEL-SUB)                   04410000
044200                                   TO ASC-KEY-SHORT-NME           04420000
044300                                      DK-SHORT-NME                04430000
044400             MOVE PO077-YEAR (ASC-SEL-SUB)                        04440000
044500                                   TO ASC-KEY-YEAR                04450000
044600             SET PO077-INQ (ASC-SEL-SUB)                          04460000
044700                                   TO TRUE                        04470000
044800             PERFORM 9200-REWRITE-SEL-QUEUE                       04480000
044900         ELSE                                                     04490000
045000             SUBTRACT +1 FROM ASC-SEL-SUB                         04500000
045100*            --- BOTTOM OF LIST ---                               04510000
045200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04520000
045300             SET DP020-MSG-INFORMATIONAL                          04530000
045400                 PS-LIST-END                                      04540000
045500                                   TO TRUE                        04550000
045600         END-IF                                                   04560000
045700     ELSE                                                         04570000
045800         SUBTRACT +1 FROM ASC-SEL-ITEM                            04580000
045900         MOVE PO077-MAX-ITEMS      TO ASC-SEL-SUB                 04590000
046000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04600000
046100         SET DP020-MSG-INFORMATIONAL                              04610000
046200             PS-LIST-END                                          04620000
046300                                   TO TRUE                        04630000
046400     END-IF.                                                      04640000
046500                                                                  04650000
046600 EJECT                                                            04660000
046700*----------------------------------------------------------------*04670000
046800*    GET THE PO NUMBER (KEY) OF THE PREVIOUS SELECTED            *04680000
046900*    OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *04690000
047000*----------------------------------------------------------------*04700000
047100 2120-GET-PREV-SET.                                               04710000
047200                                                                  04720000
047300     SUBTRACT +1 FROM ASC-SEL-SUB.                                04730000
047400     IF  ASC-SEL-SUB < +1                                         04740000
047500         SUBTRACT +1 FROM ASC-SEL-ITEM                            04750000
047600         MOVE PO077-MAX-ITEMS      TO ASC-SEL-SUB                 04760000
047700     END-IF.                                                      04770000
047800                                                                  04780000
047900     IF  ASC-SEL-ITEM > ZERO                                      04790000
048000         PERFORM 9100-READ-SEL-QUEUE                              04800000
048100         INITIALIZE ASC-SCREEN-FIELDS                             04810000
048200         MOVE PO077-SHORT-NME (ASC-SEL-SUB)                       04820000
048300                                   TO ASC-KEY-SHORT-NME           04830000
048400                                      DK-SHORT-NME                04840000
048500         MOVE PO077-YEAR (ASC-SEL-SUB)                            04850000
048600                                   TO ASC-KEY-YEAR                04860000
048700     ELSE                                                         04870000
048800         MOVE +1                   TO ASC-SEL-ITEM                04880000
048900                                      ASC-SEL-SUB                 04890000
049000*        --- TOP OF LIST ---                                      04900000
049100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04910000
049200         SET DP020-MSG-INFORMATIONAL                              04920000
049300             PS-LIST-END           TO TRUE                        04930000
049400     END-IF.                                                      04940000
049500                                                                  04950000
049600 EJECT                                                            04960000
049700*----------------------------------------------------------------*04970000
049800*  THIS PARAGRAPH READS THE PO TABLES AND BUILDS THE SCREEN      *04980000
049900*----------------------------------------------------------------*04990000
050000                                                                  05000000
050100 4000-BUILD-INITIAL-PANEL.                                        05010000
050200                                                                  05020000
050300     SET DP030-SET-CURSOR-TRAILER                                 05030000
050400                                 TO TRUE.                         05040000
050500                                                                  05050000
050600     MOVE ASC-KEY-SHORT-NME      TO DK-SHORT-NME                  05060000
050700     MOVE ASC-KEY-YEAR           TO DK-YEAR                       05070000
050800                                                                  05080000
050900     PERFORM 4100-GET-PO-SET-INFO.                                05090000
051000                                                                  05100000
051100     IF  SQLCODE = +100                                           05110000
051200         MOVE PC-TSYMSG-00148     TO DP020-MSG-NUMBER             05120000
051300         SET DP020-MSG-INFORMATIONAL TO TRUE                      05130000
051400     ELSE                                                         05140000
051500         PERFORM 4200-GET-TYPE-CODE-DESC                          05150000
051600     END-IF.                                                      05160000
051700                                                                  05170000
051800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        05180000
051900                                                                  05190000
052000 EJECT                                                            05200000
052100*----------------------------------------------------------------*05210000
052200*    GET THE PURCHASE ORDER SET INFORMATION                      *05220000
052300*----------------------------------------------------------------*05230000
052400 4100-GET-PO-SET-INFO.                                            05240000
052500                                                                  05250000
052510     INITIALIZE DCLTSEASET.                                       05251028
052520                                                                  05252028
052600     PERFORM                                                      05260000
052700         WITH TEST AFTER                                          05270000
052800         VARYING PV-RETRY-COUNTER                                 05280000
052900         FROM 1 BY 1                                              05290000
053000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05300000
053100             OR (SQLCODE = +0)                                    05310000
053200             OR (SQLCODE = +100))                                 05320000
053300                                                                  05330000
053400         EXEC SQL                                                 05340000
053500              SELECT A.SEASET_YR                                  05350000
053600                    ,A.SEASET_SHRT_NM                             05360000
053700                    ,A.SEASET_TYP_CDE                             05370000
053800                    ,A.SEASET_NM                                  05380000
053900                    ,A.STR_STUP_BEG_DTE                           05390000
054000                    ,A.STR_STUP_END_DTE                           05400000
054100                    ,A.STR_RLSE_BEG_DTE                           05410000
054200                    ,A.STR_RLSE_END_DTE                           05420000
054300                    ,A.LAST_UPD_BY_USR_ID                         05430000
054400                    ,A.LAST_UPD_TMST                              05440000
054410                    ,A.DIVERT_PFX_NBR                             05441000
                          ,A.PO_RCPT_RPTG_IND                           05445033
054500                INTO :SEASET-SEASET-YR                            05450000
054600                    ,:SEASET-SEASET-SHRT-NM                       05460000
054700                    ,:SEASET-SEASET-TYP-CDE                       05470000
054800                    ,:SEASET-SEASET-NM                            05480000
054900                    ,:SEASET-STR-STUP-BEG-DTE                     05490000
055000                    ,:SEASET-STR-STUP-END-DTE                     05500000
055100                    ,:SEASET-STR-RLSE-BEG-DTE                     05510000
055200                    ,:SEASET-STR-RLSE-END-DTE                     05520000
055300                    ,:SEASET-LAST-UPD-BY-USR-ID                   05530000
055400                    ,:SEASET-LAST-UPD-TMST                        05540000
055410                    ,:SEASET-DIVERT-PFX-NBR                       05541000
                          ,:SEASET-PO-RCPT-RPTG-IND                     05545033
055500                FROM TSEASET A                                    05550000
055600               WHERE A.SEASET_YR        = :DK-YEAR                05560000
055700                 AND A.SEASET_SHRT_NM   = :DK-SHORT-NME           05570000
055800                 AND A.SEASET_STAT_CDE  = 'A'                     05580000
055900         END-EXEC                                                 05590000
056000                                                                  05600000
056100         EVALUATE TRUE                                            05610000
056200             WHEN SQLCODE = +0                                    05620000
056300                 MOVE SEASET-SEASET-TYP-CDE                       05630000
056400                                 TO ASC-TYP-CDE                   05640000
056410                 MOVE SEASET-DIVERT-PFX-NBR                       05641000
056420                                 TO PV-9999-9                     05642000
056430                 MOVE PV-9999-X-3-4                               05643000
056440                                 TO ASC-DIVERT-PFX                05644000
056500                 MOVE SEASET-SEASET-NM                            05650000
056600                                 TO ASC-LONG-NME                  05660000
056700                 IF SEASET-STR-STUP-BEG-DTE = PC-DEFAULT-DATE     05670000
056800                     MOVE SPACES TO ASC-STR-STUP-BEG-DTE          05680000
056900                 ELSE                                             05690000
057000                     MOVE SEASET-STR-STUP-BEG-DTE                 05700000
057100                                 TO PV-DB2-DATE                   05710000
057200                     MOVE PV-DB2-DATE-MM                          05720000
057300                                 TO PV-DISPLAY-DATE-MM            05730000
057400                     MOVE PV-DB2-DATE-DD                          05740000
057500                                 TO PV-DISPLAY-DATE-DD            05750000
057600                     MOVE PV-DB2-DATE-YY                          05760000
057700                                 TO PV-DISPLAY-DATE-YY            05770000
057800                     MOVE PV-DISPLAY-DATE                         05780000
057900                                 TO ASC-STR-STUP-BEG-DTE          05790000
058000                 END-IF                                           05800000
058100                 IF SEASET-STR-STUP-END-DTE = PC-DEFAULT-DATE     05810000
058200                     MOVE SPACES TO ASC-STR-STUP-END-DTE          05820000
058300                 ELSE                                             05830000
058400                     MOVE SEASET-STR-STUP-END-DTE                 05840000
058500                                 TO PV-DB2-DATE                   05850000
058600                     MOVE PV-DB2-DATE-MM                          05860000
058700                                 TO PV-DISPLAY-DATE-MM            05870000
058800                     MOVE PV-DB2-DATE-DD                          05880000
058900                                 TO PV-DISPLAY-DATE-DD            05890000
059000                     MOVE PV-DB2-DATE-YY                          05900000
059100                                 TO PV-DISPLAY-DATE-YY            05910000
059200                     MOVE PV-DISPLAY-DATE                         05920000
059300                                 TO ASC-STR-STUP-END-DTE          05930000
059400                 END-IF                                           05940000
059500                 IF SEASET-STR-RLSE-BEG-DTE = PC-DEFAULT-DATE     05950000
059600                     MOVE SPACES TO ASC-STR-RLSE-BEG-DTE          05960000
059700                 ELSE                                             05970000
059800                     MOVE SEASET-STR-RLSE-BEG-DTE                 05980000
059900                                 TO PV-DB2-DATE                   05990000
060000                     MOVE PV-DB2-DATE-MM                          06000000
060100                                 TO PV-DISPLAY-DATE-MM            06010000
060200                     MOVE PV-DB2-DATE-DD                          06020000
060300                                 TO PV-DISPLAY-DATE-DD            06030000
060400                     MOVE PV-DB2-DATE-YY                          06040000
060500                                 TO PV-DISPLAY-DATE-YY            06050000
060600                     MOVE PV-DISPLAY-DATE                         06060000
060700                                 TO ASC-STR-RLSE-BEG-DTE          06070000
060800                 END-IF                                           06080000
060900                 IF SEASET-STR-RLSE-END-DTE = PC-DEFAULT-DATE     06090000
061000                     MOVE SPACES TO ASC-STR-RLSE-END-DTE          06100000
061100                 ELSE                                             06110000
061200                     MOVE SEASET-STR-RLSE-END-DTE                 06120000
061300                                 TO PV-DB2-DATE                   06130000
061400                     MOVE PV-DB2-DATE-MM                          06140000
061500                                 TO PV-DISPLAY-DATE-MM            06150000
061600                     MOVE PV-DB2-DATE-DD                          06160000
061700                                 TO PV-DISPLAY-DATE-DD            06170000
061800                     MOVE PV-DB2-DATE-YY                          06180000
061900                                 TO PV-DISPLAY-DATE-YY            06190000
062000                     MOVE PV-DISPLAY-DATE                         06200000
062100                                 TO ASC-STR-RLSE-END-DTE          06210000
062200                 END-IF                                           06220000
062300                 MOVE SEASET-LAST-UPD-BY-USR-ID                   06230000
062400                                 TO ASC-LAST-UPD-USR-ID           06240000
062500                 MOVE SEASET-LAST-UPD-TMST                        06250000
062600                                 TO PV-DB2-DATE                   06260000
062700                 MOVE PV-DB2-DATE-MM                              06270000
062800                                 TO PV-DISPLAY-DATE-MM            06280000
062900                 MOVE PV-DB2-DATE-DD                              06290000
063000                                 TO PV-DISPLAY-DATE-DD            06300000
063100                 MOVE PV-DB2-DATE-YY                              06310000
063200                                 TO PV-DISPLAY-DATE-YY            06320000
063300                 MOVE PV-DISPLAY-DATE                             06330000
063400                                 TO ASC-LAST-UPD-TMST             06340000
                       MOVE SEASET-PO-RCPT-RPTG-IND                     06346133
                                           TO ASC-PO-RCPT-RPTG-IND      06346233
063470*                                                                 06347000
063500             WHEN SQLCODE = +100                                  06350000
063600             WHEN SQLCODE = -904                                  06360000
063700             WHEN SQLCODE = -913                                  06370000
063800                  CONTINUE                                        06380000
063900                                                                  06390000
064000             WHEN SQLWARN0 NOT = SPACES                           06400000
064100             WHEN SQLCODE < +0                                    06410000
064200             WHEN SQLCODE > +0                                    06420000
064300                  MOVE '4100-GET-PO-SET-INFO'                     06430000
064400                                  TO DP013-PARAGRAPH              06440000
064500                  MOVE 'UNSUCCESSFUL SELECT PO SET'               06450000
064600                                  TO DP013-MESSAGE-TEXT (1)       06460000
064700                  MOVE SQLCA      TO DP013-SQLCA                  06470000
064800                  MOVE 'TSEASET ' TO DP013-DB2-TABLE-NAME (1)     06480000
064900                  SET DP013-DB2-ABEND                             06490000
065000                      DP013-XCTL-DISPLAY-RESTART                  06500000
065100                                  TO TRUE                         06510000
065200                  PERFORM DP013-0000-PROCESS-ABEND                06520000
065300         END-EVALUATE                                             06530000
065400     END-PERFORM.                                                 06540000
065500                                                                  06550000
065600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06560000
065700         MOVE '4100-GET-PO-SET-INFO'                              06570000
065800                                  TO DP013-PARAGRAPH              06580000
065900         MOVE 'MAX RETRIES EXCEEDED ON SELECT PO SET'             06590000
066000                                  TO DP013-MESSAGE-TEXT (1)       06600000
066100         MOVE SQLCA               TO DP013-SQLCA                  06610000
066200         MOVE 'TSEASET '          TO DP013-DB2-TABLE-NAME (1)     06620000
066300         SET DP013-DB2-ABEND                                      06630000
066400             DP013-XCTL-DISPLAY-RESTART                           06640000
066500                                  TO TRUE                         06650000
066600         PERFORM DP013-0000-PROCESS-ABEND                         06660000
066700     END-IF.                                                      06670000
066800                                                                  06680000
066900 EJECT                                                            06690000
067000*----------------------------------------------------------------*06700000
067100* SELECT THE TYPE CODE DESC FROM TSSTYCD.                        *06710000
067200*----------------------------------------------------------------*06720000
067300 4200-GET-TYPE-CODE-DESC.                                         06730000
067400                                                                  06740000
067500     MOVE ASC-TYP-CDE         TO DK-TYP-CDE.                      06750000
067600                                                                  06760000
067700     PERFORM                                                      06770000
067800         WITH TEST AFTER                                          06780000
067900         VARYING PV-RETRY-COUNTER                                 06790000
068000         FROM 1 BY 1                                              06800000
068100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06810000
068200                   OR (SQLCODE = ZERO)                            06820000
068300                   OR (SQLCODE = +100))                           06830000
068400                                                                  06840000
068500         EXEC SQL                                                 06850000
068600           SELECT B.SEASET_TYP_DESC                               06860000
068700             INTO  :SSTYCD-SEASET-TYP-DESC                        06870000
068800             FROM   TSSTYCD B                                     06880000
068900             WHERE B.SEASET_TYP_CDE  = :DK-TYP-CDE                06890000
069000         END-EXEC                                                 06900000
069100                                                                  06910000
069200         EVALUATE TRUE                                            06920000
069300             WHEN SQLCODE = ZERO                                  06930000
069400                 MOVE SSTYCD-SEASET-TYP-DESC  TO ASC-TYP-CDE-DESC 06940000
069500             WHEN SQLCODE = +100                                  06950000
069600                 MOVE SPACES                  TO ASC-TYP-CDE-DESC 06960000
069700                                                                  06970000
069800             WHEN SQLCODE = -904                                  06980000
069900             WHEN SQLCODE = -913                                  06990000
070000                 CONTINUE                                         07000000
070100             WHEN SQLWARN0 NOT = SPACES                           07010000
070200             WHEN SQLCODE < ZERO                                  07020000
070300             WHEN SQLCODE > ZERO                                  07030000
070400                 MOVE '4200-GET-TYPE-CODE-DESC'                   07040000
070500                                   TO DP013-PARAGRAPH             07050000
070600                 MOVE 'SELECT PO-SET TYPE DESC'                   07060000
070700                                   TO DP013-MESSAGE-TEXT (1)      07070000
070800                 MOVE SQLCA        TO DP013-SQLCA                 07080000
070900                 MOVE 'TSSTYCD'    TO DP013-DB2-TABLE-NAME (1)    07090000
071000                 SET DP013-DB2-ABEND                              07100000
071100                     DP013-XCTL-DISPLAY-RESTART                   07110000
071200                                   TO TRUE                        07120000
071300                 PERFORM DP013-0000-PROCESS-ABEND                 07130000
071400         END-EVALUATE                                             07140000
071500     END-PERFORM.                                                 07150000
071600                                                                  07160000
071700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07170000
071800         MOVE '4200-GET-TYPE-CODE-DESC'                           07180000
071900                                   TO DP013-PARAGRAPH             07190000
072000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     07200000
072100                                   TO DP013-MESSAGE-TEXT (1)      07210000
072200         MOVE 'PO SET TYPE CODE DESC'                             07220000
072300                                   TO DP013-MESSAGE-TEXT (2)      07230000
072400         MOVE SQLCA                TO DP013-SQLCA                 07240000
072500         MOVE 'TSSTYCD'            TO DP013-DB2-TABLE-NAME (1)    07250000
072600         SET DP013-DB2-ABEND                                      07260000
072700             DP013-XCTL-DISPLAY-RESTART                           07270000
072800                                   TO TRUE                        07280000
072900         PERFORM DP013-0000-PROCESS-ABEND                         07290000
073000     END-IF.                                                      07300000
073100                                                                  07310000
073200 EJECT                                                            07320000
073300*----------------------------------------------------------------*07330000
073400*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *07340000
073500*----------------------------------------------------------------*07350000
073600 4400-MOVE-COMMAREA-TO-SCREEN.                                    07360000
073700                                                                  07370000
073910     MOVE ASC-KEY-SHORT-NME      TO ASHRTNMO.                     07391029
073920     MOVE ASC-KEY-YEAR           TO AYEARO.                       07392029
074000     MOVE ASC-TYP-CDE            TO ASETTYPO.                     07400000
074010     MOVE ASC-DIVERT-PFX         TO ADIVERTO.                     07401000
074100     MOVE ASC-LONG-NME           TO ALONGNMO.                     07410000
074200     MOVE ASC-TYP-CDE-DESC       TO ATYPDSCO.                     07420000
074300     MOVE ASC-LAST-UPD-TMST      TO AUPDTO.                       07430000
074400     MOVE ASC-LAST-UPD-USR-ID    TO AUPDTBYO.                     07440000
074500     MOVE ASC-STR-STUP-BEG-DTE   TO ASBEGDTO.                     07450000
074600     MOVE ASC-STR-STUP-END-DTE   TO ASENDDTO.                     07460000
074700     MOVE ASC-STR-RLSE-BEG-DTE   TO ARBEGDTO.                     07470000
074800     MOVE ASC-STR-RLSE-END-DTE   TO ARENDDTO.                     07480000
074801                                                                  07480100
074900                                                                  07490000
           MOVE ASC-PO-RCPT-RPTG-IND   TO ARPTINDO.                     07500033
075010 EJECT                                                            07501000
075100*----------------------------------------------------------------*07510000
075200*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *07520000
075300*----------------------------------------------------------------*07530000
075400                                                                  07540000
075500 9100-READ-SEL-QUEUE.                                             07550000
075600     EXEC CICS                                                    07560000
075700         READQ TS                                                 07570000
075800             QUEUE (ASC-SEL-QUEUE-NAME)                           07580000
075900             INTO  (PO077-SET-SEL-REC)                            07590000
076000             ITEM  (ASC-SEL-ITEM)                                 07600000
076100             RESP  (PV-CICS-RESPONSE)                             07610000
076200     END-EXEC.                                                    07620000
076300                                                                  07630000
076400     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   07640000
076500         CONTINUE                                                 07650000
076600     ELSE                                                         07660000
076700         SET DP013-LOGIC-ABEND                                    07670000
076800             DP013-NO-ROLLBACK     TO TRUE                        07680000
076900         MOVE '9100-READ-SEL-QUEUE'                               07690000
077000                                   TO DP013-PARAGRAPH             07700000
077100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   07710000
077200                                   TO DP013-MESSAGE-TEXT (1)      07720000
077300         PERFORM DP013-0000-PROCESS-ABEND                         07730000
077400     END-IF.                                                      07740000
077500                                                                  07750000
077600 EJECT                                                            07760000
077700*----------------------------------------------------------------*07770000
077800*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *07780000
077900*----------------------------------------------------------------*07790000
078000 9200-REWRITE-SEL-QUEUE.                                          07800000
078100     EXEC CICS                                                    07810000
078200          WRITEQ TS                                               07820000
078300              QUEUE  (ASC-SEL-QUEUE-NAME)                         07830000
078400              FROM   (PO077-SET-SEL-REC)                          07840000
078500              ITEM   (ASC-SEL-ITEM)                               07850000
078600              RESP   (PV-CICS-RESPONSE)                           07860000
078700              REWRITE                                             07870000
078800     END-EXEC.                                                    07880000
078900                                                                  07890000
079000     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               07900000
079100         SET DP013-CICS-ABEND                                     07910000
079200             DP013-NO-ROLLBACK     TO TRUE                        07920000
079300         MOVE '9200-REWRITE-SEL-QUEUE'                            07930000
079400                                   TO DP013-PARAGRAPH             07940000
079500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   07950000
079600                                   TO DP013-MESSAGE-TEXT (1)      07960000
079700         PERFORM DP013-0000-PROCESS-ABEND                         07970000
079800     END-IF.                                                      07980000
079900                                                                  07990000
080000 EJECT                                                            08000000
080100*----------------------------------------------------------------*08010000
080200*    ABEND PROCESSOR MODULE                                      *08020000
080300*----------------------------------------------------------------*08030000
080400                                                                  08040000
080500     COPY DPPD013.                                                08050000
