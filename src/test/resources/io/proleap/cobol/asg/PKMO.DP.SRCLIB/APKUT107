000100*-----------------------*                                         00010008
000200 IDENTIFICATION DIVISION.                                         00020008
000300*-----------------------*                                         00030008
000400 PROGRAM-ID.    APKUT107.                                         00040008
000500 AUTHOR.        PAUL KEBER - STRATAGEM.                           00050008
000600 DATE-WRITTEN.  NOVEMBER, 1995.                                   00060008
000700                                                                  00070008
000800*---------------------------------------------------------------* 00080008
000900*                                                               * 00090008
001000*    COBOL II WITH SQL                                          * 00100008
001100*                                                               * 00110008
001200*         --- UNJOURNALIZED RECEIPT PO DETAILS EXTRACT ---      * 00120008
001300*                                                               * 00130008
001400* DB2 TABLES:                                                   * 00140008
001500*  1. PURCHASE ORDER                   (TPURCHS)                * 00150008
001600*  2. RECEIVER                         (TRECEIV)                * 00160008
001700*  3. PURCHASE ORDER ITEM              (TPURITM)                * 00170008
001800*  4. RECEIPT DISTRIBUTION             (TRECDIS)                * 00180008
001900*  5. RECEIPT ITEM                     (TRECITM)                * 00190008
002000*  6. EXTERNAL ENTERPRISE NAME         (TENTNME)                * 00200008
002100*  7. EXTERNAL ENTERPRISE              (TEXTENT)                * 00210008
002200*  8. INVOICE TABLE                    (TINVOIC)                * 00220014
002300*                                                               * 00230008
002400* INPUT:                                                        * 00240008
002500*  1. UNJRNLZD-RECEIPT-PO-FILE         (APRD106)                * 00250008
002600*                                                               * 00260008
002700* OUTPUT:                                                       * 00270008
002800*  1. UNJRNLZD-RECEIPT-DATA-FILE       (APRD107)                * 00280008
002900*                                                               * 00290008
003000*---------------------------------------------------------------* 00300008
003100 EJECT                                                            00310008
003200*---------------------------------------------------------------* 00320008
003300*                                                               * 00330008
003400*    THIS PROGRAM CREATES THE UNJOURNALIZED RECEIPT DATA EXTRACT* 00340008
003500*    FILE WHICH WILL CONTAIN ALL INFORMATION NEEDED TO CREATE   * 00350008
003600*    THE UNJOURNALIZED RECEIPT ANALYSIS REPORT.                 * 00360008
003700*                                                               * 00370008
003800*    OUTPUT FILE REPORT DATA IS OBTAINED FROM DB2 TABLES.       * 00380008
003900*                                                               * 00390008
004000*---------------------------------------------------------------* 00400008
004100*************************************************************     00410008
004200*   CHANGES:                                                      00420008
004300*                                                                 00430008
004400*   11/12/96 CHANGES FOR AUTOMATIC WRITE OFF UNJOURNALIZED        00440008
004500*            RECEIPTS AND NIR                                     00450008
004600*            - CHANGE LOGIC TO HANDLE WRITE-OFF-  IF PROCESS CODE 00460008
004700*              IS 'J' OR 'W' DO NOT ADD COST TO UNJORNALIZED COST.00470008
004800*            - CHANGED ++INCLUDE TO COPY                          00480008
004900*   BY: PDVOLK                                          WR 3803   00490008
005000*                                                                 00500008
005100*   11/15/02 ADDED OTB_PER_NBR TO THE SELECT FROM TPURCHS IN PARA 00510008
005200*            R200-GET-PO-DATA.  THIS WILL BE MOVED TO THE APRD107 00520008
005300*            OUTPUT RECORD.                                       00530008
005400*   BY: MIKE BESKE                                      WR 24091  00540008
005500*                                                                 00550008
005600* 02/07/2003                                                      00560008
005700*    CHANGE MADE: ARKPO PHASE3 PROJECT.                           00570008
005800*    UPDATED PGM TITLE TO MATCH THE SPEC TITLE.                   00580008
005900*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES.                00590008
006000*    CHANGED -PURCHASE-ORDER TO -PO-NBR FOR THE COPYBOOK          00600008
006100*    FIELD NAME.                                                  00610008
006200* MADE BY:  MIKE BESKE                          WR#: 23500        00620008
006300*                                                                 00630008
006400* 08/11/2003                                                      00640008
006500*    CHANGE MADE: ADDED DISPLAY OF PO NUMBER BEING PROCESSED      00650008
006600*    TO THE ABEND PARAGRAPH.                                      00660008
006700* MADE BY:  NANCY EILBES                        IR#: P00573936    00670008
006800*                                                                 00680008
006900* 08/12/2003                                                      00690008
007000*    CHANGE MADE: REMOVED RETRY LOGIC ON THE FETCH OF THE         00700008
007100*    RECEIV_CSR IN PARAGRAPH R400-FETCH-RECEIV.  THE RETRY        00710008
007200*    LOGIC WAS MAKING A 'RESOURCE UNAVAILABLE' APPEAR AS A        00720008
007300*    -501 (CURSOR NOT OPEN), WHICH WAS MISLEADING WHEN LOOKING    00730008
007400*    INTO THE ABEND.                                              00740008
007500* MADE BY:  NANCY EILBES                        IR#: P00573936    00750008
007600*                                                                 00760008
007700* 02/18/2005                                                      00770008
007800*     CHANGE MADE: ADDED NEW_STR_PO_IND TO THE SELECT FROM        00780008
007900*     TPURCHS IN PARAGRAPH R200-GET-PO-DATA FOR PURPOSES OF       00790008
008000*     INCLUDING THE DATA ON REPORTS APK33505, APK33520, AND       00800008
008100*     APK33525.  ALSO ADDED FIELD AP107-NEW-STR-PO-IND TO THE     00810008
008200*     COPYBOOK APRD107.                                           00820008
008300* MADE BY: KRYSTEN LEARY                        WR#: WR27573      00830008
008400*                                                                 00840008
008500* 10/28/2005                                                      00850008
008600*    CHANGE MADE:                                                 00860008
008700*                                                                 00870008
008800*       CREATED NEW PARAGRAPH R500-PO-TOT-GROSS-COST              00880008
008900*       TO EXTRACT THE PO SUM OF TOTAL GROSS COST FROM THE        00890008
009000*       TINVOIC TABLE.  THE RECORDS SELECTED MUST HAVE AN         00900008
009100*       INVOICE TYPE CODE = 'MI', AND MUST NOT HAVE A STATUS      00910008
009200*       CODE = 'DE', WHICH MEANS DELETED.                         00920008
009300*                                                                 00930008
009400*       MODIFIED C100-GET-DATA-REC-INFO TO EXECUTE                00940008
009500*       R500-PO-TOT-GROSS-COST                                    00950008
009600*                                                                 00960008
009700*       INCREASED SIZE OF UNJRNLZD-RECEIPT-DATA-FILE TO 95        00970008
009800*       CHARACTERS TO ALLOW FOR THE TOTAL GROSS COST              00980008
009900*       FROM THE TINVOIC TABLE.THIS OUTPUT FILE IS DEFINED        00990008
010000*       BY APRD107.                                               01000008
010100*                                                                 01010008
010200* MADE BY: MICHELE RINDFLEISCH                  WR#: 28546        01020008
010300*                                                                 01030008
010400* 02/04/2008                                                      01040010
010500*     USE FIRST COST FOR DOMESTIC PURCHASE ORDERS.                01050008
010600* MADE BY: CHRISTINE TWIEHAUS                   WR#: WR32664      01060008
010700*                                                                 01070008
010800* DATE  04/23/2008                                                01080011
010900*     CHANGE MADE: ADDED A NEW PARAGRAPH IN ORDER TO              01090011
011000*     PERFORM A COMMIT AFTER EACH SUCCESSFUL EXECUTION OF THE     01100011
011100*     SQL IN R500-PO-TOT-GROSS-COST.  THIS WAS DONE AT THE        01110011
011200*     SUGGESTION OF BRAD DORN SO THAT THIS PROGRAM WOULD FREE UP  01120011
011300*     ANY LOCKS IT HAS ON DATA FOUND IN TINVOIC WHILE IT IS ACTIVE01130011
011400*     THIS STOPS THE REORG JOB DBK221 FROM ABENDING DUE TO THESE  01140011
011500*     LOCKS WHILE THIS PROGRAM AND THE JOB RUN AT THE SAME TIME.  01150011
011600*     MADE BY: MIKE BESKE              WR/IR #: WR34276           01160011
P46749*                                                                 01170022
P46749* DATE  08/19/2014                                                01180022
P46749*     CHANGE MADE: CHANGE MADE FOR SQL TUNING TO THE CURSOR       01190022
P46749*     RECEIV_CSR.                                                 01200022
P46749*     MADE BY: COGNIZANT (JAVED)       WR/IR #: CHG0089792        01210024
011700*************************************************************     01220011
011800 EJECT                                                            01230011
011900                                                                  01240011
012000 ENVIRONMENT DIVISION.                                            01250011
012100 CONFIGURATION SECTION.                                           01260011
012200 SOURCE-COMPUTER. IBM-3090.                                       01270011
012300 OBJECT-COMPUTER. IBM-3090.                                       01280011
012400                                                                  01290011
012500*                                                                 01300011
012600 INPUT-OUTPUT SECTION.                                            01310011
012700 FILE-CONTROL.                                                    01320011
012800*                                                                 01330011
012900     SELECT UNJRNLZD-RECEIPT-PO-FILE    ASSIGN TO UT-S-INP01.     01340011
013000     SELECT UNJRNLZD-RECEIPT-DATA-FILE  ASSIGN TO UT-S-OUT01.     01350011
013100*                                                                 01360011
013200 DATA DIVISION.                                                   01370011
013300 FILE SECTION.                                                    01380011
013400*                                                                 01390011
013500*                                                                 01400011
013600 FD  UNJRNLZD-RECEIPT-PO-FILE                                     01410011
013700     RECORDING MODE IS F                                          01420011
013800     BLOCK CONTAINS 0 CHARACTERS                                  01430011
013900     LABEL RECORDS ARE STANDARD                                   01440011
014000     DATA RECORD IS UNJRNLZD-RECEIPT-PO-RECORD.                   01450011
014100*                                                                 01460011
014200 01  UNJRNLZD-RECEIPT-PO-RECORD PIC X(20).                        01470011
014300*                                                                 01480011
014400*                                                                 01490011
014500 FD  UNJRNLZD-RECEIPT-DATA-FILE                                   01500011
014600     RECORDING MODE IS F                                          01510011
014700     BLOCK CONTAINS 0 CHARACTERS                                  01520011
014800     LABEL RECORDS ARE STANDARD                                   01530011
014900     DATA RECORD IS UNJRNLZD-RECEIPT-DATA-RECORD.                 01540011
015000*                                                                 01550011
015100 01  UNJRNLZD-RECEIPT-DATA-RECORD PIC X(95).                      01560011
015200*                                                                 01570011
015300 EJECT                                                            01580011
015400 WORKING-STORAGE SECTION.                                         01590011
015500                                                                  01600011
015600 01  PV-PROGRAM-VARIABLES.                                        01610011
015700     05  FILLER                  PIC  X(30)  VALUE                01620011
015800         '** BEGINING OF APKUT107 W/S **'.                        01630011
015900     05  PV-CURRENT-PARAGRAPH    PIC  X(35)  VALUE SPACES.        01640011
016000     05  PV-PO-NBR               PIC S9(9)   VALUE ZEROS          01650011
016100                                             COMP.                01660011
016200     05  PV-DISPLAY-PO-NBR       PIC 9(9).                        01670011
016300     05  PV-TOTAL-COST           PIC S9(09)V9(3)                  01680011
016400                                             VALUE ZEROS          01690011
016500                                             COMP-3.              01700011
016600     05  PV-TOTAL-FIRST-COST     PIC S9(09)V9(3)                  01710011
016700                                             VALUE ZEROS          01720011
016800                                             COMP-3.              01730011
016900     05  PV-UNJRNLZD-REC-COST    PIC S9(09)V9(2)                  01740011
017000                                             VALUE ZEROS          01750011
017100                                             COMP-3.              01760011
017200     05  PV-TOT-GROSS-COST       PIC S9(10)V9(2)                  01770011
017300                                             VALUE ZEROS          01780011
017400                                             COMP-3.              01790011
017500     05  PV-VERIFIED-COST        PIC S9(09)V9(2)                  01800011
017600                                             VALUE ZEROS          01810011
017700                                             COMP-3.              01820011
017800     05  PV-RETRY-COUNT          PIC S9(04)   VALUE ZEROS         01830011
017900                                              COMP.               01840011
018000                                                                  01850011
018100 01  PS-PROGRAM-SWITCHES.                                         01860011
018200     05  PS-OUT-OF-POS-SW        PIC  X(01)  VALUE ' '.           01870011
018300         88  OUT-OF-POS                      VALUE 'Y'.           01880011
018400         88  MORE-POS                        VALUE ' '.           01890011
018500     05  PS-OUT-OF-RECEIPTS-SW   PIC  X(01)  VALUE ' '.           01900011
018600         88  OUT-OF-RECEIPTS                 VALUE 'Y'.           01910011
018700         88  MORE-RECEIPTS                   VALUE ' '.           01920011
018800                                                                  01930011
018900 01  PC-PROGRAM-CONSTANTS.                                        01940011
019000     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3             01950011
019100                                             COMP.                01960011
019200 EJECT                                                            01970011
019300*                                                                 01980011
019400*    UNJOURNALIZED RECEIPT PO FILE                                01990011
019500*                                                                 02000011
019600     COPY APRD106.                                                02010011
019700 EJECT                                                            02020011
019800*                                                                 02030011
019900*    UNJOURNALIZED RECEIPT DATA FILE                              02040011
020000*                                                                 02050011
020100     COPY APRD107.                                                02060011
020200 EJECT                                                            02070011
020300*----------------------------------------------------------------*02080011
020400*  PURCHASE TABLE                                                *02090011
020500*----------------------------------------------------------------*02100011
020600     EXEC SQL                                                     02110011
020700          INCLUDE TPURCHS                                         02120011
020800     END-EXEC.                                                    02130011
020900 EJECT                                                            02140011
021000*----------------------------------------------------------------*02150011
021100*  RECEIVER TABLE                                                *02160011
021200*----------------------------------------------------------------*02170011
021300     EXEC SQL                                                     02180011
021400         INCLUDE TRECEIV                                          02190011
021500     END-EXEC.                                                    02200011
021600 EJECT                                                            02210011
021700*----------------------------------------------------------------*02220011
021800*  PURCHASE ORDER ITEMS TABLE                                    *02230011
021900*----------------------------------------------------------------*02240011
022000     EXEC SQL                                                     02250011
022100          INCLUDE TPURITM                                         02260011
022200     END-EXEC.                                                    02270011
022300 EJECT                                                            02280011
022400*----------------------------------------------------------------*02290011
022500*  RECEIPT DISTRIBUTION TABLE                                    *02300011
022600*----------------------------------------------------------------*02310011
022700     EXEC SQL                                                     02320011
022800          INCLUDE TRECDIS                                         02330011
022900     END-EXEC.                                                    02340011
023000 EJECT                                                            02350011
023100*----------------------------------------------------------------*02360011
023200*  RECEIPT ITEMS TABLE                                           *02370011
023300*----------------------------------------------------------------*02380011
023400     EXEC SQL                                                     02390011
023500          INCLUDE TRECITM                                         02400011
023600     END-EXEC.                                                    02410011
023700*----------------------------------------------------------------*02420011
023800*  EXTERNAL ENTERPRISE NAME TABLE                                *02430011
023900*----------------------------------------------------------------*02440011
024000     EXEC SQL                                                     02450011
024100          INCLUDE TENTNME                                         02460011
024200     END-EXEC.                                                    02470011
024300 EJECT                                                            02480011
024400*----------------------------------------------------------------*02490011
024500*  EXTERNAL ENTERPRISE TABLE                                     *02500011
024600*----------------------------------------------------------------*02510011
024700     EXEC SQL                                                     02520011
024800          INCLUDE TEXTENT                                         02530011
024900     END-EXEC.                                                    02540011
025000*----------------------------------------------------------------*02550014
025100*  INVOICE TABLE                                                 *02560014
025200*----------------------------------------------------------------*02570014
025300     EXEC SQL                                                     02580014
025400          INCLUDE TINVOIC                                         02590014
025500     END-EXEC.                                                    02600014
025600/                                                                 02610011
025700*                                                                 02620011
025800*    SQL COMMUNICATIONS AREA DCLGEN                               02630011
025900*                                                                 02640011
026000     EXEC SQL                                                     02650011
026100         INCLUDE SQLCA                                            02660011
026200     END-EXEC.                                                    02670011
026300/                                                                 02680011
026400*----------------------------------------------------------------*02690011
026500*    CURSOR DECLARATIONS                                          02700011
026600*----------------------------------------------------------------*02710011
026700*----------------------------------------------------------------*02720011
026800* RECEIV_CSR RETURNS THE RECEIVER COSTS FOR PO'S TO BE PROCESSED. 02730011
026900*----------------------------------------------------------------*02740011
027000     EXEC SQL                                                     02750011
027100       DECLARE RECEIV_CSR CURSOR FOR                              02760011
027200         SELECT                                                   02770011
027300              RD.AP_VERIFY_ITM_QTY * PI.UNT_COST_AMT              02780011
027400            , RD.AP_VERIFY_ITM_QTY * PI.PRD_1ST_COST_AMT          02790011
027500            , RD.AP_PRC_CDE                                       02800011
027600         FROM                                                     02810011
027700             TRECEIV RV                                           02820011
027800            ,TPURITM PI                                           02830011
027900            ,TRECDIS RD                                           02840011
028000            ,TRECITM RI                                           02850011
028100         WHERE RV.ORD_NBR        = :PV-PO-NBR                     02860011
028200           AND RV.STATUS_CDE     = 'VE'                           02870011
028300           AND RV.FS_POST_TMST  ^= '9999-09-09-09.09.09.999999'   02880011
028400                                                                  02890011
028500           AND RV.ORD_NBR        = RI.ORD_NBR                     02900011
028600           AND RV.ORD_NBR        = RD.ORD_NBR                     02910011
028700           AND RV.ORD_NBR        = PI.PO_NBR                      02920011
028800                                                                  02930011
028900           AND RV.VER_STATUS_CDE = 'A'                            02940011
029000           AND RI.VER_STATUS_CDE = 'A'                            02950011
029100           AND RD.VER_STATUS_CDE = 'A'                            02960011
029200                                                                  02970011
029300           AND RV.REC_SEQ_NBR    = RI.REC_SEQ_NBR                 02980011
029400           AND RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                 02990011
029500                                                                  03000011
029600           AND RI.OPER_UNT_ID    = RD.OPER_UNT_ID                 03010011
029700           AND RI.FCLTY_ID       = RD.FCLTY_ID                    03020011
029800                                                                  03030011
029900           AND RI.ORD_LNE_NBR    = RD.ORD_LNE_NBR                 03040011
030000           AND RI.ORD_LNE_NBR    = PI.APP_PO_LNE_NBR              03050011
030100                                                                  03060011
030200           AND RI.PO_VER_NBR     = PI.VER_NBR                     03070011
030300                                                                  03080011
P46749           AND PI.PO_NBR         = PI.PO_NBR                      03090022
P46749           AND PI.VER_NBR        = PI.VER_NBR                     03100022
P46749           AND PI.PO_LNE_NBR     = PI.PO_LNE_NBR                  03110022
030400     END-EXEC.                                                    03120011
030500/                                                                 03130011
030600*----------------------------------------------------------------*03140011
030700*  ABEND DATA AREAS                                              *03150011
030800*----------------------------------------------------------------*03160011
030900 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          03170011
031000                                             COMP SYNC.           03180011
031100     88  AC-MULT-NINREC-RECS                 VALUE +4001.         03190011
031200     88  AC-DB2-ERROR                        VALUE +4013.         03200011
031300                                                                  03210011
031400                                                                  03220011
031500 01  ABEND-AREAS.                                                 03230011
031600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                03240011
031700             '*****       ABEND'.                                 03250011
031800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                03260011
031900             '*****   PROGRAM: APKUT107'.                         03270011
032000     05  AA-PARAGRAPH-LIT.                                        03280011
032100         10  FILLER              PIC  X(17)  VALUE                03290011
032200             '***** PARAGRAPH: '.                                 03300011
032300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        03310011
032400     05  AA-MESSAGE-LINE.                                         03320011
032500         10  FILLER              PIC  X(06)  VALUE '*****'.       03330011
032600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        03340011
032700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                03350011
032800             '*****    DB2 ERROR'.                                03360011
032900     05  AA-DB2-OPERATION-LIT.                                    03370011
033000         10  FILLER              PIC  X(17)  VALUE                03380011
033100             '***** OPERATION: '.                                 03390011
033200         10  AA-DB2-OPERATION.                                    03400011
033300             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        03410011
033400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        03420011
033500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        03430011
033600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        03440011
033700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        03450011
033800     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        03460011
033900     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        03470011
034000                                                                  03480011
034100     COPY DPWS004.                                                03490011
034200                                                                  03500011
034300 01  FILLER                      PIC  X(25)  VALUE                03510011
034400     '** END OF APKUT107 W/S **'.                                 03520011
034500 EJECT                                                            03530011
034600 PROCEDURE DIVISION.                                              03540011
034700 A100-MAIN.                                                       03550011
034800                                                                  03560011
034900     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    03570011
035000                                                                  03580011
035100     PERFORM B100-INITIALIZE.                                     03590011
035200                                                                  03600011
035300     PERFORM R100-READ-PO-RECORD.                                 03610011
035400     PERFORM B200-PROCESS-PO-REC                                  03620011
035500       UNTIL OUT-OF-POS.                                          03630011
035600                                                                  03640011
035700     PERFORM B300-END-PROGRAM.                                    03650011
035800                                                                  03660011
035900     GOBACK.                                                      03670011
036000                                                                  03680011
036100 EJECT                                                            03690011
036200*----------------------------------------------------------------*03700011
036300*    INITIALIZATION PROCESSING                                   *03710011
036400*    CALLED FROM A100-MAIN                                       *03720011
036500*----------------------------------------------------------------*03730011
036600 B100-INITIALIZE.                                                 03740011
036700                                                                  03750011
036800     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              03760011
036900                                                                  03770011
037000     OPEN INPUT  UNJRNLZD-RECEIPT-PO-FILE.                        03780011
037100     OPEN OUTPUT UNJRNLZD-RECEIPT-DATA-FILE.                      03790011
037200                                                                  03800011
037300     INITIALIZE DCLTPURCHS                                        03810011
037400                DCLTRECEIV                                        03820011
037500                DCLTPURITM                                        03830011
037600                DCLTRECDIS                                        03840011
037700                DCLTRECITM                                        03850011
037800                DCLTENTNME                                        03860011
037900                DCLTEXTENT                                        03870011
038000                AP106-RECORD                                      03880011
038100                AP107-RECORD.                                     03890011
038200                                                                  03900011
038300 EJECT                                                            03910011
038400*----------------------------------------------------------------*03920011
038500*    PROCESSES EACH JOURNALIZED RECEIPT PO FILE RECORD TO        *03930011
038600*    DETERMINE IF A REPORT DATA RECORD SHOULD BE CREATED.        *03940011
038700*    CALLED FROM A100-MAIN                                       *03950011
038800*----------------------------------------------------------------*03960011
038900 B200-PROCESS-PO-REC.                                             03970011
039000                                                                  03980011
039100     MOVE 'B200-PROCESS-PO-REC'     TO PV-CURRENT-PARAGRAPH.      03990011
039200                                                                  04000011
039300     IF AP106-PO-NBR NOT = PV-PO-NBR                              04010011
039400         MOVE AP106-PO-NBR          TO PV-PO-NBR                  04020011
039500         PERFORM C100-GET-DATA-REC-INFO                           04030011
039600     ELSE                                                         04040011
039700         IF AP106-NON-INVC-RECEIPT                                04050011
039800             DISPLAY 'PO IN PROCESS: ' PV-PO-NBR                  04060011
039900             MOVE PV-CURRENT-PARAGRAPH   TO AA-PARAGRAPH-NAME     04070011
040000             MOVE 'MULTIPLE NON INVC RECEIPT RECORDS'             04080011
040100                                         TO AA-MESSAGE            04090011
040200             SET AC-MULT-NINREC-RECS     TO TRUE                  04100011
040300             PERFORM Z999-ABEND                                   04110011
040400         END-IF                                                   04120011
040500     END-IF.                                                      04130011
040600                                                                  04140011
040700     PERFORM R100-READ-PO-RECORD.                                 04150011
040800                                                                  04160011
040900 EJECT                                                            04170011
041000*----------------------------------------------------------------*04180011
041100*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.  *04190011
041200*    CALLED FROM A100-MAIN                                       *04200011
041300*----------------------------------------------------------------*04210011
041400 B300-END-PROGRAM.                                                04220011
041500                                                                  04230011
041600     MOVE 'B300-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             04240011
041700                                                                  04250011
041800     CLOSE UNJRNLZD-RECEIPT-PO-FILE                               04260011
041900           UNJRNLZD-RECEIPT-DATA-FILE.                            04270011
042000                                                                  04280011
042100 EJECT                                                            04290011
042200*----------------------------------------------------------------*04300011
042300*    GETS DB2 TABLE INFORMATION WHICH WILL BE USED TO CREATE     *04310011
042400*    UNJOURNALIZED RECEIPT DATA FILE RECORDS.                    *04320011
042500*    CALLED FROM B200-PROCESS-PO-REC                             *04330011
042600*----------------------------------------------------------------*04340011
042700 C100-GET-DATA-REC-INFO.                                          04350011
042800                                                                  04360011
042900     MOVE 'C100-GET-DATA-REC-INFO'  TO PV-CURRENT-PARAGRAPH.      04370011
043000                                                                  04380011
043100     PERFORM R200-GET-PO-DATA.                                    04390011
043200     PERFORM R300-GET-VENDOR.                                     04400011
043300                                                                  04410011
043400     INITIALIZE PV-UNJRNLZD-REC-COST                              04420011
043500                PV-VERIFIED-COST                                  04430011
043600                PV-TOT-GROSS-COST                                 04440011
043700                PS-OUT-OF-RECEIPTS-SW.                            04450011
043800                                                                  04460011
043900     PERFORM Y100-OPEN-RECEIV-CSR.                                04470011
044000     PERFORM R400-FETCH-RECEIV.                                   04480011
044100                                                                  04490011
044200     PERFORM WITH TEST BEFORE                                     04500011
044300       UNTIL OUT-OF-RECEIPTS                                      04510011
044400          IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF' OR 'CD'     04520011
044500             ADD PV-TOTAL-COST       TO PV-VERIFIED-COST ROUNDED  04530011
044600         ELSE                                                     04540011
044700             ADD PV-TOTAL-FIRST-COST TO PV-VERIFIED-COST ROUNDED  04550011
044800         END-IF                                                   04560011
044900                                                                  04570011
045000         IF RECDIS-AP-PRC-CDE = 'M' OR SPACES                     04580011
045100            IF  PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF' OR 'CD'  04590011
045200                ADD PV-TOTAL-COST TO PV-UNJRNLZD-REC-COST ROUNDED 04600011
045300            ELSE                                                  04610011
045400                ADD PV-TOTAL-FIRST-COST TO PV-UNJRNLZD-REC-COST   04620011
045500                                           ROUNDED                04630011
045600            END-IF                                                04640011
045700         ELSE                                                     04650011
045800            CONTINUE                                              04660011
045900         END-IF                                                   04670011
046000                                                                  04680011
046100         PERFORM R400-FETCH-RECEIV                                04690011
046200     END-PERFORM.                                                 04700011
046300                                                                  04710011
046400     PERFORM Y150-CLOSE-RECEIV-CSR.                               04720011
046500                                                                  04730011
046600     PERFORM R500-PO-TOT-GROSS-COST.                              04740011
046700                                                                  04750011
046800     PERFORM W100-WRITE-UNJRNLZD-DATA-REC.                        04760011
046900 EJECT                                                            04770011
047000*----------------------------------------------------------------*04780011
047100*    READS AN UNJOURNALIZED RECEIPT PO FILE RECORD.              *04790011
047200*    CALLED FROM A100-MAIN                                       *04800011
047300*                B200-PROCESS-PO-REC                             *04810011
047400*----------------------------------------------------------------*04820011
047500 R100-READ-PO-RECORD.                                             04830011
047600                                                                  04840011
047700     MOVE 'R100-READ-PO-RECORD' TO PV-CURRENT-PARAGRAPH.          04850011
047800                                                                  04860011
047900     READ UNJRNLZD-RECEIPT-PO-FILE INTO AP106-RECORD              04870011
048000        AT END SET OUT-OF-POS TO TRUE.                            04880011
048100                                                                  04890011
048200 EJECT                                                            04900011
048300*----------------------------------------------------------------*04910011
048400*    RETRIEVES INFO FROM TPURCHS.                                *04920011
048500*    CALLED FROM B200-PROCESS-PO-REC                             *04930011
048600*----------------------------------------------------------------*04940011
048700 R200-GET-PO-DATA.                                                04950011
048800                                                                  04960011
048900     MOVE 'R200-GET-PO-DATA    ' TO PV-CURRENT-PARAGRAPH.         04970011
049000                                                                  04980011
049100     EXEC SQL                                                     04990011
049200         SELECT                                                   05000011
049300               DEPT_NBR                                           05010011
049400             , TOT_VAL_COST_AMT                                   05020011
049500             , OTB_PER_NBR                                        05030011
049600             , NEW_STR_PO_IND                                     05040011
049700             , PO_TYP_CDE                                         05050011
049800         INTO                                                     05060011
049900              :PURCHS-DEPT-NBR                                    05070011
050000             ,:PURCHS-TOT-VAL-COST-AMT                            05080011
050100             ,:PURCHS-OTB-PER-NBR                                 05090011
050200             ,:PURCHS-NEW-STR-PO-IND                              05100011
050300             ,:PURCHS-PO-TYP-CDE                                  05110011
050400         FROM                                                     05120011
050500              TPURCHS                                             05130011
050600         WHERE PO_NBR         = :PV-PO-NBR                        05140011
050700           AND VER_STATUS_CDE = 'A'                               05150011
050800     END-EXEC.                                                    05160011
050900                                                                  05170011
051000     EVALUATE TRUE                                                05180011
051100         WHEN SQLCODE = ZERO                                      05190011
051200              CONTINUE                                            05200011
051300         WHEN SQLCODE = +100                                      05210011
051400              MOVE '999'             TO PURCHS-DEPT-NBR           05220011
051500              MOVE SPACE             TO PURCHS-NEW-STR-PO-IND     05230011
051600                                        PURCHS-PO-TYP-CDE         05240011
051700         WHEN SQLWARN0 NOT = SPACES                               05250011
051800         WHEN SQLCODE  NOT = ZERO                                 05260011
051900             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      05270011
052000             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       05280011
052100             MOVE 'TPURCHS'             TO AA-DB2-TABLE-1         05290011
052200             PERFORM Z998-DB2-ABEND                               05300011
052300     END-EVALUATE.                                                05310011
052400                                                                  05320011
052500 EJECT                                                            05330011
052600*----------------------------------------------------------------*05340011
052700*    RETRIEVES THE VENDOR NAME AND NUMBER.                       *05350011
052800*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE WILL RESULT   *05360011
052900*           IN DEFAULT VALUES BEING PLACED IN THE REQUESTED      *05370011
053000*           FIELDS.                                              *05380011
053100*    CALLED FROM B200-PROCESS-PO-REC                             *05390011
053200*----------------------------------------------------------------*05400011
053300 R300-GET-VENDOR.                                                 05410011
053400                                                                  05420011
053500     MOVE 'R300-GET-VENDOR'      TO PV-CURRENT-PARAGRAPH.         05430011
053600                                                                  05440011
053700     PERFORM WITH TEST AFTER                                      05450011
053800             VARYING PV-RETRY-COUNT FROM 1 BY 1                   05460011
053900             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             05470011
054000                     SQLCODE = ZERO OR                            05480011
054100                     SQLCODE = +100                               05490011
054200                                                                  05500011
054300             EXEC SQL                                             05510011
054400                 SELECT                                           05520011
054500                     EN.ENT_NAME_DESC                             05530011
054600                   , EE.DUN_NBR                                   05540011
054700                 INTO                                             05550011
054800                      :ENTNME-ENT-NAME-DESC                       05560011
054900                    , :EXTENT-DUN-NBR                             05570011
055000                 FROM TENTNME EN                                  05580011
055100                    , TEXTENT EE                                  05590011
055200                    , TPURCHS PU                                  05600011
055300                 WHERE PU.PO_NBR         = :PV-PO-NBR             05610011
055400                   AND PU.VER_STATUS_CDE = 'A'                    05620011
055500                   AND PU.ENT_ID         = EE.ENT_ID              05630011
055600                   AND PU.ENT_ID         = EN.ENT_ID              05640011
055700                   AND EN.TYPE_CDE       = '01'                   05650011
055800                   AND EE.STATUS_CDE     = 'A'                    05660011
055900             END-EXEC                                             05670011
056000                                                                  05680011
056100                                                                  05690011
056200             EVALUATE TRUE                                        05700011
056300                 WHEN SQLCODE = ZERO                              05710011
056400                 WHEN SQLCODE = +100                              05720011
056500                 WHEN SQLCODE = -904                              05730011
056600                 WHEN SQLCODE = -913                              05740011
056700                      CONTINUE                                    05750011
056800                                                                  05760011
056900                 WHEN SQLWARN0 NOT = SPACES                       05770011
057000                 WHEN SQLCODE  NOT = ZERO                         05780011
057100                     MOVE PV-CURRENT-PARAGRAPH                    05790011
057200                                         TO AA-PARAGRAPH-NAME     05800011
057300                     MOVE 'UNSUCCESSFUL SELECT'                   05810011
057400                                         TO AA-DB2-OPERATION      05820011
057500                     MOVE 'TENTNME'      TO AA-DB2-TABLE-1        05830011
057600                     MOVE 'TEXTENT'      TO AA-DB2-TABLE-2        05840011
057700                     MOVE 'TPURCHS'      TO AA-DB2-TABLE-3        05850011
057800                     MOVE SPACES         TO AA-DB2-TABLE-4        05860011
057900                                            AA-DB2-TABLE-5        05870011
058000                     PERFORM Z998-DB2-ABEND                       05880011
058100             END-EVALUATE                                         05890011
058200     END-PERFORM.                                                 05900011
058300                                                                  05910011
058400     IF PV-RETRY-COUNT > PC-RETRY-MAX                             05920011
058500         MOVE PV-CURRENT-PARAGRAPH                                05930011
058600                             TO AA-PARAGRAPH-NAME                 05940011
058700         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    05950011
058800                             TO AA-DB2-OPERATION                  05960011
058900         MOVE 'TENTNME'      TO AA-DB2-TABLE-1                    05970011
059000         MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                    05980011
059100         MOVE 'TPURCHS'      TO AA-DB2-TABLE-3                    05990011
059200         MOVE SPACES         TO AA-DB2-TABLE-4                    06000011
059300                                AA-DB2-TABLE-5                    06010011
059400         PERFORM Z998-DB2-ABEND                                   06020011
059500     END-IF.                                                      06030011
059600                                                                  06040011
059700     EVALUATE TRUE                                                06050011
059800         WHEN SQLCODE = ZEROS                                     06060011
059900             CONTINUE                                             06070011
060000         WHEN SQLCODE = +100                                      06080011
060100             MOVE 'NO VENDOR FOUND' TO ENTNME-ENT-NAME-DESC       06090011
060200             MOVE '999999999'       TO EXTENT-DUN-NBR             06100011
060300         WHEN OTHER                                               06110011
060400             MOVE PV-CURRENT-PARAGRAPH                            06120011
060500                                 TO AA-PARAGRAPH-NAME             06130011
060600             MOVE 'UNSUCCESSFUL SELECT'                           06140011
060700                                 TO AA-DB2-OPERATION              06150011
060800             MOVE 'TENTNME'      TO AA-DB2-TABLE-1                06160011
060900             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                06170011
061000             MOVE 'TPURCHS'      TO AA-DB2-TABLE-3                06180011
061100             MOVE SPACES         TO AA-DB2-TABLE-4                06190011
061200                                    AA-DB2-TABLE-5                06200011
061300             PERFORM Z998-DB2-ABEND                               06210011
061400     END-EVALUATE.                                                06220011
061500 EJECT                                                            06230011
061600*----------------------------------------------------------------*06240011
061700*    RETRIEVES RECEIPT COST INFORMATION.                          06250011
061800*----------------------------------------------------------------*06260011
061900 R400-FETCH-RECEIV.                                               06270011
062000                                                                  06280011
062100     MOVE ' R400-FETCH-RECEIV     ' TO PV-CURRENT-PARAGRAPH.      06290011
062200                                                                  06300011
062300     EXEC SQL                                                     06310011
062400         FETCH RECEIV_CSR                                         06320011
062500         INTO :PV-TOTAL-COST                                      06330011
062600            , :PV-TOTAL-FIRST-COST                                06340011
062700            , :RECDIS-AP-PRC-CDE                                  06350011
062800     END-EXEC.                                                    06360011
062900                                                                  06370011
063000     EVALUATE TRUE                                                06380011
063100         WHEN SQLCODE = +100                                      06390011
063200              SET OUT-OF-RECEIPTS TO TRUE                         06400011
063300         WHEN SQLCODE = ZERO                                      06410011
063400              CONTINUE                                            06420011
063500                                                                  06430011
063600         WHEN SQLWARN0 NOT = SPACES                               06440011
063700         WHEN SQLCODE  NOT = ZERO                                 06450011
063800             MOVE PV-CURRENT-PARAGRAPH                            06460011
063900                              TO AA-PARAGRAPH-NAME                06470011
064000             MOVE 'UNSUCCESSFUL FETCH WITH RECEIV CSR'            06480011
064100                              TO AA-DB2-OP-1                      06490011
064200             MOVE 'TRECEIV'   TO AA-DB2-TABLE-1                   06500011
064300             MOVE SPACES      TO AA-DB2-TABLE-2                   06510011
064400                                 AA-DB2-TABLE-3                   06520011
064500                                 AA-DB2-TABLE-4                   06530011
064600                                 AA-DB2-TABLE-5                   06540011
064700             PERFORM Z998-DB2-ABEND                               06550011
064800     END-EVALUATE.                                                06560011
064900                                                                  06570011
065000 EJECT                                                            06580011
065100*----------------------------------------------------------------*06590011
065200*    RETRIEVES THE SUM OF THE TOTAL GROSS AMOUNT FOR EACH         06600011
065300*    PO FROM TINVOIC, WHERE THE INVOICE TYPE CODE = 'MI' AND      06610011
065400*    THE STATUS CODE NOT = 'DE'                                   06620011
065500*----------------------------------------------------------------*06630011
065600 R500-PO-TOT-GROSS-COST.                                          06640011
065700                                                                  06650011
065800     MOVE 'R500-PO-TOT-GROSS-COST '                               06660011
065900                                       TO PV-CURRENT-PARAGRAPH.   06670011
066000                                                                  06680011
066100     EXEC SQL                                                     06690011
066200       SELECT SUM(GRO_COST_AMT)                                   06700013
066300         INTO :PV-TOT-GROSS-COST                                  06710011
066400         FROM TINVOIC                                             06720013
066500         WHERE PO_NBR       = :PV-PO-NBR                          06730013
066600           AND INVC_TYP_CDE = 'MI'                                06740013
066700           AND STATUS_CDE  ^= 'DE'                                06750013
066800         GROUP BY PO_NBR                                          06760013
066900     END-EXEC.                                                    06770011
067000                                                                  06780011
067100     EVALUATE TRUE                                                06790011
067200         WHEN SQLCODE = ZERO                                      06800011
067300             PERFORM U100-COMMIT                                  06810011
067400                                                                  06820011
067500         WHEN SQLCODE = +100                                      06830011
067600             CONTINUE                                             06840011
067700                                                                  06850011
067800         WHEN SQLWARN0 NOT = SPACES                               06860011
067900         WHEN SQLCODE  NOT = ZERO                                 06870011
068000             MOVE PV-CURRENT-PARAGRAPH                            06880011
068100                              TO AA-PARAGRAPH-NAME                06890011
068200             MOVE 'UNSUCCESSFUL SELECT'                           06900011
068300                              TO AA-DB2-OP-1                      06910011
068400             MOVE 'TINVOIC'   TO AA-DB2-TABLE-1                   06920011
068500             MOVE SPACES      TO AA-DB2-TABLE-2                   06930011
068600                                 AA-DB2-TABLE-3                   06940011
068700                                 AA-DB2-TABLE-4                   06950011
068800                                 AA-DB2-TABLE-5                   06960011
068900             PERFORM Z998-DB2-ABEND                               06970011
069000     END-EVALUATE.                                                06980011
069100                                                                  06990011
069200*--------------------------------------------------------------*  07000011
069300* PERFORM COMMIT TO RELEASE CLAIMS ON TINVOIC                  *  07010011
069400* TABLE TO AVOID CONTENTION WITH DB2 REORG JOBS.               *  07020011
069500*--------------------------------------------------------------*  07030011
069600 U100-COMMIT.                                                     07040011
069700                                                                  07050011
069800     EXEC SQL                                                     07060011
069900         COMMIT                                                   07070011
070000     END-EXEC.                                                    07080011
070100                                                                  07090011
070200     EVALUATE TRUE                                                07100011
070300         WHEN SQLCODE = ZEROS                                     07110011
070400              CONTINUE                                            07120011
070500         WHEN OTHER                                               07130011
070600             MOVE 'U100-COMMIT'  TO AA-PARAGRAPH-NAME             07140011
070700             MOVE 'UNSUCCESSFUL COMMIT'                           07150011
070800                                 TO AA-DB2-OPERATION              07160011
070900             MOVE SPACES         TO AA-DB2-TABLE-1                07170012
071000                                    AA-DB2-TABLE-2                07180012
071100                                    AA-DB2-TABLE-3                07190012
071200                                    AA-DB2-TABLE-4                07200012
071300                                    AA-DB2-TABLE-5                07210011
071400             PERFORM Z998-DB2-ABEND                               07220011
071500     END-EVALUATE.                                                07230011
071600                                                                  07240011
071700 EJECT                                                            07250011
071800*----------------------------------------------------------------*07260011
071900*    WRITES THE UNJOURNALIZED RECEIPT PO FILE RECORDS.           *07270011
072000*----------------------------------------------------------------*07280011
072100 W100-WRITE-UNJRNLZD-DATA-REC.                                    07290011
072200                                                                  07300011
072300     MOVE 'W100-WRITE-UNJRNLZD-DATA-REC' TO PV-CURRENT-PARAGRAPH. 07310011
072400                                                                  07320011
072500     MOVE ENTNME-ENT-NAME-DESC     TO AP107-VENDOR-NAME.          07330011
072600     MOVE PV-PO-NBR                TO AP107-PO-NBR.               07340011
072700     MOVE EXTENT-DUN-NBR           TO AP107-VENDOR-NUMBER.        07350011
072800     MOVE PURCHS-DEPT-NBR          TO AP107-DEPT.                 07360011
072900     MOVE PURCHS-TOT-VAL-COST-AMT  TO AP107-PO-COST.              07370011
073000     MOVE PURCHS-OTB-PER-NBR       TO AP107-OTB-PER-NBR.          07380011
073100     MOVE PURCHS-NEW-STR-PO-IND    TO AP107-NEW-STR-PO-IND.       07390011
073200     MOVE PV-VERIFIED-COST         TO AP107-VERIFIED-COST.        07400011
073300     SUBTRACT AP107-VERIFIED-COST FROM AP107-PO-COST              07410011
073400           GIVING AP107-VER-EXCEPTION-AMT.                        07420011
073500     IF AP106-NON-INVC-RECEIPT                                    07430011
073600         MOVE AP106-NR-TOTAL-COST  TO AP107-UNJRNLZD-NIR          07440011
073700     ELSE                                                         07450011
073800         MOVE ZERO                 TO AP107-UNJRNLZD-NIR.         07460011
073900     MOVE PV-UNJRNLZD-REC-COST     TO AP107-UNJRNLZD-RECEIVER.    07470011
074000     MOVE PV-TOT-GROSS-COST        TO AP107-TOT-GROSS-COST.       07480011
074100                                                                  07490011
074200     WRITE UNJRNLZD-RECEIPT-DATA-RECORD FROM AP107-RECORD.        07500011
074300                                                                  07510011
074400 EJECT                                                            07520011
074500*----------------------------------------------------------------*07530011
074600*    OPENS THE RECEIVE CURSOR.                                   *07540011
074700*----------------------------------------------------------------*07550011
074800 Y100-OPEN-RECEIV-CSR.                                            07560011
074900                                                                  07570011
075000     MOVE 'Y100-OPEN-RECEIV-CSR' TO PV-CURRENT-PARAGRAPH.         07580011
075100                                                                  07590011
075200     PERFORM WITH TEST AFTER                                      07600011
075300             VARYING PV-RETRY-COUNT FROM 1 BY 1                   07610011
075400             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             07620011
075500                     SQLCODE = ZERO                               07630011
075600                                                                  07640011
075700             EXEC SQL                                             07650011
075800                 OPEN RECEIV_CSR                                  07660011
075900             END-EXEC                                             07670011
076000                                                                  07680011
076100             EVALUATE TRUE                                        07690011
076200                 WHEN SQLCODE = ZERO                              07700011
076300                 WHEN SQLCODE = -904                              07710011
076400                 WHEN SQLCODE = -911                              07720011
076500                 WHEN SQLCODE = -913                              07730011
076600                      CONTINUE                                    07740011
076700                                                                  07750011
076800                 WHEN SQLWARN0 NOT = SPACES                       07760011
076900                 WHEN SQLCODE  NOT = ZERO                         07770011
077000                     MOVE PV-CURRENT-PARAGRAPH                    07780011
077100                                         TO AA-PARAGRAPH-NAME     07790011
077200                     MOVE 'UNSUCCESSFUL OPEN ON RECEIV_CSR'       07800011
077300                                         TO AA-DB2-OPERATION      07810011
077400                     MOVE 'TRECEIV'      TO AA-DB2-TABLE-1        07820011
077500                     MOVE 'TPURITM'      TO AA-DB2-TABLE-2        07830011
077600                     MOVE 'TRECDIS'      TO AA-DB2-TABLE-3        07840011
077700                     MOVE 'TRECITM'      TO AA-DB2-TABLE-4        07850011
077800                     MOVE SPACES         TO AA-DB2-TABLE-5        07860011
077900                     PERFORM Z998-DB2-ABEND                       07870011
078000             END-EVALUATE                                         07880011
078100     END-PERFORM.                                                 07890011
078200                                                                  07900011
078300     IF PV-RETRY-COUNT > PC-RETRY-MAX                             07910011
078400         MOVE PV-CURRENT-PARAGRAPH                                07920011
078500                             TO AA-PARAGRAPH-NAME                 07930011
078600         MOVE 'MAX RETRIES EXCEEDED ON OPEN FOR RECEIV_CSR'       07940011
078700                             TO AA-DB2-OPERATION                  07950011
078800         MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                    07960011
078900         MOVE 'TPURITM'      TO AA-DB2-TABLE-2                    07970011
079000         MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                    07980011
079100         MOVE 'TRECITM'      TO AA-DB2-TABLE-4                    07990011
079200         MOVE SPACES         TO AA-DB2-TABLE-5                    08000011
079300         PERFORM Z998-DB2-ABEND                                   08010011
079400     END-IF.                                                      08020011
079500                                                                  08030011
079600 EJECT                                                            08040011
079700*----------------------------------------------------------------*08050011
079800*    CLOSES THE RECEIV CURSOR                                    *08060011
079900*----------------------------------------------------------------*08070011
080000 Y150-CLOSE-RECEIV-CSR.                                           08080011
080100                                                                  08090011
080200     MOVE 'Y150-CLOSE-RECEIV-CSR' TO PV-CURRENT-PARAGRAPH.        08100011
080300                                                                  08110011
080400     PERFORM WITH TEST AFTER                                      08120011
080500             VARYING PV-RETRY-COUNT FROM 1 BY 1                   08130011
080600             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             08140011
080700                     SQLCODE = ZERO                               08150011
080800                                                                  08160011
080900             EXEC SQL                                             08170011
081000                 CLOSE RECEIV_CSR                                 08180011
081100             END-EXEC                                             08190011
081200                                                                  08200011
081300             EVALUATE TRUE                                        08210011
081400                 WHEN SQLCODE = ZERO                              08220011
081500                 WHEN SQLCODE = -904                              08230011
081600                 WHEN SQLCODE = -911                              08240011
081700                 WHEN SQLCODE = -913                              08250011
081800                      CONTINUE                                    08260011
081900                                                                  08270011
082000                 WHEN SQLWARN0 NOT = SPACES                       08280011
082100                 WHEN SQLCODE  NOT = ZERO                         08290011
082200                     MOVE PV-CURRENT-PARAGRAPH                    08300011
082300                                         TO AA-PARAGRAPH-NAME     08310011
082400                     MOVE 'UNSUCCESSFUL CLOSE ON RECEIV_CSR'      08320011
082500                                         TO AA-DB2-OPERATION      08330011
082600                     MOVE 'TRECEIV'      TO AA-DB2-TABLE-1        08340011
082700                     MOVE 'TPURITM'      TO AA-DB2-TABLE-2        08350011
082800                     MOVE 'TRECDIS'      TO AA-DB2-TABLE-3        08360011
082900                     MOVE 'TRECITM'      TO AA-DB2-TABLE-4        08370011
083000                     MOVE SPACES         TO AA-DB2-TABLE-5        08380011
083100                     PERFORM Z998-DB2-ABEND                       08390011
083200             END-EVALUATE                                         08400011
083300     END-PERFORM.                                                 08410011
083400                                                                  08420011
083500     IF PV-RETRY-COUNT > PC-RETRY-MAX                             08430011
083600         MOVE PV-CURRENT-PARAGRAPH                                08440011
083700                             TO AA-PARAGRAPH-NAME                 08450011
083800         MOVE 'MAX RETRIES EXCEEDED ON CLOSE FOR RECEIV_CSR'      08460011
083900                             TO AA-DB2-OPERATION                  08470011
084000         MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                    08480011
084100         MOVE 'TPURITM'      TO AA-DB2-TABLE-2                    08490011
084200         MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                    08500011
084300         MOVE 'TRECITM'      TO AA-DB2-TABLE-4                    08510011
084400         MOVE SPACES         TO AA-DB2-TABLE-5                    08520011
084500         PERFORM Z998-DB2-ABEND                                   08530011
084600     END-IF.                                                      08540011
084700                                                                  08550011
084800 EJECT                                                            08560011
084900*----------------------------------------------------------------*08570011
085000*    ABEND ROUTINE FOR DB2 ERRORS                                *08580011
085100*----------------------------------------------------------------*08590011
085200 Z998-DB2-ABEND.                                                  08600011
085300                                                                  08610011
085400     MOVE PV-PO-NBR TO PV-DISPLAY-PO-NBR.                         08620011
085500     DISPLAY 'PO NUMBER BEING PROCESSED = ' PV-DISPLAY-PO-NBR.    08630011
085600     DISPLAY AA-ABEND-LIT.                                        08640011
085700     DISPLAY AA-DB2-ERROR-LIT.                                    08650011
085800     DISPLAY AA-PROGRAM-LIT.                                      08660011
085900     DISPLAY AA-PARAGRAPH-LIT.                                    08670011
086000     DISPLAY AA-DB2-OPERATION-LIT.                                08680011
086100     DISPLAY AA-DB2-TABLE-1.                                      08690011
086200     DISPLAY AA-DB2-TABLE-2.                                      08700011
086300     DISPLAY AA-DB2-TABLE-3.                                      08710011
086400     DISPLAY AA-DB2-TABLE-4.                                      08720011
086500     SET AC-DB2-ERROR TO TRUE.                                    08730011
086600                                                                  08740011
086700     COPY DPPD004.                                                08750011
086800                                                                  08760011
086900     CALL 'ILBOABN0' USING ABEND-CODE.                            08770011
087000 EJECT                                                            08780011
087100*----------------------------------------------------------------*08790011
087200*    ABEND ROUTINE                                               *08800011
087300*----------------------------------------------------------------*08810011
087400 Z999-ABEND.                                                      08820011
087500                                                                  08830011
087600     DISPLAY AA-ABEND-LIT.                                        08840011
087700     DISPLAY AA-PROGRAM-LIT.                                      08850011
087800     DISPLAY AA-PARAGRAPH-LIT.                                    08860011
087900     DISPLAY AA-MESSAGE-LINE.                                     08870011
088000     CALL 'ILBOABN0' USING ABEND-CODE.                            08880011
