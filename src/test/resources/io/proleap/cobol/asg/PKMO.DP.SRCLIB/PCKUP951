000100 TITLE 'UPDATE PCT-TRN-CLSN-BAL TABLE - IT QTY    '.              00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    PCKUP951.                                         00030000
000400 AUTHOR.        DENISE HAHN.                                      00040000
000500 DATE-WRITTEN.  JANUARY, 2015.                                    00050000
000600                                                                  00060000
000700******************************************************************00070000
000800*                                                                *00080000
000900* THIS PROGRAM WILL USE THE EXTRACT FILE CREATED BY PCKUT987 OF  *00090000
001000* OLD IT FROM PCT_TRN_CLSN_DTL THAT HAVE NOT PURGED FORM THE     *00100000
001100* TABLES.  WILL UPDATE PCT_TRN_CLSN_BAL IT QUANTITIES            *00110000
001200*                                                                *00120000
001300* THIS PROGRAM WAS COPIED FROM PCKUP992 ON 10/10/2017 BY RON     *00130000
001400* KRIER.  THE ONLY CHANGE TO THIS PROGRAM WAS THAT WE COMMENTED  *00140000
001500* OUT THE DISPLAY LINES IN 8030-UPDATE-IT-BAL SINCE THERE WILL   *00150000
001600* BE A LOT OF CHANGES GENERATED BY THE SPECIAL RUN TO CLEAN      *00160000
001700* UP STORE EXPECTED THAT GOT MESSED UP.                          *00170000
001800*                                                                *00180000
001900* ALSO ADDED LOGIC TO THE 7000-READ-INPUT PARAGRAPH TO PUT IN    *00190000
002000* A PROGRESSIVE DISPLAY FOR EVERY 20,000 INPUT RECORDS READ.     *00200000
002100*                                                                *00210000
002200******************************************************************00220000
002300                                                                  00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT IN-TRANSIT-EXTRACT-FILE                               00280000
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300001
003100     SELECT OUT-GIV-UPDATE-FILE                                   00310001
003200         ASSIGN TO OUT01.                                         00320001
003300                                                                  00330000
003400 DATA DIVISION.                                                   00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700 FD  IN-TRANSIT-EXTRACT-FILE                                      00370000
003800     RECORDING MODE IS F                                          00380000
003900     LABEL RECORDS ARE STANDARD                                   00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100                                                                  00410000
004200 01  IN-TRANSIT-RECORD                   PIC  X(50).              00420000
004300                                                                  00430000
004400 FD  OUT-GIV-UPDATE-FILE                                          00440001
004500     RECORDING MODE IS F                                          00450001
004600     LABEL RECORDS ARE STANDARD                                   00460001
004700     BLOCK CONTAINS 0 RECORDS.                                    00470001
004800                                                                  00480001
004900 01  OUT-GIV-UPDATE-RECORD               PIC  X(35).              00490001
005000                                                                  00500001
005100 WORKING-STORAGE SECTION.                                         00510000
005200                                                                  00520000
005300 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00530000
005400                                                     COMP SYNC.   00540000
005500 01  PV-PROGRAM-SWITCHES.                                         00550000
005600     05  PS-EOF-INPUT-SW                 PIC  X(01)  VALUE 'N'.   00560000
005700         88 PS-EOF-INPUT                             VALUE 'Y'.   00570000
005800         88 PS-EOF-INPUT-NO                          VALUE 'N'.   00580000
005900                                                                  00590000
006000 01  PV-PROGRAM-CONSTANTS.                                        00600000
006100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKUP951'.  00610000
006200                                                                  00620000
006300 01  PV-PROGRAM-VARIABLES.                                        00630000
006400     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00640000
006500     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00650000
006600     05  PV-SQL-CODE                     PIC -999.                00660000
006700                                                                  00670000
006800     05 PV-COMMIT-COUNT                  PIC S9(09)  COMP-3       00680000
006900                                                     VALUE ZERO.  00690000
007000     05 PV-EXTRACT-COUNT                 PIC S9(09)  COMP-3       00700000
007100                                                     VALUE ZERO.  00710000
007200     05 PV-WRITE-COUNT                   PIC S9(09)  COMP-3       00720001
007300                                                     VALUE ZERO.  00730001
007400     05 PV-NO-UPDATE-COUNT               PIC S9(09)  COMP-3       00740000
007500                                                     VALUE ZERO.  00750000
007600     05 PV-UPDATE-COUNT                  PIC S9(09)  COMP-3       00760000
007700                                                     VALUE ZERO.  00770000
007800     05 PV-NOT-FND-COUNT                 PIC S9(09)  COMP-3       00780000
007900                                                     VALUE ZERO.  00790000
008000     05 PV-TOTAL-SELECT                  PIC S9(09)  COMP-3       00800000
008100                                                     VALUE ZERO.  00810000
008200     05 PV-SELECT-COUNT                  PIC S9(09)  COMP.        00820001
008300     05 PV-INTR-UPC-ID                   PIC S9(09)  COMP         00830001
008400                                                     VALUE ZERO.  00840001
008500     05 PV-CHUNK-COUNT                   PIC S9(09)  COMP-3       00850000
008600                                                     VALUE ZERO.  00860000
008610     05 PV-LONG-INTR-UPC-ID              PIC S9(10) COMP.         00861002
008700                                                                  00870000
008800     05 PV-DISP-SQL                      PIC -999.                00880000
008900     05 PV-DISP-EXTR-CNT                 PIC ZZZ,ZZZ,ZZ9.         00890000
009000     05 PV-DISP-UPDATE-CNT               PIC ZZZ,ZZZ,ZZ9.         00900000
009100     05 PV-DISP-NO-UPD-CNT               PIC ZZZ,ZZZ,ZZ9.         00910000
009200     05 PV-DISP-NOTFND-CNT               PIC ZZZ,ZZZ,ZZ9.         00920000
009300     05 PV-DISP-BEFORE-QTY               PIC ZZZ,ZZZ,ZZ9-.        00930000
009400     05 PV-DISP-AFTER-QTY                PIC ZZZ,ZZZ,ZZ9-.        00940000
009500     05 PV-DISP-CHUNK-CNT                PIC ZZZ,ZZZ,ZZ9-.        00950000
009510     05 PV-DISP-WRITE-CNT                PIC ZZZ,ZZZ,ZZ9-.        00951002
009600                                                                  00960000
009700     05 PV-PURGE-DAYS                    PIC S9(9) COMP.          00970000
009800     05 PV-CURRENT-DATE                  PIC X(10).               00980000
009900     05 PV-PURGE-DATE                    PIC X(10).               00990000
010000                                                                  01000000
010100 01  DM-UNBALANCE-MESSAGE.                                        01010001
010200     05  FILLER                      PIC X(01) VALUE SPACE.       01020001
010300     05  FILLER                      PIC X(17) VALUE              01030002
010400         'UNBALANCE - SKU: '.                                     01040002
010500     05  DMU-SKU                     PIC 99999999.                01050001
010600     05  FILLER                      PIC X(06) VALUE              01060001
010700         ' STR: '.                                                01070001
010800     05  DMU-STORE                   PIC 9999.                    01080001
010900     05  FILLER                      PIC X(08) VALUE              01090001
011000         ' DTL Q: '.                                              01100001
011100     05  DMU-DTL-QTY                 PIC ZZZ,ZZ9-.                01110001
011200     05  FILLER                      PIC X(08) VALUE              01120001
011300         ' BAL Q: '.                                              01130001
011400     05  DMU-BAL-QTY                 PIC ZZZ,ZZ9-.                01140001
011410     05  FILLER                      PIC X(08) VALUE              01141002
011420         ' ADJ Q: '.                                              01142002
011430     05  DMU-ADJ-QTY                 PIC ZZZ,ZZ9-.                01143002
011500     05  FILLER                      PIC X(09) VALUE              01150002
011600         ' UPC ID: '.                                             01160002
011700     05  DMU-INTERNAL-UPC            PIC 9999999999.              01170001
011800     05  FILLER                      PIC X(05) VALUE              01180001
011900         ' ON: '.                                                 01190001
012000     05  DMU-LAST-UPDATE-DTE         PIC X(10).                   01200001
012100                                                                  01210001
012200*                                                                 01220000
012300* IN-TRANSIT BALANCE TABLE                                        01230000
012400*                                                                 01240000
012500     EXEC SQL                                                     01250000
012600          INCLUDE PCT00014                                        01260000
012700     END-EXEC.                                                    01270000
012800                                                                  01280000
012900*                                                                 01290000
013000* IN-TRANSIT DETAIL TABLE                                         01300000
013100*                                                                 01310000
013200     EXEC SQL                                                     01320000
013300          INCLUDE PCT00015                                        01330000
013400     END-EXEC.                                                    01340000
013500*                                                                 01350001
013600*---------------------------------------------------------------* 01360001
013700*    DB2 AREA FOR XLT_SKU                                       * 01370001
013800*---------------------------------------------------------------* 01380001
013900     EXEC SQL                                                     01390001
014000          INCLUDE XLT00003                                        01400001
014100     END-EXEC.                                                    01410001
014200                                                                  01420001
014300                                                                  01430000
014400     COPY DPWS004.                                                01440000
014500                                                                  01450000
014600*  INPUT FILE                                                     01460001
014700     COPY PCRD080.                                                01470000
014800                                                                  01480000
014900*  OUTPUT FILE TO SEND TO GIV                                     01490001
015000     COPY PCRD041.                                                01500001
015100                                                                  01510001
015200     COPY DPWS004.                                                01520000
015300                                                                  01530000
015400     EXEC SQL                                                     01540000
015500         INCLUDE SQLCA                                            01550000
015600     END-EXEC.                                                    01560000
015700     COPY SQLCA2.                                                 01570000
015800/                                                                 01580000
015900 PROCEDURE DIVISION.                                              01590000
016000                                                                  01600000
016100     PERFORM 1000-INITIALIZE.                                     01610000
016200                                                                  01620000
016300     PERFORM 2000-PROCESS                                         01630000
016400             UNTIL PS-EOF-INPUT.                                  01640000
016500                                                                  01650000
016600     PERFORM 9000-QUIT.                                           01660000
016700                                                                  01670000
016800     GOBACK.                                                      01680000
016900                                                                  01690000
017000 1000-INITIALIZE.                                                 01700000
017100                                                                  01710000
017200     OPEN INPUT IN-TRANSIT-EXTRACT-FILE.                          01720000
017300     OPEN OUTPUT OUT-GIV-UPDATE-FILE.                             01730001
017400                                                                  01740000
017500     DISPLAY ' '.                                                 01750000
017600     DISPLAY '*****************************************'.         01760000
017700     DISPLAY '*                                       *'.         01770000
017800     DISPLAY '* PCKUP951 - UPDATE PCT_TRN_CLSN_BAL    *'.         01780004
017900     DISPLAY '*                                       *'.         01790000
018000                                                                  01800000
018100     PERFORM 7000-READ-INPUT.                                     01810000
018200                                                                  01820000
018300     DISPLAY '* PURGE DATE:  '  PC080-PURGE-DATE.                 01830000
018400     DISPLAY '*                                       *'.         01840000
018500     DISPLAY '*                                       *'.         01850000
018600                                                                  01860000
018700 2000-PROCESS.                                                    01870000
018800                                                                  01880000
018900     PERFORM 8000-SELECT-IT-BAL.                                  01890000
019000     PERFORM 8020-SELECT-IT-DTL.                                  01900000
019100     IF  PCT00015-TRN-CLSN-PRCG-QTY = PCT00014-TRN-CLSN-QTY       01910000
019200         ADD  1      TO   PV-NO-UPDATE-COUNT                      01920000
019300     ELSE                                                         01930000
019400         PERFORM 8030-UPDATE-IT-BAL                               01940000
019500     END-IF.                                                      01950000
019600                                                                  01960000
019700     PERFORM 7000-READ-INPUT.                                     01970000
019800                                                                  01980000
019900                                                                  01990000
020000 7000-READ-INPUT.                                                 02000000
020100                                                                  02010000
020200      READ IN-TRANSIT-EXTRACT-FILE                                02020000
020300      INTO PC080-INTRNST-PURGE-REC                                02030000
020400        AT END                                                    02040000
020500           SET PS-EOF-INPUT TO TRUE                               02050000
020600        NOT AT END                                                02060000
020700           ADD  1  TO  PV-EXTRACT-COUNT                           02070000
020800      END-READ.                                                   02080000
020900                                                                  02090000
021000      IF  PS-EOF-INPUT                                            02100000
021100          NEXT SENTENCE                                           02110000
021200      ELSE                                                        02120000
021300          ADD +1 TO PV-CHUNK-COUNT                                02130000
021400          IF  PV-CHUNK-COUNT >= 20000                             02140000
021500              MOVE PV-EXTRACT-COUNT TO PV-DISP-CHUNK-CNT          02150000
021600              DISPLAY 'PROCESSED RECORD:  ' PV-DISP-CHUNK-CNT     02160000
021700              MOVE ZERO TO PV-CHUNK-COUNT                         02170000
021800          ELSE                                                    02180000
021900              NEXT SENTENCE                                       02190000
022000          END-IF                                                  02200000
022100      END-IF.                                                     02210000
022200                                                                  02220000
022300 8000-SELECT-IT-BAL.                                              02230000
022400                                                                  02240000
022500      MOVE ZEROES                TO PCT00014-INTR-UPC-ID          02250000
022600                                    PCT00014-LOC-NBR.             02260000
022700      MOVE PC080-INTR-UPC-ID-KEY TO PCT00014-INTR-UPC-ID.         02270000
022800      MOVE PC080-LOC-NBR         TO PCT00014-LOC-NBR.             02280000
022900                                                                  02290000
023000      EXEC SQL                                                    02300000
023100           SELECT INTR_UPC_ID                                     02310000
023200                , LOC_NBR                                         02320000
023300                , TRN_CLSN_CDE                                    02330000
023400                , TRN_CLSN_QTY                                    02340000
023500                , LAST_UPD_DTE                                    02350000
023600                , CURRENT DATE                                    02360001
023700             INTO :PCT00014-INTR-UPC-ID                           02370000
023800                , :PCT00014-LOC-NBR                               02380000
023900                , :PCT00014-TRN-CLSN-CDE                          02390000
024000                , :PCT00014-TRN-CLSN-QTY                          02400000
024100                , :PCT00014-LAST-UPD-DTE                          02410000
024200                , :PC041-INTRNST-TRN-DTE                          02420001
024300             FROM PCT_TRN_CLSN_BAL                                02430000
024400           WHERE INTR_UPC_ID        =  :PCT00014-INTR-UPC-ID      02440000
024500             AND LOC_NBR            =  :PCT00014-LOC-NBR          02450000
024600             AND TRN_CLSN_CDE       =  :PC080-TRN-CLSN-CDE        02460000
024700           WITH UR                                                02470000
024800      END-EXEC.                                                   02480000
024900                                                                  02490000
025000                                                                  02500000
025100     EVALUATE TRUE                                                02510000
025200         WHEN SQLCODE = ZERO                                      02520000
025300              CONTINUE                                            02530000
025400                                                                  02540000
025500         WHEN SQLCODE = +100                                      02550000
025600              ADD  1                     TO PV-NOT-FND-COUNT      02560000
025700             DISPLAY 'NOT FOUND - '                               02570000
025800                     ' UPC ID:  ' PC080-INTR-UPC-ID               02580000
025900                     ' LOC NBR: ' PC080-LOC-NBR                   02590000
026000                     ' CODE:    ' PC080-TRN-CLSN-CDE              02600000
026100                     ' DATE:    ' PC080-PURGE-DATE                02610000
026200                                                                  02620000
026300         WHEN OTHER                                               02630000
026400             MOVE SQLCODE                TO PV-DISP-SQL           02640000
026500             DISPLAY '**************************************'     02650000
026600             DISPLAY 'ERROR ISSUED ON                       '     02660000
026700             DISPLAY ' SELECT INTRANSIT BALANCE             '     02670000
026800             DISPLAY 'SQLCODE: ' PV-DISP-SQL                      02680000
026900             DISPLAY 'UPC ID.: ' PC080-INTR-UPC-ID                02690000
027000             DISPLAY 'LOC NBR: ' PC080-LOC-NBR                    02700000
027100             DISPLAY 'CODE...: ' PC080-TRN-CLSN-CDE               02710000
027200             DISPLAY 'DATE...: ' PC080-PURGE-DATE                 02720000
027300             DISPLAY '**************************************'     02730000
027400             PERFORM 9100-SQL-ABEND                               02740000
027500                                                                  02750000
027600     END-EVALUATE.                                                02760000
027700                                                                  02770000
027800 8010-COMMIT.                                                     02780000
027900                                                                  02790000
028000      EXEC SQL                                                    02800000
028100         COMMIT                                                   02810000
028200      END-EXEC.                                                   02820000
028300                                                                  02830000
028400     MOVE PV-EXTRACT-COUNT            TO PV-DISP-EXTR-CNT.        02840000
028500     MOVE PV-UPDATE-COUNT             TO PV-DISP-UPDATE-CNT.      02850000
028600     MOVE PV-NO-UPDATE-COUNT          TO PV-DISP-NO-UPD-CNT.      02860000
028700     MOVE PV-NOT-FND-COUNT            TO PV-DISP-NOTFND-CNT.      02870000
028800                                                                  02880000
028900     DISPLAY '  * EXTRACT: '    PV-DISP-EXTR-CNT                  02890000
029000             '  * UPDATE: '     PV-DISP-UPDATE-CNT                02900000
029100             '  * NO UPD: '     PV-DISP-NO-UPD-CNT                02910000
029200             '  * NOT FOUND: '  PV-DISP-NOTFND-CNT.               02920000
029300                                                                  02930000
029400 8020-SELECT-IT-DTL.                                              02940000
029500                                                                  02950000
029600      MOVE ZEROES            TO PCT00015-INTR-UPC-ID              02960000
029700                                PCT00015-LOC-NBR.                 02970000
029800      MOVE PC080-INTR-UPC-ID-KEY TO PCT00015-INTR-UPC-ID.         02980000
029900      MOVE PC080-LOC-NBR         TO PCT00015-LOC-NBR.             02990000
030000                                                                  03000000
030100      EXEC SQL                                                    03010000
030200           SELECT SUM(TRN_CLSN_PRCG_QTY)                          03020000
030300             INTO :PCT00015-TRN-CLSN-PRCG-QTY                     03030000
030400             FROM PCT_TRN_CLSN_DTL                                03040000
030500           WHERE INTR_UPC_ID        =  :PCT00015-INTR-UPC-ID      03050000
030600             AND LOC_NBR            =  :PCT00015-LOC-NBR          03060000
030700             AND TRN_CLSN_CDE       =  :PC080-TRN-CLSN-CDE        03070000
030800             AND NOT TRN_TYP_CDE IN ('NS','UM','MM','AM','SM')    03080000
030900             AND DATE(IN_TRNST_TRN_TMST)                          03090000
031000                                    >  :PC080-PURGE-DATE          03100000
031100           WITH UR                                                03110000
031200      END-EXEC.                                                   03120000
031300                                                                  03130000
031400                                                                  03140000
031500     EVALUATE TRUE                                                03150000
031600         WHEN SQLCODE = ZERO                                      03160000
031700              CONTINUE                                            03170000
031800         WHEN SQLCODE = +100                                      03180000
031900         WHEN SQLCODE = -305                                      03190000
032000              MOVE ZEROES  TO  PCT00015-TRN-CLSN-PRCG-QTY         03200000
032100                                                                  03210000
032200         WHEN OTHER                                               03220000
032300             MOVE SQLCODE                TO PV-DISP-SQL           03230000
032400             DISPLAY '**************************************'     03240000
032500             DISPLAY 'ERROR ISSUED ON                       '     03250000
032600             DISPLAY ' SUM INTRNSIT DETAIL                  '     03260000
032700             DISPLAY 'SQLCODE: ' PV-DISP-SQL                      03270000
032800             DISPLAY 'UPC ID.: ' PC080-INTR-UPC-ID                03280000
032900             DISPLAY 'LOC NBR: ' PC080-LOC-NBR                    03290000
033000             DISPLAY 'CODE...: ' PC080-TRN-CLSN-CDE               03300000
033100             DISPLAY 'DATE...: ' PC080-PURGE-DATE                 03310002
033200             DISPLAY '**************************************'     03320000
033300             PERFORM 9100-SQL-ABEND                               03330000
033400                                                                  03340000
033500     END-EVALUATE.                                                03350000
033600                                                                  03360000
033700                                                                  03370000
033800 8030-UPDATE-IT-BAL.                                              03380000
033900                                                                  03390000
034000      MOVE ZEROES            TO PCT00015-INTR-UPC-ID              03400000
034100                                PCT00015-LOC-NBR.                 03410000
034200      MOVE PC080-INTR-UPC-ID-KEY TO PCT00015-INTR-UPC-ID.         03420000
034300      MOVE PC080-LOC-NBR         TO PCT00015-LOC-NBR.             03430000
034400                                                                  03440000
034500      MOVE PCT00014-TRN-CLSN-QTY      TO PV-DISP-BEFORE-QTY       03450000
034600      MOVE PCT00015-TRN-CLSN-PRCG-QTY TO PV-DISP-AFTER-QTY        03460000
034700*     DISPLAY '  INTR-UPC-ID: '  PC080-INTR-UPC-ID                03470000
034800*             '  LOC-NBR: '      PC080-LOC-NBR                    03480000
034900*             '  CODE: '         PC080-TRN-CLSN-CDE               03490000
035000*             '  BEFORE: '       PV-DISP-BEFORE-QTY               03500000
035100*             '  AFTER: '        PV-DISP-AFTER-QTY.               03510000
035200                                                                  03520000
035300                                                                  03530000
035400      EXEC SQL                                                    03540000
035500           UPDATE PCT_TRN_CLSN_BAL                                03550000
035600              SET TRN_CLSN_QTY      =  :PCT00015-TRN-CLSN-PRCG-QTY03560002
035700           WHERE INTR_UPC_ID        =  :PCT00015-INTR-UPC-ID      03570000
035800             AND LOC_NBR            =  :PCT00015-LOC-NBR          03580000
035900             AND TRN_CLSN_CDE       =  :PC080-TRN-CLSN-CDE        03590000
036000      END-EXEC.                                                   03600000
036100                                                                  03610000
036200     EVALUATE TRUE                                                03620000
036300         WHEN SQLCODE = ZERO                                      03630000
036400              ADD  1                     TO PV-COMMIT-COUNT       03640000
036500              ADD  1                     TO PV-UPDATE-COUNT       03650000
036600                                                                  03660000
036700              IF  PV-COMMIT-COUNT > 10                            03670000
036800                  PERFORM 8010-COMMIT                             03680000
036900                  MOVE ZEROES  TO  PV-COMMIT-COUNT                03690000
037000              END-IF                                              03700000
037100              PERFORM 8050-WRITE-OUTPUT                           03710001
037200                                                                  03720000
037300         WHEN SQLCODE = +100                                      03730000
037400              ADD  1                     TO PV-NOT-FND-COUNT      03740000
037500                                                                  03750000
037600         WHEN OTHER                                               03760000
037700             MOVE SQLCODE                TO PV-DISP-SQL           03770000
037800             DISPLAY '**************************************'     03780000
037900             DISPLAY 'ERROR ISSUED ON                       '     03790000
038000             DISPLAY ' UPDATE INTRANSIT BALANCE             '     03800000
038100             DISPLAY 'SQLCODE: ' PV-DISP-SQL                      03810000
038200             DISPLAY 'UPC ID.: ' PC080-INTR-UPC-ID                03820000
038300             DISPLAY 'LOC NBR: ' PC080-LOC-NBR                    03830000
038400             DISPLAY 'CODE...: ' PC080-TRN-CLSN-CDE               03840000
038500             DISPLAY '**************************************'     03850000
038600             PERFORM 9100-SQL-ABEND                               03860000
038700                                                                  03870000
038800     END-EVALUATE.                                                03880000
038900                                                                  03890000
039000                                                                  03900000
039100                                                                  03910000
039200 8050-WRITE-OUTPUT.                                               03920001
039300                                                                  03930001
039400     MOVE 0                           TO PC041-PO-NBR             03940001
039500                                         PC041-RCVR-SEQ-NBR.      03950001
039600     MOVE PCT00015-INTR-UPC-ID        TO PC041-INTR-UPC-ID.       03960001
039700     MOVE PCT00015-LOC-NBR            TO PC041-LOC-NBR.           03970001
039800     SUBTRACT PCT00014-TRN-CLSN-QTY                               03980001
039900         FROM PCT00015-TRN-CLSN-PRCG-QTY                          03990001
040000       GIVING PC041-TRN-CLSN-QTY.                                 04000001
040100     MOVE ' '                         TO PC041-BOSS-INDICATOR.    04010001
040200     SET PC041-GT-90 TO TRUE.                                     04020001
040300                                                                  04030001
040400     WRITE OUT-GIV-UPDATE-RECORD                                  04040001
040500      FROM PC041-UNBAL-SUMMARY-REC.                               04050001
040600     ADD +1 TO PV-WRITE-COUNT.                                    04060001
040700                                                                  04070001
040800     IF  PV-INTR-UPC-ID = PCT00015-INTR-UPC-ID                    04080001
040900         CONTINUE                                                 04090001
041000     ELSE                                                         04100001
041100         PERFORM 8070-GET-SKU-NUMBER                              04110001
041200         MOVE PCT00015-INTR-UPC-ID TO PV-INTR-UPC-ID              04120002
041300     END-IF.                                                      04130001
041400                                                                  04140002
041500     MOVE XLT00003-SKU-NBR TO DMU-SKU.                            04150002
041600     MOVE PCT00015-INTR-UPC-ID TO                                 04160002
041700          PV-LONG-INTR-UPC-ID.                                    04170002
042000     MOVE PV-LONG-INTR-UPC-ID TO                                  04200002
042100          DMU-INTERNAL-UPC.                                       04210002
042300     MOVE PC041-LOC-NBR TO                                        04230002
042500          DMU-STORE.                                              04250002
042700     MOVE PCT00015-TRN-CLSN-PRCG-QTY TO                           04270002
042900          DMU-DTL-QTY.                                            04290002
043000     MOVE PCT00014-TRN-CLSN-QTY TO                                04300002
043200          DMU-BAL-QTY.                                            04320002
043201     MOVE PC041-TRN-CLSN-QTY TO                                   04320102
043210          DMU-ADJ-QTY                                             04321002
043300     MOVE PCT00014-LAST-UPD-DTE TO                                04330002
043400          DMU-LAST-UPDATE-DTE                                     04340002
043500     DISPLAY DM-UNBALANCE-MESSAGE.                                04350002
043600                                                                  04360002
043700                                                                  04370001
043800 8070-GET-SKU-NUMBER.                                             04380001
043900                                                                  04390001
044000     EXEC SQL                                                     04400002
044100         SELECT  A.SKU_NBR                                        04410002
044200           INTO  :XLT00003-SKU-NBR                                04420002
044300           FROM  XLT_SKU  A                                       04430003
044400          WHERE  A.INTR_UPC_ID         = :PCT00015-INTR-UPC-ID    04440002
044500     END-EXEC.                                                    04450002
044600                                                                  04460001
044700     EVALUATE TRUE                                                04470001
044800         WHEN SQLCODE = ZERO                                      04480001
044900              CONTINUE                                            04490001
045000         WHEN SQLCODE = +100                                      04500001
045100              MOVE ZEROES  TO  XLT00003-SKU-NBR                   04510002
045200         WHEN OTHER                                               04520001
045300             MOVE SQLCODE                TO PV-DISP-SQL           04530001
045400             DISPLAY '**************************************'     04540001
045500             DISPLAY 'ERROR ISSUED IN 8070 PARAGRAPH        '     04550002
045600             DISPLAY ' SELECT OF XLT_SKU                    '     04560002
045700             DISPLAY 'SQLCODE: ' PV-DISP-SQL                      04570001
045800             DISPLAY 'UPC ID.: ' PC080-INTR-UPC-ID                04580001
045900             DISPLAY 'LOC NBR: ' PC080-LOC-NBR                    04590001
046000             DISPLAY 'CODE...: ' PC080-TRN-CLSN-CDE               04600001
046100             DISPLAY '**************************************'     04610001
046200             PERFORM 9100-SQL-ABEND                               04620001
046300                                                                  04630001
046400     END-EVALUATE.                                                04640001
046500                                                                  04650001
046600 9000-QUIT.                                                       04660001
046700                                                                  04670000
046800     MOVE PV-EXTRACT-COUNT            TO PV-DISP-EXTR-CNT.        04680000
046900     MOVE PV-UPDATE-COUNT             TO PV-DISP-UPDATE-CNT.      04690000
047000     MOVE PV-NO-UPDATE-COUNT          TO PV-DISP-NO-UPD-CNT.      04700000
047100     MOVE PV-NOT-FND-COUNT            TO PV-DISP-NOTFND-CNT.      04710000
047110     MOVE PV-WRITE-COUNT              TO PV-DISP-WRITE-CNT.       04711002
047200                                                                  04720000
047300     DISPLAY '*                                       *'.         04730000
047400     DISPLAY '* INPUT COUNT....: ' PV-DISP-EXTR-CNT.              04740002
047500     DISPLAY '* UPDATE COUNT...: ' PV-DISP-UPDATE-CNT.            04750000
047600     DISPLAY '* NO UPD COUNT...: ' PV-DISP-NO-UPD-CNT.            04760000
047700     DISPLAY '* NOT FOUND COUNT: ' PV-DISP-NOTFND-CNT.            04770000
047710     DISPLAY '* OUTPUT COUNT...: ' PV-DISP-WRITE-CNT.             04771002
047800     DISPLAY '*                                       *'.         04780000
047900     DISPLAY '*****************************************'.         04790000
048000                                                                  04800000
048100     CLOSE IN-TRANSIT-EXTRACT-FILE.                               04810000
048110     CLOSE OUT-GIV-UPDATE-FILE.                                   04811002
048200                                                                  04820000
048300 9100-SQL-ABEND.                                                  04830000
048400******************************************************************04840000
048500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04850000
048600*  ERROR OR WARNING CODE OCCURS.                                  04860000
048700******************************************************************04870000
048800     DISPLAY '9100-SQL-ABEND'.                                    04880000
048900     DISPLAY '** ABEND     **'.                                   04890000
049000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04900000
049100     DISPLAY '**              ** = '                              04910000
049200     MOVE SQLCODE TO PV-SQL-CODE.                                 04920000
049300     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    04930000
049400     MOVE +4013 TO ABEND-CODE.                                    04940000
049500     CALL 'ILBOABN0' USING ABEND-CODE.                            04950000
