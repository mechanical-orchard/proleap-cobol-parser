      *************************                                         00010003
       IDENTIFICATION DIVISION.                                         00020003
      *************************                                         00030003
       PROGRAM-ID.      XLKUT150.                                       00040003
       AUTHOR.          RYAN STAUFFACHER.                               00050003
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060003
       DATE-WRITTEN.    11/01/04.                                       00070003
       DATE-COMPILED.                                                   00080003
      ****************************************************************  00090003
      *                                                                 00100003
      * THIS PROGRAM WILL CREATE AN EXTRACT OF THE TTKTFMT TABLE.       00110003
      *                                                                 00120003
      ****************************************************************  00130003
       ENVIRONMENT DIVISION.                                            00140003
       CONFIGURATION SECTION.                                           00150003
       SOURCE-COMPUTER. IBM-3090.                                       00160003
       OBJECT-COMPUTER. IBM-3090.                                       00170003
       INPUT-OUTPUT SECTION.                                            00180003
                                                                        00190003
       FILE-CONTROL.                                                    00200003
           SELECT                      EXTRACT-FILE                     00210003
                                       ASSIGN TO OUT01.                 00220003
      *                                                                 00230003
      ***************                                                   00240003
       DATA DIVISION.                                                   00250003
      ***************                                                   00260003
      *                                                                 00270003
       FILE SECTION.                                                    00280003
       FD  EXTRACT-FILE                                                 00290003
           RECORDING MODE IS F                                          00300003
           RECORD CONTAINS 100 CHARACTERS                               00310003
           BLOCK CONTAINS 0 RECORDS.                                    00320003
       01  EXTRACT-RECORD                     PIC  X(100).              00330003
      *                                                                 00340003
      *************************                                         00350003
       WORKING-STORAGE SECTION.                                         00360003
      *************************                                         00370003
      *                                                                 00380003
      *************************************************                 00390003
      * PROGRAM VARIABLES                                               00400003
      *************************************************                 00410003
                                                                        00420003
       01 PROGRAM-VARIABLES.                                            00430003
          05 PV-ABEND-PARAGRAPH              PIC X(30)  VALUE SPACES.   00440003
          05 PV-FETCH-CNT                    PIC 999    VALUE ZEROS.    00450003
                                                                        00460003
      * PROGRAM ABEND CODES                                             00470003
       01 PV-ABEND-CODE                      PIC S9(04) VALUE +0        00480003
                                                             COMP SYNC. 00490003
          88 ABEND-4013-DB2-ERROR                       VALUE +4013.    00500003
                                                                        00510003
                                                                        00520003
       01 PS-PROGRAM-SWITCHES.                                          00530003
          05 NOT-END-OF-CURSOR-SW            PIC X(01)  VALUE 'N'.      00540003
             88 NOT-END-OF-CURSOR                       VALUE 'N'.      00550003
             88 END-OF-CURSOR                           VALUE 'Y'.      00560003
                                                                        00570003
      ******************************************************************00580003
      *    COPYBOOK FOR EXTRACT.                                        00590003
      ******************************************************************00600003
           COPY XLRD150.                                                00610003
                                                                        00620003
      ******************************************************************00630003
      *    DB2 DCLGEN FOR TICKET FORMAT TABLE                           00640003
      ******************************************************************00650003
           EXEC SQL                                                     00660003
                INCLUDE TTKTFMT                                         00670003
           END-EXEC.                                                    00680003
                                                                        00690003
      ******************************************************************00700003
      * INCLUDE SQL COMMUNICATION AREA                                  00710003
      ******************************************************************00720003
                                                                        00730003
           EXEC SQL                                                     00740003
              INCLUDE SQLCA                                             00750003
           END-EXEC.                                                    00760003
                                                                        00770003
      ******************************************************************00780003
      * INCLUDE SQL COMMUNICATION AREA2                                 00790003
      ******************************************************************00800003
                                                                        00810003
           COPY SQLCA2.                                                 00820003
      ******************************************************************00830003
      * DECLARE CURSOR                                                  00840003
      ******************************************************************00850003
                                                                        00860003
           EXEC SQL                                                     00870003
                DECLARE TKT_FMT_CSR CURSOR WITH HOLD FOR                00880003
                 SELECT DISTINCT TKT_FMT_ID,                            00890003
                                 TKT_FMT_DESC,                          00900003
                                 TYP_CDE,                               00910003
                                 TKT_FMT_NBR                            00920003
                   FROM TTKTFMT                                         00930003
               ORDER BY TKT_FMT_ID                                      00940003
            END-EXEC.                                                   00950003
      *                                                                 00960003
      ********************                                              00970003
       PROCEDURE DIVISION.                                              00980003
      ********************                                              00990003
      *                                                                 01000003
       A000-PROGRAM-MAINLINE.                                           01010003
                                                                        01020003
           OPEN OUTPUT EXTRACT-FILE.                                    01030003
           PERFORM A100-OPEN-CURSOR.                                    01040003
           PERFORM A200-PROCESS-CURSOR                                  01050003
               UNTIL END-OF-CURSOR.                                     01060003
           PERFORM A300-CLOSE-CURSOR.                                   01070003
                                                                        01080003
           DISPLAY PV-FETCH-CNT ' ROWS WERE READ FROM TTKTFMT'.         01090003
           CLOSE EXTRACT-FILE.                                          01100003
                                                                        01110003
           GOBACK.                                                      01120003
                                                                        01130003
      ******************************************************************01140003
      * A100-OPEN-CURSOR                                                01150003
      ******************************************************************01160003
                                                                        01170003
       A100-OPEN-CURSOR.                                                01180003
                                                                        01190003
           EXEC SQL                                                     01200003
               OPEN TKT_FMT_CSR                                         01210003
           END-EXEC.                                                    01220003
                                                                        01230003
           EVALUATE TRUE                                                01240003
               WHEN SQLCODE = ZEROS                                     01250003
                   CONTINUE                                             01260003
               WHEN OTHER                                               01270003
                   DISPLAY PV-ABEND-PARAGRAPH                           01280003
                   PERFORM Z100-SQL-ERROR                               01290003
           END-EVALUATE.                                                01300003
                                                                        01310003
      ******************************************************************01320003
      * A200-PROCESS-CURSOR                                             01330003
      ******************************************************************01340003
                                                                        01350003
       A200-PROCESS-CURSOR.                                             01360003
                                                                        01370003
           EXEC SQL                                                     01380003
               FETCH TKT_FMT_CSR                                        01390003
                   INTO :XL150-TKT-FMT-CDE,                             01400003
                        :XL150-TKT-FMT-DESC,                            01410003
                        :XL150-TKT-TYP-CDE,                             01420003
                        :XL150-TKT-FMT-NBR                              01430003
           END-EXEC.                                                    01440003
                                                                        01450003
           EVALUATE TRUE                                                01460003
               WHEN SQLCODE = 0                                         01470003
                     ADD 1 TO PV-FETCH-CNT                              01480003
                     WRITE EXTRACT-RECORD FROM XL150-TICKET-FMT-REC     01490003
               WHEN SQLCODE = +100                                      01500003
                              SET END-OF-CURSOR TO TRUE                 01510003
               WHEN OTHER                                               01520003
                              DISPLAY PV-ABEND-PARAGRAPH                01530003
                              PERFORM Z100-SQL-ERROR                    01540003
           END-EVALUATE.                                                01550003
                                                                        01560003
      ******************************************************************01570003
      * A300-CLOSE-CURSOR                                               01580003
      ******************************************************************01590003
                                                                        01600003
       A300-CLOSE-CURSOR.                                               01610003
                                                                        01620003
           EXEC SQL                                                     01630003
               CLOSE TKT_FMT_CSR                                        01640003
           END-EXEC.                                                    01650003
                                                                        01660003
           EVALUATE TRUE                                                01670003
             WHEN SQLCODE = 0                                           01680003
                 CONTINUE                                               01690003
             WHEN SQLWARN0 NOT = SPACES                                 01700003
             WHEN SQLCODE < 0                                           01710003
             WHEN SQLCODE > 0                                           01720003
                 DISPLAY PV-ABEND-PARAGRAPH                             01730003
                 PERFORM Z100-SQL-ERROR                                 01740003
           END-EVALUATE.                                                01750003
                                                                        01760003
      ******************************************************************01770003
      * Z100-SQL WARNING OR ERROR PROCESSING                            01780003
      ******************************************************************01790003
                                                                        01800003
       Z100-SQL-ERROR.                                                  01810003
           MOVE SQLCODE    TO SQLCODE2.                                 01820003
           MOVE SQLERRD(3) TO SQLERRD3.                                 01830003
           DISPLAY '** ABEND **       ** = SQLERROR'.                   01840003
           DISPLAY '** PROGRAM        ** = ????????'.                   01850003
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  01860003
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  01870003
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   01880003
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  01890003
           MOVE +4013 TO PV-ABEND-CODE.                                 01900003
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01910003
                                                                        01920003
