000100*-----------------------*                                         00010009
000200 IDENTIFICATION DIVISION.                                         00020009
000300*-----------------------*                                         00030009
000400 PROGRAM-ID.    APKCS327.                                         00040009
000500 AUTHOR.        LORI LIPKE                                        00050009
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060009
000700 DATE-WRITTEN.  06-94.                                            00070009
000800 DATE-COMPILED.                                                   00080009
000900                                                                  00090009
001000*---------------------------------------------------------------* 00100009
001100*    A327 - INVOICE ITEM LIST/UPDATE                            * 00110009
001200*                                                               * 00120009
001300*    THIS PROGRAM GENERATES A LIST OF OF ITEMS ASSOCIATED WITH  * 00130009
001400*    AN INVOICE.  THE PROGRAM ALLOWS UPDATES AT A LINE LEVEL    * 00140009
001500*    OF INVOICED QUANTITY AND INVOICE UNIT COST.                * 00150009
001600*                                                               * 00160009
001610*    UPDATE RULES:                                              * 00161088
001620*                                                               * 00162080
001630*    IF INVOICE TYPE IS WRITE OFF - NO UPDATES                  * 00163080
001640*    IF INVOICE TYPE IS EXPENSE - NO UPDATES                    * 00164080
001650*    IF STATUS IS DELETE - NO UPDATES                           * 00165080
001660*    IF STATUS IS PEND JRNL & NOT SEPHORA AT KOHLS - NO UPDATE  * 00166080
001661*    IF STATUS IS ENTERED & SEPHORA AT KOHLS & INVOICE TYPE IS  * 00166180
001670*          MERCHANDISE AND ENTRY METHOD IS EDI - NO UPDATE      * 00167080
001681*    IF STATUS IS ENTERED & SEPHORA AT KOHLS & INVOICE TYPE IS  * 00168180
001682*          MERCHANDISE AND ENTRY METHOD IS MANUAL - UPDATE OK   * 00168280
001683*          NOTE - IF THIS GOES INTO IMBALANCE - THE BUSINESS    * 00168386
001684*                 PROCESS IS TO DELETE THE SAME DAY.  IF IT IS  * 00168486
001685*                 LEFT OUT THERE, AND THE IMBALANCE IS FIXED AT * 00168586
001686*                 A LATER TIME, THE PGM WILL CHANGE THE STATUS  * 00168686
001687*                 TO PJ AND THE INVOICE WILL NOT GO TO KFS      * 00168786
001688*    IF STATUS IS ENTERED & SEPHORA AT KOHLS & INVOICE TYPE IS  * 00168886
001689*          REMAINDER - UPDATE OK                                * 00168986
001690*    IF REMAINDER INVOICE & NOT SEPHORA AT KOHLS - UPDATE OK    * 00169086
001691*    IF STATUS IS ENTERED & NOT SEPHORA AT KOHLS - UPDATE OK    * 00169186
001692*    IF STATUS IS PEND JRNL & SEPHORA AT KOHLS - UPDATE OK      * 00169286
001693*    IF STATUS IS RECONCILE - UPDATE OK                         * 00169386
001694*    IF STATUS IS ITEM IMBALANCED - UPDATE OK                   * 00169486
001700*                                                               * 00170086
001710*---------------------------------------------------------------* 00171080
001800*    NOTE - THIS IS AN UPDATED VERSION OF "A1" WITH LIST PRO-   * 00180009
001900*           CESSING INCORPORATED.  MB 9/1/94.                   * 00190009
002000*---------------------------------------------------------------* 00200009
002100*                                                               * 00210009
002200* CHANGE LOG:                                                   * 00220009
002300*                                                               * 00230009
002400* 09/26/94    BMW  RESERACHING -811, MULTIPLE ROWS IN 4050-     * 00240009
002500*                                                               * 00250009
002600* 01/17/95    BMW  REMOVED USE OF VALUE(PO_NBR, +0) IN THE      * 00260009
002700*                  WHERE CLAUSES.  IT WAS CAUSING A TABLESCAN.  * 00270009
002800*                                                               * 00280009
002900* 03/15/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00290009
003000*                    THE SCREEN FROM THE COMMAREA.              * 00300009
003100*                                                               * 00310009
003200* 07/27/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00320009
003300*                    THE SCREEN FROM THE DB2 TABLE INFORMATION. * 00330009
003400*                    THE APPROVED PO LINE NUMBER IS SET TO ZERO * 00340009
003500*                    IN THE COMMAREA WHEN THE PURCHASE ITEM IS  * 00350009
003600*                    NOT FOUND.  THIS WILL BE USED TO DISPLAY   * 00360009
003700*                    THE CORRECT PO LINE NUMBER IN THE INVOICE  * 00370009
003800*                    ITEM UPDATE PROGRAM.  THE STORE NUMBER IS  * 00380009
003900*                    BEING ADDED TO THE TOP OF THE SCREEN.      * 00390009
004000*                                                               * 00400009
004100* 08/02/95  MKK      CHANGED NEXT-ACT-RETURN TO RECALCULATE     * 00410009
004200*                    ITEM COST, PARA 2105.   THIS NEEDED TO BE  * 00420009
004300*                    DONE AFTER ROWS WERE RETRIEVED FROM THE    * 00430009
004400*                    DATABASE BUT BEFORE THE AREA WAS MOVED TO  * 00440009
004500*                    THE SCREEN SO THE PERFORM OF PARA 4400     * 00450009
004600*                    WAS TAKEN OUT OF 4000 AND INSTEAD EXECUTED * 00460009
004700*                    SEPARATELY WHEREVER 4000 IS PERFORMED.     * 00470009
004800*                    THIS CHANGE REMOVES THE PROBLEM WHERE THE  * 00480009
004900*                    SUM OF THE DETAIL LINES DOES NOT EQUAL THE * 00490009
005000*                    INVOICE GROSS COST AND THE INVOICE STATUS  * 00500009
005100*                    DID NOT INDICATE AN OUT OF BALANCE         * 00510009
005200*                    CONDITION.                                 * 00520009
005300*                                                               * 00530009
005400* 11/16/95      - IN 4400-MOVE-COMMAREA-TO-SCREEN, CHANGED TO     00540009
005500* MARY KING       CHECK FOR A STATUS OF 'PD' INSTEAD OF 'PY'.     00550009
005600*                                                                 00560009
005700* 11/29/95      - IN 8800-CHECK-IF-PROCESSED, REMOVED THE JOIN    00570009
005800* MARY KING       OF TINVOIC WITH TPOSTRR IN THE SELECT STATEMENT.00580009
005900*                 BECAUSE INVOICE CRITERIA WAS FORMERLY SPECIFIED,00590009
006000*                 UPDATES (SUCH AS RESETTING INVOICE STATUSES)    00600009
006100*                 WERE BEING ALLOWED EVEN THOUGH A PO/STORE       00610009
006200*                 COMBINATION HAD BEEN RELEASED.                  00620009
006300*                                                                 00630009
006400* 03/21/97 MJW  - ADDED LOGIC TO PREVENT THE ADDITION OF INVOICE  00640009
006500*                 LINES TO A WRITE OFF INVOICE.                   00650009
006600*                                                                 00660009
006700* 01/10/01    MAB  COMMENTED VARIOUS PARTS OF CODE WHERE ERROR  * 00670009
006800*                  MESSAGE 00851 IS USED TO STOP THE USER FROM  * 00680009
006900*                  UPDATING EDI EBTERED INVOICES.  ALSO RELATED * 00690009
007000*                  WAS CODE THAT REFERRED TO THE ENTR-MTHD-CDE  * 00700009
007100*                  BEING EQUAL TO 'ED'.  THIS WAS ALL DONE TO   * 00710009
007200*                  THE USER TO BE ABLE TO DO INVOICE DETAIL     * 00720009
007300*                  MODIFICATIONS SO THAT AP WON'T HAVE TO DO    * 00730009
007400*                  MULTIPLE PAY RELEASES.  THIS WILL CUT DOWN ON* 00740009
007500*                  THE MULTIPLE GENERATED SHORTAGES TO THE      * 00750009
007600*                  VENDOR ALSO.                 WR# 21576       * 00760009
007700*                                                               * 00770009
007800* 09/21/01    MAB  ADDED CODE TO BLOCK AN EXPENSE INVOICE FROM  * 00780009
007900*                  HAVING ANY OF ITS LINE ITEMS BEING UPDATED,  * 00790009
008000*                  DELETED OR ADDED.  ALSO ADDED LOGIC TO SHOW  * 00800009
008100*                  LITERAL FOR INVOICE STATUS OF 'PR' MEANING   * 00810009
008200*                  'PENDING RVW'.                               * 00820009
008300*                  VENDOR ALSO.                 WR# 20530       * 00830009
008400*                                                               * 00840009
008500* 02/22/02  CHANGED BY: MIKE BESKE              WR# 21278       * 00850011
008600*          - REPLACED THE TSK TABLE WITH TSKXREF AS PART        * 00860011
008700*            OF RETEK PROJECT PRELIM FOR AP.  (PARA 4340-)      * 00870011
008800*                                                               * 00880011
008900*   5/22/02  ADDED LABELS TO PO_NBR IN SQL WHERE JOINS OF       * 00890014
009000*            TINVOIC AND TPAYREQ IN ORDER TO DIFFERENTIATE THE  * 00900014
009100*            TABLE THE PO_NBR IS ORIGINATING FROM.              * 00910014
009200*             BY: MIKE BESKE                     WR: 23500      * 00920012
009300*                                                               * 00930012
009400*  11/04/02  COLBY DATING PROJECT.                                00940023
009500*            ELIMINATED TPAYREQ.  ADDED CODE TO HANDLE THE NEW  * 00950020
009600*            'PJ' STATUS CODE IN 1150- AND TO DISPLAY 'PENDNG   * 00960015
009700*            JRNL' ON THE ONLINE SCREEN.  CHANGED PAYT-REQ-SEQ- * 00970019
009800*            NBR TO PO-NBR AND INVC-ID IN 1155-.                * 00980019
009900*             BY: MIKE BESKE                     WR: 23750      * 00990015
010000*                                                               * 01000015
010100*  04/18/03  ADDED CODE FOR THE NI-SKU PROJECT.                 * 01010026
010200*            REPLACED THE USE OF CLASS AND SKU SEQ NBR BEING    * 01020026
010300*            DISPLAYED ON THE SCREEN.  NOW EITHER THE SKU FROM  * 01030026
010400*            TSKXREF OR THE RMS-PO-SKU-NBR FROM TPURITM WILL BE * 01040026
010500*            DISPLAYED.  TSKXREF WILL BE JOINED TO TPURITM IN   * 01050026
010600*            PARA 4330-.                                        * 01060026
010700*             BY: MIKE BESKE                     WR: 22557      * 01070026
010800*                                                               * 01080026
010900*  04/23/04  MODIFIED CODE TO DISPLAY THE STORE NUMBER AS 4     * 01090028
011000*            DIGITS AS PART OF THE STORE CONSTRAINTS PROJECT.   * 01100028
011100*             BY: MIKE BESKE                     WR: 25805      * 01110028
011200*                                                               * 01120028
011300*  07/17/06  COMMENTED VARIOUS PARTS OF CODE IN PARAGRAPHS      * 01130035
011400*            1150-GET-INVOICE-DATA, 2100-CHECK-FUNCTION-KEY,    * 01140035
011500*            AND 3200-RESET-ATTRIBUTES RELATED TO THE FIELD     * 01150036
011600*            ASC-PROTECT-RI-FIELDS.  THIS FIELD PREVENTS THE    * 01160036
011700*            USER FROM UPDATING REMAINDER INVOICES.  THESE      * 01170036
011800*            CHANGES WERE MADE TO ALLOW THE USER THE ABILITY TO * 01180036
011900*            MODIFY INVOICE DETAILS (SUCH AS THE NUMBER OF      * 01190039
012000*            PIECES AND UNIT COST) SO THAT AP WILL NOT HAVE TO  * 01200039
012100*            PERFORM MULTIPLE PAY RELEASES.                     * 01210038
012200*            BY: KRYSTEN LEARY                   WR: 30974      * 01220034
012300*                                                               * 01230034
012400*  DATE  12/05/2006                                             * 01240043
012500*      CHANGE MADE: MATCH BY DC MODIFICATIONS.                  * 01250043
012600*      CREATED ASC- FIELDS FOR DC_NBR AND MTCH_LVL_CDE.         * 01260043
012700*      ADDED DC_NBR AND MTCH_LVL_CDE TO SELECT IN PARA 1150-.   * 01270043
012800*      ADDED MOVES OF NEW FIELDS TO APWS300 INTER APPL COMM     * 01280043
012900*      COPYBOOK IN 2400- PARA.  ADDED MOVE OF ASC-KEY-DC-NBR    * 01290043
013000*      TO CICS MAP OUTPUT FIELD IN 4400- PARA.  REPLACED THE    * 01300043
013100*      USE OF STORE NUMBER WITH MATCH LEVEL CODE IN THE WHERE   * 01310043
013200*      CONDITION IN THE 8800- PARA.                             * 01320043
013300*      MADE BY: MIKE BESKE              WR/IR #: WR21578        * 01330043
013400*                                                               * 01340046
013500*  DATE  03/11/2007                                             * 01350047
013600*      CHANGE MADE: MATCH BY DC MODIFICATIONS.                  * 01360046
013700*      CORRECTED THE WHERE CONDITION IN PARA 8800- TO INCLUDE   * 01370046
013800*      THE STR_NBR.  THIS WAS DONE SO THE USERS COULD WORK ADDL * 01380046
013900*      UNRELEASED SAME PO_NBR / DIFF STR_NBR COMBS WITHOUT BEING* 01390046
014000*      BLOCKED BY PREVIOUSLY RELEASED SAME PO_NBR / DIFF STR_NBR* 01400046
014100*      COMBS FOR THE SAME MATCH LEVEL.                          * 01410046
014200*      MADE BY: MIKE BESKE              WR/IR #: WR21578        * 01420046
014210* DATE  09/01/2021                                                01421048
014220*            - CHANGE CALL OF 'DPKUT100' TO                     * 01422048
014230*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 01423048
014240*              MAKING THE CALL DYNAMIC VS STATIC                * 01424048
014250*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        01425050
014251* DATE  03/10/2022                                                01425175
014252*            - ALLOW INVOICES IN PJ STATUS TO BE UPDATED FOR    * 01425253
014253*              SEPHORA AT KOHLS.  RETURN THE STATUS_CDE TO THE  * 01425368
014254*              ORIGINAL VALUE, INSTEAD OF DEFAULTING TO 'EN'    * 01425468
014256*     MADE BY: JEAN KURK               WR/IR #: CHG0265588        01425668
014257* DATE  03/16/2022                                                01425775
014258*            - ALLOW SEPHORA INVOICES IN EN STATUS FOR          * 01425875
014259*              REMAINDER INVOICES TO BE UPDATED                 * 01425975
014261*     MADE BY: JEAN KURK               WR/IR #: CHG0267998        01426175
014262* DATE  05/02/2022                                                01426285
014263*            - ALLOW SEPHORA INVOICES IN EN STATUS FOR          * 01426380
014264*              MERCHANDISE INVOICES THAT ARE MANUALLY ENTERED   * 01426480
014265*              TO BE UPDATED                                    * 01426580
014267*            - CHANGE UPC LOGIC - INSTEAD OF EXCLUDING BY THE   * 01426785
014268*              RANGE OF 400000000000 TO 409999999999, USE THE   * 01426885
014269*              EDI_ORD_IND FIELD (IF 'Y' THEN INCLUDE)          * 01426985
014271*     MADE BY: JEAN KURK               WR/IR #: CHG0268204        01427180
014273* DATE  10/21/2022                                                01427388
014274*     ADD COPYBOOK DPWS930                                        01427488
014275*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API    01427588
014276*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864        01427688
014280*---------------------------------------------------------------* 01428048
014400 EJECT                                                            01440026
014500 ENVIRONMENT DIVISION.                                            01450026
014600                                                                  01460026
014700 DATA DIVISION.                                                   01470026
014800                                                                  01480026
014900 WORKING-STORAGE SECTION.                                         01490026
015000                                                                  01500026
015100 01  DK-DB2-KEYS.                                                 01510026
015200     05  DK-PO-NUMBER                   PIC S9(9)   VALUE ZERO    01520026
015300                                        COMP.                     01530026
015400     05  DK-HIGH-PO-NUMBER              PIC S9(9)   VALUE ZERO    01540026
015500                                        COMP.                     01550026
015600     05  DK-LOW-PO-NUMBER               PIC S9(9)   VALUE ZERO    01560026
015700                                        COMP.                     01570026
015800     05  DK-INVOICE-ID                  PIC  X(22)  VALUE SPACES. 01580026
015900     05  DK-HIGH-INVOICE-ID             PIC  X(22)  VALUE SPACES. 01590026
016000     05  DK-LOW-INVOICE-ID              PIC  X(22)  VALUE SPACES. 01600026
016100     05  DK-PAYT-REQ-SEQ-NBR            PIC S9(9)   VALUE ZERO    01610026
016200                                        COMP.                     01620026
016300     05  DK-DEPT-NBR                    PIC  X(3)   VALUE SPACES. 01630026
016400     05  DK-ENT-ID                      PIC S9(9)   VALUE ZERO    01640026
016500                                        COMP.                     01650026
016600 01  PC-PROGRAM-CONSTANTS.                                        01660026
016700*    05  PC-MIN-UPC                     PIC S9(15)V               01670084
016800*                                        VALUE +000400000000000   01680084
016900*                                                  COMP-3.        01690084
017000*    05  PC-MAX-UPC                     PIC S9(15)V               01700084
017100*                                        VALUE +000409999999999   01710084
017200*                                                  COMP-3.        01720084
017300     05  PC-MULTIPLE-UPC                PIC X(15)  VALUE          01730026
017400         'MORE THAN 1 UPC'.                                       01740026
017500     05  PC-NO-VENDOR-UPC               PIC X(15)  VALUE          01750026
017600         'NO VENDOR UPC  '.                                       01760026
017700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01770026
017800                                                    'AP327A  '.   01780026
017900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01790026
018000                                                    'APKM327 '.   01800026
018100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01810026
018200                                                    'APKCS327'.   01820026
018300     05  PC-Y-CODE                      PIC  X      VALUE 'Y'.    01830084
018310     05  PC-LIST-QUEUE-SEQ              PIC  X      VALUE '1'.    01831084
018400     05  PC-SEL-QUEUE-SEQ-OUT           PIC  X      VALUE '3'.    01840026
018500     05  PC-DELETE                      PIC  X(02)  VALUE 'DE'.   01850026
018600     05  PC-ENTERED                     PIC  X(02)  VALUE 'EN'.   01860026
018700     05  PC-OPEN-TO-PAY                 PIC  X(02)  VALUE 'OP'.   01870026
018800     05  PC-PAID                        PIC  X(02)  VALUE 'PD'.   01880026
018900     05  PC-PENDING-JOURNALIZATION      PIC  X(02)  VALUE 'PJ'.   01890026
019000     05  PC-RECONCILED                  PIC  X(02)  VALUE 'RC'.   01900026
019100     05  PC-RELEASED                    PIC  X(02)  VALUE 'RC'.   01910026
019200     05  PC-OUT-OF-BALANCE              PIC  X(02)  VALUE 'OB'.   01920026
019300     05  PC-ITEM-IMBALANCE              PIC  X(02)  VALUE 'IB'.   01930026
019400     05  PC-ACTIVE                      PIC  X      VALUE 'A'.    01940026
019500     05  PC-TYPE-04                     PIC  XX     VALUE '04'.   01950026
019600     05  PC-TYPE-01                     PIC  XX     VALUE '01'.   01960026
019700     05  PC-EACH                        PIC  XX     VALUE 'EA'.   01970026
019800*    05  PC-EDI                         PIC  X(2)   VALUE 'ED'.   01980037
019900     05  PC-EI                          PIC  X(2)   VALUE 'EI'.   01990026
020000     05  PC-RI                          PIC  X(2)   VALUE 'RI'.   02000076
020010     05  PC-MN                          PIC  X(2)   VALUE 'MN'.   02001080
020100     05  PC-WO                          PIC  X(2)   VALUE 'WO'.   02010026
020200     05  PC-PURCH-ORDER                 PIC  X      VALUE 'P'.    02020026
020300     05  PC-INQ                         PIC  X(01)  VALUE 'I'.    02030026
020400     05  PC-UPD                         PIC  X(01)  VALUE 'U'.    02040026
020500     05  PC-DEL                         PIC  X(01)  VALUE 'D'.    02050026
020600     05  PC-ERR                         PIC  X(01)  VALUE 'E'.    02060026
020700     05  PC-PO-NBR-HIGH                 PIC S9(9)   VALUE         02070026
020800          +999999999                    COMP.                     02080026
020900     05  PC-PO-NBR-LOW                 PIC S9(9)   VALUE ZERO     02090026
021000                                        COMP.                     02100026
021100     05  PC-UNAPPROVED                  PIC  X(3)   VALUE 'WKS'.  02110026
021200     05  PC-ASTERICK                    PIC  X(4)   VALUE '****'. 02120026
021300     05  PC-NO-CHARGE                   PIC  X(06)  VALUE         02130026
021400                                                   '    NC'.      02140026
021500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     02150026
021600                                                    COMP SYNC.    02160026
021700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      02170026
021800                                                    COMP SYNC.    02180026
021900     05  PC-MAX-RETRIES                 PIC S9(04)  VALUE +3      02190026
022000                                                    COMP SYNC.    02200026
022100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         02210026
022200                                                    +1000000      02220026
022300                                                    COMP-3.       02230026
022400     05  PC-LIST-NUMBER-LENGTH          PIC S9(04)  VALUE +7      02240026
022500                                                    COMP SYNC.    02250026
022600*                                                                 02260026
022700     05  PC-TSYMSG-NUMBERS.                                       02270026
022800         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  02280026
022900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  02290026
023000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  02300026
023100         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  02310026
023200         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  02320026
023300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  02330026
023400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  02340026
023500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  02350026
023600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  02360026
023700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  02370026
023800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  02380026
023900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  02390026
024000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  02400026
024100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  02410026
024200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  02420026
024300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  02430026
024400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  02440026
024500         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  02450026
024600         10  PC-TSYMSG-00170            PIC  9(05)  VALUE 00170.  02460026
024700         10  PC-TSYMSG-00240            PIC  9(05)  VALUE 00240.  02470026
024800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  02480026
024900         10  PC-TSYMSG-00308            PIC  9(05)  VALUE 00308.  02490026
025000         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  02500026
025100         10  PC-TSYMSG-00393            PIC  9(05)  VALUE 00393.  02510026
025200         10  PC-TSYMSG-00455            PIC  9(05)  VALUE 00455.  02520026
025300         10  PC-TSYMSG-00468            PIC  9(05)  VALUE 00468.  02530026
025400         10  PC-TSYMSG-00470            PIC  9(05)  VALUE 00470.  02540026
025500         10  PC-TSYMSG-00471            PIC  9(05)  VALUE 00471.  02550026
025600         10  PC-TSYMSG-00472            PIC  9(05)  VALUE 00472.  02560026
025700         10  PC-TSYMSG-00536            PIC  9(05)  VALUE 00536.  02570026
025800         10  PC-TSYMSG-00849            PIC  9(05)  VALUE 00849.  02580026
025900         10  PC-TSYMSG-00850            PIC  9(05)  VALUE 00850.  02590026
026000         10  PC-TSYMSG-00851            PIC  9(05)  VALUE 00851.  02600026
026100         10  PC-TSYMSG-00852            PIC  9(05)  VALUE 00852.  02610026
026200         10  PC-TSYMSG-00853            PIC  9(05)  VALUE 00853.  02620026
026300         10  PC-TSYMSG-00854            PIC  9(05)  VALUE 00854.  02630026
026400         10  PC-TSYMSG-00855            PIC  9(05)  VALUE 00855.  02640026
026500         10  PC-TSYMSG-00872            PIC  9(05)  VALUE 00872.  02650026
026600         10  PC-TSYMSG-00935            PIC  9(05)  VALUE 00935.  02660026
026700         10  PC-TSYMSG-00942            PIC  9(05)  VALUE 00942.  02670026
026800         10  PC-TSYMSG-00961            PIC  9(05)  VALUE 00961.  02680026
026900         10  PC-TSYMSG-00970            PIC  9(05)  VALUE 00970.  02690026
027000         10  PC-TSYMSG-01517            PIC  9(05)  VALUE 01517.  02700026
027100         10  PC-TSYMSG-02699            PIC  9(05)  VALUE 02699.  02710026
027200*                                                                 02720026
027300 01  PS-PROGRAM-SWITCHES.                                         02730026
027400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02740026
027500         88  PS-NO-ERROR                            VALUE 'Y'.    02750026
027600         88  PS-ERROR-ALLOW-PAGING                  VALUE 'P'.    02760026
027700         88  PS-ERROR                               VALUE 'N'.    02770026
027800     05  PS-PROBLEM-LINE-SW             PIC  X(01)  VALUE 'N'.    02780026
027900         88  PS-ERROR-ON-LINE                       VALUE '1'.    02790026
028000         88  PS-WARNING-ON-LINE                     VALUE '2'.    02800026
028100         88  PS-NO-PROBLEM-ON-LINE                  VALUE 'N'.    02810026
028200     05  PS-LINE-ERROR-SW               PIC  X(01)  VALUE 'Y'.    02820026
028300         88  PS-LINE-ERROR                          VALUE 'Y'.    02830026
028400         88  PS-NO-LINE-ERROR                       VALUE 'N'.    02840026
028500     05  PS-GO-WARNING-SW               PIC  X(01)  VALUE 'N'.    02850026
028600         88  PS-GO-WARNING                          VALUE 'Y'.    02860026
028700         88  PS-NO-WARNING                          VALUE 'N'.    02870026
028800     05  PS-LINE-WARNING-SW             PIC  X(01)  VALUE 'Y'.    02880026
028900         88  PS-LINE-WARNING                        VALUE 'Y'.    02890026
029000         88  PS-NO-LINE-WARNING                     VALUE 'N'.    02900026
029100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02910026
029200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02920026
029300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02930026
029400     05  PS-DISPLAYED-LINE-SW           PIC  X(01)  VALUE 'N'.    02940026
029500         88  PS-NON-DISPLAYED-LINE                  VALUE 'Y'.    02950026
029600         88  PS-DISPLAYED-LINE                      VALUE 'N'.    02960026
029700     05  PS-ITEM-FOUND-SW               PIC  X(01)  VALUE 'N'.    02970026
029800         88  PS-ITEM-FOUND                          VALUE 'Y'.    02980026
029900         88  PS-ITEM-NOT-FOUND                      VALUE 'N'.    02990026
030000     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    03000026
030100         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    03010026
030200         88  PS-START-ITEM-ERROR                    VALUE 'N'.    03020026
030300                                                                  03030026
030400*                                                                 03040026
030500 01  PV-PROGRAM-VARIABLES.                                        03050026
030600     05  PV-DB2-COUNT                   PIC S9(4) COMP VALUE ZERO.03060026
030700     05  PV-PO-NBR.                                               03070026
030800         10  PV-PO-NBR-9                PIC 9(4)    VALUE  0.     03080026
030900     05 PV-PAYT-REQ-LNE-NBR             PIC S9(4)    COMP.        03090026
031000     05  PV-UPC-NBR                     PIC 9(15).                03100026
031100     05  PV-UPC-NBR-X REDEFINES PV-UPC-NBR                        03110026
031200                                        PIC X(15).                03120026
031300     05  PV-UPC-NBR-DISPLAY             PIC X(16)   VALUE SPACES. 03130026
031400     05  PV-SKU-NBR                     PIC 9(08).                03140026
031500     05  PV-SKU-NBR-X REDEFINES PV-SKU-NBR                        03150026
031600                                        PIC X(08).                03160026
031700     05  PV-VENDOR-STYLE                PIC X(12)   VALUE SPACES. 03170026
031800     05  PV-COLOR-CDE                   PIC X(3)    VALUE SPACES. 03180026
031900     05  PV-SIZE-CDE                    PIC X(5)    VALUE SPACES. 03190026
032000     05  PV-INVOICE-LINE                PIC 9(4)    VALUE 0.      03200026
032100     05  PV-UNIT-COST                   PIC X(9)    VALUE SPACES. 03210026
032200     05  PV-UNIT-COST-9 REDEFINES                                 03220026
032300          PV-UNIT-COST                  PIC ZZZZZ9.99.            03230026
032400     05  PV-PIECES                      PIC X(6)    VALUE SPACES. 03240026
032500     05  PV-PIECES-9 REDEFINES                                    03250026
032600          PV-PIECES                     PIC 9(6).                 03260026
032700     05  PV-APP-PO-LNE-NBR              PIC 9(4)    VALUE 0.      03270026
032800     05  PV-PO-LNE-NBR                  PIC 9(4)    VALUE 0.      03280026
032900     05  PV-TOTAL-PIECES                PIC S9(7)   VALUE +0      03290026
033000                                                    COMP SYNC.    03300026
033100     05  PV-PER-UNIT-COST               PIC S9(10)V9(3)           03310026
033200                                                    COMP-3.       03320026
033300     05  PV-PO-NBRI                     PIC S9(04)  VALUE +0      03330026
033400                                                    COMP.         03340026
033500     05  PV-WARNING-SUB                 PIC S9(04)  VALUE +0.     03350026
033600     05  PV-SUB                         PIC S9(04)  VALUE +0      03360026
033700                                                    COMP SYNC.    03370026
033800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      03380026
033900                                                    COMP SYNC.    03390026
034000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      03400026
034100                                                    COMP-3.       03410026
034200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      03420026
034300                                                    COMP-3.       03430026
034400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      03440026
034500                                                    COMP-3.       03450026
034600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      03460026
034700                                                    COMP-3.       03470026
034800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      03480026
034900                                                    COMP-3.       03490026
035000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      03500026
035100                                                    COMP-3.       03510026
035200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      03520026
035300                                                    COMP-3.       03530026
035400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      03540026
035500                                                    COMP SYNC.    03550026
035600     05  PV-HOLD-BLOCK-NUMBER           PIC S9(04)  VALUE +0      03560026
035700                                                    COMP SYNC.    03570026
035800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      03580026
035900                                                    COMP SYNC.    03590026
036000     05  PV-ITEM                        PIC S9(04)  VALUE +0      03600026
036100                                                    COMP SYNC.    03610026
036200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      03620026
036300                                                    COMP SYNC.    03630026
036400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      03640026
036500                                                    COMP SYNC.    03650026
036600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      03660026
036700                                                    COMP SYNC.    03670026
036800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      03680026
036900                                                    COMP SYNC.    03690026
037000     05  PV-FIRST-ERROR-ITEM            PIC 9(09)   VALUE 0.      03700026
037100     05  PV-FIRST-WARNING-ITEM          PIC 9(09)   VALUE 0.      03710026
037200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      03720026
037300                                                    COMP SYNC.    03730026
037400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03740026
037500                                                    COMP SYNC.    03750026
037600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03760026
037700                                                    COMP SYNC.    03770026
037800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      03780026
037900                                                    COMP SYNC.    03790026
038000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      03800026
038100                                                    COMP SYNC.    03810026
038200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      03820026
038300                                                    COMP SYNC.    03830026
038400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03840026
038500                                                    COMP SYNC.    03850026
038600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      03860026
038700                                                    COMP SYNC.    03870026
038800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      03880026
038900                                                    COMP SYNC.    03890026
039000     05  PV-DISPLAY-UNIT-COST           PIC ZZZZZ9.99.            03900026
039100     05  PV-KEY-STORE-NBR               PIC 9(4)    VALUE ZERO.   03910026
039200     05  PV-KEY-STORE-NBR-UNPK          PIC S9(4)   VALUE ZERO.   03920033
039300     05  PV-KEY-DC-NBR                  PIC 9(4)    VALUE ZERO.   03930041
039400     05  PV-KEY-DC-NBR-UNPK             PIC S9(4)   VALUE ZERO.   03940041
039500******************************************************************03950026
039600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03960026
039700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03970026
039800**  APPLICATION-SPECIFIC COMMAREA.                              **03980026
039900******************************************************************03990026
040000 01  LQW-LIST-QUEUE-WORK-AREA.                                    04000026
040100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  04010026
040200     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           04020026
040300                                        INDEXED BY LQW-IDX.       04030026
040400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)V COMP-3.       04040026
040500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               04050026
040600         10  LQW-SELECTED-SW            PIC  X(01).               04060026
040700             88  LQW-SELECT                         VALUE 'S'.    04070026
040800             88  LQW-DESELECT                       VALUE ' '.    04080026
040900         10  LQW-ACTION                 PIC  X(01).               04090026
041000         10  LQW-PAYT-REQ-LNE-NBR       PIC S9(4)   COMP.         04100026
041100         10  LQW-PIECES-ALL.                                      04110026
041200             20  LQW-INP-PIECES         PIC X(6).                 04120026
041300             20  LQW-PIECES             PIC 9(6).                 04130026
041400         10  LQW-UNIT-COST.                                       04140026
041500             20  LQW-UNIT-COST-X        PIC X(9).                 04150026
041600             20  LQW-UNIT-COST-9        PIC 9(7)V99.              04160026
041700         10  LQW-APP-PO-LINE-NBR        PIC 9(4).                 04170026
041800         10  LQW-PO-LINE-NBR            PIC 9(4).                 04180026
041900         10  LQW-UPC-CODE               PIC X(16).                04190026
042000         10  LQW-SKU                    PIC X(8).                 04200026
042100         10  LQW-VENDOR-STYLE           PIC X(12).                04210026
042200         10  LQW-COLOR                  PIC X(3).                 04220026
042300         10  LQW-SIZE                   PIC X(5).                 04230026
042400         10  LQW-INVOICE-LINE           PIC 9(4).                 04240026
042500         10  LQW-LINE-UPDATED-SW        PIC X.                    04250026
042600         10  LQW-LINE-PROBLEM-SW        PIC X.                    04260026
042700                                                                  04270026
042800     EJECT                                                        04280026
042900                                                                  04290026
043000*---------------------------------------------------------------* 04300026
043100*   AP SELECTION TSQ LAYOUT                                     * 04310026
043200*---------------------------------------------------------------* 04320026
043300     COPY APWS301.                                                04330026
043400                                                                  04340026
043500     EJECT                                                        04350026
043600*---------------------------------------------------------------* 04360026
043700*    MAP LAYOUT                                                 * 04370026
043800*---------------------------------------------------------------* 04380026
043900                                                                  04390026
044000     COPY APKM327.                                                04400026
044100*                                                                 04410026
044200 01  AP-OCCURS-LAYOUT                   REDEFINES  AP327AO.       04420026
044300     05  FILLER                         PIC X(198).               04430040
044400     05  AP-SCROLL-AREA                 OCCURS 11 TIMES.          04440026
044500         10  AP-SELECTL                 PIC S9(04) COMP.          04450026
044600         10  AP-SELECTA                 PIC  X(01).               04460026
044700         10  AP-SELECTC                 PIC  X(01).               04470026
044800         10  AP-SELECTH                 PIC  X(01).               04480026
044900         10  AP-SELECT                  PIC  X(01).               04490026
045000                                                                  04500026
045100         10  AP-ACTIONL                 PIC S9(04) COMP.          04510026
045200         10  AP-ACTIONA                 PIC  X(01).               04520026
045300         10  AP-ACTIONC                 PIC  X(01).               04530026
045400         10  AP-ACTIONH                 PIC  X(01).               04540026
045500         10  AP-ACTION                  PIC  X(01).               04550026
045600                                                                  04560026
045700         10  AP-PIECESL                 PIC S9(04) COMP.          04570026
045800         10  AP-PIECESA                 PIC  X(01).               04580026
045900         10  AP-PIECESC                 PIC  X(01).               04590026
046000         10  AP-PIECESH                 PIC  X(01).               04600026
046100         10  AP-PIECES                  PIC  X(6).                04610026
046200         10  AP-PIECES-9 REDEFINES                                04620026
046300             AP-PIECES                  PIC  ZZZZZZ.              04630026
046400                                                                  04640026
046500         10  AP-UNIT-COSTL              PIC S9(04) COMP.          04650026
046600         10  AP-UNIT-COSTA              PIC  X(01).               04660026
046700         10  AP-UNIT-COSTC              PIC  X(01).               04670026
046800         10  AP-UNIT-COSTH              PIC  X(01).               04680026
046900         10  AP-UNIT-COST               PIC  X(9).                04690026
047000         10  AP-UNIT-COST-9  REDEFINES                            04700026
047100             AP-UNIT-COST               PIC ZZZZZZ.ZZ.            04710026
047200                                                                  04720026
047300         10  AP-PO-LINEL                PIC S9(04) COMP.          04730026
047400         10  AP-PO-LINEA                PIC  X(01).               04740026
047500         10  AP-PO-LINEC                PIC  X(01).               04750026
047600         10  AP-PO-LINEH                PIC  X(01).               04760026
047700         10  AP-PO-LINE                 PIC  X(4).                04770026
047800         10  AP-PO-LINE-9 REDEFINES                               04780026
047900             AP-PO-LINE                 PIC  ZZZ9.                04790026
048000                                                                  04800026
048100         10  AP-UPC-CODEL               PIC S9(04) COMP.          04810026
048200         10  AP-UPC-CODEA               PIC  X(01).               04820026
048300         10  AP-UPC-CODEC               PIC  X(01).               04830026
048400         10  AP-UPC-CODEH               PIC  X(01).               04840026
048500         10  AP-UPC-CODE                PIC  X(16).               04850026
048600                                                                  04860026
048700         10  AP-SKUL                    PIC S9(04) COMP.          04870026
048800         10  AP-SKUA                    PIC  X(01).               04880026
048900         10  AP-SKUC                    PIC  X(01).               04890026
049000         10  AP-SKUH                    PIC  X(01).               04900026
049100         10  AP-SKU                     PIC  X(8).                04910026
049200                                                                  04920026
049300         10  AP-STYLEL                  PIC S9(04) COMP.          04930026
049400         10  AP-STYLEA                  PIC  X(01).               04940026
049500         10  AP-STYLEC                  PIC  X(01).               04950026
049600         10  AP-STYLEH                  PIC  X(01).               04960026
049700         10  AP-STYLE                   PIC  X(12).               04970026
049800                                                                  04980026
049900         10  AP-COLORL                  PIC S9(04) COMP.          04990026
050000         10  AP-COLORA                  PIC  X(01).               05000026
050100         10  AP-COLORC                  PIC  X(01).               05010026
050200         10  AP-COLORH                  PIC  X(01).               05020026
050300         10  AP-COLOR                   PIC  X(3).                05030026
050400                                                                  05040026
050500         10  AP-SIZEL                   PIC S9(04) COMP.          05050026
050600         10  AP-SIZEA                   PIC  X(01).               05060026
050700         10  AP-SIZEC                   PIC  X(01).               05070026
050800         10  AP-SIZEH                   PIC  X(01).               05080026
050900         10  AP-SIZE                    PIC  X(5).                05090026
051000                                                                  05100026
051100         10  AP-INVOICE-LINEL           PIC S9(04) COMP.          05110026
051200         10  AP-INVOICE-LINEA           PIC  X(01).               05120026
051300         10  AP-INVOICE-LINEC           PIC  X(01).               05130026
051400         10  AP-INVOICE-LINEH           PIC  X(01).               05140026
051500         10  AP-INVOICE-LINE            PIC  X(04).               05150026
051600         10  AP-INVOICE-LINE-9  REDEFINES                         05160026
051700             AP-INVOICE-LINE            PIC ZZZ9.                 05170026
051800                                                                  05180026
051900     05  AP-SEL-ITEML               PIC S9(04) COMP.              05190026
052000     05  AP-SEL-ITEMA               PIC  X(01).                   05200026
052100     05  AP-SEL-ITEMC               PIC  X(01).                   05210026
052200     05  AP-SEL-ITEMH               PIC  X(01).                   05220026
052300     05  AP-SEL-ITEM                PIC  X(07).                   05230026
052400     05  AP-SEL-ITEM-9      REDEFINES                             05240026
052500             AP-SEL-ITEM                PIC ZZZ,ZZ9.              05250026
052600                                                                  05260026
052700     EJECT                                                        05270026
052800*---------------------------------------------------------------* 05280026
052900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05290026
053000*---------------------------------------------------------------* 05300026
053100                                                                  05310026
053200     COPY DPWS015.                                                05320026
053300                                                                  05330026
053400*---------------------------------------------------------------* 05340026
053500*    DATE AND TIME COPYBOOK.                                    * 05350026
053600*---------------------------------------------------------------* 05360026
053700                                                                  05370026
053800     COPY DPWS017.                                                05380026
053900                                                                  05390026
054000*---------------------------------------------------------------* 05400026
054100*    FUNCTION KEYS COPYBOOK.                                    * 05410026
054200*---------------------------------------------------------------* 05420026
054300                                                                  05430026
054400     COPY DPWS016.                                                05440026
054500                                                                  05450026
054600*---------------------------------------------------------------* 05460026
054700*    NUMERIC EDIT LAYOUT.                                       * 05470026
054800*---------------------------------------------------------------* 05480026
054900                                                                  05490026
055000     COPY DPWS010I.                                               05500026
055100 EJECT                                                            05510026
055200*---------------------------------------------------------------* 05520026
055300*    CALLING PARAMETES FOR THE LOCKING MODULE.                  * 05530026
055400*---------------------------------------------------------------* 05540026
055500                                                                  05550026
055600     COPY DPWS044.                                                05560026
055700 EJECT                                                            05570026
055800*---------------------------------------------------------------* 05580026
055900*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 05590026
056000*---------------------------------------------------------------* 05600026
056100                                                                  05610026
056200     COPY DPWS030.                                                05620026
056210     COPY DPWS930.                                                05621088
056300 EJECT                                                            05630026
056400*---------------------------------------------------------------* 05640026
056500*    STANDARD COMMAREA.                                         * 05650026
056600*---------------------------------------------------------------* 05660026
056700                                                                  05670026
056800     COPY DPWS020.                                                05680026
056900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05690026
057000                                                                  05700026
057100*---------------------------------------------------------------* 05710026
057200* INTER-APPLICATION COMMAREA.                                   * 05720026
057300*   APWS300 - IS THE INPUT LAYOUT THAT HAS BEEN PASSED TO THIS  * 05730026
057400*             PROGRAMMING FROM APKCS320 AND APKCS324            * 05740026
057500*           - IS ALSO THE OUTPUT LAYOUT THAT WILL BE PASSED TO  * 05750026
057600*             OTHER PROGRAMS                                    * 05760026
057700*---------------------------------------------------------------* 05770026
057800                                                                  05780026
057900         10  INTER-APPL-COMM-AREA       PIC X(200).               05790026
058000     COPY APWS300.                                                05800026
058100*---------------------------------------------------------------* 05810026
058200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05820026
058300*---------------------------------------------------------------* 05830026
058400         10  ASC-SPECIFIC-COMMAREA.                               05840026
058500             15  ASC-INT-APPL-FORMAT-IND             PIC X.       05850026
058600                 88  ASC-INTER-APPL-CRIT-SPEC          VALUE '1'. 05860026
058700                 88  ASC-INTER-APPL-LIST               VALUE '5'. 05870026
058800             15  ASC-LIST-KEYS.                                   05880026
058900                 20  ASC-KEY-PO-NUMBER               PIC S9(9)    05890026
059000                                                     COMP.        05900026
059100                 20  ASC-KEY-INVOICE-ID              PIC  X(22).  05910026
059200                 20  ASC-KEY-DEPT-NBR                PIC  X(3).   05920026
059300                 20  ASC-KEY-ENT-ID                  PIC S9(9)    05930026
059400                                                     COMP.        05940026
059500                 20  ASC-KEY-STORE-NUMBER            PIC S9(4)    05950026
059600                                                     COMP.        05960026
059700                 20  ASC-KEY-PAYT-REQ-SEQ-NBR        PIC S9(9)    05970026
059800                                                     COMP.        05980026
059900                 20  ASC-KEY-TOTAL-PIECES            PIC S9(9)    05990026
060000                                                     COMP.        06000026
060100                 20  ASC-KEY-GRO-COST-AMT            PIC S9(9)V99 06010026
060200                                                     COMP-3.      06020026
060300                 20  ASC-KEY-INVC-TYP-CDE            PIC  X(2).   06030026
060400                 20  ASC-KEY-INVC-STATUS             PIC  X(2).   06040026
060410                 20  ASC-ORIG-INVC-STATUS            PIC  X(2).   06041052
060500                 20  ASC-CALC-TOTAL-PIECES           PIC S9(9)    06050026
060600                                                     COMP.        06060026
060700                 20  ASC-CALC-TOTAL-COST             PIC S9(9)V99 06070026
060800                                                     COMP-3.      06080026
060900                 20  ASC-VENDOR-DESC.                             06090026
061000                     25  ASC-VENDOR-DESC-10          PIC X(10).   06100026
061100                     25  FILLER                      PIC X(20).   06110026
061200                 20  ASC-KEY-DC-NBR                  PIC S9(4)    06120041
061300                                                     COMP.        06130041
061400                 20  ASC-KEY-MTCH-LVL-CDE            PIC X(01).   06140041
061410*                20  ASC-SEPHORA-IND                 PIC X.       06141087
061420                 20  ASC-SEPHORA-PJ-IND              PIC X.       06142087
061500                                                                  06150026
061600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06160026
061700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06170026
061800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06180026
061900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06190026
062000                                                                  06200026
062100                 20  ASC-ITEM-ARRAY.                              06210026
062200                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        06220026
062300                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   06230026
062400                                                     COMP-3.      06240026
062500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06250026
062600                             88  ASC-VALID-SELECT    VALUE ' '    06260026
062700                                                           'S'    06270026
062800                                                           'B'    06280026
062900                                                           'E'.   06290026
063000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06300026
063100                             88  ASC-TEMP-SELECT     VALUE 'S'.   06310026
063200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   06320026
063300                             88  ASC-TEMP-END        VALUE 'E'.   06330026
063400                         30  ASC-SELECTED-SW         PIC  X(01).  06340026
063500                             88  ASC-NO-SELECT       VALUE ' '.   06350026
063600                             88  ASC-SELECT          VALUE 'S'.   06360026
063700                             88  ASC-BEGIN           VALUE 'B'.   06370026
063800                             88  ASC-END             VALUE 'E'.   06380026
063900                         30  ASC-ACTION              PIC  X(01).  06390026
064000                         30  ASC-PAYT-REQ-LNE-NBR    PIC S9(4)    06400026
064100                                                     COMP.        06410026
064200                         30  ASC-PIECES-ALL.                      06420026
064300                             35  ASC-INP-PIECES      PIC X(6).    06430026
064400                             35  ASC-PIECES          PIC 9(6).    06440026
064500                         30  ASC-UNIT-COST-ALL.                   06450026
064600                             35  ASC-INP-UNIT-COST   PIC X(9).    06460026
064700                             35  ASC-UNIT-COST       PIC 9(7)V99. 06470026
064800                         30  ASC-APP-PO-LNE-NBR      PIC 9(4).    06480026
064900                         30  ASC-PO-LNE-NBR          PIC 9(4).    06490026
065000                         30  ASC-UPC-CODE            PIC X(16).   06500026
065100                         30  ASC-SKU                 PIC X(8).    06510026
065200                         30  ASC-VENDOR-STYLE        PIC X(12).   06520026
065300                         30  ASC-COLOR               PIC X(3).    06530026
065400                         30  ASC-SIZE                PIC X(5).    06540026
065500                         30  ASC-INVOICE-LINE        PIC 9(4).    06550026
065600                         30  ASC-LINE-CHANGED-SW     PIC X.       06560026
065700                             88  ASC-LINE-UPDATED    VALUE 'A'.   06570026
065800                             88  ASC-LINE-CHANGED    VALUE 'Y'.   06580026
065900                             88  ASC-LINE-NOT-CHANGED             06590026
066000                                                     VALUE ' '.   06600026
066100                         30  ASC-LINE-PROBLEM-SW     PIC X.       06610026
066200                             88  ASC-LINE-WARNING    VALUE 'W'.   06620026
066300                             88  ASC-LINE-ERROR      VALUE 'E'.   06630026
066400                             88  ASC-LINE-OK         VALUE ' '.   06640026
066500                                                                  06650026
066600             15  ASC-BLK-SUB                         PIC S9(04)   06660026
066700                                                          COMP    06670026
066800                                                          SYNC.   06680026
066900             15  ASC-ITEM-SUB                        PIC S9(04)   06690026
067000                                                          COMP    06700026
067100                                                          SYNC.   06710026
067200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06720026
067300                                                          COMP-3. 06730026
067400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   06740026
067500                                                          COMP-3. 06750026
067600             15  ASC-PROTECT-FIELDS-SW                PIC  X(01). 06760026
067700                 88  ASC-PROTECT-FIELDS               VALUE 'Y'.  06770026
067800*                88  ASC-PROTECT-EDI-FIELDS           VALUE 'E'.  06780026
067900                 88  ASC-PROTECT-EI-FIELDS            VALUE 'E'.  06790026
068000*                88  ASC-PROTECT-RI-FIELDS            VALUE 'R'.  06800036
068100                 88  ASC-UNPROTECT-FIELDS             VALUE 'N'.  06810026
068200                 88  ASC-ALLOW-SELECT-ONLY            VALUE 'S'.  06820026
068300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   06830026
068400                                                          COMP-3. 06840026
068500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   06850026
068600                                                          COMP-3. 06860026
068700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   06870026
068800                                                          COMP-3. 06880026
068900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   06890026
069000                                                          COMP    06900026
069100                                                          SYNC.   06910026
069200             15  ASC-START-ITEM-REQUEST.                          06920026
069300                 20  ASC-START-ITEM-REQUEST-N        PIC 9(5).    06930026
069400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   06940026
069500                                                          COMP-3. 06950026
069600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   06960026
069700                                                          COMP-3. 06970026
069800             15  ASC-APPROVED-SW                     PIC  X(01).  06980026
069900                 88  ASC-APPROVED                    VALUE 'Y'.   06990026
070000                 88  ASC-UNAPPROVED                  VALUE 'N'.   07000026
070100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  07010026
070200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   07020026
070300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   07030026
070400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  07040026
070500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   07050026
070600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   07060026
070700             15  ASC-LIST-QUEUE-NAME.                             07070026
070800                 20  ASC-LIST-TERM-ID                PIC  X(04).  07080026
070900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   07090026
071000                                                          COMP-3. 07100026
071100                 20  ASC-LIST-SEQ                    PIC  9(01).  07110026
071200             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  07120026
071300             15  ASC-SEL-QUEUE-NAME-OUT.                          07130026
071400                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  07140026
071500                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   07150026
071600                                                          COMP-3. 07160026
071700                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  07170026
071800             15  ASC-UPDATE-SW                       PIC X.       07180026
071900                 88  ASC-NO-UPDATE                   VALUE ' '.   07190026
072000                 88  ASC-WARNING-GIVEN               VALUE 'W'.   07200026
072100                 88  ASC-END-WARNING-GIVEN           VALUE 'E'.   07210026
072200             15  ASC-HOLD-BLOCK-NUMBER  PIC S9(04)  COMP SYNC.    07220026
072300             15  ASC-HOLD-ITEM-NUMBER   PIC S9(09)  COMP-3.       07230026
072400             15  ASC-USE-SELECTION-QUEUE-IND                      07240026
072500                                        PIC  X(01).               07250026
072600                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    07260026
072700             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       07270026
072800             15  ASC-SEL-SUB            PIC S9(04)  COMP.         07280026
072900             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         07290026
073000*        10  FILLER                                  PIC X(783).  07300026
073100     EJECT                                                        07310026
073200*---------------------------------------------------------------* 07320026
073300*    ABEND PROCESSING COPYBOOK.                                 * 07330026
073400*---------------------------------------------------------------* 07340026
073500                                                                  07350026
073600     COPY DPWS013.                                                07360026
073700                                                                  07370026
073800 EJECT                                                            07380026
073900*---------------------------------------------------------------* 07390026
074000*    DB2 AREA FOR INVOICE TABLE                                 * 07400026
074100*---------------------------------------------------------------* 07410026
074200     EXEC SQL                                                     07420026
074300          INCLUDE TINVOIC                                         07430026
074400     END-EXEC.                                                    07440026
074500*---------------------------------------------------------------* 07450026
074600*    DB2 AREA FOR PO STORE TABLE                                * 07460026
074700*---------------------------------------------------------------* 07470026
074800     EXEC SQL                                                     07480026
074900          INCLUDE TPOSTRR                                         07490026
075000     END-EXEC.                                                    07500026
075100*---------------------------------------------------------------* 07510026
075200*    DB2 AREA FOR PAY REQUEST ITEM TABLE                        * 07520026
075300*---------------------------------------------------------------* 07530026
075400     EXEC SQL                                                     07540026
075500          INCLUDE TPREQIT                                         07550026
075600     END-EXEC.                                                    07560026
075700*---------------------------------------------------------------* 07570026
075800*    DB2 AREA FOR MERCHANDISE INVOICE ITEM TABLE                * 07580026
075900*---------------------------------------------------------------* 07590026
076000     EXEC SQL                                                     07600026
076100          INCLUDE TMIITEM                                         07610026
076200     END-EXEC.                                                    07620026
076300*---------------------------------------------------------------* 07630026
076400*    DB2 AREA FOR VENDOR SUPPLIED INVOICE ITEM TABLE            * 07640026
076500*---------------------------------------------------------------* 07650026
076600     EXEC SQL                                                     07660026
076700          INCLUDE TVNDINV                                         07670026
076800     END-EXEC.                                                    07680026
076900*---------------------------------------------------------------* 07690026
077000*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 07700026
077100*---------------------------------------------------------------* 07710026
077200     EXEC SQL                                                     07720026
077300          INCLUDE TPURCHS                                         07730026
077400     END-EXEC.                                                    07740026
077500*---------------------------------------------------------------* 07750026
077600*  PO STATUS CODE TABLE                                         * 07760026
077700*---------------------------------------------------------------* 07770026
077800     EXEC SQL                                                     07780026
077900          INCLUDE TSTATCD                                         07790026
078000     END-EXEC.                                                    07800026
078100*---------------------------------------------------------------* 07810026
078200*    DB2 AREA FOR PURCHASE ORDER ITEM TABLE                     * 07820026
078300*---------------------------------------------------------------* 07830026
078400     EXEC SQL                                                     07840026
078500          INCLUDE TPURITM                                         07850026
078600     END-EXEC.                                                    07860026
078700     EXEC SQL                                                     07870026
078800          INCLUDE TUPCSKU                                         07880026
078900     END-EXEC.                                                    07890026
079000     EXEC SQL                                                     07900026
079100          INCLUDE TSKXREF                                         07910026
079200     END-EXEC.                                                    07920026
079300     EXEC SQL                                                     07930026
079400          INCLUDE TMDINVC                                         07940026
079500     END-EXEC.                                                    07950026
079600*---------------------------------------------------------------* 07960026
079700*    DB2 AREA FOR EXTERNAL ENTERPRISE NAME TABLE                * 07970026
079800*---------------------------------------------------------------* 07980026
079900     EXEC SQL                                                     07990026
080000          INCLUDE TENTNME                                         08000026
080100     END-EXEC.                                                    08010026
080101*---------------------------------------------------------------* 08010154
080102*    DB2 AREA FOR MERCHANDISE AREA TABLE (FOR SEPHORA LOOKUP)   * 08010254
080103*---------------------------------------------------------------* 08010354
080104     EXEC SQL                                                     08010454
080105          INCLUDE TMDSEAR                                         08010554
080106     END-EXEC.                                                    08010654
080107*---------------------------------------------------------------* 08010754
080108*    DB2 AREA FOR VENDOR CAPABILITIES    (FOR SEPHORA LOOKUP)   * 08010854
080109*---------------------------------------------------------------* 08010954
080110     EXEC SQL                                                     08011054
080111          INCLUDE VNT00001                                        08011154
080112     END-EXEC.                                                    08011254
080200*---------------------------------------------------------------* 08020026
080300*    DB2 AREA FOR COMMUNICATIONS                                * 08030026
080400*---------------------------------------------------------------* 08040026
080500     EXEC SQL                                                     08050026
080600          INCLUDE SQLCA                                           08060026
080700     END-EXEC.                                                    08070026
080800                                                                  08080026
080900*---------------------------------------------------------------* 08090026
081000*    CURSOR USED TO EXTRACT ITEMS FROM THE INVOICE SYSTEM       * 08100026
081100*       THAT HAVE A NULL VALUE FOR THE PO LINE NUMBER.          * 08110026
081200*---------------------------------------------------------------* 08120026
081300                                                                  08130026
081400                                                                  08140026
081500     EXEC SQL                                                     08150026
081600          DECLARE INVOICE-ITEM-CSR CURSOR FOR                     08160026
081700              SELECT M.PAYT_REQ_LNE_NBR,                          08170026
081800                       PAY_REQ_LNE_QTY,                           08180026
081900                       UNT_COST_AMT,                              08190026
082000                       VALUE(PO_LNE_NBR,+0)                       08200026
082100              FROM TINVOIC I,                                     08210026
082200                   TPREQIT R,                                     08220026
082300                   TMIITEM M                                      08230026
082400          WHERE I.PAYT_REQ_SEQ_NBR = M.PAYT_REQ_SEQ_NBR           08240026
082500           AND  I.PAYT_REQ_SEQ_NBR = R.PAYT_REQ_SEQ_NBR           08250026
082600           AND  M.PAYT_REQ_LNE_NBR = R.PAYT_REQ_LNE_NBR           08260026
082700           AND (I.INVC_ID          = :DK-INVOICE-ID)              08270026
082800           AND  I.PO_NBR             IS NOT NULL                  08280026
082900           AND  I.PO_NBR   BETWEEN  :DK-LOW-PO-NUMBER AND         08290026
083000                                    :DK-HIGH-PO-NUMBER            08300026
083100           ORDER BY 4                                             08310026
083200     END-EXEC.                                                    08320026
083300                                                                  08330026
083400     EXEC SQL                                                     08340026
083500          DECLARE PREQIT_CSR       CURSOR FOR                     08350026
083600                SELECT   PAY_REQ_LNE_QTY                          08360026
083700                        ,UNT_COST_AMT                             08370026
083800                FROM     TPREQIT                                  08380026
083900                WHERE    PAYT_REQ_SEQ_NBR = :DK-PAYT-REQ-SEQ-NBR  08390026
084000     END-EXEC.                                                    08400026
084100 EJECT                                                            08410026
084110*--------------------------------------------------------------*  08411055
084120* COPYBOOK FOR SEPHORA LOGIC                                   *  08412055
084130*--------------------------------------------------------------*  08413055
084140     COPY APWS021.                                                08414055
084150                                                                  08415055
084200 LINKAGE SECTION.                                                 08420026
084300                                                                  08430026
084400 01  DFHCOMMAREA.                                                 08440026
084500     05  FILLER                         OCCURS  1 TO 4072 TIMES   08450026
084600                                        DEPENDING ON EIBCALEN.    08460026
084700         10  FILLER                     PIC X.                    08470026
084800                                                                  08480026
084900 EJECT                                                            08490026
085000 PROCEDURE DIVISION.                                              08500026
085100******************************************************************08510026
085200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **08520026
085300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **08530026
085400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **08540026
085500******************************************************************08550026
085600 0000-MAIN-MODULE.                                                08560026
085700     INITIALIZE DP030-CICS-API-FIELDS.                            08570026
085800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08580026
085900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08590026
086000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08600026
086100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08610026
086200     MOVE LENGTH OF AP327AI        TO DP030-MAP-LENGTH (1).       08620026
086300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08630026
086400     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       08640026
086500     PERFORM 0001-CALL-CICS-ARCH-API.                             08650026
086600*                                                                 08660026
086700     PERFORM 1000-CONTROL-PROCESSING                              08670026
086800*                                                                 08680026
086900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08690026
087000     PERFORM 0001-CALL-CICS-ARCH-API.                             08700026
087100                                                                  08710026
087200******************************************************************08720026
087300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **08730026
087400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **08740026
087500******************************************************************08750026
087600 0001-CALL-CICS-ARCH-API.                                         08760026
087700     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08770088
087800                                    DFHCOMMAREA                   08780088
087900                                    DP030-CICS-API-FIELDS         08790088
088000                                    DP020-STANDARD-COMMAREA       08800088
088100                                    AP327AI.                      08810088
088200*                                                                 08820026
088300     IF  DP030-RC-CALL-SUCCESSFUL OR                              08830026
088400         DP030-RC-APPL-ERROR                                      08840026
088500         CONTINUE                                                 08850026
088600     ELSE                                                         08860026
088700         SET DP013-NO-ROLLBACK                                    08870026
088800             DP013-XCTL-DISPLAY-RESTART                           08880026
088900             DP013-CICS-ABEND      TO TRUE                        08890026
089000         MOVE 'BEFORE 0000-MAIN-MODULE'                           08900026
089100                                   TO DP013-PARAGRAPH             08910026
089310         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O08931088
089320-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      08932088
089400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      08940026
089500         PERFORM DP013-0000-PROCESS-ABEND                         08950026
089600     END-IF.                                                      08960026
089700*----------------------------------------------------------------*08970026
089800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *08980026
089900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *08990026
090000*                                                                *09000026
090100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09010026
090200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09020026
090300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09030026
090400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09040026
090500*----------------------------------------------------------------*09050026
090600                                                                  09060026
090700 1000-CONTROL-PROCESSING.                                         09070026
090800                                                                  09080026
090900     EVALUATE TRUE                                                09090026
091000                                                                  09100026
091100         WHEN DP020-NEXT-ACT-INITIAL                              09110026
091200             INITIALIZE ASC-SPECIFIC-COMMAREA                     09120026
091300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09130026
091400                                      ASC-SEL-TERM-ID-OUT         09140026
091500             MOVE DP020-SRC-TASK-NUMBER                           09150026
091600                                   TO ASC-LIST-TASK-NUMBER        09160026
091700                                      ASC-SEL-TASK-NUMBER-OUT     09170026
091800             MOVE PC-LIST-QUEUE-SEQ                               09180026
091900                                   TO ASC-LIST-SEQ                09190026
092000                                                                  09200026
092100             MOVE PC-SEL-QUEUE-SEQ-OUT                            09210026
092200                                   TO ASC-SEL-SEQ-OUT             09220026
092300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09230026
092400             IF  PS-ERROR                                         09240026
092500                 SET DP020-MSG-FATAL                              09250026
092600                                   TO TRUE                        09260026
092700                 SET DP020-NEXT-ACT-APPL-ERROR                    09270026
092800                                   TO TRUE                        09280026
092900             ELSE                                                 09290026
093000                 PERFORM 4000-BUILD-INITIAL-PANEL                 09300026
093100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09310026
093200             END-IF                                               09320026
093300                                                                  09330026
093400         WHEN DP020-NEXT-ACT-RETURN                               09340026
093500             PERFORM 2070-DELETE-LIST-QUEUE                       09350026
093600             MOVE ASC-KEY-PO-NUMBER                               09360026
093700                                 TO DK-PO-NUMBER                  09370026
093800                                    DK-HIGH-PO-NUMBER             09380026
093900                                    DK-LOW-PO-NUMBER              09390026
094000             MOVE ASC-KEY-INVOICE-ID                              09400026
094100                                 TO DK-INVOICE-ID                 09410026
094200                                    DK-HIGH-INVOICE-ID            09420026
094300                                    DK-LOW-INVOICE-ID             09430026
094400             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                        09440026
094500                                 TO DK-PAYT-REQ-SEQ-NBR           09450026
094600             MOVE ASC-KEY-DEPT-NBR                                09460026
094700                                 TO DK-DEPT-NBR                   09470026
094800             MOVE ASC-KEY-ENT-ID TO DK-ENT-ID                     09480026
094900             PERFORM 4000-BUILD-INITIAL-PANEL                     09490026
095000             PERFORM 2105-TOTAL-PIECES-CHECK                      09500026
095100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09510026
095200                                                                  09520026
095300         WHEN DP030-RC-APPL-ERROR                                 09530026
095400             MOVE ASC-KEY-PO-NUMBER                               09540026
095500                                 TO DK-PO-NUMBER                  09550026
095600                                    DK-HIGH-PO-NUMBER             09560026
095700                                    DK-LOW-PO-NUMBER              09570026
095800             MOVE ASC-KEY-INVOICE-ID                              09580026
095900                                 TO DK-INVOICE-ID                 09590026
096000                                    DK-HIGH-INVOICE-ID            09600026
096100                                    DK-LOW-INVOICE-ID             09610026
096200             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                        09620026
096300                                 TO DK-PAYT-REQ-SEQ-NBR           09630026
096400             MOVE ASC-KEY-DEPT-NBR                                09640026
096500                                 TO DK-DEPT-NBR                   09650026
096600             MOVE ASC-KEY-ENT-ID TO DK-ENT-ID                     09660026
096700             PERFORM 2070-DELETE-LIST-QUEUE                       09670026
096800             PERFORM 1150-GET-INVOICE-DATA                        09680026
096900             PERFORM 2105-TOTAL-PIECES-CHECK                      09690026
097000             PERFORM 4000-BUILD-INITIAL-PANEL                     09700026
097100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09710026
097200                                                                  09720026
097300         WHEN DP020-NEXT-ACT-READ-MAP                             09730026
097400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09740026
097500                                   TO PV-TOP-ITEM                 09750026
097600             PERFORM 2000-PROCESS-PANEL                           09760026
097700                                                                  09770026
097800         WHEN OTHER                                               09780026
097900             SET DP013-LOGIC-ABEND TO TRUE                        09790026
098000             SET DP013-NO-ROLLBACK TO TRUE                        09800026
098100             MOVE '1000-CONTROL-PROCESSING'                       09810026
098200                                   TO DP013-PARAGRAPH             09820026
098300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09830026
098400                                   TO DP013-MESSAGE-TEXT(1)       09840026
098500             PERFORM DP013-0000-PROCESS-ABEND                     09850026
098600     END-EVALUATE.                                                09860026
098700                                                                  09870026
098800 EJECT                                                            09880026
098900*----------------------------------------------------------------*09890026
099000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *09900026
099100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *09910026
099200*----------------------------------------------------------------*09920026
099300                                                                  09930026
099400 1100-PROCESS-INTER-APPL-COMM.                                    09940026
099500                                                                  09950026
099600     MOVE SPACE             TO ASC-START-ITEM-REQUEST.            09960026
099700     MOVE AP300-INVC-ID     TO ASC-KEY-INVOICE-ID                 09970026
099800                               DK-INVOICE-ID                      09980026
099900     IF AP300-PO-NBR = ZERO                                       09990026
100000        MOVE PC-PO-NBR-HIGH TO DK-HIGH-PO-NUMBER                  10000026
100100        MOVE PC-PO-NBR-LOW  TO DK-LOW-PO-NUMBER                   10010026
100200     ELSE                                                         10020026
100300        MOVE AP300-PO-NBR   TO ASC-KEY-PO-NUMBER                  10030026
100400                               DK-HIGH-PO-NUMBER                  10040026
100500                               DK-LOW-PO-NUMBER                   10050026
100600     END-IF                                                       10060026
100700                                                                  10070026
100800                                                                  10080026
100900     MOVE DP020-INT-APPL-FORMAT-IND                               10090026
101000                                 TO ASC-INT-APPL-FORMAT-IND       10100026
101100     EVALUATE TRUE                                                10110026
101200                                                                  10120026
101300         WHEN ASC-INTER-APPL-CRIT-SPEC                            10130026
101400             IF ASC-KEY-INVOICE-ID > SPACES                       10140026
101500                 PERFORM 1150-GET-INVOICE-DATA                    10150026
101600                 IF PS-NO-ERROR                                   10160026
101700                     PERFORM 1175-GET-PO-DATA                     10170026
101800                 END-IF                                           10180026
101900             ELSE                                                 10190026
102000                 MOVE PC-TSYMSG-00849    TO DP020-MSG-NUMBER      10200026
102100                 SET DP020-MSG-FATAL                              10210026
102200                     DP020-NEXT-ACT-APPL-ERROR                    10220026
102300                     PS-ERROR            TO TRUE                  10230026
102400             END-IF                                               10240026
102500         WHEN ASC-INTER-APPL-LIST                                 10250026
102600             IF AP300-NUMBER-OF-SELECTED-ITEMS > +0               10260026
102700                 SET ASC-USE-SELECTION-QUEUE                      10270026
102800                                 TO TRUE                          10280026
102900                 MOVE AP300-NUMBER-OF-SELECTED-ITEMS              10290026
103000                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  10300026
103100                 MOVE AP300-NUMBER-OF-TS-ITEMS                    10310026
103200                                 TO ASC-NUMBER-OF-TS-ITEMS        10320026
103300                 MOVE AP300-SEL-QUEUE-NAME                        10330026
103400                                 TO ASC-SEL-QUEUE-NAME-IN         10340026
103500                                                                  10350026
103600                 PERFORM 1120-PREPARE-LIST-ENTRY                  10360026
103700             ELSE                                                 10370026
103800*                -- AT LEAST ONE ITEM MUST BE SELECTED --         10380026
103900                 MOVE PC-TSYMSG-00057      TO DP020-MSG-NUMBER    10390026
104000                 SET DP020-MSG-FATAL       TO TRUE                10400026
104100                 SET PS-ERROR              TO TRUE                10410026
104200             END-IF                                               10420026
104300                                                                  10430026
104400         WHEN OTHER                                               10440026
104500*            -- ENTRY OF A FIELD REQUIRED --                      10450026
104600             MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER        10460026
104700             SET DP020-MSG-FATAL       TO TRUE                    10470026
104800             SET PS-COMMAREA-NOT-VALID TO TRUE                    10480026
104900     END-EVALUATE.                                                10490026
105000                                                                  10500026
105100/                                                                 10510026
105200*---------------------------------------------------------------- 10520026
105300* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP      10530026
105400* STORAGE QUEUE PASSED FROM THE LIST.                             10540026
105500*---------------------------------------------------------------- 10550026
105600 1120-PREPARE-LIST-ENTRY.                                         10560026
105700                                                                  10570026
105800     MOVE AP301-MAX-ITEMS          TO ASC-SEL-SUB.                10580026
105900     MOVE ZERO                     TO ASC-SEL-ITEM.               10590026
106000     PERFORM 2101-GET-NEXT-RECORD.                                10600026
106100/                                                                 10610026
106200*----------------------------------------------------------------*10620026
106300*  VALIDATE INVOICE INFORMATION                                  *10630026
106400*----------------------------------------------------------------*10640026
106500 1150-GET-INVOICE-DATA.                                           10650026
106600     EXEC SQL                                                     10660026
106700         SELECT                                                   10670026
106800             PAYT_REQ_SEQ_NBR                                     10680041
106900            ,INVC_TYP_CDE                                         10690041
107000            ,STATUS_CDE                                           10700041
107100            ,ENTR_MTHD_CDE                                        10710041
107200            ,GRO_COST_AMT                                         10720041
107300            ,VALUE(PO_NBR,+0)                                     10730041
107400            ,STR_NBR                                              10740041
107500            ,DC_NBR                                               10750041
107600            ,MTCH_LVL_CDE                                         10760041
107700         INTO                                                     10770026
107800             :INVOIC-PAYT-REQ-SEQ-NBR                             10780041
107900            ,:INVOIC-INVC-TYP-CDE                                 10790041
108000            ,:INVOIC-STATUS-CDE                                   10800041
108100            ,:INVOIC-ENTR-MTHD-CDE                                10810041
108200            ,:INVOIC-GRO-COST-AMT                                 10820041
108300            ,:INVOIC-PO-NBR                                       10830041
108400            ,:INVOIC-STR-NBR                                      10840041
108500            ,:INVOIC-DC-NBR                                       10850041
108600            ,:INVOIC-MTCH-LVL-CDE                                 10860041
108700         FROM TINVOIC I                                           10870041
108800         WHERE  INVC_ID       = :DK-INVOICE-ID                    10880041
108900           AND  PO_NBR           IS NOT NULL                      10890041
109000           AND  PO_NBR  BETWEEN :DK-LOW-PO-NUMBER AND             10900041
109100                                :DK-HIGH-PO-NUMBER                10910041
109200     END-EXEC.                                                    10920041
109300                                                                  10930041
109400     EVALUATE TRUE                                                10940041
109500         WHEN SQLCODE = ZERO                                      10950041
109610             MOVE INVOIC-PAYT-REQ-SEQ-NBR                         10961054
109700                                 TO ASC-KEY-PAYT-REQ-SEQ-NBR      10970041
109800                                    DK-PAYT-REQ-SEQ-NBR           10980041
109900             MOVE INVOIC-PO-NBR  TO DK-PO-NUMBER                  10990041
110000                                    ASC-KEY-PO-NUMBER             11000041
110100             MOVE INVOIC-STR-NBR TO ASC-KEY-STORE-NUMBER          11010041
110200             MOVE INVOIC-GRO-COST-AMT                             11020041
110300                                 TO ASC-KEY-GRO-COST-AMT          11030041
110400             MOVE INVOIC-INVC-TYP-CDE                             11040041
110500                                 TO ASC-KEY-INVC-TYP-CDE          11050041
110600             MOVE INVOIC-STATUS-CDE                               11060041
110700                                 TO ASC-KEY-INVC-STATUS           11070041
110710                                    ASC-ORIG-INVC-STATUS          11071052
110800             MOVE INVOIC-DC-NBR  TO ASC-KEY-DC-NBR                11080041
110900             MOVE INVOIC-MTCH-LVL-CDE                             11090041
111000                                 TO ASC-KEY-MTCH-LVL-CDE          11100041
111010             PERFORM 1500-CHECK-FOR-SEPHORA                       11101054
111100             EVALUATE TRUE                                        11110041
111200                 WHEN INVOIC-INVC-TYP-CDE  = PC-WO                11120041
111300                     SET ASC-PROTECT-FIELDS      TO TRUE          11130041
111400**                   -- UPDATE NOT ALLOWED FOR THIS STATUS --     11140041
111500                     MOVE PC-TSYMSG-01517        TO               11150041
111600                          DP020-MSG-NUMBER                        11160041
111700                     SET DP020-MSG-INFORMATIONAL TO TRUE          11170041
111800                 WHEN INVOIC-STATUS-CDE = PC-DELETE               11180041
111810                 WHEN (ASC-SEPHORA-PJ-IND = 'Y' AND               11181081
111820                       INVOIC-STATUS-CDE = PC-ENTERED)            11182054
111831                 WHEN (ASC-SEPHORA-PJ-IND = 'N' AND               11183181
111832                       INVOIC-STATUS-CDE =                        11183269
111840                                 PC-PENDING-JOURNALIZATION)       11184069
111900*                WHEN INVOIC-STATUS-CDE =                         11190051
112000*                                        PC-PENDING-JOURNALIZATION11200051
112100                     SET ASC-PROTECT-FIELDS      TO TRUE          11210041
112200**                   -- UPDATE NOT ALLOWED FOR THIS STATUS --     11220041
112300                     MOVE PC-TSYMSG-00170        TO               11230041
112400                          DP020-MSG-NUMBER                        11240041
112500                     SET DP020-MSG-INFORMATIONAL TO TRUE          11250041
112600*                WHEN INVOIC-ENTR-MTHD-CDE = PC-EDI               11260041
112700*                    SET ASC-PROTECT-EDI-FIELDS  TO TRUE          11270041
112800                 WHEN INVOIC-INVC-TYP-CDE  = PC-EI                11280041
112900                     SET ASC-PROTECT-EI-FIELDS  TO TRUE           11290041
113000*                WHEN INVOIC-INVC-TYP-CDE  = PC-RI                11300041
113100*                    SET ASC-PROTECT-RI-FIELDS  TO TRUE           11310041
113200                 WHEN INVOIC-STATUS-CDE = PC-ENTERED              11320041
113300                 WHEN INVOIC-STATUS-CDE = PC-RECONCILED           11330041
113400                 WHEN INVOIC-STATUS-CDE = PC-ITEM-IMBALANCE       11340041
113401                 WHEN (ASC-SEPHORA-PJ-IND = 'Y' AND               11340181
113402                       INVOIC-STATUS-CDE =                        11340269
113403                                 PC-PENDING-JOURNALIZATION)       11340369
113500                     SET ASC-UNPROTECT-FIELDS    TO TRUE          11350041
113600                 WHEN OTHER                                       11360041
113700                     SET ASC-ALLOW-SELECT-ONLY   TO TRUE          11370041
113800**                   -- UPDATE NOT ALLOWED FOR THIS STATUS --     11380041
113900                     IF INVOIC-STATUS-CDE = PC-OUT-OF-BALANCE     11390041
114000                         MOVE PC-TSYMSG-00942    TO               11400041
114100                              DP020-MSG-NUMBER                    11410041
114200                     ELSE                                         11420041
114300                         MOVE PC-TSYMSG-00170    TO               11430041
114400                              DP020-MSG-NUMBER                    11440041
114500                     END-IF                                       11450041
114600                     SET DP020-MSG-INFORMATIONAL TO TRUE          11460041
114700             END-EVALUATE                                         11470041
114800             PERFORM 1155-GET-TOTAL-PIECES                        11480041
114900         WHEN SQLCODE = -811                                      11490041
115000*-------------------------------------------------------------*   11500041
115100*  DATA PASSED IS BRINGING BACK MORE THAN ONE PO              *   11510041
115200*-------------------------------------------------------------*   11520041
115300             SET PS-ERROR        TO TRUE                          11530041
115400             MOVE PC-TSYMSG-00855                                 11540041
115500                                 TO DP020-MSG-NUMBER              11550041
115600         WHEN SQLWARN0 NOT = SPACES                               11560041
115700         WHEN SQLCODE < ZERO                                      11570041
115800         WHEN SQLCODE > ZERO                                      11580041
115900*-------------------------------------------------------------*   11590041
116000*  DATA PASSED THROUGH INTER-APPL DOES NOT EXIST              *   11600041
116100*-------------------------------------------------------------*   11610041
116200             SET PS-ERROR        TO TRUE                          11620041
116300             MOVE PC-TSYMSG-00855                                 11630041
116400                                 TO DP020-MSG-NUMBER              11640041
116500     END-EVALUATE.                                                11650041
116600 EJECT                                                            11660041
116700*-------------------------------------------------------------*   11670041
116800*  EXTRACT TOTAL PIECES FOR THE PAYT REQ SEQUENCE NUMBER      *   11680041
116900*-------------------------------------------------------------*   11690041
117000 1155-GET-TOTAL-PIECES.                                           11700041
117100     EXEC SQL                                                     11710041
117200         SELECT                                                   11720041
117300             TOT_INVC_PC_QTY                                      11730041
117400         INTO :MDINVC-TOT-INVC-PC-QTY                             11740041
117500         FROM TMDINVC                                             11750041
117600         WHERE PO_NBR  = :INVOIC-PO-NBR                           11760041
117700           AND INVC_ID = :DK-INVOICE-ID                           11770041
117800     END-EXEC.                                                    11780041
117900                                                                  11790041
118000     EVALUATE TRUE                                                11800041
118100         WHEN SQLCODE = ZERO                                      11810041
118200             MOVE MDINVC-TOT-INVC-PC-QTY                          11820041
118300                                 TO ASC-KEY-TOTAL-PIECES          11830041
118400         WHEN SQLWARN0 NOT = SPACES                               11840041
118500         WHEN SQLCODE < ZERO                                      11850041
118600         WHEN SQLCODE > ZERO                                      11860041
118700             MOVE ZERO           TO ASC-KEY-TOTAL-PIECES          11870041
118800     END-EVALUATE.                                                11880041
118900*----------------------------------------------------------------*11890041
119000*  VALIDATE PURCHASE ORDER INFORMATION                           *11900041
119100*----------------------------------------------------------------*11910041
119200 1175-GET-PO-DATA.                                                11920041
119300     EXEC SQL                                                     11930041
119400         SELECT                                                   11940041
119500             DEPT_NBR,                                            11950041
119600             ENT_ID,                                              11960041
119700             STATUS_CLS                                           11970041
119800         INTO                                                     11980041
119900             :PURCHS-DEPT-NBR,                                    11990041
120000             :PURCHS-ENT-ID,                                      12000041
120100             :STATCD-STATUS-CLS                                   12010041
120200         FROM TPURCHS P,                                          12020041
120300              TSTATCD S                                           12030041
120400         WHERE (PO_NBR           = :DK-PO-NUMBER)                 12040041
120500           AND (P.STATUS_CDE     =  S.STATUS_CDE)                 12050041
120600           AND (P.VER_STATUS_CDE = :PC-ACTIVE)                    12060041
120700           AND (S.STATUS_TYP_CDE = :PC-PURCH-ORDER)               12070041
120800     END-EXEC.                                                    12080041
120900                                                                  12090041
121000     EVALUATE TRUE                                                12100041
121100         WHEN SQLCODE = ZERO                                      12110041
121200             MOVE PURCHS-DEPT-NBR                                 12120041
121300                                 TO ASC-KEY-DEPT-NBR              12130041
121400                                    DK-DEPT-NBR                   12140041
121500             MOVE PURCHS-ENT-ID  TO ASC-KEY-ENT-ID                12150041
121600                                    DK-ENT-ID                     12160041
121700             IF STATCD-STATUS-CLS = PC-UNAPPROVED                 12170041
121800                 SET ASC-UNAPPROVED                               12180041
121900                                 TO TRUE                          12190041
122000             ELSE                                                 12200041
122100                 SET ASC-APPROVED                                 12210041
122200                                 TO TRUE                          12220041
122300             END-IF                                               12230041
122400             PERFORM 1180-GET-VENDOR-DESC                         12240041
122500         WHEN SQLWARN0 NOT = SPACES                               12250041
122600         WHEN SQLCODE < ZERO                                      12260041
122700         WHEN SQLCODE > ZERO                                      12270041
122800             SET PS-ERROR        TO TRUE                          12280041
122900             MOVE PC-TSYMSG-00852                                 12290041
123000                                 TO DP020-MSG-NUMBER              12300041
123100     END-EVALUATE.                                                12310041
123200 EJECT                                                            12320041
123300*----------------------------------------------------------------*12330041
123400*   READS ENTNME TABLE TO GET VENDOR NAME                        *12340041
123500*----------------------------------------------------------------*12350041
123600 1180-GET-VENDOR-DESC.                                            12360041
123700*                                                                 12370041
123800     EXEC SQL                                                     12380041
123900         SELECT                                                   12390041
124000             ENT_NAME_DESC                                        12400041
124100         INTO                                                     12410041
124200             :ENTNME-ENT-NAME-DESC                                12420041
124300         FROM TENTNME E                                           12430041
124400         WHERE (E.ENT_ID      = :DK-ENT-ID)                       12440041
124500           AND (E.TYPE_CDE    = :PC-TYPE-01)                      12450041
124600     END-EXEC.                                                    12460041
124700                                                                  12470041
124800     EVALUATE TRUE                                                12480041
124900         WHEN SQLCODE = ZERO                                      12490041
125000             MOVE ENTNME-ENT-NAME-DESC                            12500041
125100                             TO ASC-VENDOR-DESC                   12510041
125200         WHEN SQLCODE = +100                                      12520041
125300             MOVE SPACES         TO ASC-VENDOR-DESC               12530041
125400         WHEN SQLWARN0 NOT = SPACES                               12540041
125500         WHEN SQLCODE < ZERO                                      12550041
125600         WHEN SQLCODE > ZERO                                      12560041
125700             MOVE '1180-GET-VENDOR-DESC'                          12570041
125800                               TO DP013-PARAGRAPH                 12580041
125900             MOVE 'SELECT VENDOR DESC FROM ENT ID'                12590041
126000                                   TO DP013-MESSAGE-TEXT (1)      12600041
126100             MOVE DK-ENT-ID        TO DP013-MESSAGE-TEXT (2)      12610041
126200             MOVE SQLCA            TO DP013-SQLCA                 12620041
126300             MOVE 'TENTNME'        TO DP013-DB2-TABLE-NAME (1)    12630041
126400             SET DP013-DB2-ABEND                                  12640041
126500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12650041
126600             PERFORM DP013-0000-PROCESS-ABEND                     12660041
126700     END-EVALUATE.                                                12670041
126800 EJECT                                                            12680041
126810*----------------------------------------------------------------*12681054
126820*   DETERMINE IF THE INVOICE IS FOR SEPHORA                      *12682054
126830*----------------------------------------------------------------*12683054
126840 1500-CHECK-FOR-SEPHORA.                                          12684054
126850*                                                                 12685054
126851     MOVE PC-CURRENT-PROGRAM-NAME TO SA-PROGRAM-NAME              12685154
126852     PERFORM 1550-GET-PURCHS-FIELDS                               12685254
126853     PERFORM S100-GET-SEPHORA-DEPT                                12685354
126854     MOVE PURCHS-ENT-ID      TO PV-ENT-ID                         12685454
126855     MOVE PURCHS-DEPT-NBR    TO PV-DEPT-NBR                       12685554
126856     PERFORM S500-CHECK-FOR-SEPHORA                               12685654
126857     IF PS-SEPHORA-AT-KOHLS                                       12685767
126858         MOVE 'Y' TO ASC-SEPHORA-PJ-IND                           12685881
126860         IF ASC-KEY-INVC-TYP-CDE = PC-RI                          12686075
126862             MOVE 'N' TO ASC-SEPHORA-PJ-IND                       12686281
126864         END-IF                                                   12686475
126865         IF INVOIC-ENTR-MTHD-CDE = PC-MN                          12686581
126866            AND INVOIC-STATUS-CDE = PC-ENTERED                    12686681
126867             MOVE 'N' TO ASC-SEPHORA-PJ-IND                       12686781
126868         END-IF                                                   12686881
126869     ELSE                                                         12686981
126870         MOVE 'N' TO ASC-SEPHORA-PJ-IND                           12687081
126871     END-IF.                                                      12687181
126872                                                                  12687281
126873*----------------------------------------------------------------*12687381
126874*   READ TPURCHS TO GET DEPT/ENTID                               *12687481
126875*----------------------------------------------------------------*12687581
126876 1550-GET-PURCHS-FIELDS.                                          12687681
126877*                                                                 12687781
126878     EXEC SQL                                                     12687881
126879         SELECT                                                   12687981
126880             ENT_ID                                               12688054
126881          ,  DEPT_NBR                                             12688155
126890         INTO                                                     12689054
126891             :PURCHS-ENT-ID                                       12689154
126892           , :PURCHS-DEPT-NBR                                     12689254
126893         FROM TPURCHS                                             12689354
126894          WHERE  PO_NBR         = :DK-PO-NUMBER                   12689454
126895            AND  VER_STATUS_CDE = 'A'                             12689554
126898     END-EXEC.                                                    12689854
126899                                                                  12689954
126900     EVALUATE TRUE                                                12690054
126901         WHEN SQLCODE = ZERO                                      12690154
126903             CONTINUE                                             12690354
126904         WHEN SQLCODE = +100                                      12690454
126905             MOVE ZERO           TO PURCHS-ENT-ID                 12690554
126906             MOVE SPACES         TO PURCHS-DEPT-NBR               12690654
126919         WHEN SQLWARN0 NOT = SPACES                               12691954
126920         WHEN SQLCODE < ZERO                                      12692054
126921         WHEN SQLCODE > ZERO                                      12692154
126922             SET PS-ERROR        TO TRUE                          12692254
126923             MOVE PC-TSYMSG-00852                                 12692354
126924                                 TO DP020-MSG-NUMBER              12692454
126925     END-EVALUATE.                                                12692554
126926 EJECT                                                            12692654
126930*----------------------------------------------------------------*12693041
127000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *12700041
127100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *12710041
127200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *12720041
127300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *12730041
127400* FUNCTION KEYS CAN GET THIS FAR.                                *12740041
127500*----------------------------------------------------------------*12750041
127600                                                                  12760041
127700 2000-PROCESS-PANEL.                                              12770041
127800                                                                  12780041
127900     EVALUATE TRUE                                                12790041
128000         WHEN DP020-SRC-AID = DP016-CLEAR                         12800041
128100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    12810041
128200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12820041
128300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12830041
128400                                                                  12840041
128500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    12850041
128600             PERFORM 2070-DELETE-LIST-QUEUE                       12860041
128700             MOVE ASC-KEY-PO-NUMBER                               12870041
128800                                 TO DK-PO-NUMBER                  12880041
128900                                    DK-HIGH-PO-NUMBER             12890041
129000                                    DK-LOW-PO-NUMBER              12900041
129100             MOVE ASC-KEY-INVOICE-ID                              12910041
129200                                 TO DK-INVOICE-ID                 12920041
129300                                    DK-HIGH-INVOICE-ID            12930041
129400                                    DK-LOW-INVOICE-ID             12940041
129500             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                        12950041
129600                                 TO DK-PAYT-REQ-SEQ-NBR           12960041
129700             MOVE ASC-KEY-DEPT-NBR                                12970041
129800                                 TO DK-DEPT-NBR                   12980041
129900             MOVE ASC-KEY-ENT-ID TO DK-ENT-ID                     12990041
130000             PERFORM 4000-BUILD-INITIAL-PANEL                     13000041
130100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13010041
130200                                                                  13020041
130300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13030041
130400             PERFORM 2140-DESELECT-ALL-ITEMS                      13040041
130500             PERFORM 3200-RESET-ATTRIBUTES                        13050041
130600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13060041
130700                                                                  13070041
130800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13080041
130810             IF ASC-UNPROTECT-FIELDS                              13081065
130900                 PERFORM 2150-SELECT-ALL-ITEMS                    13090065
131000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               13100065
131100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13110065
131102             ELSE                                                 13110266
131104                 MOVE PC-TSYMSG-00170                             13110466
131105                                   TO DP020-MSG-NUMBER            13110566
131106                 SET DP020-MSG-INFORMATIONAL                      13110666
131107                                   TO TRUE                        13110766
131108             END-IF                                               13110866
131110*            PERFORM 2150-SELECT-ALL-ITEMS                        13111065
131120*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13112065
131130*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13113065
131200                                                                  13120041
131300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             13130041
131400             IF  ASC-USE-SELECTION-QUEUE                          13140041
131500                 PERFORM 2101-GET-NEXT-RECORD                     13150041
131600                 IF PS-NO-ERROR                                   13160041
131700                     PERFORM 2070-DELETE-LIST-QUEUE               13170041
131800                     PERFORM 4000-BUILD-INITIAL-PANEL             13180041
131900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13190041
132000                 END-IF                                           13200041
132100             ELSE                                                 13210041
132200*                --- BOTTOM OF LIST ---                           13220041
132300                 MOVE PC-TSYMSG-00070                             13230041
132400                                   TO DP020-MSG-NUMBER            13240041
132500                 SET DP020-MSG-INFORMATIONAL                      13250041
132600                                   TO TRUE                        13260041
132700             END-IF                                               13270041
132800                                                                  13280041
132900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             13290041
133000             IF  ASC-USE-SELECTION-QUEUE                          13300041
133100                 PERFORM 2102-GET-PREV-RECORD                     13310041
133200                 IF PS-NO-ERROR                                   13320041
133300                     PERFORM 2070-DELETE-LIST-QUEUE               13330041
133400                     PERFORM 4000-BUILD-INITIAL-PANEL             13340041
133500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13350041
133600                 END-IF                                           13360041
133700             ELSE                                                 13370041
133800*                --- TOP OF LIST ---                              13380041
133900                 MOVE PC-TSYMSG-00069                             13390041
134000                                   TO DP020-MSG-NUMBER            13400041
134100                 SET DP020-MSG-INFORMATIONAL                      13410041
134200                                   TO TRUE                        13420041
134300             END-IF                                               13430041
134400                                                                  13440041
134500                                                                  13450041
134600         WHEN OTHER                                               13460041
134700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13470041
134800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13480041
134900             IF  PS-NO-ERROR                                      13490041
135000                 SET DP030-CONTINUE-GO                            13500041
135100                                 TO TRUE                          13510041
135200                 PERFORM 2100-CHECK-FUNCTION-KEY                  13520041
135300             ELSE                                                 13530041
135400                 SET DP030-OVERRIDE-GO                            13540041
135500                                 TO TRUE                          13550041
135600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13560041
135700             END-IF                                               13570041
135800     END-EVALUATE.                                                13580041
135900 EJECT                                                            13590041
136000*----------------------------------------------------------------*13600041
136100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *13610041
136200*----------------------------------------------------------------*13620041
136300 2070-DELETE-LIST-QUEUE.                                          13630041
136400                                                                  13640041
136500     EXEC CICS                                                    13650041
136600         DELETEQ TS                                               13660041
136700             QUEUE (ASC-LIST-QUEUE-NAME)                          13670041
136800             RESP  (PV-CICS-RESP)                                 13680041
136900     END-EXEC.                                                    13690041
137000                                                                  13700041
137100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13710041
137200        (PV-CICS-RESP = DFHRESP(QIDERR))                          13720041
137300         CONTINUE                                                 13730041
137400     ELSE                                                         13740041
137500         SET DP013-CICS-ABEND      TO TRUE                        13750041
137600         SET DP013-NO-ROLLBACK     TO TRUE                        13760041
137700                                                                  13770041
137800         MOVE '2070-DELETE-LIST-QUEUE'                            13780041
137900                                   TO DP013-PARAGRAPH             13790041
138000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    13800041
138100                                   TO DP013-MESSAGE-TEXT (1)      13810041
138200         PERFORM DP013-0000-PROCESS-ABEND                         13820041
138300     END-IF.                                                      13830041
138400                                                                  13840041
138500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  13850041
138600 EJECT                                                            13860041
138700                                                                  13870041
138800*----------------------------------------------------------------*13880041
138900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*13890041
139000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *13900041
139100* CICS ARCHITECTURE API.                                         *13910041
139200*----------------------------------------------------------------*13920041
139300 2100-CHECK-FUNCTION-KEY.                                         13930041
139400     EVALUATE TRUE                                                13940041
139500                                                                  13950041
139600******************************************************************13960041
139700**  LOCAL FUNCTION 01 IS SET UP FOR THE UPDATE OF THE INVOICE   **13970041
139800**  LINE ITEMS.                                                 **13980041
139900******************************************************************13990041
140000                                                                  14000041
140100         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               14010041
140200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 14020041
140300             EVALUATE TRUE                                        14030041
140400                 WHEN ASC-UNPROTECT-FIELDS                        14040041
140500                                                                  14050041
140600                     PERFORM 3000-EDIT-DATA-IN-COMMAREA           14060041
140700                                                                  14070041
140800                     IF PS-NO-ERROR                               14080041
140900                         PERFORM 3700-EDIT-SELECTED-ITEMS         14090041
141000                     END-IF                                       14100041
141100                                                                  14110041
141200*               WHEN ASC-PROTECT-EDI-FIELDS                       14120041
141300*                    MOVE PC-TSYMSG-00851                         14130041
141400*                                    TO DP020-MSG-NUMBER          14140041
141500*                    SET DP020-MSG-FATAL                          14150041
141600*                        PS-ERROR        TO TRUE                  14160041
141700                WHEN ASC-PROTECT-EI-FIELDS                        14170041
141800                     MOVE PC-TSYMSG-02699                         14180041
141900                                     TO DP020-MSG-NUMBER          14190041
142000                     SET DP020-MSG-FATAL                          14200041
142100                         PS-ERROR        TO TRUE                  14210041
142200*               WHEN ASC-PROTECT-RI-FIELDS                        14220041
142300*                    MOVE PC-TSYMSG-00970                         14230041
142400*                                    TO DP020-MSG-NUMBER          14240041
142500*                    SET DP020-MSG-FATAL                          14250041
142600*                        PS-ERROR        TO TRUE                  14260041
142700                WHEN ASC-ALLOW-SELECT-ONLY                        14270041
142800                     IF ASC-KEY-INVC-STATUS = PC-OUT-OF-BALANCE   14280041
142900                         MOVE PC-TSYMSG-00942                     14290041
143000                                         TO DP020-MSG-NUMBER      14300041
143100                     ELSE                                         14310041
143200                        IF ASC-KEY-INVC-TYP-CDE = PC-WO           14320041
143300                           MOVE PC-TSYMSG-01517                   14330041
143400                                         TO DP020-MSG-NUMBER      14340041
143500                        ELSE                                      14350041
143600                           MOVE PC-TSYMSG-00170                   14360041
143700                                         TO DP020-MSG-NUMBER      14370041
143800                        END-IF                                    14380041
143900                     END-IF                                       14390041
144000                     SET DP020-MSG-INFORMATIONAL                  14400041
144100                         PS-ERROR        TO TRUE                  14410041
144200             END-EVALUATE                                         14420041
144300             IF PS-NO-ERROR                                       14430041
144400                 IF (PV-FIRST-ERROR-ITEM > ZERO) OR               14440041
144500                    (PS-ERROR)                                    14450041
144600                     SET ASC-WARNING-GIVEN                        14460041
144700                                 TO TRUE                          14470041
144800                     MOVE PC-TSYMSG-00872                         14480041
144900                                   TO DP020-MSG-NUMBER            14490041
145000                     SET DP020-MSG-WARNING                        14500041
145100                                     TO TRUE                      14510041
145200                 ELSE                                             14520041
145300                     IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO       14530041
145400*                    --- A LIST ITEM MUST BE SELECTED ---         14540041
145500                         MOVE PC-TSYMSG-00057                     14550041
145600                                 TO DP020-MSG-NUMBER              14560041
145700                         SET DP020-MSG-FATAL                      14570041
145800                             PS-ERROR    TO TRUE                  14580041
145900                     ELSE                                         14590041
146000                         PERFORM 8800-CHECK-IF-PROCESSED          14600041
146100                         IF PS-ERROR                              14610041
146200                             MOVE PC-TSYMSG-00961 TO              14620041
146300                                            DP020-MSG-NUMBER      14630041
146400                             SET DP020-MSG-FATAL                  14640041
146500                                 DP030-OVERRIDE-GO                14650041
146600                                 PS-ERROR          TO TRUE        14660041
146700                         ELSE                                     14670041
146800                             PERFORM 8000-PROCESS-UPDATE-TSQ      14680041
146900                             MOVE PC-TSYMSG-00059                 14690041
147000                                           TO DP020-MSG-NUMBER    14700041
147100                             SET DP020-MSG-INFORMATIONAL          14710041
147200                                             TO TRUE              14720041
147300                         END-IF                                   14730041
147400                     END-IF                                       14740041
147500                 END-IF                                           14750041
147600             END-IF                                               14760041
147700             PERFORM 2105-TOTAL-PIECES-CHECK                      14770041
147800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14780041
147900                                                                  14790041
148000                                                                  14800041
148100******************************************************************14810041
148200** FOUR FUNCTIONS THAT HAVE BEEN SETUP FOR THE LOCAL GO TO ARE  **14820041
148300**      1.  DELETE INVOICE LINE ITEMS                           **14830041
148400**      2.  STORE RECN           ??                             **14840041
148500**      3.  PO RECN              ??                             **14850041
148600**      4.  DETAIL UPDATES       ??                             **14860041
148700******************************************************************14870041
148800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  14880041
148900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 14890041
149000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14900041
149100             IF PS-ERROR                                          14910041
149200                 SET DP030-OVERRIDE-GO                            14920041
149300                                 TO TRUE                          14930041
149400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14940041
149500             ELSE                                                 14950041
149600                 SET DP030-CONTINUE-GO                            14960041
149700                                 TO TRUE                          14970041
149800                 PERFORM 2400-PREPARE-INTER-APPL-COMM             14980041
149900             END-IF                                               14990041
150000                                                                  15000041
150100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15010041
150200             MOVE +1               TO PV-TOP-ITEM                 15020041
150300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15030041
150400                                                                  15040041
150500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15050041
150600             PERFORM 2110-BROWSE-BACKWARD                         15060041
150700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15070041
150800                                                                  15080041
150900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15090041
151000             PERFORM 2120-BROWSE-FORWARD                          15100041
151100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15110041
151200                                                                  15120041
151300         WHEN DP020-SRC-AID = DP016-ENTER                         15130041
151400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   15140041
151500             IF  PS-ERROR                                         15150041
151600                 CONTINUE                                         15160041
151700             ELSE                                                 15170041
151800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15180041
151900             END-IF                                               15190041
152000                                                                  15200041
152100         WHEN OTHER                                               15210041
152200             SET DP013-NO-ROLLBACK                                15220041
152300                 DP013-XCTL-DISPLAY-RESTART                       15230041
152400                 DP013-CICS-ABEND  TO TRUE                        15240041
152500             MOVE '2100-CHECK-FUNCTION-KEY'                       15250041
152600                                   TO DP013-PARAGRAPH             15260041
152700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      15270041
152800                                   TO DP013-MESSAGE-TEXT (1)      15280041
152900             PERFORM DP013-0000-PROCESS-ABEND                     15290041
153000     END-EVALUATE.                                                15300041
153100                                                                  15310041
153200 2101-GET-NEXT-RECORD.                                            15320041
153300                                                                  15330041
153400     ADD +1                        TO ASC-SEL-SUB.                15340041
153500     IF  ASC-SEL-SUB > AP301-MAX-ITEMS                            15350041
153600         ADD +1                    TO ASC-SEL-ITEM                15360041
153700         MOVE +1                   TO ASC-SEL-SUB                 15370041
153800     END-IF.                                                      15380041
153900                                                                  15390041
154000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                15400041
154100         PERFORM 9100-READ-SEL-QUEUE                              15410041
154200         IF  AP301-ITEM (ASC-SEL-SUB) > ZERO                      15420041
154300             MOVE AP301-INVC-ID          (ASC-SEL-SUB)            15430041
154400                                     TO ASC-KEY-INVOICE-ID        15440041
154500                                        DK-INVOICE-ID             15450041
154600                                                                  15460041
154700             MOVE AP301-PO-NBR           (ASC-SEL-SUB)            15470041
154800                                     TO ASC-KEY-PO-NUMBER         15480041
154900                                        DK-PO-NUMBER              15490041
155000                                                                  15500041
155100             IF ASC-KEY-INVOICE-ID > SPACES                       15510041
155200                 IF ASC-KEY-PO-NUMBER = ZERO                      15520041
155300                     MOVE PC-PO-NBR-HIGH TO DK-HIGH-PO-NUMBER     15530041
155400                     MOVE PC-PO-NBR-LOW  TO DK-LOW-PO-NUMBER      15540041
155500                 ELSE                                             15550041
155600                     MOVE ASC-KEY-PO-NUMBER                       15560041
155700                                         TO DK-HIGH-PO-NUMBER     15570041
155800                                            DK-LOW-PO-NUMBER      15580041
155900                 END-IF                                           15590041
156000                 SET AP301-INQ (ASC-SEL-SUB)                      15600041
156100                                       TO TRUE                    15610041
156200                 PERFORM 9200-REWRITE-LIST-QUEUE                  15620041
156300                 PERFORM 1150-GET-INVOICE-DATA                    15630041
156400                 IF PS-NO-ERROR                                   15640041
156500                     PERFORM 1175-GET-PO-DATA                     15650041
156600                 END-IF                                           15660041
156700             ELSE                                                 15670041
156800                 MOVE PC-TSYMSG-00849    TO DP020-MSG-NUMBER      15680041
156900                 SET DP020-MSG-FATAL                              15690041
157000                     PS-ERROR            TO TRUE                  15700041
157100             END-IF                                               15710041
157200         ELSE                                                     15720041
157300             SUBTRACT +1 FROM ASC-SEL-SUB                         15730041
157400*            --- BOTTOM OF LIST ---                               15740041
157500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15750041
157600             SET DP020-MSG-INFORMATIONAL                          15760041
157700                 PS-ERROR                                         15770041
157800                                   TO TRUE                        15780041
157900         END-IF                                                   15790041
158000     ELSE                                                         15800041
158100         SUBTRACT +1 FROM ASC-SEL-ITEM                            15810041
158200         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 15820041
158300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15830041
158400         SET DP020-MSG-INFORMATIONAL                              15840041
158500             PS-ERROR                                             15850041
158600                                   TO TRUE                        15860041
158700     END-IF.                                                      15870041
158800                                                                  15880041
158900/                                                                 15890041
159000 2102-GET-PREV-RECORD.                                            15900041
159100                                                                  15910041
159200     SUBTRACT +1 FROM ASC-SEL-SUB.                                15920041
159300     IF  ASC-SEL-SUB < +1                                         15930041
159400         SUBTRACT +1 FROM ASC-SEL-ITEM                            15940041
159500         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 15950041
159600     END-IF.                                                      15960041
159700                                                                  15970041
159800     IF  ASC-SEL-ITEM > ZERO                                      15980041
159900         PERFORM 9100-READ-SEL-QUEUE                              15990041
160000         MOVE AP301-INVC-ID          (ASC-SEL-SUB)                16000041
160100                                 TO ASC-KEY-INVOICE-ID            16010041
160200                                    DK-INVOICE-ID                 16020041
160300         MOVE AP301-PO-NBR           (ASC-SEL-SUB)                16030041
160400                                 TO ASC-KEY-PO-NUMBER             16040041
160500                                    DK-PO-NUMBER                  16050041
160600         IF ASC-KEY-INVOICE-ID > SPACES                           16060041
160700             IF ASC-KEY-PO-NUMBER = ZERO                          16070041
160800                 MOVE PC-PO-NBR-HIGH TO DK-HIGH-PO-NUMBER         16080041
160900                 MOVE PC-PO-NBR-LOW  TO DK-LOW-PO-NUMBER          16090041
161000             ELSE                                                 16100041
161100                 MOVE ASC-KEY-PO-NUMBER                           16110041
161200                                     TO DK-HIGH-PO-NUMBER         16120041
161300                                        DK-LOW-PO-NUMBER          16130041
161400             END-IF                                               16140041
161500             SET AP301-INQ (ASC-SEL-SUB)                          16150041
161600                                   TO TRUE                        16160041
161700             PERFORM 9200-REWRITE-LIST-QUEUE                      16170041
161800             PERFORM 1150-GET-INVOICE-DATA                        16180041
161900             IF PS-NO-ERROR                                       16190041
162000                 PERFORM 1175-GET-PO-DATA                         16200041
162100             END-IF                                               16210041
162200         ELSE                                                     16220041
162300             MOVE PC-TSYMSG-00849    TO DP020-MSG-NUMBER          16230041
162400             SET DP020-MSG-FATAL                                  16240041
162500                 PS-ERROR            TO TRUE                      16250041
162600         END-IF                                                   16260041
162700     ELSE                                                         16270041
162800         MOVE +1                   TO ASC-SEL-ITEM                16280041
162900                                      ASC-SEL-SUB                 16290041
163000*        --- TOP OF LIST ---                                      16300041
163100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            16310041
163200         SET DP020-MSG-INFORMATIONAL                              16320041
163300             PS-ERROR                                             16330041
163400                                   TO TRUE                        16340041
163500     END-IF.                                                      16350041
163600                                                                  16360041
163700/                                                                 16370041
163800 2105-TOTAL-PIECES-CHECK.                                         16380041
163900                                                                  16390041
164000     PERFORM 4450-SELECT-TOTAL-PIECES.                            16400041
164100                                                                  16410041
164200     IF PS-NO-ERROR AND                                           16420041
164300        ASC-UNPROTECT-FIELDS                                      16430041
164400*        -- IF THE TOTAL COST OF THE ITEMS IS/IS NOT              16440041
164500*        -- IN SYNC W/ THE GRO_COST OF THE INVOICE,               16450041
164600*        -- SET THE STATUS ACCORDINGLY                            16460041
164700         IF ((ASC-CALC-TOTAL-COST NOT =                           16470041
164800              ASC-KEY-GRO-COST-AMT)                 AND           16480041
164900             (ASC-KEY-INVC-STATUS NOT =                           16490041
165000              PC-ITEM-IMBALANCE))                                 16500041
165100             MOVE PC-ITEM-IMBALANCE TO                            16510041
165200                  ASC-KEY-INVC-STATUS                             16520041
165300             PERFORM 2107-UPDATE-TINVOIC-STATUS                   16530041
165400         ELSE                                                     16540041
165500             IF ((ASC-CALC-TOTAL-COST =                           16550041
165600                  ASC-KEY-GRO-COST-AMT)             AND           16560041
165700                 (ASC-KEY-INVC-STATUS =                           16570041
165800                  PC-ITEM-IMBALANCE))                             16580041
165900*                IF THE ORIG STATUS IS 'IB', THEN DETERMINE IF    16590053
165901*                THE INVOICE IS FOR SEPHORA - THESE INVOICES      16590153
165902*                NEED TO BE RESET TO 'PJ', NOT 'EN'               16590253
165904                 IF ASC-ORIG-INVC-STATUS = 'IB'                   16590453
165906                     IF ASC-SEPHORA-PJ-IND = 'Y'                  16590681
165907                         MOVE 'PJ' TO ASC-KEY-INVC-STATUS         16590753
165908                     ELSE                                         16590853
165909                         MOVE 'EN' TO ASC-KEY-INVC-STATUS         16590953
165910                 ELSE                                             16591053
165911                     MOVE ASC-ORIG-INVC-STATUS                    16591153
165920                           TO ASC-KEY-INVC-STATUS                 16592052
165921                 END-IF                                           16592153
165930*                MOVE 'EN' TO ASC-KEY-INVC-STATUS                 16593053
166000                 PERFORM 2107-UPDATE-TINVOIC-STATUS               16600041
166100             END-IF                                               16610041
166200         END-IF                                                   16620041
166300     END-IF.                                                      16630041
166400                                                                  16640041
166500 2107-UPDATE-TINVOIC-STATUS.                                      16650041
166600                                                                  16660041
166700     PERFORM                                                      16670041
166800         WITH TEST AFTER                                          16680041
166900         VARYING PV-RETRY-COUNTER                                 16690041
167000         FROM 1 BY 1                                              16700041
167100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16710041
167200             OR (SQLCODE = +0))                                   16720041
167300                                                                  16730041
167400         EXEC SQL UPDATE TINVOIC                                  16740041
167500             SET STATUS_CDE        = :ASC-KEY-INVC-STATUS         16750041
167600               , STATUS_CHG_TMST   = CURRENT TIMESTAMP            16760041
167700          WHERE PAYT_REQ_SEQ_NBR   = :DK-PAYT-REQ-SEQ-NBR         16770041
167800                                                                  16780041
167900         END-EXEC                                                 16790041
168000                                                                  16800041
168100         EVALUATE TRUE                                            16810041
168200             WHEN SQLCODE = +0                                    16820041
168300             WHEN SQLCODE = -904                                  16830041
168400             WHEN SQLCODE = -913                                  16840041
168500                 CONTINUE                                         16850041
168600                                                                  16860041
168700             WHEN SQLWARN0 NOT = SPACES                           16870041
168800             WHEN SQLCODE < +0                                    16880041
168900             WHEN SQLCODE > +0                                    16890041
169000                 MOVE '2107-UPDATE-TINVOIC'                       16900041
169100                                   TO DP013-PARAGRAPH             16910041
169200                 MOVE 'UPDATE A ROW ON TINVOIC'                   16920041
169300                                   TO DP013-MESSAGE-TEXT(1)       16930041
169400                 MOVE SQLCA        TO DP013-SQLCA                 16940041
169500                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    16950041
169600                 SET DP013-DB2-ABEND                              16960041
169700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16970041
169800                 PERFORM DP013-0000-PROCESS-ABEND                 16980041
169900         END-EVALUATE                                             16990041
170000     END-PERFORM.                                                 17000041
170100                                                                  17010041
170200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17020041
170300         MOVE '2107-UPDATE-TINVOIC' TO DP013-PARAGRAPH            17030041
170400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              17040041
170500                                   TO DP013-MESSAGE-TEXT (1)      17050041
170600         MOVE 'TO UPDATE A TINVOIC ROW'                           17060041
170700                                   TO DP013-MESSAGE-TEXT (2)      17070041
170800         MOVE SQLCA                TO DP013-SQLCA                 17080041
170900         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    17090041
171000         SET DP013-DB2-ABEND                                      17100041
171100             DP013-XCTL-DISPLAY-RESTART                           17110041
171200                                   TO TRUE                        17120041
171300         PERFORM DP013-0000-PROCESS-ABEND                         17130041
171400     END-IF.                                                      17140041
171500                                                                  17150041
171600*----------------------------------------------------------------*17160041
171700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17170041
171800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17180041
171900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17190041
172000*    MESSAGE.                                                    *17200041
172100*----------------------------------------------------------------*17210041
172200                                                                  17220041
172300 2110-BROWSE-BACKWARD.                                            17230041
172400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17240041
172500         GIVING PV-TOP-ITEM.                                      17250041
172600*                                                                 17260041
172700     IF  ((PV-TOP-ITEM < +1)                                      17270041
172800       OR (PV-TOP-ITEM = +1))                                     17280041
172900         MOVE +1                   TO PV-TOP-ITEM                 17290041
173000*        -- TOP OF LIST --                                        17300041
173100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            17310041
173200         SET DP020-MSG-INFORMATIONAL TO TRUE                      17320041
173300     END-IF.                                                      17330041
173400                                                                  17340041
173500 EJECT                                                            17350041
173600*----------------------------------------------------------------*17360041
173700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *17370041
173800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *17380041
173900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *17390041
174000*----------------------------------------------------------------*17400041
174100                                                                  17410041
174200 2120-BROWSE-FORWARD.                                             17420041
174300                                                                  17430041
174400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              17440041
174500         GIVING PV-TOP-ITEM.                                      17450041
174600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   17460041
174700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17470041
174800                                   TO PV-TOP-ITEM                 17480041
174900*        -- BOTTOM OF LIST --                                     17490041
175000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17500041
175100         SET DP020-MSG-INFORMATIONAL                              17510041
175200                                   TO TRUE                        17520041
175300     ELSE                                                         17530041
175400         COMPUTE PV-BOTTOM-ITEM =                                 17540041
175500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 17550041
175600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            17560041
175700*            -- BOTTOM OF LIST --                                 17570041
175800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            17580041
175900             SET DP020-MSG-INFORMATIONAL                          17590041
176000                                   TO TRUE                        17600041
176100         END-IF                                                   17610041
176200     END-IF.                                                      17620041
176300 EJECT                                                            17630041
176400*----------------------------------------------------------------*17640041
176500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *17650041
176600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *17660041
176700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *17670041
176800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *17680041
176900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *17690041
177000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *17700041
177100*----------------------------------------------------------------*17710041
177200                                                                  17720041
177300 2130-CHECK-FOR-JUMP-BROWSE.                                      17730041
177400     SET PS-NO-ERROR               TO TRUE.                       17740041
177500     IF (ASC-START-ITEM-REQUEST = SPACE)                          17750041
177600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17760041
177700                                   TO PV-TOP-ITEM                 17770041
177800     ELSE                                                         17780041
177900         MOVE ASC-START-ITEM-REQUEST                              17790041
178000                                   TO DP010I-UNEDITED-FIELD       17800041
178100         MOVE PC-LIST-NUMBER-LENGTH                               17810041
178200                                   TO DP010I-MAXIMUM-DIGITS       17820041
178300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     17830041
178400         SET DP010I-NEGATIVE-NOT-ALLOWED                          17840041
178500                                   TO TRUE                        17850041
178620         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17862048
178630                         USING DP010I-NUMERIC-EDIT-AREA           17863048
178700                                                                  17870041
178800         IF  NOT DP010I-ERROR-DETECTED                            17880041
178900             MOVE DP010I-NUMERIC-FIELD                            17890041
179000                                   TO  ASC-START-ITEM-REQUEST-N   17900041
179100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  17910041
179200                 IF  ASC-START-ITEM-REQUEST-N >                   17920041
179300                                          ASC-NUMBER-OF-ITEMS-READ17930041
179400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         17940041
179500                     COMPUTE PV-TOP-ITEM =                        17950041
179600                             ASC-NUMBER-OF-ITEMS-READ             17960041
179700                             - PC-ITEMS-PER-PANEL + 1             17970041
179800                     IF  PV-TOP-ITEM < +1                         17980041
179900                         MOVE +1   TO PV-TOP-ITEM                 17990041
180000                         MOVE PC-TSYMSG-00070                     18000041
180100                                   TO DP020-MSG-NUMBER            18010041
180200                         SET DP020-MSG-INFORMATIONAL              18020041
180300                                   TO TRUE                        18030041
180400                     END-IF                                       18040041
180500                 ELSE                                             18050041
180600                     MOVE ASC-START-ITEM-REQUEST-N                18060041
180700                                   TO PV-TOP-ITEM                 18070041
180800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18080041
180900                     COMPUTE PV-BOTTOM-ITEM =                     18090041
181000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18100041
181100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18110041
181200*                        -- BOTTOM OF LIST --                     18120041
181300                         MOVE PC-TSYMSG-00070                     18130041
181400                                   TO DP020-MSG-NUMBER            18140041
181500                         SET DP020-MSG-INFORMATIONAL              18150041
181600                                   TO TRUE                        18160041
181700                     END-IF                                       18170041
181800                 END-IF                                           18180041
181900             ELSE                                                 18190041
182000*                --- VALUE OUT OF RANGE ----                      18200041
182100                 MOVE PC-TSYMSG-00101                             18210041
182200                                   TO DP020-MSG-NUMBER            18220041
182300                 MOVE -1           TO ASTRTITL                    18230041
182400                 SET DP030-SET-CURSOR-APPL-1                      18240041
182500                                   TO TRUE                        18250041
182600                 MOVE DP015-REVERSE                               18260041
182700                                   TO ASTRTITH                    18270041
182800                 MOVE DP015-RED    TO ASTRTITC                    18280041
182900                 MOVE DP015-UNP-NUM-BRT-MDT                       18290041
183000                                   TO ASTRTITA                    18300041
183100                 SET DP020-MSG-FATAL                              18310041
183200                     PS-START-ITEM-ERROR                          18320041
183300                                   TO TRUE                        18330041
183400             END-IF                                               18340041
183500                                                                  18350041
183600         ELSE                                                     18360041
183700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            18370041
183800             MOVE -1               TO ASTRTITL                    18380041
183900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18390041
184000             MOVE DP015-REVERSE    TO ASTRTITH                    18400041
184100             MOVE DP015-RED        TO ASTRTITC                    18410041
184200             MOVE DP015-UNP-NUM-BRT-MDT                           18420041
184300                                   TO ASTRTITA                    18430041
184400             SET DP020-MSG-FATAL                                  18440041
184500                 PS-START-ITEM-ERROR                              18450041
184600                                   TO TRUE                        18460041
184700         END-IF                                                   18470041
184800     END-IF.                                                      18480041
184900 EJECT                                                            18490041
185000*----------------------------------------------------------------*18500041
185100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *18510041
185200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *18520041
185300*----------------------------------------------------------------*18530041
185400 2140-DESELECT-ALL-ITEMS.                                         18540041
185500     MOVE +1                       TO ASC-BLK-SUB.                18550041
185600                                                                  18560041
185700     PERFORM 2141-CLEAR-SELECTED-INDS                             18570041
185800         VARYING ASC-ITEM-SUB                                     18580041
185900         FROM 1 BY 1                                              18590041
186000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18600041
186100                                                                  18610041
186200     MOVE +1                       TO ASC-BLK-SUB.                18620041
186300                                                                  18630041
186400     PERFORM 5100-WRITE-TEMP-STORAGE.                             18640041
186500                                                                  18650041
186600     ADD +1                        TO ASC-BLK-SUB.                18660041
186700     PERFORM 2141-CLEAR-SELECTED-INDS                             18670041
186800         VARYING ASC-ITEM-SUB                                     18680041
186900         FROM 1 BY 1                                              18690041
187000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18700041
187100                                                                  18710041
187200     PERFORM 5100-WRITE-TEMP-STORAGE.                             18720041
187300                                                                  18730041
187400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18740041
187500                                   TO PV-LIST-ITEM-NUMBER.        18750041
187600                                                                  18760041
187700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18770041
187800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18780041
187900                                                                  18790041
188000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18800041
188100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      18810041
188200                                                                  18820041
188300         MOVE +1                   TO PV-BLOCK-NUMBER             18830041
188400                                                                  18840041
188500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18850041
188600             PV-FIRST-BLOCK-IN-ARRAY - 1                          18860041
188700                                                                  18870041
188800         PERFORM                                                  18880041
188900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18890041
189000                                                                  18900041
189100             PERFORM 4410-READ-TEMP-STORAGE                       18910041
189200                                                                  18920041
189300             PERFORM 2141-CLEAR-SELECTED-INDS                     18930041
189400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 18940041
189500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18950041
189600                                                                  18960041
189700             PERFORM 5100-WRITE-TEMP-STORAGE                      18970041
189800                                                                  18980041
189900             ADD +1                TO PV-BLOCK-NUMBER             18990041
190000                                                                  19000041
190100         END-PERFORM                                              19010041
190200                                                                  19020041
190300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19030041
190400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19040041
190500                                                                  19050041
190600         PERFORM                                                  19060041
190700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19070041
190800                   ASC-HIGHEST-BLOCK-WRITTEN                      19080041
190900                                                                  19090041
191000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19100041
191100                                   TO PV-BLOCK-NUMBER             19110041
191200                                                                  19120041
191300             PERFORM 4410-READ-TEMP-STORAGE                       19130041
191400                                                                  19140041
191500             PERFORM 2141-CLEAR-SELECTED-INDS                     19150041
191600                 VARYING ASC-ITEM-SUB                             19160041
191700                 FROM 1 BY 1                                      19170041
191800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19180041
191900                                                                  19190041
192000             PERFORM 5100-WRITE-TEMP-STORAGE                      19200041
192100                                                                  19210041
192200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19220041
192300                                                                  19230041
192400         END-PERFORM                                              19240041
192500                                                                  19250041
192600         MOVE +1                   TO ASC-BLK-SUB                 19260041
192700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19270041
192800                                   TO PV-BLOCK-NUMBER             19280041
192900                                                                  19290041
193000         PERFORM 4410-READ-TEMP-STORAGE                           19300041
193100                                                                  19310041
193200         ADD +1                TO ASC-BLK-SUB                     19320041
193300                                  PV-BLOCK-NUMBER                 19330041
193400         PERFORM 4410-READ-TEMP-STORAGE                           19340041
193500     END-IF.                                                      19350041
193600                                                                  19360041
193700                                                                  19370041
193800     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 19380041
193900     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  19390041
194000     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    19400041
194100                                                                  19410041
194200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19420041
194300                                                                  19430041
194400 EJECT                                                            19440041
194500*----------------------------------------------------------------*19450041
194600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *19460041
194700*----------------------------------------------------------------*19470041
194800                                                                  19480041
194900 2141-CLEAR-SELECTED-INDS.                                        19490041
195000                                                                  19500041
195100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           19510041
195200             NOT EQUAL ZERO)                                      19520041
195300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19530041
195400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19540041
195500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    19550041
195600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19560041
195700                                   TO TRUE                        19570041
195800             IF ASC-LINE-UPDATED (ASC-BLK-SUB ASC-ITEM-SUB)       19580041
195900                 MOVE SPACES       TO ASC-LINE-PROBLEM-SW         19590041
196000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19600041
196100             ELSE                                                 19610041
196200                 MOVE SPACES       TO ASC-LINE-CHANGED-SW         19620041
196300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19630041
196400                                      ASC-LINE-PROBLEM-SW         19640041
196500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19650041
196600             END-IF                                               19660041
196700         END-IF                                                   19670041
196800     END-IF.                                                      19680041
196900                                                                  19690041
197000 EJECT                                                            19700041
197100*----------------------------------------------------------------*19710041
197200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *19720041
197300*  FOR ALL ITEMS.                                                *19730041
197400*----------------------------------------------------------------*19740041
197500                                                                  19750041
197600 2150-SELECT-ALL-ITEMS.                                           19760041
197700                                                                  19770041
197800     MOVE +1                       TO ASC-BLK-SUB.                19780041
197900                                                                  19790041
198000     PERFORM 2151-SET-SELECTED-INDS                               19800041
198100         VARYING ASC-ITEM-SUB                                     19810041
198200         FROM 1 BY 1                                              19820041
198300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19830041
198400                                                                  19840041
198500     MOVE +1                       TO ASC-BLK-SUB.                19850041
198600                                                                  19860041
198700     PERFORM 5100-WRITE-TEMP-STORAGE.                             19870041
198800                                                                  19880041
198900     ADD +1                        TO ASC-BLK-SUB.                19890041
199000                                                                  19900041
199100     PERFORM 2151-SET-SELECTED-INDS                               19910041
199200         VARYING ASC-ITEM-SUB                                     19920041
199300         FROM 1 BY 1                                              19930041
199400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19940041
199500                                                                  19950041
199600     PERFORM 5100-WRITE-TEMP-STORAGE.                             19960041
199700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19970041
199800                                   TO PV-LIST-ITEM-NUMBER.        19980041
199900                                                                  19990041
200000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20000041
200100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20010041
200200                                                                  20020041
200300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     20030041
200400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    20040041
200500         MOVE +1                   TO PV-BLOCK-NUMBER             20050041
200600                                                                  20060041
200700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20070041
200800             PV-FIRST-BLOCK-IN-ARRAY - 1                          20080041
200900                                                                  20090041
201000         PERFORM                                                  20100041
201100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       20110041
201200                                                                  20120041
201300             PERFORM 4410-READ-TEMP-STORAGE                       20130041
201400                                                                  20140041
201500             PERFORM 2151-SET-SELECTED-INDS                       20150041
201600                 VARYING ASC-ITEM-SUB                             20160041
201700                 FROM 1 BY 1                                      20170041
201800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20180041
201900                                                                  20190041
202000             PERFORM 5100-WRITE-TEMP-STORAGE                      20200041
202100                                                                  20210041
202200             ADD +1                TO PV-BLOCK-NUMBER             20220041
202300                                                                  20230041
202400         END-PERFORM                                              20240041
202500                                                                  20250041
202600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20260041
202700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20270041
202800                                                                  20280041
202900         PERFORM                                                  20290041
203000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20300041
203100                   ASC-HIGHEST-BLOCK-WRITTEN                      20310041
203200                                                                  20320041
203300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20330041
203400                                   TO PV-BLOCK-NUMBER             20340041
203500                                                                  20350041
203600             PERFORM 4410-READ-TEMP-STORAGE                       20360041
203700                                                                  20370041
203800             PERFORM 2151-SET-SELECTED-INDS                       20380041
203900                 VARYING ASC-ITEM-SUB                             20390041
204000                 FROM 1 BY 1                                      20400041
204100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20410041
204200                                                                  20420041
204300             PERFORM 5100-WRITE-TEMP-STORAGE                      20430041
204400                                                                  20440041
204500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20450041
204600                                                                  20460041
204700         END-PERFORM                                              20470041
204800                                                                  20480041
204900         MOVE +1                   TO ASC-BLK-SUB                 20490041
205000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20500041
205100                                   TO PV-BLOCK-NUMBER             20510041
205200                                                                  20520041
205300         PERFORM 4410-READ-TEMP-STORAGE                           20530041
205400                                                                  20540041
205500         ADD +1                    TO PV-BLOCK-NUMBER             20550041
205600                                      ASC-BLK-SUB                 20560041
205700         PERFORM 4410-READ-TEMP-STORAGE                           20570041
205800     END-IF.                                                      20580041
205900                                                                  20590041
206000                                                                  20600041
206100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             20610041
206200                       ASC-NUMBER-OF-SELECTED-ITEMS.              20620041
206300                                                                  20630041
206400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20640041
206500                                                                  20650041
206600 EJECT                                                            20660041
206700*----------------------------------------------------------------*20670041
206800*    MARK EACH ITEM AS BEING SELECTED.                           *20680041
206900*----------------------------------------------------------------*20690041
207000                                                                  20700041
207100 2151-SET-SELECTED-INDS.                                          20710041
207200                                                                  20720041
207300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20730041
207400             NOT EQUAL ZERO                                       20740041
207500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20750041
207600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20760041
207700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        20770041
207800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  20780041
207900                               TO  TRUE                           20790041
208000         END-IF                                                   20800041
208100     END-IF.                                                      20810041
208200******************************************************************20820041
208300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **20830041
208400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **20840041
208500******************************************************************20850041
208600 2200-MOVE-SCREEN-TO-COMMAREA.                                    20860041
208700                                                                  20870041
208800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20880041
208900     MOVE +1                       TO PV-SUB.                     20890041
209000                                                                  20900041
209100     PERFORM 3100-SET-SUBSCRIPTS.                                 20910041
209200     IF  ASTRTITL > ZERO                                          20920041
209300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          20930041
209400     ELSE                                                         20940041
209500         IF  ASTRTITF = DP015-ERASE-EOF                           20950041
209600             INITIALIZE ASC-START-ITEM-REQUEST                    20960041
209700         END-IF                                                   20970041
209800     END-IF.                                                      20980041
209900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20990041
210000         VARYING PV-SUB                                           21000041
210100         FROM 1 BY 1                                              21010041
210200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      21020041
210300******************************************************************21030041
210400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**21040041
210500******************************************************************21050041
210600 2210-MOVE-LINES-TO-COMMAREA.                                     21060041
210700     IF  AP-SELECTL (PV-SUB) > ZERO                               21070041
210800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             21080041
210900         MOVE AP-SELECT  (PV-SUB)                                 21090041
211000                                   TO ASC-TEMP-SELECTED-SW        21100041
211100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21110041
211200     ELSE                                                         21120041
211300         IF  AP-SELECTA (PV-SUB) = DP015-ERASE-EOF                21130041
211400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     21140041
211500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        21150041
211600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21160041
211700         END-IF                                                   21170041
211800     END-IF.                                                      21180041
211900     IF  AP-PIECESL (PV-SUB) > ZERO                               21190041
212000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             21200041
212100         MOVE AP-PIECES (PV-SUB)   TO ASC-INP-PIECES              21210041
212200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21220041
212300         IF AP-PIECES (PV-SUB) = SPACES                           21230041
212400             SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 21240041
212500                                   TO TRUE                        21250041
212600         ELSE                                                     21260041
212700             SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)     21270041
212800                                   TO TRUE                        21280041
212900         END-IF                                                   21290041
213000     ELSE                                                         21300041
213100         IF  AP-PIECESA (PV-SUB) = DP015-ERASE-EOF                21310041
213200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 21320041
213300                                 TO TRUE                          21330041
213400             MOVE SPACES         TO ASC-INP-PIECES                21340041
213500                                    (ASC-BLK-SUB, ASC-ITEM-SUB)   21350041
213600             MOVE ZEROES         TO ASC-PIECES                    21360041
213700                                    (ASC-BLK-SUB, ASC-ITEM-SUB)   21370041
213800             SET ASC-LINE-NOT-CHANGED                             21380041
213900                     (ASC-BLK-SUB, ASC-ITEM-SUB)                  21390041
214000                                 TO TRUE                          21400041
214100         END-IF                                                   21410041
214200     END-IF.                                                      21420041
214300     IF  AP-UNIT-COSTL (PV-SUB) > ZERO                            21430041
214400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             21440041
214500         MOVE AP-UNIT-COST(PV-SUB)   TO ASC-INP-UNIT-COST         21450041
214600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21460041
214700         IF AP-UNIT-COST (PV-SUB) = SPACES                        21470041
214800             SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 21480041
214900                                   TO TRUE                        21490041
215000         ELSE                                                     21500041
215100             SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)     21510041
215200                                   TO TRUE                        21520041
215300         END-IF                                                   21530041
215400     ELSE                                                         21540041
215500         IF  AP-UNIT-COSTA (PV-SUB) = DP015-ERASE-EOF             21550041
215600             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         21560041
215700             MOVE SPACES           TO ASC-INP-UNIT-COST           21570041
215800                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  21580041
215900             MOVE ZEROES           TO ASC-UNIT-COST               21590041
216000                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  21600041
216100             SET ASC-LINE-NOT-CHANGED                             21610041
216200                         (ASC-BLK-SUB, ASC-ITEM-SUB)              21620041
216300                                   TO TRUE                        21630041
216400         END-IF                                                   21640041
216500     END-IF.                                                      21650041
216600     ADD +1                        TO ASC-ITEM-SUB.               21660041
216700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21670041
216800         ADD +1                    TO ASC-BLK-SUB                 21680041
216900         MOVE +1                   TO ASC-ITEM-SUB                21690041
217000     END-IF.                                                      21700041
217100******************************************************************21710041
217200**   WHEN A LOCAL AND GO FUNCTION KEY IS PRESSED THIS PARAGRAPH **21720041
217300**   WILL MOVE ALL FIELDS NECESSARY TO THE INTER APPLICATION    **21730041
217400**   COMMAREA.                                                  **21740041
217500******************************************************************21750041
217600 2400-PREPARE-INTER-APPL-COMM.                                    21760041
217700     INITIALIZE AP300-INTER-APPL-COMMAREA.                        21770041
217800                                                                  21780041
217900     MOVE ASC-KEY-PO-NUMBER      TO AP300-PO-NBR.                 21790041
218000     MOVE ASC-KEY-INVOICE-ID     TO AP300-INVC-ID.                21800041
218100     MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                                21810041
218200                                 TO AP300-REC-SEQ-NBR.            21820041
218300     MOVE ASC-KEY-STORE-NUMBER   TO AP300-STORE-NBR.              21830041
218400     MOVE ASC-KEY-DEPT-NBR       TO AP300-DEPT-NBR.               21840041
218500     MOVE ASC-KEY-DC-NBR         TO AP300-DC-NBR.                 21850041
218600     MOVE ASC-KEY-MTCH-LVL-CDE   TO AP300-MTCH-LVL-IND.           21860041
218700                                                                  21870041
218800     IF ASC-NUMBER-OF-SELECTED-ITEMS > 0                          21880041
218900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21890041
219000                                 TO AP300-NUMBER-OF-SELECTED-ITEMS21900041
219100         PERFORM 5000-PREPARE-SEL-QUEUE                           21910041
219200     ELSE                                                         21920041
219300         MOVE 0  TO AP300-NUMBER-OF-SELECTED-ITEMS                21930041
219400         PERFORM 5000-PREPARE-SEL-QUEUE                           21940041
219500         SET ASC-NO-TSQ-UPDATE                                    21950041
219600                                 TO TRUE                          21960041
219700     END-IF.                                                      21970041
219800                                                                  21980041
219900******************************************************************21990041
220000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **22000041
220100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **22010041
220200******************************************************************22020041
220300 3000-EDIT-DATA-IN-COMMAREA.                                      22030041
220400     SET PS-NO-ERROR               TO TRUE.                       22040041
220500     PERFORM 3200-RESET-ATTRIBUTES.                               22050041
220600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     22060041
220700**                                                                22070041
220800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              22080041
220900* EDITTING IS DONE FROM THE BOTTOM UP.                            22090041
221000**                                                                22100041
221100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       22110041
221200         ASC-ITEMS-DISPLAYED - 1.                                 22120041
221300     PERFORM 3100-SET-SUBSCRIPTS.                                 22130041
221400     PERFORM 3300-EDIT-SELECTIONS                                 22140041
221500         VARYING PV-SUB                                           22150041
221600         FROM PV-SUB BY -1                                        22160041
221700         UNTIL PV-SUB < +1                                        22170041
221800*                                                                 22180041
221900     IF  PS-NO-ERROR                                              22190041
222000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        22200041
222100     END-IF.                                                      22210041
222200*                                                                 22220041
222300     IF  ((PS-NO-ERROR)                                           22230041
222400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   22240041
222500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    22250041
222600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  22260041
222700     END-IF.                                                      22270041
222800                                                                  22280041
222900 EJECT                                                            22290041
223000*----------------------------------------------------------------*22300041
223100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *22310041
223200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*22320041
223300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *22330041
223400*                                                                *22340041
223500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *22350041
223600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *22360041
223700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *22370041
223800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *22380041
223900*----------------------------------------------------------------*22390041
224000                                                                  22400041
224100 3100-SET-SUBSCRIPTS.                                             22410041
224200                                                                  22420041
224300     COMPUTE ASC-ITEM-SUB =                                       22430041
224400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        22440041
224500                                                                  22450041
224600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         22460041
224700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22470041
224800                                                                  22480041
224900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               22490041
225000     ELSE                                                         22500041
225100         MOVE +1                     TO ASC-BLK-SUB               22510041
225200     END-IF.                                                      22520041
225300******************************************************************22530041
225400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **22540041
225500******************************************************************22550041
225600                                                                  22560041
225700 3200-RESET-ATTRIBUTES.                                           22570041
225800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   22580041
225900     MOVE DP015-GREEN              TO ASTRTITC.                   22590041
226000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   22600041
226100*                                                                 22610041
226200     PERFORM                                                      22620041
226300         VARYING PV-SUB                                           22630041
226400         FROM 1 BY 1                                              22640041
226500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        22650041
226600         IF ASC-UNPROTECT-FIELDS                                  22660041
226700             MOVE DP015-UNP-ALP-NOR-OFF                           22670041
226800                                   TO AP-SELECTA (PV-SUB)         22680041
226900             MOVE DP015-UNP-NUM-NOR-OFF                           22690041
227000                                   TO AP-PIECESA(PV-SUB)          22700041
227100                                      AP-UNIT-COSTA(PV-SUB)       22710041
227200             MOVE DP015-GREEN      TO AP-SELECTC (PV-SUB)         22720041
227300                                      AP-PIECESC (PV-SUB)         22730041
227400                                      AP-UNIT-COSTC(PV-SUB)       22740041
227500             MOVE DP015-UNDERLINE  TO AP-SELECTH (PV-SUB)         22750041
227600                                      AP-PIECESH (PV-SUB)         22760041
227700                                      AP-UNIT-COSTH(PV-SUB)       22770041
227800         ELSE                                                     22780041
227900             MOVE DP015-PRO-NOR-OFF                               22790041
228000                                   TO AP-PIECESA(PV-SUB)          22800041
228100                                      AP-UNIT-COSTA(PV-SUB)       22810041
228200             MOVE DP015-BLUE       TO AP-PIECESC (PV-SUB)         22820041
228300                                      AP-UNIT-COSTC(PV-SUB)       22830041
228400             MOVE DP015-HL-OFF     TO AP-PIECESH (PV-SUB)         22840041
228500                                      AP-UNIT-COSTH(PV-SUB)       22850041
228600*            IF ASC-PROTECT-EDI-FIELDS OR                         22860041
228700*            IF ASC-PROTECT-RI-FIELDS OR                          22870041
228800             IF ASC-ALLOW-SELECT-ONLY                             22880041
228900                 MOVE DP015-UNP-ALP-NOR-OFF                       22890041
229000                                   TO AP-SELECTA (PV-SUB)         22900041
229100                 MOVE DP015-GREEN  TO AP-SELECTC (PV-SUB)         22910041
229200                 MOVE DP015-UNDERLINE                             22920041
229300                                   TO AP-SELECTH (PV-SUB)         22930041
229400             ELSE                                                 22940041
229500                 MOVE DP015-HL-OFF TO AP-SELECTH (PV-SUB)         22950041
229600                 MOVE DP015-BLUE   TO AP-SELECTC (PV-SUB)         22960041
229700                 MOVE DP015-PRO-NOR-OFF                           22970041
229800                                   TO AP-SELECTA (PV-SUB)         22980041
229900                 MOVE SPACES       TO AP-SELECT (PV-SUB)          22990041
230000             END-IF                                               23000041
230100         END-IF                                                   23010041
230200     END-PERFORM.                                                 23020041
230300******************************************************************23030041
230400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **23040041
230500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **23050041
230600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **23060041
230700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **23070041
230800******************************************************************23080041
230900 3300-EDIT-SELECTIONS.                                            23090041
231000     EVALUATE TRUE                                                23100041
231100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23110041
231200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         23120041
231300                 CONTINUE                                         23130041
231400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         23140041
231500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        23150041
231600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   23160041
231700                 MOVE ASC-TEMP-SELECTED-SW                        23170041
231800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23180041
231900                                TO ASC-SELECTED-SW                23190041
232000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23200041
232100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             23210041
232200                                TO TRUE                           23220041
232300             END-IF                                               23230041
232400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23240041
232500                 = SPACE                                          23250041
232600             EVALUATE TRUE                                        23260041
232700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       23270041
232800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS23280041
232900                     MOVE SPACE TO ASC-SELECTED-SW                23290041
233000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23300041
233100                     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)         23310041
233200                                TO TRUE                           23320041
233300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        23330041
233400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    23340041
233500                     MOVE SPACE TO ASC-SELECTED-SW                23350041
233600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23360041
233700                     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)         23370041
233800                                TO TRUE                           23380041
233900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          23390041
234000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      23400041
234100                     MOVE SPACE TO ASC-SELECTED-SW                23410041
234200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23420041
234300                     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)         23430041
234400                                TO TRUE                           23440041
234500             END-EVALUATE                                         23450041
234600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           23460041
234700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23470041
234800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23480041
234900             END-IF                                               23490041
235000             PERFORM 3310-EDIT-RANGE                              23500041
235100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             23510041
235200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23520041
235300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23530041
235400             END-IF                                               23540041
235500             PERFORM 3310-EDIT-RANGE                              23550041
235600         WHEN OTHER                                               23560041
235700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           23570041
235800             SET DP020-MSG-FATAL    TO TRUE                       23580041
235900             MOVE -1                TO AP-SELECTL (PV-SUB)        23590041
236000             SET DP030-SET-CURSOR-APPL-1                          23600041
236100                                    TO TRUE                       23610041
236200             MOVE DP015-RED         TO AP-SELECTC (PV-SUB)        23620041
236300             MOVE DP015-REVERSE     TO AP-SELECTH (PV-SUB)        23630041
236400             SET PS-ERROR TO TRUE                                 23640041
236500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23650041
236600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     23660041
236700                 MOVE SPACE         TO ASC-SELECTED-SW            23670041
236800                                        (ASC-BLK-SUB ASC-ITEM-SUB)23680041
236900             END-IF                                               23690041
237000     END-EVALUATE.                                                23700041
237100                                                                  23710041
237200     IF (ASC-LINE-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB))             23720041
237300         MOVE ASC-INP-PIECES (ASC-BLK-SUB ASC-ITEM-SUB)           23730041
237400                                 TO DP010I-UNEDITED-FIELD         23740041
237500         MOVE LENGTH OF ASC-INP-PIECES                            23750041
237600                                 TO DP010I-MAXIMUM-DIGITS         23760041
237700         MOVE +3                 TO DP010I-MAXIMUM-DECIMALS       23770041
237800         SET DP010I-NEGATIVE-NOT-ALLOWED                          23780041
237900                                 TO TRUE                          23790041
238020         CALL DP010I-NUMERIC-EDIT-ROUTINE                         23802048
238030                         USING DP010I-NUMERIC-EDIT-AREA           23803048
238100         IF DP010I-ERROR-DETECTED                                 23810041
238200             SET PS-ERROR        TO TRUE                          23820041
238300             SET ASC-LINE-ERROR(ASC-BLK-SUB ASC-ITEM-SUB)         23830041
238400                                 TO TRUE                          23840041
238500             SET DP020-MSG-FATAL TO TRUE                          23850041
238600             MOVE PC-TSYMSG-00008                                 23860041
238700                                 TO DP020-MSG-NUMBER              23870041
238800             MOVE DP015-UNP-NUM-BRT-OFF                           23880041
238900                                 TO AP-PIECESA (PV-SUB)           23890041
239000             MOVE DP015-RED      TO AP-PIECESC (PV-SUB)           23900041
239100             MOVE DP015-REVERSE  TO AP-PIECESH (PV-SUB)           23910041
239200             MOVE -1             TO AP-PIECESL (PV-SUB)           23920041
239300             SET DP030-SET-CURSOR-APPL-1                          23930041
239400                                 TO TRUE                          23940041
239500         ELSE                                                     23950041
239600             MOVE DP010I-NUMERIC-FIELD                            23960041
239700                                 TO ASC-PIECES                    23970041
239800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23980041
239900             IF (ASC-PIECES (ASC-BLK-SUB ASC-ITEM-SUB)            23990041
240000                     < ZERO)                                      24000041
240100                 SET PS-ERROR    TO TRUE                          24010041
240200                 SET ASC-LINE-ERROR(ASC-BLK-SUB ASC-ITEM-SUB)     24020041
240300                                 TO TRUE                          24030041
240400                 SET DP020-MSG-FATAL                              24040041
240500                                 TO TRUE                          24050041
240600                 MOVE PC-TSYMSG-00008                             24060041
240700                                 TO DP020-MSG-NUMBER              24070041
240800                 MOVE DP015-UNP-NUM-BRT-OFF                       24080041
240900                                 TO AP-PIECESA (PV-SUB)           24090041
241000                 MOVE DP015-RED  TO AP-PIECESC (PV-SUB)           24100041
241100                 MOVE DP015-REVERSE                               24110041
241200                                 TO AP-PIECESH (PV-SUB)           24120041
241300                 MOVE -1         TO AP-PIECESL (PV-SUB)           24130041
241400                 SET DP030-SET-CURSOR-APPL-1                      24140041
241500                                 TO TRUE                          24150041
241600             END-IF                                               24160041
241700         END-IF                                                   24170041
241800         MOVE ASC-INP-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)        24180041
241900                                 TO DP010I-UNEDITED-FIELD         24190041
242000         MOVE LENGTH OF ASC-INP-UNIT-COST                         24200041
242100                                 TO DP010I-MAXIMUM-DIGITS         24210041
242200         MOVE +3                 TO DP010I-MAXIMUM-DECIMALS       24220041
242300         SET DP010I-NEGATIVE-NOT-ALLOWED                          24230041
242400                                 TO TRUE                          24240041
242520         CALL DP010I-NUMERIC-EDIT-ROUTINE                         24252048
242530                         USING DP010I-NUMERIC-EDIT-AREA           24253048
242600         IF DP010I-ERROR-DETECTED                                 24260041
242700             SET PS-ERROR        TO TRUE                          24270041
242800             SET ASC-LINE-ERROR(ASC-BLK-SUB ASC-ITEM-SUB)         24280041
242900                                 TO TRUE                          24290041
243000             SET DP020-MSG-FATAL TO TRUE                          24300041
243100             MOVE PC-TSYMSG-00008                                 24310041
243200                                 TO DP020-MSG-NUMBER              24320041
243300             MOVE DP015-UNP-NUM-BRT-OFF                           24330041
243400                                 TO AP-UNIT-COSTA (PV-SUB)        24340041
243500             MOVE DP015-RED      TO AP-UNIT-COSTC (PV-SUB)        24350041
243600             MOVE DP015-REVERSE  TO AP-UNIT-COSTH (PV-SUB)        24360041
243700             MOVE -1             TO AP-UNIT-COSTL (PV-SUB)        24370041
243800             SET DP030-SET-CURSOR-APPL-1                          24380041
243900                                 TO TRUE                          24390041
244000         ELSE                                                     24400041
244100             MOVE DP010I-NUMERIC-FIELD                            24410041
244200                                 TO ASC-UNIT-COST                 24420041
244300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24430041
244400             IF (ASC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)         24440041
244500                     < ZERO)                                      24450041
244600                 SET PS-ERROR    TO TRUE                          24460041
244700                 SET ASC-LINE-ERROR(ASC-BLK-SUB ASC-ITEM-SUB)     24470041
244800                                 TO TRUE                          24480041
244900                 SET DP020-MSG-FATAL                              24490041
245000                                 TO TRUE                          24500041
245100                 MOVE PC-TSYMSG-00008                             24510041
245200                                 TO DP020-MSG-NUMBER              24520041
245300                 MOVE DP015-UNP-NUM-BRT-OFF                       24530041
245400                                 TO AP-UNIT-COSTA (PV-SUB)        24540041
245500                 MOVE DP015-RED  TO AP-UNIT-COSTC (PV-SUB)        24550041
245600                 MOVE DP015-REVERSE                               24560041
245700                                 TO AP-UNIT-COSTH (PV-SUB)        24570041
245800                 MOVE -1         TO AP-UNIT-COSTL (PV-SUB)        24580041
245900                 SET DP030-SET-CURSOR-APPL-1                      24590041
246000                                 TO TRUE                          24600041
246100             END-IF                                               24610041
246200         END-IF                                                   24620041
246300     END-IF.                                                      24630041
246400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 24640041
246500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               24650041
246600     IF  ASC-ITEM-SUB < 1                                         24660041
246700         SUBTRACT +1 FROM ASC-BLK-SUB                             24670041
246800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                24680041
246900     END-IF.                                                      24690041
247000******************************************************************24700041
247100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **24710041
247200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **24720041
247300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**24730041
247400** THE ENDING.                                                  **24740041
247500******************************************************************24750041
247600 3310-EDIT-RANGE.                                                 24760041
247700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                24770041
247800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   24780041
247900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)24790041
248000                                   TO ASC-SELECTED-SW             24800041
248100                                        (ASC-BLK-SUB ASC-ITEM-SUB)24810041
248200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 24820041
248300         ELSE                                                     24830041
248400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     24840041
248500                 CONTINUE                                         24850041
248600             ELSE                                                 24860041
248700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        24870041
248800                 MOVE PC-TSYMSG-00054                             24880041
248900                                   TO DP020-MSG-NUMBER            24890041
249000                 SET DP020-MSG-FATAL                              24900041
249100                                   TO TRUE                        24910041
249200                 MOVE -1           TO AP-SELECTL (PV-SUB)         24920041
249300                 SET DP030-SET-CURSOR-APPL-1                      24930041
249400                                   TO TRUE                        24940041
249500                 MOVE DP015-RED    TO AP-SELECTC (PV-SUB)         24950041
249600                 MOVE DP015-UNDERLINE                             24960041
249700                                   TO AP-SELECTH (PV-SUB)         24970041
249800                 SET PS-ERROR      TO TRUE                        24980041
249900             END-IF                                               24990041
250000         END-IF                                                   25000041
250100     ELSE                                                         25010041
250200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25020041
250300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 25030041
250400                                   TO ASC-SELECTED-SW             25040041
250500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   25050041
250600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   25060041
250700         ELSE                                                     25070041
250800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       25080041
250900                 CONTINUE                                         25090041
251000             ELSE                                                 25100041
251100*                -- ONLY ONE END-OF-RANGE ALLOWED --              25110041
251200                 MOVE PC-TSYMSG-00055                             25120041
251300                                   TO DP020-MSG-NUMBER            25130041
251400                 SET DP020-MSG-FATAL                              25140041
251500                                   TO TRUE                        25150041
251600                 MOVE -1           TO AP-SELECTL (PV-SUB)         25160041
251700                 SET DP030-SET-CURSOR-APPL-1                      25170041
251800                                   TO TRUE                        25180041
251900                 SET PS-ERROR      TO TRUE                        25190041
252000             END-IF                                               25200041
252100         END-IF                                                   25210041
252200     END-IF.                                                      25220041
252300*                                                                 25230041
252400******************************************************************25240041
252500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **25250041
252600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **25260041
252700******************************************************************25270041
252800 3400-CHECK-RANGE-SEQUENCE.                                       25280041
252900     IF (ASC-START-OF-SELECTED-RANGE > ZERO)                      25290041
253000       AND (ASC-END-OF-SELECTED-RANGE > ZERO)                     25300041
253100       AND (ASC-START-OF-SELECTED-RANGE >                         25310041
253200                ASC-END-OF-SELECTED-RANGE)                        25320041
253300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                25330041
253400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 25340041
253500         SET DP020-MSG-FATAL TO TRUE                              25350041
253600         SET PS-ERROR TO TRUE                                     25360041
253700         PERFORM 3410-POSITION-AT-ERROR                           25370041
253800     END-IF.                                                      25380041
253900******************************************************************25390041
254000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **25400041
254100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **25410041
254200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **25420041
254300******************************************************************25430041
254400 3410-POSITION-AT-ERROR.                                          25440041
254500     SET DP030-SET-CURSOR-APPL-1                                  25450041
254600                                   TO TRUE.                       25460041
254700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25470041
254800                    - PV-TOP-ITEM + 1.                            25480041
254900     IF (PV-SUB < +1 OR > PC-ITEMS-PER-PANEL)                     25490041
255000         CONTINUE                                                 25500041
255100     ELSE                                                         25510041
255200         MOVE -1                   TO AP-SELECTL (PV-SUB)         25520041
255300         MOVE DP015-REVERSE        TO AP-SELECTH (PV-SUB)         25530041
255400         MOVE DP015-RED            TO AP-SELECTC (PV-SUB)         25540041
255500     END-IF.                                                      25550041
255600*                                                                 25560041
255700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25570041
255800                    - PV-TOP-ITEM + 1.                            25580041
255900     IF (PV-SUB < +1 OR > PC-ITEMS-PER-PANEL)                     25590041
256000         CONTINUE                                                 25600041
256100     ELSE                                                         25610041
256200         MOVE -1                   TO AP-SELECTL (PV-SUB)         25620041
256300         MOVE DP015-REVERSE        TO AP-SELECTH (PV-SUB)         25630041
256400         MOVE DP015-RED            TO AP-SELECTC (PV-SUB)         25640041
256500     END-IF.                                                      25650041
256600 EJECT                                                            25660041
256700*----------------------------------------------------------------*25670041
256800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *25680041
256900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *25690041
257000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *25700041
257100*----------------------------------------------------------------*25710041
257200                                                                  25720041
257300 3500-MARK-RANGE-AS-SELECTED.                                     25730041
257400     MOVE +1                       TO  ASC-BLK-SUB.               25740041
257500     PERFORM 3510-MARK-SELECTED-INDS                              25750041
257600         VARYING ASC-ITEM-SUB                                     25760041
257700         FROM 1 BY 1                                              25770041
257800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25780041
257900     MOVE +1                       TO ASC-BLK-SUB.                25790041
258000     PERFORM 5100-WRITE-TEMP-STORAGE.                             25800041
258100                                                                  25810041
258200     ADD +1                        TO ASC-BLK-SUB.                25820041
258300     PERFORM 3510-MARK-SELECTED-INDS                              25830041
258400         VARYING ASC-ITEM-SUB                                     25840041
258500         FROM 1 BY 1                                              25850041
258600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25860041
258700     PERFORM 5100-WRITE-TEMP-STORAGE.                             25870041
258800                                                                  25880041
258900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               25890041
259000                                   TO  PV-LIST-ITEM-NUMBER.       25900041
259100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            25910041
259200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         25920041
259300               PC-ITEMS-PER-PANEL).                               25930041
259400                                                                  25940041
259500     MOVE ASC-START-OF-SELECTED-RANGE                             25950041
259600                                   TO PV-START-OF-SELECTED-RANGE. 25960041
259700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            25970041
259800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  25980041
259900               PC-ITEMS-PER-PANEL).                               25990041
260000                                                                  26000041
260100     MOVE ASC-END-OF-SELECTED-RANGE                               26010041
260200                                   TO  PV-END-OF-SELECTED-RANGE.  26020041
260300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             26030041
260400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    26040041
260500               PC-ITEMS-PER-PANEL).                               26050041
260600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             26060041
260700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             26070041
260800                                                                  26080041
260900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    26090041
261000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        26100041
261100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         26110041
261200             PV-FIRST-BLOCK-IN-ARRAY - 1                          26120041
261300                                                                  26130041
261400         PERFORM                                                  26140041
261500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      26150041
261600                   PV-PREV-BLOCK-IN-ARRAY                         26160041
261700             MOVE PV-FIRST-BLOCK-IN-RANGE                         26170041
261800                                   TO PV-BLOCK-NUMBER             26180041
261900             PERFORM 4410-READ-TEMP-STORAGE                       26190041
262000             PERFORM 3510-MARK-SELECTED-INDS                      26200041
262100                 VARYING ASC-ITEM-SUB                             26210041
262200                 FROM 1 BY 1                                      26220041
262300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26230041
262400             PERFORM 5100-WRITE-TEMP-STORAGE                      26240041
262500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     26250041
262600         END-PERFORM                                              26260041
262700                                                                  26270041
262800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         26280041
262900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     26290041
263000         PERFORM                                                  26300041
263100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       26310041
263200                   PV-LAST-BLOCK-IN-RANGE                         26320041
263300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          26330041
263400                                   TO PV-BLOCK-NUMBER             26340041
263500             PERFORM 4410-READ-TEMP-STORAGE                       26350041
263600             PERFORM 3510-MARK-SELECTED-INDS                      26360041
263700                 VARYING ASC-ITEM-SUB                             26370041
263800                 FROM 1 BY 1                                      26380041
263900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26390041
264000             PERFORM 5100-WRITE-TEMP-STORAGE                      26400041
264100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      26410041
264200         END-PERFORM                                              26420041
264300                                                                  26430041
264400         MOVE +1                   TO ASC-BLK-SUB                 26440041
264500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             26450041
264600                                   TO PV-BLOCK-NUMBER             26460041
264700         PERFORM 4410-READ-TEMP-STORAGE                           26470041
264800                                                                  26480041
264900         ADD +1                    TO PV-BLOCK-NUMBER             26490041
265000                                      ASC-BLK-SUB                 26500041
265100         PERFORM 4410-READ-TEMP-STORAGE                           26510041
265200     END-IF.                                                      26520041
265300                                                                  26530041
265400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 26540041
265500                                      ASC-END-OF-SELECTED-RANGE.  26550041
265600                                                                  26560041
265700 EJECT                                                            26570041
265800*----------------------------------------------------------------*26580041
265900*  PROCESSES THROUGHT THE SELECTED ITEMS AND EDITS FIRST FOR     *26590041
266000*  ERRORS AND THEN FOR WARNINGS                                  *26600041
266100*----------------------------------------------------------------*26610041
266200 3700-EDIT-SELECTED-ITEMS.                                        26620041
266300     MOVE 0                      TO PV-FIRST-ERROR-ITEM           26630041
266400                                    PV-FIRST-WARNING-ITEM         26640041
266500                                    PV-SUB.                       26650041
266600                                                                  26660041
266700     COMPUTE PV-BOTTOM-ITEM =                                     26670041
266800         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    26680041
266900                                                                  26690041
267000     MOVE +1                     TO ASC-BLK-SUB.                  26700041
267100     PERFORM                                                      26710041
267200         VARYING ASC-ITEM-SUB                                     26720041
267300         FROM 1 BY 1                                              26730041
267400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  26740041
267500                                                                  26750041
267600         IF (ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB) AND            26760041
267700             NOT ASC-LINE-UPDATED (ASC-BLK-SUB ASC-ITEM-SUB))     26770041
267800             PERFORM 3710-EDIT-ITEM                               26780041
267900         ELSE                                                     26790041
268000            IF NOT ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)         26800041
268100                SET ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)        26810041
268200                                 TO TRUE                          26820041
268300                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)              26830041
268400                                 TO TRUE                          26840041
268500            END-IF                                                26850041
268600         END-IF                                                   26860041
268700                                                                  26870041
268800     END-PERFORM                                                  26880041
268900     MOVE +1                     TO ASC-BLK-SUB.                  26890041
269000     PERFORM 5100-WRITE-TEMP-STORAGE.                             26900041
269100                                                                  26910041
269200     ADD +1                      TO ASC-BLK-SUB.                  26920041
269300     PERFORM                                                      26930041
269400         VARYING ASC-ITEM-SUB                                     26940041
269500         FROM 1 BY 1                                              26950041
269600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  26960041
269700                                                                  26970041
269800         IF (ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB) AND            26980041
269900             NOT ASC-LINE-UPDATED (ASC-BLK-SUB ASC-ITEM-SUB))     26990041
270000             PERFORM 3710-EDIT-ITEM                               27000041
270100         ELSE                                                     27010041
270200            IF NOT ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)         27020041
270300                SET ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)        27030041
270400                                 TO TRUE                          27040041
270500                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)              27050041
270600                                 TO TRUE                          27060041
270700            END-IF                                                27070041
270800         END-IF                                                   27080041
270900                                                                  27090041
271000     END-PERFORM                                                  27100041
271100     PERFORM 5100-WRITE-TEMP-STORAGE.                             27110041
271200                                                                  27120041
271300     MOVE ASC-LIST-ITEM-NUMBER (1 1)                              27130041
271400                                 TO PV-LIST-ITEM-NUMBER.          27140041
271500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            27150041
271600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    27160041
271700                                                                  27170041
271800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     27180041
271900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      27190041
272000                                                                  27200041
272100         MOVE +1                 TO PV-BLOCK-NUMBER               27210041
272200                                                                  27220041
272300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         27230041
272400             PV-FIRST-BLOCK-IN-ARRAY - 1                          27240041
272500         PERFORM                                                  27250041
272600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       27260041
272700                                                                  27270041
272800             PERFORM 4410-READ-TEMP-STORAGE                       27280041
272900                                                                  27290041
273000             PERFORM                                              27300041
273100                 VARYING ASC-ITEM-SUB                             27310041
273200                 FROM 1 BY 1                                      27320041
273300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          27330041
273400                                                                  27340041
273500                 IF (ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB) AND    27350041
273600                     NOT ASC-LINE-UPDATED                         27360041
273700                             (ASC-BLK-SUB ASC-ITEM-SUB))          27370041
273800                     PERFORM 3710-EDIT-ITEM                       27380041
273900                 ELSE                                             27390041
274000                    IF NOT ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB) 27400041
274100                        SET ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)27410041
274200                                 TO TRUE                          27420041
274300                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)      27430041
274400                                 TO TRUE                          27440041
274500                    END-IF                                        27450041
274600                 END-IF                                           27460041
274700                                                                  27470041
274800             END-PERFORM                                          27480041
274900                                                                  27490041
275000             PERFORM 5100-WRITE-TEMP-STORAGE                      27500041
275100                                                                  27510041
275200             ADD +1              TO PV-BLOCK-NUMBER               27520041
275300         END-PERFORM                                              27530041
275400                                                                  27540041
275500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         27550041
275600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     27560041
275700                                                                  27570041
275800         PERFORM                                                  27580041
275900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       27590041
276000                   ASC-HIGHEST-BLOCK-WRITTEN                      27600041
276100                                                                  27610041
276200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          27620041
276300                                 TO PV-BLOCK-NUMBER               27630041
276400             PERFORM 4410-READ-TEMP-STORAGE                       27640041
276500             PERFORM                                              27650041
276600                 VARYING ASC-ITEM-SUB                             27660041
276700                 FROM 1 BY 1                                      27670041
276800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          27680041
276900                                                                  27690041
277000                 IF (ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB) AND    27700041
277100                     NOT ASC-LINE-UPDATED                         27710041
277200                             (ASC-BLK-SUB ASC-ITEM-SUB))          27720041
277300                     PERFORM 3710-EDIT-ITEM                       27730041
277400                 ELSE                                             27740041
277500                    IF NOT ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB) 27750041
277600                        SET ASC-LINE-OK (ASC-BLK-SUB ASC-ITEM-SUB)27760041
277700                                 TO TRUE                          27770041
277800                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)      27780041
277900                                 TO TRUE                          27790041
278000                    END-IF                                        27800041
278100                 END-IF                                           27810041
278200                                                                  27820041
278300             END-PERFORM                                          27830041
278400                                                                  27840041
278500             PERFORM 5100-WRITE-TEMP-STORAGE                      27850041
278600                                                                  27860041
278700             ADD +1              TO PV-NEXT-BLOCK-IN-ARRAY        27870041
278800         END-PERFORM                                              27880041
278900                                                                  27890041
279000         MOVE +1                   TO ASC-BLK-SUB                 27900041
279100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             27910041
279200                                 TO PV-BLOCK-NUMBER               27920041
279300         PERFORM 4410-READ-TEMP-STORAGE                           27930041
279400                                                                  27940041
279500         ADD +1                    TO PV-BLOCK-NUMBER             27950041
279600                                      ASC-BLK-SUB                 27960041
279700         PERFORM 4410-READ-TEMP-STORAGE                           27970041
279800     END-IF.                                                      27980041
279900                                                                  27990041
280000                                                                  28000041
280100******************************************************************28010041
280200*  DOES ALL EDITS ON A SELECTED ITEM                             *28020041
280300******************************************************************28030041
280400 3710-EDIT-ITEM.                                                  28040041
280500     SET ASC-LINE-OK(ASC-BLK-SUB ASC-ITEM-SUB)                    28050041
280600                                 TO TRUE.                         28060041
280700     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                         28070041
280800                                 TO TRUE.                         28080041
280900     IF ASC-PIECES (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO              28090041
281000         SET PS-LINE-ERROR       TO TRUE                          28100041
281100         SET PS-ERROR-ON-LINE    TO TRUE                          28110041
281200         SET ASC-LINE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)            28120041
281300                                 TO TRUE                          28130041
281400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     28140041
281500                                 TO  TRUE                         28150041
281600         IF (ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)      28160041
281700               < PV-FIRST-ERROR-ITEM) OR                          28170041
281800            (PV-FIRST-ERROR-ITEM = ZERO)                          28180041
281900                                                                  28190041
282000             MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) 28200041
282100                                 TO PV-FIRST-ERROR-ITEM           28210041
282200         END-IF                                                   28220041
282300         IF ((ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)     28230041
282400                  >= PV-TOP-ITEM) AND                             28240041
282500              (ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)    28250041
282600                  <= PV-BOTTOM-ITEM))                             28260041
282700             SET PS-ERROR       TO TRUE                           28270041
282800         END-IF                                                   28280041
282900     END-IF.                                                      28290041
283000                                                                  28300041
283100*----------------------------------------------------------------*28310041
283200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *28320041
283300*----------------------------------------------------------------*28330041
283400                                                                  28340041
283500 3510-MARK-SELECTED-INDS.                                         28350041
283600                                                                  28360041
283700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28370041
283800                                ASC-ITEM-SUB) >                   28380041
283900         ASC-START-OF-SELECTED-RANGE)                             28390041
284000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28400041
284100                                ASC-ITEM-SUB) =                   28410041
284200         ASC-START-OF-SELECTED-RANGE)                             28420041
284300                                                                  28430041
284400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28440041
284500                                    ASC-ITEM-SUB) <               28450041
284600             ASC-END-OF-SELECTED-RANGE)                           28460041
284700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28470041
284800                                    ASC-ITEM-SUB) =               28480041
284900             ASC-END-OF-SELECTED-RANGE)                           28490041
285000                                                                  28500041
285100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          28510041
285200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   28520041
285300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   28530041
285400                               TO TRUE                            28540041
285500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              28550041
285600                               TO TRUE                            28560041
285700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    28570041
285800             END-IF                                               28580041
285900         END-IF                                                   28590041
286000     END-IF.                                                      28600041
286100                                                                  28610041
286200 EJECT                                                            28620041
286300*----------------------------------------------------------------*28630041
286400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *28640041
286500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *28650041
286600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *28660041
286700*    DISPLAY THE PANEL TO USER.                                  *28670041
286800*----------------------------------------------------------------*28680041
286900                                                                  28690041
287000 4000-BUILD-INITIAL-PANEL.                                        28700041
287100                                                                  28710041
287200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            28720041
287300                                 ASC-BLOCK-ENTRIES (2).           28730041
287400     MOVE +1                 TO ASC-BLK-SUB.                      28740041
287500     SET ASC-ITEMS-LEFT-ON-DB                                     28750041
287600                             TO TRUE.                             28760041
287700                                                                  28770041
287800     MOVE +0                 TO ASC-ITEM-SUB                      28780041
287900                                ASC-NUMBER-OF-ITEMS-READ          28790041
288000                                ASC-NUMBER-OF-SELECTED-ITEMS      28800041
288100                                ASC-HIGHEST-BLOCK-WRITTEN         28810041
288200                                ASC-START-OF-SELECTED-RANGE       28820041
288300                                ASC-END-OF-SELECTED-RANGE         28830041
288400                                ASC-ITEM-AT-TOP-OF-PANEL.         28840041
288500                                                                  28850041
288600     PERFORM 4010-OPEN-CURSOR.                                    28860041
288700                                                                  28870041
288800     PERFORM 4300-READ-ITEMS-FROM-DB.                             28880041
288900                                                                  28890041
289000     PERFORM 4020-CLOSE-CURSOR.                                   28900041
289100                                                                  28910041
289200     MOVE +1                     TO  PV-TOP-ITEM.                 28920041
289300 EJECT                                                            28930041
289400*----------------------------------------------------------------*28940041
289500* OPENS THE NO PO LINE CURSOR                                    *28950041
289600*----------------------------------------------------------------*28960041
289700                                                                  28970041
289800 4010-OPEN-CURSOR.                                                28980041
289900     EXEC SQL                                                     28990041
290000         OPEN INVOICE-ITEM-CSR                                    29000041
290100     END-EXEC.                                                    29010041
290200                                                                  29020041
290300     EVALUATE TRUE                                                29030041
290400         WHEN SQLCODE = +0                                        29040041
290500             CONTINUE                                             29050041
290600         WHEN OTHER                                               29060041
290700              MOVE '4010-OPEN-CURSOR'                             29070041
290800                               TO DP013-PARAGRAPH                 29080041
290900              MOVE 'OPEN INVOICE-ITEM-CSR'                        29090041
291000                               TO DP013-MESSAGE-TEXT (1)          29100041
291100              MOVE SQLCA           TO DP013-SQLCA                 29110041
291200              SET DP013-DB2-ABEND                                 29120041
291300                               TO TRUE                            29130041
291400              PERFORM DP013-0000-PROCESS-ABEND                    29140041
291500     END-EVALUATE.                                                29150041
291600                                                                  29160041
291700 EJECT                                                            29170041
291800*----------------------------------------------------------------*29180041
291900* CLOSES EITHER THE SUB-CLASS-CSR OR THE MAJ-CLASS-CSR           *29190041
292000*----------------------------------------------------------------*29200041
292100                                                                  29210041
292200 4020-CLOSE-CURSOR.                                               29220041
292300     EXEC SQL                                                     29230041
292400         CLOSE INVOICE-ITEM-CSR                                   29240041
292500     END-EXEC.                                                    29250041
292600 EJECT                                                            29260041
292700                                                                  29270041
292800*----------------------------------------------------------------*29280041
292900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *29290041
293000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *29300041
293100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *29310041
293200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *29320041
293300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *29330041
293400*                                                                *29340041
293500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *29350041
293600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *29360041
293700*    UPON INITIALIZATION.                                        *29370041
293800*----------------------------------------------------------------*29380041
293900                                                                  29390041
294000 4300-READ-ITEMS-FROM-DB.                                         29400041
294100                                                                  29410041
294200     PERFORM                                                      29420041
294300         VARYING PV-READ-COUNT                                    29430041
294400         FROM 1 BY 1                                              29440041
294500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    29450041
294600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         29460041
294700                                                                  29470041
294800         PERFORM 4310-FETCH-INVOICE-ITEMS                         29480041
294900                                                                  29490041
295000         IF  ASC-ITEMS-LEFT-ON-DB                                 29500041
295100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                29510041
295200                 ADD +1            TO ASC-ITEM-SUB                29520041
295300             ELSE                                                 29530041
295400                 ADD +1            TO ASC-BLK-SUB                 29540041
295500                 MOVE +1           TO ASC-ITEM-SUB                29550041
295600                                                                  29560041
295700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         29570041
295800                     MOVE +1       TO ASC-BLK-SUB                 29580041
295900                     SET ASC-BLOCK-MODIFIED (1)                   29590041
296000                                   TO TRUE                        29600041
296100                     PERFORM 5100-WRITE-TEMP-STORAGE              29610041
296200                     MOVE ASC-BLOCK-ENTRIES                       29620041
296300                               (PC-MAX-BLOCKS-IN-ARRAY)           29630041
296400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 29640041
296500                     ADD +1        TO ASC-BLK-SUB                 29650041
296600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   29660041
296700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      29670041
296800                                   TO TRUE                        29680041
296900                 END-IF                                           29690041
297000             END-IF                                               29700041
297100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    29710041
297200             MOVE ASC-NUMBER-OF-ITEMS-READ                        29720041
297300                                   TO ASC-LIST-ITEM-NUMBER        29730041
297400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29740041
297500             MOVE MIITEM-PAYT-REQ-LNE-NBR                         29750041
297600                                 TO ASC-PAYT-REQ-LNE-NBR          29760041
297700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29770041
297800             MOVE PREQIT-PAY-REQ-LNE-QTY                          29780041
297900                                 TO ASC-PIECES                    29790041
298000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29800041
298100             MOVE ASC-PIECES (ASC-BLK-SUB ASC-ITEM-SUB)           29810041
298200                                 TO PV-PIECES-9                   29820041
298300             MOVE PV-PIECES      TO ASC-INP-PIECES                29830041
298400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29840041
298500             MOVE PREQIT-UNT-COST-AMT                             29850041
298600                                 TO ASC-UNIT-COST                 29860041
298700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29870041
298800             MOVE ASC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)        29880041
298900                                 TO PV-UNIT-COST-9                29890041
299000             MOVE PV-UNIT-COST-9 TO ASC-INP-UNIT-COST             29900041
299100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29910041
299200             MOVE PV-UPC-NBR-DISPLAY                              29920041
299300                                 TO ASC-UPC-CODE                  29930041
299400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29940041
299500             MOVE PV-PO-LNE-NBR  TO ASC-PO-LNE-NBR                29950041
299600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29960041
299700             MOVE PV-APP-PO-LNE-NBR                               29970041
299800                                 TO ASC-APP-PO-LNE-NBR            29980041
299900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29990041
300000             MOVE PV-VENDOR-STYLE                                 30000041
300100                                 TO ASC-VENDOR-STYLE              30010041
300200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 30020041
300300             MOVE PV-COLOR-CDE   TO ASC-COLOR                     30030041
300400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 30040041
300500             MOVE PV-SIZE-CDE    TO ASC-SIZE                      30050041
300600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 30060041
300700             MOVE PV-SKU-NBR-X   TO ASC-SKU                       30070041
300800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 30080041
300900         END-IF                                                   30090041
301000     END-PERFORM.                                                 30100041
301100                                                                  30110041
301200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          30120041
301300         MOVE +1               TO ASC-BLK-SUB                     30130041
301400         PERFORM 5100-WRITE-TEMP-STORAGE                          30140041
301500         ADD +1                TO ASC-BLK-SUB                     30150041
301600         PERFORM 5100-WRITE-TEMP-STORAGE                          30160041
301700                                                                  30170041
301800         MOVE 1                TO ASC-BLK-SUB                     30180041
301900                                  PV-BLOCK-NUMBER                 30190041
302000         PERFORM 4410-READ-TEMP-STORAGE                           30200041
302100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             30210041
302200             MOVE 2            TO ASC-BLK-SUB                     30220041
302300                                  PV-BLOCK-NUMBER                 30230041
302400             PERFORM 4410-READ-TEMP-STORAGE                       30240041
302500         END-IF                                                   30250041
302600     END-IF.                                                      30260041
302700 EJECT                                                            30270041
302800*----------------------------------------------------------------*30280041
302900*    FETCH THE INVOICE ITEMS NOT ASSOCIATED TO A PO              *30290041
303000*----------------------------------------------------------------*30300041
303100                                                                  30310041
303200 4310-FETCH-INVOICE-ITEMS.                                        30320041
303300                                                                  30330041
303400     EXEC SQL                                                     30340041
303500         FETCH INVOICE-ITEM-CSR                                   30350041
303600             INTO                                                 30360041
303700                 :MIITEM-PAYT-REQ-LNE-NBR,                        30370041
303800                 :PREQIT-PAY-REQ-LNE-QTY,                         30380041
303900                 :PREQIT-UNT-COST-AMT,                            30390041
304000                 :MIITEM-PO-LNE-NBR                               30400041
304100     END-EXEC.                                                    30410041
304200                                                                  30420041
304300     EVALUATE TRUE                                                30430041
304400         WHEN SQLCODE = ZERO                                      30440041
304500              MOVE MIITEM-PO-LNE-NBR                              30450041
304600                                 TO PV-PO-LNE-NBR                 30460041
304700              IF MIITEM-PO-LNE-NBR = 0                            30470041
304800                  PERFORM 4320-GET-INVOICE-DETAILS                30480041
304900              ELSE                                                30490041
305000                  PERFORM 4330-GET-PO-DETAILS                     30500041
305100              END-IF                                              30510041
305200         WHEN SQLCODE = +100                                      30520041
305300              SET ASC-NO-ITEMS-LEFT-ON-DB                         30530041
305400                                 TO TRUE                          30540041
305500         WHEN SQLWARN0 NOT EQUAL SPACE                            30550041
305600         WHEN SQLCODE NOT EQUAL ZERO                              30560041
305700              MOVE '4310-FETCH-INVOICE-ITEMS'                     30570041
305800                               TO DP013-PARAGRAPH                 30580041
305900              MOVE 'FETCH INVOICE ITEMS CSR'                      30590041
306000                               TO DP013-MESSAGE-TEXT (1)          30600041
306100              MOVE SQLCA           TO DP013-SQLCA                 30610041
306200              SET DP013-DB2-ABEND                                 30620041
306300                               TO TRUE                            30630041
306400              PERFORM DP013-0000-PROCESS-ABEND                    30640041
306500     END-EVALUATE.                                                30650041
306600                                                                  30660041
306700*----------------------------------------------------------------*30670041
306800* GET INVOICE DETAILS FOR AN ITEM THAT DOES NOT HAVE PO ITEMS    *30680041
306900*----------------------------------------------------------------*30690041
307000 4320-GET-INVOICE-DETAILS.                                        30700041
307100                                                                  30710041
307200     INITIALIZE DCLTVNDINV                                        30720041
307300                                                                  30730041
307400     EXEC SQL                                                     30740041
307500         SELECT UPC_EAN_CDE,                                      30750041
307600                UPC_EAN_QUAL_CDE,                                 30760041
307700                VEND_STYL_CDE,                                    30770041
307800                COLOR_CDE,                                        30780041
307900                SIZE_CDE                                          30790041
308000          INTO :VNDINV-UPC-EAN-CDE,                               30800041
308100               :VNDINV-UPC-EAN-QUAL-CDE,                          30810041
308200               :VNDINV-VEND-STYL-CDE,                             30820041
308300               :VNDINV-COLOR-CDE,                                 30830041
308400               :VNDINV-SIZE-CDE                                   30840041
308500          FROM TVNDINV                                            30850041
308600          WHERE PAYT_REQ_SEQ_NBR = :DK-PAYT-REQ-SEQ-NBR           30860041
308700            AND PAYT_REQ_LNE_NBR = :MIITEM-PAYT-REQ-LNE-NBR       30870041
308800     END-EXEC.                                                    30880041
308900     EVALUATE TRUE                                                30890041
309000         WHEN SQLCODE = ZERO                                      30900041
309100              MOVE VNDINV-UPC-EAN-CDE                             30910041
309200                                 TO PV-UPC-NBR                    30920041
309300              MOVE SPACES TO PV-UPC-NBR-DISPLAY                   30930041
309400              IF VNDINV-UPC-EAN-QUAL-CDE = 'U'                    30940041
309500                  STRING PV-UPC-NBR-X(4:1) DELIMITED BY SIZE      30950041
309600                               INTO PV-UPC-NBR-DISPLAY            30960041
309700              ELSE                                                30970041
309800                  STRING PV-UPC-NBR-X(3:2) DELIMITED BY SIZE      30980041
309900                               INTO PV-UPC-NBR-DISPLAY            30990041
310000              END-IF                                              31000041
310100              STRING PV-UPC-NBR-DISPLAY DELIMITED BY '  '         31010041
310200                  '-'                DELIMITED BY SIZE            31020041
310300                  PV-UPC-NBR-X(5:5)  DELIMITED BY SIZE            31030041
310400                  '-'                DELIMITED BY SIZE            31040041
310500                  PV-UPC-NBR-X(10:5) DELIMITED BY SIZE            31050041
310600                  '-'                DELIMITED BY SIZE            31060041
310700                  PV-UPC-NBR-X(15:1) DELIMITED BY SIZE            31070041
310800                               INTO PV-UPC-NBR-DISPLAY            31080041
310900              MOVE VNDINV-VEND-STYL-CDE                           31090041
311000                                 TO PV-VENDOR-STYLE               31100041
311100              MOVE VNDINV-COLOR-CDE                               31110041
311200                                 TO PV-COLOR-CDE                  31120041
311300              MOVE VNDINV-SIZE-CDE                                31130041
311400                                 TO PV-SIZE-CDE                   31140041
311500              MOVE SPACES        TO PV-SKU-NBR-X                  31150041
311600              MOVE ZEROES        TO PV-APP-PO-LNE-NBR             31160041
311700         WHEN SQLCODE = +100                                      31170041
311800             MOVE SPACES         TO PV-SIZE-CDE                   31180041
311900                                    PV-COLOR-CDE                  31190041
312000                                    PV-VENDOR-STYLE               31200041
312100                                    PV-SKU-NBR-X                  31210041
312200             MOVE ZEROES         TO PV-UPC-NBR                    31220041
312300                                    PV-APP-PO-LNE-NBR             31230041
312400         WHEN OTHER                                               31240041
312500              MOVE '4320-GET-INVOICE-DETAILS'                     31250041
312600                               TO DP013-PARAGRAPH                 31260041
312700              MOVE 'SELECT INVOICE DETAILS'                       31270041
312800                               TO DP013-MESSAGE-TEXT (1)          31280041
312900              MOVE SQLCA           TO DP013-SQLCA                 31290041
313000              SET DP013-DB2-ABEND                                 31300041
313100                               TO TRUE                            31310041
313200              PERFORM DP013-0000-PROCESS-ABEND                    31320041
313300     END-EVALUATE.                                                31330041
313400                                                                  31340041
313500*----------------------------------------------------------------*31350041
313600*  GET PO LINE ITEM DETAILS                                      *31360041
313700*----------------------------------------------------------------*31370041
313800 4330-GET-PO-DETAILS.                                             31380041
313900     EXEC SQL                                                     31390041
314000         SELECT B.SKU,                                            31400041
314100                A.RMS_PO_SKU_NBR,                                 31410041
314200                A.ITM_NBR,                                        31420041
314300                A.VEND_STYL_NAME,                                 31430041
314400                A.COLOR_CDE,                                      31440041
314500                A.SIZE_CDE,                                       31450041
314600                A.APP_PO_LNE_NBR                                  31460041
314700          INTO :SKXREF-SKU,                                       31470041
314800               :PURITM-RMS-PO-SKU-NBR,                            31480041
314900               :PURITM-ITM-NBR,                                   31490041
315000               :PURITM-VEND-STYL-NAME,                            31500041
315100               :PURITM-COLOR-CDE,                                 31510041
315200               :PURITM-SIZE-CDE,                                  31520041
315300               :PURITM-APP-PO-LNE-NBR                             31530041
315400          FROM TPURITM A                                          31540041
315500              ,TSKXREF B                                          31550041
315600          WHERE A.ITM_NBR    = B.ITM_NBR                          31560041
315700           AND  A.PO_NBR     = :DK-PO-NUMBER                      31570041
315800           AND  A.PO_LNE_NBR = :MIITEM-PO-LNE-NBR                 31580041
315900           AND  A.VER_STATUS_CDE = :PC-ACTIVE                     31590041
316000     END-EXEC.                                                    31600041
316100     EVALUATE TRUE                                                31610041
316200         WHEN SQLCODE = ZERO                                      31620041
316300             IF PURITM-RMS-PO-SKU-NBR = 0                         31630041
316400                MOVE SKXREF-SKU  TO PV-SKU-NBR                    31640041
316500             ELSE                                                 31650041
316600                MOVE PURITM-RMS-PO-SKU-NBR                        31660041
316700                                 TO PV-SKU-NBR                    31670041
316800             END-IF                                               31680041
316900             MOVE PURITM-VEND-STYL-NAME                           31690041
317000                                 TO PV-VENDOR-STYLE               31700041
317100             MOVE PURITM-COLOR-CDE                                31710041
317200                                 TO PV-COLOR-CDE                  31720041
317300             MOVE PURITM-SIZE-CDE                                 31730041
317400                                 TO PV-SIZE-CDE                   31740041
317500             MOVE PURITM-APP-PO-LNE-NBR                           31750041
317600                                 TO PV-APP-PO-LNE-NBR             31760041
317700             PERFORM 4340-GET-UPC-INFO                            31770041
317800             MOVE TUPCSKU-UPC-NBR TO PV-UPC-NBR                   31780041
317900         WHEN SQLCODE = +100                                      31790041
318000             MOVE SPACES         TO PV-SIZE-CDE                   31800041
318100                                    PV-COLOR-CDE                  31810041
318200                                    PV-VENDOR-STYLE               31820041
318300             MOVE ZEROES         TO PV-UPC-NBR                    31830041
318400                                    PV-APP-PO-LNE-NBR             31840041
318500                                    PV-SKU-NBR                    31850041
318600         WHEN OTHER                                               31860041
318700              MOVE '4320-GET-INVOICE-DETAILS'                     31870041
318800                               TO DP013-PARAGRAPH                 31880041
318900              MOVE 'SELECT INVOICE DETAILS'                       31890041
319000                               TO DP013-MESSAGE-TEXT (1)          31900041
319100              MOVE SQLCA           TO DP013-SQLCA                 31910041
319200              SET DP013-DB2-ABEND                                 31920041
319300                               TO TRUE                            31930041
319400              PERFORM DP013-0000-PROCESS-ABEND                    31940041
319500     END-EVALUATE.                                                31950041
319600*----------------------------------------------------------------*31960041
319700*                                                                *31970041
319800*----------------------------------------------------------------*31980041
319900 4340-GET-UPC-INFO.                                               31990041
320000                                                                  32000041
320100     EXEC SQL                                                     32010041
320200         SELECT DISTINCT                                          32020041
320300              A.UPC_NBR                                           32030041
320400          INTO :TUPCSKU-UPC-NBR                                   32040041
320500          FROM TUPCSKU A                                          32050041
320600         WHERE A.ITEM_NBR         = :PURITM-ITM-NBR               32060041
320610           AND A.EDI_ORD_IND      = :PC-Y-CODE                    32061084
320700*          AND (A.UPC_NBR NOT BETWEEN                             32070084
320800*              :PC-MIN-UPC AND :PC-MAX-UPC)                       32080084
320900     END-EXEC.                                                    32090041
321000                                                                  32100041
321100     EVALUATE TRUE                                                32110041
321200         WHEN SQLCODE = +0                                        32120041
321300           MOVE TUPCSKU-UPC-NBR  TO PV-UPC-NBR                    32130041
321400           MOVE SPACES           TO PV-UPC-NBR-DISPLAY            32140041
321500           STRING PV-UPC-NBR-X(3:2)  DELIMITED BY SIZE            32150041
321600                  '-'                DELIMITED BY SIZE            32160041
321700                  PV-UPC-NBR-X(5:5)  DELIMITED BY SIZE            32170041
321800                  '-'                DELIMITED BY SIZE            32180041
321900                  PV-UPC-NBR-X(10:5) DELIMITED BY SIZE            32190041
322000                  '-'                DELIMITED BY SIZE            32200041
322100                  PV-UPC-NBR-X(15:1) DELIMITED BY SIZE            32210041
322200                               INTO PV-UPC-NBR-DISPLAY            32220041
322300                                                                  32230041
322400         WHEN SQLCODE = +100                                      32240041
322500           MOVE PC-NO-VENDOR-UPC TO PV-UPC-NBR-DISPLAY            32250041
322600                                                                  32260041
322700         WHEN SQLCODE = -811                                      32270041
322800           MOVE PC-MULTIPLE-UPC  TO PV-UPC-NBR-DISPLAY            32280041
322900                                                                  32290041
323000         WHEN SQLWARN0 NOT = SPACES                               32300041
323100         WHEN SQLCODE < +0                                        32310041
323200         WHEN SQLCODE > +0                                        32320041
323300             MOVE '4340-GET-UPC-INFO'                             32330041
323400                               TO DP013-PARAGRAPH                 32340041
323500             MOVE 'SELECT UPC INFO  '                             32350041
323600                               TO DP013-MESSAGE-TEXT (1)          32360041
323700             MOVE SQLCA        TO DP013-SQLCA                     32370041
323800             MOVE 'TUPCSKU'    TO DP013-DB2-TABLE-NAME (1)        32380041
323900             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        32390041
324000             SET DP013-DB2-ABEND                                  32400041
324100                 DP013-XCTL-DISPLAY-RESTART                       32410041
324200                               TO TRUE                            32420041
324300             PERFORM DP013-0000-PROCESS-ABEND                     32430041
324400     END-EVALUATE.                                                32440041
324500                                                                  32450041
324600*----------------------------------------------------------------*32460041
324700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *32470041
324800*----------------------------------------------------------------*32480041
324900                                                                  32490041
325000 4400-MOVE-COMMAREA-TO-SCREEN.                                    32500041
325100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             32510041
325200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          32520041
325300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          32530041
325400             MOVE +1    TO ASC-BLK-SUB                            32540041
325500             PERFORM 5100-WRITE-TEMP-STORAGE                      32550041
325600             ADD +1     TO ASC-BLK-SUB                            32560041
325700             PERFORM 5100-WRITE-TEMP-STORAGE                      32570041
325800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             32580041
325900                 GIVING PV-BLOCK-NUMBER                           32590041
326000                 REMAINDER PV-REMAINDER                           32600041
326100             IF  PV-REMAINDER > ZERO                              32610041
326200                 ADD +1 TO PV-BLOCK-NUMBER                        32620041
326300             END-IF                                               32630041
326400             MOVE +1    TO ASC-BLK-SUB                            32640041
326500             PERFORM 4410-READ-TEMP-STORAGE                       32650041
326600             ADD +1     TO ASC-BLK-SUB                            32660041
326700                           PV-BLOCK-NUMBER                        32670041
326800             PERFORM 4410-READ-TEMP-STORAGE                       32680041
326900     END-IF.                                                      32690041
327000     MOVE +1            TO ASC-BLK-SUB.                           32700041
327100     COMPUTE ASC-ITEM-SUB =                                       32710041
327200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              32720041
327300         + PC-ITEMS-PER-PANEL).                                   32730041
327400*                                                                 32740041
327500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        32750041
327600         ADD +1         TO ASC-BLK-SUB                            32760041
327700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            32770041
327800     END-IF.                                                      32780041
327900*                                                                 32790041
328000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           32800041
328100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                32810041
328200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        32820041
328300     PERFORM 3200-RESET-ATTRIBUTES.                               32830041
328400     PERFORM 4420-FORMAT-LIST-LINES                               32840041
328500         VARYING PV-SUB                                           32850041
328600         FROM PC-ITEMS-PER-PANEL BY -1                            32860041
328700         UNTIL PV-SUB < +1.                                       32870041
328800*                                                                 32880041
328900     COMPUTE ASC-ITEMS-DISPLAYED =                                32890041
329000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          32900041
329100                                                                  32910041
329200     IF PS-NO-START-ITEM-ERROR                                    32920041
329300         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL32930041
329400                                          ASTRTITO                32940041
329500         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  32950041
329600     ELSE                                                         32960041
329700         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                32970041
329800     END-IF.                                                      32980041
329900                                                                  32990041
330000     IF (ASC-ITEM-AT-BOT-OF-PANEL = ZERO AND                      33000041
330100         ASC-ITEM-AT-TOP-OF-PANEL = ZERO) OR                      33010041
330200         ASC-PROTECT-FIELDS                                       33020041
330300         SET DP030-SET-CURSOR-APPL-1                              33030041
330400                                   TO TRUE                        33040041
330500         MOVE -1                   TO ASTRTITL                    33050041
330600     END-IF                                                       33060041
330700                                                                  33070041
330800     IF PS-NO-ERROR                                               33080041
330900         IF ASC-ALLOW-SELECT-ONLY OR                              33090041
331000            ASC-PROTECT-FIELDS                                    33100041
331100*            -- UPDATE NOT ALLOWED FOR THIS STATUS --             33110041
331200             IF ASC-KEY-INVC-STATUS = PC-OUT-OF-BALANCE           33120041
331300                 MOVE PC-TSYMSG-00942                             33130041
331400                                 TO DP020-MSG-NUMBER              33140041
331500             ELSE                                                 33150041
331600                IF ASC-KEY-INVC-TYP-CDE = PC-WO                   33160041
331700                    MOVE PC-TSYMSG-01517                          33170041
331800                                 TO DP020-MSG-NUMBER              33180041
331900                ELSE                                              33190041
332000                    MOVE PC-TSYMSG-00170                          33200041
332100                                 TO DP020-MSG-NUMBER              33210041
332200                END-IF                                            33220041
332300             END-IF                                               33230041
332400             SET DP020-MSG-INFORMATIONAL TO TRUE                  33240041
332500             SET PS-ERROR                TO TRUE                  33250041
332600         END-IF                                                   33260041
332700     END-IF                                                       33270041
332800                                                                  33280041
332900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    33290041
333000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    33300041
333100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33310041
333200                                   TO ASELITO.                    33320041
333300                                                                  33330041
333400     MOVE DP015-BLUE                TO ASTATUSC                   33340041
333500     EVALUATE ASC-KEY-INVC-STATUS                                 33350041
333600         WHEN 'EN'                                                33360041
333700             MOVE 'ENTERED    '     TO ASTATUSO                   33370041
333800         WHEN 'RC'                                                33380041
333900             MOVE 'RECONCILE  '     TO ASTATUSO                   33390041
334000         WHEN 'RL'                                                33400041
334100             MOVE 'RELEASED   '     TO ASTATUSO                   33410041
334200         WHEN 'OP'                                                33420041
334300             MOVE 'OPEN TO PAY'     TO ASTATUSO                   33430041
334400         WHEN 'PD'                                                33440041
334500             MOVE 'PAID       '     TO ASTATUSO                   33450041
334600         WHEN 'PJ'                                                33460041
334700             MOVE 'PENDNG JRNL'     TO ASTATUSO                   33470041
334800         WHEN 'DE'                                                33480041
334900             MOVE 'DELETED    '     TO ASTATUSO                   33490041
335000         WHEN 'OB'                                                33500041
335100             MOVE 'OUT OF BAL '     TO ASTATUSO                   33510041
335200             MOVE DP015-YELLOW      TO ASTATUSC                   33520041
335300         WHEN 'IB'                                                33530041
335400             MOVE DP015-YELLOW      TO ASTATUSC                   33540041
335500             MOVE 'ITM IMBALNC'     TO ASTATUSO                   33550041
335600     END-EVALUATE                                                 33560041
335700                                                                  33570041
335800     MOVE ASC-KEY-PO-NUMBER        TO APONBRO.                    33580041
335900     MOVE ASC-KEY-INVOICE-ID       TO AINVNBRO.                   33590041
336000     MOVE ASC-VENDOR-DESC-10       TO AVENDORO.                   33600041
336100     MOVE ASC-KEY-DEPT-NBR         TO ADEPTO.                     33610041
336200     MOVE ASC-KEY-TOTAL-PIECES     TO ATOTQTYO.                   33620041
336300     MOVE ASC-KEY-GRO-COST-AMT     TO ATOTCSTO.                   33630041
336400     MOVE ASC-KEY-STORE-NUMBER     TO PV-KEY-STORE-NBR-UNPK.      33640041
336500     MOVE PV-KEY-STORE-NBR-UNPK    TO PV-KEY-STORE-NBR.           33650041
336600     MOVE PV-KEY-STORE-NBR         TO ASTRNBRO.                   33660041
336700     MOVE ASC-KEY-DC-NBR           TO PV-KEY-DC-NBR-UNPK.         33670041
336800     MOVE PV-KEY-DC-NBR-UNPK       TO PV-KEY-DC-NBR.              33680041
336900     MOVE PV-KEY-DC-NBR            TO ADCNBRO.                    33690041
337000                                                                  33700041
337100     PERFORM 4450-SELECT-TOTAL-PIECES                             33710041
337200                                                                  33720041
337300     MOVE ASC-CALC-TOTAL-PIECES    TO ACLCQTYO.                   33730041
337400                                                                  33740041
337500     MOVE ASC-CALC-TOTAL-COST      TO ACLCCSTO.                   33750041
337600                                                                  33760041
337700     IF PV-FIRST-ERROR-ITEM > 0                                   33770041
337800         MOVE PV-FIRST-ERROR-ITEM                                 33780041
337900                                 TO DP020-MSG-TEXT                33790041
338000         SET DP020-MSG-FATAL     TO TRUE                          33800041
338100         MOVE PC-TSYMSG-00872    TO DP020-MSG-NUMBER              33810041
338200         SET DP030-SET-CURSOR-APPL-1                              33820041
338300                                 TO TRUE                          33830041
338400     ELSE                                                         33840041
338500         IF PV-FIRST-WARNING-ITEM > 0 AND ASC-NO-UPDATE           33850041
338600             MOVE PV-FIRST-WARNING-ITEM                           33860041
338700                                 TO DP020-MSG-TEXT                33870041
338800             SET DP020-MSG-WARNING                                33880041
338900                                 TO TRUE                          33890041
339000             MOVE PC-TSYMSG-00393                                 33900041
339100                                 TO DP020-MSG-NUMBER              33910041
339200             SET DP030-SET-CURSOR-APPL-1                          33920041
339300                                 TO TRUE                          33930041
339400         ELSE                                                     33940041
339500             IF ASC-KEY-TOTAL-PIECES = ASC-CALC-TOTAL-PIECES      33950041
339600                 SET DP030-SET-CURSOR-APPL-1                      33960041
339700                                 TO TRUE                          33970041
339800                 MOVE DP015-BLUE TO ATOTQTYC                      33980041
339900                                    ACLCQTYC                      33990041
340000                 MOVE DP015-HL-OFF                                34000041
340100                                 TO ATOTQTYH                      34010041
340200                                    ACLCQTYH                      34020041
340300             ELSE                                                 34030041
340400                 IF ASC-UNPROTECT-FIELDS                          34040041
340500                     MOVE DP015-YELLOW                            34050041
340600                                 TO ATOTQTYC                      34060041
340700                                    ACLCQTYC                      34070041
340800                     MOVE DP015-REVERSE                           34080041
340900                                 TO ATOTQTYH                      34090041
341000                                    ACLCQTYH                      34100041
341100                     SET DP030-SET-CURSOR-APPL-1                  34110041
341200                                   TO TRUE                        34120041
341300                     IF PS-NO-ERROR                               34130041
341400                         MOVE PC-TSYMSG-00853                     34140041
341500                                   TO DP020-MSG-NUMBER            34150041
341600                         SET DP020-MSG-WARNING                    34160041
341700                             DP030-SET-CURSOR-TRAILER             34170041
341800                                   TO TRUE                        34180041
341900                     END-IF                                       34190041
342000                 END-IF                                           34200041
342100             END-IF                                               34210041
342200             IF ASC-KEY-GRO-COST-AMT = ASC-CALC-TOTAL-COST        34220041
342300                 SET DP030-SET-CURSOR-APPL-1                      34230041
342400                                 TO TRUE                          34240041
342500                 MOVE DP015-BLUE TO ATOTCSTC                      34250041
342600                                    ACLCCSTC                      34260041
342700                 MOVE DP015-HL-OFF                                34270041
342800                                 TO ATOTCSTH                      34280041
342900                                    ACLCCSTH                      34290041
343000             ELSE                                                 34300041
343100                 IF ASC-UNPROTECT-FIELDS                          34310041
343200                     MOVE DP015-YELLOW                            34320041
343300                                 TO ATOTCSTC                      34330041
343400                                    ACLCCSTC                      34340041
343500                     MOVE DP015-REVERSE                           34350041
343600                                 TO ATOTCSTH                      34360041
343700                                    ACLCCSTH                      34370041
343800                     SET DP030-SET-CURSOR-APPL-1                  34380041
343900                                   TO TRUE                        34390041
344000                     IF PS-NO-ERROR                               34400041
344100*                        --  ITEM IMBALANCE --                    34410041
344200                         MOVE PC-TSYMSG-00935  TO DP020-MSG-NUMBER34420041
344300                         SET DP020-MSG-WARNING                    34430041
344400                             DP030-SET-CURSOR-TRAILER             34440041
344500                                   TO TRUE                        34450041
344600                     END-IF                                       34460041
344700                 END-IF                                           34470041
344800             END-IF                                               34480041
344900         END-IF                                                   34490041
345000     END-IF.                                                      34500041
345100*                                                                 34510041
345200     IF  DP020-MSG-NUMBER-X = SPACE                               34520041
345300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  34530041
345400*            --- MORE ITEMS TO DISPLAY ----                       34540041
345500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            34550041
345600             SET DP020-MSG-INFORMATIONAL TO TRUE                  34560041
345700         END-IF                                                   34570041
345800     END-IF.                                                      34580041
345900*----------------------------------------------------------------*34590041
346000*    FOR TOTAL UNIT COST, WE NEED TO GET THE WEIGHTED AVERAGE    *34600041
346100*----------------------------------------------------------------*34610041
346200 4450-SELECT-TOTAL-PIECES.                                        34620041
346300                                                                  34630041
346400     MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                                34640041
346500                                 TO DK-PAYT-REQ-SEQ-NBR           34650041
346600     MOVE +0 TO PV-TOTAL-PIECES                                   34660041
346700                PV-PER-UNIT-COST                                  34670041
346800                ASC-CALC-TOTAL-PIECES                             34680041
346900                ASC-CALC-TOTAL-COST                               34690041
347000                                                                  34700041
347100     EXEC SQL                                                     34710041
347200         OPEN PREQIT_CSR                                          34720041
347300     END-EXEC.                                                    34730041
347400                                                                  34740041
347500     EVALUATE TRUE                                                34750041
347600         WHEN SQLCODE = +0                                        34760041
347700             CONTINUE                                             34770041
347800         WHEN OTHER                                               34780041
347900             MOVE '4450-...           '                           34790041
348000                               TO DP013-PARAGRAPH                 34800041
348100             MOVE 'OPEN CURSOR'                                   34810041
348200                               TO DP013-MESSAGE-TEXT(1)           34820041
348300             MOVE SQLCA        TO DP013-SQLCA                     34830041
348400             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        34840041
348500             SET DP013-DB2-ABEND                                  34850041
348600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               34860041
348700             PERFORM DP013-0000-PROCESS-ABEND                     34870041
348800     END-EVALUATE                                                 34880041
348900                                                                  34890041
349000     PERFORM UNTIL SQLCODE = +100                                 34900041
349100                                                                  34910041
349200         EXEC SQL                                                 34920041
349300             FETCH PREQIT_CSR                                     34930041
349400             INTO :PV-TOTAL-PIECES                                34940041
349500                 ,:PV-PER-UNIT-COST                               34950041
349600         END-EXEC                                                 34960041
349700                                                                  34970041
349800         EVALUATE TRUE                                            34980041
349900             WHEN SQLCODE = +0                                    34990041
350000                 ADD PV-TOTAL-PIECES TO ASC-CALC-TOTAL-PIECES     35000041
350100                 COMPUTE ASC-CALC-TOTAL-COST = ASC-CALC-TOTAL-COST35010041
350200                      + (PV-PER-UNIT-COST * PV-TOTAL-PIECES)      35020041
350300             WHEN SQLCODE = +100                                  35030041
350400                 CONTINUE                                         35040041
350500             WHEN OTHER                                           35050041
350600                 MOVE '4450-...           '                       35060041
350700                                   TO DP013-PARAGRAPH             35070041
350800                 MOVE 'FETCH CURSOR'                              35080041
350900                                   TO DP013-MESSAGE-TEXT(1)       35090041
351000                 MOVE SQLCA        TO DP013-SQLCA                 35100041
351100                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    35110041
351200                 SET DP013-DB2-ABEND                              35120041
351300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35130041
351400                 PERFORM DP013-0000-PROCESS-ABEND                 35140041
351500         END-EVALUATE                                             35150041
351600     END-PERFORM.                                                 35160041
351700                                                                  35170041
351800     EXEC SQL                                                     35180041
351900        CLOSE PREQIT_CSR                                          35190041
352000     END-EXEC.                                                    35200041
352100/                                                                 35210041
352200*----------------------------------------------------------------*35220041
352300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *35230041
352400*----------------------------------------------------------------*35240041
352500                                                                  35250041
352600 4410-READ-TEMP-STORAGE.                                          35260041
352700                                                                  35270041
352800     EXEC CICS                                                    35280041
352900         READQ TS                                                 35290041
353000             QUEUE (ASC-LIST-QUEUE-NAME)                          35300041
353100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35310041
353200             ITEM  (PV-BLOCK-NUMBER)                              35320041
353300             RESP  (PV-CICS-RESP)                                 35330041
353400     END-EXEC.                                                    35340041
353500                                                                  35350041
353600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       35360041
353700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     35370041
353800         CONTINUE                                                 35380041
353900     ELSE                                                         35390041
354000         SET DP013-CICS-ABEND     TO TRUE                         35400041
354100         SET DP013-NO-ROLLBACK    TO TRUE                         35410041
354200         MOVE '4410-READ-TEMP-STORAGE'                            35420041
354300                                  TO DP013-PARAGRAPH              35430041
354400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      35440041
354500                                  TO DP013-MESSAGE-TEXT(1)        35450041
354600         PERFORM DP013-0000-PROCESS-ABEND                         35460041
354700     END-IF.                                                      35470041
354800                                                                  35480041
354900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             35490041
355000*                                                                 35500041
355100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         35510041
355200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               35520041
355300     END-IF.                                                      35530041
355400 EJECT                                                            35540041
355500*----------------------------------------------------------------*35550041
355600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *35560041
355700*----------------------------------------------------------------*35570041
355800                                                                  35580041
355900 4420-FORMAT-LIST-LINES.                                          35590041
356000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      35600041
356100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                35610041
356200         MOVE DP015-ASK-DRK-OFF  TO AP-SELECTA (PV-SUB)           35620041
356300                                    AP-PIECESA (PV-SUB)           35630041
356400                                    AP-UNIT-COSTA (PV-SUB)        35640041
356500         MOVE SPACE              TO AP-SELECT  (PV-SUB)           35650041
356600                                    AP-ACTION (PV-SUB)            35660041
356700                                    AP-PIECES (PV-SUB)            35670041
356800                                    AP-UNIT-COST (PV-SUB)         35680041
356900                                    AP-PO-LINE (PV-SUB)           35690041
357000                                    AP-UPC-CODE(PV-SUB)           35700041
357100                                    AP-SKU(PV-SUB)                35710041
357200                                    AP-STYLE(PV-SUB)              35720041
357300                                    AP-COLOR(PV-SUB)              35730041
357400                                    AP-SIZE(PV-SUB)               35740041
357500                                    AP-INVOICE-LINE(PV-SUB)       35750041
357600                                                                  35760041
357700     ELSE                                                         35770041
357800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      35780041
357900                                                   > SPACE        35790041
358000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 35800041
358100                                 TO AP-SELECT  (PV-SUB)           35810041
358200         ELSE                                                     35820041
358300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      35830041
358400                                 TO AP-SELECT  (PV-SUB)           35840041
358500         END-IF                                                   35850041
358600*                                                                 35860041
358700         IF  DP030-SET-CURSOR-TRAILER                             35870041
358800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)35880041
358900                 > SPACE)                                         35890041
359000               OR (PV-SUB = 1))                                   35900041
359100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               35910041
359200                MOVE -1          TO AP-SELECTL (PV-SUB)           35920041
359300             END-IF                                               35930041
359400         END-IF                                                   35940041
359500*                                                                 35950041
359600         IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL PC-DEL    35960041
359700             MOVE DP015-ASK-DRK-OFF  TO AP-SELECTA (PV-SUB)       35970041
359800             MOVE DP015-PRO-NOR-OFF  TO AP-PIECESA (PV-SUB)       35980041
359900                                        AP-UNIT-COSTA (PV-SUB)    35990041
360000             MOVE DP015-BLUE         TO AP-PIECESC (PV-SUB)       36000041
360100                                        AP-UNIT-COSTC (PV-SUB)    36010041
360200         END-IF                                                   36020041
360300*                                                                 36030041
360400         IF ASC-APP-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         36040041
360500             = ZERO AND                                           36050041
360600            ASC-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO      36060041
360700             MOVE PC-ASTERICK    TO AP-PO-LINE (PV-SUB)           36070041
360800         ELSE                                                     36080041
360900             IF ASC-APP-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     36090041
361000                 = ZERO                                           36100041
361100                 MOVE ASC-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)   36110041
361200                                 TO AP-PO-LINE-9(PV-SUB)          36120041
361300             ELSE                                                 36130041
361400                 MOVE ASC-APP-PO-LNE-NBR                          36140041
361500                          (ASC-BLK-SUB ASC-ITEM-SUB)              36150041
361600                                 TO AP-PO-LINE-9 (PV-SUB)         36160041
361700             END-IF                                               36170041
361800         END-IF                                                   36180041
361900         MOVE ASC-ACTION           (ASC-BLK-SUB ASC-ITEM-SUB)     36190041
362000                                 TO AP-ACTION (PV-SUB)            36200041
362100         MOVE ASC-PAYT-REQ-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     36210041
362200                                 TO AP-INVOICE-LINE-9 (PV-SUB)    36220041
362300         MOVE ASC-UPC-CODE (ASC-BLK-SUB ASC-ITEM-SUB)             36230041
362400                                 TO AP-UPC-CODE (PV-SUB)          36240041
362500         MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)                  36250041
362600                                 TO AP-SKU (PV-SUB)               36260041
362700         MOVE ASC-VENDOR-STYLE (ASC-BLK-SUB ASC-ITEM-SUB)         36270041
362800                                 TO AP-STYLE (PV-SUB)             36280041
362900         MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)                36290041
363000                                 TO AP-COLOR (PV-SUB)             36300041
363100         MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)                 36310041
363200                                 TO AP-SIZE (PV-SUB)              36320041
363300         IF ASC-PIECES(ASC-BLK-SUB ASC-ITEM-SUB)                  36330041
363400             = ZERO                                               36340041
363500             MOVE ASC-PIECES                                      36350041
363600                         (ASC-BLK-SUB ASC-ITEM-SUB)               36360041
363700                                 TO AP-PIECES-9 (PV-SUB)          36370041
363800         ELSE                                                     36380041
363900             IF ASC-LINE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)         36390041
364000                 MOVE ASC-INP-PIECES (ASC-BLK-SUB ASC-ITEM-SUB)   36400041
364100                             TO AP-PIECES (PV-SUB)                36410041
364200             ELSE                                                 36420041
364300                 MOVE ASC-PIECES(ASC-BLK-SUB ASC-ITEM-SUB)        36430041
364400                                 TO AP-PIECES-9 (PV-SUB)          36440041
364500             END-IF                                               36450041
364600         END-IF                                                   36460041
364700         IF ASC-UNIT-COST(ASC-BLK-SUB ASC-ITEM-SUB)               36470041
364800             = ZERO                                               36480041
364900             IF ASC-PIECES(ASC-BLK-SUB ASC-ITEM-SUB)              36490041
365000                 = ZERO                                           36500041
365100                 MOVE ASC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)    36510041
365200                                 TO AP-UNIT-COST-9 (PV-SUB)       36520041
365300             ELSE                                                 36530041
365400                 MOVE PC-NO-CHARGE TO AP-UNIT-COST(PV-SUB)        36540041
365500             END-IF                                               36550041
365600         ELSE                                                     36560041
365700             IF ASC-LINE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)         36570041
365800                 MOVE ASC-INP-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)36580041
365900                                 TO AP-UNIT-COST(PV-SUB)          36590041
366000             ELSE                                                 36600041
366100                 MOVE ASC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)    36610041
366200                                 TO AP-UNIT-COST-9 (PV-SUB)       36620041
366300             END-IF                                               36630041
366400         END-IF                                                   36640041
366500         IF (ASC-LINE-WARNING (ASC-BLK-SUB ASC-ITEM-SUB)) AND     36650041
366600            (NOT ASC-LINE-CHANGED(ASC-BLK-SUB ASC-ITEM-SUB))      36660041
366700             MOVE DP015-YELLOW   TO AP-PIECESC (PV-SUB)           36670041
366800                                    AP-UNIT-COSTC (PV-SUB)        36680041
366900                                    AP-SELECTC (PV-SUB)           36690041
367000             MOVE DP015-REVERSE  TO AP-PIECESH (PV-SUB)           36700041
367100                                    AP-UNIT-COSTH (PV-SUB)        36710041
367200                                    AP-SELECTH (PV-SUB)           36720041
367300             SET DP030-SET-CURSOR-APPL-1                          36730041
367400                                   TO TRUE                        36740041
367500             MOVE -1               TO AP-SELECTL (PV-SUB)         36750041
367600         ELSE                                                     36760041
367700             IF ASC-LINE-CHANGED(ASC-BLK-SUB ASC-ITEM-SUB)        36770041
367800                 MOVE DP015-GREEN                                 36780041
367900                                 TO AP-PIECESC (PV-SUB)           36790041
368000                                    AP-UNIT-COSTC (PV-SUB)        36800041
368100                                    AP-SELECTC (PV-SUB)           36810041
368200                 MOVE DP015-UNDERLINE                             36820041
368300                                 TO AP-PIECESH (PV-SUB)           36830041
368400                                    AP-UNIT-COSTC (PV-SUB)        36840041
368500                                    AP-SELECTH (PV-SUB)           36850041
368600         END-IF                                                   36860041
368700         IF ASC-LINE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)             36870041
368800             SET PS-ERROR       TO TRUE                           36880041
368900             MOVE DP015-RED     TO AP-PIECESC (PV-SUB)            36890041
369000                                   AP-UNIT-COSTC (PV-SUB)         36900041
369100                                   AP-SELECTC (PV-SUB)            36910041
369200             MOVE DP015-REVERSE TO AP-PIECESH (PV-SUB)            36920041
369300                                   AP-UNIT-COSTH (PV-SUB)         36930041
369400                                   AP-SELECTH (PV-SUB)            36940041
369500             SET DP030-SET-CURSOR-APPL-1                          36950041
369600                                   TO TRUE                        36960041
369700             MOVE -1               TO AP-SELECTL (PV-SUB)         36970041
369800         END-IF                                                   36980041
369900     END-IF.                                                      36990041
370000     SUBTRACT +1 FROM ASC-ITEM-SUB                                37000041
370100     IF  ASC-ITEM-SUB < + 1                                       37010041
370200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  37020041
370300         MOVE +1                 TO ASC-BLK-SUB                   37030041
370400     END-IF.                                                      37040041
370500******************************************************************37050041
370600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **37060041
370700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **37070041
370800** ISSUE A WARNING.                                             **37080041
370900******************************************************************37090041
371000 4430-CHECK-FOR-BEGIN-AND-END.                                    37100041
371100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       37110041
371200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     37120041
371300*            -- NO END-OF-RANGE SPECFIED ---                      37130041
371400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            37140041
371500             SET DP020-MSG-WARNING TO TRUE                        37150041
371600             PERFORM 4431-POSITION-AT-WARNING                     37160041
371700         END-IF                                                   37170041
371800     ELSE                                                         37180041
371900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     37190041
372000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                37200041
372100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            37210041
372200             SET DP020-MSG-WARNING TO TRUE                        37220041
372300             PERFORM 4431-POSITION-AT-WARNING                     37230041
372400         END-IF                                                   37240041
372500     END-IF.                                                      37250041
372600******************************************************************37260041
372700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **37270041
372800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **37280041
372900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **37290041
373000** POSITION THE CURSOR THERE.                                   **37300041
373100******************************************************************37310041
373200 4431-POSITION-AT-WARNING.                                        37320041
373300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 37330041
373400                    - PV-TOP-ITEM + 1.                            37340041
373500     IF (PV-SUB < +1 OR > PC-ITEMS-PER-PANEL)                     37350041
373600         CONTINUE                                                 37360041
373700     ELSE                                                         37370041
373800         SET DP030-SET-CURSOR-APPL-1                              37380041
373900                                   TO TRUE                        37390041
374000         MOVE -1                   TO AP-SELECTL (PV-SUB)         37400041
374100         MOVE DP015-REVERSE        TO AP-SELECTH (PV-SUB)         37410041
374200         MOVE DP015-YELLOW         TO AP-SELECTC (PV-SUB)         37420041
374300     END-IF.                                                      37430041
374400*                                                                 37440041
374500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   37450041
374600                    - PV-TOP-ITEM + 1.                            37460041
374700     IF (PV-SUB < +1 OR > PC-ITEMS-PER-PANEL)                     37470041
374800         CONTINUE                                                 37480041
374900     ELSE                                                         37490041
375000         SET DP030-SET-CURSOR-APPL-1                              37500041
375100                                   TO TRUE                        37510041
375200         MOVE -1                   TO AP-SELECTL (PV-SUB)         37520041
375300         MOVE DP015-REVERSE        TO AP-SELECTH (PV-SUB)         37530041
375400         MOVE DP015-YELLOW         TO AP-SELECTC (PV-SUB)         37540041
375500     END-IF.                                                      37550041
375600 EJECT                                                            37560041
375700*----------------------------------------------------------------*37570041
375800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *37580041
375900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *37590041
376000* FOR THE SELECTED ITEMS QUEUE.                                  *37600041
376100*                                                                *37610041
376200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *37620041
376300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *37630041
376400* THE ARRAY IS FULL.                                             *37640041
376500*----------------------------------------------------------------*37650041
376600                                                                  37660041
376700 5000-PREPARE-SEL-QUEUE.                                          37670041
376800                                                                  37680041
376900     MOVE +1                   TO  ASC-BLK-SUB.                   37690041
377000     PERFORM 5100-WRITE-TEMP-STORAGE.                             37700041
377100     ADD +1                    TO  ASC-BLK-SUB.                   37710041
377200     PERFORM 5100-WRITE-TEMP-STORAGE.                             37720041
377300                                                                  37730041
377400     MOVE ASC-SEL-QUEUE-NAME-OUT                                  37740041
377500                               TO  AP300-SEL-QUEUE-NAME.          37750041
377600     PERFORM 6010-DELETE-SEL-QUEUE.                               37760041
377700                                                                  37770041
377800     SET ASC-UPDATE-TSQ        TO  TRUE.                          37780041
377900                                                                  37790041
378000     SET AP301-IDX             TO  1.                             37800041
378100     MOVE ZERO                 TO AP301-SELECTED-ITEMS.           37810041
378200     INITIALIZE AP301-SELECTED-ITEM-ARRAY.                        37820041
378300                                                                  37830041
378400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           37840041
378500             VARYING PV-ITEM                                      37850041
378600             FROM 1 BY 1                                          37860041
378700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     37870041
378800                                                                  37880041
378900     IF  AP301-IDX > 1                                            37890041
379000         ADD +1                TO AP300-NUMBER-OF-TS-ITEMS        37900041
379100                                  PV-SEL-QUEUE-ITEM               37910041
379200         PERFORM 5205-WRITE-SEL-QUEUE                             37920041
379300     END-IF.                                                      37930041
379400 EJECT                                                            37940041
379500*----------------------------------------------------------------*37950041
379600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *37960041
379700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *37970041
379800*----------------------------------------------------------------*37980041
379900                                                                  37990041
380000 5100-WRITE-TEMP-STORAGE.                                         38000041
380100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     38010041
380200                                   TO PV-LIST-ITEM-NUMBER.        38020041
380300     COMPUTE PV-BLOCK-NUMBER =                                    38030041
380400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    38040041
380500                                                                  38050041
380600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             38060041
380700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             38070041
380800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      38080041
380900             PERFORM 5105-REWRITE-ASC-LISTQ                       38090041
381000         END-IF                                                   38100041
381100     ELSE                                                         38110041
381200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       38120041
381300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            38130041
381400         PERFORM 5110-WRITE-ASC-LISTQ                             38140041
381500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   38150041
381600     END-IF.                                                      38160041
381700                                                                  38170041
381800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             38180041
381900******************************************************************38190041
382000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **38200041
382100** SPECIFIC COMMAREA.                                           **38210041
382200******************************************************************38220041
382300 5105-REWRITE-ASC-LISTQ.                                          38230041
382400     EXEC CICS                                                    38240041
382500         WRITEQ TS                                                38250041
382600             QUEUE (ASC-LIST-QUEUE-NAME)                          38260041
382700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               38270041
382800             ITEM  (PV-BLOCK-NUMBER)                              38280041
382900             REWRITE                                              38290041
383000             RESP  (PV-CICS-RESP)                                 38300041
383100     END-EXEC.                                                    38310041
383200                                                                  38320041
383300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           38330041
383400         CONTINUE                                                 38340041
383500     ELSE                                                         38350041
383600         SET DP013-CICS-ABEND            TO TRUE                  38360041
383700         SET DP013-NO-ROLLBACK           TO TRUE                  38370041
383800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       38380041
383900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     38390041
384000                                         TO DP013-MESSAGE-TEXT(1) 38400041
384100         PERFORM DP013-0000-PROCESS-ABEND                         38410041
384200     END-IF.                                                      38420041
384300                                                                  38430041
384400******************************************************************38440041
384500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **38450041
384600** SPECIFIC COMMAREA.                                           **38460041
384700******************************************************************38470041
384800 5110-WRITE-ASC-LISTQ.                                            38480041
384900     EXEC CICS                                                    38490041
385000         WRITEQ TS                                                38500041
385100             QUEUE (ASC-LIST-QUEUE-NAME)                          38510041
385200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               38520041
385300             ITEM  (PV-BLOCK-NUMBER)                              38530041
385400             RESP  (PV-CICS-RESP)                                 38540041
385500     END-EXEC.                                                    38550041
385600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      38560041
385700         SET DP013-CICS-ABEND      TO TRUE                        38570041
385800         SET DP013-NO-ROLLBACK     TO TRUE                        38580041
385900         MOVE '5110-WRITE-ASC-LISTQ'                              38590041
386000                                   TO DP013-PARAGRAPH             38600041
386100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           38610041
386200                                   TO DP013-MESSAGE-TEXT(1)       38620041
386300         PERFORM DP013-0000-PROCESS-ABEND                         38630041
386400     END-IF.                                                      38640041
386500 EJECT                                                            38650041
386600*----------------------------------------------------------------*38660041
386700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *38670041
386800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *38680041
386900*----------------------------------------------------------------*38690041
387000                                                                  38700041
387100 5200-FILL-SEL-QUEUE-RECORD.                                      38710041
387200                                                                  38720041
387300     PERFORM 6112-READ-LIST-QUEUE.                                38730041
387400                                                                  38740041
387500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       38750041
387600         PERFORM                                                  38760041
387700         VARYING LQW-IDX                                          38770041
387800         FROM 1 BY 1                                              38780041
387900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            38790041
388000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          38800041
388100                                                                  38810041
388200             IF  LQW-SELECT (LQW-IDX)                             38820041
388300                 ADD +1            TO AP301-SELECTED-ITEMS        38830041
388400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              38840041
388500                                   TO AP301-ITEM (AP301-IDX)      38850041
388600                                                                  38860041
388700                 MOVE LQW-PAYT-REQ-LNE-NBR (LQW-IDX)              38870041
388800                                   TO AP301-PAYT-REQ-LNE-NBR      38880041
388900                                        (AP301-IDX)               38890041
389000                 MOVE LQW-PO-LINE-NBR (LQW-IDX)                   38900041
389100                                   TO AP301-PO-LNE-NBR            38910041
389200                                        (AP301-IDX)               38920041
389300                 MOVE SPACE        TO AP301-ACTION-SW (AP301-IDX) 38930041
389400                 SET AP301-IDX UP BY 1                            38940041
389500                 IF  AP301-IDX > AP301-MAX-ITEMS                  38950041
389600                     ADD +1      TO AP300-NUMBER-OF-TS-ITEMS      38960041
389700                                    PV-SEL-QUEUE-ITEM             38970041
389800                     PERFORM 5205-WRITE-SEL-QUEUE                 38980041
389900                     MOVE 0      TO AP301-SELECTED-ITEMS          38990041
390000                     INITIALIZE AP301-SELECTED-ITEM-ARRAY         39000041
390100                     SET AP301-IDX TO  1                          39010041
390200                 END-IF                                           39020041
390300             END-IF                                               39030041
390400         END-PERFORM                                              39040041
390500     END-IF.                                                      39050041
390600                                                                  39060041
390700*----------------------------------------------------------------*39070041
390800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *39080041
390900*----------------------------------------------------------------*39090041
391000                                                                  39100041
391100 5205-WRITE-SEL-QUEUE.                                            39110041
391200                                                                  39120041
391300                                                                  39130041
391400     EXEC CICS                                                    39140041
391500          WRITEQ TS                                               39150041
391600              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      39160041
391700              FROM  (AP301-INVC-LIST-TS-RCRD)                     39170041
391800              ITEM  (PV-SEL-QUEUE-ITEM)                           39180041
391900              RESP  (PV-CICS-RESP)                                39190041
392000     END-EXEC.                                                    39200041
392100                                                                  39210041
392200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39220041
392300         CONTINUE                                                 39230041
392400     ELSE                                                         39240041
392500         SET DP013-CICS-ABEND      TO TRUE                        39250041
392600         SET DP013-NO-ROLLBACK     TO TRUE                        39260041
392700         MOVE '5205-WRITE-SEL-QUEUE'                              39270041
392800                                   TO DP013-PARAGRAPH             39280041
392900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          39290041
393000                                   TO DP013-MESSAGE-TEXT(1)       39300041
393100         PERFORM DP013-0000-PROCESS-ABEND                         39310041
393200     END-IF.                                                      39320041
393300 EJECT                                                            39330041
393400                                                                  39340041
393500*----------------------------------------------------------------*39350041
393600*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *39360041
393700*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *39370041
393800*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *39380041
393900*  THE USER.                                                     *39390041
394000*----------------------------------------------------------------*39400041
394100                                                                  39410041
394200 6000-REFRESH-PANEL-FROM-TEMP.                                    39420041
394300                                                                  39430041
394400     IF  ASC-UPDATE-TSQ AND                                       39440041
394500         ASC-NUMBER-OF-SELECTED-ITEMS > 0                         39450041
394600         SET ASC-NO-TSQ-UPDATE TO TRUE                            39460041
394700         MOVE ZERO                 TO PV-SAVE-ITEM                39470041
394800                                      PV-SEL-QUEUE-ITEM           39480041
394900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        39490041
395000                                   TO PV-HOLD-SELECTED-ITEMS      39500041
395100         MOVE +1                   TO PV-ITEMS-PROCESSED          39510041
395200         PERFORM 6100-UPDATE-TSQ                                  39520041
395300             UNTIL PV-ITEMS-PROCESSED >                           39530041
395400                                     PV-HOLD-SELECTED-ITEMS       39540041
395500         PERFORM 6010-DELETE-SEL-QUEUE                            39550041
395600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         39560041
395700                    ASC-BLOCK-ENTRIES (2)                         39570041
395800     END-IF.                                                      39580041
395900                                                                  39590041
396000*----------------------------------------------------------------*39600041
396100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *39610041
396200*----------------------------------------------------------------*39620041
396300                                                                  39630041
396400 6010-DELETE-SEL-QUEUE.                                           39640041
396500                                                                  39650041
396600     EXEC CICS                                                    39660041
396700         DELETEQ TS                                               39670041
396800             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       39680041
396900             RESP  (PV-CICS-RESP)                                 39690041
397000     END-EXEC.                                                    39700041
397100                                                                  39710041
397200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      39720041
397300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         39730041
397400         CONTINUE                                                 39740041
397500     ELSE                                                         39750041
397600         SET DP013-CICS-ABEND TO TRUE                             39760041
397700         SET DP013-NO-ROLLBACK TO TRUE                            39770041
397800         MOVE '6010-DELETE-SEL-QUEUE'                             39780041
397900                        TO DP013-PARAGRAPH                        39790041
398000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         39800041
398100                        TO DP013-MESSAGE-TEXT (1)                 39810041
398200         PERFORM DP013-0000-PROCESS-ABEND                         39820041
398300     END-IF.                                                      39830041
398400                                                                  39840041
398500*----------------------------------------------------------------*39850041
398600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *39860041
398700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *39870041
398800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *39880041
398900*    THE TEMP QUEUE.                                             *39890041
399000*----------------------------------------------------------------*39900041
399100                                                                  39910041
399200 6100-UPDATE-TSQ.                                                 39920041
399300                                                                  39930041
399400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             39940041
399500     PERFORM 6105-READ-SEL-QUEUE.                                 39950041
399600     PERFORM                                                      39960041
399700         VARYING AP301-IDX                                        39970041
399800         FROM 1 BY 1                                              39980041
399900         UNTIL ((PV-ITEMS-PROCESSED >                             39990041
400000                              PV-HOLD-SELECTED-ITEMS)             40000041
400100         OR (AP301-IDX GREATER THAN AP301-MAX-ITEMS))             40010041
400200         IF  AP301-ACTION-SW (AP301-IDX) > SPACE                  40020041
400300             PERFORM 6110-PROCESS-ITEMS                           40030041
400400         END-IF                                                   40040041
400500         ADD +1                TO PV-ITEMS-PROCESSED              40050041
400600     END-PERFORM.                                                 40060041
400700                                                                  40070041
400800     IF PV-SAVE-ITEM NOT EQUAL ZERO                               40080041
400900         PERFORM 6111-WRITE-LIST-QUEUE                            40090041
401000     END-IF.                                                      40100041
401100                                                                  40110041
401200*----------------------------------------------------------------*40120041
401300*    READ THE LIST QUEUE RECORD.                                 *40130041
401400*----------------------------------------------------------------*40140041
401500                                                                  40150041
401600 6105-READ-SEL-QUEUE.                                             40160041
401700                                                                  40170041
401800     EXEC CICS                                                    40180041
401900          READQ TS                                                40190041
402000              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      40200041
402100              INTO  (AP301-INVC-LIST-TS-RCRD)                     40210041
402200              ITEM  (PV-SEL-QUEUE-ITEM)                           40220041
402300              RESP  (PV-CICS-RESP)                                40230041
402400     END-EXEC.                                                    40240041
402500                                                                  40250041
402600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          40260041
402700         CONTINUE                                                 40270041
402800     ELSE                                                         40280041
402900         SET DP013-CICS-ABEND      TO  TRUE                       40290041
403000         SET DP013-NO-ROLLBACK     TO  TRUE                       40300041
403100         MOVE '6105-READ-SEL-QUEUE'                               40310041
403200                                   TO  DP013-PARAGRAPH            40320041
403300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           40330041
403400                                   TO  DP013-MESSAGE-TEXT(1)      40340041
403500         PERFORM DP013-0000-PROCESS-ABEND                         40350041
403600     END-IF.                                                      40360041
403700 EJECT                                                            40370041
403800                                                                  40380041
403900*----------------------------------------------------------------*40390041
404000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*40400041
404100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*40410041
404200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *40420041
404300*----------------------------------------------------------------*40430041
404400                                                                  40440041
404500 6110-PROCESS-ITEMS.                                              40450041
404600                                                                  40460041
404700     COMPUTE PV-ITEM = 1 + ((AP301-ITEM (AP301-IDX) - 1)          40470041
404800                     / PC-ITEMS-PER-PANEL).                       40480041
404900                                                                  40490041
405000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           40500041
405100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          40510041
405200             PERFORM 6111-WRITE-LIST-QUEUE                        40520041
405300         END-IF                                                   40530041
405400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    40540041
405500                                                                  40550041
405600         PERFORM 6112-READ-LIST-QUEUE                             40560041
405700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               40570041
405800             CONTINUE                                             40580041
405900         END-IF                                                   40590041
406000     END-IF.                                                      40600041
406100                                                                  40610041
406200     COMPUTE PV-SUB = (AP301-ITEM (AP301-IDX)                     40620041
406300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              40630041
406400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         40640041
406500     MOVE LQW-SELECTED-SW (PV-SUB)                                40650041
406600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  40660041
406700                                                                  40670041
406800     EVALUATE TRUE                                                40680041
406900         WHEN AP301-INQ (AP301-IDX)                               40690041
407000              MOVE PC-INQ    TO LQW-ACTION (PV-SUB)               40700041
407100                                                                  40710041
407200         WHEN AP301-UPD (AP301-IDX)                               40720041
407300              MOVE PC-UPD    TO LQW-ACTION (PV-SUB)               40730041
407400                                                                  40740041
407500         WHEN AP301-DEL (AP301-IDX)                               40750041
407600              MOVE PC-DEL    TO LQW-ACTION (PV-SUB)               40760041
407700                                                                  40770041
407800         WHEN AP301-ERR (AP301-IDX)                               40780041
407900              MOVE PC-ERR    TO LQW-ACTION (PV-SUB)               40790041
408000     END-EVALUATE.                                                40800041
408100                                                                  40810041
408200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                40820041
408300                                                                  40830041
408400*----------------------------------------------------------------*40840041
408500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *40850041
408600*----------------------------------------------------------------*40860041
408700                                                                  40870041
408800 6111-WRITE-LIST-QUEUE.                                           40880041
408900                                                                  40890041
409000     EXEC CICS                                                    40900041
409100         WRITEQ TS                                                40910041
409200             QUEUE (ASC-LIST-QUEUE-NAME)                          40920041
409300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     40930041
409400             ITEM  (PV-SAVE-ITEM)                                 40940041
409500             REWRITE                                              40950041
409600             RESP  (PV-CICS-RESP)                                 40960041
409700     END-EXEC.                                                    40970041
409800                                                                  40980041
409900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          40990041
410000         CONTINUE                                                 41000041
410100     ELSE                                                         41010041
410200         SET DP013-CICS-ABEND  TO  TRUE                           41020041
410300         SET DP013-NO-ROLLBACK TO  TRUE                           41030041
410400         MOVE '6111-WRITE-LIST-QUEUE'                             41040041
410500                               TO  DP013-PARAGRAPH                41050041
410600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  41060041
410700                               TO  DP013-MESSAGE-TEXT(1)          41070041
410800         PERFORM DP013-0000-PROCESS-ABEND                         41080041
410900     END-IF.                                                      41090041
411000                                                                  41100041
411100 EJECT                                                            41110041
411200*----------------------------------------------------------------*41120041
411300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*41130041
411400*----------------------------------------------------------------*41140041
411500                                                                  41150041
411600 6112-READ-LIST-QUEUE.                                            41160041
411700                                                                  41170041
411800     EXEC CICS                                                    41180041
411900         READQ TS                                                 41190041
412000             QUEUE (ASC-LIST-QUEUE-NAME)                          41200041
412100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     41210041
412200             ITEM  (PV-ITEM)                                      41220041
412300             RESP  (PV-CICS-RESP)                                 41230041
412400     END-EXEC.                                                    41240041
412500*                                                                 41250041
412600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          41260041
412700         CONTINUE                                                 41270041
412800     ELSE                                                         41280041
412900         SET DP013-CICS-ABEND        TO TRUE                      41290041
413000         SET DP013-NO-ROLLBACK       TO TRUE                      41300041
413100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           41310041
413200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    41320041
413300                                     TO DP013-MESSAGE-TEXT(1)     41330041
413400         PERFORM DP013-0000-PROCESS-ABEND                         41340041
413500     END-IF.                                                      41350041
413600                                                                  41360041
413700*----------------------------------------------------------------*41370041
413800* PHYSICALLY LOOPS THROUGH ALL ITEMS IN THE LIST TEMP STORAGE    *41380041
413900* QUEUE.  PERFORMS THE ADD PARAGRAPH ONCE AN ITEM IS FOUND TO    *41390041
414000* BE SELECTED.                                                   *41400041
414100*----------------------------------------------------------------*41410041
414200 8000-PROCESS-UPDATE-TSQ.                                         41420041
414300                                                                  41430041
414400     MOVE ASC-LIST-ITEM-NUMBER (1 1)                              41440041
414500                                 TO PV-LIST-ITEM-NUMBER.          41450041
414600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            41460041
414700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    41470041
414800                                                                  41480041
414900     MOVE +1                     TO ASC-BLK-SUB                   41490041
415000                                                                  41500041
415100     PERFORM                                                      41510041
415200         VARYING PV-BLOCK-NUMBER                                  41520041
415300         FROM 1 BY 1                                              41530041
415400         UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN        41540041
415500                                                                  41550041
415600         PERFORM 4410-READ-TEMP-STORAGE                           41560041
415700                                                                  41570041
415800         PERFORM                                                  41580041
415900             VARYING ASC-ITEM-SUB                                 41590041
416000             FROM 1 BY 1                                          41600041
416100             UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL              41610041
416200                                                                  41620041
416300             IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)             41630041
416400                 PERFORM 8100-UPDATE-ITEM                         41640041
416500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              41650041
416600                                 TO TRUE                          41660041
416700                 SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     41670041
416800                                 TO TRUE                          41680041
416900                 SET ASC-TEMP-NO-SELECT                           41690041
417000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     41700041
417100                                 TO TRUE                          41710041
417200                 SUBTRACT +1  FROM ASC-NUMBER-OF-SELECTED-ITEMS   41720041
417300             END-IF                                               41730041
417400                                                                  41740041
417500         END-PERFORM                                              41750041
417600                                                                  41760041
417700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      41770041
417800             PERFORM 5105-REWRITE-ASC-LISTQ                       41780041
417900         END-IF                                                   41790041
418000                                                                  41800041
418100     END-PERFORM.                                                 41810041
418200                                                                  41820041
418300     MOVE +1                     TO ASC-BLK-SUB.                  41830041
418400     MOVE PV-FIRST-BLOCK-IN-ARRAY                                 41840041
418500                                 TO PV-BLOCK-NUMBER.              41850041
418600     PERFORM 4410-READ-TEMP-STORAGE.                              41860041
418700                                                                  41870041
418800     ADD +1                      TO PV-BLOCK-NUMBER               41880041
418900                                    ASC-BLK-SUB.                  41890041
419000     PERFORM 4410-READ-TEMP-STORAGE.                              41900041
419100                                                                  41910041
419200*----------------------------------------------------------------*41920041
419300*>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    *41930041
419400*----------------------------------------------------------------*41940041
419500 8100-UPDATE-ITEM.                                                41950041
419600     MOVE ASC-PIECES (ASC-BLK-SUB ASC-ITEM-SUB)                   41960041
419700                                 TO PREQIT-PAY-REQ-LNE-QTY        41970041
419800     MOVE ASC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)                41980041
419900                                 TO PREQIT-UNT-COST-AMT           41990041
420000     MOVE PC-EACH                TO PREQIT-QTY-UNT-OF-MSMT        42000041
420100     MOVE ASC-PAYT-REQ-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         42010041
420200                                 TO PREQIT-PAYT-REQ-LNE-NBR       42020041
420300     MOVE ASC-KEY-PAYT-REQ-SEQ-NBR                                42030041
420400                                 TO PREQIT-PAYT-REQ-SEQ-NBR       42040041
420500     EXEC SQL                                                     42050041
420600         UPDATE TPREQIT                                           42060041
420700             SET PAY_REQ_LNE_QTY   = :PREQIT-PAY-REQ-LNE-QTY,     42070041
420800                 QTY_UNT_OF_MSMT   = :PREQIT-QTY-UNT-OF-MSMT,     42080041
420900                 UNT_COST_AMT      = :PREQIT-UNT-COST-AMT         42090041
421000             WHERE PAYT_REQ_SEQ_NBR                               42100041
421100                                   = :PREQIT-PAYT-REQ-SEQ-NBR     42110041
421200               AND PAYT_REQ_LNE_NBR                               42120041
421300                                   = :PREQIT-PAYT-REQ-LNE-NBR     42130041
421400     END-EXEC.                                                    42140041
421500     EVALUATE TRUE                                                42150041
421600         WHEN SQLCODE = ZERO                                      42160041
421700             CONTINUE                                             42170041
421800         WHEN SQLWARN0 NOT = SPACES                               42180041
421900         WHEN SQLCODE > ZERO                                      42190041
422000         WHEN SQLCODE < ZERO                                      42200041
422100             MOVE '8100-UPDATE-ITEM'                              42210041
422200                               TO DP013-PARAGRAPH                 42220041
422300             MOVE 'UPDATE ITEM WITH U/COST AND QTY'               42230041
422400                                   TO DP013-MESSAGE-TEXT (1)      42240041
422500             MOVE SQLCA            TO DP013-SQLCA                 42250041
422600             MOVE 'TPREQIT'        TO DP013-DB2-TABLE-NAME (1)    42260041
422700             SET DP013-DB2-ABEND                                  42270041
422800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               42280041
422900             PERFORM DP013-0000-PROCESS-ABEND                     42290041
423000     END-EVALUATE.                                                42300041
423100                                                                  42310041
423200 8800-CHECK-IF-PROCESSED.                                         42320041
423300                                                                  42330041
423400     PERFORM                                                      42340041
423500         WITH TEST AFTER                                          42350041
423600         VARYING PV-RETRY-COUNTER                                 42360041
423700         FROM 1 BY 1                                              42370041
423800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               42380041
423900             OR (SQLCODE = +0))                                   42390041
424000                                                                  42400041
424100         EXEC SQL                                                 42410041
424200           SELECT COUNT(*)                                        42420044
424300             INTO :PV-DB2-COUNT                                   42430044
424400             FROM TPOSTRR A                                       42440044
424500            WHERE A.PO_NBR       = :ASC-KEY-PO-NUMBER             42450044
424600              AND (STR_NBR       = :ASC-KEY-STORE-NUMBER          42460044
424700                   OR MTCH_LVL_CDE NOT IN (:ASC-KEY-MTCH-LVL-CDE))42470044
424800              AND STATUS_CDE    IN (' ', 'I')                     42480044
424900         END-EXEC                                                 42490044
425000                                                                  42500044
425100         EVALUATE TRUE                                            42510044
425200             WHEN SQLCODE = +0                                    42520044
425300             WHEN SQLCODE = -305                                  42530044
425400             WHEN SQLCODE = -904                                  42540044
425500             WHEN SQLCODE = -913                                  42550044
425600                  CONTINUE                                        42560044
425700                                                                  42570044
425800             WHEN SQLWARN0 NOT = SPACES                           42580044
425900             WHEN SQLCODE  NOT = ZERO                             42590044
426000                  MOVE '8800-CHECK-IF-PROCESSED'                  42600044
426100                                  TO DP013-PARAGRAPH              42610044
426200                  MOVE 'UNSUCCESSFUL SELECT COUNT'                42620044
426300                                  TO DP013-MESSAGE-TEXT (1)       42630044
426400                  MOVE SQLCA      TO DP013-SQLCA                  42640044
426500                  MOVE 'TPOSTRR ' TO DP013-DB2-TABLE-NAME (1)     42650044
426600                  MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (2)     42660044
426700                  SET DP013-DB2-ABEND                             42670044
426800                      DP013-XCTL-DISPLAY-RESTART                  42680044
426900                                  TO TRUE                         42690044
427000                  PERFORM DP013-0000-PROCESS-ABEND                42700044
427100         END-EVALUATE                                             42710044
427200     END-PERFORM.                                                 42720044
427300                                                                  42730044
427400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        42740044
427500         MOVE '8800-CHECK-IF-PROCESSED'                           42750044
427600                                  TO DP013-PARAGRAPH              42760044
427700         MOVE 'MAX RETRIES EXCEEDED FOR SELECT COUNT'             42770044
427800                                  TO DP013-MESSAGE-TEXT (1)       42780044
427900         MOVE SQLCA               TO DP013-SQLCA                  42790044
428000         MOVE 'TPOSTRR '          TO DP013-DB2-TABLE-NAME (1)     42800044
428100         MOVE 'TINVOIC '          TO DP013-DB2-TABLE-NAME (2)     42810044
428200         SET DP013-DB2-ABEND                                      42820044
428300             DP013-XCTL-DISPLAY-RESTART                           42830044
428400                                  TO TRUE                         42840044
428500         PERFORM DP013-0000-PROCESS-ABEND                         42850044
428600     END-IF.                                                      42860044
428700                                                                  42870044
428800     IF SQLCODE = ZERO AND PV-DB2-COUNT > ZERO                    42880044
428900         MOVE DP015-UNP-ALP-BRT-OFF                               42890044
429000                              TO APONBRA                          42900044
429100         MOVE DP015-RED       TO APONBRC                          42910044
429200         MOVE DP015-REVERSE   TO APONBRH                          42920044
429300         SET PS-ERROR         TO TRUE                             42930044
429400     END-IF.                                                      42940044
429500/                                                                 42950044
429600*---------------------------------------------------------------- 42960044
429700* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        42970044
429800*---------------------------------------------------------------- 42980044
429900                                                                  42990044
430000 9100-READ-SEL-QUEUE.                                             43000044
430100                                                                  43010044
430200     EXEC CICS                                                    43020044
430300         READQ TS                                                 43030044
430400             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        43040044
430500             INTO  (AP301-INVC-LIST-TS-RCRD)                      43050044
430600             ITEM  (ASC-SEL-ITEM)                                 43060044
430700             RESP  (PV-CICS-RESP)                                 43070044
430800     END-EXEC.                                                    43080044
430900                                                                  43090044
431000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       43100044
431100         CONTINUE                                                 43110044
431200     ELSE                                                         43120044
431300         SET DP013-LOGIC-ABEND                                    43130044
431400             DP013-NO-ROLLBACK     TO TRUE                        43140044
431500         MOVE '9100-READ-SEL-QUEUE'                               43150044
431600                                   TO DP013-PARAGRAPH             43160044
431700         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   43170044
431800                                   TO DP013-MESSAGE-TEXT (1)      43180044
431900         PERFORM DP013-0000-PROCESS-ABEND                         43190044
432000     END-IF.                                                      43200044
432100                                                                  43210044
432200/                                                                 43220044
432300*---------------------------------------------------------------- 43230044
432400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        43240044
432500*---------------------------------------------------------------- 43250044
432600 9200-REWRITE-LIST-QUEUE.                                         43260044
432700                                                                  43270044
432800     EXEC CICS                                                    43280044
432900          WRITEQ TS                                               43290044
433000              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      43300044
433100              FROM   (AP301-INVC-LIST-TS-RCRD)                    43310044
433200              ITEM   (ASC-SEL-ITEM)                               43320044
433300              RESP   (PV-CICS-RESP)                               43330044
433400              REWRITE                                             43340044
433500     END-EXEC.                                                    43350044
433600                                                                  43360044
433700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   43370044
433800         SET DP013-CICS-ABEND                                     43380044
433900             DP013-NO-ROLLBACK     TO TRUE                        43390044
434000         MOVE '9200-REWRITE-LIST-QUEUE'                           43400044
434100                                   TO DP013-PARAGRAPH             43410044
434200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   43420044
434300                                   TO DP013-MESSAGE-TEXT (1)      43430044
434400         PERFORM DP013-0000-PROCESS-ABEND                         43440044
434500     END-IF.                                                      43450044
434600                                                                  43460044
434700/                                                                 43470044
434800*----------------------------------------------------------------*43480044
434900*    ABEND PROCESSOR MODULE                                      *43490044
435000*----------------------------------------------------------------*43500044
435100                                                                  43510044
435200     COPY DPPD013.                                                43520044
435300*----------------------------------------------------------------*43530044
435400*    DATE AND TIME MODULE                                        *43540044
435500*----------------------------------------------------------------*43550044
435600                                                                  43560044
435700     COPY DPPD017.                                                43570044
435800*--------------------------------------------------------------*  43580054
435900* COPYBOOK FOR SEPHORA PROCESSES                               *  43590054
436000*--------------------------------------------------------------*  43600054
436100     COPY APPD021.                                                43610054
436200                                                                  43620054
