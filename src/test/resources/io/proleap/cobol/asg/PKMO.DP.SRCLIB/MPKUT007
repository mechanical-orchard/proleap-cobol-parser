000100 IDENTIFICATION DIVISION.                                         00010094
000200                                                                  00020007
000300 PROGRAM-ID.    MPKUT007.                                         00030002
000400 AUTHOR.        DAN FRANKLIN.                                     00040007
000500 INSTALLATION.  KOHL CORPORATION.                                 00050007
000600 DATE-WRITTEN.  01/26/89.                                         00060007
000700 DATE-COMPILED.                                                   00070007
000800***********************************************************       00080007
000900*    CREATE THE DAILY RECEIPTS OUTPUT FILE.                       00090007
001000*                                                                 00100007
001100*    CREATE THE DAILY RECEIPTS OUTPUT FILE FROM RECORDS ON        00110007
001200*    EACH OF THE 3 INPUT FILES:                                   00120007
001300*                                                                 00130007
001400*    1) PLANNED RECEIPTS FILE - CONTAINS PLANNED RECEIPTS         00140007
001500*       FOR DEPARTMENTS AND THEIR RECEIVING LOCATIONS.            00150007
001600*                                                                 00160007
001700*    2) STRREC EXTRACT FILE   - CONTAINS THE ACTUAL RECEIPTS      00170007
001800*       FOR ONE DAY FOR DEPARTMENTS AND THEIR RECEIVING           00180007
001900*       LOCATIONS.                                                00190007
002000*                                                                 00200007
002100*    3) DAILY RECEIPTS FILE   - THE CURRENT GENERATION OF THE     00210007
002200*       DAILY RECEIPTS FILE.  IT CONTAINS THE RECEIPTS FOR THE    00220007
002300*       CURRENT WEEK ALONG WITH THE PLANNED AND MONTH TO DATE     00230007
002400*       RECEIPTS FOR DEPARTMENTS AND THEIR RECEIVING LOCATIONS.   00240007
002500*                                                                 00250007
002600*    THERE ARE 3 POSSIBLE VALUES FOR THE RECEIVING LOCATION:      00260007
002700*                                                                 00270007
002800*    1) D1 - MENOMINEE FALLS DISTRIBUTION CENTER                  00280007
002900*    2) D2 - COLUMBUS DISTRIBUTION CENTER                         00290007
003000*    3) DS - DIRECT SHIP TO THE STORE                             00300007
003100*                                                                 00310007
003200*    EACH OF THE 3 FILES ARE SORTED BY DEPT AND RECEIVING         00320007
003300*    LOCATION, WHICH MAKE UP THE KEY FOR EACH FILE.               00330007
003400*    BY MATCHING THE KEYS FROM EACH FILE, WE CAN DETERMINE        00340007
003500*    WHICH FILES ARE TO BE USED TO BUILD A RECORD.                00350007
003600*                                                                 00360007
003700*    IF A FILE HAS A KEY THAT IS NOT FOUND ON THE OTHER           00370007
003800*    2 FILES, A RECORD IS THEN BUILT USING JUST THAT ONE FILE.    00380007
003900*    IN SOME CASES, 2 OF THE FILES WILL BE USED TO BUILD          00390007
004000*    THE RECORD.  IN SOME CASES, ALL 3 FILES WILL BE USED TO      00400007
004100*    BUILD THE RECORD.  IN ANY CASE, EACH RECORD FROM EACH FILE   00410007
004200*    IS SOMEHOW USED IN BUILDING THE OUTPUT RECORD.               00420007
004300***********************************************************       00430007
263627*----------------------------------------------------------------*00431099
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00432099
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00433099
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00434099
263627*----------------------------------------------------------------*00435099
004400*                                                                 00440007
004500*                                                                 00450007
004600*                                                                 00460007
004700 ENVIRONMENT DIVISION.                                            00470007
004800*                                                                 00480007
004900*                                                                 00490007
005000 CONFIGURATION SECTION.                                           00500007
005100                                                                  00510007
005200 SOURCE-COMPUTER.        IBM-3090.                                00520007
005300 OBJECT-COMPUTER.        IBM-3090.                                00530007
005400*                                                                 00540007
005500*                                                                 00550007
005600 INPUT-OUTPUT SECTION.                                            00560007
005700                                                                  00570007
005800 FILE-CONTROL.                                                    00580007
005900                                                                  00590007
006000     SELECT PLANNED-RECEIPTS-FILE                                 00600007
006100         ASSIGN INP01.                                            00610007
006200                                                                  00620007
006300     SELECT STORE-EXTRACT-FILE                                    00630007
006400         ASSIGN INP02.                                            00640007
006500                                                                  00650007
006600     SELECT DAILY-RECEIPTS-IN-FILE                                00660007
006700         ASSIGN INP03.                                            00670007
006800                                                                  00680007
006900     SELECT DAILY-RECEIPTS-OUT-FILE                               00690007
007000         ASSIGN OUT01.                                            00700007
007100*                                                                 00710007
007200*                                                                 00720007
007300*                                                                 00730007
007400 DATA DIVISION.                                                   00740007
007500*                                                                 00750007
007600*                                                                 00760007
007700 FILE SECTION.                                                    00770007
007800                                                                  00780007
007900 FD  PLANNED-RECEIPTS-FILE                                        00790007
008000     RECORDING MODE IS F                                          00800007
008100     BLOCK CONTAINS 0 RECORDS.                                    00810007
008200                                                                  00820007
008300 01  PR-PLANNED-RECEIPTS-RECORD      PIC  X(80).                  00830007
008400*                                                                 00840007
008500*                                                                 00850007
008600 FD  STORE-EXTRACT-FILE                                           00860007
008700     RECORDING MODE IS F                                          00870007
008800     BLOCK CONTAINS 0 RECORDS.                                    00880007
008900                                                                  00890007
009000 01  SE-STORE-EXTRACT-RECORD         PIC  X(300).                 00900007
009100*                                                                 00910007
009200*                                                                 00920007
009300 FD  DAILY-RECEIPTS-IN-FILE                                       00930007
009400     RECORDING MODE IS F                                          00940007
009500     BLOCK CONTAINS 0 RECORDS.                                    00950007
009600                                                                  00960007
009700 01  DRI-DAILY-RECEIPTS-IN-RECORD    PIC  X(90).                  00970007
009800*                                                                 00980007
009900*                                                                 00990007
010000 FD  DAILY-RECEIPTS-OUT-FILE                                      01000007
010100     RECORDING MODE IS F                                          01010007
010200     BLOCK CONTAINS 0 RECORDS.                                    01020007
010300                                                                  01030007
010400 01  DRO-DAILY-RECEIPTS-OUT-RECORD   PIC  X(90).                  01040007
010500*                                                                 01050007
010600*                                                                 01060007
010700 WORKING-STORAGE SECTION.                                         01070007
010800                                                                  01080007
010900***************************************************************   01090007
011000*    NUMERIC EDIT LAYOUT                                          01100007
011100***************************************************************   01110007
011200     COPY DPWS010I.                                               01120099
011300*                                                                 01130007
011400*                                                                 01140007
011500******************************************************************01150099
011600***  WORK FIELDS FOR THE DATE CONVERSION SUBROUTINE               01160099
011700******************************************************************01170099
011800     COPY DPWS500.                                                01180099
011900*                                                                 01190099
012000***********************************************************       01200099
012100*  COPYBOOK USED BY MBS SYSTEM                            *       01210099
012200***********************************************************       01220099
012300     COPY DPWS003.                                                01230099
012400*                                                                 01240099
012500/                                                                 01250099
012600******************************************************************01260099
012700*   DB2 SQL COMMUNICATION AREA                                    01270099
012800******************************************************************01280099
012900     EXEC SQL                                                     01290099
013000          INCLUDE SQLCA                                           01300099
013100     END-EXEC.                                                    01310099
013200/                                                                 01320099
014000***************************************************************   01330007
014100*    PLANNED RECEIPTS RECORD LAYOUT                               01340007
014200***************************************************************   01350007
014300     COPY MPRD010I.                                               01360099
014400*                                                                 01370007
014500*                                                                 01380007
014600***************************************************************   01390007
014700*    DAILY RECEIPTS RECORD LAYOUT - INPUT                         01400007
014800***************************************************************   01410007
014900     COPY MPRD009I.                                               01420099
015000*                                                                 01430007
015100*                                                                 01440007
015200***************************************************************   01450007
015300*    DAILY RECEIPTS RECORD LAYOUT - OUTPUT                        01460007
015400***************************************************************   01470007
015500     COPY MPRD009O.                                               01480099
015600*                                                                 01490007
015700*                                                                 01500007
015800***************************************************************   01510007
015900*    STOREREC EXTRACT RECORD LAYOUT                               01520007
016000***************************************************************   01530007
016100     COPY STOREEXT.                                               01540099
016200*                                                                 01550007
016300 01  CC-CONTROL-CARD.                                             01560007
016400     05  CC-RUN-DATE.                                             01570007
016500         10  CC-RUN-DATE-MM          PIC  X(02)    VALUE SPACES.  01580007
016600         10  CC-RUN-DATE-DD          PIC  X(02)    VALUE SPACES.  01590007
016700         10  CC-RUN-DATE-YY          PIC  X(02)    VALUE SPACES.  01600007
016800     05  FILLER                      PIC  X(01)    VALUE SPACE.   01610007
016900     05  CC-FISCAL-CALENDAR          PIC  X(02)    VALUE SPACES.  01620007
017000     05  FILLER                      PIC  X(71)    VALUE SPACES.  01630007
017100                                                                  01640007
017200 01  PH-PROGRAM-HELPERS.                                          01650007
017300     05  PH-DEPT                     PIC  9(03)    VALUE ZERO.    01660007
017400     05  PH-PREVIOUS-DEPT-DC.                                     01670007
017500         10  PH-PREVIOUS-DEPT        PIC  9(03)    VALUE ZERO.    01680007
017600         10  PH-PREVIOUS-DC          PIC  X(02)    VALUE ZERO.    01690007
017700                                                                  01700007
017800 01  PC-CONSTANTS.                                                01710007
017900     05  PC-MBS-PROGRAM-NAME         PIC  X(08)    VALUE          01720004
018000         'DPKUT039'.                                              01730004
018100     05  PC-CURRENT-OPERATING-COMPANY                             01740004
018200                                     PIC  X(02)    VALUE '03'.    01750004
018300     05  PC-SYSTEM-CODE              PIC  X(02)    VALUE 'MP'.    01760004
018400                                                                  01770007
018500 01  PV-PROGRAM-VARIABLES.                                        01780099
           05  PV-TIMESTAMP                 PIC X(26).                  01790099
018600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01800099
018700                                                   COMP SYNC.     01810099
018800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01820099
018900     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01830099
019000     05  PV-ABEND-STRUCTURE-1        PIC  X(8)     VALUE SPACES.  01840099
019100     05  PV-ABEND-STRUCTURE-2        PIC  X(8)     VALUE SPACES.  01850099
019200     05  PV-ABEND-STRUCTURE-3        PIC  X(8)     VALUE SPACES.  01860099
019300     05  PV-ERROR-MESSAGE-1          PIC  X(60)    VALUE SPACES.  01870099
019400     05  PV-ERROR-MESSAGE-2          PIC  X(60)    VALUE SPACES.  01880099
019500     05  PV-SQLCODE                  PIC  9(9)     VALUE ZERO.    01890099
019600                                                                  01900007
019700 01  PK-PROGRAM-KEYS.                                             01910007
019800     05  PK-PLANNED-RECEIPTS-KEY.                                 01920007
019900         10  PK-PLANNED-RECEIPTS-DEPT                             01930007
020000                                     PIC  X(03)    VALUE ZERO.    01940007
020100         10  PK-PLANNED-RECEIPTS-DC  PIC  X(02)    VALUE 'DC'.    01950007
020200         10  PK-PLANNED-OPER-UNIT-ID PIC S9(04)    COMP           01960099
020300                                                   VALUE +85.     01970099
020400     05  PK-DAILY-RECEIPTS-KEY.                                   01980007
020500         10  PK-DAILY-RECEIPTS-DEPT  PIC  X(03)    VALUE ZERO.    01990007
020600         10  PK-DAILY-RECEIPTS-DC    PIC  X(02)    VALUE ZERO.    02000007
020700         10  PK-DAILY-OPER-UNIT-ID   PIC S9(04)    COMP.          02010099
020800     05  PK-STORE-EXTRACT-KEY.                                    02020007
020900         10  PK-STORE-EXTRACT-DEPT PIC X(03)       VALUE ZERO.    02030007
021000         10  PK-STORE-EXTRACT-DC     PIC  X(02)    VALUE ZERO.    02040007
021100         10  PK-STORE-OPER-UNIT-ID   PIC S9(04)    COMP.          02050099
021200                                                                  02060007
021300 01  PS-PROGRAM-SUBSCRIPTS.                                       02070007
021400     05  PS-DAY-SUB                  PIC S9(04)    VALUE ZERO     02080007
021500                                                   COMP SYNC.     02090007
021600     05  PS-WORK-SUB                 PIC S9(04)    VALUE ZERO     02100007
021700                                                   COMP SYNC.     02110007
021800                                                                  02120007
021900 01  PS-PROGRAM-SWITCHES.                                         02130007
022000     05  PS-NEW-PERIOD-SW            PIC  X(01)    VALUE SPACE.   02140007
022100         88  PS-NEW-MONTH                          VALUE 'M'.     02150007
022200         88  PS-NEW-WEEK                           VALUE 'W'.     02160007
022300     05  PS-PLANNED-RECEIPTS-EOF-SW  PIC  X(01)    VALUE 'N'.     02170007
022400         88  PS-PLANNED-RECEIPTS-EOF               VALUE 'Y'.     02180007
022500     05  PS-DAILY-RECEIPTS-EOF-SW    PIC  X(01)    VALUE 'N'.     02190007
022600         88  PS-DAILY-RECEIPTS-EOF                 VALUE 'Y'.     02200007
022700     05  PS-STORE-EXTRACT-EOF-SW     PIC  X(01)    VALUE 'N'.     02210007
022800         88  PS-STORE-EXTRACT-EOF                  VALUE 'Y'.     02220007
022900     05  PS-DEPT-FOUND-SW            PIC  X(01)    VALUE 'Y'.     02230007
023000         88  PS-DEPT-FOUND                         VALUE 'Y'.     02240007
023100         88  PS-DEPT-NOT-FOUND                     VALUE 'N'.     02250007
023200     05  PS-VALID-PLAN-SW            PIC  X(01)    VALUE 'Y'.     02260007
023300         88  PS-VALID-PLAN                         VALUE 'Y'.     02270007
023400         88  PS-INVALID-PLAN                       VALUE 'N'.     02280007
023500     05  PS-DC-ERROR-SW              PIC  X(01)    VALUE 'N'.     02290007
023600         88  PS-DC-ERROR                           VALUE 'Y'.     02300007
023700         88  PS-NO-DC-ERROR                        VALUE 'N'.     02310007
023800                                                                  02320007
023900 01  TD-TODAYS-DATE.                                              02330007
024000     05  TD-YY                       PIC  9(02)    VALUE ZERO.    02340007
024100     05  TD-MM                       PIC  9(02)    VALUE ZERO.    02350007
024200     05  TD-DD                       PIC  9(02)    VALUE ZERO.    02360007
024300                                                                  02370007
024400 01  ABEND-CODE                      PIC S9(04)    VALUE ZERO     02380007
024500                                                   COMP SYNC.     02390007
024600*                                                                 02400007
024700*                                                                 02410007
024800 LINKAGE SECTION.                                                 02420007
024900*                                                                 02430007
025000 PROCEDURE DIVISION.                                              02440007
025100                                                                  02450007
025200 A100-MAIN-MODULE.                                                02460007
025300***************************************************************   02470007
025400*    OPEN ALL FILES.                                              02480007
025500*    READ THE 1ST RECORD FROM EACH OF THE 3 INPUT FILES.          02490007
025600*    READ THE CALENDAR DB TO DETERMINE THE DAY ON THE RECEIPT     02500007
025700*    OUTPUT RECORD THAT IS TO BE UPDATED.                         02510007
025800*    BUILD THE DAILY RECEIPTS OUTPUT FILE UNTIL WE GET AN EOF     02520007
025900*    CONDITION FOR ALL 3 INPUT FILES.                             02530007
026000*    CLOSE ALL FILES.                                             02540007
026100*                                                                 02550007
026200*    PERFORMED BY A100-MAIN-MODULE.                               02560007
026300***************************************************************   02570007
026400                                                                  02580007
           EXEC SQL SET :PV-TIMESTAMP = CURRENT TIMESTAMP END-EXEC.     02590099
                                                                        02600099
026500     OPEN INPUT  PLANNED-RECEIPTS-FILE                            02610007
026600                 STORE-EXTRACT-FILE                               02620007
026700                 DAILY-RECEIPTS-IN-FILE                           02630007
026800          OUTPUT DAILY-RECEIPTS-OUT-FILE.                         02640007
026900                                                                  02650007
027000     ACCEPT CC-CONTROL-CARD.                                      02660007
027100                                                                  02670007
027200     DISPLAY 'CONTROL-CARD -- ' CC-CONTROL-CARD.                  02680007
027300                                                                  02690007
027400     SET PS-INVALID-PLAN         TO TRUE.                         02700007
027500                                                                  02710007
027600     PERFORM Z100-READ-PLANNED-RECEIPTS                           02720007
027700       UNTIL (PS-VALID-PLAN)                                      02730007
027800          OR (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES).             02740007
027900                                                                  02750007
028000     PERFORM Z200-READ-DAILY-RECEIPTS.                            02760007
028100     PERFORM Z300-READ-STORE-EXTRACT.                             02770007
028200                                                                  02780007
028300     PERFORM B100-PROCESS-CALENDAR.                               02790007
028400                                                                  02800007
028500     PERFORM B200-PROCESS-RECORDS                                 02810007
028600       UNTIL (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES)              02820007
028700         AND (PK-DAILY-RECEIPTS-KEY   = HIGH-VALUES)              02830007
028800         AND (PK-STORE-EXTRACT-KEY = HIGH-VALUES).                02840007
028900                                                                  02850007
029000     CLOSE PLANNED-RECEIPTS-FILE                                  02860007
029100           STORE-EXTRACT-FILE                                     02870007
029200           DAILY-RECEIPTS-IN-FILE                                 02880007
029300           DAILY-RECEIPTS-OUT-FILE.                               02890007
029400                                                                  02900007
029500     STOP RUN.                                                    02910007
029600*                                                                 02920007
029700*                                                                 02930007
029800 B100-PROCESS-CALENDAR.                                           02940007
029900***************************************************************   02950007
030000*    READ THE CALENDAR DB USING THE DATE FROM THE STOREREC        02960007
030100*    EXTRACT FILE.  IF THERE ARE NO RECORDS ON THE FILE, USE      02970007
030200*    TODAYS DATE.  DETERMINE THE DAY WHICH IS TO BE UPDATED       02980007
030300*    ON THE DAILY RECEIPTS OUTPUT FILE, AND DETERMINE THE         02990007
030400*    WEEK ENDING DATE.                                            03000007
030500*                                                                 03010007
030600*    PERFORMED BY A100-MAIN-MODULE.                               03020007
030700***************************************************************   03030007
030800     ACCEPT TD-TODAYS-DATE FROM DATE.                             03040007
030900*                                                                 03050007
030910     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03060099
030920*                                                                 03070099
031000     MOVE CC-FISCAL-CALENDAR         TO DPG51-CALENDAR-TYPE.      03080007
031100     SET DPG52-LK-DTE-GREG           TO TRUE.                     03090007
031200*                                                                 03100007
031300     MOVE TD-TODAYS-DATE             TO DPG51-SYSTEM-DATE.        03110007
031400     MOVE CC-RUN-DATE                TO DPG52-LK-DATE-INPUT.      03120007
031500*                                                                 03130007
031600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                03140099
031700                                  DPG52                           03150007
031800                                  DPG53                           03160007
031900                                  DPG54                           03170007
032000                                  DPG55                           03180007
032100                                  DPG56.                          03190007
032200*                                                                 03200007
032300     IF  DPG54-SEVERE-ERROR                                       03210007
032400      OR DPG54-WARNING-ERROR                                      03220099
032500         DISPLAY '*** ABEND IN MPKUT007 ***'                      03230007
032600         DISPLAY 'PARAGRAPH B100-PROCESS-CALENDAR'                03240007
032700         DISPLAY 'DATE ROUTINE ERROR:  ' DPG54-ERROR-MESSAGE      03250007
032800         DISPLAY 'DPG51 INPUT PARMS: ' DPG51                      03260099
032900         DISPLAY 'DPG52 INPUT PARMS: ' DPG52                      03270099
033000         DISPLAY 'DPG53 INPUT PARMS: ' DPG53                      03280099
033100         DISPLAY 'DPG54 RESPONSE   : ' DPG54                      03290099
033200         MOVE +4019              TO ABEND-CODE                    03300007
033300         CALL 'ILBOABN0' USING ABEND-CODE                         03310007
033400     END-IF.                                                      03320007
033500*                                                                 03330007
033600     EVALUATE TRUE                                                03340007
033700         WHEN DPG55-NUMERIC-WEEK-DAY-SUN                          03350007
033800              MOVE 1             TO PS-DAY-SUB                    03360007
033900         WHEN DPG55-NUMERIC-WEEK-DAY-MON                          03370007
034000              MOVE 2             TO PS-DAY-SUB                    03380007
034100         WHEN DPG55-NUMERIC-WEEK-DAY-TUE                          03390007
034200              MOVE 3             TO PS-DAY-SUB                    03400007
034300         WHEN DPG55-NUMERIC-WEEK-DAY-WED                          03410007
034400              MOVE 4             TO PS-DAY-SUB                    03420007
034500         WHEN DPG55-NUMERIC-WEEK-DAY-THU                          03430007
034600              MOVE 5             TO PS-DAY-SUB                    03440007
034700         WHEN DPG55-NUMERIC-WEEK-DAY-FRI                          03450007
034800              MOVE 6             TO PS-DAY-SUB                    03460007
034900         WHEN DPG55-NUMERIC-WEEK-DAY-SAT                          03470007
035000              MOVE 7             TO PS-DAY-SUB                    03480007
035100     END-EVALUATE.                                                03490007
035200                                                                  03500007
035300     MOVE DPG55-LAST-WKDY-GREG   TO MP009O-WEEK-ENDING-DATE.      03510007
035400*                                                                 03520007
035500     IF  DPG55-DB2-ISO-DATE-FMT = DPG56-FIRST-FP-DB2-ISO-FMT      03530007
035600         SET PS-NEW-MONTH        TO TRUE                          03540007
035700     ELSE                                                         03550007
035800         IF  DPG55-NUMERIC-WEEK-DAY-SUN                           03560007
035900             SET PS-NEW-WEEK     TO TRUE                          03570007
036000         END-IF                                                   03580007
036100     END-IF.                                                      03590007
036200*                                                                 03600007
036300     DISPLAY 'NEW PERIOD SWITCH -- ' PS-NEW-PERIOD-SW.            03610007
036400     DISPLAY ''' '' -- OTHER THAN FIRST RUN OF WEEK OR MONTH'.    03620007
036500     DISPLAY '''W'' -- FIRST RUN OF THE WEEK'.                    03630007
036600     DISPLAY '''M'' -- FIRST RUN OF THE MONTH'.                   03640007
036700*                                                                 03650007
036800*                                                                 03660007
036900 B200-PROCESS-RECORDS.                                            03670007
037000***************************************************************   03680007
037100*    COMPARE THE KEY VALUE FROM EACH OF THE 3 FILES.              03690007
037200*    BUILD THE DAILY RECEIPTS OUTPUT RECORD FROM THE FILE(S)      03700007
037300*    THAT HAVE THE SMALLEST KEY.                                  03710007
037400*                                                                 03720007
037500*    PERFORMED BY A100-MAIN-MODULE.                               03730007
037600***************************************************************   03740007
037700     IF  (PK-PLANNED-RECEIPTS-KEY = PK-STORE-EXTRACT-KEY )        03750099
037800     AND (PK-PLANNED-RECEIPTS-KEY = PK-DAILY-RECEIPTS-KEY )       03760099
037900         PERFORM C100-ALL-KEYS                                    03770007
038000     ELSE                                                         03780007
038100         IF  PK-PLANNED-RECEIPTS-KEY <                            03790099
038200                        PK-DAILY-RECEIPTS-KEY                     03800099
038300             IF  PK-PLANNED-RECEIPTS-KEY <                        03810099
038400                        PK-STORE-EXTRACT-KEY                      03820099
038500                 PERFORM C200-PLAN-KEY                            03830007
038600             ELSE                                                 03840007
038700                 IF  PK-STORE-EXTRACT-KEY  <                      03850099
038800                         PK-PLANNED-RECEIPTS-KEY                  03860007
038900                     PERFORM C300-EXTRACT-KEY                     03870007
039000                 ELSE                                             03880007
039100                     PERFORM C400-PLAN-EXTRACT-KEY                03890007
039200                 END-IF                                           03900007
039300             END-IF                                               03910007
039400         ELSE                                                     03920007
039500             IF  PK-DAILY-RECEIPTS-KEY  <                         03930099
039600                              PK-PLANNED-RECEIPTS-KEY             03940099
039700                 IF  PK-DAILY-RECEIPTS-KEY <                      03950099
039800                        PK-STORE-EXTRACT-KEY                      03960099
039900                     IF  (MP009I-MTD-RECEIPTS > ZERO              03970007
040000                      OR  MP009I-PLAN-RECEIPTS > ZERO)            03980007
040100                         PERFORM  C500-DAILY-KEY                  03990007
040200                     ELSE                                         04000007
040300                         PERFORM  Z200-READ-DAILY-RECEIPTS        04010007
040400                     END-IF                                       04020007
040500                 ELSE                                             04030007
040600                     IF  PK-STORE-EXTRACT-KEY <                   04040007
040700                             PK-DAILY-RECEIPTS-KEY                04050007
040800                         PERFORM C300-EXTRACT-KEY                 04060007
040900                     ELSE                                         04070007
041000                         PERFORM C600-DAILY-EXTRACT-KEY           04080007
041100                     END-IF                                       04090007
041200                 END-IF                                           04100007
041300             ELSE                                                 04110007
041400                 IF  PK-DAILY-RECEIPTS-KEY <                      04120099
041500                             PK-STORE-EXTRACT-KEY                 04130099
041600                     PERFORM C700-PLAN-DAILY-KEY                  04140007
041700                 ELSE                                             04150007
041800                     PERFORM C300-EXTRACT-KEY                     04160007
041900                 END-IF                                           04170007
042000             END-IF                                               04180007
042100         END-IF                                                   04190007
042200     END-IF.                                                      04200007
042300*                                                                 04210007
042400*                                                                 04220007
042500 C100-ALL-KEYS.                                                   04230007
042600***************************************************************   04240007
042700*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      04250007
042800*    THE PLANNED RECEIPTS RECORD, THE DAILY RECEIPTS INPUT        04260007
042900*    RECORD, AND THE STOREREC EXTRACT RECORD.                     04270007
043000*                                                                 04280007
043100*    PERFORMED BY B200-PROCESS-RECORDS.                           04290007
043200***************************************************************   04300007
043300     PERFORM Z550-EDIT-DEPT-DC.                                   04310007
043400                                                                  04320007
043500     IF  (DP010I-ERROR-DETECTED)                                  04330007
043600      OR (PS-DC-ERROR)                                            04340007
043700         IF  DP010I-ERROR-DETECTED                                04350007
043800             DISPLAY 'PLAN DEPT IS NOT NUMERIC'                   04360007
043900             DISPLAY 'DEPT ' MP010I-DEPT                          04370007
044000             DISPLAY ' '                                          04380007
044100         END-IF                                                   04390007
044200         IF  PS-DC-ERROR                                          04400007
044300             DISPLAY 'INVALID RECEIVING LOCATION'                 04410007
044400             DISPLAY 'DEPT     ' MP010I-DEPT                      04420007
044500             DISPLAY ' '                                          04430007
044600         END-IF                                                   04440007
044700     ELSE                                                         04450007
044800         MOVE DP010I-NUMERIC-FIELD                                04460007
044900                                 TO PH-DEPT                       04470007
045000         PERFORM Z500-READ-DEPT-DB                                04480007
045100         IF  PS-DEPT-FOUND                                        04490007
045200             PERFORM Z600-EDIT-RECEIPTS                           04500007
045300             IF  DP010I-ERROR-DETECTED                            04510007
045400                 DISPLAY 'PLANNED RECEIPTS NOT NUMERIC'           04520007
045500                 DISPLAY 'DEPT ' PH-DEPT                          04530007
045600                 DISPLAY ' '                                      04540007
045700                 MOVE MP009I-PLAN-RECEIPTS                        04550007
045800                                 TO MP009O-PLAN-RECEIPTS          04560007
045900                 MOVE MP009I-OPER-UNT-ID                          04570099
046000                                 TO MP009O-OPER-UNT-ID            04580099
046100                 MOVE MP009I-FCLTY-ID                             04590099
046200                                 TO MP009O-FCLTY-ID               04600099
046300             ELSE                                                 04610007
046400                 COMPUTE MP009O-PLAN-RECEIPTS =                   04620007
046500                     DP010I-NUMERIC-FIELD * 1000                  04630007
046600***              MOVE MP010I-RECEIVING-LOCATION                   04640007
046700                 MOVE 'DC'       TO MP009O-RECEIVING-LOCATION     04650007
046800                 MOVE +85        TO MP009O-OPER-UNT-ID            04660099
046900                 IF  (PS-NEW-MONTH)                               04670007
047000                  OR (PS-NEW-WEEK)                                04680007
047100                     INITIALIZE PS-WORK-SUB                       04690007
047200                     PERFORM D100-ZERO-RECEIPTS 7 TIMES           04700007
047300                     IF  PS-NEW-MONTH                             04710007
047400                         INITIALIZE MP009O-MTD-RECEIPTS           04720007
047500                     ELSE                                         04730007
047600                         MOVE MP009I-MTD-RECEIPTS                 04740007
047700                                 TO MP009O-MTD-RECEIPTS           04750007
047800                     END-IF                                       04760007
047900                 ELSE                                             04770007
048000                     INITIALIZE PS-WORK-SUB                       04780007
048100                     PERFORM D200-MOVE-RECEIPTS 7 TIMES           04790007
048200                     MOVE MP009I-MTD-RECEIPTS                     04800007
048300                                 TO MP009O-MTD-RECEIPTS           04810007
048400                 END-IF                                           04820007
048500                 MOVE SE-RETAIL-EXTENSION                         04830007
048600                   TO MP009O-DAY-RECEIPTS (PS-DAY-SUB)            04840007
048700                 ADD  SE-RETAIL-EXTENSION                         04850007
048800                                 TO MP009O-MTD-RECEIPTS           04860007
048900                 PERFORM Z700-WRITE-DAILY-RECEIPTS                04870007
049000             END-IF                                               04880007
049100         END-IF                                                   04890007
049200     END-IF.                                                      04900007
049300                                                                  04910007
049400     SET PS-INVALID-PLAN         TO TRUE.                         04920007
049500                                                                  04930007
049600     PERFORM Z100-READ-PLANNED-RECEIPTS                           04940007
049700       UNTIL (PS-VALID-PLAN)                                      04950007
049800          OR (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES).             04960007
049900                                                                  04970007
050000     PERFORM Z200-READ-DAILY-RECEIPTS.                            04980007
050100     PERFORM Z300-READ-STORE-EXTRACT.                             04990007
050200*                                                                 05000007
050300*                                                                 05010007
050400 C200-PLAN-KEY.                                                   05020007
050500***************************************************************   05030007
050600*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      05040007
050700*    THE PLANNED RECEIPTS RECORD.                                 05050007
050800*                                                                 05060007
050900*    PERFORMED BY B200-PROCESS-RECORDS.                           05070007
051000***************************************************************   05080007
051100     PERFORM Z550-EDIT-DEPT-DC.                                   05090007
051200                                                                  05100007
051300     IF  (DP010I-ERROR-DETECTED)                                  05110007
051400      OR (PS-DC-ERROR)                                            05120007
051500         IF  DP010I-ERROR-DETECTED                                05130007
051600             DISPLAY 'PLAN DEPT IS NOT NUMERIC'                   05140007
051700             DISPLAY 'DEPT ' MP010I-DEPT                          05150007
051800             DISPLAY ' '                                          05160007
051900         END-IF                                                   05170007
052000         IF  PS-DC-ERROR                                          05180007
052100             DISPLAY 'INVALID RECEIVING LOCATION'                 05190007
052200****         DISPLAY 'LOCATION ' MP010I-RECEIVING-LOCATION        05200007
052300             DISPLAY 'DEPT     ' MP010I-DEPT                      05210007
052400             DISPLAY ' '                                          05220007
052500         END-IF                                                   05230007
052600     ELSE                                                         05240007
052700         MOVE DP010I-NUMERIC-FIELD                                05250007
052800                                 TO PH-DEPT                       05260007
052900         PERFORM Z500-READ-DEPT-DB                                05270007
053000         IF  PS-DEPT-FOUND                                        05280007
053100             PERFORM Z600-EDIT-RECEIPTS                           05290007
053200             IF  DP010I-ERROR-DETECTED                            05300007
053300                 DISPLAY 'PLANNED RECEIPTS NOT NUMERIC'           05310007
053400                 DISPLAY 'DEPT ' PH-DEPT                          05320007
053500                 DISPLAY ' '                                      05330007
053600                 INITIALIZE MP009O-PLAN-RECEIPTS                  05340007
053700             ELSE                                                 05350007
053800                 COMPUTE MP009O-PLAN-RECEIPTS =                   05360007
053900                     DP010I-NUMERIC-FIELD * 1000                  05370007
054000***              MOVE MP010I-RECEIVING-LOCATION                   05380007
054100***                              TO MP009O-RECEIVING-LOCATION     05390007
054200                 MOVE 'DC'       TO MP009O-RECEIVING-LOCATION     05400007
054300                 MOVE +85        TO MP009O-OPER-UNT-ID            05410099
054400                 INITIALIZE PS-WORK-SUB                           05420007
054500                 PERFORM D100-ZERO-RECEIPTS 7 TIMES               05430007
054600                 INITIALIZE MP009O-MTD-RECEIPTS                   05440007
054700                 PERFORM Z700-WRITE-DAILY-RECEIPTS                05450007
054800             END-IF                                               05460007
054900         END-IF                                                   05470007
055000     END-IF.                                                      05480007
055100                                                                  05490007
055200     SET PS-INVALID-PLAN         TO TRUE.                         05500007
055300                                                                  05510007
055400     PERFORM Z100-READ-PLANNED-RECEIPTS                           05520007
055500       UNTIL (PS-VALID-PLAN)                                      05530007
055600          OR (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES).             05540007
055700*                                                                 05550007
055800*                                                                 05560007
055900 C300-EXTRACT-KEY.                                                05570007
056000***************************************************************   05580007
056100*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      05590007
056200*    THE STOREREC EXTRACT RECORD.                                 05600007
056300*                                                                 05610007
056400*    PERFORMED BY B200-PROCESS-RECORDS.                           05620007
056500***************************************************************   05630007
056600     MOVE SE-DEPT                TO PH-DEPT.                      05640007
056700     PERFORM Z500-READ-DEPT-DB.                                   05650007
056800                                                                  05660007
056900     IF  PS-DEPT-FOUND                                            05670007
057000         INITIALIZE MP009O-PLAN-RECEIPTS                          05680007
057100         MOVE SE-RECEIVING-LOCATION                               05690007
057200                                 TO MP009O-RECEIVING-LOCATION     05700007
057300         MOVE SE-OPER-UNT-ID     TO  MP009O-OPER-UNT-ID           05710099
057400         INITIALIZE PS-WORK-SUB                                   05720007
057500         PERFORM D100-ZERO-RECEIPTS 7 TIMES                       05730007
057600         INITIALIZE MP009O-MTD-RECEIPTS                           05740007
057700         MOVE SE-RETAIL-EXTENSION                                 05750007
057800           TO MP009O-DAY-RECEIPTS (PS-DAY-SUB)                    05760007
057900         ADD  SE-RETAIL-EXTENSION                                 05770007
058000                                 TO MP009O-MTD-RECEIPTS           05780007
058100         PERFORM Z700-WRITE-DAILY-RECEIPTS                        05790007
058200     END-IF.                                                      05800007
058300                                                                  05810007
058400     PERFORM Z300-READ-STORE-EXTRACT.                             05820007
058500*                                                                 05830007
058600*                                                                 05840007
058700 C400-PLAN-EXTRACT-KEY.                                           05850007
058800***************************************************************   05860007
058900*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      05870007
059000*    THE PLANNED RECEIPTS RECORD AND THE STOREREC EXTRACT RECORD. 05880007
059100*                                                                 05890007
059200*    PERFORMED BY B200-PROCESS-RECORDS.                           05900007
059300***************************************************************   05910007
059400     PERFORM Z550-EDIT-DEPT-DC.                                   05920007
059500                                                                  05930007
059600     IF  (DP010I-ERROR-DETECTED)                                  05940007
059700      OR (PS-DC-ERROR)                                            05950007
059800         IF  DP010I-ERROR-DETECTED                                05960007
059900             DISPLAY 'PLAN DEPT IS NOT NUMERIC'                   05970007
060000             DISPLAY 'DEPT ' MP010I-DEPT                          05980007
060100             DISPLAY ' '                                          05990007
060200         END-IF                                                   06000007
060300         IF  PS-DC-ERROR                                          06010007
060400             DISPLAY 'INVALID RECEIVING LOCATION'                 06020007
060500***          DISPLAY 'LOCATION ' MP010I-RECEIVING-LOCATION        06030007
060600             DISPLAY 'DEPT     ' MP010I-DEPT                      06040007
060700             DISPLAY ' '                                          06050007
060800         END-IF                                                   06060007
060900     ELSE                                                         06070007
061000         MOVE DP010I-NUMERIC-FIELD                                06080007
061100                                 TO PH-DEPT                       06090007
061200         PERFORM Z500-READ-DEPT-DB                                06100007
061300         IF  PS-DEPT-FOUND                                        06110007
061400             PERFORM Z600-EDIT-RECEIPTS                           06120007
061500             IF  DP010I-ERROR-DETECTED                            06130007
061600                 DISPLAY 'PLANNED RECEIPTS NOT NUMERIC'           06140007
061700                 DISPLAY 'DEPT ' PH-DEPT                          06150007
061800                 DISPLAY ' '                                      06160007
061900                 INITIALIZE MP009O-PLAN-RECEIPTS                  06170007
062000             ELSE                                                 06180007
062100                 COMPUTE MP009O-PLAN-RECEIPTS =                   06190007
062200                     DP010I-NUMERIC-FIELD * 1000                  06200007
062300***              MOVE MP010I-RECEIVING-LOCATION                   06210007
062400***                              TO MP009O-RECEIVING-LOCATION     06220007
062500                 MOVE 'DC'       TO MP009O-RECEIVING-LOCATION     06230007
062600                 MOVE +85        TO MP009O-OPER-UNT-ID            06240099
062700                 INITIALIZE PS-WORK-SUB                           06250007
062800                 PERFORM D100-ZERO-RECEIPTS 7 TIMES               06260007
062900                 INITIALIZE MP009O-MTD-RECEIPTS                   06270007
063000                 MOVE SE-RETAIL-EXTENSION                         06280007
063100                   TO MP009O-DAY-RECEIPTS (PS-DAY-SUB)            06290007
063200                 ADD  SE-RETAIL-EXTENSION                         06300007
063300                                 TO MP009O-MTD-RECEIPTS           06310007
063400                 PERFORM Z700-WRITE-DAILY-RECEIPTS                06320007
063500             END-IF                                               06330007
063600         END-IF                                                   06340007
063700     END-IF.                                                      06350007
063800                                                                  06360007
063900     SET PS-INVALID-PLAN         TO TRUE.                         06370007
064000     PERFORM Z100-READ-PLANNED-RECEIPTS                           06380007
064100       UNTIL (PS-VALID-PLAN)                                      06390007
064200          OR (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES).             06400007
064300     PERFORM Z300-READ-STORE-EXTRACT.                             06410007
064400*                                                                 06420007
064500*                                                                 06430007
064600 C500-DAILY-KEY.                                                  06440007
064700***************************************************************   06450007
064800*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      06460007
064900*    THE DAILY RECEIPTS INPUT RECORD.                             06470007
065000*                                                                 06480007
065100*    PERFORMED BY B200-PROCESS-RECORDS.                           06490007
065200***************************************************************   06500007
065300     MOVE MP009I-DEPT            TO PH-DEPT.                      06510007
065400     PERFORM Z500-READ-DEPT-DB.                                   06520007
065500                                                                  06530007
065600     IF  PS-DEPT-FOUND                                            06540007
065700         MOVE MP009I-PLAN-RECEIPTS                                06550007
065800                                 TO MP009O-PLAN-RECEIPTS          06560007
065900         MOVE MP009I-RECEIVING-LOCATION                           06570007
066000                                 TO MP009O-RECEIVING-LOCATION     06580007
066100         MOVE MP009I-OPER-UNT-ID                                  06590099
066200                                 TO MP009O-OPER-UNT-ID            06600099
066300         IF  (PS-NEW-MONTH)                                       06610007
066400          OR (PS-NEW-WEEK)                                        06620007
066500             INITIALIZE PS-WORK-SUB                               06630007
066600             PERFORM D100-ZERO-RECEIPTS 7 TIMES                   06640007
066700             IF  PS-NEW-MONTH                                     06650007
066800                 INITIALIZE MP009O-MTD-RECEIPTS                   06660007
066900             ELSE                                                 06670007
067000                 MOVE MP009I-MTD-RECEIPTS                         06680007
067100                                 TO MP009O-MTD-RECEIPTS           06690007
067200             END-IF                                               06700007
067300         ELSE                                                     06710007
067400             INITIALIZE PS-WORK-SUB                               06720007
067500             PERFORM D200-MOVE-RECEIPTS 7 TIMES                   06730007
067600             MOVE MP009I-MTD-RECEIPTS                             06740007
067700                                 TO MP009O-MTD-RECEIPTS           06750007
067800         END-IF                                                   06760007
067900         PERFORM Z700-WRITE-DAILY-RECEIPTS                        06770007
068000     END-IF.                                                      06780007
068100                                                                  06790007
068200     PERFORM Z200-READ-DAILY-RECEIPTS.                            06800007
068300*                                                                 06810007
068400*                                                                 06820007
068500 C600-DAILY-EXTRACT-KEY.                                          06830007
068600***************************************************************   06840007
068700*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      06850007
068800*    THE DAILY RECEIPTS INPUT RECORD THE STOREREC EXTRACT RECORD. 06860007
068900*                                                                 06870007
069000*    PERFORMED BY B200-PROCESS-RECORDS.                           06880007
069100***************************************************************   06890007
069200     MOVE SE-DEPT                TO PH-DEPT.                      06900007
069300     PERFORM Z500-READ-DEPT-DB.                                   06910007
069400                                                                  06920007
069500     IF  PS-DEPT-FOUND                                            06930007
069600         MOVE MP009I-PLAN-RECEIPTS                                06940007
069700                                 TO MP009O-PLAN-RECEIPTS          06950007
069800         MOVE SE-RECEIVING-LOCATION                               06960007
069900                                 TO MP009O-RECEIVING-LOCATION     06970007
070000         IF  (PS-NEW-MONTH)                                       06980007
070100          OR (PS-NEW-WEEK)                                        06990007
070200             INITIALIZE PS-WORK-SUB                               07000007
070300             PERFORM D100-ZERO-RECEIPTS 7 TIMES                   07010007
070400             IF  PS-NEW-MONTH                                     07020007
070500                 INITIALIZE MP009O-MTD-RECEIPTS                   07030007
070600             ELSE                                                 07040007
070700                 MOVE MP009I-MTD-RECEIPTS                         07050007
070800                                 TO MP009O-MTD-RECEIPTS           07060007
070900             END-IF                                               07070007
071000         ELSE                                                     07080007
071100             INITIALIZE PS-WORK-SUB                               07090007
071200             PERFORM D200-MOVE-RECEIPTS 7 TIMES                   07100007
071300             MOVE MP009I-MTD-RECEIPTS                             07110007
071400                                 TO MP009O-MTD-RECEIPTS           07120007
071500         END-IF                                                   07130007
071600         MOVE SE-RETAIL-EXTENSION                                 07140007
071700           TO MP009O-DAY-RECEIPTS (PS-DAY-SUB)                    07150007
071800         ADD  SE-RETAIL-EXTENSION                                 07160007
071900                                 TO MP009O-MTD-RECEIPTS           07170007
072000         PERFORM Z700-WRITE-DAILY-RECEIPTS                        07180007
072100     END-IF.                                                      07190007
072200                                                                  07200007
072300     PERFORM Z200-READ-DAILY-RECEIPTS.                            07210007
072400     PERFORM Z300-READ-STORE-EXTRACT.                             07220007
072500*                                                                 07230007
072600*                                                                 07240007
072700 C700-PLAN-DAILY-KEY.                                             07250007
072800***************************************************************   07260007
072900*    CREATE THE DAILY RECEIPTS OUTPUT RECORD USING DATA FROM      07270007
073000*    THE PLANNED RECEIPTS RECORD AND THE DAILY RECEIPTS INPUT     07280007
073100*    RECORD.                                                      07290007
073200*                                                                 07300007
073300*    PERFORMED BY B200-PROCESS-RECORDS.                           07310007
073400***************************************************************   07320007
073500     PERFORM Z550-EDIT-DEPT-DC.                                   07330007
073600                                                                  07340007
073700     IF  (DP010I-ERROR-DETECTED)                                  07350007
073800      OR (PS-DC-ERROR)                                            07360007
073900         IF  DP010I-ERROR-DETECTED                                07370007
074000             DISPLAY 'PLAN DEPT IS NOT NUMERIC'                   07380007
074100             DISPLAY 'DEPT ' MP010I-DEPT                          07390007
074200             DISPLAY ' '                                          07400007
074300         END-IF                                                   07410007
074400         IF  PS-DC-ERROR                                          07420007
074500             DISPLAY 'INVALID RECEIVING LOCATION'                 07430007
074600***          DISPLAY 'LOCATION ' MP010I-RECEIVING-LOCATION        07440007
074700             DISPLAY 'DEPT     ' MP010I-DEPT                      07450007
074800             DISPLAY ' '                                          07460007
074900         END-IF                                                   07470007
075000     ELSE                                                         07480007
075100         MOVE DP010I-NUMERIC-FIELD                                07490007
075200                                 TO PH-DEPT                       07500007
075300         PERFORM Z500-READ-DEPT-DB                                07510007
075400         IF  PS-DEPT-FOUND                                        07520007
075500             PERFORM Z600-EDIT-RECEIPTS                           07530007
075600             IF  DP010I-ERROR-DETECTED                            07540007
075700                 DISPLAY 'PLANNED RECEIPTS NOT NUMERIC'           07550007
075800                 DISPLAY 'DEPT ' PH-DEPT                          07560007
075900                 DISPLAY ' '                                      07570007
076000                 MOVE MP009I-PLAN-RECEIPTS                        07580007
076100                                 TO MP009O-PLAN-RECEIPTS          07590007
076200             ELSE                                                 07600007
076300                 COMPUTE MP009O-PLAN-RECEIPTS =                   07610007
076400                     DP010I-NUMERIC-FIELD * 1000                  07620007
076500***              MOVE MP010I-RECEIVING-LOCATION                   07630007
076600***                              TO MP009O-RECEIVING-LOCATION     07640007
076700                 MOVE 'DC'       TO MP009O-RECEIVING-LOCATION     07650007
076800                 IF  (PS-NEW-MONTH)                               07660007
076900                  OR (PS-NEW-WEEK)                                07670007
077000                     INITIALIZE PS-WORK-SUB                       07680007
077100                     PERFORM D100-ZERO-RECEIPTS 7 TIMES           07690007
077200                     IF  PS-NEW-MONTH                             07700007
077300                         INITIALIZE MP009O-MTD-RECEIPTS           07710007
077400                     ELSE                                         07720007
077500                         MOVE MP009I-MTD-RECEIPTS                 07730007
077600                                 TO MP009O-MTD-RECEIPTS           07740007
077700                     END-IF                                       07750007
077800                 ELSE                                             07760007
077900                     INITIALIZE PS-WORK-SUB                       07770007
078000                     PERFORM D200-MOVE-RECEIPTS 7 TIMES           07780007
078100****                 MOVE MP009I-OPER-UNT-ID                      07790099
078200****                             TO MP009O-OPER-UNT-ID            07800099
078300                     MOVE MP009I-MTD-RECEIPTS                     07810007
078400                                 TO MP009O-MTD-RECEIPTS           07820007
078500                 END-IF                                           07830007
078600                     MOVE MP009I-OPER-UNT-ID                      07840099
078700                                 TO MP009O-OPER-UNT-ID            07850099
078800                 PERFORM Z700-WRITE-DAILY-RECEIPTS                07860007
078900             END-IF                                               07870007
079000         END-IF                                                   07880007
079100     END-IF.                                                      07890007
079200                                                                  07900007
079300     SET PS-INVALID-PLAN         TO TRUE.                         07910007
079400                                                                  07920007
079500     PERFORM Z100-READ-PLANNED-RECEIPTS                           07930007
079600       UNTIL (PS-VALID-PLAN)                                      07940007
079700          OR (PK-PLANNED-RECEIPTS-KEY = HIGH-VALUES).             07950007
079800                                                                  07960007
079900     PERFORM Z200-READ-DAILY-RECEIPTS.                            07970007
080000*                                                                 07980099
080100*                                                                 07990007
080200 D100-ZERO-RECEIPTS.                                              08000007
080300***************************************************************   08010007
080400*    ZERO OUT THE RECEIPTS FOR MONDAY THRU FRIDAY ON THE          08020007
080500*    DAILY RECEIPTS OUTPUT FILE.                                  08030007
080600*                                                                 08040007
080700*    PERFORMED BY C100-ALL-KEYS.                                  08050007
080800*    PERFORMED BY C200-PLAN-KEY.                                  08060007
080900*    PERFORMED BY C300-EXTRACT-KEY.                               08070007
081000*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          08080007
081100*    PERFORMED BY C500-DAILY-KEY.                                 08090007
081200*    PERFORMED BY C600-DAILY-EXTRACT-KEY.                         08100007
081300*    PERFORMED BY C700-PLAN-DAILY-KEY.                            08110007
081400***************************************************************   08120007
081500     ADD 1                       TO PS-WORK-SUB.                  08130007
081600                                                                  08140007
081700     INITIALIZE MP009O-DAY-RECEIPTS (PS-WORK-SUB).                08150007
081800*                                                                 08160007
081900*                                                                 08170007
082000 D200-MOVE-RECEIPTS.                                              08180007
082100***************************************************************   08190007
082200*    MOVE THE RECEIPTS FOR MONDAY THRU FRIDAY FROM THE            08200007
082300*    DAILY RECEIPTS INPUT FILE TO THE DAILY RECEIPTS OUTPUT       08210007
082400*    FILE.                                                        08220007
082500*                                                                 08230007
082600*    PERFORMED BY C100-ALL-KEYS.                                  08240007
082700*    PERFORMED BY C500-DAILY-KEY.                                 08250007
082800*    PERFORMED BY C600-DAILY-EXTRACT-KEY.                         08260007
082900*    PERFORMED BY C700-PLAN-DAILY-KEY.                            08270007
083000***************************************************************   08280007
083100     ADD 1                       TO PS-WORK-SUB.                  08290007
083200                                                                  08300007
083300     MOVE MP009I-DAY-RECEIPTS (PS-WORK-SUB)                       08310007
083400       TO MP009O-DAY-RECEIPTS (PS-WORK-SUB).                      08320007
083500*                                                                 08330007
083600*                                                                 08340007
083700 Z100-READ-PLANNED-RECEIPTS.                                      08350007
083800***************************************************************   08360007
083900*    READ THE PLANNED RECEIPTS FILE.                              08370007
084000*    WHEN WE REACH THE END OF FILE, FILL IN THE RECEIPT KEY       08380007
084100*    WITH HIGH VALUES.  IF A RECORD IS FOUND, FILL IN THE         08390007
084200*    RECEIPT KEY WITH THE DEPT AND RECEIVING LOCATION FROM        08400007
084300*    THE RECEIPT RECORD.                                          08410007
084400*    MAKE SURE THE KEY FROM THIS RECORD IS NOT THE SAME AS        08420007
084500*    THE KEY FROM THE PREVIOUS PLANNED RECEIPT RECORD.            08430007
084600*                                                                 08440007
084700*    PERFORMED BY A100-MAIN-MODULE.                               08450007
084800*    PERFORMED BY C100-ALL-KEYS.                                  08460007
084900*    PERFORMED BY C200-PLAN-KEY.                                  08470007
085000*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          08480007
085100*    PERFORMED BY C700-PLAN-DAILY-KEY.                            08490007
085200***************************************************************   08500007
085300     READ PLANNED-RECEIPTS-FILE                                   08510007
085400       INTO MP010I-PLANNED-RECEIPTS                               08520007
085500         AT END SET PS-PLANNED-RECEIPTS-EOF                       08530007
085600                                 TO TRUE.                         08540007
085700                                                                  08550007
085800     IF  PS-PLANNED-RECEIPTS-EOF                                  08560007
085900         MOVE HIGH-VALUES        TO PK-PLANNED-RECEIPTS-KEY       08570007
086000     ELSE                                                         08580007
086100         MOVE MP010I-DEPT        TO PK-PLANNED-RECEIPTS-DEPT      08590007
086200**       MOVE 'DC'                                                08600007
086300**                               TO PK-PLANNED-RECEIPTS-DC        08610007
086400**       MOVE +85                TO PK-PLANNED-OPER-UNIT-ID       08620099
086500***      MOVE MP010I-RECEIVING-LOCATION                           08630007
086600***                              TO PK-PLANNED-RECEIPTS-DC        08640007
086700         MOVE 'DC'               TO MP009O-RECEIVING-LOCATION     08650099
086800     END-IF.                                                      08660007
086900                                                                  08670007
087000     IF  (MP010I-DEPT               NOT = PH-PREVIOUS-DEPT)       08680007
087100***   OR (MP010I-RECEIVING-LOCATION NOT = PH-PREVIOUS-DC)         08690007
087200         SET PS-VALID-PLAN       TO TRUE                          08700007
087300         MOVE MP010I-DEPT        TO PH-PREVIOUS-DEPT              08710007
087400***      MOVE MP010I-RECEIVING-LOCATION                           08720007
087500***                              TO PH-PREVIOUS-DC                08730007
087600     END-IF.                                                      08740007
087700*                                                                 08750007
087800*                                                                 08760007
087900 Z200-READ-DAILY-RECEIPTS.                                        08770007
088000***************************************************************   08780007
088100*    READ THE DAILY RECEIPTS FILE.                                08790007
088200*    WHEN WE REACH THE END OF FILE, FILL IN THE RECEIPT KEY       08800007
088300*    WITH HIGH VALUES.  IF A RECORD IS FOUND, FILL IN THE         08810007
088400*    RECEIPT KEY WITH THE DEPT AND RECEIVING LOCATION FROM        08820007
088500*    THE RECEIPT RECORD.                                          08830007
088600*                                                                 08840007
088700*    PERFORMED BY A100-MAIN-MODULE.                               08850007
088800*    PERFORMED BY C100-ALL-KEYS.                                  08860007
088900*    PERFORMED BY C500-DAILY-KEY.                                 08870007
089000*    PERFORMED BY C600-DAILY-EXTRACT-KEY.                         08880007
089100*    PERFORMED BY C700-PLAN-DAILY-KEY.                            08890007
089200***************************************************************   08900007
089300     READ DAILY-RECEIPTS-IN-FILE                                  08910007
089400       INTO MP009I-DAILY-RECEIPTS                                 08920007
089500         AT END SET PS-DAILY-RECEIPTS-EOF                         08930007
089600                                 TO TRUE.                         08940007
089700                                                                  08950007
089800     IF  PS-DAILY-RECEIPTS-EOF                                    08960007
089900         MOVE HIGH-VALUES        TO PK-DAILY-RECEIPTS-KEY         08970007
090000     ELSE                                                         08980007
090100         MOVE MP009I-DEPT        TO PK-DAILY-RECEIPTS-DEPT        08990007
090200         MOVE MP009I-RECEIVING-LOCATION                           09000007
090300                                 TO PK-DAILY-RECEIPTS-DC          09010007
090400                                    MP009O-RECEIVING-LOCATION     09020007
090500         MOVE MP009I-FCLTY-ID                                     09030099
090600                            TO  MP009O-FCLTY-ID                   09040099
090700                                                                  09050099
090800       IF MP009I-RECEIVING-LOCATION = 'DC'                        09060099
090900         MOVE MP009I-OPER-UNT-ID                                  09070099
091000                            TO  MP009O-OPER-UNT-ID                09080099
091100                                PK-DAILY-OPER-UNIT-ID             09090099
091200       ELSE                                                       09100099
091300         MOVE +90                                                 09110099
091400                            TO  MP009O-OPER-UNT-ID                09120099
091500                                PK-DAILY-OPER-UNIT-ID             09130099
091600       END-IF                                                     09140099
091700     END-IF.                                                      09150007
091800*                                                                 09160007
091900*                                                                 09170007
092000 Z300-READ-STORE-EXTRACT.                                         09180007
092100***************************************************************   09190007
092200*    READ THE STOREREC EXTRACT FILE.                              09200007
092300*    WHEN WE REACH THE END OF FILE, FILL IN THE EXTRACT KEY       09210007
092400*    WITH HIGH VALUES.  IF A RECORD IS FOUND, FILL IN THE         09220007
092500*    EXTRACT KEY WITH THE DEPT AND RECEIVING LOCATION FROM        09230007
092600*    THE EXTRACT RECORD.                                          09240007
092700*                                                                 09250007
092800*    PERFORMED BY A100-MAIN-MODULE.                               09260007
092900*    PERFORMED BY C100-ALL-KEYS.                                  09270007
093000*    PERFORMED BY C300-EXTRACT-KEY.                               09280007
093100*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          09290007
093200*    PERFORMED BY C600-DAILY-EXTRACT-KEY.                         09300007
093300***************************************************************   09310007
093400                                                                  09320007
093500     READ STORE-EXTRACT-FILE                                      09330007
093600       INTO STORE-EXTRACT-LINE                                    09340099
093700         AT END SET PS-STORE-EXTRACT-EOF                          09350007
093800                                 TO TRUE.                         09360007
093900                                                                  09370007
094000     IF  PS-STORE-EXTRACT-EOF                                     09380007
094100         MOVE HIGH-VALUES        TO PK-STORE-EXTRACT-KEY          09390007
094200     ELSE                                                         09400007
094300         MOVE SE-DEPT            TO  PK-STORE-EXTRACT-DEPT        09410007
094400         MOVE SE-FCLTY-ID        TO  MP009O-FCLTY-ID              09420099
094600         MOVE SE-RECEIVING-LOCATION                               09430007
094700                                 TO PK-STORE-EXTRACT-DC           09440007
094800                                    MP009O-RECEIVING-LOCATION     09450007
094900      IF SE-RECEIVING-LOCATION = 'DC'                             09460099
095000         MOVE SE-OPER-UNT-ID     TO  MP009O-OPER-UNT-ID           09470099
095100                                    PK-STORE-OPER-UNIT-ID         09480099
095200      ELSE                                                        09490099
095300         MOVE +90                TO  MP009O-OPER-UNT-ID           09500099
095400                                    PK-STORE-OPER-UNIT-ID         09510099
095500      END-IF                                                      09520099
095600     END-IF.                                                      09530007
095700*                                                                 09540007
095800*                                                                 09550007
095900 Z500-READ-DEPT-DB.                                               09560007
096000***************************************************************   09570007
096100     MOVE 'Z500-READ-DEPT-DB     ' TO   PV-PARAGRAPH-NAME.        09580004
096200/                                                                 09590004
096300******************************************************************09600004
096400*  GET THE BUYER NAME AND NUMBER INFORMATION FROM THE MBS TABLES  09610004
096500*  USING SUBROUTINE 'DPKUT039'.                                   09620004
096600******************************************************************09630004
096700     INITIALIZE DP003-INPUT-FIELDS.                               09640099
096800                                                                  09650099
096900     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      09660004
097000     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       09670004
097100     MOVE TD-TODAYS-DATE               TO DP003-CURRENT-DATE      09680004
097200                                          DP003-EFF-DATE.         09690004
097300*                                                                 09700004
097400     MOVE PH-DEPT                      TO DP003-DPT-INPUT         09710099
097500                                          MP009O-DEPT.            09720099
097600                                                                  09730099
097700***  MOVE MP009I-DIVISION              TO MP009O-DIVISION.        09740099
097800******************************************************************09750004
097900**** LOOK UP GMM NUMBER FROM DEPT NUMBER                          09760004
098000******************************************************************09770004
098100*                                                                 09780004
098200     SET DP003-GMM-LOOKUP-NMBR         TO TRUE.                   09790004
098300     MOVE ZERO             TO MP009O-GMM                          09800099
098400*                                                                 09810004
098500     CALL PC-MBS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.09820004
098600*                                                                 09830099
098700     EVALUATE TRUE                                                09840099
098800        WHEN DP003-SUCCESSFUL                                     09850099
098900           MOVE DP003-GMM-NMBR   TO MP009O-GMM                    09860099
099000        WHEN DP003-GMM-NMBR-NOT-FOUND                             09870099
099100           MOVE ZERO             TO MP009O-GMM                    09880099
099200        WHEN DP003-GMM-NMBR-DB2-ERROR                             09890099
099300           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          09900099
099400           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         09910099
099500                                 TO PV-ABEND-STRUCTURE-2          09920099
099600           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          09930099
099700***        PERFORM 9200-ABEND                                     09940099
099800        WHEN DP003-DMM-NMBR-MAX-RETRIES                           09950099
099900           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          09960099
100000           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         09970099
100100                                 TO PV-ABEND-STRUCTURE-2          09980099
100200           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          09990099
100300***        PERFORM 9200-ABEND                                     10000099
100400        WHEN DP003-NO-INPUT-SELECTION                             10010099
100500           MOVE 'CURRENT INPUT FIELDS ARE: '                      10020099
100600                                 TO PV-ERROR-MESSAGE-1            10030099
100700           MOVE DP003-INPUT-FIELDS                                10040099
100800                                 TO PV-ERROR-MESSAGE-2            10050099
                 MOVE DP003-SQLCA      TO SQLCA                         10060099
100900           PERFORM 9200-ABEND                                     10070004
101000        WHEN DP003-SYSTEM-CODE-ERROR                              10080004
101100           MOVE 'THE SYSTEM CODE IS: '                            10090004
101200                                 TO PV-ERROR-MESSAGE-1            10100004
101300           MOVE DP003-SYSTEM-CODE                                 10110004
101400                                 TO PV-ERROR-MESSAGE-2            10120004
101500           PERFORM 9200-ABEND                                     10130004
101600        WHEN DP003-CURRENT-DATE-ERROR                             10140004
101700           MOVE 'THE CURRENT DATE USED IS:'                       10150004
101800                                 TO PV-ERROR-MESSAGE-1            10160004
101900           MOVE DP003-CURRENT-DATE                                10170004
102000                                 TO PV-ERROR-MESSAGE-2            10180004
102100           PERFORM 9200-ABEND                                     10190004
102200        WHEN DP003-EFF-DATE-ERROR                                 10200004
102300           MOVE 'THE EFFECTIVE DATE USED IS:'                     10210004
102400                                 TO PV-ERROR-MESSAGE-1            10220004
102500           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            10230004
102600           PERFORM 9200-ABEND                                     10240004
102700        WHEN DP003-DPT-MUST-BE-NUMERIC                            10250004
102800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10260004
102900                                 TO PV-ERROR-MESSAGE-1            10270004
103000           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            10280004
103100           PERFORM 9200-ABEND                                     10290004
103200        WHEN OTHER                                                10300004
103300           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '10310004
103400                                 TO PV-ERROR-MESSAGE-1            10320004
103500           MOVE DP003-INPUT-FIELDS                                10330004
103600                                 TO PV-ERROR-MESSAGE-2            10340004
103700***        PERFORM 9200-ABEND                                     10350004
103800     END-EVALUATE.                                                10360004
103900******************************************************************10370004
104000**** LOOK UP DMM NUMBER FROM DEPT NUMBER                          10380004
104100******************************************************************10390004
104200     SET DP003-DMM-LOOKUP-NMBR         TO TRUE.                   10400004
104300     MOVE ZERO             TO MP009O-DIVISION                     10410099
104400*                                                                 10420004
104500     CALL PC-MBS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.10430004
104600*                                                                 10440099
104700     EVALUATE TRUE                                                10450099
104800        WHEN DP003-SUCCESSFUL                                     10460099
104900           MOVE DP003-DMM-NMBR   TO MP009O-DIVISION               10470099
105000        WHEN DP003-DMM-NMBR-NOT-FOUND                             10480099
105100           MOVE ZERO             TO MP009O-DIVISION               10490099
105200        WHEN DP003-GMM-NMBR-DB2-ERROR                             10500099
105300           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          10510099
105400           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10520099
105500                                 TO PV-ABEND-STRUCTURE-2          10530099
105600           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          10540099
105700***        PERFORM 9200-ABEND                                     10550099
105800        WHEN DP003-DMM-NMBR-MAX-RETRIES                           10560099
105900           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          10570099
106000           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10580099
106100                                 TO PV-ABEND-STRUCTURE-2          10590099
106200           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          10600099
106300***        PERFORM 9200-ABEND                                     10610099
106400        WHEN DP003-NO-INPUT-SELECTION                             10620099
106500           MOVE 'CURRENT INPUT FIELDS ARE: '                      10630099
106600                                 TO PV-ERROR-MESSAGE-1            10640099
106700           MOVE DP003-INPUT-FIELDS                                10650099
106800                                 TO PV-ERROR-MESSAGE-2            10660099
106900           PERFORM 9200-ABEND                                     10670004
107000        WHEN DP003-SYSTEM-CODE-ERROR                              10680004
107100           MOVE 'THE SYSTEM CODE IS: '                            10690004
107200                                 TO PV-ERROR-MESSAGE-1            10700004
107300           MOVE DP003-SYSTEM-CODE                                 10710004
107400                                 TO PV-ERROR-MESSAGE-2            10720004
107500           PERFORM 9200-ABEND                                     10730004
107600        WHEN DP003-CURRENT-DATE-ERROR                             10740004
107700           MOVE 'THE CURRENT DATE USED IS:'                       10750004
107800                                 TO PV-ERROR-MESSAGE-1            10760004
107900           MOVE DP003-CURRENT-DATE                                10770004
108000                                 TO PV-ERROR-MESSAGE-2            10780004
108100           PERFORM 9200-ABEND                                     10790004
108200        WHEN DP003-EFF-DATE-ERROR                                 10800004
108300           MOVE 'THE EFFECTIVE DATE USED IS:'                     10810004
108400                                 TO PV-ERROR-MESSAGE-1            10820004
108500           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            10830004
108600           PERFORM 9200-ABEND                                     10840004
108700        WHEN DP003-DPT-MUST-BE-NUMERIC                            10850004
108800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10860004
108900                                 TO PV-ERROR-MESSAGE-1            10870004
109000           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            10880004
109100           PERFORM 9200-ABEND                                     10890004
109200        WHEN OTHER                                                10900004
109300           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '10910004
109400                                 TO PV-ERROR-MESSAGE-1            10920004
109500           MOVE DP003-INPUT-FIELDS                                10930004
109600                                 TO PV-ERROR-MESSAGE-2            10940004
109700***        PERFORM 9200-ABEND                                     10950004
109800     END-EVALUATE.                                                10960004
109900******************************************************************10970004
110000**** LOOK UP BUYER NUMBER FROM DEPT NUMBER.                       10980099
110100******************************************************************10990004
110200                                                                  11000099
110300     INITIALIZE DP003-INPUT-FIELDS.                               11010099
110400                                                                  11020099
110500     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      11030004
110600     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       11040004
110700     MOVE TD-TODAYS-DATE               TO DP003-CURRENT-DATE      11050004
110800                                          DP003-EFF-DATE.         11060004
110900     MOVE PH-DEPT                      TO DP003-DPT-INPUT         11070099
111000     SET DP003-BYR-LOOKUP-NMBR         TO TRUE.                   11080004
111100     MOVE ZERO             TO MP009O-BUYER                        11090099
111200*                                                                 11100004
111300     CALL PC-MBS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.11110004
111400*                                                                 11120004
111500     EVALUATE TRUE                                                11130004
111600        WHEN DP003-SUCCESSFUL                                     11140004
111700           MOVE DP003-BYR-NMBR   TO MP009O-BUYER                  11150007
111800        WHEN DP003-BYR-NMBR-NOT-FOUND                             11160004
111900           MOVE ZERO             TO MP009O-BUYER                  11170099
112000        WHEN DP003-BYR-NMBR-DB2-ERROR                             11180004
112100           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          11190004
112200           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         11200004
112300                                 TO PV-ABEND-STRUCTURE-2          11210004
112400           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          11220004
112500           PERFORM 9200-ABEND                                     11230099
112600        WHEN DP003-BYR-NMBR-MAX-RETRIES                           11240004
112700           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          11250004
112800           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         11260004
112900                                 TO PV-ABEND-STRUCTURE-2          11270004
113000           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          11280004
113100           PERFORM 9200-ABEND                                     11290099
113200        WHEN DP003-NO-INPUT-SELECTION                             11300004
113300           MOVE 'CURRENT INPUT FIELDS ARE: '                      11310004
113400                                 TO PV-ERROR-MESSAGE-1            11320004
113500           MOVE DP003-INPUT-FIELDS                                11330004
113600                                 TO PV-ERROR-MESSAGE-2            11340004
113700           PERFORM 9200-ABEND                                     11350004
113800        WHEN DP003-SYSTEM-CODE-ERROR                              11360004
113900           MOVE 'THE SYSTEM CODE IS: '                            11370004
114000                                 TO PV-ERROR-MESSAGE-1            11380004
114100           MOVE DP003-SYSTEM-CODE                                 11390004
114200                                 TO PV-ERROR-MESSAGE-2            11400004
114300           PERFORM 9200-ABEND                                     11410004
114400        WHEN DP003-CURRENT-DATE-ERROR                             11420004
114500           MOVE 'THE CURRENT DATE USED IS:'                       11430004
114600                                 TO PV-ERROR-MESSAGE-1            11440004
114700           MOVE DP003-CURRENT-DATE                                11450004
114800                                 TO PV-ERROR-MESSAGE-2            11460004
114900           PERFORM 9200-ABEND                                     11470004
115000        WHEN DP003-EFF-DATE-ERROR                                 11480004
115100           MOVE 'THE EFFECTIVE DATE USED IS:'                     11490004
115200                                 TO PV-ERROR-MESSAGE-1            11500004
115300           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            11510004
115400           PERFORM 9200-ABEND                                     11520004
115500        WHEN DP003-DPT-MUST-BE-NUMERIC                            11530004
115600           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         11540004
115700                                 TO PV-ERROR-MESSAGE-1            11550004
115800           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            11560004
115900           PERFORM 9200-ABEND                                     11570004
116000        WHEN OTHER                                                11580004
116100           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '11590004
116200                                 TO PV-ERROR-MESSAGE-1            11600004
116300           MOVE DP003-INPUT-FIELDS                                11610004
116400                                 TO PV-ERROR-MESSAGE-2            11620004
116500***        PERFORM 9200-ABEND                                     11630004
116600     END-EVALUATE.                                                11640004
116700******************************************************************11650004
116800**** LOOK UP DEPT DESCRIPTION FROM DEPT NUMBER.                   11660004
116900******************************************************************11670004
117000                                                                  11680099
117100     INITIALIZE DP003-INPUT-FIELDS.                               11690099
117200                                                                  11700099
117300     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      11710004
117400     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       11720004
117500     MOVE TD-TODAYS-DATE               TO DP003-CURRENT-DATE      11730004
117600                                          DP003-EFF-DATE.         11740004
117700     MOVE PH-DEPT                      TO DP003-DPT-INPUT         11750099
117800     SET DP003-DPT-LOOKUP              TO TRUE.                   11760004
117900     MOVE SPACES                       TO MP009O-DEPT-DESC.       11770099
118000     SET PS-DEPT-NOT-FOUND             TO TRUE                    11780099
118100*                                                                 11790004
118200     CALL PC-MBS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.11800004
118300*                                                                 11810004
118400     EVALUATE TRUE                                                11820004
118500        WHEN DP003-SUCCESSFUL                                     11830004
118600           MOVE DP003-DPT-DESCRIPTION TO                          11840099
118700                                    MP009O-DEPT-DESC              11850099
118800           SET PS-DEPT-FOUND             TO TRUE                  11860099
118900        WHEN DP003-MCL-NOT-FOUND                                  11870099
119000           MOVE SPACES           TO MP009O-DEPT-DESC              11880099
119100        WHEN DP003-MCL-DB2-ERROR                                  11890099
119200           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          11900004
119300           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         11910004
119400                                 TO PV-ABEND-STRUCTURE-2          11920004
119500           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          11930004
119600           PERFORM 9200-ABEND                                     11940099
119700        WHEN DP003-MCL-MAX-RETRIES                                11950099
119800           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          11960004
119900           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         11970004
120000                                 TO PV-ABEND-STRUCTURE-2          11980004
120100           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          11990004
120200           PERFORM 9200-ABEND                                     12000099
120300        WHEN DP003-NO-INPUT-SELECTION                             12010004
120400           MOVE 'CURRENT INPUT FIELDS ARE: '                      12020004
120500                                 TO PV-ERROR-MESSAGE-1            12030004
120600           MOVE DP003-INPUT-FIELDS                                12040004
120700                                 TO PV-ERROR-MESSAGE-2            12050004
120800           PERFORM 9200-ABEND                                     12060004
120900        WHEN DP003-SYSTEM-CODE-ERROR                              12070004
121000           MOVE 'THE SYSTEM CODE IS: '                            12080004
121100                                 TO PV-ERROR-MESSAGE-1            12090004
121200           MOVE DP003-SYSTEM-CODE                                 12100004
121300                                 TO PV-ERROR-MESSAGE-2            12110004
121400           PERFORM 9200-ABEND                                     12120004
121500        WHEN DP003-CURRENT-DATE-ERROR                             12130004
121600           MOVE 'THE CURRENT DATE USED IS:'                       12140004
121700                                 TO PV-ERROR-MESSAGE-1            12150004
121800           MOVE DP003-CURRENT-DATE                                12160004
121900                                 TO PV-ERROR-MESSAGE-2            12170004
122000           PERFORM 9200-ABEND                                     12180004
122100        WHEN DP003-EFF-DATE-ERROR                                 12190004
122200           MOVE 'THE EFFECTIVE DATE USED IS:'                     12200004
122300                                 TO PV-ERROR-MESSAGE-1            12210004
122400           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            12220004
122500           PERFORM 9200-ABEND                                     12230004
122600        WHEN DP003-DPT-MUST-BE-NUMERIC                            12240004
122700           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         12250004
122800                                 TO PV-ERROR-MESSAGE-1            12260004
122900           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            12270004
123000           PERFORM 9200-ABEND                                     12280004
123100        WHEN OTHER                                                12290004
123200           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '12300004
123300                                 TO PV-ERROR-MESSAGE-1            12310004
123400           MOVE DP003-INPUT-FIELDS                                12320004
123500                                 TO PV-ERROR-MESSAGE-2            12330004
123600***        PERFORM 9200-ABEND                                     12340004
123700     END-EVALUATE.                                                12350004
123800*                                                                 12360007
123900 Z550-EDIT-DEPT-DC.                                               12370007
124000***************************************************************   12380007
124100*    CHECK IF THE RECEIVING LOCATION (DISTRIBUTION CENTER),       12390007
124200*    AND THE DEPT FROM THE PLAN FILE ARE VALID.                   12400007
124300*                                                                 12410007
124400*    PERFORMED BY C100-ALL-KEYS.                                  12420007
124500*    PERFORMED BY C200-PLAN-KEY.                                  12430007
124600*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          12440007
124700*    PERFORMED BY C700-PLAN-DAILY-KEY.                            12450007
124800***************************************************************   12460007
124900     SET PS-NO-DC-ERROR          TO TRUE.                         12470007
125000                                                                  12480099
125100     MOVE MP010I-DEPT            TO DP010I-UNEDITED-FIELD.        12490007
125200     MOVE 3                      TO DP010I-MAXIMUM-DIGITS.        12500007
125300     MOVE 0                      TO DP010I-MAXIMUM-DECIMALS.      12510007
125400     SET  DP010I-NEGATIVE-NOT-ALLOWED                             12520007
125500                                 TO TRUE.                         12530007
125600                                                                  12540007
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12551099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         12552099
125800*                                                                 12560007
125900*                                                                 12570007
126000 Z600-EDIT-RECEIPTS.                                              12580007
126100***************************************************************   12590007
126200*    CHECK IF THE PLANNED RECEIPTS ARE NUMERIC                    12600007
126300*                                                                 12610007
126400*    PERFORMED BY C100-ALL-KEYS.                                  12620007
126500*    PERFORMED BY C200-PLAN-KEY.                                  12630007
126600*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          12640007
126700*    PERFORMED BY C700-PLAN-DAILY-KEY.                            12650007
126800***************************************************************   12660007
126900     MOVE MP010I-PLAN-RECEIPTS   TO DP010I-UNEDITED-FIELD.        12670007
127000     MOVE 6                      TO DP010I-MAXIMUM-DIGITS.        12680007
127100     MOVE 0                      TO DP010I-MAXIMUM-DECIMALS.      12690007
127200     SET  DP010I-NEGATIVE-NOT-ALLOWED                             12700007
127300                                 TO TRUE.                         12710007
127400                                                                  12720007
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12731099
263627          USING DP010I-NUMERIC-EDIT-AREA.                         12732099
127600*                                                                 12740007
127700*                                                                 12750007
127800 Z700-WRITE-DAILY-RECEIPTS.                                       12760007
127900***************************************************************   12770007
128000*    WRITE TO THE DAILY RECEIPTS OUTPUT FILE                      12780007
128100*                                                                 12790007
128200*    PERFORMED BY C100-ALL-KEYS.                                  12800007
128300*    PERFORMED BY C200-PLAN-KEY.                                  12810007
128400*    PERFORMED BY C300-EXTRACT-KEY.                               12820007
128500*    PERFORMED BY C400-PLAN-EXTRACT-KEY.                          12830007
128600*    PERFORMED BY C500-DAILY-KEY.                                 12840007
128700*    PERFORMED BY C600-DAILY-EXTRACT-KEY.                         12850007
128800*    PERFORMED BY C700-PLAN-DAILY-KEY.                            12860007
128900***************************************************************   12870007
129000     IF MP009O-RECEIVING-LOCATION = 'DS'                          12880099
129100        MOVE +90                 TO MP009O-OPER-UNT-ID            12890099
129200     END-IF.                                                      12900099
129300                                                                  12910099
129400     WRITE DRO-DAILY-RECEIPTS-OUT-RECORD                          12920007
129500         FROM MP009O-DAILY-RECEIPTS.                              12930007
129600*                                                                 12940004
129700 9200-ABEND.                                                      12950004
129800******************************************************************12960004
129900*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       12970004
130000******************************************************************12980004
           MOVE SQLCODE        TO PV-SQLCODE                            12990099
130100     DISPLAY '***************************'.                       13000004
130200     DISPLAY '**       ABEND           **'.                       13010004
130300     DISPLAY '**  IN PROGRAM MPKUT007  **'.                       13020004
130400     DISPLAY '***************************'.                       13030004
130500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13040004
130600     DISPLAY '**   ERROR         ** = ' DP003-RETURN-MSG.         13050004
130600     DISPLAY '**   SQLCODE       ** = ' PV-SQLCODE                13060099
130700     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       13070004
130800     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       13080004
130900                                                                  13090004
131000     MOVE +4014                  TO PV-ABEND-CODE.                13100004
131100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13110004
131200*                                                                 13120007
