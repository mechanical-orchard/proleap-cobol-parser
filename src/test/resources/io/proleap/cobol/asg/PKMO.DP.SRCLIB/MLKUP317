       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.    MLKUP317.                                         00030000
       AUTHOR.        BARBARA HULL.                                     00040000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
       DATE-WRITTEN.  07-06-98.                                         00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ******************************************************************00090000
      * MLKUP317 - DESCRIPTION.............                             00100000
      *                                                                 00110000
      * UPDATE OPEN FISCAL PERIODS CONTROL TABLE TMLCNTL.               00120000
      *                                                                 00130000
      ******************************************************************00140000
                                                                        00150000
       ENVIRONMENT DIVISION.                                            00160000
                                                                        00170000
       CONFIGURATION SECTION.                                           00180000
       SOURCE-COMPUTER.        IBM-3090.                                00190000
       OBJECT-COMPUTER.        IBM-3090.                                00200000
                                                                        00210000
       INPUT-OUTPUT SECTION.                                            00220000
       FILE-CONTROL.                                                    00230000
                                                                        00240000
           SELECT FISCAL-WEEK-FILE                                      00250000
               ASSIGN TO INP01.                                         00260000
                                                                        00270000
      ******************************************************************00280000
       DATA DIVISION.                                                   00290000
      ******************************************************************00300000
       FILE SECTION.                                                    00310000
                                                                        00320000
       FD  FISCAL-WEEK-FILE                                             00330000
           LABEL RECORDS ARE STANDARD                                   00340000
           RECORDING MODE IS F                                          00350000
           BLOCK CONTAINS 0 RECORDS.                                    00360000
       01  FISCAL-WEEK-RECORD          PIC X(80).                       00370000
                                                                        00380000
       WORKING-STORAGE SECTION.                                         00390000
                                                                        00400000
       01  FILLER                      PIC X(40)                        00410000
            VALUE '***** WORKING STORAGE STARTS HERE ******'.           00420000
                                                                        00430000
      *** START OF INPUT RECORD                                         00440000
       01  CC-CONTROL-RECORD.                                           00450000
           05  CC-OPEN-FSCL-WK-END-DTE PIC X(10).                       00470005
           05  FILLER                  PIC X(67).                       00480005
      *                                                                 00490002
       01  PROGRAM-VARIABLES.                                           00500002
           05  PV-OPN-FSCL-DATES.                                       00510002
               10  PV-OPN-FSCL-MN-DTE  PIC X(10).                       00520002
               10  PV-OPN-FSCL-MN-NBR  PIC X(02).                       00530002
               10  PV-OPN-FSCL-WK-DTE  PIC X(10).                       00540002
               10  PV-OPN-FSCL-WK-NBR  PIC X(02).                       00550002
                                                                        00560002
       EJECT                                                            00570000
                                                                        00580000
      *-----------------------------------------------------------------00590000
      *  ABEND AREA                                                     00600000
      *-----------------------------------------------------------------00610000
       01 ABEND-AREAS.                                                  00620000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00630000
                                                   COMP SYNC.           00640000
               88  AC-BAD-DATA                     VALUE +4003.         00650000
               88  AC-DB2-ERROR                    VALUE +4013.         00660000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00670000
                 '*****       ABEND'.                                   00680000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00690000
                   '*****   PROGRAM: MLKUP317'.                         00700000
           05  AA-PARAGRAPH-LIT.                                        00710000
               10  FILLER              PIC X(17)   VALUE                00720000
                   '***** PARAGRAPH: '.                                 00730000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00740000
           05  AA-MESSAGE-LINE.                                         00750000
               10  FILLER              PIC X(06)   VALUE '*****'.       00760000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00770000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00780000
                   '*****    DB2 ERROR'.                                00790000
           05  AA-DB2-OPERATION-LIT.                                    00800000
               10  FILLER              PIC X(17)   VALUE                00810000
                   '***** OPERATION: '.                                 00820000
               10  AA-DB2-OPERATION.                                    00830000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        00840000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        00850000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        00860000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        00870000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        00880000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        00890000
                                                                        00900000
      ******************************************************************00910000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                00920000
      ******************************************************************00930000
           COPY DPWS004.                                                00940000
                                                                        00950000
      ******************************************************************00960000
      *  USED FOR DB2 ERRORS                                            00970000
      ******************************************************************00980000
           EXEC SQL                                                     00990000
               INCLUDE SQLCA                                            01000000
           END-EXEC.                                                    01010000
                                                                        01020000
      ******************************************************************01030000
      *  LAYOUT FOR DATE TABLE                                          01040000
      ******************************************************************01050000
           EXEC SQL                                                     01060000
               INCLUDE TDTATTR                                          01070000
           END-EXEC.                                                    01080000
                                                                        01090000
      ******************************************************************01100000
      *  LAYOUT FOR OPEN FISCAL PERIOD TABLE                            01110000
      ******************************************************************01120000
           EXEC SQL                                                     01130000
               INCLUDE TMLCNTL                                          01140000
           END-EXEC.                                                    01150000
                                                                        01160000
       01  FILLER                      PIC X(22)                        01170000
           VALUE 'END OF WORKING STORAGE'.                              01180000
                                                                        01190000
       EJECT                                                            01200000
                                                                        01210000
      ******************************************************************01220000
       PROCEDURE DIVISION.                                              01230000
      ******************************************************************01240000
                                                                        01250000
      ******************************************************************01260000
       0000-MAINLINE-MLKUP317.                                          01270000
      ******************************************************************01280000
                                                                        01290000
           PERFORM 1000-INITIALIZATION.                                 01300000
                                                                        01310000
           PERFORM 2000-PROCESS-CONTROL.                                01320000
                                                                        01330000
           PERFORM 8000-EOJ-PROCESS.                                    01340000
                                                                        01350000
           STOP RUN.                                                    01360000
                                                                        01370000
       EJECT                                                            01380000
                                                                        01390000
      ******************************************************************01400000
       1000-INITIALIZATION.                                             01410000
      ******************************************************************01420000
                                                                        01430000
           OPEN INPUT FISCAL-WEEK-FILE.                                 01440000
                                                                        01450000
       EJECT                                                            01460000
                                                                        01470000
      ******************************************************************01480000
       2000-PROCESS-CONTROL.                                            01490000
      ******************************************************************01500000
                                                                        01510000
           PERFORM 4000-READ-FISCAL-WEEK-FILE.                          01520000
                                                                        01530000
           DISPLAY ' '.                                                 01540000
           DISPLAY '*** INPUT CONTROL CARD PROCESSED ***'.              01550000
           DISPLAY CC-OPEN-FSCL-WK-END-DTE.                             01560006
                                                                        01570000
           PERFORM 7000-SELECT-TDTATTR.                                 01580000
                                                                        01590000
           IF CC-OPEN-FSCL-WK-END-DTE NOT = DTATTR-FSCL-WK-END-DTE      01600004
               MOVE '2000-PROCESS-CONTROL'                              01610004
                                       TO AA-PARAGRAPH-NAME             01620004
               MOVE 'CONTROL CARD DATE NOT = DTATTR WEEK END DATE'      01630006
                                       TO AA-MESSAGE                    01640004
               MOVE +4002              TO ABEND-CODE                    01650004
               PERFORM 9900-COMMON-ABEND-ROUTINE                        01660004
           END-IF.                                                      01670004
                                                                        01680004
           MOVE DTATTR-FSCL-MN-END-DTE TO PV-OPN-FSCL-MN-DTE.           01690002
           MOVE DTATTR-FSCL-MN-NBR     TO PV-OPN-FSCL-MN-NBR.           01700002
           MOVE DTATTR-FSCL-WK-END-DTE TO PV-OPN-FSCL-WK-DTE.           01710002
           MOVE DTATTR-FSCL-WK-NBR     TO PV-OPN-FSCL-WK-NBR.           01720002
                                                                        01730002
           DISPLAY ' '.                                                 01740002
           DISPLAY '*** TMLCNTL ROW UPDATED ***'.                       01750002
           DISPLAY PV-OPN-FSCL-DATES.                                   01760002
                                                                        01770002
           PERFORM 7100-UPDATE-TMLCNTL.                                 01780001
                                                                        01790000
       EJECT                                                            01800000
                                                                        01810000
      ******************************************************************01820000
       4000-READ-FISCAL-WEEK-FILE.                                      01830000
      ******************************************************************01840000
                                                                        01850000
           READ FISCAL-WEEK-FILE                                        01860000
               INTO CC-CONTROL-RECORD                                   01870000
               AT END                                                   01880000
                   MOVE '4000-READ-FISCAL-WEEK-FILE'                    01890000
                                       TO AA-PARAGRAPH-NAME             01900000
                   MOVE 'CONTROL CARD IS MISSING'                       01910000
                                       TO AA-MESSAGE                    01920000
                   MOVE +4001          TO ABEND-CODE                    01930000
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    01940000
           END-READ.                                                    01950000
                                                                        01960000
       EJECT                                                            01970000
                                                                        01980000
      ******************************************************************01990000
       7000-SELECT-TDTATTR.                                             02000000
      ******************************************************************02010000
                                                                        02020000
           EXEC SQL                                                     02030000
               SELECT FSCL_MN_NBR,                                      02040000
                      FSCL_WK_NBR,                                      02050000
                      FSCL_MN_END_DTE,                                  02060000
                      FSCL_WK_END_DTE                                   02070000
               INTO  :DTATTR-FSCL-MN-NBR,                               02080000
                     :DTATTR-FSCL-WK-NBR,                               02090000
                     :DTATTR-FSCL-MN-END-DTE,                           02100000
                     :DTATTR-FSCL-WK-END-DTE                            02110000
               FROM TDTATTR                                             02120000
               WHERE (KY_DTE = :CC-OPEN-FSCL-WK-END-DTE)                02130000
           END-EXEC.                                                    02140000
                                                                        02150000
           EVALUATE TRUE                                                02160000
               WHEN SQLCODE = 100                                       02170000
                   MOVE '7000-SELECT-TDTATTR'                           02180000
                                       TO AA-PARAGRAPH-NAME             02190000
                   MOVE 'TDTATTR ROW NOT FOUND'                         02200000
                                       TO AA-MESSAGE                    02210000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02220000
                   PERFORM 9998-DB2-ABEND                               02230000
               WHEN SQLCODE < 0                                         02240000
                   MOVE '7000-SELECT-TDTATTR'                           02250000
                                       TO AA-PARAGRAPH-NAME             02260000
                   MOVE 'TDTATTR TABLE ERROR'                           02270000
                                       TO AA-MESSAGE                    02280000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02290000
                   PERFORM 9998-DB2-ABEND                               02300000
               WHEN SQLCODE > 0                                         02310000
               WHEN SQLWARN0 NOT = SPACES                               02320000
                   MOVE '7000-SELECT-TDTATTR'                           02330000
                                       TO AA-PARAGRAPH-NAME             02340000
                   MOVE 'TDTATTR TABLE WARNING'                         02350000
                                       TO AA-MESSAGE                    02360000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02370000
                   PERFORM 9998-DB2-ABEND                               02380000
           END-EVALUATE.                                                02390000
                                                                        02400000
       EJECT                                                            02410000
                                                                        02420000
      ******************************************************************02430000
       7100-UPDATE-TMLCNTL.                                             02440000
      ******************************************************************02450000
                                                                        02460000
           EXEC SQL                                                     02470000
               UPDATE TMLCNTL                                           02480000
                  SET OPN_FSCL_MN_DTE = :PV-OPN-FSCL-MN-DTE,            02490003
                      OPN_FSCL_MN_NBR = :PV-OPN-FSCL-MN-NBR,            02500003
                      OPN_FSCL_WK_DTE = :PV-OPN-FSCL-WK-DTE,            02510003
                      OPN_FSCL_WK_NBR = :PV-OPN-FSCL-WK-NBR             02520003
           END-EXEC.                                                    02530000
                                                                        02540000
           EVALUATE TRUE                                                02550000
               WHEN SQLCODE < 0                                         02560000
                   MOVE '7100-UPDATE-TMLCNTL'                           02570000
                                       TO AA-PARAGRAPH-NAME             02580000
                   MOVE 'TMLCNTL TABLE ERROR'                           02590000
                                       TO AA-MESSAGE                    02600000
                   MOVE 'UPDATE'       TO AA-DB2-OPERATION              02610000
                   PERFORM 9998-DB2-ABEND                               02620000
               WHEN SQLCODE > 0                                         02630000
               WHEN SQLWARN0 NOT = SPACES                               02640000
                   MOVE '7100-UPDATE-TMLCNTL'                           02650000
                                       TO AA-PARAGRAPH-NAME             02660000
                   MOVE 'TMLCNTL TABLE WARNING'                         02670000
                                       TO AA-MESSAGE                    02680000
                   MOVE 'UPDATE'       TO AA-DB2-OPERATION              02690000
                   PERFORM 9998-DB2-ABEND                               02700000
           END-EVALUATE.                                                02710000
                                                                        02720000
       EJECT                                                            02730000
                                                                        02740000
      ******************************************************************02750000
       8000-EOJ-PROCESS.                                                02760000
      ******************************************************************02770000
                                                                        02780000
           CLOSE FISCAL-WEEK-FILE.                                      02790000
                                                                        02800000
       EJECT                                                            02810000
                                                                        02820000
      ******************************************************************02830000
       9900-COMMON-ABEND-ROUTINE.                                       02840000
      ******************************************************************02850000
                                                                        02860000
           DISPLAY AA-ABEND-LIT.                                        02870000
           DISPLAY AA-PROGRAM-LIT.                                      02880000
           DISPLAY AA-PARAGRAPH-LIT.                                    02890000
           DISPLAY AA-MESSAGE-LINE.                                     02900000
           DISPLAY ABEND-CODE.                                          02910000
                                                                        02920000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02930000
                                                                        02940000
       EJECT                                                            02950000
                                                                        02960000
      ******************************************************************02970000
       9998-DB2-ABEND.                                                  02980000
      ******************************************************************02990000
                                                                        03000000
           CLOSE FISCAL-WEEK-FILE.                                      03010000
                                                                        03020000
           DISPLAY AA-ABEND-LIT.                                        03030000
           DISPLAY AA-DB2-ERROR-LIT.                                    03040000
           DISPLAY AA-PROGRAM-LIT.                                      03050000
           DISPLAY AA-PARAGRAPH-LIT.                                    03060000
           DISPLAY AA-MESSAGE-LINE.                                     03070000
           DISPLAY AA-DB2-OPERATION-LIT.                                03080000
           SET AC-DB2-ERROR TO TRUE.                                    03090000
           MOVE +4013                  TO ABEND-CODE.                   03100000
                                                                        03110000
           COPY DPPD004.                                                03120000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03130000
                                                                        03140000
