000100 IDENTIFICATION DIVISION.                                                 
000200 PROGRAM-ID.    XLKUT085.                                                 
000300 AUTHOR.        LYNN MCADAMS.                                             
000400 DATE-WRITTEN.  OCTOBER, 2004.                                            
000500*                                                                         
000600****************************************************************          
000700*    P E R M   P R I C E   D O M A I N   S Y N C / E X T R A C T          
000800*             PERM PRICE CHANGE (PPC) COMPARE PROGRAM                     
000900*                                                                         
001000* THIS PROGRAM COMPARES THREE SETS OF FILES, CREATING A                   
001100* COMBINED OUTFILE OF THE DIFFERENCES BETWEEN EACH SET OF FILES.          
001200* THE PROGRAM WILL COMPARE FILES EXTRACTED FROM PPC AGAINST LIKE          
001300* FILES EXTRACTED FROM THE DB2 PERM PRICE DOMAIN TABLES.                  
001400* (EACH SET OF FILES CORRESPONDS TO A DB2 PERM PRICE DOMAIN TABLE)        
001500*                                                                         
001600* DIFFERENCES BETWEEN THE PPC & DB2 FILES WILL BE WRITTEN TO AN           
001700* OUTPUT FILE AS EITHER AN ADD, DELETE OR UPDATE RECORD.                  
001800****************************************************************          
      * LOG                                                                     
      *     DAVE WELLER - 07/23/2012                                            
      *     ADJUST FILE LENGTHS AND PROCESS NEW FIELDS                          
001800****************************************************************          
001900*                                                                         
002000 ENVIRONMENT DIVISION.                                                    
002100 INPUT-OUTPUT SECTION.                                                    
002200                                                                          
002300 FILE-CONTROL.                                                            
002400     SELECT PPC-PRCHG-FILE          ASSIGN TO INP01.                      
002500     SELECT DB2-PRCHG-FILE          ASSIGN TO INP02.                      
002600                                                                          
002700     SELECT PPC-STRGP-FILE          ASSIGN TO INP03.                      
002800     SELECT DB2-STRGP-FILE          ASSIGN TO INP04.                      
002900                                                                          
003000     SELECT PPC-MDSE-FILE           ASSIGN TO INP05.                      
003100     SELECT DB2-MDSE-FILE           ASSIGN TO INP06.                      
003200     SELECT TIMESTAMP-FILE          ASSIGN TO INP07.                      
003300                                                                          
003400     SELECT OUTPUT-FILE             ASSIGN TO OUT01.                      
003500                                                                          
003600****************************************************************          
003700 DATA DIVISION.                                                           
003800 FILE SECTION.                                                            
003900                                                                          
004000 FD  PPC-PRCHG-FILE                                                       
004100     LABEL RECORDS ARE STANDARD                                           
004200     RECORDING MODE IS F                                                  
004300     BLOCK CONTAINS 0 RECORDS.                                            
004400 01  PPC-PRCHG-FILE-REC          PIC X(200).                              
004500                                                                          
004600 FD  DB2-PRCHG-FILE                                                       
004700     LABEL RECORDS ARE STANDARD                                           
004800     RECORDING MODE IS F                                                  
004900     BLOCK CONTAINS 0 RECORDS.                                            
005000 01  DB2-PRCHG-FILE-REC          PIC X(037).                              
005100                                                                          
005200 FD  PPC-STRGP-FILE                                                       
005300     LABEL RECORDS ARE STANDARD                                           
005400     RECORDING MODE IS F                                                  
005500     BLOCK CONTAINS 0 RECORDS.                                            
005600 01  PPC-STRGP-FILE-REC          PIC X(200).                              
005700                                                                          
005800 FD  DB2-STRGP-FILE                                                       
005900     LABEL RECORDS ARE STANDARD                                           
006000     RECORDING MODE IS F                                                  
006100     BLOCK CONTAINS 0 RECORDS.                                            
006200 01  DB2-STRGP-FILE-REC          PIC X(071).                              
006300                                                                          
006400 FD  PPC-MDSE-FILE                                                        
006500     LABEL RECORDS ARE STANDARD                                           
006600     RECORDING MODE IS F                                                  
006700     BLOCK CONTAINS 0 RECORDS.                                            
006800 01  PPC-MDSE-FILE-REC           PIC X(200).                              
006900                                                                          
007000 FD  DB2-MDSE-FILE                                                        
007100     LABEL RECORDS ARE STANDARD                                           
007200     RECORDING MODE IS F                                                  
007300     BLOCK CONTAINS 0 RECORDS.                                            
007400 01  DB2-MDSE-FILE-REC           PIC X(057).                              
007500                                                                          
007600 FD  TIMESTAMP-FILE                                                       
007700     LABEL RECORDS ARE STANDARD                                           
007800     RECORDING MODE IS F                                                  
007900     BLOCK CONTAINS 0 RECORDS.                                            
008000 01  TIMESTAMP-REC               PIC X(080).                              
008100                                                                          
008200 FD  OUTPUT-FILE                                                          
008300     LABEL RECORDS ARE STANDARD                                           
008400     RECORDING MODE IS F                                                  
008500     BLOCK CONTAINS 0 RECORDS.                                            
008600 01  OUTPUT-FILE-REC             PIC X(110).                              
008700                                                                          
008800 WORKING-STORAGE SECTION.                                                 
008900                                                                          
009000 01  WS-WORKING-STOAGE-VALUE     PIC X(35)  VALUE                         
009100                          '*** WORKING STORAGE STARTS HERE ***'.          
009200 01  PS-PROGRAM-SWITCHES.                                                 
009300     05  PS-EMPTY-FILE-SW              PIC X(01)  VALUE 'N'.              
009400         88  PS-EMPTY-FILE                  VALUE 'Y'.                    
009500         88  PS-NOT-EMPTY-FILE              VALUE 'N'.                    
009600     05  PS-END-OF-PPC-PRCHG-SW        PIC X(01)  VALUE 'N'.              
009700         88  PS-END-OF-PPC-PRCHG            VALUE 'Y'.                    
009800         88  PS-NOT-END-OF-PPC-PRCHG        VALUE 'N'.                    
009900     05  PS-END-OF-DB2-PRCHG-SW        PIC X(01)  VALUE 'N'.              
010000         88  PS-END-OF-DB2-PRCHG            VALUE 'Y'.                    
010100         88  PS-NOT-END-OF-DB2-PRCHG        VALUE 'N'.                    
010200                                                                          
010300     05  PS-END-OF-PPC-STRGP-SW        PIC X(01)  VALUE 'N'.              
010400         88  PS-END-OF-PPC-STRGP            VALUE 'Y'.                    
010500         88  PS-NOT-END-OF-PPC-STRGP        VALUE 'N'.                    
010600     05  PS-END-OF-DB2-STRGP-SW        PIC X(01)  VALUE 'N'.              
010700         88  PS-END-OF-DB2-STRGP            VALUE 'Y'.                    
010800         88  PS-NOT-END-OF-DB2-STRGP        VALUE 'N'.                    
010900                                                                          
011000     05  PS-END-OF-PPC-MDSE-SW         PIC X(01)  VALUE 'N'.              
011100         88  PS-END-OF-PPC-MDSE             VALUE 'Y'.                    
011200         88  PS-NOT-END-OF-PPC-MDSE         VALUE 'N'.                    
011300     05  PS-END-OF-DB2-MDSE-SW         PIC X(01)  VALUE 'N'.              
011400         88  PS-END-OF-DB2-MDSE             VALUE 'Y'.                    
011500         88  PS-NOT-END-OF-DB2-MDSE         VALUE 'N'.                    
011600                                                                          
011700     05  PS-FIRST-TIME-SW             PIC X(01) VALUE 'Y'.                
011800         88  PS-FIRST-TIME-YES                  VALUE 'Y'.                
011900         88  PS-FIRST-TIME-NO                   VALUE 'N'.                
012000     05  PS-COUNTER-SUB               PIC 9(01) VALUE 1.                  
012100         88  PS-PRICE-CHANGE-COUNT              VALUE 1.                  
012200         88  PS-STR-GP-CHANGE-COUNT             VALUE 2.                  
012300         88  PS-MDSE-CHANGE-COUNT               VALUE 3.                  
012400 01  PT-COUNTER-TABLE.                                                    
012500     05  PT-COUNTERS OCCURS 3 TIMES.                                      
012600         10  PT-COUNTER               PIC S9(11) COMP-3.                  
012700                                                                          
012800 01  PC-PROGRAM-CONSTANTS.                                                
012900     05  PC-CURRENT-PROGRAM-NAME PIC X(08)  VALUE 'XLKUT085'.             
013000     05  PC-DASH                 PIC X(01)  VALUE '-'.                    
013100     05  PC-DEFAULT-TMST         PIC X(26)                                
013200             VALUE '9999-09-09-09.09.09.999999'.                          
013300                                                                          
013400 01  CONTROL-CARD-DATA.                                                   
013500     05  CC-PROGRAM-NAME         PIC X(01)  VALUE SPACES.                 
013600         88  CC-NIGHTLY-MAINT               VALUE '1'.                    
013700         88  CC-DATA-INTEGRITY              VALUE '2'.                    
013800     05  CC-FILLER               PIC X(79)  VALUE SPACES.                 
013900                                                                          
014000*CREATE PV FIELDS TO USE WHEN COMPARING PPC AND DB2 FIELDS                
014100*SINCE THEY ARE DEFINED DIFFERENTLY.                                      
014200                                                                          
014300 01  PV-SYSIN-CARD.                                                       
014400     05  PV-SYSIN-TIMESTAMP           PIC X(26).                          
014500     05  FILLER                       PIC X(54).                          
014600                                                                          
014700 01  PV-PROGRAM-VARIABLES.                                                
014800     05  PV-PPCDAY-QTY            PIC  S9(9) COMP.                        
014900     05  PV-PRCHG-ID                  PIC 9(10).                          
015000     05  PV-DISP-CONTROL              PIC S9(09) COMP-3                   
015100                                              VALUE ZERO.                 
015200     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.                    
015300     05  PV-TIME                      PIC X(08).                          
015400     05  PV-READ-COUNTER              PIC S9(09) COMP VALUE ZERO.         
015500                                                                          
015600*XLT_STR_GP_PRCHG PRIMARY KEYS                                            
015700     05  PV-PPC-STRGP-KEYS.                                               
015800         10  PV-PPC-STRGP-TYP-CDE    PIC 9(04).                           
015900         10  PV-PPC-STRGP-GP-ID      PIC 9(04).                           
016000         10  PV-PPC-STRGP-PRCHG-ID   PIC 9(10).                           
016100     05  PV-DB2-STRGP-KEYS.                                               
016200         10  PV-DB2-STRGP-TYP-CDE    PIC 9(04).                           
016300         10  PV-DB2-STRGP-GP-ID      PIC 9(04).                           
016400         10  PV-DB2-STRGP-PRCHG-ID   PIC 9(10).                           
016500                                                                          
016600*XLT_MDSE_PRCHG PRIMARY KEYS                                              
016700     05  PV-PPC-MDSE-KEYS.                                                
016800         10  PV-PPC-MDSE-TYP-CDE     PIC 9(04).                           
016900         10  PV-PPC-MDSE-GP-ID       PIC 9(04).                           
017000         10  PV-PPC-MDSE-PRCHG-ID    PIC 9(10).                           
017100         10  PV-PPC-MDSE-ID          PIC 9(10).                           
017200     05  PV-DB2-MDSE-KEYS.                                                
017300         10  PV-DB2-MDSE-TYP-CDE     PIC 9(04).                           
017400         10  PV-DB2-MDSE-GP-ID       PIC 9(04).                           
017500         10  PV-DB2-MDSE-PRCHG-ID    PIC 9(10).                           
017600         10  PV-DB2-MDSE-ID          PIC 9(10).                           
017700                                                                          
017800     05  PV-SKU-NBR                   PIC 9(08).                          
017900     05  PV-PREV-UNT-RTL-AMT          PIC S9(07)V99.                      
017900     05  PV-UNT-RTL-AMT               PIC S9(07)V99.                      
018000     05  PV-GP-PRIC-ID                PIC 9(10).                          
018100     05  PV-GP-RTL-AMT                PIC S9(07)V99.                      
018200     05  PV-GP-RTL-QTY                PIC S9(04).                         
018300     05  PV-PRICG-GRID-ID             PIC 9(10).                          
018400                                                                          
018500*    05  PV-DB2-CURRENT-TMST          PIC X(26).                          
018600     05  PV-MARKER-TMST               PIC X(26).                          
018700     05  PV-DB2-MINUS-30-DAYS-DATE    PIC X(10).                          
018800                                                                          
018900     05  PV-DB2-CURR-DATE.                                                
019000         10  PV-DB2-CURR-DATE-CC      PIC X(02).                          
019100         10  PV-DB2-CURR-DATE-YY      PIC X(02).                          
019200         10  FILLER                   PIC X(01) VALUE '-'.                
019300         10  PV-DB2-CURR-DATE-MM      PIC X(02).                          
019400         10  FILLER                   PIC X(01) VALUE '-'.                
019500         10  PV-DB2-CURR-DATE-DD      PIC X(02).                          
019600                                                                          
019700     05  PV-DB2-PREV-DATE.                                                
019800         10  PV-DB2-PREV-DATE-CC      PIC X(02).                          
019900         10  PV-DB2-PREV-DATE-YY      PIC X(02).                          
020000         10  FILLER                   PIC X(01) VALUE '-'.                
020100         10  PV-DB2-PREV-DATE-MM      PIC X(02).                          
020200         10  FILLER                   PIC X(01) VALUE '-'.                
020300         10  PV-DB2-PREV-DATE-DD      PIC X(02).                          
020400                                                                          
020500     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.             
020600     05  PV-SQLCODE                   PIC 9(09) VALUE ZERO.               
020700     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0                  
020800                                                COMP-3.                   
020900                                                                          
021000 01  PV-ABEND-FIELDS.                                                     
021100     05  PV-ABEND-CODE               PIC S9(4) VALUE +0                   
021200                                               COMP SYNC.                 
021300     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'XLKUT085'.          
021400     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.              
021500     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.              
021600     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.              
021700     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.              
021800     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.              
021900     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.              
022000     05  PV-DB2-TABLE-NAME-1         PIC X(20) VALUE SPACES.              
022100     05  PV-DB2-TABLE-NAME-2         PIC X(20) VALUE SPACES.              
022200                                                                          
022300     05  PV-DISPLAY-PRCHG-ID         PIC  9(08) VALUE ZEROES.             
022400     05  PV-DISPLAY-STR-GP-ID        PIC  9(08) VALUE ZEROES.             
022500     05  PV-DISPLAY-STR-GP-TYP-CDE   PIC  9(08) VALUE ZEROES.             
022600                                                                          
022700 01  PA-PROGRAM-COUNTERS.                                                 
022800     05  PA-PPC-PRCHG-RECS-READ          PIC 9(09) VALUE ZEROS.           
022900     05  PA-DB2-PRCHG-RECS-READ          PIC 9(09) VALUE ZEROS.           
023000     05  PA-DB2-PRCHG-HIST-READ          PIC 9(09) VALUE ZEROS.           
023100                                                                          
023200     05  PA-DB2-PRCHG-RECS-INSERT        PIC 9(09) VALUE ZEROS.           
023300     05  PA-DB2-PRCHG-RECS-UPDATE        PIC 9(09) VALUE ZEROS.           
023400     05  PA-DB2-PRCHG-RECS-DELETE        PIC 9(09) VALUE ZEROS.           
023500     05  PA-DB2-PRCHG-UPDATE-SKIP        PIC 9(09) VALUE ZEROS.           
023600                                                                          
023700     05  PA-PPC-STRGP-RECS-READ          PIC 9(09) VALUE ZEROS.           
023800     05  PA-DB2-STRGP-RECS-READ          PIC 9(09) VALUE ZEROS.           
023900     05  PA-DB2-STRGP-HIST-READ          PIC 9(09) VALUE ZEROS.           
024000                                                                          
024100     05  PA-DB2-STRGP-RECS-INSERT        PIC 9(09) VALUE ZEROS.           
024200     05  PA-DB2-STRGP-RECS-UPDATE        PIC 9(09) VALUE ZEROS.           
024300     05  PA-DB2-STRGP-RECS-DELETE        PIC 9(09) VALUE ZEROS.           
024400     05  PA-DB2-STRGP-RECS-UPDATE-SKIP   PIC 9(09) VALUE ZEROS.           
024500                                                                          
024600     05  PA-PPC-MDSE-RECS-READ           PIC 9(09) VALUE ZEROS.           
024700     05  PA-DB2-MDSE-RECS-READ           PIC 9(09) VALUE ZEROS.           
024800     05  PA-DB2-MDSE-HIST-READ           PIC 9(09) VALUE ZEROS.           
024900                                                                          
025000     05  PA-DB2-MDSE-RECS-INSERT         PIC 9(09) VALUE ZEROS.           
025100     05  PA-DB2-MDSE-RECS-UPDATE         PIC 9(09) VALUE ZEROS.           
025200     05  PA-DB2-MDSE-RECS-DELETE         PIC 9(09) VALUE ZEROS.           
025300     05  PA-DB2-MDSE-RECS-UPDATE-SKIP    PIC 9(09) VALUE ZEROS.           
025400                                                                          
025500     05  PA-DIFFER-RECORD-WRITTEN        PIC 9(09) VALUE ZEROS.           
025600                                                                          
025700 01  DK-DB-KEYS.                                                          
025800     05  DK-PRCHG-ID                     PIC  S9(9) COMP.                 
025900     05  DK-STR-GP-ID                    PIC  S9(4) COMP.                 
026000     05  DK-STR-GP-TYP-CDE               PIC  S9(4) COMP.                 
026100                                                                          
026200 01  PV-PREV-KEYS.                                                        
026300     05  PV-PREV-PRCHG-ID                PIC  S9(9) COMP.                 
026400     05  PV-PREV-STR-GP-ID               PIC  S9(4) COMP.                 
026500     05  PV-PREV-STR-GP-TYP-CDE          PIC  S9(4) COMP.                 
026600*                                                                         
026700*  USED FOR DB2 ERROR MESSAGE BUILDING                                    
026800*                                                                         
026900     COPY DPWS004.                                                        
027000                                                                          
027100***                                                                       
027200*XLT_PRCHG                                                                
027300     COPY PERD103.                                                        
027400                                                                          
027500* XLT_PRCHG                                                               
027600*THIS COPYBOOK HAS BEEN CREATED TO ACCOMMODATE THIS.                      
027700     COPY XLRD055.                                                        
027800                                                                          
027900***                                                                       
028000*XLT_STR_GP_PRCHG                                                         
028100     COPY PERD104.                                                        
028200                                                                          
028300*SINCE PERD104 HAS THE PRCH-EFF-DTE BROKEN DOWN AND XLT00033              
028400*DOES NOT, THIS COPYBOOK HAS BEEN CREATED TO ACCOMODATE THIS.             
028500     COPY XLRD056.                                                        
028600                                                                          
028700***                                                                       
028800*XLT_PRCHG_MDSE                                                           
028900     COPY PERD105.                                                        
029000                                                                          
029100*SINCE XLT00034 (XLT_PRCHG_MDSE) HAS NULLS IN SOME FIELDS,                
029200*THIS COPYBOOK HAS BEEN CREATED TO ACCOMMODATE THIS.                      
029300     COPY XLRD057.                                                        
029400                                                                          
029500***                                                                       
029600     EXEC SQL                                                             
029700         INCLUDE SQLCA                                                    
029800     END-EXEC.                                                            
029900                                                                          
030000***DB2 DCLGEN FOR PARM TABLE                                              
030100     EXEC SQL                                                             
030200          INCLUDE TKRPRPM                                                 
030300     END-EXEC.                                                            
030400                                                                          
030500***TABLE XLT_PRCHG                                                        
030600     EXEC SQL                                                             
030700         INCLUDE XLT00032                                                 
030800     END-EXEC.                                                            
030900                                                                          
031000***TABLE XLT_STR_GP_PRCHG                                                 
031100     EXEC SQL                                                             
031200         INCLUDE XLT00033                                                 
031300     END-EXEC.                                                            
031400                                                                          
031500***TABLE XLT_PRCHG_MDSE                                                   
031600*    EXEC SQL                                                             
031700*        INCLUDE XLT00034                                                 
031800*    END-EXEC.                                                            
031900                                                                          
032000******************************************************************        
032100* COPYBOOK OF OUTPUT FILE.                                                
032200******************************************************************        
032300     COPY XLRD054.                                                        
032400                                                                          
032500******************************************************************        
032600 PROCEDURE DIVISION.                                                      
032700                                                                          
032800     PERFORM 1000-INITIALIZATION.                                         
032900*                                                                         
033000*CHECK IF ANY EMPTY PPC FILES (ERROR MESSAGE).                            
033100*  LMM COMMENT OUT FOR TESTING                                            
033200*    IF PS-EMPTY-FILE                                                     
033300*        MOVE 4095 TO RETURN-CODE                                         
033400*        PERFORM 9999-TERMINATE                                           
033500*        GOBACK                                                           
033600*    END-IF.                                                              
033700                                                                          
033800*COMPARE PRICE CHANGE.                                                    
033900*    EXEC SQL SET :PV-MARKER-TMST = CURRENT TIMESTAMP END-EXEC            
034000*    DISPLAY 'STARTING PRICE CHANGE COMPARE       ' PV-MARKER-TMST        
034100                                                                          
034200     PERFORM 2000-PROCESS-PRCHG                                           
034300       UNTIL PS-END-OF-PPC-PRCHG                                          
034400          OR PS-END-OF-DB2-PRCHG.                                         
034500     PERFORM 2900-PROCESS-EXTRA-PRCHG-REC                                 
034600       UNTIL PS-END-OF-PPC-PRCHG                                          
034700         AND PS-END-OF-DB2-PRCHG.                                         
034800                                                                          
034900     EXEC SQL SET :PV-MARKER-TMST = CURRENT TIMESTAMP END-EXEC            
035000     DISPLAY 'STARTING GROUP PRICE CHANGE COMPARE '                       
035100                          PV-MARKER-TMST                                  
035200                                                                          
035300*COMPARE STORE GROUP PRICE CHANGE.                                        
035400     PERFORM 3000-PROCESS-STRGP                                           
035500       UNTIL PS-END-OF-PPC-STRGP                                          
035600          OR PS-END-OF-DB2-STRGP.                                         
035700     PERFORM 3900-PROCESS-EXTRA-STRGP-REC                                 
035800       UNTIL PS-END-OF-PPC-STRGP                                          
035900         AND PS-END-OF-DB2-STRGP.                                         
036000                                                                          
036100     EXEC SQL SET :PV-MARKER-TMST = CURRENT TIMESTAMP END-EXEC            
036200     DISPLAY 'STARTING PRICE CHANGE MDSE COMPARE  '                       
036300                          PV-MARKER-TMST                                  
036400                                                                          
036500*COMPARE PRICE CHANGE MERCHANDISE.                                        
036600     PERFORM 4000-PROCESS-MDSE                                            
036700       UNTIL PS-END-OF-PPC-MDSE                                           
036800          OR PS-END-OF-DB2-MDSE.                                          
036900     PERFORM 4900-PROCESS-EXTRA-MDSE-REC                                  
037000       UNTIL PS-END-OF-PPC-MDSE                                           
037100         AND PS-END-OF-DB2-MDSE.                                          
037200                                                                          
037300                                                                          
037400*    EXEC SQL SET :PV-MARKER-TMST = CURRENT TIMESTAMP END-EXEC            
037500*    DISPLAY 'ENDING PRICE CHANGE MDSE COMPARE    '                       
037600*                         PV-MARKER-TMST                                  
037700                                                                          
037800*FINISH PROCESSING.                                                       
037900     PERFORM 9999-TERMINATE.                                              
038000                                                                          
038100     IF PA-DIFFER-RECORD-WRITTEN > ZERO                                   
038200                 AND CC-DATA-INTEGRITY                                    
038300         MOVE 4094 TO RETURN-CODE                                         
038400     END-IF                                                               
038500                                                                          
038600     GOBACK.                                                              
038700/                                                                         
038800 1000-INITIALIZATION.                                                     
038900     MOVE '1000-INITIALIZATION           ' TO PV-PARAGRAPH-NAME.          
039000*    DISPLAY PV-PARAGRAPH-NAME                                            
039100*SET COUNTERS TO ZERO.                                                    
039200     INITIALIZE PA-PROGRAM-COUNTERS                                       
039300                PT-COUNTER-TABLE                                          
039400                                                                          
039500*READ SYSIN CONTROL CARD.                                                 
039600     ACCEPT CONTROL-CARD-DATA FROM SYSIN.                                 
039700                                                                          
039800     OPEN INPUT  PPC-PRCHG-FILE                                           
039900                 DB2-PRCHG-FILE                                           
040000                 PPC-STRGP-FILE                                           
040100                 DB2-STRGP-FILE                                           
040200                 PPC-MDSE-FILE                                            
040300                 DB2-MDSE-FILE                                            
040400                 TIMESTAMP-FILE                                           
040500          OUTPUT OUTPUT-FILE.                                             
040600                                                                          
040700     READ TIMESTAMP-FILE INTO                                             
040800            PV-SYSIN-CARD                                                 
040900     AT END                                                               
041000         DISPLAY ALL '!'                                                  
041100         DISPLAY ' DATE CARD IS MISSING - JOB GO BOOM'                    
041200         DISPLAY SPACES                                                   
041300         PERFORM 9900-DB2-ABEND                                           
041400     NOT AT END                                                           
041500         IF PV-SYSIN-CARD = LOW-VALUES OR SPACES                          
041600             DISPLAY ALL '!'                                              
041700             DISPLAY ' DATE CARD IS MISSING - JOB GO BOOM'                
041800             DISPLAY SPACES                                               
041900             PERFORM 9900-DB2-ABEND                                       
042000         ELSE                                                             
042100             DISPLAY 'XLKUT085 - DATE IS ' PV-SYSIN-TIMESTAMP             
042200         END-IF                                                           
042300     END-READ.                                                            
042400                                                                          
042500     SET PS-NOT-EMPTY-FILE                                                
042600         PS-NOT-END-OF-PPC-PRCHG                                          
042700         PS-NOT-END-OF-DB2-PRCHG                                          
042800         PS-NOT-END-OF-PPC-STRGP                                          
042900         PS-NOT-END-OF-DB2-STRGP                                          
043000         PS-NOT-END-OF-PPC-MDSE                                           
043100         PS-NOT-END-OF-DB2-MDSE  TO TRUE.                                 
043200                                                                          
043300*    EXEC SQL                                                             
043400*       SET :PV-DB2-CURRENT-TMST = CURRENT TIMESTAMP                      
043500*    END-EXEC.                                                            
043600                                                                          
043700     PERFORM 1100-SELECT-TKRPRPM                                          
043800                                                                          
043900     EXEC SQL                                                             
044000        SET :PV-DB2-MINUS-30-DAYS-DATE                                    
044100          = (DATE(:PV-SYSIN-TIMESTAMP)                                    
044200             - :PV-PPCDAY-QTY DAYS)                                       
044300     END-EXEC.                                                            
044400                                                                          
044500     PERFORM 6000-READ-PRCHG-PPC-FILE                                     
044600     PERFORM 6100-READ-PRCHG-DB2-FILE.                                    
044700                                                                          
044800     PERFORM 7000-READ-STRGP-PPC-FILE                                     
044900     PERFORM 7100-READ-STRGP-DB2-FILE.                                    
045000                                                                          
045100     PERFORM 8000-READ-MDSE-PPC-FILE                                      
045200     PERFORM 8100-READ-MDSE-DB2-FILE.                                     
045300/                                                                         
045400                                                                          
045500*GET PARM FOR NUMBER OF DAYS PRICE CHG DOCUMENT SHOULD BE                 
045600*RETAINED ON OUR TABLES.                                                  
045700 1100-SELECT-TKRPRPM.                                                     
045800                                                                          
045900     EXEC SQL                                                             
046000          SELECT FUNC_QTY                                                 
046100            INTO  :PV-PPCDAY-QTY                                          
046200            FROM TKRPRPM                                                  
046300           WHERE SYS_PRC_FUNC_CDE = 'PPCDAY'                              
046400             WITH UR                                                      
046500     END-EXEC.                                                            
046600                                                                          
046700     EVALUATE TRUE                                                        
046800         WHEN SQLCODE = +0                                                
046900*            CONTINUE                                                     
047000              DISPLAY 'PARM PPCDAY VALUE = ' PV-PPCDAY-QTY                
047100         WHEN SQLCODE = +100                                              
047200              CONTINUE                                                    
047300         WHEN SQLWARN0 NOT = SPACE                                        
047400         WHEN SQLCODE  NOT = +0                                           
047500           DISPLAY '*****************************************'            
047600           DISPLAY '**  ABEND                              **'            
047700           DISPLAY '*****************************************'            
047800           PERFORM 9999-DISPLAY-STATISTICS                                
047900              MOVE '1100-SELECT-TKRPRPM'                                  
048000                                   TO PV-ABEND-PARAGRAPH                  
048100              MOVE 'SELECT FROM TKRPRPM'                                  
048200                                   TO PV-DB2-OPERATION-MESSAGE-1          
048300              PERFORM 9900-DB2-ABEND                                      
048400     END-EVALUATE.                                                        
048500/                                                                         
048600*     P R O C E S S   P R I C E   C H A N G E                    *        
048700* COMPARE ON PRIMARY KEY (PRCHG_ID)                              *        
048800 2000-PROCESS-PRCHG.                                                      
048900     MOVE '2000-PROCESS-PRCHG       ' TO PV-PARAGRAPH-NAME.               
049000*    DISPLAY PV-PARAGRAPH-NAME                                            
049100                                                                          
049200     SET PS-PRICE-CHANGE-COUNT        TO TRUE                             
049300     INITIALIZE XL054-TRANS-REC                                           
049400     MOVE XL055-PRCHG-ID              TO PV-PRCHG-ID                      
049500                                                                          
049600*    DISPLAY 'XL055-PRCHG-ID = ' PV-PRCHG-ID                              
049700*            ' / PE103-PRCHG-ID = ' PE103-PRCHG-ID                        
049800                                                                          
049900     EVALUATE TRUE                                                        
050000                                                                          
050100     WHEN PE103-PRCHG-ID = PV-PRCHG-ID                                    
050200*        DISPLAY 'EQUAL'                                                  
050300        PERFORM 2200-COMPARE-PRCHG-FIELDS                                 
050400        PERFORM 6000-READ-PRCHG-PPC-FILE                                  
050500        PERFORM 6100-READ-PRCHG-DB2-FILE                                  
050600                                                                          
050700     WHEN PE103-PRCHG-ID > PV-PRCHG-ID                                    
050800*        DISPLAY 'PE103-PRCHG-ID > PV-PRCHG-ID '                          
050900*             ' DELETE  '                                                 
051000        MOVE XL055-PRCHG-ID TO DK-PRCHG-ID                                
051100        PERFORM 2010-COUNT-PRCHG                                          
051200                                                                          
051300        IF PV-DB2-COUNT = ZERO                                            
051400                                                                          
051500*          SET XL054-DELETE                                               
051600*              XL054-PRCH             TO TRUE                             
051700*          MOVE 'D'                   TO XL054-PRCH-LAST-ACTN-CDE         
051800           MOVE PC-DEFAULT-TMST       TO XL054-PRCH-LAST-UPD-TMST         
051900           MOVE '09'                  TO XL054-SORT-SEQUENCE              
052000                                                                          
052100           PERFORM 6500-MOVE-DB2-PRCHG-VALUES                             
052200           PERFORM 9800-WRITE-OUTPUT-RECORD                               
052300                                                                          
052400        ELSE                                                              
052500           ADD +1                     TO PA-DB2-PRCHG-HIST-READ           
052600        END-IF                                                            
052700                                                                          
052800        PERFORM 6100-READ-PRCHG-DB2-FILE                                  
052900                                                                          
053000     WHEN PE103-PRCHG-ID < PV-PRCHG-ID                                    
053100                                                                          
053200*        DISPLAY 'PE103-PRCHG-ID < PV-PRCHG-ID '                          
053300*           '  INSERT '                                                   
053400*       SET XL054-INSERT                                                  
053500*           XL054-PRCH                TO TRUE                             
053600                                                                          
053700        MOVE 'A'                      TO XL054-PRCH-LAST-ACTN-CDE         
053800        MOVE PC-DEFAULT-TMST          TO XL054-PRCH-LAST-UPD-TMST         
053900        MOVE '01'                     TO XL054-SORT-SEQUENCE              
054000                                                                          
054100        PERFORM 6400-MOVE-PPC-PRCHG-VALUES                                
054200        PERFORM 9800-WRITE-OUTPUT-RECORD                                  
054300        PERFORM 6000-READ-PRCHG-PPC-FILE                                  
054400     END-EVALUATE.                                                        
054500/                                                                         
054600 2010-COUNT-PRCHG.                                                        
054700     MOVE ZERO            TO  PV-DB2-COUNT.                               
054800                                                                          
054900     EXEC SQL                                                             
055000          SELECT 1                                                        
055100          INTO   :PV-DB2-COUNT                                            
055200          FROM   XLT_PRCHG        A                                       
055300                ,XLT_STR_GP_PRCHG B                                       
055400          WHERE A.PRCHG_ID = B.PRCHG_ID                                   
055500            AND A.PRCHG_ID         =  :DK-PRCHG-ID                        
055600            AND B.PRCHG_EFF_DTE                                           
055700                BETWEEN (DATE(:PV-SYSIN-TIMESTAMP)                        
055800                             - :PV-PPCDAY-QTY DAYS)                       
055900                    AND DATE(:PV-SYSIN-TIMESTAMP)                         
056000                                                                          
056100*               BETWEEN (DATE(:PV-SYSIN-TIMESTAMP)                        
056200*                            - :PV-PPCDAY-QTY DAYS)                       
056300*                   AND CURRENT DATE                                      
056400                                                                          
056500          FETCH FIRST 1 ROW ONLY                                          
056600          WITH UR                                                         
056700     END-EXEC.                                                            
056800                                                                          
056900     EVALUATE TRUE                                                        
057000       WHEN SQLCODE = ZERO                                                
057100       WHEN SQLCODE = +100                                                
057200           CONTINUE                                                       
057300       WHEN OTHER                                                         
057400           DISPLAY '*****************************************'            
057500           DISPLAY '**  ABEND                              **'            
057600           DISPLAY '*****************************************'            
057700           PERFORM 9999-DISPLAY-STATISTICS                                
057800           MOVE '2010-COUNT-PRCHG'   TO PV-ABEND-PARAGRAPH                
057900           MOVE 'COUNT XLT_PRCHG'    TO PV-DB2-OPERATION-MESSAGE-1        
058000           MOVE 'XLT_PRCHG'          TO PV-DB2-TABLE-NAME-1               
058100           MOVE 'XLT_STR_GP_PRCHG'   TO PV-DB2-TABLE-NAME-2               
058200           MOVE  DK-PRCHG-ID         TO PV-DISPLAY-PRCHG-ID               
058300           PERFORM 9900-DB2-ABEND                                         
058400     END-EVALUATE.                                                        
058500                                                                          
058600** COMPARES ALL NON-PRIMARY FIELDS TO SEE IF DIFFERENCES EXIST            
058700 2200-COMPARE-PRCHG-FIELDS.                                               
058800     MOVE '2200-PROCESS-PRCHG             ' TO PV-PARAGRAPH-NAME.         
058900*    DISPLAY PV-PARAGRAPH-NAME                                            
059000                                                                          
059100     IF  XL055-PRCHG-ST-CDE  = PE103-PRCHG-ST-CDE                         
               AND                                                              
               XL055-PRCHG-TYP-CDE = PE103-PRCHG-TYP-CDE                        
059200*        AND                                                              
059300*        XL055-LAST-UPD-TMST = PE103-SOR-LAST-UPD-TMST                    
059400         ADD 1                  TO PA-DB2-PRCHG-UPDATE-SKIP               
059500*        DISPLAY ' SKIP UPDATE PRCHG ' PE103-PRCHG-ID                     
059600                                                                          
059700     ELSE                                                                 
059800                                                                          
059900*       SET XL054-UPDATE                                                  
060000*           XL054-PRCH                TO TRUE                             
060100        MOVE 'U'                      TO XL054-PRCH-LAST-ACTN-CDE         
060200        MOVE PV-SYSIN-TIMESTAMP       TO XL054-PRCH-LAST-UPD-TMST         
060300        MOVE '04'                     TO XL054-SORT-SEQUENCE              
060400                                                                          
060500        PERFORM 6400-MOVE-PPC-PRCHG-VALUES                                
060600        PERFORM 9800-WRITE-OUTPUT-RECORD                                  
060700                                                                          
060800     END-IF.                                                              
060900/                                                                         
061000**COMPLETE PROCESSING OF EXTRACT RECORDS IF THEY EXIST                    
061100 2900-PROCESS-EXTRA-PRCHG-REC.                                            
061200                                                                          
061300     MOVE '2900-PROCESS-EXTRA-PRCHG-REC' TO PV-PARAGRAPH-NAME.            
061400*    DISPLAY PV-PARAGRAPH-NAME                                            
061500                                                                          
061600     INITIALIZE XL054-TRANS-REC                                           
061700                                                                          
061800     IF  PS-NOT-END-OF-PPC-PRCHG                                          
061900*        SET XL054-INSERT                                                 
062000*            XL054-PRCH               TO TRUE                             
062100         MOVE 'A'                     TO XL054-PRCH-LAST-ACTN-CDE         
062200         MOVE PC-DEFAULT-TMST         TO XL054-PRCH-LAST-UPD-TMST         
062300         MOVE '01'                    TO XL054-SORT-SEQUENCE              
062400         PERFORM 6400-MOVE-PPC-PRCHG-VALUES                               
062500         PERFORM 9800-WRITE-OUTPUT-RECORD                                 
062600         PERFORM 6000-READ-PRCHG-PPC-FILE                                 
062700     END-IF.                                                              
062800                                                                          
062900     IF  PS-NOT-END-OF-DB2-PRCHG                                          
063000         MOVE XL055-PRCHG-ID          TO DK-PRCHG-ID                      
063100         PERFORM 2010-COUNT-PRCHG                                         
063200         IF PV-DB2-COUNT = ZERO                                           
063300*           SET XL054-DELETE          TO TRUE                             
063400            MOVE 'D'                  TO XL054-PRCH-LAST-ACTN-CDE         
063500            MOVE PC-DEFAULT-TMST      TO XL054-PRCH-LAST-UPD-TMST         
063600*           SET XL054-DELETE                                              
063700*               XL054-PRCH            TO TRUE                             
063800            MOVE '09'                 TO XL054-SORT-SEQUENCE              
063900            PERFORM 6500-MOVE-DB2-PRCHG-VALUES                            
064000            PERFORM 9800-WRITE-OUTPUT-RECORD                              
064100         ELSE                                                             
064200            ADD +1                    TO PA-DB2-PRCHG-HIST-READ           
064300         END-IF                                                           
064400         PERFORM 6100-READ-PRCHG-DB2-FILE                                 
064500     END-IF.                                                              
064600/                                                                         
064700*     P R O C E S S   S T O R E  G R O U P  P R I C E  C H G     *        
064800* COMPARE ON PRIMARY KEYS (STR_GP_TYP_CDE, STR_GP_ID, PRCHG_ID)  *        
064900 3000-PROCESS-STRGP.                                                      
065000     SET PS-STR-GP-CHANGE-COUNT       TO TRUE                             
065100     MOVE '3000-PROCESS-STRGP             ' TO PV-PARAGRAPH-NAME.         
065200*    DISPLAY PV-PARAGRAPH-NAME                                            
065300                                                                          
065400     INITIALIZE XL054-TRANS-REC                                           
065500                                                                          
065600     MOVE PE104-STR-GP-TYP-CDE TO PV-PPC-STRGP-TYP-CDE                    
065700     MOVE PE104-STR-GP-ID      TO PV-PPC-STRGP-GP-ID                      
065800     MOVE PE104-PRCHG-ID       TO PV-PPC-STRGP-PRCHG-ID                   
065900                                                                          
066000     MOVE XL056-STR-GP-TYP-CDE TO PV-DB2-STRGP-TYP-CDE                    
066100     MOVE XL056-STR-GP-ID      TO PV-DB2-STRGP-GP-ID                      
066200     MOVE XL056-PRCHG-ID       TO PV-DB2-STRGP-PRCHG-ID                   
066300*    DISPLAY 'PV-PPC-STRGP-KEYS= ' PV-PPC-STRGP-KEYS                      
066400*            ' PV-DB2-STRGP-KEYS= ' PV-DB2-STRGP-KEYS                     
066500                                                                          
066600     EVALUATE TRUE                                                        
066700     WHEN PV-PPC-STRGP-KEYS    = PV-DB2-STRGP-KEYS                        
066800          PERFORM 3200-COMPARE-STRGP-FIELDS                               
066900          PERFORM 7000-READ-STRGP-PPC-FILE                                
067000          PERFORM 7100-READ-STRGP-DB2-FILE                                
067100                                                                          
067200     WHEN PV-PPC-STRGP-KEYS    > PV-DB2-STRGP-KEYS                        
067300          MOVE PV-SYSIN-TIMESTAMP  (1:10)                                 
067400                                      TO PV-DB2-CURR-DATE                 
067500          MOVE PV-DB2-MINUS-30-DAYS-DATE                                  
067600                                      TO PV-DB2-PREV-DATE                 
067700                                                                          
067800          EVALUATE TRUE                                                   
067900          WHEN XL056-PRCHG-EFF-DTE > PV-DB2-CURR-DATE                     
068000*            SET XL054-DELETE                                             
068100*                XL054-STR-GP-PRCHG   TO TRUE                             
068200             MOVE 'D'                 TO XL054-STGP-LAST-ACTN-CDE         
068300             MOVE PC-DEFAULT-TMST     TO XL054-STGP-LAST-UPD-TMST         
068400             MOVE '08'                TO XL054-SORT-SEQUENCE              
068500             PERFORM 7500-MOVE-DB2-STRGP-VALUES                           
068600             PERFORM 9800-WRITE-OUTPUT-RECORD                             
068700          WHEN XL056-PRCHG-EFF-DTE < PV-DB2-PREV-DATE                     
068800*            SET XL054-DELETE                                             
068900*                XL054-STR-GP-PRCHG   TO TRUE                             
069000             MOVE 'D'                 TO XL054-STGP-LAST-ACTN-CDE         
069100             MOVE PC-DEFAULT-TMST     TO XL054-STGP-LAST-UPD-TMST         
069200             MOVE '08'                TO XL054-SORT-SEQUENCE              
069300             PERFORM 7500-MOVE-DB2-STRGP-VALUES                           
069400             PERFORM 9800-WRITE-OUTPUT-RECORD                             
069500          WHEN XL056-PRCHG-EFF-DTE >= PV-DB2-PREV-DATE                    
069600             ADD +1                   TO PA-DB2-STRGP-HIST-READ           
069700          END-EVALUATE                                                    
069800                                                                          
069900          PERFORM 7100-READ-STRGP-DB2-FILE                                
070000                                                                          
070100     WHEN PV-PPC-STRGP-KEYS    < PV-DB2-STRGP-KEYS                        
070200*         SET XL054-INSERT                                                
070300*             XL054-STR-GP-PRCHG      TO TRUE                             
070400          MOVE 'A'                    TO XL054-STGP-LAST-ACTN-CDE         
070500          MOVE PC-DEFAULT-TMST        TO XL054-STGP-LAST-UPD-TMST         
070600          MOVE '02'                   TO XL054-SORT-SEQUENCE              
070700          PERFORM 7400-MOVE-PPC-STRGP-VALUES                              
070800          PERFORM 9800-WRITE-OUTPUT-RECORD                                
070900          PERFORM 7000-READ-STRGP-PPC-FILE                                
071000     END-EVALUATE.                                                        
071100/                                                                         
071200** COMPARES ALL NON-PRIMARY FIELDS TO SEE IF DIFFERENCES EXIST            
071300 3200-COMPARE-STRGP-FIELDS.                                               
071400     MOVE '3200-COMPARE-STRGP-FIELDS      ' TO PV-PARAGRAPH-NAME.         
071500*    DISPLAY PV-PARAGRAPH-NAME                                            
071600                                                                          
071700     IF (XL056-PRCHG-EFF-CC         = PE104-PRCHG-EFF-CC                  
071800        AND XL056-PRCHG-EFF-YY      = PE104-PRCHG-EFF-YY                  
071900        AND XL056-PRCHG-EFF-MM      = PE104-PRCHG-EFF-MM                  
072000        AND XL056-PRCHG-EFF-DD      = PE104-PRCHG-EFF-DD)                 
072100         ADD 1                   TO PA-DB2-STRGP-RECS-UPDATE-SKIP         
072200                                                                          
072300*        AND                                                              
072400*        (XL056-LAST-UPD-TMST       = PE104-SOR-LAST-UPD-TMST             
072500*           OR (XL056-LAST-UPD-TMST = PC-DEFAULT-TMST                     
072600*           AND PE104-SOR-LAST-UPD-TMST = SPACES))                        
072700                                                                          
072800        CONTINUE                                                          
072900     ELSE                                                                 
073000*       SET XL054-UPDATE                                                  
073100*           XL054-STR-GP-PRCHG        TO TRUE                             
073200        MOVE '05'                     TO XL054-SORT-SEQUENCE              
073300        MOVE PV-SYSIN-TIMESTAMP       TO XL054-STGP-LAST-UPD-TMST         
073400        MOVE 'U'                      TO XL054-STGP-LAST-ACTN-CDE         
073500                                                                          
073600        PERFORM 7400-MOVE-PPC-STRGP-VALUES                                
073700        PERFORM 9800-WRITE-OUTPUT-RECORD                                  
073800     END-IF.                                                              
073900/                                                                         
074000**COMPLETE PROCESSING OF EXTRACT RECORDS IF THEY EXIST                    
074100 3900-PROCESS-EXTRA-STRGP-REC.                                            
074200                                                                          
074300     MOVE '3900-PROCESS-EXTRA-STRGP-REC' TO PV-PARAGRAPH-NAME.            
074400*    DISPLAY PV-PARAGRAPH-NAME                                            
074500                                                                          
074600     INITIALIZE XL054-TRANS-REC                                           
074700                                                                          
074800     IF  PS-NOT-END-OF-PPC-STRGP                                          
074900*        SET XL054-INSERT                                                 
075000*            XL054-STR-GP-PRCHG       TO TRUE                             
075100         MOVE 'A'                     TO XL054-STGP-LAST-ACTN-CDE         
075200         MOVE PC-DEFAULT-TMST         TO XL054-STGP-LAST-UPD-TMST         
075300         MOVE '02'                    TO XL054-SORT-SEQUENCE              
075400         PERFORM 7400-MOVE-PPC-STRGP-VALUES                               
075500         PERFORM 9800-WRITE-OUTPUT-RECORD                                 
075600         PERFORM 7000-READ-STRGP-PPC-FILE                                 
075700     END-IF.                                                              
075800                                                                          
075900     IF  PS-NOT-END-OF-DB2-STRGP                                          
076000         MOVE PV-SYSIN-TIMESTAMP  (1:10) TO PV-DB2-CURR-DATE              
076100         MOVE PV-DB2-MINUS-30-DAYS-DATE                                   
076200                                      TO PV-DB2-PREV-DATE                 
076300       EVALUATE TRUE                                                      
076400       WHEN XL056-PRCHG-EFF-DTE > PV-DB2-CURR-DATE                        
076500*         SET XL054-DELETE                                                
076600*             XL054-STR-GP-PRCHG      TO TRUE                             
076700          MOVE 'D'                    TO XL054-STGP-LAST-ACTN-CDE         
076800          MOVE PC-DEFAULT-TMST        TO XL054-STGP-LAST-UPD-TMST         
076900          MOVE '08'                   TO XL054-SORT-SEQUENCE              
077000          PERFORM 7500-MOVE-DB2-STRGP-VALUES                              
077100          PERFORM 9800-WRITE-OUTPUT-RECORD                                
077200       WHEN XL056-PRCHG-EFF-DTE < PV-DB2-PREV-DATE                        
077300*         SET XL054-DELETE                                                
077400*             XL054-STR-GP-PRCHG      TO TRUE                             
077500          MOVE 'D'                    TO XL054-STGP-LAST-ACTN-CDE         
077600          MOVE PC-DEFAULT-TMST        TO XL054-STGP-LAST-UPD-TMST         
077700          MOVE '08'                   TO XL054-SORT-SEQUENCE              
077800          PERFORM 7500-MOVE-DB2-STRGP-VALUES                              
077900          PERFORM 9800-WRITE-OUTPUT-RECORD                                
078000       WHEN XL056-PRCHG-EFF-DTE >= PV-DB2-PREV-DATE                       
078100          ADD +1                      TO PA-DB2-STRGP-HIST-READ           
078200       END-EVALUATE                                                       
078300                                                                          
078400       PERFORM 7100-READ-STRGP-DB2-FILE                                   
078500     END-IF.                                                              
078600/                                                                         
078700*     P R O C E S S   P R I C E  C H A N G E  M D S E            *        
078800* COMPARE ON PRIMARY KEYS (STR_GP_TYP_CDE, STR_GP_ID, PRCHG_ID,  *        
078900*                      AND PRCHG_MDSE_ID)                        *        
079000 4000-PROCESS-MDSE.                                                       
079100     MOVE '4000-PROCESS-MDSE              ' TO PV-PARAGRAPH-NAME.         
079200*    DISPLAY PV-PARAGRAPH-NAME                                            
079300                                                                          
079400     SET PS-MDSE-CHANGE-COUNT         TO TRUE                             
079500     INITIALIZE XL054-TRANS-REC                                           
079600                XL054-PRCHG-MDSE-DATA                                     
079700                                                                          
079800     MOVE PE105-STR-GP-TYP-CDE TO PV-PPC-MDSE-TYP-CDE                     
079900     MOVE PE105-STR-GP-ID      TO PV-PPC-MDSE-GP-ID                       
080000     MOVE PE105-PRCHG-ID       TO PV-PPC-MDSE-PRCHG-ID                    
080100     MOVE PE105-PRCHG-MDSE-ID  TO PV-PPC-MDSE-ID                          
080200                                                                          
080300     MOVE XL057-STR-GP-TYP-CDE TO PV-DB2-MDSE-TYP-CDE                     
080400     MOVE XL057-STR-GP-ID      TO PV-DB2-MDSE-GP-ID                       
080500     MOVE XL057-PRCHG-ID       TO PV-DB2-MDSE-PRCHG-ID                    
080600     MOVE XL057-PRCHG-MDSE-ID  TO PV-DB2-MDSE-ID                          
080700                                                                          
080800*    IF PS-FIRST-TIME-YES                                                 
080900*        MOVE XL057-PRCHG-ID          TO PV-PREV-PRCHG-ID                 
081000*        MOVE XL057-STR-GP-ID         TO PV-PREV-STR-GP-ID                
081100*        MOVE XL057-STR-GP-TYP-CDE    TO PV-PREV-STR-GP-TYP-CDE           
081200*        SET PS-FIRST-TIME-NO         TO TRUE                             
081300*    END-IF                                                               
081400                                                                          
081500     ADD 1                            TO PV-DISP-CONTROL                  
081600                                         PV-READ-COUNTER                  
081700     IF PV-DISP-CONTROL > 9999999                                         
081800         EXEC SQL                                                         
081900             SELECT CURRENT TIME                                          
082000             INTO :PV-TIME                                                
082100                 FROM SYSIBM.SYSDUMMY1                                    
082200         END-EXEC                                                         
082300         MOVE PV-READ-COUNTER     TO PV-DISP-NBR                          
082400         DISPLAY PV-TIME                                                  
082500             ' PROCESSING MDSE REC # ' PV-DISP-NBR                        
082600         MOVE ZERO                TO PV-DISP-CONTROL                      
082700     END-IF                                                               
082800                                                                          
082900*    DISPLAY 'PV-PPC-MDSE-KEYS= ' PV-PPC-MDSE-KEYS                        
083000*            ' PV-DB2-MDSE-KEYS= ' PV-DB2-MDSE-KEYS                       
083100                                                                          
083200     EVALUATE TRUE                                                        
083300     WHEN PV-PPC-MDSE-KEYS     = PV-DB2-MDSE-KEYS                         
083400          PERFORM 4200-COMPARE-MDSE-FIELDS                                
083500          PERFORM 8000-READ-MDSE-PPC-FILE                                 
083600          PERFORM 8100-READ-MDSE-DB2-FILE                                 
083700                                                                          
083800     WHEN PV-PPC-MDSE-KEYS     > PV-DB2-MDSE-KEYS                         
083900          MOVE XL057-PRCHG-ID        TO DK-PRCHG-ID                       
084000          MOVE XL057-STR-GP-ID       TO DK-STR-GP-ID                      
084100          MOVE XL057-STR-GP-TYP-CDE  TO DK-STR-GP-TYP-CDE                 
084200          PERFORM 4010-SELECT-PRCHG-EFF-DTE                               
084300          MOVE PV-SYSIN-TIMESTAMP  (1:10) TO PV-DB2-CURR-DATE             
084400          MOVE PV-DB2-MINUS-30-DAYS-DATE                                  
084500                                    TO PV-DB2-PREV-DATE                   
084600          EVALUATE TRUE                                                   
084700          WHEN XLT00033-PRCHG-EFF-DTE > PV-DB2-CURR-DATE                  
084800*           SET XL054-DELETE                                              
084900*               XL054-PRCH-MDSE       TO TRUE                             
085000            MOVE 'D'  TO XL054-MDSE-LAST-ACTN-CDE                         
085100            MOVE PC-DEFAULT-TMST TO XL054-MDSE-LAST-UPD-TMST              
085200            MOVE '07'                 TO XL054-SORT-SEQUENCE              
085300            PERFORM 8500-MOVE-DB2-MDSE-VALUES                             
085400            PERFORM 9800-WRITE-OUTPUT-RECORD                              
085500          WHEN XLT00033-PRCHG-EFF-DTE < PV-DB2-PREV-DATE                  
085600*           SET XL054-DELETE                                              
085700*               XL054-PRCH-MDSE       TO TRUE                             
085800            MOVE 'D'                  TO XL054-MDSE-LAST-ACTN-CDE         
085900            MOVE PC-DEFAULT-TMST      TO XL054-MDSE-LAST-UPD-TMST         
086000            MOVE '07'                 TO XL054-SORT-SEQUENCE              
086100            PERFORM 8500-MOVE-DB2-MDSE-VALUES                             
086200            PERFORM 9800-WRITE-OUTPUT-RECORD                              
086300          WHEN XLT00033-PRCHG-EFF-DTE >= PV-DB2-PREV-DATE                 
086400            ADD +1 TO PA-DB2-MDSE-HIST-READ                               
086500          END-EVALUATE                                                    
086600          PERFORM 8100-READ-MDSE-DB2-FILE                                 
086700                                                                          
086800     WHEN PV-PPC-MDSE-KEYS     < PV-DB2-MDSE-KEYS                         
086900*         SET XL054-INSERT                                                
087000*               XL054-PRCH-MDSE       TO TRUE                             
087100          MOVE 'A'  TO XL054-MDSE-LAST-ACTN-CDE                           
087200          MOVE PC-DEFAULT-TMST        TO XL054-MDSE-LAST-UPD-TMST         
087300          MOVE '03'                   TO XL054-SORT-SEQUENCE              
087400          PERFORM 8400-MOVE-PPC-MDSE-VALUES                               
087500          PERFORM 9800-WRITE-OUTPUT-RECORD                                
087600          PERFORM 8000-READ-MDSE-PPC-FILE                                 
087700     END-EVALUATE.                                                        
087800/                                                                         
087900** GET PRCHG_EFF_DTE FROM STR_GP_PRCHG TABLE TO USE IN COMPARING          
088000** AGAINST CURR DB2 DATE AND CURR DB2 DATE MINUS 30 DAYS.                 
088100 4010-SELECT-PRCHG-EFF-DTE.                                               
088200     IF DK-PRCHG-ID = PV-PREV-PRCHG-ID                                    
088300         AND                                                              
088400         DK-STR-GP-ID = PV-PREV-STR-GP-ID                                 
088500         AND                                                              
088600         DK-STR-GP-TYP-CDE = PV-PREV-STR-GP-TYP-CDE                       
088700             CONTINUE                                                     
088800     ELSE                                                                 
088900         MOVE DK-PRCHG-ID             TO PV-PREV-PRCHG-ID                 
089000         MOVE DK-STR-GP-ID            TO PV-PREV-STR-GP-ID                
089100         MOVE DK-STR-GP-TYP-CDE       TO PV-PREV-STR-GP-TYP-CDE           
089200                                                                          
089300         EXEC SQL                                                         
089400              SELECT PRCHG_EFF_DTE                                        
089500              INTO   :XLT00033-PRCHG-EFF-DTE                              
089600              FROM   XLT_STR_GP_PRCHG A                                   
089700              WHERE                                                       
089800                    A.PRCHG_ID         = :DK-PRCHG-ID                     
089900                AND A.STR_GP_ID        = :DK-STR-GP-ID                    
090000                AND A.STR_GP_TYP_CDE   = :DK-STR-GP-TYP-CDE               
090100              FETCH FIRST 1 ROW ONLY                                      
090200               WITH UR                                                    
090300         END-EXEC                                                         
090400                                                                          
090500*        DISPLAY '4010-SELECT-PRCHG-EFF-DTE' ' '                          
090600*            DK-PRCHG-ID                                                  
090700*            ' / '                                                        
090800*            DK-STR-GP-ID                                                 
090900*            ' / '                                                        
091000*            DK-STR-GP-TYP-CDE                                            
091100*            ' / '                                                        
091200*            XLT00033-PRCHG-EFF-DTE                                       
091300                                                                          
091400     EVALUATE TRUE                                                        
091500       WHEN SQLCODE = ZERO                                                
091600           CONTINUE                                                       
091700       WHEN OTHER                                                         
091800           DISPLAY '*****************************************'            
091900           DISPLAY '**  ABEND                              **'            
092000           DISPLAY '*****************************************'            
092100           PERFORM 9999-DISPLAY-STATISTICS                                
092200           MOVE '4010-SELECT-PRCHG-EFF-DTE' TO PV-ABEND-PARAGRAPH         
092300           MOVE 'SELECT PRCHG_EFF_DTE' TO                                 
092400                               PV-DB2-OPERATION-MESSAGE-1                 
092500           MOVE 'XLT_STR_GP_PRCHG'   TO PV-DB2-TABLE-NAME-1               
092600           MOVE 'XLT_PRCHG_MDSE'     TO PV-DB2-TABLE-NAME-2               
092700           MOVE  DK-PRCHG-ID         TO PV-DISPLAY-PRCHG-ID               
092800           MOVE  DK-STR-GP-ID        TO PV-DISPLAY-STR-GP-ID              
092900           MOVE  DK-STR-GP-TYP-CDE   TO PV-DISPLAY-STR-GP-TYP-CDE         
093000           PERFORM 9900-DB2-ABEND                                         
093100     END-EVALUATE                                                         
093200     END-IF.                                                              
093300/                                                                         
093400** COMPARES ALL NON-PRIMARY FIELDS TO SEE IF DIFFERENCES EXIST            
093500 4200-COMPARE-MDSE-FIELDS.                                                
093600*    MOVE '4200-COMPARE-MDSE-FIELDS      ' TO PV-PARAGRAPH-NAME.          
093700*    DISPLAY PV-PARAGRAPH-NAME                                            
093800                                                                          
093900     IF XL057-UNT-RTL-AMT-NI = '?'                                        
094000        MOVE ZERO                     TO PV-UNT-RTL-AMT                   
094100     ELSE                                                                 
094200        MOVE XL057-UNT-RTL-AMT        TO PV-UNT-RTL-AMT                   
094300     END-IF                                                               
094400                                                                          
093900*    IF XL057-PREV-UNT-RTL-AMT-NI = '?'                                   
094000        MOVE ZERO                     TO PV-PREV-UNT-RTL-AMT              
094100*    ELSE                                                                 
094200*       MOVE XL057-PREV-UNT-RTL-AMT   TO PV-PREV-UNT-RTL-AMT              
094300*    END-IF                                                               
094400                                                                          
094500     MOVE XL057-SKU-NBR               TO PV-SKU-NBR                       
094600                                                                          
094700     IF  (PV-SKU-NBR    = PE105-SKU-NBR                                   
094800            OR (XL057-SKU-NBR-NI = '?'                                    
094900            AND PE105-SKU-NBR-NI = -1))                                   
  5000         AND                                                              
095100            (PV-UNT-RTL-AMT     = PE105-MDSE-PRIC-AMT                     
095200            OR (XL057-UNT-RTL-AMT-NI = '?'                                
  5300            AND PE105-MDSE-PRIC-AMT-NI = -1))                             
  5000*        AND                                                              
095100*           (PV-PREV-UNT-RTL-AMT     = PE105-PREV-MDSE-PRIC-AMT           
095200*           OR (XL057-PREV-UNT-RTL-AMT-NI = '?'                           
  5300*           AND PE105-PREV-MDSE-PRIC-AMT-NI = -1))                        
095400*                                                                         
095500*       AND (XL057-LAST-UPD-TMST = PE105-SOR-LAST-UPD-TMST                
095600*           OR (XL057-LAST-UPD-TMST = PC-DEFAULT-TMST                     
095700*           AND PE105-SOR-LAST-UPD-TMST = SPACES))                        
095800                                                                          
095900         ADD 1                  TO PA-DB2-MDSE-RECS-UPDATE-SKIP           
096000                                                                          
096100     ELSE                                                                 
096200                                                                          
096300*        SET XL054-UPDATE                                                 
096400*            XL054-PRCH-MDSE          TO TRUE                             
096500         MOVE 'U'                     TO XL054-MDSE-LAST-ACTN-CDE         
096600         MOVE PV-SYSIN-TIMESTAMP      TO XL054-MDSE-LAST-UPD-TMST         
096700         MOVE '06'                    TO XL054-SORT-SEQUENCE              
096800         PERFORM 8400-MOVE-PPC-MDSE-VALUES                                
096900         PERFORM 9800-WRITE-OUTPUT-RECORD                                 
097000     END-IF.                                                              
097100/                                                                         
097200**COMPLETE PROCESSING OF EXTRACT RECORDS IF THEY EXIST                    
097300 4900-PROCESS-EXTRA-MDSE-REC.                                             
097400                                                                          
097500     MOVE '4900-PROCESS-EXTRA-MDSE-REC' TO PV-PARAGRAPH-NAME.             
097600*    DISPLAY PV-PARAGRAPH-NAME                                            
097700                                                                          
097800     INITIALIZE XL054-TRANS-REC                                           
097900                XL054-PRCHG-MDSE-DATA                                     
098000                                                                          
098100     IF  PS-NOT-END-OF-PPC-MDSE                                           
098200*        SET XL054-INSERT                                                 
098300*            XL054-PRCH-MDSE          TO TRUE                             
098400         MOVE 'A'                     TO XL054-MDSE-LAST-ACTN-CDE         
098500         MOVE PC-DEFAULT-TMST         TO XL054-MDSE-LAST-UPD-TMST         
098600         MOVE '03'                    TO XL054-SORT-SEQUENCE              
098700         PERFORM 8400-MOVE-PPC-MDSE-VALUES                                
098800         PERFORM 9800-WRITE-OUTPUT-RECORD                                 
098900         PERFORM 8000-READ-MDSE-PPC-FILE                                  
099000     END-IF.                                                              
099100                                                                          
099200     IF  PS-NOT-END-OF-DB2-MDSE                                           
099300         MOVE XL057-PRCHG-ID        TO DK-PRCHG-ID                        
099400         MOVE XL057-STR-GP-ID       TO DK-STR-GP-ID                       
099500         MOVE XL057-STR-GP-TYP-CDE  TO DK-STR-GP-TYP-CDE                  
099600         PERFORM 4010-SELECT-PRCHG-EFF-DTE                                
099700         MOVE PV-SYSIN-TIMESTAMP  (1:10) TO PV-DB2-CURR-DATE              
099800         MOVE PV-DB2-MINUS-30-DAYS-DATE (1:10)                            
099900                                   TO PV-DB2-PREV-DATE                    
100000         EVALUATE TRUE                                                    
100100         WHEN XLT00033-PRCHG-EFF-DTE > PV-DB2-CURR-DATE                   
100200*          SET XL054-DELETE                                               
100300*              XL054-PRCH-MDSE        TO TRUE                             
100400           MOVE 'D'                   TO XL054-MDSE-LAST-ACTN-CDE         
100500           MOVE PC-DEFAULT-TMST TO XL054-MDSE-LAST-UPD-TMST               
100600           MOVE '07'                  TO XL054-SORT-SEQUENCE              
100700           PERFORM 8500-MOVE-DB2-MDSE-VALUES                              
100800           PERFORM 9800-WRITE-OUTPUT-RECORD                               
100900         WHEN XLT00033-PRCHG-EFF-DTE < PV-DB2-PREV-DATE                   
101000*          SET XL054-DELETE                                               
101100*              XL054-PRCH-MDSE        TO TRUE                             
101200           MOVE 'D'                   TO XL054-MDSE-LAST-ACTN-CDE         
101300           MOVE PC-DEFAULT-TMST       TO XL054-MDSE-LAST-UPD-TMST         
101400           MOVE '07'                  TO XL054-SORT-SEQUENCE              
101500           PERFORM 8500-MOVE-DB2-MDSE-VALUES                              
101600           PERFORM 9800-WRITE-OUTPUT-RECORD                               
101700         WHEN XLT00033-PRCHG-EFF-DTE >= PV-DB2-PREV-DATE                  
101800           ADD +1                     TO PA-DB2-MDSE-HIST-READ            
101900         END-EVALUATE                                                     
102000         PERFORM 8100-READ-MDSE-DB2-FILE                                  
102100     END-IF.                                                              
102200/                                                                         
102300 6000-READ-PRCHG-PPC-FILE.                                                
102400     MOVE '6000-READ-PRCHG-PPC-FILE      ' TO PV-PARAGRAPH-NAME.          
102500*    DISPLAY PV-PARAGRAPH-NAME                                            
102600                                                                          
102700     READ PPC-PRCHG-FILE INTO PE103-RECORD                                
102800         AT END                                                           
102900             SET PS-END-OF-PPC-PRCHG                                      
103000                 PS-EMPTY-FILE       TO TRUE                              
103100*        DISPLAY 'EOF PPC-PRCHG-FILE'                                     
103200         NOT AT END                                                       
103300             ADD +1 TO PA-PPC-PRCHG-RECS-READ                             
103400*            IF PE103-PRCHG-ID = 56493 OR 59494                           
103500*                DISPLAY 'TRAP1'                                          
103600*            END-IF                                                       
103700     END-READ.                                                            
103800                                                                          
103900/                                                                         
104000 6100-READ-PRCHG-DB2-FILE.                                                
104100     MOVE '6100-READ-PRCHG-DB2-FILE      ' TO PV-PARAGRAPH-NAME.          
104200*    DISPLAY PV-PARAGRAPH-NAME                                            
104300                                                                          
104400     READ DB2-PRCHG-FILE INTO XL055-DCLXL055                              
104500       AT END                                                             
104600             SET PS-END-OF-DB2-PRCHG                                      
104700                 PS-EMPTY-FILE       TO TRUE                              
104800*        DISPLAY 'EOF DB2-PRCHG-FILE'                                     
104900         NOT AT END                                                       
105000             ADD +1 TO PA-DB2-PRCHG-RECS-READ                             
105100*            IF XL055-PRCHG-ID = 56493 OR 59494                           
105200*                DISPLAY 'TRAP2'                                          
105300*            END-IF                                                       
105400     END-READ.                                                            
105500/                                                                         
105600**MOVES PPC PRCHG EXTRACT VALUES TO OUTPUT FILE                           
105700 6400-MOVE-PPC-PRCHG-VALUES.                                              
105800                                                                          
105900     MOVE PE103-PRCHG-ID              TO XL054-PRCH-PRCHG-ID              
106000     MOVE PE103-PRCHG-ST-CDE          TO XL054-PRCH-PRCHG-ST-CDE.         
106100*    MOVE PE103-SOR-LAST-UPD-TMST     TO XL054-PRCH-LAST-UPD-TMST.        
           MOVE PE103-PRCHG-TYP-CDE         TO XL054-PRCH-TYP-CDE.              
106200/                                                                         
106300**MOVES DB2 PRCHG EXTRACT VALUES TO OUTPUT FILE                           
106400 6500-MOVE-DB2-PRCHG-VALUES.                                              
106500                                                                          
106600     MOVE XL055-PRCHG-ID             TO XL054-PRCH-PRCHG-ID.              
106700     MOVE XL055-PRCHG-ST-CDE         TO XL054-PRCH-PRCHG-ST-CDE.          
           MOVE XL055-PRCHG-TYP-CDE        TO XL054-PRCH-TYP-CDE.               
106800/                                                                         
106900 7000-READ-STRGP-PPC-FILE.                                                
107000     MOVE '7000-READ-STRGP-PPC-FILE      ' TO PV-PARAGRAPH-NAME.          
107100                                                                          
107200     READ PPC-STRGP-FILE INTO PE104-RECORD                                
107300         AT END                                                           
107400             SET PS-END-OF-PPC-STRGP                                      
107500                 PS-EMPTY-FILE       TO TRUE                              
107600*        DISPLAY 'EOF PPC-STRGP-FILE'                                     
107700         NOT AT END                                                       
107800             ADD +1 TO PA-PPC-STRGP-RECS-READ                             
107900     END-READ.                                                            
108000                                                                          
108100/                                                                         
108200 7100-READ-STRGP-DB2-FILE.                                                
108300     MOVE '7100-READ-STRGP-DB2-FILE      ' TO PV-PARAGRAPH-NAME.          
108400*    DISPLAY PV-PARAGRAPH-NAME                                            
108500                                                                          
108600     READ DB2-STRGP-FILE INTO XL056-DCLXL056                              
108700         AT END                                                           
108800             SET PS-END-OF-DB2-STRGP                                      
108900                 PS-EMPTY-FILE       TO TRUE                              
109000*        DISPLAY 'EOF DB2-STRGP-FILE'                                     
109100         NOT AT END                                                       
109200             ADD +1 TO PA-DB2-STRGP-RECS-READ                             
109300     END-READ.                                                            
109400                                                                          
109500/                                                                         
109600                                                                          
109700**MOVES PPC STRGP EXTRACT VALUES TO OUTPUT FILE                           
109800 7400-MOVE-PPC-STRGP-VALUES.                                              
109900                                                                          
110000     MOVE PE104-STR-GP-TYP-CDE   TO XL054-STGP-STR-GP-TYP-CDE             
110100     MOVE PE104-STR-GP-ID        TO XL054-STGP-STR-GP-ID                  
110200     MOVE PE104-PRCHG-ID         TO XL054-STGP-PRCHG-ID                   
110300                                                                          
110400     MOVE PE104-PRCHG-EFF-CC     TO XL054-STGP-PRCHG-EFF-CC               
110500     MOVE PE104-PRCHG-EFF-YY     TO XL054-STGP-PRCHG-EFF-YY               
110600     MOVE PC-DASH                TO XL054-STGP-DASH-1                     
110700     MOVE PE104-PRCHG-EFF-MM     TO XL054-STGP-PRCHG-EFF-MM               
110800     MOVE PC-DASH                TO XL054-STGP-DASH-2                     
110900     MOVE PE104-PRCHG-EFF-DD     TO XL054-STGP-PRCHG-EFF-DD               
111000                                                                          
           IF PE104-SOR-LAST-UPD-TMST = SPACES                                  
               MOVE PC-DEFAULT-TMST    TO XL054-STGP-SOR-CRE-TMST               
           ELSE                                                                 
               MOVE PE104-SOR-LAST-UPD-TMST                                     
                                       TO XL054-STGP-SOR-CRE-TMST               
           END-IF.                                                              
                                                                                
111100*    IF PE104-SOR-LAST-UPD-TMST = SPACES                                  
111200*        MOVE PC-DEFAULT-TMST    TO XL054-STGP-LAST-UPD-TMST              
111300*    ELSE                                                                 
111400*        MOVE PE104-SOR-LAST-UPD-TMST                                     
111500*                                TO XL054-STGP-LAST-UPD-TMST              
111600*    END-IF.                                                              
111700/                                                                         
111800**MOVES DB2 STRGP EXTRACT VALUES TO OUTPUT FILE                           
111900 7500-MOVE-DB2-STRGP-VALUES.                                              
112000                                                                          
112100     MOVE XL056-STR-GP-TYP-CDE   TO XL054-STGP-STR-GP-TYP-CDE             
112200     MOVE XL056-STR-GP-ID        TO XL054-STGP-STR-GP-ID                  
112300     MOVE XL056-PRCHG-ID         TO XL054-STGP-PRCHG-ID                   
           MOVE XL056-SOR-CRE-TMST     TO XL054-STGP-SOR-CRE-TMST               
112400                                                                          
112500     MOVE XL056-PRCHG-EFF-CC     TO XL054-STGP-PRCHG-EFF-CC               
112600     MOVE XL056-PRCHG-EFF-YY     TO XL054-STGP-PRCHG-EFF-YY               
112700     MOVE XL056-PRCHG-EFF-MM     TO XL054-STGP-PRCHG-EFF-MM               
112800     MOVE XL056-PRCHG-EFF-DD     TO XL054-STGP-PRCHG-EFF-DD.              
112900/                                                                         
113000 8000-READ-MDSE-PPC-FILE.                                                 
113100     MOVE '8000-READ-MDSE-PPC-FILE      ' TO PV-PARAGRAPH-NAME.           
113200*    DISPLAY PV-PARAGRAPH-NAME                                            
113300                                                                          
113400     READ PPC-MDSE-FILE INTO PE105-RECORD                                 
113500         AT END                                                           
113600             SET PS-END-OF-PPC-MDSE                                       
113700                 PS-EMPTY-FILE       TO TRUE                              
113800*        DISPLAY 'EOF PPC-MDSE-FILE '                                     
113900         NOT AT END                                                       
114000             ADD +1 TO PA-PPC-MDSE-RECS-READ                              
114100     END-READ.                                                            
114200                                                                          
114300/                                                                         
114400 8100-READ-MDSE-DB2-FILE.                                                 
114500     MOVE '8100-READ-MDSE-DB2-FILE      ' TO PV-PARAGRAPH-NAME.           
114600*    DISPLAY PV-PARAGRAPH-NAME                                            
114700                                                                          
114800     READ DB2-MDSE-FILE INTO XL057-DCLXL057                               
114900       AT END                                                             
115000         SET PS-END-OF-DB2-MDSE                                           
115100             PS-EMPTY-FILE       TO TRUE                                  
115200*        DISPLAY 'EOF DB2-MDSE-FILE '                                     
115300         NOT AT END                                                       
115400             ADD +1 TO PA-DB2-MDSE-RECS-READ                              
115500     END-READ.                                                            
115600/                                                                         
115700**MOVES PPC MDSE EXTRACT VALUES TO OUTPUT FILE                            
115800 8400-MOVE-PPC-MDSE-VALUES.                                               
115900                                                                          
116000     MOVE PE105-STR-GP-TYP-CDE   TO XL054-MDSE-STR-GP-TYP-CDE             
116100     MOVE PE105-STR-GP-ID        TO XL054-MDSE-STR-GP-ID                  
116200     MOVE PE105-PRCHG-ID         TO XL054-MDSE-PRCHG-ID                   
116300     MOVE PE105-PRCHG-MDSE-ID    TO XL054-MDSE-PRCHG-MDSE-ID              
116400                                                                          
116500     MOVE PE105-SKU-NBR           TO XL054-MDSE-SKU-NBR                   
116600     IF PE105-SKU-NBR-NI = -1                                             
116700        SET XL054-MDSE-SKU-NBR-NI TO TRUE                                 
116800     ELSE                                                                 
116900        SET XL054-MDSE-SKU-NBR-NN TO TRUE                                 
117000     END-IF.                                                              
117100                                                                          
117200     MOVE PE105-MDSE-PRIC-AMT         TO XL054-MDSE-UNT-RTL-AMT           
117300     IF PE105-MDSE-PRIC-AMT-NI = -1                                       
117400        SET XL054-MDSE-UNT-RTL-AMT-NI TO TRUE                             
117500     ELSE                                                                 
117600        SET XL054-MDSE-UNT-RTL-AMT-NN TO TRUE                             
117700     END-IF.                                                              
117200     MOVE PE105-PREV-MDSE-PRIC-AMT    TO XL054-PREV-MDSE-RTL-AMT          
117300     IF PE105-PREV-MDSE-PRIC-AMT-NI = -1                                  
117400        SET XL054-PREV-MDSE-RTL-AMT-NI TO TRUE                            
117500     ELSE                                                                 
117600        SET XL054-PREV-MDSE-RTL-AMT-NN TO TRUE                            
117700     END-IF.                                                              
117800                                                                          
117900*    IF PE105-SOR-LAST-UPD-TMST = SPACES                                  
118000*       MOVE PC-DEFAULT-TMST          TO XL054-MDSE-LAST-UPD-TMST         
118100*    ELSE                                                                 
118200*       MOVE PE105-SOR-LAST-UPD-TMST                                      
118300*                                     TO XL054-MDSE-LAST-UPD-TMST         
118400*    END-IF.                                                              
118500/                                                                         
118600**MOVES DB2 MDSE EXTRACT VALUES TO OUTPUT FILE                            
118700 8500-MOVE-DB2-MDSE-VALUES.                                               
118800                                                                          
118900     MOVE XL057-STR-GP-TYP-CDE     TO XL054-MDSE-STR-GP-TYP-CDE           
119000     MOVE XL057-STR-GP-ID          TO XL054-MDSE-STR-GP-ID                
119100     MOVE XL057-PRCHG-ID           TO XL054-MDSE-PRCHG-ID                 
119200     MOVE XL057-PRCHG-MDSE-ID      TO XL054-MDSE-PRCHG-MDSE-ID            
119300                                                                          
119400     MOVE XL057-SKU-NBR           TO XL054-MDSE-SKU-NBR                   
119500     IF XL057-SKU-NBR-NI = '?'                                            
119600        SET XL054-MDSE-SKU-NBR-NI TO TRUE                                 
119700     ELSE                                                                 
119800        SET XL054-MDSE-SKU-NBR-NN TO TRUE                                 
119900     END-IF                                                               
120000                                                                          
120100     MOVE XL057-UNT-RTL-AMT           TO XL054-MDSE-UNT-RTL-AMT           
120200     IF XL057-UNT-RTL-AMT-NI = '?'                                        
120300         SET XL054-MDSE-UNT-RTL-AMT-NI TO TRUE                            
120400     ELSE                                                                 
120500         SET XL054-MDSE-UNT-RTL-AMT-NN TO TRUE                            
120600     END-IF                                                               
120100     MOVE XL057-PREV-UNT-RTL-AMT      TO XL054-PREV-MDSE-RTL-AMT          
120200     IF XL057-PREV-UNT-RTL-AMT-NI = '?'                                   
120300         SET XL054-PREV-MDSE-RTL-AMT-NI TO TRUE                           
120400     ELSE                                                                 
120500         SET XL054-PREV-MDSE-RTL-AMT-NN TO TRUE                           
120600     END-IF                                                               
120700                                                                          
120800     MOVE XL057-LAST-UPD-TMST      TO XL054-MDSE-LAST-UPD-TMST.           
120900/                                                                         
121000 9800-WRITE-OUTPUT-RECORD.                                                
121100                                                                          
121200*    DISPLAY '*'                                                          
121300*    DISPLAY '9800-WRITE-OUTPUT-RECORD'                                   
121400*    DISPLAY XL054-COMMON-AREA                                            
121500                                                                          
121600     EVALUATE XL054-SORT-SEQUENCE                                         
121700     WHEN '01'                                                            
121800         ADD 1                 TO PA-DB2-PRCHG-RECS-INSERT                
121900*        DISPLAY ' INSERT PRCHG ' XL054-PRCH-PRCHG-ID                     
122000     WHEN '02'                                                            
122100         ADD 1                 TO PA-DB2-STRGP-RECS-INSERT                
122200     WHEN '03'                                                            
122300         ADD 1                 TO PA-DB2-MDSE-RECS-INSERT                 
122400     WHEN '04'                                                            
122500         ADD 1                 TO PA-DB2-PRCHG-RECS-UPDATE                
122600*        DISPLAY ' UPDATE PRCHG ' XL054-PRCH-PRCHG-ID                     
122700     WHEN '05'                                                            
122800         ADD 1                 TO PA-DB2-STRGP-RECS-UPDATE                
122900     WHEN '06'                                                            
123000         ADD 1                 TO PA-DB2-MDSE-RECS-UPDATE                 
123100     WHEN '07'                                                            
123200         ADD 1                 TO PA-DB2-MDSE-RECS-DELETE                 
123300     WHEN '08'                                                            
123400         ADD 1                 TO PA-DB2-STRGP-RECS-DELETE                
123500     WHEN '09'                                                            
123600         ADD 1                 TO PA-DB2-PRCHG-RECS-DELETE                
123700*        DISPLAY ' DELETE PRCHG ' XL054-PRCH-PRCHG-ID                     
123800     END-EVALUATE.                                                        
123900                                                                          
124000                                                                          
124100     WRITE OUTPUT-FILE-REC FROM XL054-TRANS-REC.                          
124200                                                                          
124300     ADD +1                   TO PA-DIFFER-RECORD-WRITTEN                 
124400                                 PT-COUNTER (PS-COUNTER-SUB).             
124500                                                                          
124600 9900-DB2-ABEND.                                                          
124700                                                                          
124800     MOVE SQLCODE TO PV-SQLCODE.                                          
124900     DISPLAY '*** DB2 ERROR '.                                            
125000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                               
125100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                         
125200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.                       
125300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.                       
125400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.               
125500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.               
125600     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.                      
125700     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.                      
125800                                                                          
125900     DISPLAY 'PRCHG ID       = ' PV-DISPLAY-PRCHG-ID                      
126000     DISPLAY 'STR GP ID      = ' PV-DISPLAY-STR-GP-ID                     
126100     DISPLAY 'STR GP TYP CDE = ' PV-DISPLAY-STR-GP-TYP-CDE                
126200                                                                          
126300     COPY DPPD004.                                                        
126400                                                                          
126500     MOVE +4013 TO PV-ABEND-CODE.                                         
126600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
126700                                                                          
126800 9999-TERMINATE.                                                          
126900     MOVE '9999-TERMINATE                ' TO PV-PARAGRAPH-NAME.          
127000                                                                          
127100     CLOSE PPC-PRCHG-FILE                                                 
127200           DB2-PRCHG-FILE                                                 
127300           PPC-STRGP-FILE                                                 
127400           DB2-STRGP-FILE                                                 
127500           OUTPUT-FILE.                                                   
127600                                                                          
127700     PERFORM 9999-DISPLAY-STATISTICS.                                     
127800                                                                          
127900****************************************************************          
128000*DISPLAY PROGRAM STATISTICS                                               
128100****************************************************************          
128200 9999-DISPLAY-STATISTICS.                                                 
128300                                                                          
128400     DISPLAY SPACES.                                                      
128500     DISPLAY '**************************************************'.        
128600     DISPLAY 'PROGRAM.................'   PC-CURRENT-PROGRAM-NAME.        
128700                                                                          
128800     MOVE PA-PPC-PRCHG-RECS-READ      TO PV-DISP-NBR                      
128900     DISPLAY 'PPC PRCHG RECS READ     = ' PV-DISP-NBR                     
129000                                                                          
129100     MOVE PA-DB2-PRCHG-RECS-READ      TO PV-DISP-NBR                      
129200     DISPLAY 'DB2 PRCHG RECS READ     = ' PV-DISP-NBR                     
129300                                                                          
129400     MOVE PA-DB2-PRCHG-HIST-READ      TO PV-DISP-NBR                      
129500     DISPLAY 'DB2 PRCHG HIST READ     = ' PV-DISP-NBR                     
129600                                                                          
129700     DISPLAY SPACES                                                       
129800                                                                          
129900     MOVE PA-PPC-STRGP-RECS-READ      TO PV-DISP-NBR                      
130000     DISPLAY 'PPC STRGP RECS READ     = ' PV-DISP-NBR                     
130100                                                                          
130200     MOVE PA-DB2-STRGP-RECS-READ      TO PV-DISP-NBR                      
130300     DISPLAY 'DB2 STRGP RECS READ     = ' PV-DISP-NBR                     
130400                                                                          
130500     MOVE PA-DB2-STRGP-HIST-READ      TO PV-DISP-NBR                      
130600     DISPLAY 'DB2 STRGP HIST READ     = ' PV-DISP-NBR                     
130700     DISPLAY SPACES.                                                      
130800                                                                          
130900     MOVE PA-PPC-MDSE-RECS-READ       TO PV-DISP-NBR                      
131000     DISPLAY 'PPC MDSE RECS READ      = ' PV-DISP-NBR                     
131100                                                                          
131200     MOVE PA-DB2-MDSE-RECS-READ       TO PV-DISP-NBR                      
131300     DISPLAY 'DB2 MDSE RECS READ      = ' PV-DISP-NBR                     
131400                                                                          
131500     MOVE PA-DB2-MDSE-HIST-READ       TO PV-DISP-NBR                      
131600     DISPLAY 'DB2 MDSE HIST READ      = ' PV-DISP-NBR                     
131700                                                                          
131800     DISPLAY SPACES.                                                      
131900                                                                          
132000     MOVE PT-COUNTER (1)              TO PV-DISP-NBR                      
132100     DISPLAY 'DIFFER PRCHG WRITTEN:     '  PV-DISP-NBR                    
132200     MOVE PT-COUNTER (2)              TO PV-DISP-NBR                      
132300     DISPLAY 'DIFFER STRGP WRITTEN:     '  PV-DISP-NBR                    
132400     MOVE PT-COUNTER (3)              TO PV-DISP-NBR                      
132500     DISPLAY 'DIFFER MDSE WRITTEN:      '   PV-DISP-NBR                   
132600                                                                          
132700     DISPLAY '                           ----------'                      
132800                                                                          
132900     MOVE PA-DIFFER-RECORD-WRITTEN    TO PV-DISP-NBR                      
133000     DISPLAY 'DIFFER RECORDS WRITTEN:   '  PV-DISP-NBR                    
133100                                                                          
133200     DISPLAY SPACES                                                       
133300     DISPLAY '************* BREAKDOWN *********************'              
133400     DISPLAY SPACES                                                       
133500                                                                          
133600     MOVE PA-DB2-PRCHG-RECS-INSERT    TO PV-DISP-NBR                      
133700     DISPLAY 'PRCHG INSERT RECS:        ' PV-DISP-NBR                     
133800     MOVE PA-DB2-PRCHG-RECS-UPDATE    TO PV-DISP-NBR                      
133900     DISPLAY 'PRCHG UPDATE RECS:        ' PV-DISP-NBR                     
134000     MOVE PA-DB2-PRCHG-RECS-DELETE    TO PV-DISP-NBR                      
134100     DISPLAY 'PRCHG DELETE RECS:        ' PV-DISP-NBR                     
134200     MOVE PA-DB2-PRCHG-UPDATE-SKIP    TO PV-DISP-NBR                      
134300     DISPLAY 'PRCHG UPDATES SKIPPED     ' PV-DISP-NBR                     
134400                                                                          
134500     DISPLAY SPACES                                                       
134600                                                                          
134700     MOVE PA-DB2-STRGP-RECS-INSERT    TO PV-DISP-NBR                      
134800     DISPLAY 'STRGP INSERT RECS:        ' PV-DISP-NBR                     
134900     MOVE PA-DB2-STRGP-RECS-UPDATE    TO PV-DISP-NBR                      
135000     DISPLAY 'STRGP UPDATE RECS:        ' PV-DISP-NBR                     
135100     MOVE PA-DB2-STRGP-RECS-DELETE    TO PV-DISP-NBR                      
135200     DISPLAY 'STRGP DELETE RECS:        ' PV-DISP-NBR                     
135300     MOVE PA-DB2-STRGP-RECS-UPDATE-SKIP TO PV-DISP-NBR                    
135400     DISPLAY 'STRGP UPDATES SKIPPED     ' PV-DISP-NBR                     
135500                                                                          
135600     DISPLAY SPACES                                                       
135700                                                                          
135800     MOVE PA-DB2-MDSE-RECS-INSERT     TO PV-DISP-NBR                      
135900     DISPLAY 'MDSE  INSERT RECS:        ' PV-DISP-NBR                     
136000     MOVE PA-DB2-MDSE-RECS-UPDATE     TO PV-DISP-NBR                      
136100     DISPLAY 'MDSE  UPDATE RECS:        ' PV-DISP-NBR                     
136200     MOVE PA-DB2-MDSE-RECS-DELETE     TO PV-DISP-NBR                      
136300     DISPLAY 'MDSE  DELETE RECS:        ' PV-DISP-NBR                     
136400     MOVE PA-DB2-MDSE-RECS-UPDATE-SKIP TO PV-DISP-NBR                     
136500     DISPLAY 'MDSE UPDATES SKIPPED:     ' PV-DISP-NBR                     
136600                                                                          
136700                                                                          
136800                                                                          
136900     DISPLAY '**************************************************'.        
