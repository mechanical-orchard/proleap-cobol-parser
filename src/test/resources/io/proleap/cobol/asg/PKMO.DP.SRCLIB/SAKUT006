000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SAKUT006.                                00050001
000600 AUTHOR.                 PAT DOYLE.                               00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            06-03-99.                                00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00121020
001200*  THIS PROGRAM CREATES THE COSA GENERAL LEDGER FILE.            *00122020
001300*                                                                *00130001
001400*  IF THE DEBITS DO NOT EQUAL THE CREDITS ON THE OUTPUT FILE,    *00140001
001500*  A RETURN CODE OF 4090 IS SET TO TELL THE JOB TO DELETE THE    *00150001
001600*  FILE.  ALSO, IN EITHER CASE, AN EMAIL IS CREATED TO SEND,     *00160001
001700*  WHICH TELLS THE AMOUNT OF DEBITS AND CREDITS AND WHETHER      *00170001
001800*  THE GENERAL LEDGER FILE WAS SUCCESSFULLY CREATED.             *00180001
001900*                                                                *00190001
002000*  IF THE GENERAL LEDGER FILE IS SUCCESSFULLY CREATED, THIS      *00200001
002100*  PROGRAM WILL ALSO UPDATE A CONTROL CARD WITH THE WEEK-ENDING  *00210001
002200*  DATE FOR WHICH THE GL FILE IS BEING CREATED, AND AN INDICATOR *00220001
002300*  WHICH TELLS IF IT IS THE END OF THE FISCAL MONTH OR NOT.      *00230001
002400*                                                                *00240001
002500*  IF THE GL FILE IS SUCCESSFULLY CREATED, THE TABLE TSAGLDT     *00250001
002600*  WILL BE UPDATED WITH THE WEEK-ENDING DATE OF THE FILE.        *00260001
002700*                                                                *00270001
002800******************************************************************00280001
002900*  CHANGED 9/06/2001   BY GAYLE HAUPT   WR# 21811                 00290001
003000*                                                                 00300001
003100*  AUTO POST GL PROJECT--INTRODUCED NEW CATEGORY CODES THAT NEED  00310001
003200*  TO BE POSTED TO THE GENERAL LEDGER.                            00320001
003300*  ECR - E-COMMERCE RETURNS        KKT - KCK GIFT CARDS TENDERED  00330001
003400*  GWR - GIFT WRAPPING RETURNS     MAN - MANIFESTO TAX RETURNS    00340001
003500*  GWS - GIFT WRAPPING SALES       PTG - POSTAGE SALES            00350001
003600*  KKB - KCK BACK TO SCHOOL        SPN - SCANNING PENALTY         00360001
003700*  KKH - KCK HOLIDAY SALES         SHR - SHIPPING RETURNS         00370001
003800*  KKS - KCK SPRING SALES          SHS - SHIPPING SALES           00380001
003900*  BRC - BREAST CANCER AWARENESS SALES                            00390001
004000******************************************************************00400001
004100*  CHANGED 12/12/2001   BY GAYLE HAUPT   WR# 23086                00410001
004200*                                                                 00420001
004300*  INCLUDED DEBIT CARD (DBN) CATEGORY CODE IN THE TSAADSU SELECT  00430001
004400*  STATEMENT FOR DEBIT CARD PROJECT.                              00440001
004500******************************************************************00450001
004600*  CHANGED 04/30/2002   BY GAYLE HAUPT   PITS #PM00462537         00460001
004700*                                                                 00470001
004800*  CHANGED TSASUM-CSR TO USE REGISTER ROWS <> ZERO.  SALES        00480001
004900*  CORRECTIONS PUT THROUGH THE SAME DAY THE GL FILE WAS CREATED   00490001
005000*  WERE NOT BEING PICKED UP WHEN USING THE ZERO REGISTER ROWS.    00500001
005100******************************************************************00510001
005200*  CHANGED 05/08/2002   BY GAYLE HAUPT   PITS #PM00462537         00520001
005300*                                                                 00530001
005400*  ADDED ZEROROW-CSR TO PICK UP ZERO REGISTER ROWS.  CATEGORIES   00540001
005500*  KKS, KKT, KKB, KKH, MAN, PTG, SPN WERE NOT BEING PICKED UP AS  00550001
005600*  A RESULT OF THE 04/30/2002 CHANGE.                             00560001
005700******************************************************************00570001
005800*  CHANGED 08/01/2002   BY GAYLE HAUPT   PITS #PM00479457         00580001
005900*                                                                 00590001
006000*  ADDED TEPPART TABLE TO TSASUM-CSR AND ZEROROW-CSR.  THIS WILL  00600001
006100*  PREVENT DATA FROM PARTITIONS 1-4 (TEMPORARY PARTITIONS) FROM   00610001
006200*  BEING ADDED IN THE WEEKLY TOTALS.  CURSORS WILL ONLY RETRIEVE  00620001
006300*  DATA FROM PARTITIONS WITH A STR_GP_CDE OF 'A'.                 00630001
006400******************************************************************00640001
006500******************************************************************00650001
006600*  CHANGED 12/19/2005   BY SCOTT BARTELT   WR #29912              00660001
006700*                                                                 00670001
006800*  STARTING FISCAL 2006 (1/29/2006), EMPLOYEE DISCOUNTS WILL BE   00680001
006900*  REPORTED AS A MARKDOWN INSTEAD OF AN EXPENSE.  THEREFORE, THIS 00690001
007000*  PROGRAM IS BEING CHANGED TO NO LONGER SEND THE DISCOUNT        00700001
007100*  EXPENSE TO GENERAL LEDGER.                                     00710001
007200******************************************************************00720001
007300******************************************************************00730001
007400*  CHANGED 03/05/2008   BY THOMAS HANSON   WR #33714              00740001
007500*                                                                 00750001
007600*  ADDED 'TPC' AND 'TCC' TO GL FILE WRITES AS PART OF BLACKHAWK.  00760001
007700*  THIRD PARTY GIFT CARD SALES.  TPC = THIRD PARTY CARDS SOLD     00770001
007800*                                TCC = THIRD PARTY COMMISSIONS    00780001
007900******************************************************************00790001
008000*  CHANGED 05/19/2008   BY DAN PAYNTER     INC000000367880        00800001
008100*                                                                 00810001
008200*  ALLOW FOR POSSIBILITY OF NO THIRD PARTY CARD TOTALS ON TSASUM. 00820001
008300******************************************************************00830001
008400*  CHANGED 05/22/2008   BY JIM HUNTER      INC000000373417        00840001
008500*                                                                 00850001
008600*  CHANGE ORDER BY ON TSAADDP CURSOR AND CHECK FOR BREAK WHEN     00860001
008700*  A STORE CONVERTS TO USING SOLUTRAN SO THAT PRE-SOLUTRAN AND    00870001
008800*  POST-SOLUTRAN TOTALS ARE GENERATED CORRECTLY.                  00880001
008900*                                                                 00890001
009000******************************************************************00900001
009100*  CHANGED 08/23/2010   BY CHERI PARMLEY   WR38834                00910001
009200*                                                                 00920001
009300*  INCLUDE NEW CATEGORY 'BRC' FOR BREAST CANCER AWARENESS SALES   00930001
009400*                                                                 00940001
009500******************************************************************00950001
009600*  CHANGED 03/17/2011   BY JACKIE HELING   WR39649                00960001
009700*  REMOVE HARDCODING FOR LOCATION 873                             00970001
009800******************************************************************00980001
009900*  CHANGED 07/30/2013   BY DAVID WELLER    CHG 53632              00990001
010000*  INCLUDE NEW CATEGORY 'SFS' FOR SHIP FROM STORE SALES           01000001
010100******************************************************************01010001
010200*  CHANGED 02/13/2014   BY BARB SCHULTZ    CHG 8446E              01020001
010300*  INCLUDE NEW CATEGORY 'BPS' FOR BUY ONLINE PICKUP AT STORE      01030001
010400*                                (bopus)                          01040001
010500******************************************************************01050001
010600*  CHANGED 09/05/2014   BY COGNIZANT       CHG0092405             01060001
010700*  INCLUDE NEW CODES 'WFC' AND 'WRC' TO WRITE THAT IN GL FILE     01070001
010800*                                (Market Places)                  01080001
010900***************************************************************** 01090001
011000*  CHANGED 01/28/2015   BY COGNIZANT        CHG0103444            01100001
011100*  Increase the index variable length to fix SOC7 abend           01110001
011200******************************************************************01120001
011300*  CHANGED 02/20/2015   BY BARB SCHULTZ    CHG0105300             01130001
011400*  CHANGED THE DUE TO WAYFAIR LOGIC BY REARRANGING THE IF         01140001
011500*  STATEMENT.                                                     01150001
011600******************************************************************01160001
011700*  CHANGE CHG0160001 - FIND 'STCFEE'                              01170001
011800*  CHANGED 10/20/2016   BY JIM HUNTER                             01180001
011900*  ADD 'FEE' CATEGORY FOR SALES TAX COMPLIANCE                    01190001
012000*  INCLUDE 'AFE' FEE ADJUSTMENTS CATEGORY IN FEE CALCULATION.     01200001
012100******************************************************************01210001
BOSS  *  CHANGED 03/20/2018   BY BARB SCHULTZ    CHG0188487             01211001
BOSS  *  INCLUDE NEW CATEGORY 'BOS' FOR BUY ONLINE SHIP TO STORE        01212001
BOSS  *  ADD IN 'BSR' AND 'BPR' FOR BOSS AND BOPUS RETURNS.             01213001
010500******************************************************************01214001
12386a*  CHANGED 11/30/2018   BY COGNIZANT                              01214101
12386a*  INCLUDE NEW CATEGORY 'DON' FOR CHARITABLE DONATIONS AND        01214201
12386a*  OFFSETTING CREDIT TO STM.                                      01214301
255393******************************************************************01214401
255393*  CHANGED 03/26/2021   BY Jim Hunter   CHG0255393                01214501
255393*  Add new Sephora categories (TSAADSU TABLE / SAWS006 COPYBOOK)  01214601
255393*  'SCN' - SEPHORA CHARGE NET        (SA006-SEPHORA-CHARGE)       01214701
255393*  'SGS' - SEPHORA GIFT CARD SALES   (SA006-SEPHORA-GC-SALES)     01214801
255393*  'SGT' - SEPHORA GIFT CARD TENDERS (SA006-SEPHORA-GC-TENDERED)  01214901
255393******************************************************************01215001
MKTPLC*  CHANGED 04/07/2022   BY Jim Hunter   CHG0268311                01215101
MKTPLC*  Add new MARKETPLACE categories (TSASUM / SAWS006 COPYBOOK)     01215201
MKTPLC*  'MSS' - Marketplace Seller Sale                                01215301
MKTPLC*  'MSR' - Marketplace Seller Return                              01215401
MKTPLC*  'MCS' - Marketplace Commissions Sale                           01215501
MKTPLC*  'MCR' - Marketplace Commissions Return                         01215601
MKTPLC*  'MMS' - Marketplace Mirakl Sale                                01215701
MKTPLC*  'MMR' - Marketplace Mirakl Return                              01215801
MKTPLC*  Also removing Sephora and Wayfair logic.                       01215901
MKTPLC*  New Sephora logic will be required for Gift Cards in the next  01216001
MKTPLC*  change.                                                        01216101
MKTPLC******************************************************************01216201
SEPHOR*  CHANGED 04/20/2022   BY Jim Hunter   CHG0269309                01216307
SEPHOR*  Add new Sephora categories (TSASUM TABLE / SAWS006 COPYBOOK)   01216502
SEPHOR*  'SGS' - SEPHORA GIFT CARD SALES   (SA006-SEPHORA-GC-SALES)     01216602
SEPHOR*  'SGT' - SEPHORA GIFT CARD TENDERS (SA006-SEPHORA-GC-TENDERED)  01216702
SEPHOR******************************************************************01216802
MKTPL2*  CHANGED 07/13/2022   BY Jim Hunter   CHG0272489                01216911
MKTPL2*  Convert from using the marketplace categories calculated by    01217008
MKTPL2*  the batch process in register zero to using the marketplace    01217108
MKTPL2*  categories calculated by the Sales Hub in the non-zero         01217208
MKTPL2*  registers.  Also, KEEP the subtraction of the marketplace      01217309
MKTPL2*  categories from the sales and returns categories as the        01217408
MKTPL2*  Sales Hub will STILL be including them in those categories.    01217509
MKTPL2*  The Mirakl categories (MMS and MMR) will no longer be used.    01217608
012300******************************************************************01217708
ZX    *  CHANGED 07/17/2022   BY DAN PAYNTER  CHG0272489                01217811
ZX    *  FIX ISSUE IGNORING LATES FOR THE TCC (THIRD PARTY GIFT CARD    01217910
ZX    *  COMMISSIONS)                                                   01218010
ZX    ******************************************************************01218110
STRFNT*  CHANGED 10/04/2022   BY JIM HUNTER    CHG0275578               01218215
STRFNT*  BYPASS STOREFRONT (STORE 6666) TOTALS WHICH CAUSE GL TO FAIL.  01218312
STRFNT******************************************************************01218512
TPCFIX*  CHANGED 11/22/2022   BY JIM HUNTER    CHG0278871               01218619
TPCFIX*  POC AND THE SALES HUB ADD SEPHORA GIFT CARD DOLLARS INTO THE   01218716
TPCFIX*  TSAADSU AND TSASUM TPC BUCKETS AND THEY NEED TO BE SUBTRACTED  01218816
TPCFIX*  OUT BEFORE THE THIRD PARTY CARD NUMBERS GO TO GL.              01218916
TPCFIX*  THE ORIGINAL SEPHORA CHANGES SUBTRACTED SGS FROM GDS.          01219017
TPCFIX*  THE ORIGINAL SEPHORA CHANGES ALSO SUBTRACTED SGT FROM GDT,     01219117
TPCFIX*  WHICH IS STILL CORRECT.                                        01219217
TPCFIX******************************************************************01219317
COBRND*  CHANGED 02/23/2023   BY JIM HUNTER    CHG0284865               01219428
COBRND*  THESE CHANGES ARE FOR THE NEW COBRAND VISA CHARGE CARDS.       01219523
COBRND*  2 NEW CATEGORIES WILL BE NEEDED FOR GL:                        01219623
COBRND*  COBRAND VISA NET (CVN)                                         01219723
COBRND*  COBRAND VISA Payments (CVP)                                    01219823
COBRND*  THEY WILL COME FROM THE TSASUM TABLE.                          01219923
COBRND*  IN THE TSAADSU CASH OFFICE TABLE THEY WILL BE INCLUDED IN THE  01220023
COBRND*  BCN (BANK CARD NET) AND KCP (KOHL'S CHARGE PAYMENTS)           01220123
COBRND*  CATEGORIES.                                                    01220223
COBRND*  CVN WILL BE SUBTRACTED FROM BCN BEFORE THEY ARE SENT TO GL.    01220326
COBRND*  CVP WILL BE SUBTRACTED FROM KCP BEFORE THEY ARE SENT TO GL.    01220426
COBRND******************************************************************01220823
PAYVEN*  CHANGED 08/23/2023   BY JIM HUNTER    CHG0289055               01223846
PAYVEN*  THESE CHANGES ARE FOR THE NEW PAYPAL AND VENMO CARDS.          01223943
PAYVEN*  2 NEW CATEGORIES WILL BE NEEDED FOR GL:                        01224043
PAYVEN*  PAYPAL NET (PPN)                                               01224143
PAYVEN*  VENMO NET (vmn)                                                01224243
SOLTRN*  REMOVE SOLUTRAN CONTROL CARD AND LOGIC.                        01224346
SOLTRN*  CHANGE TSAADDP-CURSOR TO SUM THE 7 DAYS OF DEPOSITS AND ADD    01224446
SOLTRN*  A GROUP BY STORE AND TENDER TYPE SO THAT ALL OF THE ORIGINAL   01224546
SOLTRN*  LOGIC THAT SUMMED AND CHECKED FOR STORE BREAKS CAN BE REPLACED 01224646
SOLTRN*  WITH SIMPLE FETCH AND WRITE PROCESSING.                        01224746
PAYVEN******************************************************************01224843
COBTRL*  CHANGED 10/23/2023   BY JIM HUNTER    CHG0295722               01224946
COBTRL*  ADDING LOGIC TO ADJUST CATEGORIES FOR COBRAND TRAILING         01225046
COBTRL*  TRANSACTIONS.  THESE TRANSACTIONS ARE THOSE MADE AGAINST       01225146
COBTRL*  KOHL'S CHARGE ACCOUNTS FOR CUSTOMERS WHO NOW HAVE COBRAND      01225246
COBTRL*  ACCOUNTS INSTEAD.                                              01225346
COBTRL*  THEY WILL COME FROM THE TSASUM TABLE, REGISTER ZERO, CATEGORIES01225446
COBTRL*  TTN (COBRAND TRAILING NET) AND TTP (COBRAND TRAILING PAYMENTS).01225546
COBTRL*  TTN WILL BE SUBTRACTED FROM KCN BEFORE KCN IS SENT TO GL.      01225646
COBTRL*  TTN WILL BE ADDED TO CVN BEFORE CVN IS SENT TO GL.             01225746
COBTRL*  TTP WILL BE SUBTRACTED FROM KCP BEFORE KCP IS SENT TO GL.      01225846
COBTRL*  TTP WILL BE ADDED TO CVP BEFORE CVP IS SENT TO GL.             01225946
COBTR2*  ADDED LOGIC TO DETERMINE IF THERE ARE COBRAND TRAILING         01226146
COBTR2*  TRANSACTIONS (TTN OR TTP) THAT WEREN'T PICKED UP IN THE TSASUM 01226246
COBTR2** PARAGRAPH BECAUSE THE STORE HAD NO COBRAND SALES (CVN) OR      01226346
COBTR2** PAYMENTS (CVP) FOR THE WEEK.                                   01226446
COBTR2** THE KCN AND KCP PARAGRAPHS WOULD THEN READ THE TRAILING TRANS, 01226546
COBTR2** CREATE THE CVN OR CVP GL RECORDS AND INCREMENT THE             01226646
COBTR2** KCN OR KCP GL RECORDS.                                         01226746
COBTRF** NEEDED TO INCREMENT A SIGNED FIELD AND THEN MOVE IT TO         01226846
COBTRF** GL002-MONETARY-AMT, WHICH ISN'T SIGNED, TO AVOID A PROBLEM     01226946
COBTRF** WHEN IT IS NEGATIVE.                                           01227046
COBTRL******************************************************************01227146
012300                                                                  01227243
012400 ENVIRONMENT DIVISION.                                            01227343
012500******************************************************************01227443
012600                                                                  01227543
012700 CONFIGURATION SECTION.                                           01227643
012800                                                                  01227743
012900 SOURCE-COMPUTER.        IBM-3090.                                01227843
013000 OBJECT-COMPUTER.        IBM-3090.                                01227943
013100                                                                  01228043
013200 INPUT-OUTPUT SECTION.                                            01229037
013300                                                                  01230001
013400 FILE-CONTROL.                                                    01240001
013500                                                                  01250001
013900     SELECT GENERAL-LEDGER-FILE                                   01290001
014000         ASSIGN TO OUT01.                                         01300001
014100                                                                  01310001
014200     SELECT EMAIL-FILE                                            01320001
014300         ASSIGN TO OUT02.                                         01330001
014400                                                                  01340001
014500     SELECT ML-CONTROL-OUT                                        01350001
014600         ASSIGN TO OUT03.                                         01360001
014700                                                                  01370001
014800******************************************************************01380001
014900 DATA DIVISION.                                                   01390001
015000******************************************************************01400001
015100                                                                  01410001
015200 FILE SECTION.                                                    01420001
015300                                                                  01430001
016100 FD  GENERAL-LEDGER-FILE                                          01510001
016200     RECORDING MODE IS F                                          01520001
016300     LABEL RECORDS ARE STANDARD                                   01530001
016400     BLOCK CONTAINS 0 RECORDS.                                    01540001
016500                                                                  01550001
016600 01  GENERAL-LEDGER-RECORD       PIC X(180).                      01560001
016700                                                                  01570001
016800 FD  EMAIL-FILE                                                   01580001
016900     RECORDING MODE IS F                                          01590001
017000     LABEL RECORDS ARE STANDARD                                   01600001
017100     BLOCK CONTAINS 0 RECORDS.                                    01610001
017200                                                                  01620001
017300 01  EMAIL-RECORD                PIC X(80).                       01630001
017400                                                                  01640001
017500 FD  ML-CONTROL-OUT                                               01650001
017600     RECORDING MODE IS F                                          01660001
017700     LABEL RECORDS ARE STANDARD                                   01670001
017800     BLOCK CONTAINS 0 RECORDS.                                    01680001
017900                                                                  01690001
018000 01  ML-CONTROL-RECORD           PIC X(80).                       01700001
018100                                                                  01710001
018200 WORKING-STORAGE SECTION.                                         01720001
018300                                                                  01730001
018400*                                                                 01740001
018500*  GENERAL LEDGER OUTPUT FILE                                     01750001
018600*                                                                 01760001
018700                                                                  01770001
018800     COPY GLRD002.                                                01780001
018900                                                                  01790001
019000                                                                  01800001
019100 01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         01810001
019200                                 COMP SYNC.                       01820001
019300     88  ABEND-4003-CC-ERROR                       VALUE +4003.   01830001
019400     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   01840001
019500     88  ABEND-4019-CAL-ERROR                      VALUE +4019.   01850001
019600                                                                  01860001
019700 01  DK-DB2-KEYS.                                                 01870001
019800     05  DK-BEGIN-DATE-ISO       PIC X(10)    VALUE SPACES.       01880001
019900     05  DK-END-DATE-ISO         PIC X(10)    VALUE SPACES.       01890001
020000     05  DK-BEGIN-PARTITION      PIC S9(04)   COMP                01900001
020100                                              VALUE ZERO.         01910001
020200     05  DK-END-PARTITION        PIC S9(04)   COMP                01920001
020300                                              VALUE ZERO.         01930001
020400                                                                  01940001
020500 01  PS-PROGRAM-SWITCHES.                                         01950001
020600     05  PS-END-OF-CURSOR-SW     PIC X(01)    VALUE 'N'.          01960001
020700         88  PS-END-OF-CURSOR                 VALUE 'Y'.          01970001
020800         88  PS-NOT-END-OF-CURSOR             VALUE 'N'.          01980001
020900     05  PS-END-OF-STORE-FILE-SW   PIC X(01)  VALUE 'N'.          01990001
021000         88  PS-END-OF-STORE-FILE             VALUE 'Y'.          02000001
021100         88  PS-NOT-END-OF-STORE-FILE         VALUE 'N'.          02010001
021200     05  PS-FIRST-TIME-THRU-SW   PIC X(01)    VALUE 'N'.          02020001
021300         88  PS-FIRST-TIME-THRU-YES           VALUE 'Y'.          02030001
021400         88  PS-FIRST-TIME-THRU-NO            VALUE 'N'.          02040001
021500     05  PS-SCAN-PENALTY-SW      PIC X(01)    VALUE 'N'.          02050001
021600         88  PS-SCAN-PENALTY-YES              VALUE 'Y'.          02060001
021700         88  PS-SCAN-PENALTY-NO               VALUE 'N'.          02070001
022100     05  PS-STORES-SW            PIC X(01)    VALUE 'N'.          02110001
022200         88  PS-ALL-STORES                    VALUE 'Y'.          02120001
022300         88  PS-NOT-ALL-STORES                VALUE 'N'.          02130001
022400                                                                  02140001
022500 01  PC-PROGRAM-CONSTANTS.                                        02150001
022600     05  PC-CURRENT-PROGRAM-NAME PIC X(08)    VALUE 'SAKUT006'.   02160001
022700     05  PC-BUSINESS-UNIT        PIC X(03)    VALUE 'KDS'.        02170001
022800     05  PC-OPERATIONAL-TABLES   PIC X(01)    VALUE 'O'.          02180001
022900     05  PC-STORE-GROUP-CODE     PIC X(01)    VALUE 'A'.          02190001
023000*    05  PC-WEBSTORE             PIC 9(03)    VALUE 873.          02200001
023100     05  PC-CASH-CHECK-DEPOSIT   PIC X(03)    VALUE 'CCD'.        02210001
023200     05  PC-REGISTER-OVER-SHORT-MSG PIC X(20)                     02220001
023300                     VALUE 'RGSTR (OVR)SHORT WE:'.                02230001
023400     05  PC-SAFE-OVER-SHORT-MSG     PIC X(20)                     02240001
023500                     VALUE 'SAFE (OVR) SHORT WE:'.                02250001
023600     05  PC-SUM-CTG-CDE          PIC  X(03).                      02260001
023700         88  PC-SUM-CTG-CDE-SHS               VALUE 'SHS'.        02270001
023800         88  PC-SUM-CTG-CDE-SHR               VALUE 'SHR'.        02280001
023900         88  PC-SUM-CTG-CDE-GWS               VALUE 'GWS'.        02290001
024000         88  PC-SUM-CTG-CDE-GWR               VALUE 'GWR'.        02300001
024100         88  PC-SUM-CTG-CDE-ECR               VALUE 'ECR'.        02310001
024200         88  PC-SUM-CTG-CDE-KKB               VALUE 'KKB'.        02320001
024300         88  PC-SUM-CTG-CDE-BRC               VALUE 'BRC'.        02330001
024400         88  PC-SUM-CTG-CDE-KKH               VALUE 'KKH'.        02340001
024500         88  PC-SUM-CTG-CDE-KKU               VALUE 'KKU'.        02350001
024600         88  PC-SUM-CTG-CDE-KKS               VALUE 'KKS'.        02360001
024700         88  PC-SUM-CTG-CDE-KKT               VALUE 'KKT'.        02370001
024800         88  PC-SUM-CTG-CDE-MAN               VALUE 'MAN'.        02380001
024900         88  PC-SUM-CTG-CDE-PTG               VALUE 'PTG'.        02390001
025000         88  PC-SUM-CTG-CDE-SPN               VALUE 'SPN'.        02400001
025100         88  PC-SUM-CTG-CDE-SFS               VALUE 'SFS'.        02410001
025200         88  PC-SUM-CTG-CDE-BPS               VALUE 'BPS'.        02420001
025600         88  PC-SUM-CTG-CDE-FEE               VALUE 'FEE'.        02430001
025700         88  PC-SUM-CTG-CDE-AFE               VALUE 'AFE'.        02440001
BOSS           88  PC-SUM-CTG-CDE-BOS               VALUE 'BOS'.        02450001
BOSS           88  PC-SUM-CTG-CDE-BSR               VALUE 'BSR'.        02460001
BOSS           88  PC-SUM-CTG-CDE-BPR               VALUE 'BPR'.        02470001
12386a         88  PC-SUM-CTG-CDE-DON               VALUE 'DON'.        02480001
MKTPLC         88  PC-SUM-CTG-CDE-MSS               VALUE 'MSS'.        02490001
MKTPLC         88  PC-SUM-CTG-CDE-MSR               VALUE 'MSR'.        02500001
MKTPLC         88  PC-SUM-CTG-CDE-MCS               VALUE 'MCS'.        02510001
MKTPLC         88  PC-SUM-CTG-CDE-MCR               VALUE 'MCR'.        02520001
MKTPL2*        88  PC-SUM-CTG-CDE-MMS               VALUE 'MMS'.        02530008
MKTPL2*        88  PC-SUM-CTG-CDE-MMR               VALUE 'MMR'.        02540008
SEPHOR         88  PC-SUM-CTG-CDE-SGS               VALUE 'SGS'.        02541003
SEPHOR         88  PC-SUM-CTG-CDE-SGT               VALUE 'SGT'.        02542003
COBRND         88  PC-SUM-CTG-CDE-CVN               VALUE 'CVN'.        02543025
COBRND         88  PC-SUM-CTG-CDE-CVP               VALUE 'CVP'.        02544025
025800                                                                  02550001
025900 01  PT-PROGRAM-TOTALS.                                           02560001
026000     05  PT-DEBITS               PIC S9(11)V99  VALUE ZEROS       02570001
026100                                 COMP-3.                          02580001
026200     05  PT-CREDITS              PIC S9(11)V99  VALUE ZEROS       02590001
026300                                 COMP-3.                          02600001
026400     05  PT-GL-RECORDS-WRITTEN   PIC S9(11)   VALUE ZEROS         02610001
026500                                 COMP-3.                          02620001
026600                                                                  02630001
026700 01  PV-PROGRAM-VARIABLES.                                        02640001
026800     05  PV-SUM-TPC-NULL-IND     PIC S9(4) COMP VALUE +0.         02650001
026900     05  PV-DB2-FUNCTION         PIC X(30)    VALUE SPACES.       02660001
027000     05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       02670001
027100     05  PV-STR-NBR-NUMERIC      PIC 9(04)    VALUE ZEROES.       02680001
COBTR2     05  PV-TBL-STORE            PIC S9(04)  COMP  VALUE ZEROES.  02701040
027400     05  PV-SUM-CTG-CDE          PIC X(03)    VALUE SPACES.       02710001
027500     05  PV-STORE-NUMBER-X.                                       02720001
027600         10  PV-STORE-NUMBER     PIC 9(04).                       02730001
027700     05  PV-DEBIT-HOLD-AMT       PIC S9(13)V99 COMP-3 VALUE ZERO. 02740001
027800     05  PV-SUM-CTG-AMT          PIC S9(13)V99                    02750001
027900                                              COMP-3 VALUE ZERO.  02760001
028000     05  PV-COMMISSIONS-AMT      PIC S9(13)V99                    02770001
028100                                              COMP-3 VALUE ZERO.  02780001
COBTRL     05  PV-TTN-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02791032
COBTRL     05  PV-TTP-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02792032
COBTR2     05  PV-TRAIL-AMOUNT         PIC ---,---,--9.99  VALUE ZERO.  02792140
COBTRL     05  PV-TTN-TOTAL            PIC S9(9)V99 COMP-3 VALUE ZERO.  02792334
COBTRL     05  PV-TTP-TOTAL            PIC S9(9)V99 COMP-3 VALUE ZERO.  02792434
028200     05  PV-FEE-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02793029
028300     05  PV-HOLD-GL-AMT          PIC S9(13)V99                    02800001
028400                                              COMP-3 VALUE ZERO.  02810001
028600     05  PV-TBL-SUB              PIC S9(05)   COMP VALUE ZERO.    02830001
028700     05  PV-CURRENT-DATE.                                         02840001
028800         10  PV-CURRENT-CCYY     PIC X(04).                       02850001
028900         10  PV-CURRENT-MM       PIC X(02).                       02860001
029000         10  PV-CURRENT-DD       PIC X(02).                       02870001
029100     05  PV-CURRENT-DATE-ISO.                                     02880001
029200         10  PV-CURRENT-CCYY-ISO PIC X(04).                       02890001
029300         10  FILLER              PIC X(01)    VALUE '-'.          02900001
029400         10  PV-CURRENT-MM-ISO   PIC X(02).                       02910001
029500         10  FILLER              PIC X(01)    VALUE '-'.          02920001
029600         10  PV-CURRENT-DD-ISO   PIC X(02).                       02930001
029700                                                                  02940001
029800**  THE PV-HOLD-AMTS-TABLE WILL HOLD AMOUNTS THAT ACCUMULATE      02950001
029900**  AS A RESULT OF THE NEW CATEGORIES FROM THE AUTO POST GL       02960001
030000**  PROJCT.  THE ACCUMULATED AMOUNTS WILL BE ADDED/SUBTRACTED     02970001
030100**  FROM THE VARIOUS DEBIT/CREDIT AMOUNTS FOR THE CATEGORIES      02980001
030200**  LISTED IN THE TABLE.                                          02990001
030300 01  PV-HOLD-AMTS-TABLE.                                          03000001
030400     05  PV-HOLD-AMTS-TBL        OCCURS 9999 TIMES.               03010001
030500         10  PV-HOLD-STM-AMT     PIC S9(13)V99 COMP-3.            03020001
030600         10  PV-HOLD-TMR-AMT     PIC S9(13)V99 COMP-3.            03030001
TPCFIX         10  PV-HOLD-TPC-AMT     PIC S9(13)V99 COMP-3.            03040016
030700         10  PV-HOLD-GDT-AMT     PIC S9(13)V99 COMP-3.            03041003
030800         10  PV-HOLD-SSE-AMT     PIC S9(13)V99 COMP-3.            03050001
COBRND         10  PV-HOLD-BCN-AMT     PIC S9(13)V99 COMP-3.            03051025
COBRND         10  PV-HOLD-KCP-AMT     PIC S9(13)V99 COMP-3.            03052025
COBTRL         10  PV-HOLD-KCN-AMT     PIC S9(13)V99 COMP-3.            03053029
COBTR2         10  PV-HOLD-CVN-FOUND   PIC X.                           03054037
COBTR2         10  PV-HOLD-CVP-FOUND   PIC X.                           03055037
031200                                                                  03060001
031800 01  DATE-CONTROL-CARD.                                           03120001
031900     05  CC-WEEK-ENDING-DATE-ISO.                                 03130001
032000         10  CC-WEEK-ENDING-CC   PIC X(02).                       03140001
032100         10  CC-WEEK-ENDING-YY   PIC X(02).                       03150001
032200         10  FILLER              PIC X(01).                       03160001
032300         10  CC-WEEK-ENDING-MM   PIC X(02).                       03170001
032400         10  FILLER              PIC X(01).                       03180001
032500         10  CC-WEEK-ENDING-DD   PIC X(02).                       03190001
032600     05  FILLER                  PIC X(70).                       03200001
032700                                                                  03210001
032800 01  TD-TOTAL-DISPLAY-MESSAGE.                                    03220001
032900     05  TD-TOTAL-ID             PIC X(45)    VALUE SPACES.       03230001
033000         88  TD-DEBITS                        VALUE               03240001
033100             'DEBITS . . . . . . . . . . . . . . . . . . . '.     03250001
033200         88  TD-CREDITS                       VALUE               03260001
033300             'CREDITS. . . . . . . . . . . . . . . . . . . '.     03270001
033400         88  TD-GL-RECORDS-WRITTEN            VALUE               03280001
033500             'GL RECORDS WRITTEN . . . . . . . . . . . . . '.     03290001
033600     05  TD-TOTAL-AMOUNT         PIC ZZ,ZZZ,ZZZ,ZZZ.ZZ            03300039
033700                                              VALUE ZEROS.        03310001
033800                                                                  03320001
033900 01  EM-EMAIL-LINE1.                                              03330001
034000     05  FILLER                  PIC X(50)    VALUE               03340001
034100         'General Ledger file was successfully created for: '.    03350001
034200     05  EM-LINE1-DATE           PIC X(10)    VALUE SPACES.       03360001
034300     05  FILLER                  PIC X(14)    VALUE SPACES.       03370001
034400     05  FILLER                  PIC X(06)    VALUE SPACES.       03380001
034500                                                                  03390001
034600 01  EM-EMAIL-LINE2A.                                             03400001
034700     05  FILLER                  PIC X(41)    VALUE               03410001
034800         'General Ledger file was NOT created for: '.             03420001
034900     05  EM-LINE2A-DATE          PIC X(10)    VALUE SPACES.       03430001
035000     05  FILLER                  PIC X(23)    VALUE SPACES.       03440001
035100     05  FILLER                  PIC X(06)    VALUE SPACES.       03450001
035200                                                                  03460001
035300 01  EM-EMAIL-LINE2B.                                             03470001
035400     05  FILLER                  PIC X(33)    VALUE               03480001
035500         'DEBITS AND CREDITS ARE NOT EQUAL.'.                     03490001
035600     05  FILLER                  PIC X(41)    VALUE SPACES.       03500001
035700     05  FILLER                  PIC X(06)    VALUE SPACES.       03510001
035800                                                                  03520001
035900 01  EM-EMAIL-LINE3.                                              03530001
036000     05  FILLER                  PIC X(09)    VALUE               03540001
036100         'Debits:  '.                                             03550001
036200     05  EM-LINE3-DEBITS         PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99       03560001
036300                                              VALUE ZERO.         03570001
036400     05  FILLER                  PIC X(43)    VALUE SPACES.       03580001
036500     05  FILLER                  PIC X(06)    VALUE SPACES.       03590001
036600                                                                  03600001
036700 01  EM-EMAIL-LINE4.                                              03610001
036800     05  FILLER                  PIC X(09)    VALUE               03620001
036900         'Credits: '.                                             03630001
037000     05  EM-LINE4-CREDITS        PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99       03640001
037100                                              VALUE ZERO.         03650001
037200     05  FILLER                  PIC X(43)    VALUE SPACES.       03660001
037300     05  FILLER                  PIC X(06)    VALUE SPACES.       03670001
037400                                                                  03680001
037500 01  EM-EMAIL-LINE5.                                              03690001
037600     05  FILLER                  PIC X(32)    VALUE               03700001
037700         'E-COMMERCE TMR CREDIT GENERATED '.                      03710001
037800     05  EM-LINE5-E-COM-CR       PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99       03720001
037900                                              VALUE ZEROS.        03730001
038000                                                                  03740001
038100 01  EM-EMAIL-BLANK-LINE         PIC X(80)    VALUE SPACES.       03750001
038200                                                                  03760001
038300 01  ML-CONTROL-AREA.                                             03770001
038400     05  ML-CONTROL-DATE         PIC X(10)    VALUE SPACES.       03780001
038500     05  ML-CURRENT-DATE         PIC X(10)    VALUE SPACES.       03790001
038600     05  ML-LAST-WEEK-IND        PIC X(01)    VALUE SPACES.       03800001
038700         88  ML-LAST-FISCAL-WEEK              VALUE 'Y'.          03810001
038800         88  ML-NOT-LAST-FISCAL-WEEK          VALUE 'N'.          03820001
038900     05  FILLER                  PIC X(59)    VALUE SPACES.       03830001
039000                                                                  03840001
039100*---------------------------------------------------------------* 03850001
039200*    DATE ROUTINE WORKING STORAGE                               * 03860001
039300*---------------------------------------------------------------* 03870001
039400     COPY DPWS500.                                                03880001
039500*---------------------------------------------------------------* 03890001
039600*    SA CONSTANTS                                               * 03900001
039700*---------------------------------------------------------------* 03910001
039800     COPY SAWS006.                                                03920001
039900     COPY SAWS007.                                                03930001
040400*---------------------------------------------------------------* 03980001
040500*    DB2 ABEND AREA                                             * 03990001
040600*---------------------------------------------------------------* 04000001
040700     COPY DPWS004.                                                04010001
040800*---------------------------------------------------------------* 04020001
040900*    DB2 AREA FOR COSA DEPOSIT AMOUNT TABLE                     * 04030001
041000*---------------------------------------------------------------* 04040001
041100     EXEC SQL                                                     04050001
041200          INCLUDE TSAADDP                                         04060001
041300     END-EXEC.                                                    04070001
041400*---------------------------------------------------------------* 04080001
041500*    DB2 AREA FOR COSA PAID OUT/CASH RECEIVED TABLE             * 04090001
041600*---------------------------------------------------------------* 04100001
041700     EXEC SQL                                                     04110001
041800          INCLUDE TSAADPC                                         04120001
041900     END-EXEC.                                                    04130001
042000*---------------------------------------------------------------* 04140001
042100*    DB2 AREA FOR COSA SUMMARY TABLE                            * 04150001
042200*---------------------------------------------------------------* 04160001
042300     EXEC SQL                                                     04170001
042400          INCLUDE TSAADSU                                         04180001
042500     END-EXEC.                                                    04190001
042600*---------------------------------------------------------------* 04200001
042700*    DB2 AREA FOR COSA SUMMARY TOTAL TABLE                      * 04210001
042800*---------------------------------------------------------------* 04220001
042900     EXEC SQL                                                     04230001
043000          INCLUDE TSASUM                                          04240001
043100     END-EXEC.                                                    04250001
043200*---------------------------------------------------------------* 04260001
043300*    DB2 AREA FOR GENERAL LEDGER DATE TABLE                     * 04270001
043400*---------------------------------------------------------------* 04280001
043500     EXEC SQL                                                     04290001
043600          INCLUDE TSAGLDT                                         04300001
043700     END-EXEC.                                                    04310001
043800*---------------------------------------------------------------* 04320001
043900*    DB2 AREA FOR PARTITION TABLE                               * 04330001
044000*---------------------------------------------------------------* 04340001
044100     EXEC SQL                                                     04350001
044200          INCLUDE TEPPART                                         04360001
044300     END-EXEC.                                                    04370001
044400*---------------------------------------------------------------* 04380001
044500*    DB2 AREA FOR XST_LOC                                         04390001
044600*---------------------------------------------------------------* 04400001
044700     EXEC SQL                                                     04410001
044800          INCLUDE XST00001                                        04420001
044900     END-EXEC.                                                    04430001
045000*---------------------------------------------------------------* 04440001
045100*    DB2 AREA FOR COMMUNICATIONS                                * 04450001
045200*---------------------------------------------------------------* 04460001
045300     EXEC SQL                                                     04470001
045400          INCLUDE SQLCA                                           04480001
045500     END-EXEC.                                                    04490001
045600                                                                  04500001
045700*---------------------------------------------------------------* 04510001
045800*    TSAADDP CURSOR - FOR DEPOSIT TABLE                         * 04520001
045900*---------------------------------------------------------------* 04530001
046000     EXEC SQL                                                     04540001
046100         DECLARE TSAADDP-CSR CURSOR FOR                           04550001
046200             SELECT  STR_NBR                                      04560001
046300                   , TNDR_TYP_CDE                                 04570001
SOLTRN                   , SUM(TNDR_AMT)                                04580034
046600               FROM  TSAADDP                                      04600001
046700               WHERE SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO           04610001
046800                                 AND :DK-END-DATE-ISO             04620001
STRFNT                                 AND STR_NBR <> 6666              04621012
SOLTRN               GROUP BY STR_NBR, TNDR_TYP_CDE                     04630034
SOLTRN               ORDER BY STR_NBR, TNDR_TYP_CDE                     04631034
047000             WITH UR                                              04640001
047100     END-EXEC.                                                    04650001
047200                                                                  04660001
047300*---------------------------------------------------------------* 04670001
047400*    TSAADPC CURSOR - FOR PAID OUT/CASH RECEIVED TABLE          * 04680001
047500*---------------------------------------------------------------* 04690001
047600     EXEC SQL                                                     04700001
047700         DECLARE TSAADPC-CSR CURSOR FOR                           04710001
047800             SELECT  P.STR_NBR,                                   04720001
047900                     P.TYP_CDE,                                   04730001
048000                     P.STR_CHRGD_NBR,                             04740001
048100                     P.RSN_CDE,                                   04750001
048200                     P.ADJ_CSH_AMT,                               04760001
048300                     P.CMNT_TXT                                   04770001
048400               FROM  TSAADPC P                                    04780001
048500               WHERE P.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO         04790001
048600                                 AND   :DK-END-DATE-ISO           04800001
STRFNT                                 AND   P.STR_NBR <> 6666          04801012
048700             WITH UR                                              04810001
048800     END-EXEC.                                                    04820001
048900                                                                  04830001
049000*---------------------------------------------------------------* 04840001
049100*    TSAADSU CURSOR - FOR TOTALS TABLE                          * 04850001
049200*---------------------------------------------------------------* 04860001
049300     EXEC SQL                                                     04870001
049400         DECLARE TSAADSU-CSR CURSOR FOR                           04880001
049500             SELECT  S.STR_NBR,                                   04890001
049600                     S.SUM_CTG_CDE,                               04900001
049700                     L.E_BUS_IND,                                 04910001
049800                     SUM (S.ADJ_AMT)                              04920001
049900               FROM  TSAADSU S                                    04930001
050000                    ,XST_LOC L                                    04940001
050100               WHERE S.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO         04950001
050200                                 AND   :DK-END-DATE-ISO           04960001
050300                 AND S.STR_NBR = L.LOC_NBR                        04970001
STRFNT                 AND S.STR_NBR <> 6666                            04971012
050400                 AND S.SUM_CTG_CDE IN ('KMT','POS','GTT',         04980001
050500                                       'TMR','GDT','BCN',         04990001
050600                                       'NCN','AEN','KCN',         05000001
050700                                       'ROS','SOS','COH',         05010001
050800                                       'STM','TAX','GTS',         05020001
050900                                       'GDS','CRI','KMI',         05030001
051000                                       'POR','KCP','NSF',         05040001
051100                                       'CUD','DBN','TPC',         05050043
PAYVEN                                       'PPN','VMN')               05051043
051300               GROUP BY S.STR_NBR,                                05060001
051400                        S.SUM_CTG_CDE,                            05070001
051500                        L.E_BUS_IND                               05080001
051600             WITH UR                                              05090001
051700     END-EXEC.                                                    05100001
051800                                                                  05110001
051900*---------------------------------------------------------------* 05120001
052000*    TSASUM CURSOR - FOR SUMMARY TOTAL TABLE - TO GET EMPLOYEE  * 05130001
052100*    CASH DISCOUNT.                                             * 05140001
052200*    WITH AUTO POST GL, NEW CATEGORIES WILL BE SUMMED USING     * 05150001
052300*    TSASUM.  THE NEW CATEGORIES ARE:  GWR, GWS, ECR, SHR, SHS, * 05160001
052400*    KKB, KKH, KKS, KKT, MAN, PTG, SPN.                         * 05170001
055600*    THESE ARE CATEGORIES CALCULATED BY THE SALES HUB, EXCEPT   * 05180001
055600*    FOR ECR WHICH IS CALCULATED BY THE BATCH AT THE REGISTER   * 05190001
055600*    LEVEL.                                                     * 05200001
052500*    5/8/2002 - CHANGE MADE TO INCLUDE TWO TSASUM CURSORS; ONE  * 05210001
052600*    THAT USES NON-ZERO REGISTER ROWS (TSASUM-CSR) AND ONE THAT * 05220001
052700*    USES ZERO REGISTER ROWS (ZEROROW-CSR).                     * 05230001
MKTPL2*    MAR,2022 ADD MARKETPLACE CATEGORIES MSS, MSR, MCS AND MCR. * 05231027
COBRND*    FEB,2023 ADD COBRAND CATEGORIES CVN AND CVP.               * 05232027
053100*---------------------------------------------------------------* 05240001
053200     EXEC SQL                                                     05250001
053300         DECLARE TSASUM-CSR CURSOR FOR                            05260001
053400             SELECT  STR_NBR,                                     05270001
053500                     SUM_CTG_CDE,                                 05280001
053600                     SUM (CTG_AMT) AS PV-SUM-CTG-AMT              05290001
053700               FROM  TSASUM   SUM                                 05300001
053800                    ,TEPPART PRT                                  05310001
053900               WHERE PRT.SLS_DTE                                  05320001
054000                            BETWEEN :DK-BEGIN-DATE-ISO            05330001
054100                                AND :DK-END-DATE-ISO              05340001
054200                 AND SUM.PARTN_NBR                                05350001
054300                                  =  PRT.PARTN_NBR                05360001
054400                 AND DB_STRUC_CDE = :PC-OPERATIONAL-TABLES        05370001
054500                 AND STR_GP_CDE   = :PC-STORE-GROUP-CODE          05380001
054600                 AND SUM_TYP_CDE IN ('D', 'S')                    05390001
054700                 AND SUM_CTG_CDE IN ('ECR', 'GWR', 'GWS', 'SHR',  05400001
MKTPL2                                     'SHS', 'FEE', 'SGS', 'SGT',  05410008
MKTPL2                                     'MSS', 'MSR', 'MCS', 'MCR',  05411024
COBRND                                     'CVN', 'CVP')                05412024
MKTPL2**                                   'MMS', 'MMR')                05412124
STRFNT                 AND STR_NBR     <> 6666                          05413012
054900                 AND RGST_ID     <> 0                             05420001
055000               GROUP BY STR_NBR, SUM_CTG_CDE                      05430001
055100             WITH UR                                              05440001
055200     END-EXEC.                                                    05450001
055300                                                                  05460001
055400*---------------------------------------------------------------* 05470001
055500*    ZEROROW-CSR - PICKS UP CATEGORIES IN TSASUM THAT ONLY HAVE * 05480001
055600*    ZERO REGISTER ROWS.                                        * 05490001
055600*    THESE ARE CATEGORIES CALCULATED BY THE BATCH PROCESSING.   * 05500001
BOSS  *    ADD CATEGORY BOS TO THE ZERO REGISTER ROW.                 * 05510001
BOSS  *    ADD CATEGORY BSR TO THE ZERO REGISTER ROW.                 * 05520001
BOSS  *    ADD CATEGORY BPR TO THE ZERO REGISTER ROW.                 * 05530001
055700*---------------------------------------------------------------* 05550001
055800     EXEC SQL                                                     05560001
055900         DECLARE ZEROROW-CSR CURSOR FOR                           05561001
056000             SELECT  STR_NBR,                                     05562001
056100                     SUM_CTG_CDE,                                 05563001
056200                     SUM (CTG_AMT) AS PV-SUM-CTG-AMT              05564001
056300               FROM  TSASUM   SUM                                 05565001
056400                    ,TEPPART  PRT                                 05566001
056500               WHERE PRT.SLS_DTE                                  05567001
056600                            BETWEEN :DK-BEGIN-DATE-ISO            05568001
056700                                AND :DK-END-DATE-ISO              05569001
056800                 AND SUM.PARTN_NBR                                05570001
056900                                  =  PRT.PARTN_NBR                05580001
057000                 AND DB_STRUC_CDE = :PC-OPERATIONAL-TABLES        05590001
057100                 AND STR_GP_CDE   = :PC-STORE-GROUP-CODE          05600001
057200                 AND SUM_TYP_CDE IN ('D', 'S')                    05610001
057300                 AND SUM_CTG_CDE IN ('KKB', 'KKH', 'KKS', 'KKT',  05620001
057400                                     'MAN', 'PTG', 'SPN', 'KKU',  05630001
BOSS                                       'BRC', 'SFS', 'BPS', 'BOS',  05640001
MKTPL2                                     'BSR', 'BPR', 'DON')         05650008
STRFNT                 AND STR_NBR     <> 6666                          05660012
057600                 AND RGST_ID      = 0                             05680001
057700               GROUP BY STR_NBR, SUM_CTG_CDE                      05690001
057800             WITH UR                                              05700001
057900     END-EXEC.                                                    05710001
058000                                                                  05720001
058100******************************************************************05730001
058200 PROCEDURE DIVISION.                                              05740001
058300******************************************************************05750001
058400 0000-MAINLINE.                                                   05760001
058500                                                                  05770001
058500     DISPLAY 'SAKUT006 WITH TRAILING TRAN LOGIC AND PAY/VEN'      05771046
058500                                                                  05772030
058600     PERFORM 1000-INITIALIZE.                                     05780001
058700                                                                  05790001
058800     PERFORM 2000-PROCESS.                                        05800001
058900                                                                  05810001
059000     PERFORM 9000-EOJ-ROUTINE.                                    05820001
059100                                                                  05830001
059200     STOP RUN.                                                    05840001
059300                                                                  05850001
059400*----------------------------------------------------------------*05860001
059500*  OPEN FILES. GET DATE FROM CONTROL CARD. CHECK IF DATE IS      *05870001
059600*  VALID, AND FIND OUT MONTH-ENDING DATE, TO SEE IF WE ARE AT    *05880001
059700*  THE END OF THE FISCAL MONTH.  PREPARE OUTPUT RECORD.          *05890001
059800*----------------------------------------------------------------*05900001
059900 1000-INITIALIZE.                                                 05910001
060100     OPEN OUTPUT GENERAL-LEDGER-FILE                              05930034
060200                 EMAIL-FILE.                                      05940001
060300                                                                  05950001
060400     ACCEPT DATE-CONTROL-CARD FROM SYSIN.                         05960001
060500                                                                  05970001
060600     INITIALIZE PV-HOLD-AMTS-TABLE.                               05980001
060700     MOVE ZERO                TO PV-STORE-NUMBER.                 05990001
060800     SET PS-FIRST-TIME-THRU-YES                                   06000001
060900         PS-SCAN-PENALTY-NO                                       06010001
061100                               TO TRUE.                           06030001
061200                                                                  06040001
061300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06050001
061400     MOVE CC-WEEK-ENDING-DATE-ISO                                 06060001
061500                               TO DPG52-LK-DATE-INPUT.            06070001
061600     SET DPG52-LK-DTE-ISO-FMT  TO TRUE.                           06080001
061700     SET DPG51-FISCAL-454-CALENDAR                                06090001
061800                               TO TRUE.                           06100001
061900     SET DPG51-DO-NOT-INCR-DECR-DATE                              06110001
062000                               TO TRUE.                           06120001
062100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          06130001
062200                                             DPG53 DPG54          06140001
062300                                             DPG55 DPG56.         06150001
062400     EVALUATE TRUE                                                06160001
062500         WHEN DPG54-NO-ERROR                                      06170001
062600             MOVE DPG55-1ST-WKDY-DB2ISO-FMT                       06180001
062700                               TO DK-BEGIN-DATE-ISO               06190001
062800             MOVE DPG55-LAST-WKDY-DB2ISO-FMT                      06200001
062900                               TO DK-END-DATE-ISO                 06210001
063000             IF DPG56-LAST-FP-DB2-ISO-FMT                         06220001
063100                               = CC-WEEK-ENDING-DATE-ISO          06230001
063200                 SET ML-LAST-FISCAL-WEEK     TO TRUE              06240001
063300             ELSE                                                 06250001
063400                 SET ML-NOT-LAST-FISCAL-WEEK TO TRUE              06260001
063500             END-IF                                               06270001
063600         WHEN DPG54-SEVERE-ERROR                                  06280001
063700         WHEN DPG54-WARNING-ERROR                                 06290001
063800             DISPLAY '** ABEND **'                                06300001
063900             DISPLAY '** PROGRAM   ** = SAKUT006'                 06310001
064000             DISPLAY '** PARAGRAPH ** = 1000-INITIALIZE'          06320001
064100             DISPLAY 'BAD INPUT DATE: '                           06330001
064200                            CC-WEEK-ENDING-DATE-ISO               06340001
064300             DISPLAY DPG54-ERROR-MESSAGE                          06350001
064400             SET ABEND-4003-CC-ERROR TO TRUE                      06360001
064500             CALL 'ILBOABN0' USING ABEND-CODE                     06370001
064600     END-EVALUATE.                                                06380001
064700                                                                  06390001
064800     IF DPG55-ALPHA-WEEK-DAY-SATURDAY                             06400001
064900         CONTINUE                                                 06410001
065000     ELSE                                                         06420001
065100         DISPLAY '** ABEND **'                                    06430001
065200         DISPLAY '** PROGRAM   ** = SAKUT006'                     06440001
065300         DISPLAY '** PARAGRAPH ** = 1000-INITIALIZE'              06450001
065400         DISPLAY 'BAD INPUT DATE: '                               06460001
065500                            CC-WEEK-ENDING-DATE-ISO               06470001
065600         DISPLAY 'INPUT DATE IS NOT A WEEK ENDING DATE'           06480001
065700         SET ABEND-4003-CC-ERROR TO TRUE                          06490001
065800         CALL 'ILBOABN0' USING ABEND-CODE                         06500001
065900     END-IF.                                                      06510001
066000                                                                  06520001
066100     INITIALIZE GL002-GL-INTERFACE-TRN.                           06530001
066200     MOVE PC-BUSINESS-UNIT  TO GL002-BUSINESS-UNIT.               06540001
066300     MOVE CC-WEEK-ENDING-CC TO GL002-TRN-EFF-CC.                  06550001
066400     MOVE CC-WEEK-ENDING-YY TO GL002-TRN-EFF-YY.                  06560001
066500     MOVE CC-WEEK-ENDING-MM TO GL002-TRN-EFF-MM.                  06570001
066600     MOVE CC-WEEK-ENDING-DD TO GL002-TRN-EFF-DD.                  06580001
066700                                                                  06590001
070800                                                                  07000001
070900*----------------------------------------------------------------*07010001
071000*                                                                *07020001
071100*----------------------------------------------------------------*07030001
071200 2000-PROCESS.                                                    07040001
071300                                                                  07050001
071400     PERFORM 2200-PROCESS-TSAADDP-TABLE.                          07060001
071500                                                                  07070001
071600**  AUTO POST GL PROJECT:  THE TSASUM TABLE MUST BE PROCESSED     07080001
071700**  PRIOR TO THE TSAADPC AND TSAADSU TABLES BECAUSE TSASUM        07090001
071800**  WILL INCLUDE CATEGORIES WHOSE DEBITS/CREDITS MAY NEED TO      07100001
071900**  BE ADDED TO TOTAL RETURNS (TMR), SALES (STM), GIFT CARDS      07110001
072000**  (GDT) OR STORE SUNDRY EXPENSE (SSE).  THE AMOUNTS ARE         07120001
072100**  KEPT IN THE PV-HOLD-AMTS-TABLE SUBSCRIPTED BY THE STORE       07130001
072200**  NUMBER.                                                       07140001
072300     PERFORM 2500-PROCESS-TSASUM-TABLE.                           07150001
072400                                                                  07160001
072500     PERFORM 2300-PROCESS-TSAADPC-TABLE.                          07170001
072600                                                                  07180001
072700     PERFORM 2400-PROCESS-TSAADSU-TABLE.                          07190001
072800                                                                  07200001
072900     PERFORM 2600-CHECK-IF-BALANCED.                              07210001
073000                                                                  07220001
073100*----------------------------------------------------------------*07230001
073200*    PROCESS THE TSAADDP (DEPOSIT AMOUNTS) TABLE                 *07240001
073300*----------------------------------------------------------------*07250001
073400 2200-PROCESS-TSAADDP-TABLE.                                      07260001
073500                                                                  07270001
073600     SET PS-NOT-END-OF-CURSOR TO TRUE.                            07280001
073700     PERFORM 2210-OPEN-TSAADDP-CURSOR.                            07290001
074500     PERFORM UNTIL PS-END-OF-CURSOR                               07370001
074700         PERFORM 2220-FETCH-TSAADDP-CURSOR                        07392034
074800     END-PERFORM.                                                 07400001
075200     PERFORM 2240-CLOSE-TSAADDP-CURSOR.                           07440001
075300                                                                  07450001
075400*----------------------------------------------------------------*07460001
075500*    OPEN THE TSAADDP CURSOR.                                    *07470001
075600*----------------------------------------------------------------*07480001
075700 2210-OPEN-TSAADDP-CURSOR.                                        07490001
075800                                                                  07500001
075900     EXEC SQL                                                     07510001
076000          OPEN TSAADDP-CSR                                        07520001
076100     END-EXEC.                                                    07530001
076200     EVALUATE TRUE                                                07540001
076300         WHEN SQLCODE = ZERO                                      07550001
076400             CONTINUE                                             07560001
076500         WHEN OTHER                                               07570001
076600             MOVE '2210-OPEN-TSAADDP-CURSOR'                      07580001
076700                              TO PV-PARAGRAPH-NAME                07590001
076800             MOVE 'OPEN CURSOR FOR TABLE TSAADDP'                 07600001
076900                              TO PV-DB2-FUNCTION                  07610001
077000             PERFORM 9990-DB2-ABEND                               07620001
077100     END-EVALUATE.                                                07630001
077200                                                                  07640001
077300*----------------------------------------------------------------*07650001
077400*   FETCH THE TSAADDP CURSOR.                                    *07660001
077500*----------------------------------------------------------------*07670001
077600 2220-FETCH-TSAADDP-CURSOR.                                       07680001
077700                                                                  07690001
077800     EXEC SQL                                                     07700001
077900         FETCH TSAADDP-CSR                                        07710001
078000         INTO  :SAADDP-STR-NBR,                                   07720001
078100               :SAADDP-TNDR-TYP-CDE,                              07730001
078200               :SAADDP-TNDR-AMT                                   07740034
078400     END-EXEC.                                                    07760001
078500     EVALUATE TRUE                                                07770001
078600         WHEN SQLCODE = ZERO                                      07780001
SOLTRN             PERFORM 2230-PROCESS-TSAADDP                         07791034
078800         WHEN SQLCODE = +100                                      07800001
078900             SET PS-END-OF-CURSOR TO TRUE                         07810001
079000         WHEN OTHER                                               07820001
079100             MOVE '2220-FETCH-TSAADDP-CURSOR'                     07830001
079200                              TO PV-PARAGRAPH-NAME                07840001
079300             MOVE 'FETCH CURSOR FOR TABLE TSAADDP'                07850001
079400                              TO PV-DB2-FUNCTION                  07860001
079500             PERFORM 9990-DB2-ABEND                               07870001
079600     END-EVALUATE.                                                07880001
079700                                                                  07890001
079800*----------------------------------------------------------------*07900001
079900*    THERE ARE TWO ROWS PER STORE ON THE TSAADDP TABLE.  ONE     *07910001
080000*    FOR THE CASH AND ONE THE CHECK.                             *07920034
080300*    CASH GOES TO THE 'CCD' CATEGORY AND THE CHECK GOES TO       *07950001
080400*    THE 'BOC' CATEGORY.                                         *07960001
082800*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *07961034
082900*    TNDR-TYP-CDE = '00' IS CASH.                                *07962034
083000*    TNDR-TYP-CDE = '01' IS CHECK.                               *07963034
080500*----------------------------------------------------------------*07970001
080600 2230-PROCESS-TSAADDP.                                            07980001
080700                                                                  07990001
080800     MOVE SAADDP-STR-NBR             TO PV-STR-NBR-NUMERIC.       08000034
081800     MOVE PV-STR-NBR-NUMERIC         TO PV-STORE-NUMBER.          08100034
081900     MOVE PV-STORE-NUMBER-X          TO GL002-LOCATION            08110034
082000                                        GL002-JRNL-LN-REF         08120034
082100                                        GL002-JRNL-LINE-DESC.     08130034
SOLTRN     IF SAADDP-TNDR-TYP-CDE = '00'                                08251034
SOLTRN         MOVE PC-CASH-CHECK-DEPOSIT  TO GL002-EXPENSE-TYPE-CDE    08252034
SOLTRN     ELSE                                                         08254034
SOLTRN**       SAADDP-TNDR-TYP-CDE = '01'                               08254134
SOLTRN         MOVE 'BOC'                  TO GL002-EXPENSE-TYPE-CDE    08255034
SOLTRN     END-IF.                                                      08256034
SOLTRN     MOVE SAADDP-TNDR-AMT            TO GL002-MONETARY-AMT.       08320034
084200     SET  GL002-MONETARY-AMT-DR      TO TRUE.                     08340034
084300     PERFORM 8100-WRITE-GL-RECORD.                                08350034
086900                                                                  08610001
087000*----------------------------------------------------------------*08620001
087100*   CLOSE THE TSAADDP CURSOR.                                    *08630001
087200*----------------------------------------------------------------*08640001
087300 2240-CLOSE-TSAADDP-CURSOR.                                       08650001
087400     EXEC SQL                                                     08660001
087500          CLOSE TSAADDP-CSR                                       08670001
087600     END-EXEC.                                                    08680001
087700     EVALUATE TRUE                                                08690001
087800         WHEN SQLCODE = ZERO                                      08700001
087900             CONTINUE                                             08710001
088000         WHEN OTHER                                               08720001
088100             MOVE '2240-CLOSE-TSAADDP-CURSOR'                     08730001
088200                              TO PV-PARAGRAPH-NAME                08740001
088300             MOVE 'CLOSE CURSOR FOR TABLE TSAADDP'                08750001
088400                              TO PV-DB2-FUNCTION                  08760001
088500             PERFORM 9990-DB2-ABEND                               08770001
088600     END-EVALUATE.                                                08780001
088700                                                                  08790001
088800*----------------------------------------------------------------*08800001
088900*    PROCESS THE TSAADPC (PAID OUT/CASH RECEIVED) TABLE          *08810001
089000*----------------------------------------------------------------*08820001
089100                                                                  08830001
089200 2300-PROCESS-TSAADPC-TABLE.                                      08840001
089300                                                                  08850001
089400     SET PS-NOT-END-OF-CURSOR TO TRUE.                            08860001
089500     PERFORM 2310-OPEN-TSAADPC-CURSOR.                            08870001
089600     PERFORM 2320-FETCH-TSAADPC-CURSOR.                           08880001
089700     PERFORM UNTIL PS-END-OF-CURSOR                               08890001
089800         PERFORM 2330-PROCESS-TSAADPC                             08900001
089900         PERFORM 2320-FETCH-TSAADPC-CURSOR                        08910001
090000     END-PERFORM.                                                 08920001
090100     PERFORM 2340-CLOSE-TSAADPC-CURSOR.                           08930001
090200**  AUTO POST GL:  A RECORD WILL NEED TO BE INSERTED INTO         08940001
090300**  THE FILE FOR THE SCANNING PENALTY DEBIT (DEBITED TO STORE     08950001
090400**  SUNDRY EXPENSE--SSE).                                         08960001
090500     IF PS-END-OF-CURSOR  AND  PS-SCAN-PENALTY-YES                08970001
090600       PERFORM 2350-INSERT-SPN-TOTAL                              08980001
090700        VARYING PV-TBL-SUB FROM 1 BY 1                            08990001
090800         UNTIL  PV-TBL-SUB > 9999                                 09000001
090900     END-IF.                                                      09010001
091000     SET PS-SCAN-PENALTY-NO    TO TRUE.                           09020001
091100                                                                  09030001
091200*----------------------------------------------------------------*09040001
091300*    OPEN THE TSAADPC CURSOR.                                    *09050001
091400*----------------------------------------------------------------*09060001
091500 2310-OPEN-TSAADPC-CURSOR.                                        09070001
091600                                                                  09080001
091700     EXEC SQL                                                     09090001
091800          OPEN TSAADPC-CSR                                        09100001
091900     END-EXEC.                                                    09110001
092000     EVALUATE TRUE                                                09120001
092100         WHEN SQLCODE = ZERO                                      09130001
092200             CONTINUE                                             09140001
092300         WHEN OTHER                                               09150001
092400             MOVE '2310-OPEN-TSAADPC-CURSOR'                      09160001
092500                              TO PV-PARAGRAPH-NAME                09170001
092600             MOVE 'OPEN CURSOR FOR TABLE TSAADPC'                 09180001
092700                              TO PV-DB2-FUNCTION                  09190001
092800             PERFORM 9990-DB2-ABEND                               09200001
092900     END-EVALUATE.                                                09210001
093000                                                                  09220001
093100*----------------------------------------------------------------*09230001
093200*   FETCH THE TSAADPC CURSOR.                                    *09240001
093300*----------------------------------------------------------------*09250001
093400 2320-FETCH-TSAADPC-CURSOR.                                       09260001
093500                                                                  09270001
093600     EXEC SQL                                                     09280001
093700         FETCH TSAADPC-CSR                                        09290001
093800         INTO  :SAADPC-STR-NBR,                                   09300001
093900               :SAADPC-TYP-CDE,                                   09310001
094000               :SAADPC-STR-CHRGD-NBR,                             09320001
094100               :SAADPC-RSN-CDE,                                   09330001
094200               :SAADPC-ADJ-CSH-AMT,                               09340001
094300               :SAADPC-CMNT-TXT                                   09350001
094400     END-EXEC.                                                    09360001
094500     EVALUATE TRUE                                                09370001
094600         WHEN SQLCODE = ZERO                                      09380001
094700             CONTINUE                                             09390001
094800         WHEN SQLCODE = +100                                      09400001
094900             SET PS-END-OF-CURSOR TO TRUE                         09410001
095000         WHEN OTHER                                               09420001
095100             MOVE '2320-FETCH-TSAADPC-CURSOR'                     09430001
095200                              TO PV-PARAGRAPH-NAME                09440001
095300             MOVE 'FETCH CURSOR FOR TABLE TSAADPC'                09450001
095400                              TO PV-DB2-FUNCTION                  09460001
095500             PERFORM 9990-DB2-ABEND                               09470001
095600     END-EVALUATE.                                                09480001
095700                                                                  09490001
095800*----------------------------------------------------------------*09500001
095900*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *09510001
096000*----------------------------------------------------------------*09520001
096100 2330-PROCESS-TSAADPC.                                            09530001
096200                                                                  09540001
096300     MOVE SAADPC-STR-NBR      TO PV-STORE-NUMBER.                 09550001
096400     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF.               09560001
096500     MOVE SAADPC-ADJ-CSH-AMT  TO GL002-MONETARY-AMT.              09570001
096600     MOVE SAADPC-TYP-CDE      TO SA007-TYP-CDE.                   09580001
096700     IF SA007-PAID-OUT                                            09590001
096800         IF SAADPC-ADJ-CSH-AMT < 0                                09600001
096900             SET  GL002-MONETARY-AMT-DR                           09610001
097000                              TO TRUE                             09620001
097100         ELSE                                                     09630001
097200             SET  GL002-MONETARY-AMT-CR                           09640001
097300                              TO TRUE                             09650001
097400         END-IF                                                   09660001
097500     ELSE                                                         09670001
097600         IF SAADPC-ADJ-CSH-AMT >= 0                               09680001
097700             SET  GL002-MONETARY-AMT-CR                           09690001
097800                              TO TRUE                             09700001
097900         ELSE                                                     09710001
098000             SET  GL002-MONETARY-AMT-DR                           09720001
098100                              TO TRUE                             09730001
098200         END-IF                                                   09740001
098300     END-IF.                                                      09750001
098400     MOVE SAADPC-RSN-CDE      TO GL002-EXPENSE-TYPE-CDE.          09760001
098500     MOVE SAADPC-STR-CHRGD-NBR                                    09770001
098600                              TO PV-STORE-NUMBER.                 09780001
098700     MOVE PV-STORE-NUMBER-X   TO GL002-LOCATION.                  09790001
098800     MOVE SAADPC-CMNT-TXT     TO GL002-JRNL-LINE-DESC.            09800001
098900     PERFORM 8100-WRITE-GL-RECORD.                                09810001
099000                                                                  09820001
099100*----------------------------------------------------------------*09830001
099200*   CLOSE THE TSAADPC CURSOR.                                    *09840001
099300*----------------------------------------------------------------*09850001
099400 2340-CLOSE-TSAADPC-CURSOR.                                       09860001
099500     EXEC SQL                                                     09870001
099600          CLOSE TSAADPC-CSR                                       09880001
099700     END-EXEC.                                                    09890001
099800     EVALUATE TRUE                                                09900001
099900         WHEN SQLCODE = ZERO                                      09910001
100000             CONTINUE                                             09920001
100100         WHEN OTHER                                               09930001
100200             MOVE '2340-CLOSE-TSAADPC-CURSOR'                     09940001
100300                              TO PV-PARAGRAPH-NAME                09950001
100400             MOVE 'CLOSE CURSOR FOR TABLE TSAADPC'                09960001
100500                              TO PV-DB2-FUNCTION                  09970001
100600             PERFORM 9990-DB2-ABEND                               09980001
100700     END-EVALUATE.                                                09990001
100800                                                                  10000001
100900*----------------------------------------------------------------*10010001
101000*    INSERT THE DEBIT TO THE STORE SUNDRY EXPENSE HERE FOR ANY   *10020001
101100*    AND ALL SCANNING PENALTIES.                                 *10030001
101200*----------------------------------------------------------------*10040001
101300 2350-INSERT-SPN-TOTAL.                                           10050001
101400                                                                  10060001
101500     MOVE PV-TBL-SUB          TO PV-STORE-NUMBER.                 10070001
101600     IF (PV-HOLD-SSE-AMT (PV-TBL-SUB)                             10080001
101700                       NOT EQUAL ZERO)                            10090001
101800         MOVE PV-STORE-NUMBER-X                                   10100001
101900                              TO GL002-JRNL-LN-REF                10110001
102000                                 GL002-LOCATION                   10120001
102100         MOVE 'SSE'           TO GL002-EXPENSE-TYPE-CDE           10130001
102200         MOVE 'Scan Penalty'  TO GL002-JRNL-LINE-DESC             10140001
102500         IF PV-HOLD-SSE-AMT (PV-TBL-SUB)                          10150001
102600                               > ZERO                             10160001
102700             MOVE 'C'         TO SA007-TYP-CDE                    10170001
102710             SET  GL002-MONETARY-AMT-DR                           10180001
102720                              TO TRUE                             10190001
102800         ELSE                                                     10200001
102900             MOVE 'P'         TO SA007-TYP-CDE                    10210001
102910             SET  GL002-MONETARY-AMT-CR                           10220001
102920                              TO TRUE                             10230001
103000         END-IF                                                   10240001
103100         MOVE PV-HOLD-SSE-AMT (PV-TBL-SUB)                        10250001
103200                              TO GL002-MONETARY-AMT               10260001
103300         PERFORM 8100-WRITE-GL-RECORD                             10270001
103400     END-IF.                                                      10280001
103500                                                                  10290001
103600*----------------------------------------------------------------*10300001
103700*    PROCESS THE TSAADSU (SUMMARY AMOUNTS) TABLE                 *10310001
103800*----------------------------------------------------------------*10320001
103900                                                                  10330001
104000 2400-PROCESS-TSAADSU-TABLE.                                      10340001
104100                                                                  10350001
104200     SET PS-NOT-END-OF-CURSOR TO TRUE.                            10360001
104300     PERFORM 2410-OPEN-TSAADSU-CURSOR.                            10370001
104400     PERFORM 2420-FETCH-TSAADSU-CURSOR.                           10380001
104500     PERFORM UNTIL PS-END-OF-CURSOR                               10390001
104600         PERFORM 2430-PROCESS-TSAADSU                             10400001
104700         PERFORM 2420-FETCH-TSAADSU-CURSOR                        10410001
104800     END-PERFORM.                                                 10420001
104900     PERFORM 2440-CLOSE-TSAADSU-CURSOR.                           10430001
105000                                                                  10440001
105100*----------------------------------------------------------------*10450001
105200*    OPEN THE TSAADSU CURSOR.                                    *10460001
105300*----------------------------------------------------------------*10470001
105400 2410-OPEN-TSAADSU-CURSOR.                                        10480001
105500                                                                  10490001
105600     EXEC SQL                                                     10500001
105700          OPEN TSAADSU-CSR                                        10510001
105800     END-EXEC.                                                    10520001
105900     EVALUATE TRUE                                                10530001
106000         WHEN SQLCODE = ZERO                                      10540001
106100             CONTINUE                                             10550001
106200         WHEN OTHER                                               10560001
106300             MOVE '2410-OPEN-TSAADSU-CURSOR'                      10570001
106400                              TO PV-PARAGRAPH-NAME                10580001
106500             MOVE 'OPEN CURSOR FOR TABLE TSAADSU'                 10590001
106600                              TO PV-DB2-FUNCTION                  10600001
106700             PERFORM 9990-DB2-ABEND                               10610001
106800     END-EVALUATE.                                                10620001
106900                                                                  10630001
107000*----------------------------------------------------------------*10640001
107100*   FETCH THE TSAADSU CURSOR.                                    *10650001
107200*----------------------------------------------------------------*10660001
107300 2420-FETCH-TSAADSU-CURSOR.                                       10670001
107400                                                                  10680001
107500     EXEC SQL                                                     10690001
107600         FETCH TSAADSU-CSR                                        10700001
107700         INTO  :SAADSU-STR-NBR,                                   10710001
107800               :SAADSU-SUM-CTG-CDE,                               10720001
107900               :XST00001-E-BUS-IND,                               10730001
108000               :SAADSU-ADJ-AMT                                    10740001
108100     END-EXEC.                                                    10750001
108200     EVALUATE TRUE                                                10760001
108300         WHEN SQLCODE = ZERO                                      10770001
108400             CONTINUE                                             10780001
108500         WHEN SQLCODE = +100                                      10790001
108600             SET PS-END-OF-CURSOR TO TRUE                         10800001
108700         WHEN OTHER                                               10810001
108800             MOVE '2420-FETCH-TSAADSU-CURSOR'                     10820001
108900                              TO PV-PARAGRAPH-NAME                10830001
109000             MOVE 'FETCH CURSOR FOR TABLE TSAADSU'                10840001
109100                              TO PV-DB2-FUNCTION                  10850001
109200             PERFORM 9990-DB2-ABEND                               10860001
109300     END-EVALUATE.                                                10870001
109400                                                                  10880001
109500*----------------------------------------------------------------*10890001
109600*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *10900001
109700*----------------------------------------------------------------*10910001
109800 2430-PROCESS-TSAADSU.                                            10920001
109900                                                                  10930001
110000     MOVE SAADSU-STR-NBR      TO PV-STORE-NUMBER                  10940001
110100                                 PV-TBL-SUB.                      10950001
110200     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF                10960001
110300                                 GL002-LOCATION                   10970001
110400                                 GL002-JRNL-LINE-DESC.            10980001
110500     MOVE SAADSU-SUM-CTG-CDE  TO GL002-EXPENSE-TYPE-CDE           10990001
110600                                 SA006-SUM-CTG-CDE.               11000001
110700     IF SA006-REGISTER-OVER-SHORT                                 11010001
110800       STRING PC-REGISTER-OVER-SHORT-MSG,                         11020001
110900              CC-WEEK-ENDING-CC, CC-WEEK-ENDING-YY,               11030001
111000              '-', CC-WEEK-ENDING-MM,                             11040001
111100              '-', CC-WEEK-ENDING-DD                              11050001
111200              DELIMITED BY SIZE INTO GL002-JRNL-LINE-DESC         11060001
111300       END-STRING                                                 11070001
111400     END-IF.                                                      11080001
111500     IF SA006-SAFE-OVER-SHORT                                     11090001
111600       STRING PC-SAFE-OVER-SHORT-MSG,                             11100001
111700              CC-WEEK-ENDING-CC, CC-WEEK-ENDING-YY,               11110001
111800              '-', CC-WEEK-ENDING-MM,                             11120001
111900              '-', CC-WEEK-ENDING-DD                              11130001
112000              DELIMITED BY SIZE INTO GL002-JRNL-LINE-DESC         11140001
112100       END-STRING                                                 11150001
112200     END-IF.                                                      11160001
112300                                                                  11170001
112400     MOVE SAADSU-ADJ-AMT      TO GL002-MONETARY-AMT.              11180001
112500                                                                  11190001
112600     EVALUATE TRUE                                                11200001
112700         WHEN SA006-KMRC-TENDERED                                 11210001
112800         WHEN SA006-PO-RECEIVABLE                                 11220001
112900         WHEN SA006-GIFT-CERT-TENDERED                            11230001
113000             SET GL002-MONETARY-AMT-DR                            11250001
113100                              TO TRUE                             11260001
113200             PERFORM 8100-WRITE-GL-RECORD                         11270001
113300         WHEN SA006-TOTAL-MDSE-RETURNS                            11280001
113400             MOVE SAADSU-ADJ-AMT                                  11290001
113500                              TO PV-HOLD-GL-AMT                   11300001
113600             SUBTRACT PV-HOLD-TMR-AMT (PV-TBL-SUB)                11310001
113700                 FROM PV-HOLD-GL-AMT                              11320001
113800                                                                  11330001
113900             IF PV-HOLD-GL-AMT < 0                                11340001
114000                SET GL002-MONETARY-AMT-DR TO TRUE                 11350001
114100             ELSE                                                 11360001
114200*               IF SAADSU-STR-NBR = PC-WEBSTORE                   11370001
114300                IF XST00001-E-BUS-IND = 'Y'                       11380001
114400                   SET GL002-MONETARY-AMT-CR TO TRUE              11390001
114500                   MOVE PV-HOLD-GL-AMT       TO EM-LINE5-E-COM-CR 11400001
114600                END-IF                                            11410001
114700             END-IF                                               11420001
114800                                                                  11430001
114900             MOVE PV-HOLD-GL-AMT                                  11440001
115000                              TO GL002-MONETARY-AMT               11450001
115100             PERFORM 8100-WRITE-GL-RECORD                         11460001
115200         WHEN SA006-GIFT-CARD-TENDERED                            11470001
SEPHOR**           KKT AND SEPHORA GC TENDERS ARE SUBTRACTED FROM       11471004
SEPHOR**           THE KOHL'S GIFT CARDS TENDERED.                      11472003
115600             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             11510004
115700             SUBTRACT PV-HOLD-GDT-AMT (PV-TBL-SUB)                11520001
115800                 FROM PV-HOLD-GL-AMT                              11530001
115900             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         11540004
SEPHOR             IF PV-HOLD-GL-AMT >= ZERO                            11551004
SEPHOR                 SET GL002-MONETARY-AMT-DR   TO TRUE              11552025
SEPHOR             ELSE                                                 11553004
SEPHOR                 SET GL002-MONETARY-AMT-CR   TO TRUE              11554025
SEPHOR             END-IF                                               11555004
116100             PERFORM 8100-WRITE-GL-RECORD                         11560001
116200         WHEN SA006-BANK-CHARGE                                   11570001
COBRND**           CVN (COBRAND VISA NET) IS SUBTRACTED FROM            11570125
COBRND**           BCN (BANK CHARGE NET).                               11570225
COBRND             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             11570325
COBRND             SUBTRACT PV-HOLD-BCN-AMT (PV-TBL-SUB)                11570425
COBRND                 FROM PV-HOLD-GL-AMT                              11570525
COBRND             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         11570625
COBRND             IF PV-HOLD-GL-AMT >= ZERO                            11570725
COBRND                 SET GL002-MONETARY-AMT-DR   TO  TRUE             11572025
COBRND             ELSE                                                 11574025
COBRND                 SET GL002-MONETARY-AMT-CR   TO  TRUE             11575025
COBRND             END-IF                                               11577025
COBRND             PERFORM 8100-WRITE-GL-RECORD                         11578025
116300         WHEN SA006-NOVUS-CHARGE                                  11580001
116400         WHEN SA006-AMERICAN-EXPRESS                              11590001
116600         WHEN SA006-DEBIT-CARDS                                   11610001
116700         WHEN SA006-REGISTER-OVER-SHORT                           11620001
116800         WHEN SA006-SAFE-OVER-SHORT                               11630001
116900         WHEN SA006-CHANGE-IN-CASH-ON-HAND                        11640001
PAYVEN         WHEN SA006-PAYPAL                                        11641043
PAYVEN         WHEN SA006-VENMO                                         11642043
117000             IF SAADSU-ADJ-AMT >= ZERO                            11650001
117100                 SET GL002-MONETARY-AMT-DR                        11660001
117200                              TO TRUE                             11670001
117300             ELSE                                                 11680001
117400                 SET GL002-MONETARY-AMT-CR                        11690001
117500                              TO TRUE                             11700001
117600             END-IF                                               11710001
117700             PERFORM 8100-WRITE-GL-RECORD                         11720001
116500         WHEN SA006-KOHLS-CHARGE                                  11720229
COBTRL**           TTN (COBRAND TRAILING NET) IS SUBTRACTED FROM        11721032
COBTRL**           KCN (KOHLS CHARGE NET).                              11722029
COBTR2**           NEED TO DETERMINE IF THERE ARE COBRAND TRAILING      11722237
COBTR2**           TRANSACTIONS THAT WEREN'T PICKED UP IN THE TSASUM    11722337
COBTR2**           PARAGRAPH BECAUSE THE STORE HAD NO COBRAND SALES OR  11722437
COBTR2**           RETURNS (CVN) FOR THE WEEK.                          11722537
COBTR2**           THE CVN LOGIC WILL SET THE CVN INDICATOR TO 'Y'      11722637
COBTR2**           WHEN IT IS EXECUTED.                                 11722737
COBTR2**           IF CVN INDICATOR = 'N', CALL TO GET TRAILING TRANS.  11722837
COBTR2**           IF FOUND AND IT IS NOT ZERO, WRITE A CVN RECORD      11722937
COBTR2**           WITH THE TTN AMT AND ADD TTN AMT TO THE HOLD KCN AMT.11723037
COBTR2**           THEN CONTINUE TO WRITE THE KCN RECORD.               11723137
COBTR2**                                                                11723237
COBTR2             IF PV-HOLD-CVN-FOUND (PV-TBL-SUB) NOT = 'Y'          11723538
COBTR2                 MOVE SAADSU-STR-NBR TO PV-TBL-STORE              11723638
COBTR2                 PERFORM 2547-GET-TTN-ADJUSTMENTS                 11723738
COBTR2                 IF PV-TTN-ADJUSTMENTS NOT = 0                    11723838
COBTR2                     MOVE 'CVN'      TO GL002-EXPENSE-TYPE-CDE    11723938
COBTR2                     ADD PV-TTN-ADJUSTMENTS  TO                   11724038
COBTR2                                     PV-HOLD-KCN-AMT (PV-TBL-SUB) 11724138
COBTR2                                     PV-TTN-TOTAL                 11724238
COBTR2                     MOVE PV-TTN-ADJUSTMENTS TO GL002-MONETARY-AMT11724338
COBTR2                     IF PV-TTN-ADJUSTMENTS >= 0                   11724437
COBTR2                         SET GL002-MONETARY-AMT-DR  TO TRUE       11724537
COBTR2                     ELSE                                         11724637
COBTR2                         SET GL002-MONETARY-AMT-CR  TO TRUE       11724737
COBTR2                     END-IF                                       11724837
COBTR2                     PERFORM 8100-WRITE-GL-RECORD                 11724937
COBTR2**                   RESET ORIG EXPENSE TYPE CODE (KCN)           11725037
COBTR2                     MOVE SAADSU-SUM-CTG-CDE                      11725137
COBTR2                                     TO GL002-EXPENSE-TYPE-CDE    11725237
COBTR2                 END-IF                                           11725337
COBTR2             END-IF                                               11725437
COBTR2**           PROCESS KCN                                          11725537
COBTRL             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             11725737
COBTRL             SUBTRACT PV-HOLD-KCN-AMT (PV-TBL-SUB)                11725837
COBTRL                 FROM PV-HOLD-GL-AMT                              11725937
COBTRL             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         11726029
COBTRL             IF PV-HOLD-GL-AMT >= ZERO                            11727029
COBTRL                 SET GL002-MONETARY-AMT-DR   TO  TRUE             11728035
COBTRL             ELSE                                                 11729029
COBTRL                 SET GL002-MONETARY-AMT-CR   TO  TRUE             11729135
COBTRL             END-IF                                               11729229
COBTRL             PERFORM 8100-WRITE-GL-RECORD                         11729329
118100         WHEN SA006-KOHLS-PAYMENTS                                11729429
COBTRL**           CVP (COBRAND VISA PAYMENTS) AND TTP (COBRAND         11729532
COBTRL**           TRAILING PAYMENTS) ARE SUBTRACTED FROM               11729632
COBRND**           KCP (KOHLS CHARGE PAYMENTS).                         11729732
COBTR2**           NEED TO DETERMINE IF THERE ARE COBRAND TRAILING      11729937
COBTR2**           TRANSACTIONS THAT WEREN'T PICKED UP IN THE TSASUM    11730037
COBTR2**           PARAGRAPH BECAUSE THE STORE HAD NO COBRAND PAYMENTS  11730137
COBTR2**           (CVP) FOR THE WEEK.                                  11730237
COBTR2**           THE CVP LOGIC WILL SET THE CVP INDICATOR TO 'Y'      11730337
COBTR2**           WHEN IT IS EXECUTED.                                 11730437
COBTR2**           IF CVP INDICATOR = 'N', CALL TO GET TRAILING TRANS.  11730537
COBTR2**           IF FOUND AND IT IS NOT ZERO, WRITE A CVP RECORD      11730637
COBTR2**           WITH THE TTP AMT AND ADD TTP AMT TO THE HOLD KCP AMT.11730737
COBTR2**           THEN CONTINUE TO WRITE THE KCP RECORD.               11730837
COBTR2**                                                                11730937
COBTR2             IF PV-HOLD-CVP-FOUND (PV-TBL-SUB) NOT = 'Y'          11731037
COBTR2                 MOVE SAADSU-STR-NBR TO PV-TBL-STORE              11731138
COBTR2                 PERFORM 2546-GET-TTP-ADJUSTMENTS                 11731237
COBTR2                 IF PV-TTP-ADJUSTMENTS NOT = 0                    11731337
COBTR2                     MOVE 'CVP'      TO GL002-EXPENSE-TYPE-CDE    11731437
COBTR2                     ADD PV-TTP-ADJUSTMENTS  TO                   11731537
COBTR2                                     PV-HOLD-KCP-AMT (PV-TBL-SUB) 11731637
COBTR2                                     PV-TTP-TOTAL                 11731737
COBTR2                     MOVE PV-TTP-ADJUSTMENTS TO GL002-MONETARY-AMT11731837
COBTR2                     IF PV-TTP-ADJUSTMENTS >= 0                   11731937
COBTR2                         SET GL002-MONETARY-AMT-CR  TO TRUE       11732037
COBTR2                     ELSE                                         11732137
COBTR2                         SET GL002-MONETARY-AMT-DR  TO TRUE       11732237
COBTR2                     END-IF                                       11732337
COBTR2                     PERFORM 8100-WRITE-GL-RECORD                 11732437
COBTR2**                   RESET ORIG EXPENSE TYPE CODE (KCP)           11732537
COBTR2                     MOVE SAADSU-SUM-CTG-CDE                      11732637
COBTR2                                     TO GL002-EXPENSE-TYPE-CDE    11732737
COBTR2                 END-IF                                           11732837
COBTR2             END-IF                                               11732937
COBTR2**           PROCESS KCP                                          11733037
COBRND             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             11733132
COBRND             SUBTRACT PV-HOLD-KCP-AMT (PV-TBL-SUB)                11733232
COBRND                 FROM PV-HOLD-GL-AMT                              11733332
COBRND             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         11733432
COBRND             IF PV-HOLD-GL-AMT >= ZERO                            11733532
COBRND                 SET GL002-MONETARY-AMT-CR   TO  TRUE             11733632
COBRND             ELSE                                                 11733732
COBRND                 SET GL002-MONETARY-AMT-DR   TO  TRUE             11733832
COBRND             END-IF                                               11733932
COBRND             PERFORM 8100-WRITE-GL-RECORD                         11734032
117800         WHEN SA006-CORPORATE-REFUNDS-ISSUED                      11735029
117900         WHEN SA006-KMRC-ISSUED                                   11740001
118000         WHEN SA006-PO-RETURNS                                    11750001
118200         WHEN SA006-NSF-PAYMENTS                                  11770001
118300         WHEN SA006-CURRENCY-DELIVERY                             11780001
118400             SET GL002-MONETARY-AMT-CR                            11790001
118500                              TO TRUE                             11800001
118600             PERFORM 8100-WRITE-GL-RECORD                         11810001
118700         WHEN SA006-STATE-TAXABLE-MDSE                            11820001
118800             MOVE SAADSU-ADJ-AMT                                  11830001
118900                              TO PV-HOLD-GL-AMT                   11840001
119000             SUBTRACT PV-HOLD-STM-AMT (PV-TBL-SUB)                11850001
119100                            FROM PV-HOLD-GL-AMT                   11860001
119200             MOVE PV-HOLD-GL-AMT                                  11870001
119300                              TO GL002-MONETARY-AMT               11880001
119400             IF PV-HOLD-GL-AMT >= ZERO                            11890001
119500                 SET GL002-MONETARY-AMT-CR                        11900001
119600                              TO TRUE                             11910001
119700             ELSE                                                 11920001
119800                 SET GL002-MONETARY-AMT-DR                        11930001
119900                              TO TRUE                             11940001
120000             END-IF                                               11950001
120100             PERFORM 8100-WRITE-GL-RECORD                         11960001
120200         WHEN SA006-STATE-TAX                                     11970001
120300         WHEN SA006-GIFT-CERT-SALES                               11980001
120400         WHEN SA006-GIFT-CARD-SALES                               11990016
120500             IF SAADSU-ADJ-AMT >= ZERO                            12010001
120600                 SET GL002-MONETARY-AMT-CR                        12020001
120700                              TO TRUE                             12030001
120800             ELSE                                                 12040001
120900                 SET GL002-MONETARY-AMT-DR                        12050001
121000                              TO TRUE                             12060001
121100             END-IF                                               12070001
121200             PERFORM 8100-WRITE-GL-RECORD                         12080001
121300         WHEN SA006-THIRD-PARTY-CARD-SALES                        12181017
TPCFIX             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             12182017
121400             PERFORM 2435-GET-COMMISSIONS                         12183017
TPCFIX             SUBTRACT PV-COMMISSIONS-AMT FROM PV-HOLD-GL-AMT      12184017
TPCFIX**           POC AND THE SALES HUB ADD SEPHORA GIFT CARDS INTO    12185017
TPCFIX**           THE TPC BUCKETS AND THEY NEED TO BE SUBTRACTED       12186017
TPCFIX**           OUT BEFORE GOING TO GL.                              12187017
TPCFIX             SUBTRACT PV-HOLD-TPC-AMT (PV-TBL-SUB)                12188017
TPCFIX                 FROM PV-HOLD-GL-AMT                              12189017
TPCFIX             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         12189117
TPCFIX             IF PV-HOLD-GL-AMT >= ZERO                            12189217
121700                 SET GL002-MONETARY-AMT-CR TO TRUE                12189317
121800             ELSE                                                 12189417
121900                 SET GL002-MONETARY-AMT-DR TO TRUE                12189517
122000             END-IF                                               12189617
122100             PERFORM 8100-WRITE-GL-RECORD                         12189717
122200                                                                  12189817
122300***          SEND THIRD PARTY CARD COMMISSIONS TO GL              12190001
122400             MOVE 'TCC' TO GL002-EXPENSE-TYPE-CDE                 12200001
122500             MOVE PV-COMMISSIONS-AMT TO GL002-MONETARY-AMT        12210001
122600             SET GL002-MONETARY-AMT-CR TO TRUE                    12220001
122700             PERFORM 8100-WRITE-GL-RECORD                         12230001
124100                                                                  12240001
124200         WHEN OTHER                                               12250001
124300             CONTINUE                                             12260001
124400     END-EVALUATE.                                                12270001
124500                                                                  12280001
124600*----------------------------------------------------------------*12290001
124700*    COMMISSIONS NEED TO BE SUBTRACTED FROM SALES BEFORE THEY ARE 12300001
124800*    PASSED ON TO GL. THESE COMMISSIONS WOULD BE FROM KOHLS       12310001
124900*    SELLING 3RD PARTY GIFT CARDS.                                12320001
125000*----------------------------------------------------------------*12330001
125100 2435-GET-COMMISSIONS.                                            12340001
125200                                                                  12350001
125300     EXEC SQL                                                     12360001
125400         SELECT SUM (CTG_AMT)                                     12370001
125500         INTO  :PV-COMMISSIONS-AMT :PV-SUM-TPC-NULL-IND           12380001
125600         FROM   TSASUM   SUM                                      12390001
125700               ,TEPPART  PRT                                      12400001
125800         WHERE PRT.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO             12410001
125900                               AND :DK-END-DATE-ISO               12420001
126000           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     12430001
126100           AND STR_NBR       = :SAADSU-STR-NBR                    12440001
126200           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               12450001
ZX               AND SUM_TYP_CDE   IN ('D','S')                         12460010
126400           AND SUM_CTG_CDE   = 'TCC'                              12470001
126500           AND RGST_ID       = 0                                  12480001
126600     END-EXEC.                                                    12490001
126700                                                                  12500001
126800     EVALUATE TRUE                                                12510001
126900         WHEN SQLCODE = ZERO                                      12520001
127000             IF PV-SUM-TPC-NULL-IND = -1                          12530001
127100                 MOVE ZEROES             TO PV-COMMISSIONS-AMT    12540001
127200             END-IF                                               12550001
127300         WHEN SQLCODE = +100                                      12560001
127400             MOVE ZEROES                 TO PV-COMMISSIONS-AMT    12570001
127500         WHEN OTHER                                               12580001
127600             MOVE '2435-GET-COMMISSIONS' TO PV-PARAGRAPH-NAME     12590001
127700             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       12600001
127800             DISPLAY 'SAADSU-STR-NBR ' SAADSU-STR-NBR             12610001
127900             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   12620001
128000             PERFORM 9990-DB2-ABEND                               12630001
128100     END-EVALUATE.                                                12640001
128200                                                                  12650001
128300*----------------------------------------------------------------*12660001
128400*   CLOSE THE TSAADSU CURSOR.                                    *12670001
128500*----------------------------------------------------------------*12680001
128600 2440-CLOSE-TSAADSU-CURSOR.                                       12690001
128700     EXEC SQL                                                     12700001
128800          CLOSE TSAADSU-CSR                                       12710001
128900     END-EXEC.                                                    12720001
129000     EVALUATE TRUE                                                12730001
129100         WHEN SQLCODE = ZERO                                      12740001
129200             CONTINUE                                             12750001
129300         WHEN OTHER                                               12760001
129400             MOVE '2440-CLOSE-TSAADSU-CURSOR'                     12770001
129500                              TO PV-PARAGRAPH-NAME                12780001
129600             MOVE 'CLOSE CURSOR FOR TABLE TSAADSU'                12790001
129700                              TO PV-DB2-FUNCTION                  12800001
129800             PERFORM 9990-DB2-ABEND                               12810001
129900     END-EVALUATE.                                                12820001
130000                                                                  12830001
130100*----------------------------------------------------------------*12840001
130200*  RETRIEVE DATA FROM THE TSASUM TABLE.                          *12850001
130300*----------------------------------------------------------------*12860001
130400                                                                  12870001
130500 2500-PROCESS-TSASUM-TABLE.                                       12880001
130600                                                                  12890001
130700     SET PS-NOT-END-OF-CURSOR TO TRUE.                            12900001
130800     PERFORM 2520-OPEN-TSASUM-CURSOR.                             12910001
130900     PERFORM 2530-FETCH-TSASUM-CURSOR.                            12920001
131000     PERFORM UNTIL PS-END-OF-CURSOR                               12930001
131100         PERFORM 2540-PROCESS-TSASUM                              12940001
131200         PERFORM 2530-FETCH-TSASUM-CURSOR                         12950001
131300     END-PERFORM.                                                 12960001
131400     PERFORM 2550-CLOSE-TSASUM-CURSOR.                            12970001
131500**  5/8/2002  ADDITIONAL ZEROROW-CSR ADDED TO PICK UP ZERO        12980001
131600**  REGISTER ROWS FOR CATEGORIES THAT DO NOT HAVE NON-ZERO        12990001
131700**  REGISTER ROWS.                                                13000001
131800     SET PS-NOT-END-OF-CURSOR TO TRUE.                            13010001
131900     PERFORM 2560-OPEN-ZEROROW-CURSOR.                            13020001
132000     PERFORM 2570-FETCH-ZEROROW-CURSOR.                           13030001
132100     PERFORM UNTIL PS-END-OF-CURSOR                               13040001
132200         PERFORM 2540-PROCESS-TSASUM                              13050001
132300         PERFORM 2570-FETCH-ZEROROW-CURSOR                        13060001
132400     END-PERFORM                                                  13070001
132500     PERFORM 2580-CLOSE-ZEROROW-CURSOR.                           13080001
132600                                                                  13090001
132700*----------------------------------------------------------------*13100001
132800*    OPEN THE TSASUM CURSOR.                                     *13110001
132900*----------------------------------------------------------------*13120001
133000 2520-OPEN-TSASUM-CURSOR.                                         13130001
133100                                                                  13140001
133200     EXEC SQL                                                     13150001
133300          OPEN TSASUM-CSR                                         13160001
133400     END-EXEC.                                                    13170001
133500     EVALUATE TRUE                                                13180001
133600         WHEN SQLCODE = ZERO                                      13190001
133700             CONTINUE                                             13200001
133800         WHEN OTHER                                               13210001
133900             MOVE '2520-OPEN-TSASUM-CURSOR'                       13220001
134000                              TO PV-PARAGRAPH-NAME                13230001
134100             MOVE 'OPEN CURSOR FOR TABLE TSASUM'                  13240001
134200                              TO PV-DB2-FUNCTION                  13250001
134300             PERFORM 9990-DB2-ABEND                               13260001
134400     END-EVALUATE.                                                13270001
134500                                                                  13280001
134600*----------------------------------------------------------------*13290001
134700*   FETCH THE TSASUM CURSOR.                                     *13300001
134800*----------------------------------------------------------------*13310001
134900 2530-FETCH-TSASUM-CURSOR.                                        13320001
135000                                                                  13330001
135100     EXEC SQL                                                     13340001
135200         FETCH TSASUM-CSR                                         13350001
135300         INTO  :SASUM-STR-NBR,                                    13360001
135400               :SASUM-SUM-CTG-CDE,                                13370001
135500               :PV-SUM-CTG-AMT                                    13380001
135600     END-EXEC.                                                    13390001
135700     EVALUATE TRUE                                                13400001
135800         WHEN SQLCODE = ZERO                                      13410001
135900             MOVE SASUM-SUM-CTG-CDE  TO PC-SUM-CTG-CDE            13420001
136000         WHEN SQLCODE = +100                                      13430001
136100             SET PS-END-OF-CURSOR TO TRUE                         13440001
136200         WHEN OTHER                                               13450001
136300             MOVE '2530-FETCH-TSASUM-CURSOR'                      13460001
136400                              TO PV-PARAGRAPH-NAME                13470001
136500             MOVE 'FETCH CURSOR FOR TABLE TSASUM'                 13480001
136600                              TO PV-DB2-FUNCTION                  13490001
136700             PERFORM 9990-DB2-ABEND                               13500001
136800     END-EVALUATE.                                                13510001
136900                                                                  13520001
137000*----------------------------------------------------------------*13530001
137100*    CREATE TWO OUTPUT RECORDS FOR THE ROW, ONE DEBIT AND ONE    *13540001
137200*    CREDIT.                                                     *13550001
137300*----------------------------------------------------------------*13560001
137400 2540-PROCESS-TSASUM.                                             13570001
137500                                                                  13580001
137600     MOVE SASUM-STR-NBR       TO PV-STORE-NUMBER                  13590001
137700                                 PV-TBL-SUB.                      13600001
137800     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF                13610001
137900                                 GL002-LOCATION                   13620001
138000                                 GL002-JRNL-LINE-DESC.            13630001
138100     MOVE PV-SUM-CTG-AMT      TO GL002-MONETARY-AMT.              13640001
138200                                                                  13650001
138300     EVALUATE TRUE                                                13660001
138400**  FEES WILL BE SENT THROUGH AS A CREDIT IF THE AMOUNT IS        13670001
138500**  POSITIVE (WITH AN OFFSETTING DEBIT TO STM); OR A DEBIT IF THE 13680001
138600**  AMOUNT IS NEGATIVE (WITH AN OFFSETTING CREDIT TO TMR)         13690001
138700**  NEED TO RESET GL002-MONETARY-AMT AFTER FEE ADJUSTMENTS ARE    13700001
138800**  SUBTRACTED FROM FEES.                                         13710001
138900         WHEN PC-SUM-CTG-CDE-FEE                                  13720001
139000             PERFORM 2545-GET-FEE-ADJUSTMENTS                     13730001
139100             SUBTRACT PV-FEE-ADJUSTMENTS FROM PV-SUM-CTG-AMT      13740001
139200             MOVE PV-SUM-CTG-AMT           TO GL002-MONETARY-AMT  13750001
139300             IF PV-SUM-CTG-AMT < 0                                13760001
139400                 ADD PV-SUM-CTG-AMT                               13770001
139500                              TO PV-HOLD-TMR-AMT (PV-TBL-SUB)     13780001
139600                 SET GL002-MONETARY-AMT-DR                        13790001
139700                              TO TRUE                             13800001
139800             ELSE                                                 13810001
139900                 ADD PV-SUM-CTG-AMT                               13820001
140000                              TO PV-HOLD-STM-AMT (PV-TBL-SUB)     13830001
140100                 SET GL002-MONETARY-AMT-CR                        13840001
140200                              TO TRUE                             13850001
140300             END-IF                                               13860001
140400             MOVE PC-SUM-CTG-CDE                                  13870001
140500                              TO GL002-EXPENSE-TYPE-CDE           13880001
140600             PERFORM 8100-WRITE-GL-RECORD                         13890001
140700**  SHIPPING SALES WILL BE SENT THROUGH AS A CREDIT; AN           13900001
140800**  OFFSETTING DEBIT WILL BE TO THE STM (STATE TAXABLE            13910001
140900**  MERCHANDISE) ACCOUNT                                          13920001
141000         WHEN PC-SUM-CTG-CDE-SHS                                  13930001
141100             ADD PV-SUM-CTG-AMT                                   13940001
141200                              TO PV-HOLD-STM-AMT (PV-TBL-SUB)     13950001
141300             MOVE PC-SUM-CTG-CDE                                  13960001
141400                              TO GL002-EXPENSE-TYPE-CDE           13970001
141500             IF PV-SUM-CTG-AMT >= ZERO                            13980001
141600                 SET GL002-MONETARY-AMT-CR   TO TRUE              13990001
141700             ELSE                                                 14000001
141800                 SET GL002-MONETARY-AMT-DR   TO TRUE              14010001
141900             END-IF                                               14020001
142000             PERFORM 8100-WRITE-GL-RECORD                         14030001
142100**  SHIPPING RETURNS WILL BE SENT THROUGH AS A DEBIT; AN          14040001
142200**  OFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE        14050001
142300**  RETURNS) ACCOUNT                                              14060001
142400         WHEN PC-SUM-CTG-CDE-SHR                                  14070001
142500             ADD PV-SUM-CTG-AMT                                   14080001
142600                              TO PV-HOLD-TMR-AMT (PV-TBL-SUB)     14090001
142700             MOVE PC-SUM-CTG-CDE                                  14100001
142800                              TO GL002-EXPENSE-TYPE-CDE           14110001
142900             SET GL002-MONETARY-AMT-DR                            14120001
143000                              TO TRUE                             14130001
143100             PERFORM 8100-WRITE-GL-RECORD                         14140001
145400**  GIFT WRAPPING SALES WILL BE SENT THROUGH AS A CREDIT; AN      14150001
145500**  OFFSETTING DEBIT WILL BE TO THE STM (STATE TAXABLE            14160001
145600**  MERCHANDISE) ACCOUNT                                          14170001
145700         WHEN PC-SUM-CTG-CDE-GWS                                  14180001
145800             ADD PV-SUM-CTG-AMT                                   14190001
145900                              TO PV-HOLD-STM-AMT (PV-TBL-SUB)     14200001
146000             MOVE PC-SUM-CTG-CDE                                  14210001
146100                              TO GL002-EXPENSE-TYPE-CDE           14220001
146200             SET GL002-MONETARY-AMT-CR                            14230001
146300                              TO TRUE                             14240001
146400             PERFORM 8100-WRITE-GL-RECORD                         14250001
146500**  GIFT WRAPPING RETURNS WILL BE SENT THROUGH AS A DEBIT; AN     14260001
146600**  OFFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE       14270001
146700**  RETURNS) ACCOUNT                                              14280001
146800         WHEN PC-SUM-CTG-CDE-GWR                                  14290001
146900             ADD PV-SUM-CTG-AMT                                   14300001
147000                              TO PV-HOLD-TMR-AMT (PV-TBL-SUB)     14310001
147100             MOVE PC-SUM-CTG-CDE                                  14320001
147200                              TO GL002-EXPENSE-TYPE-CDE           14330001
147300             SET GL002-MONETARY-AMT-DR                            14340001
147400                              TO TRUE                             14350001
147500             PERFORM 8100-WRITE-GL-RECORD                         14360001
147600**  E-COMMERCE RETURNS WILL BE SENT THROUGH AS A DEBIT; AN        14370001
147700**  OFFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE       14380001
147800**  RETURNS) ACCOUNT                                              14390001
147900         WHEN PC-SUM-CTG-CDE-ECR                                  14400001
148000             ADD PV-SUM-CTG-AMT                                   14410001
148100                              TO PV-HOLD-TMR-AMT (PV-TBL-SUB)     14420001
148200             MOVE PC-SUM-CTG-CDE                                  14430001
148300                              TO GL002-EXPENSE-TYPE-CDE           14440001
148400             SET GL002-MONETARY-AMT-DR                            14450001
148500                              TO TRUE                             14460001
148600             PERFORM 8100-WRITE-GL-RECORD                         14470001
148700**  NON-MERCHANDISE AND POSTAGE SALES, AND MANIFESTO TAX RETURNS  14480001
148800**  WILL BE SENT THROUGH AS A CREDIT IF THE AMOUNT IS POSITIVE    14490001
148900**  (WITH AN OFFSETTING DEBIT TO STM); OR A DEBIT IF THE AMOUNT   14500001
149000**  IS NEGATIVE (WITH AN OFFSETTING CREDIT TO TMR)                14510001
149100         WHEN PC-SUM-CTG-CDE-KKB                                  14520001
149200         WHEN PC-SUM-CTG-CDE-BRC                                  14530001
149300         WHEN PC-SUM-CTG-CDE-KKH                                  14540001
149400         WHEN PC-SUM-CTG-CDE-KKU                                  14550001
149500         WHEN PC-SUM-CTG-CDE-KKS                                  14560001
149600         WHEN PC-SUM-CTG-CDE-PTG                                  14570001
149700         WHEN PC-SUM-CTG-CDE-MAN                                  14580001
149800         WHEN PC-SUM-CTG-CDE-SFS                                  14590001
149900         WHEN PC-SUM-CTG-CDE-BPS                                  14600001
BOSS           WHEN PC-SUM-CTG-CDE-BPR                                  14610001
BOSS           WHEN PC-SUM-CTG-CDE-BOS                                  14620001
BOSS           WHEN PC-SUM-CTG-CDE-BSR                                  14630001
MKTPLC         WHEN PC-SUM-CTG-CDE-MSS                                  14640009
MKTPLC         WHEN PC-SUM-CTG-CDE-MSR                                  14650009
MKTPLC         WHEN PC-SUM-CTG-CDE-MCS                                  14660009
MKTPLC         WHEN PC-SUM-CTG-CDE-MCR                                  14670009
MKTPL2**       WHEN PC-SUM-CTG-CDE-MMS                                  14680009
MKTPL2**       WHEN PC-SUM-CTG-CDE-MMR                                  14690009
150000             IF PV-SUM-CTG-AMT < 0                                14700001
150100                ADD PV-SUM-CTG-AMT                                14710001
150200                              TO PV-HOLD-TMR-AMT (PV-TBL-SUB)     14720001
150300                SET GL002-MONETARY-AMT-DR                         14730001
150900                              TO TRUE                             14740001
150500             ELSE                                                 14750001
150600                ADD PV-SUM-CTG-AMT                                14760001
150700                              TO PV-HOLD-STM-AMT (PV-TBL-SUB)     14770001
150800                SET GL002-MONETARY-AMT-CR                         14780001
150900                              TO TRUE                             14790001
151000             END-IF                                               14800001
151100             MOVE PC-SUM-CTG-CDE                                  14810001
151200                              TO GL002-EXPENSE-TYPE-CDE           14820001
151300             PERFORM 8100-WRITE-GL-RECORD                         14830001
MKTPL2**************************************************************    14830109
MKTPL2***  7/19/22 - It was decided that for now the Sales Hub will     14830209
MKTPL2***            include the Marketplace dollars in the Sales       14830309
MKTPL2***            and Returns categories, so this code may be        14830409
MKTPL2***            needed in the future, but not now!!!!              14830509
MKTPL2**************************************************************    14830609
MKTPL2**       WHEN PC-SUM-CTG-CDE-MSS                                  14831009
MKTPL2**       WHEN PC-SUM-CTG-CDE-MSR                                  14832009
MKTPL2**       WHEN PC-SUM-CTG-CDE-MCS                                  14833009
MKTPL2**       WHEN PC-SUM-CTG-CDE-MCR                                  14834009
MKTPL2***  The Sales Hub will not include marketplace categories        14836108
MKTPL2***  in the Sales (SAL/STM) and Returns (RET/TMR) buckets so      14836208
MKTPL2***  they should not be subtracted from them here.                14836308
MKTPL2**           IF PV-SUM-CTG-AMT < 0                                14837009
MKTPL2**              SET GL002-MONETARY-AMT-DR                         14839109
MKTPL2**                            TO TRUE                             14839209
MKTPL2**           ELSE                                                 14839309
MKTPL2**              SET GL002-MONETARY-AMT-CR                         14839609
MKTPL2**                            TO TRUE                             14839709
MKTPL2**           END-IF                                               14839809
MKTPL2**           MOVE PC-SUM-CTG-CDE                                  14839909
MKTPL2**                            TO GL002-EXPENSE-TYPE-CDE           14840009
MKTPL2**           PERFORM 8100-WRITE-GL-RECORD                         14840109
12386a         WHEN PC-SUM-CTG-CDE-DON                                  14841008
12386a             ADD  PV-SUM-CTG-AMT TO PV-HOLD-STM-AMT (PV-TBL-SUB)  14850001
12386a             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        14860001
12386a             IF PV-SUM-CTG-AMT >= ZERO                            14870001
12386a                SET GL002-MONETARY-AMT-CR TO TRUE                 14880001
12386a             ELSE                                                 14890001
12386a                SET GL002-MONETARY-AMT-DR TO TRUE                 14900001
12386a             END-IF                                               14910001
12386a             PERFORM 8100-WRITE-GL-RECORD                         14920001
151400**  KCK CARDS TENDERED WILL BE SENT THROUGH AS A DEBIT; AN        14930001
151500**  OFFSETTING CREDIT WILL BE TO THE GDT (GIFT CARDS TENDERED)    14940001
151600**  ACCOUNT                                                       14950001
151700         WHEN PC-SUM-CTG-CDE-KKT                                  14960001
151800             ADD PV-SUM-CTG-AMT                                   14970001
151900                              TO PV-HOLD-GDT-AMT (PV-TBL-SUB)     14980001
152000             MOVE PC-SUM-CTG-CDE                                  14990001
152100                              TO GL002-EXPENSE-TYPE-CDE           15000001
152200             IF PV-SUM-CTG-AMT >= 0                               15010001
152300                 SET GL002-MONETARY-AMT-DR  TO TRUE               15020001
152400             ELSE                                                 15030001
152500                 SET GL002-MONETARY-AMT-CR  TO TRUE               15040001
152600             END-IF                                               15050001
152700*            SET GL002-MONETARY-AMT-DR                            15060001
152800*                             TO TRUE                             15070001
152900             PERFORM 8100-WRITE-GL-RECORD                         15080001
153000**  SCANNING PENALTIES WILL BE CREDITED TO STM.                   15090001
153100**  STORE SUNDRY EXPENSE (SSE) WILL BE DEBITED.                   15100001
153200**  PV-HOLD-TMR-AMT, PV-HOLD-STM-AMT AND PV-HOLD-SSE-AMT ARE      15110001
153300**  SIGNED FIELDS.                                                15120001
153400**  8100-WRITE-GL-RECORD IS NOT PERFORMED HERE AS THE TOTALS      15130001
153500**  WILL BE INSERTED WHEN THE TSAADPC CURSOR IS PROCESSED.        15140001
153600         WHEN PC-SUM-CTG-CDE-SPN                                  15150001
153700             SET PS-SCAN-PENALTY-YES                              15160001
153800                              TO TRUE                             15170001
153900             ADD PV-SUM-CTG-AMT                                   15180001
154000                              TO PV-HOLD-STM-AMT (PV-TBL-SUB)     15190001
154100             MOVE PV-SUM-CTG-AMT                                  15200001
154200                              TO PV-HOLD-GL-AMT                   15210001
154300             COMPUTE PV-HOLD-GL-AMT = PV-HOLD-GL-AMT * -1         15220001
154400             ADD PV-HOLD-GL-AMT                                   15230001
154500                              TO PV-HOLD-SSE-AMT (PV-TBL-SUB)     15240001
SEPHOR**  SEPHORA GIFT CARD SALES WILL BE SENT THROUGH AS A CREDIT.     15241003
TPCFIX**  AN OFFSETTING DEBIT WILL BE MADE TO THE TPC (THIRD PARTY      15242016
TPCFIX**  GIFT CARD SALES), WHICH IS UPDATED BY POC (TSAADSU) AND       15243016
TPCFIX**  THE SALES HUB (TSASUM).                                       15243116
SEPHOR         WHEN PC-SUM-CTG-CDE-SGS                                  15244003
TPCFIX             ADD PV-SUM-CTG-AMT                                   15245016
TPCFIX                              TO PV-HOLD-TPC-AMT (PV-TBL-SUB)     15246016
SEPHOR             MOVE PC-SUM-CTG-CDE                                  15247003
SEPHOR                              TO GL002-EXPENSE-TYPE-CDE           15248003
SEPHOR             IF PV-SUM-CTG-AMT >= 0                               15249003
SEPHOR                 SET GL002-MONETARY-AMT-CR  TO TRUE               15249103
SEPHOR             ELSE                                                 15249203
SEPHOR                 SET GL002-MONETARY-AMT-DR  TO TRUE               15249303
SEPHOR             END-IF                                               15249403
SEPHOR             PERFORM 8100-WRITE-GL-RECORD                         15249703
SEPHOR**  SEPHORA GIFT CARDS TENDERED WILL BE SENT THROUGH AS A DEBIT.  15251003
SEPHOR**  AN OFFSETTING CREDIT WILL BE TO THE GDT (GIFT CARDS TENDERED) 15252003
SEPHOR**  ACCOUNT.                                                      15253003
SEPHOR         WHEN PC-SUM-CTG-CDE-SGT                                  15254003
SEPHOR             ADD PV-SUM-CTG-AMT                                   15255003
SEPHOR                              TO PV-HOLD-GDT-AMT (PV-TBL-SUB)     15256003
SEPHOR             MOVE PC-SUM-CTG-CDE                                  15257003
SEPHOR                              TO GL002-EXPENSE-TYPE-CDE           15258003
SEPHOR             IF PV-SUM-CTG-AMT >= 0                               15259003
SEPHOR                 SET GL002-MONETARY-AMT-DR  TO TRUE               15259103
SEPHOR             ELSE                                                 15259203
SEPHOR                 SET GL002-MONETARY-AMT-CR  TO TRUE               15259303
SEPHOR             END-IF                                               15259403
SEPHOR             PERFORM 8100-WRITE-GL-RECORD                         15259503
COBRND**  COBRAND VISA PAYMENTS (CVP) WILL BE SENT THROUGH AS A CREDIT. 15259625
COBRND**  AN OFFSETTING DEBIT WILL BE MADE TO THE KCP (KOHLS CHARGE     15259725
COBRND**  PAYMENTS) ACCOUNT, WHICH IS UPDATED BY POC (TSAADSU).         15259825
COBTRL**  COBRAND TRAILING PAYMENTS (TTP) NEED TO BE ADDED TO THE       15259932
COBTRL**  COBRAND VISA PAYMENTS (CVP) AND THE HOLD-KCP-AMT SO THAT      15260029
COBTRL**  THEY CAN BE SUBTRACTED FROM KCP.                              15260129
COBRND         WHEN PC-SUM-CTG-CDE-CVP                                  15260229
COBTR2             MOVE SASUM-STR-NBR  TO PV-TBL-STORE                  15260338
COBTRL             PERFORM 2546-GET-TTP-ADJUSTMENTS                     15260432
COBTRL             ADD PV-TTP-ADJUSTMENTS TO PV-SUM-CTG-AMT             15260532
COBTRL                                       PV-TTP-TOTAL               15260734
COBTRF             MOVE PV-SUM-CTG-AMT TO GL002-MONETARY-AMT            15260844
COBRND             ADD PV-SUM-CTG-AMT  TO PV-HOLD-KCP-AMT (PV-TBL-SUB)  15260933
COBRND             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        15261033
COBRND             IF PV-SUM-CTG-AMT >= 0                               15261133
COBRND                 SET GL002-MONETARY-AMT-CR  TO TRUE               15261233
COBRND             ELSE                                                 15261333
COBRND                 SET GL002-MONETARY-AMT-DR  TO TRUE               15261433
COBRND             END-IF                                               15261533
COBRND             PERFORM 8100-WRITE-GL-RECORD                         15261633
COBTR2**           SET PV-HOLD-CVP-FOUND TO TELL KCP THAT CVP PROCESSED 15261737
COBTR2**           THE TRAILING TRANSACTIONS AND KCP DOESN'T NEED TO.   15261837
COBTR2             MOVE 'Y' TO PV-HOLD-CVP-FOUND (PV-TBL-SUB)           15261937
COBTRL**                                                                15262037
COBRND**  COBRAND VISA NET TENDERED WILL BE SENT THROUGH AS A DEBIT.    15262137
COBRND**  AN OFFSETTING CREDIT WILL BE TO THE BCN (BANK CHARGE NET)     15262237
COBRND**  ACCOUNT, WHICH IS UPDATED BY POC (TSAADSU).                   15262337
COBTRL**  COBRAND TRAILING NET (TTN) NEEDS TO BE ADDED TO THE           15262437
COBTRL**  COBRAND VISA NET (CVN) AND THE HOLD-KCN-AMT SO THAT           15262537
COBTRL**  THEY CAN BE SUBTRACTED FROM KCN.  THEY SHOULD NOT IMPACT      15262637
COBTRL**  BCN, SO THEY SHOULDN'T BE ADDED TO CVN UNTIL AFTER CVN IS     15262737
COBTRL**  MOVED TO THE HOLD-BCN-AMT BUCKET.                             15262837
COBRND         WHEN PC-SUM-CTG-CDE-CVN                                  15262937
COBRND             ADD PV-SUM-CTG-AMT  TO PV-HOLD-BCN-AMT (PV-TBL-SUB)  15263037
COBTR2             MOVE SASUM-STR-NBR  TO PV-TBL-STORE                  15263138
COBTRL             PERFORM 2547-GET-TTN-ADJUSTMENTS                     15263237
COBTRL             ADD PV-TTN-ADJUSTMENTS TO PV-SUM-CTG-AMT             15263337
COBTRL                                    PV-HOLD-KCN-AMT (PV-TBL-SUB)  15263437
COBTRL                                       PV-TTN-TOTAL               15263537
COBTRF             MOVE PV-SUM-CTG-AMT TO GL002-MONETARY-AMT            15263644
COBRND             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        15263744
COBRND             IF PV-SUM-CTG-AMT >= 0                               15263844
COBRND                 SET GL002-MONETARY-AMT-DR  TO TRUE               15263944
COBRND             ELSE                                                 15264044
COBRND                 SET GL002-MONETARY-AMT-CR  TO TRUE               15264144
COBRND             END-IF                                               15264244
COBRND             PERFORM 8100-WRITE-GL-RECORD                         15264344
COBTR2**           SET PV-HOLD-CVN-FOUND TO TELL KCN THAT CVN PROCESSED 15264444
COBTR2**           THE TRAILING TRANSACTIONS AND KCN DOESN'T NEED TO.   15264544
COBTR2             MOVE 'Y' TO PV-HOLD-CVN-FOUND (PV-TBL-SUB)           15264644
154600     END-EVALUATE.                                                15264744
154700                                                                  15265029
154800*----------------------------------------------------------------*15270001
154900*    EMPLOYEE DISCOUNTS CALCULATED BY THE SALES HUB CAN RESULT    15280001
155000*    IN ADJUSTMENTS WHICH WILL REDUCE THE FEES.                   15290001
155100*----------------------------------------------------------------*15300001
155200 2545-GET-FEE-ADJUSTMENTS.                                        15310001
155300                                                                  15320001
155400     EXEC SQL                                                     15330001
155500         SELECT SUM (CTG_AMT)                                     15340001
155600         INTO  :PV-FEE-ADJUSTMENTS                                15350001
155700         FROM   TSASUM   SUM                                      15360001
155800               ,TEPPART  PRT                                      15370001
155900         WHERE PRT.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO             15380001
156000                               AND :DK-END-DATE-ISO               15390001
156100           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     15400001
156200           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               15410001
156300           AND SUM_TYP_CDE  IN ('D','S')                          15420001
156400           AND STR_NBR       = :SASUM-STR-NBR                     15430001
156500           AND SUM_CTG_CDE   = 'AFE'                              15440001
156600           AND RGST_ID      <> 0                                  15450001
156700         WITH UR                                                  15460001
156800     END-EXEC.                                                    15470001
156900                                                                  15480001
157000     EVALUATE TRUE                                                15490001
157100         WHEN SQLCODE = ZERO                                      15500001
157200             CONTINUE                                             15510001
157300         WHEN SQLCODE = +100 OR -305                              15520001
157400             MOVE ZEROES                 TO PV-FEE-ADJUSTMENTS    15530001
157500         WHEN OTHER                                               15540001
157600             MOVE '2545-GET-FEE-ADJUSTMENTS'                      15550001
157700                                         TO PV-PARAGRAPH-NAME     15560001
157800             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       15570001
157900             DISPLAY 'SASUM-STR-NBR  ' SASUM-STR-NBR              15580029
158000             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   15590001
158100             PERFORM 9990-DB2-ABEND                               15600001
158200     END-EVALUATE.                                                15610001
158300                                                                  15620001
COBTRL                                                                  15622029
COBTRL*----------------------------------------------------------------*15623029
COBTRL*    COBRAND TRAILING PAYMENTS (TTP) NEED TO BE SUBTRACTED        15624032
COBTRL*    FROM KCP AND ADDED TO CVP.                                   15625029
COBTRL*----------------------------------------------------------------*15626029
COBTRL 2546-GET-TTP-ADJUSTMENTS.                                        15626132
COBTRL                                                                  15628029
COBTRL     EXEC SQL                                                     15629029
COBTRL         SELECT SUM (CTG_AMT)                                     15629129
COBTRL         INTO  :PV-TTP-ADJUSTMENTS                                15629232
COBTRL         FROM   TSASUM   SUM                                      15629329
COBTRL               ,TEPPART  PRT                                      15629429
COBTRL         WHERE PRT.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO             15629529
COBTRL                               AND :DK-END-DATE-ISO               15629629
COBTRL           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     15629729
COBTRL           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               15629829
COBTRL           AND SUM_TYP_CDE  IN ('D','S')                          15629929
COBTR2           AND STR_NBR       = :PV-TBL-STORE                      15630040
COBTRL           AND SUM_CTG_CDE   = 'TTP'                              15630132
COBTRL           AND RGST_ID       = 0                                  15630231
COBTRL         WITH UR                                                  15630329
COBTRL     END-EXEC.                                                    15630429
COBTRL                                                                  15630529
COBTRL     EVALUATE TRUE                                                15630629
COBTRL         WHEN SQLCODE = ZERO                                      15630729
COBTRL             CONTINUE                                             15630829
COBTRL         WHEN SQLCODE = +100 OR -305                              15630929
COBTRL             MOVE ZEROES                 TO PV-TTP-ADJUSTMENTS    15631032
COBTRL         WHEN OTHER                                               15631129
COBTRL             MOVE '2546-GET-TTP-ADJUSTMENTS'                      15631232
COBTRL                                         TO PV-PARAGRAPH-NAME     15631329
COBTRL             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       15631429
COBTRL             DISPLAY 'SASUM-STR-NBR  ' SASUM-STR-NBR              15631529
COBTRL             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   15631629
COBTRL             PERFORM 9990-DB2-ABEND                               15631729
COBTRL     END-EVALUATE.                                                15631829
COBTRL                                                                  15631929
COBTRL                                                                  15632229
COBTRL*----------------------------------------------------------------*15632329
COBTRL*    COBRAND TRAILING NET (TTN) NEEDS TO BE SUBTRACTED            15632432
COBTRL*    FROM BCN AND ADDED TO CVN.                                   15632529
COBTRL*----------------------------------------------------------------*15632629
COBTRL 2547-GET-TTN-ADJUSTMENTS.                                        15632732
COBTRL                                                                  15632929
COBTRL     EXEC SQL                                                     15633029
COBTRL         SELECT SUM (CTG_AMT)                                     15633129
COBTRL         INTO  :PV-TTN-ADJUSTMENTS                                15633232
COBTRL         FROM   TSASUM   SUM                                      15633329
COBTRL               ,TEPPART  PRT                                      15633429
COBTRL         WHERE PRT.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO             15633529
COBTRL                               AND :DK-END-DATE-ISO               15633629
COBTRL           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     15633729
COBTRL           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               15633829
COBTRL           AND SUM_TYP_CDE  IN ('D','S')                          15633929
COBTR2           AND STR_NBR       = :PV-TBL-STORE                      15634040
COBTRL           AND SUM_CTG_CDE   = 'TTN'                              15634132
COBTRL           AND RGST_ID       = 0                                  15634231
COBTRL         WITH UR                                                  15634329
COBTRL     END-EXEC.                                                    15634429
COBTRL                                                                  15634529
COBTRL     EVALUATE TRUE                                                15634629
COBTRL         WHEN SQLCODE = ZERO                                      15634729
COBTRL             CONTINUE                                             15634829
COBTRL         WHEN SQLCODE = +100 OR -305                              15634929
COBTRL             MOVE ZEROES                 TO PV-TTN-ADJUSTMENTS    15635032
COBTRL         WHEN OTHER                                               15635129
COBTRL             MOVE '2547-GET-TTN-ADJUSTMENTS'                      15635232
COBTRL                                         TO PV-PARAGRAPH-NAME     15635329
COBTRL             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       15635429
COBTRL             DISPLAY 'SASUM-STR-NBR  ' SASUM-STR-NBR              15635529
COBTRL             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   15635629
COBTRL             PERFORM 9990-DB2-ABEND                               15635729
COBTRL     END-EVALUATE.                                                15635829
COBTRL                                                                  15635929
158400                                                                  15636029
158500*----------------------------------------------------------------*15640001
158600*   CLOSE THE TSASUM CURSOR.                                     *15650001
158700*----------------------------------------------------------------*15660001
158800 2550-CLOSE-TSASUM-CURSOR.                                        15670001
158900     EXEC SQL                                                     15680001
159000          CLOSE TSASUM-CSR                                        15690001
159100     END-EXEC.                                                    15700001
159200     EVALUATE TRUE                                                15710001
159300         WHEN SQLCODE = ZERO                                      15720001
159400             CONTINUE                                             15730001
159500         WHEN OTHER                                               15740001
159600             MOVE '2550-CLOSE-TSASUM-CURSOR'                      15750001
159700                              TO PV-PARAGRAPH-NAME                15760001
159800             MOVE 'CLOSE CURSOR FOR TABLE TSASUM'                 15770001
159900                              TO PV-DB2-FUNCTION                  15780001
160000             PERFORM 9990-DB2-ABEND                               15790001
160100     END-EVALUATE.                                                15800001
160200                                                                  15810001
160300*----------------------------------------------------------------*15820001
160400*    OPEN THE ZEROROW CURSOR.                                    *15830001
160500*----------------------------------------------------------------*15840001
160600 2560-OPEN-ZEROROW-CURSOR.                                        15850001
160700                                                                  15860001
160800     EXEC SQL                                                     15870001
160900          OPEN ZEROROW-CSR                                        15880001
161000     END-EXEC.                                                    15890001
161100     EVALUATE TRUE                                                15900001
161200         WHEN SQLCODE = ZERO                                      15910001
161300             CONTINUE                                             15920001
161400         WHEN OTHER                                               15930001
161500             MOVE '2560-OPEN-ZEROROW-CURSOR'                      15940001
161600                              TO PV-PARAGRAPH-NAME                15950001
161700             MOVE 'OPEN CURSOR FOR ZERO ROWS'                     15960001
161800                              TO PV-DB2-FUNCTION                  15970001
161900             PERFORM 9990-DB2-ABEND                               15980001
162000     END-EVALUATE.                                                15990001
162100                                                                  16000001
162200*----------------------------------------------------------------*16010001
162300*   FETCH THE ZEROROW CURSOR.                                    *16020001
162400*----------------------------------------------------------------*16030001
162500 2570-FETCH-ZEROROW-CURSOR.                                       16040001
162600                                                                  16050001
162700     EXEC SQL                                                     16060001
162800         FETCH ZEROROW-CSR                                        16070001
162900         INTO  :SASUM-STR-NBR,                                    16080001
163000               :SASUM-SUM-CTG-CDE,                                16090001
163100               :PV-SUM-CTG-AMT                                    16100001
163200     END-EXEC.                                                    16110001
163300     EVALUATE TRUE                                                16120001
163400         WHEN SQLCODE = ZERO                                      16130001
163500             MOVE SASUM-SUM-CTG-CDE  TO PC-SUM-CTG-CDE            16140001
163600         WHEN SQLCODE = +100                                      16150001
163700             SET PS-END-OF-CURSOR TO TRUE                         16160001
163800         WHEN OTHER                                               16170001
163900             MOVE '2570-FETCH-ZEROROW-CURSOR'                     16180001
164000                              TO PV-PARAGRAPH-NAME                16190001
164100             MOVE 'FETCH CURSOR FOR ZERO ROWS'                    16200001
164200                              TO PV-DB2-FUNCTION                  16210001
164300             PERFORM 9990-DB2-ABEND                               16220001
164400     END-EVALUATE.                                                16230001
164500                                                                  16240001
164600*----------------------------------------------------------------*16250001
164700*   CLOSE THE ZEROROW CURSOR.                                    *16260001
164800*----------------------------------------------------------------*16270001
164900 2580-CLOSE-ZEROROW-CURSOR.                                       16280001
165000     EXEC SQL                                                     16290001
165100          CLOSE ZEROROW-CSR                                       16300001
165200     END-EXEC.                                                    16310001
165300     EVALUATE TRUE                                                16320001
165400         WHEN SQLCODE = ZERO                                      16330001
165500             CONTINUE                                             16340001
165600         WHEN OTHER                                               16350001
165700             MOVE '2580-CLOSE-ZEROROW-CURSOR'                     16360001
165800                              TO PV-PARAGRAPH-NAME                16370001
165900             MOVE 'CLOSE CURSOR FOR ZERO ROWS'                    16380001
166000                              TO PV-DB2-FUNCTION                  16390001
166100             PERFORM 9990-DB2-ABEND                               16400001
166200     END-EVALUATE.                                                16410001
166300                                                                  16420001
166400*----------------------------------------------------------------*16430001
166500*  CHECK IF THE DEBITS AND CREDITS BALANCE.                      *16440001
166600*----------------------------------------------------------------*16450001
166700                                                                  16460001
166800 2600-CHECK-IF-BALANCED.                                          16470001
166900                                                                  16480001
167000     WRITE EMAIL-RECORD       FROM EM-EMAIL-BLANK-LINE.           16490001
167100     IF PT-DEBITS = PT-CREDITS                                    16500001
167200         MOVE ZERO            TO RETURN-CODE                      16510001
167300         MOVE CC-WEEK-ENDING-DATE-ISO                             16520001
167400                              TO EM-LINE1-DATE                    16530001
167500         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE1                 16540001
167600     ELSE                                                         16550001
167700         MOVE 4090            TO RETURN-CODE                      16560001
167800         MOVE CC-WEEK-ENDING-DATE-ISO                             16570001
167900                              TO EM-LINE2A-DATE                   16580001
168000         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE2A                16590001
168100         WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE            16600001
168200         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE2B                16610001
168300     END-IF.                                                      16620001
168400     WRITE EMAIL-RECORD       FROM EM-EMAIL-BLANK-LINE.           16630001
168500     MOVE PT-DEBITS           TO   EM-LINE3-DEBITS.               16640001
168600     MOVE PT-CREDITS          TO   EM-LINE4-CREDITS.              16650001
168700     WRITE EMAIL-RECORD       FROM EM-EMAIL-LINE3.                16660001
168800     WRITE EMAIL-RECORD       FROM EM-EMAIL-LINE4.                16670001
168900     IF EM-LINE5-E-COM-CR NOT EQUAL ZEROS                         16680001
169000       WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE              16690001
169100       WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE5                   16700001
169200     END-IF.                                                      16710001
169300     IF PT-DEBITS = PT-CREDITS                                    16720001
169400         PERFORM 2610-INSERT-TSAGLDT-ROW                          16730001
169500         PERFORM 2620-UPDATE-CONTROL-CARD                         16740001
169600     END-IF.                                                      16750001
169700                                                                  16760001
169800*----------------------------------------------------------------*16770001
169900*  INSERT TSAGLDT ROW WITH DATE FOR GL FILE.                     *16780001
170000*----------------------------------------------------------------*16790001
170100                                                                  16800001
170200 2610-INSERT-TSAGLDT-ROW.                                         16810001
170300                                                                  16820001
170400     MOVE CC-WEEK-ENDING-DATE-ISO TO SAGLDT-SLS-WK-END-DTE.       16830001
170500                                                                  16840022
170600     EXEC SQL                                                     16850022
170700        INSERT INTO TSAGLDT                                       16860022
170800           (SLS_WK_END_DTE,                                       16870022
170900            SNT_TO_GL_DTE)                                        16880022
171000        VALUES                                                    16890022
171100           (:SAGLDT-SLS-WK-END-DTE,                               16900022
171200            CURRENT DATE)                                         16910022
171300     END-EXEC.                                                    16920022
171400                                                                  16930022
171500     EVALUATE TRUE                                                16940022
171600         WHEN SQLCODE = +0                                        16950022
171700             CONTINUE                                             16960022
171800         WHEN OTHER                                               16970022
171900             MOVE '2610-INSERT-TSAGLDT-ROW'                       16980022
172000                              TO PV-PARAGRAPH-NAME                16990022
172100             MOVE 'INSERT GL DATE TO TSAGLDT'                     17000022
172200                              TO PV-DB2-FUNCTION                  17010022
172300             PERFORM 9990-DB2-ABEND                               17020022
172400     END-EVALUATE.                                                17030022
172500                                                                  17040001
172600*----------------------------------------------------------------*17050001
172700*  UPDATE MERCHANDISE LEDGER CONTROL CARD WITH WEEK-ENDING DATE. *17060001
172800*  IF END OF MONTH, ALSO UPDATE IT WITH THE CURRENT DATE.        *17070001
172900*----------------------------------------------------------------*17080001
173000                                                                  17090001
173100 2620-UPDATE-CONTROL-CARD.                                        17100001
173200                                                                  17110001
173300     MOVE CC-WEEK-ENDING-DATE-ISO                                 17120001
173400                              TO ML-CONTROL-DATE.                 17130001
173500                                                                  17140001
173600     IF ML-LAST-FISCAL-WEEK                                       17150001
173700         MOVE FUNCTION CURRENT-DATE (1:8)                         17160001
173800                              TO PV-CURRENT-DATE                  17170001
173900         MOVE PV-CURRENT-CCYY TO PV-CURRENT-CCYY-ISO              17180001
174000         MOVE PV-CURRENT-MM   TO PV-CURRENT-MM-ISO                17190001
174100         MOVE PV-CURRENT-DD   TO PV-CURRENT-DD-ISO                17200001
174200         MOVE PV-CURRENT-DATE-ISO                                 17210001
174300                              TO ML-CURRENT-DATE                  17220001
174400     END-IF.                                                      17230001
174500                                                                  17240001
174600     OPEN OUTPUT ML-CONTROL-OUT.                                  17250001
174700     WRITE ML-CONTROL-RECORD  FROM ML-CONTROL-AREA.               17260001
174800     CLOSE ML-CONTROL-OUT.                                        17270001
174900                                                                  17280001
175000*----------------------------------------------------------------*17290001
175100*  WRITE GENERAL LEDGER RECORD.                                  *17300001
175200*----------------------------------------------------------------*17310001
175300                                                                  17320001
175400 8100-WRITE-GL-RECORD.                                            17330001
175500                                                                  17340001
175600     IF GL002-MONETARY-AMT = 0                                    17350001
175700         CONTINUE                                                 17360001
175800     ELSE                                                         17370001
175900         WRITE GENERAL-LEDGER-RECORD                              17380001
176000                              FROM GL002-GL-INTERFACE-TRN         17390001
176100         IF GL002-MONETARY-AMT-DR                                 17400001
176200             ADD GL002-MONETARY-AMT                               17410001
176300                              TO PT-DEBITS                        17420001
176400         ELSE                                                     17430001
176500             ADD GL002-MONETARY-AMT                               17440001
176600                              TO PT-CREDITS                       17450001
176700         END-IF                                                   17460001
176800         ADD 1                TO PT-GL-RECORDS-WRITTEN            17470001
176900     END-IF.                                                      17480001
177000                                                                  17490001
177100*----------------------------------------------------------------*17500001
177200*  CLOSE ALL FILES.                                              *17510001
177300*----------------------------------------------------------------*17520001
177400 9000-EOJ-ROUTINE.                                                17530001
177500                                                                  17540001
177700     CLOSE GENERAL-LEDGER-FILE                                    17560034
177800           EMAIL-FILE.                                            17570001
177900                                                                  17580001
178000     SET TD-DEBITS                 TO TRUE.                       17590001
178100     MOVE PT-DEBITS                TO TD-TOTAL-AMOUNT.            17600001
178200     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       17610001
178300               TD-TOTAL-DISPLAY-MESSAGE.                          17620001
178400                                                                  17630001
178500     SET TD-CREDITS                TO TRUE.                       17640001
178600     MOVE PT-CREDITS               TO TD-TOTAL-AMOUNT.            17650001
178700     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       17660001
178800               TD-TOTAL-DISPLAY-MESSAGE.                          17670001
178900                                                                  17680001
179000     SET TD-GL-RECORDS-WRITTEN     TO TRUE.                       17690001
179100     MOVE PT-GL-RECORDS-WRITTEN    TO TD-TOTAL-AMOUNT.            17700001
179200     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       17710001
179300               TD-TOTAL-DISPLAY-MESSAGE.                          17720001
179400                                                                  17730001
COBTRL     DISPLAY '     '.                                             17730136
COBTR2     MOVE PV-TTN-TOTAL              TO PV-TRAIL-AMOUNT.           17731041
COBTRL     DISPLAY 'TOTAL TRAILING TENDER  TRANSACTION DOLLARS = '      17731134
COBTR2              PV-TRAIL-AMOUNT.                                    17731241
COBTR2     MOVE PV-TTP-TOTAL              TO PV-TRAIL-AMOUNT.           17732041
COBTRL     DISPLAY 'TOTAL TRAILING PAYMENT TRANSACTION DOLLARS = '      17733034
COBTR2              PV-TRAIL-AMOUNT.                                    17734041
COBTRL     DISPLAY '     '.                                             17734136
COBTRL                                                                  17735034
179500*----------------------------------------------------------------*17740001
179600*      PERFORMS ABENDS AFTER UNEXPECTED SQLCODE                  *17750001
179700*----------------------------------------------------------------*17760001
179800 9990-DB2-ABEND.                                                  17770001
179900                                                                  17780001
180000     DISPLAY '** ABEND **'.                                       17790001
180100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        17800001
180200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              17810001
180300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                17820001
180400                                                                  17830001
180500* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     17840001
180600     COPY DPPD004.                                                17850001
180700                                                                  17860001
180800     SET ABEND-4013-DB2-ERROR TO TRUE.                            17870001
180900     CALL 'ILBOABN0' USING ABEND-CODE.                            17880001
