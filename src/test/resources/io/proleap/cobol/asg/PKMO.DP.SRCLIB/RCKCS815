000010*-----------------------*                                         00001018
000020 IDENTIFICATION DIVISION.                                         00002018
000030*-----------------------*                                         00003018
000040 PROGRAM-ID.    RCKCS815.                                         00004018
000050 AUTHOR.        PATRICK BURKE.                                    00005018
000060 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00006018
000070 DATE-WRITTEN.  AUGUST 2002.                                      00007018
000080 DATE-COMPILED.                                                   00008018
000090                                                                  00009018
000100*---------------------------------------------------------------* 00010018
000110*    E815 - PO/RECEIVER CHECK-IN STATUS LIST.                   * 00011018
000120*                                                               * 00012018
000130*    THIS PROGRAM GENERATES A LIST OF PO/RECEIVERS THAT ARE     * 00013018
000140*    ASSOCIATED TO A TRIP ID OR SCAC,TRAILER THAT WAS           * 00014018
000150*    SELECTED FROM THE PREVIOUS LIST SCREEN OR THE CRIT SPEC    * 00015018
000160*    SCREEN.                                                    * 00016018
000170*                                                               * 00017018
000180*---------------------------------------------------------------* 00018018
000181* MAINTENANCE:                                                  * 00018118
000182*    JACK KRAMER 02/05/2014   CHG0069538                        * 00018218
000183*      MTK PROJECT - PACKAGE CODE CHANGES.                      * 00018318
000184*        CHANGES IN PARAGRAPH:                                  * 00018418
000185*            4300-READ-ITEMS-FROM-DB                            * 00018518
000186*        NEW PARAGRAPHS:                                        * 00018618
000187*            4600-CHECK-TRECITM                                 * 00018718
000188*            4610-CHECK-PTL-PREPK-TRECITM                       * 00018818
000189*            4620-CHECK-PTL-PREPK-TPURITM                       * 00018918
000190*            4630-CHECK-PTL-BULK-TRECITM                        * 00019018
000191*            4640-CHECK-PTL-BULK-TPURITM                        * 00019118
000192* ------------------------------------------------------------- * 00019218
000193*    CHERI PARMLEY 10/22/14   CHG0094517                        * 00019318
000194*      EXPAND PO IN COMMAREA TO 8 DIGITS                        * 00019418
000195*---------------------------------------------------------------* 00019518
000196* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00019656
000197* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00019757
000198* MAKING THE CALL DYNAMIC VS STATIC.                              00019857
000199*---------------------------------------------------------------* 00019957
000200* CHANGED 08/15/2022    BY BARB SCHULTZ    WR: CHG0273427         00020057
000201* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00020157
000202* MAKING THE CALL DYNAMIC VS STATIC.                              00020257
000203*----------------------------------------------------------------*00020357
000205 ENVIRONMENT DIVISION.                                            00020555
000206 DATA DIVISION.                                                   00020655
000207                                                                  00020755
000208 WORKING-STORAGE SECTION.                                         00020855
000209                                                                  00020955
000210 01  DK-DB2-KEYS.                                                 00021018
000220     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00022018
000230                                                    COMP.         00023018
000240     05  DK-FCLTY-ID                    PIC S9(04)  VALUE ZERO    00024018
000250                                                    COMP.         00025018
000260     05  DK-SCAC-ID                     PIC  X(04)  VALUE SPACE.  00026018
000270     05  DK-VEH-NBR                     PIC  X(10)  VALUE SPACE.  00027018
000280     05  DK-ARRIVAL-DTE                 PIC  X(10)  VALUE SPACE.  00028018
000290     05  DK-SHIPT-ID                    PIC S9(09)  VALUE +0      00029018
000300                                                    COMP.         00030018
000310     05  DK-TRIP-ID                     PIC S9(09)  VALUE +0      00031018
000320                                                    COMP.         00032018
000330                                                                  00033018
000340     05  DK-TRLR-STATUS                PIC  X(10)  VALUE SPACES.  00034018
000350     05  DK-HDR-LBL-PRTID              PIC S9(08)  COMP.          00035018
000360     05  DK-HDR-LBL-INSTR              PIC  X(25)  VALUE SPACES.  00036018
000370                                                                  00037018
000380     05  DK-STATUS-CDE                 PIC  X(02)  VALUE SPACES.  00038018
000390     05  DK-STATUS-DTE                 PIC  X(10)  VALUE SPACES.  00039018
000400     05  DK-STATUS-TME                 PIC  X(08)  VALUE SPACES.  00040018
000410     05  DK-PO-NBR                     PIC S9(09)  COMP.          00041018
000420     05  DK-REC-SEQ-NBR                PIC S9(09)  COMP.          00042018
000430     05  DK-CNTL-DESC                  PIC X(07)  VALUE SPACES.   00043018
000440     05  DK-DEPT-NBR                   PIC X(03)  VALUE SPACE.    00044018
000450     05  DK-ORD-NBR                    PIC S9(09) COMP VALUE +0.  00045018
000460     05  DK-STORE-NMBR                 PIC X(04)  VALUE SPACES.   00046018
000470* JAK 04/2007 - ADD KEY FIELD                                     00047018
000480     05  DK-CURRENT-TIMESTAMP      PIC X(26)   VALUE SPACES.      00048018
000490                                                                  00049018
000500 01  DN-DB2-NULL-INDICATORS.                                      00050018
000510     05  DN-UNRESOLVED-ID             PIC S9(04) VALUE +0         00051018
000520                                                  COMP.           00052018
000530     05  DN-AD-EVNT-DTE               PIC S9(04) COMP VALUE +0.   00053018
000540     05  DN-TKT-FMT-ID                PIC S9(04) COMP VALUE +0.   00054018
000550     05  DN-CURR-TRIP-ID              PIC S9(04) COMP VALUE +0.   00055018
000560                                                                  00056018
000570***************************************************************** 00057018
000580*    THESE FIELDS ARE USED TO BUILD THE TEMPORARY WORK TABLE      00058018
000590                                                                  00059018
000600 01  PS-TEMP-TABLE-SWITCHES.                                      00060018
000610     05  PS-TYPE-A-CSR-SW             PIC X(01) VALUE 'N'.        00061018
000620         88  PS-EOF-TYPE-A-NO                 VALUE 'N'.          00062018
000630         88  PS-EOF-TYPE-A-YES                VALUE 'Y'.          00063018
000640     05  PS-CHECKIN-CSR-SW             PIC X(01) VALUE 'N'.       00064018
000650         88  PS-EOF-CHECKIN-CSR-NO               VALUE 'N'.       00065018
000660         88  PS-EOF-CHECKIN-YES                  VALUE 'Y'.       00066018
000670     05  PS-TEMP-B-SWITCH              PIC X(01) VALUE 'N'.       00067018
000680         88  PS-TEMP-B-NO                        VALUE 'N'.       00068018
000690         88  PS-TEMP-B-YES                       VALUE 'Y'.       00069018
000700     05  PS-TEMP-PKSLIP-STAT-SW       PIC X(01)  VALUE 'N'.       00070018
000710         88  PS-TEMP-PKSLIP-DELETED-NO           VALUE 'N'.       00071018
000720         88  PS-TEMP-PKSLIP-DELETED-YES          VALUE 'Y'.       00072018
000730     05  PS-TRECITM-FOUND-SW          PIC X(01)  VALUE 'N'.       00073018
000740         88  PS-TRECITM-FOUND-NO                 VALUE 'N'.       00074018
000750         88  PS-TRECITM-FOUND-YES                VALUE 'Y'.       00075018
000760     05  PS-PACK-TO-LIGHT-SW          PIC X(01)  VALUE 'N'.       00076018
000770         88  PS-PACK-TO-LIGHT-NO                 VALUE 'N'.       00077018
000780         88  PS-PACK-TO-LIGHT-YES                VALUE 'Y'.       00078018
000790                                                                  00079018
000800 01  PV-TEMP-TABLE-VARIABLES.                                     00080018
000810     05  PV-TEMP-PO-NBR               PIC S9(09) COMP VALUE ZERO. 00081018
000820     05  PV-TEMP-REC-SEQ-NBR          PIC S9(09) COMP VALUE ZERO. 00082018
000830     05  PV-TEMP-STATUS-CDE           PIC X(02)       VALUE SPACE.00083018
000840     05  PV-TEMP-SCREEN-SEQUENCE      PIC S9(04) COMP VALUE ZERO. 00084018
000850     05  PV-TEMP-UNION-TYPE           PIC X(01)       VALUE SPACE.00085018
000860     05  PV-TEMP-SHIPT-UNT-ID         PIC S9(18)V COMP-3          00086018
000870                                                      VALUE ZERO. 00087018
000880     05  PV-TEMP-SEQ-NBR              PIC S9(04) COMP VALUE ZERO. 00088018
000890     05  PV-TEMP-PO-NULL              PIC S9(04) COMP VALUE ZERO. 00089018
000900     05  PV-TEMP-SEQ-NULL             PIC S9(04) COMP VALUE ZERO. 00090018
000910                                                                  00091018
000920     05  PV-CURRENT-TEMP.                                         00092018
000930         10  PV-CURR-TEMP-PO          PIC 9(09)       VALUE ZERO. 00093018
000940         10  PV-CURR-TEMP-SEQ         PIC 9(04)       VALUE ZERO. 00094018
000950     05  PV-PREVIOUS-TEMP.                                        00095018
000960         10  PV-PREV-TEMP-PO          PIC 9(09)       VALUE ZERO. 00096018
000970         10  PV-PREV-TEMP-SEQ         PIC 9(04)       VALUE ZERO. 00097018
000980                                                                  00098018
000990 01  PV-TEMP-LIST.                                                00099018
001000     05  FILLER                       PIC X(06) VALUE ' TASK='.   00100018
001010     05  PV-LIST-TASK-NBR             PIC 9(05)       VALUE ZERO. 00101018
001020     05  FILLER                       PIC X(04) VALUE ' PO='.     00102018
001030     05  PV-LIST-PO-NBR               PIC 9(09)       VALUE ZERO. 00103018
001040     05  FILLER                       PIC X(06) VALUE ' RCVR='.   00104018
001050     05  PV-LIST-REC-SEQ-NBR          PIC 9(09)       VALUE ZERO. 00105018
001060     05  FILLER                       PIC X(06) VALUE ' TYPE='.   00106018
001070     05  PV-LIST-STATUS-CDE           PIC X(02)       VALUE SPACE.00107018
001080     05  FILLER                       PIC X(05) VALUE ' SEQ='.    00108018
001090     05  PV-LIST-SCREEN-SEQUENCE      PIC 9(04)       VALUE ZERO. 00109018
001100     05  FILLER                       PIC X(07) VALUE ' UNION='.  00110018
001110     05  PV-LIST-UNION-TYPE           PIC X(01)       VALUE SPACE.00111018
001120                                                                  00112018
001130 01  PC-PROGRAM-CONSTANTS.                                        00113018
001140     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00114018
001150                                                    'RC815A '.    00115018
001160     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00116018
001170                                                    'RCKM815 '.   00117018
001180     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00118018
001190                                                    'RCKCS815'.   00119018
001200     05  PC-REPORT-PROGRAM-NAME         PIC  X(08)  VALUE         00120018
001210                                                    'PCKCS112'.   00121018
001240     05  PC-DPKCS060                    PIC  X(08)  VALUE         00124018
001250                                                    'DPKCS060'.   00125018
001260     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00126018
001270     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00127018
001280     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00128018
001290     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00129018
001300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +9      00130018
001310                                                    COMP SYNC.    00131018
001320     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00132018
001330                                                    COMP SYNC.    00133018
001340     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00134018
001350                                                    +1000000      00135018
001360                                                    COMP-3.       00136018
001370     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00137018
001380                                                    COMP SYNC.    00138018
001390     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00139018
001400                                                    COMP-3.       00140018
001410     05  PV-CICS-RESPONSE               PIC S9(08) VALUE ZEROES   00141018
001420                                                   COMP SYNC.     00142018
001430     05  PV-CURRENT-DATE                PIC  X(10)  VALUE SPACES. 00143018
001440     05  PV-CURRENT-DATE-R REDEFINES PV-CURRENT-DATE.             00144018
001450         10  PV-CURR-YY                 PIC  9(04).               00145018
001460         10  FILLER                     PIC  X(01).               00146018
001470         10  PV-CURR-MM                 PIC  9(02).               00147018
001480         10  FILLER                     PIC  X(01).               00148018
001490         10  PV-CURR-DD                 PIC  9(02).               00149018
001500     05  PV-CURR-DATE.                                            00150018
001510         10  PV-CR-MM                   PIC  9(02).               00151018
001520         10  PV-CR-DD                   PIC  9(02).               00152018
001530         10  PV-CR-YY                   PIC  9(04).               00153018
001540     05  PV-DEFAULT-FROM-DATE           PIC  X(10)  VALUE SPACES. 00154018
001550     05  PV-DEFAULT-DATE-R REDEFINES PV-DEFAULT-FROM-DATE.        00155018
001560         10  PV-DFLT-YY                 PIC  9(04).               00156018
001570         10  FILLER                     PIC  X(01).               00157018
001580         10  PV-DFLT-MM                 PIC  9(02).               00158018
001590         10  FILLER                     PIC  X(01).               00159018
001600         10  PV-DFLT-DD                 PIC  9(02).               00160018
001610     05  PV-DFLT-FROM-DATE.                                       00161018
001620         10  PV-DT-MM                   PIC  9(02).               00162018
001630         10  PV-DT-DD                   PIC  9(02).               00163018
001640         10  PV-DT-YY                   PIC  9(04).               00164018
001650                                                                  00165018
001660     05  PC-OPER-UNT-ID                 PIC S9(04) VALUE +0       00166018
001670                                                  COMP.           00167018
001680     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00168018
001690     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00169018
001700     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00170018
001710     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00171018
001720     05  PC-UNKNWN-VND-NME         PIC  X(19)  VALUE              00172018
001730                               'UNKNOWN VENDOR NAME'.             00173018
001740*                                                                 00174018
001750     05  PC-INNER-PREPACK          PIC X(06)   VALUE 'INPRPK'.    00175018
001760     05  PC-FREE-ASTRAY            PIC X(06)   VALUE 'FRASTY'.    00176018
001770                                                                  00177018
001780     05  PC-MULTIPLE-SHIPMENTS           PIC  X(18)  VALUE        00178018
001790         'MULTIPLE SHIPMENTS'.                                    00179018
001800     05  PC-PACKED-BY-STORE              PIC  X(15)  VALUE        00180018
001810         'PACKED BY STORE'.                                       00181018
001820     05  PC-PRE-TICKETED                 PIC  X(15)  VALUE        00182018
001830         'PRE TICKETED   '.                                       00183018
001840     05  PC-DETAIL-CHECK                 PIC  X(12)  VALUE        00184018
001850         'DETAIL CHECK'.                                          00185018
001860     05  PC-ON-HANGER                    PIC  X(09)  VALUE        00186018
001870         'ON HANGER'.                                             00187018
001880                                                                  00188018
001890     05  PC-TSYMSG-NUMBERS.                                       00189018
001900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00190018
001910         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00191018
001920         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00192018
001930         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00193018
001940         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00194018
001950         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00195018
001960         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00196018
001970         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00197018
001980         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00198018
001990         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00199018
002000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00200018
002010         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00201018
002020         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  00202018
002030         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00203018
002040         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00204018
002050         10  PC-TSYMSG-00416            PIC  9(05)  VALUE 00416.  00205018
002060         10  PC-TSYMSG-00417            PIC  9(05)  VALUE 00417.  00206018
002070         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  00207018
002080         10  PC-TSYMSG-00954            PIC  9(05)  VALUE 00954.  00208018
002090         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  00209018
002100         10  PC-TSYMSG-01074            PIC  9(05)  VALUE 01074.  00210018
002110         10  PC-TSYMSG-01803            PIC  9(05)  VALUE 01803.  00211018
002120         10  PC-TSYMSG-02122            PIC  9(05)  VALUE 02122.  00212018
002130         10  PC-TSYMSG-02993            PIC  9(05)  VALUE 02993.  00213018
002141         10  PC-TSYMSG-03138            PIC  9(05)  VALUE 03138.  00214122
002150         10  PC-TSYMSG-03229            PIC  9(05)  VALUE 03229.  00215018
002160         10  PC-TSYMSG-03289            PIC  9(05)  VALUE 03289.  00216018
002180         10  PC-TSYMSG-03554            PIC  9(05)  VALUE 03554.  00218018
002181         10  PC-TSYMSG-03814            PIC  9(05)  VALUE 03814.  00218141
002190                                                                  00219018
002200 01  PM-PROGRAM-MESSAGES.                                         00220018
002210     05  PM-PROGRAM-MESSAGE-1.                                    00221018
002220         10  PM-RET-CDE                  PIC  X(02)  VALUE SPACE. 00222018
002230         10  FILLER                      PIC  X(01)  VALUE '-'.   00223018
002240         10  PM-RET-MSG                  PIC  X(25)  VALUE SPACE. 00224018
002250         10  FILLER                      PIC  X(48)  VALUE SPACE. 00225018
002260                                                                  00226018
002270*                                                                 00227018
002280 01  PS-PROGRAM-SWITCHES.                                         00228018
002290     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00229018
002300         88  PS-NO-ERROR                            VALUE 'Y'.    00230018
002310         88  PS-ERROR                               VALUE 'N'.    00231018
002320     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00232018
002330         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00233018
002340         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00234018
002350     05  PS-RECEIVER-EXISTS-SW          PIC  X(01)  VALUE 'Y'.    00235018
002360         88  PS-RECEIVER-EXISTS                     VALUE 'Y'.    00236018
002370         88  PS-RECEIVER-DOESNT-EXIST               VALUE 'N'.    00237018
002380     05  PS-END-OF-STATUS-CURSOR-SW     PIC  X(01)  VALUE 'N'.    00238018
002390         88  PS-END-OF-STATUS-CURSOR          VALUE 'Y'.          00239018
002400         88  PS-NOT-END-OF-STATUS-CURSOR      VALUE 'N'.          00240018
002410     05  PS-CONTINUE-FUNC-03-SW   PIC  X(01)  VALUE 'N'.          00241018
002420         88  PS-CONTINUE-FUNC-03              VALUE 'Y'.          00242018
002430         88  PS-END-FUNC-03                   VALUE 'N'.          00243018
002440     05  PS-END-OF-RECITM-CSR-SW  PIC  X(01)  VALUE 'N'.          00244018
002450         88  PS-END-OF-RECITM-CSR             VALUE 'Y'.          00245018
002460         88  PS-NOT-END-OF-RECITM-CSR         VALUE 'N'.          00246018
002470     05  PS-LIST-END-SW           PIC  X(01)  VALUE 'N'.          00247018
002480         88  PS-LIST-END                      VALUE 'Y'.          00248018
002490         88  PS-NO-LIST-END                   VALUE 'N'.          00249018
002500     05  PS-BLOCK-ERROR-SW        PIC  X(01)  VALUE 'Y'.          00250018
002510         88  PS-NO-BLOCK-ERROR                VALUE 'Y'.          00251018
002520         88  PS-BLOCK-ERROR                   VALUE 'N'.          00252018
002530     05  PS-FREE-ASTRAY-SW        PIC  X(01)  VALUE 'N'.          00253018
002540         88  PS-FREE-ASTRAY                   VALUE 'Y'.          00254018
002550         88  PS-FREE-ASTRAY-NO                VALUE 'N'.          00255018
002560     05  PS-VERIFIED-RECEIVER-SW  PIC  X(01)  VALUE 'N'.          00256018
002570         88  PS-VERIFIED-RECEIVER             VALUE 'Y'.          00257018
002580         88  PS-NO-VERIFIED-RECEIVER          VALUE 'N'.          00258018
002590     05  PS-AR-STATUS-SW          PIC  X(01)  VALUE 'N'.          00259018
002600         88  PS-AR-STATUS                     VALUE 'Y'.          00260018
002610         88  PS-NO-AR-STATUS                  VALUE 'N'.          00261018
002620     05  PS-STOR-TRBL-SW          PIC  X(01)  VALUE 'N'.          00262018
002630         88  PS-NO-STOR-TRBL                  VALUE 'N'.          00263018
002640         88  PS-CURR-STOR-TRBL                VALUE 'Y'.          00264018
002650         88  PS-PREV-STOR-TRBL                VALUE 'P'.          00265018
002660     05  PS-OTHER-TRBL-SW         PIC  X(01)  VALUE 'N'.          00266018
002670         88  PS-NO-OTHER-TRBL                 VALUE 'N'.          00267018
002680         88  PS-OTHER-TRBL                    VALUE 'Y'.          00268018
002690     05  PS-SHIPMENT-CURSOR-SW    PIC  X(01)  VALUE 'N'.          00269018
002700         88  PS-NO-MORE-SHIPMENTS             VALUE 'Y'.          00270018
002710     05  PS-PO-REC-COLOR-SW       PIC  X(01)  VALUE 'N'.          00271018
002720         88 PS-COLOR-RED                      VALUE 'Y'.          00272018
002730         88 PS-COLOR-RED-NO                   VALUE 'N'.          00273018
002740     05  PS-TROUBLE-SW            PIC  X(01)  VALUE 'N'.          00274018
002750         88 PS-TROUBLE                        VALUE 'Y'.          00275018
002760         88 PS-TROUBLE-NO                     VALUE 'N'.          00276018
002770     05  PS-TRECITM-CURSOR-SW     PIC  X(01)  VALUE 'N'.          00277018
002780         88  PS-EOF-TRECITM-CSR               VALUE 'Y'.          00278018
002790         88  PS-EOF-TRECITM-CSR-NO            VALUE 'N'.          00279018
002800     05  PS-PRESENTATION-SW       PIC  X(01)  VALUE ' '.          00280018
002810         88  PS-PRESENTATION-DONE             VALUE 'Y'.          00281018
002820*LMM 05  PS-TCENPPC-CURSOR-SW     PIC  X(01)  VALUE 'N'.          00282018
002830*        88  PS-EOF-PPC-CSR                   VALUE 'Y'.          00283018
002840     05  PS-PRICE-SW              PIC  X(01)  VALUE ' '.          00284018
002850         88  PS-PRICE-DONE                    VALUE 'Y'.          00285018
002860     05  PS-UNLOAD-SW             PIC  X(01)  VALUE 'N'.          00286018
002870         88 PS-UNLOAD-YES                     VALUE 'Y'.          00287018
002880         88 PS-UNLOAD-NO                      VALUE 'N'.          00288018
002890     05  PS-PACK-BY-STORE-SW      PIC  X(01)  VALUE 'N'.          00289018
002900         88 PS-PACK-BY-STORE                  VALUE 'Y'.          00290018
002910         88 PS-PACK-BY-STORE-NO               VALUE 'N'.          00291018
002920     05  PS-ACTL-COUNT-ZERO-SW    PIC  X(01)  VALUE 'N'.          00292018
002930         88 PS-ACTL-COUNT-ZERO                VALUE 'Y'.          00293018
002940         88 PS-ACTL-COUNT-ZERO-NO             VALUE 'N'.          00294018
002950     05  PS-HDR-LBL-FRM-SCRN-SW   PIC  X(01)  VALUE 'N'.          00295018
002960         88 PS-HDRLBL-FRMSCRN-YES             VALUE 'Y'.          00296018
002970         88 PS-HDRLBL-FRMSCRN-NO              VALUE 'N'.          00297018
002980     05  PS-PBS-ERRORS-FOUND-SW   PIC  X(01)  VALUE 'N'.          00298018
002990         88  PS-PBS-ERRORS-FOUND              VALUE 'Y'.          00299018
003000         88  PS-PBS-ERRORS-FOUND-NO           VALUE 'N'.          00300018
003010     05  PS-PBS-PACK-TYPE-SW      PIC  X(01)  VALUE 'N'.          00301018
003020         88  PS-PBS-PACK-TYPE-YES             VALUE 'Y'.          00302018
003030         88  PS-PBS-PACK-TYPE-NO              VALUE 'N'.          00303018
003040     05  PS-DC-LEVEL-SW           PIC  X(01)  VALUE 'N'.          00304018
003050         88  PS-DC-LEVEL-YES                  VALUE 'Y'.          00305018
003060         88  PS-DC-LEVEL-NO                   VALUE 'N'.          00306018
003070     05  PS-SOFT-ABORT-ERROR-SW    PIC  X(01) VALUE 'N'.          00307018
003080         88  PS-SOFT-ABORT-ERROR              VALUE 'Y'.          00308018
003090         88  PS-NO-SOFT-ABORT-ERROR           VALUE 'N'.          00309018
003100     05  PS-MISDIRECT-SW           PIC  X(01) VALUE 'N'.          00310018
003110         88  PS-MISDIRECT-YES                 VALUE 'Y'.          00311018
003120         88  PS-MISDIRECT-NO                  VALUE 'N'.          00312018
003130* JAK 04/2007 - ADD WMS SWITCH                                    00313018
003140     05  PS-DC-ON-WMOS-SW          PIC  X(01) VALUE 'N'.          00314018
003150         88  PS-DC-ON-WMOS-YES                VALUE 'Y'.          00315018
003160         88  PS-DC-ON-WMOS-NO                 VALUE 'N'.          00316018
003170     05  PS-SEASET-CHECK-SW        PIC  X(01) VALUE 'N'.          00317018
003180         88  PS-SEASET-CHECK-YES              VALUE 'Y'.          00318018
003190         88  PS-SEASET-CHECK-NO               VALUE 'N'.          00319018
003200***************************************************************** 00320018
003210*                                                                 00321018
003220 01  DN-DB2-NULL-INDICATORS.                                      00322018
003230     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE ZEROES. 00323018
003240     05  DN-EXP-CTN-CNT             PIC S9(04) COMP VALUE ZEROES. 00324018
003250*                                                                 00325018
003260 01  PV-PROGRAM-VARIABLES.                                        00326018
003270     05  PV-PPCBEF-QTY                  PIC  S9(9)  COMP.         00327018
003280     05  PV-PPCAFT-QTY                  PIC  S9(9)  COMP.         00328018
003290     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      00329018
003300                                                    COMP SYNC.    00330018
003310     05  PV-SUB                         PIC S9(04)  VALUE +0      00331018
003320                                                    COMP SYNC.    00332018
003330     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00333018
003340                                                    COMP SYNC.    00334018
003350     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00335018
003360                                                    COMP-3.       00336018
003370     05  PV-COUNT-MISDIRECTS            PIC S9(09)  VALUE +0      00337018
003380                                                    COMP-3.       00338018
003390     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00339018
003400                                                    COMP-3.       00340018
003410     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00341018
003420                                                    COMP-3.       00342018
003430     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00343018
003440                                                    COMP-3.       00344018
003450     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00345018
003460                                                    COMP SYNC.    00346018
003470     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00347018
003480                                                    COMP SYNC.    00348018
003490     05  PV-ITEM                        PIC S9(04)  VALUE +0      00349018
003500                                                    COMP SYNC.    00350018
003510     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00351018
003520                                                    COMP SYNC.    00352018
003530     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00353018
003540                                                    COMP SYNC.    00354018
003550     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00355018
003560                                                    COMP SYNC.    00356018
003570     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00357018
003580                                                    COMP SYNC.    00358018
003590     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      00359018
003600                                                    COMP SYNC.    00360018
003610     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00361018
003620                                                    COMP SYNC.    00362018
003630     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00363018
003640                                                    COMP SYNC.    00364018
003650     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      00365018
003660                                                    COMP SYNC.    00366018
003670     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      00367018
003680                                                    COMP SYNC.    00368018
003690     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      00369018
003700                                                    COMP SYNC.    00370018
003710     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      00371018
003720                                                    COMP SYNC.    00372018
003730     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00373018
003740                                                    COMP SYNC.    00374018
003750     05  PV-PO-RCVR-UNT-CNTR            PIC S9(06)  VALUE +0      00375018
003760                                                    COMP.         00376018
003770     05  PV-DB2-COUNT                   PIC S9(09) VALUE +0       00377018
003780                                                    COMP-3.       00378018
003790     05  PV-VERIFY-ITM-QTY              PIC S9(09)  VALUE +0      00379018
003800                                                    COMP.         00380018
003810     05  PV-AP-VERIFY-ITM-QTY           PIC S9(09)  VALUE +0      00381018
003820                                                    COMP.         00382018
003830     05  PV-DB2-COUNT-EXP-SCN           PIC S9(05)  VALUE +0      00383018
003840                                                    COMP.         00384018
003850     05  PV-DB2-COUNT-REC-TRLR          PIC S9(04)  VALUE +0      00385018
003860                                                    COMP.         00386018
003870     05  PV-DB2-COUNT-ACTL-CTN          PIC S9(04)  VALUE +0      00387018
003880                                                    COMP.         00388018
003890     05  PV-DB2-COUNT-ACTL-SCN          PIC S9(04)  VALUE +0      00389018
003900                                                    COMP.         00390018
003910     05  PV-DB2-COUNT-MANIFEST          PIC S9(04)  VALUE +0      00391018
003920                                                    COMP SYNC.    00392018
003930     05  PV-DB2-COUNT-PBS-ERRORS        PIC S9(04)  VALUE +0      00393018
003940                                                    COMP SYNC.    00394018
003950     05  PV-REC-SEQ-NBR                 PIC S9(09)  VALUE +0      00395018
003960                                                    COMP SYNC.    00396018
003970     05  PV-PERCENT-SCANNED             PIC  9(03)V99.            00397018
003980     05  PV-PERCENT-EDITED.                                       00398018
003990         10  PV-PERCENT                 PIC  Z(03).99.            00399018
004000     05  PV-DIVIDEND                    PIC   9(03)V9999.         00400018
004010     05  PV-PACK-TYPE                   PIC X(06) VALUE SPACES.   00401018
004020     05  PV-ONE                         PIC S9(09) COMP.          00402018
004030                                                                  00403018
004040     05  PV-PO-STATUS                   PIC X(02) VALUE SPACES.   00404018
004041     05  PV-RCVR-CURR-OPER              PIC S9(4) COMP.           00404125
004050                                                                  00405018
004060     05  PV-PO-RECEIVER.                                          00406018
004070         10  PV-PO-NBR                  PIC  9(08).               00407018
004080         10  FILLER                     PIC  X(01) VALUE '-'.     00408018
004090         10  PV-RECEIVER                PIC  9(04).               00409018
004100     05  PV-PO-RECEIVER-X REDEFINES                               00410018
004110         PV-PO-RECEIVER                 PIC X(13).                00411018
004120     05  PV-UNION-TYPE                  PIC  X(01).               00412018
004130     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00413018
004140                                                    COMP-3.       00414018
004150     05  PV-ORIGINAL-BLOCK              PIC S9(04)  VALUE +0      00415018
004160                                                    COMP SYNC.    00416018
004170     05  PV-ITEMS-HOLD                  PIC S9(03)  COMP-3.       00417018
004180     05  PV-ITEMS-DIFF                  PIC S9(03)  COMP-3.       00418018
004190     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00419018
004200                                                    COMP-3.       00420018
004210     05  PV-ERROR-MSG.                                            00421018
004220         10  FILLER                     PIC X(4) VALUE 'PO= '.    00422018
004230         10  PV-ERROR-OPER-UNT-ID       PIC Z(3)9.                00423018
004240         10  FILLER                     PIC X(1) VALUE '-'.       00424018
004250         10  PV-ERROR-PO                PIC Z(8)9.                00425018
004260         10  FILLER                     PIC X(1) VALUE '-'.       00426018
004270         10  PV-ERROR-SEQ               PIC Z(8)9.                00427018
004280         10  FILLER                     PIC X(7) VALUE '  TRIP='. 00428018
004290         10  PV-ERROR-TRIP              PIC Z(9)9.                00429018
004300         10  FILLER                     PIC X(7) VALUE '  TYPE='. 00430018
004310         10  PV-ERROR-TYPE              PIC X(01).                00431018
004320                                                                  00432018
004330     05  PV-NUMBER-OF-SELECTED-ITEM     PIC S9(9) VALUE ZERO      00433018
004340                                                  COMP-3.         00434018
004350     05  PV-PRINTER-NO.                                           00435018
004360         10  PV-PRINTER-NO-9            PIC 9(03) VALUE ZERO.     00436018
004370     05  PV-PO-NBR-8-POSITIONS          PIC 9(08) VALUE ZEROES.   00437018
004380     05  PV-RCVR-SEQ-4-DGT              PIC 9(04) VALUE ZEROES.   00438018
004390     05  PV-RCVR-SEQ-4-X REDEFINES PV-RCVR-SEQ-4-DGT.             00439018
004400         10  FILLER                      PIC  X(01).              00440018
004410         10  PV-RCVR-SEQ-3-X             PIC  X(03).              00441018
004420     05  PV-DISPLAY-ORD-NBR             PIC 9(07) VALUE 0.        00442018
004430     05  PV-DISPLAY-ITEM                PIC Z(15).                00443018
004440     05  PV-DISPLAY-PO                  PIC Z(09).                00444018
004450     05  PV-DISPLAY-RCVR                PIC 9(04).                00445018
004460                                                                  00446018
004470     05 PV-DC-5-CHAR-ABBR            PIC X(05) VALUE SPACES.      00447018
004480     05 PV-DC-5-CHAR-ABBR-R REDEFINES PV-DC-5-CHAR-ABBR.          00448018
004490         10 FILLER                   PIC  X(03).                  00449018
004500         10 PV-2-DIGIT-DC-ABBR       PIC  X(02).                  00450018
004510     05  PV-FORMAT-DATE                  PIC  X(06)  VALUE SPACES.00451018
004520     05  FILLER REDEFINES PV-FORMAT-DATE.                         00452018
004530         10  PV-MM                       PIC  X(02).              00453018
004540         10  PV-DD                       PIC  X(02).              00454018
004550         10  PV-YY                       PIC  X(02).              00455018
004560     05  PV-DB2-REC-DATE              PIC  X(10).                 00456018
004570     05  PV-DB2-DATE                  PIC  X(10).                 00457018
004580     05  FILLER  REDEFINES PV-DB2-DATE.                           00458018
004590         10  PV-DB2-DATE-CC           PIC  X(02).                 00459018
004600         10  PV-DB2-DATE-YY           PIC  X(02).                 00460018
004610         10  FILLER                   PIC  X(01).                 00461018
004620         10  PV-DB2-DATE-MM           PIC  X(02).                 00462018
004630         10  FILLER                   PIC  X(01).                 00463018
004640         10  PV-DB2-DATE-DD           PIC  X(02).                 00464018
004650     05  PV-OPER-UNT-ID               PIC 9(04).                  00465018
004660     05  PV-OPER-UNT-ID-X REDEFINES                               00466018
004670         PV-OPER-UNT-ID               PIC X(04).                  00467018
004680     05  PV-ACTL-CART-COUNT           PIC 9(04).                  00468018
004690     05  PV-ACTL-CART-COUNT-X REDEFINES                           00469018
004700         PV-ACTL-CART-COUNT           PIC X(04).                  00470018
004710     05  PV-EXP-CART-COUNT            PIC 9(04).                  00471018
004720     05  PV-EXP-CART-COUNT-X REDEFINES                            00472018
004730         PV-EXP-CART-COUNT            PIC X(04).                  00473018
004740     05  PV-DISPLAY-TRIP              PIC  9(09).                 00474018
004750                                                                  00475018
004760     05  PV-CICS-MSG-AREA             PIC X(80)  VALUE SPACE.     00476018
004770                                                                  00477018
004780     05  PV-HNG-FOLD-CDE              PIC X(01) VALUE SPACE.      00478018
004790                                                                  00479018
004800*                                                                 00480018
004810*** 3/19/13 - BEGIN                                               00481018
004820     05  PV-PO-ATTACH-TRLR            PIC S9(9) COMP              00482018
004830                                                VALUE ZEROES.     00483018
004840     05  PV-PO-RCVR-TRANSCRB          PIC S9(9) COMP              00484018
004850                                                VALUE ZEROES.     00485018
004860     05  PV-PO-PBS-ERROR              PIC S9(9) COMP              00486018
004870                                                VALUE ZEROES.     00487018
004880     05  PV-SHIPT-UNT-ID-SMOOTH       PIC S9(18)V COMP-3          00488018
004890                                                VALUE ZEROES.     00489018
004900     05  PV-PO-NBR-PHYSCL             PIC S9(9) COMP              00490018
004910                                                VALUE ZEROES.     00491018
004911     05  PV-FUNC-TXT                  PIC  X(24).                 00491120
004920*** 3/19/13 - BEGIN                                               00492018
004930*                                                                 00493018
004931     05  PV-BULK-MULT-SKU             PIC S9(09) VALUE +0         00493147
004932                                                 COMP-3.          00493247
004940                                                                  00494018
004950******************************************************************00495018
004960**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **00496018
004970**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **00497018
004980**  APPLICATION-SPECIFIC COMMAREA.                              **00498018
004990******************************************************************00499018
005000 01  LQW-LIST-QUEUE-WORK-AREA.                                    00500018
005010     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  00501018
005020     05  LQW-ITEM-ENTRIES               OCCURS 9  TIMES           00502018
005030                                        INDEXED BY LQW-IDX.       00503018
005040         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       00504018
005050*                                                                 00505018
005060         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               00506018
005070         10  LQW-SELECTED-SW            PIC  X(01).               00507018
005080             88  LQW-SELECT                         VALUE 'S'.    00508018
005090             88  LQW-DESELECT                       VALUE ' '.    00509018
005100         10  LQW-ACTION                 PIC  X(03).               00510018
005110         10  LQW-PO-IND                 PIC  X(01).               00511018
005120         10  LQW-PO-RECEIVER.                                     00512018
005130             15 LQW-PO-NBR              PIC  9(08).               00513018
005140             15 FILLER                  PIC  X(01).               00514018
005150             15 LQW-RECEIVER            PIC  9(04).               00515018
005160         10  LQW-PO-STATUS              PIC  X(02).               00516018
005170         10  LQW-VND-NME.                                         00517018
005180                 15 LQW-VND-NME-18      PIC  X(18).               00518018
005190                 15 LQW-VND-NME-30      PIC  X(12).               00519018
005200         10  LQW-PACK-TYPE              PIC  X(01).               00520018
005210         10  LQW-EXP-CART-COUNT         PIC  9(05) COMP.          00521020
005220         10  LQW-ACTL-CART-COUNT        PIC  9(05) COMP.          00522020
005230         10  LQW-EXP-SCN-COUNT          PIC  9(05) COMP.          00523020
005240         10  LQW-ACTL-SCN-COUNT         PIC  9(05) COMP.          00524020
005250         10  LQW-PERCENT-SCND           PIC  X(06).               00525018
005260         10  LQW-TOTAL-UNITS            PIC  9(06) COMP.          00526020
005270         10  LQW-CSR-IND                PIC  X(01).               00527018
005280         10  LQW-AD-INFO                PIC  X(04).               00528018
005290         10  LQW-PRE-TKT-IND            PIC  X(01).               00529018
005300         10  LQW-PACK-BY-ST-IND         PIC  X(01).               00530018
005310         10  LQW-AD-DATE                PIC  X(06).               00531018
005330         10  LQW-DETAIL-CHECK           PIC  X(01).               00533018
005340         10  LQW-COLOR-SW               PIC  X(01).               00534018
005350             88 LQW-COLOR-RED           VALUE 'Y'.                00535018
005360             88 LQW-COLOR-RED-NO        VALUE 'N'.                00536018
005370         10  LQW-COLOR-YELLOW-SW        PIC  X(01).               00537018
005380             88 LQW-COLOR-YELLOW        VALUE 'Y'.                00538018
005390             88 LQW-COLOR-YELLOW-NO     VALUE 'N'.                00539018
005400         10  LQW-AUTO-VE-SW             PIC  X(01).               00540018
005410             88 LQW-AUTO-VE             VALUE 'Y'.                00541018
005420             88 LQW-AUTO-VE-NO          VALUE 'N'.                00542018
005430         10  LQW-CHCKIN-SW              PIC X(01).                00543018
005440             88 LQW-CHCKIN-YES          VALUE 'Y'.                00544018
005450             88 LQW-CHCKIN-NO           VALUE 'N'.                00545018
005470         10  LQW-DEPT-CLASS.                                      00547018
005480             15  LQW-DEPT               PIC  X(03).               00548018
005490             15  LQW-CLASS.                                       00549018
005500                 20  LQW-MAJOR-CLASS    PIC  X(01).               00550018
005510                 20  LQW-CLASS-ZERO     PIC  X(01).               00551018
005520         10  LQW-MULT-IND               PIC  X(01).               00552018
005530         10  LQW-GOH-IND                PIC  X(01).               00553018
005540         10  LQW-STOR-TRBL-SW           PIC  X(01).               00554018
005550             88  LQW-NO-STOR-TRBL       VALUE 'N'.                00555018
005560             88  LQW-CURR-STOR-TRBL     VALUE 'Y'.                00556018
005570             88  LQW-PREV-STOR-TRBL     VALUE 'P'.                00557018
005580         10  LQW-OTHER-TRBL-SW          PIC  X(01).               00558018
005590             88  LQW-NO-OTHER-TRBL      VALUE 'N'.                00559018
005600             88  LQW-OTHER-TRBL         VALUE 'Y'.                00560018
005610         10  LQW-OPER-SET-DESC          PIC  X(15).               00561018
005620         10  LQW-STOR-IND               PIC  X(01).               00562018
005630         10  LQW-REC-CLK                PIC  X(03).               00563018
005640         10  LQW-PBS-ERRORS-SW          PIC  X(01).               00564018
005650             88  LQW-PBS-ERRORS-FOUND               VALUE 'Y'.    00565018
005660         10  LQW-TROUBLE-SW          PIC  X(01).                  00566018
005670             88  LQW-TROUBLE         VALUE 'Y'.                   00567018
005680             88  LQW-TROUBLE-NO      VALUE 'N'.                   00568018
005690         10  LQW-REC-ATCHD-TRLR-SW   PIC  X(01).                  00569018
005700             88  LQW-REC-ATCHD-TRLR     VALUE 'Y'.                00570018
005710             88  LQW-REC-ATCHD-TRLR-NO  VALUE 'N'.                00571018
005720         10  LQW-REC-TRNSCRBD-SW     PIC  X(01).                  00572018
005730             88  LQW-REC-TRNSCRBD       VALUE 'Y'.                00573018
005740             88  LQW-REC-TRNSCRBD-NO    VALUE 'N'.                00574018
005750         10  LQW-MISDIRECT-SW        PIC  X(01).                  00575018
005760             88  LQW-MISDIRECT-YES      VALUE 'Y'.                00576018
005770             88  LQW-MISDIRECT-NO       VALUE 'N'.                00577018
005771         10  LQW-CURR-OPER-UNT-ID    PIC S9(04) COMP.             00577120
005772         10  LQW-BULK-MULT-SKU-SW        PIC  X(01).              00577244
005773             88  LQW-BULK-MULT-SKU-YES        VALUE 'Y'.          00577344
005774             88  LQW-BULK-MULT-SKU-NO         VALUE 'N'.          00577444
005780                                                                  00578018
005790*----------------------------------------------------------------*00579018
005800*    COMMAREA FOR SEASONAL SET AND FIXT ID MODULE (PCKUT025)      00580018
005810*----------------------------------------------------------------*00581018
005820     COPY PCWS240.                                                00582018
005830                                                                  00583018
005840*-----------------------------------------------------------------00584018
005850*  COPYBOOK FOR LOGISTIC MODULE XLKUT001                          00585018
005860*-----------------------------------------------------------------00586018
005870*    COPY XLWS001.                                                00587018
005880                                                                  00588018
005890*-----------------------------------------------------------------00589018
005900* COMMAREA FOR XLKUT086 - PERM PRICE MODULE                       00590018
005910*-----------------------------------------------------------------00591018
005920     COPY XLWS086.                                                00592018
005930/                                                                 00593018
005940***************************************************************** 00594018
005950*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 00595018
005960*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 00596018
005970***************************************************************** 00597018
005980     COPY RCWS040.                                                00598018
005990/                                                                 00599018
006000******************************************************************00600018
006010* COMMAREA FOR XLKUT071 - LOCATION MODULE                         00601018
006020******************************************************************00602018
006030     COPY XLWS071.                                                00603018
006040/                                                                 00604018
006050*---------------------------------------------------------------* 00605018
006060*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 00606018
006070*---------------------------------------------------------------* 00607018
006080     COPY SUWS004.                                                00608018
006090     COPY RCWS816.                                                00609018
006100                                                                  00610018
006110*---------------------------------------------------------------* 00611018
006120*  RECORD LAYOUT FOR SELECTION TEMP STORAGE QUEUE.  *             00612018
006130*---------------------------------------------------------------* 00613018
006140     COPY RCWS013.                                                00614018
006150     COPY PCWS237.                                                00615018
006160                                                                  00616018
006170*    SELECT QUEUE PASSED TO SUKCS589 AUDIT RESULTS LIST           00617018
006180     COPY SUWS025.                                                00618018
006190                                                                  00619018
006260*----------------------------------------------------------------*00626018
006270*  WORK AREA PASSED IN CALL TO DPKUT500                          *00627018
006280*----------------------------------------------------------------*00628018
006290     COPY DPWS500.                                                00629018
006300                                                                  00630018
006310*---------------------------------------------------------------* 00631018
006320*    MAP LAYOUT                                                 * 00632018
006330*---------------------------------------------------------------* 00633018
006340                                                                  00634018
006350     COPY RCKM815.                                                00635018
006360*                                                                 00636018
006370*---------------------------------------------------------------* 00637018
006380 01  MR-OCCURS-LAYOUT                   REDEFINES  RC815AO.       00638018
006390     05  FILLER                         PIC X(178).               00639048
006400     05  MR-SCROLL-AREA                 OCCURS 9  TIMES.          00640018
006410         10  MR-SELECTL                 PIC S9(04) COMP.          00641018
006420         10  MR-SELECTA                 PIC  X(01).               00642018
006430         10  MR-SELECTC                 PIC  X(01).               00643018
006440         10  MR-SELECTH                 PIC  X(01).               00644018
006450         10  MR-SELECTI                 PIC  X(01).               00645018
006460                                                                  00646018
006470         10  MR-ACTIONL                 PIC S9(04) COMP.          00647018
006480         10  MR-ACTIONA                 PIC  X(01).               00648018
006490         10  MR-ACTIONC                 PIC  X(01).               00649018
006500         10  MR-ACTIONH                 PIC  X(01).               00650018
006510         10  MR-ACTION                  PIC  X(03).               00651018
006520                                                                  00652018
006530         10  MR-PO-INDL                PIC S9(04) COMP.           00653018
006540         10  MR-PO-INDA                PIC  X(01).                00654018
006550         10  MR-PO-INDC                PIC  X(01).                00655018
006560         10  MR-PO-INDH                PIC  X(01).                00656018
006570         10  MR-PO-IND                 PIC  X(01).                00657018
006580                                                                  00658018
006590         10  MR-PO-RCVRL                PIC S9(04) COMP.          00659018
006600         10  MR-PO-RCVRA                PIC  X(01).               00660018
006610         10  MR-PO-RCVRC                PIC  X(01).               00661018
006620         10  MR-PO-RCVRH                PIC  X(01).               00662018
006630         10  MR-PO-RCVR                 PIC  X(13).               00663018
006640                                                                  00664018
006650         10  MR-PO-STATUSL              PIC S9(04) COMP.          00665018
006660         10  MR-PO-STATUSA              PIC  X(01).               00666018
006670         10  MR-PO-STATUSC              PIC  X(01).               00667018
006680         10  MR-PO-STATUSH              PIC  X(01).               00668018
006690         10  MR-PO-STATUS               PIC  X(02).               00669018
006700                                                                  00670018
006710         10  MR-VND-NMEL                PIC S9(04) COMP.          00671018
006720         10  MR-VND-NMEA                PIC  X(01).               00672018
006730         10  MR-VND-NMEC                PIC  X(01).               00673018
006740         10  MR-VND-NMEH                PIC  X(01).               00674018
006750         10  MR-VND-NME                 PIC  X(18).               00675018
006760                                                                  00676018
006770         10  MR-PACK-TYPEL                 PIC S9(04) COMP.       00677018
006780         10  MR-PACK-TYPEA                 PIC  X(01).            00678018
006790         10  MR-PACK-TYPEC                 PIC  X(01).            00679018
006800         10  MR-PACK-TYPEH                 PIC  X(01).            00680018
006810         10  MR-PACK-TYPE                  PIC  X(01).            00681018
006820                                                                  00682018
006830         10  MR-EXP-CART-COUNTL         PIC S9(04) COMP.          00683018
006840         10  MR-EXP-CART-COUNTA         PIC  X(01).               00684018
006850         10  MR-EXP-CART-COUNTC         PIC  X(01).               00685018
006860         10  MR-EXP-CART-COUNTH         PIC  X(01).               00686018
006870         10  MR-EXP-CART-COUNT-X.                                 00687018
006880             15 MR-EXP-CART-COUNT       PIC  ZZZ9.                00688018
006890                                                                  00689018
006900         10  MR-ACTL-CART-COUNTL        PIC S9(04) COMP.          00690018
006910         10  MR-ACTL-CART-COUNTA        PIC  X(01).               00691018
006920         10  MR-ACTL-CART-COUNTC        PIC  X(01).               00692018
006930         10  MR-ACTL-CART-COUNTH        PIC  X(01).               00693018
006940         10  MR-ACTL-CART-COUNT-X.                                00694018
006950             15 MR-ACTL-CART-COUNT      PIC  ZZZ9.                00695018
006960                                                                  00696018
006970         10  MR-EXP-SCN-COUNTL          PIC S9(04) COMP.          00697018
006980         10  MR-EXP-SCN-COUNTA          PIC  X(01).               00698018
006990         10  MR-EXP-SCN-COUNTC          PIC  X(01).               00699018
007000         10  MR-EXP-SCN-COUNTH          PIC  X(01).               00700018
007010         10  MR-EXP-SCN-COUNT-X.                                  00701018
007020             15  MR-EXP-SCN-COUNT       PIC ZZZ9.                 00702018
007030                                                                  00703018
007040         10  MR-ACTL-SCN-COUNTL         PIC S9(04) COMP.          00704018
007050         10  MR-ACTL-SCN-COUNTA         PIC  X(01).               00705018
007060         10  MR-ACTL-SCN-COUNTC         PIC  X(01).               00706018
007070         10  MR-ACTL-SCN-COUNTH         PIC  X(01).               00707018
007080         10  MR-ACTL-SCN-COUNT-X.                                 00708018
007090             15  MR-ACTL-SCN-COUNT      PIC ZZZ9.                 00709018
007100                                                                  00710018
007110         10  MR-PERCENT-SCNDL           PIC S9(04) COMP.          00711018
007120         10  MR-PERCENT-SCNDA           PIC  X(01).               00712018
007130         10  MR-PERCENT-SCNDC           PIC  X(01).               00713018
007140         10  MR-PERCENT-SCNDH           PIC  X(01).               00714018
007150         10  MR-PERCENT-SCND-X.                                   00715018
007160             15  MR-PERCENT-SCND        PIC  X(06).               00716018
007170                                                                  00717018
007180         10  MR-TOTAL-UNITSL            PIC S9(04) COMP.          00718018
007190         10  MR-TOTAL-UNITSA            PIC  X(01).               00719018
007200         10  MR-TOTAL-UNITSC            PIC  X(01).               00720018
007210         10  MR-TOTAL-UNITSH            PIC  X(01).               00721018
007220         10  MR-TOTAL-UNITS-X.                                    00722018
007230             15  MR-TOTAL-UNITS         PIC  ZZZZZ9.              00723018
007240     05  FILLER                         PIC  X(12).               00724018
007250                                                                  00725018
007260                                                                  00726018
007270                                                                  00727018
007280*-----------------------------------------------------------------00728018
007290*                                                                 00729018
007300*-----------------------------------------------------------------00730018
007310*  COPYBOOK FOR TCENPPC CURSOR                                    00731018
007320*-----------------------------------------------------------------00732018
007330*LMM  COPY PEWS049.                                               00733018
007340*                                                                 00734018
007350*-----------------------------------------------------------------00735018
007360*  SENDING/RECEIVING AREA FOR THE                                *00736018
007370*  PRINTER VALIDATION ROUTING (DPKCS060)                         *00737018
007380*----------------------------------------------------------------*00738018
007390     COPY DPWS072.                                                00739018
007400                                                                  00740018
007410     COPY PCWS140.                                                00741018
007420*                                                                 00742018
007430*-----------------------------------------------------------------00743018
007440*  SENDING/RECEIVING AREA FOR THE                                *00744018
007450*  STORE UNIT ASJUSTMENT PO LIST SCREEN (SUKCS755)               *00745018
007460*----------------------------------------------------------------*00746018
007470     COPY SUWS039.                                                00747018
007480*                                                                 00748018
007490*----------------------------------------------------------------*00749018
007500**  SECURITY SUBROUTINE PARAMETERS                                00750018
007510*----------------------------------------------------------------*00751018
007520     COPY DPWS008.                                                00752018
007530*---------------------------------------------------------------* 00753018
007540*    ATTRIBUTE SETTINGS COPYBOOK.                               * 00754018
007550*---------------------------------------------------------------* 00755018
007560                                                                  00756018
007570     COPY DPWS015.                                                00757018
007580                                                                  00758018
007590*---------------------------------------------------------------* 00759018
007600*    FUNCTION KEYS COPYBOOK.                                    * 00760018
007610*---------------------------------------------------------------* 00761018
007620                                                                  00762018
007630     COPY DPWS016.                                                00763018
007640                                                                  00764018
007650*---------------------------------------------------------------* 00765018
007660*    NUMERIC EDIT LAYOUT.                                       * 00766018
007670*---------------------------------------------------------------* 00767018
007680                                                                  00768018
007690     COPY DPWS010I.                                               00769018
007700                                                                  00770018
007710******************************************************************00771057
007720** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **00772057
007721** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00772157
007730******************************************************************00773057
007740     COPY DPWS030.                                                00774018
007741     COPY DPWS930.                                                00774157
007750                                                                  00775018
007760*---------------------------------------------------------------* 00776018
007770*    STANDARD COMMAREA.                                         * 00777018
007780*---------------------------------------------------------------* 00778018
007790     COPY DPWS020.                                                00779018
007800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00780018
007810                                                                  00781018
007820*---------------------------------------------------------------* 00782018
007830* INTER-APPLICATION COMMAREA.                                   * 00783018
007840*   RCWS814 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 00784018
007850*             SPEC SCREEN.                                      * 00785018
007860*   SUWS003 - IS THE INPUT  LAYOUT THAT WILL BE PASSED FROM     * 00786018
007870*             THE RECEIVER CHECK-IN SCREEN.                     * 00787018
007880*   SUWS024 - IS THE INPUT  LAYOUT THAT WILL BE PASSED TO       * 00788018
007890*             THE AUDIT RESULTS LIST (SUKCS589)                 * 00789018
007900*---------------------------------------------------------------* 00790018
007910                                                                  00791018
007920         10  INTER-APPL-COMM-AREA       PIC X(200).               00792018
007930     COPY RCWS814.                                                00793018
007940     COPY RCWS815.                                                00794018
007950     COPY SUWS002.                                                00795018
007960     COPY SUWS003.                                                00796018
007970     COPY RCWS015.                                                00797018
007980     COPY PCWS236.                                                00798018
007990     COPY SUWS024.                                                00799018
008000     COPY SUWS038.                                                00800018
008010     COPY SUWS046.                                                00801018
008020                                                                  00802018
008030*LMM                                                              00803018
008040**** THE FOLLOWING COMMAREA IS USED TO CREATE TROUBLE             00804018
008050     COPY PCWS000.                                                00805018
008060*                                                                 00806018
008070*---------------------------------------------------------------* 00807018
008080*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 00808018
008090*---------------------------------------------------------------* 00809018
008100         10  ASC-SPECIFIC-COMMAREA.                               00810018
008110             15  ASC-LIST-KEYS.                                   00811018
008120                 20  ASC-OPER-UNT-ID           PIC S9(04)  COMP.  00812018
008130                 20  ASC-KEY-OPER-UNT-ID       PIC S9(04)  COMP.  00813018
008140                 20  ASC-FCLTY-ID              PIC S9(04)  COMP.  00814018
008150                 20  ASC-KEY-FCLTY-ID          PIC S9(04)  COMP.  00815018
008160                 20  ASC-FCLTY-NME                   PIC  X(25).  00816018
008170                 20  ASC-SCAC-ID                     PIC  X(04).  00817018
008180                 20  ASC-VEH-NBR                     PIC  X(10).  00818018
008190                 20  ASC-KEY-PO-NBR-X.                            00819018
008192                     25  ASC-KEY-PO-NBR              PIC  9(08).  00819218
008194                 20  ASC-KEY-REC-SEQ-NBR             PIC S9(04)   00819418
008195                                                         COMP.    00819518
008196                 20  ASC-KEY-ARRIVAL-DTE             PIC  X(10).  00819618
008197                 20  ASC-ARRIVAL-DTE                 PIC  X(06).  00819718
008198                 20  ASC-ARRIVAL-DTE-CC              PIC  X(02).  00819818
008199                 20  ASC-STATUS                      PIC  X(02).  00819918
008200                 20  ASC-STATUS-DTE                  PIC  X(10).  00820018
008210                 20  ASC-TRLR-STATUS                 PIC  X(10).  00821018
008220                 20  ASC-TROUB-STATUS-1              PIC  X(11).  00822018
008230                 20  ASC-HDR-LBL-PRTID               PIC  X(08).  00823018
008240                 20  ASC-HDR-LBL-PRTID-N             PIC  9(08).  00824018
008250                 20  ASC-HDR-LBL-INSTR               PIC  X(25).  00825018
008260                 20  ASC-PRESENTATION                PIC  X(20).  00826018
008270                 20  ASC-NEWSTORE                    PIC  X(01).  00827018
008280                 20  ASC-RTV                         PIC  X(01).  00828018
008290                 20  ASC-SET-NAME                    PIC  X(05).  00829018
008300                 20  ASC-PRICE-CHG                   PIC  X(05).  00830018
008310                 20  ASC-TOT-UNITS                   PIC S9(07)   00831018
008320                                                           COMP.  00832018
008330                 20  ASC-TRIP-ID                     PIC S9(09)   00833018
008340                                                           COMP.  00834018
008350                 20  ASC-ALL-PO-IND                  PIC  X(01).  00835018
008360                     88  ASC-ALL-PO-NBRS             VALUE 'Y'.   00836018
008370                     88  ASC-NOT-ALL-PO-NBRS         VALUE 'N'.   00837018
008380                 20  ASC-PBS-SW                      PIC  X(01).  00838018
008390                     88  ASC-PBS-YES                 VALUE 'Y'.   00839018
008400                     88  ASC-PBS-NO                  VALUE 'N'.   00840018
008401                 20  ASC-FA-ACCESS-SW                PIC  X(01).  00840127
008402                     88  ASC-FA-ACCESS-YES           VALUE 'Y'.   00840227
008403                     88  ASC-FA-ACCESS-NO            VALUE 'N'.   00840327
008410                 20  ASC-OPER-MISMATCH-SW            PIC  X(01).  00841027
008420                     88  ASC-OPER-MISMATCH           VALUE 'Y'.   00842027
008430                     88  ASC-OPER-MISMATCH-NO        VALUE 'N'.   00843027
008440             15  ASC-BLK-SUB                         PIC S9(04)   00844018
008450                                                          COMP    00845018
008460                                                          SYNC.   00846018
008470             15  ASC-ITEM-SUB                        PIC S9(04)   00847018
008480                                                          COMP    00848018
008490                                                          SYNC.   00849018
008500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   00850018
008510                                                          COMP-3. 00851018
008520             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   00852018
008530                                                          COMP-3. 00853018
008540             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   00854018
008550                                                          COMP-3. 00855018
008560             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   00856018
008570                                                          COMP-3. 00857018
008580             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   00858018
008590                                                          COMP-3. 00859018
008600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   00860018
008610                                                          COMP    00861018
008620                                                          SYNC.   00862018
008630             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   00863018
008640                                                          COMP-3. 00864018
008650             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   00865018
008660                                                          COMP-3. 00866018
008670             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  00867018
008680                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   00868018
008690                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   00869018
008700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  00870018
008710                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   00871018
008720                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   00872018
008730             15  ASC-LIST-QUEUE-NAME.                             00873018
008740                 20  ASC-LIST-TERM-ID                PIC  X(04).  00874018
008750                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   00875018
008760                                                          COMP-3. 00876018
008770                 20  ASC-LIST-SEQ                    PIC  9(01).  00877018
008780             15  ASC-SEL-QUEUE-NAME.                              00878018
008790                 20  ASC-SEL-TERM-ID          PIC  X(04).         00879018
008800                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  00880018
008810                 20  ASC-SEL-SEQ              PIC  9(01).         00881018
008820             15  ASC-SEL-QUEUE-NAME-IN.                           00882018
008830                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         00883018
008840                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  00884018
008850                 20  ASC-SEL-SEQ-IN           PIC  9(01).         00885018
008860             15  ASC-PKGNG-CD                 PIC  X(01).         00886018
008870                 88  ASC-PRE-PACK-ORDER            VALUE 'I', 'M'.00887018
008880                 88  ASC-INNER-PREPK                    VALUE 'I'.00888018
008890                 88  ASC-MULTI-SKU-PREPK                VALUE 'M'.00889018
008900                 88  ASC-SINGLE-SKU-PREPK               VALUE 'S'.00890018
008910                 88  ASC-CASEPACK                       VALUE 'C'.00891018
008920                 88  ASC-BULK-PACK                      VALUE 'B'.00892018
008930                 88  ASC-PBS                            VALUE ' '.00893018
008940             15  ASC-TOT-EXP-CRTNS            PIC S9(05) COMP.    00894018
008950             15  ASC-TOT-ACTL-CRTNS           PIC S9(05) COMP.    00895018
008960             15  ASC-TOT-EXP-SCAN             PIC S9(05) COMP.    00896018
008970             15  ASC-TOT-ACTL-SCN             PIC S9(05) COMP.    00897018
008990             15  ASC-IN-TROUB-DATE            PIC X(05).          00899018
009000             15  ASC-IN-TROUB-TIME            PIC X(05).          00900018
009010             15  ASC-OUT-TROUB-DATE           PIC X(05).          00901018
009020             15  ASC-OUT-TROUB-TIME           PIC X(05).          00902018
009030             15  ASC-TRAILER-STATUS           PIC X(01).          00903018
009040                 88  ASC-TRLR-UNLOADED          VALUE ' '         00904018
009050                                                      'U'.        00905018
009060                 88  ASC-TRLR-NOT-UNLOADED      VALUE 'L'.        00906018
009070                                                                  00907018
009080                                                                  00908018
009090             15  ASC-START-ITEM-REQUEST.                          00909018
009100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  00910018
009110                                                                  00911019
009120             15  ASC-SEL-SUB                  PIC S9(4) COMP.     00912018
009130             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     00913018
009140             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          00914018
009150                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 00915018
009160             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  00916018
009170                                                                  00917018
009180             15  ASC-FUNC-RETURN-FLAG         PIC  X(1).          00918018
009190                 88  ASC-FUNC01-RETURN-YES  VALUE '1'.            00919018
009200                 88  ASC-FUNC01-RETURN-NO   VALUE ' '.            00920018
009210                 88  ASC-FUNC03-RETURN-YES  VALUE '3'.            00921018
009220                 88  ASC-FUNC03-RETURN-NO   VALUE ' '.            00922018
009230                 88  ASC-FUNC04-RETURN-YES  VALUE '4'.            00923018
009240                 88  ASC-FUNC04-RETURN-NO   VALUE ' '.            00924018
009250                 88  ASC-FUNC05-RETURN-YES  VALUE '5'.            00925018
009260                 88  ASC-FUNC05-RETURN-NO   VALUE ' '.            00926018
009270                 88  ASC-FUNC07-RETURN-YES  VALUE '7'.            00927018
009280                 88  ASC-FUNC07-RETURN-NO   VALUE ' '.            00928018
009290                 88  ASC-FUNC08-RETURN-YES  VALUE '8'.            00929018
009300                 88  ASC-FUNC08-RETURN-NO   VALUE ' '.            00930018
009310                 88  ASC-FUNC09-RETURN-YES  VALUE '9'.            00931018
009320                 88  ASC-FUNC09-RETURN-NO   VALUE ' '.            00932018
009330                 88  ASC-FUNC11-RETURN-YES  VALUE 'A'.            00933018
009340                 88  ASC-FUNC11-RETURN-NO   VALUE ' '.            00934018
009350                 88  ASC-FUNC10-RETURN-YES  VALUE 'B'.            00935018
009360                 88  ASC-FUNC10-RETURN-NO   VALUE ' '.            00936018
009370                                                                  00937018
009380             15  ASC-FUNC02-RETURN-FLAG       PIC  X(1).          00938018
009390                 88  ASC-FUNC02-RETURN-NO   VALUE 'N'.            00939018
009400                 88  ASC-FUNC02-RETURN-YES  VALUE 'Y'.            00940018
009410                                                                  00941018
009420             15  ASC-FUNC06-RETURN-FLAG       PIC  X(1).          00942018
009430                 88  ASC-FUNC06-RETURN-NO   VALUE 'N'.            00943018
009440                 88  ASC-FUNC06-RETURN-YES  VALUE 'Y'.            00944018
009450                                                                  00945018
009500             15  ASC-SELECT-ALL-FLAG           PIC X(01).         00950018
009510                 88  ASC-SELECT-ALL-YES        VALUE 'Y'.         00951018
009520                 88  ASC-SELECT-ALL-NO         VALUE 'N'.         00952018
009530                                                                  00953018
009540             15  ASC-UNLOAD-FLAG               PIC X(01).         00954018
009550                 88  ASC-UNLOAD-YES            VALUE 'Y'.         00955018
009560                 88  ASC-UNLOAD-NO             VALUE 'N'.         00956018
009570                                                                  00957018
009580             15  ASC-ACTL-COUNT-ZERO-SW        PIC X(01).         00958018
009590                 88  ASC-ACTL-COUNT-ZERO       VALUE 'Y'.         00959018
009600                 88  ASC-ACTL-COUNT-ZERO-NO    VALUE 'N'.         00960018
009610                                                                  00961018
009620             15  ASC-FREE-ASTRAY-SW            PIC X(01).         00962018
009630                 88  ASC-FREE-ASTRAY           VALUE 'Y'.         00963018
009640                 88  ASC-FREE-ASTRAY-NO        VALUE 'N'.         00964018
009650                                                                  00965018
009660             15  ASC-PHYSICAL-LABEL-SW         PIC X(01).         00966018
009670                 88  ASC-PHYSICAL-LABEL        VALUE 'Y'.         00967018
009680                 88  ASC-PHYSICAL-LABEL-NO     VALUE 'N'.         00968018
009690                                                                  00969018
009700             15  ASC-FACILITY-AUTOVE-SW        PIC X(01).         00970018
009710                 88  ASC-FACILITY-AUTOVE-YES   VALUE 'Y'.         00971018
009720                 88  ASC-FACILITY-AUTOVE-NO    VALUE 'N'.         00972018
009730                                                                  00973018
009731             15  ASC-VALIDATE-CURR-OPER-SW     PIC X(01).         00973118
009732                 88  ASC-VALIDATE-CURR-OPER-YES    VALUE 'Y'.     00973218
009733                 88  ASC-VALIDATE-CURR-OPER-NO     VALUE 'N'.     00973318
009734                                                                  00973443
009735             15  ASC-HAS-BULK-MULTI-SKU-SW           PIC X(01).   00973543
009736                 88  ASC-HAS-BULK-MULTI-SKU-YES    VALUE 'Y'.     00973643
009737                 88  ASC-HAS-BULK-MULTI-SKU-NO     VALUE 'N'.     00973743
009738                                                                  00973818
009740             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                00974018
009750                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  00975018
009760                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   00976018
009770                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   00977018
009780                                                                  00978018
009790                 20  ASC-ITEM-ARRAY.                              00979018
009800                     25  ASC-ITEM-ENTRIES OCCURS 9  TIMES.        00980018
009810                         30  ASC-LIST-ITEM-NUMBER                 00981018
009820                                                     PIC S9(09)   00982018
009830                                                     COMP-3.      00983018
009840                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  00984018
009850                             88  ASC-VALID-SELECT    VALUE ' '    00985018
009860                                                           'S'    00986018
009870                                                           'B'    00987018
009880                                                           'E'.   00988018
009890                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   00989018
009900                             88  ASC-TEMP-SELECT     VALUE 'S'.   00990018
009910                             88  ASC-TEMP-BEGIN      VALUE 'B'.   00991018
009920                             88  ASC-TEMP-END        VALUE 'E'.   00992018
009930                         30  ASC-SELECTED-SW         PIC  X(01).  00993018
009940                             88  ASC-NO-SELECT       VALUE ' '.   00994018
009950                             88  ASC-SELECT          VALUE 'S'.   00995018
009960                             88  ASC-BEGIN           VALUE 'B'.   00996018
009970                             88  ASC-END             VALUE 'E'.   00997018
009980                         30  ASC-ACTION             PIC  X(03).   00998018
009990                         30  ASC-PO-IND             PIC  X(01).   00999018
010000                         30  ASC-PO-RECEIVER.                     01000018
010010                             35 ASC-PO-NBR          PIC  9(08).   01001018
010020                             35 FILLER              PIC  X(01).   01002018
010030                             35 ASC-RECEIVER        PIC  9(04).   01003018
010040                         30  ASC-PO-STATUS          PIC  X(02).   01004018
010050                         30  ASC-VND-NME.                         01005018
010060                             35 ASC-VND-NME-18.                   01006018
010070                                 40  ASC-VND-NME-8  PIC  X(08).   01007018
010080                                 40  ASC-VND-NME-10 PIC  X(10).   01008018
010090                             35 ASC-VND-NME-30      PIC  X(12).   01009018
010100                         30  ASC-PACK-TYPE          PIC  X(01).   01010018
010101***                                                               01010118
010102***CHANGED FIELDS FROM PIC 9(##) TO PIC 9(##) COMP RECLAIM SPACE  01010218
010103***                                                               01010318
010110***                      30  ASC-EXP-CART-COUNT     PIC  9(05).   01011018
010120***                      30  ASC-ACTL-CART-COUNT    PIC  9(05).   01012018
010130***                      30  ASC-EXP-SCN-COUNT      PIC  9(05).   01013018
010140***                      30  ASC-ACTL-SCN-COUNT     PIC  9(05).   01014018
010150***                      30  ASC-PERCENT-SCND       PIC  X(06).   01015018
010160***                      30  ASC-TOTAL-UNITS        PIC  9(06).   01016018
010161***                                                               01016118
010162                         30  ASC-EXP-CART-COUNT   PIC 9(05) COMP. 01016218
010163                         30  ASC-ACTL-CART-COUNT  PIC 9(05) COMP. 01016318
010164                         30  ASC-EXP-SCN-COUNT    PIC 9(05) COMP. 01016418
010165                         30  ASC-ACTL-SCN-COUNT   PIC 9(05) COMP. 01016518
010166                         30  ASC-PERCENT-SCND     PIC X(06).      01016618
010167                         30  ASC-TOTAL-UNITS      PIC 9(06) COMP. 01016718
010168***                                                               01016818
010170                         30  ASC-CSR-IND            PIC  X(01).   01017018
010180                         30  ASC-AD-INFO             PIC  X(04).  01018018
010190                         30  ASC-PRE-TKT-IND         PIC  X(01).  01019018
010200                         30  ASC-PACK-BY-ST-IND      PIC  X(01).  01020018
010210                         30  ASC-AD-DATE             PIC  X(06).  01021018
010230                         30  ASC-DETAIL-CHECK        PIC  X(01).  01023018
010240                         30  ASC-COLOR-SW            PIC X(01).   01024018
010250                             88 ASC-COLOR-RED        VALUE 'Y'.   01025018
010260                             88 ASC-COLOR-RED-NO     VALUE 'N'.   01026018
010270                         30  ASC-COLOR-YELLOW-SW     PIC X(01).   01027018
010280                             88 ASC-COLOR-YELLOW     VALUE 'Y'.   01028018
010290                             88 ASC-COLOR-YELLOW-NO  VALUE 'N'.   01029018
010300                         30  ASC-AUTO-VE-SW          PIC X(01).   01030018
010310                             88 ASC-AUTO-VE          VALUE 'Y'.   01031018
010320                             88 ASC-AUTO-VE-NO       VALUE 'N'.   01032018
010330                         30  ASC-CHCKIN-SW           PIC X(01).   01033018
010340                             88 ASC-CHCKIN-YES       VALUE 'Y'.   01034018
010350                             88 ASC-CHCKIN-NO        VALUE 'N'.   01035018
010370                         30  ASC-DEPT-CLASS.                      01037018
010380                             35  ASC-DEPT            PIC  X(03).  01038018
010390                             35  ASC-CLASS.                       01039018
010400                                 40  ASC-MAJOR-CLASS PIC  X(01).  01040018
010410                                 40  ASC-CLASS-ZERO  PIC  X(01).  01041018
010420                         30  ASC-MULT-IND            PIC  X(01).  01042018
010430                         30  ASC-GOH-IND             PIC  X(01).  01043018
010440                         30  ASC-STOR-TRBL-SW        PIC  X(01).  01044018
010450                             88  ASC-NO-STOR-TRBL    VALUE 'N'.   01045018
010460                             88  ASC-CURR-STOR-TRBL  VALUE 'Y'.   01046018
010470                             88  ASC-PREV-STOR-TRBL  VALUE 'P'.   01047018
010480                         30  ASC-OTHER-TRBL-SW       PIC  X(01).  01048018
010490                             88  ASC-NO-OTHER-TRBL   VALUE 'N'.   01049018
010500                             88  ASC-OTHER-TRBL      VALUE 'Y'.   01050018
010510                         30  ASC-OPER-SET-DESC       PIC  X(15).  01051018
010520                         30  ASC-STOR-IND            PIC  X(01).  01052018
010530                         30  ASC-REC-CLK             PIC  X(03).  01053018
010540                         30  ASC-PBS-ERRORS-SW      PIC  X(01).   01054018
010550                             88  ASC-PBS-ERRORS-FOUND VALUE 'Y'.  01055018
010560                         30  ASC-TROUBLE-SW          PIC  X(01).  01056018
010570                             88  ASC-TROUBLE         VALUE 'Y'.   01057018
010580                             88  ASC-TROUBLE-NO      VALUE 'N'.   01058018
010590                         30  ASC-REC-ATCHD-TRLR-SW   PIC  X(01).  01059018
010600                             88  ASC-REC-ATCHD-TRLR     VALUE 'Y'.01060018
010610                             88  ASC-REC-ATCHD-TRLR-NO  VALUE 'N'.01061018
010620                         30  ASC-REC-TRNSCRBD-SW     PIC  X(01).  01062018
010630                             88  ASC-REC-TRNSCRBD       VALUE 'Y'.01063018
010640                             88  ASC-REC-TRNSCRBD-NO    VALUE 'N'.01064018
010650                         30  ASC-MISDIRECT-SW        PIC  X(01).  01065018
010660                             88  ASC-MISDIRECT-YES      VALUE 'Y'.01066018
010670                             88  ASC-MISDIRECT-NO       VALUE 'N'.01067018
010671                         30  ASC-CURR-OPER-UNT-ID PIC S9(04) COMP.01067118
010672                         30  ASC-BULK-MULT-SKU-SW    PIC  X(01).  01067244
010673                             88  ASC-BULK-MULT-SKU-YES            01067344
010674                                                     VALUE 'Y'.   01067444
010675                             88  ASC-BULK-MULT-SKU-NO             01067544
010676                                                     VALUE 'N'.   01067644
010677             15  FILLER                              PIC  X(61).  01067749
010680                                                                  01068018
010690*---------------------------------------------------------------* 01069018
010700*    ABEND PROCESSING COPYBOOK.                                 * 01070018
010710*---------------------------------------------------------------* 01071018
010720     COPY DPWS013.                                                01072018
010730                                                                  01073018
010740*---------------------------------------------------------------* 01074018
010750*    DB2 AREA FOR SYSDUMMY TABLE                                  01075018
010760*---------------------------------------------------------------* 01076018
010770     EXEC SQL                                                     01077018
010780          INCLUDE SYSDUMMY                                        01078018
010790     END-EXEC.                                                    01079018
010800                                                                  01080018
010810*----------------------------------------------------------------*01081018
010820*    DB2 DCLGEN FOR THE PURCHASE ORDER  TABLE                     01082018
010830*----------------------------------------------------------------*01083018
010840     EXEC SQL                                                     01084018
010850          INCLUDE TPURCHS                                         01085018
010860     END-EXEC.                                                    01086018
010870                                                                  01087018
010880*----------------------------------------------------------------*01088018
010890*    DB2 DCLGEN FOR THE EXTERNAL ENTITY NAME TABLE                01089018
010900*----------------------------------------------------------------*01090018
010910     EXEC SQL                                                     01091018
010920          INCLUDE TENTNME                                         01092018
010930     END-EXEC.                                                    01093018
010940                                                                  01094018
010950*---------------------------------------------------------------* 01095018
010960*    DB2 AREA FOR SHIPMENT TABLE                                * 01096018
010970*---------------------------------------------------------------* 01097018
010980     EXEC SQL                                                     01098018
010990          INCLUDE TSHIPMT                                         01099018
011000     END-EXEC.                                                    01100018
011010*---------------------------------------------------------------* 01101018
011020*    DB2 AREA FOR SHIPMENT PO TABLE                             * 01102018
011030*---------------------------------------------------------------* 01103018
011040     EXEC SQL                                                     01104018
011050          INCLUDE TSHPTPO                                         01105018
011060     END-EXEC.                                                    01106018
011070*---------------------------------------------------------------* 01107018
011080*    DB2 AREA FOR TRIP STATUS TABLE                             * 01108018
011090*---------------------------------------------------------------* 01109018
011100     EXEC SQL                                                     01110018
011110          INCLUDE TTRSTYP                                         01111018
011120     END-EXEC.                                                    01112018
011130*---------------------------------------------------------------* 01113018
011140*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 01114018
011150*---------------------------------------------------------------* 01115018
011160     EXEC SQL                                                     01116018
011170          INCLUDE TVHTRIP                                         01117018
011180     END-EXEC.                                                    01118018
011190*---------------------------------------------------------------* 01119018
011200*    DB2 AREA FOR RECEIVER TABLE                                * 01120018
011210*---------------------------------------------------------------* 01121018
011220     EXEC SQL                                                     01122018
011230          INCLUDE TRECEIV                                         01123018
011240     END-EXEC.                                                    01124018
011250*----------------------------------------------------------------*01125018
011260*    DB2 AREA FOR OPERATION SET TABLE                            *01126018
011270*----------------------------------------------------------------*01127018
011280     EXEC SQL                                                     01128018
011290          INCLUDE TOPRSET                                         01129018
011300     END-EXEC.                                                    01130018
011310*----------------------------------------------------------------*01131018
011320*    DB2 AREA FOR WORK ORDER TABLE                               *01132018
011330*----------------------------------------------------------------*01133018
011340     EXEC SQL                                                     01134018
011350          INCLUDE TWRKORD                                         01135018
011360     END-EXEC.                                                    01136018
011370*---------------------------------------------------------------* 01137018
011380*    DB2 AREA FOR TRIP STATUS TABLE                             * 01138018
011390*---------------------------------------------------------------* 01139018
011400     EXEC SQL                                                     01140018
011410          INCLUDE TTRIPST                                         01141018
011420     END-EXEC.                                                    01142018
011430*---------------------------------------------------------------* 01143018
011440*    DB2 AREA                                                     01144018
011450*---------------------------------------------------------------* 01145018
011460     EXEC SQL                                                     01146018
011470          INCLUDE TINPKSU                                         01147018
011480     END-EXEC.                                                    01148018
011490*---------------------------------------------------------------* 01149018
011500*    DB2 AREA                                                     01150018
011510*---------------------------------------------------------------* 01151018
011520     EXEC SQL                                                     01152018
011530          INCLUDE TSHPUNT                                         01153018
011540     END-EXEC.                                                    01154018
011550*---------------------------------------------------------------* 01155018
011560*    DB2 AREA FOR THE PACKSLIP TABLE                            * 01156018
011570*---------------------------------------------------------------* 01157018
011580     EXEC SQL                                                     01158018
011590          INCLUDE TPKSLIP                                         01159018
011600     END-EXEC.                                                    01160018
011610*---------------------------------------------------------------* 01161018
011620*    DB2 AREA FOR THE SHIP UNIT TABLE                           * 01162018
011630*---------------------------------------------------------------* 01163018
011640     EXEC SQL                                                     01164018
011650          INCLUDE TSHUNLO                                         01165018
011660     END-EXEC.                                                    01166018
011670*---------------------------------------------------------------* 01167018
011680*    DB2 AREA                                                     01168018
011690*---------------------------------------------------------------* 01169018
011700     EXEC SQL                                                     01170018
011710          INCLUDE TRECITM                                         01171018
011720     END-EXEC.                                                    01172018
011730*---------------------------------------------------------------* 01173018
011740*    DB2 AREA                                                     01174018
011750*---------------------------------------------------------------* 01175018
011760     EXEC SQL                                                     01176018
011770          INCLUDE TRECDIS                                         01177018
011780     END-EXEC.                                                    01178018
011790*---------------------------------------------------------------* 01179018
011800*    DB2 AREA                                                     01180018
011810*---------------------------------------------------------------* 01181018
011820     EXEC SQL                                                     01182018
011830          INCLUDE TSHUUPC                                         01183018
011840     END-EXEC.                                                    01184018
011850*---------------------------------------------------------------* 01185018
011860*    DB2 AREA                                                     01186018
011870*---------------------------------------------------------------* 01187018
011880     EXEC SQL                                                     01188018
011890          INCLUDE TPOINST                                         01189018
011900     END-EXEC.                                                    01190018
011910*---------------------------------------------------------------* 01191018
011920*    DB2 AREA                                                     01192018
011930*---------------------------------------------------------------* 01193018
011940     EXEC SQL                                                     01194018
011950          INCLUDE TINSTCD                                         01195018
011960     END-EXEC.                                                    01196018
011970*---------------------------------------------------------------* 01197018
011980*    DB2 AREA                                                     01198018
011990*---------------------------------------------------------------* 01199018
012000*    EXEC SQL                                                     01200018
012010*         INCLUDE TINRCCD                                         01201018
012020*    END-EXEC.                                                    01202018
012030                                                                  01203018
012040*----------------------------------------------------------------*01204018
012050*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                01205018
012060*----------------------------------------------------------------*01206018
012070     EXEC SQL                                                     01207018
012080          INCLUDE TTRBNTF                                         01208018
012090     END-EXEC.                                                    01209018
012100                                                                  01210018
012110*----------------------------------------------------------------*01211018
012120*    DB2 DCLGEN FOR THE TROUBLE REASON TABLE                      01212018
012130*----------------------------------------------------------------*01213018
012140     EXEC SQL                                                     01214018
012150          INCLUDE TTRBRSN                                         01215018
012160     END-EXEC.                                                    01216018
012170*---------------------------------------------------------------* 01217018
012180*---------------------------------------------------------------* 01218018
012190*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 01219018
012200*---------------------------------------------------------------* 01220018
012210     EXEC SQL                                                     01221018
012220          INCLUDE TPURITM                                         01222018
012230     END-EXEC.                                                    01223018
012240                                                                  01224018
012250*---------------------------------------------------------------* 01225018
012260*    DB2 AREA FOR THE PURCHASE ORDER PREPACK TABLE              * 01226018
012270*---------------------------------------------------------------* 01227018
012280     EXEC SQL                                                     01228018
012290          INCLUDE TPOPRPK                                         01229018
012300     END-EXEC.                                                    01230018
012310                                                                  01231018
012320*---------------------------------------------------------------* 01232018
012321*    DB2 AREA FOR TICKET FORMAT ASSIGNMENTS                     * 01232118
012322*---------------------------------------------------------------* 01232218
012323     EXEC SQL                                                     01232318
012324          INCLUDE TDCTFAS                                         01232418
012325     END-EXEC.                                                    01232518
012326                                                                  01232618
012327                                                                  01232718
012328*---------------------------------------------------------------* 01232818
012329*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 01232918
012330*---------------------------------------------------------------* 01233018
012340     EXEC SQL                                                     01234018
012350          INCLUDE TSHIPST                                         01235018
012360     END-EXEC.                                                    01236018
012370                                                                  01237018
012380                                                                  01238018
012390*---------------------------------------------------------------* 01239018
012400*    DB2 AREA FOR SHIPMENT TYPE TABLE                           * 01240018
012410*---------------------------------------------------------------* 01241018
012420     EXEC SQL                                                     01242018
012430          INCLUDE TSHSTYP                                         01243018
012440     END-EXEC.                                                    01244018
012450                                                                  01245018
012460                                                                  01246018
012470*---------------------------------------------------------------* 01247018
012480*    DB2 AREA FOR THE VEHICLE TABLE                             * 01248018
012490*---------------------------------------------------------------* 01249018
012500     EXEC SQL                                                     01250018
012510          INCLUDE TVEHICL                                         01251018
012520     END-EXEC.                                                    01252018
012530                                                                  01253018
012540*---------------------------------------------------------------* 01254018
012550*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 01255018
012560*---------------------------------------------------------------* 01256018
012570     EXEC SQL                                                     01257018
012580          INCLUDE TAUVHCL                                         01258018
012590     END-EXEC.                                                    01259018
012600                                                                  01260018
012610                                                                  01261018
012620*----------------------------------------------------------------*01262018
012630*    DB2 DCLGEN FOR TCPPCDT TABLE                                 01263018
012640*----------------------------------------------------------------*01264018
012650*LMM EXEC SQL                                                     01265018
012660*         INCLUDE TCPPCDT                                         01266018
012670*    END-EXEC.                                                    01267018
012680*                                                                 01268018
012690*----------------------------------------------------------------*01269018
012700*    DB2 DCLGEN FOR TCENPPC TABLE                                 01270018
012710*----------------------------------------------------------------*01271018
012720*LMM EXEC SQL                                                     01272018
012730*         INCLUDE TCENPPC                                         01273018
012740*    END-EXEC.                                                    01274018
012750*                                                                 01275018
012760*----------------------------------------------------------------*01276018
012770*    DB2 DCLGEN FOR TKRPRPM TABLE                                 01277018
012780*----------------------------------------------------------------*01278018
012790     EXEC SQL                                                     01279018
012800          INCLUDE TKRPRPM                                         01280018
012810     END-EXEC.                                                    01281018
012820                                                                  01282018
012830*----------------------------------------------------------------*01283018
012840*    DB2 DCLGEN FOR TDISTHD TABLE                                 01284018
012850*----------------------------------------------------------------*01285018
012860     EXEC SQL                                                     01286018
012870          INCLUDE TDISTHD                                         01287018
012880     END-EXEC.                                                    01288018
012890                                                                  01289018
012900*----------------------------------------------------------------*01290018
012910*    DB2 DCLGEN FOR SUT_OTBND_UPC                                 01291018
012920*----------------------------------------------------------------*01292018
012930     EXEC SQL                                                     01293018
012940          INCLUDE SUT00028                                        01294018
012950     END-EXEC.                                                    01295018
012960                                                                  01296018
012970*----------------------------------------------------------------*01297018
012980*    DB2 DCLGEN FOR SUT_OTBND_CART                                01298018
012990*----------------------------------------------------------------*01299018
013000     EXEC SQL                                                     01300018
013010          INCLUDE SUT00024                                        01301018
013020     END-EXEC.                                                    01302018
013030                                                                  01303018
013040*----------------------------------------------------------------*01304018
013050*    SUTT_PO_RCVR_TRLR                                            01305018
013060*----------------------------------------------------------------*01306018
013070     EXEC SQL                                                     01307018
013080          INCLUDE SUT00042                                        01308018
013090     END-EXEC.                                                    01309018
013100                                                                  01310018
013110* JAK 04/2007 - ADD WST00008/9/10                                 01311018
013120***************************************************************** 01312018
013130*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 01313018
013140***************************************************************** 01314018
013150     EXEC SQL                                                     01315018
013160          INCLUDE WST00008                                        01316018
013170     END-EXEC.                                                    01317018
013180***************************************************************** 01318018
013190*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   01319018
013200***************************************************************** 01320018
013210     EXEC SQL                                                     01321018
013220          INCLUDE WST00009                                        01322018
013230     END-EXEC.                                                    01323018
013240***************************************************************** 01324018
013250*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   01325018
013260***************************************************************** 01326018
013270     EXEC SQL                                                     01327018
013280          INCLUDE WST00010                                        01328018
013290     END-EXEC.                                                    01329018
013300                                                                  01330018
013310*    XLT_SKU                                                      01331018
013320     EXEC SQL                                                     01332018
013330          INCLUDE XLT00003                                        01333018
013340     END-EXEC.                                                    01334018
013350                                                                  01335018
013360*    XLT_VND_STYL                                                 01336018
013370     EXEC SQL                                                     01337018
013380          INCLUDE XLT00004                                        01338018
013390     END-EXEC.                                                    01339018
013400                                                                  01340018
013410     EXEC SQL                                                     01341018
013420          INCLUDE SQLCA                                           01342018
013430     END-EXEC.                                                    01343018
013440                                                                  01344018
013450***************************************************************   01345018
013460*    THIS CURSOR CONTAINS THE BULK OF THE PO/RCVRS EXPECTED       01346018
013470*    TO BE ON THIS TRAILER.  ALL OF THESE WILL BE LOADED          01347018
013480*    DIRECTLY TO THE TEMP WORK TABLE.                             01348018
013490                                                                  01349018
013500     EXEC SQL                                                     01350018
013510         DECLARE TYPE-A-CSR CURSOR FOR                            01351018
013520             SELECT                                               01352018
013530                  'A'                                             01353018
013540                , C.PO_NBR                                        01354018
013550                , C.REC_SEQ_NBR                                   01355018
013560                , D.STATUS_CDE                                    01356018
013570*               , CASE                                            01357018
013580*                     WHEN D.STATUS_CDE = 'IP'                    01358018
013590*                     THEN 1 ELSE 9                               01359018
013600*                 END                                             01360018
013610            FROM  TVHTRIP A                                       01361018
013620                , TSHIPMT B                                       01362018
013630                , TSHPTPO C                                       01363018
013640                , TRECEIV D                                       01364018
013650            WHERE A.TRIP_ID           = :DK-TRIP-ID               01365018
013660              AND A.TRIP_ID           = B.TRIP_ID                 01366018
013670              AND C.SHIPT_ID          = B.SHIPT_ID                01367018
013680              AND C.PO_NBR          = D.ORD_NBR                   01368018
013690              AND C.REC_SEQ_NBR     = D.REC_SEQ_NBR               01369018
013700              AND D.VER_STATUS_CDE  = 'A'                         01370018
013710     END-EXEC.                                                    01371018
013720                                                                  01372018
013730****************************************************************  01373018
013740*    THIS CURSOR IS A LIST OF ALL THE PO/RCVRS FOUND ON THE       01374018
013750*    TRAILER.  THE ONES WITHOUT PACKSLIPS ARE FREE-ASTRAYS.       01375018
013760                                                                  01376018
013770     EXEC SQL                                                     01377018
013780         DECLARE CHECKIN-CSR CURSOR FOR                           01378018
013790           SELECT                                                 01379018
013800                  A.SHIPT_UNT_ID                                  01380018
013810              ,   B.PO_NBR                                        01381018
013820              ,   B.SEQ_NBR                                       01382018
013830*               , 'IP'  AS RCVR_STATUS_CDE                        01383018
013840*               , 'A'   AS SCREEN_SEQUENCE                        01384018
013850             FROM  TSHUNLO A                                      01385018
013860             LEFT OUTER JOIN                                      01386018
013870                  TINPKSU B                                       01387018
013880              ON A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID            01388018
013890             WHERE A.TRIP_ID          = :DK-TRIP-ID               01389018
013900             ORDER BY                                             01390018
013910                 B.PO_NBR                                         01391018
013920              ,  B.SEQ_NBR                                        01392018
013930         WITH UR                                                  01393018
013940     END-EXEC.                                                    01394018
013950                                                                  01395018
013960******************************************************************01396018
013970*  CURSOR FOR THE EXPECTED NUMBER OF CARTONS FOR EACH PO/RECVR  **01397018
013980*  AND PO/RECVR SCANNED BUT NOT EXPECTED                          01398018
013990*  UNION 'B' AND  'C' TYPES = FREE ASTRAYS                        01399018
014000******************************************************************01400018
014010                                                                  01401018
014020     EXEC SQL                                                     01402018
014030         DECLARE SHIPMT-EXP-CSR CURSOR FOR                        01403018
014040           SELECT DISTINCT                                        01404018
014050                  RCVR_PRCG_CDE                                   01405018
014060                , PO_NBR                                          01406018
014070                , RCVR_SEQ_NBR                                    01407018
014080                , RCVR_STAT_CDE                                   01408018
014090                , DISP_SEQ_NBR                                    01409018
014100                                                                  01410018
014110            FROM  SUTT_PO_RCVR_TRLR                               01411018
014120            ORDER BY                                              01412018
014130                 DISP_SEQ_NBR                                     01413018
014140             ,   PO_NBR                                           01414018
014150             ,   RCVR_SEQ_NBR                                     01415018
014160     END-EXEC.                                                    01416018
014170                                                                  01417018
014180                                                                  01418018
014190     EXEC SQL                                                     01419018
014200          DECLARE RECV-ITM-CSR CURSOR FOR                         01420018
014210          SELECT     ORD_LNE_NBR                                  01421018
014220                 ,   STATUS_CDE                                   01422018
014230                 ,   PKSL_ITM_QTY                                 01423018
014240                 ,   DTL_CK_ITM_QTY                               01424018
014250           FROM    TRECITM                                        01425018
014260           WHERE     ORD_NBR        = :DK-PO-NBR                  01426018
014270              AND    REC_SEQ_NBR    = :DK-REC-SEQ-NBR             01427018
014280              AND    VER_STATUS_CDE = 'A'                         01428018
014290           WITH UR                                                01429018
014300     END-EXEC.                                                    01430018
014310                                                                  01431018
014320                                                                  01432018
014330*---------------------------------------------------------------* 01433018
014340*  CURSOR TO LIST SHIPMENTS FOR A TRIP                          * 01434018
014350*---------------------------------------------------------------* 01435018
014360                                                                  01436018
014370     EXEC SQL                                                     01437018
014380          DECLARE SHIPMENT-CSR CURSOR FOR                         01438018
014390           SELECT SHIPT_ID                                        01439018
014400            FROM  TSHIPMT                                         01440018
014410           WHERE  TRIP_ID = :DK-TRIP-ID                           01441018
014420             AND  TRIP_ID IS NOT NULL                             01442018
014430         ORDER BY SHIPT_ID                                        01443018
014440     END-EXEC.                                                    01444018
014450                                                                  01445018
014460*---------------------------------------------------------------* 01446018
014470*  CURSOR TO RETRIEVE ITEM NUMBER FROM TRECITM                 *  01447018
014480*---------------------------------------------------------------* 01448018
014490     EXEC SQL                                                     01449018
014500          DECLARE TRECITM-CSR CURSOR FOR                          01450018
014510           SELECT ITM_NBR                                         01451018
014520           FROM   TRECITM                                         01452018
014530           WHERE  ORD_NBR        = :DK-PO-NBR                     01453018
014540             AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                01454018
014550             AND  VER_STATUS_CDE = 'A'                            01455018
014560           ORDER BY ORD_LNE_NBR                                   01456018
014570           WITH UR                                                01457018
014580     END-EXEC.                                                    01458018
014590                                                                  01459018
014600*---------------------------------------------------------------* 01460018
014610*  CURSOR TO RETRIEVE PRICE CHANGE INFORMATION                 *  01461018
014620*---------------------------------------------------------------* 01462018
014630*LMM EXEC SQL                                                     01463018
014640*         DECLARE PPC-CSR CURSOR FOR                              01464018
014650*          SELECT B.EFF_DTE                                       01465018
014660*            FROM TCPPCDT A,                                      01466018
014670*                 TCENPPC B                                       01467018
014680*           WHERE (A.OPERCO_NBR    = B.OPERCO_NBR                 01468018
014690*             AND  A.CENPPC_NBR    = B.CENPPC_NBR                 01469018
014700*             AND A.TSK_ITEM_NMBR = :RECITM-ITM-NBR               01470018
014710*             AND B.DOC_TYP_CDE = :PE049-CORPORATE-DOC-TYPE-CDE   01471018
014720*             AND (B.STATUS_CDE = :PE049-APPROVED-STATUS-CDE      01472018
014730*                  OR                                             01473018
014740*                  B.STATUS_CDE = :PE049-IN-PROCESS-STATUS-CDE)   01474018
014750*             AND  CHAR(DATE(B.EFF_DTE),ISO)                      01475018
014760*                  BETWEEN CHAR(CURRENT DATE - 2 DAYS, ISO)       01476018
014770*                      AND CHAR(CURRENT DATE + 5 DAYS, ISO))      01477018
014780*        ORDER BY  B.EFF_DTE DESC                                 01478018
014790*    END-EXEC.                                                    01479018
014800*                                                                 01480018
014810*---------------------------------------------------------------* 01481018
014820                                                                  01482018
014830 LINKAGE SECTION.                                                 01483018
014840                                                                  01484018
014850 01  DFHCOMMAREA.                                                 01485018
014860     05  FILLER                         OCCURS  1 TO 4072 TIMES   01486018
014870                                        DEPENDING ON EIBCALEN.    01487018
014880         10  FILLER                     PIC X.                    01488018
014890                                                                  01489018
014900 PROCEDURE DIVISION.                                              01490018
014910******************************************************************01491018
014920**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **01492018
014930**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **01493018
014940**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **01494018
014950******************************************************************01495018
014960 0000-MAIN-MODULE.                                                01496018
014970     INITIALIZE DP030-CICS-API-FIELDS.                            01497018
014980     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01498018
014990     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01499018
015000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01500018
015010     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01501018
015020     MOVE LENGTH OF RC815AI        TO DP030-MAP-LENGTH (1).       01502018
015030     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01503018
015040     PERFORM 0001-CALL-CICS-ARCH-API.                             01504018
015050                                                                  01505018
015060     PERFORM 1000-CONTROL-PROCESSING                              01506018
015070                                                                  01507018
015080     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01508018
015090     PERFORM 0001-CALL-CICS-ARCH-API.                             01509018
015100                                                                  01510018
015110******************************************************************01511018
015120**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **01512018
015130**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **01513018
015140******************************************************************01514018
015150 0001-CALL-CICS-ARCH-API.                                         01515018
015161     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01516157
015170                                    DFHCOMMAREA                   01517057
015180                                    DP030-CICS-API-FIELDS         01518057
015190                                    DP020-STANDARD-COMMAREA       01519057
015200                                    RC815AI.                      01520057
015210                                                                  01521018
015220     IF  DP030-RC-CALL-SUCCESSFUL                                 01522018
015230         CONTINUE                                                 01523018
015240     ELSE                                                         01524018
015250         SET DP013-NO-ROLLBACK                                    01525018
015260             DP013-XCTL-DISPLAY-RESTART                           01526018
015270             DP013-CICS-ABEND      TO TRUE                        01527018
015280         MOVE '0001-CALL-CICS-ARCH-API'                           01528018
015290                                   TO DP013-PARAGRAPH             01529018
015292         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O01529257
015293-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01529357
015320         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      01532018
015330         PERFORM DP013-0000-PROCESS-ABEND                         01533018
015340     END-IF.                                                      01534018
015350*----------------------------------------------------------------*01535018
015360* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *01536018
015370* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *01537018
015380*                                                                *01538018
015390* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *01539018
015400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *01540018
015410*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *01541018
015420*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *01542018
015430*----------------------------------------------------------------*01543018
015440                                                                  01544018
015450 1000-CONTROL-PROCESSING.                                         01545018
015460                                                                  01546018
015470     EVALUATE TRUE                                                01547018
015480         WHEN DP020-NEXT-ACT-INITIAL                              01548018
015490             INITIALIZE ASC-SPECIFIC-COMMAREA                     01549018
015500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            01550018
015510                                      ASC-SEL-TERM-ID             01551018
015520                                      ASC-SEL-TERM-ID-IN          01552018
015530             MOVE DP020-SRC-TASK-NUMBER                           01553018
015540                                   TO ASC-LIST-TASK-NUMBER        01554018
015550                                      ASC-SEL-TASK-NUMBER         01555018
015560                                      ASC-SEL-TASK-NUMBER-IN      01556018
015570             MOVE PC-LIST-QUEUE-SEQ                               01557018
015580                                   TO ASC-LIST-SEQ                01558018
015590             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 01559018
015600                                      ASC-SEL-SEQ-IN              01560018
015610             SET ASC-SELECT-ALL-NO TO TRUE                        01561018
015620             PERFORM 1100-PROCESS-INTER-APPL-COMM                 01562018
015630***-----$TEMPLATE NOTE$-------------------------------------------01563018
015640*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,01564018
015650*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  01565018
015660*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.01566018
015670***---------------------------------------------------------------01567018
015680             IF  PS-COMMAREA-NOT-VALID                            01568018
015690                 SET DP020-NEXT-ACT-APPL-ERROR                    01569018
015700                                   TO TRUE                        01570018
015710             ELSE                                                 01571018
015720                 PERFORM 4000-BUILD-INITIAL-PANEL                 01572018
015730             END-IF                                               01573018
015740                                                                  01574018
015750         WHEN DP020-NEXT-ACT-READ-MAP                             01575018
015760             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        01576018
015770                                   TO PV-TOP-ITEM                 01577018
015780             PERFORM 2000-PROCESS-PANEL                           01578018
015790                                                                  01579018
015800         WHEN DP020-NEXT-ACT-RETURN                               01580018
015810             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        01581018
015820                                   TO PV-TOP-ITEM                 01582018
015830             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    01583018
015840                                      ASC-TOT-UNITS               01584018
015850             IF ASC-FUNC03-RETURN-YES                             01585018
015860                 MOVE ZERO         TO ASC-TOT-UNITS               01586018
015870                 PERFORM 2050-DELETE-LIST-QUEUE                   01587018
015880                 PERFORM 4000-BUILD-INITIAL-PANEL                 01588018
015890                 SET ASC-FUNC03-RETURN-NO TO TRUE                 01589018
015900             ELSE                                                 01590018
015910                 IF ASC-FUNC06-RETURN-YES                         01591018
015920                    MOVE ZERO         TO ASC-TOT-UNITS            01592018
015930                    PERFORM 2050-DELETE-LIST-QUEUE                01593018
015940                    PERFORM 4000-BUILD-INITIAL-PANEL              01594018
015950                    SET ASC-FUNC06-RETURN-NO TO TRUE              01595018
015960                 ELSE                                             01596018
015970                    PERFORM 6000-REFRESH-PANEL-FROM-TEMP          01597018
015980                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN          01598018
015990                 END-IF                                           01599018
016000             END-IF                                               01600018
016010                                                                  01601018
016020         WHEN OTHER                                               01602018
016030             SET DP013-LOGIC-ABEND TO TRUE                        01603018
016040             SET DP013-NO-ROLLBACK TO TRUE                        01604018
016050             MOVE '1000-CONTROL-PROCESSING'                       01605018
016060                                   TO DP013-PARAGRAPH             01606018
016070             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    01607018
016080                                   TO DP013-MESSAGE-TEXT(1)       01608018
016090             PERFORM DP013-0000-PROCESS-ABEND                     01609018
016100     END-EVALUATE.                                                01610018
016110                                                                  01611018
016120*----------------------------------------------------------------*01612018
016130* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *01613018
016140* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *01614018
016150*----------------------------------------------------------------*01615018
016160                                                                  01616018
016170 1100-PROCESS-INTER-APPL-COMM.                                    01617018
016180                                                                  01618018
016190******COMING FROM RCWS814 CRIT SPEC                               01619018
016200                                                                  01620018
016210     SET PS-COMMAREA-VALID          TO TRUE.                      01621018
016220     MOVE SPACE                     TO ASC-START-ITEM-REQUEST     01622018
016230                                       ASC-HDR-LBL-PRTID.         01623018
016240     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          01624018
016250                                                                  01625018
016260         MOVE RC814-OPER-UNT-ID     TO ASC-KEY-OPER-UNT-ID        01626018
016270         MOVE RC814-FCLTY-ID        TO ASC-KEY-FCLTY-ID           01627018
016280         MOVE RC814-FCLTY-NME       TO ASC-FCLTY-NME              01628018
016290         MOVE RC814-SCAC            TO ASC-SCAC-ID                01629018
016300         MOVE RC814-TRLR-NBR        TO ASC-VEH-NBR                01630018
016310         MOVE RC814-TRIP-ID         TO ASC-TRIP-ID                01631018
016320         MOVE RC814-PO-NBR          TO PV-PO-NBR                  01632018
016330                                       DK-PO-NBR                  01633018
016340*LMM                                                              01634018
016350                                       ASC-KEY-PO-NBR             01635018
016360         MOVE RC814-REC-SEQ-NBR     TO PV-RECEIVER                01636018
016370                                       DK-REC-SEQ-NBR             01637018
016380*LMM                                                              01638018
016390                                       ASC-KEY-REC-SEQ-NBR        01639018
016400         MOVE RC814-TRLR-STATUS     TO DK-TRLR-STATUS             01640018
016410          IF ASC-TRIP-ID GREATER THAN ZEROS                       01641018
016420              CONTINUE                                            01642018
016430          ELSE                                                    01643018
016440             IF  PV-PO-NBR GREATER THAN ZEROS                     01644018
016450                 AND PV-RECEIVER GREATER THAN ZEROS               01645018
016460                    PERFORM 7200-GET-TRIP-ID                      01646018
016470             ELSE                                                 01647018
016480             SET PS-ERROR          TO TRUE                        01648018
016490                    MOVE PC-TSYMSG-00050       TO DP020-MSG-NUMBER01649018
016500                    SET  PS-COMMAREA-NOT-VALID TO TRUE            01650018
016510             END-IF                                               01651018
016520          END-IF                                                  01652018
016530     END-IF.                                                      01653018
016540     IF  DP020-INT-APPL-FORMAT-IND =  PC-LIST-FORMAT              01654018
016550       IF SU003-NUMBER-OF-SELECTED-ITEMS > 0                      01655018
016560         MOVE SU003-OPER-UNT-ID        TO ASC-KEY-OPER-UNT-ID     01656018
016570         MOVE SU003-SCAC-CDE           TO ASC-SCAC-ID             01657018
016580         MOVE SU003-TRLR-NBR           TO ASC-VEH-NBR             01658018
016590         MOVE SU003-TRIP-ID            TO ASC-TRIP-ID             01659018
016600         MOVE SU003-FCLTY-ID           TO ASC-KEY-FCLTY-ID        01660018
016610         MOVE SU003-FCLTY-NME          TO ASC-FCLTY-NME           01661018
016620                                                                  01662018
016630         SET ASC-USE-SELECTION-QUEUE   TO TRUE                    01663018
016640         MOVE SU003-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  01664018
016650         MOVE SU003-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   01665018
016660                                                                  01666018
016670         PERFORM 1120-PREPARE-LIST-ENTRY                          01667018
016680       ELSE                                                       01668018
016690         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           01669018
016700         SET  PS-COMMAREA-NOT-VALID TO TRUE                       01670018
016710       END-IF                                                     01671018
016720     END-IF.                                                      01672018
016730                                                                  01673018
016740*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*01674018
016750 1120-PREPARE-LIST-ENTRY.                                         01675018
016760                                                                  01676018
016770     MOVE SU004-MAX-ITEMS          TO ASC-SEL-SUB.                01677018
016780     MOVE ZERO                     TO ASC-SEL-ITEM.               01678018
016790     PERFORM 1130-GET-NEXT-RECORD.                                01679018
016800                                                                  01680018
016810*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*01681018
016820*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*01682018
016830*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*01683018
016840 1130-GET-NEXT-RECORD.                                            01684018
016850                                                                  01685018
016860     ADD +1                       TO ASC-SEL-SUB.                 01686018
016870                                                                  01687018
016880     IF  ASC-SEL-SUB > SU004-MAX-ITEMS                            01688018
016890         ADD +1                   TO ASC-SEL-ITEM                 01689018
016900         MOVE +1                  TO ASC-SEL-SUB                  01690018
016910     END-IF.                                                      01691018
016920                                                                  01692018
016930     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                01693018
016940         PERFORM 9100-READ-SEL-QUEUE                              01694018
016950         IF  SU004-ITEM (ASC-SEL-SUB) > ZERO                      01695018
016960             MOVE ZEROS TO ASC-TOT-EXP-CRTNS                      01696018
016970             MOVE ZEROS TO ASC-TOT-ACTL-CRTNS                     01697018
016980             MOVE ZEROS TO ASC-TOT-EXP-SCAN                       01698018
016990             MOVE ZEROS TO ASC-TOT-ACTL-SCN                       01699018
017000             MOVE ZEROS TO ASC-TOT-UNITS                          01700018
017010             MOVE SU004-SCAC-CDE   (ASC-SEL-SUB)                  01701018
017020                                       TO ASC-SCAC-ID             01702018
017030             MOVE SU004-VEH-NBR     (ASC-SEL-SUB)                 01703018
017040                                       TO ASC-VEH-NBR             01704018
017050             MOVE SU004-TRIP-ID   (ASC-SEL-SUB)                   01705018
017060                                       TO ASC-TRIP-ID             01706018
017070                                                                  01707018
017080             SET SU004-INQ (ASC-SEL-SUB)                          01708018
017090                                  TO TRUE                         01709018
017100             PERFORM 9200-REWRITE-SEL-QUEUE                       01710018
017110         ELSE                                                     01711018
017120             SUBTRACT +1 FROM ASC-SEL-SUB                         01712018
017130             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             01713018
017140             SET DP020-MSG-INFORMATIONAL                          01714018
017150                 PS-LIST-END             TO TRUE                  01715018
017160         END-IF                                                   01716018
017170     ELSE                                                         01717018
017180         SUBTRACT +1 FROM ASC-SEL-ITEM                            01718018
017190         MOVE SU004-MAX-ITEMS     TO ASC-SEL-SUB                  01719018
017200         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             01720018
017210             SET DP020-MSG-INFORMATIONAL                          01721018
017220                 PS-LIST-END             TO TRUE                  01722018
017230     END-IF.                                                      01723018
017240                                                                  01724018
017250                                                                  01725018
017260*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*01726018
017270*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *01727018
017280*    PROCESSED.                                                  *01728018
017290*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*01729018
017300                                                                  01730018
017310 1140-GET-PREV-RECORD.                                            01731018
017320                                                                  01732018
017330     SUBTRACT +1 FROM ASC-SEL-SUB.                                01733018
017340                                                                  01734018
017350     IF  ASC-SEL-SUB < +1                                         01735018
017360         SUBTRACT +1 FROM ASC-SEL-ITEM                            01736018
017370         MOVE SU004-MAX-ITEMS     TO ASC-SEL-SUB                  01737018
017380     END-IF.                                                      01738018
017390                                                                  01739018
017400     IF  ASC-SEL-ITEM > ZERO                                      01740018
017410         PERFORM 9100-READ-SEL-QUEUE                              01741018
017420             MOVE ZEROS TO ASC-TOT-EXP-CRTNS                      01742018
017430             MOVE ZEROS TO ASC-TOT-ACTL-CRTNS                     01743018
017440             MOVE ZEROS TO ASC-TOT-EXP-SCAN                       01744018
017450             MOVE ZEROS TO ASC-TOT-ACTL-SCN                       01745018
017460             MOVE ZEROS TO ASC-TOT-UNITS                          01746018
017470             MOVE SU004-SCAC-CDE   (ASC-SEL-SUB)                  01747018
017480                                       TO ASC-SCAC-ID             01748018
017490             MOVE SU004-VEH-NBR     (ASC-SEL-SUB)                 01749018
017500                                       TO ASC-VEH-NBR             01750018
017510             MOVE SU004-TRIP-ID   (ASC-SEL-SUB)                   01751018
017520                                       TO ASC-TRIP-ID             01752018
017530         SET SU004-INQ (ASC-SEL-SUB)                              01753018
017540                                  TO TRUE                         01754018
017550         PERFORM 9200-REWRITE-SEL-QUEUE                           01755018
017560     ELSE                                                         01756018
017570         MOVE +1                  TO ASC-SEL-ITEM                 01757018
017580                                     ASC-SEL-SUB                  01758018
017590         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             01759018
017600             SET DP020-MSG-INFORMATIONAL                          01760018
017610                 PS-LIST-END             TO TRUE                  01761018
017620     END-IF.                                                      01762018
017630                                                                  01763018
017640                                                                  01764018
017650                                                                  01765018
017660******************************************************************01766018
017670*  GET ARRIVAL DATE.                                             *01767018
017680******************************************************************01768018
017690 1150-GET-ARRIVAL-DATE.                                           01769018
017700                                                                  01770018
017710     PERFORM                                                      01771018
017720         WITH TEST AFTER                                          01772018
017730         VARYING PV-RETRY-COUNTER                                 01773018
017740         FROM 1 BY 1                                              01774018
017750         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               01775018
017760             OR (SQLCODE = +0)                                    01776018
017770             OR (SQLCODE = -305))                                 01777018
017780                                                                  01778018
017790         EXEC SQL                                                 01779018
017800              SELECT MAX(B.STATUS_DTE)                            01780018
017810                INTO :TRIPST-STATUS-DTE                           01781018
017820              FROM   TVHTRIP A                                    01782018
017830                    ,TTRIPST B                                    01783018
017840                    ,TTRSTYP C                                    01784018
017850              WHERE A.TRIP_ID = :DK-TRIP-ID                       01785018
017860                AND B.TRIP_STATUS_CDE IN ('AR','EN')              01786018
017870                AND A.TRIP_ID  = B.TRIP_ID                        01787018
017880                AND C.PRTY_CDE =                                  01788018
017890                    (SELECT MAX(E.PRTY_CDE)                       01789018
017900                       FROM TTRIPST D                             01790018
017910                           ,TTRSTYP E                             01791018
017920                      WHERE D.TRIP_ID         = A.TRIP_ID         01792018
017930                        AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)01793018
017940         END-EXEC                                                 01794018
017950                                                                  01795018
017960         EVALUATE TRUE                                            01796018
017970             WHEN SQLCODE = +0                                    01797018
017980             WHEN SQLCODE = -305                                  01798018
017990             WHEN SQLCODE = -904                                  01799018
018000             WHEN SQLCODE = -913                                  01800018
018010                  CONTINUE                                        01801018
018020                                                                  01802018
018030             WHEN SQLWARN0 NOT = SPACES                           01803018
018040             WHEN SQLCODE < +0                                    01804018
018050             WHEN SQLCODE > +0                                    01805018
018060                  MOVE '1150-GET-ARRIVAL-DATE'                    01806018
018070                                  TO DP013-PARAGRAPH              01807018
018080                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'           01808018
018090                                  TO DP013-MESSAGE-TEXT (1)       01809018
018100                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  01810018
018110                  MOVE DK-REC-SEQ-NBR                             01811018
018120                                  TO PV-ERROR-SEQ                 01812018
018130                  MOVE DK-OPER-UNT-ID                             01813018
018140                                  TO PV-ERROR-OPER-UNT-ID         01814018
018150                  MOVE PV-ERROR-MSG                               01815018
018160                                  TO DP013-MESSAGE-TEXT (2)       01816018
018170                  MOVE SQLCA      TO DP013-SQLCA                  01817018
018180                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     01818018
018190                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     01819018
018200                  MOVE 'TTRSTYP ' TO DP013-DB2-TABLE-NAME (3)     01820018
018210                  SET DP013-DB2-ABEND                             01821018
018220                      DP013-XCTL-DISPLAY-RESTART                  01822018
018230                                  TO TRUE                         01823018
018240                  PERFORM DP013-0000-PROCESS-ABEND                01824018
018250         END-EVALUATE                                             01825018
018260     END-PERFORM.                                                 01826018
018270                                                                  01827018
018280     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    01828018
018290         SQLCODE NOT = +0                                         01829018
018300         MOVE '1150-GET-ARRIVAL-DATE'                             01830018
018310                                  TO DP013-PARAGRAPH              01831018
018320         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'            01832018
018330                                  TO DP013-MESSAGE-TEXT (1)       01833018
018340         MOVE SQLCA               TO DP013-SQLCA                  01834018
018350         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     01835018
018360         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     01836018
018370         MOVE 'TTRSTYP '          TO DP013-DB2-TABLE-NAME (3)     01837018
018380         SET DP013-DB2-ABEND                                      01838018
018390             DP013-XCTL-DISPLAY-RESTART                           01839018
018400                                  TO TRUE                         01840018
018410         PERFORM DP013-0000-PROCESS-ABEND                         01841018
018420     END-IF.                                                      01842018
018430                                                                  01843018
018440                                                                  01844018
018450*----------------------------------------------------------------*01845018
018460* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *01846018
018470* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *01847018
018480* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *01848018
018490* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *01849018
018500* FUNCTION KEYS CAN GET THIS FAR.                                *01850018
018510*----------------------------------------------------------------*01851018
018520                                                                  01852018
018530 2000-PROCESS-PANEL.                                              01853018
018540     EVALUATE TRUE                                                01854018
018550         WHEN DP020-SRC-AID = DP016-CLEAR                         01855018
018560             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    01856018
018570             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   01857018
018580             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01858018
018590                                                                  01859018
018600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    01860018
018610             SET ASC-SELECT-ALL-NO TO TRUE                        01861018
018620             MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID          01862018
018630             MOVE ASC-KEY-FCLTY-ID  TO DK-FCLTY-ID                01863018
018640             MOVE ASC-SCAC-ID       TO DK-SCAC-ID                 01864018
018650             MOVE ASC-VEH-NBR       TO DK-VEH-NBR                 01865018
018660             MOVE ASC-TRIP-ID       TO DK-TRIP-ID                 01866018
018670             MOVE ASC-TRLR-STATUS   TO DK-TRLR-STATUS             01867018
018680             MOVE ASC-HDR-LBL-PRTID TO DK-HDR-LBL-PRTID           01868018
018690             MOVE ASC-HDR-LBL-INSTR TO DK-HDR-LBL-INSTR           01869018
018700*            MOVE ASC-TOT-UNITS     TO DK-TOTAL-UNITS             01870018
018710             MOVE ASC-STATUS        TO DK-STATUS-CDE              01871018
018720                                                                  01872018
018730             PERFORM 2050-DELETE-LIST-QUEUE                       01873018
018740             MOVE ZEROS TO ASC-TOT-EXP-CRTNS                      01874018
018750             MOVE ZEROS TO ASC-TOT-ACTL-CRTNS                     01875018
018760             MOVE ZEROS TO ASC-TOT-EXP-SCAN                       01876018
018770             MOVE ZEROS TO ASC-TOT-ACTL-SCN                       01877018
018780             MOVE ZEROS TO ASC-TOT-UNITS                          01878018
018790             MOVE SPACES TO ASC-HDR-LBL-PRTID                     01879018
018800             MOVE SPACES TO ASC-HDR-LBL-INSTR                     01880018
018810             MOVE SPACES TO ASC-TRAILER-STATUS                    01881018
018820             PERFORM 4000-BUILD-INITIAL-PANEL                     01882018
018830                                                                  01883018
018840         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    01884018
018850             PERFORM 2140-DESELECT-ALL-ITEMS                      01885018
018860             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01886018
018870                                                                  01887018
018880         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  01888018
018890             SET ASC-SELECT-ALL-YES TO TRUE                       01889018
018900             PERFORM 2150-SELECT-ALL-ITEMS                        01890018
018910             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01891018
018920                                                                  01892018
018930         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             01893018
018940           IF  ASC-USE-SELECTION-QUEUE                            01894018
018950               PERFORM 1130-GET-NEXT-RECORD                       01895018
018960               IF PS-LIST-END                                     01896018
018970                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           01897018
018980                   SET PS-NO-LIST-END TO TRUE                     01898018
018990               ELSE                                               01899018
019000                   PERFORM 2050-DELETE-LIST-QUEUE                 01900018
019010                   PERFORM 3200-RESET-ATTRIBUTES                  01901018
019020                   PERFORM 4000-BUILD-INITIAL-PANEL               01902018
019030               END-IF                                             01903018
019040            ELSE                                                  01904018
019050               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               01905018
019060*              --- BOTTOM OF LIST ---                             01906018
019070               MOVE PC-TSYMSG-00070                               01907018
019080                                 TO DP020-MSG-NUMBER              01908018
019090               SET DP020-MSG-INFORMATIONAL                        01909018
019100                                 TO TRUE                          01910018
019110           END-IF                                                 01911018
019120                                                                  01912018
019130         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             01913018
019140           IF  ASC-USE-SELECTION-QUEUE                            01914018
019150               PERFORM 1140-GET-PREV-RECORD                       01915018
019160               IF PS-LIST-END                                     01916018
019170                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           01917018
019180                   SET PS-NO-LIST-END                             01918018
019190                                 TO TRUE                          01919018
019200               ELSE                                               01920018
019210                   PERFORM 2050-DELETE-LIST-QUEUE                 01921018
019220                   PERFORM 3200-RESET-ATTRIBUTES                  01922018
019230                   PERFORM 4000-BUILD-INITIAL-PANEL               01923018
019240               END-IF                                             01924018
019250           ELSE                                                   01925018
019260               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               01926018
019270               MOVE PC-TSYMSG-00069                               01927018
019280                                 TO DP020-MSG-NUMBER              01928018
019290               SET DP020-MSG-INFORMATIONAL                        01929018
019300                                 TO TRUE                          01930018
019310           END-IF                                                 01931018
019320                                                                  01932018
019330         WHEN OTHER                                               01933018
019340             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 01934018
019350             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   01935018
019360             IF  PS-NO-ERROR                                      01936018
019370                 SET DP030-CONTINUE-GO                            01937018
019380                                 TO TRUE                          01938018
019390                 PERFORM 2100-CHECK-FUNCTION-KEY                  01939018
019400             ELSE                                                 01940018
019410                 IF DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)        01941035
019420                     PERFORM 2100-CHECK-FUNCTION-KEY              01942034
019430                 ELSE                                             01943034
019440                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         01944018
019450                     SET DP030-OVERRIDE-GO TO TRUE                01945018
019460                 END-IF                                           01946034
019470             END-IF                                               01947018
019480     END-EVALUATE.                                                01948018
019490                                                                  01949018
019500*----------------------------------------------------------------*01950018
019510*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *01951018
019520*----------------------------------------------------------------*01952018
019530 2050-DELETE-LIST-QUEUE.                                          01953018
019540                                                                  01954018
019550     EXEC CICS                                                    01955018
019560         DELETEQ TS                                               01956018
019570             QUEUE (ASC-LIST-QUEUE-NAME)                          01957018
019580             RESP  (PV-CICS-RESP)                                 01958018
019590     END-EXEC.                                                    01959018
019600                                                                  01960018
019610     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       01961018
019620        (PV-CICS-RESP = DFHRESP(QIDERR))                          01962018
019630         CONTINUE                                                 01963018
019640     ELSE                                                         01964018
019650         SET DP013-CICS-ABEND      TO TRUE                        01965018
019660         SET DP013-NO-ROLLBACK     TO TRUE                        01966018
019670                                                                  01967018
019680         MOVE '2050-DELETE-LIST-QUEUE'                            01968018
019690                                   TO DP013-PARAGRAPH             01969018
019700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    01970018
019710                                   TO DP013-MESSAGE-TEXT (1)      01971018
019720         PERFORM DP013-0000-PROCESS-ABEND                         01972018
019730     END-IF.                                                      01973018
019740                                                                  01974018
019750     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  01975018
019760                                                                  01976018
019770*----------------------------------------------------------------*01977018
019780* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*01978018
019790* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *01979018
019800* CICS ARCHITECTURE API.                                         *01980018
019810*----------------------------------------------------------------*01981018
019820***********************************                               01982018
019830* F24 - CTNRCLST    (LOCAL-FUNC-01)                               01983018
019840***********************************                               01984018
019850                                                                  01985018
019860 2100-CHECK-FUNCTION-KEY.                                         01986018
019870     SET SU003-UPDATE-TSQ TO TRUE.                                01987018
019880                                                                  01988018
019890        EVALUATE TRUE                                             01989018
019900****F24 **PO/RCVR CARTON LIST*** (SUKCS553)                       01990018
019910          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)             01991018
019920             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              01992018
019930                 INITIALIZE SU003-INTER-APPL-COMMAREA             01993018
019940                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                01994018
019950                                TO SU003-NUMBER-OF-SELECTED-ITEMS 01995018
019960                 MOVE ASC-KEY-OPER-UNT-ID TO SU003-OPER-UNT-ID    01996018
019970                 MOVE ASC-KEY-FCLTY-ID    TO SU003-FCLTY-ID       01997018
019980                 MOVE ASC-FCLTY-NME       TO SU003-FCLTY-NME      01998018
019990                 MOVE ASC-SCAC-ID         TO SU003-SCAC-CDE       01999018
020000                 MOVE ASC-VEH-NBR         TO SU003-TRLR-NBR       02000018
020010                 MOVE ASC-TRIP-ID         TO SU003-TRIP-ID        02001018
020020                                                                  02002018
020030                 PERFORM 5000-PREPARE-SEL-QUEUE                   02003018
020040                 SET ASC-FUNC01-RETURN-YES TO TRUE                02004018
020050             ELSE                                                 02005018
020060                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02006018
020070                 SET DP030-OVERRIDE-GO TO TRUE                    02007018
020080                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        02008018
020090                 SET DP020-MSG-WARNING TO TRUE                    02009018
020100             END-IF                                               02010018
020110                                                                  02011018
020120****F15 RECEIVER UPDATE*(RCKCS816)                                02012018
020130          WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)             02013018
020140             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              02014018
020150                 INITIALIZE RC815-INTER-APPL-COMMAREA             02015018
020160                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                02016018
020170                                TO RC815-NUMBER-OF-SELECTED-ITEMS 02017018
020180                 MOVE ASC-KEY-OPER-UNT-ID TO RC815-OPER-UNT-ID    02018018
020190                 MOVE ASC-KEY-FCLTY-ID    TO RC815-FCLTY-ID       02019018
020200                 MOVE ASC-SCAC-ID TO RC815-SCAC-CDE               02020018
020210                 MOVE ASC-VEH-NBR TO RC815-TRLR-NBR               02021018
020220                 MOVE ASC-TRIP-ID TO RC815-TRIP-ID                02022018
020230                 MOVE ASC-TRLR-STATUS TO RC815-TRAILER-STATUS     02023018
020240                 PERFORM 5000-PREPARE-SEL-QUEUE                   02024018
020250                 SET ASC-FUNC03-RETURN-YES TO TRUE                02025018
020260             ELSE                                                 02026018
020270                IF ASC-FA-ACCESS-NO                               02027018
020280                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           02028018
020290                   SET ASC-FA-ACCESS-YES  TO TRUE                 02029018
020300                   SET DP030-OVERRIDE-GO  TO TRUE                 02030018
020310                   MOVE PC-TSYMSG-03229   TO DP020-MSG-NUMBER     02031018
020320                   SET DP020-MSG-WARNING  TO TRUE                 02032018
020330                ELSE                                              02033018
020340                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           02034018
020350                   SET DP030-OVERRIDE-GO  TO TRUE                 02035018
020360                   MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER     02036018
020370                   SET DP020-MSG-WARNING  TO TRUE                 02037018
020380                END-IF                                            02038018
020390             END-IF                                               02039018
020400                                                                  02040018
020410****F23 **P2L/CASEPACK ** (PCKCS701)                              02041023
020420         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              02042018
020430             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              02043018
020441                 INITIALIZE RC815-INTER-APPL-COMMAREA             02044151
020450                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                02045051
020460                            TO RC815-NUMBER-OF-SELECTED-ITEMS     02046018
020470                 MOVE DP020-LOCATION-NBR    TO RC815-OPER-UNT-ID  02047051
020480                 MOVE ASC-KEY-FCLTY-ID      TO RC815-FCLTY-ID     02048051
020490                 PERFORM 5000-PREPARE-SEL-QUEUE                   02049051
020500                 SET ASC-FUNC05-RETURN-YES  TO TRUE               02050051
020510             ELSE                                                 02051018
020520               IF  ASC-PBS-YES                                    02052018
020530                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02053018
020540                     SET ASC-PBS-NO         TO TRUE               02054018
020550                     SET DP030-OVERRIDE-GO  TO TRUE               02055018
020560                     MOVE PC-TSYMSG-01803   TO DP020-MSG-NUMBER   02056018
020570                     SET DP020-MSG-WARNING  TO TRUE               02057018
020581               ELSE                                               02058123
020582                 IF  ASC-OPER-MISMATCH                            02058240
020583                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02058340
020584                     SET ASC-OPER-MISMATCH-NO TO TRUE             02058440
020585                     SET DP030-OVERRIDE-GO  TO TRUE               02058540
020586                     MOVE PC-TSYMSG-03814   TO DP020-MSG-NUMBER   02058641
020588                     SET DP020-MSG-WARNING  TO TRUE               02058840
020589                 ELSE                                             02058940
020590                 IF ASC-FA-ACCESS-NO                              02059018
020600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02060018
020610                     SET ASC-FA-ACCESS-YES  TO TRUE               02061018
020620                     SET DP030-OVERRIDE-GO  TO TRUE               02062018
020630                     MOVE PC-TSYMSG-03229   TO DP020-MSG-NUMBER   02063018
020640                     SET DP020-MSG-WARNING  TO TRUE               02064018
020644                 ELSE                                             02064428
020660                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02066018
020670                     SET DP030-OVERRIDE-GO  TO TRUE               02067018
020680                     MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER   02068018
020690                     SET DP020-MSG-WARNING  TO TRUE               02069018
020701                 END-IF                                           02070144
020702                 END-IF                                           02070244
020710               END-IF                                             02071018
020720             END-IF                                               02072018
020730                                                                  02073018
020740*   F14 **AUDIT LIST ** (SUKCS589)                                02074018
020750         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              02075018
020760             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              02076018
020770                 INITIALIZE SU024-INTER-APPL-COMMAREA             02077018
020780                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                02078018
020790                                 TO SU024-NUMBER-OF-SELECTED-ITEMS02079018
020800                 MOVE ASC-KEY-OPER-UNT-ID TO  SU024-OPER-UNIT-ID  02080018
020810                 PERFORM 5000-PREPARE-SEL-QUEUE                   02081018
020820                 SET ASC-FUNC07-RETURN-YES TO TRUE                02082018
020830             ELSE                                                 02083018
020840                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02084018
020850                 SET DP030-OVERRIDE-GO  TO TRUE                   02085018
020860                 MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER       02086018
020870                 SET DP020-MSG-WARNING  TO TRUE                   02087018
020880             END-IF                                               02088018
020890                                                                  02089018
020900****F17 ***PRINT HEADER***                                        02090018
020910         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              02091018
020920           IF ASC-SELECT-ALL-NO                                   02092018
020930             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               02093018
020940                IF ASC-FA-ACCESS-NO                               02094018
020950                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           02095018
020960                   SET ASC-FA-ACCESS-YES  TO TRUE                 02096018
020970                   SET DP030-OVERRIDE-GO  TO TRUE                 02097018
020980                   MOVE PC-TSYMSG-03229   TO DP020-MSG-NUMBER     02098018
020990                   SET DP020-MSG-WARNING  TO TRUE                 02099018
021000                ELSE                                              02100018
021010                   SET DP030-OVERRIDE-GO TO TRUE                  02101018
021020                   MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER      02102018
021030                   SET DP020-MSG-WARNING TO TRUE                  02103018
021040                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           02104018
021050                END-IF                                            02105018
021060             ELSE                                                 02106018
021070                 SET DP030-CONTINUE-GO TO TRUE                    02107018
021080                 PERFORM 5000-PREPARE-SEL-QUEUE                   02108018
021090                  IF PC140-CRA-SUCCESSFUL                         02109018
021100                       MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER   02110018
021110                       SET DP020-MSG-INFORMATIONAL TO TRUE        02111018
021120                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       02112018
021130                 ELSE                                             02113018
021140                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       02114018
021150                 END-IF                                           02115018
021160             END-IF                                               02116018
021170           ELSE                                                   02117018
021180               MOVE PC-TSYMSG-02993 TO DP020-MSG-NUMBER           02118018
021190               SET DP020-MSG-WARNING       TO TRUE                02119018
021200           END-IF                                                 02120018
021210                                                                  02121018
021220****F18 ***PO REPORT REQUEST SCREEN*** (SUKCS556)                 02122018
021230         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              02123018
021240             IF  ASC-NUMBER-OF-ITEMS-READ =                       02124018
021250                 ASC-NUMBER-OF-SELECTED-ITEMS                     02125018
021260                    MOVE 'Y' TO ASC-ALL-PO-IND                    02126018
021270             ELSE                                                 02127018
021280                    MOVE 'N' TO ASC-ALL-PO-IND                    02128018
021290             END-IF                                               02129018
021300                                                                  02130018
021310             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              02131018
021320                 INITIALIZE SU003-INTER-APPL-COMMAREA             02132018
021330                 MOVE ASC-ALL-PO-IND      TO SU003-ALL-PO-IND     02133018
021340                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                02134018
021350                                TO SU003-NUMBER-OF-SELECTED-ITEMS 02135018
021360                 MOVE ASC-KEY-OPER-UNT-ID TO SU003-OPER-UNT-ID    02136018
021370                 MOVE ASC-KEY-FCLTY-ID    TO SU003-FCLTY-ID       02137018
021380                 MOVE ASC-FCLTY-NME       TO SU003-FCLTY-NME      02138018
021390                 MOVE ASC-TRIP-ID         TO SU003-TRIP-ID        02139018
021400                 MOVE ASC-SCAC-ID         TO SU003-SCAC-CDE       02140018
021410                 MOVE ASC-VEH-NBR         TO SU003-TRLR-NBR       02141018
021420                 PERFORM 5000-PREPARE-SEL-QUEUE                   02142018
021430                 SET ASC-FUNC04-RETURN-YES TO TRUE                02143018
021440                 SET SU003-NO-TSQ-UPDATE  TO TRUE                 02144018
021450             ELSE                                                 02145018
021460                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02146018
021470                 SET DP030-OVERRIDE-GO  TO TRUE                   02147018
021480                 MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER       02148018
021490                 SET DP020-MSG-WARNING  TO TRUE                   02149018
021500             END-IF                                               02150018
021510                                                                  02151018
021520****F22 **UNLOADED **                                             02152018
021530         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              02153018
021540           MOVE ASC-TRIP-ID       TO DK-TRIP-ID                   02154018
021550* JAK 04/2007 - ADD WMS CHECK - START                             02155018
021560           PERFORM 7300-CHECK-WMOS                                02156018
021570           IF PS-NO-ERROR                                         02157018
021580* JAK 04/2007 - ADD WMS CHECK - END                               02158018
021590             PERFORM 2160-SELECT-TTRIPST                          02159018
021600*            MOVE SPACES TO ASC-TRAILER-STATUS                    02160018
021610*            PERFORM 2170-CHECK-TO-UNLOAD                         02161018
021620             IF TRIPST-TRIP-STATUS-CDE     = 'UN'                 02162018
021630**  TRLR IS ALREADY UNLOADED**                                    02163018
021640               SET DP030-OVERRIDE-GO  TO TRUE                     02164018
021650               MOVE PC-TSYMSG-03289 TO DP020-MSG-NUMBER           02165018
021660               SET DP020-MSG-WARNING TO TRUE                      02166018
021670               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               02167018
021680             ELSE                                                 02168018
021690               IF TRIPST-TRIP-STATUS-CDE NOT = 'AR' AND NOT = 'UG'02169018
021700**  TRLR HAS TO BE ARRIVED BEFORE IT CAN BE UNLOADED **           02170018
021710                 SET DP030-OVERRIDE-GO  TO TRUE                   02171018
021720                 MOVE PC-TSYMSG-01074 TO DP020-MSG-NUMBER         02172018
021730                 SET DP020-MSG-WARNING TO TRUE                    02173018
021740                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02174018
021750               ELSE                                               02175018
021760*                IF ASC-TRLR-NOT-UNLOADED                         02176018
021770**  UPDATE OF RECEIPT INFO NOT COMPLETED FOR THIS TRLR  **        02177018
021780*                  SET DP030-OVERRIDE-GO  TO TRUE                 02178018
021790*                  MOVE PC-TSYMSG-00416 TO DP020-MSG-NUMBER       02179018
021800*                  SET DP020-MSG-WARNING TO TRUE                  02180018
021810*                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           02181018
021820*                ELSE                                             02182018
021830**  TRAILER HAS BEEN UNLOADED **                                  02183018
021840                   INITIALIZE RC815-INTER-APPL-COMMAREA           02184018
021850                   MOVE ASC-NUMBER-OF-SELECTED-ITEMS              02185018
021860                       TO RC815-NUMBER-OF-SELECTED-ITEMS          02186018
021870                   MOVE ASC-KEY-OPER-UNT-ID                       02187018
021880                               TO RC815-OPER-UNT-ID               02188018
021890                   MOVE ASC-KEY-FCLTY-ID                          02189018
021900                                 TO RC815-FCLTY-ID                02190018
021910                   MOVE ASC-SCAC-ID TO RC815-SCAC-CDE             02191018
021920                   MOVE ASC-VEH-NBR TO RC815-TRLR-NBR             02192018
021930                   MOVE ASC-TRIP-ID TO RC815-TRIP-ID              02193018
021940                   MOVE ASC-TRLR-STATUS                           02194018
021950                                  TO RC815-TRAILER-STATUS         02195018
021960                   PERFORM 5000-PREPARE-SEL-QUEUE                 02196018
021970                   SET ASC-FUNC06-RETURN-YES TO TRUE              02197018
021980*               END-IF                                            02198018
021990               END-IF                                             02199018
022000             END-IF                                               02200018
022010* JAK 04/2007 - ADD ERROR LOGIC                                   02201018
022020           ELSE                                                   02202018
022030               SET DP030-OVERRIDE-GO  TO TRUE                     02203018
022040               MOVE PC-TSYMSG-03554   TO DP020-MSG-NUMBER         02204018
022050               SET DP020-MSG-FATAL    TO TRUE                     02205018
022060               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               02206018
022070           END-IF                                                 02207018
022080* JAK 04/2007 - END ERROR LOGIC                                   02208018
022090                                                                  02209018
022100*LMM                                                              02210018
022110****F19 **TRBLCRE **                                              02211018
022120         WHEN DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)               02212018
022130             INITIALIZE PC000-INTER-APPL-COMMAREA                 02213018
022140             MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                 02214018
022150                                   PC000-NUMBER-OF-SELECTED-ITEMS 02215018
022160             MOVE ASC-KEY-PO-NBR                                  02216018
022170                                TO PC000-PO-NBR-N                 02217018
022180             MOVE ASC-KEY-REC-SEQ-NBR                             02218018
022190                                TO PC000-REC-SEQ-NBR-N            02219018
022200             MOVE ASC-KEY-OPER-UNT-ID                             02220018
022210                                TO PC000-OPERATING-UNIT-ID        02221018
022220             MOVE ASC-KEY-FCLTY-ID                                02222018
022230                                TO PC000-FACILITY-ID              02223018
022240             PERFORM 5000-PREPARE-SEL-QUEUE                       02224018
022250             SET ASC-FUNC08-RETURN-YES TO TRUE                    02225018
022260                                                                  02226018
022270*LMM                                                              02227018
022280****F16 **FREE ASTRAY LIST ** (SUKCS761)                          02228018
022290         WHEN DP020-FK-LOCAL-FUNC-09(DP020-SRC-AID)               02229018
022300             INITIALIZE SU046-INTER-APPL-COMMAREA                 02230018
022310             MOVE ASC-KEY-OPER-UNT-ID                             02231018
022320                                TO SU046-OPER-UNT-ID              02232018
022330             MOVE ASC-KEY-FCLTY-ID                                02233018
022340                                TO SU046-FCLTY-ID                 02234018
022350             MOVE ASC-FCLTY-NME                                   02235018
022360                                TO SU046-FCLTY-NME                02236018
022370             MOVE ASC-SCAC-ID                                     02237018
022380                                TO SU046-SCAC                     02238018
022390             MOVE ASC-VEH-NBR                                     02239018
022400                                TO SU046-TRLR-NBR                 02240018
022410*            SET ASC-FUNC09-RETURN-YES TO TRUE                    02241018
022420                                                                  02242018
022430*DMB                                                              02243018
022440****F20 **SULPOADJ** STORE UNIT ADJ PO ACTIVITY                   02244018
022450         WHEN DP020-FK-LOCAL-FUNC-10(DP020-SRC-AID)               02245018
022460             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              02246018
022470                 INITIALIZE SU038-INTER-APPL-COMMAREA             02247018
022480                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                02248018
022490                                 TO SU038-NUMBER-OF-SELECTED-ITEMS02249018
022500                 MOVE 'A'                 TO SU038-UNT-ADJ-TYP    02250018
022510                 MOVE ASC-KEY-OPER-UNT-ID TO SU038-OPER-UNT-ID    02251018
022520                 PERFORM 2105-GET-DATE-RANGE                      02252018
022530**** JOAN FLETCHER DECIDED THIS DATE NEEDED TO BE FROM THE BEGIN- 02253018
022540**** NING OF 2003 BECAUSE OF SET TRAILERS.  12/2003 D.BRANTNER    02254018
022550*                MOVE PV-DFLT-FROM-DATE    TO SU038-FROM-DATE     02255018
022560                 MOVE '12312002'           TO SU038-FROM-DATE     02256018
022570                 MOVE PV-CURR-DATE        TO SU038-TO-DATE        02257018
022580                 PERFORM 5000-PREPARE-SEL-QUEUE                   02258018
022590                 SET ASC-FUNC10-RETURN-YES TO TRUE                02259018
022600             ELSE                                                 02260018
022610                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02261018
022620                 SET DP030-OVERRIDE-GO TO TRUE                    02262018
022630                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         02263018
022640                 SET DP020-MSG-WARNING TO TRUE                    02264018
022650             END-IF                                               02265018
022660                                                                  02266018
022670*      F13 SUSPEND LIST - RCKCS299                                02267018
022680         WHEN DP020-FK-LOCAL-FUNC-11(DP020-SRC-AID)               02268018
022690             MOVE ASC-TRIP-ID         TO RC015-TRIP-ID            02269018
022700             MOVE ASC-KEY-OPER-UNT-ID TO RC015-OPER-UNT-ID        02270018
022710             MOVE 1                   TO RC015-FCLTY-ID           02271018
022720*            CONTINUE                                             02272018
022730*            IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               02273018
022740*                SET DP030-OVERRIDE-GO TO TRUE                    02274018
022750*                MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        02275018
022760*                SET DP020-MSG-WARNING TO TRUE                    02276018
022770*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02277018
022780*            ELSE                                                 02278018
022790*                SET ASC-FUNC11-RETURN-YES TO TRUE                02279018
022800*                SET DP030-CONTINUE-GO TO TRUE                    02280018
022810*                INITIALIZE RC815-INTER-APPL-COMMAREA             02281018
022820*                PERFORM 5000-PREPARE-SEL-QUEUE                   02282018
022830*            END-IF                                               02283018
022840*************                                                     02284018
022850*F2 CONFIRM                                                       02285018
022860*************                                                     02286018
022870         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    02287018
022880           IF ASC-SELECT-ALL-YES                                  02288018
022890               SET DP030-CONTINUE-GO TO TRUE                      02289018
022900               PERFORM 3270-VALIDATE-PRINTER-ID                   02290018
022910               MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID        02291018
022920               PERFORM 3600-GET-DC-LOCATION                       02292018
022930               PERFORM 5000-PREPARE-SEL-QUEUE                     02293018
022940                   IF PC140-CRA-SUCCESSFUL                        02294018
022950                       MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER   02295018
022960                       SET DP020-MSG-INFORMATIONAL TO TRUE        02296018
022970                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       02297018
022980                   ELSE                                           02298018
022990                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       02299018
023000                   END-IF                                         02300018
023010                   SET ASC-SELECT-ALL-NO TO TRUE                  02301018
023020*          ELSE                                                   02302018
023030*            IF ASC-UNLOAD-YES                                    02303018
023040*              IF ASC-ACTL-COUNT-ZERO                             02304018
023050*                 MOVE PC-TSYMSG-02996 TO DP020-MSG-NUMBER        02305018
023060*                 SET DP020-MSG-WARNING      TO TRUE              02306018
023070*                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            02307018
023080*                 SET ASC-UNLOAD-YES TO TRUE                      02308018
023090*                 SET ASC-SELECT-ALL-NO TO TRUE                   02309018
023100*                 SET ASC-ACTL-COUNT-ZERO-NO TO TRUE              02310018
023110*              ELSE                                               02311018
023120*                 PERFORM 8000-UPDATE-TRIP-SHIPMENT-STAT          02312018
023130*                 MOVE PC-TSYMSG-00417 TO DP020-MSG-NUMBER        02313018
023140*                 MOVE 'UNLOADED'      TO ASC-TRLR-STATUS         02314018
023150*                 SET DP020-MSG-INFORMATIONAL TO TRUE             02315018
023160*                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            02316018
023170*                 SET ASC-UNLOAD-NO TO TRUE                       02317018
023180*              END-IF                                             02318018
023190*            END-IF                                               02319018
023200           END-IF                                                 02320018
023210******************************************************************02321018
023220*                                                                 02322018
023230* F6 - FIRST PAGE                                                 02323018
023240*                                                                 02324018
023250         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  02325018
023260             MOVE +1               TO PV-TOP-ITEM                 02326018
023270             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02327018
023280*                                                                 02328018
023290* F7 - PREVIOUS PAGE                                              02329018
023300*                                                                 02330018
023310         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   02331018
023320             PERFORM 2110-BROWSE-BACKWARD                         02332018
023330             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02333018
023340*                                                                 02334018
023350* F8 - NEXT PAGE                                                  02335018
023360*                                                                 02336018
023370         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   02337018
023380             PERFORM 2120-BROWSE-FORWARD                          02338018
023390             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02339018
023400*                                                                 02340018
023410* ENTER KEY                                                       02341018
023420*                                                                 02342018
023430         WHEN DP020-SRC-AID = DP016-ENTER                         02343018
023440             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   02344018
023450             IF  PS-ERROR                                         02345018
023460                 CONTINUE                                         02346018
023470             ELSE                                                 02347018
023480                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02348018
023490             END-IF                                               02349018
023500                                                                  02350018
023510         WHEN OTHER                                               02351018
023520             SET DP013-NO-ROLLBACK                                02352018
023530                 DP013-XCTL-DISPLAY-RESTART                       02353018
023540                 DP013-CICS-ABEND  TO TRUE                        02354018
023550             MOVE '2100-CHECK-FUNCTION-KEY'                       02355018
023560                                   TO DP013-PARAGRAPH             02356018
023570             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02357018
023580                                   TO DP013-MESSAGE-TEXT (1)      02358018
023590             PERFORM DP013-0000-PROCESS-ABEND                     02359018
023600        END-EVALUATE.                                             02360018
023610*                                                                 02361018
023620*----------------------------------------------------------------*02362018
023630*    USE CALENDAR ROUTINE TO RETRIEVE A DATE RANGE THAT IS       *02363018
023640*    USED BY THE RECEIVER CHECK IN SCREEN.                       *02364018
023650*                                                                *02365018
023660*----------------------------------------------------------------*02366018
023670 2105-GET-DATE-RANGE.                                             02367018
023680     EXEC SQL                                                     02368018
023690         SELECT CURRENT DATE - FUNC_QTY DAYS                      02369018
023700               ,CURRENT DATE                                      02370018
023710           INTO   :PV-DEFAULT-FROM-DATE                           02371018
023720                 ,:PV-CURRENT-DATE                                02372018
023730           FROM  TKRPRPM                                          02373018
023740          WHERE LOC_ID            = :ASC-KEY-OPER-UNT-ID          02374018
023750            AND INTFC_SYS_CDE     = 'KHL'                         02375018
023760            AND SYS_PRC_FUNC_CDE  = 'STADJD'                      02376018
023770            AND FUNC_PRC_STAT_CDE = 'AC'                          02377018
023780      END-EXEC.                                                   02378018
023790                                                                  02379018
023800       EVALUATE TRUE                                              02380018
023810          WHEN SQLCODE = +0                                       02381018
023820              MOVE PV-DFLT-YY  TO PV-DT-YY                        02382018
023830              MOVE PV-DFLT-MM  TO PV-DT-MM                        02383018
023840              MOVE PV-DFLT-DD  TO PV-DT-DD                        02384018
023850              MOVE PV-CURR-YY  TO PV-CR-YY                        02385018
023860              MOVE PV-CURR-MM  TO PV-CR-MM                        02386018
023870              MOVE PV-CURR-DD  TO PV-CR-DD                        02387018
023880          WHEN OTHER                                              02388018
023890              SET PS-ERROR    TO TRUE                             02389018
023900              MOVE '2105-GET-DFLT-FROM-DATE ' TO DP013-PARAGRAPH  02390018
023910              MOVE 'CHECKING PARM TABLE' TO DP013-MESSAGE-TEXT (1)02391018
023920              MOVE DK-PO-NBR      TO PV-ERROR-PO                  02392018
023930              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 02393018
023940              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       02394018
023950              MOVE SQLCA   TO DP013-SQLCA                         02395018
023960              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         02396018
023970              SET DP013-DB2-ABEND                                 02397018
023980                  DP013-XCTL-DISPLAY-RESTART TO TRUE              02398018
023990              PERFORM DP013-0000-PROCESS-ABEND                    02399018
024000      END-EVALUATE.                                               02400018
024010                                                                  02401018
024020 2106-GET-BEFORE-PRICE-CHG-DAYS.                                  02402018
024030      EXEC SQL                                                    02403018
024040          SELECT FUNC_QTY                                         02404018
024050            INTO  :PV-PPCBEF-QTY                                  02405018
024060            FROM TKRPRPM                                          02406018
024070           WHERE LOC_ID = 90                                      02407018
024080             AND                                                  02408018
024090                 INTFC_SYS_CDE = 'KHL'                            02409018
024100             AND                                                  02410018
024110                 SYS_PRC_FUNC_CDE = 'PPCBEF'                      02411018
024120             WITH UR                                              02412018
024130      END-EXEC.                                                   02413018
024140                                                                  02414018
024150      EVALUATE TRUE                                               02415018
024160          WHEN SQLCODE = +0                                       02416018
024170*TEST ONLY    DISPLAY 'PARM PPCBEF VALUE = ' PV-PPCBEF-QTY        02417018
024180              CONTINUE                                            02418018
024190          WHEN SQLCODE = +100                                     02419018
024200              CONTINUE                                            02420018
024210          WHEN OTHER                                              02421018
024220              SET PS-ERROR    TO TRUE                             02422018
024230              MOVE '2106-GET-BEFORE-PRICE-CHG-DAYS'               02423018
024240                  TO DP013-PARAGRAPH                              02424018
024250              MOVE 'CHECKING PARM TABLE' TO DP013-MESSAGE-TEXT (1)02425018
024260              MOVE SQLCA   TO DP013-SQLCA                         02426018
024270              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         02427018
024280              SET DP013-DB2-ABEND                                 02428018
024290                  DP013-XCTL-DISPLAY-RESTART TO TRUE              02429018
024300              PERFORM DP013-0000-PROCESS-ABEND                    02430018
024310      END-EVALUATE.                                               02431018
024320                                                                  02432018
024330 2107-GET-AFTER-PRICE-CHG-DAYS.                                   02433018
024340      EXEC SQL                                                    02434018
024350          SELECT FUNC_QTY                                         02435018
024360            INTO  :PV-PPCAFT-QTY                                  02436018
024370            FROM TKRPRPM                                          02437018
024380           WHERE LOC_ID = 90                                      02438018
024390             AND                                                  02439018
024400                 INTFC_SYS_CDE = 'KHL'                            02440018
024410             AND                                                  02441018
024420                 SYS_PRC_FUNC_CDE = 'PPCAFT'                      02442018
024430             WITH UR                                              02443018
024440      END-EXEC.                                                   02444018
024450                                                                  02445018
024460      EVALUATE TRUE                                               02446018
024470          WHEN SQLCODE = +0                                       02447018
024480*TEST ONLY    DISPLAY 'PARM PPCAFT VALUE = ' PV-PPCAFT-QTY        02448018
024490              CONTINUE                                            02449018
024500          WHEN SQLCODE = +100                                     02450018
024510              CONTINUE                                            02451018
024520          WHEN OTHER                                              02452018
024530              SET PS-ERROR    TO TRUE                             02453018
024540              MOVE '2107-GET-AFTER-PRICE-CHG-DAYS'                02454018
024550                  TO DP013-PARAGRAPH                              02455018
024560              MOVE 'CHECKING PARM TABLE' TO DP013-MESSAGE-TEXT (1)02456018
024570              MOVE SQLCA   TO DP013-SQLCA                         02457018
024580              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         02458018
024590              SET DP013-DB2-ABEND                                 02459018
024600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              02460018
024610              PERFORM DP013-0000-PROCESS-ABEND                    02461018
024620      END-EVALUATE.                                               02462018
024630                                                                  02463018
024640*----------------------------------------------------------------*02464018
024650*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *02465018
024660*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *02466018
024670*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *02467018
024680*    MESSAGE.                                                    *02468018
024690*----------------------------------------------------------------*02469018
024700                                                                  02470018
024710 2110-BROWSE-BACKWARD.                                            02471018
024720     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    02472018
024730         GIVING PV-TOP-ITEM.                                      02473018
024740                                                                  02474018
024750     IF  ((PV-TOP-ITEM < +1)                                      02475018
024760       OR (PV-TOP-ITEM = +1))                                     02476018
024770         MOVE +1                   TO PV-TOP-ITEM                 02477018
024780*        -- TOP OF LIST --                                        02478018
024790         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            02479018
024800         SET DP020-MSG-INFORMATIONAL TO TRUE                      02480018
024810     END-IF.                                                      02481018
024820                                                                  02482018
024830*----------------------------------------------------------------*02483018
024840*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *02484018
024850*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *02485018
024860*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *02486018
024870*----------------------------------------------------------------*02487018
024880                                                                  02488018
024890 2120-BROWSE-FORWARD.                                             02489018
024900                                                                  02490018
024910     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              02491018
024920         GIVING PV-TOP-ITEM.                                      02492018
024930     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   02493018
024940         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            02494018
024950                                   TO PV-TOP-ITEM                 02495018
024960*        -- BOTTOM OF LIST --                                     02496018
024970         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            02497018
024980         SET DP020-MSG-INFORMATIONAL                              02498018
024990                                   TO TRUE                        02499018
025000     ELSE                                                         02500018
025010         COMPUTE PV-BOTTOM-ITEM =                                 02501018
025020             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 02502018
025030         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            02503018
025040*            -- BOTTOM OF LIST --                                 02504018
025050             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            02505018
025060             SET DP020-MSG-INFORMATIONAL                          02506018
025070                                   TO TRUE                        02507018
025080         END-IF                                                   02508018
025090     END-IF.                                                      02509018
025100                                                                  02510018
025110*----------------------------------------------------------------*02511018
025120*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *02512018
025130*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *02513018
025140*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *02514018
025150*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *02515018
025160*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *02516018
025170*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *02517018
025180*----------------------------------------------------------------*02518018
025190                                                                  02519018
025200 2130-CHECK-FOR-JUMP-BROWSE.                                      02520018
025210     SET PS-NO-ERROR               TO TRUE.                       02521018
025220     IF (ASC-START-ITEM-REQUEST = SPACE)                          02522018
025230         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            02523018
025240                                   TO PV-TOP-ITEM                 02524018
025250     ELSE                                                         02525018
025260         MOVE ASC-START-ITEM-REQUEST                              02526018
025270                                   TO DP010I-UNEDITED-FIELD       02527018
025280         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       02528018
025290         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     02529018
025300         SET DP010I-NEGATIVE-NOT-ALLOWED                          02530018
025310                                   TO TRUE                        02531018
025330         CALL DP010I-NUMERIC-EDIT-ROUTINE                         02533056
025331              USING DP010I-NUMERIC-EDIT-AREA                      02533156
025332                                                                  02533254
025340         IF  NOT DP010I-ERROR-DETECTED                            02534018
025350             MOVE DP010I-NUMERIC-FIELD                            02535018
025360                                   TO  ASC-START-ITEM-REQUEST-N   02536018
025370             IF  ASC-START-ITEM-REQUEST-N > ZERO                  02537018
025380                 IF  ASC-START-ITEM-REQUEST-N >                   02538018
025390                                          ASC-NUMBER-OF-ITEMS-READ02539018
025400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         02540018
025410                     COMPUTE PV-TOP-ITEM =                        02541018
025420                             ASC-NUMBER-OF-ITEMS-READ             02542018
025430                             - PC-ITEMS-PER-PANEL + 1             02543018
025440                     IF  PV-TOP-ITEM < +1                         02544018
025450                         MOVE +1   TO PV-TOP-ITEM                 02545018
025460                         MOVE PC-TSYMSG-00070                     02546018
025470                                   TO DP020-MSG-NUMBER            02547018
025480                         SET DP020-MSG-INFORMATIONAL              02548018
025490                                   TO TRUE                        02549018
025500                     END-IF                                       02550018
025510                 ELSE                                             02551018
025520                     MOVE ASC-START-ITEM-REQUEST-N                02552018
025530                                   TO PV-TOP-ITEM                 02553018
025540                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      02554018
025550                     COMPUTE PV-BOTTOM-ITEM =                     02555018
025560                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     02556018
025570                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ02557018
025580*                        -- BOTTOM OF LIST --                     02558018
025590                         MOVE PC-TSYMSG-00070                     02559018
025600                                   TO DP020-MSG-NUMBER            02560018
025610                         SET DP020-MSG-INFORMATIONAL              02561018
025620                                   TO TRUE                        02562018
025630                     END-IF                                       02563018
025640                 END-IF                                           02564018
025650             ELSE                                                 02565018
025660*                --- VALUE OUT OF RANGE ----                      02566018
025670                 MOVE PC-TSYMSG-00101                             02567018
025680                                   TO DP020-MSG-NUMBER            02568018
025690                 MOVE -1           TO ASTRTITL                    02569018
025700                 SET DP030-SET-CURSOR-APPL-1                      02570018
025710                                   TO TRUE                        02571018
025720                 MOVE DP015-REVERSE                               02572018
025730                                   TO ASTRTITH                    02573018
025740                 MOVE DP015-RED    TO ASTRTITC                    02574018
025750                 MOVE DP015-UNP-NUM-BRT-MDT                       02575018
025760                                   TO ASTRTITA                    02576018
025770                 SET DP020-MSG-FATAL                              02577018
025780                                   TO TRUE                        02578018
025790                 SET PS-ERROR      TO TRUE                        02579018
025800             END-IF                                               02580018
025810                                                                  02581018
025820         ELSE                                                     02582018
025830             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            02583018
025840             MOVE -1               TO ASTRTITL                    02584018
025850             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  02585018
025860             MOVE DP015-REVERSE    TO ASTRTITH                    02586018
025870             MOVE DP015-RED        TO ASTRTITC                    02587018
025880             MOVE DP015-UNP-NUM-BRT-MDT                           02588018
025890                                   TO ASTRTITA                    02589018
025900             SET DP020-MSG-FATAL   TO TRUE                        02590018
025910             SET PS-ERROR          TO TRUE                        02591018
025920         END-IF                                                   02592018
025930     END-IF.                                                      02593018
025940                                                                  02594018
025950*----------------------------------------------------------------*02595018
025960*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *02596018
025970*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *02597018
025980*----------------------------------------------------------------*02598018
025990 2140-DESELECT-ALL-ITEMS.                                         02599018
026000     MOVE +1                       TO ASC-BLK-SUB.                02600018
026010                                                                  02601018
026020     PERFORM 2141-CLEAR-SELECTED-INDS                             02602018
026030         VARYING ASC-ITEM-SUB                                     02603018
026040         FROM 1 BY 1                                              02604018
026050         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 02605018
026060                                                                  02606018
026070     ADD +1                        TO ASC-BLK-SUB.                02607018
026080                                                                  02608018
026090     PERFORM 2141-CLEAR-SELECTED-INDS                             02609018
026100         VARYING ASC-ITEM-SUB                                     02610018
026110         FROM 1 BY 1                                              02611018
026120         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 02612018
026130                                                                  02613018
026140     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               02614018
026150                                   TO PV-LIST-ITEM-NUMBER.        02615018
026160                                                                  02616018
026170     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            02617018
026180         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    02618018
026190                                                                  02619018
026200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     02620018
026210        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      02621018
026220         MOVE +1                   TO ASC-BLK-SUB                 02622018
026230                                                                  02623018
026240         PERFORM 5100-WRITE-TEMP-STORAGE                          02624018
026250                                                                  02625018
026260         MOVE +1                   TO PV-BLOCK-NUMBER             02626018
026270                                                                  02627018
026280         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         02628018
026290             PV-FIRST-BLOCK-IN-ARRAY - 1                          02629018
026300                                                                  02630018
026310         PERFORM                                                  02631018
026320             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       02632018
026330                                                                  02633018
026340             PERFORM 4410-READ-TEMP-STORAGE                       02634018
026350                                                                  02635018
026360             PERFORM 2141-CLEAR-SELECTED-INDS                     02636018
026370                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 02637018
026380                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          02638018
026390                                                                  02639018
026400             PERFORM 5100-WRITE-TEMP-STORAGE                      02640018
026410                                                                  02641018
026420             ADD +1                TO PV-BLOCK-NUMBER             02642018
026430                                                                  02643018
026440         END-PERFORM                                              02644018
026450                                                                  02645018
026460         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         02646018
026470             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     02647018
026480                                                                  02648018
026490         PERFORM                                                  02649018
026500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       02650018
026510                   ASC-HIGHEST-BLOCK-WRITTEN                      02651018
026520                                                                  02652018
026530             MOVE PV-NEXT-BLOCK-IN-ARRAY                          02653018
026540                                   TO PV-BLOCK-NUMBER             02654018
026550                                                                  02655018
026560             PERFORM 4410-READ-TEMP-STORAGE                       02656018
026570                                                                  02657018
026580             PERFORM 2141-CLEAR-SELECTED-INDS                     02658018
026590                 VARYING ASC-ITEM-SUB                             02659018
026600                 FROM 1 BY 1                                      02660018
026610                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          02661018
026620                                                                  02662018
026630             PERFORM 5100-WRITE-TEMP-STORAGE                      02663018
026640                                                                  02664018
026650             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      02665018
026660                                                                  02666018
026670         END-PERFORM                                              02667018
026680                                                                  02668018
026690         MOVE PV-FIRST-BLOCK-IN-ARRAY                             02669018
026700                                   TO PV-BLOCK-NUMBER             02670018
026710                                                                  02671018
026720         PERFORM 4410-READ-TEMP-STORAGE                           02672018
026730     END-IF.                                                      02673018
026740                                                                  02674018
026750                                                                  02675018
026760     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 02676018
026770     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.02677018
026780     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  02678018
026790                                                                  02679018
026800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        02680018
026810                                                                  02681018
026820*----------------------------------------------------------------*02682018
026830*    MARK EACH ITEM AS BEING NOT SELECTED.                       *02683018
026840*----------------------------------------------------------------*02684018
026850                                                                  02685018
026860 2141-CLEAR-SELECTED-INDS.                                        02686018
026870                                                                  02687018
026880     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           02688018
026890             NOT EQUAL ZERO                                       02689018
026900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          02690018
026910             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          02691018
026920                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    02692018
026930                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  02693018
026940                                   TO TRUE                        02694018
026950         END-IF                                                   02695018
026960     END-IF.                                                      02696018
026970                                                                  02697018
026980*----------------------------------------------------------------*02698018
026990*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *02699018
027000*  FOR ALL ITEMS.                                                *02700018
027010*----------------------------------------------------------------*02701018
027020                                                                  02702018
027030 2150-SELECT-ALL-ITEMS.                                           02703018
027040                                                                  02704018
027050     MOVE +1                       TO ASC-BLK-SUB.                02705018
027060                                                                  02706018
027070     PERFORM 2151-SET-SELECTED-INDS                               02707018
027080         VARYING ASC-ITEM-SUB                                     02708018
027090         FROM 1 BY 1                                              02709018
027100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 02710018
027110                                                                  02711018
027120     ADD +1                        TO ASC-BLK-SUB.                02712018
027130                                                                  02713018
027140     PERFORM 2151-SET-SELECTED-INDS                               02714018
027150         VARYING ASC-ITEM-SUB                                     02715018
027160         FROM 1 BY 1                                              02716018
027170         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 02717018
027180                                                                  02718018
027190     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               02719018
027200                                   TO PV-LIST-ITEM-NUMBER.        02720018
027210                                                                  02721018
027220     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            02722018
027230         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    02723018
027240                                                                  02724018
027250*10/13/00- BEGIN                                                  02725018
027260     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            02726018
027270         MOVE +1                   TO ASC-BLK-SUB                 02727018
027280                                                                  02728018
027290         PERFORM 5100-WRITE-TEMP-STORAGE                          02729018
027300         MOVE +2                   TO ASC-BLK-SUB                 02730018
027310         PERFORM 5100-WRITE-TEMP-STORAGE                          02731018
027320         MOVE +1                   TO ASC-BLK-SUB                 02732018
027330         MOVE +1                   TO PV-BLOCK-NUMBER             02733018
027340     END-IF.                                                      02734018
027350* 10/13/00 END                                                    02735018
027360     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     02736018
027370        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    02737018
027380         MOVE +1                   TO ASC-BLK-SUB                 02738018
027390                                                                  02739018
027400         PERFORM 5100-WRITE-TEMP-STORAGE                          02740018
027410                                                                  02741018
027420         MOVE +1                   TO PV-BLOCK-NUMBER             02742018
027430                                                                  02743018
027440         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         02744018
027450             PV-FIRST-BLOCK-IN-ARRAY - 1                          02745018
027460                                                                  02746018
027470         PERFORM                                                  02747018
027480             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       02748018
027490                                                                  02749018
027500             PERFORM 4410-READ-TEMP-STORAGE                       02750018
027510                                                                  02751018
027520             PERFORM 2151-SET-SELECTED-INDS                       02752018
027530                 VARYING ASC-ITEM-SUB                             02753018
027540                 FROM 1 BY 1                                      02754018
027550                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          02755018
027560                                                                  02756018
027570             PERFORM 5100-WRITE-TEMP-STORAGE                      02757018
027580                                                                  02758018
027590             ADD +1                TO PV-BLOCK-NUMBER             02759018
027600                                                                  02760018
027610         END-PERFORM                                              02761018
027620                                                                  02762018
027630         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         02763018
027640             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     02764018
027650                                                                  02765018
027660         PERFORM                                                  02766018
027670             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       02767018
027680                   ASC-HIGHEST-BLOCK-WRITTEN                      02768018
027690                                                                  02769018
027700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          02770018
027710                                   TO PV-BLOCK-NUMBER             02771018
027720                                                                  02772018
027730             PERFORM 4410-READ-TEMP-STORAGE                       02773018
027740                                                                  02774018
027750             PERFORM 2151-SET-SELECTED-INDS                       02775018
027760                 VARYING ASC-ITEM-SUB                             02776018
027770                 FROM 1 BY 1                                      02777018
027780                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          02778018
027790                                                                  02779018
027800             PERFORM 5100-WRITE-TEMP-STORAGE                      02780018
027810                                                                  02781018
027820             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      02782018
027830                                                                  02783018
027840         END-PERFORM                                              02784018
027850                                                                  02785018
027860         MOVE PV-FIRST-BLOCK-IN-ARRAY                             02786018
027870                                   TO PV-BLOCK-NUMBER             02787018
027880                                                                  02788018
027890         PERFORM 4410-READ-TEMP-STORAGE                           02789018
027900     END-IF.                                                      02790018
027910                                                                  02791018
027920                                                                  02792018
027930     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             02793018
027940                       ASC-NUMBER-OF-SELECTED-ITEMS.              02794018
027950                                                                  02795018
027960     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        02796018
027970                                                                  02797018
027980*----------------------------------------------------------------*02798018
027990*    MARK EACH ITEM AS BEING SELECTED.                           *02799018
028000*----------------------------------------------------------------*02800018
028010                                                                  02801018
028020 2151-SET-SELECTED-INDS.                                          02802018
028030                                                                  02803018
028040     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           02804018
028050             NOT EQUAL ZERO                                       02805018
028060         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             02806018
028070             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             02807018
028080                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        02808018
028090                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  02809018
028100                               TO  TRUE                           02810018
028110         END-IF                                                   02811018
028120     END-IF.                                                      02812018
028130                                                                  02813018
028140*----------------------------------------------------------------*02814018
028150*  SELECT THE ARRIVED TRIP STATUS ROW                            *02815018
028160*----------------------------------------------------------------*02816018
028170 2160-SELECT-TTRIPST.                                             02817018
028180                                                                  02818018
028190     PERFORM                                                      02819018
028200         WITH TEST AFTER                                          02820018
028210         VARYING PV-RETRY-COUNTER                                 02821018
028220         FROM 1 BY 1                                              02822018
028230         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               02823018
028240             OR (SQLCODE = +0)                                    02824018
028250             OR (SQLCODE = +100))                                 02825018
028260                                                                  02826018
028270         EXEC SQL                                                 02827018
028280             SELECT TRIP_STATUS_CDE                               02828018
028290              INTO  :TRIPST-TRIP-STATUS-CDE                       02829018
028300             FROM   TTRIPST B                                     02830018
028310        WHERE                                                     02831018
028320             B.TRIP_ID     = :DK-TRIP-ID                          02832018
028330          AND                                                     02833018
028340                TIMESTAMP(B.STATUS_DTE, B.STATUS_TME)             02834018
028350            IN                                                    02835018
028360                (SELECT                                           02836018
028370                       MAX(TIMESTAMP(A.STATUS_DTE, A.STATUS_TME)) 02837018
028380                 FROM   TTRIPST A                                 02838018
028390                 WHERE  A.TRIP_ID     = B.TRIP_ID )               02839018
028400         END-EXEC                                                 02840018
028410                                                                  02841018
028420         EVALUATE TRUE                                            02842018
028430             WHEN SQLCODE = +0                                    02843018
028440             WHEN SQLCODE = -904                                  02844018
028450             WHEN SQLCODE = -913                                  02845018
028460                 CONTINUE                                         02846018
028470                                                                  02847018
028480             WHEN SQLCODE = +100                                  02848018
028490                 SET PS-NO-AR-STATUS TO TRUE                      02849018
028500                                                                  02850018
028510             WHEN SQLWARN0 NOT = SPACES                           02851018
028520             WHEN SQLCODE < +0                                    02852018
028530             WHEN SQLCODE > +0                                    02853018
028540                 MOVE '2160-SELECT-TTRIPST'                       02854018
028550                                   TO DP013-PARAGRAPH             02855018
028560                 MOVE 'SELECT A ROW ON TTRIPST'                   02856018
028570                                   TO DP013-MESSAGE-TEXT(1)       02857018
028580                 MOVE SQLCA        TO DP013-SQLCA                 02858018
028590                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    02859018
028600                 MOVE DK-TRIP-ID   TO PV-DISPLAY-TRIP             02860018
028610                 STRING               DK-SCAC-ID '/'              02861018
028620                                      DK-ARRIVAL-DTE '/'          02862018
028630                                      DK-VEH-NBR '/'              02863018
028640                                      PV-DISPLAY-TRIP '/'         02864018
028650                 DELIMITED BY SIZE                                02865018
028660                                 INTO DP013-MESSAGE-TEXT(2)       02866018
028670                 SET DP013-DB2-ABEND                              02867018
028680                     DP013-XCTL-DISPLAY-RESTART TO TRUE           02868018
028690                 PERFORM DP013-0000-PROCESS-ABEND                 02869018
028700         END-EVALUATE                                             02870018
028710     END-PERFORM.                                                 02871018
028720                                                                  02872018
028730     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02873018
028740         SQLCODE NOT = +0                                         02874018
028750         MOVE '2160-SELECT-TTRIPST'                               02875018
028760                                   TO DP013-PARAGRAPH             02876018
028770         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              02877018
028780                                   TO DP013-MESSAGE-TEXT (1)      02878018
028790         MOVE 'TO SELECT A TTRIPST ROW'                           02879018
028800                                   TO DP013-MESSAGE-TEXT (2)      02880018
028810         MOVE SQLCA                TO DP013-SQLCA                 02881018
028820         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    02882018
028830         SET DP013-DB2-ABEND                                      02883018
028840             DP013-XCTL-DISPLAY-RESTART                           02884018
028850                                   TO TRUE                        02885018
028860         PERFORM DP013-0000-PROCESS-ABEND                         02886018
028870     END-IF.                                                      02887018
028880                                                                  02888018
028881*----------------------------------------------------------------*02888120
028882*    CHECK IF WE ARE CHECKING CURR OPER ON RECEIVER IF CASEPACK  *02888220
028883*    DOWNLOAD IS SELECTED                                        *02888320
028884*                                                                *02888420
028885*----------------------------------------------------------------*02888520
028886 2165-CHECK-FOR-CURR.                                             02888620
028887                                                                  02888720
028888     SET ASC-VALIDATE-CURR-OPER-NO  TO TRUE.                      02888820
028889                                                                  02888920
028890     EXEC SQL                                                     02889020
028891         SELECT FUNC_TXT                                          02889120
028892           INTO :PV-FUNC-TXT                                      02889220
028893           FROM  TKRPRPM                                          02889320
028894          WHERE LOC_ID            =  90                           02889420
028895            AND INTFC_SYS_CDE     = 'KHL'                         02889520
028896            AND SYS_PRC_FUNC_CDE  = 'RCVRCR'                      02889620
028897            AND FUNC_PRC_STAT_CDE = 'AC'                          02889720
028898      END-EXEC.                                                   02889820
028899                                                                  02889920
028900       EVALUATE TRUE                                              02890020
028901          WHEN SQLCODE = +0                                       02890120
028902               IF  PV-FUNC-TXT = 'Y'                              02890220
028903                   SET ASC-VALIDATE-CURR-OPER-YES TO TRUE         02890320
028904               ELSE                                               02890420
028905                   SET ASC-VALIDATE-CURR-OPER-NO  TO TRUE         02890520
028906               END-IF                                             02890620
028907                                                                  02890720
028908          WHEN SQLCODE = +100                                     02890820
028909          WHEN SQLCODE = -305                                     02890920
028912               SET ASC-VALIDATE-CURR-OPER-NO  TO TRUE             02891220
028913                                                                  02891320
028914          WHEN OTHER                                              02891420
028915              SET PS-ERROR    TO TRUE                             02891520
028916              MOVE '2165-CHECK-FOR-CURR     ' TO DP013-PARAGRAPH  02891620
028917              MOVE 'CHECKING PARM TABLE' TO DP013-MESSAGE-TEXT (1)02891720
028921              MOVE SQLCA   TO DP013-SQLCA                         02892120
028922              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         02892220
028923              SET DP013-DB2-ABEND                                 02892320
028924                  DP013-XCTL-DISPLAY-RESTART TO TRUE              02892420
028925              PERFORM DP013-0000-PROCESS-ABEND                    02892520
028926      END-EVALUATE.                                               02892620
028930                                                                  02893020
029560                                                                  02956018
029570******************************************************************02957018
029580** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **02958018
029590** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **02959018
029600******************************************************************02960018
029610 2200-MOVE-SCREEN-TO-COMMAREA.                                    02961018
029620                                                                  02962018
029630     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             02963018
029640     MOVE +1                       TO PV-SUB.                     02964018
029650                                                                  02965018
029660     PERFORM 3100-SET-SUBSCRIPTS.                                 02966018
029670     IF  ASTRTITL > ZERO                                          02967018
029680         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          02968018
029690     ELSE                                                         02969018
029700         IF  ASTRTITF = DP015-ERASE-EOF                           02970018
029710             INITIALIZE ASC-START-ITEM-REQUEST                    02971018
029720         END-IF                                                   02972018
029730     END-IF.                                                      02973018
029740                                                                  02974018
029750     IF APRTIDL > ZERO                                            02975018
029760         MOVE APRTIDI TO ASC-HDR-LBL-PRTID                        02976018
029770     ELSE                                                         02977018
029780         IF APRTIDF = DP015-ERASE-EOF                             02978018
029790             INITIALIZE ASC-HDR-LBL-PRTID                         02979018
029800         END-IF                                                   02980018
029810     END-IF.                                                      02981018
029820                                                                  02982018
029830     IF AINSTRL > ZERO                                            02983018
029840         MOVE AINSTRI                  TO ASC-HDR-LBL-INSTR       02984018
029850         SET PS-HDRLBL-FRMSCRN-YES     TO TRUE                    02985018
029860     ELSE                                                         02986018
029870         IF AINSTRF = DP015-ERASE-EOF                             02987018
029880             MOVE SPACES               TO ASC-HDR-LBL-INSTR       02988018
029890         END-IF                                                   02989018
029900         SET PS-HDRLBL-FRMSCRN-NO  TO TRUE                        02990018
029910     END-IF.                                                      02991018
029920                                                                  02992018
029930     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          02993018
029940         VARYING PV-SUB                                           02994018
029950         FROM 1 BY 1                                              02995018
029960         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      02996018
029970                                                                  02997018
029980******************************************************************02998018
029990** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**02999018
030000******************************************************************03000018
030010 2210-MOVE-LINES-TO-COMMAREA.                                     03001018
030020     IF  MR-SELECTL (PV-SUB) > ZERO                               03002018
030030         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             03003018
030040         MOVE MR-SELECTI (PV-SUB)                                 03004018
030050                                   TO ASC-TEMP-SELECTED-SW        03005018
030060                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      03006018
030070     ELSE                                                         03007018
030080         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                03008018
030090                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     03009018
030100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        03010018
030110                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      03011018
030120         END-IF                                                   03012018
030130     END-IF.                                                      03013018
030140     ADD +1                        TO ASC-ITEM-SUB.               03014018
030150                                                                  03015018
030160     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        03016018
030170         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     03017018
030180             COMPUTE PV-BLOCK-NUMBER  =                           03018018
030190                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         03019018
030200                    PC-ITEMS-PER-PANEL                            03020018
030210             PERFORM 5105-REWRITE-ASC-LISTQ                       03021018
030220         END-IF                                                   03022018
030230         ADD +1                    TO ASC-BLK-SUB                 03023018
030240         MOVE +1                   TO ASC-ITEM-SUB                03024018
030250                                                                  03025018
030260* DMH - 11-10-04 - BEGIN                                          03026018
030270         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 03027018
030280             MOVE +1               TO ASC-BLK-SUB                 03028018
030290         END-IF                                                   03029018
030300* DMH - 11-10-04 - END                                            03030018
030310                                                                  03031018
030320     ELSE                                                         03032018
030330     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             03033018
030340         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     03034018
030350             COMPUTE PV-BLOCK-NUMBER  =                           03035018
030360                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         03036018
030370                    PC-ITEMS-PER-PANEL                            03037018
030380             PERFORM 5105-REWRITE-ASC-LISTQ                       03038018
030390         END-IF                                                   03039018
030400     END-IF.                                                      03040018
030410*----------------------------------------------------------------*03041018
030420*    CREATE LABELS FOR ONE ASC BLOCK, IF SELECTED.               *03042018
030430*----------------------------------------------------------------*03043018
030440* DEAD CODE 1/24/2005                                             03044018
030450*2520-DO-ONE-ASC-BLK.                                             03045018
030460*                                                                 03046018
030470*    PERFORM 2650-HEADER-ITEMS                                    03047018
030480*        VARYING ASC-ITEM-SUB                                     03048018
030490*        FROM 1 BY 1                                              03049018
030500*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  03050018
030510*        OR NOT PC140-CRA-SUCCESSFUL.                             03051018
030520*                                                                 03052018
030530*    PERFORM 5100-WRITE-TEMP-STORAGE.                             03053018
030540*                                                                 03054018
030550*----------------------------------------------------------------*03055018
030560*    CREATE LABELS FOR SELECTED HEADER ITEMS.                    *03056018
030570*----------------------------------------------------------------*03057018
030580                                                                  03058018
030590 2650-HEADER-ITEMS.                                               03059018
030600                                                                  03060018
030610     MOVE LQW-PO-NBR (LQW-IDX)    TO DK-PO-NBR.                   03061018
030620     MOVE LQW-RECEIVER (LQW-IDX)  TO DK-REC-SEQ-NBR.              03062018
030630     MOVE ASC-KEY-OPER-UNT-ID     TO DK-OPER-UNT-ID.              03063018
030640     MOVE ASC-KEY-FCLTY-ID        TO DK-FCLTY-ID.                 03064018
030650     PERFORM 4380-GET-OPER-SET-DESC.                              03065018
030660     MOVE OPRSET-CNTL-DESC        TO DK-CNTL-DESC.                03066018
030670     MOVE ASC-TRIP-ID             TO DK-TRIP-ID.                  03067018
030680     PERFORM 1150-GET-ARRIVAL-DATE                                03068018
030690     IF  SQLCODE = -305                                           03069018
030700         MOVE '0001-01-01'  TO ASC-KEY-ARRIVAL-DTE                03070018
030710                               DK-ARRIVAL-DTE                     03071018
030720                               PV-DB2-DATE                        03072018
030730     ELSE                                                         03073018
030740         MOVE TRIPST-STATUS-DTE                                   03074018
030750                            TO ASC-KEY-ARRIVAL-DTE                03075018
030760                               DK-ARRIVAL-DTE                     03076018
030770                               PV-DB2-DATE                        03077018
030780     END-IF                                                       03078018
030790     STRING PV-DB2-DATE-MM                                        03079018
030800            PV-DB2-DATE-DD                                        03080018
030810            PV-DB2-DATE-YY DELIMITED BY SIZE                      03081018
030820                         INTO ASC-ARRIVAL-DTE                     03082018
030830     MOVE   PV-DB2-DATE-CC TO ASC-ARRIVAL-DTE-CC                  03083018
030840     PERFORM 7000-SETUP-HDR-LABELS-ASC.                           03084018
030850                                                                  03085018
030860*----------------------------------------------------------------*03086018
030870*    READ THE DB2 P.O. SPECIAL INSTRUCTION DATABASE              *03087018
030880*----------------------------------------------------------------*03088018
030890 2295-GET-PO-INSTRUCT.                                            03089018
030900                                                                  03090018
030910     INITIALIZE DCLTPOINST                                        03091018
030920                DCLTINSTCD.                                       03092018
030930                                                                  03093018
030940     PERFORM                                                      03094018
030950         WITH TEST AFTER                                          03095018
030960         VARYING PV-RETRY-COUNTER                                 03096018
030970         FROM 1 BY 1                                              03097018
030980         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03098018
030990            OR  (SQLCODE = ZERO)                                  03099018
031000            OR  (SQLCODE = +100)                                  03100018
031010            OR  (SQLCODE = -811))                                 03101018
031020                                                                  03102018
031030         EXEC SQL                                                 03103018
031040             SELECT                                               03104018
031050                     B.INSTR_DESC                                 03105018
031060               INTO  :INSTCD-INSTR-DESC                           03106018
031070               FROM  TPOINST A,                                   03107018
031080                     TINSTCD B                                    03108018
031090              WHERE  (A.PO_NBR     =  :DK-PO-NBR                  03109018
031100                AND   A.RECIP_CDE  =  'DC'                        03110018
031110                AND   A.INSTR_NBR  =  B.INSTR_NBR)                03111018
031120         END-EXEC                                                 03112018
031130                                                                  03113018
031140         EVALUATE TRUE                                            03114018
031150             WHEN SQLCODE = ZERO                                  03115018
031160                 MOVE INSTCD-INSTR-DESC                           03116018
031170                                     TO AINSTRO                   03117018
031180                                        ASC-HDR-LBL-INSTR         03118018
031190                                                                  03119018
031200             WHEN SQLCODE = -904                                  03120018
031210             WHEN SQLCODE = -913                                  03121018
031220                 CONTINUE                                         03122018
031230             WHEN SQLCODE = +100                                  03123018
031240                 MOVE SPACES         TO AINSTRO                   03124018
031250                                        ASC-HDR-LBL-INSTR         03125018
031260                                                                  03126018
031270             WHEN SQLCODE = -811                                  03127018
031280                 MOVE 'MULTIPLE SPEC INSTRUCTION'                 03128018
031290                                     TO AINSTRO                   03129018
031300                                        ASC-HDR-LBL-INSTR         03130018
031310             WHEN SQLWARN0 NOT = SPACES                           03131018
031320             WHEN SQLCODE < ZERO                                  03132018
031330             WHEN SQLCODE > ZERO                                  03133018
031340                  MOVE '2295-GET-PO-INSTRUCT'                     03134018
031350                                     TO DP013-PARAGRAPH           03135018
031360                  MOVE 'SELECT SPECIAL INSTRUCTIONS  KEYS = '     03136018
031370                                     TO DP013-MESSAGE-TEXT (1)    03137018
031380                  MOVE PV-PO-NBR TO PV-DISPLAY-ORD-NBR            03138018
031390                  MOVE PV-DISPLAY-ORD-NBR                         03139018
031400                                     TO DP013-MESSAGE-TEXT (2)    03140018
031410                  MOVE SQLCA         TO DP013-SQLCA               03141018
031420                  MOVE 'TPOINST'     TO DP013-DB2-TABLE-NAME (1)  03142018
031430                  MOVE 'TINSTCD'     TO DP013-DB2-TABLE-NAME (2)  03143018
031440                  SET DP013-DB2-ABEND                             03144018
031450                                     TO TRUE                      03145018
031460                  SET DP013-NO-ROLLBACK                           03146018
031470                                     TO TRUE                      03147018
031480                  PERFORM DP013-0000-PROCESS-ABEND                03148018
031490         END-EVALUATE                                             03149018
031500     END-PERFORM.                                                 03150018
031510                                                                  03151018
031520     IF  PV-RETRY-COUNTER  > PC-MAX-RETRIES                       03152018
031530         MOVE '2295-GET-PO-INSTRUCT'                              03153018
031540                                     TO DP013-PARAGRAPH           03154018
031550         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     03155018
031560                                     TO DP013-MESSAGE-TEXT (1)    03156018
031570         MOVE 'THE SPECIAL INSTRUCTIONS.  KEYS = '                03157018
031580                                     TO DP013-MESSAGE-TEXT (2)    03158018
031590         MOVE DK-PO-NBR              TO PV-DISPLAY-ORD-NBR        03159018
031600         MOVE PV-DISPLAY-ORD-NBR     TO DP013-MESSAGE-TEXT (3)    03160018
031610         MOVE SQLCA                  TO DP013-SQLCA               03161018
031620         MOVE 'TPOINST'              TO DP013-DB2-TABLE-NAME (1)  03162018
031630         MOVE 'TINSTCD'              TO DP013-DB2-TABLE-NAME (2)  03163018
031640         SET DP013-DB2-ABEND         TO TRUE                      03164018
031650         SET DP013-NO-ROLLBACK       TO TRUE                      03165018
031660         PERFORM DP013-0000-PROCESS-ABEND                         03166018
031670     END-IF.                                                      03167018
031680                                                                  03168018
031690*----------------------------------------------------------------*03169018
031700*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          03170018
031710*----------------------------------------------------------------*03171018
031720 2300-CALL-AUTOVE-MODULE.                                         03172018
031730                                                                  03173018
031740     INITIALIZE RC040-FIELDS.                                     03174018
031750     IF PS-DC-LEVEL-YES                                           03175018
031760        SET RC040-DC-LEVEL     TO TRUE                            03176018
031770     END-IF                                                       03177018
031780     MOVE DP020-LOCATION-NBR   TO RC040-SIGNON-LOCATION.          03178018
031790     MOVE PV-PO-NBR            TO RC040-PO-NBR                    03179018
031800     MOVE PV-RECEIVER          TO RC040-PO-RCVR                   03180018
031810     MOVE DP020-USERID         TO RC040-USER-ID.                  03181018
031820     MOVE 'RCKCS815'           TO RC040-CALLING-PROGRAM.          03182018
031830                                                                  03183018
031840     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  03184018
031850                                        RC040-COMMAREA            03185018
031860                                        RC040-FIELDS.             03186018
031870                                                                  03187018
031880     EVALUATE TRUE                                                03188018
031890         WHEN RC040-SUCCESSFUL                                    03189018
031900              CONTINUE                                            03190018
031910         WHEN RC040-DATABASE-BUSY OR                              03191018
031920              RC040-INVALID-SQL                                   03192018
031930                  MOVE PC-TSYMSG-00984  TO DP020-MSG-NUMBER       03193018
031940                  SET DP020-MSG-WARNING TO TRUE                   03194018
031950                  SET DP030-OVERRIDE-GO TO TRUE                   03195018
031960                  SET PS-ERROR          TO TRUE                   03196018
031970                                                                  03197018
031980                                                                  03198018
031990              INITIALIZE PV-CICS-MSG-AREA                         03199018
032000              STRING 'RCKCS815-'                                  03200018
032010                     '2300-CALL-AUTOVE-MODULE - '                 03201018
032020                                           DELIMITED BY SIZE      03202018
032030                                      INTO PV-CICS-MSG-AREA       03203018
032040              PERFORM 9900-WRITE-CICS-LOG                         03204018
032050                                                                  03205018
032060              INITIALIZE PV-CICS-MSG-AREA                         03206018
032070              STRING 'RCKCS815-'                                  03207018
032080                     RC040-CRA-RET-MSG                            03208018
032090                                           DELIMITED BY SIZE      03209018
032100                                      INTO PV-CICS-MSG-AREA       03210018
032110              PERFORM 9900-WRITE-CICS-LOG                         03211018
032120                                                                  03212018
032130                                                                  03213018
032140         WHEN RC040-NOT-SUCCESSFUL                                03214018
032150                  MOVE PC-TSYMSG-03138  TO DP020-MSG-NUMBER       03215018
032160                  SET DP020-MSG-WARNING TO TRUE                   03216018
032170                  SET DP030-OVERRIDE-GO TO TRUE                   03217018
032180                  SET PS-ERROR          TO TRUE                   03218018
032190                                                                  03219018
032200              INITIALIZE PV-CICS-MSG-AREA                         03220018
032210              STRING 'RCKCS815-'                                  03221018
032220                     '2300-CALL-AUTOVE-MODULE - '                 03222018
032230                                           DELIMITED BY SIZE      03223018
032240                                      INTO PV-CICS-MSG-AREA       03224018
032250              PERFORM 9900-WRITE-CICS-LOG                         03225018
032260                                                                  03226018
032270              INITIALIZE PV-CICS-MSG-AREA                         03227018
032280              STRING 'RCKCS815-'                                  03228018
032290                     RC040-CRA-RET-MSG                            03229018
032300                                           DELIMITED BY SIZE      03230018
032310                                      INTO PV-CICS-MSG-AREA       03231018
032320              PERFORM 9900-WRITE-CICS-LOG                         03232018
032330                                                                  03233018
032340         WHEN OTHER                                               03234018
032350                                                                  03235018
032360              INITIALIZE PV-CICS-MSG-AREA                         03236018
032370              STRING 'RCKCS815-'                                  03237018
032380                     '2300-CALL-AUTOVE-MODULE - '                 03238018
032390                                           DELIMITED BY SIZE      03239018
032400                                      INTO PV-CICS-MSG-AREA       03240018
032410              PERFORM 9900-WRITE-CICS-LOG                         03241018
032420                                                                  03242018
032430              INITIALIZE PV-CICS-MSG-AREA                         03243018
032440              STRING 'RCKCS815-'                                  03244018
032450                     RC040-CRA-RET-MSG                            03245018
032460                                           DELIMITED BY SIZE      03246018
032470                                      INTO PV-CICS-MSG-AREA       03247018
032480              PERFORM 9900-WRITE-CICS-LOG                         03248018
032490                                                                  03249018
032500             MOVE '2300-CALL-AUTOVE-MODULE' TO DP013-PARAGRAPH    03250018
032510             MOVE 'UNSUCCESSFUL CALL TO AUTO VE MOD'              03251018
032520                                         TO DP013-MESSAGE-TEXT (1)03252018
032530             MOVE RC040-SUCCESS-IND      TO DP013-MESSAGE-TEXT (2)03253018
032540             MOVE RC040-SQLCA            TO DP013-SQLCA           03254018
032550             SET DP013-DB2-ABEND                                  03255018
032560                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              03256018
032570             SET PS-ERROR                    TO TRUE              03257018
032580             PERFORM DP013-0000-PROCESS-ABEND                     03258018
032590                                                                  03259018
032600     END-EVALUATE.                                                03260018
032610/                                                                 03261018
032620******************************************************************03262018
032630** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **03263018
032640** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **03264018
032650******************************************************************03265018
032660 3000-EDIT-DATA-IN-COMMAREA.                                      03266018
032670     SET PS-NO-ERROR                                              03267018
032680         ASC-TRLR-UNLOADED                                        03268033
032681         ASC-OPER-MISMATCH-NO      TO TRUE.                       03268133
032690     PERFORM 3200-RESET-ATTRIBUTES.                               03269018
032700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     03270018
032710**                                                                03271018
032720* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              03272018
032730* EDITTING IS DONE FROM THE BOTTOM UP.                            03273018
032740**                                                                03274018
032750     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       03275018
032760         ASC-ITEMS-DISPLAYED - 1.                                 03276018
032770     PERFORM 3100-SET-SUBSCRIPTS.                                 03277018
032780                                                                  03278018
032790     IF  PS-NO-ERROR                                              03279018
032800         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        03280018
032810     END-IF.                                                      03281018
032820                                                                  03282018
032830     IF  PS-NO-ERROR                                              03283018
032840         PERFORM 3400-CHECK-RANGE-SEQUENCE                        03284018
032850     END-IF.                                                      03285018
032860                                                                  03286018
032870     IF  ((PS-NO-ERROR)                                           03287018
032880       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   03288018
032890       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    03289018
032900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  03290018
032910     END-IF.                                                      03291018
032920                                                                  03292018
032930     IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                    03293018
032940*        OR  DP020-FK-CONFIRM (DP020-SRC-AID)                     03294018
032950       IF ASC-UNLOAD-YES                                          03295018
032960         CONTINUE                                                 03296018
032970       ELSE                                                       03297018
032980         IF ASC-HDR-LBL-PRTID   = SPACES                          03298018
032990             SET PS-ERROR            TO TRUE                      03299018
033000             SET DP020-MSG-FATAL     TO TRUE                      03300018
033010             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          03301018
033020             MOVE DP015-UNP-ALP-BRT-OFF TO APRTIDA                03302018
033030             MOVE DP015-RED          TO APRTIDC                   03303018
033040             MOVE DP015-REVERSE      TO APRTIDH                   03304018
033050             MOVE -1                 TO APRTIDL                   03305018
033060             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  03306018
033070         ELSE                                                     03307018
033080             PERFORM 3245-EDIT-PRINTER-ID                         03308018
033090         END-IF                                                   03309018
033100       END-IF.                                                    03310018
033110                                                                  03311018
033120*----------------------------------------------------------------*03312018
033130*   3005-EDIT-COMMAREA-BLOCKS                                    *03313018
033140*----------------------------------------------------------------*03314018
033150 3005-EDIT-COMMAREA-BLOCKS.                                       03315018
033160     MOVE +1                       TO PV-BLOCK-NUMBER.            03316018
033170     MOVE +1                       TO ASC-BLK-SUB.                03317018
033180     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               03318018
033190                                                                  03319018
033200     COMPUTE PV-BLOCK-NUMBER  =                                   03320018
033210        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 03321018
033220            PC-ITEMS-PER-PANEL.                                   03322018
033230                                                                  03323018
033240     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          03324018
033250                                                                  03325018
033260     PERFORM                                                      03326018
033270       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          03327018
033280          OR PS-ERROR                                             03328018
033290          OR PS-BLOCK-ERROR                                       03329018
033300                                                                  03330018
033310             COMPUTE PV-ITEMS-HOLD  =                             03331018
033320                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        03332018
033330                     PC-ITEMS-PER-PANEL - 1                       03333018
033340                                                                  03334018
033350             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       03335018
033360                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               03336018
033370                     FROM  PV-ITEMS-HOLD                          03337018
033380                   GIVING  PV-ITEMS-DIFF                          03338018
033390                 SUBTRACT  PV-ITEMS-DIFF                          03339018
033400                     FROM  PC-ITEMS-PER-PANEL                     03340018
033410                   GIVING  PV-ITEMS-HOLD                          03341018
033420                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              03342018
033430                                              ASC-ITEM-SUB        03343018
033440                                              ASC-ITEMS-DISPLAYED 03344018
033450             ELSE                                                 03345018
033460                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              03346018
033470                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        03347018
033480             END-IF                                               03348018
033490                                                                  03349018
033500             PERFORM 3300-EDIT-SELECTIONS                         03350018
033510                     VARYING PV-SUB                               03351018
033520                        FROM PV-SUB BY -1                         03352018
033530                       UNTIL PV-SUB < +1                          03353018
033540                                                                  03354018
033550             MOVE +1               TO ASC-BLK-SUB                 03355018
033560                                                                  03356018
033570             PERFORM 5105-REWRITE-ASC-LISTQ                       03357018
033580                                                                  03358018
033590             MOVE +1                TO ASC-BLK-SUB                03359018
033600                                                                  03360018
033610             IF  PS-BLOCK-ERROR                                   03361018
033620                 SET  PS-ERROR     TO TRUE                        03362018
033630                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        03363018
033640                                   TO PV-TOP-ITEM                 03364018
033650             ELSE                                                 03365018
033660                 ADD  +1           TO PV-BLOCK-NUMBER             03366018
033670                 IF  PV-BLOCK-NUMBER >                            03367018
033680                     ASC-HIGHEST-BLOCK-WRITTEN                    03368018
033690                     MOVE +2       TO ASC-BLK-SUB                 03369018
033700                     PERFORM 4410-READ-TEMP-STORAGE               03370018
033710                     MOVE +1       TO ASC-BLK-SUB                 03371018
033720                 ELSE                                             03372018
033730                     PERFORM 4410-READ-TEMP-STORAGE               03373018
033740                     ADD  +1        TO PV-BLOCK-NUMBER            03374018
033750                     MOVE +2        TO ASC-BLK-SUB                03375018
033760                     PERFORM 4410-READ-TEMP-STORAGE               03376018
033770                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            03377018
033780                     MOVE +1        TO ASC-BLK-SUB                03378018
033790                 END-IF                                           03379018
033800             END-IF                                               03380018
033810     END-PERFORM.                                                 03381018
033820                                                                  03382018
033830     IF  PV-ORIGINAL-BLOCK  = +1    OR                            03383018
033840         PS-ERROR                   OR                            03384018
033850         PS-BLOCK-ERROR                                           03385018
033860         CONTINUE                                                 03386018
033870     ELSE                                                         03387018
033880         MOVE +1                 TO PV-BLOCK-NUMBER               03388018
033890         MOVE +1                 TO ASC-BLK-SUB                   03389018
033900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  03390018
033910         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           03391018
033920         PERFORM 4410-READ-TEMP-STORAGE                           03392018
033930                                                                  03393018
033940         PERFORM                                                  03394018
033950           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              03395018
033960              OR PS-ERROR                                         03396018
033970              OR PS-BLOCK-ERROR                                   03397018
033980                                                                  03398018
033990                 COMPUTE PV-ITEMS-HOLD  =                         03399018
034000                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    03400018
034010                         PC-ITEMS-PER-PANEL - 1                   03401018
034020                                                                  03402018
034030                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     03403018
034040                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           03404018
034050                         FROM  PV-ITEMS-HOLD                      03405018
034060                       GIVING  PV-ITEMS-DIFF                      03406018
034070                     SUBTRACT  PV-ITEMS-DIFF                      03407018
034080                         FROM  PC-ITEMS-PER-PANEL                 03408018
034090                       GIVING  PV-ITEMS-HOLD                      03409018
034100                         MOVE  PV-ITEMS-HOLD TO PV-SUB            03410018
034110                                                ASC-ITEM-SUB      03411018
034120                                               ASC-ITEMS-DISPLAYED03412018
034130                 ELSE                                             03413018
034140                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          03414018
034150                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    03415018
034160                 END-IF                                           03416018
034170                                                                  03417018
034180                 PERFORM 3300-EDIT-SELECTIONS                     03418018
034190                         VARYING PV-SUB                           03419018
034200                            FROM PV-SUB BY -1                     03420018
034210                           UNTIL PV-SUB < +1                      03421018
034220                                                                  03422018
034230                 MOVE +1               TO ASC-BLK-SUB             03423018
034240                                                                  03424018
034250                 PERFORM 5105-REWRITE-ASC-LISTQ                   03425018
034260                                                                  03426018
034270                 MOVE +1                TO ASC-BLK-SUB            03427018
034280                                                                  03428018
034290                 IF  PS-BLOCK-ERROR                               03429018
034300                     SET  PS-ERROR     TO TRUE                    03430018
034310                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    03431018
034320                                       TO PV-TOP-ITEM             03432018
034330                 ELSE                                             03433018
034340                     ADD  +1            TO PV-BLOCK-NUMBER        03434018
034350                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      03435018
034360                         MOVE +2        TO ASC-BLK-SUB            03436018
034370                         PERFORM 4410-READ-TEMP-STORAGE           03437018
034380                         MOVE +1        TO ASC-BLK-SUB            03438018
034390                     ELSE                                         03439018
034400                         PERFORM 4410-READ-TEMP-STORAGE           03440018
034410                         ADD  +1        TO PV-BLOCK-NUMBER        03441018
034420                         MOVE +2        TO ASC-BLK-SUB            03442018
034430                         PERFORM 4410-READ-TEMP-STORAGE           03443018
034440                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        03444018
034450                         MOVE +1        TO ASC-BLK-SUB            03445018
034460                     END-IF                                       03446018
034470                 END-IF                                           03447018
034480     END-PERFORM.                                                 03448018
034490******************************************************************03449018
034500* ****************************************************************03450018
034510*----------------------------------------------------------------*03451018
034520*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *03452018
034530*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*03453018
034540*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *03454018
034550*                                                                *03455018
034560*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *03456018
034570*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *03457018
034580*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *03458018
034590*    US IN THE 2ND BLOCK OF THE ARRAY.                           *03459018
034600*----------------------------------------------------------------*03460018
034610                                                                  03461018
034620 3100-SET-SUBSCRIPTS.                                             03462018
034630                                                                  03463018
034640     COMPUTE ASC-ITEM-SUB =                                       03464018
034650         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        03465018
034660                                                                  03466018
034661* DMH BEGIN - 10/29/19                                            03466118
034662     IF  ASC-ITEM-SUB  < +1                                       03466218
034663         MOVE +1                      TO ASC-ITEM-SUB.            03466318
034664* DMH END   - 10/29/19                                            03466418
034665                                                                  03466518
034666     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         03466618
034667         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            03466718
034668                                                                  03466818
034669         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               03466918
034670     ELSE                                                         03467018
034680         MOVE +1                     TO ASC-BLK-SUB               03468018
034690     END-IF.                                                      03469018
034700******************************************************************03470018
034710** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **03471018
034720******************************************************************03472018
034730                                                                  03473018
034740 3200-RESET-ATTRIBUTES.                                           03474018
034750     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    03475018
034760                                      APRTIDA.                    03476018
034770     MOVE DP015-GREEN              TO ASTRTITC                    03477018
034780                                      APRTIDC.                    03478018
034790     MOVE DP015-UNDERLINE          TO ASTRTITH                    03479018
034800                                      APRTIDH.                    03480018
034810                                                                  03481018
034820     PERFORM                                                      03482018
034830         VARYING PV-SUB                                           03483018
034840         FROM 1 BY 1                                              03484018
034850         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        03485018
034860         MOVE DP015-UNP-ALP-NOR-OFF                               03486018
034870                                   TO MR-SELECTA (PV-SUB)         03487018
034880         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         03488018
034890         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         03489018
034900     END-PERFORM.                                                 03490018
034910*----------------------------------------------------------------*03491018
034920*    CHECK THE PRINTER NUMBER FOR NUMERIC                        *03492018
034930*----------------------------------------------------------------*03493018
034940                                                                  03494018
034950 3245-EDIT-PRINTER-ID.                                            03495018
034960                                                                  03496018
034970     MOVE ASC-HDR-LBL-PRTID      TO DP010I-UNEDITED-FIELD.        03497018
034980     MOVE LENGTH OF ASC-HDR-LBL-PRTID                             03498018
034990                                 TO DP010I-MAXIMUM-DIGITS.        03499018
035000     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      03500018
035010                                                                  03501018
035020     SET DP010I-NEGATIVE-NOT-ALLOWED                              03502018
035030                                 TO TRUE.                         03503018
035040                                                                  03504018
035052     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03505256
035053          USING DP010I-NUMERIC-EDIT-AREA.                         03505356
035060                                                                  03506018
035070     IF DP010I-ERROR-DETECTED                                     03507018
035080         SET PS-ERROR            TO TRUE                          03508018
035090         SET DP020-MSG-FATAL     TO TRUE                          03509018
035100         MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER              03510018
035110         MOVE DP015-UNP-ALP-BRT-OFF                               03511018
035120                                 TO APRTIDA                       03512018
035130         MOVE DP015-RED          TO APRTIDC                       03513018
035140         MOVE DP015-REVERSE      TO APRTIDH                       03514018
035150         MOVE -1                 TO APRTIDL                       03515018
035160         SET DP030-SET-CURSOR-APPL-1                              03516018
035170                                 TO TRUE                          03517018
035180     ELSE                                                         03518018
035190         MOVE DP010I-NUMERIC-FIELD                                03519018
035200                                 TO ASC-HDR-LBL-PRTID-N           03520018
035210         PERFORM 3270-VALIDATE-PRINTER-ID                         03521018
035220         MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID              03522018
035230         PERFORM 3600-GET-DC-LOCATION                             03523018
035240     END-IF.                                                      03524018
035250                                                                  03525018
035260*----------------------------------------------------------------*03526018
035270*  GET PACKAGE TYPE CODE FOR PO-RCVR                             *03527018
035280*----------------------------------------------------------------*03528018
035290 3250-GET-PKG-TYP-CDE.                                            03529018
035300                                                                  03530018
035310     IF DK-REC-SEQ-NBR = ZERO                                     03531018
035320         EXEC SQL                                                 03532018
035330              SELECT   PKGNG_CDE                                  03533018
035331                     , 0                                          03533125
035340                INTO  :ASC-PKGNG-CD                               03534025
035341                     ,:PV-RCVR-CURR-OPER                          03534125
035350                FROM TPURCHS                                      03535018
035360              WHERE VER_STATUS_CDE = 'A'                          03536018
035370                   AND PO_NBR  = :DK-PO-NBR                       03537018
035380         END-EXEC                                                 03538018
035390     ELSE                                                         03539018
035400         EXEC SQL                                                 03540018
035410              SELECT   PKGNG_CDE                                  03541018
035420                     , STATUS_CDE                                 03542018
035421                     , CURR_OPER_UNT_ID                           03542125
035430                INTO  :ASC-PKGNG-CD                               03543025
035440                     ,:PV-PO-STATUS                               03544025
035441                     ,:PV-RCVR-CURR-OPER                          03544125
035450                FROM TRECEIV                                      03545018
035460               WHERE ORD_NBR       =  :DK-PO-NBR                  03546018
035470                 AND REC_SEQ_NBR   =  :DK-REC-SEQ-NBR             03547018
035480         END-EXEC.                                                03548018
035490                                                                  03549018
035500     EVALUATE TRUE                                                03550018
035510         WHEN SQLCODE = ZERO                                      03551018
035520              IF DK-REC-SEQ-NBR = ZERO                            03552018
035530                  MOVE 'IP'        TO PV-PO-STATUS                03553018
035540              END-IF                                              03554018
035550              SET PS-PBS-PACK-TYPE-NO TO TRUE                     03555018
035560              IF  ASC-INNER-PREPK                                 03556018
035570                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03557018
035580              ELSE                                                03558018
035590              IF  ASC-MULTI-SKU-PREPK                             03559018
035600                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03560018
035610              ELSE                                                03561018
035620              IF  ASC-SINGLE-SKU-PREPK                            03562018
035630                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03563018
035640              ELSE                                                03564018
035650              IF  ASC-CASEPACK                                    03565018
035660                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03566018
035670              ELSE                                                03567018
035680              IF  ASC-BULK-PACK                                   03568018
035690                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03569018
035700              END-IF                                              03570018
035710              IF  ASC-PBS                                         03571018
035720                  SET PS-PBS-PACK-TYPE-YES TO TRUE                03572018
035730                  MOVE ASC-PKGNG-CD  TO PV-PACK-TYPE              03573018
035740              END-IF                                              03574018
035750              END-IF                                              03575018
035760              END-IF                                              03576018
035770              END-IF                                              03577018
035780              END-IF                                              03578018
035790         WHEN SQLCODE = +100                                      03579018
035800              SET PS-PBS-PACK-TYPE-NO TO TRUE                     03580018
035810              MOVE 'F'               TO PV-PACK-TYPE              03581018
035820         WHEN SQLWARN0 NOT = SPACES                               03582018
035830         WHEN SQLCODE < ZERO                                      03583018
035840         WHEN SQLCODE > ZERO                                      03584018
035850              MOVE '3250-GET-PKG-TYP-CDE'                         03585018
035860                                  TO DP013-PARAGRAPH              03586018
035870              MOVE 'SELECT PACKAGING TYPE CODE  '                 03587018
035880                                  TO DP013-MESSAGE-TEXT (1)       03588018
035890              MOVE DK-PO-NBR  TO PV-ERROR-PO                      03589018
035900              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 03590018
035910              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         03591018
035920              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       03592018
035930              MOVE SQLCA          TO DP013-SQLCA                  03593018
035940              MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)     03594018
035950              SET DP013-DB2-ABEND TO TRUE                         03595018
035960              SET DP013-XCTL-DISPLAY-RESTART TO TRUE              03596018
035970              PERFORM DP013-0000-PROCESS-ABEND                    03597018
035980     END-EVALUATE.                                                03598018
035990                                                                  03599018
036000                                                                  03600018
036010*----------------------------------------------------------------*03601018
036020*   3270-VALIDATE-PRINTER-ID                                     *03602018
036030* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                      *03603018
036040*----------------------------------------------------------------*03604018
036050                                                                  03605018
036060 3270-VALIDATE-PRINTER-ID.                                        03606018
036070*  VALIDATE THE PRINTER ID BASED ON THE PHYSICAL LOCATION         03607018
036080*  OF THE TERMINAL.                                               03608018
036090                                                                  03609018
036100     MOVE ASC-HDR-LBL-PRTID          TO DP072-PRINTER-ID.         03610018
036110     MOVE PC-REPORT-PROGRAM-NAME     TO DP072-RPT-PGM-NME.        03611018
036120     MOVE '01'                       TO DP072-RPT-PGM-TYP-ID.     03612018
036130     MOVE ASC-KEY-OPER-UNT-ID        TO DP072-ORIGIN-OPER-UNT-ID  03613018
036140                                        DP072-OPER-UNT-ID.        03614018
036150     MOVE ASC-KEY-FCLTY-ID           TO DP072-ORIGIN-FCLTY-ID     03615018
036160                                        DP072-FCLTY-ID.           03616018
036170                                                                  03617018
036180     SET DP072-VALIDATE              TO TRUE.                     03618018
036190                                                                  03619018
036200     EXEC CICS                                                    03620018
036210         LINK PROGRAM  (PC-DPKCS060)                              03621018
036220              COMMAREA (DP072-COMM-AREA)                          03622018
036230              RESP     (PV-CICS-RESP)                             03623018
036240     END-EXEC.                                                    03624018
036250                                                                  03625018
036260     EVALUATE TRUE                                                03626018
036270         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     03627018
036280             CONTINUE                                             03628018
036290         WHEN OTHER                                               03629018
036300               MOVE '3270-VALIDATE-PRINTER-ID'                    03630018
036310                                     TO DP013-PARAGRAPH           03631018
036320               MOVE PV-CICS-RESP                                  03632018
036330                    TO DP013-MESSAGE-TEXT(1)                      03633018
036340               MOVE SQLCA            TO DP013-SQLCA               03634018
036350               SET DP013-CICS-ABEND                               03635018
036360                   DP013-NO-ROLLBACK TO TRUE                      03636018
036370               PERFORM DP013-0000-PROCESS-ABEND                   03637018
036380     END-EVALUATE.                                                03638018
036390                                                                  03639018
036400     IF DP072-PRTR-PRTR-TRK-STAT-CDE =  'A'                       03640018
036410         CONTINUE                                                 03641018
036420     ELSE                                                         03642018
036430         MOVE PC-TSYMSG-00746        TO DP020-MSG-NUMBER          03643018
036440         SET PS-ERROR                                             03644018
036450             DP020-MSG-FATAL                                      03645018
036460             DP030-SET-CURSOR-APPL-1 TO TRUE                      03646018
036470                                                                  03647018
036480         MOVE DP015-UNP-ALP-BRT-OFF  TO APRTIDA                   03648018
036490         MOVE DP015-RED              TO APRTIDC                   03649018
036500         MOVE DP015-REVERSE          TO APRTIDH                   03650018
036510         MOVE -1                     TO APRTIDL                   03651018
036520     END-IF.                                                      03652018
036530                                                                  03653018
036540                                                                  03654018
036550******************************************************************03655018
036560** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **03656018
036570** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **03657018
036580** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **03658018
036590** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **03659018
036600******************************************************************03660018
036610 3300-EDIT-SELECTIONS.                                            03661018
036620     EVALUATE TRUE                                                03662018
036630         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     03663018
036640             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         03664018
036650                 CONTINUE                                         03665018
036660         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         03666018
036670             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        03667018
036680                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   03668018
036690                 MOVE ASC-TEMP-SELECTED-SW                        03669018
036700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  03670018
036710                                TO ASC-SELECTED-SW                03671018
036720                                      (ASC-BLK-SUB ASC-ITEM-SUB)  03672018
036730             END-IF                                               03673018
036740         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     03674018
036750                 = SPACE                                          03675018
036760             EVALUATE TRUE                                        03676018
036770                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       03677018
036780                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS03678018
036790                     MOVE SPACE TO ASC-SELECTED-SW                03679018
036800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  03680018
036810                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        03681018
036820                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    03682018
036830                     MOVE SPACE TO ASC-SELECTED-SW                03683018
036840                                      (ASC-BLK-SUB ASC-ITEM-SUB)  03684018
036850                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          03685018
036860                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      03686018
036870                     MOVE SPACE TO ASC-SELECTED-SW                03687018
036880                                      (ASC-BLK-SUB ASC-ITEM-SUB)  03688018
036890             END-EVALUATE                                         03689018
036900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           03690018
036910             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            03691018
036920                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    03692018
036930             END-IF                                               03693018
036940             PERFORM 3310-EDIT-RANGE                              03694018
036950         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             03695018
036960             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            03696018
036970                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    03697018
036980             END-IF                                               03698018
036990             PERFORM 3310-EDIT-RANGE                              03699018
037000         WHEN OTHER                                               03700018
037010             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           03701018
037020             SET DP020-MSG-FATAL    TO TRUE                       03702018
037030             MOVE -1                TO MR-SELECTL (PV-SUB)        03703018
037040             SET DP030-SET-CURSOR-APPL-1                          03704018
037050                                    TO TRUE                       03705018
037060             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        03706018
037070             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        03707018
037080             SET PS-ERROR TO TRUE                                 03708018
037090             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            03709018
037100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     03710018
037110                 MOVE SPACE         TO ASC-SELECTED-SW            03711018
037120                                        (ASC-BLK-SUB ASC-ITEM-SUB)03712018
037130             END-IF                                               03713018
037140     END-EVALUATE.                                                03714018
037150                                                                  03715018
037160     IF PS-NO-ERROR                                               03716018
037170        IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 03717018
037180          IF  DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID) OR           03718018
037190              DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID) OR           03719018
037200              DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) OR           03720018
037210              DP020-FK-CONFIRM       (DP020-SRC-AID)              03721018
037220             IF (ASC-PO-IND  (ASC-BLK-SUB ASC-ITEM-SUB) =  'Y'    03722018
037230                 AND  ASC-REC-ATCHD-TRLR-NO                       03723018
037240                                       (ASC-BLK-SUB ASC-ITEM-SUB) 03724018
037250                 AND  ASC-REC-TRNSCRBD-NO                         03725018
037260                                      (ASC-BLK-SUB ASC-ITEM-SUB)) 03726018
037270                 SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     03727018
037280                                      TO TRUE                     03728018
037290                 SET ASC-FA-ACCESS-NO    TO TRUE                  03729018
037300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     03730018
037310             ELSE                                                 03731018
037320               IF (ASC-PO-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y'    03732018
037330                    AND  ASC-AUTO-VE-NO                           03733018
037340                                     (ASC-BLK-SUB ASC-ITEM-SUB))  03734018
037350                  SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    03735018
037360                                          TO TRUE                 03736018
037370                  SET ASC-FA-ACCESS-NO    TO TRUE                 03737018
037380                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    03738018
037390               ELSE                                               03739018
037400                  IF (ASC-PO-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y' 03740018
037410                      AND  ASC-FACILITY-AUTOVE-NO)                03741018
037420                                                                  03742018
037430                    SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)  03743018
037440                                            TO TRUE               03744018
037450                    SET ASC-FA-ACCESS-NO    TO TRUE               03745018
037460                    SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS  03746018
037470                  END-IF                                          03747018
037480               END-IF                                             03748018
037490              END-IF                                              03749018
037500            END-IF                                                03750018
037510        END-IF                                                    03751018
037520      END-IF                                                      03752018
037530                                                                  03753018
037540     IF PS-NO-ERROR                                               03754018
037550        IF DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) AND             03755018
037560            ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 03756018
037570            IF ASC-PACK-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) =  ' '    03757018
037580               SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       03758018
037590                                     TO TRUE                      03759018
037600               SET ASC-PBS-YES       TO TRUE                      03760018
037610               SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       03761018
037620            END-IF                                                03762018
037630        END-IF                                                    03763018
037640     END-IF                                                       03764018
037651                                                                  03765140
037652* 08/10/20 - DMH - BEGIN                                          03765240
037653     IF PS-NO-ERROR                                               03765340
037654        IF  DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) AND            03765440
037655            ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 03765540
037656            IF ASC-KEY-OPER-UNT-ID  NOT =                         03765640
037657               ASC-CURR-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)    03765740
037658               MOVE ASC-CURR-OPER-UNT-ID                          03765840
037659                        (ASC-BLK-SUB ASC-ITEM-SUB)                03765940
037660                                      TO DP020-MSG-TEXT           03766040
037661               SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       03766140
037662                                         TO TRUE                  03766240
037668               SET ASC-OPER-MISMATCH  TO TRUE                     03766840
037672               SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       03767240
037674            END-IF                                                03767440
037675        END-IF                                                    03767540
037676     END-IF                                                       03767640
037677* 08/10/20 - DMH - END                                            03767740
037678                                                                  03767840
037679     IF PS-NO-ERROR                                               03767918
037680        IF (DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) OR             03768018
037681           DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)) AND            03768118
037690            ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 03769018
037700            IF ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = 99999999   03770018
037710               SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       03771018
037720                                         TO TRUE                  03772018
037730               SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       03773018
037740            END-IF                                                03774018
037750        END-IF                                                    03775018
037760     END-IF                                                       03776018
037770                                                                  03777018
037780* 11/10/04 - DMH - BEGIN                                          03778018
037790     IF PS-NO-ERROR                                               03779018
037800        IF  DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) AND            03780018
037810            ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 03781018
037820            IF ASC-RECEIVER (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO     03782018
037830               SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       03783036
037840                                         TO TRUE                  03784036
037850               SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS       03785018
037860            END-IF                                                03786018
037870        END-IF                                                    03787018
037880     END-IF                                                       03788018
037890* 11/10/04 - DMH - END                                            03789018
037926                                                                  03792623
037927                                                                  03792723
037928     IF PS-NO-ERROR                                               03792823
037929        IF  DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                03792923
037930            IF ASC-PO-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y'        03793018
037940                 SET ASC-FREE-ASTRAY TO TRUE                      03794018
037950            ELSE                                                  03795018
037960                IF ASC-ACTL-CART-COUNT (ASC-BLK-SUB ASC-ITEM-SUB) 03796018
037970                                                      = ZEROES    03797018
037980                    PERFORM 3320-UNLOAD-CHK                       03798018
037990                END-IF                                            03799018
038000            END-IF                                                03800018
038010        END-IF                                                    03801018
038020     END-IF                                                       03802018
038030                                                                  03803018
038040     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 03804018
038050     SUBTRACT +1 FROM ASC-ITEM-SUB.                               03805018
038060     IF  ASC-ITEM-SUB < 1                                         03806018
038070         SUBTRACT +1 FROM ASC-BLK-SUB                             03807018
038080         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                03808018
038090     END-IF.                                                      03809018
038100******************************************************************03810018
038110** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **03811018
038120** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **03812018
038130** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**03813018
038140** THE ENDING.                                                  **03814018
038150******************************************************************03815018
038160 3310-EDIT-RANGE.                                                 03816018
038170     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                03817018
038180         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   03818018
038190             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)03819018
038200                                   TO ASC-SELECTED-SW             03820018
038210                                        (ASC-BLK-SUB ASC-ITEM-SUB)03821018
038220             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 03822018
038230         ELSE                                                     03823018
038240             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     03824018
038250                 CONTINUE                                         03825018
038260             ELSE                                                 03826018
038270*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        03827018
038280                 MOVE PC-TSYMSG-00054                             03828018
038290                                   TO DP020-MSG-NUMBER            03829018
038300                 SET DP020-MSG-FATAL                              03830018
038310                                   TO TRUE                        03831018
038320                 MOVE -1           TO MR-SELECTL (PV-SUB)         03832018
038330                 SET DP030-SET-CURSOR-APPL-1                      03833018
038340                                   TO TRUE                        03834018
038350                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         03835018
038360                 MOVE DP015-UNDERLINE                             03836018
038370                                   TO MR-SELECTH (PV-SUB)         03837018
038380                 SET PS-ERROR      TO TRUE                        03838018
038390             END-IF                                               03839018
038400         END-IF                                                   03840018
038410     ELSE                                                         03841018
038420         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     03842018
038430             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 03843018
038440                                   TO ASC-SELECTED-SW             03844018
038450                                     (ASC-BLK-SUB ASC-ITEM-SUB)   03845018
038460             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   03846018
038470         ELSE                                                     03847018
038480             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       03848018
038490                 CONTINUE                                         03849018
038500             ELSE                                                 03850018
038510*                -- ONLY ONE END-OF-RANGE ALLOWED --              03851018
038520                 MOVE PC-TSYMSG-00055                             03852018
038530                                   TO DP020-MSG-NUMBER            03853018
038540                 SET DP020-MSG-FATAL                              03854018
038550                                   TO TRUE                        03855018
038560                 MOVE -1           TO MR-SELECTL (PV-SUB)         03856018
038570                 SET DP030-SET-CURSOR-APPL-1                      03857018
038580                                   TO TRUE                        03858018
038590                 SET PS-ERROR      TO TRUE                        03859018
038600             END-IF                                               03860018
038610         END-IF                                                   03861018
038620     END-IF.                                                      03862018
038630                                                                  03863018
038640 3320-UNLOAD-CHK.                                                 03864018
038650     PERFORM 3322-CHECK-RCVR-CLERK                                03865018
038660     IF RECEIV-RCVG-CLERK-INIT-ID = SPACES                        03866018
038670         SET ASC-TRLR-NOT-UNLOADED TO TRUE                        03867018
038680     ELSE                                                         03868018
038690         SET ASC-ACTL-COUNT-ZERO   TO TRUE                        03869018
038700     END-IF.                                                      03870018
038710     IF ASC-TRLR-NOT-UNLOADED                                     03871018
038720**  UPDATE OF RECEIPT INFO NOT COMPLETED FOR THIS TRLR  **        03872018
038730         SET DP030-OVERRIDE-GO     TO TRUE                        03873018
038740         SET PS-ERROR              TO TRUE                        03874018
038750         MOVE PC-TSYMSG-00416      TO DP020-MSG-NUMBER            03875018
038760         SET DP020-MSG-WARNING     TO TRUE                        03876018
038770         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     03877018
038780     END-IF.                                                      03878018
038790*----------------------------------------------------------------*03879018
038800*  CHECK FOR RCVR CLERK INITIALS.                                *03880018
038810*----------------------------------------------------------------*03881018
038820 3322-CHECK-RCVR-CLERK.                                           03882018
038830     MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) TO DK-PO-NBR.     03883018
038840     MOVE ASC-RECEIVER (ASC-BLK-SUB ASC-ITEM-SUB)                 03884018
038850                                                TO DK-REC-SEQ-NBR.03885018
038860                                                                  03886018
038870         EXEC SQL                                                 03887018
038880                SELECT RCVG_CLERK_INIT_ID                         03888018
038890                INTO  :RECEIV-RCVG-CLERK-INIT-ID                  03889018
038900                FROM    TRECEIV                                   03890018
038910                WHERE   ORD_NBR        = :DK-PO-NBR               03891018
038920                  AND   REC_SEQ_NBR    = :DK-REC-SEQ-NBR          03892018
038930                  AND   VER_STATUS_CDE = 'A'                      03893018
038940         END-EXEC                                                 03894018
038950                                                                  03895018
038960         EVALUATE TRUE                                            03896018
038970             WHEN SQLCODE = ZERO                                  03897018
038980                  CONTINUE                                        03898018
038990             WHEN SQLCODE = +100                                  03899018
039000                  MOVE SPACES TO RECEIV-RCVG-CLERK-INIT-ID        03900018
039010             WHEN SQLWARN0 NOT = SPACE                            03901018
039020             WHEN SQLCODE NOT = ZERO                              03902018
039030                  MOVE '3322-CHECK-RCVR-CLERK ' TO DP013-PARAGRAPH03903018
039040                  MOVE 'SELECT RCVG CLERK INIT'                   03904018
039050                                         TO DP013-MESSAGE-TEXT (1)03905018
039060                  MOVE DK-PO-NBR      TO PV-ERROR-PO              03906018
039070                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             03907018
039080                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   03908018
039090                  MOVE SQLCA          TO DP013-SQLCA              03909018
039100                  SET DP013-DB2-ABEND TO TRUE                     03910018
039110                  PERFORM DP013-0000-PROCESS-ABEND                03911018
039120         END-EVALUATE.                                            03912018
039130                                                                  03913018
039140******************************************************************03914018
039150** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **03915018
039160** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **03916018
039170******************************************************************03917018
039180 3400-CHECK-RANGE-SEQUENCE.                                       03918018
039190     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       03919018
039200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      03920018
039210       AND  ASC-START-OF-SELECTED-RANGE >                         03921018
039220                                         ASC-END-OF-SELECTED-RANGE03922018
039230*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                03923018
039240         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 03924018
039250         SET DP020-MSG-FATAL TO TRUE                              03925018
039260         SET PS-ERROR TO TRUE                                     03926018
039270         PERFORM 3410-POSITION-AT-ERROR                           03927018
039280     END-IF.                                                      03928018
039290******************************************************************03929018
039300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **03930018
039310** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **03931018
039320** SHOULD BE POSITIONED ON A RANGE ERROR.                       **03932018
039330******************************************************************03933018
039340 3410-POSITION-AT-ERROR.                                          03934018
039350     SET DP030-SET-CURSOR-APPL-1                                  03935018
039360                                   TO TRUE.                       03936018
039370     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 03937018
039380                    - PV-TOP-ITEM + 1.                            03938018
039390     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      03939018
039400         CONTINUE                                                 03940018
039410     ELSE                                                         03941018
039420         MOVE -1                   TO MR-SELECTL (PV-SUB)         03942018
039430         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         03943018
039440         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         03944018
039450     END-IF.                                                      03945018
039460                                                                  03946018
039470     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   03947018
039480                    - PV-TOP-ITEM + 1.                            03948018
039490     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      03949018
039500         CONTINUE                                                 03950018
039510     ELSE                                                         03951018
039520         MOVE -1                   TO MR-SELECTL (PV-SUB)         03952018
039530         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         03953018
039540         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         03954018
039550     END-IF.                                                      03955018
039560                                                                  03956018
039570*----------------------------------------------------------------*03957018
039580*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *03958018
039590*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *03959018
039600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *03960018
039610*----------------------------------------------------------------*03961018
039620                                                                  03962018
039630 3500-MARK-RANGE-AS-SELECTED.                                     03963018
039640     MOVE +1                       TO  ASC-BLK-SUB.               03964018
039650     PERFORM 3510-MARK-SELECTED-INDS                              03965018
039660         VARYING ASC-ITEM-SUB                                     03966018
039670         FROM 1 BY 1                                              03967018
039680         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 03968018
039690                                                                  03969018
039700     ADD +1                        TO ASC-BLK-SUB.                03970018
039710     PERFORM 3510-MARK-SELECTED-INDS                              03971018
039720         VARYING ASC-ITEM-SUB                                     03972018
039730         FROM 1 BY 1                                              03973018
039740         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 03974018
039750                                                                  03975018
039760     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               03976018
039770                                   TO  PV-LIST-ITEM-NUMBER.       03977018
039780     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            03978018
039790         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         03979018
039800               PC-ITEMS-PER-PANEL).                               03980018
039810                                                                  03981018
039820     MOVE ASC-START-OF-SELECTED-RANGE                             03982018
039830                                   TO PV-START-OF-SELECTED-RANGE. 03983018
039840     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            03984018
039850         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  03985018
039860               PC-ITEMS-PER-PANEL).                               03986018
039870                                                                  03987018
039880     MOVE ASC-END-OF-SELECTED-RANGE                               03988018
039890                                   TO  PV-END-OF-SELECTED-RANGE.  03989018
039900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             03990018
039910         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    03991018
039920               PC-ITEMS-PER-PANEL).                               03992018
039930     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             03993018
039940         PV-FIRST-BLOCK-IN-ARRAY + 1.                             03994018
039950                                                                  03995018
039960     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    03996018
039970        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        03997018
039980         MOVE +1                   TO ASC-BLK-SUB                 03998018
039990         PERFORM 5100-WRITE-TEMP-STORAGE                          03999018
040000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         04000018
040010             PV-FIRST-BLOCK-IN-ARRAY - 1                          04001018
040020                                                                  04002018
040030         PERFORM                                                  04003018
040040             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      04004018
040050                   PV-PREV-BLOCK-IN-ARRAY                         04005018
040060             MOVE PV-FIRST-BLOCK-IN-RANGE                         04006018
040070                                   TO PV-BLOCK-NUMBER             04007018
040080             PERFORM 4410-READ-TEMP-STORAGE                       04008018
040090             PERFORM 3510-MARK-SELECTED-INDS                      04009018
040100                 VARYING ASC-ITEM-SUB                             04010018
040110                 FROM 1 BY 1                                      04011018
040120                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          04012018
040130             PERFORM 5100-WRITE-TEMP-STORAGE                      04013018
040140             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     04014018
040150         END-PERFORM                                              04015018
040160                                                                  04016018
040170         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         04017018
040180             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     04018018
040190         PERFORM                                                  04019018
040200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       04020018
040210                   PV-LAST-BLOCK-IN-RANGE                         04021018
040220             MOVE PV-NEXT-BLOCK-IN-ARRAY                          04022018
040230                                   TO PV-BLOCK-NUMBER             04023018
040240             PERFORM 4410-READ-TEMP-STORAGE                       04024018
040250             PERFORM 3510-MARK-SELECTED-INDS                      04025018
040260                 VARYING ASC-ITEM-SUB                             04026018
040270                 FROM 1 BY 1                                      04027018
040280                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          04028018
040290             PERFORM 5100-WRITE-TEMP-STORAGE                      04029018
040300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      04030018
040310         END-PERFORM                                              04031018
040320                                                                  04032018
040330         MOVE PV-FIRST-BLOCK-IN-ARRAY                             04033018
040340                                   TO PV-BLOCK-NUMBER             04034018
040350         PERFORM 4410-READ-TEMP-STORAGE                           04035018
040360     END-IF.                                                      04036018
040370                                                                  04037018
040380     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 04038018
040390                                      ASC-END-OF-SELECTED-RANGE.  04039018
040400                                                                  04040018
040410*----------------------------------------------------------------*04041018
040420* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *04042018
040430*----------------------------------------------------------------*04043018
040440                                                                  04044018
040450 3510-MARK-SELECTED-INDS.                                         04045018
040460                                                                  04046018
040470     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         04047018
040480                                ASC-ITEM-SUB) >                   04048018
040490         ASC-START-OF-SELECTED-RANGE)                             04049018
040500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         04050018
040510                                ASC-ITEM-SUB) =                   04051018
040520         ASC-START-OF-SELECTED-RANGE)                             04052018
040530                                                                  04053018
040540         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     04054018
040550                                    ASC-ITEM-SUB) <               04055018
040560             ASC-END-OF-SELECTED-RANGE)                           04056018
040570         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     04057018
040580                                    ASC-ITEM-SUB) =               04058018
040590             ASC-END-OF-SELECTED-RANGE)                           04059018
040600                                                                  04060018
040610             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          04061018
040620                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   04062018
040630                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   04063018
040640                               TO TRUE                            04064018
040650                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              04065018
040660                               TO TRUE                            04066018
040670                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    04067018
040680             END-IF                                               04068018
040690         END-IF                                                   04069018
040700     END-IF.                                                      04070018
040710                                                                  04071018
040720*----------------------------------------------------------------*04072018
040730*                                                                *04073018
040740*----------------------------------------------------------------*04074018
040750 3600-GET-DC-LOCATION.                                            04075018
040760                                                                  04076018
040770     INITIALIZE XL071-COMMAREA-REC.                               04077018
040780     MOVE DK-OPER-UNT-ID             TO XL071-LOCATION-NUMBER.    04078018
040790                                                                  04079018
040800     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  04080018
040810                                        XL071-COMMAREA            04081018
040820                                        XL071-COMMAREA-REC.       04082018
040830                                                                  04083018
040840                                                                  04084018
040850     EVALUATE TRUE                                                04085018
040860         WHEN XL071-NO-ERRORS                                     04086018
040870            MOVE  XL071-LOC-5-ABBR-NM TO PV-DC-5-CHAR-ABBR        04087018
040880            MOVE  PV-2-DIGIT-DC-ABBR  TO  PC140-CRA-DC-ID         04088018
040890            MOVE  DK-OPER-UNT-ID      TO  PC140-CRA-OPER-UNT-ID   04089018
040900         WHEN XL071-LOC-NOT-FOUND                                 04090018
040910            MOVE  '90'    TO  PC140-CRA-DC-ID                     04091018
040920                              PC140-CRA-OPER-UNT-ID               04092018
040930         WHEN OTHER                                               04093018
040940            MOVE '3600-GET-DC-LOCATION'                           04094018
040950                                   TO DP013-PARAGRAPH             04095018
040960            INITIALIZE PV-CICS-MSG-AREA                           04096018
040970            STRING ' RCKCS815 - CALL XLKUT071 -'                  04097018
040980                   ' SQLCODE=' XL071-SQLCODE                      04098018
040990                   ' TABLE='   XL071-DB2-TABLE                    04099018
041000                                            DELIMITED BY SIZE     04100018
041010                                       INTO PV-CICS-MSG-AREA      04101018
041020            PERFORM 9900-WRITE-CICS-LOG                           04102018
041030                                                                  04103018
041040*           PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                04104018
041050*           PERFORM 9900A-SOFT-ABORT                              04105018
041060            SET DP013-DB2-ABEND                                   04106018
041070                DP013-XCTL-DISPLAY-RESTART                        04107018
041080                                 TO TRUE                          04108018
041090            PERFORM DP013-0000-PROCESS-ABEND                      04109018
041100     END-EVALUATE.                                                04110018
041110/                                                                 04111018
041120*----------------------------------------------------------------*04112018
041130*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *04113018
041140*    INITIALIZE ALL COUNTERS AND FLAGS.                          *04114018
041150*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *04115018
041160*    DISPLAY THE PANEL TO USER.                                  *04116018
041170*----------------------------------------------------------------*04117018
041180                                                                  04118018
041190 4000-BUILD-INITIAL-PANEL.                                        04119018
041200                                                                  04120018
041210     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            04121018
041220                                 ASC-BLOCK-ENTRIES (2).           04122018
041230     MOVE +1                 TO ASC-BLK-SUB.                      04123018
041240     SET ASC-ITEMS-LEFT-ON-DB                                     04124018
041250                             TO TRUE.                             04125018
041260                                                                  04126018
041270     MOVE +0                 TO ASC-ITEM-SUB                      04127018
041280                                ASC-NUMBER-OF-ITEMS-READ          04128018
041290                                ASC-NUMBER-OF-SELECTED-ITEMS      04129018
041300                                ASC-HIGHEST-BLOCK-WRITTEN         04130018
041310                                ASC-START-OF-SELECTED-RANGE       04131018
041320                                ASC-END-OF-SELECTED-RANGE         04132018
041330                                ASC-ITEM-AT-TOP-OF-PANEL.         04133018
041340                                                                  04134018
041350     SET PS-DC-LEVEL-YES            TO  TRUE                      04135018
041360     PERFORM 2300-CALL-AUTOVE-MODULE                              04136018
041370     SET PS-DC-LEVEL-NO             TO  TRUE                      04137018
041380     IF RC040-FACILITY-AUTOVE-YES                                 04138018
041390        SET ASC-FACILITY-AUTOVE-YES TO  TRUE                      04139018
041400     ELSE                                                         04140018
041410        SET ASC-FACILITY-AUTOVE-NO  TO  TRUE                      04141018
041420     END-IF                                                       04142018
041430                                                                  04143018
041431     PERFORM 2165-CHECK-FOR-CURR.                                 04143120
041432                                                                  04143220
041440     PERFORM 4100-PREPARE-CURSOR.                                 04144018
041450                                                                  04145018
041460     PERFORM 4010-OPEN-EXPCTD-CURSOR.                             04146018
041470                                                                  04147018
041480     PERFORM 4300-READ-ITEMS-FROM-DB.                             04148018
041490                                                                  04149018
041500     PERFORM 4020-CLOSE-EXPCTD-CURSOR.                            04150018
041510                                                                  04151018
041520     MOVE +1                   TO  PV-TOP-ITEM.                   04152018
041530     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          04153018
041540         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    04154018
041550         SET DP020-MSG-FATAL   TO  TRUE                           04155018
041560         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               04156018
041570     ELSE                                                         04157018
041580         MOVE -1               TO MR-SELECTL (1)                  04158018
041590         SET DP030-SET-CURSOR-APPL-1                              04159018
041600                               TO TRUE                            04160018
041610         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     04161018
041620     END-IF.                                                      04162018
041630                                                                  04163018
041640*----------------------------------------------------------------*04164018
041650* OPEN THE EXPCTD CURSOR.                                        *04165018
041660*----------------------------------------------------------------*04166018
041670                                                                  04167018
041680 4010-OPEN-EXPCTD-CURSOR.                                         04168018
041690***EXPECTED NUMBER OF CARTONS FOR EACH PO/RECEIVER ON THE TRAILER 04169018
041700***FOR THE TRIP -ID ENTERED :DK-TRIP-ID                           04170018
041710     PERFORM                                                      04171018
041720         WITH TEST AFTER                                          04172018
041730         VARYING PV-RETRY-COUNTER                                 04173018
041740         FROM 1 BY 1                                              04174018
041750         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04175018
041760                   OR (SQLCODE = ZERO))                           04176018
041770                 EXEC SQL                                         04177018
041780                      OPEN SHIPMT-EXP-CSR                         04178018
041790                 END-EXEC                                         04179018
041800                                                                  04180018
041810                                                                  04181018
041820         EVALUATE TRUE                                            04182018
041830             WHEN SQLCODE = ZERO                                  04183018
041840             WHEN SQLCODE = -904                                  04184018
041850             WHEN SQLCODE = -913                                  04185018
041860                 CONTINUE                                         04186018
041870             WHEN SQLWARN0 NOT = SPACES                           04187018
041880             WHEN SQLCODE < ZERO                                  04188018
041890             WHEN SQLCODE > ZERO                                  04189018
041900                 MOVE '4010-OPEN-EXPCTD-CURSOR'                   04190018
041910                                   TO DP013-PARAGRAPH             04191018
041920                 MOVE 'OPEN SHIPMT CURSOR - '                     04192018
041930                                   TO DP013-MESSAGE-TEXT (1)      04193018
041940                 MOVE SQLCA        TO DP013-SQLCA                 04194018
041950                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    04195018
041960                 SET DP013-DB2-ABEND                              04196018
041970                     DP013-XCTL-DISPLAY-RESTART TO TRUE           04197018
041980                 PERFORM DP013-0000-PROCESS-ABEND                 04198018
041990         END-EVALUATE                                             04199018
042000     END-PERFORM.                                                 04200018
042010                                                                  04201018
042020     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04202018
042030         SQLCODE NOT = ZERO                                       04203018
042040         MOVE '4010-OPEN-EXPECTD-CURSOR'   TO DP013-PARAGRAPH     04204018
042050         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   04205018
042060                                   TO DP013-MESSAGE-TEXT (1)      04206018
042070         MOVE SQLCA                TO DP013-SQLCA                 04207018
042080         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    04208018
042090         SET DP013-DB2-ABEND                                      04209018
042100             DP013-XCTL-DISPLAY-RESTART                           04210018
042110                                   TO TRUE                        04211018
042120         PERFORM DP013-0000-PROCESS-ABEND                         04212018
042130     END-IF.                                                      04213018
042140                                                                  04214018
042150******************************************************************04215018
042160*  CLOSE EXPECTED CURSOR                                       * *04216018
042170******************************************************************04217018
042180 4020-CLOSE-EXPCTD-CURSOR.                                        04218018
042190         EXEC SQL                                                 04219018
042200             CLOSE SHIPMT-EXP-CSR                                 04220018
042210         END-EXEC                                                 04221018
042220                                                                  04222018
042230     EVALUATE TRUE                                                04223018
042240         WHEN SQLCODE = ZERO                                      04224018
042250             CONTINUE                                             04225018
042260         WHEN SQLWARN0 NOT = SPACES                               04226018
042270         WHEN SQLCODE < ZERO                                      04227018
042280         WHEN SQLCODE > ZERO                                      04228018
042290             MOVE '4020-CLOSE-EXPCTD-CURSOR'                      04229018
042300                               TO DP013-PARAGRAPH                 04230018
042310             MOVE 'CLOSE SHIPMT CURSOR '                          04231018
042320                               TO DP013-MESSAGE-TEXT (1)          04232018
042330             MOVE SQLCA        TO DP013-SQLCA                     04233018
042340             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        04234018
042350             SET DP013-DB2-ABEND                                  04235018
042360                 DP013-XCTL-DISPLAY-RESTART TO TRUE               04236018
042370             PERFORM DP013-0000-PROCESS-ABEND                     04237018
042380     END-EVALUATE.                                                04238018
042390                                                                  04239018
042400*----------------------------------------------------------------*04240018
042410*    SET UP THE HOST VARIABLES.                                  *04241018
042420*----------------------------------------------------------------*04242018
042430                                                                  04243018
042440 4100-PREPARE-CURSOR.                                             04244018
042450                                                                  04245018
042460     MOVE ASC-KEY-OPER-UNT-ID   TO DK-OPER-UNT-ID.                04246018
042470     MOVE ASC-KEY-FCLTY-ID      TO DK-FCLTY-ID.                   04247018
042480     MOVE ASC-SCAC-ID           TO DK-SCAC-ID.                    04248018
042490     MOVE ASC-VEH-NBR           TO DK-VEH-NBR.                    04249018
042500     MOVE ASC-TRIP-ID           TO DK-TRIP-ID.                    04250018
042510     MOVE PV-PO-NBR             TO DK-PO-NBR.                     04251018
042520     MOVE PV-RECEIVER           TO DK-REC-SEQ-NBR.                04252018
042530                                                                  04253018
042540     PERFORM 4200-BUILD-TEMP-TABLE.                               04254018
042550/                                                                 04255018
042560 4200-BUILD-TEMP-TABLE.                                           04256018
042570                                                                  04257018
042580*    RETRIEVE EXPECTED PO/RCVRS AND INSERT THEM TO THE TEMP TABLE 04258018
042590     PERFORM 7500-OPEN-TYPE-A-CSR                                 04259018
042600     PERFORM 7505-FETCH-TYPE-A-CSR                                04260018
042610     PERFORM UNTIL PS-EOF-TYPE-A-YES                              04261018
042620         PERFORM 7600-INSERT-TEMP-TABLE                           04262018
042630         PERFORM 7505-FETCH-TYPE-A-CSR                            04263018
042640     END-PERFORM.                                                 04264018
042650     PERFORM 7510-CLOSE-TYPE-A-CSR.                               04265018
042660                                                                  04266018
042670*    GET THE CHECKIN DATA AND INSERT THEN TO THE TEMP TABLE       04267018
042680                                                                  04268018
042690     MOVE ZERO                        TO PV-PREV-TEMP-PO          04269018
042700                                         PV-PREV-TEMP-SEQ         04270018
042710                                                                  04271018
042720     PERFORM 7520-OPEN-CHECKIN-CSR.                               04272018
042730     PERFORM 7525-FETCH-CHECKIN-CSR                               04273018
042740                                                                  04274018
042750     PERFORM UNTIL PS-EOF-CHECKIN-YES                             04275018
042760         IF PV-TEMP-PO-NULL = -1 OR PV-TEMP-SEQ-NULL = -1         04276018
042770             PERFORM 4201-TYPE-C                                  04277018
042780             PERFORM 7600-INSERT-TEMP-TABLE                       04278018
042790         ELSE                                                     04279018
042800             IF PV-CURRENT-TEMP = PV-PREVIOUS-TEMP                04280018
042810                 CONTINUE                                         04281018
042820             ELSE                                                 04282018
042830                 PERFORM 4202-OTHER-TYPES                         04283018
042840                 PERFORM 7546-SELECT-RECEIVER-STATUS              04284018
042850                 PERFORM 7600-INSERT-TEMP-TABLE                   04285018
042860                 MOVE PV-CURR-TEMP-PO TO PV-PREV-TEMP-PO          04286018
042870                 MOVE PV-CURR-TEMP-SEQ                            04287018
042880                                      TO PV-PREV-TEMP-SEQ         04288018
042890             END-IF                                               04289018
042900         END-IF                                                   04290018
042910                                                                  04291018
042920         PERFORM 7525-FETCH-CHECKIN-CSR                           04292018
042930                                                                  04293018
042940     END-PERFORM.                                                 04294018
042950                                                                  04295018
042960     PERFORM 7530-CLOSE-CHECKIN-CSR.                              04296018
042970                                                                  04297018
042980 4201-TYPE-C.                                                     04298018
042990     PERFORM 7540-SELECT-TSHUUPC.                                 04299018
043000     MOVE 'C'                         TO PV-TEMP-UNION-TYPE       04300018
043010*    MOVE  1                          TO PV-TEMP-SCREEN-SEQUENCE. 04301018
043020     MOVE ZERO                        TO PV-TEMP-REC-SEQ-NBR.     04302018
043030                                                                  04303018
043040 4202-OTHER-TYPES.                                                04304018
043050     PERFORM 7545-SELECT-TPKSLIP.                                 04305018
043060     IF SQLCODE = ZERO                                            04306018
043070         IF PV-TEMP-REC-SEQ-NBR = ZERO                            04307018
043080             MOVE 'D'                 TO PV-TEMP-UNION-TYPE       04308018
043090*            MOVE  1                  TO PV-TEMP-SCREEN-SEQUENCE  04309018
043100         ELSE                                                     04310018
043110             PERFORM 7550-SELECT-FROM-TEMP                        04311018
043120             IF PS-TEMP-B-YES                                     04312018
043130                 MOVE 'B'             TO PV-TEMP-UNION-TYPE       04313018
043140*                MOVE  1              TO PV-TEMP-SCREEN-SEQUENCE  04314018
043150             END-IF                                               04315018
043160         END-IF                                                   04316018
043170     ELSE                                                         04317018
043180         PERFORM 7555-FIND-DELETED-PKSLIPS                        04318018
043190         IF PS-TEMP-PKSLIP-DELETED-YES                            04319018
043200             MOVE ZERO                TO PV-TEMP-REC-SEQ-NBR      04320018
043210             MOVE 'E'                 TO PV-TEMP-UNION-TYPE       04321018
043220*            MOVE 1                   TO PV-TEMP-SCREEN-SEQUENCE  04322018
043230         ELSE                                                     04323018
043240             MOVE 'E'                 TO PV-TEMP-UNION-TYPE       04324018
043250*            MOVE 1                   TO PV-TEMP-SCREEN-SEQUENCE  04325018
043260         END-IF                                                   04326018
043270     END-IF.                                                      04327018
043280                                                                  04328018
043290/                                                                 04329018
043300*----------------------------------------------------------------*04330018
043310*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *04331018
043320*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *04332018
043330*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *04333018
043340*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *04334018
043350*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *04335018
043360*                                                                *04336018
043370*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *04337018
043380*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *04338018
043390*    UPON INITIALIZATION.                                        *04339018
043400*----------------------------------------------------------------*04340018
043410                                                                  04341018
043420 4300-READ-ITEMS-FROM-DB.                                         04342018
043430                                                                  04343018
043440     PERFORM                                                      04344018
043450         VARYING PV-READ-COUNT                                    04345018
043460         FROM 1 BY 1                                              04346018
043470         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    04347018
043480            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         04348018
043490                                                                  04349018
043500         PERFORM 4310-FETCH-EXPECTED-CNT                          04350018
043510                                                                  04351018
043520         IF  ASC-ITEMS-LEFT-ON-DB                                 04352018
043530             PERFORM 3250-GET-PKG-TYP-CDE                         04353018
043540             PERFORM 4320-SELECT-EXPECTD-CNT                      04354018
043550             PERFORM 4330-SELECT-SCANNED-CNT                      04355018
043560             PERFORM 4340-SELECT-TOT-EXP-AND-ACTUAL               04356018
043570                                                                  04357018
043580             IF DK-REC-SEQ-NBR = 0                                04358018
043590                MOVE ZEROES TO  PV-PO-RCVR-UNT-CNTR               04359018
043600             ELSE                                                 04360018
043610                PERFORM 5010-OPEN-TOTAL-UNTS-CSR                  04361018
043620                SET PS-NOT-END-OF-RECITM-CSR TO TRUE              04362018
043630                                                                  04363018
043640                PERFORM 5310-FETCH-TOTAL-UNITS                    04364018
043650                            UNTIL PS-END-OF-RECITM-CSR            04365018
043660                PERFORM 5020-CLOSE-TOTAL-UNTS-CSR                 04366018
043670             END-IF                                               04367018
043680                                                                  04368018
043690             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                04369018
043700                 ADD +1            TO ASC-ITEM-SUB                04370018
043710             ELSE                                                 04371018
043720                 ADD +1            TO ASC-BLK-SUB                 04372018
043730                 MOVE +1           TO ASC-ITEM-SUB                04373018
043740                                                                  04374018
043750                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         04375018
043760                     MOVE +1       TO ASC-BLK-SUB                 04376018
043770                     SET ASC-BLOCK-MODIFIED (1)                   04377018
043780                                   TO TRUE                        04378018
043790                     PERFORM 5100-WRITE-TEMP-STORAGE              04379018
043800                     MOVE ASC-BLOCK-ENTRIES                       04380018
043810                               (PC-MAX-BLOCKS-IN-ARRAY)           04381018
043820                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 04382018
043830                     ADD +1        TO ASC-BLK-SUB                 04383018
043840                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   04384018
043850                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      04385018
043860                                   TO TRUE                        04386018
043870                 END-IF                                           04387018
043880             END-IF                                               04388018
043890                                                                  04389018
043900             PERFORM 7210-SELECT-MAX-STATUS                       04390018
043910                                                                  04391018
043920             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    04392018
043930             MOVE ASC-NUMBER-OF-ITEMS-READ                        04393018
043940                                   TO ASC-LIST-ITEM-NUMBER        04394018
043950                                      (ASC-BLK-SUB ASC-ITEM-SUB)  04395018
043960             MOVE SPACES                 TO  ASC-ACTION           04396018
043970                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04397018
043980             MOVE PV-UNION-TYPE          TO  ASC-CSR-IND          04398018
043990                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04399018
044000*            MOVE PV-PO-CODE         TO ASC-PO-IND                04400018
044010*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 04401018
044020             MOVE PV-PO-RECEIVER-X   TO ASC-PO-RECEIVER           04402018
044030                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04403018
044040*                                                                 04404018
044041             MOVE PV-RCVR-CURR-OPER  TO ASC-CURR-OPER-UNT-ID      04404125
044042                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04404225
044043*                                                                 04404325
044050             IF PS-PBS-PACK-TYPE-YES                              04405018
044060                PERFORM 4361-CHECK-FOR-PBS-ERRORS                 04406018
044070                IF PS-PBS-ERRORS-FOUND                            04407018
044080                   SET ASC-PBS-ERRORS-FOUND                       04408018
044090                      (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE          04409018
044100                END-IF                                            04410018
044110             END-IF                                               04411018
044120             MOVE PV-PO-STATUS          TO ASC-PO-STATUS          04412018
044130                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04413018
044140             MOVE ENTNME-ENT-NAME-DESC TO ASC-VND-NME             04414018
044150                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04415018
044160             MOVE PV-PACK-TYPE         TO ASC-PACK-TYPE           04416018
044170                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04417018
044180*** MOVE FOR EXPECTED CTN COUNT                                   04418018
044190             MOVE PV-DB2-COUNT-MANIFEST                           04419018
044200                                       TO ASC-EXP-CART-COUNT      04420018
044210                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04421018
044220             ADD PV-DB2-COUNT-MANIFEST                            04422018
044230                                   TO ASC-TOT-EXP-CRTNS           04423018
044240*** MOVE FOR ACTUAL CTN COUNT                                     04424018
044250             MOVE PV-DB2-COUNT-ACTL-CTN                           04425018
044260                                       TO ASC-ACTL-CART-COUNT     04426018
044270                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04427018
044280             IF  PV-DB2-COUNT-ACTL-CTN  = ZERO                    04428018
044290                 SET ASC-ACTL-COUNT-ZERO    TO TRUE               04429018
044300             ELSE                                                 04430018
044310                 SET ASC-ACTL-COUNT-ZERO-NO TO TRUE               04431018
044320             END-IF                                               04432018
044330             ADD PV-DB2-COUNT-ACTL-CTN                            04433018
044340                                   TO ASC-TOT-ACTL-CRTNS          04434018
044350*** MOVE FOR SCANNED  CTN COUNT                                   04435018
044360             MOVE PV-DB2-COUNT-EXP-SCN                            04436018
044370                                   TO ASC-EXP-SCN-COUNT           04437018
044380                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04438018
044390             ADD PV-DB2-COUNT-EXP-SCN                             04439018
044400                                   TO ASC-TOT-EXP-SCAN            04440018
044410*** MOVE FOR ACTUAL SCAN COUNT                                    04441018
044420             MOVE PV-DB2-COUNT-ACTL-SCN                           04442018
044430                                   TO ASC-ACTL-SCN-COUNT          04443018
044440                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04444018
044450             ADD PV-DB2-COUNT-ACTL-SCN                            04445018
044460                                   TO ASC-TOT-ACTL-SCN            04446018
044470*** MOVE FOR PERCENT SCANNED                                      04447018
044480             PERFORM 4350-CALCULATE-PERCENT-SCANNED               04448018
044490             MOVE PV-PERCENT-SCANNED TO PV-PERCENT                04449018
044500             MOVE PV-PERCENT-EDITED                               04450018
044510                                   TO ASC-PERCENT-SCND            04451018
044520                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04452018
044530*** MOVE FOR TOTAL UNITS                                          04453018
044540             MOVE PV-PO-RCVR-UNT-CNTR                             04454018
044550                                   TO ASC-TOTAL-UNITS             04455018
044560                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04456018
044570             ADD PV-PO-RCVR-UNT-CNTR                              04457018
044580                                   TO ASC-TOT-UNITS               04458018
044590                                                                  04459018
044600             INITIALIZE PV-PO-RCVR-UNT-CNTR                       04460018
044610                                                                  04461018
044620*** INFO FOR HEADER LABELS                                        04462018
044630                                                                  04463018
044640             PERFORM 4395-GET-SHIPMENT-INFO                       04464018
044650             IF  SQLCODE = -811                                   04465018
044660                 MOVE 'M' TO ASC-MULT-IND                         04466018
044670                              (ASC-BLK-SUB ASC-ITEM-SUB)          04467018
044680             END-IF                                               04468018
044690             MOVE DK-PO-NBR             TO DK-ORD-NBR             04469018
044700             PERFORM 4370-GET-RECEIVER-INFO                       04470018
044710*            MOVE RECEIV-PKGNG-CDE          TO                    04471018
044720*                     ASC-PKGNG-CDE     (ASC-BLK-SUB ASC-ITEM-SUB)04472018
044730             IF  RECEIV-REC-TYP-CDE = 'EX'                        04473018
044740                 MOVE 'EXPENSE RECEIPT' TO ASC-OPER-SET-DESC      04474018
044750                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04475018
044760             ELSE                                                 04476018
044770                 PERFORM 4380-GET-OPER-SET-DESC                   04477018
044780                 MOVE OPRSET-OPER-SET-DESC TO                     04478018
044790                     ASC-OPER-SET-DESC (ASC-BLK-SUB ASC-ITEM-SUB) 04479018
044800             END-IF                                               04480018
044810*----------------------------------------------------------------*04481018
044820* IDENTIFY FREE-ASTRAY AND UNUSED PHYSICAL LABELS.                04482018
044830*----------------------------------------------------------------*04483018
044840             IF  RECEIV-STATUS-CDE = 'IP' OR 'CM'                 04484018
044850                 IF RECEIV-FRE-ASTRA-IND = 'Y'                    04485018
044860                    SET ASC-COLOR-YELLOW                          04486018
044870                            (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE   04487018
044880                    IF ASC-FREE-ASTRAY-SW NOT = 'Y'               04488018
044890                       SET ASC-FREE-ASTRAY   TO TRUE              04489018
044900                    END-IF                                        04490018
044910                 END-IF                                           04491018
044920             END-IF                                               04492018
044930                                                                  04493018
044940             IF ASC-FACILITY-AUTOVE-YES                           04494018
044950                 PERFORM 2300-CALL-AUTOVE-MODULE                  04495018
044960                 IF RC040-AUTO-VE-NO                              04496018
044970                     MOVE '==>MANUAL'  TO ASC-VND-NME-10          04497018
044980                                  (ASC-BLK-SUB ASC-ITEM-SUB)      04498018
044990                     SET ASC-AUTO-VE-NO                           04499018
045000                               (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE04500018
045010                 ELSE                                             04501018
045020                     IF RECEIV-CRE-UID = 'CHECK-IN'               04502018
045030                       MOVE '==>CHCKIN'  TO ASC-VND-NME-10        04503018
045040                                  (ASC-BLK-SUB ASC-ITEM-SUB)      04504018
045050                     SET ASC-CHCKIN-YES                           04505018
045060                               (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE04506018
045070                     END-IF                                       04507018
045080                 END-IF                                           04508018
045090             END-IF                                               04509018
045100                                                                  04510018
045110             IF  ASC-PHYSICAL-LABEL-SW NOT  = 'Y'                 04511018
045120                 IF RECEIV-PACK-BY-ST-IND = 'Y'                   04512018
045130                    PERFORM 4371-COUNT-SMOOTH-CARTONS             04513018
045140                 ELSE                                             04514018
045150                    PERFORM 4372-COUNT-PHYSICAL-LABELS            04515018
045160                 END-IF                                           04516018
045170                 IF PV-DB2-COUNT > 0                              04517018
045180                    SET ASC-PHYSICAL-LABEL  TO TRUE               04518018
045190                 END-IF                                           04519018
045200             END-IF                                               04520018
045210*----------------------------------------------------------------*04521018
045220* CHECK IF RECEIVER IS A SYSTEM GENERATED FREE-ASTRAY WHICH IS    04522018
045230*  ATTACHED TO A TRAILER AND THE PACKSLIP HAS BEEN TRANSCRIBED.   04523018
045240*----------------------------------------------------------------*04524018
045250             IF ASC-COLOR-YELLOW (ASC-BLK-SUB ASC-ITEM-SUB)       04525018
045260                 PERFORM 4325-REC-ATTACHED-TRLR                   04526018
045270                 PERFORM 4326-REC-TRNSCRBD                        04527018
045280             END-IF                                               04528018
045290                                                                  04529018
045300*----------------------------------------------------------------*04530018
045310*            IF ASC-COLOR-YELLOW (ASC-BLK-SUB ASC-ITEM-SUB)       04531018
045320                 PERFORM 4327-SELECT-TTRIPST                      04532018
045330                 IF PS-MISDIRECT-YES                              04533018
045340                   IF DK-REC-SEQ-NBR  >  0                        04534018
045350                     PERFORM 4329-SELECT-TRECEIV                  04535018
045360                     IF RECEIV-CURR-OPER-UNT-ID =                 04536018
045370                                       DP020-LOCATION-NBR         04537018
045380                        SET ASC-MISDIRECT-NO                      04538018
045390                               (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE 04539018
045400                        IF (RECEIV-CURR-OPER-UNT-ID NOT EQUAL     04540018
045410                            RECEIV-CRE-OPER-UNT-ID)  AND          04541018
045420                            RECEIV-FRE-ASTRA-IND  = 'Y'           04542018
045430                            MOVE '==>PBSMSD'  TO ASC-VND-NME-10   04543018
045440                                    (ASC-BLK-SUB ASC-ITEM-SUB)    04544018
045450                            SET ASC-MISDIRECT-YES                 04545018
045460                               (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE 04546018
045470                        END-IF                                    04547018
045480                     ELSE                                         04548018
045490                        MOVE '==>MSDRCT'  TO ASC-VND-NME-10       04549018
045500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  04550018
045510                        SET ASC-MISDIRECT-YES                     04551018
045520                               (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE 04552018
045530                     END-IF                                       04553018
045540                   ELSE                                           04554018
045550                      SET ASC-MISDIRECT-YES                       04555018
045560                               (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE 04556018
045570                      MOVE '==>MSDRCT'  TO ASC-VND-NME-10         04557018
045580                                    (ASC-BLK-SUB ASC-ITEM-SUB)    04558018
045590                   END-IF                                         04559018
045600                 ELSE                                             04560018
045610                    SET ASC-MISDIRECT-NO                          04561018
045620                               (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE 04562018
045630                 END-IF                                           04563018
045640*            END-IF                                               04564018
045650                                                                  04565018
045660*----------------------------------------------------------------*04566018
045670             PERFORM 4510-CHECK-IF-IN-TROUBLE                     04567018
045680             IF PS-TROUBLE                                        04568018
045690                SET ASC-TROUBLE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE04569018
045700                SET PS-TROUBLE-NO TO TRUE                         04570018
045710             END-IF                                               04571018
045720                                                                  04572018
045730             IF RECEIV-OPER-UNT-ID > ZERO                         04573018
045740                 INITIALIZE PV-DB2-COUNT                          04574018
045750                 MOVE RECEIV-OPER-UNT-ID TO PV-OPER-UNT-ID        04575018
045760                 MOVE PV-OPER-UNT-ID-X                            04576018
045770                                     TO DK-STORE-NMBR             04577018
045780                 PERFORM 4365-CHECK-DIRECT-STORE                  04578018
045790                 IF  XL071-LOC-TYP-CDE NOT = 'DC'                 04579018
045800                    STRING PV-OPER-UNT-ID-X(2:3) DELIMITED BY SIZE04580018
045810                           ' - '                 DELIMITED BY SIZE04581018
045820                           'DIR. STORE'          DELIMITED BY SIZE04582018
045830                                      INTO ASC-OPER-SET-DESC      04583018
045840                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04584018
045850                 END-IF                                           04585018
045860             END-IF                                               04586018
045870                                                                  04587018
045880             PERFORM 4515-CHECK-4-SPCL-INSTRCT                    04588018
045890* GET PRESENTATION                                                04589018
045900             PERFORM 4520-CHECK-4-PRSNTATN                        04590018
045910             IF ASC-PRESENTATION = 'HANG                '         04591018
045920                 SET PS-COLOR-RED   TO TRUE                       04592018
045930*            ELSE                                                 04593018
045940*            IF ASC-PRESENTATION = 'FOLD                ' AND     04594018
045950*               RECEIV-GOH-IND      = 'Y'                         04595018
045960*                SET PS-COLOR-RED   TO TRUE                       04596018
045970*            ELSE                                                 04597018
045980*            IF ASC-PRESENTATION = '                    ' AND     04598018
045990*               RECEIV-GOH-IND      = 'Y'                         04599018
046000*                SET PS-COLOR-RED   TO TRUE                       04600018
046010*            END-IF                                               04601018
046020*            END-IF                                               04602018
046030             END-IF                                               04603018
046040             MOVE SPACES TO ASC-PRESENTATION                      04604018
046050* GET NEW STORE INFO                                              04605018
046060     PERFORM 4535-GET-NEWSTORE-INFO                               04606018
046070*    IF ASC-NEWSTORE = 'Y'                                        04607018
046080*        SET PS-COLOR-RED   TO TRUE                               04608018
046090*    END-IF                                                       04609018
046100* GET RTV INFO                                                    04610018
046110     PERFORM 4540-GET-RTV-INFO                                    04611018
046120     IF ASC-RTV = 'Y'                                             04612018
046130         SET PS-COLOR-RED   TO TRUE                               04613018
046140     END-IF                                                       04614018
046150* GET SET NAME INFO                                               04615018
046160     PERFORM 4550-GET-SET-NAME-INFO                               04616018
046170     IF PC240-NO-SEASONAL-SET-FOUND                               04617018
046180     OR PC240-DIVERT-PFX-NBR = ZEROES                             04618018
046190* ADDED THE FOLLOWING SET STATEMENT TO SET THIS SWITCH SO THAT    04619018
046200* THE PROGRAM WOULD FALL OUT OF THIS IF STATEMENT INTO THE        04620018
046210* NEXT CHECK                                                      04621018
046220        SET PS-SEASET-CHECK-NO TO TRUE                            04622018
046230     ELSE                                                         04623018
046240        IF ASC-PKGNG-CD = 'I'                                     04624018
046250           IF PC240-DIVERT-PFX-NBR > ZEROES                       04625018
046260              SET PS-COLOR-RED   TO TRUE                          04626018
046270           ELSE                                                   04627018
046280              IF ASC-SET-NAME = 'T & T' OR                        04628018
046290                 ASC-SET-NAME = 'T&T'                             04629018
046300                 SET PS-COLOR-RED   TO TRUE                       04630018
046310              END-IF                                              04631018
046320           END-IF                                                 04632018
046330        ELSE                                                      04633018
046340           IF ASC-PKGNG-CD = 'M'                                  04634018
046350              PERFORM 4600-CHECK-TRECITM                          04635018
046360              IF PS-TRECITM-FOUND-YES                             04636018
046370                 PERFORM 4610-CHECK-PTL-PREPK-TRECITM             04637018
046380                 IF PS-PACK-TO-LIGHT-YES                          04638018
046390                    IF PC240-DIVERT-PFX-NBR > ZEROES              04639018
046400                       SET PS-COLOR-RED   TO TRUE                 04640018
046410                    ELSE                                          04641018
046420                       IF ASC-SET-NAME = 'T & T' OR               04642018
046430                          ASC-SET-NAME = 'T&T'                    04643018
046440                          SET PS-COLOR-RED   TO TRUE              04644018
046450                       END-IF                                     04645018
046460                    END-IF                                        04646018
046470                 END-IF                                           04647018
046480              ELSE                                                04648018
046490                 PERFORM 4620-CHECK-PTL-PREPK-TPURITM             04649018
046500                 IF PS-PACK-TO-LIGHT-YES                          04650018
046510                    IF PC240-DIVERT-PFX-NBR > ZEROES              04651018
046520                       SET PS-COLOR-RED   TO TRUE                 04652018
046530                    ELSE                                          04653018
046540                       IF ASC-SET-NAME = 'T & T' OR               04654018
046550                          ASC-SET-NAME = 'T&T'                    04655018
046560                          SET PS-COLOR-RED   TO TRUE              04656018
046570                       END-IF                                     04657018
046580                    END-IF                                        04658018
046590                 END-IF                                           04659018
046600              END-IF                                              04660018
046610           ELSE                                                   04661018
046620              IF ASC-PKGNG-CD = 'B'                               04662018
046630                 PERFORM 4600-CHECK-TRECITM                       04663018
046640                 IF PS-TRECITM-FOUND-YES                          04664018
046650                    PERFORM 4630-CHECK-PTL-BULK-TRECITM           04665018
046660                    IF PS-PACK-TO-LIGHT-YES                       04666018
046670                       IF PC240-DIVERT-PFX-NBR > ZEROES           04667018
046680                          SET PS-COLOR-RED   TO TRUE              04668018
046690                       ELSE                                       04669018
046700                          IF ASC-SET-NAME = 'T & T' OR            04670018
046710                             ASC-SET-NAME = 'T&T'                 04671018
046720                             SET PS-COLOR-RED   TO TRUE           04672018
046730                          END-IF                                  04673018
046740                       END-IF                                     04674018
046750                    END-IF                                        04675018
046760                 ELSE                                             04676018
046770                    PERFORM 4640-CHECK-PTL-BULK-TPURITM           04677018
046780                    IF PS-PACK-TO-LIGHT-YES                       04678018
046790                       IF PC240-DIVERT-PFX-NBR > ZEROES           04679018
046800                          SET PS-COLOR-RED   TO TRUE              04680018
046810                       ELSE                                       04681018
046820                          IF ASC-SET-NAME = 'T & T' OR            04682018
046830                            ASC-SET-NAME = 'T&T'                  04683018
046840                            SET PS-COLOR-RED   TO TRUE            04684018
046850                          END-IF                                  04685018
046860                       END-IF                                     04686018
046870                    END-IF                                        04687018
046880                 END-IF                                           04688018
046890              END-IF                                              04689018
046900           END-IF                                                 04690018
046910        END-IF                                                    04691018
046920     END-IF                                                       04692018
046930             IF PS-COLOR-RED                                      04693018
046940                 SET ASC-COLOR-RED (ASC-BLK-SUB ASC-ITEM-SUB)     04694018
046950                    TO TRUE                                       04695018
046960             ELSE                                                 04696018
046970                 SET ASC-COLOR-RED-NO (ASC-BLK-SUB ASC-ITEM-SUB)  04697018
046980                   TO TRUE                                        04698018
046990             END-IF                                               04699018
047000             SET PS-COLOR-RED-NO TO TRUE                          04700018
047010                                                                  04701018
047020             MOVE PV-DB2-REC-DATE  TO PV-DB2-DATE                 04702018
047030             MOVE RECEIV-PACK-BY-ST-IND TO                        04703018
047040                  ASC-PACK-BY-ST-IND (ASC-BLK-SUB ASC-ITEM-SUB)   04704018
047050             MOVE RECEIV-AD-INFO-DESC TO                          04705018
047060                  ASC-AD-INFO (ASC-BLK-SUB ASC-ITEM-SUB)          04706018
047070             MOVE RECEIV-PRE-TKT-IND TO                           04707018
047080                  ASC-PRE-TKT-IND (ASC-BLK-SUB ASC-ITEM-SUB)      04708018
047090             MOVE RECEIV-GOH-IND TO                               04709018
047100                  ASC-GOH-IND (ASC-BLK-SUB ASC-ITEM-SUB)          04710018
047110             MOVE RECEIV-RCVG-CLERK-INIT-ID TO                    04711018
047120                  ASC-REC-CLK (ASC-BLK-SUB ASC-ITEM-SUB)          04712018
047130*            IF  ASC-REC-CLK (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES  04713018
047140*                SET ASC-TRLR-NOT-UNLOADED TO TRUE                04714018
047150*            ELSE                                                 04715018
047160*                SET ASC-TRLR-UNLOADED     TO TRUE                04716018
047170*            END-IF                                               04717018
047180             MOVE ASC-KEY-OPER-UNT-ID TO DK-OPER-UNT-ID           04718018
047190             MOVE ASC-KEY-FCLTY-ID    TO DK-FCLTY-ID              04719018
047200             PERFORM 4390-SELECT-TDCTFAS                          04720018
047210             PERFORM 4385-GET-AD-DATE                             04721018
047220             IF  SQLCODE = -305                                   04722018
047230                 MOVE SPACES               TO ASC-AD-DATE         04723018
047240                                      (ASC-BLK-SUB ASC-ITEM-SUB)  04724018
047250             ELSE                                                 04725018
047260                 IF  DN-AD-EVNT-DTE = -1                          04726018
047270                     MOVE SPACES           TO ASC-AD-DATE         04727018
047280                                      (ASC-BLK-SUB ASC-ITEM-SUB)  04728018
047290                 ELSE                                             04729018
047300                     MOVE PURITM-AD-EVNT-DTE TO PV-DB2-DATE       04730018
047310                     STRING PV-DB2-DATE-MM                        04731018
047320                            PV-DB2-DATE-DD                        04732018
047330                            PV-DB2-DATE-YY DELIMITED BY SIZE      04733018
047340                                         INTO ASC-AD-DATE         04734018
047350                                      (ASC-BLK-SUB ASC-ITEM-SUB)  04735018
047360                 END-IF                                           04736018
047370             END-IF                                               04737018
047380             PERFORM 4360-GET-PO-INFO                             04738018
047390             MOVE PURCHS-DEPT-NBR TO ASC-DEPT                     04739018
047400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   04740018
047410             PERFORM 4389-GET-CL-NBR                              04741018
047420             MOVE PURITM-CL-NBR   TO ASC-CLASS                    04742018
047430                                     (ASC-BLK-SUB ASC-ITEM-SUB)   04743018
047440             PERFORM 4375-SELECT-SHPTPO                           04744018
047450             MOVE SHPTPO-PKSL-IND TO                              04745018
047460                       ASC-DETAIL-CHECK (ASC-BLK-SUB ASC-ITEM-SUB)04746018
047470                                                                  04747018
047480             IF PV-UNION-TYPE  = 'A'                              04748018
047490                IF ASC-COLOR-RED   (ASC-BLK-SUB ASC-ITEM-SUB)     04749018
047500                   MOVE 'R'             TO ASC-PO-IND             04750018
047510                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04751018
047520                END-IF                                            04752018
047530             ELSE                                                 04753018
047540                SET ASC-FREE-ASTRAY     TO TRUE                   04754018
047550                MOVE 'Y'                TO ASC-PO-IND             04755018
047560                                       (ASC-BLK-SUB ASC-ITEM-SUB) 04756018
047570             END-IF                                               04757018
047571                                                                  04757147
047572* - DMH 4/27/2021 BEGIN                                           04757247
047573* IF A BULK RECEIVER CHECK IF CARTONS HAVE MULTIPLE SKU'S IN THEM 04757347
047574* IF MULTIPLE SKU'S IN CARTON THEN MUST BE PBS ORDER              04757447
047575             IF  ASC-PACK-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = 'B'   04757547
047577                 PERFORM 4335-CHECK-BULK-SINGLE-SKU               04757747
047578                 IF  PV-BULK-MULT-SKU   >  1                      04757847
047579                     SET  ASC-BULK-MULT-SKU-YES                   04757947
047580                         (ASC-BLK-SUB ASC-ITEM-SUB)               04758047
047581                         TO  TRUE                                 04758147
047582                     SET  ASC-HAS-BULK-MULTI-SKU-YES              04758247
047583                         TO  TRUE                                 04758347
047584                 ELSE                                             04758447
047585                     SET  ASC-BULK-MULT-SKU-NO                    04758547
047586                         (ASC-BLK-SUB ASC-ITEM-SUB)               04758647
047587                         TO  TRUE                                 04758747
047588                 END-IF                                           04758847
047589             ELSE                                                 04758947
047590                 MOVE SPACE  TO  ASC-BULK-MULT-SKU-SW             04759047
047591                         (ASC-BLK-SUB ASC-ITEM-SUB)               04759147
047592             END-IF                                               04759247
047593* - DMH 4/27/2021 END                                             04759347
047594                                                                  04759447
047598         END-IF                                                   04759847
047600     END-PERFORM.                                                 04760018
047610                                                                  04761018
047620     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          04762018
047630         MOVE +1               TO ASC-BLK-SUB                     04763018
047640         PERFORM 5100-WRITE-TEMP-STORAGE                          04764018
047650         ADD +1                TO ASC-BLK-SUB                     04765018
047660         PERFORM 5100-WRITE-TEMP-STORAGE                          04766018
047670                                                                  04767018
047680         MOVE 1                TO ASC-BLK-SUB                     04768018
047690                                  PV-BLOCK-NUMBER                 04769018
047700         PERFORM 4410-READ-TEMP-STORAGE                           04770018
047710         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             04771018
047720             MOVE 2            TO ASC-BLK-SUB                     04772018
047730                                  PV-BLOCK-NUMBER                 04773018
047740             PERFORM 4410-READ-TEMP-STORAGE                       04774018
047750         END-IF                                                   04775018
047760     END-IF.                                                      04776018
047770                                                                  04777018
047780*----------------------------------------------------------------*04778018
047790*    FETCH THE MESSAGE CURSOR.                                   *04779018
047800*----------------------------------------------------------------*04780018
047810                                                                  04781018
047820 4310-FETCH-EXPECTED-CNT.                                         04782018
047830                                                                  04783018
047840         EXEC SQL                                                 04784018
047850             FETCH SHIPMT-EXP-CSR                                 04785018
047860             INTO   :PV-UNION-TYPE                                04786018
047870                  , :DK-PO-NBR                                    04787018
047880                  , :DK-REC-SEQ-NBR                               04788018
047890                ,   :PV-TEMP-STATUS-CDE                           04789018
047900                ,   :PV-TEMP-SCREEN-SEQUENCE                      04790018
047910         END-EXEC                                                 04791018
047920                                                                  04792018
047930     EVALUATE TRUE                                                04793018
047940         WHEN SQLCODE = ZERO                                      04794018
047950              MOVE DK-PO-NBR      TO   PV-PO-NBR                  04795018
047960              MOVE DK-REC-SEQ-NBR TO   PV-RECEIVER                04796018
047970                                                                  04797018
047980         WHEN SQLCODE = +100                                      04798018
047990              SET ASC-NO-ITEMS-LEFT-ON-DB                         04799018
048000                                        TO TRUE                   04800018
048010         WHEN SQLWARN0 NOT = SPACE                                04801018
048020         WHEN SQLCODE NOT = ZERO                                  04802018
048030              MOVE '4310-FETCH-EXPECTED-CNT'                      04803018
048040                               TO DP013-PARAGRAPH                 04804018
048050              MOVE 'FETCH MESSAGE CURSOR'                         04805018
048060                               TO DP013-MESSAGE-TEXT (1)          04806018
048070              MOVE DK-PO-NBR  TO PV-ERROR-PO                      04807018
048080              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 04808018
048090              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         04809018
048100              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       04810018
048110              MOVE SQLCA       TO DP013-SQLCA                     04811018
048120              SET DP013-DB2-ABEND                                 04812018
048130                               TO TRUE                            04813018
048140              PERFORM DP013-0000-PROCESS-ABEND                    04814018
048150     END-EVALUATE.                                                04815018
048160                                                                  04816018
048170                                                                  04817018
048180     IF SQLCODE = +0                                              04818018
048190         PERFORM  5910-GET-ENT-NAME-DESC                          04819018
048200     END-IF.                                                      04820018
048210                                                                  04821018
048220******************************************************************04822018
048230******************************************************************04823018
048240                                                                  04824018
048250 4320-SELECT-EXPECTD-CNT.                                         04825018
048260     INITIALIZE        PV-DB2-COUNT-EXP-SCN.                      04826018
048270                                                                  04827018
048280                                                                  04828018
048290     EXEC SQL                                                     04829018
048300          SELECT  COUNT(*)                                        04830018
048310          INTO  :PV-DB2-COUNT-EXP-SCN                             04831018
048320          FROM   TSHIPMT A                                        04832018
048330                ,TSHPTPO B                                        04833018
048340                ,TPKSLIP C                                        04834018
048350                ,TINPKSU D                                        04835018
048360                ,TSHPUNT E                                        04836018
048370          WHERE A.TRIP_ID = :DK-TRIP-ID                           04837018
048380            AND B.PO_NBR   = :DK-PO-NBR                           04838018
048390            AND B.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   04839018
048400            AND B.PO_NBR   = C.PO_NBR                             04840018
048410            AND B.REC_SEQ_NBR = C.REC_SEQ_NBR                     04841018
048420            AND B.PRIM_SHIPT_IND= 'Y'                             04842018
048430            AND C.VER_STAT_CDE = 'A'                              04843018
048440            AND B.PO_NBR   = D.PO_NBR                             04844018
048450            AND D.SEQ_NBR   = C.SEQ_NBR                           04845018
048460            AND A.SHIPT_ID = B.SHIPT_ID                           04846018
048470            AND D.SHIPT_UNT_ID = E.SHIPT_UNT_ID                   04847018
048480            AND E.ACTV_IND = 'A'                                  04848018
048490     END-EXEC                                                     04849018
048500                                                                  04850018
048510                                                                  04851018
048520     EVALUATE TRUE                                                04852018
048530         WHEN SQLCODE = ZERO                                      04853018
048540         WHEN SQLCODE = +100                                      04854018
048550              CONTINUE                                            04855018
048560         WHEN SQLWARN0 NOT = SPACE                                04856018
048570         WHEN SQLCODE NOT = ZERO                                  04857018
048580              MOVE '4320-SELECT-EXPECTD-CNT'                      04858018
048590                               TO DP013-PARAGRAPH                 04859018
048600              MOVE 'FETCH MESSAGE CURSOR'                         04860018
048610                               TO DP013-MESSAGE-TEXT (1)          04861018
048620              MOVE DK-PO-NBR  TO PV-ERROR-PO                      04862018
048630              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 04863018
048640              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         04864018
048650              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       04865018
048660              MOVE SQLCA       TO DP013-SQLCA                     04866018
048670              SET DP013-DB2-ABEND                                 04867018
048680                               TO TRUE                            04868018
048690              PERFORM DP013-0000-PROCESS-ABEND                    04869018
048700     END-EVALUATE.                                                04870018
048710                                                                  04871018
048720                                                                  04872018
048730******************************************************************04873018
048740* CHECK IF RECEIVER IS ATTACHED TO A TRAILER.                     04874018
048750******************************************************************04875018
048760                                                                  04876018
048770 4325-REC-ATTACHED-TRLR.                                          04877018
048780     MOVE ZEROS    TO  PV-PO-ATTACH-TRLR.                         04878018
048790                                                                  04879018
048800     EXEC SQL                                                     04880018
048810          SELECT  A.PO_NBR                                        04881018
048820          INTO  :PV-PO-ATTACH-TRLR                                04882018
048830          FROM   TSHPTPO A                                        04883018
048840                ,TSHIPMT B                                        04884018
048850          WHERE A.PO_NBR      = :DK-PO-NBR                        04885018
048860            AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   04886018
048870            AND A.SHIPT_ID    = B.SHIPT_ID                        04887018
048880            AND B.TRIP_ID     = :DK-TRIP-ID                       04888018
048890            AND A.PRIM_SHIPT_IND = 'Y'                            04889018
048900            FETCH FIRST 1 ROW ONLY                                04890018
048910     END-EXEC                                                     04891018
048920                                                                  04892018
048930                                                                  04893018
048940     EVALUATE TRUE                                                04894018
048950         WHEN SQLCODE = ZERO                                      04895018
048960         WHEN SQLCODE = -811                                      04896018
048970                                                                  04897018
048980              SET ASC-REC-ATCHD-TRLR (ASC-BLK-SUB ASC-ITEM-SUB)   04898018
048990                                                TO TRUE           04899018
049000         WHEN SQLCODE = +100                                      04900018
049010              SET ASC-REC-ATCHD-TRLR-NO (ASC-BLK-SUB ASC-ITEM-SUB)04901018
049020                                                TO TRUE           04902018
049030                                                                  04903018
049040         WHEN SQLWARN0 NOT = SPACE                                04904018
049050         WHEN SQLCODE NOT = ZERO                                  04905018
049060              MOVE '4325-REC-ATTACHED-TRLR'                       04906018
049070                               TO DP013-PARAGRAPH                 04907018
049080              MOVE 'CHECK FOR FREE ASTRAY'                        04908018
049090                               TO DP013-MESSAGE-TEXT (1)          04909018
049100              MOVE DK-PO-NBR  TO PV-ERROR-PO                      04910018
049110              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 04911018
049120              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         04912018
049130              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       04913018
049140              MOVE SQLCA       TO DP013-SQLCA                     04914018
049150              SET DP013-DB2-ABEND                                 04915018
049160                               TO TRUE                            04916018
049170              PERFORM DP013-0000-PROCESS-ABEND                    04917018
049180     END-EVALUATE.                                                04918018
049190/                                                                 04919018
049200******************************************************************04920018
049210* CHECK IF PACKSLIPS ATTACHED TO RECEIVER IS TRANSCRIBED.         04921018
049220******************************************************************04922018
049230                                                                  04923018
049240 4326-REC-TRNSCRBD.                                               04924018
049250     MOVE ZEROS    TO  PV-PO-RCVR-TRANSCRB.                       04925018
049260                                                                  04926018
049270     EXEC SQL                                                     04927018
049280          SELECT  A.PO_NBR                                        04928018
049290          INTO  :PV-PO-RCVR-TRANSCRB                              04929018
049300          FROM   TPKSLIP A                                        04930018
049310          WHERE A.PO_NBR        = :DK-PO-NBR                      04931018
049320            AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 04932018
049330            AND A.VER_STAT_CDE  = 'A'                             04933018
049340            AND A.PKSL_STAT_CDE = 'AC'                            04934018
049350            FETCH FIRST 1 ROW ONLY                                04935018
049360     END-EXEC                                                     04936018
049370                                                                  04937018
049380                                                                  04938018
049390     EVALUATE TRUE                                                04939018
049400         WHEN SQLCODE = ZERO                                      04940018
049410         WHEN SQLCODE = -811                                      04941018
049420              SET ASC-REC-TRNSCRBD    (ASC-BLK-SUB ASC-ITEM-SUB)  04942018
049430                                              TO TRUE             04943018
049440         WHEN SQLCODE = +100                                      04944018
049450              SET ASC-REC-TRNSCRBD-NO (ASC-BLK-SUB ASC-ITEM-SUB)  04945018
049460                                              TO TRUE             04946018
049470                                                                  04947018
049480         WHEN SQLWARN0 NOT = SPACE                                04948018
049490         WHEN SQLCODE NOT = ZERO                                  04949018
049500              MOVE '4326-REC-TRNSCRBD'                            04950018
049510                               TO DP013-PARAGRAPH                 04951018
049520              MOVE 'CHECK TRANSCRIBED PACKSLIPS'                  04952018
049530                               TO DP013-MESSAGE-TEXT (1)          04953018
049540              MOVE DK-PO-NBR  TO PV-ERROR-PO                      04954018
049550              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 04955018
049560              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         04956018
049570              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       04957018
049580              MOVE SQLCA       TO DP013-SQLCA                     04958018
049590              SET DP013-DB2-ABEND                                 04959018
049600                               TO TRUE                            04960018
049610              PERFORM DP013-0000-PROCESS-ABEND                    04961018
049620     END-EVALUATE.                                                04962018
049630                                                                  04963018
049640                                                                  04964018
049650******************************************************************04965018
049660*  SELECT OPER UNIT FROM TRIPST.                                  04966018
049670******************************************************************04967018
049680 4327-SELECT-TTRIPST.                                             04968018
049690                                                                  04969018
049850         EXEC SQL                                                 04985018
049860              SELECT B.ORGN_OPER_UNT_ID                           04986018
049870                INTO :SHPUNT-ORGN-OPER-UNT-ID                     04987018
049880                FROM TSHUNLO A                                    04988018
049890                    ,TSHPUNT B                                    04989018
049900                    ,TSHUUPC C                                    04990018
049910               WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID              04991018
049920                 AND A.TRIP_ID = :DK-TRIP-ID                      04992018
049930                 AND A.OPER_UNT_ID <> B.ORGN_OPER_UNT_ID          04993018
049940                 AND C.SHIPT_UNT_ID = A.SHIPT_UNT_ID              04994018
049950                 AND C.TRN_NBR = :DK-PO-NBR + 0                   04995021
049960               FETCH FIRST 1 ROW ONLY                             04996018
049970              WITH UR                                             04997018
049980         END-EXEC                                                 04998018
049990                                                                  04999018
050000         EVALUATE TRUE                                            05000018
050010             WHEN SQLCODE = +0                                    05001018
050020             WHEN SQLCODE = -811                                  05002018
050030                 SET PS-MISDIRECT-YES   TO TRUE                   05003018
050040             WHEN SQLCODE = +100                                  05004018
050050                 SET PS-MISDIRECT-NO    TO TRUE                   05005018
050060                                                                  05006018
050070             WHEN SQLWARN0 NOT = SPACES                           05007018
050080             WHEN SQLCODE < +0                                    05008018
050090             WHEN SQLCODE > +0                                    05009018
050100                 MOVE '4327-SELECT-TTRIPST'                       05010018
050110                                   TO DP013-PARAGRAPH             05011018
050120                 MOVE 'SELECT OPER ON TTRIPST'                    05012018
050130                                   TO DP013-MESSAGE-TEXT(1)       05013018
050140                 MOVE SQLCA        TO DP013-SQLCA                 05014018
050150                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    05015018
050160                 MOVE DK-TRIP-ID   TO PV-DISPLAY-TRIP             05016018
050170                 STRING               DK-SCAC-ID '/'              05017018
050180                                      DK-ARRIVAL-DTE '/'          05018018
050190                                      DK-VEH-NBR '/'              05019018
050200                                      PV-DISPLAY-TRIP '/'         05020018
050210                 DELIMITED BY SIZE                                05021018
050220                                 INTO DP013-MESSAGE-TEXT(2)       05022018
050230                 STRING                                           05023018
050240                                      DP020-STACK-TRAN-ID(1) '/'  05024018
050250                                      DP020-STACK-TRAN-ID(2) '/'  05025018
050260                                      DP020-STACK-TRAN-ID(3) '/'  05026018
050270                                      DP020-STACK-TRAN-ID(4) '/'  05027018
050280                                      DP020-STACK-TRAN-ID(5) '/'  05028018
050290                                      DP020-STACK-TRAN-ID(6) '/'  05029018
050300                                      DP020-STACK-TRAN-ID(7) '/'  05030018
050310                                      DP020-STACK-TRAN-ID(8) '/'  05031018
050320                                      DP020-STACK-TRAN-ID(9) '/'  05032018
050330                                      DP020-STACK-TRAN-ID(10)     05033018
050340                 DELIMITED BY SIZE                                05034018
050350                                 INTO DP013-MESSAGE-TEXT(3)       05035018
050360                 SET DP013-DB2-ABEND                              05036018
050370                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05037018
050380                 PERFORM DP013-0000-PROCESS-ABEND                 05038018
050390         END-EVALUATE.                                            05039018
050400                                                                  05040018
050410******************************************************************05041018
050420*  SELECT ORIG OPER UNIT ID FROM TSHPUNT.                         05042018
050430*  DEAD CODE 1/24/2005                                            05043018
050440******************************************************************05044018
050450*4328-SELECT-TSHPUNT.                                             05045018
050460*                                                                 05046018
050470*    EXEC SQL                                                     05047018
050480*        SELECT                                                   05048018
050490*            ORGN_OPER_UNT_ID                                     05049018
050500*        INTO                                                     05050018
050510*            :SHPUNT-ORGN-OPER-UNT-ID                             05051018
050520*        FROM                                                     05052018
050530*            TSHPUNT                                              05053018
050540*        WHERE                                                    05054018
050550*            SHIPT_UNT_ID = :PV-TEMP-SHIPT-UNT-ID                 05055018
050560*        FETCH FIRST 1 ROWS ONLY                                  05056018
050570*    END-EXEC.                                                    05057018
050580*                                                                 05058018
050590*    EVALUATE TRUE                                                05059018
050600*        WHEN SQLCODE = ZERO                                      05060018
050610*        WHEN SQLCODE = -811                                      05061018
050620*            CONTINUE                                             05062018
050630*        WHEN SQLCODE = -904                                      05063018
050640*        WHEN SQLCODE = -913                                      05064018
050650*        WHEN SQLCODE = -911                                      05065018
050660*            MOVE '4328-SELECT-TSHPUNT'                           05066018
050670*                                     TO DP013-PARAGRAPH          05067018
050680*           MOVE 'TIMEOUT SELECTING TRN-NBR'                      05068018
050690*                                     TO DP013-MESSAGE-TEXT (1)   05069018
050700*            MOVE SQLCA               TO DP013-SQLCA              05070018
050710*            MOVE 'TSHPUNT '          TO DP013-DB2-TABLE-NAME (1) 05071018
050720*            SET DP013-DB2-ABEND                                  05072018
050730*                DP013-XCTL-DISPLAY-RESTART                       05073018
050740*                                     TO TRUE                     05074018
050750*            PERFORM DP013-0000-PROCESS-ABEND                     05075018
050760*        WHEN SQLWARN0 NOT = SPACES                               05076018
050770*        WHEN SQLCODE < ZERO                                      05077018
050780*        WHEN SQLCODE > ZERO                                      05078018
050790*            MOVE '4328-SELECT-TSHPUNT'                           05079018
050800*                                  TO DP013-PARAGRAPH             05080018
050810*            MOVE 'SELECT ORGN-OPR-UNT' TO DP013-MESSAGE-TEXT (1) 05081018
050820*            MOVE SQLCA        TO DP013-SQLCA                     05082018
050830*            MOVE 'TSHPUNT '          TO DP013-DB2-TABLE-NAME (1) 05083018
050840*            SET DP013-DB2-ABEND                                  05084018
050850*                DP013-XCTL-DISPLAY-RESTART TO TRUE               05085018
050860*            PERFORM DP013-0000-PROCESS-ABEND                     05086018
050870*    END-EVALUATE.                                                05087018
050880*                                                                 05088018
050890****************************************************************  05089018
050900*GET CURR OPER UNT ID FROM TRECEIV                           ***  05090018
050910****************************************************************  05091018
050920 4329-SELECT-TRECEIV.                                             05092018
050930                                                                  05093018
050940         EXEC SQL                                                 05094018
050950                SELECT CURR_OPER_UNT_ID                           05095018
050960                     , CRE_OPER_UNT_ID                            05096018
050970                INTO  :RECEIV-CURR-OPER-UNT-ID                    05097018
050980                    , :RECEIV-CRE-OPER-UNT-ID                     05098018
050990                FROM    TRECEIV                                   05099018
051000                WHERE   ORD_NBR     = :DK-PO-NBR                  05100018
051010                  AND   REC_SEQ_NBR = :DK-REC-SEQ-NBR             05101018
051020         END-EXEC                                                 05102018
051030                                                                  05103018
051040         EVALUATE TRUE                                            05104018
051050             WHEN SQLCODE = ZERO                                  05105018
051060                  CONTINUE                                        05106018
051070             WHEN SQLCODE = +100                                  05107018
051080                  MOVE +0   TO RECEIV-CURR-OPER-UNT-ID            05108018
051090             WHEN SQLWARN0 NOT = SPACE                            05109018
051100             WHEN SQLCODE NOT = ZERO                              05110018
051110                  MOVE '4329-SELECT-TRECEIV'                      05111018
051120                                   TO DP013-PARAGRAPH             05112018
051130                  MOVE 'FETCH CURRENT OPER'                       05113018
051140                                   TO DP013-MESSAGE-TEXT (1)      05114018
051150                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05115018
051160                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05116018
051170                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05117018
051180                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05118018
051190                  MOVE SQLCA       TO DP013-SQLCA                 05119018
051200                  SET DP013-DB2-ABEND                             05120018
051210                                   TO TRUE                        05121018
051220                  PERFORM DP013-0000-PROCESS-ABEND                05122018
051230         END-EVALUATE.                                            05123018
051240******************************************************************05124018
051250 4330-SELECT-SCANNED-CNT.                                         05125018
051260      INITIALIZE             PV-DB2-COUNT-ACTL-SCN.               05126018
051270     EVALUATE TRUE                                                05127018
051280       WHEN PV-UNION-TYPE = 'A'                                   05128018
051290         EXEC SQL                                                 05129018
051300              SELECT  COUNT(*)                                    05130018
051310              INTO  :PV-DB2-COUNT-ACTL-SCN                        05131018
051320              FROM   TPKSLIP A                                    05132018
051330                    ,TINPKSU B                                    05133018
051340                    ,TSHUNLO C                                    05134018
051350              WHERE A.PO_NBR   = :DK-PO-NBR                       05135018
051360                AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR               05136018
051370                AND A.VER_STAT_CDE = 'A'                          05137018
051380                AND A.PO_NBR   = B.PO_NBR                         05138018
051390                AND A.SEQ_NBR  = B.SEQ_NBR                        05139018
051400                AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID               05140018
051410                AND C.TRIP_ID = :DK-TRIP-ID                       05141018
051420             WITH UR                                              05142018
051430         END-EXEC                                                 05143018
051440                                                                  05144018
051450       WHEN  PV-UNION-TYPE =  'B'                                 05145018
051460           EXEC SQL                                               05146018
051470              SELECT COUNT(*)                                     05147018
051480              INTO  :PV-DB2-COUNT-ACTL-SCN                        05148018
051490               FROM  TPKSLIP A,                                   05149018
051500                     TINPKSU B,                                   05150018
051510                     TSHUNLO C                                    05151018
051520               WHERE A.PO_NBR = :DK-PO-NBR                        05152018
051530                 AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR              05153018
051540                 AND A.PO_NBR = B.PO_NBR                          05154018
051550                 AND A.SEQ_NBR = B.SEQ_NBR                        05155018
051560                 AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID              05156018
051570                 AND C.TRIP_ID = :DK-TRIP-ID                      05157018
051580                 AND A.VER_STAT_CDE = 'A'                         05158018
051590             WITH UR                                              05159018
051600           END-EXEC                                               05160018
051610       WHEN PV-UNION-TYPE = 'C'                                   05161018
051620         EXEC SQL                                                 05162018
051630              SELECT  COUNT(*)                                    05163018
051640              INTO  :PV-DB2-COUNT-ACTL-SCN                        05164018
051650              FROM   TSHUNLO A                                    05165018
051660                    ,TSHUUPC B                                    05166018
051670              WHERE A.TRIP_ID = :DK-TRIP-ID                       05167018
051680                AND A.SHIPT_UNT_ID = B.SHIPT_UNT_ID               05168018
051690                AND B.TRN_NBR  = :DK-PO-NBR                       05169018
051700              AND NOT EXISTS                                      05170018
051710               (SELECT C.SHIPT_UNT_ID                             05171018
051720                FROM TINPKSU C                                    05172018
051730                WHERE B.SHIPT_UNT_ID  = C.SHIPT_UNT_ID)           05173018
051740*                 AND C.PO_NBR = B.TRN_NBR)                       05174018
051750             WITH UR                                              05175018
051760         END-EXEC                                                 05176018
051770       WHEN PV-UNION-TYPE = 'D'                                   05177018
051780         EXEC SQL                                                 05178018
051790              SELECT  COUNT(*)                                    05179018
051800              INTO  :PV-DB2-COUNT-ACTL-SCN                        05180018
051810              FROM   TSHUNLO A                                    05181018
051820                    ,TINPKSU B                                    05182018
051830                    ,TPKSLIP C                                    05183018
051840              WHERE A.TRIP_ID = :DK-TRIP-ID                       05184018
051850                AND A.SHIPT_UNT_ID = B.SHIPT_UNT_ID               05185018
051860                AND B.PO_NBR  = :DK-PO-NBR                        05186018
051870                AND B.PO_NBR  = C.PO_NBR                          05187018
051880                AND B.SEQ_NBR = C.SEQ_NBR                         05188018
051890                AND C.VER_STAT_CDE = 'A'                          05189018
051900                AND C.REC_SEQ_NBR = :DK-REC-SEQ-NBR               05190018
051910             WITH UR                                              05191018
051920         END-EXEC                                                 05192018
051930       WHEN PV-UNION-TYPE = 'E'                                   05193018
051940         EXEC SQL                                                 05194018
051950              SELECT  COUNT(*)                                    05195018
051960              INTO  :PV-DB2-COUNT-ACTL-SCN                        05196018
051970              FROM   TSHUNLO A                                    05197018
051980                    ,TINPKSU B                                    05198018
051990                    ,TPKSLIP C                                    05199018
052000              WHERE A.TRIP_ID = :DK-TRIP-ID                       05200018
052010                AND A.SHIPT_UNT_ID = B.SHIPT_UNT_ID               05201018
052020                AND B.PO_NBR  = :DK-PO-NBR                        05202018
052030                AND B.PO_NBR  = C.PO_NBR                          05203018
052040                AND B.SEQ_NBR = C.SEQ_NBR                         05204018
052050                AND C.PKSL_STAT_CDE = 'DE'                        05205018
052060             WITH UR                                              05206018
052070         END-EXEC                                                 05207018
052080     END-EVALUATE                                                 05208018
052090                                                                  05209018
052100                                                                  05210018
052110     EVALUATE TRUE                                                05211018
052120         WHEN SQLCODE = ZERO                                      05212018
052130         WHEN SQLCODE = +100                                      05213018
052140              CONTINUE                                            05214018
052150         WHEN SQLWARN0 NOT = SPACE                                05215018
052160         WHEN SQLCODE NOT = ZERO                                  05216018
052170              MOVE '4330-SELECT-SCANNED-CNT'                      05217018
052180                               TO DP013-PARAGRAPH                 05218018
052190              MOVE 'FETCH MESSAGE CURSOR'                         05219018
052200                               TO DP013-MESSAGE-TEXT (1)          05220018
052210              MOVE DK-PO-NBR  TO PV-ERROR-PO                      05221018
052220              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 05222018
052230              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         05223018
052240              MOVE DK-TRIP-ID     TO PV-ERROR-TRIP                05224018
052250              MOVE PV-UNION-TYPE  TO PV-ERROR-TYPE                05225018
052260              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       05226018
052270              MOVE SQLCA       TO DP013-SQLCA                     05227018
052280              SET DP013-DB2-ABEND                                 05228018
052290                               TO TRUE                            05229018
052300              PERFORM DP013-0000-PROCESS-ABEND                    05230018
052310     END-EVALUATE.                                                05231018
052320                                                                  05232018
052330                                                                  05233018
052331*----------------------------------------------------------------*05233147
052332* CHECK BULK RECEIVER HAS ONLY SINGLE SKU CARTONS                *05233247
052333*----------------------------------------------------------------*05233347
052334 4335-CHECK-BULK-SINGLE-SKU.                                      05233447
052335                                                                  05233547
052336     MOVE  ZEROES  TO  PV-BULK-MULT-SKU.                          05233647
052337                                                                  05233747
052346                                                                  05234647
052347     EXEC SQL                                                     05234747
052348          SELECT D.SHIPT_UNT_ID                                   05234847
052349               , COUNT(DISTINCT(D.TRN_LNE_NBR))                   05234947
052350            INTO :SHUUPC-SHIPT-UNT-ID                             05235047
052351               , :PV-BULK-MULT-SKU                                05235147
052352            FROM TRECEIV A                                        05235247
052353               , TPKSLIP B                                        05235347
052354               , TINPKSU C                                        05235447
052355               , TSHUUPC D                                        05235547
052356           WHERE A.ORD_NBR       = :DK-ORD-NBR                    05235647
052357             AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                05235747
052358             AND A.PKGNG_CDE     = 'B'                            05235847
052359             AND A.ORD_NBR       =  B.PO_NBR                      05235947
052360             AND A.REC_SEQ_NBR   =  B.REC_SEQ_NBR                 05236047
052361             AND B.PO_NBR        =  C.PO_NBR                      05236147
052362             AND B.SEQ_NBR       =  C.SEQ_NBR                     05236247
052363             AND C.SHIPT_UNT_ID  =  D.SHIPT_UNT_ID                05236347
052364           GROUP BY D.SHIPT_UNT_ID                                05236447
052365           HAVING COUNT(DISTINCT(D.TRN_LNE_NBR)) > 1              05236547
052366           FETCH FIRST 1 ROW ONLY                                 05236647
052367       WITH UR                                                    05236747
052368     END-EXEC.                                                    05236847
052369                                                                  05236947
052370     EVALUATE TRUE                                                05237047
052371         WHEN SQLCODE = +0                                        05237147
052372         WHEN SQLCODE = +100                                      05237247
052373         WHEN SQLCODE = -811                                      05237347
052374         WHEN SQLCODE = -904                                      05237447
052375         WHEN SQLCODE = -913                                      05237547
052376             CONTINUE                                             05237647
052377                                                                  05237747
052378         WHEN SQLWARN0 NOT = SPACE                                05237847
052379         WHEN SQLCODE < +0                                        05237947
052380         WHEN SQLCODE > +0                                        05238047
052381              MOVE '4335-CHECK-BULK-SINGLE-SKU'                   05238147
052382                           TO DP013-PARAGRAPH                     05238247
052383              MOVE 'FETCH MESSAGE CURSOR'                         05238347
052384                           TO DP013-MESSAGE-TEXT (1)              05238447
052385              MOVE DK-PO-NBR  TO PV-ERROR-PO                      05238547
052386              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 05238647
052387              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         05238747
052388              MOVE DK-TRIP-ID     TO PV-ERROR-TRIP                05238847
052389              MOVE PV-UNION-TYPE  TO PV-ERROR-TYPE                05238947
052390              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       05239047
052391              MOVE SQLCA          TO DP013-SQLCA                  05239147
052392              SET DP013-DB2-ABEND                                 05239247
052393                                  TO TRUE                         05239347
052394              PERFORM DP013-0000-PROCESS-ABEND                    05239447
052409     END-EVALUATE.                                                05240947
052430                                                                  05243047
052431                                                                  05243147
052432*----------------------------------------------------------------*05243247
052433*                                                                *05243347
052434*----------------------------------------------------------------*05243447
052435 4340-SELECT-TOT-EXP-AND-ACTUAL.                                  05243547
052436     IF  PV-UNION-TYPE    = 'A'                                   05243647
052437                                                                  05243747
052438         EXEC SQL                                                 05243847
052439                SELECT SUM(EXPTED_CART_CNT)                       05243947
052440                INTO  :PV-DB2-COUNT-MANIFEST                      05244047
052441                FROM    TSHPTPO                                   05244147
052442                WHERE   PO_NBR      = :DK-PO-NBR                  05244247
052443                  AND   REC_SEQ_NBR = :DK-REC-SEQ-NBR             05244347
052444         END-EXEC                                                 05244418
052445         EVALUATE TRUE                                            05244518
052450             WHEN SQLCODE = ZERO                                  05245018
052460                  CONTINUE                                        05246018
052470             WHEN SQLCODE = +100                                  05247018
052480             WHEN SQLCODE = -305                                  05248018
052490                  MOVE ZEROES TO PV-DB2-COUNT-MANIFEST            05249018
052500             WHEN SQLWARN0 NOT = SPACE                            05250018
052510             WHEN SQLCODE NOT = ZERO                              05251018
052520                  MOVE '4340-SELECT-TOT-EXP-AND-ACTUAL'           05252018
052530                                   TO DP013-PARAGRAPH             05253018
052540                  MOVE 'FETCH MESSAGE CURSOR'                     05254018
052550                                   TO DP013-MESSAGE-TEXT (1)      05255018
052560                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05256018
052570                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05257018
052580                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05258018
052590                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05259018
052600                  MOVE SQLCA       TO DP013-SQLCA                 05260018
052610                  SET DP013-DB2-ABEND                             05261018
052620                                   TO TRUE                        05262018
052630                  PERFORM DP013-0000-PROCESS-ABEND                05263018
052640         END-EVALUATE                                             05264018
052650                                                                  05265018
052660**GB 6/12/00                                                      05266018
052670         EXEC SQL                                                 05267018
052680                SELECT ACTL_CART_CNT                              05268018
052690                INTO  :PV-DB2-COUNT-ACTL-CTN                      05269018
052700                FROM    TRECEIV                                   05270018
052710                WHERE   ORD_NBR     = :DK-PO-NBR                  05271018
052720                  AND   REC_SEQ_NBR = :DK-REC-SEQ-NBR             05272018
052730         END-EXEC                                                 05273018
052740                                                                  05274018
052750         EVALUATE TRUE                                            05275018
052760             WHEN SQLCODE = ZERO                                  05276018
052770                  CONTINUE                                        05277018
052780             WHEN SQLCODE = +100                                  05278018
052790                  MOVE ZEROES TO PV-DB2-COUNT-ACTL-CTN            05279018
052800             WHEN SQLWARN0 NOT = SPACE                            05280018
052810             WHEN SQLCODE NOT = ZERO                              05281018
052820                  MOVE '4340-SELECT-TOT-EXP-AND-ACTUAL'           05282018
052830                                   TO DP013-PARAGRAPH             05283018
052840                  MOVE 'FETCH MESSAGE CURSOR'                     05284018
052850                                   TO DP013-MESSAGE-TEXT (1)      05285018
052860                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05286018
052870                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05287018
052880                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05288018
052890                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05289018
052900                  MOVE SQLCA       TO DP013-SQLCA                 05290018
052910                  SET DP013-DB2-ABEND                             05291018
052920                                   TO TRUE                        05292018
052930                  PERFORM DP013-0000-PROCESS-ABEND                05293018
052940         END-EVALUATE                                             05294018
052950     ELSE                                                         05295018
052960          MOVE ZERO TO PV-DB2-COUNT-MANIFEST                      05296018
052970          MOVE ZERO TO PV-DB2-COUNT-ACTL-CTN                      05297018
052980     END-IF.                                                      05298018
052990                                                                  05299018
053000*----------------------------------------------------------------*05300018
053010*    CALCULATE PERCENT SCANNED                                   *05301018
053020*----------------------------------------------------------------*05302018
053030                                                                  05303018
053040 4350-CALCULATE-PERCENT-SCANNED.                                  05304018
053050     IF PV-DB2-COUNT-EXP-SCN > ZERO                               05305018
053060       DIVIDE PV-DB2-COUNT-ACTL-SCN BY PV-DB2-COUNT-EXP-SCN       05306018
053070         GIVING PV-DIVIDEND ROUNDED                               05307018
053080         MULTIPLY PV-DIVIDEND BY 100                              05308018
053090             GIVING PV-PERCENT-SCANNED                            05309018
053100     ELSE                                                         05310018
053110         MOVE ZEROES  TO  PV-DIVIDEND                             05311018
053120                          PV-PERCENT-SCANNED                      05312018
053130     END-IF.                                                      05313018
053140                                                                  05314018
053150*----------------------------------------------------------------*05315018
053160*    GET PURCHASE ORDER INFO                                     *05316018
053170*----------------------------------------------------------------*05317018
053180 4360-GET-PO-INFO.                                                05318018
053190                                                                  05319018
053200     PERFORM                                                      05320018
053210         WITH TEST AFTER                                          05321018
053220         VARYING PV-RETRY-COUNTER                                 05322018
053230         FROM 1 BY 1                                              05323018
053240         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05324018
053250            OR (SQLCODE = +0)                                     05325018
053260            OR (SQLCODE = +100))                                  05326018
053270                                                                  05327018
053280         EXEC SQL                                                 05328018
053290            SELECT  A.DEPT_NBR                                    05329018
053300***                ,A.PKGNG_CDE                                   05330018
053310                   ,A.SEASET_SHRT_NM                              05331018
053320                   ,B.ENT_NAME_DESC                               05332018
053330              INTO :PURCHS-DEPT-NBR                               05333018
053340***               ,:PURCHS-PKGNG-CDE                              05334018
053350                  ,:PURCHS-SEASET-SHRT-NM                         05335018
053360                  ,:ENTNME-ENT-NAME-DESC                          05336018
053370              FROM  TPURCHS A                                     05337018
053380                   ,TENTNME B                                     05338018
053390          WHERE A.PO_NBR         = :DK-PO-NBR                     05339018
053400            AND A.VER_STATUS_CDE = 'A'                            05340018
053410            AND B.TYPE_CDE       = '01'                           05341018
053420            AND A.ENT_ID = B.ENT_ID                               05342018
053430         END-EXEC                                                 05343018
053440                                                                  05344018
053450         EVALUATE TRUE                                            05345018
053460             WHEN SQLCODE = +0                                    05346018
053470             WHEN SQLCODE = +100                                  05347018
053480             WHEN SQLCODE = -904                                  05348018
053490             WHEN SQLCODE = -913                                  05349018
053500                 CONTINUE                                         05350018
053510                                                                  05351018
053520             WHEN SQLWARN0 NOT = SPACE                            05352018
053530             WHEN SQLCODE < +0                                    05353018
053540             WHEN SQLCODE > +0                                    05354018
053550                 MOVE '4360-GET-PO-INFO'                          05355018
053560                                 TO DP013-PARAGRAPH               05356018
053570                 MOVE 'SELECT ON TPURCHS'                         05357018
053580                                 TO DP013-MESSAGE-TEXT (1)        05358018
053590                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   05359018
053600                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              05360018
053610                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      05361018
053620                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    05362018
053630                 MOVE SQLCA      TO DP013-SQLCA                   05363018
053640                 MOVE 'TPURCHS'  TO DP013-DB2-TABLE-NAME (1)      05364018
053650                 MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (2)      05365018
053660                 SET DP013-DB2-ABEND                              05366018
053670                                 TO TRUE                          05367018
053680                 SET DP013-XCTL-DISPLAY-RESTART                   05368018
053690                                 TO TRUE                          05369018
053700                 PERFORM DP013-0000-PROCESS-ABEND                 05370018
053710         END-EVALUATE                                             05371018
053720     END-PERFORM.                                                 05372018
053730                                                                  05373018
053740     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05374018
053750         SQLCODE NOT = +0                                         05375018
053760         MOVE '4360-GET-PO-INFO'                                  05376018
053770                                 TO DP013-PARAGRAPH               05377018
053780         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05378018
053790                                 TO DP013-MESSAGE-TEXT (1)        05379018
053800         MOVE 'PURCHASE ORDER INFO'                               05380018
053810                                 TO DP013-MESSAGE-TEXT (2)        05381018
053820         MOVE SQLCA              TO DP013-SQLCA                   05382018
053830         MOVE 'TPURCHS'          TO DP013-DB2-TABLE-NAME (1)      05383018
053840         MOVE 'TENTNME'          TO DP013-DB2-TABLE-NAME (2)      05384018
053850         SET DP013-DB2-ABEND     TO TRUE                          05385018
053860         SET DP013-XCTL-DISPLAY-RESTART                           05386018
053870                                 TO TRUE                          05387018
053880         PERFORM DP013-0000-PROCESS-ABEND                         05388018
053890     END-IF.                                                      05389018
053900                                                                  05390018
053910                                                                  05391018
053920                                                                  05392018
053930 4361-CHECK-FOR-PBS-ERRORS.                                       05393018
053940                                                                  05394018
053950     MOVE ZERO                        TO PV-PO-PBS-ERROR          05395018
053960                                                                  05396018
053970     EXEC SQL                                                     05397018
053980         SELECT  A.PO_NBR                                         05398018
053990         INTO  :PV-PO-PBS-ERROR                                   05399018
054000         FROM   TPKSLIP A                                         05400018
054010               ,TINPKSU B                                         05401018
054020               ,TSHUNLO C                                         05402018
054030         WHERE A.PO_NBR   = :DK-PO-NBR                            05403018
054040           AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                    05404018
054050           AND A.VER_STAT_CDE = 'A'                               05405018
054060           AND A.PO_NBR   = B.PO_NBR                              05406018
054070           AND A.SEQ_NBR  = B.SEQ_NBR                             05407018
054080           AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID                    05408018
054090           AND C.SCN_LOC_ID IN                                    05409018
054100                 ('PBSA', 'PBSB', 'PBSC','PBSD','PBSE')           05410018
054110           FETCH FIRST 1 ROW ONLY                                 05411018
054120     END-EXEC                                                     05412018
054130                                                                  05413018
054140     EVALUATE TRUE                                                05414018
054150         WHEN SQLCODE = ZERO                                      05415018
054160         WHEN SQLCODE = -811                                      05416018
054170              SET PS-PBS-ERRORS-FOUND TO TRUE                     05417018
054180                                                                  05418018
054190         WHEN SQLCODE = +100                                      05419018
054200              SET PS-PBS-ERRORS-FOUND-NO TO TRUE                  05420018
054210                                                                  05421018
054220         WHEN SQLWARN0 NOT = SPACE                                05422018
054230         WHEN SQLCODE NOT = ZERO                                  05423018
054240              MOVE '4361-CHECK-FOR-PBS-ERRORS'                    05424018
054250                               TO DP013-PARAGRAPH                 05425018
054260              MOVE 'CHECK FOR PBS ERRORS'                         05426018
054270                               TO DP013-MESSAGE-TEXT (1)          05427018
054280              MOVE SQLCA       TO DP013-SQLCA                     05428018
054290              SET DP013-DB2-ABEND                                 05429018
054300                               TO TRUE                            05430018
054310              PERFORM DP013-0000-PROCESS-ABEND                    05431018
054320     END-EVALUATE.                                                05432018
054330                                                                  05433018
054340*----------------------------------------------------------------*05434018
054350*     CHECK TO SEE IF OPERATING UNIT IS A STORE                  *05435018
054360*----------------------------------------------------------------*05436018
054370 4365-CHECK-DIRECT-STORE.                                         05437018
054380                                                                  05438018
054390     INITIALIZE XL071-COMMAREA-REC.                               05439018
054400     MOVE DK-STORE-NMBR              TO XL071-LOCATION-NUMBER.    05440018
054410                                                                  05441018
054420     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  05442018
054430                                        XL071-COMMAREA            05443018
054440                                        XL071-COMMAREA-REC.       05444018
054450                                                                  05445018
054460     EVALUATE TRUE                                                05446018
054470         WHEN XL071-NO-ERRORS                                     05447018
054480            CONTINUE                                              05448018
054490         WHEN OTHER                                               05449018
054500            MOVE '4365-CHECK-DIRECT-STORE'                        05450018
054510                                   TO DP013-PARAGRAPH             05451018
054520            INITIALIZE PV-CICS-MSG-AREA                           05452018
054530            STRING ' RCKCS815 - CALL XLKUT071 -'                  05453018
054540                   ' SQLCODE=' XL071-SQLCODE                      05454018
054550                   ' TABLE='   XL071-DB2-TABLE                    05455018
054560                                            DELIMITED BY SIZE     05456018
054570                                       INTO PV-CICS-MSG-AREA      05457018
054580            PERFORM 9900-WRITE-CICS-LOG                           05458018
054590                                                                  05459018
054600*           PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                05460018
054610*           PERFORM 9900A-SOFT-ABORT                              05461018
054620            SET DP013-DB2-ABEND                                   05462018
054630                DP013-XCTL-DISPLAY-RESTART                        05463018
054640                                 TO TRUE                          05464018
054650            PERFORM DP013-0000-PROCESS-ABEND                      05465018
054660     END-EVALUATE.                                                05466018
054670/                                                                 05467018
054680*----------------------------------------------------------------*05468018
054690*    GET RECEIVER INFO                                           *05469018
054700*----------------------------------------------------------------*05470018
054710 4370-GET-RECEIVER-INFO.                                          05471018
054720                                                                  05472018
054730     PERFORM                                                      05473018
054740         WITH TEST AFTER                                          05474018
054750         VARYING PV-RETRY-COUNTER                                 05475018
054760         FROM 1 BY 1                                              05476018
054770         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05477018
054780            OR (SQLCODE = +0)                                     05478018
054790            OR (SQLCODE = +100))                                  05479018
054800                                                                  05480018
054810         EXEC SQL                                                 05481018
054820            SELECT  STATUS_CDE                                    05482018
054830                   ,PRE_TKT_IND                                   05483018
054840                   ,AD_INFO_DESC                                  05484018
054850                   ,PACK_BY_ST_IND                                05485018
054860                   ,REC_TYP_CDE                                   05486018
054870                   ,RCVG_CLERK_INIT_ID                            05487018
054880                   ,OPER_UNT_ID                                   05488018
054890                   ,FCLTY_ID                                      05489018
054900                   ,GOH_IND                                       05490018
054910                   ,PKGNG_CDE                                     05491018
054920                   ,FRE_ASTRA_IND                                 05492018
054930                   ,CRE_UID                                       05493018
054940              INTO :RECEIV-STATUS-CDE                             05494018
054950                  ,:RECEIV-PRE-TKT-IND                            05495018
054960                  ,:RECEIV-AD-INFO-DESC                           05496018
054970                  ,:RECEIV-PACK-BY-ST-IND                         05497018
054980                  ,:RECEIV-REC-TYP-CDE                            05498018
054990                  ,:RECEIV-RCVG-CLERK-INIT-ID                     05499018
055000                  ,:RECEIV-OPER-UNT-ID                            05500018
055010                  ,:RECEIV-FCLTY-ID                               05501018
055020                  ,:RECEIV-GOH-IND                                05502018
055030                  ,:RECEIV-PKGNG-CDE                              05503018
055040                  ,:RECEIV-FRE-ASTRA-IND                          05504018
055050                  ,:RECEIV-CRE-UID                                05505018
055060              FROM  TRECEIV                                       05506018
055070          WHERE ORD_NBR        = :DK-ORD-NBR                      05507018
055080            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  05508018
055090            AND VER_STATUS_CDE = 'A'                              05509018
055100         END-EXEC                                                 05510018
055110                                                                  05511018
055120         EVALUATE TRUE                                            05512018
055130             WHEN SQLCODE = +0                                    05513018
055140             WHEN SQLCODE = +100                                  05514018
055150             WHEN SQLCODE = -904                                  05515018
055160             WHEN SQLCODE = -913                                  05516018
055170                 CONTINUE                                         05517018
055180                                                                  05518018
055190             WHEN SQLWARN0 NOT = SPACE                            05519018
055200             WHEN SQLCODE < +0                                    05520018
055210             WHEN SQLCODE > +0                                    05521018
055220                 MOVE '4370-GET-RECEIVER-INFO'                    05522018
055230                                 TO DP013-PARAGRAPH               05523018
055240                 MOVE 'SELECT ON TRECEIV'                         05524018
055250                                 TO DP013-MESSAGE-TEXT (1)        05525018
055260                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   05526018
055270                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              05527018
055280                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      05528018
055290                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    05529018
055300                 MOVE SQLCA      TO DP013-SQLCA                   05530018
055310                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      05531018
055320                 SET DP013-DB2-ABEND                              05532018
055330                                 TO TRUE                          05533018
055340                 SET DP013-XCTL-DISPLAY-RESTART                   05534018
055350                                 TO TRUE                          05535018
055360                 PERFORM DP013-0000-PROCESS-ABEND                 05536018
055370         END-EVALUATE                                             05537018
055380     END-PERFORM.                                                 05538018
055390                                                                  05539018
055400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05540018
055410         SQLCODE NOT = +0                                         05541018
055420         MOVE '4370-GET-RECEIVER-INFO'                            05542018
055430                                 TO DP013-PARAGRAPH               05543018
055440         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05544018
055450                                 TO DP013-MESSAGE-TEXT (1)        05545018
055460         MOVE 'RECEIVER INFO     '                                05546018
055470                                 TO DP013-MESSAGE-TEXT (2)        05547018
055480         MOVE SQLCA              TO DP013-SQLCA                   05548018
055490         MOVE 'TRECEIV'          TO DP013-DB2-TABLE-NAME (1)      05549018
055500         SET DP013-DB2-ABEND     TO TRUE                          05550018
055510         SET DP013-XCTL-DISPLAY-RESTART                           05551018
055520                                 TO TRUE                          05552018
055530         PERFORM DP013-0000-PROCESS-ABEND                         05553018
055540     END-IF.                                                      05554018
055550                                                                  05555018
055560*----------------------------------------------------------------*05556018
055570*    COUNT SMOOTH CARTONS                                        *05557018
055580*----------------------------------------------------------------*05558018
055590 4371-COUNT-SMOOTH-CARTONS.                                       05559018
055600                                                                  05560018
055610     MOVE ZEROES  TO  PV-SHIPT-UNT-ID-SMOOTH.                     05561018
055620                                                                  05562018
055630     PERFORM                                                      05563018
055640         WITH TEST AFTER                                          05564018
055650         VARYING PV-RETRY-COUNTER                                 05565018
055660         FROM 1 BY 1                                              05566018
055670         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05567018
055680            OR (SQLCODE = +0)                                     05568018
055690            OR (SQLCODE = -811)                                   05569018
055700            OR (SQLCODE = +100))                                  05570018
055710                                                                  05571018
055720                                                                  05572018
055730         EXEC SQL                                                 05573018
055740             SELECT A.SHIPT_UNT_ID                                05574018
055750             INTO  :PV-SHIPT-UNT-ID-SMOOTH                        05575018
055760             FROM   SUT_OTBND_UPC A                               05576018
055770                   ,SUT_OTBND_CART B                              05577018
055780             WHERE A.TRN_NBR      = :DK-PO-NBR                    05578018
055790               AND A.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR               05579018
055800               AND A.SHIPT_UNT_ID =  B.SHIPT_UNT_ID               05580018
055810               AND B.CART_SRC_CDE = 'SMO'                         05581018
055820               AND B.ACTV_IND     = 'Y'                           05582018
055830             FETCH FIRST 1 ROW ONLY                               05583018
055840             WITH UR                                              05584018
055850                                                                  05585018
055860         END-EXEC                                                 05586018
055870                                                                  05587018
055880         EVALUATE TRUE                                            05588018
055890             WHEN SQLCODE = ZERO                                  05589018
055900             WHEN SQLCODE = -811                                  05590018
055910                  MOVE  1  TO  PV-DB2-COUNT                       05591018
055920             WHEN SQLCODE = +100                                  05592018
055930                  MOVE  0  TO  PV-DB2-COUNT                       05593018
055940             WHEN SQLCODE = -904                                  05594018
055950             WHEN SQLCODE = -913                                  05595018
055960                 CONTINUE                                         05596018
055970             WHEN SQLWARN0 NOT = SPACE                            05597018
055980             WHEN SQLCODE NOT = ZERO                              05598018
055990                  MOVE '4371-COUNT-SMOOTH-CARTONS'                05599018
056000                                   TO DP013-PARAGRAPH             05600018
056010                  MOVE 'COUNT SMOOTH CARTONS'                     05601018
056020                                   TO DP013-MESSAGE-TEXT (1)      05602018
056030                  MOVE SQLCA       TO DP013-SQLCA                 05603018
056040                  SET DP013-DB2-ABEND                             05604018
056050                                   TO TRUE                        05605018
056060                  PERFORM DP013-0000-PROCESS-ABEND                05606018
056070         END-EVALUATE                                             05607018
056080     END-PERFORM                                                  05608018
056090                                                                  05609018
056100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05610018
056110         SQLCODE NOT = +0     AND                                 05611018
056120         SQLCODE NOT = -811                                       05612018
056130         MOVE '4371-COUNT-SMOOTH-CARTONS'                         05613018
056140                                 TO DP013-PARAGRAPH               05614018
056150         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05615018
056160                                 TO DP013-MESSAGE-TEXT (1)        05616018
056170         MOVE 'ON SUT_OTBND_UPC' TO DP013-MESSAGE-TEXT (2)        05617018
056180         MOVE SQLCA              TO DP013-SQLCA                   05618018
056190         MOVE 'SUT_OTBND_UPC'    TO DP013-DB2-TABLE-NAME (1)      05619018
056200         MOVE 'SUT_OTBND_CART'   TO DP013-DB2-TABLE-NAME (2)      05620018
056210         SET DP013-DB2-ABEND     TO TRUE                          05621018
056220         SET DP013-XCTL-DISPLAY-RESTART                           05622018
056230                                 TO TRUE                          05623018
056240         PERFORM DP013-0000-PROCESS-ABEND                         05624018
056250     END-IF.                                                      05625018
056260/                                                                 05626018
056270*----------------------------------------------------------------*05627018
056280*    COUNT PHYSICAL LABELS                                       *05628018
056290*----------------------------------------------------------------*05629018
056300 4372-COUNT-PHYSICAL-LABELS.                                      05630018
056310                                                                  05631018
056320     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           05632018
056330                                                                  05633018
056340     PERFORM                                                      05634018
056350         WITH TEST AFTER                                          05635018
056360         VARYING PV-RETRY-COUNTER                                 05636018
056370         FROM 1 BY 1                                              05637018
056380         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05638018
056390            OR (SQLCODE = +0)                                     05639018
056400            OR (SQLCODE = -811)                                   05640018
056410            OR (SQLCODE = +100))                                  05641018
056420                                                                  05642018
056430                                                                  05643018
056440         EXEC SQL                                                 05644018
056450*3/19/13     SELECT COUNT(*)                                      05645018
056460*3/19/13     INTO  :PV-DB2-COUNT                                  05646018
056470             SELECT A.ORD_NBR                                     05647018
056480             INTO  :PV-PO-NBR-PHYSCL                              05648018
056490             FROM   TDISTHD A                                     05649018
056500             WHERE A.ORD_NBR            = :DK-PO-NBR              05650018
056510               AND A.RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR         05651018
056520               AND A.UCC128_DAT_USG_CDE IN ('I','N')              05652018
056530             FETCH FIRST 1 ROW ONLY                               05653018
056540             WITH UR                                              05654018
056550                                                                  05655018
056560         END-EXEC                                                 05656018
056570                                                                  05657018
056580         EVALUATE TRUE                                            05658018
056590             WHEN SQLCODE = ZERO                                  05659018
056600             WHEN SQLCODE = -811                                  05660018
056610                  MOVE 1  TO  PV-DB2-COUNT                        05661018
056620                                                                  05662018
056630             WHEN SQLCODE = +100                                  05663018
056640                  MOVE 0  TO  PV-DB2-COUNT                        05664018
056650                                                                  05665018
056660             WHEN SQLCODE = -904                                  05666018
056670             WHEN SQLCODE = -913                                  05667018
056680                 CONTINUE                                         05668018
056690             WHEN SQLWARN0 NOT = SPACE                            05669018
056700             WHEN SQLCODE NOT = ZERO                              05670018
056710                  MOVE '4372-COUNT-PHYSICAL-LABELS'               05671018
056720                                   TO DP013-PARAGRAPH             05672018
056730                  MOVE 'COUNT PHYSICAL LABELS'                    05673018
056740                                   TO DP013-MESSAGE-TEXT (1)      05674018
056750                  MOVE SQLCA       TO DP013-SQLCA                 05675018
056760                  SET DP013-DB2-ABEND                             05676018
056770                                   TO TRUE                        05677018
056780                  PERFORM DP013-0000-PROCESS-ABEND                05678018
056790         END-EVALUATE                                             05679018
056800     END-PERFORM                                                  05680018
056810                                                                  05681018
056820     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05682018
056830         SQLCODE NOT = +0   AND                                   05683018
056840         SQLCODE NOT = -811                                       05684018
056850         MOVE '4372-COUNT-PHYSICAL-LABELS'                        05685018
056860                                 TO DP013-PARAGRAPH               05686018
056870         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05687018
056880                                 TO DP013-MESSAGE-TEXT (1)        05688018
056890         MOVE 'ON TDISTHD'       TO DP013-MESSAGE-TEXT (2)        05689018
056900         MOVE SQLCA              TO DP013-SQLCA                   05690018
056910         MOVE 'TDISTHD'          TO DP013-DB2-TABLE-NAME (1)      05691018
056920         SET DP013-DB2-ABEND     TO TRUE                          05692018
056930         SET DP013-XCTL-DISPLAY-RESTART                           05693018
056940                                 TO TRUE                          05694018
056950         PERFORM DP013-0000-PROCESS-ABEND                         05695018
056960     END-IF.                                                      05696018
056970/                                                                 05697018
056980****************************************************************  05698018
056990*GET PKSL IND FOR HEADER LABEL.                              ***  05699018
057000****************************************************************  05700018
057010 4375-SELECT-SHPTPO.                                              05701018
057020                                                                  05702018
057030         EXEC SQL                                                 05703018
057040                SELECT PKSL_IND                                   05704018
057050                INTO  :SHPTPO-PKSL-IND                            05705018
057060                FROM    TSHPTPO                                   05706018
057070                WHERE   PO_NBR      = :DK-PO-NBR                  05707018
057080                  AND   REC_SEQ_NBR = :DK-REC-SEQ-NBR             05708018
057090         END-EXEC                                                 05709018
057100                                                                  05710018
057110         EVALUATE TRUE                                            05711018
057120             WHEN SQLCODE = ZERO                                  05712018
057130             WHEN SQLCODE = +100                                  05713018
057140             WHEN SQLCODE = -811                                  05714018
057150                  CONTINUE                                        05715018
057160             WHEN SQLWARN0 NOT = SPACE                            05716018
057170             WHEN SQLCODE NOT = ZERO                              05717018
057180                  MOVE '4375-SELECT-SHPTPO '                      05718018
057190                                   TO DP013-PARAGRAPH             05719018
057200                  MOVE 'SELECT PKSL IND '                         05720018
057210                                   TO DP013-MESSAGE-TEXT (1)      05721018
057220                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05722018
057230                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05723018
057240                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05724018
057250                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05725018
057260                  MOVE SQLCA       TO DP013-SQLCA                 05726018
057270                  SET DP013-DB2-ABEND                             05727018
057280                                   TO TRUE                        05728018
057290                  PERFORM DP013-0000-PROCESS-ABEND                05729018
057300         END-EVALUATE.                                            05730018
057310****************************************************************  05731018
057320*GET CORRECT OPER AND FACILITY WHEN GOING TO                 ***  05732018
057330*RCVRINQ OR RCVRMNT SCREENS                                  ***  05733018
057340****************************************************************  05734018
057350 4378-CHECK-OPER-AND-FACILTY.                                     05735018
057360***                                                               05736018
057370*** REMOVE SELECT OF OPER, THE KEY OPER SHOULD ALWAYS BE THE CURR 05737018
057380*** OPER WHICH IS POPULATED WHEN THE SCREEN IS BUILT GB 8/30/05   05738018
057390******************************************************************05739018
057400         EXEC SQL                                                 05740018
057410                SELECT STATUS_CDE                                 05741018
057420                INTO  :RECEIV-STATUS-CDE                          05742018
057430                FROM    TRECEIV                                   05743018
057440                WHERE   ORD_NBR     = :DK-PO-NBR                  05744018
057450                  AND   REC_SEQ_NBR = :DK-REC-SEQ-NBR             05745018
057460         END-EXEC                                                 05746018
057470                                                                  05747018
057480         EVALUATE TRUE                                            05748018
057490             WHEN SQLCODE = ZERO                                  05749018
057500             WHEN SQLCODE = +100                                  05750018
057510                  CONTINUE                                        05751018
057520             WHEN SQLWARN0 NOT = SPACE                            05752018
057530             WHEN SQLCODE NOT = ZERO                              05753018
057540                  MOVE '4378-CHECK-OPER-AND-FACILTY '             05754018
057550                                   TO DP013-PARAGRAPH             05755018
057560                  MOVE 'FETCH MESSAGE CURSOR'                     05756018
057570                                   TO DP013-MESSAGE-TEXT (1)      05757018
057580                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05758018
057590                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05759018
057600                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05760018
057610                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05761018
057620                  MOVE SQLCA       TO DP013-SQLCA                 05762018
057630                  SET DP013-DB2-ABEND                             05763018
057640                                   TO TRUE                        05764018
057650                  PERFORM DP013-0000-PROCESS-ABEND                05765018
057660         END-EVALUATE.                                            05766018
057670*----------------------------------------------------------------*05767018
057680*    RETRIEVE OPERATION SET DESCRIPTION                          *05768018
057690*----------------------------------------------------------------*05769018
057700 4380-GET-OPER-SET-DESC.                                          05770018
057710                                                                  05771018
057720     PERFORM                                                      05772018
057730         WITH TEST AFTER                                          05773018
057740         VARYING PV-RETRY-COUNTER                                 05774018
057750         FROM 1 BY 1                                              05775018
057760         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05776018
057770             OR (SQLCODE = +0)                                    05777018
057780             OR (SQLCODE = +100))                                 05778018
057790                                                                  05779018
057800         EXEC SQL                                                 05780018
057810            SELECT  DISTINCT                                      05781018
057820                    B.OPER_SET_DESC                               05782018
057830                   ,B.CNTL_DESC                                   05783018
057840              INTO :OPRSET-OPER-SET-DESC                          05784018
057850                  ,:OPRSET-CNTL-DESC                              05785018
057860              FROM  TWRKORD A                                     05786018
057870                   ,TOPRSET B                                     05787018
057880             WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID            05788018
057890               AND  A.FCLTY_ID       = :DK-FCLTY-ID               05789018
057900               AND  A.ORD_NBR        = :DK-PO-NBR                 05790018
057910               AND  A.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR            05791018
057920               AND  A.ORD_LNE_NBR    = 0                          05792018
057930               AND  A.VER_STATUS_CDE = 'A'                        05793018
057940               AND  A.OPER_SET_ID    = B.OPER_SET_ID              05794018
057950         END-EXEC                                                 05795018
057960                                                                  05796018
057970         EVALUATE TRUE                                            05797018
057980             WHEN SQLCODE = +0                                    05798018
057990             WHEN SQLCODE = +100                                  05799018
058000             WHEN SQLCODE = -904                                  05800018
058010             WHEN SQLCODE = -913                                  05801018
058020                  CONTINUE                                        05802018
058030                                                                  05803018
058040             WHEN SQLWARN0 NOT = SPACES                           05804018
058050             WHEN SQLCODE < +0                                    05805018
058060             WHEN SQLCODE > +0                                    05806018
058070                  MOVE '4380-GET-OPER-SET-DESC'                   05807018
058080                                  TO DP013-PARAGRAPH              05808018
058090                  MOVE 'UNSUCCESSFUL SELECT ON TOPRSET  '         05809018
058100                                  TO DP013-MESSAGE-TEXT (1)       05810018
058110                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05811018
058120                  MOVE DK-REC-SEQ-NBR                             05812018
058130                                  TO PV-ERROR-SEQ                 05813018
058140                  MOVE DK-OPER-UNT-ID                             05814018
058150                                  TO PV-ERROR-OPER-UNT-ID         05815018
058160                  MOVE PV-ERROR-MSG                               05816018
058170                                  TO DP013-MESSAGE-TEXT (2)       05817018
058180                  MOVE SQLCA      TO DP013-SQLCA                  05818018
058190                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (1)     05819018
058200                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)     05820018
058210                  SET DP013-DB2-ABEND                             05821018
058220                      DP013-XCTL-DISPLAY-RESTART                  05822018
058230                                  TO TRUE                         05823018
058240                  PERFORM DP013-0000-PROCESS-ABEND                05824018
058250         END-EVALUATE                                             05825018
058260     END-PERFORM.                                                 05826018
058270                                                                  05827018
058280     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05828018
058290         SQLCODE NOT = +0                                         05829018
058300         MOVE '4380-GET-OPER-SET-DESC'                            05830018
058310                                  TO DP013-PARAGRAPH              05831018
058320         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TOPRSET  '       05832018
058330                                  TO DP013-MESSAGE-TEXT (1)       05833018
058340         MOVE SQLCA               TO DP013-SQLCA                  05834018
058350         MOVE 'TWRKORD '          TO DP013-DB2-TABLE-NAME (1)     05835018
058360         MOVE 'TOPRSET '          TO DP013-DB2-TABLE-NAME (2)     05836018
058370         SET DP013-DB2-ABEND                                      05837018
058380             DP013-XCTL-DISPLAY-RESTART                           05838018
058390                                  TO TRUE                         05839018
058400         PERFORM DP013-0000-PROCESS-ABEND                         05840018
058410     END-IF.                                                      05841018
058420                                                                  05842018
058430                                                                  05843018
058440*----------------------------------------------------------------*05844018
058450*    GET THE EARLIEST AD DATE                                    *05845018
058460*----------------------------------------------------------------*05846018
058470 4385-GET-AD-DATE.                                                05847018
058480                                                                  05848018
058490     PERFORM                                                      05849018
058500         WITH TEST AFTER                                          05850018
058510         VARYING PV-RETRY-COUNTER                                 05851018
058520         FROM 1 BY 1                                              05852018
058530         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05853018
058540             OR (SQLCODE = +0)                                    05854018
058550             OR (SQLCODE = -305))                                 05855018
058560                                                                  05856018
058570         EXEC SQL                                                 05857018
058580              SELECT MIN(AD_EVNT_DTE)                             05858018
058590                INTO :PURITM-AD-EVNT-DTE                          05859018
058600                       :DN-AD-EVNT-DTE                            05860018
058610                FROM TPURITM                                      05861018
058620               WHERE PO_NBR         = :DK-PO-NBR                  05862018
058630                 AND VER_STATUS_CDE = 'A'                         05863018
058640                 AND AD_EVNT_DTE > '0001-01-01'                   05864018
058650         END-EXEC                                                 05865018
058660                                                                  05866018
058670         EVALUATE TRUE                                            05867018
058680             WHEN SQLCODE = +0                                    05868018
058690             WHEN SQLCODE = -305                                  05869018
058700             WHEN SQLCODE = -904                                  05870018
058710             WHEN SQLCODE = -913                                  05871018
058720                  CONTINUE                                        05872018
058730                                                                  05873018
058740             WHEN SQLWARN0 NOT = SPACES                           05874018
058750             WHEN SQLCODE < +0                                    05875018
058760             WHEN SQLCODE > +0                                    05876018
058770                  MOVE '4385-GET-AD-DATE'                         05877018
058780                                  TO DP013-PARAGRAPH              05878018
058790                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           05879018
058800                                  TO DP013-MESSAGE-TEXT (1)       05880018
058810                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05881018
058820                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05882018
058830                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05883018
058840                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05884018
058850                  MOVE SQLCA      TO DP013-SQLCA                  05885018
058860                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     05886018
058870                  SET DP013-DB2-ABEND                             05887018
058880                      DP013-XCTL-DISPLAY-RESTART                  05888018
058890                                  TO TRUE                         05889018
058900                  PERFORM DP013-0000-PROCESS-ABEND                05890018
058910         END-EVALUATE                                             05891018
058920     END-PERFORM.                                                 05892018
058930                                                                  05893018
058940     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05894018
058950         SQLCODE NOT = +0                                         05895018
058960         MOVE '4385-GET-AD-DATE'                                  05896018
058970                                  TO DP013-PARAGRAPH              05897018
058980         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            05898018
058990                                  TO DP013-MESSAGE-TEXT (1)       05899018
059000         MOVE SQLCA               TO DP013-SQLCA                  05900018
059010         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     05901018
059020         SET DP013-DB2-ABEND                                      05902018
059030             DP013-XCTL-DISPLAY-RESTART                           05903018
059040                                  TO TRUE                         05904018
059050         PERFORM DP013-0000-PROCESS-ABEND                         05905018
059060     END-IF.                                                      05906018
059070                                                                  05907018
059080                                                                  05908018
059090*----------------------------------------------------------------*05909018
059100*    GET THE CLASS NUMBER                                        *05910018
059110*----------------------------------------------------------------*05911018
059120 4389-GET-CL-NBR.                                                 05912018
059130                                                                  05913018
059140     PERFORM                                                      05914018
059150         WITH TEST AFTER                                          05915018
059160         VARYING PV-RETRY-COUNTER                                 05916018
059170         FROM 1 BY 1                                              05917018
059180         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05918018
059190             OR (SQLCODE = +0)                                    05919018
059200             OR (SQLCODE = +100))                                 05920018
059210                                                                  05921018
059220         EXEC SQL                                                 05922018
059230              SELECT A.CL_NBR                                     05923018
059240                INTO :PURITM-CL-NBR                               05924018
059250                FROM TPURITM A                                    05925018
059260               WHERE A.PO_NBR         = :DK-PO-NBR                05926018
059270                 AND A.VER_STATUS_CDE = 'A'                       05927018
059280                 AND A.PO_LNE_NBR =                               05928018
059290                  (SELECT MIN(B.PO_LNE_NBR)                       05929018
059300                    FROM TPURITM B                                05930018
059310                   WHERE B.PO_NBR = A.PO_NBR                      05931018
059320                     AND B.VER_STATUS_CDE = 'A')                  05932018
059330         END-EXEC                                                 05933018
059340                                                                  05934018
059350         EVALUATE TRUE                                            05935018
059360             WHEN SQLCODE = +0                                    05936018
059370             WHEN SQLCODE = +100                                  05937018
059380             WHEN SQLCODE = -904                                  05938018
059390             WHEN SQLCODE = -913                                  05939018
059400                  CONTINUE                                        05940018
059410                                                                  05941018
059420             WHEN SQLWARN0 NOT = SPACES                           05942018
059430             WHEN SQLCODE < +0                                    05943018
059440             WHEN SQLCODE > +0                                    05944018
059450                  MOVE '4389-GET-CL-NBR'                          05945018
059460                                  TO DP013-PARAGRAPH              05946018
059470                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           05947018
059480                                  TO DP013-MESSAGE-TEXT (1)       05948018
059490                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  05949018
059500                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             05950018
059510                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     05951018
059520                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   05952018
059530                  MOVE SQLCA      TO DP013-SQLCA                  05953018
059540                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     05954018
059550                  SET DP013-DB2-ABEND                             05955018
059560                      DP013-XCTL-DISPLAY-RESTART                  05956018
059570                                  TO TRUE                         05957018
059580                  PERFORM DP013-0000-PROCESS-ABEND                05958018
059590         END-EVALUATE                                             05959018
059600     END-PERFORM.                                                 05960018
059610                                                                  05961018
059620     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05962018
059630         SQLCODE NOT = +0                                         05963018
059640         MOVE '4389-GET-CL-NBR '                                  05964018
059650                                  TO DP013-PARAGRAPH              05965018
059660         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            05966018
059670                                  TO DP013-MESSAGE-TEXT (1)       05967018
059680         MOVE SQLCA               TO DP013-SQLCA                  05968018
059690         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     05969018
059700         SET DP013-DB2-ABEND                                      05970018
059710             DP013-XCTL-DISPLAY-RESTART                           05971018
059720                                  TO TRUE                         05972018
059730         PERFORM DP013-0000-PROCESS-ABEND                         05973018
059740     END-IF.                                                      05974018
059750                                                                  05975018
059760                                                                  05976018
059770*----------------------------------------------------------------*05977018
059780*    RETRIEVE TICKET FORMAT                                      *05978018
059790*----------------------------------------------------------------*05979018
059800 4390-SELECT-TDCTFAS.                                             05980018
059810     PERFORM                                                      05981018
059820         WITH TEST AFTER                                          05982018
059830         VARYING PV-RETRY-COUNTER                                 05983018
059840         FROM 1 BY 1                                              05984018
059850         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05985018
059860             OR (SQLCODE = +0)                                    05986018
059870             OR (SQLCODE = +100))                                 05987018
059880                                                                  05988018
059890         EXEC SQL                                                 05989018
059900              SELECT TKT_FMT_ID                                   05990018
059910                INTO :DCTFAS-TKT-FMT-ID                           05991018
059920                       :DN-TKT-FMT-ID                             05992018
059930                FROM TDCTFAS A                                    05993018
059940               WHERE A.OPER_UNT_ID = :DK-OPER-UNT-ID              05994018
059950                 AND A.FCLTY_ID    = :DK-FCLTY-ID                 05995018
059960                 AND A.DEPT_NBR    = :DK-DEPT-NBR                 05996018
059970                 AND A.RANK_NBR    = 1                            05997018
059980                 AND A.CL_NBR      =                              05998018
059990                    (SELECT MIN(B.CL_NBR)                         05999018
060000                      FROM TPURITM B                              06000018
060010                     WHERE B.PO_NBR         = :DK-PO-NBR          06001018
060020                       AND B.VER_STATUS_CDE = 'A')                06002018
060030         END-EXEC                                                 06003018
060040                                                                  06004018
060050         EVALUATE TRUE                                            06005018
060060                                                                  06006018
060070             WHEN SQLCODE = +0                                    06007018
060080             WHEN SQLCODE = +100                                  06008018
060090             WHEN SQLCODE = -904                                  06009018
060100             WHEN SQLCODE = -913                                  06010018
060110                  CONTINUE                                        06011018
060120                                                                  06012018
060130             WHEN SQLWARN0 NOT = SPACES                           06013018
060140             WHEN SQLCODE < +0                                    06014018
060150             WHEN SQLCODE > +0                                    06015018
060160                  MOVE '4390-SELECT-TDCTFAS'                      06016018
060170                                  TO DP013-PARAGRAPH              06017018
060180                  MOVE 'UNSUCCESSFUL SELECT ON TDCTFAS TABLE'     06018018
060190                                  TO DP013-MESSAGE-TEXT (1)       06019018
060200                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  06020018
060210                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             06021018
060220                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     06022018
060230                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   06023018
060240                  MOVE SQLCA      TO DP013-SQLCA                  06024018
060250                  MOVE 'TDCTFAS ' TO DP013-DB2-TABLE-NAME (1)     06025018
060260                  SET DP013-DB2-ABEND                             06026018
060270                      DP013-XCTL-DISPLAY-RESTART                  06027018
060280                                  TO TRUE                         06028018
060290                  PERFORM DP013-0000-PROCESS-ABEND                06029018
060300         END-EVALUATE                                             06030018
060310     END-PERFORM.                                                 06031018
060320                                                                  06032018
060330     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06033018
060340         SQLCODE NOT = +0                                         06034018
060350         MOVE '4390-SELECT-TDCTFAS'  TO DP013-PARAGRAPH           06035018
060360         MOVE 'MAX RETRIES EXCEEDED ON SELECT TICKET FORMAT ASSIG'06036018
060370                                  TO DP013-MESSAGE-TEXT (1)       06037018
060380         MOVE SQLCA               TO DP013-SQLCA                  06038018
060390         MOVE 'TDCTFAS'           TO DP013-DB2-TABLE-NAME (1)     06039018
060400         SET DP013-DB2-ABEND                                      06040018
060410             DP013-XCTL-DISPLAY-RESTART                           06041018
060420                                  TO TRUE                         06042018
060430         PERFORM DP013-0000-PROCESS-ABEND                         06043018
060440     END-IF.                                                      06044018
060450                                                                  06045018
060460                                                                  06046018
060470*----------------------------------------------------------------*06047018
060480*    GET SHIPMENT INFO                                           *06048018
060490*----------------------------------------------------------------*06049018
060500 4395-GET-SHIPMENT-INFO.                                          06050018
060510                                                                  06051018
060520     PERFORM                                                      06052018
060530         WITH TEST AFTER                                          06053018
060540         VARYING PV-RETRY-COUNTER                                 06054018
060550         FROM 1 BY 1                                              06055018
060560         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06056018
060570            OR (SQLCODE = +0)                                     06057018
060580            OR (SQLCODE = +100)                                   06058018
060590            OR (SQLCODE = -811))                                  06059018
060600                                                                  06060018
060610         EXEC SQL                                                 06061018
060620            SELECT  B.PRO_NBR                                     06062018
060630                   ,B.BOL_NBR                                     06063018
060640                   ,B.VEND_SHIP_DTE                               06064018
060650              INTO :SHIPMT-PRO-NBR                                06065018
060660                  ,:SHIPMT-BOL-NBR                                06066018
060670                  ,:SHIPMT-VEND-SHIP-DTE                          06067018
060680              FROM  TSHPTPO A                                     06068018
060690                   ,TSHIPMT B                                     06069018
060700          WHERE A.PO_NBR      = :DK-PO-NBR                        06070018
060710            AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   06071018
060720            AND A.SHIPT_ID = B.SHIPT_ID                           06072018
060730         END-EXEC                                                 06073018
060740                                                                  06074018
060750         EVALUATE TRUE                                            06075018
060760             WHEN SQLCODE = +0                                    06076018
060770             WHEN SQLCODE = +100                                  06077018
060780             WHEN SQLCODE = -811                                  06078018
060790             WHEN SQLCODE = -904                                  06079018
060800             WHEN SQLCODE = -913                                  06080018
060810                 CONTINUE                                         06081018
060820                                                                  06082018
060830             WHEN SQLWARN0 NOT = SPACE                            06083018
060840             WHEN SQLCODE < +0                                    06084018
060850             WHEN SQLCODE > +0                                    06085018
060860                 MOVE '4395-GET-SHIPMENT-INFO'                    06086018
060870                                 TO DP013-PARAGRAPH               06087018
060880                 MOVE 'SELECT SHIPMENT INFO'                      06088018
060890                                 TO DP013-MESSAGE-TEXT (1)        06089018
060900                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   06090018
060910                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              06091018
060920                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      06092018
060930                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    06093018
060940                 MOVE SQLCA      TO DP013-SQLCA                   06094018
060950                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (1)      06095018
060960                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (2)      06096018
060970                 SET DP013-DB2-ABEND                              06097018
060980                                 TO TRUE                          06098018
060990                 SET DP013-XCTL-DISPLAY-RESTART                   06099018
061000                                 TO TRUE                          06100018
061010                 PERFORM DP013-0000-PROCESS-ABEND                 06101018
061020         END-EVALUATE                                             06102018
061030     END-PERFORM.                                                 06103018
061040                                                                  06104018
061050     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06105018
061060             AND (SQLCODE = -904 OR -913)                         06106018
061070         MOVE '4395-GET-SHIPMTNE-INFO'                            06107018
061080                                 TO DP013-PARAGRAPH               06108018
061090         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06109018
061100                                 TO DP013-MESSAGE-TEXT (1)        06110018
061110         MOVE 'SHIPMENT INFO'                                     06111018
061120                                 TO DP013-MESSAGE-TEXT (2)        06112018
061130         MOVE SQLCA              TO DP013-SQLCA                   06113018
061140         MOVE 'TSHPTPO'          TO DP013-DB2-TABLE-NAME (1)      06114018
061150         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (2)      06115018
061160         SET DP013-DB2-ABEND     TO TRUE                          06116018
061170         SET DP013-XCTL-DISPLAY-RESTART                           06117018
061180                                 TO TRUE                          06118018
061190         PERFORM DP013-0000-PROCESS-ABEND                         06119018
061200     END-IF.                                                      06120018
061210                                                                  06121018
061220                                                                  06122018
061230*----------------------------------------------------------------*06123018
061240* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *06124018
061250*----------------------------------------------------------------*06125018
061260                                                                  06126018
061270 4400-MOVE-COMMAREA-TO-SCREEN.                                    06127018
061280     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             06128018
061290         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          06129018
061300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          06130018
061310             MOVE +1    TO ASC-BLK-SUB                            06131018
061320             PERFORM 5100-WRITE-TEMP-STORAGE                      06132018
061330             ADD +1     TO ASC-BLK-SUB                            06133018
061340             PERFORM 5100-WRITE-TEMP-STORAGE                      06134018
061350             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             06135018
061360                 GIVING PV-BLOCK-NUMBER                           06136018
061370                 REMAINDER PV-REMAINDER                           06137018
061380             IF  PV-REMAINDER > ZERO                              06138018
061390                 ADD +1 TO PV-BLOCK-NUMBER                        06139018
061400             END-IF                                               06140018
061410             MOVE +1    TO ASC-BLK-SUB                            06141018
061420             PERFORM 4410-READ-TEMP-STORAGE                       06142018
061430             ADD +1     TO ASC-BLK-SUB                            06143018
061440                           PV-BLOCK-NUMBER                        06144018
061450             PERFORM 4410-READ-TEMP-STORAGE                       06145018
061460     END-IF.                                                      06146018
061470     MOVE +1            TO ASC-BLK-SUB.                           06147018
061480     COMPUTE ASC-ITEM-SUB =                                       06148018
061490         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              06149018
061500         + PC-ITEMS-PER-PANEL).                                   06150018
061510                                                                  06151018
061520     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        06152018
061530         ADD +1         TO ASC-BLK-SUB                            06153018
061540         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            06154018
061550     END-IF.                                                      06155018
061560                                                                  06156018
061570     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           06157018
061580         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                06158018
061590     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        06159018
061600     PERFORM 4420-FORMAT-LIST-LINES                               06160018
061610         VARYING PV-SUB                                           06161018
061620         FROM PC-ITEMS-PER-PANEL BY -1                            06162018
061630         UNTIL PV-SUB < +1.                                       06163018
061640                                                                  06164018
061650     COMPUTE ASC-ITEMS-DISPLAYED =                                06165018
061660         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          06166018
061670     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    06167018
061680                                      ASTRTITO.                   06168018
061690     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    06169018
061700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    06170018
061710     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            06171018
061720                                   TO ASELITO.                    06172018
061730     MOVE ASC-SCAC-ID              TO ASCACO.                     06173018
061740     MOVE ASC-VEH-NBR              TO ATRLRO.                     06174018
061750     MOVE ASC-TRIP-ID              TO ATRIPO.                     06175018
061760     MOVE ASC-TRLR-STATUS          TO ATRLSTO.                    06176018
061770     MOVE ASC-HDR-LBL-PRTID        TO APRTIDO.                    06177018
061780     IF PS-HDRLBL-FRMSCRN-YES                                     06178018
061790         MOVE ASC-HDR-LBL-INSTR    TO AINSTRO                     06179018
061800     ELSE                                                         06180018
061810         MOVE SPACES               TO AINSTRO                     06181018
061820     END-IF.                                                      06182018
061830     MOVE ASC-TOT-UNITS            TO ATLUNSO.                    06183018
061831                                                                  06183144
061832* DMH - 7/12/2021 BEGIN                                           06183244
061833                                                                  06183344
061834     IF  ASC-HAS-BULK-MULTI-SKU-YES                               06183444
061835         MOVE 'PKG-B W/MIXED SKU CASE'  TO ABMSGO                 06183546
061836         MOVE DP015-RED                 TO ABMSGC                 06183645
061837     ELSE                                                         06183744
061838         MOVE SPACE                     TO ABMSGO                 06183846
061839         MOVE DP015-BLUE                TO ABMSGC                 06183945
061840     END-IF.                                                      06184044
061841                                                                  06184144
061842* DMH - 7/12/2021 END                                             06184244
061843                                                                  06184344
061844                                                                  06184418
061850     IF  DP020-MSG-NUMBER-X = SPACE                               06185018
061860         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  06186018
061870*            --- MORE ITEMS TO DISPLAY ----                       06187018
061880             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            06188018
061890             SET DP020-MSG-INFORMATIONAL TO TRUE                  06189018
061900         END-IF                                                   06190018
061910     END-IF.                                                      06191018
061920*----------------------------------------------------------------*06192018
061930*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *06193018
061940*----------------------------------------------------------------*06194018
061950                                                                  06195018
061960 4410-READ-TEMP-STORAGE.                                          06196018
061970                                                                  06197018
061980     EXEC CICS                                                    06198018
061990         READQ TS                                                 06199018
062000             QUEUE (ASC-LIST-QUEUE-NAME)                          06200018
062010             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               06201018
062020             ITEM  (PV-BLOCK-NUMBER)                              06202018
062030             RESP  (PV-CICS-RESP)                                 06203018
062040     END-EXEC.                                                    06204018
062050     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       06205018
062060       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     06206018
062070         CONTINUE                                                 06207018
062080     ELSE                                                         06208018
062090         SET DP013-CICS-ABEND     TO TRUE                         06209018
062100         SET DP013-NO-ROLLBACK    TO TRUE                         06210018
062110         MOVE '4410-READ-TEMP-STORAGE'                            06211018
062120                                  TO DP013-PARAGRAPH              06212018
062130         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      06213018
062140                                  TO DP013-MESSAGE-TEXT(1)        06214018
062150         PERFORM DP013-0000-PROCESS-ABEND                         06215018
062160     END-IF.                                                      06216018
062170                                                                  06217018
062180     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             06218018
062190                                                                  06219018
062200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         06220018
062210         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               06221018
062220     END-IF.                                                      06222018
062230                                                                  06223018
062240*----------------------------------------------------------------*06224018
062250*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *06225018
062260*----------------------------------------------------------------*06226018
062270 4420-FORMAT-LIST-LINES.                                          06227018
062280     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      06228018
062290         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                06229018
062300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           06230018
062310         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           06231018
062320         MOVE SPACE              TO MR-ACTION  (PV-SUB)           06232018
062330                                    MR-SELECTI (PV-SUB)           06233018
062340                                    MR-PO-IND (PV-SUB)            06234018
062350                                    MR-PO-RCVR (PV-SUB)           06235018
062360                                    MR-PO-STATUS (PV-SUB)         06236018
062370                                    MR-VND-NME (PV-SUB)           06237018
062380                                    MR-PACK-TYPE (PV-SUB)         06238018
062390                                    MR-EXP-CART-COUNT-X  (PV-SUB) 06239018
062400                                    MR-ACTL-CART-COUNT-X (PV-SUB) 06240018
062410                                    MR-EXP-SCN-COUNT-X (PV-SUB)   06241018
062420                                    MR-ACTL-SCN-COUNT-X (PV-SUB)  06242018
062430                                    MR-PERCENT-SCND-X  (PV-SUB)   06243018
062440                                    MR-TOTAL-UNITS-X (PV-SUB)     06244018
062450     ELSE                                                         06245018
062460         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      06246018
062470                                                   > SPACE        06247018
062480             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 06248018
062490                                 TO MR-SELECTI (PV-SUB)           06249018
062500         ELSE                                                     06250018
062510             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      06251018
062520                                 TO MR-SELECTI (PV-SUB)           06252018
062530         END-IF                                                   06253018
062540                                                                  06254018
062550         IF  DP030-SET-CURSOR-TRAILER                             06255018
062560             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)06256018
062570                 > SPACE)                                         06257018
062580               OR (PV-SUB = 1))                                   06258018
062590                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06259018
062600                MOVE -1          TO MR-SELECTL (PV-SUB)           06260018
062610             END-IF                                               06261018
062620         END-IF                                                   06262018
062630                                                                  06263018
062640         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           06264018
062650             IF ASC-CSR-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'A'      06265018
062660                 MOVE DP015-BLUE   TO MR-ACTIONC (PV-SUB)         06266018
062670                                      MR-PO-RCVRC (PV-SUB)        06267018
062680                                      MR-PO-STATUSC (PV-SUB)      06268018
062690                                      MR-VND-NMEC (PV-SUB)        06269018
062700                                      MR-PACK-TYPEC (PV-SUB)      06270018
062710                                      MR-EXP-CART-COUNTC (PV-SUB) 06271018
062720                                      MR-ACTL-CART-COUNTC (PV-SUB)06272018
062730                                      MR-EXP-SCN-COUNTC (PV-SUB)  06273018
062740                                      MR-ACTL-SCN-COUNTC (PV-SUB) 06274018
062750                                      MR-PERCENT-SCNDC (PV-SUB)   06275018
062760                                      MR-TOTAL-UNITSC (PV-SUB)    06276018
062770                   IF ASC-COLOR-RED   (ASC-BLK-SUB ASC-ITEM-SUB)  06277018
062780                      MOVE DP015-RED    TO MR-PO-RCVRC (PV-SUB)   06278018
062790                   END-IF                                         06279018
062800                                                                  06280018
062810                   IF ASC-TROUBLE (ASC-BLK-SUB ASC-ITEM-SUB)      06281018
062820                      MOVE DP015-RED    TO MR-PO-STATUSC (PV-SUB) 06282018
062830                   END-IF                                         06283018
062840                                                                  06284018
062850                   IF ASC-COLOR-YELLOW (ASC-BLK-SUB ASC-ITEM-SUB) 06285018
062860                      MOVE 'Y'          TO ASC-PO-IND             06286018
062870                                       (ASC-BLK-SUB ASC-ITEM-SUB) 06287018
062880                      MOVE DP015-YELLOW TO MR-PO-RCVRC (PV-SUB)   06288018
062890                   END-IF                                         06289018
062900                                                                  06290018
062910                   IF ASC-AUTO-VE-NO (ASC-BLK-SUB ASC-ITEM-SUB)   06291018
062920                      MOVE DP015-YELLOW TO MR-VND-NMEC (PV-SUB)   06292018
062930                   END-IF                                         06293018
062940                                                                  06294018
062950                   IF ASC-CHCKIN-YES (ASC-BLK-SUB ASC-ITEM-SUB)   06295018
062960                      MOVE DP015-YELLOW TO MR-VND-NMEC (PV-SUB)   06296018
062970                   END-IF                                         06297018
062980                                                                  06298018
062990                   IF ASC-MISDIRECT-YES (ASC-BLK-SUB ASC-ITEM-SUB)06299018
063000                      MOVE DP015-YELLOW TO MR-VND-NMEC (PV-SUB)   06300018
063010                   END-IF                                         06301018
063020                                                                  06302018
063030                   IF ASC-PBS-ERRORS-FOUND                        06303018
063040                                      (ASC-BLK-SUB ASC-ITEM-SUB)  06304018
063050                      MOVE DP015-RED TO MR-EXP-SCN-COUNTC (PV-SUB)06305018
063060                   ELSE                                           06306018
063070                     MOVE DP015-BLUE TO MR-EXP-SCN-COUNTC (PV-SUB)06307018
063080                 END-IF                                           06308018
063090             ELSE                                                 06309018
063100                MOVE DP015-YELLOW TO MR-PO-RCVRC (PV-SUB)         06310018
063110                IF ASC-PBS-ERRORS-FOUND                           06311018
063120                                  (ASC-BLK-SUB ASC-ITEM-SUB)      06312018
063130                   MOVE DP015-RED TO MR-EXP-SCN-COUNTC (PV-SUB)   06313018
063140                ELSE                                              06314018
063150                     MOVE DP015-BLUE TO MR-EXP-SCN-COUNTC (PV-SUB)06315018
063160                END-IF                                            06316018
063170                IF ASC-AUTO-VE-NO (ASC-BLK-SUB ASC-ITEM-SUB)      06317018
063180                    MOVE DP015-YELLOW TO MR-VND-NMEC (PV-SUB)     06318018
063190                END-IF                                            06319018
063200                IF ASC-MISDIRECT-YES (ASC-BLK-SUB ASC-ITEM-SUB)   06320018
063210                    MOVE DP015-YELLOW TO MR-VND-NMEC (PV-SUB)     06321018
063220                END-IF                                            06322018
063230             END-IF                                               06323018
063240                                                                  06324018
063250             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           06325018
063260                                 TO MR-ACTION (PV-SUB)            06326018
063270             IF ASC-PACK-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES 06327018
063280                 MOVE SPACES TO MR-SELECTI (PV-SUB)               06328018
063290                 MOVE ASC-PACK-TYPE  (ASC-BLK-SUB ASC-ITEM-SUB)   06329018
063300                                          TO MR-PACK-TYPE (PV-SUB)06330018
063310             ELSE                                                 06331018
063320                 MOVE ASC-PACK-TYPE  (ASC-BLK-SUB ASC-ITEM-SUB)   06332018
063330                                          TO MR-PACK-TYPE (PV-SUB)06333018
063340             END-IF                                               06334018
063350             IF ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = 99999999  06335018
063360                 MOVE SPACES TO MR-SELECTI (PV-SUB)               06336018
063370             END-IF                                               06337018
063380                                                                  06338018
063390             MOVE ASC-PO-RECEIVER  (ASC-BLK-SUB ASC-ITEM-SUB)     06339018
063400                                 TO MR-PO-RCVR (PV-SUB)           06340018
063410             MOVE ASC-PO-STATUS  (ASC-BLK-SUB ASC-ITEM-SUB)       06341018
063420                                 TO MR-PO-STATUS (PV-SUB)         06342018
063430             MOVE ASC-VND-NME-18 (ASC-BLK-SUB ASC-ITEM-SUB)       06343018
063440                                 TO MR-VND-NME (PV-SUB)           06344018
063450             MOVE ASC-EXP-CART-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)   06345018
063460                                 TO MR-EXP-CART-COUNT (PV-SUB)    06346018
063470             MOVE ASC-ACTL-CART-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)  06347018
063480                                 TO MR-ACTL-CART-COUNT (PV-SUB)   06348018
063490             IF  ASC-EXP-SCN-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)     06349018
063500                                 > 9999                           06350018
063510                 MOVE '****'                                      06351018
063520                                  TO MR-EXP-SCN-COUNT-X (PV-SUB)  06352018
063530             ELSE                                                 06353018
063540                 MOVE ASC-EXP-SCN-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)06354018
063550                                  TO MR-EXP-SCN-COUNT (PV-SUB)    06355018
063560             END-IF                                               06356018
063570             MOVE ASC-ACTL-SCN-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)   06357018
063580                                 TO MR-ACTL-SCN-COUNT (PV-SUB)    06358018
063590             MOVE ASC-PERCENT-SCND (ASC-BLK-SUB ASC-ITEM-SUB)     06359018
063600                                 TO MR-PERCENT-SCND (PV-SUB)      06360018
063610             MOVE ASC-TOTAL-UNITS  (ASC-BLK-SUB ASC-ITEM-SUB)     06361018
063620                                 TO MR-TOTAL-UNITS (PV-SUB)       06362018
063630             MOVE ASC-PO-IND      (ASC-BLK-SUB ASC-ITEM-SUB)      06363018
063640                                 TO MR-PO-IND  (PV-SUB)           06364018
063641* DMH - 7/12/2021 - END                                           06364144
063642             IF ASC-BULK-MULT-SKU-YES (ASC-BLK-SUB ASC-ITEM-SUB)  06364244
063643                 MOVE DP015-RED  TO MR-PACK-TYPEC (PV-SUB)        06364344
063644             ELSE                                                 06364444
063645                 MOVE DP015-BLUE TO MR-PACK-TYPEC (PV-SUB)        06364544
063646             END-IF                                               06364644
063647* DMH - 7/12/2021 - END                                           06364744
063650         ELSE                                                     06365018
063660             IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES    06366018
063670                 MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       06367018
063680                                     TO MR-ACTION (PV-SUB)        06368018
063690             END-IF                                               06369018
063700             IF ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = 99999999  06370018
063710                 MOVE SPACES TO MR-SELECTI (PV-SUB)               06371018
063720             END-IF                                               06372018
063730         END-IF                                                   06373018
063740     END-IF.                                                      06374018
063750                                                                  06375018
063760                                                                  06376018
063770     SUBTRACT +1 FROM ASC-ITEM-SUB                                06377018
063780     IF  ASC-ITEM-SUB < + 1                                       06378018
063790         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  06379018
063800         MOVE +1                 TO ASC-BLK-SUB                   06380018
063810     END-IF.                                                      06381018
063820******************************************************************06382018
063830** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **06383018
063840** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **06384018
063850** ISSUE A WARNING.                                             **06385018
063860******************************************************************06386018
063870 4430-CHECK-FOR-BEGIN-AND-END.                                    06387018
063880     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       06388018
063890         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     06389018
063900*            -- NO END-OF-RANGE SPECFIED ---                      06390018
063910             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            06391018
063920             SET DP020-MSG-WARNING TO TRUE                        06392018
063930             PERFORM 4431-POSITION-AT-WARNING                     06393018
063940         END-IF                                                   06394018
063950     ELSE                                                         06395018
063960         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     06396018
063970*            -- NO BEGINNING-OF-RANGE SPECFIED ---                06397018
063980             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            06398018
063990             SET DP020-MSG-WARNING TO TRUE                        06399018
064000             PERFORM 4431-POSITION-AT-WARNING                     06400018
064010         END-IF                                                   06401018
064020     END-IF.                                                      06402018
064030******************************************************************06403018
064040** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **06404018
064050** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **06405018
064060** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **06406018
064070** POSITION THE CURSOR THERE.                                   **06407018
064080******************************************************************06408018
064090 4431-POSITION-AT-WARNING.                                        06409018
064100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 06410018
064110                    - PV-TOP-ITEM + 1.                            06411018
064120     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      06412018
064130         CONTINUE                                                 06413018
064140     ELSE                                                         06414018
064150         SET DP030-SET-CURSOR-APPL-1                              06415018
064160                                   TO TRUE                        06416018
064170         MOVE -1                   TO MR-SELECTL (PV-SUB)         06417018
064180         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         06418018
064190         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         06419018
064200     END-IF.                                                      06420018
064210                                                                  06421018
064220     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   06422018
064230                    - PV-TOP-ITEM + 1.                            06423018
064240     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      06424018
064250         CONTINUE                                                 06425018
064260     ELSE                                                         06426018
064270         SET DP030-SET-CURSOR-APPL-1                              06427018
064280                                   TO TRUE                        06428018
064290         MOVE -1                   TO MR-SELECTL (PV-SUB)         06429018
064300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         06430018
064310         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         06431018
064320     END-IF.                                                      06432018
064330                                                                  06433018
064340*----------------------------------------------------------------*06434018
064350* CHECK IF TROUBLE NOTIFICATION EXISTS FOR THE PO #/RECV SEQ #.  *06435018
064360*----------------------------------------------------------------*06436018
064370 4510-CHECK-IF-IN-TROUBLE.                                        06437018
064380     EXEC SQL                                                     06438018
064390         SELECT B.TRBL_LONG_DESC                                  06439018
064400          INTO :TRBRSN-TRBL-LONG-DESC                             06440018
064410          FROM  TTRBNTF A                                         06441018
064420               ,TTRBRSN B                                         06442018
064430          WHERE  A.PO_NBR           =  :DK-PO-NBR                 06443018
064440          AND    A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR            06444018
064450*         AND    A.OPER_UNT_ID      =  :DK-OPER-UNT-ID            06445018
064460*         AND    A.FCLTY_ID         =  :DK-FCLTY-ID               06446018
064470          AND    B.TRBL_RSN_CDE     =  A.TRBL_RSN_CDE             06447018
064480          AND  ((A.RESOLVED_IND    IN  ('N','I','R')              06448018
064490          AND    B.NOTIF_IND        =  'T')                       06449018
064500           OR    B.TRBL_RSN_CDE     =  803)                       06450018
064510     END-EXEC.                                                    06451018
064520                                                                  06452018
064530     EVALUATE TRUE                                                06453018
064540         WHEN SQLCODE = +0                                        06454018
064550         WHEN SQLCODE = -811                                      06455018
064560             SET PS-COLOR-RED TO TRUE                             06456018
064570             SET PS-TROUBLE  TO TRUE                              06457018
064580         WHEN OTHER                                               06458018
064590             CONTINUE                                             06459018
064600     END-EVALUATE.                                                06460018
064610                                                                  06461018
064620                                                                  06462018
064630*----------------------------------------------------------------*06463018
064640* CHECK FOR ANY SPECIAL INSTRUCTION RECIPIENTS                    06464018
064650*----------------------------------------------------------------*06465018
064660 4515-CHECK-4-SPCL-INSTRCT.                                       06466018
064670                                                                  06467018
064680     EXEC SQL                                                     06468018
064690         SELECT  B.INSTR_DESC                                     06469018
064700            INTO :INSTCD-INSTR-DESC                               06470018
064710            FROM  TPOINST A                                       06471018
064720                 ,TINSTCD B                                       06472018
064730         WHERE A.PO_NBR    = :DK-PO-NBR                           06473018
064740           AND A.RECIP_CDE = 'DC'                                 06474018
064750*          AND A.RECIP_CDE IN ('DC','AN')                         06475018
064760           AND A.INSTR_NBR = B.INSTR_NBR                          06476018
064770     END-EXEC.                                                    06477018
064780                                                                  06478018
064790     EVALUATE TRUE                                                06479018
064800         WHEN SQLCODE = +0                                        06480018
064810         WHEN SQLCODE = -811                                      06481018
064820             SET PS-COLOR-RED      TO TRUE                        06482018
064830         WHEN OTHER                                               06483018
064840             CONTINUE                                             06484018
064850     END-EVALUATE.                                                06485018
064860                                                                  06486018
064870****************************************************************  06487018
064880 4520-CHECK-4-PRSNTATN.                                           06488018
064890     PERFORM 4521-OPEN-TRECITM-CSR.                               06489018
064900     PERFORM 4522-FETCH-TRECITM-CSR UNTIL                         06490018
064910                 PS-EOF-TRECITM-CSR.                              06491018
064920     PERFORM 4524-CLOSE-TRECITM-CSR.                              06492018
064930       SET PS-EOF-TRECITM-CSR-NO TO TRUE.                         06493018
064940     MOVE SPACES TO  PS-PRESENTATION-SW                           06494018
064950                     PS-PRICE-SW.                                 06495018
064960                                                                  06496018
064970*----------------------------------------------------------------*06497018
064980* OPEN THE TRECITM CURSOR                                        *06498018
064990*----------------------------------------------------------------*06499018
065000 4521-OPEN-TRECITM-CSR.                                           06500018
065010                                                                  06501018
065020     EXEC SQL                                                     06502018
065030          OPEN TRECITM-CSR                                        06503018
065040     END-EXEC.                                                    06504018
065050                                                                  06505018
065060     EVALUATE TRUE                                                06506018
065070         WHEN SQLCODE = +0                                        06507018
065080         WHEN SQLCODE = -904                                      06508018
065090         WHEN SQLCODE = -913                                      06509018
065100              CONTINUE                                            06510018
065110         WHEN SQLWARN0 NOT = SPACE                                06511018
065120         WHEN SQLCODE  NOT = +0                                   06512018
065130              MOVE '4521-OPEN-TRECITM-CSR' TO DP013-PARAGRAPH     06513018
065140              MOVE 'OPEN TRECITM CURSOR'                          06514018
065150                                   TO DP013-MESSAGE-TEXT (1)      06515018
065160              MOVE SQLCA       TO DP013-SQLCA                     06516018
065170              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        06517018
065180              SET DP013-DB2-ABEND  TO TRUE                        06518018
065190              PERFORM DP013-0000-PROCESS-ABEND                    06519018
065200     END-EVALUATE.                                                06520018
065210                                                                  06521018
065220*----------------------------------------------------------------*06522018
065230*    FETCH A TRECITM ROW                                         *06523018
065240*----------------------------------------------------------------*06524018
065250 4522-FETCH-TRECITM-CSR.                                          06525018
065260                                                                  06526018
065270     EXEC SQL                                                     06527018
065280          FETCH TRECITM-CSR                                       06528018
065290          INTO :RECITM-ITM-NBR                                    06529018
065300     END-EXEC.                                                    06530018
065310                                                                  06531018
065320     EVALUATE TRUE                                                06532018
065330         WHEN SQLCODE = +0                                        06533018
065340             PERFORM 4523-HANG-FOLD                               06534018
065350                                                                  06535018
065360             IF PS-PRESENTATION-DONE                              06536018
065370                 SET PS-EOF-TRECITM-CSR TO TRUE                   06537018
065380             END-IF                                               06538018
065390         WHEN SQLCODE = +100                                      06539018
065400              SET PS-EOF-TRECITM-CSR TO TRUE                      06540018
065410         WHEN SQLWARN0 NOT = SPACE                                06541018
065420         WHEN SQLCODE < +0                                        06542018
065430         WHEN SQLCODE > +0                                        06543018
065440              MOVE '4522-FETCH-TRECITM-CSR' TO DP013-PARAGRAPH    06544018
065450              MOVE 'FETCH TRECITM CURSOR'                         06545018
065460                                   TO DP013-MESSAGE-TEXT (1)      06546018
065470              MOVE DK-PO-NBR  TO PV-ERROR-PO                      06547018
065480              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 06548018
065490              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         06549018
065500              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       06550018
065510              MOVE SQLCA           TO DP013-SQLCA                 06551018
065520              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    06552018
065530              SET DP013-DB2-ABEND  TO TRUE                        06553018
065540              PERFORM DP013-0000-PROCESS-ABEND                    06554018
065550     END-EVALUATE.                                                06555018
065560                                                                  06556018
065570*----------------------------------------------------------------*06557018
065580* CALL LOGISTICS ITEM ACCESS MODULE (XLKUT001)                   *06558018
065590*----------------------------------------------------------------*06559018
065600 4523-HANG-FOLD.                                                  06560018
065610*     INITIALIZE XL001-ITEM-COMMAREA.                             06561018
065620      MOVE RECITM-ITM-NBR   TO XLT00003-ITM-NBR                   06562018
065630                                                                  06563018
065640     PERFORM 7700-SELECT-HANG-FOLD                                06564018
065650                                                                  06565018
065660*     SET  XL001-BY-ITEM                                          06566018
065670*          XL001-SELECT-VND-STYL                                  06567018
065680*          XL001-SELECT-SKU      TO TRUE.                         06568018
065690*                                                                 06569018
065700*     CALL XL001-VSM-PGM USING DFHEIBLK                           06570018
065710*                              XL001-COMMAREA                     06571018
065720*                              XL001-ITEM-COMMAREA.               06572018
065730*                                                                 06573018
065740      EVALUATE TRUE                                               06574018
065750          WHEN SQLCODE = ZERO                                     06575018
065760              PERFORM 4525-CHECK-PRESENTATION                     06576018
065770*LMM          PERFORM 4527-CHECK-PRICE                            06577018
065780              PERFORM 2106-GET-BEFORE-PRICE-CHG-DAYS              06578018
065790              PERFORM 2107-GET-AFTER-PRICE-CHG-DAYS               06579018
065800              PERFORM 4527-CALL-PRICE-CHANGE-MODULE               06580018
065810          WHEN OTHER                                              06581018
065820              MOVE SPACES            TO ASC-PRESENTATION          06582018
065830              SET PS-EOF-TRECITM-CSR TO TRUE                      06583018
065840      END-EVALUATE.                                               06584018
065850                                                                  06585018
065860*----------------------------------------------------------------*06586018
065870* CLOSE THE TRECITM CURSOR                                       *06587018
065880*----------------------------------------------------------------*06588018
065890 4524-CLOSE-TRECITM-CSR.                                          06589018
065900                                                                  06590018
065910     EXEC SQL                                                     06591018
065920          CLOSE TRECITM-CSR                                       06592018
065930     END-EXEC.                                                    06593018
065940                                                                  06594018
065950     EVALUATE TRUE                                                06595018
065960         WHEN SQLCODE = +0                                        06596018
065970              CONTINUE                                            06597018
065980         WHEN SQLWARN0 NOT = SPACE                                06598018
065990         WHEN SQLCODE  NOT = +0                                   06599018
066000              MOVE '4524-CLOSE-TRECITM-CSR' TO DP013-PARAGRAPH    06600018
066010              MOVE 'CLOSE TRECITM CURSOR'                         06601018
066020                                   TO DP013-MESSAGE-TEXT (1)      06602018
066030              MOVE SQLCA           TO DP013-SQLCA                 06603018
066040              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    06604018
066050              SET DP013-DB2-ABEND  TO TRUE                        06605018
066060              PERFORM DP013-0000-PROCESS-ABEND                    06606018
066070     END-EVALUATE.                                                06607018
066080                                                                  06608018
066090*----------------------------------------------------------------*06609018
066100* CHECK PRESENTATION INFORMATION                                  06610018
066110*----------------------------------------------------------------*06611018
066120 4525-CHECK-PRESENTATION.                                         06612018
066130     IF PS-PRESENTATION-DONE                                      06613018
066140         CONTINUE                                                 06614018
066150     ELSE                                                         06615018
066160         IF PV-HNG-FOLD-CDE = 'M'                                 06616018
066170             MOVE XLT00004-HNG-FOLD-DESC TO ASC-PRESENTATION      06617018
066180             SET PS-PRESENTATION-DONE TO TRUE                     06618018
066190         ELSE                                                     06619018
066200             IF PV-HNG-FOLD-CDE = 'H'                             06620018
066210                 IF ASC-PRESENTATION = SPACES                     06621018
066220                     MOVE XLT00004-HNG-FOLD-DESC                  06622018
066230                                 TO ASC-PRESENTATION              06623018
066240                 ELSE                                             06624018
066250                     IF ASC-PRESENTATION NOT =                    06625018
066260                                         XLT00004-HNG-FOLD-DESC   06626018
066270                        MOVE 'MIXED         ' TO  ASC-PRESENTATION06627018
066280                        SET PS-PRESENTATION-DONE TO TRUE          06628018
066290                     ELSE                                         06629018
066300                        MOVE XLT00004-HNG-FOLD-DESC TO            06630018
066310                                                  ASC-PRESENTATION06631018
066320                     END-IF                                       06632018
066330                 END-IF                                           06633018
066340             ELSE                                                 06634018
066350                 IF PV-HNG-FOLD-CDE = 'F'                         06635018
066360                     IF ASC-PRESENTATION = SPACES                 06636018
066370                         MOVE XLT00004-HNG-FOLD-DESC TO           06637018
066380                                                  ASC-PRESENTATION06638018
066390                     ELSE                                         06639018
066400                         IF ASC-PRESENTATION NOT =                06640018
066410                                      XLT00004-HNG-FOLD-DESC      06641018
066420                             MOVE 'MIXED         ' TO             06642018
066430                                                  ASC-PRESENTATION06643018
066440                             SET PS-PRESENTATION-DONE TO TRUE     06644018
066450                         ELSE                                     06645018
066460                             MOVE XLT00004-HNG-FOLD-DESC TO       06646018
066470                                                  ASC-PRESENTATION06647018
066480                         END-IF                                   06648018
066490                     END-IF                                       06649018
066500                 END-IF                                           06650018
066510             END-IF                                               06651018
066520         END-IF                                                   06652018
066530     END-IF.                                                      06653018
066540                                                                  06654018
066550*----------------------------------------------------------------*06655018
066560* CALL PERM PRICE CHANGE MODULE XLKUT086 - GET PRICE INFO        *06656018
066570*----------------------------------------------------------------*06657018
066580 4527-CALL-PRICE-CHANGE-MODULE.                                   06658018
066590                                                                  06659018
066600     INITIALIZE XL086-PR-CHG-COMMAREA.                            06660018
066610     MOVE XLT00003-ITM-NBR         TO XL086-KEY-ITM-NBR           06661018
066620     MOVE XLT00003-SKU-NBR         TO XL086-KEY-SKU-NBR           06662018
066630     MOVE PV-PPCBEF-QTY            TO XL086-KEY-BEFORE-DAYS       06663018
066640     MOVE PV-PPCAFT-QTY            TO XL086-KEY-AFTER-DAYS        06664018
066650                                                                  06665018
066660     SET XL086-OCCURRENCE-ONLY-YES TO TRUE                        06666018
066670                                                                  06667018
066680     CALL XL086-PR-CHG-PGM USING DFHEIBLK                         06668018
066690                                 XL086-COMMAREA                   06669018
066700                                 XL086-PR-CHG-COMMAREA.           06670018
066710                                                                  06671018
066720     EVALUATE TRUE                                                06672018
066730        WHEN XL086-SUCCESSFUL                                     06673018
066740           IF XL086-PPC-DOC-FOUND                                 06674018
066750              MOVE XL086-EFF-DTE(6:5)    TO ASC-PRICE-CHG         06675018
066760              SET PS-PRICE-DONE          TO TRUE                  06676018
066770              SET PS-COLOR-RED           TO TRUE                  06677018
066780           ELSE                                                   06678018
066790              MOVE SPACES                TO ASC-PRICE-CHG         06679018
066800           END-IF                                                 06680018
066810        WHEN XL086-SQL-ERROR                                      06681018
066820           MOVE SPACES                   TO ASC-PRICE-CHG         06682018
066830     END-EVALUATE.                                                06683018
066840/                                                                 06684018
066850                                                                  06685018
066860*----------------------------------------------------------------*06686018
066870* GET PRICE INFORMATION                                           06687018
066880*----------------------------------------------------------------*06688018
066890*4527-CHECK-PRICE.                                                06689018
066900*LMM                                                              06690018
066910*    IF PS-PRICE-DONE                                             06691018
066920*        CONTINUE                                                 06692018
066930*    ELSE                                                         06693018
066940*        MOVE SPACE TO PS-TCENPPC-CURSOR-SW                       06694018
066950*        PERFORM 4528-OPEN-TCENPPC-CSR                            06695018
066960*        PERFORM 4529-FETCH-TCENPPC-CSR UNTIL                     06696018
066970*                    PS-EOF-PPC-CSR                               06697018
066980*        PERFORM 4530-CLOSE-TCENPPC-CSR                           06698018
066990*    END-IF.                                                      06699018
067000*                                                                 06700018
067010*----------------------------------------------------------------*06701018
067020* OPEN THE TCENPPC CURSOR                                         06702018
067030*----------------------------------------------------------------*06703018
067040*4528-OPEN-TCENPPC-CSR.                                           06704018
067050*LMM                                                              06705018
067060*    EXEC SQL                                                     06706018
067070*         OPEN PPC-CSR                                            06707018
067080*    END-EXEC.                                                    06708018
067090*                                                                 06709018
067100*    EVALUATE TRUE                                                06710018
067110*        WHEN SQLCODE = +0                                        06711018
067120*        WHEN SQLCODE = -904                                      06712018
067130*        WHEN SQLCODE = -913                                      06713018
067140*             CONTINUE                                            06714018
067150*        WHEN SQLWARN0 NOT = SPACE                                06715018
067160*        WHEN SQLCODE  NOT = +0                                   06716018
067170*             MOVE '4528-OPEN-PPC-CSR' TO DP013-PARAGRAPH         06717018
067180*             MOVE 'OPEN PPC CURSOR'                              06718018
067190*                                  TO DP013-MESSAGE-TEXT (1)      06719018
067200*             MOVE SQLCA       TO DP013-SQLCA                     06720018
067210*             MOVE 'TCENPPC'   TO DP013-DB2-TABLE-NAME (1)        06721018
067220*             SET DP013-DB2-ABEND  TO TRUE                        06722018
067230*             PERFORM DP013-0000-PROCESS-ABEND                    06723018
067240*    END-EVALUATE.                                                06724018
067250*                                                                 06725018
067260*----------------------------------------------------------------*06726018
067270*    FETCH A TCENPPC ROW                                         *06727018
067280*----------------------------------------------------------------*06728018
067290*4529-FETCH-TCENPPC-CSR.                                          06729018
067300*LMM                                                              06730018
067310*    EXEC SQL                                                     06731018
067320*         FETCH PPC-CSR                                           06732018
067330*         INTO :CENPPC-EFF-DTE                                    06733018
067340*    END-EXEC.                                                    06734018
067350*                                                                 06735018
067360*    EVALUATE TRUE                                                06736018
067370*        WHEN SQLCODE = +0                                        06737018
067380*            MOVE CENPPC-EFF-DTE(6:5) TO ASC-PRICE-CHG            06738018
067390*            SET PS-PRICE-DONE        TO TRUE                     06739018
067400*            SET PS-EOF-PPC-CSR       TO TRUE                     06740018
067410*            SET PS-COLOR-RED         TO TRUE                     06741018
067420*        WHEN SQLCODE = +100                                      06742018
067430*            SET PS-EOF-PPC-CSR       TO TRUE                     06743018
067440*        WHEN SQLWARN0 NOT = SPACE                                06744018
067450*        WHEN SQLCODE < +0                                        06745018
067460*        WHEN SQLCODE > +0                                        06746018
067470*             MOVE '4529-FETCH-TCENPPC-CSR' TO DP013-PARAGRAPH    06747018
067480*             MOVE 'FETCH TCENPPC CURSOR'                         06748018
067490*                                  TO DP013-MESSAGE-TEXT (1)      06749018
067500*             MOVE DK-PO-NBR  TO PV-ERROR-PO                      06750018
067510*             MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 06751018
067520*             MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         06752018
067530*             MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       06753018
067540*             MOVE SQLCA           TO DP013-SQLCA                 06754018
067550*             MOVE 'TCENPPC'       TO DP013-DB2-TABLE-NAME (1)    06755018
067560*             SET DP013-DB2-ABEND  TO TRUE                        06756018
067570*             PERFORM DP013-0000-PROCESS-ABEND                    06757018
067580*    END-EVALUATE.                                                06758018
067590*                                                                 06759018
067600*----------------------------------------------------------------*06760018
067610* CLOSE THE TCENPPC CURSOR                                       *06761018
067620*----------------------------------------------------------------*06762018
067630*4530-CLOSE-TCENPPC-CSR.                                          06763018
067640*LMM                                                              06764018
067650*    EXEC SQL                                                     06765018
067660*         CLOSE PPC-CSR                                           06766018
067670*    END-EXEC.                                                    06767018
067680*                                                                 06768018
067690*    EVALUATE TRUE                                                06769018
067700*        WHEN SQLCODE = +0                                        06770018
067710*             CONTINUE                                            06771018
067720*        WHEN SQLWARN0 NOT = SPACE                                06772018
067730*        WHEN SQLCODE  NOT = +0                                   06773018
067740*             MOVE '4530-CLOSE-TCENPPC-CSR' TO DP013-PARAGRAPH    06774018
067750*             MOVE 'CLOSE TCENPPC CURSOR'                         06775018
067760*                                  TO DP013-MESSAGE-TEXT (1)      06776018
067770*             MOVE SQLCA           TO DP013-SQLCA                 06777018
067780*             MOVE 'TCENPPC'       TO DP013-DB2-TABLE-NAME (1)    06778018
067790*             SET DP013-DB2-ABEND  TO TRUE                        06779018
067800*             PERFORM DP013-0000-PROCESS-ABEND                    06780018
067810*    END-EVALUATE.                                                06781018
067820*                                                                 06782018
067830*----------------------------------------------------------------*06783018
067840* GET NEW STORE INFORMATION                                       06784018
067850*----------------------------------------------------------------*06785018
067860 4535-GET-NEWSTORE-INFO.                                          06786018
067870                                                                  06787018
067880     EXEC SQL                                                     06788018
067890          SELECT NEW_STR_PO_IND                                   06789018
067900           INTO :PURCHS-NEW-STR-PO-IND                            06790018
067910            FROM TPURCHS                                          06791018
067920           WHERE PO_NBR         = :DK-PO-NBR                      06792018
067930             AND VER_STATUS_CDE = 'A'                             06793018
067940             AND PO_CATEG_CDE   = 'MR'                            06794018
067950       END-EXEC.                                                  06795018
067960                                                                  06796018
067970       EVALUATE TRUE                                              06797018
067980         WHEN SQLCODE = +0                                        06798018
067990             MOVE PURCHS-NEW-STR-PO-IND TO ASC-NEWSTORE           06799018
068000         WHEN OTHER                                               06800018
068010             MOVE ' '                   TO ASC-NEWSTORE           06801018
068020     END-EVALUATE.                                                06802018
068030                                                                  06803018
068040*----------------------------------------------------------------*06804018
068050* GET RTV INFORMATION                                             06805018
068060*----------------------------------------------------------------*06806018
068070 4540-GET-RTV-INFO.                                               06807018
068080                                                                  06808018
068090     EXEC SQL                                                     06809018
068100         SELECT 1                                                 06810018
068110           INTO :PV-ONE                                           06811018
068120           FROM SYSIBM.SYSDUMMY1 X                                06812018
068130          WHERE  EXISTS (SELECT 1                                 06813018
068140               FROM TRECITM                                       06814018
068150              WHERE ORD_NBR     = :DK-PO-NBR                      06815018
068160                AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                 06816018
068170                AND RTV_IND     = 'Y'                             06817018
068180                AND X.IBMREQD > '')                               06818018
068190         WITH UR                                                  06819018
068200       END-EXEC.                                                  06820018
068210                                                                  06821018
068220       EVALUATE TRUE                                              06822018
068230         WHEN SQLCODE = +0                                        06823018
068240             MOVE 'Y'           TO ASC-RTV                        06824018
068250         WHEN OTHER                                               06825018
068260             MOVE SPACES        TO ASC-RTV                        06826018
068270     END-EVALUATE.                                                06827018
068280                                                                  06828018
068290*----------------------------------------------------------------*06829018
068300* GET SET NAME INFORMATION                                        06830018
068310*----------------------------------------------------------------*06831018
068320 4550-GET-SET-NAME-INFO.                                          06832018
068330                                                                  06833018
068340     INITIALIZE PC240-ITEM-COMMAREA.                              06834018
068350     MOVE DK-PO-NBR             TO PC240-KEY-PO.                  06835018
068360     SET PC240-SET-NAME-ONLY    TO TRUE.                          06836018
068370                                                                  06837018
068380     CALL PC240-VSM-PGM USING DFHEIBLK                            06838018
068390                              PC240-COMMAREA                      06839018
068400                              PC240-ITEM-COMMAREA                 06840018
068410     EVALUATE TRUE                                                06841018
068420         WHEN PC240-SUCCESSFUL                                    06842018
068430             IF PC240-NO-SEASONAL-SET-FOUND                       06843018
068440                 MOVE SPACES              TO ASC-SET-NAME         06844018
068450             ELSE                                                 06845018
068460                MOVE PC240-SEASET-SHRT-NM TO ASC-SET-NAME         06846018
068470             END-IF                                               06847018
068480                                                                  06848018
068490         WHEN OTHER                                               06849018
068500             MOVE SPACES               TO ASC-SET-NAME            06850018
068510     END-EVALUATE.                                                06851018
068520                                                                  06852018
068530*----------------------------------------------------------------*06853018
068540* CHECK FOR TRECITM                                              *06854018
068550*----------------------------------------------------------------*06855018
068560 4600-CHECK-TRECITM.                                              06856018
068570                                                                  06857018
068580     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           06858018
068590                                                                  06859018
068600     EXEC SQL                                                     06860018
068700         SELECT ORD_NBR                                           06870018
068800         INTO  :PV-PO-NBR-PHYSCL                                  06880018
068810         FROM   TRECITM                                           06881018
068820         WHERE ORD_NBR        = :DK-PO-NBR                        06882018
068830           AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                   06883018
068840           AND VER_STATUS_CDE = 'A'                               06884018
068841           FETCH FIRST 1 ROW ONLY                                 06884118
068842     END-EXEC.                                                    06884218
068843       EVALUATE TRUE                                              06884318
068844         WHEN SQLCODE = +0                                        06884418
068845         WHEN SQLCODE = -811                                      06884518
068846             SET PS-TRECITM-FOUND-YES TO TRUE                     06884618
068847         WHEN SQLCODE = +100                                      06884718
068848             SET PS-TRECITM-FOUND-NO  TO TRUE                     06884818
068849       END-EVALUATE.                                              06884918
068850                                                                  06885018
068860*----------------------------------------------------------------*06886018
068870* CHECK FOR PACK-TO-LIGHT PREPACK ON TRECITM                     *06887018
068880*----------------------------------------------------------------*06888018
068890 4610-CHECK-PTL-PREPK-TRECITM.                                    06889018
068900                                                                  06890018
068910     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           06891018
068920                                                                  06892018
068930     EXEC SQL                                                     06893018
068940         SELECT ORD_NBR                                           06894018
068950         INTO  :PV-PO-NBR-PHYSCL                                  06895018
068960         FROM   TRECITM                                           06896018
068970         WHERE ORD_NBR        = :DK-PO-NBR                        06897018
068980           AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                   06898018
068990           AND VER_STATUS_CDE = 'A'                               06899018
069000           AND PREPK_DRV_LNE_CDE = 'A'                            06900018
069010           AND CASE_PACK_QTY     > 1                              06901018
069020           FETCH FIRST 1 ROW ONLY                                 06902018
069030     END-EXEC.                                                    06903018
069040       EVALUATE TRUE                                              06904018
069050         WHEN SQLCODE = +0                                        06905018
069060         WHEN SQLCODE = -811                                      06906018
069070             SET PS-PACK-TO-LIGHT-YES TO TRUE                     06907018
069080         WHEN SQLCODE = +100                                      06908018
069090             SET PS-PACK-TO-LIGHT-NO  TO TRUE                     06909018
069100       END-EVALUATE.                                              06910018
069110*----------------------------------------------------------------*06911018
069120* CHECK FOR PACK-TO-LIGHT PREPACK ON TPURITM                     *06912018
069130*----------------------------------------------------------------*06913018
069140 4620-CHECK-PTL-PREPK-TPURITM.                                    06914018
069150                                                                  06915018
069160     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           06916018
069170                                                                  06917018
069180     EXEC SQL                                                     06918018
069190         SELECT A.PO_NBR                                          06919018
069200         INTO  :PV-PO-NBR-PHYSCL                                  06920018
069210         FROM   TPURITM A                                         06921018
069220            ,   TPOPRPK B                                         06922018
069230         WHERE A.PO_NBR            = :DK-PO-NBR                   06923018
069240           AND A.VER_STATUS_CDE    = 'A'                          06924018
069250           AND B.PO_NBR            = A.PO_NBR                     06925018
069260           AND B.PO_PREPK_ID       = A.PO_PREPK_ID                06926018
069270           AND B.PREPK_TYP_CDE     = 'I'                          06927018
069280           FETCH FIRST 1 ROW ONLY                                 06928018
069290     END-EXEC.                                                    06929018
069300       EVALUATE TRUE                                              06930018
069310         WHEN SQLCODE = +0                                        06931018
069320         WHEN SQLCODE = -811                                      06932018
069330             SET PS-PACK-TO-LIGHT-YES TO TRUE                     06933018
069340         WHEN SQLCODE = +100                                      06934018
069350             SET PS-PACK-TO-LIGHT-NO  TO TRUE                     06935018
069360       END-EVALUATE.                                              06936018
069370                                                                  06937018
069380*----------------------------------------------------------------*06938018
069390* CHECK FOR PACK-TO-LIGHT BULK ON TRECITM                     *   06939018
069400*----------------------------------------------------------------*06940018
069410 4630-CHECK-PTL-BULK-TRECITM.                                     06941018
069420                                                                  06942018
069430     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           06943018
069440                                                                  06944018
069450     EXEC SQL                                                     06945018
069460         SELECT ORD_NBR                                           06946018
069470         INTO  :PV-PO-NBR-PHYSCL                                  06947018
069480         FROM   TRECITM                                           06948018
069490         WHERE ORD_NBR        = :DK-PO-NBR                        06949018
069500           AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                   06950018
069510           AND VER_STATUS_CDE = 'A'                               06951018
069520           AND CASE_PACK_QTY  > INNR_PACK_QTY                     06952018
069530           FETCH FIRST 1 ROW ONLY                                 06953018
069540     END-EXEC.                                                    06954018
069550       EVALUATE TRUE                                              06955018
069560         WHEN SQLCODE = +0                                        06956018
069570         WHEN SQLCODE = -811                                      06957018
069580             SET PS-PACK-TO-LIGHT-YES TO TRUE                     06958018
069590         WHEN SQLCODE = +100                                      06959018
069600             SET PS-PACK-TO-LIGHT-NO  TO TRUE                     06960018
069610       END-EVALUATE.                                              06961018
069620                                                                  06962018
069630*----------------------------------------------------------------*06963018
069631* CHECK FOR PACK-TO-LIGHT BULK ON TPURITM                     *   06963118
069632*----------------------------------------------------------------*06963218
069633 4640-CHECK-PTL-BULK-TPURITM.                                     06963318
069634                                                                  06963418
069635     MOVE ZEROES  TO  PV-PO-NBR-PHYSCL.                           06963518
069636                                                                  06963618
069637     EXEC SQL                                                     06963718
069638         SELECT PO_NBR                                            06963818
069639         INTO  :PV-PO-NBR-PHYSCL                                  06963918
069640         FROM  TPURITM                                            06964018
069641         WHERE PO_NBR         = :DK-PO-NBR                        06964118
069642           AND VER_STATUS_CDE = 'A'                               06964218
069643           AND OUTR_PK_QTY    > INNR_PK_QTY                       06964318
069644           FETCH FIRST 1 ROW ONLY                                 06964418
069645     END-EXEC.                                                    06964518
069646       EVALUATE TRUE                                              06964618
069647         WHEN SQLCODE = +0                                        06964718
069648         WHEN SQLCODE = -811                                      06964818
069649             SET PS-PACK-TO-LIGHT-YES TO TRUE                     06964918
069650         WHEN SQLCODE = +100                                      06965018
069651             SET PS-PACK-TO-LIGHT-NO  TO TRUE                     06965118
069652       END-EVALUATE.                                              06965218
069653                                                                  06965318
069654                                                                  06965418
069655*----------------------------------------------------------------*06965518
069656* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *06965618
069657* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *06965718
069658* FOR THE SELECTED ITEMS QUEUE.                                  *06965818
069659*                                                                *06965918
069660* DETERMINE WHICH COPYBOOK WILL BE USED TO PREPARE THE SELECTION *06966018
069661* QUEUE BASED ON THE FUNCTION SELECTED (FUCN02 AND FUNC03 GO TO  *06966118
069662* RC LISTS WHICH USE A DIFFERENT COPYBOOK                        *06966218
069663*                                                                *06966318
069664* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *06966418
069665* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *06966518
069666* THE ARRAY IS FULL.                                             *06966618
069667*----------------------------------------------------------------*06966718
069668                                                                  06966818
069669 5000-PREPARE-SEL-QUEUE.                                          06966918
069670                                                                  06967018
069671     MOVE +1                   TO  ASC-BLK-SUB.                   06967118
069672     PERFORM 5100-WRITE-TEMP-STORAGE.                             06967218
069673     ADD +1                    TO  ASC-BLK-SUB.                   06967318
069674     PERFORM 5100-WRITE-TEMP-STORAGE.                             06967418
069675                                                                  06967518
069676*LMM                                                              06967618
069677*** USE PC000- FIELDS FOR CREATING TROUBLE                        06967718
069678     IF DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)                     06967818
069679         MOVE ASC-SEL-QUEUE-NAME TO  PC000-SEL-QUEUE-NAME         06967918
069680     ELSE                                                         06968018
069681         MOVE ASC-SEL-QUEUE-NAME TO  RC015-SEL-QUEUE-NAME         06968118
069682     END-IF.                                                      06968218
069683     PERFORM 6010-DELETE-SEL-QUEUE.                               06968318
069684                                                                  06968418
069685     SET ASC-UPDATE-TSQ        TO  TRUE.                          06968518
069686                                                                  06968618
069687     SET RC013-IDX             TO  1.                             06968718
069688*** USE PC000- FIELDS FOR CREATING TROUBLE                        06968818
069689     IF DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)                     06968918
069690         MOVE ZERO             TO PC000-NUMBER-OF-TS-ITEMS        06969018
069700     ELSE                                                         06970018
069710         MOVE ZERO             TO RC015-NUMBER-OF-TS-ITEMS        06971018
069720     END-IF.                                                      06972018
069730     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        06973018
069740                                                                  06974018
069750     EVALUATE TRUE                                                06975018
069760       WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                06976018
069770       WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                06977018
069780       WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                06978018
069790               MOVE ASC-SEL-QUEUE-NAME TO RC815-SEL-QUEUE-NAME    06979018
069800                                                                  06980018
069810       WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                06981018
069820       WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                      06982018
069830               MOVE ASC-SEL-QUEUE-NAME TO RC015-SEL-QUEUE-NAME    06983018
069840             MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                 06984018
069850                 PV-NUMBER-OF-SELECTED-ITEM                       06985018
069860             PERFORM 5005-SEARCH-FOR-SELECTION                    06986018
069870                 VARYING PV-ITEM  FROM 1 BY 1                     06987018
069880                 UNTIL   PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      06988018
069890             PERFORM 5015-SCREEN-CLEANUP                          06989018
069900                                                                  06990018
069910        WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)               06991018
069920               MOVE ASC-SEL-QUEUE-NAME TO PC000-SEL-QUEUE-NAME    06992018
069930             MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                 06993018
069940                 PV-NUMBER-OF-SELECTED-ITEM                       06994018
069950                                                                  06995018
069960        WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)               06996018
069970            MOVE ASC-SEL-QUEUE-NAME TO SU038-SEL-QUEUE-NAME       06997018
069980            MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                  06998018
069990                                    SU038-NUMBER-OF-SELECTED-ITEMS06999018
070000        WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)               07000018
070010            MOVE ASC-SEL-QUEUE-NAME TO RC015-SEL-QUEUE-NAME       07001018
070020            MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                  07002018
070030                                 RC015-NUMBER-OF-SELECTED-ITEMS   07003018
070040                                                                  07004018
070050       WHEN OTHER                                                 07005018
070060           MOVE ASC-SEL-QUEUE-NAME TO SU003-SEL-QUEUE-NAME        07006018
070070     END-EVALUATE.                                                07007018
070080                                                                  07008018
070090     PERFORM 6010-DELETE-SEL-QUEUE.                               07009018
070100                                                                  07010018
070110     SET ASC-UPDATE-TSQ        TO  TRUE.                          07011018
070120                                                                  07012018
070130     EVALUATE TRUE                                                07013018
070140       WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                07014018
070150       WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                07015018
070160       WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                07016018
070170               SET RC816-IDX         TO  1                        07017018
070180               MOVE ZERO             TO RC815-NUMBER-OF-TS-ITEMS  07018018
070190               INITIALIZE RC816-SELECTED-ITEM-ARRAY               07019018
070200                                                                  07020018
070210       WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                07021018
070220       WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                      07022018
070230               SET RC013-IDX         TO  1                        07023018
070240               MOVE ZERO             TO RC015-NUMBER-OF-TS-ITEMS  07024018
070250               INITIALIZE RC013-SELECTED-ITEM-ARRAY               07025018
070260                                                                  07026018
070270       WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)                07027018
070280               SET SU025-IDX         TO  1                        07028018
070290               MOVE ZERO             TO SU024-NUMBER-OF-TS-ITEMS  07029018
070300               INITIALIZE SU025-SELECTED-ITEM-ARRAY               07030018
070310*LMM                                                              07031018
070320       WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)                07032018
070330               SET RC013-IDX         TO  1                        07033018
070340               MOVE ZERO             TO PC000-NUMBER-OF-TS-ITEMS  07034018
070350               INITIALIZE RC013-SELECTED-ITEM-ARRAY               07035018
070360                                                                  07036018
070370*DMB                                                              07037018
070380       WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)                07038018
070390               SET SU039-IDX         TO  1                        07039018
070400               MOVE ZERO             TO SU038-NUMBER-OF-TS-ITEMS  07040018
070410               INITIALIZE SU039-SELECTED-ITEM-ARRAY               07041018
070420                                                                  07042018
070430       WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)                07043018
070440               SET RC013-IDX         TO  1                        07044018
070450               MOVE ZERO             TO PC000-NUMBER-OF-TS-ITEMS  07045018
070460               INITIALIZE RC013-SELECTED-ITEM-ARRAY               07046018
070470                                                                  07047018
070480       WHEN OTHER                                                 07048018
070490               SET SU004-IDX         TO  1                        07049018
070500               MOVE ZERO             TO SU003-NUMBER-OF-TS-ITEMS  07050018
070510               INITIALIZE SU004-SELECTED-ITEM-ARRAY               07051018
070520     END-EVALUATE.                                                07052018
070530                                                                  07053018
070540     EVALUATE TRUE                                                07054018
070550       WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                07055018
070560       WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                07056018
070570       WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                07057018
070580               SET PS-NO-VERIFIED-RECEIVER TO TRUE                07058018
070590               PERFORM 5600-FILL-SEL-QUEUE-RECORD                 07059018
070600                 VARYING PV-ITEM FROM 1 BY 1                      07060018
070610                   UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      07061018
070620                                                                  07062018
070630       WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                07063018
070640       WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                      07064018
070650               SET PS-NO-VERIFIED-RECEIVER TO TRUE                07065018
070660               PERFORM 5350-FILL-SEL-QUEUE-RECORD                 07066018
070670                 VARYING PV-ITEM FROM 1 BY 1                      07067018
070680                   UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      07068018
070690                                                                  07069018
070700*      WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                07070018
070710*              SET PS-NO-VERIFIED-RECEIVER TO TRUE                07071018
070720*              PERFORM 5400-FILL-SEL-QUEUE-RECORD                 07072018
070730*                VARYING PV-ITEM FROM 1 BY 1                      07073018
070740*                  UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN      07074018
070750                                                                  07075018
070760       WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)                07076018
070770            PERFORM 5200A-FILL-SEL-QUEUE-RECORD                   07077018
070780              VARYING PV-ITEM FROM 1 BY 1                         07078018
070790                UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN         07079018
070800*LMM                                                              07080018
070810       WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)                07081018
070820       WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)                07082018
070830            PERFORM 5200B-FILL-SEL-QUEUE-RECORD                   07083018
070840              VARYING PV-ITEM FROM 1 BY 1                         07084018
070850                UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN         07085018
070860                                                                  07086018
070870*DMB                                                              07087018
070880       WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)                07088018
070890            PERFORM 5200C-FILL-SEL-QUEUE-RECORD                   07089018
070900              VARYING PV-ITEM FROM 1 BY 1                         07090018
070910                UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN         07091018
070920                                                                  07092018
070930       WHEN OTHER                                                 07093018
070940            PERFORM 5200-FILL-SEL-QUEUE-RECORD                    07094018
070950              VARYING PV-ITEM FROM 1 BY 1                         07095018
070960                UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN         07096018
070970     END-EVALUATE.                                                07097018
070980                                                                  07098018
070990     EVALUATE TRUE                                                07099018
071000       WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                07100018
071010       WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                07101018
071020       WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                07102018
071030               IF RC816-IDX > 1                                   07103018
071040                  PERFORM 5505-WRITE-SEL-QUEUE                    07104018
071050                  ADD +1 TO RC815-NUMBER-OF-TS-ITEMS              07105018
071060               END-IF                                             07106018
071070                                                                  07107018
071080       WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                07108018
071090       WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                      07109018
071100       WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)                07110018
071110*      WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                07111018
071120               IF RC013-IDX > 1                                   07112018
071130                  PERFORM 5305-WRITE-SEL-QUEUE                    07113018
071140                  ADD +1 TO RC015-NUMBER-OF-TS-ITEMS              07114018
071150               END-IF                                             07115018
071160                                                                  07116018
071170       WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)                07117018
071180         IF SU025-IDX > 1                                         07118018
071190             PERFORM 5205A-WRITE-SEL-QUEUE                        07119018
071200             ADD +1 TO SU024-NUMBER-OF-TS-ITEMS                   07120018
071210         END-IF                                                   07121018
071220*LMM                                                              07122018
071230       WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)                07123018
071240         IF RC013-IDX > 1                                         07124018
071250             PERFORM 5205B-WRITE-SEL-QUEUE                        07125018
071260             ADD +1 TO PC000-NUMBER-OF-TS-ITEMS                   07126018
071270         END-IF                                                   07127018
071280                                                                  07128018
071290*DMB                                                              07129018
071300       WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)                07130018
071310         IF SU039-IDX > 1                                         07131018
071320             PERFORM 5205C-WRITE-SEL-QUEUE                        07132018
071330             ADD +1 TO SU038-NUMBER-OF-TS-ITEMS                   07133018
071340         END-IF                                                   07134018
071350                                                                  07135018
071360       WHEN OTHER                                                 07136018
071370               IF SU004-IDX > 1                                   07137018
071380                  PERFORM 5205-WRITE-SEL-QUEUE                    07138018
071390                  ADD +1 TO SU003-NUMBER-OF-TS-ITEMS              07139018
071400               END-IF                                             07140018
071410     END-EVALUATE.                                                07141018
071420                                                                  07142018
071430******************************************************************07143018
071440 5005-SEARCH-FOR-SELECTION.                                       07144018
071450                                                                  07145018
071460     PERFORM 6112-READ-LIST-QUEUE.                                07146018
071470                                                                  07147018
071480     IF PV-CICS-RESP = DFHRESP (NORMAL)                           07148018
071490         PERFORM                                                  07149018
071500         VARYING LQW-IDX  FROM 1 BY 1                             07150018
071510         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL OR                  07151018
071520                 LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            07152018
071530                                                                  07153018
071540             IF LQW-SELECT (LQW-IDX)                              07154018
071550                 EVALUATE TRUE                                    07155018
071560                     WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)  07156018
071570                     WHEN DP020-FK-CONFIRM (DP020-SRC-AID)        07157018
071580                         PERFORM 2650-HEADER-ITEMS                07158018
071590                 END-EVALUATE                                     07159018
071600                 IF PC140-CRA-SUCCESSFUL                          07160018
071610                      SET LQW-DESELECT (LQW-IDX) TO TRUE          07161018
071620                      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS07162018
071630                 END-IF                                           07163018
071640             END-IF                                               07164018
071650         END-PERFORM                                              07165018
071660     END-IF.                                                      07166018
071670                                                                  07167018
071680**********************************************************        07168018
071690 5010-OPEN-TOTAL-UNTS-CSR.                                        07169018
071700***TOTAL NUMBER OF CARTONS FOR EACH  PO/RECEIVER ON THE***        07170018
071710***TRAILER                                                        07171018
071720**********************************************************        07172018
071730                                                                  07173018
071740     PERFORM                                                      07174018
071750         WITH TEST AFTER                                          07175018
071760         VARYING PV-RETRY-COUNTER                                 07176018
071770         FROM 1 BY 1                                              07177018
071780         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07178018
071790                   OR (SQLCODE = ZERO))                           07179018
071800                                                                  07180018
071810                 EXEC SQL                                         07181018
071820                      OPEN RECV-ITM-CSR                           07182018
071830                 END-EXEC                                         07183018
071840                                                                  07184018
071850                                                                  07185018
071860         EVALUATE TRUE                                            07186018
071870             WHEN SQLCODE = ZERO                                  07187018
071880             WHEN SQLCODE = -904                                  07188018
071890             WHEN SQLCODE = -913                                  07189018
071900                 CONTINUE                                         07190018
071910             WHEN SQLWARN0 NOT = SPACES                           07191018
071920             WHEN SQLCODE < ZERO                                  07192018
071930             WHEN SQLCODE > ZERO                                  07193018
071940                 MOVE '5010-OPEN-TOTAL-UNTS-CSR'                  07194018
071950                                   TO DP013-PARAGRAPH             07195018
071960                 MOVE 'OPEN SHIPMT CURSOR - '                     07196018
071970                                   TO DP013-MESSAGE-TEXT (1)      07197018
071980                 MOVE SQLCA        TO DP013-SQLCA                 07198018
071990                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    07199018
072000                 SET DP013-DB2-ABEND                              07200018
072010                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07201018
072020                 PERFORM DP013-0000-PROCESS-ABEND                 07202018
072030         END-EVALUATE                                             07203018
072040     END-PERFORM.                                                 07204018
072050                                                                  07205018
072060     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07206018
072070         SQLCODE NOT = ZERO                                       07207018
072080         MOVE '5010-OPEN-TOTAL-UNTS-CSR' TO DP013-PARAGRAPH       07208018
072090         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   07209018
072100                                   TO DP013-MESSAGE-TEXT (1)      07210018
072110         MOVE SQLCA                TO DP013-SQLCA                 07211018
072120         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    07212018
072130         SET DP013-DB2-ABEND                                      07213018
072140             DP013-XCTL-DISPLAY-RESTART                           07214018
072150                                   TO TRUE                        07215018
072160         PERFORM DP013-0000-PROCESS-ABEND                         07216018
072170     END-IF.                                                      07217018
072180                                                                  07218018
072190*LMM                                                              07219018
072200     IF  RC013-IDX > 1                                            07220018
072210         PERFORM 5205B-WRITE-SEL-QUEUE                            07221018
072220*** USE PC000- FIELDS FOR CREATING TROUBLE                        07222018
072230         IF DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)                 07223018
072240             ADD +1            TO PC000-NUMBER-OF-TS-ITEMS        07224018
072250         ELSE                                                     07225018
072260             ADD +1            TO RC015-NUMBER-OF-TS-ITEMS        07226018
072270         END-IF                                                   07227018
072280     END-IF.                                                      07228018
072290                                                                  07229018
072300******************************************************************07230018
072310 5015-SCREEN-CLEANUP.                                             07231018
072320                                                                  07232018
072330     INITIALIZE ASC-BLOCK-ENTRIES (1)                             07233018
072340                ASC-BLOCK-ENTRIES (2).                            07234018
072350     MOVE +1                     TO  ASC-BLK-SUB                  07235018
072360                                     PV-TOP-ITEM.                 07236018
072370                                                                  07237018
072380     MOVE ZERO                   TO  ASC-ITEM-SUB                 07238018
072390                                     ASC-NUMBER-OF-SELECTED-ITEMS 07239018
072400                                     ASC-START-OF-SELECTED-RANGE  07240018
072410                                     ASC-END-OF-SELECTED-RANGE    07241018
072420                                     ASC-ITEM-AT-TOP-OF-PANEL.    07242018
072430                                                                  07243018
072440     PERFORM 2050-DELETE-LIST-QUEUE.                              07244018
072450     MOVE ZEROS              TO ASC-TOT-UNITS.                    07245018
072460     MOVE ASC-SCAC-ID        TO DK-SCAC-ID.                       07246018
072470     MOVE ASC-VEH-NBR        TO DK-VEH-NBR.                       07247018
072480     MOVE ASC-TRIP-ID        TO DK-TRIP-ID.                       07248018
072490     PERFORM 4000-BUILD-INITIAL-PANEL.                            07249018
072500     PERFORM 4410-READ-TEMP-STORAGE.                              07250018
072510     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07251018
072520     PERFORM 3200-RESET-ATTRIBUTES.                               07252018
072530                                                                  07253018
072540******************************************************************07254018
072550* CLOSE TOTAL UNITS CURSOR                                     * *07255018
072560******************************************************************07256018
072570 5020-CLOSE-TOTAL-UNTS-CSR.                                       07257018
072580                                                                  07258018
072590         EXEC SQL                                                 07259018
072600             CLOSE RECV-ITM-CSR                                   07260018
072610         END-EXEC                                                 07261018
072620                                                                  07262018
072630     EVALUATE TRUE                                                07263018
072640         WHEN SQLCODE = ZERO                                      07264018
072650             CONTINUE                                             07265018
072660         WHEN SQLWARN0 NOT = SPACES                               07266018
072670         WHEN SQLCODE < ZERO                                      07267018
072680         WHEN SQLCODE > ZERO                                      07268018
072690             MOVE '5020-CLOSE-TOTAL-UNTS-CSR'                     07269018
072700                               TO DP013-PARAGRAPH                 07270018
072710             MOVE 'CLOSE SHIPMT CURSOR '                          07271018
072720                               TO DP013-MESSAGE-TEXT (1)          07272018
072730             MOVE SQLCA        TO DP013-SQLCA                     07273018
072740             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        07274018
072750             SET DP013-DB2-ABEND                                  07275018
072760                 DP013-XCTL-DISPLAY-RESTART TO TRUE               07276018
072770             PERFORM DP013-0000-PROCESS-ABEND                     07277018
072780     END-EVALUATE.                                                07278018
072790                                                                  07279018
072800*----------------------------------------------------------------*07280018
072810*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *07281018
072820*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *07282018
072830*----------------------------------------------------------------*07283018
072840                                                                  07284018
072850 5100-WRITE-TEMP-STORAGE.                                         07285018
072860     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     07286018
072870                                   TO PV-LIST-ITEM-NUMBER.        07287018
072880     COMPUTE PV-BLOCK-NUMBER =                                    07288018
072890         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07289018
072900                                                                  07290018
072910     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             07291018
072920     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             07292018
072930         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      07293018
072940             PERFORM 5105-REWRITE-ASC-LISTQ                       07294018
072950         END-IF                                                   07295018
072960     ELSE                                                         07296018
072970         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       07297018
072980         ASC-HIGHEST-BLOCK-WRITTEN + 1                            07298018
072990         PERFORM 5110-WRITE-ASC-LISTQ                             07299018
073000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   07300018
073010     END-IF.                                                      07301018
073020                                                                  07302018
073030     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             07303018
073040******************************************************************07304018
073050** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **07305018
073060** SPECIFIC COMMAREA.                                           **07306018
073070******************************************************************07307018
073080 5105-REWRITE-ASC-LISTQ.                                          07308018
073090     EXEC CICS                                                    07309018
073100         WRITEQ TS                                                07310018
073110             QUEUE (ASC-LIST-QUEUE-NAME)                          07311018
073120             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               07312018
073130             ITEM  (PV-BLOCK-NUMBER)                              07313018
073140             REWRITE                                              07314018
073150             RESP  (PV-CICS-RESP)                                 07315018
073160     END-EXEC.                                                    07316018
073170                                                                  07317018
073180     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           07318018
073190         CONTINUE                                                 07319018
073200     ELSE                                                         07320018
073210         SET DP013-CICS-ABEND            TO TRUE                  07321018
073220         SET DP013-NO-ROLLBACK           TO TRUE                  07322018
073230         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       07323018
073240         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     07324018
073250                                         TO DP013-MESSAGE-TEXT(1) 07325018
073260         PERFORM DP013-0000-PROCESS-ABEND                         07326018
073270     END-IF.                                                      07327018
073280                                                                  07328018
073290******************************************************************07329018
073300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **07330018
073310** SPECIFIC COMMAREA.                                           **07331018
073320******************************************************************07332018
073330 5110-WRITE-ASC-LISTQ.                                            07333018
073340     EXEC CICS                                                    07334018
073350         WRITEQ TS                                                07335018
073360             QUEUE (ASC-LIST-QUEUE-NAME)                          07336018
073370             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               07337018
073380             ITEM  (PV-BLOCK-NUMBER)                              07338018
073390             RESP  (PV-CICS-RESP)                                 07339018
073400     END-EXEC.                                                    07340018
073410     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      07341018
073420         SET DP013-CICS-ABEND      TO TRUE                        07342018
073430         SET DP013-NO-ROLLBACK     TO TRUE                        07343018
073440         MOVE '5110-WRITE-ASC-LISTQ'                              07344018
073450                                   TO DP013-PARAGRAPH             07345018
073460         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           07346018
073470                                   TO DP013-MESSAGE-TEXT(1)       07347018
073480         PERFORM DP013-0000-PROCESS-ABEND                         07348018
073490     END-IF.                                                      07349018
073500                                                                  07350018
073510*----------------------------------------------------------------*07351018
073520* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *07352018
073530* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *07353018
073540*----------------------------------------------------------------*07354018
073550 5200-FILL-SEL-QUEUE-RECORD.                                      07355018
073560                                                                  07356018
073570     PERFORM 6112-READ-LIST-QUEUE.                                07357018
073580     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       07358018
073590         PERFORM                                                  07359018
073600         VARYING LQW-IDX                                          07360018
073610         FROM 1 BY 1                                              07361018
073620         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            07362018
073630           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          07363018
073640             IF  LQW-SELECT (LQW-IDX)                             07364018
073650               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                07365018
073660                                 TO SU004-ITEM (SU004-IDX)        07366018
073670               MOVE SPACE        TO SU004-ACTION-SW (SU004-IDX)   07367018
073680               MOVE LQW-PO-NBR (LQW-IDX)                          07368018
073690                                 TO SU004-PO-NBR (SU004-IDX)      07369018
073700               MOVE LQW-RECEIVER (LQW-IDX)                        07370018
073710                                 TO SU004-REC-SEQ-NBR (SU004-IDX) 07371018
073720               SET SU004-ALL-LINES (SU004-IDX)  TO TRUE           07372018
073730                 SET SU004-IDX UP BY 1                            07373018
073740                 IF  SU004-IDX > SU004-MAX-ITEMS                  07374018
073750                     PERFORM 5205-WRITE-SEL-QUEUE                 07375018
073760                     ADD +1        TO SU003-NUMBER-OF-TS-ITEMS    07376018
073770                     INITIALIZE SU004-SELECTED-ITEM-ARRAY         07377018
073780                     SET SU004-IDX TO  1                          07378018
073790                 END-IF                                           07379018
073800             END-IF                                               07380018
073810         END-PERFORM                                              07381018
073820     END-IF.                                                      07382018
073830                                                                  07383018
073840 5200A-FILL-SEL-QUEUE-RECORD.                                     07384018
073850                                                                  07385018
073860     PERFORM 6112-READ-LIST-QUEUE.                                07386018
073870     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       07387018
073880         PERFORM                                                  07388018
073890         VARYING LQW-IDX                                          07389018
073900         FROM 1 BY 1                                              07390018
073910         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            07391018
073920           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          07392018
073930             IF  LQW-SELECT (LQW-IDX)                             07393018
073940               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                07394018
073950                                 TO SU025-ITEM (SU025-IDX)        07395018
073960               MOVE SPACE        TO SU025-ACTION-SW (SU025-IDX)   07396018
073970               MOVE LQW-PO-RECEIVER (LQW-IDX)                     07397018
073980                                 TO SU025-PO-RECEIVER (SU025-IDX) 07398018
073990                 SET SU025-IDX UP BY 1                            07399018
074000                 IF  SU025-IDX > SU025-MAX-ITEMS                  07400018
074010                     PERFORM 5205A-WRITE-SEL-QUEUE                07401018
074020                     ADD +1        TO SU024-NUMBER-OF-TS-ITEMS    07402018
074030                     INITIALIZE SU025-SELECTED-ITEM-ARRAY         07403018
074040                     SET SU025-IDX TO  1                          07404018
074050                 END-IF                                           07405018
074060             END-IF                                               07406018
074070         END-PERFORM                                              07407018
074080     END-IF.                                                      07408018
074090                                                                  07409018
074100*LMM                                                              07410018
074110 5200B-FILL-SEL-QUEUE-RECORD.                                     07411018
074120                                                                  07412018
074130     PERFORM 6112-READ-LIST-QUEUE.                                07413018
074140     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       07414018
074150         PERFORM                                                  07415018
074160         VARYING LQW-IDX                                          07416018
074170         FROM 1 BY 1                                              07417018
074180         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            07418018
074190           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          07419018
074200             IF  LQW-SELECT (LQW-IDX)                             07420018
074210               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                07421018
074220                                 TO RC013-ITEM (RC013-IDX)        07422018
074230               MOVE SPACE        TO RC013-ACTION-SW (RC013-IDX)   07423018
074240               MOVE LQW-PO-NBR (LQW-IDX)                          07424018
074250                                 TO RC013-PO-NBR (RC013-IDX)      07425018
074260               MOVE LQW-RECEIVER (LQW-IDX)                        07426018
074270                                 TO RC013-REC-SEQ-NBR (RC013-IDX) 07427018
074280*LMM                                                              07428018
074290               MOVE ASC-KEY-OPER-UNT-ID                           07429018
074300                          TO RC013-OPER-UNT-ID (RC013-IDX)        07430018
074310               MOVE ASC-KEY-FCLTY-ID                              07431018
074320                          TO RC013-FCLTY-ID (RC013-IDX)           07432018
074330                                                                  07433018
074340                 SET RC013-IDX UP BY 1                            07434018
074350                 IF  RC013-IDX > RC013-MAX-ITEMS                  07435018
074360                     PERFORM 5205B-WRITE-SEL-QUEUE                07436018
074370                                                                  07437018
074380*** USE PC000- FIELDS FOR CREATING TROUBLE                        07438018
074390                     IF DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)     07439018
074400                         ADD +1    TO PC000-NUMBER-OF-TS-ITEMS    07440018
074410                     ELSE                                         07441018
074420                         ADD +1    TO RC015-NUMBER-OF-TS-ITEMS    07442018
074430                     END-IF                                       07443018
074440                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         07444018
074450                     SET RC013-IDX TO  1                          07445018
074460                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    07446018
074470                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         07447018
074480                     SET RC013-IDX TO  1                          07448018
074490                 END-IF                                           07449018
074500             END-IF                                               07450018
074510         END-PERFORM                                              07451018
074520     END-IF.                                                      07452018
074530                                                                  07453018
074540*DMB                                                              07454018
074550 5200C-FILL-SEL-QUEUE-RECORD.                                     07455018
074560                                                                  07456018
074570     PERFORM 6112-READ-LIST-QUEUE.                                07457018
074580     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       07458018
074590         PERFORM                                                  07459018
074600         VARYING LQW-IDX                                          07460018
074610         FROM 1 BY 1                                              07461018
074620         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            07462018
074630           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          07463018
074640             IF  LQW-SELECT (LQW-IDX)                             07464018
074650               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                07465018
074660                                 TO SU039-ITEM (SU039-IDX)        07466018
074670               MOVE SPACE        TO SU039-ACTION-SW (SU039-IDX)   07467018
074680               MOVE LQW-PO-RECEIVER (LQW-IDX)                     07468018
074690                                 TO SU039-PO-RCVR     (SU039-IDX) 07469018
074700               MOVE ASC-KEY-OPER-UNT-ID                           07470018
074710                             TO SU039-OPER-UNT-ID   (SU039-IDX)   07471018
074720               MOVE 'U'      TO SU039-FAIL-SUCCSS   (SU039-IDX)   07472018
074730               MOVE 'C'      TO SU039-PROCESS-GROUP (SU039-IDX)   07473018
074740               MOVE 'CARTON' TO SU039-PROCESS-GRP-DESC (SU039-IDX)07474018
074750                                                                  07475018
074760                 SET SU039-IDX UP BY 1                            07476018
074770                 IF  SU039-IDX > SU039-MAX-ITEMS                  07477018
074780                     PERFORM 5205C-WRITE-SEL-QUEUE                07478018
074790                                                                  07479018
074800                     ADD +1    TO SU038-NUMBER-OF-TS-ITEMS        07480018
074810                     INITIALIZE SU039-SELECTED-ITEM-ARRAY         07481018
074820                     SET SU039-IDX TO  1                          07482018
074830                 END-IF                                           07483018
074840             END-IF                                               07484018
074850         END-PERFORM                                              07485018
074860     END-IF.                                                      07486018
074870                                                                  07487018
074880*----------------------------------------------------------------*07488018
074890*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *07489018
074900*----------------------------------------------------------------*07490018
074910 5205-WRITE-SEL-QUEUE.                                            07491018
074920                                                                  07492018
074930     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            07493018
074940                                   TO SU004-SELECTED-ITEMS.       07494018
074950                                                                  07495018
074960     EXEC CICS                                                    07496018
074970          WRITEQ TS                                               07497018
074980              QUEUE (ASC-SEL-QUEUE-NAME)                          07498018
074990              FROM  (SU004-DC-SELECT-RECORD)                      07499018
075000              ITEM  (PV-SEL-QUEUE-ITEM)                           07500018
075010              RESP  (PV-CICS-RESP)                                07501018
075020     END-EXEC.                                                    07502018
075030                                                                  07503018
075040     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          07504018
075050         CONTINUE                                                 07505018
075060     ELSE                                                         07506018
075070         SET DP013-CICS-ABEND      TO TRUE                        07507018
075080         SET DP013-NO-ROLLBACK     TO TRUE                        07508018
075090         MOVE '5205-WRITE-SEL-QUEUE'                              07509018
075100                                   TO DP013-PARAGRAPH             07510018
075110         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07511018
075120                                   TO DP013-MESSAGE-TEXT(1)       07512018
075130         PERFORM DP013-0000-PROCESS-ABEND                         07513018
075140     END-IF.                                                      07514018
075150                                                                  07515018
075160 5205A-WRITE-SEL-QUEUE.                                           07516018
075170                                                                  07517018
075180     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            07518018
075190                                   TO SU025-SELECTED-ITEMS.       07519018
075200                                                                  07520018
075210     EXEC CICS                                                    07521018
075220          WRITEQ TS                                               07522018
075230              QUEUE (ASC-SEL-QUEUE-NAME)                          07523018
075240              FROM  (SU025-SELECT-RECORD)                         07524018
075250              ITEM  (PV-SEL-QUEUE-ITEM)                           07525018
075260              RESP  (PV-CICS-RESP)                                07526018
075270     END-EXEC.                                                    07527018
075280                                                                  07528018
075290     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          07529018
075300         CONTINUE                                                 07530018
075310     ELSE                                                         07531018
075320         SET DP013-CICS-ABEND      TO TRUE                        07532018
075330         SET DP013-NO-ROLLBACK     TO TRUE                        07533018
075340         MOVE '5205A-WRITE-SEL-QUEUE'                             07534018
075350                                   TO DP013-PARAGRAPH             07535018
075360         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07536018
075370                                   TO DP013-MESSAGE-TEXT(1)       07537018
075380         PERFORM DP013-0000-PROCESS-ABEND                         07538018
075390     END-IF.                                                      07539018
075400/                                                                 07540018
075410                                                                  07541018
075420*LMM                                                              07542018
075430 5205B-WRITE-SEL-QUEUE.                                           07543018
075440                                                                  07544018
075450     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            07545018
075460                                   TO RC013-SELECTED-ITEMS.       07546018
075470                                                                  07547018
075480     EXEC CICS                                                    07548018
075490          WRITEQ TS                                               07549018
075500              QUEUE (ASC-SEL-QUEUE-NAME)                          07550018
075510              FROM  (RC013-DC-SELECT-RECORD)                      07551018
075520              ITEM  (PV-SEL-QUEUE-ITEM)                           07552018
075530              RESP  (PV-CICS-RESP)                                07553018
075540     END-EXEC.                                                    07554018
075550                                                                  07555018
075560     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          07556018
075570         CONTINUE                                                 07557018
075580     ELSE                                                         07558018
075590         SET DP013-CICS-ABEND      TO TRUE                        07559018
075600         SET DP013-NO-ROLLBACK     TO TRUE                        07560018
075610         MOVE '5205B-WRITE-SEL-QUEUE'                             07561018
075620                                   TO DP013-PARAGRAPH             07562018
075630         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07563018
075640                                   TO DP013-MESSAGE-TEXT(1)       07564018
075650         PERFORM DP013-0000-PROCESS-ABEND                         07565018
075660     END-IF.                                                      07566018
075670                                                                  07567018
075680*DMB                                                              07568018
075690 5205C-WRITE-SEL-QUEUE.                                           07569018
075700                                                                  07570018
075710     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            07571018
075720                                   TO SU039-SELECTED-ITEMS.       07572018
075730                                                                  07573018
075740     EXEC CICS                                                    07574018
075750          WRITEQ TS                                               07575018
075760              QUEUE (ASC-SEL-QUEUE-NAME)                          07576018
075770              FROM  (SU039-SELECT-RECORD)                         07577018
075780              ITEM  (PV-SEL-QUEUE-ITEM)                           07578018
075790              RESP  (PV-CICS-RESP)                                07579018
075800     END-EXEC.                                                    07580018
075810                                                                  07581018
075820     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          07582018
075830         CONTINUE                                                 07583018
075840     ELSE                                                         07584018
075850         SET DP013-CICS-ABEND      TO TRUE                        07585018
075860         SET DP013-NO-ROLLBACK     TO TRUE                        07586018
075870         MOVE '5205C-WRITE-SEL-QUEUE'                             07587018
075880                                   TO DP013-PARAGRAPH             07588018
075890         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07589018
075900                                   TO DP013-MESSAGE-TEXT(1)       07590018
075910         PERFORM DP013-0000-PROCESS-ABEND                         07591018
075920     END-IF.                                                      07592018
075930                                                                  07593018
075940*  DEAD CODE 1/24/2005                                            07594018
075950*5300-FILL-SEL-QUEUE-RECORD.                                      07595018
075960*                                                                 07596018
075970*    PERFORM 6112-READ-LIST-QUEUE.                                07597018
075980*                                                                 07598018
075990*    IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        07599018
076000*        PERFORM                                                  07600018
076010*          VARYING LQW-IDX FROM 1 BY 1                            07601018
076020*            UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                   07602018
076030*               OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO          07603018
076040*                                                                 07604018
076050*            IF LQW-SELECT (LQW-IDX)                              07605018
076060*                                                                 07606018
076070*                MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              07607018
076080*                           TO RC013-ITEM (RC013-IDX)             07608018
076090*                MOVE SPACE TO RC013-ACTION-SW (RC013-IDX)        07609018
076100*                MOVE LQW-PO-NBR (LQW-IDX)                        07610018
076110*                           TO RC013-PO-NBR   (RC013-IDX)         07611018
076120*                              DK-PO-NBR                          07612018
076130*                MOVE LQW-RECEIVER (LQW-IDX)                      07613018
076140*                           TO RC013-REC-SEQ-NBR (RC013-IDX)      07614018
076150*                              DK-REC-SEQ-NBR                     07615018
076160*                                                                 07616018
076170*                PERFORM 4378-CHECK-OPER-AND-FACILTY              07617018
076180*                                                                 07618018
076190*                IF RECEIV-STATUS-CDE = 'VE'                      07619018
076200*                    SET PS-VERIFIED-RECEIVER TO TRUE             07620018
076210*                    MOVE PC-ERR TO LQW-ACTION (LQW-IDX)          07621018
076220*                END-IF                                           07622018
076230*                MOVE ASC-KEY-OPER-UNT-ID                         07623018
076240*                           TO RC013-OPER-UNT-ID (RC013-IDX)      07624018
076250*                MOVE ASC-KEY-FCLTY-ID                            07625018
076260*                           TO RC013-FCLTY-ID (RC013-IDX)         07626018
076270*                                                                 07627018
076280*                IF LQW-RECEIVER(LQW-IDX) = ZERO                  07628018
076290*                   SET PS-RECEIVER-DOESNT-EXIST TO TRUE          07629018
076300*                END-IF                                           07630018
076310*                                                                 07631018
076320*                SET RC013-IDX UP BY 1                            07632018
076330*                IF RC013-IDX > RC013-MAX-ITEMS                   07633018
076340*                    PERFORM 5305-WRITE-SEL-QUEUE                 07634018
076350*                    ADD +1  TO RC015-NUMBER-OF-TS-ITEMS          07635018
076360*                    INITIALIZE RC013-SELECTED-ITEM-ARRAY         07636018
076370*                    SET RC013-IDX TO 1                           07637018
076380*                END-IF                                           07638018
076390*            END-IF                                               07639018
076400*        END-PERFORM                                              07640018
076410*    END-IF.                                                      07641018
076420*    IF PS-VERIFIED-RECEIVER                                      07642018
076430*        PERFORM 6113-WRITE-LIST-QUEUE                            07643018
076440*    END-IF.                                                      07644018
076450*                                                                 07645018
076460*                                                                 07646018
076470*----------------------------------------------------------------*07647018
076480*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *07648018
076490*----------------------------------------------------------------*07649018
076500 5305-WRITE-SEL-QUEUE.                                            07650018
076510                                                                  07651018
076520     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO RC013-SELECTED-ITEMS.   07652018
076530                                                                  07653018
076540     EXEC CICS                                                    07654018
076550          WRITEQ TS                                               07655018
076560              QUEUE (ASC-SEL-QUEUE-NAME)                          07656018
076570              FROM  (RC013-DC-SELECT-RECORD)                      07657018
076580              ITEM  (PV-SEL-QUEUE-ITEM)                           07658018
076590              RESP  (PV-CICS-RESP)                                07659018
076600     END-EXEC.                                                    07660018
076610     IF PV-CICS-RESP = DFHRESP (NORMAL)                           07661018
076620         CONTINUE                                                 07662018
076630     ELSE                                                         07663018
076640         SET DP013-CICS-ABEND        TO TRUE                      07664018
076650         SET DP013-NO-ROLLBACK       TO TRUE                      07665018
076660         MOVE '5305-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           07666018
076670         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07667018
076680                                     TO DP013-MESSAGE-TEXT(1)     07668018
076690         PERFORM DP013-0000-PROCESS-ABEND                         07669018
076700     END-IF.                                                      07670018
076710                                                                  07671018
076720*-----------------------------------------------------------------07672018
076730* FETCH FOR TOTAL UNITS                                           07673018
076740*-----------------------------------------------------------------07674018
076750 5310-FETCH-TOTAL-UNITS.                                          07675018
076760                                                                  07676018
076770     EXEC SQL                                                     07677018
076780            FETCH   RECV-ITM-CSR                                  07678018
076790            INTO   :RECITM-ORD-LNE-NBR                            07679018
076800                 , :RECITM-STATUS-CDE                             07680018
076810                 , :RECITM-PKSL-ITM-QTY                           07681018
076820                 , :RECITM-DTL-CK-ITM-QTY                         07682018
076830     END-EXEC                                                     07683018
076840                                                                  07684018
076850                                                                  07685018
076860     EVALUATE TRUE                                                07686018
076870         WHEN SQLCODE = ZERO                                      07687018
076880              PERFORM 5320-CHECK-RECEIPT-DISTRB                   07688018
076890         WHEN SQLCODE = +100                                      07689018
076900              SET PS-END-OF-RECITM-CSR TO TRUE                    07690018
076910         WHEN SQLWARN0 NOT = SPACE                                07691018
076920         WHEN SQLCODE NOT = ZERO                                  07692018
076930              MOVE '5310-FETCH-TOTAL-UNITS'                       07693018
076940                               TO DP013-PARAGRAPH                 07694018
076950              MOVE 'FETCH MESSAGE CURSOR'                         07695018
076960                               TO DP013-MESSAGE-TEXT (1)          07696018
076970              MOVE DK-PO-NBR  TO PV-ERROR-PO                      07697018
076980              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 07698018
076990              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         07699018
077000              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       07700018
077010              MOVE SQLCA       TO DP013-SQLCA                     07701018
077020              SET DP013-DB2-ABEND                                 07702018
077030                               TO TRUE                            07703018
077040              PERFORM DP013-0000-PROCESS-ABEND                    07704018
077050     END-EVALUATE.                                                07705018
077060******************************************************************07706018
077070******************************************************************07707018
077080 5320-CHECK-RECEIPT-DISTRB.                                       07708018
077090                                                                  07709018
077100     EXEC SQL                                                     07710018
077110            SELECT SUM(VERIFY_ITM_QTY)                            07711018
077120                 , SUM(AP_VERIFY_ITM_QTY)                         07712018
077130            INTO   :PV-VERIFY-ITM-QTY                             07713018
077140                 , :PV-AP-VERIFY-ITM-QTY                          07714018
077150            FROM    TRECDIS                                       07715018
077160           WHERE   ORD_NBR        = :DK-PO-NBR                    07716018
077170              AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR               07717018
077180              AND  ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR           07718018
077190           WITH UR                                                07719018
077200     END-EXEC                                                     07720018
077210                                                                  07721018
077220                                                                  07722018
077230     EVALUATE TRUE                                                07723018
077240         WHEN SQLCODE = ZERO                                      07724018
077250         WHEN SQLCODE = -305                                      07725018
077260         WHEN SQLCODE = +100                                      07726018
077270              CONTINUE                                            07727018
077280         WHEN SQLWARN0 NOT = SPACE                                07728018
077290         WHEN SQLCODE NOT = ZERO                                  07729018
077300              MOVE '5320-CHECK-RECEIPT-DISTRB'                    07730018
077310                               TO DP013-PARAGRAPH                 07731018
077320              MOVE 'FETCH MESSAGE CURSOR'                         07732018
077330                               TO DP013-MESSAGE-TEXT (1)          07733018
077340              MOVE DK-PO-NBR  TO PV-ERROR-PO                      07734018
077350              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 07735018
077360              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         07736018
077370              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       07737018
077380              MOVE SQLCA       TO DP013-SQLCA                     07738018
077390              SET DP013-DB2-ABEND                                 07739018
077400                               TO TRUE                            07740018
077410              PERFORM DP013-0000-PROCESS-ABEND                    07741018
077420     END-EVALUATE.                                                07742018
077430                                                                  07743018
077440     IF SQLCODE = ZERO                                            07744018
077450        IF RECITM-STATUS-CDE = 'VE'                               07745018
077460           ADD PV-AP-VERIFY-ITM-QTY TO  PV-PO-RCVR-UNT-CNTR       07746018
077470        ELSE                                                      07747018
077480           ADD PV-VERIFY-ITM-QTY TO PV-PO-RCVR-UNT-CNTR           07748018
077490        END-IF                                                    07749018
077500     ELSE                                                         07750018
077510        IF RECITM-DTL-CK-ITM-QTY > 0                              07751018
077520           ADD RECITM-DTL-CK-ITM-QTY TO  PV-PO-RCVR-UNT-CNTR      07752018
077530        ELSE                                                      07753018
077540           ADD RECITM-PKSL-ITM-QTY TO PV-PO-RCVR-UNT-CNTR         07754018
077550        END-IF                                                    07755018
077560     END-IF.                                                      07756018
077570                                                                  07757018
077580                                                                  07758018
077590*----------------------------------------------------------------*07759018
077600 5350-FILL-SEL-QUEUE-RECORD.                                      07760018
077610                                                                  07761018
077620     PERFORM 6112-READ-LIST-QUEUE.                                07762018
077630                                                                  07763018
077640     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        07764018
077650         PERFORM                                                  07765018
077660           VARYING LQW-IDX FROM 1 BY 1                            07766018
077670             UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                   07767018
077680                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO          07768018
077690                                                                  07769018
077700             IF LQW-SELECT (LQW-IDX)                              07770018
077710                 EVALUATE TRUE                                    07771018
077720                     WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)  07772018
077730                     WHEN DP020-FK-CONFIRM (DP020-SRC-AID)        07773018
077740                         PERFORM 2650-HEADER-ITEMS                07774018
077750                 END-EVALUATE                                     07775018
077760                 IF PC140-CRA-SUCCESSFUL                          07776018
077770                     SET LQW-DESELECT (LQW-IDX)                   07777018
077780                                     TO TRUE                      07778018
077790                     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS 07779018
077800                 END-IF                                           07780018
077810             END-IF                                               07781018
077820         END-PERFORM                                              07782018
077830     END-IF.                                                      07783018
077840                                                                  07784018
077850*   DEAD CODE 1/24/2005                                           07785018
077860*5400-FILL-SEL-QUEUE-RECORD.                                      07786018
077870*                                                                 07787018
077880*    PERFORM 6112-READ-LIST-QUEUE.                                07788018
077890*                                                                 07789018
077900*    IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        07790018
077910*        PERFORM                                                  07791018
077920*          VARYING LQW-IDX FROM 1 BY 1                            07792018
077930*            UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                   07793018
077940*               OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO          07794018
077950*                                                                 07795018
077960*            IF LQW-SELECT (LQW-IDX)                              07796018
077970*                MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              07797018
077980*                           TO PC237-ITEM (PC237-IDX)             07798018
077990*                MOVE SPACE TO PC237-ACTION-SW (PC237-IDX)        07799018
078000*                MOVE LQW-PO-NBR (LQW-IDX)                        07800018
078010*                           TO PC237-PO-NBR   (PC237-IDX)         07801018
078020*                              DK-PO-NBR                          07802018
078030*                MOVE LQW-RECEIVER (LQW-IDX)                      07803018
078040*                           TO PC237-REC-SEQ-NBR (PC237-IDX)      07804018
078050*                              DK-REC-SEQ-NBR                     07805018
078060*                                                                 07806018
078070*                PERFORM 4378-CHECK-OPER-AND-FACILTY              07807018
078080*                                                                 07808018
078090*                IF RECEIV-STATUS-CDE = 'VE'                      07809018
078100*                    SET PS-VERIFIED-RECEIVER TO TRUE             07810018
078110*                    MOVE PC-ERR TO LQW-ACTION (LQW-IDX)          07811018
078120*                END-IF                                           07812018
078130*                MOVE ASC-KEY-OPER-UNT-ID                         07813018
078140*                           TO PC237-OPER-UNT-ID (PC237-IDX)      07814018
078150*                MOVE ASC-KEY-FCLTY-ID                            07815018
078160*                           TO PC237-FCLTY-ID (PC237-IDX)         07816018
078170*                                                                 07817018
078180*                IF LQW-RECEIVER(LQW-IDX) = ZERO                  07818018
078190*                   SET PS-RECEIVER-DOESNT-EXIST TO TRUE          07819018
078200*                END-IF                                           07820018
078210*                                                                 07821018
078220*                SET PC237-IDX UP BY 1                            07822018
078230*                IF PC237-IDX > PC237-MAX-ITEMS                   07823018
078240*                    PERFORM 5405-WRITE-SEL-QUEUE                 07824018
078250*                    ADD +1  TO PC236-NUMBER-OF-TS-ITEMS          07825018
078260*                    INITIALIZE PC237-SELECTED-ITEM-ARRAY         07826018
078270*                    SET PC237-IDX TO 1                           07827018
078280*                END-IF                                           07828018
078290*            END-IF                                               07829018
078300*        END-PERFORM                                              07830018
078310*    END-IF.                                                      07831018
078320*    IF PS-VERIFIED-RECEIVER                                      07832018
078330*        PERFORM 6113-WRITE-LIST-QUEUE                            07833018
078340*    END-IF.                                                      07834018
078350*                                                                 07835018
078360*----------------------------------------------------------------*07836018
078370*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *07837018
078380*----------------------------------------------------------------*07838018
078390 5405-WRITE-SEL-QUEUE.                                            07839018
078400                                                                  07840018
078410     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO PC237-SELECTED-ITEMS.   07841018
078420                                                                  07842018
078430     EXEC CICS                                                    07843018
078440          WRITEQ TS                                               07844018
078450              QUEUE (ASC-SEL-QUEUE-NAME)                          07845018
078460              FROM  (PC237-DC-SELECT-RECORD)                      07846018
078470              ITEM  (PV-SEL-QUEUE-ITEM)                           07847018
078480              RESP  (PV-CICS-RESP)                                07848018
078490     END-EXEC.                                                    07849018
078500     IF PV-CICS-RESP = DFHRESP (NORMAL)                           07850018
078510         CONTINUE                                                 07851018
078520     ELSE                                                         07852018
078530         SET DP013-CICS-ABEND        TO TRUE                      07853018
078540         SET DP013-NO-ROLLBACK       TO TRUE                      07854018
078550         MOVE '5405-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           07855018
078560         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07856018
078570                                     TO DP013-MESSAGE-TEXT(1)     07857018
078580         PERFORM DP013-0000-PROCESS-ABEND                         07858018
078590     END-IF.                                                      07859018
078600                                                                  07860018
078610*----------------------------------------------------------------*07861018
078620*FILL SELECT QUEUE FOR RECEIVER UPDATE                            07862018
078630 5500-FILL-SEL-QUEUE-RECORD.                                      07863018
078640                                                                  07864018
078650     PERFORM 6112-READ-LIST-QUEUE.                                07865018
078660                                                                  07866018
078670     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        07867018
078680         PERFORM                                                  07868018
078690           VARYING LQW-IDX FROM 1 BY 1                            07869018
078700             UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                   07870018
078710                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO          07871018
078720                                                                  07872018
078730             IF LQW-SELECT (LQW-IDX)                              07873018
078740                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              07874018
078750                                         TO RC816-ITEM (RC816-IDX)07875018
078760                 MOVE SPACE TO RC816-ACTION-SW (RC816-IDX)        07876018
078770                 MOVE LQW-PO-NBR (LQW-IDX)                        07877018
078780                                       TO RC816-PO-NBR (RC816-IDX)07878018
078790                                          DK-PO-NBR               07879018
078800                 MOVE LQW-RECEIVER (LQW-IDX)                      07880018
078810                                     TO RC816-RCVR-NBR (RC816-IDX)07881018
078820                                        DK-REC-SEQ-NBR            07882018
078830                 MOVE LQW-VND-NME (LQW-IDX)                       07883018
078840                                       TO RC816-VENDOR (RC816-IDX)07884018
078850                 IF LQW-PO-IND (LQW-IDX) = 'A'                    07885018
078860                     SET PS-FREE-ASTRAY-NO  TO TRUE               07886018
078870                 ELSE                                             07887018
078880                     SET PS-FREE-ASTRAY     TO TRUE               07888018
078890                 END-IF                                           07889018
078900                 MOVE LQW-PACK-TYPE (LQW-IDX)                     07890018
078910                                     TO RC816-PKG-CODE (RC816-IDX)07891018
078920                 MOVE LQW-PO-STATUS (LQW-IDX)                     07892018
078930                                    TO RC816-PO-STATUS (RC816-IDX)07893018
078940                 MOVE LQW-ACTL-SCN-COUNT (LQW-IDX)                07894018
078950                               TO RC816-ACTL-SCN-COUNT (RC816-IDX)07895018
078960                 MOVE LQW-ACTL-CART-COUNT     (LQW-IDX)           07896018
078970                              TO RC816-ACTL-CART-COUNT (RC816-IDX)07897018
078980                                                                  07898018
078990                 PERFORM 4378-CHECK-OPER-AND-FACILTY              07899018
079000                                                                  07900018
079010                 IF RECEIV-STATUS-CDE = 'VE'                      07901018
079020                     SET PS-VERIFIED-RECEIVER TO TRUE             07902018
079030*                    MOVE PC-ERR TO LQW-ACTION (LQW-IDX)          07903018
079040                 END-IF                                           07904018
079050                                                                  07905018
079060                 IF LQW-RECEIVER(LQW-IDX) = ZERO                  07906018
079070                     SET PS-RECEIVER-DOESNT-EXIST TO TRUE         07907018
079080                 END-IF                                           07908018
079090                                                                  07909018
079100                 SET RC816-IDX UP BY 1                            07910018
079110                 IF RC816-IDX > RC816-MAX-ITEMS                   07911018
079120                     PERFORM 5505-WRITE-SEL-QUEUE                 07912018
079130                     ADD +1  TO RC815-NUMBER-OF-TS-ITEMS          07913018
079140                     INITIALIZE RC816-SELECTED-ITEM-ARRAY         07914018
079150                     SET RC816-IDX TO 1                           07915018
079160                 END-IF                                           07916018
079170             END-IF                                               07917018
079180         END-PERFORM                                              07918018
079190     END-IF.                                                      07919018
079200     IF PS-VERIFIED-RECEIVER                                      07920018
079210         PERFORM 6113-WRITE-LIST-QUEUE                            07921018
079220     END-IF.                                                      07922018
079230                                                                  07923018
079240*----------------------------------------------------------------*07924018
079250*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *07925018
079260*----------------------------------------------------------------*07926018
079270 5505-WRITE-SEL-QUEUE.                                            07927018
079280                                                                  07928018
079290     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO RC816-SELECTED-ITEMS.   07929018
079300                                                                  07930018
079310     EXEC CICS                                                    07931018
079320          WRITEQ TS                                               07932018
079330              QUEUE (ASC-SEL-QUEUE-NAME)                          07933018
079340              FROM  (RC816-SELECT-RECORD)                         07934018
079350              ITEM  (PV-SEL-QUEUE-ITEM)                           07935018
079360              RESP  (PV-CICS-RESP)                                07936018
079370     END-EXEC.                                                    07937018
079380     IF PV-CICS-RESP = DFHRESP (NORMAL)                           07938018
079390         CONTINUE                                                 07939018
079400     ELSE                                                         07940018
079410         SET DP013-CICS-ABEND        TO TRUE                      07941018
079420         SET DP013-NO-ROLLBACK       TO TRUE                      07942018
079430         MOVE '5505-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           07943018
079440         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          07944018
079450                                     TO DP013-MESSAGE-TEXT(1)     07945018
079460         PERFORM DP013-0000-PROCESS-ABEND                         07946018
079470     END-IF.                                                      07947018
079480                                                                  07948018
079490*----------------------------------------------------------------*07949018
079500*FILL SELECT QUEUE FOR RECEIVER UPDATE                            07950018
079510 5600-FILL-SEL-QUEUE-RECORD.                                      07951018
079520                                                                  07952018
079530     PERFORM 6112-READ-LIST-QUEUE.                                07953018
079540                                                                  07954018
079550     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        07955018
079560         PERFORM                                                  07956018
079570           VARYING LQW-IDX FROM 1 BY 1                            07957018
079580             UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                   07958018
079590                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO          07959018
079600                                                                  07960018
079610             IF LQW-SELECT (LQW-IDX)                              07961018
079620                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              07962018
079630                                         TO RC816-ITEM (RC816-IDX)07963018
079640                 MOVE SPACE TO RC816-ACTION-SW (RC816-IDX)        07964018
079650                 MOVE LQW-PO-NBR (LQW-IDX)                        07965018
079660                                       TO RC816-PO-NBR (RC816-IDX)07966018
079670                                          DK-PO-NBR               07967018
079680                 MOVE LQW-RECEIVER (LQW-IDX)                      07968018
079690                                     TO RC816-RCVR-NBR (RC816-IDX)07969018
079700                                        DK-REC-SEQ-NBR            07970018
079710                 MOVE LQW-VND-NME (LQW-IDX)                       07971018
079720                                       TO RC816-VENDOR (RC816-IDX)07972018
079730                 IF LQW-PO-IND (LQW-IDX) = 'A'                    07973018
079740                      SET PS-FREE-ASTRAY-NO  TO TRUE              07974018
079750                 ELSE                                             07975018
079760                     SET PS-FREE-ASTRAY     TO TRUE               07976018
079770                 END-IF                                           07977018
079780                 MOVE LQW-PACK-TYPE (LQW-IDX)                     07978018
079790                                     TO RC816-PKG-CODE (RC816-IDX)07979018
079800                 MOVE LQW-PO-STATUS (LQW-IDX)                     07980018
079810                                    TO RC816-PO-STATUS (RC816-IDX)07981018
079820                 MOVE LQW-ACTL-SCN-COUNT (LQW-IDX)                07982018
079830                               TO RC816-ACTL-SCN-COUNT (RC816-IDX)07983018
079840                 MOVE LQW-ACTL-CART-COUNT     (LQW-IDX)           07984018
079850                              TO RC816-ACTL-CART-COUNT (RC816-IDX)07985018
079860                                                                  07986018
079870                 PERFORM 4378-CHECK-OPER-AND-FACILTY              07987018
079880                                                                  07988018
079890                 IF RECEIV-STATUS-CDE = 'VE'                      07989018
079900                     SET PS-VERIFIED-RECEIVER TO TRUE             07990018
079910*                    MOVE PC-ERR TO LQW-ACTION (LQW-IDX)          07991018
079920                 END-IF                                           07992018
079930                                                                  07993018
079940                 IF LQW-RECEIVER(LQW-IDX) = ZERO                  07994018
079950                     SET PS-RECEIVER-DOESNT-EXIST TO TRUE         07995018
079960                 END-IF                                           07996018
079970                                                                  07997018
079980                 SET RC816-IDX UP BY 1                            07998018
079990                 IF RC816-IDX > RC816-MAX-ITEMS                   07999018
080000                     PERFORM 5505-WRITE-SEL-QUEUE                 08000018
080010                     ADD +1  TO RC815-NUMBER-OF-TS-ITEMS          08001018
080020                     INITIALIZE RC816-SELECTED-ITEM-ARRAY         08002018
080030                     SET RC816-IDX TO 1                           08003018
080040                 END-IF                                           08004018
080050             END-IF                                               08005018
080060         END-PERFORM                                              08006018
080070     END-IF.                                                      08007018
080080     IF PS-VERIFIED-RECEIVER                                      08008018
080090         PERFORM 6113-WRITE-LIST-QUEUE                            08009018
080100     END-IF.                                                      08010018
080110                                                                  08011018
080120*----------------------------------------------------------------*08012018
080130*  RETRIEVE THE PRIMARY VENDOR NAME                               08013018
080140*----------------------------------------------------------------*08014018
080150 5910-GET-ENT-NAME-DESC.                                          08015018
080160                                                                  08016018
080170     PERFORM                                                      08017018
080180         WITH TEST AFTER                                          08018018
080190         VARYING PV-RETRY-COUNTER                                 08019018
080200         FROM 1 BY 1                                              08020018
080210         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08021018
080220             OR (SQLCODE = +0)                                    08022018
080230             OR (SQLCODE = +100))                                 08023018
080240                                                                  08024018
080250         EXEC SQL                                                 08025018
080260              SELECT B.ENT_NAME_DESC                              08026018
080270                INTO :ENTNME-ENT-NAME-DESC                        08027018
080280                FROM TPURCHS A                                    08028018
080290                    ,TENTNME B                                    08029018
080300               WHERE A.PO_NBR         = :DK-PO-NBR                08030018
080310                 AND A.VER_STATUS_CDE = 'A'                       08031018
080320                 AND B.TYPE_CDE       = '01'                      08032018
080330                 AND A.ENT_ID = B.ENT_ID                          08033018
080340         END-EXEC                                                 08034018
080350                                                                  08035018
080360         EVALUATE TRUE                                            08036018
080370             WHEN SQLCODE = +0                                    08037018
080380               CONTINUE                                           08038018
080390             WHEN SQLCODE = +100                                  08039018
080400               MOVE PC-UNKNWN-VND-NME TO ENTNME-ENT-NAME-DESC     08040018
080410             WHEN SQLWARN0 NOT = SPACES                           08041018
080420             WHEN SQLCODE < +0                                    08042018
080430             WHEN SQLCODE > +0                                    08043018
080440                  MOVE '5910-GET-ENT-NAME-DESC'                   08044018
080450                                  TO DP013-PARAGRAPH              08045018
080460                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      08046018
080470                                  TO DP013-MESSAGE-TEXT (1)       08047018
080480                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  08048018
080490                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             08049018
080500                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     08050018
080510                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   08051018
080520                  MOVE SQLCA      TO DP013-SQLCA                  08052018
080530                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     08053018
080540                  SET DP013-DB2-ABEND                             08054018
080550                      DP013-XCTL-DISPLAY-RESTART                  08055018
080560                                  TO TRUE                         08056018
080570                  PERFORM DP013-0000-PROCESS-ABEND                08057018
080580         END-EVALUATE                                             08058018
080590     END-PERFORM.                                                 08059018
080600                                                                  08060018
080610     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08061018
080620         SQLCODE NOT = ZERO                                       08062018
080630         MOVE '5910-GET-ENT-NAME-DESC'                            08063018
080640                                  TO DP013-PARAGRAPH              08064018
080650         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    08065018
080660                                  TO DP013-MESSAGE-TEXT (1)       08066018
080670         MOVE SQLCA               TO DP013-SQLCA                  08067018
080680         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     08068018
080690         SET DP013-DB2-ABEND                                      08069018
080700             DP013-XCTL-DISPLAY-RESTART                           08070018
080710                                  TO TRUE                         08071018
080720         PERFORM DP013-0000-PROCESS-ABEND                         08072018
080730     END-IF.                                                      08073018
080740                                                                  08074018
080750******************************************************************08075018
080760 6000-REFRESH-PANEL-FROM-TEMP.                                    08076018
080770     IF  ASC-UPDATE-TSQ AND                                       08077018
080780         ((ASC-FUNC02-RETURN-YES OR                               08078018
080790           ASC-FUNC03-RETURN-YES OR                               08079018
080800           ASC-FUNC05-RETURN-YES OR                               08080018
080810           ASC-FUNC06-RETURN-YES OR                               08081018
080820           ASC-FUNC07-RETURN-YES OR                               08082018
080830           ASC-FUNC08-RETURN-YES OR                               08083018
080840           ASC-FUNC11-RETURN-YES OR                               08084018
080850           ASC-FUNC10-RETURN-YES) OR                              08085018
080860          SU003-UPDATE-TSQ)                                       08086018
080870         SET ASC-NO-TSQ-UPDATE TO TRUE                            08087018
080880         MOVE ZERO                 TO PV-SAVE-ITEM                08088018
080890                                      PV-SEL-QUEUE-ITEM           08089018
080900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        08090018
080910                                   TO PV-HOLD-SELECTED-ITEMS      08091018
080920         MOVE +1                   TO PV-ITEMS-PROCESSED          08092018
080930                                                                  08093018
080940         EVALUATE TRUE                                            08094018
080950            WHEN ASC-FUNC02-RETURN-YES                            08095018
080960              OR ASC-FUNC11-RETURN-YES                            08096018
080970*             OR ASC-FUNC06-RETURN-YES                            08097018
080980               PERFORM 6200-UPDATE-TSQ                            08098018
080990                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08099018
081000                                                                  08100018
081010            WHEN ASC-FUNC03-RETURN-YES OR                         08101018
081020                 ASC-FUNC05-RETURN-YES                            08102018
081030              OR ASC-FUNC06-RETURN-YES                            08103018
081040               PERFORM 6400-UPDATE-TSQ                            08104018
081050                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08105018
081060                                                                  08106018
081070*           WHEN ASC-FUNC06-RETURN-YES                            08107018
081080*              PERFORM 6300-UPDATE-TSQ                            08108018
081090*                UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08109018
081100                                                                  08110018
081110            WHEN ASC-FUNC07-RETURN-YES                            08111018
081120               PERFORM 6700-UPDATE-TSQ                            08112018
081130                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08113018
081140                                                                  08114018
081150            WHEN ASC-FUNC08-RETURN-YES                            08115018
081160               PERFORM 6800-UPDATE-TSQ                            08116018
081170                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08117018
081180                                                                  08118018
081190            WHEN ASC-FUNC10-RETURN-YES                            08119018
081200               PERFORM 6900-UPDATE-TSQ                            08120018
081210                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08121018
081220                                                                  08122018
081230*           WHEN ASC-FUNC09-RETURN-YES                            08123018
081240*              PERFORM 6100-UPDATE-TSQ                            08124018
081250*                UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08125018
081260                                                                  08126018
081270            WHEN OTHER                                            08127018
081280               PERFORM 6100-UPDATE-TSQ                            08128018
081290                 UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS08129018
081300         END-EVALUATE                                             08130018
081310                                                                  08131018
081320         SET ASC-FUNC02-RETURN-NO TO TRUE                         08132018
081330         SET ASC-FUNC03-RETURN-NO TO TRUE                         08133018
081340         SET ASC-FUNC05-RETURN-NO TO TRUE                         08134018
081350         SET ASC-FUNC06-RETURN-NO TO TRUE                         08135018
081360         SET ASC-FUNC07-RETURN-NO TO TRUE                         08136018
081370         SET ASC-FUNC08-RETURN-NO TO TRUE                         08137018
081380         SET ASC-FUNC11-RETURN-NO TO TRUE                         08138018
081390                                                                  08139018
081400                                                                  08140018
081410         INITIALIZE ASC-BLOCK-ENTRIES (1)                         08141018
081420                    ASC-BLOCK-ENTRIES (2)                         08142018
081430     END-IF.                                                      08143018
081440                                                                  08144018
081450*----------------------------------------------------------------*08145018
081460*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *08146018
081470*----------------------------------------------------------------*08147018
081480 6010-DELETE-SEL-QUEUE.                                           08148018
081490                                                                  08149018
081500     EXEC CICS                                                    08150018
081510         DELETEQ TS                                               08151018
081520             QUEUE (ASC-SEL-QUEUE-NAME)                           08152018
081530             RESP  (PV-CICS-RESP)                                 08153018
081540     END-EXEC.                                                    08154018
081550     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      08155018
081560        (PV-CICS-RESP = DFHRESP(QIDERR)))                         08156018
081570         CONTINUE                                                 08157018
081580     ELSE                                                         08158018
081590         SET DP013-CICS-ABEND TO TRUE                             08159018
081600         SET DP013-NO-ROLLBACK TO TRUE                            08160018
081610         MOVE '6010-DELETE-SEL-QUEUE'                             08161018
081620                        TO DP013-PARAGRAPH                        08162018
081630         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         08163018
081640                        TO DP013-MESSAGE-TEXT (1)                 08164018
081650         PERFORM DP013-0000-PROCESS-ABEND                         08165018
081660     END-IF.                                                      08166018
081670                                                                  08167018
081680*----------------------------------------------------------------*08168018
081690*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *08169018
081700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *08170018
081710*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *08171018
081720*    THE TEMP QUEUE.                                             *08172018
081730*----------------------------------------------------------------*08173018
081740 6100-UPDATE-TSQ.                                                 08174018
081750                                                                  08175018
081760     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             08176018
081770     PERFORM 6105-READ-SEL-QUEUE.                                 08177018
081780     PERFORM                                                      08178018
081790         VARYING SU004-IDX                                        08179018
081800         FROM 1 BY 1                                              08180018
081810         UNTIL ((PV-ITEMS-PROCESSED >                             08181018
081820                              PV-HOLD-SELECTED-ITEMS)             08182018
081830         OR (SU004-IDX GREATER THAN SU004-MAX-ITEMS))             08183018
081840         IF  SU004-ACTION-SW (SU004-IDX) > SPACE                  08184018
081850             PERFORM 6110-PROCESS-ITEMS                           08185018
081860         END-IF                                                   08186018
081870         ADD +1                TO PV-ITEMS-PROCESSED              08187018
081880     END-PERFORM.                                                 08188018
081890     PERFORM 6111-WRITE-LIST-QUEUE.                               08189018
081900                                                                  08190018
081910*----------------------------------------------------------------*08191018
081920*    READ THE LIST QUEUE RECORD.                                 *08192018
081930*----------------------------------------------------------------*08193018
081940 6105-READ-SEL-QUEUE.                                             08194018
081950                                                                  08195018
081960     EXEC CICS                                                    08196018
081970          READQ TS                                                08197018
081980              QUEUE (ASC-SEL-QUEUE-NAME)                          08198018
081990              INTO  (SU004-DC-SELECT-RECORD)                      08199018
082000              ITEM  (PV-SEL-QUEUE-ITEM)                           08200018
082010              RESP  (PV-CICS-RESP)                                08201018
082020     END-EXEC.                                                    08202018
082030*                                                                 08203018
082040     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          08204018
082050         CONTINUE                                                 08205018
082060     ELSE                                                         08206018
082070         SET DP013-CICS-ABEND      TO  TRUE                       08207018
082080         SET DP013-NO-ROLLBACK     TO  TRUE                       08208018
082090         MOVE '6105-READ-SEL-QUEUE'                               08209018
082100                                   TO  DP013-PARAGRAPH            08210018
082110         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08211018
082120                                   TO  DP013-MESSAGE-TEXT(1)      08212018
082130         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08213018
082140         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08214018
082150         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08215018
082160         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08216018
082170         PERFORM DP013-0000-PROCESS-ABEND                         08217018
082180     END-IF.                                                      08218018
082190                                                                  08219018
082200*----------------------------------------------------------------*08220018
082210*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*08221018
082220*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*08222018
082230*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *08223018
082240*----------------------------------------------------------------*08224018
082250 6110-PROCESS-ITEMS.                                              08225018
082260                                                                  08226018
082270     COMPUTE PV-ITEM = 1 + ((SU004-ITEM (SU004-IDX) - 1)          08227018
082280                     / PC-ITEMS-PER-PANEL).                       08228018
082290                                                                  08229018
082300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           08230018
082310         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          08231018
082320             PERFORM 6111-WRITE-LIST-QUEUE                        08232018
082330         END-IF                                                   08233018
082340         MOVE PV-ITEM          TO PV-SAVE-ITEM                    08234018
082350                                                                  08235018
082360         PERFORM 6112-READ-LIST-QUEUE                             08236018
082370         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               08237018
082380             CONTINUE                                             08238018
082390         END-IF                                                   08239018
082400     END-IF.                                                      08240018
082410                                                                  08241018
082420     COMPUTE PV-SUB = (SU004-ITEM (SU004-IDX)                     08242018
082430                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08243018
082440     SET LQW-DESELECT (PV-SUB) TO    TRUE                         08244018
082450     MOVE LQW-SELECTED-SW (PV-SUB)                                08245018
082460                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08246018
082470     EVALUATE TRUE                                                08247018
082480         WHEN SU004-INQ (SU004-IDX)                               08248018
082490              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08249018
082500                                                                  08250018
082510         WHEN SU004-UPD (SU004-IDX)                               08251018
082520              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08252018
082530                                                                  08253018
082540         WHEN SU004-DEL (SU004-IDX)                               08254018
082550              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08255018
082560                                                                  08256018
082570         WHEN SU004-ERR (SU004-IDX)                               08257018
082580              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08258018
082590     END-EVALUATE.                                                08259018
082600                                                                  08260018
082610     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08261018
082620                                                                  08262018
082630*----------------------------------------------------------------*08263018
082640*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *08264018
082650*----------------------------------------------------------------*08265018
082660 6111-WRITE-LIST-QUEUE.                                           08266018
082670                                                                  08267018
082680     EXEC CICS                                                    08268018
082690         WRITEQ TS                                                08269018
082700             QUEUE (ASC-LIST-QUEUE-NAME)                          08270018
082710             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     08271018
082720             ITEM  (PV-SAVE-ITEM)                                 08272018
082730             REWRITE                                              08273018
082740             RESP  (PV-CICS-RESP)                                 08274018
082750     END-EXEC.                                                    08275018
082760*                                                                 08276018
082770     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          08277018
082780         CONTINUE                                                 08278018
082790     ELSE                                                         08279018
082800         SET DP013-CICS-ABEND  TO  TRUE                           08280018
082810         SET DP013-NO-ROLLBACK TO  TRUE                           08281018
082820         MOVE '6111-WRITE-LIST-QUEUE'                             08282018
082830                               TO  DP013-PARAGRAPH                08283018
082840         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  08284018
082850                               TO  DP013-MESSAGE-TEXT(1)          08285018
082860         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08286018
082870         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08287018
082880         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08288018
082890         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08289018
082900         PERFORM DP013-0000-PROCESS-ABEND                         08290018
082910     END-IF.                                                      08291018
082920                                                                  08292018
082930                                                                  08293018
082940*----------------------------------------------------------------*08294018
082950*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*08295018
082960*----------------------------------------------------------------*08296018
082970 6112-READ-LIST-QUEUE.                                            08297018
082980                                                                  08298018
082990     EXEC CICS                                                    08299018
083000         READQ TS                                                 08300018
083010             QUEUE (ASC-LIST-QUEUE-NAME)                          08301018
083020             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     08302018
083030             ITEM  (PV-ITEM)                                      08303018
083040             RESP  (PV-CICS-RESP)                                 08304018
083050     END-EXEC.                                                    08305018
083060     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          08306018
083070         CONTINUE                                                 08307018
083080     ELSE                                                         08308018
083090         SET DP013-CICS-ABEND        TO TRUE                      08309018
083100         SET DP013-NO-ROLLBACK       TO TRUE                      08310018
083110         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           08311018
083120         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    08312018
083130                                     TO DP013-MESSAGE-TEXT(1)     08313018
083140         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08314018
083150         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08315018
083160         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08316018
083170         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08317018
083180         PERFORM DP013-0000-PROCESS-ABEND                         08318018
083190     END-IF.                                                      08319018
083200                                                                  08320018
083210*----------------------------------------------------------------*08321018
083220*    WRITE THE TS QUEUE RECORD                                   *08322018
083230*----------------------------------------------------------------*08323018
083240 6113-WRITE-LIST-QUEUE.                                           08324018
083250                                                                  08325018
083260     EXEC CICS                                                    08326018
083270         WRITEQ TS                                                08327018
083280             QUEUE (ASC-LIST-QUEUE-NAME)                          08328018
083290             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     08329018
083300             ITEM  (PV-ITEM)                                      08330018
083310             REWRITE                                              08331018
083320             RESP  (PV-CICS-RESP)                                 08332018
083330     END-EXEC.                                                    08333018
083340*                                                                 08334018
083350     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          08335018
083360         CONTINUE                                                 08336018
083370     ELSE                                                         08337018
083380         SET DP013-CICS-ABEND  TO  TRUE                           08338018
083390         SET DP013-NO-ROLLBACK TO  TRUE                           08339018
083400         MOVE '6113-WRITE-LIST-QUEUE'                             08340018
083410                               TO  DP013-PARAGRAPH                08341018
083420         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  08342018
083430                               TO  DP013-MESSAGE-TEXT(1)          08343018
083440         PERFORM DP013-0000-PROCESS-ABEND                         08344018
083450     END-IF.                                                      08345018
083460                                                                  08346018
083470                                                                  08347018
083480*----------------------------------------------------------------*08348018
083490 6200-UPDATE-TSQ.                                                 08349018
083500                                                                  08350018
083510     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08351018
083520     PERFORM 6205-READ-SEL-QUEUE.                                 08352018
083530                                                                  08353018
083540     PERFORM                                                      08354018
083550       VARYING RC013-IDX FROM 1 BY 1                              08355018
083560         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08356018
083570            OR (RC013-IDX > RC013-MAX-ITEMS))                     08357018
083580                                                                  08358018
083590         IF RC013-ACTION-SW (RC013-IDX) > SPACE                   08359018
083600             PERFORM 6210-PROCESS-ITEMS                           08360018
083610         END-IF                                                   08361018
083620                                                                  08362018
083630         ADD +1 TO PV-ITEMS-PROCESSED                             08363018
083640     END-PERFORM.                                                 08364018
083650                                                                  08365018
083660     PERFORM 6111-WRITE-LIST-QUEUE.                               08366018
083670                                                                  08367018
083680*----------------------------------------------------------------*08368018
083690*    READ THE LIST QUEUE RECORD.                                 *08369018
083700*----------------------------------------------------------------*08370018
083710 6205-READ-SEL-QUEUE.                                             08371018
083720                                                                  08372018
083730     EXEC CICS                                                    08373018
083740          READQ TS                                                08374018
083750              QUEUE (ASC-SEL-QUEUE-NAME)                          08375018
083760              INTO  (RC013-DC-SELECT-RECORD)                      08376018
083770              ITEM  (PV-SEL-QUEUE-ITEM)                           08377018
083780              RESP  (PV-CICS-RESP)                                08378018
083790     END-EXEC.                                                    08379018
083800                                                                  08380018
083810     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08381018
083820         CONTINUE                                                 08382018
083830     ELSE                                                         08383018
083840         SET DP013-CICS-ABEND       TO  TRUE                      08384018
083850         SET DP013-NO-ROLLBACK      TO  TRUE                      08385018
083860         MOVE '6205-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08386018
083870         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08387018
083880                                    TO  DP013-MESSAGE-TEXT(1)     08388018
083890         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08389018
083900         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08390018
083910         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08391018
083920         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08392018
083930         PERFORM DP013-0000-PROCESS-ABEND                         08393018
083940     END-IF.                                                      08394018
083950                                                                  08395018
083960*----------------------------------------------------------------*08396018
083970*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*08397018
083980*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*08398018
083990*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *08399018
084000*----------------------------------------------------------------*08400018
084010 6210-PROCESS-ITEMS.                                              08401018
084020                                                                  08402018
084030     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          08403018
084040                     / PC-ITEMS-PER-PANEL).                       08404018
084050                                                                  08405018
084060     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08406018
084070         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08407018
084080             PERFORM 6111-WRITE-LIST-QUEUE                        08408018
084090         END-IF                                                   08409018
084100                                                                  08410018
084110         MOVE PV-ITEM TO PV-SAVE-ITEM                             08411018
084120                                                                  08412018
084130         PERFORM 6112-READ-LIST-QUEUE                             08413018
084140                                                                  08414018
084150         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08415018
084160             CONTINUE                                             08416018
084170         END-IF                                                   08417018
084180     END-IF.                                                      08418018
084190                                                                  08419018
084200     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     08420018
084210                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08421018
084220                                                                  08422018
084230     SET LQW-DESELECT (PV-SUB) TO TRUE                            08423018
084240     MOVE LQW-SELECTED-SW (PV-SUB)                                08424018
084250                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08425018
084260                                                                  08426018
084270     EVALUATE TRUE                                                08427018
084280         WHEN RC013-INQ (RC013-IDX)                               08428018
084290              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08429018
084300                                                                  08430018
084310         WHEN RC013-UPD (RC013-IDX)                               08431018
084320              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08432018
084330                                                                  08433018
084340         WHEN RC013-DEL (RC013-IDX)                               08434018
084350              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08435018
084360                                                                  08436018
084370         WHEN RC013-ERR (RC013-IDX)                               08437018
084380              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08438018
084390     END-EVALUATE.                                                08439018
084400                                                                  08440018
084410     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08441018
084420*  DEAD CODE 1/24/2005                                            08442018
084430*6300-UPDATE-TSQ.                                                 08443018
084440*                                                                 08444018
084450*    ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08445018
084460*    PERFORM 6305-READ-SEL-QUEUE.                                 08446018
084470*                                                                 08447018
084480*    PERFORM                                                      08448018
084490*      VARYING PC237-IDX FROM 1 BY 1                              08449018
084500*        UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08450018
084510*           OR (PC237-IDX > PC237-MAX-ITEMS))                     08451018
084520*                                                                 08452018
084530*        IF PC237-ACTION-SW (PC237-IDX) > SPACE                   08453018
084540*            PERFORM 6310-PROCESS-ITEMS                           08454018
084550*        END-IF                                                   08455018
084560*                                                                 08456018
084570*        ADD +1 TO PV-ITEMS-PROCESSED                             08457018
084580*    END-PERFORM.                                                 08458018
084590*                                                                 08459018
084600*    PERFORM 6111-WRITE-LIST-QUEUE.                               08460018
084610                                                                  08461018
084620*----------------------------------------------------------------*08462018
084630*    READ THE LIST QUEUE RECORD.                                 *08463018
084640*----------------------------------------------------------------*08464018
084650 6305-READ-SEL-QUEUE.                                             08465018
084660                                                                  08466018
084670     EXEC CICS                                                    08467018
084680          READQ TS                                                08468018
084690              QUEUE (ASC-SEL-QUEUE-NAME)                          08469018
084700              INTO  (PC237-DC-SELECT-RECORD)                      08470018
084710              ITEM  (PV-SEL-QUEUE-ITEM)                           08471018
084720              RESP  (PV-CICS-RESP)                                08472018
084730     END-EXEC.                                                    08473018
084740                                                                  08474018
084750     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08475018
084760         CONTINUE                                                 08476018
084770     ELSE                                                         08477018
084780         SET DP013-CICS-ABEND       TO  TRUE                      08478018
084790         SET DP013-NO-ROLLBACK      TO  TRUE                      08479018
084800         MOVE '6305-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08480018
084810         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08481018
084820                                    TO  DP013-MESSAGE-TEXT(1)     08482018
084830         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08483018
084840         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08484018
084850         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08485018
084860         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08486018
084870         PERFORM DP013-0000-PROCESS-ABEND                         08487018
084880     END-IF.                                                      08488018
084890                                                                  08489018
084900*----------------------------------------------------------------*08490018
084910*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*08491018
084920*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*08492018
084930*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *08493018
084940*----------------------------------------------------------------*08494018
084950 6310-PROCESS-ITEMS.                                              08495018
084960                                                                  08496018
084970     COMPUTE PV-ITEM = 1 + ((PC237-ITEM (PC237-IDX) - 1)          08497018
084980                     / PC-ITEMS-PER-PANEL).                       08498018
084990                                                                  08499018
085000     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08500018
085010         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08501018
085020             PERFORM 6111-WRITE-LIST-QUEUE                        08502018
085030         END-IF                                                   08503018
085040                                                                  08504018
085050         MOVE PV-ITEM TO PV-SAVE-ITEM                             08505018
085060                                                                  08506018
085070         PERFORM 6112-READ-LIST-QUEUE                             08507018
085080                                                                  08508018
085090         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08509018
085100             CONTINUE                                             08510018
085110         END-IF                                                   08511018
085120     END-IF.                                                      08512018
085130                                                                  08513018
085140     COMPUTE PV-SUB = (PC237-ITEM (PC237-IDX)                     08514018
085150                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08515018
085160                                                                  08516018
085170     SET LQW-DESELECT (PV-SUB) TO TRUE                            08517018
085180     MOVE LQW-SELECTED-SW (PV-SUB)                                08518018
085190                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08519018
085200                                                                  08520018
085210     EVALUATE TRUE                                                08521018
085220         WHEN PC237-INQ (PC237-IDX)                               08522018
085230              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08523018
085240                                                                  08524018
085250         WHEN PC237-UPD (PC237-IDX)                               08525018
085260              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08526018
085270                                                                  08527018
085280         WHEN PC237-DEL (PC237-IDX)                               08528018
085290              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08529018
085300                                                                  08530018
085310         WHEN PC237-ERR (PC237-IDX)                               08531018
085320              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08532018
085330     END-EVALUATE.                                                08533018
085340                                                                  08534018
085350     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08535018
085360                                                                  08536018
085370*----------------------------------------------------------------*08537018
085380 6400-UPDATE-TSQ.                                                 08538018
085390                                                                  08539018
085400     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08540018
085410     PERFORM 6405-READ-SEL-QUEUE.                                 08541018
085420                                                                  08542018
085430     PERFORM                                                      08543018
085440       VARYING RC816-IDX FROM 1 BY 1                              08544018
085450         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08545018
085460            OR (RC816-IDX > RC816-MAX-ITEMS))                     08546018
085470                                                                  08547018
085480         IF RC816-ACTION-SW (RC816-IDX) > SPACE                   08548018
085490             PERFORM 6410-PROCESS-ITEMS                           08549018
085500         END-IF                                                   08550018
085510                                                                  08551018
085520         ADD +1 TO PV-ITEMS-PROCESSED                             08552018
085530     END-PERFORM.                                                 08553018
085540                                                                  08554018
085550     PERFORM 6111-WRITE-LIST-QUEUE.                               08555018
085560                                                                  08556018
085570*----------------------------------------------------------------*08557018
085580*    READ THE LIST QUEUE RECORD.                                 *08558018
085590*----------------------------------------------------------------*08559018
085600 6405-READ-SEL-QUEUE.                                             08560018
085610                                                                  08561018
085620     EXEC CICS                                                    08562018
085630          READQ TS                                                08563018
085640              QUEUE (ASC-SEL-QUEUE-NAME)                          08564018
085650              INTO  (RC816-SELECT-RECORD)                         08565018
085660              ITEM  (PV-SEL-QUEUE-ITEM)                           08566018
085670              RESP  (PV-CICS-RESP)                                08567018
085680     END-EXEC.                                                    08568018
085690                                                                  08569018
085700     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08570018
085710         CONTINUE                                                 08571018
085720     ELSE                                                         08572018
085730         SET DP013-CICS-ABEND       TO  TRUE                      08573018
085740         SET DP013-NO-ROLLBACK      TO  TRUE                      08574018
085750         MOVE '6405-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08575018
085760         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08576018
085770                                    TO  DP013-MESSAGE-TEXT(1)     08577018
085780         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08578018
085790         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08579018
085800         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08580018
085810         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08581018
085820         PERFORM DP013-0000-PROCESS-ABEND                         08582018
085830     END-IF.                                                      08583018
085840                                                                  08584018
085850*----------------------------------------------------------------*08585018
085860*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*08586018
085870*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*08587018
085880*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *08588018
085890*----------------------------------------------------------------*08589018
085900 6410-PROCESS-ITEMS.                                              08590018
085910                                                                  08591018
085920     COMPUTE PV-ITEM = 1 + ((RC816-ITEM (RC816-IDX) - 1)          08592018
085930                     / PC-ITEMS-PER-PANEL).                       08593018
085940                                                                  08594018
085950     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08595018
085960         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08596018
085970             PERFORM 6111-WRITE-LIST-QUEUE                        08597018
085980         END-IF                                                   08598018
085990                                                                  08599018
086000         MOVE PV-ITEM TO PV-SAVE-ITEM                             08600018
086010                                                                  08601018
086020         PERFORM 6112-READ-LIST-QUEUE                             08602018
086030                                                                  08603018
086040         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08604018
086050             CONTINUE                                             08605018
086060         END-IF                                                   08606018
086070     END-IF.                                                      08607018
086080                                                                  08608018
086090     COMPUTE PV-SUB = (RC816-ITEM (RC816-IDX)                     08609018
086100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08610018
086110                                                                  08611018
086120     SET LQW-DESELECT (PV-SUB) TO TRUE                            08612018
086130     MOVE LQW-SELECTED-SW (PV-SUB)                                08613018
086140                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08614018
086150                                                                  08615018
086160     EVALUATE TRUE                                                08616018
086170         WHEN RC816-INQ (RC816-IDX)                               08617018
086180              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08618018
086190                                                                  08619018
086200         WHEN RC816-UPD (RC816-IDX)                               08620018
086210              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08621018
086220                                                                  08622018
086230         WHEN RC816-DEL (RC816-IDX)                               08623018
086240              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08624018
086250                                                                  08625018
086260         WHEN RC816-ERR (RC816-IDX)                               08626018
086270              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08627018
086280     END-EVALUATE.                                                08628018
086290                                                                  08629018
086300     MOVE RC816-PO-STATUS (RC816-IDX)                             08630018
086310                               TO LQW-PO-STATUS (PV-SUB).         08631018
086320     MOVE RC816-ACTL-CART-COUNT (RC816-IDX)                       08632018
086330                               TO LQW-ACTL-CART-COUNT (PV-SUB).   08633018
086340                                                                  08634018
086350     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08635018
086360/                                                                 08636018
086370 6700-UPDATE-TSQ.                                                 08637018
086380                                                                  08638018
086390     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08639018
086400     PERFORM 6705-READ-SEL-QUEUE.                                 08640018
086410                                                                  08641018
086420     PERFORM                                                      08642018
086430       VARYING SU025-IDX FROM 1 BY 1                              08643018
086440         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08644018
086450            OR (SU025-IDX > SU025-MAX-ITEMS))                     08645018
086460                                                                  08646018
086470         IF SU025-ACTION-SW (SU025-IDX) > SPACE                   08647018
086480             PERFORM 6710-PROCESS-ITEMS                           08648018
086490         END-IF                                                   08649018
086500                                                                  08650018
086510         ADD +1 TO PV-ITEMS-PROCESSED                             08651018
086520     END-PERFORM.                                                 08652018
086530                                                                  08653018
086540     PERFORM 6111-WRITE-LIST-QUEUE.                               08654018
086550                                                                  08655018
086560*LMM                                                              08656018
086570 6800-UPDATE-TSQ.                                                 08657018
086580                                                                  08658018
086590     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08659018
086600     PERFORM 6805-READ-SEL-QUEUE.                                 08660018
086610                                                                  08661018
086620     PERFORM                                                      08662018
086630       VARYING RC013-IDX FROM 1 BY 1                              08663018
086640         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08664018
086650            OR (RC013-IDX > RC013-MAX-ITEMS))                     08665018
086660                                                                  08666018
086670         IF RC013-ACTION-SW (RC013-IDX) > SPACE                   08667018
086680             PERFORM 6810-PROCESS-ITEMS                           08668018
086690         END-IF                                                   08669018
086700                                                                  08670018
086710         ADD +1 TO PV-ITEMS-PROCESSED                             08671018
086720     END-PERFORM.                                                 08672018
086730                                                                  08673018
086740     PERFORM 6111-WRITE-LIST-QUEUE.                               08674018
086750                                                                  08675018
086760 6705-READ-SEL-QUEUE.                                             08676018
086770                                                                  08677018
086780     EXEC CICS                                                    08678018
086790          READQ TS                                                08679018
086800              QUEUE (ASC-SEL-QUEUE-NAME)                          08680018
086810              INTO  (SU025-SELECT-RECORD)                         08681018
086820              ITEM  (PV-SEL-QUEUE-ITEM)                           08682018
086830              RESP  (PV-CICS-RESP)                                08683018
086840     END-EXEC.                                                    08684018
086850                                                                  08685018
086860     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08686018
086870         CONTINUE                                                 08687018
086880     ELSE                                                         08688018
086890         SET DP013-CICS-ABEND       TO  TRUE                      08689018
086900         SET DP013-NO-ROLLBACK      TO  TRUE                      08690018
086910         MOVE '6705-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08691018
086920         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08692018
086930                                    TO  DP013-MESSAGE-TEXT(1)     08693018
086940         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08694018
086950         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08695018
086960         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08696018
086970         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08697018
086980         PERFORM DP013-0000-PROCESS-ABEND                         08698018
086990     END-IF.                                                      08699018
087000                                                                  08700018
087010*LMM                                                              08701018
087020 6805-READ-SEL-QUEUE.                                             08702018
087030                                                                  08703018
087040     EXEC CICS                                                    08704018
087050          READQ TS                                                08705018
087060              QUEUE (ASC-SEL-QUEUE-NAME)                          08706018
087070              INTO  (RC013-DC-SELECT-RECORD)                      08707018
087080              ITEM  (PV-SEL-QUEUE-ITEM)                           08708018
087090              RESP  (PV-CICS-RESP)                                08709018
087100     END-EXEC.                                                    08710018
087110                                                                  08711018
087120     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08712018
087130         CONTINUE                                                 08713018
087140     ELSE                                                         08714018
087150         SET DP013-CICS-ABEND       TO  TRUE                      08715018
087160         SET DP013-NO-ROLLBACK      TO  TRUE                      08716018
087170         MOVE '6805-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08717018
087180         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08718018
087190                                    TO  DP013-MESSAGE-TEXT(1)     08719018
087200         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08720018
087210         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08721018
087220         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08722018
087230         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08723018
087240         PERFORM DP013-0000-PROCESS-ABEND                         08724018
087250     END-IF.                                                      08725018
087260                                                                  08726018
087270 6710-PROCESS-ITEMS.                                              08727018
087280                                                                  08728018
087290     COMPUTE PV-ITEM = 1 + ((SU025-ITEM (SU025-IDX) - 1)          08729018
087300                     / PC-ITEMS-PER-PANEL).                       08730018
087310                                                                  08731018
087320     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08732018
087330         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08733018
087340             PERFORM 6111-WRITE-LIST-QUEUE                        08734018
087350         END-IF                                                   08735018
087360                                                                  08736018
087370         MOVE PV-ITEM TO PV-SAVE-ITEM                             08737018
087380                                                                  08738018
087390         PERFORM 6112-READ-LIST-QUEUE                             08739018
087400                                                                  08740018
087410         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08741018
087420             CONTINUE                                             08742018
087430         END-IF                                                   08743018
087440     END-IF.                                                      08744018
087450                                                                  08745018
087460     COMPUTE PV-SUB = (SU025-ITEM (SU025-IDX)                     08746018
087470                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08747018
087480                                                                  08748018
087490     SET LQW-DESELECT (PV-SUB) TO TRUE                            08749018
087500     MOVE LQW-SELECTED-SW (PV-SUB)                                08750018
087510                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08751018
087520                                                                  08752018
087530     EVALUATE TRUE                                                08753018
087540         WHEN SU025-INQ (SU025-IDX)                               08754018
087550              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08755018
087560                                                                  08756018
087570         WHEN SU025-UPD (SU025-IDX)                               08757018
087580              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08758018
087590                                                                  08759018
087600         WHEN SU025-DEL (SU025-IDX)                               08760018
087610              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08761018
087620                                                                  08762018
087630         WHEN SU025-ERR (SU025-IDX)                               08763018
087640              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08764018
087650     END-EVALUATE.                                                08765018
087660                                                                  08766018
087670     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08767018
087680                                                                  08768018
087690*LMM                                                              08769018
087700 6810-PROCESS-ITEMS.                                              08770018
087710                                                                  08771018
087720     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          08772018
087730                     / PC-ITEMS-PER-PANEL).                       08773018
087740                                                                  08774018
087750     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08775018
087760         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08776018
087770             PERFORM 6111-WRITE-LIST-QUEUE                        08777018
087780         END-IF                                                   08778018
087790                                                                  08779018
087800         MOVE PV-ITEM TO PV-SAVE-ITEM                             08780018
087810                                                                  08781018
087820         PERFORM 6112-READ-LIST-QUEUE                             08782018
087830                                                                  08783018
087840         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08784018
087850             CONTINUE                                             08785018
087860         END-IF                                                   08786018
087870     END-IF.                                                      08787018
087880                                                                  08788018
087890     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     08789018
087900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08790018
087910                                                                  08791018
087920     SET LQW-DESELECT (PV-SUB) TO TRUE                            08792018
087930     MOVE LQW-SELECTED-SW (PV-SUB)                                08793018
087940                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08794018
087950                                                                  08795018
087960     EVALUATE TRUE                                                08796018
087970         WHEN RC013-INQ (RC013-IDX)                               08797018
087980              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08798018
087990                                                                  08799018
088000         WHEN RC013-UPD (RC013-IDX)                               08800018
088010              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08801018
088020                                                                  08802018
088030         WHEN RC013-DEL (RC013-IDX)                               08803018
088040              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08804018
088050                                                                  08805018
088060         WHEN RC013-ERR (RC013-IDX)                               08806018
088070              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08807018
088080     END-EVALUATE.                                                08808018
088090                                                                  08809018
088100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08810018
088110                                                                  08811018
088120 6900-UPDATE-TSQ.                                                 08812018
088130                                                                  08813018
088140     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  08814018
088150     PERFORM 6905-READ-SEL-QUEUE.                                 08815018
088160                                                                  08816018
088170     PERFORM                                                      08817018
088180       VARYING SU039-IDX FROM 1 BY 1                              08818018
088190         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     08819018
088200            OR (SU039-IDX > SU039-MAX-ITEMS))                     08820018
088210                                                                  08821018
088220         IF SU039-ACTION-SW (SU039-IDX) > SPACE                   08822018
088230             PERFORM 6910-PROCESS-ITEMS                           08823018
088240         END-IF                                                   08824018
088250                                                                  08825018
088260         ADD +1 TO PV-ITEMS-PROCESSED                             08826018
088270     END-PERFORM.                                                 08827018
088280                                                                  08828018
088290     PERFORM 6111-WRITE-LIST-QUEUE.                               08829018
088300                                                                  08830018
088310 6905-READ-SEL-QUEUE.                                             08831018
088320                                                                  08832018
088330     EXEC CICS                                                    08833018
088340          READQ TS                                                08834018
088350              QUEUE (ASC-SEL-QUEUE-NAME)                          08835018
088360              INTO  (SU039-SELECT-RECORD)                         08836018
088370              ITEM  (PV-SEL-QUEUE-ITEM)                           08837018
088380              RESP  (PV-CICS-RESP)                                08838018
088390     END-EXEC.                                                    08839018
088400                                                                  08840018
088410     IF PV-CICS-RESP = DFHRESP (NORMAL)                           08841018
088420         CONTINUE                                                 08842018
088430     ELSE                                                         08843018
088440         SET DP013-CICS-ABEND       TO  TRUE                      08844018
088450         SET DP013-NO-ROLLBACK      TO  TRUE                      08845018
088460         MOVE '6905-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           08846018
088470         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           08847018
088480                                    TO  DP013-MESSAGE-TEXT(1)     08848018
088490         MOVE DK-PO-NBR      TO PV-ERROR-PO                       08849018
088500         MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                      08850018
088510         MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID              08851018
088520         MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)            08852018
088530         PERFORM DP013-0000-PROCESS-ABEND                         08853018
088540     END-IF.                                                      08854018
088550                                                                  08855018
088560 6910-PROCESS-ITEMS.                                              08856018
088570                                                                  08857018
088580     COMPUTE PV-ITEM = 1 + ((SU039-ITEM (SU039-IDX) - 1)          08858018
088590                     / PC-ITEMS-PER-PANEL).                       08859018
088600                                                                  08860018
088610     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            08861018
088620         IF PV-SAVE-ITEM NOT EQUAL ZERO                           08862018
088630             PERFORM 6111-WRITE-LIST-QUEUE                        08863018
088640         END-IF                                                   08864018
088650                                                                  08865018
088660         MOVE PV-ITEM TO PV-SAVE-ITEM                             08866018
088670                                                                  08867018
088680         PERFORM 6112-READ-LIST-QUEUE                             08868018
088690                                                                  08869018
088700         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                08870018
088710             CONTINUE                                             08871018
088720         END-IF                                                   08872018
088730     END-IF.                                                      08873018
088740                                                                  08874018
088750     COMPUTE PV-SUB = (SU039-ITEM (SU039-IDX)                     08875018
088760                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              08876018
088770                                                                  08877018
088780     SET LQW-DESELECT (PV-SUB) TO TRUE                            08878018
088790     MOVE LQW-SELECTED-SW (PV-SUB)                                08879018
088800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  08880018
088810                                                                  08881018
088820     EVALUATE TRUE                                                08882018
088830         WHEN SU039-INQ (SU039-IDX)                               08883018
088840              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             08884018
088850                                                                  08885018
088860         WHEN SU039-UPD (SU039-IDX)                               08886018
088870              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             08887018
088880                                                                  08888018
088890         WHEN SU039-DEL (SU039-IDX)                               08889018
088900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             08890018
088910                                                                  08891018
088920         WHEN SU039-ERR (SU039-IDX)                               08892018
088930              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             08893018
088940     END-EVALUATE.                                                08894018
088950                                                                  08895018
088960     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                08896018
088970                                                                  08897018
088980*----------------------------------------------------------------*08898018
088990*    FORMAT HEADER LABEL PRIOR TO PRINT REQUEST FORM ASC.        *08899018
089000*----------------------------------------------------------------*08900018
089010 7000-SETUP-HDR-LABELS-ASC.                                       08901018
089020                                                                  08902018
089030     SET PC140-COMMON-HDR-LBL-NBR       TO TRUE.                  08903018
089040                                                                  08904018
089050     MOVE ASC-HDR-LBL-PRTID-N    TO PV-PRINTER-NO-9.              08905018
089060     MOVE PV-PRINTER-NO          TO PC140-HL-PRTR-ID.             08906018
089070     MOVE OPRSET-CNTL-DESC       TO PC140-HL-PRC-AREA-TX.         08907018
089080     MOVE ASC-TRIP-ID            TO PC140-HL-TRIP-ID.             08908018
089090     MOVE SPACES                 TO PC140-HL-PRC-AREA-CD.         08909018
089100                                                                  08910018
089110     IF PS-HDRLBL-FRMSCRN-NO                                      08911018
089120         PERFORM 2295-GET-PO-INSTRUCT                             08912018
089130         IF ASC-HDR-LBL-INSTR = SPACES                            08913018
089140             SET PC140-CRA-NOT-SPC-INSTR    TO TRUE               08914018
089150         ELSE                                                     08915018
089160             SET PC140-CRA-SPC-INSTR        TO TRUE               08916018
089170         END-IF                                                   08917018
089180     ELSE                                                         08918018
089190         SET PC140-CRA-SPC-INSTR        TO TRUE                   08919018
089200     END-IF.                                                      08920018
089210                                                                  08921018
089220     MOVE ASC-HDR-LBL-INSTR                                       08922018
089230                                 TO PC140-HL-SPECIAL-TX.          08923018
089240                                                                  08924018
089250     IF  LQW-ACTL-CART-COUNT (LQW-IDX) > ZEROES                   08925018
089260         MOVE LQW-ACTL-CART-COUNT (LQW-IDX)                       08926018
089270                                 TO PV-ACTL-CART-COUNT            08927018
089280         MOVE PV-ACTL-CART-COUNT-X                                08928018
089290                                 TO PC140-HL-CART-CT              08929018
089300     ELSE                                                         08930018
089310         MOVE LQW-EXP-CART-COUNT (LQW-IDX)                        08931018
089320                                 TO PV-EXP-CART-COUNT             08932018
089330         MOVE PV-EXP-CART-COUNT-X                                 08933018
089340                                 TO PC140-HL-CART-CT              08934018
089350     END-IF.                                                      08935018
089360*                                                                 08936018
089370     IF ASC-ARRIVAL-DTE           = '090999'                      08937018
089380       AND ASC-ARRIVAL-DTE-CC           = '99'                    08938018
089390        MOVE 'ENROUTE'   TO PC140-HL-RCVD-MM-DD-YY                08939018
089400     ELSE                                                         08940018
089410        MOVE ASC-ARRIVAL-DTE                                      08941018
089420                                    TO PV-FORMAT-DATE             08942018
089430        STRING                                                    08943018
089440            PV-MM                                                 08944018
089450            '-'                                                   08945018
089460            PV-DD                                                 08946018
089470            '-'                                                   08947018
089480            PV-YY                                                 08948018
089490                DELIMITED BY SIZE                                 08949018
089500                                  INTO PC140-HL-RCVD-MM-DD-YY     08950018
089510     END-IF.                                                      08951018
089520     MOVE LQW-PO-NBR (LQW-IDX)                                    08952018
089530                                 TO PV-PO-NBR-8-POSITIONS.        08953018
089540     MOVE PV-PO-NBR-8-POSITIONS                                   08954018
089550                                 TO PC140-HL-PO-NBR.              08955018
089560     MOVE LQW-VND-NME (LQW-IDX)                                   08956018
089570                                 TO PC140-HL-VEND-NAME.           08957018
089580     MOVE LQW-RECEIVER (LQW-IDX)                                  08958018
089590                                 TO PV-RCVR-SEQ-4-DGT.            08959018
089600     MOVE PV-RCVR-SEQ-3-X        TO PC140-HL-RCVR-SEQ-NBR-TX.     08960018
089610                                                                  08961018
089620     STRING                                                       08962018
089630         PC140-HL-PO-NBR                                          08963018
089640         PC140-HL-RCVR-SEQ-NBR-TX                                 08964018
089650                 DELIMITED BY SIZE                                08965018
089660                               INTO PC140-HL-RCVR-NBR.            08966018
089670                                                                  08967018
089680     IF  LQW-AD-DATE (LQW-IDX) > SPACES                           08968018
089690         MOVE LQW-AD-DATE (LQW-IDX)                               08969018
089700                                 TO PV-FORMAT-DATE                08970018
089710         STRING                                                   08971018
089720             PV-MM                                                08972018
089730             '-'                                                  08973018
089740             PV-DD                                                08974018
089750             '-'                                                  08975018
089760             PV-YY                                                08976018
089770                 DELIMITED BY SIZE                                08977018
089780                               INTO PC140-HL-AD-MM-DD-YY          08978018
089790     ELSE                                                         08979018
089800         MOVE '  -  -  '         TO PC140-HL-AD-MM-DD-YY          08980018
089810     END-IF.                                                      08981018
089820                                                                  08982018
089830     EVALUATE LQW-AD-INFO (LQW-IDX)                               08983018
089840         WHEN '1'                                                 08984018
089850             MOVE 'HOT '         TO PC140-HL-PIC-TX               08985018
089860         WHEN '2'                                                 08986018
089870             MOVE 'PICT'         TO PC140-HL-PIC-TX               08987018
089880         WHEN '3'                                                 08988018
089890             MOVE 'PREP'         TO PC140-HL-PIC-TX               08989018
089900         WHEN '4'                                                 08990018
089910             MOVE 'RAIN'         TO PC140-HL-PIC-TX               08991018
089920         WHEN '5'                                                 08992018
089930             MOVE 'CUST'         TO PC140-HL-PIC-TX               08993018
089940         WHEN OTHER                                               08994018
089950             MOVE SPACES         TO PC140-HL-PIC-TX               08995018
089960     END-EVALUATE.                                                08996018
089970                                                                  08997018
089980     IF  LQW-MULT-IND (LQW-IDX) = 'M'                             08998018
089990         MOVE PC-MULTIPLE-SHIPMENTS                               08999018
090000                                 TO PC140-HL-MULT-SHIPMENTS-TX    09000018
090010     ELSE                                                         09001018
090020         MOVE SPACES             TO PC140-HL-MULT-SHIPMENTS-TX    09002018
090030     END-IF.                                                      09003018
090040                                                                  09004018
090050                                                                  09005018
090060     IF  LQW-PRE-TKT-IND (LQW-IDX) = 'N' OR ' '                   09006018
090070         MOVE SPACES             TO PC140-HL-PRE-TKT-TX           09007018
090080     ELSE                                                         09008018
090090         MOVE PC-PRE-TICKETED    TO PC140-HL-PRE-TKT-TX           09009018
090100     END-IF.                                                      09010018
090110                                                                  09011018
090120     IF LQW-PACK-BY-ST-IND (LQW-IDX) = 'N' OR ' '                 09012018
090130         MOVE SPACES             TO PC140-HL-PACKED-BY-TX         09013018
090140     ELSE                                                         09014018
090150         MOVE PC-PACKED-BY-STORE TO PC140-HL-PACKED-BY-TX         09015018
090160     END-IF.                                                      09016018
090170                                                                  09017018
090180     IF  LQW-GOH-IND (LQW-IDX) = 'N' OR ' '                       09018018
090190         MOVE SPACES             TO PC140-HL-ON-HANGER-TX         09019018
090200     ELSE                                                         09020018
090210         MOVE PC-ON-HANGER       TO PC140-HL-ON-HANGER-TX         09021018
090220     END-IF.                                                      09022018
090230                                                                  09023018
090240     MOVE LQW-DEPT (LQW-IDX)                                      09024018
090250                                 TO PC140-HL-DEPT.                09025018
090260     MOVE LQW-CLASS (LQW-IDX)                                     09026018
090270                                 TO PC140-HL-CLASS.               09027018
090280                                                                  09028018
090290     IF LQW-DETAIL-CHECK (LQW-IDX) = 'Y'                          09029018
090300         MOVE PC-DETAIL-CHECK    TO PC140-HL-DETAIL-CHECK         09030018
090310     ELSE                                                         09031018
090320         MOVE SPACES             TO PC140-HL-DETAIL-CHECK         09032018
090330     END-IF.                                                      09033018
090340                                                                  09034018
090350     MOVE DP072-PRTR-IP-ADDRESS  TO PC140-HL-IP-ADDRESS.          09035018
090360     MOVE DP072-PRTR-CLUSTER-OS-RLSE-CDE                          09036018
090370                                 TO PC140-HL-OS-RLSE-CDE.         09037018
090380     MOVE DP072-PRTR-DATA-XFER-MODE-ID                            09038018
090390                                 TO PC140-HL-XFER-MODE-ID.        09039018
090400     MOVE DP072-XMIT-INTFC-CDE                                    09040018
090410                                 TO PC140-XMIT-INTFC-CDE.         09041018
090420     MOVE DP072-PRTR-OPER-UNT-ID TO PC-OPER-UNT-ID.               09042018
090430                                                                  09043018
090440     PERFORM 7150-LINK-SOCKET-PRINT-ROUTINE.                      09044018
090450                                                                  09045018
090460****************************************************************  09046018
090470 7150-LINK-SOCKET-PRINT-ROUTINE.                                  09047018
090480                                                                  09048018
090490     MOVE DP020-USERID           TO PC140-CRA-USERID.             09049018
090500     MOVE 400                    TO PV-COMMAREA-LENGTH.           09050018
090510                                                                  09051018
090520     EXEC CICS                                                    09052018
090530          LINK PROGRAM  ('PCKCS707')                              09053018
090540               COMMAREA (PC140-LABELMST)                          09054018
090550               LENGTH   (PV-COMMAREA-LENGTH)                      09055018
090560               RESP     (PV-CICS-RESP)                            09056018
090570     END-EXEC.                                                    09057018
090580                                                                  09058018
090590     EVALUATE TRUE                                                09059018
090600         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     09060018
090610              CONTINUE                                            09061018
090620         WHEN OTHER                                               09062018
090630              PERFORM DP013-0000-PROCESS-ABEND                    09063018
090640     END-EVALUATE.                                                09064018
090650     IF PC140-CRA-SOCKET-COMM-ERROR                               09065018
090660         SET PS-ERROR            TO TRUE                          09066018
090670         SET DP020-MSG-FATAL     TO TRUE                          09067018
090680         MOVE PC-TSYMSG-02122    TO DP020-MSG-NUMBER              09068018
090690         MOVE DP015-UNP-NUM-BRT-OFF                               09069018
090700                                 TO APRTIDA                       09070018
090710         MOVE DP015-RED          TO APRTIDC                       09071018
090720         MOVE DP015-REVERSE      TO APRTIDH                       09072018
090730         MOVE -1                 TO APRTIDL                       09073018
090740         SET DP030-SET-CURSOR-APPL-1                              09074018
090750                                 TO TRUE                          09075018
090760     ELSE                                                         09076018
090770     IF PC140-CRA-INVALID-PRT-FMT                                 09077018
090780         SET PS-ERROR            TO TRUE                          09078018
090790         SET DP020-MSG-FATAL     TO TRUE                          09079018
090800         MOVE DP015-UNP-NUM-BRT-OFF                               09080018
090810                                 TO APRTIDA                       09081018
090820         MOVE DP015-RED          TO APRTIDC                       09082018
090830         MOVE DP015-REVERSE      TO APRTIDH                       09083018
090840         MOVE -1                 TO APRTIDL                       09084018
090850         SET DP030-SET-CURSOR-APPL-1                              09085018
090860                                 TO TRUE                          09086018
090870         MOVE PC140-CRA-RET-CDE      TO PM-RET-CDE                09087018
090880         MOVE PC140-CRA-RET-MSG      TO PM-RET-MSG                09088018
090890         MOVE PM-PROGRAM-MESSAGE-1   TO DP020-MSG-TEXT            09089018
090900     ELSE                                                         09090018
090910         SET DP020-MSG-INFORMATIONAL TO TRUE                      09091018
090920         MOVE PC-TSYMSG-00098    TO DP020-MSG-NUMBER              09092018
090930         MOVE -1                 TO APRTIDL                       09093018
090940         SET DP030-SET-CURSOR-APPL-1                              09094018
090950                                 TO TRUE                          09095018
090960     END-IF.                                                      09096018
090970/                                                                 09097018
090980 7200-GET-TRIP-ID.                                                09098018
090990                                                                  09099018
091000     EXEC SQL                                                     09100018
091010          SELECT A.TRIP_ID                                        09101018
091020                ,A.OWNER_SCAC_ID                                  09102018
091030                ,A.VEH_NBR                                        09103018
091040                ,B.TRIP_STATUS_CDE                                09104018
091050          INTO  :DK-TRIP-ID                                       09105018
091060               ,:DK-SCAC-ID                                       09106018
091070               ,:DK-VEH-NBR :DN-VEH-NBR                           09107018
091080               ,:DK-STATUS-CDE                                    09108018
091090           FROM TVHTRIP A                                         09109018
091100               ,TTRIPST B                                         09110018
091110               ,TTRSTYP C                                         09111018
091120               ,TSHIPMT E                                         09112018
091130               ,TSHPTPO F                                         09113018
091140          WHERE F.PO_NBR           = :DK-PO-NBR                   09114018
091150            AND F.REC_SEQ_NBR      = :DK-REC-SEQ-NBR              09115018
091160            AND A.TRIP_ID          = B.TRIP_ID                    09116018
091170            AND B.TRIP_STATUS_CDE  = C.TRIP_STATUS_CDE            09117018
091180            AND A.TRIP_ID          = E.TRIP_ID                    09118018
091190            AND E.SHIPT_ID         = F.SHIPT_ID                   09119018
091200            AND F.PRIM_SHIPT_IND   = 'Y'                          09120018
091210            AND C.PRTY_CDE         =                              09121018
091220              (SELECT MAX(E.PRTY_CDE)                             09122018
091230                FROM TTRIPST D                                    09123018
091240                    ,TTRSTYP E                                    09124018
091250               WHERE D.TRIP_ID         = A.TRIP_ID                09125018
091260                 AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)       09126018
091270     END-EXEC                                                     09127018
091280                                                                  09128018
091290                                                                  09129018
091300     EVALUATE TRUE                                                09130018
091310         WHEN SQLCODE = ZERO                                      09131018
091320              MOVE DK-TRIP-ID      TO   ASC-TRIP-ID               09132018
091330              MOVE DK-SCAC-ID      TO   ASC-SCAC-ID               09133018
091340              MOVE DK-STATUS-CDE   TO   ASC-STATUS                09134018
091350              IF DN-VEH-NBR = -1                                  09135018
091360                 MOVE SPACES       TO   ASC-VEH-NBR               09136018
091370                                        DK-VEH-NBR                09137018
091380              ELSE                                                09138018
091390                 MOVE DK-VEH-NBR  TO   ASC-VEH-NBR                09139018
091400              END-IF                                              09140018
091410         WHEN SQLCODE = +100                                      09141018
091420              MOVE PC-TSYMSG-00954       TO DP020-MSG-NUMBER      09142018
091430              SET  PS-COMMAREA-NOT-VALID TO TRUE                  09143018
091440         WHEN SQLCODE = -811                                      09144018
091450         WHEN SQLWARN0 NOT = SPACE                                09145018
091460         WHEN SQLCODE NOT = ZERO                                  09146018
091470              MOVE '7200-GET-TRIP-ID'                             09147018
091480                               TO DP013-PARAGRAPH                 09148018
091490              MOVE 'FETCH MESSAGE CURSOR'                         09149018
091500                               TO DP013-MESSAGE-TEXT (1)          09150018
091510              MOVE DK-PO-NBR  TO PV-ERROR-PO                      09151018
091520              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 09152018
091530              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         09153018
091540              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       09154018
091550              MOVE SQLCA       TO DP013-SQLCA                     09155018
091560              SET DP013-DB2-ABEND                                 09156018
091570                               TO TRUE                            09157018
091580              PERFORM DP013-0000-PROCESS-ABEND                    09158018
091590     END-EVALUATE.                                                09159018
091600                                                                  09160018
091610 7210-SELECT-MAX-STATUS.                                          09161018
091620                                                                  09162018
091630     EXEC SQL                                                     09163018
091640          SELECT MAX(STATUS_DTE),MAX(STATUS_TME)                  09164018
091650          INTO  :DK-STATUS-DTE                                    09165018
091660               ,:DK-STATUS-TME                                    09166018
091670          FROM   TVHTRIP A                                        09167018
091680                ,TTRIPST B                                        09168018
091690          WHERE A.TRIP_ID = :DK-TRIP-ID                           09169018
091700          AND   A.TRIP_ID =  B.TRIP_ID                            09170018
091710            AND B.STATUS_DTE =                                    09171018
091720                 (SELECT MAX(D.STATUS_DTE)                        09172018
091730                    FROM TTRIPST D                                09173018
091740                  WHERE D.TRIP_ID = A.TRIP_ID)                    09174018
091750     END-EXEC                                                     09175018
091760                                                                  09176018
091770                                                                  09177018
091780     EXEC SQL                                                     09178018
091790          SELECT B.TRIP_STATUS_CDE                                09179018
091800          INTO  :DK-STATUS-CDE                                    09180018
091810          FROM   TVHTRIP A                                        09181018
091820                ,TTRIPST B                                        09182018
091830          WHERE A.TRIP_ID = :DK-TRIP-ID                           09183018
091840              AND A.TRIP_ID =  B.TRIP_ID                          09184018
091850              AND B.STATUS_DTE = :DK-STATUS-DTE                   09185018
091860              AND B.STATUS_TME = :DK-STATUS-TME                   09186018
091870     END-EXEC                                                     09187018
091880                                                                  09188018
091890                                                                  09189018
091900     EVALUATE TRUE                                                09190018
091910         WHEN SQLCODE = ZERO                                      09191018
091920              MOVE DK-STATUS-CDE TO   ASC-STATUS                  09192018
091930              MOVE DK-STATUS-DTE TO   ASC-STATUS-DTE              09193018
091940              PERFORM 7210A-TRLR-STATUS-DESC                      09194018
091950         WHEN SQLCODE = +100                                      09195018
091960         WHEN SQLWARN0 NOT = SPACE                                09196018
091970         WHEN SQLCODE NOT = ZERO                                  09197018
091980              MOVE '7210-SELECT-MAX-STATUS'                       09198018
091990                               TO DP013-PARAGRAPH                 09199018
092000              MOVE 'FETCH MESSAGE CURSOR'                         09200018
092010                               TO DP013-MESSAGE-TEXT (1)          09201018
092020              MOVE DK-PO-NBR  TO PV-ERROR-PO                      09202018
092030              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 09203018
092040              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         09204018
092050              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       09205018
092060              MOVE SQLCA       TO DP013-SQLCA                     09206018
092070              SET DP013-DB2-ABEND                                 09207018
092080                               TO TRUE                            09208018
092090              PERFORM DP013-0000-PROCESS-ABEND                    09209018
092100     END-EVALUATE.                                                09210018
092110                                                                  09211018
092120 7210A-TRLR-STATUS-DESC.                                          09212018
092130                                                                  09213018
092140     EVALUATE TRUE                                                09214018
092150         WHEN ASC-STATUS = 'AR'                                   09215018
092160              MOVE 'ARRIVED'       TO ASC-TRLR-STATUS             09216018
092170         WHEN ASC-STATUS = 'UN'                                   09217018
092180              MOVE 'UNLOADED'      TO ASC-TRLR-STATUS             09218018
092190         WHEN ASC-STATUS = 'UG'                                   09219018
092200              MOVE 'UNLOADING'     TO ASC-TRLR-STATUS             09220018
092210         WHEN ASC-STATUS = 'EN'                                   09221018
092220              MOVE 'ENROUTE'       TO ASC-TRLR-STATUS             09222018
092230         WHEN ASC-STATUS = 'DP'                                   09223018
092240              MOVE 'DEPARTED'      TO ASC-TRLR-STATUS             09224018
092250         WHEN ASC-STATUS = 'ET'                                   09225018
092260              MOVE 'END TRIP'      TO ASC-TRLR-STATUS             09226018
092270     END-EVALUATE.                                                09227018
092280/                                                                 09228018
092290* JAK 04/2007 - START                                             09229018
092300 7300-CHECK-WMOS.                                                 09230018
092310                                                                  09231018
092320* CHECK TO SEE IF THE DC IS DOWNLOADING TO WMOS.                  09232018
092330* IF IT IS, THEN THE FUNCTION IS NOT ALLOWED.                     09233018
092340                                                                  09234018
092350     PERFORM 7310-GET-CURR-TMST                                   09235018
092360     MOVE DP020-LOCATION-NBR         TO DK-OPER-UNT-ID            09236018
092370     PERFORM 7320-CHECK-DC-WMOS                                   09237018
092380     IF PS-DC-ON-WMOS-YES                                         09238018
092390*        MOVE PC-TSYMSG-03554      TO DP020-MSG-NUMBER            09239018
092400*        SET DP020-MSG-FATAL       TO TRUE                        09240018
092410*        MOVE -1                   TO MR-SELECTL (1)              09241018
092420*        SET DP030-SET-CURSOR-APPL-1                              09242018
092430*                                      TO TRUE                    09243018
092440         SET PS-ERROR              TO TRUE                        09244018
092450*        SET ASC-NO-TSQ-UPDATE TO TRUE                            09245018
092460     END-IF.                                                      09246018
092470                                                                  09247018
092480                                                                  09248018
092490 7310-GET-CURR-TMST.                                              09249018
092500                                                                  09250018
092510         EXEC SQL                                                 09251018
092520             SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP        09252018
092530         END-EXEC.                                                09253018
092540                                                                  09254018
092550                                                                  09255018
092560 7320-CHECK-DC-WMOS.                                              09256018
092570                                                                  09257018
092580     EXEC SQL                                                     09258018
092590          SELECT   A.INTGRTN_TYP_DESC                             09259018
092600            INTO  :WST00008-INTGRTN-TYP-DESC                      09260018
092610            FROM                                                  09261018
092620                  WST_INTGRTN_TYP  A                              09262018
092630               ,  WST_ATTR_DEFN    B                              09263018
092640               ,  WST_ATTR_ELEM    C                              09264018
092650               ,  WST_ATTR_ELEM    D                              09265018
092660               ,  WST_ATTR_ELEM    E                              09266018
092670            WHERE                                                 09267018
092680                  A.INTGRTN_TYP_CDE   = 'WMOSON'                  09268018
092690              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         09269018
092700              AND B.ATTR_DEFN_SEQ_NBR = 1                         09270018
092710              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         09271018
092720              AND C.ATTR_DEFN_SEQ_NBR = 1                         09272018
092730              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         09273018
092740              AND D.ATTR_DEFN_SEQ_NBR = 2                         09274018
092750              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         09275018
092760              AND E.ATTR_DEFN_SEQ_NBR = 3                         09276018
092770              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       09277018
092780              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       09278018
092790              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           09279018
092800              AND E.ATTR_ELEM_TMST   <= :DK-CURRENT-TIMESTAMP     09280018
092810     END-EXEC.                                                    09281018
092820                                                                  09282018
092830     EVALUATE TRUE                                                09283018
092840         WHEN SQLCODE = ZERO                                      09284018
092850             SET PS-DC-ON-WMOS-YES      TO TRUE                   09285018
092860         WHEN OTHER                                               09286018
092870             SET PS-DC-ON-WMOS-NO       TO TRUE                   09287018
092880     END-EVALUATE.                                                09288018
092890                                                                  09289018
092900* JAK 04/2007 - END                                               09290018
092910                                                                  09291018
092920                                                                  09292018
092930 7500-OPEN-TYPE-A-CSR.                                            09293018
092940     EXEC SQL                                                     09294018
092950         OPEN TYPE-A-CSR                                          09295018
092960     END-EXEC.                                                    09296018
092970                                                                  09297018
092980     EVALUATE TRUE                                                09298018
092990         WHEN SQLCODE = ZERO                                      09299018
093000             CONTINUE                                             09300018
093010         WHEN SQLCODE = -904                                      09301018
093020         WHEN SQLCODE = -913                                      09302018
093030         WHEN SQLCODE = -911                                      09303018
093040             MOVE '7500-OPEN-TYPE-A-CSR'                          09304018
093050                                      TO DP013-PARAGRAPH          09305018
093060            MOVE 'TIMEMOUT TO OPEN CSR'                           09306018
093070                                      TO DP013-MESSAGE-TEXT (1)   09307018
093080             MOVE SQLCA               TO DP013-SQLCA              09308018
093090             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09309018
093100             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09310018
093110             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09311018
093120             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09312018
093130             SET DP013-DB2-ABEND                                  09313018
093140                 DP013-XCTL-DISPLAY-RESTART                       09314018
093150                                      TO TRUE                     09315018
093160             PERFORM DP013-0000-PROCESS-ABEND                     09316018
093170         WHEN SQLWARN0 NOT = SPACES                               09317018
093180         WHEN SQLCODE < ZERO                                      09318018
093190         WHEN SQLCODE > ZERO                                      09319018
093200             MOVE '7500-OPEN-TYPE-A-CSR'                          09320018
093210                                   TO DP013-PARAGRAPH             09321018
093220             MOVE 'OPEN TYPE-A - ' TO DP013-MESSAGE-TEXT (1)      09322018
093230             MOVE SQLCA        TO DP013-SQLCA                     09323018
093240             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09324018
093250             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09325018
093260             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09326018
093270             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09327018
093280             SET DP013-DB2-ABEND                                  09328018
093290                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09329018
093300             PERFORM DP013-0000-PROCESS-ABEND                     09330018
093310     END-EVALUATE.                                                09331018
093320                                                                  09332018
093330 7505-FETCH-TYPE-A-CSR.                                           09333018
093340                                                                  09334018
093350     EXEC SQL                                                     09335018
093360         FETCH TYPE-A-CSR                                         09336018
093370     INTO                                                         09337018
093380         :PV-TEMP-UNION-TYPE                                      09338018
093390       , :PV-TEMP-PO-NBR                                          09339018
093400       , :PV-TEMP-REC-SEQ-NBR                                     09340018
093410       , :PV-TEMP-STATUS-CDE                                      09341018
093420*      , :PV-TEMP-SCREEN-SEQUENCE                                 09342018
093430                                                                  09343018
093440     END-EXEC                                                     09344018
093450                                                                  09345018
093460     EVALUATE TRUE                                                09346018
093470         WHEN SQLCODE = ZERO                                      09347018
093480             CONTINUE                                             09348018
093490         WHEN SQLCODE = +100                                      09349018
093500             SET PS-EOF-TYPE-A-YES    TO TRUE                     09350018
093510         WHEN SQLCODE = -904                                      09351018
093520         WHEN SQLCODE = -913                                      09352018
093530         WHEN SQLCODE = -911                                      09353018
093540             MOVE '7505-FETCH-TYPE-A-CSR'                         09354018
093550                                      TO DP013-PARAGRAPH          09355018
093560            MOVE 'TIMEOUT TO FETCH TYPE-A CSR'                    09356018
093570                                      TO DP013-MESSAGE-TEXT (1)   09357018
093580             MOVE SQLCA               TO DP013-SQLCA              09358018
093590             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09359018
093600             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09360018
093610             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09361018
093620             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09362018
093630             SET DP013-DB2-ABEND                                  09363018
093640                 DP013-XCTL-DISPLAY-RESTART                       09364018
093650                                      TO TRUE                     09365018
093660             PERFORM DP013-0000-PROCESS-ABEND                     09366018
093670         WHEN SQLWARN0 NOT = SPACES                               09367018
093680         WHEN SQLCODE < ZERO                                      09368018
093690         WHEN SQLCODE > ZERO                                      09369018
093700             MOVE '7505-FETCH-TYPE-A-CSR'                         09370018
093710                                      TO DP013-PARAGRAPH          09371018
093720             MOVE 'ABEND FETCHING TYPE-A CSR'                     09372018
093730                                      TO DP013-MESSAGE-TEXT (1)   09373018
093740             MOVE SQLCA               TO DP013-SQLCA              09374018
093750             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09375018
093760             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09376018
093770             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09377018
093780             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09378018
093790             SET DP013-DB2-ABEND                                  09379018
093800                 DP013-XCTL-DISPLAY-RESTART                       09380018
093810                                      TO TRUE                     09381018
093820             PERFORM DP013-0000-PROCESS-ABEND                     09382018
093830     END-EVALUATE.                                                09383018
093840                                                                  09384018
093850 7510-CLOSE-TYPE-A-CSR.                                           09385018
093860     EXEC SQL                                                     09386018
093870         CLOSE TYPE-A-CSR                                         09387018
093880     END-EXEC.                                                    09388018
093890                                                                  09389018
093900     EVALUATE TRUE                                                09390018
093910         WHEN SQLCODE = ZERO                                      09391018
093920             CONTINUE                                             09392018
093930         WHEN SQLWARN0 NOT = SPACES                               09393018
093940         WHEN SQLCODE < ZERO                                      09394018
093950         WHEN SQLCODE > ZERO                                      09395018
093960             MOVE '7510-CLOSE-TYPE-A-CSR'                         09396018
093970                                   TO DP013-PARAGRAPH             09397018
093980             MOVE 'CLOSE TYPE-A - ' TO DP013-MESSAGE-TEXT (1)     09398018
093990             MOVE SQLCA        TO DP013-SQLCA                     09399018
094000             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09400018
094010             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09401018
094020             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09402018
094030             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09403018
094040             SET DP013-DB2-ABEND                                  09404018
094050                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09405018
094060             PERFORM DP013-0000-PROCESS-ABEND                     09406018
094070     END-EVALUATE.                                                09407018
094080                                                                  09408018
094090 7520-OPEN-CHECKIN-CSR.                                           09409018
094100     EXEC SQL                                                     09410018
094110         OPEN CHECKIN-CSR                                         09411018
094120     END-EXEC.                                                    09412018
094130                                                                  09413018
094140     EVALUATE TRUE                                                09414018
094150         WHEN SQLCODE = ZERO                                      09415018
094160             CONTINUE                                             09416018
094170         WHEN SQLCODE = -904                                      09417018
094180         WHEN SQLCODE = -913                                      09418018
094190         WHEN SQLCODE = -911                                      09419018
094200             MOVE '7520-OPEN-CHECKIN-CSR'                         09420018
094210                                      TO DP013-PARAGRAPH          09421018
094220            MOVE 'TIMEMOUT TO OPEN CSR'                           09422018
094230                                      TO DP013-MESSAGE-TEXT (1)   09423018
094240             MOVE SQLCA               TO DP013-SQLCA              09424018
094250             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1) 09425018
094260             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (2) 09426018
094270             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (3) 09427018
094280             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (4) 09428018
094290             SET DP013-DB2-ABEND                                  09429018
094300                 DP013-XCTL-DISPLAY-RESTART                       09430018
094310                                      TO TRUE                     09431018
094320             PERFORM DP013-0000-PROCESS-ABEND                     09432018
094330         WHEN SQLWARN0 NOT = SPACES                               09433018
094340         WHEN SQLCODE < ZERO                                      09434018
094350         WHEN SQLCODE > ZERO                                      09435018
094360             MOVE '7520-OPEN-CHECKIN-CSR'                         09436018
094370                                   TO DP013-PARAGRAPH             09437018
094380             MOVE 'OPEN CHECKIN  ' TO DP013-MESSAGE-TEXT (1)      09438018
094390             MOVE SQLCA        TO DP013-SQLCA                     09439018
094400             MOVE 'TSHUNLO '          TO DP013-DB2-TABLE-NAME (1) 09440018
094410             MOVE 'TINPKSU '          TO DP013-DB2-TABLE-NAME (2) 09441018
094420             SET DP013-DB2-ABEND                                  09442018
094430                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09443018
094440             PERFORM DP013-0000-PROCESS-ABEND                     09444018
094450     END-EVALUATE.                                                09445018
094460                                                                  09446018
094470 7525-FETCH-CHECKIN-CSR.                                          09447018
094480                                                                  09448018
094490     EXEC SQL                                                     09449018
094500         FETCH CHECKIN-CSR                                        09450018
094510         INTO                                                     09451018
094520            :PV-TEMP-SHIPT-UNT-ID                                 09452018
094530         ,  :PV-TEMP-PO-NBR :PV-TEMP-PO-NULL                      09453018
094540         ,  :PV-TEMP-SEQ-NBR :PV-TEMP-SEQ-NULL                    09454018
094550*        ,  :PV-TEMP-STATUS-CDE                                   09455018
094560*        ,  :PV-TEMP-SCREEN-SEQUENCE                              09456018
094570                                                                  09457018
094580     END-EXEC                                                     09458018
094590                                                                  09459018
094600     EVALUATE TRUE                                                09460018
094610         WHEN SQLCODE = ZERO                                      09461018
094620             IF PV-TEMP-PO-NULL = -1 OR PV-TEMP-SEQ-NULL = -1     09462018
094630                 CONTINUE                                         09463018
094640             ELSE                                                 09464018
094650                 MOVE PV-TEMP-PO-NBR  TO PV-CURR-TEMP-PO          09465018
094660                 MOVE PV-TEMP-SEQ-NBR TO PV-CURR-TEMP-SEQ         09466018
094670             END-IF                                               09467018
094680         WHEN SQLCODE = +100                                      09468018
094690             SET PS-EOF-CHECKIN-YES   TO TRUE                     09469018
094700         WHEN SQLCODE = -904                                      09470018
094710         WHEN SQLCODE = -913                                      09471018
094720         WHEN SQLCODE = -911                                      09472018
094730             MOVE '7525-FETCH-CHECKIN-CSR'                        09473018
094740                                      TO DP013-PARAGRAPH          09474018
094750            MOVE 'TIMEOUT TO FETCH TYPE-A CSR'                    09475018
094760                                      TO DP013-MESSAGE-TEXT (1)   09476018
094770             MOVE SQLCA               TO DP013-SQLCA              09477018
094780             MOVE 'TINPKSU '          TO DP013-DB2-TABLE-NAME (1) 09478018
094790             MOVE 'TSHUNLO '          TO DP013-DB2-TABLE-NAME (2) 09479018
094800             SET DP013-DB2-ABEND                                  09480018
094810                 DP013-XCTL-DISPLAY-RESTART                       09481018
094820                                      TO TRUE                     09482018
094830             PERFORM DP013-0000-PROCESS-ABEND                     09483018
094840         WHEN SQLWARN0 NOT = SPACES                               09484018
094850         WHEN SQLCODE < ZERO                                      09485018
094860         WHEN SQLCODE > ZERO                                      09486018
094870             MOVE '7525-FETCH-CHECKIN-CSR'                        09487018
094880                                      TO DP013-PARAGRAPH          09488018
094890             MOVE 'ABEND FETCHING TYPE-A CSR'                     09489018
094900                                      TO DP013-MESSAGE-TEXT (1)   09490018
094910             MOVE SQLCA               TO DP013-SQLCA              09491018
094920             MOVE 'TINPKSU '          TO DP013-DB2-TABLE-NAME (1) 09492018
094930             MOVE 'TSHUNLO '          TO DP013-DB2-TABLE-NAME (2) 09493018
094940             SET DP013-DB2-ABEND                                  09494018
094950                 DP013-XCTL-DISPLAY-RESTART                       09495018
094960                                      TO TRUE                     09496018
094970             PERFORM DP013-0000-PROCESS-ABEND                     09497018
094980     END-EVALUATE.                                                09498018
094990                                                                  09499018
095000 7530-CLOSE-CHECKIN-CSR.                                          09500018
095010     EXEC SQL                                                     09501018
095020         CLOSE CHECKIN-CSR                                        09502018
095030     END-EXEC.                                                    09503018
095040                                                                  09504018
095050     EVALUATE TRUE                                                09505018
095060         WHEN SQLCODE = ZERO                                      09506018
095070             CONTINUE                                             09507018
095080         WHEN SQLWARN0 NOT = SPACES                               09508018
095090         WHEN SQLCODE < ZERO                                      09509018
095100         WHEN SQLCODE > ZERO                                      09510018
095110             MOVE '7530-CLOSE-CHECKIN-CSR'                        09511018
095120                                   TO DP013-PARAGRAPH             09512018
095130             MOVE 'CLOSE CHECKIN CSR ' TO DP013-MESSAGE-TEXT (1)  09513018
095140             MOVE SQLCA        TO DP013-SQLCA                     09514018
095150             MOVE 'TINPKSU '          TO DP013-DB2-TABLE-NAME (1) 09515018
095160             MOVE 'TSHUNLO '          TO DP013-DB2-TABLE-NAME (2) 09516018
095170             SET DP013-DB2-ABEND                                  09517018
095180                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09518018
095190             PERFORM DP013-0000-PROCESS-ABEND                     09519018
095200     END-EVALUATE.                                                09520018
095210                                                                  09521018
095220 7540-SELECT-TSHUUPC.                                             09522018
095230                                                                  09523018
095240     EXEC SQL                                                     09524018
095250         SELECT                                                   09525018
095260             TRN_NBR                                              09526018
095270         INTO                                                     09527018
095280             :PV-TEMP-PO-NBR                                      09528018
095290         FROM                                                     09529018
095300             TSHUUPC                                              09530018
095310         WHERE                                                    09531018
095320             SHIPT_UNT_ID = :PV-TEMP-SHIPT-UNT-ID                 09532018
095330         FETCH FIRST 1 ROWS ONLY                                  09533018
095340     END-EXEC.                                                    09534018
095350                                                                  09535018
095360     EVALUATE TRUE                                                09536018
095370         WHEN SQLCODE = ZERO                                      09537018
095380         WHEN SQLCODE = -811                                      09538018
095390             CONTINUE                                             09539018
095400         WHEN SQLCODE = -904                                      09540018
095410         WHEN SQLCODE = -913                                      09541018
095420         WHEN SQLCODE = -911                                      09542018
095430             MOVE '7540-SELECT-TSHUUPC'                           09543018
095440                                      TO DP013-PARAGRAPH          09544018
095450            MOVE 'TIMEOUT SELECTING TRN-NBR'                      09545018
095460                                      TO DP013-MESSAGE-TEXT (1)   09546018
095470             MOVE SQLCA               TO DP013-SQLCA              09547018
095480             MOVE 'TSHUUPC '          TO DP013-DB2-TABLE-NAME (1) 09548018
095490             SET DP013-DB2-ABEND                                  09549018
095500                 DP013-XCTL-DISPLAY-RESTART                       09550018
095510                                      TO TRUE                     09551018
095520             PERFORM DP013-0000-PROCESS-ABEND                     09552018
095530         WHEN SQLWARN0 NOT = SPACES                               09553018
095540         WHEN SQLCODE < ZERO                                      09554018
095550         WHEN SQLCODE > ZERO                                      09555018
095560             MOVE '7540-SELECT-TSHUUPC'                           09556018
095570                                   TO DP013-PARAGRAPH             09557018
095580             MOVE 'SELECT TRN-NBR    ' TO DP013-MESSAGE-TEXT (1)  09558018
095590             MOVE SQLCA        TO DP013-SQLCA                     09559018
095600             MOVE 'TSHUUPC '          TO DP013-DB2-TABLE-NAME (1) 09560018
095610             SET DP013-DB2-ABEND                                  09561018
095620                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09562018
095630             PERFORM DP013-0000-PROCESS-ABEND                     09563018
095640     END-EVALUATE.                                                09564018
095650                                                                  09565018
095660 7545-SELECT-TPKSLIP.                                             09566018
095670                                                                  09567018
095680     EXEC SQL                                                     09568018
095690         SELECT                                                   09569018
095700             REC_SEQ_NBR                                          09570018
095710         INTO                                                     09571018
095720             :PV-TEMP-REC-SEQ-NBR                                 09572018
095730         FROM                                                     09573018
095740             TPKSLIP                                              09574018
095750         WHERE                                                    09575018
095760             PO_NBR       = :PV-TEMP-PO-NBR                       09576018
095770         AND SEQ_NBR      = :PV-TEMP-SEQ-NBR                      09577018
095780         AND VER_STAT_CDE = 'A'                                   09578018
095790         FETCH FIRST 1 ROWS ONLY                                  09579018
095800     END-EXEC.                                                    09580018
095810                                                                  09581018
095820     EVALUATE TRUE                                                09582018
095830         WHEN SQLCODE = ZERO                                      09583018
095840         WHEN SQLCODE = +100                                      09584018
095850         WHEN SQLCODE = -811                                      09585018
095860             CONTINUE                                             09586018
095870         WHEN SQLCODE = -904                                      09587018
095880         WHEN SQLCODE = -913                                      09588018
095890         WHEN SQLCODE = -911                                      09589018
095900             MOVE '7545-SELECT-TPKSLIP'                           09590018
095910                                      TO DP013-PARAGRAPH          09591018
095920            MOVE 'TIMEOUT SELECTING REC-SEQ-NBR'                  09592018
095930                                      TO DP013-MESSAGE-TEXT (1)   09593018
095940             MOVE SQLCA               TO DP013-SQLCA              09594018
095950             MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1) 09595018
095960             SET DP013-DB2-ABEND                                  09596018
095970                 DP013-XCTL-DISPLAY-RESTART                       09597018
095980                                      TO TRUE                     09598018
095990             PERFORM DP013-0000-PROCESS-ABEND                     09599018
096000         WHEN SQLWARN0 NOT = SPACES                               09600018
096010         WHEN SQLCODE < ZERO                                      09601018
096020         WHEN SQLCODE > ZERO                                      09602018
096030             MOVE '7545-SELECT-TPKSLIP'                           09603018
096040                                   TO DP013-PARAGRAPH             09604018
096050             MOVE 'SELECT REC-SEQ-NBR' TO DP013-MESSAGE-TEXT (1)  09605018
096060             MOVE SQLCA        TO DP013-SQLCA                     09606018
096070             MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1) 09607018
096080             SET DP013-DB2-ABEND                                  09608018
096090                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09609018
096100             PERFORM DP013-0000-PROCESS-ABEND                     09610018
096110     END-EVALUATE.                                                09611018
096120                                                                  09612018
096130 7546-SELECT-RECEIVER-STATUS.                                     09613018
096140                                                                  09614018
096150         EXEC SQL                                                 09615018
096160              SELECT   STATUS_CDE                                 09616018
096170                INTO  :PV-TEMP-STATUS-CDE                         09617018
096180                FROM TRECEIV                                      09618018
096190               WHERE ORD_NBR       =  :PV-TEMP-PO-NBR             09619018
096200                 AND REC_SEQ_NBR   =  :PV-TEMP-REC-SEQ-NBR        09620018
096210         END-EXEC.                                                09621018
096220                                                                  09622018
096230     EVALUATE TRUE                                                09623018
096240         WHEN SQLCODE = ZERO                                      09624018
096250         WHEN SQLCODE = +100                                      09625018
096260         WHEN SQLCODE = -811                                      09626018
096270             CONTINUE                                             09627018
096280         WHEN SQLCODE = -904                                      09628018
096290         WHEN SQLCODE = -913                                      09629018
096300         WHEN SQLCODE = -911                                      09630018
096310             MOVE '7546-SELECT-RECEIVER-STATUS'                   09631018
096320                                      TO DP013-PARAGRAPH          09632018
096330            MOVE 'TIMEOUT SELECTING STATUS-CDE'                   09633018
096340                                      TO DP013-MESSAGE-TEXT (1)   09634018
096350             MOVE SQLCA               TO DP013-SQLCA              09635018
096360             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1) 09636018
096370             SET DP013-DB2-ABEND                                  09637018
096380                 DP013-XCTL-DISPLAY-RESTART                       09638018
096390                                      TO TRUE                     09639018
096400             PERFORM DP013-0000-PROCESS-ABEND                     09640018
096410         WHEN SQLWARN0 NOT = SPACES                               09641018
096420         WHEN SQLCODE < ZERO                                      09642018
096430         WHEN SQLCODE > ZERO                                      09643018
096440             MOVE '7546-SELECT-RECEIVER-STATUS'                   09644018
096450                                   TO DP013-PARAGRAPH             09645018
096460             MOVE 'SELECT STATUS-CDE ' TO DP013-MESSAGE-TEXT (1)  09646018
096470             MOVE SQLCA        TO DP013-SQLCA                     09647018
096480             MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1) 09648018
096490             SET DP013-DB2-ABEND                                  09649018
096500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09650018
096510             PERFORM DP013-0000-PROCESS-ABEND                     09651018
096520     END-EVALUATE.                                                09652018
096530                                                                  09653018
096540                                                                  09654018
096550 7550-SELECT-FROM-TEMP.                                           09655018
096560                                                                  09656018
096570*    IF THE PO/RCVR IS ALREADY IN THE TEMP TABLE WE CAN'T MAKE IT 09657018
096580*    A 'B' UNION-TYPE                                             09658018
096590                                                                  09659018
096600     SET PS-TEMP-B-YES                TO TRUE                     09660018
096610                                                                  09661018
096620     EXEC SQL                                                     09662018
096630         SELECT                                                   09663018
096640             'N'                                                  09664018
096650         ,   RCVR_STAT_CDE                                        09665018
096660         ,   RCVR_PRCG_CDE                                        09666018
096670         ,   DISP_SEQ_NBR                                         09667018
096680         INTO                                                     09668018
096690             :PS-TEMP-B-SWITCH                                    09669018
096700         ,   :PV-TEMP-STATUS-CDE                                  09670018
096710         ,   :PV-TEMP-UNION-TYPE                                  09671018
096720         ,   :PV-TEMP-SCREEN-SEQUENCE                             09672018
096730         FROM                                                     09673018
096740             SUTT_PO_RCVR_TRLR                                    09674018
096750         WHERE                                                    09675018
096760             PO_NBR          = :PV-TEMP-PO-NBR                    09676018
096770         AND RCVR_SEQ_NBR    = :PV-TEMP-REC-SEQ-NBR               09677018
096780         FETCH FIRST 1 ROWS ONLY                                  09678018
096790     END-EXEC.                                                    09679018
096800                                                                  09680018
096810     EVALUATE TRUE                                                09681018
096820         WHEN SQLCODE = ZERO                                      09682018
096830         WHEN SQLCODE = +100                                      09683018
096840         WHEN SQLCODE = -811                                      09684018
096850             CONTINUE                                             09685018
096860         WHEN SQLWARN0 NOT = SPACES                               09686018
096870         WHEN SQLCODE < ZERO                                      09687018
096880         WHEN SQLCODE > ZERO                                      09688018
096890             MOVE '7550-SELECT-FROM-TEMP'                         09689018
096900                                   TO DP013-PARAGRAPH             09690018
096910             MOVE 'SELECT PO/RCVR' TO DP013-MESSAGE-TEXT (1)      09691018
096920             MOVE SQLCA        TO DP013-SQLCA                     09692018
096930             MOVE 'SUTT_PO_RCVR_TRLR ' TO DP013-DB2-TABLE-NAME (1)09693018
096940             SET DP013-DB2-ABEND                                  09694018
096950                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09695018
096960             PERFORM DP013-0000-PROCESS-ABEND                     09696018
096970     END-EVALUATE.                                                09697018
096980                                                                  09698018
096990 7555-FIND-DELETED-PKSLIPS.                                       09699018
097000                                                                  09700018
097010     SET PS-TEMP-PKSLIP-DELETED-NO    TO TRUE                     09701018
097020                                                                  09702018
097030     EXEC SQL                                                     09703018
097040         SELECT                                                   09704018
097050             'Y'                                                  09705018
097060         INTO                                                     09706018
097070             :PS-TEMP-PKSLIP-STAT-SW                              09707018
097080         FROM                                                     09708018
097090             TPKSLIP                                              09709018
097100         WHERE                                                    09710018
097110             PO_NBR        = :PV-TEMP-PO-NBR                      09711018
097120         AND PKSL_STAT_CDE = 'DE'                                 09712018
097130         FETCH FIRST 1 ROWS ONLY                                  09713018
097140     END-EXEC.                                                    09714018
097150                                                                  09715018
097160     EVALUATE TRUE                                                09716018
097170         WHEN SQLCODE = ZERO                                      09717018
097180         WHEN SQLCODE = +100                                      09718018
097190         WHEN SQLCODE = -811                                      09719018
097200             CONTINUE                                             09720018
097210         WHEN SQLCODE = -904                                      09721018
097220         WHEN SQLCODE = -913                                      09722018
097230         WHEN SQLCODE = -911                                      09723018
097240             MOVE '7555-FIND-DELETED-PKSLIPS'                     09724018
097250                                      TO DP013-PARAGRAPH          09725018
097260            MOVE 'TIMEOUT SELECTING REC-SEQ-NBR'                  09726018
097270                                      TO DP013-MESSAGE-TEXT (1)   09727018
097280             MOVE SQLCA               TO DP013-SQLCA              09728018
097290             MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1) 09729018
097300             SET DP013-DB2-ABEND                                  09730018
097310                 DP013-XCTL-DISPLAY-RESTART                       09731018
097320                                      TO TRUE                     09732018
097330             PERFORM DP013-0000-PROCESS-ABEND                     09733018
097340         WHEN SQLWARN0 NOT = SPACES                               09734018
097350         WHEN SQLCODE < ZERO                                      09735018
097360         WHEN SQLCODE > ZERO                                      09736018
097370             MOVE '7555-FIND-DELETED-PKSLIPS'                     09737018
097380                                   TO DP013-PARAGRAPH             09738018
097390             MOVE 'SELECT REC-SEQ-NBR' TO DP013-MESSAGE-TEXT (1)  09739018
097400             MOVE SQLCA        TO DP013-SQLCA                     09740018
097410             MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1) 09741018
097420             SET DP013-DB2-ABEND                                  09742018
097430                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09743018
097440             PERFORM DP013-0000-PROCESS-ABEND                     09744018
097450     END-EVALUATE.                                                09745018
097460                                                                  09746018
097470/                                                                 09747018
097480 7600-INSERT-TEMP-TABLE.                                          09748018
097490     INITIALIZE DCLSUT00042                                       09749018
097500     MOVE PV-TEMP-PO-NBR              TO SUT00042-PO-NBR          09750018
097510     MOVE PV-TEMP-REC-SEQ-NBR         TO SUT00042-RCVR-SEQ-NBR    09751018
097520     MOVE PV-TEMP-STATUS-CDE          TO SUT00042-RCVR-STAT-CDE   09752018
097530     EVALUATE TRUE                                                09753018
097540         WHEN PV-TEMP-STATUS-CDE = 'IP'                           09754018
097550              MOVE  1              TO PV-TEMP-SCREEN-SEQUENCE     09755018
097560         WHEN PV-TEMP-STATUS-CDE = 'CM'                           09756018
097570              MOVE  2              TO PV-TEMP-SCREEN-SEQUENCE     09757018
097580         WHEN PV-TEMP-STATUS-CDE = 'VE'                           09758018
097590              MOVE  3              TO PV-TEMP-SCREEN-SEQUENCE     09759018
097600     END-EVALUATE                                                 09760018
097610                                                                  09761018
097620     MOVE PV-TEMP-SCREEN-SEQUENCE     TO SUT00042-DISP-SEQ-NBR    09762018
097630     MOVE PV-TEMP-UNION-TYPE          TO SUT00042-RCVR-PRCG-CDE   09763018
097640                                                                  09764018
097650     EXEC SQL                                                     09765018
097660         INSERT                                                   09766018
097670         INTO                                                     09767018
097680             SUTT_PO_RCVR_TRLR                                    09768018
097690         (                                                        09769018
097700           PO_NBR                                                 09770018
097710         , RCVR_SEQ_NBR                                           09771018
097720         , RCVR_STAT_CDE                                          09772018
097730         , DISP_SEQ_NBR                                           09773018
097740         , RCVR_PRCG_CDE                                          09774018
097750         )                                                        09775018
097760         VALUES                                                   09776018
097770         (                                                        09777018
097780           :SUT00042-PO-NBR                                       09778018
097790         , :SUT00042-RCVR-SEQ-NBR                                 09779018
097800         , :SUT00042-RCVR-STAT-CDE                                09780018
097810         , :SUT00042-DISP-SEQ-NBR                                 09781018
097820         , :SUT00042-RCVR-PRCG-CDE                                09782018
097830         )                                                        09783018
097840     END-EXEC.                                                    09784018
097850                                                                  09785018
097860     EVALUATE TRUE                                                09786018
097870         WHEN SQLCODE = ZERO                                      09787018
097880             CONTINUE                                             09788018
097890         WHEN SQLWARN0 NOT = SPACES                               09789018
097900         WHEN SQLCODE < ZERO                                      09790018
097910         WHEN SQLCODE > ZERO                                      09791018
097920             MOVE '7600-INSERT-TEMP-TABLE'                        09792018
097930                                   TO DP013-PARAGRAPH             09793018
097940             MOVE 'INSERT INTO TEMP'  TO DP013-MESSAGE-TEXT (1)   09794018
097950             MOVE SQLCA        TO DP013-SQLCA                     09795018
097960             MOVE 'SUTT_PO_RCVR_TRLR' TO DP013-DB2-TABLE-NAME (1) 09796018
097970             SET DP013-DB2-ABEND                                  09797018
097980                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09798018
097990             PERFORM DP013-0000-PROCESS-ABEND                     09799018
098000     END-EVALUATE.                                                09800018
098010                                                                  09801018
098020 7700-SELECT-HANG-FOLD.                                           09802018
098030                                                                  09803018
098040     INITIALIZE XLT00004-HNG-FOLD-DESC                            09804018
098050                XLT00003-SKU-NBR                                  09805018
098060                PV-HNG-FOLD-CDE                                   09806018
098070                                                                  09807018
098080     EXEC SQL                                                     09808018
098090         SELECT STYL.HNG_FOLD_DESC                                09809018
098100              , SKU.SKU_NBR                                       09810018
098110              , CASE                                              09811018
098120                 WHEN STYL.HNG_FOLD_DESC = 'HANG'                 09812018
098130                     THEN 'H'                                     09813018
098140                 WHEN STYL.HNG_FOLD_DESC = 'FOLD'                 09814018
098150                     THEN 'F'                                     09815018
098160                 WHEN STYL.HNG_FOLD_DESC = '                    ' 09816018
098170                     THEN ' '                                     09817018
098180                 ELSE 'U'                                         09818018
098190                 END                                              09819018
098200             INTO                                                 09820018
098210                 :XLT00004-HNG-FOLD-DESC                          09821018
098220             ,   :XLT00003-SKU-NBR                                09822018
098230             ,   :PV-HNG-FOLD-CDE                                 09823018
098240                                                                  09824018
098250             FROM XLT_VND_STYL STYL                               09825018
098260               ,  XLT_SKU      SKU                                09826018
098270             WHERE SKU.ITM_NBR = :XLT00003-ITM-NBR                09827018
098280                AND SKU.STYL_ID = STYL.STYL_ID                    09828018
098290         WITH UR                                                  09829018
098300     END-EXEC                                                     09830018
098310                                                                  09831018
098320     EVALUATE TRUE                                                09832018
098330         WHEN SQLCODE = ZERO                                      09833018
098340            CONTINUE                                              09834018
098350         WHEN SQLWARN0 NOT = SPACES                               09835018
098360         WHEN SQLCODE < ZERO                                      09836018
098370         WHEN SQLCODE > ZERO                                      09837018
098380             MOVE XLT00003-ITM-NBR  TO  PV-DISPLAY-ITEM           09838018
098390             MOVE DK-PO-NBR         TO  PV-DISPLAY-PO             09839018
098400             MOVE DK-REC-SEQ-NBR    TO  PV-DISPLAY-RCVR           09840018
098410             MOVE '7700-SELECT-HANG-FOLD'                         09841018
098420                                   TO DP013-PARAGRAPH             09842018
098430***          MOVE 'SELECT '  TO DP013-MESSAGE-TEXT (1)            09843018
098440             INITIALIZE DP013-MESSAGE-TEXT (1)                    09844018
098450                        DP013-MESSAGE-TEXT (2)                    09845018
098460             STRING PV-DISPLAY-PO '-'                             09846018
098470                    PV-DISPLAY-RCVR DELIMITED BY SIZE             09847018
098480                           INTO DP013-MESSAGE-TEXT (1)            09848018
098490             MOVE PV-DISPLAY-ITEM                                 09849018
098500                               TO DP013-MESSAGE-TEXT (2)          09850018
098510             MOVE SQLCA        TO DP013-SQLCA                     09851018
098520             MOVE 'XLT_SKU          ' TO DP013-DB2-TABLE-NAME (1) 09852018
098530             MOVE 'XLT_VND_STYL     ' TO DP013-DB2-TABLE-NAME (2) 09853018
098540             SET DP013-DB2-ABEND                                  09854018
098550                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09855018
098560             PERFORM DP013-0000-PROCESS-ABEND                     09856018
098570     END-EVALUATE.                                                09857018
098580/                                                                 09858018
098590                                                                  09859018
098600 8000-UPDATE-TRIP-SHIPMENT-STAT.                                  09860018
098610                                                                  09861018
098620     PERFORM 8005-UPDATE-TVEHICL.                                 09862018
098630     PERFORM 8030-AUDIT-TVEHICL.                                  09863018
098640     MOVE ASC-TRIP-ID    TO DK-TRIP-ID.                           09864018
098650     PERFORM 8010-SELECT-TTRIPST.                                 09865018
098660     MOVE 'UN'               TO TRIPST-TRIP-STATUS-CDE.           09866018
098670     PERFORM 8020-INSERT-TTRIPST.                                 09867018
098680                                                                  09868018
098690     IF  PS-NO-ERROR                                              09869018
098700         MOVE 'N'            TO PS-SHIPMENT-CURSOR-SW             09870018
098710         PERFORM 8100-OPEN-SHIPMENT-CSR                           09871018
098720         PERFORM 8102-FETCH-SHIPMENT-CSR                          09872018
098730         PERFORM UNTIL PS-NO-MORE-SHIPMENTS                       09873018
098740             MOVE SHIPMT-SHIPT-ID                                 09874018
098750                             TO DK-SHIPT-ID                       09875018
098760             PERFORM 8110-SELECT-TSHIPST                          09876018
098770             MOVE 'UN'       TO SHIPST-SHIPT-STATUS-CDE           09877018
098780             PERFORM 8120-INSERT-TSHIPST                          09878018
098790             PERFORM 8102-FETCH-SHIPMENT-CSR                      09879018
098800         END-PERFORM                                              09880018
098810         PERFORM 8104-CLOSE-SHIPMENT-CSR                          09881018
098820     END-IF.                                                      09882018
098830                                                                  09883018
098840                                                                  09884018
098850*----------------------------------------------------------------*09885018
098860*  UPDATE THE LOCATION AND STATUS OF THE VEHICLE                 *09886018
098870*----------------------------------------------------------------*09887018
098880 8005-UPDATE-TVEHICL.                                             09888018
098890                                                                  09889018
098900     MOVE 'UN' TO VEHICL-CURR-STATUS-CDE                          09890018
098910                                                                  09891018
098920                                                                  09892018
098930     PERFORM                                                      09893018
098940         WITH TEST AFTER                                          09894018
098950         VARYING PV-RETRY-COUNTER                                 09895018
098960         FROM 1 BY 1                                              09896018
098970         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09897018
098980             OR (SQLCODE = +0))                                   09898018
098990                                                                  09899018
099000         EXEC SQL                                                 09900018
099010           UPDATE TVEHICL                                         09901018
099020              SET LAST_UPD_DTE     = CURRENT DATE                 09902018
099030                 ,LAST_UPD_TME     = CURRENT TIME                 09903018
099040                 ,LAST_UPD_UID     = :DP020-USERID                09904018
099050                 ,CURR_STATUS_DTE  = CURRENT DATE                 09905018
099060                 ,CURR_STATUS_TME  = CURRENT TIME                 09906018
099070                 ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE      09907018
099080           WHERE  VEH_NBR       = :DK-VEH-NBR                     09908018
099090             AND  OWNER_SCAC_ID = :DK-SCAC-ID                     09909018
099100         END-EXEC                                                 09910018
099110                                                                  09911018
099120         EVALUATE TRUE                                            09912018
099130             WHEN SQLCODE = +0                                    09913018
099140             WHEN SQLCODE = -904                                  09914018
099150             WHEN SQLCODE = -913                                  09915018
099160                 CONTINUE                                         09916018
099170                                                                  09917018
099180             WHEN SQLWARN0 NOT = SPACES                           09918018
099190             WHEN SQLCODE < +0                                    09919018
099200             WHEN SQLCODE > +0                                    09920018
099210                 MOVE '8005-UPDATE-TVEHICL'                       09921018
099220                                   TO DP013-PARAGRAPH             09922018
099230                 MOVE 'UPDATE CURR INFO ON TVEHICL'               09923018
099240                                   TO DP013-MESSAGE-TEXT(1)       09924018
099250                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   09925018
099260                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              09926018
099270                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      09927018
099280                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    09928018
099290                 MOVE SQLCA        TO DP013-SQLCA                 09929018
099300                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    09930018
099310                 SET DP013-DB2-ABEND                              09931018
099320                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09932018
099330                 PERFORM DP013-0000-PROCESS-ABEND                 09933018
099340         END-EVALUATE                                             09934018
099350     END-PERFORM.                                                 09935018
099360                                                                  09936018
099370     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09937018
099380         SQLCODE NOT = +0                                         09938018
099390         MOVE '8005-UPDATE-TVEHICL'                               09939018
099400                                   TO DP013-PARAGRAPH             09940018
099410         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09941018
099420                                   TO DP013-MESSAGE-TEXT (1)      09942018
099430         MOVE 'TO UPDATE A TVEHICL ROW'                           09943018
099440                                   TO DP013-MESSAGE-TEXT (2)      09944018
099450         MOVE SQLCA                TO DP013-SQLCA                 09945018
099460         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    09946018
099470         SET DP013-DB2-ABEND                                      09947018
099480             DP013-XCTL-DISPLAY-RESTART                           09948018
099490                                   TO TRUE                        09949018
099500         PERFORM DP013-0000-PROCESS-ABEND                         09950018
099510     END-IF.                                                      09951018
099520                                                                  09952018
099530*----------------------------------------------------------------*09953018
099540*  SELECT CURRENT TRIP STATUS ROW                                *09954018
099550*----------------------------------------------------------------*09955018
099560 8010-SELECT-TTRIPST.                                             09956018
099570                                                                  09957018
099580     PERFORM                                                      09958018
099590         WITH TEST AFTER                                          09959018
099600         VARYING PV-RETRY-COUNTER                                 09960018
099610         FROM 1 BY 1                                              09961018
099620         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09962018
099630             OR (SQLCODE = +0))                                   09963018
099640                                                                  09964018
099650         EXEC SQL                                                 09965018
099660             SELECT  A.TRIP_ID                                    09966018
099670                    ,A.TRIP_STATUS_CDE                            09967018
099680                    ,A.STATUS_DTE                                 09968018
099690                    ,A.STATUS_TME                                 09969018
099700                    ,A.STATUS_UID                                 09970018
099710                    ,A.OPER_UNT_ID                                09971018
099720                    ,A.FCLTY_ID                                   09972018
099730                    ,A.FCLTY_AREA_ID                              09973018
099740              INTO   :TRIPST-TRIP-ID                              09974018
099750                    ,:TRIPST-TRIP-STATUS-CDE                      09975018
099760                    ,:TRIPST-STATUS-DTE                           09976018
099770                    ,:TRIPST-STATUS-TME                           09977018
099780                    ,:TRIPST-STATUS-UID                           09978018
099790                    ,:TRIPST-OPER-UNT-ID                          09979018
099800                    ,:TRIPST-FCLTY-ID                             09980018
099810                    ,:TRIPST-FCLTY-AREA-ID                        09981018
099820              FROM  TTRIPST A                                     09982018
099830                   ,TTRSTYP B                                     09983018
099840             WHERE  A.TRIP_ID          = :DK-TRIP-ID              09984018
099850               AND  A.TRIP_STATUS_CDE ^= 'DE'                     09985018
099860               AND  B.PRTY_CDE =                                  09986018
099870                  (SELECT MAX(D.PRTY_CDE)                         09987018
099880                     FROM TTRIPST C                               09988018
099890                         ,TTRSTYP D                               09989018
099900                    WHERE C.TRIP_ID         = A.TRIP_ID           09990018
099910                      AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  09991018
099920               AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE         09992018
099930         END-EXEC                                                 09993018
099940                                                                  09994018
099950         EVALUATE TRUE                                            09995018
099960             WHEN SQLCODE = +0                                    09996018
099970             WHEN SQLCODE = -904                                  09997018
099980             WHEN SQLCODE = -913                                  09998018
099990                 CONTINUE                                         09999018
100000                                                                  10000018
100100             WHEN SQLWARN0 NOT = SPACES                           10010018
100200             WHEN SQLCODE < +0                                    10020018
100300             WHEN SQLCODE > +0                                    10030018
100400                 MOVE '8010-SELECT-TTRIPST'                       10040018
100500                                   TO DP013-PARAGRAPH             10050018
100600                 MOVE 'SELECT A ROW ON TTRIPST'                   10060018
100700                                   TO DP013-MESSAGE-TEXT(1)       10070018
100800                 MOVE SQLCA        TO DP013-SQLCA                 10080018
100900                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    10090018
101000                 MOVE DK-TRIP-ID   TO PV-DISPLAY-TRIP             10100018
101100                 STRING               DK-SCAC-ID '/'              10110018
101200                                      DK-ARRIVAL-DTE '/'          10120018
101300                                      DK-VEH-NBR '/'              10130018
101400                                      PV-DISPLAY-TRIP '/'         10140018
101500                 DELIMITED BY SIZE                                10150018
101600                                 INTO DP013-MESSAGE-TEXT(2)       10160018
101700                 STRING                                           10170018
101800                                      DP020-STACK-TRAN-ID(1) '/'  10180018
101900                                      DP020-STACK-TRAN-ID(2) '/'  10190018
102000                                      DP020-STACK-TRAN-ID(3) '/'  10200018
102100                                      DP020-STACK-TRAN-ID(4) '/'  10210018
102200                                      DP020-STACK-TRAN-ID(5) '/'  10220018
102300                                      DP020-STACK-TRAN-ID(6) '/'  10230018
102400                                      DP020-STACK-TRAN-ID(7) '/'  10240018
102500                                      DP020-STACK-TRAN-ID(8) '/'  10250018
102600                                      DP020-STACK-TRAN-ID(9) '/'  10260018
102700                                      DP020-STACK-TRAN-ID(10)     10270018
102800                 DELIMITED BY SIZE                                10280018
102900                                 INTO DP013-MESSAGE-TEXT(3)       10290018
103000                 SET DP013-DB2-ABEND                              10300018
103100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10310018
103200                 PERFORM DP013-0000-PROCESS-ABEND                 10320018
103300         END-EVALUATE                                             10330018
103400     END-PERFORM.                                                 10340018
103500                                                                  10350018
103600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    10360018
103700         SQLCODE NOT = +0                                         10370018
103800         MOVE '8010-SELECT-TTRIPST'                               10380018
103900                                   TO DP013-PARAGRAPH             10390018
104000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              10400018
104100                                   TO DP013-MESSAGE-TEXT (1)      10410018
104200         MOVE 'TO SELECT A TTRIPST ROW'                           10420018
104300                                   TO DP013-MESSAGE-TEXT (2)      10430018
104400         MOVE SQLCA                TO DP013-SQLCA                 10440018
104500         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    10450018
104600         SET DP013-DB2-ABEND                                      10460018
104700             DP013-XCTL-DISPLAY-RESTART                           10470018
104800                                   TO TRUE                        10480018
104900         PERFORM DP013-0000-PROCESS-ABEND                         10490018
105000     END-IF.                                                      10500018
105100                                                                  10510018
105200                                                                  10520018
105300*----------------------------------------------------------------*10530018
105400*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *10540018
105500*----------------------------------------------------------------*10550018
105600 8020-INSERT-TTRIPST.                                             10560018
105700                                                                  10570018
105800     PERFORM                                                      10580018
105900         WITH TEST AFTER                                          10590018
106000         VARYING PV-RETRY-COUNTER                                 10600018
106100         FROM 1 BY 1                                              10610018
106200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10620018
106300             OR (SQLCODE = +0)                                    10630018
106400             OR (SQLCODE = -803))                                 10640018
106500                                                                  10650018
106600         EXEC SQL                                                 10660018
106700             INSERT  INTO TTRIPST                                 10670018
106800                    (TRIP_ID                                      10680018
106900                    ,TRIP_STATUS_CDE                              10690018
107000                    ,STATUS_DTE                                   10700018
107100                    ,STATUS_TME                                   10710018
107200                    ,STATUS_UID                                   10720018
107300                    ,OPER_UNT_ID                                  10730018
107400                    ,FCLTY_ID                                     10740018
107500                    ,FCLTY_AREA_ID)                               10750018
107600            VALUES  (:TRIPST-TRIP-ID                              10760018
107700                    ,:TRIPST-TRIP-STATUS-CDE                      10770018
107800                    ,CURRENT DATE                                 10780018
107900                    ,CURRENT TIME                                 10790018
108000                    ,:DP020-USERID                                10800018
108100                    ,:TRIPST-OPER-UNT-ID                          10810018
108200                    ,:TRIPST-FCLTY-ID                             10820018
108300                    ,:TRIPST-FCLTY-AREA-ID)                       10830018
108400         END-EXEC                                                 10840018
108500                                                                  10850018
108600         EVALUATE TRUE                                            10860018
108700             WHEN SQLCODE = +0                                    10870018
108800                 CONTINUE                                         10880018
108900                                                                  10890018
109000             WHEN SQLCODE = -803                                  10900018
109100                 SET PS-ERROR                                     10910018
109200                     DP020-MSG-INFORMATIONAL                      10920018
109300                                        TO TRUE                   10930018
109400                 MOVE PC-TSYMSG-00417   TO DP020-MSG-NUMBER       10940018
109500                 SET DP030-SET-CURSOR-TRAILER                     10950018
109600                                        TO TRUE                   10960018
109700                                                                  10970018
109800             WHEN SQLCODE = -904                                  10980018
109900             WHEN SQLCODE = -913                                  10990018
110000                 CONTINUE                                         11000018
110100                                                                  11010018
110200             WHEN SQLWARN0 NOT = SPACES                           11020018
110300             WHEN SQLCODE < +0                                    11030018
110400             WHEN SQLCODE > +0                                    11040018
110500                 MOVE '8020-INSERT-TTRIPST'                       11050018
110600                                   TO DP013-PARAGRAPH             11060018
110700                 MOVE 'INSERT A ROW ON TTRIPST'                   11070018
110800                                   TO DP013-MESSAGE-TEXT(1)       11080018
110900                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   11090018
111000                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              11100018
111100                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      11110018
111200                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    11120018
111300                 MOVE SQLCA        TO DP013-SQLCA                 11130018
111400                 MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)    11140018
111500                 SET DP013-DB2-ABEND                              11150018
111600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11160018
111700                 PERFORM DP013-0000-PROCESS-ABEND                 11170018
111800         END-EVALUATE                                             11180018
111900     END-PERFORM.                                                 11190018
112000                                                                  11200018
112100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    11210018
112200         SQLCODE NOT = +0                                         11220018
112300         MOVE '8020-INSERT-TTRIPST'                               11230018
112400                                   TO DP013-PARAGRAPH             11240018
112500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              11250018
112600                                   TO DP013-MESSAGE-TEXT (1)      11260018
112700         MOVE 'TO INSERT A TTRIPST ROW'                           11270018
112800                                   TO DP013-MESSAGE-TEXT (2)      11280018
112900         MOVE SQLCA                TO DP013-SQLCA                 11290018
113000         MOVE 'TTRIPST'            TO DP013-DB2-TABLE-NAME (1)    11300018
113100         SET DP013-DB2-ABEND                                      11310018
113200             DP013-XCTL-DISPLAY-RESTART                           11320018
113300                                   TO TRUE                        11330018
113400         PERFORM DP013-0000-PROCESS-ABEND                         11340018
113500     END-IF.                                                      11350018
113600                                                                  11360018
113700                                                                  11370018
113800*----------------------------------------------------------------*11380018
113900*  TAKE A SNAPSHOT OF THE BEFORE IMAGE OF TVEHICL AND WRITE      *11390018
114000*  TO THE AUDIT TABLE.                                           *11400018
114100*----------------------------------------------------------------*11410018
114200 8030-AUDIT-TVEHICL.                                              11420018
114300                                                                  11430018
114400     INITIALIZE DCLTAUVHCL.                                       11440018
114500                                                                  11450018
114600     PERFORM                                                      11460018
114700         WITH TEST AFTER                                          11470018
114800         VARYING PV-RETRY-COUNTER                                 11480018
114900         FROM 1 BY 1                                              11490018
115000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11500018
115100             OR (SQLCODE = +0))                                   11510018
115200                                                                  11520018
115300         EXEC SQL                                                 11530018
115400             SELECT  OWNER_SCAC_ID                                11540018
115500                    ,VEH_NBR                                      11550018
115600                    ,CRT_SRC_CDE                                  11560018
115700                    ,LAST_UPD_DTE                                 11570018
115800                    ,LAST_UPD_TME                                 11580018
115900                    ,LAST_UPD_UID                                 11590018
116000                    ,USAGE_CDE                                    11600018
116100                    ,VEH_TYP_CDE                                  11610018
116200                    ,CURR_STATUS_CDE                              11620018
116300                    ,CURR_STATUS_DTE                              11630018
116400                    ,CURR_STATUS_TME                              11640018
116500                    ,CURR_OPER_UNT_ID                             11650018
116600                    ,CURR_FCLTY_ID                                11660018
116700                    ,CURR_FAC_AREA_ID                             11670018
116800                    ,CURR_LOC_DTE                                 11680018
116900                    ,CURR_LOC_TME                                 11690018
117000                    ,CURR_TRIP_ID                                 11700018
117100                    ,VEH_SIZE_CDE                                 11710018
117200            INTO     :VEHICL-OWNER-SCAC-ID                        11720018
117300                    ,:VEHICL-VEH-NBR                              11730018
117400                    ,:VEHICL-CRT-SRC-CDE                          11740018
117500                    ,:VEHICL-LAST-UPD-DTE                         11750018
117600                    ,:VEHICL-LAST-UPD-TME                         11760018
117700                    ,:VEHICL-LAST-UPD-UID                         11770018
117800                    ,:VEHICL-USAGE-CDE                            11780018
117900                    ,:VEHICL-VEH-TYP-CDE                          11790018
118000                    ,:VEHICL-CURR-STATUS-CDE                      11800018
118100                    ,:VEHICL-CURR-STATUS-DTE                      11810018
118200                    ,:VEHICL-CURR-STATUS-TME                      11820018
118300                    ,:VEHICL-CURR-OPER-UNT-ID                     11830018
118400                    ,:VEHICL-CURR-FCLTY-ID                        11840018
118500                    ,:VEHICL-CURR-FAC-AREA-ID                     11850018
118600                    ,:VEHICL-CURR-LOC-DTE                         11860018
118700                    ,:VEHICL-CURR-LOC-TME                         11870018
118800                    ,:VEHICL-CURR-TRIP-ID                         11880018
118900                       :DN-CURR-TRIP-ID                           11890018
119000                    ,:VEHICL-VEH-SIZE-CDE                         11900018
119100           FROM   TVEHICL                                         11910018
119200           WHERE  VEH_NBR       = :DK-VEH-NBR                     11920018
119300             AND  OWNER_SCAC_ID = :DK-SCAC-ID                     11930018
119400         END-EXEC                                                 11940018
119500                                                                  11950018
119600         EVALUATE TRUE                                            11960018
119700             WHEN SQLCODE = +0                                    11970018
119800             WHEN SQLCODE = -904                                  11980018
119900             WHEN SQLCODE = -913                                  11990018
120000                 CONTINUE                                         12000018
120100                                                                  12010018
120200             WHEN SQLWARN0 NOT = SPACES                           12020018
120300             WHEN SQLCODE < +0                                    12030018
120400             WHEN SQLCODE > +0                                    12040018
120500                 MOVE '8030-AUDIT-TVEHICL'                        12050018
120600                                   TO DP013-PARAGRAPH             12060018
120700                 MOVE 'SELECT A TVEHICL ROW   '                   12070018
120800                                   TO DP013-MESSAGE-TEXT(1)       12080018
120900                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   12090018
121000                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              12100018
121100                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      12110018
121200                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    12120018
121300                 MOVE SQLCA        TO DP013-SQLCA                 12130018
121400                 MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)    12140018
121500                 SET DP013-DB2-ABEND                              12150018
121600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12160018
121700                 PERFORM DP013-0000-PROCESS-ABEND                 12170018
121800         END-EVALUATE                                             12180018
121900     END-PERFORM.                                                 12190018
122000                                                                  12200018
122100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    12210018
122200         SQLCODE NOT = +0                                         12220018
122300         MOVE '8030-AUDIT-TVEHICL '                               12230018
122400                                   TO DP013-PARAGRAPH             12240018
122500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12250018
122600                                   TO DP013-MESSAGE-TEXT (1)      12260018
122700         MOVE 'TO SELECT A TVEHICL ROW'                           12270018
122800                                   TO DP013-MESSAGE-TEXT (2)      12280018
122900         MOVE SQLCA                TO DP013-SQLCA                 12290018
123000         MOVE 'TVEHICL'            TO DP013-DB2-TABLE-NAME (1)    12300018
123100         SET DP013-DB2-ABEND                                      12310018
123200             DP013-XCTL-DISPLAY-RESTART                           12320018
123300                                   TO TRUE                        12330018
123400         PERFORM DP013-0000-PROCESS-ABEND                         12340018
123500     END-IF.                                                      12350018
123600                                                                  12360018
123700     PERFORM                                                      12370018
123800         WITH TEST AFTER                                          12380018
123900         VARYING PV-RETRY-COUNTER                                 12390018
124000         FROM 1 BY 1                                              12400018
124100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12410018
124200             OR (SQLCODE = +0))                                   12420018
124300                                                                  12430018
124400         EXEC SQL                                                 12440018
124500             INSERT  INTO TAUVHCL                                 12450018
124600                    (OWNER_SCAC_ID                                12460018
124700                    ,VEH_NBR                                      12470018
124800                    ,CRT_SRC_CDE                                  12480018
124900                    ,LAST_UPD_DTE                                 12490018
125000                    ,LAST_UPD_TME                                 12500018
125100                    ,LAST_UPD_UID                                 12510018
125200                    ,USAGE_CDE                                    12520018
125300                    ,VEH_TYP_CDE                                  12530018
125400                    ,CURR_STATUS_CDE                              12540018
125500                    ,CURR_STATUS_DTE                              12550018
125600                    ,CURR_STATUS_TME                              12560018
125700                    ,CURR_OPER_UNT_ID                             12570018
125800                    ,CURR_FCLTY_ID                                12580018
125900                    ,CURR_FAC_AREA_ID                             12590018
126000                    ,CURR_LOC_DTE                                 12600018
126100                    ,CURR_LOC_TME                                 12610018
126200                    ,CURR_TRIP_ID                                 12620018
126300                    ,VEH_SIZE_CDE)                                12630018
126400            VALUES  (:VEHICL-OWNER-SCAC-ID                        12640018
126500                    ,:VEHICL-VEH-NBR                              12650018
126600                    ,:VEHICL-CRT-SRC-CDE                          12660018
126700                    ,:VEHICL-LAST-UPD-DTE                         12670018
126800                    ,:VEHICL-LAST-UPD-TME                         12680018
126900                    ,:VEHICL-LAST-UPD-UID                         12690018
127000                    ,:VEHICL-USAGE-CDE                            12700018
127100                    ,:VEHICL-VEH-TYP-CDE                          12710018
127200                    ,:VEHICL-CURR-STATUS-CDE                      12720018
127300                    ,:VEHICL-CURR-STATUS-DTE                      12730018
127400                    ,:VEHICL-CURR-STATUS-TME                      12740018
127500                    ,:VEHICL-CURR-OPER-UNT-ID                     12750018
127600                    ,:VEHICL-CURR-FCLTY-ID                        12760018
127700                    ,:VEHICL-CURR-FAC-AREA-ID                     12770018
127800                    ,:VEHICL-CURR-LOC-DTE                         12780018
127900                    ,:VEHICL-CURR-LOC-TME                         12790018
128000                    ,:VEHICL-CURR-TRIP-ID                         12800018
128100                       :DN-CURR-TRIP-ID                           12810018
128200                    ,:VEHICL-VEH-SIZE-CDE)                        12820018
128300         END-EXEC                                                 12830018
128400                                                                  12840018
128500         EVALUATE TRUE                                            12850018
128600             WHEN SQLCODE = +0                                    12860018
128700             WHEN SQLCODE = -904                                  12870018
128800             WHEN SQLCODE = -913                                  12880018
128900                 CONTINUE                                         12890018
129000                                                                  12900018
129100             WHEN SQLWARN0 NOT = SPACES                           12910018
129200             WHEN SQLCODE < +0                                    12920018
129300             WHEN SQLCODE > +0                                    12930018
129400                 MOVE '8030-AUDIT-TVEHICL '                       12940018
129500                                   TO DP013-PARAGRAPH             12950018
129600                 MOVE 'INSERT A ROW ON TAUVHCL'                   12960018
129700                                   TO DP013-MESSAGE-TEXT(1)       12970018
129800                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   12980018
129900                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              12990018
130000                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      13000018
130100                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    13010018
130200                 MOVE SQLCA        TO DP013-SQLCA                 13020018
130300                 MOVE 'TAUVHCL'    TO DP013-DB2-TABLE-NAME (1)    13030018
130400                 SET DP013-DB2-ABEND                              13040018
130500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13050018
130600                 PERFORM DP013-0000-PROCESS-ABEND                 13060018
130700         END-EVALUATE                                             13070018
130800     END-PERFORM.                                                 13080018
130900                                                                  13090018
131000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    13100018
131100         SQLCODE NOT = +0                                         13110018
131200         MOVE '8030-AUDIT-TAUVHCL'                                13120018
131300                                   TO DP013-PARAGRAPH             13130018
131400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13140018
131500                                   TO DP013-MESSAGE-TEXT (1)      13150018
131600         MOVE 'TO INSERT A TAUVHCL ROW'                           13160018
131700                                   TO DP013-MESSAGE-TEXT (2)      13170018
131800         MOVE SQLCA                TO DP013-SQLCA                 13180018
131900         MOVE 'TAUVHCL'            TO DP013-DB2-TABLE-NAME (1)    13190018
132000         SET DP013-DB2-ABEND                                      13200018
132100             DP013-XCTL-DISPLAY-RESTART                           13210018
132200                                   TO TRUE                        13220018
132300         PERFORM DP013-0000-PROCESS-ABEND                         13230018
132400     END-IF.                                                      13240018
132500                                                                  13250018
132600                                                                  13260018
132700*----------------------------------------------------------------*13270018
132800* OPEN THE SHIPMENT CURSROR                                      *13280018
132900*----------------------------------------------------------------*13290018
133000                                                                  13300018
133100 8100-OPEN-SHIPMENT-CSR.                                          13310018
133200                                                                  13320018
133300     PERFORM                                                      13330018
133400         WITH TEST AFTER                                          13340018
133500         VARYING PV-RETRY-COUNTER                                 13350018
133600         FROM 1 BY 1                                              13360018
133700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13370018
133800            OR (SQLCODE = +0))                                    13380018
133900                                                                  13390018
134000         EXEC SQL                                                 13400018
134100              OPEN SHIPMENT-CSR                                   13410018
134200         END-EXEC                                                 13420018
134300                                                                  13430018
134400         EVALUATE TRUE                                            13440018
134500             WHEN SQLCODE = +0                                    13450018
134600                  CONTINUE                                        13460018
134700             WHEN SQLCODE = -904                                  13470018
134800             WHEN SQLCODE = -913                                  13480018
134900                  CONTINUE                                        13490018
135000             WHEN SQLWARN0 NOT = SPACE                            13500018
135100             WHEN SQLCODE  NOT = +0                               13510018
135200                  MOVE '8100-OPEN-SHIPMENT-CSR'                   13520018
135300                                   TO DP013-PARAGRAPH             13530018
135400                  MOVE 'OPEN SHIPMENT CURSOR'                     13540018
135500                                   TO DP013-MESSAGE-TEXT (1)      13550018
135600                  MOVE DK-PO-NBR  TO PV-ERROR-PO                  13560018
135700                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ             13570018
135800                  MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID     13580018
135900                  MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)   13590018
136000                  MOVE SQLCA       TO DP013-SQLCA                 13600018
136100                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)    13610018
136200                  SET DP013-DB2-ABEND                             13620018
136300                                   TO TRUE                        13630018
136400                  PERFORM DP013-0000-PROCESS-ABEND                13640018
136500         END-EVALUATE                                             13650018
136600     END-PERFORM.                                                 13660018
136700                                                                  13670018
136800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    13680018
136900         SQLCODE NOT = +0                                         13690018
137000         MOVE '8100-OPEN-SHIPMENT-CSR'                            13700018
137100                                   TO DP013-PARAGRAPH             13710018
137200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN SHIPMENT CURSOR'     13720018
137300                                   TO DP013-MESSAGE-TEXT (1)      13730018
137400         MOVE SQLCA                TO DP013-SQLCA                 13740018
137500         SET DP013-DB2-ABEND       TO TRUE                        13750018
137600         PERFORM DP013-0000-PROCESS-ABEND                         13760018
137700     END-IF.                                                      13770018
137800                                                                  13780018
137900                                                                  13790018
138000*----------------------------------------------------------------*13800018
138100*    FETCH A SHIPMENT ROW                                        *13810018
138200*----------------------------------------------------------------*13820018
138300                                                                  13830018
138400 8102-FETCH-SHIPMENT-CSR.                                         13840018
138500                                                                  13850018
138600     EXEC SQL                                                     13860018
138700          FETCH SHIPMENT-CSR                                      13870018
138800          INTO :SHIPMT-SHIPT-ID                                   13880018
138900     END-EXEC                                                     13890018
139000                                                                  13900018
139100     EVALUATE TRUE                                                13910018
139200         WHEN SQLCODE = +0                                        13920018
139300              CONTINUE                                            13930018
139400                                                                  13940018
139500         WHEN SQLCODE = +100                                      13950018
139600              SET PS-NO-MORE-SHIPMENTS TO TRUE                    13960018
139700                                                                  13970018
139800         WHEN SQLWARN0 NOT = SPACE                                13980018
139900         WHEN SQLCODE < +0                                        13990018
140000         WHEN SQLCODE > +0                                        14000018
140100              MOVE '8102-FETCH-SHIPMENT-CSR'                      14010018
140200                                   TO DP013-PARAGRAPH             14020018
140300              MOVE 'FETCH SHIPMENT CURSOR'                        14030018
140400                                   TO DP013-MESSAGE-TEXT (1)      14040018
140500              MOVE DK-PO-NBR  TO PV-ERROR-PO                      14050018
140600              MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ                 14060018
140700              MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID         14070018
140800              MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)       14080018
140900              MOVE SQLCA           TO DP013-SQLCA                 14090018
141000              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (1)    14100018
141100              SET DP013-DB2-ABEND  TO TRUE                        14110018
141200              PERFORM DP013-0000-PROCESS-ABEND                    14120018
141300     END-EVALUATE.                                                14130018
141400                                                                  14140018
141500                                                                  14150018
141600*----------------------------------------------------------------*14160018
141700* CLOSE THE SHIPMENT CURSOR                                      *14170018
141800*----------------------------------------------------------------*14180018
141900                                                                  14190018
142000 8104-CLOSE-SHIPMENT-CSR.                                         14200018
142100                                                                  14210018
142200     EXEC SQL                                                     14220018
142300          CLOSE SHIPMENT-CSR                                      14230018
142400     END-EXEC                                                     14240018
142500                                                                  14250018
142600     EVALUATE TRUE                                                14260018
142700         WHEN SQLCODE = +0                                        14270018
142800              CONTINUE                                            14280018
142900         WHEN SQLWARN0 NOT = SPACE                                14290018
143000         WHEN SQLCODE  NOT = +0                                   14300018
143100              MOVE '8104-CLOSE-SHIPMENT-CSR'                      14310018
143200                                   TO DP013-PARAGRAPH             14320018
143300              MOVE 'CLOSE SHIPMENT CURSOR'                        14330018
143400                                   TO DP013-MESSAGE-TEXT (1)      14340018
143500              MOVE SQLCA           TO DP013-SQLCA                 14350018
143600              MOVE 'TSHIPMT'       TO DP013-DB2-TABLE-NAME (1)    14360018
143700              SET DP013-DB2-ABEND  TO TRUE                        14370018
143800              PERFORM DP013-0000-PROCESS-ABEND                    14380018
143900     END-EVALUATE.                                                14390018
144000                                                                  14400018
144100                                                                  14410018
144200*----------------------------------------------------------------*14420018
144300*  SELECT LATEST SHIPMENT STATUS ROW                             *14430018
144400*----------------------------------------------------------------*14440018
144500 8110-SELECT-TSHIPST.                                             14450018
144600                                                                  14460018
144700     PERFORM                                                      14470018
144800         WITH TEST AFTER                                          14480018
144900         VARYING PV-RETRY-COUNTER                                 14490018
145000         FROM 1 BY 1                                              14500018
145100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14510018
145200             OR (SQLCODE = +0))                                   14520018
145300                                                                  14530018
145400         EXEC SQL                                                 14540018
145500             SELECT  A.SHIPT_ID                                   14550018
145600                    ,A.SHIPT_STATUS_CDE                           14560018
145700                    ,A.STATUS_DTE                                 14570018
145800                    ,A.STATUS_TME                                 14580018
145900                    ,A.STATUS_UID                                 14590018
146000                    ,A.DELAY_RSN_CDE                              14600018
146100                    ,A.CARR_STATUS_CDE                            14610018
146200                    ,A.TIME_ZONE_CDE                              14620018
146300                    ,A.CITY_NAME                                  14630018
146400                    ,A.STATE_CDE                                  14640018
146500             INTO    :SHIPST-SHIPT-ID                             14650018
146600                    ,:SHIPST-SHIPT-STATUS-CDE                     14660018
146700                    ,:SHIPST-STATUS-DTE                           14670018
146800                    ,:SHIPST-STATUS-TME                           14680018
146900                    ,:SHIPST-STATUS-UID                           14690018
147000                    ,:SHIPST-DELAY-RSN-CDE                        14700018
147100                    ,:SHIPST-CARR-STATUS-CDE                      14710018
147200                    ,:SHIPST-TIME-ZONE-CDE                        14720018
147300                    ,:SHIPST-CITY-NAME                            14730018
147400                    ,:SHIPST-STATE-CDE                            14740018
147500           FROM   TSHIPST A                                       14750018
147600                 ,TSHSTYP B                                       14760018
147700           WHERE  A.SHIPT_ID = :DK-SHIPT-ID                       14770018
147800             AND  B.PRTY_CDE =                                    14780018
147900                  (SELECT MAX(D.PRTY_CDE)                         14790018
148000                     FROM TSHIPST C                               14800018
148100                         ,TSHSTYP D                               14810018
148200                    WHERE C.SHIPT_ID         = A.SHIPT_ID         14820018
148300                      AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)14830018
148400             AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE         14840018
148500         END-EXEC                                                 14850018
148600                                                                  14860018
148700         EVALUATE TRUE                                            14870018
148800             WHEN SQLCODE = +0                                    14880018
148900             WHEN SQLCODE = -904                                  14890018
149000             WHEN SQLCODE = -913                                  14900018
149100                 CONTINUE                                         14910018
149200                                                                  14920018
149300             WHEN SQLWARN0 NOT = SPACES                           14930018
149400             WHEN SQLCODE < +0                                    14940018
149500             WHEN SQLCODE > +0                                    14950018
149600                 MOVE '8110-SELECT-TSHIPST'                       14960018
149700                                   TO DP013-PARAGRAPH             14970018
149800                 MOVE 'SELECT A TSHIPST ROW   '                   14980018
149900                                   TO DP013-MESSAGE-TEXT(1)       14990018
150000                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   15000018
150100                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              15010018
150200                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      15020018
150300                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    15030018
150400                 MOVE SQLCA        TO DP013-SQLCA                 15040018
150500                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    15050018
150600                 SET DP013-DB2-ABEND                              15060018
150700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15070018
150800                 PERFORM DP013-0000-PROCESS-ABEND                 15080018
150900         END-EVALUATE                                             15090018
151000     END-PERFORM.                                                 15100018
151100                                                                  15110018
151200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15120018
151300         SQLCODE NOT = +0                                         15130018
151400         MOVE '8110-SELECT-TSHIPST'                               15140018
151500                                   TO DP013-PARAGRAPH             15150018
151600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              15160018
151700                                   TO DP013-MESSAGE-TEXT (1)      15170018
151800         MOVE 'TO SELECT A TSHIPST ROW'                           15180018
151900                                   TO DP013-MESSAGE-TEXT (2)      15190018
152000         MOVE SQLCA                TO DP013-SQLCA                 15200018
152100         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    15210018
152200         SET DP013-DB2-ABEND                                      15220018
152300             DP013-XCTL-DISPLAY-RESTART                           15230018
152400                                   TO TRUE                        15240018
152500         PERFORM DP013-0000-PROCESS-ABEND                         15250018
152600     END-IF.                                                      15260018
152700                                                                  15270018
152800                                                                  15280018
152900*----------------------------------------------------------------*15290018
153000*  INSERT A SHIPMENT STATUS ROW                                  *15300018
153100*----------------------------------------------------------------*15310018
153200 8120-INSERT-TSHIPST.                                             15320018
153300                                                                  15330018
153400     PERFORM                                                      15340018
153500         WITH TEST AFTER                                          15350018
153600         VARYING PV-RETRY-COUNTER                                 15360018
153700         FROM 1 BY 1                                              15370018
153800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15380018
153900             OR (SQLCODE = +0))                                   15390018
154000                                                                  15400018
154100         EXEC SQL                                                 15410018
154200             INSERT  INTO TSHIPST                                 15420018
154300                    (SHIPT_ID                                     15430018
154400                    ,SHIPT_STATUS_CDE                             15440018
154500                    ,STATUS_DTE                                   15450018
154600                    ,STATUS_TME                                   15460018
154700                    ,STATUS_UID                                   15470018
154800                    ,DELAY_RSN_CDE                                15480018
154900                    ,CARR_STATUS_CDE                              15490018
155000                    ,TIME_ZONE_CDE                                15500018
155100                    ,CITY_NAME                                    15510018
155200                    ,STATE_CDE )                                  15520018
155300            VALUES  (:SHIPST-SHIPT-ID                             15530018
155400                    ,:SHIPST-SHIPT-STATUS-CDE                     15540018
155500                    ,CURRENT DATE                                 15550018
155600                    ,CURRENT TIME                                 15560018
155700                    ,:DP020-USERID                                15570018
155800                    ,:SHIPST-DELAY-RSN-CDE                        15580018
155900                    ,:SHIPST-CARR-STATUS-CDE                      15590018
156000                    ,:SHIPST-TIME-ZONE-CDE                        15600018
156100                    ,:SHIPST-CITY-NAME                            15610018
156200                    ,:SHIPST-STATE-CDE )                          15620018
156300         END-EXEC                                                 15630018
156400                                                                  15640018
156500         EVALUATE TRUE                                            15650018
156600             WHEN SQLCODE = +0                                    15660018
156700             WHEN SQLCODE = -904                                  15670018
156800             WHEN SQLCODE = -913                                  15680018
156900                 CONTINUE                                         15690018
157000                                                                  15700018
157100             WHEN SQLWARN0 NOT = SPACES                           15710018
157200             WHEN SQLCODE < +0                                    15720018
157300             WHEN SQLCODE > +0                                    15730018
157400                 MOVE '8120-INSERT-TSHIPST'                       15740018
157500                                   TO DP013-PARAGRAPH             15750018
157600                 MOVE 'INSERT A ROW ON TSHIPST'                   15760018
157700                                   TO DP013-MESSAGE-TEXT(1)       15770018
157800                 MOVE DK-PO-NBR  TO PV-ERROR-PO                   15780018
157900                 MOVE DK-REC-SEQ-NBR TO PV-ERROR-SEQ              15790018
158000                 MOVE DK-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      15800018
158100                 MOVE PV-ERROR-MSG   TO DP013-MESSAGE-TEXT (2)    15810018
158200                 MOVE SQLCA        TO DP013-SQLCA                 15820018
158300                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    15830018
158400                 SET DP013-DB2-ABEND                              15840018
158500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15850018
158600                 PERFORM DP013-0000-PROCESS-ABEND                 15860018
158700         END-EVALUATE                                             15870018
158800     END-PERFORM.                                                 15880018
158900                                                                  15890018
159000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15900018
159100         SQLCODE NOT = +0                                         15910018
159200         MOVE '8120-INSERT-TSHIPST'                               15920018
159300                                   TO DP013-PARAGRAPH             15930018
159400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              15940018
159500                                   TO DP013-MESSAGE-TEXT (1)      15950018
159600         MOVE 'TO INSERT A TSHIPST ROW'                           15960018
159700                                   TO DP013-MESSAGE-TEXT (2)      15970018
159800         MOVE SQLCA                TO DP013-SQLCA                 15980018
159900         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    15990018
160000         SET DP013-DB2-ABEND                                      16000018
160100             DP013-XCTL-DISPLAY-RESTART                           16010018
160200                                   TO TRUE                        16020018
160300         PERFORM DP013-0000-PROCESS-ABEND                         16030018
160400     END-IF.                                                      16040018
160500                                                                  16050018
160600                                                                  16060018
160700*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 16070018
160800 9100-READ-SEL-QUEUE.                                             16080018
160900     EXEC CICS                                                    16090018
161000         READQ TS                                                 16100018
161100             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        16110018
161200             INTO  (SU004-DC-SELECT-RECORD)                       16120018
161300             ITEM  (ASC-SEL-ITEM)                                 16130018
161400             RESP  (PV-CICS-RESP)                                 16140018
161500     END-EXEC.                                                    16150018
161600     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        16160018
161700         CONTINUE                                                 16170018
161800     ELSE                                                         16180018
161900         SET DP013-LOGIC-ABEND                                    16190018
162000             DP013-NO-ROLLBACK   TO   TRUE                        16200018
162100         MOVE '9100-READ-SEL-QUEUE'                               16210018
162200                                 TO   DP013-PARAGRAPH             16220018
162300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   16230018
162400                                 TO   DP013-MESSAGE-TEXT (1)      16240018
162500         PERFORM DP013-0000-PROCESS-ABEND                         16250018
162600     END-IF.                                                      16260018
162700                                                                  16270018
162800                                                                  16280018
162900*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*16290018
163000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *16300018
163100*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 16310018
163200 9200-REWRITE-SEL-QUEUE.                                          16320018
163300                                                                  16330018
163400     EXEC CICS                                                    16340018
163500          WRITEQ TS                                               16350018
163600              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      16360018
163700              FROM   (SU004-DC-SELECT-RECORD)                     16370018
163800              ITEM   (ASC-SEL-ITEM)                               16380018
163900              RESP   (PV-CICS-RESP)                               16390018
164000              REWRITE                                             16400018
164100     END-EXEC.                                                    16410018
164200                                                                  16420018
164300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   16430018
164400         SET DP013-CICS-ABEND                                     16440018
164500             DP013-NO-ROLLBACK     TO TRUE                        16450018
164600         MOVE '9200-REWRITE-SEL-QUEUE'                            16460018
164700                                   TO DP013-PARAGRAPH             16470018
164800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   16480018
164900                                   TO DP013-MESSAGE-TEXT (1)      16490018
165000         PERFORM DP013-0000-PROCESS-ABEND                         16500018
165100     END-IF.                                                      16510018
165200                                                                  16520018
165300                                                                  16530018
165400******************************************************************16540018
165500 9900-WRITE-CICS-LOG.                                             16550018
165600                                                                  16560018
165700     MOVE LENGTH OF PV-CICS-MSG-AREA                              16570018
165800          TO PV-COMMAREA-LENGTH                                   16580018
165900                                                                  16590018
166000     EXEC CICS                                                    16600018
166100         WRITEQ TD                                                16610018
166200             QUEUE  ('CSSL')                                      16620018
166300             FROM   (PV-CICS-MSG-AREA)                            16630018
166400             LENGTH (PV-COMMAREA-LENGTH)                          16640018
166500             RESP   (PV-CICS-RESPONSE)                            16650018
166600     END-EXEC.                                                    16660018
166700                                                                  16670018
166800     MOVE SPACES TO PV-CICS-MSG-AREA.                             16680018
166900                                                                  16690018
167000*----------------------------------------------------------------*16700018
167100*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *16710018
167200*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *16720018
167300*----------------------------------------------------------------*16730018
167400*9900A-SOFT-ABORT.                                                16740018
167500*                                                                 16750018
167600*    EXEC CICS SYNCPOINT                                          16760018
167700*         ROLLBACK                                                16770018
167800*    END-EXEC.                                                    16780018
167900*                                                                 16790018
168000*    SET  PS-ERROR                                                16800018
168100*         PS-SOFT-ABORT-ERROR                                     16810018
168200*         DP020-MSG-FATAL       TO  TRUE.                         16820018
168300                                                                  16830018
168400*   DEAD CODE 1/24/2005                                           16840018
168500*9999-WRITE-MESSAGE-TO-CICS-LOG.                                  16850018
168600*                                                                 16860018
168700*    MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           16870018
168800*    MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          16880018
168900*    INITIALIZE DP013-SRC-TASK-NUMBER                             16890018
169000*               DP013-STACK.                                      16900018
169100*    SET DP013-LINK-RETURN            TO TRUE.                    16910018
169200*                                                                 16920018
169300*    EXEC CICS                                                    16930018
169400*        LINK                                                     16940018
169500*            PROGRAM   (DP013-NAME)                               16950018
169600*            COMMAREA  (DP013-PARAMETERS)                         16960018
169700*            LENGTH    (DP013-LENGTH)                             16970018
169800*    END-EXEC.                                                    16980018
169900/                                                                 16990018
170000*----------------------------------------------------------------*17000018
170100*    ABEND PROCESSOR MODULE                                      *17010018
170200*----------------------------------------------------------------*17020018
170300                                                                  17030018
170400     COPY DPPD013.                                                17040018
170500                                                                  17050018
