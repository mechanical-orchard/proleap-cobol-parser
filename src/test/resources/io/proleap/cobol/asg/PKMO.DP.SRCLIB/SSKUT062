000300*---------------------------------------------------------------  00010005
000400 IDENTIFICATION DIVISION.                                         00020002
000500*---------------------------------------------------------------  00030005
000600 PROGRAM-ID.         SSKUT062.                                    00040088
000700 AUTHOR.             JOE GARDETTO.                                00050087
000800 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00060002
000900 DATE-WRITTEN        OCTOBER 2012.                                00070087
001000 DATE-COMPILED.                                                   00080002
001100                                                                  00090002
001200*---------------------------------------------------------------  00100005
001300* THIS PROGRAM CREATES A COMMA DELIMITED FILE THAT WILL BE FTP'D  00110005
001400* TO STEPHANIE LORELLO (STORE ADMINISTRATION) AT THE END OF EACH  00120087
001500* FISCAL MONTH. THE FILE WILL CONTAIN E-COMMERCE RETURN DOLLERS   00130089
001600* PER DAY FOR THE FISCAL MONTH.                                   00140089
001800*---------------------------------------------------------------  00160005
001900                                                                  00170005
002000*---------------------------------------------------------------  00180005
002100* HISTORY LOG:                                                    00190005
002200*                                                                 00200005
002300* DATE: 10/04/12                                                  00210089
002400* WR/IR#: WR41350                                                 00220089
002500* PROGRAMMER: JOE GARDETTO                                        00230089
002600* DESCRIPTION: NEW PROGRAM                                        00240005
002200*                                                                 00241083
002700*---------------------------------------------------------------  00250005
003000 ENVIRONMENT DIVISION.                                            00280002
003200 CONFIGURATION SECTION.                                           00300002
003300 SOURCE-COMPUTER.    IBM-3090.                                    00320002
003400 OBJECT-COMPUTER.    IBM-3090.                                    00330002
003500                                                                  00340002
003600 INPUT-OUTPUT SECTION.                                            00350002
003800 FILE-CONTROL.                                                    00370002
003900                                                                  00380002
004000     SELECT FISCAL-MONTH-INPUT-FILE                               00390002
004100         ASSIGN TO INP01.                                         00400002
004200                                                                  00410002
004300     SELECT ECOMM-RETURN-EXTRACT-FILE                             00431089
004400         ASSIGN TO OUT01.                                         00432089
004500                                                                  00440002
004600*---------------------------------------------------------------  00450006
004700 DATA DIVISION.                                                   00460002
004900 FILE SECTION.                                                    00480002
005000                                                                  00490002
005100 FD  FISCAL-MONTH-INPUT-FILE                                      00500002
005200     RECORDING MODE IS F                                          00510002
005300     RECORD CONTAINS 80 CHARACTERS                                00520002
005400     LABEL RECORDS ARE STANDARD                                   00530002
005500     BLOCK CONTAINS 0 RECORDS.                                    00540002
005600                                                                  00550002
005700 01  FISCAL-MONTH-INPUT-RECORD   PIC X(80).                       00560014
005800                                                                  00570002
005900 FD  ECOMM-RETURN-EXTRACT-FILE                                    00580089
006000     RECORDING MODE IS F                                          00590002
006100     RECORD CONTAINS 80 CHARACTERS                                00600099
006200     LABEL RECORDS ARE STANDARD                                   00610002
006300     BLOCK CONTAINS 0  RECORDS.                                   00620002
006400                                                                  00630002
006500 01  ECOMM-RETURN-EXTRACT-RECORD PIC X(80).                       00641099
006600                                                                  00650002
006700*---------------------------------------------------------------  00660006
006800 WORKING-STORAGE SECTION.                                         00670002
006900*---------------------------------------------------------------  00680006
007000 01  AC-ABEND-CODE               PIC   S9(04) VALUE +0            00690021
007100                                              COMP SYNC.          00700021
007200     88  AC-CURSOR-OPEN                       VALUE +4001.        00710021
007300     88  AC-CURSOR-CLOSE                      VALUE +4002.        00720021
007400     88  AC-CURSOR-FETCH                      VALUE +4003.        00730021
007500     88  AC-INVALID-CONTROL-CARD              VALUE +4004.        00740021
007600     88  AC-CALENDAR-ROUTINE-ERROR            VALUE +4005.        00750021
007700     88  AC-FILE-SEQUENCE-ERROR               VALUE +4007.        00760021
007800     88  AC-DB2-ERROR                         VALUE +4013.        00770021
007900                                                                  00780002
008000*------------------------------------------------                 00790006
008100* ECOMM RETURN HEADER RECORD - OUTPUT                             00801089
008200*------------------------------------------------                 00810006
008300 01  ERT-COLUMN-HEADINGS.                                         00820189
008400     05  COLUMN-1                PIC  X(07)   VALUE               00820289
008400           'COUNTS,'.                                             00820389
008400     05  COLUMN-2                PIC  X(19)   VALUE               00821189
008400           'SUM(NET_CHRGD_AMT),'.                                 00821289
008400     05  COLUMN-3                PIC  X(06)   VALUE               00821399
008400           'STORE,'.                                              00821499
008400     05  COLUMN-4                PIC  X(07)   VALUE               00821599
008400           'SLS_DTE'.                                             00821699
008400     05  COLUMN-5                PIC  X(16)   VALUE               00821799
008400           '                '.                                    00821899
007900                                                                  00822681
008000*------------------------------------------------                 00822781
008100* ECOMM RETURN EXTRACT RECORD LAYOUT - OUTPUT                     00823089
008200*------------------------------------------------                 00824079
010100                                                                  01020007
008300 01  ERT-ECOMM-RETURN-EXTRACT.                                    01021089
009200     05  ERT-ITM-COUNT           PIC  9(8)    VALUE ZEROES.       01022093
008900     05  FILLER                  PIC  X(1)    VALUE ','.          01027089
009400     05  ERT-TOT-RETURN-AMT      PIC -999999999.99                01027189
009400                                              VALUE ZEROES.       01027289
009100     05  FILLER                  PIC  X(1)    VALUE ','.          01027389
008800     05  ERT-STORE-NBR           PIC  X(4)    VALUE SPACES.       01027499
009100     05  FILLER                  PIC  X(1)    VALUE ','.          01027599
008800     05  ERT-SALES-DATE          PIC  X(10)   VALUE SPACES.       01027699
010100                                                                  01030289
010200*---------------------------------------------------------------  01031089
010300* LAYOUT FOR THE INPUT FILE THAT INDICATES WHETHER OR NOT IT IS   01040006
010400* THE FISCAL MONTH END                                            01050006
010500*---------------------------------------------------------------  01060006
010600 01  FISCAL-MONTH-CONTROL-AREA.                                   01070002
010700     05  FM-CONTROL-DATE         PIC  X(10)   VALUE SPACES.       01080021
010800     05  FM-CURRENT-DATE         PIC  X(10)   VALUE SPACES.       01090021
010900     05  FM-LAST-WEEK-IND        PIC  X(01)   VALUE SPACES.       01100021
011000         88  FM-LAST-FISCAL-WEEK              VALUE 'Y'.          01110021
011200     05  FILLER                  PIC  X(59)   VALUE SPACES.       01130021
011300                                                                  01140002
011400*------------------------------------------------                 01150006
011500* PC- PROGRAM CONSTANTS                                           01160006
011600*------------------------------------------------                 01170006
011700 01  PC-PROGRAM-CONSTANTS.                                        01180006
011800     05  PC-PROGRAM-NAME         PIC  X(8)    VALUE 'SSKUT062'.   01190088
011900     05  PC-ROW-NOT-FOUND        PIC S9(04)   VALUE +100          01200021
012000                                              COMP SYNC.          01210021
012100                                                                  01240002
012200*------------------------------------------------                 01250006
012300* PS- PROGRAM SWITCHES                                            01260006
012400*------------------------------------------------                 01270006
012500 01  PS-PROGRAM-SWITCHES.                                         01280002
012600     05  PS-END-OF-ECOMM-CURSOR-SW   PIC X  VALUE 'N'.            01290090
012700         88 PS-END-OF-ECOMM-CURSOR          VALUE 'Y'.            01300090
012800     05  PS-END-OF-FISCAL-FILE-SW    PIC X  VALUE 'N'.            01310021
012900         88 PS-END-OF-FISCAL-FILE           VALUE 'Y'.            01320021
013000                                                                  01330006
013100*------------------------------------------------                 01340007
013200* PV- PROGRAM VARIABLES                                           01350007
013300*------------------------------------------------                 01360007
013400 01  PV-PROGRAM-VARIABLES.                                        01370007
013500     05  PV-RECORDS-WRITTEN          PIC S9(7)    VALUE +0 COMP-3.01380007
013600     05  PV-ECOMM-CURSOR-COUNT       PIC S9(7)    VALUE +0 COMP-3.01390090
013700     05  PV-START-DATE               PIC X(10).                   01400021
013800     05  PV-END-DATE                 PIC X(10).                   01410021
013900     05  PV-PARAGRAPH-NAME           PIC X(30)    VALUE SPACES.   01420021
014000     05  PV-OPERATION-MSG-1          PIC X(40)    VALUE SPACES.   01430021
014100     05  PV-OPERATION-MSG-2          PIC X(40)    VALUE SPACES.   01440021
014200     05  PV-DB2-OPERATION            PIC X(30)    VALUE SPACES.   01450021
014900     05  PV-EPITM-TRN-COUNT          PIC 9(10)    VALUE ZEROES.   01530099
015100     05  PV-EPITM-TOTAL-SALES        PIC S9(12)V99 VALUE ZEROES.  01550099
014200     05  PV-EPTRN-STR-NBR            PIC X(4)     VALUE SPACES.   01551099
014200     05  PV-EPTRN-SLS-DTE            PIC X(10)    VALUE SPACES.   01551199
015200     05  PV-EDIT-MASK                PIC Z,ZZZ,ZZ9.               01560022
019100     05  EPITM-TRN-NBR2              PIC S9(5) COMP.              01931099
019100     05  EPITM-NET-CHRGD-AMT2        PIC S9(9)V9(2) COMP-3.       01932099
019100                                                                  01933099
019100                                                                  01934099
019200*-----------------------------------------------------            01940020
019300* PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)              01950007
019400*-----------------------------------------------------            01960007
019500     COPY DPWS500.                                                01970002
019600                                                                  01980002
019700*-----------------------------------------------------            01990007
019800* WS FIELDS FOR SQLCA MESSAGE ROUTINE (DPPD004)                   02000007
019900*-----------------------------------------------------            02010007
020000     COPY DPWS004.                                                02020002
020100                                                                  02030002
020200*-----------------------------------------------------            02040007
020300* DB2 COMMUNICATION AREA                                          02050007
020400*-----------------------------------------------------            02060007
020500     EXEC SQL                                                     02070002
020600          INCLUDE SQLCA                                           02080002
020700     END-EXEC.                                                    02090002
020800                                                                  02100007
020900*-----------------------------------------------------            02110009
021000* DB2 TABLE DB2PDBA.TEPPART - PARTITION TABLE                     02120009
021100*-----------------------------------------------------            02130009
021200     EXEC SQL                                                     02140002
021300          INCLUDE TEPPART                                         02150009
021400     END-EXEC.                                                    02160002
022200                                                                  02240009
021600*-----------------------------------------------------            02241092
021700* DB2 TABLE DB2PDBA.TEPTRN - TRANSACTION TABLE                    02242092
021800*-----------------------------------------------------            02243092
021900     EXEC SQL                                                     02244092
022000          INCLUDE TEPTRN                                          02245092
022100     END-EXEC.                                                    02246092
022200                                                                  02247092
022300*-----------------------------------------------------            02250009
022400* DB2 TABLE DB2PDBA.TEPITM - ITEM TABLE                           02260092
022500*-----------------------------------------------------            02270009
022600     EXEC SQL                                                     02280009
022700          INCLUDE TEPITM                                          02290092
022800     END-EXEC.                                                    02300009
022200                                                                  02301092
022300*-----------------------------------------------------            02302092
022400* DB2 TABLE DB2PDBA.TEPIRT - ITEM RETURN INFORMATION TABLE        02303092
022500*-----------------------------------------------------            02303192
022600     EXEC SQL                                                     02303292
022700          INCLUDE TEPIRT                                          02303392
022800     END-EXEC.                                                    02303492
022900                                                                  02310009
023000*-----------------------------------------------------            02320009
023100* DB2 TABLE DB2PDBA.XST_LOC - LOCATION TABLE                      02330009
023200*-----------------------------------------------------            02340009
023300     EXEC SQL                                                     02350009
023400          INCLUDE XST00001                                        02360012
023500     END-EXEC.                                                    02370009
023600                                                                  02380009
023700*---------------------------------------------------------------  02390012
023800* ECOMM-CURSOR --> FISCAL MONTHS RETURNS OF ECOMM AT B&M STORES   02400090
024000*---------------------------------------------------------------  02420012
024100     EXEC SQL                                                     02430002
024200       DECLARE ECOMM-CURSOR CURSOR FOR                            02441089
               SELECT                                                   02442099
                 COUNT(ITM.TRN_NBR)                                     02443099
                ,SUM(ITM.NET_CHRGD_AMT)                                 02444099
                ,IRT.STR_NBR                                            02445099
                ,PRT.SLS_DTE                                            02446099
               FROM                                                     02447099
                 TEPPART PRT                                            02448099
                ,TEPTRN TRN                                             02449099
                ,TEPIRT IRT                                             02450099
                ,TEPITM ITM                                             02460099
                ,XST_LOC LOC1                                           02470099
                ,XST_LOC LOC2                                           02480099
               WHERE                                                    02490099
                    PRT.PARTN_NBR = TRN.PARTN_NBR                       02500099
                AND TRN.PARTN_NBR = IRT.PARTN_NBR                       02510099
                AND TRN.STR_NBR = IRT.STR_NBR                           02520099
                AND TRN.RGST_ID = IRT.RGST_ID                           02530099
                AND TRN.TRN_NBR = IRT.TRN_NBR                           02540099
                AND TRN.STRT_TM = IRT.STRT_TM                           02550099
                AND TRN.SLS_CORR_SEQ_NBR = IRT.SLS_CORR_SEQ_NBR         02560099
                AND TRN.PARTN_NBR = ITM.PARTN_NBR                       02570099
                AND TRN.STR_NBR = ITM.STR_NBR                           02580099
                AND TRN.RGST_ID = ITM.RGST_ID                           02590099
                AND TRN.TRN_NBR = ITM.TRN_NBR                           02600099
                AND TRN.STRT_TM = ITM.STRT_TM                           02610099
                AND TRN.SLS_CORR_SEQ_NBR = ITM.SLS_CORR_SEQ_NBR         02620099
                AND IRT.LNE_ITM_SEQ_NBR = ITM.LNE_ITM_SEQ_NBR           02630099
                AND TRN.STR_NBR = LOC1.LOC_NBR                          02640099
                AND IRT.ORIG_STR_NBR = LOC2.LOC_NBR                     02650099
                AND PRT.DB_STRUC_CDE = 'O'                              02660099
                AND PRT.SLS_DTE BETWEEN :PV-START-DATE AND :PV-END-DATE 02670099
                AND TRN.TRN_STAT_CDE IN ('V','Z','L')                   02680099
                AND TRN.VOID_ABRT_CDE = 'N'                             02690099
                AND ITM.LIV_RSLU_CDE IN ('+','-')                       02700099
                AND LOC1.E_BUS_IND = 'N'                                02710099
                AND LOC2.E_BUS_IND = 'Y'                                02720099
               GROUP BY                                                 02730099
                IRT.STR_NBR                                             02740099
                ,PRT.SLS_DTE                                            02750099
               WITH UR                                                  02760099
028400     END-EXEC.                                                    02830002
028500                                                                  02840012
028600*---------------------------------------------------------------  02853012
028700 PROCEDURE DIVISION.                                              02860002
028800*---------------------------------------------------------------  02870012
028900     PERFORM 1000-INITIALIZATION.                                 02880002
029000                                                                  02890002
029100     IF FM-LAST-FISCAL-WEEK                                       02900002
029200         PERFORM 2000-PROCESS-ECOMM-RTN-TOTALS                    02910090
029300             UNTIL PS-END-OF-ECOMM-CURSOR                         02920090
029500         PERFORM 8000-END-OF-JOB                                  02940021
029600     ELSE                                                         02950002
029700         DISPLAY 'WEEK ENDING DATE '                              02960002
029800                 FM-CONTROL-DATE                                  02970002
029900                 ' IS NOT THE LAST WEEK OF THE FISCAL MONTH'      02980002
030000         CLOSE FISCAL-MONTH-INPUT-FILE                            02990002
030100         CLOSE ECOMM-RETURN-EXTRACT-FILE                          03000090
030200         MOVE 4090 TO RETURN-CODE                                 03010017
030300     END-IF.                                                      03020002
030400                                                                  03030002
030500     STOP RUN.                                                    03040002
030600                                                                  03050014
030700*---------------------------------------------------------------  03060012
030800* INITIALIZATION ROUTINE, OPEN THE EXTRACT, ACCEPT THE CARD       03070012
030900* FROM SYSIN, PERFORM THE ROUTINE TO FIND THE FISCAL PERIOD AND   03080012
031000* PERFORM THE ROUTINE TO OPEN THE CURSOR                          03090021
031100*---------------------------------------------------------------  03100012
031200 1000-INITIALIZATION.                                             03110002
031300                                                                  03120002
031400     OPEN INPUT  FISCAL-MONTH-INPUT-FILE.                         03130012
031500     OPEN OUTPUT ECOMM-RETURN-EXTRACT-FILE.                       03140090
031600                                                                  03150002
031700     READ FISCAL-MONTH-INPUT-FILE                                 03160002
031800         INTO FISCAL-MONTH-CONTROL-AREA                           03170002
031900         AT END SET PS-END-OF-FISCAL-FILE                         03180002
032000                                    TO TRUE.                      03190017
032100     IF PS-END-OF-FISCAL-FILE                                     03200002
032200         MOVE '1000-INITIALIZATION'                               03210002
032300                                    TO PV-PARAGRAPH-NAME          03220017
032400         MOVE 'FISCAL MONTH CONTROL CARD IS EMPTY'                03230002
032500                                    TO PV-OPERATION-MSG-1         03240017
032600         SET AC-FILE-SEQUENCE-ERROR TO TRUE                       03250017
032700         PERFORM 9999-ABEND                                       03260002
032800     END-IF.                                                      03270002
032900                                                                  03280002
033000     IF FM-LAST-FISCAL-WEEK                                       03290002
104900         WRITE ECOMM-RETURN-EXTRACT-RECORD                        03291090
105000              FROM ERT-COLUMN-HEADINGS                            03292090
033100         PERFORM 1100-DATE-ROUTINE                                03300002
033200         PERFORM 1200-OPEN-ECOMM-CURSOR                           03310090
033300         PERFORM 2100-FETCH-ECOMM-CURSOR                          03320090
033400     END-IF.                                                      03330002
033500                                                                  03340002
033600*---------------------------------------------------------------  03350017
033700* INITIALIZE THE CALL PARAMETERS, SET THE DATE INDICATORS,        03360017
033800* MOVE THE YEAR AND PERIOD TO THE INPUT AREA, AND CALL THE        03370017
033900* ROUTINE AND CHECK FOR ERRORS.                                   03380017
034000*---------------------------------------------------------------  03390017
034100 1100-DATE-ROUTINE.                                               03400002
034200                                                                  03410002
034300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03420002
034400                                                                  03430002
034500     SET  DPG51-FISCAL-454-CALENDAR    TO TRUE.                   03440002
034600     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   03450002
034700     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   03460002
034800     MOVE FM-CONTROL-DATE              TO DPG52-LK-DATE-INPUT.    03470002
034900                                                                  03480002
035000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03490002
035100                                             DPG54 DPG55 DPG56.   03500002
035200     EVALUATE TRUE                                                03510002
035300         WHEN DPG54-SEVERE-ERROR                                  03520002
035400         WHEN DPG54-DATE-INVALID                                  03530002
035500             MOVE '1100-DATE-ROUTINE'                             03540002
035600                                       TO PV-PARAGRAPH-NAME       03550017
035700             MOVE 'ERROR CONVERTING INPUT CARD DATE'              03560002
035800                                       TO PV-OPERATION-MSG-1      03570017
035900             SET AC-CALENDAR-ROUTINE-ERROR                        03580017
036000                                       TO TRUE                    03590017
036100             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      03600017
036200             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      03610017
036300             PERFORM 9999-ABEND                                   03620002
036400     END-EVALUATE.                                                03630002
036500                                                                  03640002
036600     MOVE DPG56-FIRST-FP-DB2-ISO-FMT   TO PV-START-DATE           03650017
036700     MOVE DPG56-LAST-FP-DB2-ISO-FMT    TO PV-END-DATE.            03660017
036800                                                                  03670002
036900     DISPLAY 'PV-START-DATE - ' PV-START-DATE                     03680002
037000     DISPLAY 'PV-END-DATE --- ' PV-END-DATE.                      03690002
037100                                                                  03700002
037200*---------------------------------------------------------------  03710017
037300* OPEN ECOMM CURSOR AND CHECK FOR ERRORS                          03720090
037400*---------------------------------------------------------------  03730017
037500 1200-OPEN-ECOMM-CURSOR.                                          03740090
037600                                                                  03750002
037700     EXEC SQL                                                     03760002
037800          OPEN ECOMM-CURSOR                                       03770090
037900     END-EXEC.                                                    03780002
038000                                                                  03790002
038100     EVALUATE TRUE                                                03800002
038200         WHEN SQLCODE = ZERO                                      03810002
038300              CONTINUE                                            03820002
038400         WHEN SQLWARN0 NOT EQUAL SPACE                            03830002
038500         WHEN SQLCODE NOT EQUAL ZERO                              03840002
038600              MOVE '1200-OPEN-ECOMM-CURSOR'                       03850090
038700                                 TO PV-PARAGRAPH-NAME             03860017
038800              MOVE 'ERROR ON OPEN OF ECOMM-CURSOR'                03870090
038900                                 TO PV-DB2-OPERATION              03880017
039000              SET AC-CURSOR-OPEN TO TRUE                          03890017
039100              PERFORM 9800-SQL-ABEND                              03900017
039200     END-EVALUATE.                                                03910002
039300                                                                  03920002
039400*---------------------------------------------------------------  03930019
039600* WRITE ROW TO ECOMM-RETURN-EXTRACT-FILE; PERFORM FETCH TO GET    03950090
039700* ANOTHER ROW FROM THE CURSOR;                                    03960090
040000*---------------------------------------------------------------  03990019
040100 2000-PROCESS-ECOMM-RTN-TOTALS.                                   04000090
040200                                                                  04010002
040600*--> ECOM RETURN SALES FOR A GIVEN DAY                            04050093
040700                                                                  04060026
041400     MOVE PV-EPITM-TRN-COUNT     TO ERT-ITM-COUNT.                04081093
041600     MOVE PV-EPITM-TOTAL-SALES                                    04083296
041610                                 TO ERT-TOT-RETURN-AMT.           04084093
083420     MOVE PV-EPTRN-STR-NBR       TO ERT-STORE-NBR.                04084199
041600     MOVE PV-EPTRN-SLS-DTE       TO ERT-SALES-DATE.               04084299
                                                                        04084799
044900     PERFORM 9000-WRITE-EXTRACT-RECORDS.                          04085190
045100     MOVE ZEROES TO ERT-ITM-COUNT.                                04085293
                                                                        04085390
081800     PERFORM 2100-FETCH-ECOMM-CURSOR.                             04085490
                                                                        04086090
082000*FETCHHERE                                                        09010019
082100*---------------------------------------------------------------  09020016
082200* FETCH THE ECOMM CURSOR AND CHECK FOR ERRORS                     09030090
082300*---------------------------------------------------------------  09040016
082400 2100-FETCH-ECOMM-CURSOR.                                         09050090
082500                                                                  09090090
082600     EXEC SQL                                                     09100002
082700          FETCH ECOMM-CURSOR                                      09110090
                 INTO :EPITM-TRN-NBR2                                   09110199
                     ,:EPITM-NET-CHRGD-AMT2                             09110299
                     ,:EPTRN-STR-NBR                                    09110399
                     ,:EPTRN-SLS-DTE                                    09110499
083300     END-EXEC.                                                    09170002
                                                                        09189099
083430                                                                  09224099
083500     EVALUATE TRUE                                                09230002
083600         WHEN SQLCODE = ZERO                                      09240002
                   MOVE EPITM-TRN-NBR2    TO PV-EPITM-TRN-COUNT         09241099
                   MOVE EPITM-NET-CHRGD-AMT2                            09242099
                                          TO PV-EPITM-TOTAL-SALES       09242199
                   MOVE EPTRN-STR-NBR     TO PV-EPTRN-STR-NBR           09243099
                   MOVE EPTRN-SLS-DTE     TO PV-EPTRN-SLS-DTE           09244099
083700             ADD 1                  TO PV-ECOMM-CURSOR-COUNT      09250099
083800         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09260002
083900             SET PS-END-OF-ECOMM-CURSOR                           09270090
084000                                     TO TRUE                      09280021
084100         WHEN SQLWARN0 NOT EQUAL SPACE                            09290002
084200         WHEN SQLCODE NOT EQUAL ZERO                              09300002
084300             MOVE '2100-FETCH-ECOMM-CURSOR'                       09310090
084400                                     TO PV-PARAGRAPH-NAME         09320021
084500             MOVE SQLCODE            TO PV-DB2-OPERATION          09330021
084900             SET AC-CURSOR-FETCH     TO TRUE                      09360021
085000             PERFORM 9800-SQL-ABEND                               09370002
085100     END-EVALUATE.                                                09380002
098900                                                                  11140022
099000*---------------------------------------------------------------  11150021
099100* CLOSES FISCAL MONTH INPUT FILE, ECOMM RETURN EXTRACT FILE, AND  11160099
099200* ECOMM CURSOR                                                    11170099
099300*---------------------------------------------------------------  11180021
099400 8000-END-OF-JOB.                                                 11190002
100000     CLOSE FISCAL-MONTH-INPUT-FILE.                               11200002
100100     CLOSE ECOMM-RETURN-EXTRACT-FILE.                             11210090
100200                                                                  11220002
100300     PERFORM 8100-CLOSE-ECOMM-CURSOR.                             11230092
100400                                                                  11240002
100500     DISPLAY '****************************************'           11250002
100600     DISPLAY '*************** SSKUT062 ***************'           11260088
100700     DISPLAY '****************************************'           11270002
100800     MOVE PV-ECOMM-CURSOR-COUNT TO PV-EDIT-MASK                   11280090
100900     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          11290002
101000     DISPLAY 'RETURN COUNT ROWS FETCHED......'                    11301099
101100         PV-EDIT-MASK                                             11310002
101200     MOVE PV-RECORDS-WRITTEN     TO PV-EDIT-MASK                  11320002
101300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          11330002
101400     DISPLAY 'EXTRACT RECORDS WRITTEN........'                    11340002
101500         PV-EDIT-MASK                                             11350002
101600     DISPLAY '****************************************'           11360002
101700     DISPLAY '****************************************'           11370002
101800     DISPLAY '****************************************'.          11380002
101900                                                                  11390002
102000     MOVE ZERO                   TO RETURN-CODE.                  11400017
102100                                                                  11410017
102200*---------------------------------------------------------------  11420021
102300* CLOSE THE ECOMM CURSOR AND CHECK FOR ERRORS                     11430092
102400*---------------------------------------------------------------  11440021
102500 8100-CLOSE-ECOMM-CURSOR.                                         11450092
102600                                                                  11460002
102700     EXEC SQL                                                     11470002
102800          CLOSE ECOMM-CURSOR                                      11480092
102900     END-EXEC.                                                    11490002
103000                                                                  11500002
103100     EVALUATE TRUE                                                11510002
103200         WHEN SQLCODE = ZERO                                      11520002
103300              CONTINUE                                            11530002
103400         WHEN SQLWARN0 NOT EQUAL SPACE                            11540002
103500         WHEN SQLCODE NOT EQUAL ZERO                              11550002
103600             MOVE '8100-CLOSE-ECOMM-CURSOR'                       11560092
103700                                 TO PV-PARAGRAPH-NAME             11570002
103800             MOVE 'ERROR ON CLOSE OF ECOMM-CURSOR'                11580092
103900                                 TO PV-DB2-OPERATION              11590002
104000             SET AC-CURSOR-CLOSE TO TRUE                          11600002
104100             PERFORM 9800-SQL-ABEND                               11610002
104200     END-EVALUATE.                                                11620002
104300                                                                  11630019
104400*---------------------------------------------------------------  11640019
104500* THIS MODULE WRITES THE OUTPUT FILE RECORD                       11650019
104600*---------------------------------------------------------------  11660019
104700 9000-WRITE-EXTRACT-RECORDS.                                      11670002
104800                                                                  11680002
104900     WRITE ECOMM-RETURN-EXTRACT-RECORD                            11690090
105000         FROM ERT-ECOMM-RETURN-EXTRACT.                           11700090
105100                                                                  11710002
105200     ADD 1 TO PV-RECORDS-WRITTEN.                                 11720019
105300                                                                  11730002
105400*---------------------------------------------------------------  11740013
105500* 9800-SQL-ABEND                                                  11750013
105600* ABEND PROGRAM WHEN A WARNING OR SQL ERROR CODE OCCURS           11760021
105700*---------------------------------------------------------------  11770013
105800 9800-SQL-ABEND.                                                  11780002
105900     DISPLAY '** ABEND     **'.                                   11790002
106000     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                11800007
106100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11810002
106200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               11820002
106600                                                                  11850002
106700     COPY DPPD004.                                                11860002
106800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         11870002
106900                                                                  11880002
107000*---------------------------------------------------------------  11890013
107100* 9999-ABEND                                                      11900002
107200* ABEND PROGRAM WHEN AN ERROR OCCURS                              11910021
107300*---------------------------------------------------------------  11920013
107400 9999-ABEND.                                                      11930002
107500     DISPLAY '** ABEND     **'.                                   11940013
107600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                11950013
107700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11960013
107800     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG-1.             11970013
107900     DISPLAY '**           ** = ' PV-OPERATION-MSG-2.             11980013
108000                                                                  11990013
108100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12000013
108200                                                                  12010015
