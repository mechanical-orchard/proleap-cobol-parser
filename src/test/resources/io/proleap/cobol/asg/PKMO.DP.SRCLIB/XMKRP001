000400***************************************************************** 00040000
000500 IDENTIFICATION DIVISION.                                         00050000
000600***************************************************************** 00060000
000700                                                                  00070000
000800 PROGRAM-ID.             XMKRP001.                                00080000
000900 AUTHOR.                 PAUL KEBER.                              00090000
001000 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00100000
001100 DATE-WRITTEN            APRIL 13, 2004.                          00110000
001200 DATE-COMPILED.                                                   00120000
001300                                                                  00130000
001400***************************************************************** 00131001
001500*    XMKRP001 - DEPARTMENT STORES LISTED BY DISTRICT REPORT PGM   00132001
001400***************************************************************** 00140000
001500*    THIS PROGRAM IS PART OF LOCATION MAINTENANCE (XM).           00150000
001600*    IT ACCESSES THE XMT_LOC AND XMT_DIST DB2 TABLES IN ORDER     00160000
001700*    TO CREATE A REPORT OF ALL STORES WITHIN EACH DISTRICT,       00170000
001800*    PLUS ALL DISTRIBUTION CENTERS, WAREHOUSES AND HEADQUARTERS.  00180000
001900***************************************************************** 00190000
002000/                                                                 00200000
002100*                                                                 00210000
002200*                                                                 00220000
002300***************************************************************** 00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500***************************************************************** 00250000
002600*                                                                 00260000
002700*                                                                 00270000
002800 CONFIGURATION SECTION.                                           00280000
002900                                                                  00290000
003000 SOURCE-COMPUTER.        IBM-3090.                                00300000
003100 OBJECT-COMPUTER.        IBM-3090.                                00310000
003200*                                                                 00320000
003300*                                                                 00330000
003400 INPUT-OUTPUT SECTION.                                            00340000
003500                                                                  00350000
003600 FILE-CONTROL.                                                    00360000
003700                                                                  00370000
004100     SELECT OUT-STORE-DISTRICT-RPT                                00410000
004200         ASSIGN TO RPT01.                                         00420000
004300/                                                                 00430000
004400*                                                                 00440000
004500   EJECT                                                          00450000
004600******************************************************************00460000
004700 DATA DIVISION.                                                   00470000
004800******************************************************************00480000
004900*                                                                 00490000
005000*                                                                 00500000
005100 FILE SECTION.                                                    00510000
005200                                                                  00520000
006000 FD  OUT-STORE-DISTRICT-RPT                                       00600000
006100     RECORDING MODE IS F                                          00610000
006200     LABEL RECORDS ARE STANDARD                                   00620000
006300     BLOCK CONTAINS 0 RECORDS.                                    00630000
006400                                                                  00640000
006500 01  OUT-STORE-DISTRICT-RECORD   PIC X(132).                      00650000
006600/                                                                 00660000
006700*                                                                 00670000
006800*                                                                 00680000
006900   EJECT                                                          00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100 01  FILLER                           PIC X(47)      VALUE        00710000
007200     'BEGINNING WORKING STORAGE FOR PROGRAM: XMKRP001'.           00720000
007300                                                                  00730000
007400 01  ABEND-CODE                       PIC S9(04)     VALUE +0     00740000
007500                                                     COMP SYNC.   00750000
007600     88  ABEND-4002                                  VALUE 4002.  00760000
007700     88  ABEND-4013                                  VALUE 4013.  00770000
007800                                                                  00780000
007900 01  PC-PROGRAM-CONSTANTS.                                        00790000
008000     05  PC-MAX-RETRIES               PIC S9(3) COMP-3 VALUE +3.  00800000
008100                                                                  00810000
008200 01  PV-PROGRAM-VARIABLES.                                        00820000
008300     05  PV-SQL-DST-SUB               PIC S9(4) COMP VALUE +0.    00830000
008400     05  PV-SQL-STR-SUB               PIC S9(4) COMP VALUE +0.    00840000
           05  PV-PHN-NBR-NULL-IND          PIC S9(4) COMP VALUE +0.    00841007
008500     05  PV-SELECT-TYPE               PIC X(02)      VALUE SPACES.00850000
008600     05  PV-1ST-TIME-THRU-SW          PIC X(01)      VALUE 'N'.   00860000
008700         88  PV-1ST-TIME-THRU                        VALUE 'Y'.   00870000
008800     05  PV-DISTRICT-NBR              PIC S9(4) COMP-3 VALUE +3.  00880001
008900     05  PV-MGR-STORE-NBR             PIC X(03)      VALUE SPACES.00890000
009000     05  PV-PAGE-COUNT                PIC S9(05)     VALUE ZEROS. 00900000
009100     05  PV-LINE-COUNT                PIC S9(03)     VALUE +0.    00910000
009200     05  PV-RPT-PRGM-ID               PIC X(08)      VALUE        00920000
009300         'XMKRP001'.                                              00930000
009400     05  PV-RPT-NUMBER                PIC X(01)      VALUE '1'.   00940000
009500*    ****** ABEND FIELDS ******                                   00950000
009600     05  PV-PARAGRAPH-NAME            PIC X(30)      VALUE SPACES.00960000
009700     05  PV-DB2-OPER-ATTEMPTED        PIC X(30)      VALUE SPACES.00970000
009800                                                                  00980000
009900 01  PS-PROGRAM-SWITCHES.                                         00990000
010200     05  PS-PROCESSED-STORE-RECS      PIC X(01)      VALUE 'N'.   01020000
010300         88  PS-ALL-STORE-RECS-PROCESSED             VALUE 'Y'.   01030000
010400     05  PS-REPORT-DONE-SW            PIC X(01)      VALUE 'N'.   01040000
010500         88  PS-REPORT-DONE                          VALUE 'Y'.   01050000
010600                                                                  01060000
010700 01  WS-MISC-VARIABLES.                                           01070000
010800                                                                  01080000
010900     05  WS-SYSTEM-DATE               PIC X(08).                  01090000
011800     05  WS-ISO-OPENED-DATE.                                      01100000
011900         10  WS-OPENED-DATE-CC        PIC 9(02)      VALUE ZEROS. 01110000
012000         10  WS-OPENED-DATE-YY        PIC 9(02)      VALUE ZEROS. 01120000
012100         10  FILLER                   PIC X(01)      VALUE '/'.   01130000
012200         10  WS-OPENED-DATE-MM        PIC 9(02)      VALUE ZEROS. 01140000
012300         10  FILLER                   PIC X(01)      VALUE '/'.   01150000
012400         10  WS-OPENED-DATE-DD        PIC 9(02)      VALUE ZEROS. 01160000
012500     05  WS-OPEN-DATE.                                            01170000
012600         10  WS-OPEN-DTE-CC           PIC 9(02)      VALUE ZEROS. 01180000
012610         10  WS-OPEN-DTE-YY           PIC 9(02)      VALUE ZEROS. 01190000
012700         10  WS-OPEN-DTE-MM           PIC 9(02)      VALUE ZEROS. 01200000
012800         10  WS-OPEN-DTE-DD           PIC 9(02)      VALUE ZEROS. 01210000
012900                                                                  01220000
013400     05  WS-PHONE-REFORMAT            PIC X(26)      VALUE SPACES.01270002
013500     05  FILLER REDEFINES WS-PHONE-REFORMAT.                      01280002
013700         10  WS-PHONE-AREA            PIC X(03).                  01300002
013800         10  WS-PHONE-REST            PIC X(23).                  01310002
013800         10  WS-PHONE-REST-1 REDEFINES WS-PHONE-REST.             01310102
013800             15  WS-PHONE-1ST3-1      PIC X(03).                  01311002
013900             15  WS-PHONE-LST4-1      PIC X(04).                  01320002
014300             15  FILLER               PIC X(16).                  01321002
013800         10  WS-PHONE-REST-2 REDEFINES WS-PHONE-REST.             01322002
014300             15  WS-PHONE-HYPHEN1-2   PIC X(1).                   01322102
013800             15  WS-PHONE-1ST3-2      PIC X(03).                  01323002
014300             15  WS-PHONE-HYPHEN2-2   PIC X(1).                   01323102
013900             15  WS-PHONE-LST4-2      PIC X(04).                  01324002
014300             15  FILLER               PIC X(14).                  01325002
013800         10  WS-PHONE-REST-3 REDEFINES WS-PHONE-REST.             01326002
014300             15  FILLER               PIC X(4).                   01326102
013900             15  WS-PHONE-LST4-3      PIC X(04).                  01329102
014300             15  FILLER               PIC X(15).                  01329202
014000                                                                  01330000
014900   EJECT                                                          01420000
015000******************************************************************01430000
015100*    ** STANDARD 132 BYTE KOHL'S REPORT HEADER RECORD             01440000
015200******************************************************************01450000
015300*                                                                 01460000
015400     COPY DPWS132O.                                               01470000
015500                                                                  01480000
015600   EJECT                                                          01490000
015700******************************************************************01500000
015800*    ** REPORT RECORD LAYOUTS                                     01510000
015900******************************************************************01520000
016000*                                                                 01530000
016100 01  RPT-HEADER-LINE-2.                                           01540000
016700     05  FILLER                       PIC X(48)      VALUE SPACES.01600008
016800     05  RPT-REPORT-TITLE             PIC X(36)      VALUE        01610000
016900         'DEPARTMENT STORES LISTED BY DISTRICT'.                  01620000
017000     05  FILLER                       PIC X(48)      VALUE SPACES.01630000
017100*                                                                 01640000
017200 01  RPT-TITLE-LINE-1.                                            01650000
017300     05  FILLER                       PIC X(02)      VALUE SPACES.01660000
017400     05  FILLER                       PIC X(06)      VALUE        01670000
017500         'FUTURE'.                                                01680000
017600     05  FILLER                       PIC X(05)      VALUE SPACES.01690000
017700     05  FILLER                       PIC X(05)      VALUE        01700003
017500         'STORE'.                                                 01701003
017800     05  FILLER                       PIC X(29)      VALUE SPACES.01710005
018100     05  FILLER                       PIC X(02)      VALUE '05'.  01740000
018200     05  FILLER                       PIC X(62)      VALUE SPACES.01750005
018300     05  FILLER                       PIC X(03)      VALUE 'ZIP'. 01760000
018400     05  FILLER                       PIC X(18)      VALUE SPACES.01770004
018500*                                                                 01780000
018600 01  RPT-TITLE-LINE-2.                                            01790000
018700     05  FILLER                       PIC X(02)      VALUE SPACES.01800000
018800     05  FILLER                       PIC X(09)      VALUE        01810000
018900         'OPEN DATE'.                                             01820000
019000     05  FILLER                       PIC X(02)      VALUE SPACES.01830000
019100     05  FILLER                       PIC X(03)      VALUE 'NO.'. 01840000
019200     05  FILLER                       PIC X(04)      VALUE SPACES.01850003
019300     05  FILLER                       PIC X(10)      VALUE        01860000
019400         'STORE NAME'.                                            01870000
019500     05  FILLER                       PIC X(17)      VALUE SPACES.01880003
019800     05  FILLER                       PIC X(04)      VALUE 'CHAR'.01910000
019900     05  FILLER                       PIC X(03)      VALUE SPACES.01920000
020000     05  FILLER                       PIC X(07)      VALUE        01930000
020100         'ADDRESS'.                                               01940000
020200     05  FILLER                       PIC X(25)      VALUE SPACES.01950003
020300     05  FILLER                       PIC X(12)      VALUE        01960000
020400         'CITY / STATE'.                                          01970000
020500     05  FILLER                       PIC X(13)      VALUE SPACES.01980004
020600     05  FILLER                       PIC X(04)      VALUE 'CODE'.01990000
020700     05  FILLER                       PIC X(03)      VALUE SPACES.02000004
020800     05  FILLER                       PIC X(14)      VALUE        02010000
020900         'AREA  PHONE # '.                                        02020000
021100*                                                                 02040000
021200 01  RPT-TITLE-LINE-3.                                            02050000
021300     05  FILLER                       PIC X(02)      VALUE SPACES.02060000
021400     05  FILLER                       PIC X(09)      VALUE        02070000
021500         '---------'.                                             02080000
021700     05  FILLER                       PIC X(02)      VALUE SPACES.02100000
021800     05  FILLER                       PIC X(05)      VALUE        02110003
021900         '-----'.                                                 02120003
022100     05  FILLER                       PIC X(02)      VALUE SPACES.02140000
022200     05  FILLER                       PIC X(25)      VALUE        02150000
022300         '-------------------------'.                             02160000
022500     05  FILLER                       PIC X(02)      VALUE SPACES.02180000
023000     05  FILLER                       PIC X(05)      VALUE        02230000
023100         '-----'.                                                 02240000
023300     05  FILLER                       PIC X(02)      VALUE SPACES.02260000
023400     05  FILLER                       PIC X(30)      VALUE        02270003
023500         '------------------------------'.                        02280003
023700     05  FILLER                       PIC X(02)      VALUE SPACES.02300000
023800     05  FILLER                       PIC X(23)      VALUE        02310003
023900         '-----------------------'.                               02320003
024100     05  FILLER                       PIC X(02)      VALUE SPACES.02340000
024200     05  FILLER                       PIC X(05)      VALUE        02350003
024300         '-----'.                                                 02360003
024500     05  FILLER                       PIC X(02)      VALUE SPACES.02380000
024600     05  FILLER                       PIC X(14)      VALUE        02390000
024700         '--------------'.                                        02400000
025000*                                                                 02430000
025100 01  RPT-DISTRICT-LINE.                                           02440000
025200     05  FILLER                       PIC X(11)      VALUE SPACES.02450000
025300     05  FILLER                       PIC X(10)      VALUE        02460000
025400         'DISTRICT: '.                                            02470000
025500     05  RPT-DISTRICT-NBR             PIC 9(04)      VALUE ZERO.  02480002
025600     05  FILLER                       PIC X(02)      VALUE SPACES.02490000
025700     05  RPT-DISTRICT-NAME            PIC X(20)      VALUE SPACES.02500002
025800     05  FILLER                       PIC X(02)      VALUE SPACES.02510000
025900     05  FILLER                       PIC X(09)      VALUE        02520000
026000         'MANAGER: '.                                             02530000
026100     05  RPT-MANAGER-NAME             PIC X(32)      VALUE SPACES.02540002
026200     05  FILLER                       PIC X(42)      VALUE SPACES.02550002
026700*                                                                 02600000
026800 01  RPT-DETAIL-LINE.                                             02610000
026900     05  FILLER                       PIC X(02)      VALUE SPACES.02620000
027000     05  RPT-FUTURE-OPEN-DATE.                                    02630000
027100         10  RPT-FUTURE-OPEN-MM       PIC X(02)      VALUE SPACES.02640000
027200         10  RPT-SLASH1               PIC X(01)      VALUE '/'.   02650000
027300         10  RPT-FUTURE-OPEN-DD       PIC X(02)      VALUE SPACES.02660000
027400         10  RPT-SLASH2               PIC X(01)      VALUE '/'.   02670000
027500         10  RPT-FUTURE-OPEN-CC       PIC X(02)      VALUE SPACES.02680000
027600         10  RPT-FUTURE-OPEN-YY       PIC X(02)      VALUE SPACES.02690000
027700     05  FILLER                       PIC X(01)      VALUE SPACE. 02700000
027800     05  RPT-STORE-NMBR               PIC 9(05)      VALUE ZEROS. 02710002
027900     05  FILLER                       PIC X(02)      VALUE SPACES.02720000
028000     05  RPT-STORE-NAME               PIC X(25)      VALUE SPACES.02730000
028100     05  FILLER                       PIC X(02)      VALUE SPACES.02740000
028400     05  RPT-5-CHAR-NAME              PIC X(05)      VALUE SPACES.02770000
028500     05  FILLER                       PIC X(02)      VALUE SPACES.02780000
028600     05  RPT-ADDRESS-1                PIC X(30)      VALUE SPACES.02790002
028700     05  FILLER                       PIC X(02)      VALUE SPACES.02800000
028800     05  RPT-CITY                     PIC X(20)      VALUE SPACES.02810002
028900     05  FILLER                       PIC X(01)      VALUE SPACE. 02820000
029000     05  RPT-STATE                    PIC X(02)      VALUE SPACES.02830000
029100     05  FILLER                       PIC X(02)      VALUE SPACE. 02840004
029200     05  RPT-ZIP-CODE                 PIC X(05)      VALUE SPACES.02850000
029300     05  FILLER                       PIC X(02)      VALUE SPACES.02860000
029400     05  RPT-PHONE.                                               02870000
029500         10  FILLER                   PIC X(01)      VALUE '('.   02880000
029600         10  RPT-AREA-CODE            PIC X(03)      VALUE SPACES.02890000
029700         10  FILLER                   PIC X(01)      VALUE ')'.   02900000
029800         10  FILLER                   PIC X(01)      VALUE SPACE. 02910000
029900         10  RPT-PHONE-1ST3           PIC X(03)      VALUE SPACES.02920002
030000         10  FILLER                   PIC X(01)      VALUE '-'.   02930000
030100         10  RPT-PHONE-LAST4          PIC X(04)      VALUE SPACES.02940002
030300*                                                                 02960000
030400 01  RPT-DISTRIBUTION-LINE.                                       02970000
030500     05  FILLER                       PIC X(11)      VALUE SPACES.02980000
030600     05  FILLER                       PIC X(21)      VALUE        02990000
030700         'DISTRIBUTION CENTERS:'.                                 03000000
030800     05  FILLER                       PIC X(100)     VALUE SPACES.03010000
030900*                                                                 03020000
031000 01  RPT-CSTOCK-LINE.                                             03030000
031100     05  FILLER                       PIC X(11)      VALUE SPACES.03040000
031200     05  FILLER                       PIC X(24)      VALUE        03050000
031300         'CENTRAL STOCK LOCATIONS:'.                              03060000
031400     05  FILLER                       PIC X(097)     VALUE SPACES.03070000
031500*                                                                 03080000
031600 01  RPT-RETURN-TO-VENDOR-LINE.                                   03090000
031700     05  FILLER                       PIC X(11)      VALUE SPACES.03100000
031800     05  FILLER                       PIC X(27)      VALUE        03110000
031900         'RETURN TO VENDOR LOCATIONS:'.                           03120000
032000     05  FILLER                       PIC X(094)     VALUE SPACES.03130000
032100*                                                                 03140000
032200 01  RPT-HEADQUARTERS-LINE.                                       03150000
032300     05  FILLER                       PIC X(11)      VALUE SPACES.03160000
032400     05  FILLER                       PIC X(13)      VALUE        03170000
032500         'HEADQUARTERS:'.                                         03180000
032600     05  FILLER                       PIC X(108)     VALUE SPACES.03190000
032700*                                                                 03200000
032800 01  RPT-DEBIT-ALLOWANCES-LINE.                                   03210000
032900     05  FILLER                       PIC X(11)      VALUE SPACES.03220000
033000     05  FILLER                       PIC X(17)      VALUE        03230000
033100         'DEBIT ALLOWANCES:'.                                     03240000
033200     05  FILLER                       PIC X(104)     VALUE SPACES.03250000
033300*                                                                 03260000
033400/                                                                 03270000
033500*                                                                 03280000
033600*                                                                 03290000
033700   EJECT                                                          03300000
033800******************************************************************03310000
033900*                                                                *03320000
034000*    DB2  I/O  AREA:                                             *03330000
034100*                                                                *03340000
034200******************************************************************03350000
034300*                                                                 03360000
034400*----------------------------------------*                        03370000
034500*    DCLGEN FOR THE XMT_LOC TABLE        *                        03380001
034600*----------------------------------------*                        03390000
034700*                                                                 03400000
034800     EXEC SQL                                                     03410000
034900         INCLUDE XMT00001                                         03420001
035000     END-EXEC.                                                    03430000
035100*                                                                 03440000
035200*----------------------------------------*                        03450000
034500*    DCLGEN FOR THE XMT_DIST TABLE       *                        03451001
035400*----------------------------------------*                        03470000
035500*                                                                 03480000
035600     EXEC SQL                                                     03490000
035700         INCLUDE XMT00006                                         03500001
035800     END-EXEC.                                                    03510000
035900*                                                                 03520000
036000******************************************************************03530000
036100*    SQL COMMUNICATIONS AREA DCLGEN                              *03540000
036200******************************************************************03550000
036300*                                                                 03560000
036400     COPY SQLCA2.                                                 03570000
036500*                                                                 03580000
036600     EXEC SQL                                                     03590000
036700         INCLUDE SQLCA                                            03600000
036800     END-EXEC.                                                    03610000
036900*                                                                 03620000
037000******************************************************************03630000
037100*    DB2 ERROR MESSAGE AREA                                      *03640000
037200******************************************************************03650000
037300*                                                                 03660000
037400     COPY DPWS004.                                                03670000
037500*                                                                 03680000
037600   EJECT                                                          03690000
037700******************************************************************03700000
037800*    DB2 CURSOR DECLARATIONS                                     *03710000
037900******************************************************************03720000
038000*                                                                 03730000
038100     EXEC SQL                                                     03740000
038200         DECLARE DISTRICT-RECS CURSOR FOR                         03750006
038300         SELECT                                                   03760006
038400                 DIST_NBR                                         03770006
038500               , DIST_NM                                          03780006
038600               , DIST_MGR_NM                                      03790006
038800         FROM                                                     03810000
038900                XMT_DIST                                          03820006
039000         ORDER BY DIST_NBR                                        03830006
039100                                                                  03840006
039200     END-EXEC.                                                    03850000
039300*                                                                 03860000
039400*                                                                 03870000
039500     EXEC SQL                                                     03880000
039600         DECLARE STORE-RECS CURSOR FOR                            03890006
039700         SELECT                                                   03900006
039800                 LOC_NBR                                          03910006
039900               , LOC_NM                                           03920006
040100               , LOC_5_ABBR_NM                                    03940006
040200               , LNE_1_ADDR                                       03950006
040300               , CTY_NM                                           03960006
040400               , ST_CDE                                           03970006
040500               , ZIP_10_CDE                                       03980006
040600               , PHN_NBR                                          03990006
040700               , OPN_DTE                                          04000006
040800         FROM                                                     04010000
040900                XMT_LOC                                           04020006
041100         WHERE  LOC_TYP_CDE = :PV-SELECT-TYPE                     04040006
041200           AND ( (DIST_NBR = :PV-DISTRICT-NBR                     04050006
                        AND LOC_TYP_CDE = 'DS')                         04051006
                      OR (DIST_NBR IS NULL AND LOC_TYP_CDE <> 'DS'))    04052006
041300           AND  CLO_DTE >= DATE(CURRENT TIMESTAMP)                04060006
041400         ORDER BY LOC_NBR                                         04070006
041500                                                                  04080006
041600     END-EXEC.                                                    04090000
041700*                                                                 04100000
041800   EJECT                                                          04110000
041900******************************************************************04120000
042000*  THE FOLLOWING SIGNIFIES THE END OF THE WORKING STORAGE SECTION 04130000
042100******************************************************************04140000
042200*                                                                 04150000
042300 01  FILLER                           PIC X(44)      VALUE        04160000
042400     'END OF WORKING STORAGE FOR PROGRAM: XMKRP001'.              04170000
042500/                                                                 04180000
042600*                                                                 04190000
042700   EJECT                                                          04200000
042800*                                                                 04210000
042900******************************************************************04220000
043000 PROCEDURE DIVISION.                                              04230000
043100******************************************************************04240000
043200                                                                  04250000
043300******************************************************************04260000
043400*    START OF 'A' PARAGRAPHS                                     *04270000
043500******************************************************************04280000
043600                                                                  04290000
043700******************************************************************04300000
043800* A100-MAINLINE                                                  *04310000
043900*     CONTROLS THE FLOW OF THE PROGRAM.                          *04320000
044000*     PERFORMS HOUSEKEEPING OF ONE TIME ONLY PROCESSED ITEMS.    *04330000
044100*     PERFORMS PROCESS OF DATA UNTIL                             *04340000
044200*     ALL RECORDS FROM THE DB2 STORE TABLE HAVE BEEN PROCESSED.  *04350000
044300*     PERFORMS CLOSING OF ALL DATASETS REFERENCED.               *04360000
044400******************************************************************04370000
044500 A100-MAINLINE.                                                   04380000
044600     MOVE 'A100-MAINLINE' TO PV-PARAGRAPH-NAME.                   04390000
044700                                                                  04400000
044800     PERFORM B100-HOUSEKEEPING.                                   04410000
044900     PERFORM B200-PROCESS-DATA                                    04420000
045000     UNTIL   PS-ALL-STORE-RECS-PROCESSED.                         04430000
045100     PERFORM B800-CLOSE-DATASETS.                                 04440000
045200     GOBACK.                                                      04450000
045300/                                                                 04460000
045400*                                                                 04470000
045500   EJECT                                                          04480000
045600******************************************************************04490000
045700*    START OF 'B' PARAGRAPHS                                     *04500000
045800******************************************************************04510000
045900                                                                  04520000
046000******************************************************************04530000
046100* B100-HOUSEKEEPING                                              *04540000
046200*     OPENS ALL INPUT AND OUTPUT DATASETS TO BE REFERENCED.      *04550000
046300*     PERFORMS A READ OF THE CONTROL FILE RECORD TO RETRIEVE     *04560000
046400*       THE BETA93 RECIPIENT ID FOR THE REPORT.                  *04570000
046500*     PERFORMS ONE TIME REPORT DATE/TIME LOAD.                   *04580000
046600*                                                                *04590000
046700*     PERFORMED BY A100-MAINLINE                                 *04600000
046800******************************************************************04610000
046900 B100-HOUSEKEEPING.                                               04620000
047000     MOVE 'B100-HOUSEKEEPING' TO PV-PARAGRAPH-NAME.               04630000
047100                                                                  04640000
047300     OPEN OUTPUT   OUT-STORE-DISTRICT-RPT.                        04660008
047400                                                                  04670000
049001     MOVE FUNCTION CURRENT-DATE (3:2) TO DP132O-RUN-YEAR.         04840000
049002     MOVE FUNCTION CURRENT-DATE (5:2) TO DP132O-RUN-MONTH.        04850000
049003     MOVE FUNCTION CURRENT-DATE (7:2) TO DP132O-RUN-DAY.          04860000
049004     MOVE FUNCTION CURRENT-DATE (9:2) TO DP132O-RUN-HOUR.         04870000
049010     MOVE FUNCTION CURRENT-DATE (11:2) TO DP132O-RUN-MINUTE.      04880000
049900                                                                  04890000
050000     MOVE  PV-RPT-PRGM-ID TO DP132O-PROGRAM-NAME.                 04900000
050100     MOVE  PV-RPT-NUMBER  TO DP132O-REPORT-NUMBER.                04910000
050200/                                                                 04920000
050300*                                                                 04930000
050400******************************************************************04940000
050500* B200-PROCESS-DATA                                              *04950000
050600*     INTIALIZES PAGE COUNT FIELD.                               *04960000
050700*     PERFORMS REPORT HEADER LOGIC.                              *04970000
050800*     PERFORMS OPEN OF DISTRICT CURSOR.                          *04980000
050900*     PERFORMS REPORT PROCESSING FOR STORE RECORDS.              *04990000
051000*     PERFORMS CLOSE OF DEISTRICT CURSOR.                        *05000000
051100*                                                                *05010000
051200*     PERFORMED BY A100-MAINLINE                                 *05020000
051300******************************************************************05030000
051400 B200-PROCESS-DATA.                                               05040000
051500     MOVE 'B200-PROCESS-DATA' TO PV-PARAGRAPH-NAME.               05050000
051600                                                                  05060000
051700     MOVE 0  TO  PV-PAGE-COUNT.                                   05070000
051800     PERFORM U100-CREATE-RPT-HDRS.                                05080000
051900                                                                  05090000
052000     PERFORM C100-OPEN-DISTRICT-CURSOR.                           05100000
052100                                                                  05110000
052200     PERFORM C200-CREATE-REPORT                                   05120000
052300       UNTIL PS-REPORT-DONE.                                      05130000
052400                                                                  05140000
052500     PERFORM C300-CLOSE-DISTRICT-CURSOR.                          05150000
052600     MOVE 'Y' TO PS-PROCESSED-STORE-RECS.                         05160000
052700/                                                                 05170000
052800*                                                                 05180000
052900******************************************************************05190000
053000* B800-CLOSE-DATASETS                                            *05200000
053100*     CLOSES INPUT AND OUTPUT DATASETS.                          *05210000
053200*                                                                *05220000
053300*     PERFORMED BY A100-MAINLINE                                 *05230000
053400******************************************************************05240000
053500 B800-CLOSE-DATASETS.                                             05250000
053600     MOVE 'B800-CLOSE-DATASETS' TO PV-PARAGRAPH-NAME.             05260000
053700                                                                  05270000
053900     CLOSE  OUT-STORE-DISTRICT-RPT.                               05290008
054000/                                                                 05300000
054100*                                                                 05310000
054200   EJECT                                                          05320000
054300******************************************************************05330000
054400*    START OF 'C' PARAGRAPHS                                     *05340000
054500******************************************************************05350000
054600                                                                  05360000
054700******************************************************************05370000
054800* C100-OPEN-DISTRICT-CURSOR                                      *05380000
054900*     HERE WE ONLY OPEN THE CURSOR.                              *05390000
055000*                                                                *05400000
055100*     PERFORMED BY B200-PROCESS-DATA                             *05410000
055200******************************************************************05420000
055300 C100-OPEN-DISTRICT-CURSOR.                                       05430000
055400     MOVE 'C100-OPEN-DISTRICT-CURSOR' TO PV-PARAGRAPH-NAME.       05440000
055500                                                                  05450000
055600     PERFORM                                                      05460000
055700         WITH TEST AFTER                                          05470000
055800         VARYING PV-SQL-DST-SUB                                   05480000
055900         FROM 1 BY 1                                              05490000
056000         UNTIL ( PV-SQL-DST-SUB > PC-MAX-RETRIES                  05500000
056100                 OR SQLCODE = 0                                   05510000
056200                 OR SQLCODE = +100 )                              05520000
056300                                                                  05530000
056400         EXEC SQL                                                 05540000
056500             OPEN DISTRICT-RECS                                   05550000
056600         END-EXEC                                                 05560000
056700                                                                  05570000
056800         EVALUATE TRUE                                            05580000
056900             WHEN SQLCODE = -904                                  05590000
057000             WHEN SQLCODE = -911                                  05600000
057100             WHEN SQLCODE = +100                                  05610000
057200             WHEN SQLCODE = 0                                     05620000
057300                 CONTINUE                                         05630000
057400             WHEN SQLWARN NOT = SPACES                            05640000
057500             WHEN SQLCODE NOT = ZERO                              05650000
057600                 MOVE 'C100-OPEN-DISTRICT-CURSOR'                 05660000
057700                                 TO PV-PARAGRAPH-NAME             05670000
057800                 MOVE 'OPEN DISTRICT-RECS CURSOR'                 05680000
057900                                 TO PV-DB2-OPER-ATTEMPTED         05690000
058000                 PERFORM X999-SQL-ABEND                           05700000
058100         END-EVALUATE                                             05710000
058200                                                                  05720000
058300     END-PERFORM.                                                 05730000
058400                                                                  05740000
058500     IF  PV-SQL-DST-SUB > PC-MAX-RETRIES                          05750000
058600           MOVE 'C100-OPEN-DISTRICT-CURSOR'                       05760000
058700                         TO PV-PARAGRAPH-NAME                     05770000
058800           MOVE 'OPEN DISTRICT RETRIES EXCEEDED'                  05780000
058900                         TO PV-DB2-OPER-ATTEMPTED                 05790000
059000           PERFORM X999-SQL-ABEND                                 05800000
059100     END-IF.                                                      05810000
059200/                                                                 05820000
059300*                                                                 05830000
059400******************************************************************05840000
059500* C200-CREATE-REPORT                                             *05850000
059600*    CREATES STORE DETAIL UNTIL SQLCODE NOT EQUAL ZERO.          *05860000
059700*    ** NOTE ** 'OP' (OPERATING COMPANY) NOT REPORTED            *05870000
059800*                                                                *05880000
059900*     PERFORMED BY B200-PROCESS-DATA                             *05890000
060000******************************************************************05900000
060100 C200-CREATE-REPORT.                                              05910000
060200     MOVE 'C200-CREATE-REPORT' TO PV-PARAGRAPH-NAME.              05920000
060300                                                                  05930000
060400     PERFORM D100-FETCH-DISTRICT-CURSOR.                          05940000
060500                                                                  05950000
060600     IF  PV-LINE-COUNT > 60                                       05960000
060700          MOVE +0 TO PV-LINE-COUNT                                05970000
060800          PERFORM U100-CREATE-RPT-HDRS.                           05980000
060900                                                                  05990000
061000     IF SQLCODE EQUAL ZERO                                        06000000
061100          PERFORM D200-CREATE-DISTRICT-DETAIL                     06010000
061200          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06020000
061300          MOVE XMT00006-DIST-NBR TO PV-DISTRICT-NBR               06030001
061400          MOVE 'DS' TO PV-SELECT-TYPE                             06040000
061500          PERFORM D300-CREATE-STORE-DETAILS                       06050000
061600                                                                  06060000
061700     ELSE                                                         06070000
061800     IF SQLCODE EQUAL +100                                        06080000
061900          MOVE 0 TO PV-DISTRICT-NBR                               06090001
062000                                                                  06100000
062100          IF  PV-LINE-COUNT > 50                                  06110000
062200*             ** IF THERE IS NOT ROOM ENOUGH FOR THE 3 OTHER   ** 06120000
062300*             ** LOCALES (DC,WH,HQ) PLUS 1 LINE OF DETAIL EACH ** 06130000
062400              MOVE +0 TO PV-LINE-COUNT                            06140000
062500              PERFORM U100-CREATE-RPT-HDRS                        06150000
062600          END-IF                                                  06160000
062700                                                                  06170000
062800          MOVE 'DC' TO PV-SELECT-TYPE                             06180000
062900          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06190000
063000          PERFORM D300-CREATE-STORE-DETAILS                       06200000
063100                                                                  06210000
063200          MOVE 'CS' TO PV-SELECT-TYPE                             06220000
063300          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06230000
063400          PERFORM D300-CREATE-STORE-DETAILS                       06240000
063500                                                                  06250000
063600          MOVE 'RV' TO PV-SELECT-TYPE                             06260000
063700          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06270000
063800          PERFORM D300-CREATE-STORE-DETAILS                       06280000
063900                                                                  06290000
064000          MOVE 'HQ' TO PV-SELECT-TYPE                             06300000
064100          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06310000
064200          PERFORM D300-CREATE-STORE-DETAILS                       06320000
064300                                                                  06330000
064400          MOVE 'DA' TO PV-SELECT-TYPE                             06340000
064500          MOVE 'Y' TO PV-1ST-TIME-THRU-SW                         06350000
064600          PERFORM D300-CREATE-STORE-DETAILS                       06360000
064700                                                                  06370000
064800*         ** NOTE: 'OP' NOT PROCESSED FOR REPORT **               06380000
064900                                                                  06390000
065000          MOVE 'Y' TO PS-REPORT-DONE-SW                           06400000
065100                                                                  06410000
065200     END-IF.                                                      06420000
065300/                                                                 06430000
065400*                                                                 06440000
065500******************************************************************06450000
065600* C300-CLOSE-DISTRICT-CURSOR                                     *06460000
065700*     HERE WE ONLY CLOSE THE CURSOR.                             *06470000
065800*                                                                *06480000
065900*     PERFORMED BY B200-PROCESS-DATA                             *06490000
066000******************************************************************06500000
066100  C300-CLOSE-DISTRICT-CURSOR.                                     06510000
066200     MOVE 'C300-CLOSE-DISTRICT-CURSOR' TO PV-PARAGRAPH-NAME.      06520000
066300                                                                  06530000
066400     PERFORM                                                      06540000
066500         WITH TEST AFTER                                          06550000
066600         VARYING PV-SQL-DST-SUB                                   06560000
066700         FROM 1 BY 1                                              06570000
066800         UNTIL ( PV-SQL-DST-SUB > PC-MAX-RETRIES                  06580000
066900                 OR SQLCODE = 0 )                                 06590000
067000                                                                  06600000
067100         EXEC SQL                                                 06610000
067200             CLOSE DISTRICT-RECS                                  06620000
067300         END-EXEC                                                 06630000
067400                                                                  06640000
067500         EVALUATE TRUE                                            06650000
067600             WHEN SQLCODE = -904                                  06660000
067700             WHEN SQLCODE = -911                                  06670000
067800             WHEN SQLCODE = 0                                     06680000
067900                 CONTINUE                                         06690000
068000             WHEN SQLWARN NOT = SPACES                            06700000
068100             WHEN SQLCODE NOT = ZERO                              06710000
068200                 MOVE 'C300-CLOSE-DISTRICT-CURSOR'                06720000
068300                                 TO PV-PARAGRAPH-NAME             06730000
068400                 MOVE 'CLOSE DISTRICT-RECS CURSOR'                06740000
068500                                 TO PV-DB2-OPER-ATTEMPTED         06750000
068600                 PERFORM X999-SQL-ABEND                           06760000
068700         END-EVALUATE                                             06770000
068800                                                                  06780000
068900     END-PERFORM.                                                 06790000
069000                                                                  06800000
069100     IF  PV-SQL-DST-SUB > PC-MAX-RETRIES                          06810000
069200           MOVE 'C300-CLOSE-DISTRICT-CURSOR'                      06820000
069300                         TO PV-PARAGRAPH-NAME                     06830000
069400           MOVE 'CLOSE DISTRICT RETRIES EXCEEDED'                 06840000
069500                         TO PV-DB2-OPER-ATTEMPTED                 06850000
069600           PERFORM X999-SQL-ABEND                                 06860000
069700     END-IF.                                                      06870000
069800/                                                                 06880000
069900*                                                                 06890000
070000   EJECT                                                          06900000
070100******************************************************************06910000
070200* D100-FETCH-DISTRICT-CURSOR                                     *06920000
070300*     THIS PARAGRAPH RETRIEVES THE DISTRICT ROWS.                *06930000
070400*                                                                *06940000
070500*     PERFORMED BY C200-CREATE-REPORT                            *06950000
070600******************************************************************06960000
070700 D100-FETCH-DISTRICT-CURSOR.                                      06970000
070800     MOVE 'D100-FETCH-DISTRICT-CURSOR' TO PV-PARAGRAPH-NAME.      06980000
070900                                                                  06990000
071000     PERFORM                                                      07000000
071100         WITH TEST AFTER                                          07010000
071200         VARYING PV-SQL-DST-SUB                                   07020000
071300         FROM 1 BY 1                                              07030000
071400         UNTIL ( PV-SQL-DST-SUB > PC-MAX-RETRIES                  07040000
071500                 OR SQLCODE = 0                                   07050000
071600                 OR SQLCODE = +100 )                              07060000
071700                                                                  07070000
071800         EXEC SQL                                                 07080000
071900             FETCH                                                07090000
072000                   DISTRICT-RECS                                  07100000
072100              INTO                                                07110000
072200                   :XMT00006-DIST-NBR                             07120001
072300                 , :XMT00006-DIST-NM                              07130001
072400                 , :XMT00006-DIST-MGR-NM                          07140001
072600         END-EXEC                                                 07160000
072700                                                                  07170000
072800         EVALUATE TRUE                                            07180000
072900             WHEN SQLCODE = -904                                  07190000
073000             WHEN SQLCODE = -911                                  07200000
073100             WHEN SQLCODE = +100                                  07210000
073200             WHEN SQLCODE = 0                                     07220000
073300                 CONTINUE                                         07230000
073400             WHEN SQLWARN NOT = SPACES                            07240000
073500             WHEN SQLCODE NOT = ZERO                              07250000
073600                 MOVE 'D100-FETCH-DISTRICT-CURSOR'                07260000
073700                                 TO PV-PARAGRAPH-NAME             07270000
073800                 MOVE 'FETCH DISTRICT-RECS CURSOR'                07280000
073900                                 TO PV-DB2-OPER-ATTEMPTED         07290000
074000                 PERFORM X999-SQL-ABEND                           07300000
074100         END-EVALUATE                                             07310000
074200                                                                  07320000
074300     END-PERFORM.                                                 07330000
074400                                                                  07340000
074500     IF  PV-SQL-DST-SUB > PC-MAX-RETRIES                          07350000
074600           MOVE 'D100-FETCH-DISTRICT-CURSOR'                      07360000
074700                         TO PV-PARAGRAPH-NAME                     07370000
074800           MOVE 'FETCH DISTRICT RETRIES EXCEEDED'                 07380000
074900                         TO PV-DB2-OPER-ATTEMPTED                 07390000
075000           PERFORM X999-SQL-ABEND                                 07400000
075100     END-IF.                                                      07410000
075200/                                                                 07420000
075300*                                                                 07430000
075400******************************************************************07440000
075500* D200-CREATE-DISTRICT-DETAIL                                    *07450000
075600*                                                                *07460000
075700*     PERFORMED BY C200-CREATE-REPORT                            *07470000
075800******************************************************************07480000
075900 D200-CREATE-DISTRICT-DETAIL.                                     07490000
076000     MOVE 'D200-CREATE-DISTRICT-DETAIL' TO PV-PARAGRAPH-NAME.     07500000
076100                                                                  07510000
081500     MOVE XMT00006-DIST-NBR    TO  RPT-DISTRICT-NBR.              08050001
081600     MOVE XMT00006-DIST-NM     TO  RPT-DISTRICT-NAME.             08060001
081700     MOVE XMT00006-DIST-MGR-NM TO  RPT-MANAGER-NAME.              08070001
081800                                                                  08080000
081900     IF  PV-LINE-COUNT > 60                                       08090000
082000          MOVE +0 TO PV-LINE-COUNT                                08100000
082100          PERFORM U100-CREATE-RPT-HDRS                            08110000
082200     END-IF.                                                      08120000
082300                                                                  08130000
082400     WRITE OUT-STORE-DISTRICT-RECORD                              08140000
082500     FROM  RPT-DISTRICT-LINE                                      08150000
082600     AFTER ADVANCING 1 LINES.                                     08160000
082700     ADD +1 TO PV-LINE-COUNT.                                     08170000
082800/                                                                 08180000
082900*                                                                 08190000
083000******************************************************************08200000
083100* D300-CREATE-STORE-DETAILS                                      *08210000
083200*   * PERFORMS OPEN STORE CURSOR.                                *08220000
083300*   * PROCESSES STORE DETAIL FOR REPORT.                         *08230000
083400*   * PERFORMS CLOSE STORE CURSOR.                               *08240000
083500*                                                                *08250000
083600*     PERFORMED BY C200-CREATE-REPORT                            *08260000
083700******************************************************************08270000
083800 D300-CREATE-STORE-DETAILS.                                       08280000
083900     MOVE 'D300-CREATE-STORE-DETAILS' TO PV-PARAGRAPH-NAME.       08290000
084000                                                                  08300000
084100      PERFORM E100-OPEN-STORE-CURSOR.                             08310000
084200                                                                  08320000
084300      PERFORM E200-WRITE-STORE-DETAIL                             08330000
084400*     ** UNITL NO MORE RECORDS TO SELECT **                       08340000
084500      UNTIL   SQLCODE EQUAL +100.                                 08350000
084600                                                                  08360000
084700      PERFORM E300-CLOSE-STORE-CURSOR.                            08370000
084800/                                                                 08380000
084900*                                                                 08390000
085000   EJECT                                                          08400000
085100******************************************************************08410000
085200* E100-OPEN-STORE-CURSOR                                         *08420000
085300*     HERE WE ONLY OPEN THE CURSOR.                              *08430000
085400*                                                                *08440000
085500*     PERFORMED BY D300-CREATE-STORE-DETAILS                     *08450000
085600******************************************************************08460000
085700 E100-OPEN-STORE-CURSOR.                                          08470000
085800     MOVE 'E100-OPEN-STORE-CURSOR' TO PV-PARAGRAPH-NAME.          08480000
085900                                                                  08490000
086000     PERFORM                                                      08500000
086100         WITH TEST AFTER                                          08510000
086200         VARYING PV-SQL-DST-SUB                                   08520000
086300         FROM 1 BY 1                                              08530000
086400         UNTIL ( PV-SQL-DST-SUB > PC-MAX-RETRIES                  08540000
086500                 OR SQLCODE = 0                                   08550000
086600                 OR SQLCODE = +100 )                              08560000
086700                                                                  08570000
086800         EXEC SQL                                                 08580000
086900             OPEN STORE-RECS                                      08590000
087000         END-EXEC                                                 08600000
087100                                                                  08610000
087200         EVALUATE TRUE                                            08620000
087300             WHEN SQLCODE = -904                                  08630000
087400             WHEN SQLCODE = -911                                  08640000
087500             WHEN SQLCODE = +100                                  08650000
087600             WHEN SQLCODE = 0                                     08660000
087700                 CONTINUE                                         08670000
087800             WHEN SQLWARN NOT = SPACES                            08680000
087900             WHEN SQLCODE NOT = ZERO                              08690000
088000                 MOVE 'E100-OPEN-STORE-CURSOR'                    08700000
088100                                 TO PV-PARAGRAPH-NAME             08710000
088200                 MOVE 'OPEN STORE-RECS CURSOR'                    08720000
088300                                 TO PV-DB2-OPER-ATTEMPTED         08730000
088400                 PERFORM X999-SQL-ABEND                           08740000
088500         END-EVALUATE                                             08750000
088600                                                                  08760000
088700     END-PERFORM.                                                 08770000
088800                                                                  08780000
088900     IF  PV-SQL-STR-SUB > PC-MAX-RETRIES                          08790000
089000           MOVE 'E100-OPEN-STORE-CURSOR'                          08800000
089100                         TO PV-PARAGRAPH-NAME                     08810000
089200           MOVE 'OPEN STORE RETRIES EXCEEDED'                     08820000
089300                         TO PV-DB2-OPER-ATTEMPTED                 08830000
089400           PERFORM X999-SQL-ABEND                                 08840000
089500     END-IF.                                                      08850000
089600/                                                                 08860000
089700*                                                                 08870000
089800******************************************************************08880000
089900* E200-WRITE-STORE-DETAIL                                        *08890000
090000*   * DEFINES LIMITING VARIABLES FOR STORE CURSOR.               *08900000
090100*                                                                *08910000
090200*     PERFORMED BY D300-CREATE-STORE-DETAILS                     *08920000
090300******************************************************************08930000
090400 E200-WRITE-STORE-DETAIL.                                         08940000
090500     MOVE 'E200-WRITE-STORE-DETAIL' TO PV-PARAGRAPH-NAME.         08950000
090600                                                                  08960000
090700     PERFORM F100-FETCH-STORE-CURSOR.                             08970000
090800                                                                  08980000
090900     IF SQLCODE EQUAL +100                                        08990000
091000*         ** NO MORE ROWS TO RETIEVE **                           09000000
091100          MOVE 'N' TO PV-1ST-TIME-THRU-SW                         09010000
091200     ELSE                                                         09020000
091300          IF PV-1ST-TIME-THRU                                     09030000
091400               MOVE 'N' TO PV-1ST-TIME-THRU-SW                    09040000
091500                                                                  09050000
091600               IF PV-SELECT-TYPE = 'DC'                           09060000
091700                    WRITE OUT-STORE-DISTRICT-RECORD               09070000
091800                          FROM  RPT-DISTRIBUTION-LINE             09080000
091900                          AFTER ADVANCING 2 LINES                 09090000
092000                    ADD +2 TO PV-LINE-COUNT                       09100000
092100               END-IF                                             09110000
092200               IF PV-SELECT-TYPE = 'CS'                           09120000
092300                    WRITE OUT-STORE-DISTRICT-RECORD               09130000
092400                          FROM  RPT-CSTOCK-LINE                   09140000
092500                          AFTER ADVANCING 2 LINES                 09150000
092600                    ADD +2 TO PV-LINE-COUNT                       09160000
092700               END-IF                                             09170000
092800               IF PV-SELECT-TYPE = 'RV'                           09180000
092900                    WRITE OUT-STORE-DISTRICT-RECORD               09190000
093000                          FROM  RPT-RETURN-TO-VENDOR-LINE         09200000
093100                          AFTER ADVANCING 2 LINES                 09210000
093200                    ADD +2 TO PV-LINE-COUNT                       09220000
093300               END-IF                                             09230000
093400               IF PV-SELECT-TYPE = 'HQ'                           09240000
093500                    WRITE OUT-STORE-DISTRICT-RECORD               09250000
093600                          FROM  RPT-HEADQUARTERS-LINE             09260000
093700                          AFTER ADVANCING 2 LINES                 09270000
093800                    ADD +2 TO PV-LINE-COUNT                       09280000
093900               END-IF                                             09290000
094000               IF PV-SELECT-TYPE = 'DA'                           09300000
094100                    WRITE OUT-STORE-DISTRICT-RECORD               09310000
094200                          FROM  RPT-DEBIT-ALLOWANCES-LINE         09320000
094300                          AFTER ADVANCING 2 LINES                 09330000
094400                    ADD +2 TO PV-LINE-COUNT                       09340000
094500               END-IF                                             09350000
094600                                                                  09360000
094700          END-IF                                                  09370000
094800                                                                  09380000
094900          PERFORM F200-FORMAT-STORE-DETAIL                        09390000
095000                                                                  09400000
095100     END-IF.                                                      09410000
095200/                                                                 09420000
095300*                                                                 09430000
095400******************************************************************09440000
095500* E300-CLOSE-STORE-CURSOR                                        *09450000
095600*                                                                *09460000
095700*     PERFORMED BY D300-CREATE-STORE-DETAILS                     *09470000
095800******************************************************************09480000
095900 E300-CLOSE-STORE-CURSOR.                                         09490000
096000     MOVE 'E300-CLOSE-STORE-CURSOR' TO PV-PARAGRAPH-NAME.         09500000
096100                                                                  09510000
096200     PERFORM                                                      09520000
096300         WITH TEST AFTER                                          09530000
096400         VARYING PV-SQL-DST-SUB                                   09540000
096500         FROM 1 BY 1                                              09550000
096600         UNTIL ( PV-SQL-DST-SUB > PC-MAX-RETRIES                  09560000
096700                 OR SQLCODE = 0 )                                 09570000
096800                                                                  09580000
096900         EXEC SQL                                                 09590000
097000             CLOSE STORE-RECS                                     09600000
097100         END-EXEC                                                 09610000
097200                                                                  09620000
097300         EVALUATE TRUE                                            09630000
097400             WHEN SQLCODE = -904                                  09640000
097500             WHEN SQLCODE = -911                                  09650000
097600             WHEN SQLCODE = 0                                     09660000
097700                 CONTINUE                                         09670000
097800             WHEN SQLWARN NOT = SPACES                            09680000
097900             WHEN SQLCODE NOT = ZERO                              09690000
098000                 MOVE 'E300-CLOSE-STORE-CURSOR'                   09700000
098100                                 TO PV-PARAGRAPH-NAME             09710000
098200                 MOVE 'CLOSE STORE-RECS CURSOR'                   09720000
098300                                 TO PV-DB2-OPER-ATTEMPTED         09730000
098400                 PERFORM X999-SQL-ABEND                           09740000
098500         END-EVALUATE                                             09750000
098600                                                                  09760000
098700     END-PERFORM.                                                 09770000
098800                                                                  09780000
098900     IF  PV-SQL-STR-SUB > PC-MAX-RETRIES                          09790000
099000           MOVE 'E300-CLOSE-STORE-CURSOR'                         09800000
099100                         TO PV-PARAGRAPH-NAME                     09810000
099200           MOVE 'CLOSE STORE RETRIES EXCEEDED'                    09820000
099300                         TO PV-DB2-OPER-ATTEMPTED                 09830000
099400           PERFORM X999-SQL-ABEND                                 09840000
099500     END-IF.                                                      09850000
099600/                                                                 09860000
099700*                                                                 09870000
099800   EJECT                                                          09880000
099900******************************************************************09890000
100000* F100-FETCH-STORE-CURSOR                                        *09900000
100100*     THIS PARAGRAPH RETRIEVES THE STORE ROWS FOR A DISTRICT     *09910000
100200*                                                                *09920000
100300*     PERFORMED BY E200-WRITE-STORE-DETAIL                       *09930000
100400******************************************************************09940000
100500 F100-FETCH-STORE-CURSOR.                                         09950000
100600     MOVE 'F100-FETCH-STORE-CURSOR' TO PV-PARAGRAPH-NAME.         09960000
100700                                                                  09970000
100800     PERFORM                                                      09980000
100900         WITH TEST AFTER                                          09990000
101000         VARYING PV-SQL-STR-SUB                                   10000000
101100         FROM 1 BY 1                                              10010000
101200         UNTIL ( PV-SQL-STR-SUB > PC-MAX-RETRIES                  10020000
101300                 OR SQLCODE = 0                                   10030000
101400                 OR SQLCODE = +100 )                              10040000
101500                                                                  10050000
101600         EXEC SQL                                                 10060000
101700             FETCH                                                10070000
101800                   STORE-RECS                                     10080000
101900              INTO                                                10090000
102000                   :XMT00001-LOC-NBR                              10100002
102100                 , :XMT00001-LOC-NM                               10110002
102300                 , :XMT00001-LOC-5-ABBR-NM                        10130002
102400                 , :XMT00001-LNE-1-ADDR                           10140002
102500                 , :XMT00001-CTY-NM                               10150002
102600                 , :XMT00001-ST-CDE                               10160002
102700                 , :XMT00001-ZIP-10-CDE                           10170002
102800                 , :XMT00001-PHN-NBR :PV-PHN-NBR-NULL-IND         10180007
102900                 , :XMT00001-OPN-DTE                              10190002
103000         END-EXEC                                                 10200000
103100                                                                  10210000
103200         EVALUATE TRUE                                            10220000
103300             WHEN SQLCODE = -904                                  10230000
103400             WHEN SQLCODE = -911                                  10240000
103500             WHEN SQLCODE = +100                                  10250000
103600             WHEN SQLCODE = 0                                     10260000
103700                 CONTINUE                                         10270000
103800             WHEN SQLWARN NOT = SPACES                            10280000
103900             WHEN SQLCODE NOT = ZERO                              10290000
104000                 MOVE 'F100-FETCH-STORE-CURSOR'                   10300000
104100                                 TO PV-PARAGRAPH-NAME             10310000
104200                 MOVE 'FETCH STORE-RECS CURSOR'                   10320000
104300                                 TO PV-DB2-OPER-ATTEMPTED         10330000
104400                 PERFORM X999-SQL-ABEND                           10340000
104500         END-EVALUATE                                             10350000
104600                                                                  10360000
104700     END-PERFORM.                                                 10370000
104800                                                                  10380000
104900     IF  PV-SQL-STR-SUB > PC-MAX-RETRIES                          10390000
105000           MOVE 'F100-FETCH-STORE-CURSOR'                         10400000
105100                         TO PV-PARAGRAPH-NAME                     10410000
105200           MOVE 'FETCH STORE RETRIES EXCEEDED'                    10420000
105300                         TO PV-DB2-OPER-ATTEMPTED                 10430000
105400           PERFORM X999-SQL-ABEND                                 10440000
105500     END-IF.                                                      10450000
105600/                                                                 10460000
105700*                                                                 10470000
105800******************************************************************10480000
105900* F200-FORMAT-STORE-DETAIL                                       *10490000
106000*                                                                *10500000
106100*     PERFORMED BY E200-WRITE-STORE-DETAIL                       *10510000
106200******************************************************************10520000
106300 F200-FORMAT-STORE-DETAIL.                                        10530000
106400     MOVE 'F200-FORMAT-STORE-DETAIL' TO PV-PARAGRAPH-NAME.        10540000
106500                                                                  10550000
106600*    ** INSTALLATION DEFAULT IS TO RETURN ISO FORMAT **           10560000
106800                                                                  10580000
106900     MOVE XMT00001-OPN-DTE      TO  WS-ISO-OPENED-DATE.           10590002
107000     MOVE WS-OPENED-DATE-CC     TO  WS-OPEN-DTE-CC.               10600000
107010     MOVE WS-OPENED-DATE-YY     TO  WS-OPEN-DTE-YY.               10610000
107100     MOVE WS-OPENED-DATE-MM     TO  WS-OPEN-DTE-MM.               10620000
107200     MOVE WS-OPENED-DATE-DD     TO  WS-OPEN-DTE-DD.               10630000
107300                                                                  10640000
107310     MOVE FUNCTION CURRENT-DATE (1:8) TO WS-SYSTEM-DATE.          10650000
107500                                                                  10660000
107600     IF  WS-OPEN-DATE >= WS-SYSTEM-DATE                           10670000
107700*        ** THIS IS A NEW STORE - OPENING ON THE FUTURE DATE **   10680000
107800          MOVE WS-OPENED-DATE-MM     TO  RPT-FUTURE-OPEN-MM       10690000
107900          MOVE '/'                   TO  RPT-SLASH1               10700000
108000          MOVE WS-OPENED-DATE-DD     TO  RPT-FUTURE-OPEN-DD       10710000
108100          MOVE '/'                   TO  RPT-SLASH2               10720000
108200          MOVE WS-OPENED-DATE-CC     TO  RPT-FUTURE-OPEN-CC       10730000
108300          MOVE WS-OPENED-DATE-YY     TO  RPT-FUTURE-OPEN-YY       10740000
108400     ELSE                                                         10750000
108500          MOVE SPACES                TO  RPT-FUTURE-OPEN-DATE.    10760000
108600                                                                  10770000
108700     MOVE XMT00001-LOC-NBR                                        10780002
108800                        TO  RPT-STORE-NMBR.                       10790000
108900     MOVE XMT00001-LOC-NM                                         10800002
109000                        TO  RPT-STORE-NAME.                       10810000
109300     MOVE XMT00001-LOC-5-ABBR-NM                                  10840002
109400                        TO  RPT-5-CHAR-NAME.                      10850000
109500     MOVE XMT00001-LNE-1-ADDR                                     10860002
109600                        TO  RPT-ADDRESS-1.                        10870000
109700     MOVE XMT00001-CTY-NM                                         10880002
109800                        TO  RPT-CITY.                             10890000
109900     MOVE XMT00001-ST-CDE                                         10900002
110000                        TO  RPT-STATE.                            10910000
110100                                                                  10920000
110200     MOVE XMT00001-ZIP-10-CDE                                     10930002
110300                        TO RPT-ZIP-CODE.                          10940002
110500                                                                  10960000
110500     IF PV-PHN-NBR-NULL-IND < +0                                  10961007
110700         MOVE SPACES    TO WS-PHONE-REFORMAT                      10962007
110900     ELSE                                                         10963007
110600         MOVE XMT00001-PHN-NBR                                    10970007
110700                        TO WS-PHONE-REFORMAT                      10980007
111500     END-IF.                                                      10981007
110800     MOVE WS-PHONE-AREA TO RPT-AREA-CODE.                         10990000
111200     IF WS-PHONE-HYPHEN1-2 = '-'                                  10991002
110900         MOVE WS-PHONE-1ST3-2 TO RPT-PHONE-1ST3                   11000002
111200         IF WS-PHONE-HYPHEN2-2 = '-'                              11001002
110900             MOVE WS-PHONE-LST4-2 TO RPT-PHONE-LAST4              11002002
110900         ELSE                                                     11003002
110900             MOVE WS-PHONE-LST4-3 TO RPT-PHONE-LAST4              11003102
111500         END-IF                                                   11003202
110900     ELSE                                                         11004002
110900         MOVE WS-PHONE-1ST3-1 TO RPT-PHONE-1ST3                   11005002
111000         MOVE WS-PHONE-LST4-1 TO RPT-PHONE-LAST4                  11010002
111500     END-IF.                                                      11011002
111100                                                                  11020000
111200     IF  PV-LINE-COUNT > 60                                       11030000
111300          MOVE +0 TO PV-LINE-COUNT                                11040000
111400          PERFORM U100-CREATE-RPT-HDRS                            11050000
111500     END-IF.                                                      11060000
111600                                                                  11070000
111700     WRITE OUT-STORE-DISTRICT-RECORD                              11080000
111800     FROM  RPT-DETAIL-LINE                                        11090000
111900     AFTER ADVANCING 1 LINE.                                      11100000
112000     ADD +1 TO PV-LINE-COUNT.                                     11110000
112100/                                                                 11120000
112200*                                                                 11130000
112300   EJECT                                                          11140000
114000******************************************************************11310000
114100* U100-CREATE-RPT-HDRS                                           *11320000
114200*     INCREMENTS PAGE COUNT FIELD.                               *11330000
114300*     WRITES ALL REPORT HEADINGS AND TITLE LINES.                *11340000
114400*                                                                *11350000
114500*     PERFORMED BY B200-PROCESS-DATA                             *11360000
114600******************************************************************11370000
114700 U100-CREATE-RPT-HDRS.                                            11380000
114800     MOVE 'U100-CREATE-RPT-HDRS' TO PV-PARAGRAPH-NAME.            11390000
114900                                                                  11400000
115000     ADD  +1  TO  PV-PAGE-COUNT.                                  11410000
115100     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    11420000
115200                                                                  11430000
115300     WRITE OUT-STORE-DISTRICT-RECORD                              11440000
115400     FROM  DP132O-STANDRD-HEADER-132-COLS                         11450000
115500     AFTER ADVANCING PAGE.                                        11460000
115600     ADD +1 TO PV-LINE-COUNT.                                     11470000
115700                                                                  11480000
115800     WRITE OUT-STORE-DISTRICT-RECORD                              11490000
115900     FROM  RPT-HEADER-LINE-2                                      11500000
116000     AFTER ADVANCING 1 LINE.                                      11510000
116100     ADD +1 TO PV-LINE-COUNT.                                     11520000
116200                                                                  11530000
116300     WRITE OUT-STORE-DISTRICT-RECORD                              11540000
116400     FROM  RPT-TITLE-LINE-1                                       11550000
116500     AFTER ADVANCING 2 LINES.                                     11560000
116600     ADD +2 TO PV-LINE-COUNT.                                     11570000
116700                                                                  11580000
116800     WRITE OUT-STORE-DISTRICT-RECORD                              11590000
116900     FROM  RPT-TITLE-LINE-2                                       11600000
117000     AFTER ADVANCING 1 LINE.                                      11610000
117100     ADD +1 TO PV-LINE-COUNT.                                     11620000
117200                                                                  11630000
117300*    ** UNDERSCORE THE COLUMN TITLES **                           11640000
117400     WRITE OUT-STORE-DISTRICT-RECORD                              11650000
117500     FROM  RPT-TITLE-LINE-3                                       11660000
117600     AFTER ADVANCING 1 LINE.                                      11670000
117700/                                                                 11680000
117800*                                                                 11690000
117900   EJECT                                                          11700000
118000******************************************************************11710000
118100* X999-SQL-ABEND                                                 *11720000
118200*     THIS PARAGRAPH WILL FORCE THE PROGRAM TO ABEND BECAUSE     *11730000
118300*     OF A SERIOUS DB2 ERROR.                                    *11740000
118400*                                                                *11750000
118500*     PERFORMED BY R200-READ-DEPT-DATA-BASE                      *11760000
118600******************************************************************11770000
118700 X999-SQL-ABEND.                                                  11780000
118800     MOVE 'X999-SQL-ABEND' TO PV-PARAGRAPH-NAME.                  11790000
118900                                                                  11800000
119000     SET ABEND-4013                   TO TRUE.                    11810000
119100                                                                  11820000
119200     DISPLAY '**  ABEND     **'                                   11830000
119300     DISPLAY '**  PROGRAM   **  =  XMKRP001'.                     11840000
119400     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            11850000
119500     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        11860000
119600/                                                                 11870000
119700*                                                                 11880000
119800******************************************************************11890000
119900*    THE FOLLOWING INCLUDE COPYBOOK USES THE DB2 ABEND MODULE    *11900000
120000*    'DSNTIAR' TO CONVERT THE SQLCA INTO MEANINGFUL VERBAGE.     *11910000
120100******************************************************************11920000
120200*                                                                 11930000
120300     COPY DPPD004.                                                11940000
120400*                                                                 11950000
120500     CALL 'ILBOABN0' USING ABEND-CODE.                            11960000
120600                                                                  11970000
