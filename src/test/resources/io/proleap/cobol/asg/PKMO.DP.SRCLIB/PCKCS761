000100 IDENTIFICATION DIVISION.                                         00010019
000200 PROGRAM-ID.    PCKCS761.                                         00020020
000300 AUTHOR.        DEANNA BRANTNER.                                  00030020
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040020
000500 DATE-WRITTEN.  OCTOBER, 2001.                                    00050020
000600 DATE-COMPILED.                                                   00060020
000700*---------------------------------------------------------------* 00070020
000800*    E761 - IN-TRANSIT - PO/RCVR UNBAL STORE EXPECTED BY STR      00080020
000900*---------------------------------------------------------------* 00090020
000910* DATE  11/04/2021                                                00091021
000920*            - CHANGE CALL OF 'DPKUT100' TO                     * 00092021
000930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00093021
000940*              MAKING THE CALL DYNAMIC VS STATIC                * 00094021
000950*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00095022
000960*-----------------------------------------------------------------00096021
1122RM* DATE  11/07/2022                                              * 00097023
1122RM*            - ADD COPYBOOK DPWS930                             * 00098023
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00099023
1122RM*              DYNAMIC.                                         * 00099123
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00099223
1122RM*-----------------------------------------------------------------00099323
001000 ENVIRONMENT DIVISION.                                            00100020
001100 DATA DIVISION.                                                   00110020
001200                                                                  00120020
001300 WORKING-STORAGE SECTION.                                         00130020
001400 01  DK-DB2-KEYS.                                                 00140020
001500     05  DK-SKU                 PIC S9(08)V VALUE ZERO COMP-3.    00150020
001600     05  DK-UPC-ID              PIC S9(09)  VALUE ZERO COMP.      00160020
001700     05  DK-STR-NBR             PIC S9(04)  VALUE ZERO COMP.      00170020
001800     05  DK-PO-TRN-NBR          PIC 9(09) VALUE ZEROES.           00180020
001900     05  DK-TRN-NBR-N REDEFINES DK-PO-TRN-NBR.                    00190020
002000         10  DK-TRN-NBR-X       PIC X(09).                        00200020
002100     05  DK-TRN-NBR-9.                                            00210020
002200         10  FILLER             PIC X(01) VALUE SPACES.           00220020
002300         10  DK-TRN-NBR-8       PIC X(08) VALUE SPACES.           00230020
002400                                                                  00240020
002500     05  DK-PO-RCVR-NBR-N                 PIC 9(09) VALUE ZEROES. 00250020
002600     05  DK-PO-RCVR-NBR-X REDEFINES DK-PO-RCVR-NBR-N.             00260020
002700         10  DK-RCVR-NBR-X                PIC X(09).              00270020
002800     05  DK-RCVR-NBR-9.                                           00280020
002900         10  FILLER                       PIC X(06) VALUE SPACES. 00290020
003000         10  DK-RCVR-NBR-3                PIC X(03) VALUE SPACES. 00300020
003100                                                                  00310020
003200     05  DK-PO-RCVR.                                              00320020
003300         10  DK-TRN-NBR                   PIC X(08) VALUE SPACES. 00330020
003400         10  FILLER                       PIC X(01) VALUE '-'.    00340020
003500         10  DK-RCVR-NBR                  PIC X(03) VALUE SPACES. 00350020
003600                                                                  00360020
003700     05  PV-DISPLAY-CS-PULL.                                      00370020
003800         10  PV-CS-PULL-NBR               PIC X(08) VALUE SPACES. 00380020
003900         10  FILLER                       PIC X(04).              00390020
004000     05  PV-STORE-EXPECTED                PIC S9(9) COMP.         00400020
004100     05  PV-INTRANSIT-QTY                 PIC S9(9) COMP.         00410020
004200     05  PV-STORE-ON-HAND                 PIC S9(9) COMP.         00420020
004300     05  PV-ONHAND-QTY                    PIC S9(9) COMP.         00430020
004400     05  PV-TTL-STORE-EXPECT              PIC S9(9) COMP.         00440000
004500     05  PV-TTL-INTRNST-QTY               PIC S9(9) COMP.         00450000
004600     05  PV-TTL-STORE-ON-HAND             PIC S9(9) COMP.         00460000
004700     05  PV-TTL-ONHAND-QTY                PIC S9(9) COMP.         00470000
004800     05  PV-DISPLAY-UPC                   PIC  ZZZZZZZZZZ9.       00480000
004900     05  PV-DISPLAY-SKU                   PIC  ZZZZZZZZ9.         00490000
005000     05  PV-DISPLAY-PO                    PIC  ZZZZZZZZ9.         00500018
005100     05  PV-DISPLAY-RCVR                  PIC  9999.              00510000
005200     05  PV-DISPLAY-RCVR-X                PIC  X(04).             00520018
005300     05  PV-DISPLAY-STORE                 PIC  9999.              00530000
005400                                                                  00540000
005500 01  PC-PROGRAM-CONSTANTS.                                        00550000
005600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC761A  '.  00560000
005700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM761'.   00570000
005800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS761'.  00580000
005900     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE 'XLKUT071'.  00590000
006000     05  PC-XL001-VSM-PGM          PIC  X(08)  VALUE 'XLKUT001'.  00600000
006100     05  PC-XMKCS001               PIC  X(08)  VALUE 'XMKCS001'.  00610000
006200     05  PC-DISPLAY-BSS            PIC  X(04)  VALUE 'BSS '.      00620018
006300     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00630000
006400     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00640000
006500     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00650000
006600     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00660000
006700     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +09          00670000
006800                                               COMP SYNC.         00680000
006900     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00690000
007000                                               COMP SYNC.         00700000
007100     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00710000
007200                                               COMP-3.            00720000
007300     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00730000
007400                                               COMP SYNC.         00740000
007500     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00750000
007600                                               COMP-3.            00760000
007700     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00770000
007800     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00780000
007900     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00790000
008000     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00800000
008100     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00810000
008200     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00820000
008300                                               COMP.              00830000
008400     05  PC-01                     PIC  X(02)  VALUE '01'.        00840000
008500     05  PC-A                      PIC  X(01)  VALUE 'A'.         00850000
008600*                                                                 00860000
008700*----------------------------------------------------------------*00870000
008800*  SYSTEM MESSAGES                                               *00880000
008900*----------------------------------------------------------------*00890000
009000*   00005 = INVALID VALUE                                        *00900000
009100*   00008 = MUST BE NUMERIC                                      *00910000
009200*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00920000
009300*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00930000
009400*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00940000
009500*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00950000
009600*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00960000
009700*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00970000
009800*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00980000
009900*   00069 - TOP OF LIST                                          *00990000
010000*   00070 - BOTTOM OF LIST                                       *01000000
010100*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *01010000
010200*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*01020000
010300*   00279 - MORE ITEMS TO DISPLAY                                *01030000
010400*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *01040000
010500*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *01050000
010600*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *01060000
010700*   99901 = INVALID COMMAND WAS ENTERED                          *01070000
010800*----------------------------------------------------------------*01080000
010900     05  PC-TSYMSG-NUMBERS.                                       01090000
011000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01100000
011100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01110000
011200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01120000
011300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01130000
011400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01140000
011500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01150000
011600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01160000
011700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01170000
011800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01180000
011900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01190000
012000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01200000
012100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01210000
012200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01220000
012300         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01230000
012400         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  01240000
012500         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01250000
012600         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01260000
012700         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01270000
012800         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01280000
012900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01290000
013000*                                                                 01300000
013100 01  PS-PROGRAM-SWITCHES.                                         01310000
013200     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01320000
013300         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01330000
013400         88  PS-BLOCK-ERROR                         VALUE 'N'.    01340000
013500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01350000
013600         88  PS-NO-ERROR                            VALUE 'Y'.    01360000
013700         88  PS-ERROR                               VALUE 'N'.    01370000
013800     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01380000
013900         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01390000
014000         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01400000
014100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01410000
014200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01420000
014300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01430000
014400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01440000
014500         88  PS-DONE                                VALUE 'Y'.    01450000
014600         88  PS-NOT-DONE                            VALUE 'N'.    01460000
014700     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01470000
014800         88  PS-LIST-END                            VALUE  'Y'.   01480000
014900         88  PS-NO-LIST-END                         VALUE  'N'.   01490000
015000     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01500000
015100         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01510000
015200         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01520000
015300*                                                                 01530000
015400 01  PV-PROGRAM-VARIABLES.                                        01540000
015500     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01550000
015600                                                     COMP SYNC.   01560000
015700     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01570000
015800     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01580000
015900     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01590000
016000     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01600000
016100                                        COMP SYNC.                01610000
016200     05  PV-SUB                         PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01660000
016700                                                    COMP-3.       01670000
016800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01680000
016900                                                    COMP-3.       01690000
017000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01700000
017100                                                    COMP-3.       01710000
017200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01720000
017300                                                    COMP-3.       01730000
017400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01740000
017500                                                    COMP-3.       01750000
017600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01760000
017700                                                    COMP-3.       01770000
017800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01780000
017900                                                    COMP-3.       01790000
018000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01800000
018100                                                    COMP SYNC.    01810000
018200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01820000
018300                                                    COMP SYNC.    01830000
018400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01840000
018500                                                    COMP SYNC.    01850000
018600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01860000
018700                                                    COMP SYNC.    01870000
018800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01880000
018900                                                    COMP SYNC.    01890000
019000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01900000
019100                                                    COMP SYNC.    01910000
019200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01920000
019300                                                    COMP SYNC.    01930000
019400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01940000
019500                                                    COMP SYNC.    01950000
019600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01960000
019700                                                    COMP SYNC.    01970000
019800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01980000
019900                                                    COMP SYNC.    01990000
020000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02000000
020100                                                    COMP SYNC.    02010000
020200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02020000
020300                                                    COMP SYNC.    02030000
020400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02040000
020500                                                    COMP SYNC.    02050000
020600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02060000
020700                                                    COMP SYNC.    02070000
020800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02080000
020900                                                    COMP SYNC.    02090000
021000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02100000
021100                                                    COMP SYNC.    02110000
021200     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      02120000
021300                                                    COMP.         02130000
021400     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      02140000
021500                                                    COMP.         02150000
021600     05  PV-BOSS-PARM-RECV              PIC S9(09)  COMP.         02160018
021700     05  PV-SOFT-ABORT-MSG.                                       02170000
021800         10  FILLER            PIC X(12) VALUE ' PCKCS761 - '.    02180000
021900         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02190000
022000         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02200000
022100         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02210000
022200         10  PV-SOFT-PARAGRAPH PIC X(30).                         02220000
022300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02230000
022400                                                     COMP SYNC.   02240000
022500     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02250000
022600     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02260000
022700     05  PV-CICS-MSG-HOLD.                                        02270000
022800         10  FILLER                      PIC  X(01)  VALUE SPACE. 02280000
022900         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02290000
023000     05  PV-CICS-MSG-HOLD2.                                       02300000
023100         10  FILLER                      PIC  X(01)  VALUE SPACE. 02310000
023200         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02320000
023300                                                                  02330000
023400     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02340000
023500     05  PV-TMST-R REDEFINES  PV-TMST.                            02350000
023600         10   PV-TMST-CCYY              PIC X(04).                02360000
023700         10   FILLER                    PIC X(01).                02370000
023800         10   PV-TMST-MM                PIC X(02).                02380000
023900         10   FILLER                    PIC X(01).                02390000
024000         10   PV-TMST-DD                PIC X(02).                02400000
024100         10   FILLER                    PIC X(01).                02410000
024200         10   PV-TMST-HRS               PIC X(02).                02420000
024300         10   FILLER                    PIC X(01).                02430000
024400         10   PV-TMST-MIN               PIC X(02).                02440000
024500         10   FILLER                    PIC X(01).                02450000
024600         10   PV-TMST-SEC               PIC X(02).                02460000
024700         10   FILLER                    PIC X(07).                02470000
024800     05  PV-DATE-DISPLAY.                                         02480000
024900         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02490000
025000         10   PV-SLASH-1                PIC X(01)   VALUE '/'.    02500000
025100         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02510000
025200         10   PV-SLASH-2                PIC X(01)   VALUE '/'.    02520000
025300         10   PV-DISPLAY-CCYY           PIC X(04)   VALUE SPACES. 02530000
025400     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02540000
025500     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02550000
025600     05  PV-SEL-TERM-ID                  PIC  X(04).              02560000
025700     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02570000
025800     05  PV-SEL-SEQ                      PIC  9(01).              02580000
025900                                                                  02590000
026000******************************************************************02600000
026100**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02610000
026200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02620000
026300**  APPLICATION-SPECIFIC COMMAREA.                              **02630000
026400******************************************************************02640000
026500 01  LQW-LIST-QUEUE-WORK-AREA.                                    02650000
026600     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02660000
026700     05  LQW-ITEM-ENTRIES               OCCURS 09 TIMES           02670000
026800                                        INDEXED BY LQW-IDX.       02680000
026900         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02690000
027000         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02700000
027100         10  LQW-SELECTED-SW            PIC  X(01).               02710000
027200             88  LQW-SELECT                         VALUE 'S'.    02720000
027300             88  LQW-DESELECT                       VALUE ' '.    02730000
027400         10  LQW-ACTION                 PIC  X(03).               02740000
027500             88  LQW-DEL                            VALUE 'DEL'.  02750000
027600             88  LQW-INQ                            VALUE 'INQ'.  02760000
027700             88  LQW-UPD                            VALUE 'UPD'.  02770000
027800             88  LQW-ERR                            VALUE 'ERR'.  02780000
027900         10  LQW-STORE                  PIC  X(04).               02790000
028000         10  LQW-STR-NAME               PIC  X(10).               02800000
028100         10  LQW-FASH-QTY               PIC S9(08).               02810000
028200         10  LQW-TRN-QTY                PIC S9(06).               02820000
028300         10  LQW-STR-EXP                PIC S9(08).               02830000
028400         10  LQW-STR-ONH                PIC S9(08).               02840000
028500         10  LQW-DATE                   PIC  X(10).               02850000
028600                                                                  02860000
028700*---------------------------------------------------------------* 02870000
028800* SELECTON QUEUE LAYOUT                                         * 02880000
028900*---------------------------------------------------------------* 02890000
029000     COPY PCWS212.                                                02900000
029100                                                                  02910000
029200*---------------------------------------------------------------* 02920000
029300*    MAP LAYOUT                                                 * 02930000
029400*---------------------------------------------------------------* 02940000
029500     COPY PCKM761.                                                02950000
029600*                                                                 02960000
029700 01  MR-OCCURS-LAYOUT                   REDEFINES  PC761AO.       02970000
029800     05  FILLER                         PIC X(170).               02980018
029900     05  MR-SCROLL-AREA                 OCCURS 09 TIMES.          02990000
030000         10  MR-SELECTL                 PIC S9(04) COMP.          03000000
030100         10  MR-SELECTA                 PIC  X(01).               03010000
030200         10  MR-SELECTC                 PIC  X(01).               03020000
030300         10  MR-SELECTH                 PIC  X(01).               03030000
030400         10  MR-SELECTI                 PIC  X(01).               03040000
030500                                                                  03050000
030600         10  MR-ACTIONL                 PIC S9(04) COMP.          03060000
030700         10  MR-ACTIONA                 PIC  X(01).               03070000
030800         10  MR-ACTIONC                 PIC  X(01).               03080000
030900         10  MR-ACTIONH                 PIC  X(01).               03090000
031000         10  MR-ACTION                  PIC  X(03).               03100000
031100                                                                  03110000
031200         10  MR-STOREL                  PIC S9(04) COMP.          03120000
031300         10  MR-STOREA                  PIC  X(01).               03130000
031400         10  MR-STOREC                  PIC  X(01).               03140000
031500         10  MR-STOREH                  PIC  X(01).               03150000
031600         10  MR-STORE                   PIC  X(04).               03160000
031700                                                                  03170000
031800         10  MR-STR-NAMEL               PIC S9(04) COMP.          03180000
031900         10  MR-STR-NAMEA               PIC  X(01).               03190000
032000         10  MR-STR-NAMEC               PIC  X(01).               03200000
032100         10  MR-STR-NAMEH               PIC  X(01).               03210000
032200         10  MR-STR-NAME                PIC  X(10).               03220000
032300                                                                  03230000
032400         10  MR-FASH-QTYL               PIC S9(04) COMP.          03240000
032500         10  MR-FASH-QTYA               PIC  X(01).               03250000
032600         10  MR-FASH-QTYC               PIC  X(01).               03260000
032700         10  MR-FASH-QTYH               PIC  X(01).               03270000
032800         10  MR-FASH-QTY                PIC  X(09).               03280000
032900         10  MR-FASH-QTY-X REDEFINES MR-FASH-QTY.                 03290000
033000             15  MR-FASH-QTY-N             PIC ZZZZZZZ9-.         03300000
033100                                                                  03310000
033200         10  MR-TRN-QTYL                PIC S9(04) COMP.          03320000
033300         10  MR-TRN-QTYA                PIC  X(01).               03330000
033400         10  MR-TRN-QTYC                PIC  X(01).               03340000
033500         10  MR-TRN-QTYH                PIC  X(01).               03350000
033600         10  MR-TRN-QTY                 PIC  X(07).               03360000
033700         10  MR-TRN-QTY-X REDEFINES MR-TRN-QTY.                   03370000
033800             15  MR-TRN-QTY-N              PIC ZZZZZ9-.           03380000
033900                                                                  03390000
034000         10  MR-STR-EXPL                PIC S9(04) COMP.          03400000
034100         10  MR-STR-EXPA                PIC  X(01).               03410000
034200         10  MR-STR-EXPC                PIC  X(01).               03420000
034300         10  MR-STR-EXPH                PIC  X(01).               03430000
034400         10  MR-STR-EXP                 PIC  X(09).               03440000
034500         10  MR-STR-EXP-X REDEFINES MR-STR-EXP.                   03450000
034600             15  MR-STR-EXP-N              PIC ZZZZZZZ9-.         03460000
034700                                                                  03470000
034800         10  MR-STR-ONHL                PIC S9(04) COMP.          03480000
034900         10  MR-STR-ONHA                PIC  X(01).               03490000
035000         10  MR-STR-ONHC                PIC  X(01).               03500000
035100         10  MR-STR-ONHH                PIC  X(01).               03510000
035200         10  MR-STR-ONH                 PIC  X(09).               03520000
035300         10  MR-STR-ONH-X REDEFINES MR-STR-ONH.                   03530000
035400             15  MR-STR-ONH-N              PIC ZZZZZZZ9-.         03540000
035500                                                                  03550000
035600         10  MR-DATEL                   PIC S9(04) COMP.          03560000
035700         10  MR-DATEA                   PIC  X(01).               03570000
035800         10  MR-DATEC                   PIC  X(01).               03580000
035900         10  MR-DATEH                   PIC  X(01).               03590000
036000         10  MR-DATE                    PIC  X(10).               03600000
036100                                                                  03610000
036200*----------------------------------------------------------------*03620000
036300*    XMKCS001 COPYBOOK USED WITH XMKCS001 - ON HAND QUANTITY     *03630000
036400*----------------------------------------------------------------*03640000
036500     COPY XMWS003.                                                03650000
036600                                                                  03660000
036700*---------------------------------------------------------------* 03670000
036800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03680000
036900*---------------------------------------------------------------* 03690000
037000     COPY DPWS015.                                                03700000
037100                                                                  03710000
037200*---------------------------------------------------------------* 03720000
037300*    FUNCTION KEYS COPYBOOK.                                    * 03730000
037400*---------------------------------------------------------------* 03740000
037500     COPY DPWS016.                                                03750000
037600                                                                  03760000
037700*---------------------------------------------------------------* 03770000
037800*    NUMERIC EDIT LAYOUT.                                       * 03780000
037900*---------------------------------------------------------------* 03790000
038000     COPY DPWS010I.                                               03800000
038100                                                                  03810000
038200*---------------------------------------------------------------* 03820000
038300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03830000
038400*---------------------------------------------------------------* 03840000
038500     COPY DPWS030.                                                03850000
1122RM     COPY DPWS930.                                                03851023
038600                                                                  03860000
038700*---------------------------------------------------------------* 03870000
038800*    STANDARD COMMAREA.                                         * 03880000
038900*---------------------------------------------------------------* 03890000
039000     COPY DPWS020.                                                03900000
039100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03910000
039200                                                                  03920000
039300*---------------------------------------------------------------* 03930000
039400* INTER-APPLICATION COMMAREA.                                   * 03940000
039500*   PCWS210 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03950000
039600*             SPEC SCREEN (PCKCS745).                           * 03960000
039700*   PCWS211 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03970000
039800*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION     * 03980000
039900*             (PCKCS746).                                       * 03990000
040000*---------------------------------------------------------------* 04000000
040100                                                                  04010000
040200         10  INTER-APPL-COMM-AREA       PIC X(200).               04020000
040300     COPY PCWS210.                                                04030000
040400     COPY PCWS211.                                                04040000
040500*---------------------------------------------------------------* 04050000
040600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04060000
040700*---------------------------------------------------------------* 04070000
040800         10  ASC-SPECIFIC-COMMAREA.                               04080000
040900             15  ASC-SKU                     PIC S9(08)V COMP-3.  04090000
041000             15  ASC-UPC-ID                  PIC S9(09)  COMP.    04100000
041100             15  ASC-SKU-DESC                PIC  X(25).          04110000
041200             15  ASC-STR-NBR-X               PIC  X(04).          04120000
041300             15  ASC-STR-NBR-N REDEFINES ASC-STR-NBR-X.           04130000
041400                 20  ASC-STR-NBR             PIC  9(04).          04140000
041500             15  ASC-STORE-NAME              PIC  X(10).          04150000
041600             15  ASC-TTL-FASHION             PIC S9(09).          04160000
041700             15  ASC-TTL-INTRNST             PIC S9(09).          04170000
041800             15  ASC-TTL-STORE-EXPECT        PIC S9(09).          04180000
041900             15  ASC-TTL-STORE-ON-HAND       PIC S9(09).          04190000
042000             15  ASC-SCREEN-DISPLAY          PIC  X(01).          04200000
042100                 88  ASC-DISP-INTR                VALUE 'I'.      04210000
042200                 88  ASC-DISP-INTR-PORCVR         VALUE 'J'.      04220000
042300                 88  ASC-DISP-STR-EXPT            VALUE 'S'.      04230000
042400                 88  ASC-DISP-STR-EXPT-PORCVR     VALUE 'T'.      04240000
042500             15  ASC-FASHION-ON-HAND         PIC S9(09).          04250000
042600             15  ASC-INTR-QTY                PIC S9(09).          04260000
042700             15  ASC-STORE-EXPECTED          PIC S9(09).          04270000
042800             15  ASC-STORE-ON-HAND           PIC S9(09).          04280000
042900             15  ASC-LAST-UPDT               PIC  X(10).          04290000
043000             15  ASC-TRAN-DATE               PIC  X(10).          04300000
043100             15  ASC-PO-NBR                  PIC S9(09) COMP.     04310000
043200             15  ASC-RCVR-NBR                PIC S9(09) COMP.     04320000
043300             15  ASC-SWITCH                  PIC X(01).           04330000
043400                 88  ASC-BALCD-SEQ              VALUE 'B'.        04340000
043500                 88  ASC-UNBAL-SEQ              VALUE 'U'.        04350000
043600                 88  ASC-ALL-SEQ                VALUE ' '.        04360000
043700*-----------------------------------------------------------------04370000
043800             15  ASC-BLK-SUB                  PIC S9(04) COMP     04380000
043900                                                         SYNC.    04390000
044000             15  ASC-ITEM-SUB                 PIC S9(04) COMP     04400000
044100                                                         SYNC.    04410000
044200             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  04420000
044300             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  04430000
044400             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  04440000
044500             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04450000
044600             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04460000
044700             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04470000
044800                                                         SYNC.    04480000
044900             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04490000
045000             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04500000
045100             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04510000
045200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04520000
045300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04530000
045400             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04540000
045500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04550000
045600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04560000
045700             15  ASC-LIST-QUEUE-NAME.                             04570000
045800                 20  ASC-LIST-TERM-ID         PIC  X(04).         04580000
045900                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04590000
046000                 20  ASC-LIST-SEQ             PIC  9(01).         04600000
046100                                                                  04610000
046200             15  ASC-START-ITEM-REQUEST.                          04620000
046300                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04630000
046400                                                                  04640000
046500             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04650000
046600             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04660000
046700             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04670000
046800                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04680000
046900             15  ASC-SEL-QUEUE-NAME.                              04690000
047000                 20  ASC-SEL-TERM-ID          PIC  X(04).         04700000
047100                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04710000
047200                 20  ASC-SEL-SEQ              PIC  9(01).         04720000
047300             15  ASC-SEL-QUEUE-NAME-2.                            04730000
047400                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         04740000
047500                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  04750000
047600                 20  ASC-SEL-SEQ-2            PIC  9(01).         04760000
047700             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04770000
047800                                                                  04780000
047900*-----------------------------------------------------------------04790000
048000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04800000
048100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04810000
048200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04820000
048300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04830000
048400                                                                  04840000
048500                 20  ASC-ITEM-ARRAY.                              04850000
048600                     25  ASC-ITEM-ENTRIES OCCURS 09 TIMES.        04860000
048700                         30  ASC-LIST-ITEM-NUMBER                 04870000
048800                                                     PIC S9(09)   04880000
048900                                                     COMP-3.      04890000
049000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04900000
049100                             88  ASC-VALID-SELECT    VALUE ' '    04910000
049200                                                           'S'    04920000
049300                                                           'B'    04930000
049400                                                           'E'.   04940000
049500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04950000
049600                             88  ASC-TEMP-SELECT     VALUE 'S'.   04960000
049700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04970000
049800                             88  ASC-TEMP-END        VALUE 'E'.   04980000
049900                         30  ASC-SELECTED-SW         PIC  X(01).  04990000
050000                             88  ASC-NO-SELECT       VALUE ' '.   05000000
050100                             88  ASC-SELECT          VALUE 'S'.   05010000
050200                             88  ASC-BEGIN           VALUE 'B'.   05020000
050300                             88  ASC-END             VALUE 'E'.   05030000
050400                         30  ASC-ACTION              PIC  X(03).  05040000
050500                         30  ASC-STORE               PIC  X(04).  05050000
050600                         30  ASC-STR-NAME            PIC  X(10).  05060000
050700                         30  ASC-FASH-QTY            PIC S9(08).  05070000
050800                         30  ASC-TRN-QTY             PIC S9(06).  05080000
050900                         30  ASC-STR-EXP             PIC S9(08).  05090000
051000                         30  ASC-STR-ONH             PIC S9(08).  05100000
051100                         30  ASC-DATE                PIC  X(10).  05110000
051200                                                                  05120000
051300*---------------------------------------------------------------* 05130000
051400*    ABEND PROCESSING COPYBOOK.                                 * 05140000
051500*---------------------------------------------------------------* 05150000
051600     COPY DPWS013.                                                05160000
051700                                                                  05170000
051800*----------------------------------------------------------------*05180000
051900*    XLKUT001 COPYBOOK USED WITH SKU MODULE                      *05190000
052000*----------------------------------------------------------------*05200000
052100     COPY XLWS001.                                                05210000
052200                                                                  05220000
052300*----------------------------------------------------------------*05230000
052400*    XLKUT071 COPYBOOK USED WITH LOCATION MODULE                 *05240000
052500*----------------------------------------------------------------*05250000
052600     COPY XLWS071.                                                05260000
052700                                                                  05270000
052800*---------------------------------------------------------------* 05280000
052900*    PCT_TRN_CLSN_BAL                                           * 05290000
053000*---------------------------------------------------------------* 05300000
053100     EXEC SQL                                                     05310000
053200          INCLUDE PCT00014                                        05320000
053300     END-EXEC.                                                    05330000
053400                                                                  05340000
053500*---------------------------------------------------------------* 05350000
053600*    PCT_TRN_CLSN_DTL                                           * 05360000
053700*---------------------------------------------------------------* 05370000
053800     EXEC SQL                                                     05380000
053900          INCLUDE PCT00015                                        05390000
054000     END-EXEC.                                                    05400000
054100                                                                  05410000
054200*---------------------------------------------------------------* 05420013
054300*    TKRPRPM                                                    * 05430013
054400*---------------------------------------------------------------* 05440013
054500     EXEC SQL                                                     05450013
054600          INCLUDE TKRPRPM                                         05460013
054700     END-EXEC.                                                    05470013
054800                                                                  05480013
054900*---------------------------------------------------------------* 05490000
055000*    PO, RCVR, SKU CURSOR IN LOC NBR ORDER                        05500000
055100*---------------------------------------------------------------* 05510000
055200     EXEC SQL                                                     05520000
055300          DECLARE SKU-CSR CURSOR FOR                              05530000
055400              SELECT                                              05540000
055500                      DISTINCT(B.LOC_NBR)                         05550000
055600                     ,LAST_UPD_DTE                                05560000
055700                FROM  PCT_TRN_CLSN_DTL A                          05570000
055800                    , PCT_TRN_CLSN_BAL B                          05580000
055900               WHERE  A.INTR_UPC_ID       =  :DK-UPC-ID           05590000
056000                 AND  A.PO_NBR            =  :ASC-PO-NBR          05600000
056100                 AND  A.RCVR_SEQ_NBR      =  :ASC-RCVR-NBR        05610000
056200                 AND  A.INTR_UPC_ID       =  B.INTR_UPC_ID        05620000
056300                 AND  A.LOC_NBR           =  B.LOC_NBR            05630000
056400                 AND  A.TRN_TYP_CDE NOT IN ('UM', 'NS', 'MM',     05640009
056500                                            'AM', 'SM')           05650009
056600                 AND  B.LAST_UPD_DTE  IN                          05660000
056700                      (SELECT MAX(C.LAST_UPD_DTE)                 05670000
056800                         FROM PCT_TRN_CLSN_BAL C                  05680000
056900                        WHERE B.INTR_UPC_ID  =  C.INTR_UPC_ID     05690000
057000                          AND B.LOC_NBR      =  C.LOC_NBR)        05700001
057100               GROUP BY B.LOC_NBR                                 05710001
057200                       ,B.LAST_UPD_DTE                            05720001
057300               ORDER BY B.LOC_NBR                                 05730001
057400     END-EXEC.                                                    05740001
057500                                                                  05750001
057600*---------------------------------------------------------------* 05760000
057700*    DB2 AREA FOR COMMUNICATIONS                                * 05770000
057800*---------------------------------------------------------------* 05780000
057900     EXEC SQL                                                     05790000
058000          INCLUDE SQLCA                                           05800000
058100     END-EXEC.                                                    05810000
058200                                                                  05820000
058300*-----------------------------------------------------------------05830000
058400 LINKAGE SECTION.                                                 05840000
058500                                                                  05850000
058600 01  DFHCOMMAREA.                                                 05860000
058700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05870000
058800                                        DEPENDING ON EIBCALEN.    05880000
058900         10  FILLER                     PIC X.                    05890000
059000                                                                  05900000
059100                                                                  05910000
059200 PROCEDURE DIVISION.                                              05920000
059300******************************************************************05930000
059400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05940000
059500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05950000
059600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05960000
059700******************************************************************05970000
059800 0000-MAIN-MODULE.                                                05980000
059900     INITIALIZE DP030-CICS-API-FIELDS.                            05990000
060000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06000000
060100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06010000
060200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06020000
060300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06030000
060400     MOVE LENGTH OF PC761AI        TO DP030-MAP-LENGTH (1).       06040000
060500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06050000
060600     PERFORM 0001-CALL-CICS-ARCH-API.                             06060000
060700*                                                                 06070000
060800     PERFORM 1000-CONTROL-PROCESSING                              06080000
060900*                                                                 06090000
061000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06100000
061100     PERFORM 0001-CALL-CICS-ARCH-API.                             06110000
061200                                                                  06120000
061300******************************************************************06130000
061400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06140000
061500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06150000
061600******************************************************************06160000
061700 0001-CALL-CICS-ARCH-API.                                         06170000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               06180023
1122RM     CALL DP930-CICS-ARCH-API                                     06181023
1122RM                     USING DFHEIBLK                               06182023
061900                           DFHCOMMAREA                            06190000
062000                           DP030-CICS-API-FIELDS                  06200000
062100                           DP020-STANDARD-COMMAREA                06210000
062200                           PC761AI.                               06220000
062300*                                                                 06230000
062400     IF  DP030-RC-CALL-SUCCESSFUL                                 06240000
062500         CONTINUE                                                 06250000
062600     ELSE                                                         06260000
062700         SET DP013-NO-ROLLBACK                                    06270000
062800             DP013-XCTL-DISPLAY-RESTART                           06280000
062900             DP013-CICS-ABEND      TO TRUE                        06290000
063000         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06300000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06310023
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06320023
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06321023
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06322023
063300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06330000
063400         PERFORM DP013-0000-PROCESS-ABEND                         06340000
063500     END-IF.                                                      06350000
063600                                                                  06360000
063700*----------------------------------------------------------------*06370000
063800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06380000
063900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06390000
064000*                                                                *06400000
064100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06410000
064200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06420000
064300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06430000
064400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06440000
064500*----------------------------------------------------------------*06450000
064600 1000-CONTROL-PROCESSING.                                         06460000
064700                                                                  06470000
064800     EVALUATE TRUE                                                06480000
064900         WHEN DP020-NEXT-ACT-INITIAL                              06490000
065000             INITIALIZE ASC-SPECIFIC-COMMAREA                     06500000
065100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06510000
065200                                      ASC-SEL-TERM-ID             06520000
065300                                      ASC-SEL-TERM-ID-2           06530000
065400             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06540000
065500                                           ASC-SEL-TASK-NUMBER    06550000
065600                                           ASC-SEL-TASK-NUMBER-2  06560000
065700             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06570000
065800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06580000
065900                                      ASC-SEL-SEQ-2               06590000
066000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06600000
066100             PERFORM 4000-BUILD-INITIAL-PANEL                     06610000
066200                                                                  06620000
066300         WHEN DP020-NEXT-ACT-READ-MAP                             06630000
066400             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06640000
066500             PERFORM 2000-PROCESS-PANEL                           06650000
066600                                                                  06660000
066700         WHEN DP020-NEXT-ACT-RETURN                               06670000
066800             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06680000
066900             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               06690000
067000             IF ASC-BALCD-SEQ                                     06700000
067100                 MOVE 'BALANCED  '     TO ASEQO                   06710000
067200             ELSE                                                 06720000
067300                 IF ASC-UNBAL-SEQ                                 06730000
067400                     MOVE 'UNBALANCED' TO ASEQO                   06740000
067500                 ELSE                                             06750000
067600                     MOVE SPACES       TO ASEQO                   06760000
067700                 END-IF                                           06770000
067800             END-IF                                               06780000
067900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06790000
068000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06800000
068100                                                                  06810000
068200         WHEN OTHER                                               06820000
068300             SET DP013-LOGIC-ABEND TO TRUE                        06830000
068400             SET DP013-NO-ROLLBACK TO TRUE                        06840000
068500             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06850000
068600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06860000
068700                                   TO DP013-MESSAGE-TEXT(1)       06870000
068800             PERFORM DP013-0000-PROCESS-ABEND                     06880000
068900     END-EVALUATE.                                                06890000
069000                                                                  06900000
069100*----------------------------------------------------------------*06910000
069200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06920000
069300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06930000
069400*    PC-CRIT-SPEC-FORMAT IS A '1' AND COMES FROM PCKCS745        *06940000
069500*    PC-LIST-FORMAT      IS A '2' AND COMES FROM PCKCS746        *06950000
069600*----------------------------------------------------------------*06960000
069700 1100-PROCESS-INTER-APPL-COMM.                                    06970000
069800                                                                  06980000
069900     SET PS-COMMAREA-VALID         TO TRUE.                       06990000
070000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07000000
070100                                                                  07010000
070200     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07020000
070300         MOVE PC210-PO-NBR            TO ASC-PO-NBR               07030000
070400         MOVE PC210-RCVR-NBR          TO ASC-RCVR-NBR             07040000
070500     ELSE                                                         07050000
070600     IF  DP020-INT-APPL-FORMAT-IND = PC-LIST-FORMAT               07060000
070700         SET ASC-USE-SELECTION-QUEUE TO TRUE                      07070000
070800         MOVE PC211-NUMBER-OF-SELECTED-ITEMS TO                   07080000
070900                                      ASC-NUMBER-OF-SELECTED-ITEMS07090000
071000         MOVE PC211-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  07100000
071100         MOVE PC211-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      07110000
071200         MOVE PC211-PO-NBR             TO ASC-PO-NBR              07120000
071300         MOVE PC211-RCVR-NBR           TO ASC-RCVR-NBR            07130000
071400         MOVE PC211-SEQ-SW             TO ASC-SWITCH              07140000
071500         PERFORM 1120-PREPARE-LIST-ENTRY                          07150000
071600     END-IF                                                       07160000
071700     END-IF.                                                      07170000
071800                                                                  07180000
071900*-----------------------------------------------------------------07190000
072000*  PREPARE LIST ENTRY                                             07200000
072100*-----------------------------------------------------------------07210000
072200 1120-PREPARE-LIST-ENTRY.                                         07220000
072300                                                                  07230000
072400     MOVE PC212-MAX-ITEMS          TO ASC-SEL-SUB.                07240000
072500     MOVE ZERO                     TO ASC-SEL-ITEM.               07250000
072600     PERFORM 1130-GET-NEXT-RECORD.                                07260000
072700                                                                  07270000
072800*-----------------------------------------------------------------07280000
072900*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07290000
073000*-----------------------------------------------------------------07300000
073100 1130-GET-NEXT-RECORD.                                            07310000
073200     ADD +1                       TO ASC-SEL-SUB.                 07320000
073300                                                                  07330000
073400     IF  ASC-SEL-SUB > PC212-MAX-ITEMS                            07340000
073500         ADD +1                   TO ASC-SEL-ITEM                 07350000
073600         MOVE +1                  TO ASC-SEL-SUB                  07360000
073700     END-IF.                                                      07370000
073800                                                                  07380000
073900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07390000
074000         PERFORM 9100-READ-SEL-QUEUE                              07400000
074100         IF  PC212-ITEM (ASC-SEL-SUB) > ZERO                      07410000
074200             MOVE PC212-SKU (ASC-SEL-SUB) TO ASC-SKU              07420000
074300             SET PC212-INQ (ASC-SEL-SUB)  TO TRUE                 07430000
074400             PERFORM 9200-REWRITE-SEL-QUEUE                       07440000
074500         ELSE                                                     07450000
074600             SUBTRACT +1 FROM ASC-SEL-SUB                         07460000
074700             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07470000
074800             SET DP020-MSG-INFORMATIONAL                          07480000
074900                 PS-LIST-END             TO TRUE                  07490000
075000         END-IF                                                   07500000
075100     ELSE                                                         07510000
075200         SUBTRACT +1 FROM ASC-SEL-ITEM                            07520000
075300         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  07530000
075400         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07540000
075500         SET DP020-MSG-INFORMATIONAL                              07550000
075600             PS-LIST-END             TO TRUE                      07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900*----------------------------------------------------------------*07590000
076000*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07600000
076100*    PROCESSED.                                                  *07610000
076200*----------------------------------------------------------------*07620000
076300 1140-GET-PREV-RECORD.                                            07630000
076400     SUBTRACT +1 FROM ASC-SEL-SUB.                                07640000
076500                                                                  07650000
076600     IF  ASC-SEL-SUB < +1                                         07660000
076700         SUBTRACT +1 FROM ASC-SEL-ITEM                            07670000
076800         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  07680000
076900     END-IF.                                                      07690000
077000                                                                  07700000
077100     IF  ASC-SEL-ITEM > ZERO                                      07710000
077200         PERFORM 9100-READ-SEL-QUEUE                              07720000
077300         MOVE PC212-SKU (ASC-SEL-SUB) TO ASC-SKU                  07730000
077400         SET PC212-INQ (ASC-SEL-SUB)  TO TRUE                     07740000
077500         PERFORM 9200-REWRITE-SEL-QUEUE                           07750000
077600     ELSE                                                         07760000
077700         MOVE +1                  TO ASC-SEL-ITEM                 07770000
077800                                     ASC-SEL-SUB                  07780000
077900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07790000
078000         SET DP020-MSG-INFORMATIONAL                              07800000
078100             PS-LIST-END             TO TRUE                      07810000
078200     END-IF.                                                      07820000
078300                                                                  07830000
078400*----------------------------------------------------------------*07840000
078500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07850000
078600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07860000
078700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07870000
078800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07880000
078900* FUNCTION KEYS CAN GET THIS FAR.                                *07890000
079000*----------------------------------------------------------------*07900000
079100 2000-PROCESS-PANEL.                                              07910000
079200     EVALUATE TRUE                                                07920000
079300         WHEN DP020-SRC-AID = DP016-CLEAR                         07930000
079400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07940000
079500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07950000
079600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07960000
079700                                                                  07970000
079800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07980000
079900             IF ASC-BALCD-SEQ                                     07990000
080000                 MOVE 'BALANCED  '     TO ASEQO                   08000000
080100             ELSE                                                 08010000
080200                 IF ASC-UNBAL-SEQ                                 08020000
080300                     MOVE 'UNBALANCED' TO ASEQO                   08030000
080400                 ELSE                                             08040000
080500                     MOVE SPACES       TO ASEQO                   08050000
080600                 END-IF                                           08060000
080700             END-IF                                               08070000
080800             PERFORM 2050-DELETE-LIST-QUEUE                       08080000
080900             PERFORM 4000-BUILD-INITIAL-PANEL                     08090000
081000                                                                  08100000
081100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08110000
081200             PERFORM 2140-DESELECT-ALL-ITEMS                      08120000
081300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08130000
081400                                                                  08140000
081500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08150000
081600             PERFORM 2150-SELECT-ALL-ITEMS                        08160000
081700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08170000
081800                                                                  08180000
081900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08190000
082000             IF  ASC-USE-SELECTION-QUEUE                          08200000
082100                 PERFORM 1130-GET-NEXT-RECORD                     08210000
082200                 IF PS-LIST-END                                   08220000
082300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08230000
082400                     SET PS-NO-LIST-END TO TRUE                   08240000
082500                 ELSE                                             08250000
082600                     PERFORM 2050-DELETE-LIST-QUEUE               08260000
082700                     PERFORM 3200-RESET-ATTRIBUTES                08270000
082800                     PERFORM 4000-BUILD-INITIAL-PANEL             08280000
082900                 END-IF                                           08290000
083000              ELSE                                                08300000
083100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08310000
083200*                --- BOTTOM OF LIST ---                           08320000
083300                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         08330000
083400                 SET DP020-MSG-INFORMATIONAL TO TRUE              08340000
083500             END-IF                                               08350000
083600                                                                  08360000
083700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08370000
083800             IF  ASC-USE-SELECTION-QUEUE                          08380000
083900                 PERFORM 1140-GET-PREV-RECORD                     08390000
084000                 IF PS-LIST-END                                   08400000
084100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08410000
084200                     SET PS-NO-LIST-END TO TRUE                   08420000
084300                 ELSE                                             08430000
084400                     PERFORM 2050-DELETE-LIST-QUEUE               08440000
084500                     PERFORM 3200-RESET-ATTRIBUTES                08450000
084600                     PERFORM 4000-BUILD-INITIAL-PANEL             08460000
084700                 END-IF                                           08470000
084800             ELSE                                                 08480000
084900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08490000
085000                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08500000
085100                 SET DP020-MSG-INFORMATIONAL TO TRUE              08510000
085200             END-IF                                               08520000
085300                                                                  08530000
085400         WHEN OTHER                                               08540000
085500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08550000
085600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08560000
085700                                                                  08570000
085800             IF  PS-NO-ERROR                                      08580000
085900                 SET DP030-CONTINUE-GO TO TRUE                    08590000
086000                 PERFORM 2100-CHECK-FUNCTION-KEY                  08600000
086100             ELSE                                                 08610000
086200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08620000
086300                 SET DP030-OVERRIDE-GO TO TRUE                    08630000
086400             END-IF                                               08640000
086500     END-EVALUATE.                                                08650000
086600                                                                  08660000
086700*----------------------------------------------------------------*08670000
086800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08680000
086900*----------------------------------------------------------------*08690000
087000 2050-DELETE-LIST-QUEUE.                                          08700000
087100                                                                  08710000
087200     EXEC CICS                                                    08720000
087300         DELETEQ TS                                               08730000
087400             QUEUE (ASC-LIST-QUEUE-NAME)                          08740000
087500             RESP  (PV-CICS-RESP)                                 08750000
087600     END-EXEC.                                                    08760000
087700                                                                  08770000
087800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08780000
087900        (PV-CICS-RESP = DFHRESP(QIDERR))                          08790000
088000         CONTINUE                                                 08800000
088100     ELSE                                                         08810000
088200         SET DP013-CICS-ABEND      TO TRUE                        08820000
088300         SET DP013-NO-ROLLBACK     TO TRUE                        08830000
088400                                                                  08840000
088500         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         08850000
088600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08860000
088700                                   TO DP013-MESSAGE-TEXT (1)      08870000
088800         PERFORM DP013-0000-PROCESS-ABEND                         08880000
088900     END-IF.                                                      08890000
089000                                                                  08900000
089100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08910000
089200                                                                  08920000
089300*----------------------------------------------------------------*08930000
089400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08940000
089500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08950000
089600* CICS ARCHITECTURE API.                                         *08960000
089700*----------------------------------------------------------------*08970000
089800 2100-CHECK-FUNCTION-KEY.                                         08980000
089900                                                                  08990000
090000     EVALUATE TRUE                                                09000000
090100                                                                  09010000
090200* F18 - IN-TRANSIT SKU STORE DETAIL - IN-TRANSIT VIEW             09020000
090300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09030000
090400             IF PS-NO-ERROR                                       09040000
090500                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09050000
090600                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09060000
090700                     INITIALIZE PC211-INTER-APPL-COMMAREA         09070000
090800                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09080000
090900                                TO PC211-NUMBER-OF-SELECTED-ITEMS 09090000
091000                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09100000
091100                                      TO PC211-NUMBER-OF-TS-ITEMS 09110000
091200                     MOVE ASC-SEL-QUEUE-NAME                      09120000
091300                                           TO PC211-SEL-QUEUE-NAME09130000
091400                     MOVE ASC-PO-NBR          TO PC211-PO-NBR     09140000
091500                     MOVE ASC-RCVR-NBR        TO PC211-RCVR-NBR   09150000
091600                     MOVE ASC-SKU             TO PC211-SKU        09160000
091700                     SET  PC211-DISPLAY-INTR  TO  TRUE            09170000
091800                     PERFORM 5000-PREPARE-SEL-QUEUE               09180000
091900                 ELSE                                             09190000
092000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09200000
092100                     SET DP030-OVERRIDE-GO TO TRUE                09210000
092200                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09220000
092300                     SET DP020-MSG-WARNING TO TRUE                09230000
092400                 END-IF                                           09240000
092500             END-IF                                               09250000
092600                                                                  09260000
092700* F24 - IN-TRANSIT SKU STORE DETAIL - STORE EXPECTED VIEW         09270000
092800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09280000
092900             IF PS-NO-ERROR                                       09290000
093000                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09300000
093100                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09310000
093200                     INITIALIZE PC211-INTER-APPL-COMMAREA         09320000
093300                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09330000
093400                                TO PC211-NUMBER-OF-SELECTED-ITEMS 09340000
093500                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09350000
093600                                      TO PC211-NUMBER-OF-TS-ITEMS 09360000
093700                     MOVE ASC-SEL-QUEUE-NAME                      09370000
093800                                           TO PC211-SEL-QUEUE-NAME09380000
093900                     MOVE ASC-PO-NBR          TO PC211-PO-NBR     09390000
094000                     MOVE ASC-RCVR-NBR        TO PC211-RCVR-NBR   09400000
094100                     MOVE ASC-SKU             TO PC211-SKU        09410000
094200                     SET  PC211-DISPLAY-STR-EXPT  TO  TRUE        09420000
094300                     PERFORM 5000-PREPARE-SEL-QUEUE               09430000
094400                 ELSE                                             09440000
094500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09450000
094600                     SET DP030-OVERRIDE-GO TO TRUE                09460000
094700                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09470000
094800                     SET DP020-MSG-WARNING TO TRUE                09480000
094900                 END-IF                                           09490000
095000             END-IF                                               09500000
095100*                                                                 09510000
095200* F6 - FIRST PAGE                                                 09520000
095300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09530000
095400             MOVE +1               TO PV-TOP-ITEM                 09540000
095500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09550000
095600*                                                                 09560000
095700* F7 - PREVIOUS PAGE                                              09570000
095800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09580000
095900             PERFORM 2110-BROWSE-BACKWARD                         09590000
096000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09600000
096100*                                                                 09610000
096200* F8 - NEXT PAGE                                                  09620000
096300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09630000
096400             PERFORM 2120-BROWSE-FORWARD                          09640000
096500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09650000
096600*                                                                 09660000
096700* ENTER KEY                                                       09670000
096800         WHEN DP020-SRC-AID = DP016-ENTER                         09680000
096900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09690000
097000             IF  PS-ERROR                                         09700000
097100                 CONTINUE                                         09710000
097200             ELSE                                                 09720000
097300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09730000
097400             END-IF                                               09740000
097500                                                                  09750000
097600         WHEN OTHER                                               09760000
097700             SET DP013-NO-ROLLBACK                                09770000
097800                 DP013-XCTL-DISPLAY-RESTART                       09780000
097900                 DP013-CICS-ABEND  TO TRUE                        09790000
098000             MOVE '2100-CHECK-FUNCTION-KEY'                       09800000
098100                                   TO DP013-PARAGRAPH             09810000
098200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09820000
098300                                   TO DP013-MESSAGE-TEXT (1)      09830000
098400             PERFORM DP013-0000-PROCESS-ABEND                     09840000
098500     END-EVALUATE.                                                09850000
098600*                                                                 09860000
098700*----------------------------------------------------------------*09870000
098800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09880000
098900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09890000
099000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09900000
099100*    MESSAGE.                                                    *09910000
099200*----------------------------------------------------------------*09920000
099300 2110-BROWSE-BACKWARD.                                            09930000
099400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09940000
099500         GIVING PV-TOP-ITEM.                                      09950000
099600*                                                                 09960000
099700     IF  ((PV-TOP-ITEM < +1)                                      09970000
099800       OR (PV-TOP-ITEM = +1))                                     09980000
099900         MOVE +1                   TO PV-TOP-ITEM                 09990000
100000*        -- TOP OF LIST --                                        10000000
100100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10010000
100200         SET DP020-MSG-INFORMATIONAL TO TRUE                      10020000
100300     END-IF.                                                      10030000
100400                                                                  10040000
100500*----------------------------------------------------------------*10050000
100600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10060000
100700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10070000
100800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10080000
100900*----------------------------------------------------------------*10090000
101000 2120-BROWSE-FORWARD.                                             10100000
101100                                                                  10110000
101200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10120000
101300         GIVING PV-TOP-ITEM.                                      10130000
101400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10140000
101500         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             10150000
101600*        -- BOTTOM OF LIST --                                     10160000
101700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10170000
101800         SET DP020-MSG-INFORMATIONAL  TO TRUE                     10180000
101900     ELSE                                                         10190000
102000         COMPUTE PV-BOTTOM-ITEM =                                 10200000
102100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10210000
102200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10220000
102300*            -- BOTTOM OF LIST --                                 10230000
102400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10240000
102500             SET DP020-MSG-INFORMATIONAL TO TRUE                  10250000
102600         END-IF                                                   10260000
102700     END-IF.                                                      10270000
102800                                                                  10280000
102900*----------------------------------------------------------------*10290000
103000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10300000
103100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10310000
103200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10320000
103300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10330000
103400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10340000
103500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10350000
103600*----------------------------------------------------------------*10360000
103700 2130-CHECK-FOR-JUMP-BROWSE.                                      10370000
103800     SET PS-NO-ERROR               TO TRUE.                       10380000
103900     IF (ASC-START-ITEM-REQUEST = SPACE)                          10390000
104000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10400000
104100                                   TO PV-TOP-ITEM                 10410000
104200     ELSE                                                         10420000
104300         MOVE ASC-START-ITEM-REQUEST                              10430000
104400                                   TO DP010I-UNEDITED-FIELD       10440000
104500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10450000
104600         MOVE LENGTH OF ASC-START-ITEM-REQUEST                    10460000
104700                                 TO DP010I-MAXIMUM-DIGITS         10470000
104800         SET DP010I-NEGATIVE-NOT-ALLOWED                          10480000
104900                                   TO TRUE                        10490000
105010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10501020
105020                         USING DP010I-NUMERIC-EDIT-AREA           10502020
105100                                                                  10510000
105200         IF  NOT DP010I-ERROR-DETECTED                            10520000
105300             MOVE DP010I-NUMERIC-FIELD                            10530000
105400                                   TO  ASC-START-ITEM-REQUEST-N   10540000
105500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10550000
105600                 IF  ASC-START-ITEM-REQUEST-N >                   10560000
105700                                          ASC-NUMBER-OF-ITEMS-READ10570000
105800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10580000
105900                     COMPUTE PV-TOP-ITEM =                        10590000
106000                             ASC-NUMBER-OF-ITEMS-READ             10600000
106100                             - PC-ITEMS-PER-PANEL + 1             10610000
106200                     IF  PV-TOP-ITEM < +1                         10620000
106300                         MOVE +1   TO PV-TOP-ITEM                 10630000
106400                         MOVE PC-TSYMSG-00070                     10640000
106500                                   TO DP020-MSG-NUMBER            10650000
106600                         SET DP020-MSG-INFORMATIONAL              10660000
106700                                   TO TRUE                        10670000
106800                     ELSE                                         10680000
106900                         MOVE  PV-TOP-ITEM                        10690000
107000                           TO  ASC-START-ITEM-REQUEST-N           10700000
107100                     END-IF                                       10710000
107200                 ELSE                                             10720000
107300                     MOVE ASC-START-ITEM-REQUEST-N                10730000
107400                                   TO PV-TOP-ITEM                 10740000
107500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10750000
107600                     COMPUTE PV-BOTTOM-ITEM =                     10760000
107700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10770000
107800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10780000
107900                         SUBTRACT  PV-TOP-ITEM                    10790000
108000                             FROM  ASC-NUMBER-OF-ITEMS-READ       10800000
108100                           GIVING  ASC-ITEMS-DISPLAYED            10810000
108200                         MOVE  ASC-NUMBER-OF-ITEMS-READ           10820000
108300                           TO  PV-BOTTOM-ITEM                     10830000
108400*                        -- BOTTOM OF LIST --                     10840000
108500                         MOVE PC-TSYMSG-00070                     10850000
108600                                   TO DP020-MSG-NUMBER            10860000
108700                         SET DP020-MSG-INFORMATIONAL              10870000
108800                                   TO TRUE                        10880000
108900                     END-IF                                       10890000
109000                 END-IF                                           10900000
109100             ELSE                                                 10910000
109200*                --- VALUE OUT OF RANGE ----                      10920000
109300                 MOVE PC-TSYMSG-00101                             10930000
109400                                   TO DP020-MSG-NUMBER            10940000
109500                 MOVE -1           TO ASTRTITL                    10950000
109600                 SET DP030-SET-CURSOR-APPL-1                      10960000
109700                                   TO TRUE                        10970000
109800                 MOVE DP015-REVERSE                               10980000
109900                                   TO ASTRTITH                    10990000
110000                 MOVE DP015-RED    TO ASTRTITC                    11000000
110100                 MOVE DP015-UNP-NUM-BRT-MDT                       11010000
110200                                   TO ASTRTITA                    11020000
110300                 SET DP020-MSG-FATAL                              11030000
110400                                   TO TRUE                        11040000
110500                 SET PS-ERROR      TO TRUE                        11050000
110600             END-IF                                               11060000
110700         ELSE                                                     11070000
110800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11080000
110900             MOVE -1               TO ASTRTITL                    11090000
111000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11100000
111100             MOVE DP015-REVERSE    TO ASTRTITH                    11110000
111200             MOVE DP015-RED        TO ASTRTITC                    11120000
111300             MOVE DP015-UNP-NUM-BRT-MDT                           11130000
111400                                   TO ASTRTITA                    11140000
111500             SET DP020-MSG-FATAL   TO TRUE                        11150000
111600             SET PS-ERROR          TO TRUE                        11160000
111700         END-IF                                                   11170000
111800     END-IF.                                                      11180000
111900                                                                  11190000
112000*----------------------------------------------------------------*11200000
112100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11210000
112200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11220000
112300*----------------------------------------------------------------*11230000
112400 2140-DESELECT-ALL-ITEMS.                                         11240000
112500     MOVE +1                       TO ASC-BLK-SUB.                11250000
112600                                                                  11260000
112700     PERFORM 2141-CLEAR-SELECTED-INDS                             11270000
112800         VARYING ASC-ITEM-SUB                                     11280000
112900         FROM 1 BY 1                                              11290000
113000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11300000
113100                                                                  11310000
113200     ADD +1                        TO ASC-BLK-SUB.                11320000
113300                                                                  11330000
113400     PERFORM 2141-CLEAR-SELECTED-INDS                             11340000
113500         VARYING ASC-ITEM-SUB                                     11350000
113600         FROM 1 BY 1                                              11360000
113700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11370000
113800                                                                  11380000
113900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11390000
114000                                   TO PV-LIST-ITEM-NUMBER.        11400000
114100                                                                  11410000
114200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11420000
114300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11430000
114400                                                                  11440000
114500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11450000
114600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11460000
114700         MOVE +1                   TO ASC-BLK-SUB                 11470000
114800                                                                  11480000
114900         PERFORM 5100-WRITE-TEMP-STORAGE                          11490000
115000         MOVE +2                   TO ASC-BLK-SUB                 11500000
115100         PERFORM 5100-WRITE-TEMP-STORAGE                          11510000
115200         MOVE +1                   TO ASC-BLK-SUB                 11520000
115300                                                                  11530000
115400         MOVE +1                   TO PV-BLOCK-NUMBER             11540000
115500                                                                  11550000
115600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11560000
115700             PV-FIRST-BLOCK-IN-ARRAY - 1                          11570000
115800                                                                  11580000
115900         PERFORM                                                  11590000
116000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11600000
116100                                                                  11610000
116200             PERFORM 4410-READ-TEMP-STORAGE                       11620000
116300                                                                  11630000
116400             PERFORM 2141-CLEAR-SELECTED-INDS                     11640000
116500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11650000
116600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11660000
116700                                                                  11670000
116800             PERFORM 5100-WRITE-TEMP-STORAGE                      11680000
116900                                                                  11690000
117000             ADD +1                TO PV-BLOCK-NUMBER             11700000
117100                                                                  11710000
117200         END-PERFORM                                              11720000
117300                                                                  11730000
117400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11740000
117500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11750000
117600                                                                  11760000
117700         PERFORM                                                  11770000
117800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11780000
117900                   ASC-HIGHEST-BLOCK-WRITTEN                      11790000
118000                                                                  11800000
118100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11810000
118200                                   TO PV-BLOCK-NUMBER             11820000
118300                                                                  11830000
118400             PERFORM 4410-READ-TEMP-STORAGE                       11840000
118500                                                                  11850000
118600             PERFORM 2141-CLEAR-SELECTED-INDS                     11860000
118700                 VARYING ASC-ITEM-SUB                             11870000
118800                 FROM 1 BY 1                                      11880000
118900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11890000
119000                                                                  11900000
119100             PERFORM 5100-WRITE-TEMP-STORAGE                      11910000
119200                                                                  11920000
119300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11930000
119400         END-PERFORM                                              11940000
119500                                                                  11950000
119600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          11960000
119700         PERFORM 4410-READ-TEMP-STORAGE                           11970000
119800     END-IF.                                                      11980000
119900                                                                  11990000
120000                                                                  12000000
120100     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.12010000
120200     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 12020000
120300     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   12030000
120400                                                                  12040000
120500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12050000
120600                                                                  12060000
120700*----------------------------------------------------------------*12070000
120800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12080000
120900*----------------------------------------------------------------*12090000
121000 2141-CLEAR-SELECTED-INDS.                                        12100000
121100                                                                  12110000
121200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12120000
121300             NOT EQUAL ZERO                                       12130000
121400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12140000
121500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12150000
121600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12160000
121700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12170000
121800                                   TO TRUE                        12180000
121900         END-IF                                                   12190000
122000     END-IF.                                                      12200000
122100                                                                  12210000
122200*----------------------------------------------------------------*12220000
122300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12230000
122400*  FOR ALL ITEMS.                                                *12240000
122500*----------------------------------------------------------------*12250000
122600 2150-SELECT-ALL-ITEMS.                                           12260000
122700                                                                  12270000
122800     MOVE +1                       TO ASC-BLK-SUB.                12280000
122900                                                                  12290000
123000     PERFORM 2151-SET-SELECTED-INDS                               12300000
123100         VARYING ASC-ITEM-SUB                                     12310000
123200         FROM 1 BY 1                                              12320000
123300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12330000
123400                                                                  12340000
123500     ADD +1                        TO ASC-BLK-SUB.                12350000
123600                                                                  12360000
123700     PERFORM 2151-SET-SELECTED-INDS                               12370000
123800         VARYING ASC-ITEM-SUB                                     12380000
123900         FROM 1 BY 1                                              12390000
124000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12400000
124100                                                                  12410000
124200     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       12420000
124300                                                                  12430000
124400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12440000
124500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12450000
124600                                                                  12460000
124700     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            12470000
124800         MOVE +1                   TO ASC-BLK-SUB                 12480000
124900                                                                  12490000
125000         PERFORM 5100-WRITE-TEMP-STORAGE                          12500000
125100         MOVE +2                   TO ASC-BLK-SUB                 12510000
125200         PERFORM 5100-WRITE-TEMP-STORAGE                          12520000
125300         MOVE +1                   TO ASC-BLK-SUB                 12530000
125400         MOVE +1                   TO PV-BLOCK-NUMBER             12540000
125500     END-IF.                                                      12550000
125600*                                                                 12560000
125700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12570000
125800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12580000
125900         MOVE +1                   TO ASC-BLK-SUB                 12590000
126000                                                                  12600000
126100         PERFORM 5100-WRITE-TEMP-STORAGE                          12610000
126200         MOVE +2                   TO ASC-BLK-SUB                 12620000
126300         PERFORM 5100-WRITE-TEMP-STORAGE                          12630000
126400         MOVE +1                   TO ASC-BLK-SUB                 12640000
126500         MOVE +1                   TO PV-BLOCK-NUMBER             12650000
126600                                                                  12660000
126700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12670000
126800             PV-FIRST-BLOCK-IN-ARRAY - 1                          12680000
126900                                                                  12690000
127000         PERFORM                                                  12700000
127100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12710000
127200                                                                  12720000
127300             PERFORM 4410-READ-TEMP-STORAGE                       12730000
127400                                                                  12740000
127500             PERFORM 2151-SET-SELECTED-INDS                       12750000
127600                 VARYING ASC-ITEM-SUB                             12760000
127700                 FROM 1 BY 1                                      12770000
127800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12780000
127900                                                                  12790000
128000             PERFORM 5100-WRITE-TEMP-STORAGE                      12800000
128100                                                                  12810000
128200             ADD +1                TO PV-BLOCK-NUMBER             12820000
128300                                                                  12830000
128400         END-PERFORM                                              12840000
128500                                                                  12850000
128600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12860000
128700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12870000
128800                                                                  12880000
128900         PERFORM                                                  12890000
129000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12900000
129100                   ASC-HIGHEST-BLOCK-WRITTEN                      12910000
129200                                                                  12920000
129300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12930000
129400                                   TO PV-BLOCK-NUMBER             12940000
129500                                                                  12950000
129600             PERFORM 4410-READ-TEMP-STORAGE                       12960000
129700                                                                  12970000
129800             PERFORM 2151-SET-SELECTED-INDS                       12980000
129900                 VARYING ASC-ITEM-SUB                             12990000
130000                 FROM 1 BY 1                                      13000000
130100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13010000
130200                                                                  13020000
130300             PERFORM 5100-WRITE-TEMP-STORAGE                      13030000
130400                                                                  13040000
130500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13050000
130600                                                                  13060000
130700         END-PERFORM                                              13070000
130800                                                                  13080000
130900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13090000
131000                                   TO PV-BLOCK-NUMBER             13100000
131100                                                                  13110000
131200         PERFORM 4410-READ-TEMP-STORAGE                           13120000
131300     END-IF.                                                      13130000
131400                                                                  13140000
131500                                                                  13150000
131600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13160000
131700                       ASC-NUMBER-OF-SELECTED-ITEMS.              13170000
131800                                                                  13180000
131900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13190000
132000                                                                  13200000
132100*----------------------------------------------------------------*13210000
132200*    MARK EACH ITEM AS BEING SELECTED.                           *13220000
132300*----------------------------------------------------------------*13230000
132400 2151-SET-SELECTED-INDS.                                          13240000
132500                                                                  13250000
132600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13260000
132700             NOT EQUAL ZERO                                       13270000
132800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13280000
132900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13290000
133000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13300000
133100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13310000
133200                               TO  TRUE                           13320000
133300         END-IF                                                   13330000
133400     END-IF.                                                      13340000
133500                                                                  13350000
133600******************************************************************13360000
133700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13370000
133800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13380000
133900******************************************************************13390000
134000 2200-MOVE-SCREEN-TO-COMMAREA.                                    13400000
134100                                                                  13410000
134200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13420000
134300     MOVE +1                       TO PV-SUB.                     13430000
134400*                                                                 13440000
134500     PERFORM 3100-SET-SUBSCRIPTS.                                 13450000
134600     IF  ASTRTITL > ZERO                                          13460000
134700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13470000
134800     ELSE                                                         13480000
134900         IF  ASTRTITF = DP015-ERASE-EOF                           13490000
135000             INITIALIZE ASC-START-ITEM-REQUEST                    13500000
135100         END-IF                                                   13510000
135200     END-IF.                                                      13520000
135300                                                                  13530000
135400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13540000
135500         VARYING PV-SUB                                           13550000
135600         FROM 1 BY 1                                              13560000
135700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13570000
135800******************************************************************13580000
135900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13590000
136000******************************************************************13600000
136100 2210-MOVE-LINES-TO-COMMAREA.                                     13610000
136200     IF  MR-SELECTL (PV-SUB) > ZERO                               13620000
136300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13630000
136400         MOVE MR-SELECTI (PV-SUB)                                 13640000
136500                                   TO ASC-TEMP-SELECTED-SW        13650000
136600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13660000
136700     ELSE                                                         13670000
136800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13680000
136900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13690000
137000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13700000
137100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13710000
137200         END-IF                                                   13720000
137300     END-IF.                                                      13730000
137400     ADD +1                        TO ASC-ITEM-SUB.               13740000
137500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13750000
137600         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13760000
137700             COMPUTE PV-BLOCK-NUMBER  =                           13770000
137800                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         13780000
137900                    PC-ITEMS-PER-PANEL                            13790000
138000             PERFORM 5105-REWRITE-ASC-LISTQ                       13800000
138100         END-IF                                                   13810000
138200         ADD +1                    TO ASC-BLK-SUB                 13820000
138300         MOVE +1                   TO ASC-ITEM-SUB                13830000
138400     ELSE                                                         13840000
138500     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             13850000
138600         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13860000
138700             COMPUTE PV-BLOCK-NUMBER  =                           13870000
138800                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         13880000
138900                    PC-ITEMS-PER-PANEL                            13890000
139000             PERFORM 5105-REWRITE-ASC-LISTQ                       13900000
139100         END-IF                                                   13910000
139200     END-IF.                                                      13920000
139300                                                                  13930000
139400******************************************************************13940000
139500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13950000
139600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13960000
139700******************************************************************13970000
139800 3000-EDIT-DATA-IN-COMMAREA.                                      13980000
139900     SET PS-NO-ERROR               TO TRUE.                       13990000
140000     PERFORM 3200-RESET-ATTRIBUTES.                               14000000
140100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14010000
140200                                                                  14020000
140300**                                                                14030000
140400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14040000
140500* EDITTING IS DONE FROM THE BOTTOM UP.                            14050000
140600**                                                                14060000
140700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14070000
140800         ASC-ITEMS-DISPLAYED - 1.                                 14080000
140900     PERFORM 3100-SET-SUBSCRIPTS.                                 14090000
141000*                                                                 14100000
141100     IF  PS-NO-ERROR                                              14110000
141200         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14120000
141300     END-IF.                                                      14130000
141400                                                                  14140000
141500     IF  PS-NO-ERROR                                              14150000
141600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14160000
141700     END-IF.                                                      14170000
141800*                                                                 14180000
141900     IF  ((PS-NO-ERROR)                                           14190000
142000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14200000
142100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14210000
142200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14220000
142300     END-IF.                                                      14230000
142400                                                                  14240000
142500*----------------------------------------------------------------*14250000
142600*   3005-EDIT-COMMAREA-BLOCKS                                    *14260000
142700*----------------------------------------------------------------*14270000
142800 3005-EDIT-COMMAREA-BLOCKS.                                       14280000
142900     MOVE +1                       TO PV-BLOCK-NUMBER.            14290000
143000     MOVE +1                       TO ASC-BLK-SUB.                14300000
143100     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               14310000
143200                                                                  14320000
143300     COMPUTE PV-BLOCK-NUMBER  =                                   14330000
143400        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 14340000
143500            PC-ITEMS-PER-PANEL.                                   14350000
143600                                                                  14360000
143700     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          14370000
143800                                                                  14380000
143900     PERFORM                                                      14390000
144000       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          14400000
144100          OR PS-ERROR                                             14410000
144200          OR PS-BLOCK-ERROR                                       14420000
144300                                                                  14430000
144400             COMPUTE PV-ITEMS-HOLD  =                             14440000
144500                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        14450000
144600                     PC-ITEMS-PER-PANEL - 1                       14460000
144700                                                                  14470000
144800             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       14480000
144900                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               14490000
145000                     FROM  PV-ITEMS-HOLD                          14500000
145100                   GIVING  PV-ITEMS-DIFF                          14510000
145200                 SUBTRACT  PV-ITEMS-DIFF                          14520000
145300                     FROM  PC-ITEMS-PER-PANEL                     14530000
145400                   GIVING  PV-ITEMS-HOLD                          14540000
145500                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              14550000
145600                                              ASC-ITEM-SUB        14560000
145700                                              ASC-ITEMS-DISPLAYED 14570000
145800             ELSE                                                 14580000
145900                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              14590000
146000                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        14600000
146100             END-IF                                               14610000
146200                                                                  14620000
146300             PERFORM 3300-EDIT-SELECTIONS                         14630000
146400                     VARYING PV-SUB                               14640000
146500                        FROM PV-SUB BY -1                         14650000
146600                       UNTIL PV-SUB < +1                          14660000
146700                                                                  14670000
146800             MOVE +1               TO ASC-BLK-SUB                 14680000
146900                                                                  14690000
147000             PERFORM 5105-REWRITE-ASC-LISTQ                       14700000
147100                                                                  14710000
147200             MOVE +1                TO ASC-BLK-SUB                14720000
147300                                                                  14730000
147400             IF  PS-BLOCK-ERROR                                   14740000
147500                 SET  PS-ERROR     TO TRUE                        14750000
147600                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        14760000
147700                                   TO PV-TOP-ITEM                 14770000
147800             ELSE                                                 14780000
147900                 ADD  +1           TO PV-BLOCK-NUMBER             14790000
148000                 IF  PV-BLOCK-NUMBER >                            14800000
148100                     ASC-HIGHEST-BLOCK-WRITTEN                    14810000
148200                     MOVE +2       TO ASC-BLK-SUB                 14820000
148300                     PERFORM 4410-READ-TEMP-STORAGE               14830000
148400                     MOVE +1       TO ASC-BLK-SUB                 14840000
148500                 ELSE                                             14850000
148600                     PERFORM 4410-READ-TEMP-STORAGE               14860000
148700                     ADD  +1        TO PV-BLOCK-NUMBER            14870000
148800                     MOVE +2        TO ASC-BLK-SUB                14880000
148900                     PERFORM 4410-READ-TEMP-STORAGE               14890000
149000                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            14900000
149100                     MOVE +1        TO ASC-BLK-SUB                14910000
149200                 END-IF                                           14920000
149300             END-IF                                               14930000
149400     END-PERFORM.                                                 14940000
149500                                                                  14950000
149600     IF  PV-ORIGINAL-BLOCK  = +1    OR                            14960000
149700         PS-ERROR                   OR                            14970000
149800         PS-BLOCK-ERROR                                           14980000
149900         CONTINUE                                                 14990000
150000     ELSE                                                         15000000
150100         MOVE +1                 TO PV-BLOCK-NUMBER               15010000
150200         MOVE +1                 TO ASC-BLK-SUB                   15020000
150300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15030000
150400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15040000
150500         PERFORM 4410-READ-TEMP-STORAGE                           15050000
150600                                                                  15060000
150700         PERFORM                                                  15070000
150800           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15080000
150900              OR PS-ERROR                                         15090000
151000              OR PS-BLOCK-ERROR                                   15100000
151100                                                                  15110000
151200                 COMPUTE PV-ITEMS-HOLD  =                         15120000
151300                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15130000
151400                         PC-ITEMS-PER-PANEL - 1                   15140000
151500                                                                  15150000
151600                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15160000
151700                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15170000
151800                         FROM  PV-ITEMS-HOLD                      15180000
151900                       GIVING  PV-ITEMS-DIFF                      15190000
152000                     SUBTRACT  PV-ITEMS-DIFF                      15200000
152100                         FROM  PC-ITEMS-PER-PANEL                 15210000
152200                       GIVING  PV-ITEMS-HOLD                      15220000
152300                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15230000
152400                                                ASC-ITEM-SUB      15240000
152500                                               ASC-ITEMS-DISPLAYED15250000
152600                 ELSE                                             15260000
152700                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          15270000
152800                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    15280000
152900                 END-IF                                           15290000
153000                                                                  15300000
153100                 PERFORM 3300-EDIT-SELECTIONS                     15310000
153200                         VARYING PV-SUB                           15320000
153300                            FROM PV-SUB BY -1                     15330000
153400                           UNTIL PV-SUB < +1                      15340000
153500                                                                  15350000
153600                 MOVE +1               TO ASC-BLK-SUB             15360000
153700                                                                  15370000
153800                 PERFORM 5105-REWRITE-ASC-LISTQ                   15380000
153900                                                                  15390000
154000                 MOVE +1                TO ASC-BLK-SUB            15400000
154100                                                                  15410000
154200                 IF  PS-BLOCK-ERROR                               15420000
154300                     SET  PS-ERROR     TO TRUE                    15430000
154400                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    15440000
154500                                       TO PV-TOP-ITEM             15450000
154600                 ELSE                                             15460000
154700                     ADD  +1            TO PV-BLOCK-NUMBER        15470000
154800                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      15480000
154900                         MOVE +2        TO ASC-BLK-SUB            15490000
155000                         PERFORM 4410-READ-TEMP-STORAGE           15500000
155100                         MOVE +1        TO ASC-BLK-SUB            15510000
155200                     ELSE                                         15520000
155300                         PERFORM 4410-READ-TEMP-STORAGE           15530000
155400                         ADD  +1        TO PV-BLOCK-NUMBER        15540000
155500                         MOVE +2        TO ASC-BLK-SUB            15550000
155600                         PERFORM 4410-READ-TEMP-STORAGE           15560000
155700                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        15570000
155800                         MOVE +1        TO ASC-BLK-SUB            15580000
155900                     END-IF                                       15590000
156000                 END-IF                                           15600000
156100     END-PERFORM.                                                 15610000
156200                                                                  15620000
156300*----------------------------------------------------------------*15630000
156400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15640000
156500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15650000
156600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15660000
156700*                                                                *15670000
156800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15680000
156900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15690000
157000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15700000
157100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15710000
157200*----------------------------------------------------------------*15720000
157300 3100-SET-SUBSCRIPTS.                                             15730000
157400                                                                  15740000
157500     COMPUTE ASC-ITEM-SUB =                                       15750000
157600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15760000
157700                                                                  15770000
157800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15780000
157900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15790000
158000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15800000
158100     ELSE                                                         15810000
158200         MOVE +1                     TO ASC-BLK-SUB               15820000
158300     END-IF.                                                      15830000
158400                                                                  15840000
158500******************************************************************15850000
158600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15860000
158700******************************************************************15870000
158800 3200-RESET-ATTRIBUTES.                                           15880000
158900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15890000
159000     MOVE DP015-GREEN              TO ASTRTITC.                   15900000
159100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15910000
159200                                                                  15920000
159300     PERFORM                                                      15930000
159400         VARYING PV-SUB                                           15940000
159500         FROM 1 BY 1                                              15950000
159600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15960000
159700             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    15970000
159800             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      15980000
159900             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      15990000
160000     END-PERFORM.                                                 16000000
160100                                                                  16010000
160200******************************************************************16020000
160300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16030000
160400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16040000
160500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16050000
160600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16060000
160700******************************************************************16070000
160800 3300-EDIT-SELECTIONS.                                            16080000
160900     EVALUATE TRUE                                                16090000
161000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16100000
161100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16110000
161200                 CONTINUE                                         16120000
161300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16130000
161400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16140000
161500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16150000
161600                 MOVE ASC-TEMP-SELECTED-SW                        16160000
161700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16170000
161800                                TO ASC-SELECTED-SW                16180000
161900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16190000
162000             END-IF                                               16200000
162100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16210000
162200                 = SPACE                                          16220000
162300             EVALUATE TRUE                                        16230000
162400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16240000
162500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16250000
162600                     MOVE SPACE TO ASC-SELECTED-SW                16260000
162700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16270000
162800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16280000
162900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16290000
163000                     MOVE SPACE TO ASC-SELECTED-SW                16300000
163100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16310000
163200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16320000
163300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16330000
163400                     MOVE SPACE TO ASC-SELECTED-SW                16340000
163500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16350000
163600             END-EVALUATE                                         16360000
163700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16370000
163800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16380000
163900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16390000
164000             END-IF                                               16400000
164100             PERFORM 3310-EDIT-RANGE                              16410000
164200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16420000
164300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16430000
164400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16440000
164500             END-IF                                               16450000
164600             PERFORM 3310-EDIT-RANGE                              16460000
164700         WHEN OTHER                                               16470000
164800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16480000
164900             SET DP020-MSG-FATAL    TO TRUE                       16490000
165000             MOVE -1                TO MR-SELECTL (PV-SUB)        16500000
165100             SET DP030-SET-CURSOR-APPL-1                          16510000
165200                                    TO TRUE                       16520000
165300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        16530000
165400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        16540000
165500             SET PS-ERROR TO TRUE                                 16550000
165600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16560000
165700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16570000
165800                 MOVE SPACE         TO ASC-SELECTED-SW            16580000
165900                                        (ASC-BLK-SUB ASC-ITEM-SUB)16590000
166000             END-IF                                               16600000
166100     END-EVALUATE.                                                16610000
166200                                                                  16620000
166300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16630000
166400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16640000
166500     IF  ASC-ITEM-SUB < 1                                         16650000
166600         SUBTRACT +1 FROM ASC-BLK-SUB                             16660000
166700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16670000
166800     END-IF.                                                      16680000
166900                                                                  16690000
167000******************************************************************16700000
167100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16710000
167200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16720000
167300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16730000
167400** THE ENDING.                                                  **16740000
167500******************************************************************16750000
167600 3310-EDIT-RANGE.                                                 16760000
167700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16770000
167800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16780000
167900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16790000
168000                                   TO ASC-SELECTED-SW             16800000
168100                                        (ASC-BLK-SUB ASC-ITEM-SUB)16810000
168200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16820000
168300         ELSE                                                     16830000
168400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16840000
168500                 CONTINUE                                         16850000
168600             ELSE                                                 16860000
168700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16870000
168800                 MOVE PC-TSYMSG-00054                             16880000
168900                                       TO DP020-MSG-NUMBER        16890000
169000                 MOVE -1               TO MR-SELECTL (PV-SUB)     16900000
169100                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     16910000
169200                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     16920000
169300                 SET DP020-MSG-FATAL                              16930000
169400                     DP030-SET-CURSOR-APPL-1                      16940000
169500                     PS-ERROR          TO TRUE                    16950000
169600             END-IF                                               16960000
169700         END-IF                                                   16970000
169800     ELSE                                                         16980000
169900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16990000
170000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17000000
170100                                   TO ASC-SELECTED-SW             17010000
170200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17020000
170300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17030000
170400         ELSE                                                     17040000
170500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17050000
170600                 CONTINUE                                         17060000
170700             ELSE                                                 17070000
170800*                -- ONLY ONE END-OF-RANGE ALLOWED --              17080000
170900                 MOVE PC-TSYMSG-00055                             17090000
171000                                        TO DP020-MSG-NUMBER       17100000
171100                 MOVE -1                TO MR-SELECTL (PV-SUB)    17110000
171200                 SET DP020-MSG-FATAL                              17120000
171300                     DP030-SET-CURSOR-APPL-1                      17130000
171400                     PS-ERROR           TO TRUE                   17140000
171500             END-IF                                               17150000
171600         END-IF                                                   17160000
171700     END-IF.                                                      17170000
171800*                                                                 17180000
171900******************************************************************17190000
172000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17200000
172100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17210000
172200******************************************************************17220000
172300 3400-CHECK-RANGE-SEQUENCE.                                       17230000
172400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17240000
172500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17250000
172600       AND  ASC-START-OF-SELECTED-RANGE >                         17260000
172700                                         ASC-END-OF-SELECTED-RANGE17270000
172800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17280000
172900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17290000
173000         SET DP020-MSG-FATAL TO TRUE                              17300000
173100         SET PS-ERROR TO TRUE                                     17310000
173200         PERFORM 3410-POSITION-AT-ERROR                           17320000
173300     END-IF.                                                      17330000
173400******************************************************************17340000
173500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17350000
173600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **17360000
173700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **17370000
173800******************************************************************17380000
173900 3410-POSITION-AT-ERROR.                                          17390000
174000     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       17400000
174100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17410000
174200                    - PV-TOP-ITEM + 1.                            17420000
174300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17430000
174400         CONTINUE                                                 17440000
174500     ELSE                                                         17450000
174600         MOVE -1                   TO MR-SELECTL (PV-SUB)         17460000
174700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17470000
174800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17480000
174900     END-IF.                                                      17490000
175000*                                                                 17500000
175100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17510000
175200                    - PV-TOP-ITEM + 1.                            17520000
175300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17530000
175400         CONTINUE                                                 17540000
175500     ELSE                                                         17550000
175600         MOVE -1                   TO MR-SELECTL (PV-SUB)         17560000
175700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17570000
175800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17580000
175900     END-IF.                                                      17590000
176000                                                                  17600000
176100*----------------------------------------------------------------*17610000
176200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17620000
176300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17630000
176400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17640000
176500*----------------------------------------------------------------*17650000
176600 3500-MARK-RANGE-AS-SELECTED.                                     17660000
176700     MOVE +1                       TO  ASC-BLK-SUB.               17670000
176800     PERFORM 3510-MARK-SELECTED-INDS                              17680000
176900         VARYING ASC-ITEM-SUB                                     17690000
177000         FROM 1 BY 1                                              17700000
177100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17710000
177200                                                                  17720000
177300     ADD +1                        TO ASC-BLK-SUB.                17730000
177400     PERFORM 3510-MARK-SELECTED-INDS                              17740000
177500         VARYING ASC-ITEM-SUB                                     17750000
177600         FROM 1 BY 1                                              17760000
177700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17770000
177800                                                                  17780000
177900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17790000
178000                                   TO  PV-LIST-ITEM-NUMBER.       17800000
178100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17810000
178200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17820000
178300               PC-ITEMS-PER-PANEL).                               17830000
178400                                                                  17840000
178500     MOVE ASC-START-OF-SELECTED-RANGE                             17850000
178600                                   TO PV-START-OF-SELECTED-RANGE. 17860000
178700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17870000
178800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17880000
178900               PC-ITEMS-PER-PANEL).                               17890000
179000                                                                  17900000
179100     MOVE ASC-END-OF-SELECTED-RANGE                               17910000
179200                                   TO  PV-END-OF-SELECTED-RANGE.  17920000
179300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17930000
179400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17940000
179500               PC-ITEMS-PER-PANEL).                               17950000
179600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17960000
179700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17970000
179800                                                                  17980000
179900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17990000
180000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18000000
180100         MOVE +1                   TO ASC-BLK-SUB                 18010000
180200         PERFORM 5100-WRITE-TEMP-STORAGE                          18020000
180300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18030000
180400             PV-FIRST-BLOCK-IN-ARRAY - 1                          18040000
180500                                                                  18050000
180600         PERFORM                                                  18060000
180700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18070000
180800                   PV-PREV-BLOCK-IN-ARRAY                         18080000
180900             MOVE PV-FIRST-BLOCK-IN-RANGE                         18090000
181000                                   TO PV-BLOCK-NUMBER             18100000
181100             PERFORM 4410-READ-TEMP-STORAGE                       18110000
181200             PERFORM 3510-MARK-SELECTED-INDS                      18120000
181300                 VARYING ASC-ITEM-SUB                             18130000
181400                 FROM 1 BY 1                                      18140000
181500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18150000
181600             PERFORM 5100-WRITE-TEMP-STORAGE                      18160000
181700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18170000
181800         END-PERFORM                                              18180000
181900                                                                  18190000
182000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18200000
182100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18210000
182200         PERFORM                                                  18220000
182300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18230000
182400                   PV-LAST-BLOCK-IN-RANGE                         18240000
182500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18250000
182600                                   TO PV-BLOCK-NUMBER             18260000
182700             PERFORM 4410-READ-TEMP-STORAGE                       18270000
182800             PERFORM 3510-MARK-SELECTED-INDS                      18280000
182900                 VARYING ASC-ITEM-SUB                             18290000
183000                 FROM 1 BY 1                                      18300000
183100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18310000
183200             PERFORM 5100-WRITE-TEMP-STORAGE                      18320000
183300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18330000
183400         END-PERFORM                                              18340000
183500                                                                  18350000
183600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18360000
183700                                   TO PV-BLOCK-NUMBER             18370000
183800         PERFORM 4410-READ-TEMP-STORAGE                           18380000
183900     END-IF.                                                      18390000
184000                                                                  18400000
184100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18410000
184200                                      ASC-END-OF-SELECTED-RANGE.  18420000
184300                                                                  18430000
184400*----------------------------------------------------------------*18440000
184500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18450000
184600*----------------------------------------------------------------*18460000
184700 3510-MARK-SELECTED-INDS.                                         18470000
184800                                                                  18480000
184900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18490000
185000                                ASC-ITEM-SUB) >                   18500000
185100         ASC-START-OF-SELECTED-RANGE)                             18510000
185200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18520000
185300                                ASC-ITEM-SUB) =                   18530000
185400         ASC-START-OF-SELECTED-RANGE)                             18540000
185500                                                                  18550000
185600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18560000
185700                                    ASC-ITEM-SUB) <               18570000
185800             ASC-END-OF-SELECTED-RANGE)                           18580000
185900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18590000
186000                                    ASC-ITEM-SUB) =               18600000
186100             ASC-END-OF-SELECTED-RANGE)                           18610000
186200                                                                  18620000
186300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18630000
186400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18640000
186500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18650000
186600                               TO TRUE                            18660000
186700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18670000
186800                               TO TRUE                            18680000
186900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18690000
187000             END-IF                                               18700000
187100         END-IF                                                   18710000
187200     END-IF.                                                      18720000
187300                                                                  18730000
187400*----------------------------------------------------------------*18740000
187500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18750000
187600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18760000
187700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18770000
187800*    DISPLAY THE PANEL TO USER.                                  *18780000
187900*----------------------------------------------------------------*18790000
188000 4000-BUILD-INITIAL-PANEL.                                        18800000
188100                                                                  18810000
188200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18820000
188300                                 ASC-BLOCK-ENTRIES (2).           18830000
188400     MOVE +1                 TO ASC-BLK-SUB.                      18840000
188500     SET ASC-ITEMS-LEFT-ON-DB                                     18850000
188600                             TO TRUE.                             18860000
188700                                                                  18870000
188800     MOVE +0                 TO ASC-ITEM-SUB                      18880000
188900                                ASC-NUMBER-OF-ITEMS-READ          18890000
189000                                ASC-NUMBER-OF-SELECTED-ITEMS      18900000
189100                                ASC-HIGHEST-BLOCK-WRITTEN         18910000
189200                                ASC-START-OF-SELECTED-RANGE       18920000
189300                                ASC-END-OF-SELECTED-RANGE         18930000
189400                                ASC-ITEM-AT-TOP-OF-PANEL          18940000
189500                                ASC-TTL-FASHION                   18950000
189600                                ASC-TTL-INTRNST                   18960000
189700                                ASC-TTL-STORE-EXPECT              18970000
189800                                ASC-TTL-STORE-ON-HAND.            18980000
189900                                                                  18990000
190000     INITIALIZE XL001-ITEM-COMMAREA.                              19000000
190100     SET XL001-BY-NUMERIC-SKU TO TRUE.                            19010000
190200     SET XL001-SELECT-SKU     TO TRUE.                            19020000
190300     MOVE ASC-SKU             TO XL001-KEY-SKU.                   19030000
190400                                                                  19040000
190500     CALL PC-XL001-VSM-PGM USING DFHEIBLK                         19050000
190600                                 XL001-COMMAREA                   19060000
190700                                 XL001-ITEM-COMMAREA.             19070000
190800                                                                  19080000
190900     IF XL001-SUCCESSFUL                                          19090000
191000             MOVE XL001-SKU-DESC    TO ASC-SKU-DESC               19100000
191100             MOVE XL001-INTR-UPC-ID TO DK-UPC-ID                  19110000
191200                                       ASC-UPC-ID                 19120000
191300     END-IF.                                                      19130000
191400                                                                  19140000
191500     PERFORM 4010-OPEN-CURSOR.                                    19150000
191600     PERFORM 4300-READ-ITEMS-FROM-DB.                             19160000
191700     PERFORM 4020-CLOSE-CURSOR.                                   19170000
191800                                                                  19180000
191900     MOVE +1                   TO  PV-TOP-ITEM.                   19190000
192000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19200000
192100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19210000
192200         SET DP020-MSG-FATAL   TO  TRUE                           19220000
192300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19230000
192400     ELSE                                                         19240000
192500         MOVE -1               TO MR-SELECTL (1)                  19250000
192600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19260000
192700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19270000
192800     END-IF.                                                      19280000
192900                                                                  19290000
193000*----------------------------------------------------------------*19300000
193100* OPEN THE CURSOR                                                 19310000
193200*----------------------------------------------------------------*19320000
193300 4010-OPEN-CURSOR.                                                19330000
193400     PERFORM                                                      19340000
193500         WITH TEST AFTER                                          19350000
193600         VARYING PV-RETRY-COUNTER                                 19360000
193700         FROM 1 BY 1                                              19370000
193800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19380000
193900                   OR (SQLCODE = ZERO))                           19390000
194000                                                                  19400000
194100         EXEC SQL                                                 19410000
194200             OPEN SKU-CSR                                         19420000
194300         END-EXEC                                                 19430000
194400                                                                  19440000
194500         EVALUATE TRUE                                            19450000
194600             WHEN SQLCODE = ZERO                                  19460000
194700             WHEN SQLCODE = -904                                  19470000
194800             WHEN SQLCODE = -913                                  19480000
194900                 CONTINUE                                         19490000
195000             WHEN SQLWARN0 NOT = SPACES                           19500000
195100             WHEN SQLCODE < ZERO                                  19510000
195200             WHEN SQLCODE > ZERO                                  19520000
195300                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       19530000
195400                 MOVE 'OPEN CURSOR PROBLEM    - '                 19540000
195500                                   TO DP013-MESSAGE-TEXT (1)      19550000
195600                 MOVE SQLCA        TO DP013-SQLCA                 19560000
195700                 MOVE 'PCT_TRN_CLSN_DTL' TO                       19570000
195800                                      DP013-DB2-TABLE-NAME (1)    19580000
195900                 MOVE 'PCT_TRN_CLSN_BAL' TO                       19590000
196000                                      DP013-DB2-TABLE-NAME (2)    19600000
196100                 SET DP013-DB2-ABEND                              19610000
196200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19620000
196300                 PERFORM DP013-0000-PROCESS-ABEND                 19630000
196400         END-EVALUATE                                             19640000
196500     END-PERFORM.                                                 19650000
196600*                                                                 19660000
196700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19670000
196800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19680000
196900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19690000
197000                                   TO DP013-MESSAGE-TEXT (1)      19700000
197100         MOVE SQLCA                TO DP013-SQLCA                 19710000
197200         MOVE 'PCT_TRN_CLSN_DTL'   TO DP013-DB2-TABLE-NAME (1)    19720000
197300         SET DP013-DB2-ABEND                                      19730000
197400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19740000
197500         PERFORM DP013-0000-PROCESS-ABEND                         19750000
197600     END-IF.                                                      19760000
197700                                                                  19770000
197800*----------------------------------------------------------------*19780000
197900* CLOSE THE CURSOR.                                               19790000
198000*----------------------------------------------------------------*19800000
198100 4020-CLOSE-CURSOR.                                               19810000
198200                                                                  19820000
198300     EXEC SQL                                                     19830000
198400         CLOSE SKU-CSR                                            19840000
198500     END-EXEC.                                                    19850000
198600                                                                  19860000
198700     EVALUATE TRUE                                                19870000
198800         WHEN SQLCODE = ZERO                                      19880000
198900         WHEN SQLCODE = +100                                      19890000
199000             CONTINUE                                             19900000
199100         WHEN SQLWARN0 NOT = SPACES                               19910000
199200         WHEN SQLCODE < ZERO                                      19920000
199300         WHEN SQLCODE > ZERO                                      19930000
199400             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          19940000
199500             MOVE 'CLOSE CURSOR PROBLEM   '                       19950000
199600                               TO DP013-MESSAGE-TEXT (1)          19960000
199700             MOVE SQLCA        TO DP013-SQLCA                     19970000
199800             MOVE 'PCT_TRN_CLSN_DTL' TO                           19980000
199900                                  DP013-DB2-TABLE-NAME (1)        19990000
200000             MOVE 'PCT_TRN_CLSN_BAL' TO                           20000000
200100                                  DP013-DB2-TABLE-NAME (2)        20010000
200200             SET DP013-DB2-ABEND                                  20020000
200300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20030000
200400             PERFORM DP013-0000-PROCESS-ABEND                     20040000
200500     END-EVALUATE.                                                20050000
200600                                                                  20060000
200700*----------------------------------------------------------------*20070000
200800*    SELECT ONHAND QTY FROM XMKCS001                             *20080000
200900*----------------------------------------------------------------*20090000
201000 4200-SELECT-ONHAND-QTY.                                          20100000
201100     INITIALIZE XM003-ITEM-COMMAREA.                              20110000
201200     SET XM003-ONHAND-YES  TO TRUE.                               20120000
201300                                                                  20130000
201400     MOVE ASC-SKU          TO XM003-KEY-SKU.                      20140000
201500     MOVE PCT00014-LOC-NBR TO XM003-KEY-STR-NBR.                  20150000
201600     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    20160000
201700                                                                  20170000
201800     EXEC CICS                                                    20180000
201900          LINK                                                    20190000
202000               PROGRAM (PC-XMKCS001)                              20200000
202100              COMMAREA (XM003-ITEM-COMMAREA)                      20210000
202200                LENGTH (PV-COMMAREA-LENGTH)                       20220000
202300                  RESP (PV-CICS-RESPONSE)                         20230000
202400     END-EXEC.                                                    20240000
202500                                                                  20250000
202600     EVALUATE TRUE                                                20260000
202700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 20270000
202800              EVALUATE TRUE                                       20280000
202900                  WHEN XM003-SUCCESSFUL                           20290000
203000                       MOVE XM003-ONHAND    TO PV-ONHAND-QTY      20300000
203100                  WHEN OTHER                                      20310000
203200                       IF XM003-RETURN-SQLCODE = +100             20320000
203300                           MOVE 0 TO PV-ONHAND-QTY                20330000
203400                       END-IF                                     20340000
203500              END-EVALUATE                                        20350000
203600                                                                  20360000
203700         WHEN OTHER                                               20370000
203800              MOVE '4200-SELECT-ONHAND-QTY' TO DP013-PARAGRAPH    20380000
203900              MOVE 'SELECT FROM XMKCS001 '                        20390000
204000                               TO DP013-MESSAGE-TEXT (1)          20400000
204100              MOVE SQLCA       TO DP013-SQLCA                     20410000
204200              MOVE 'XMKCS001'   TO DP013-DB2-TABLE-NAME (1)       20420000
204300              SET DP013-DB2-ABEND TO TRUE                         20430000
204400              PERFORM DP013-0000-PROCESS-ABEND                    20440000
204500     END-EVALUATE.                                                20450000
204600                                                                  20460000
204700*----------------------------------------------------------------*20470000
204800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20480000
204900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20490000
205000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20500000
205100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20510000
205200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20520000
205300*                                                                *20530000
205400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20540000
205500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20550000
205600*    UPON INITIALIZATION.                                        *20560000
205700*----------------------------------------------------------------*20570000
205800 4300-READ-ITEMS-FROM-DB.                                         20580000
205900                                                                  20590000
206000     PERFORM                                                      20600000
206100         VARYING PV-READ-COUNT                                    20610000
206200         FROM 1 BY 1                                              20620000
206300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20630000
206400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20640000
206500                                                                  20650000
206600         PERFORM 4310-FETCH                                       20660000
206700                                                                  20670000
206800*** FASHION ON HAND                                               20680000
206900         MOVE ZEROES TO PV-ONHAND-QTY                             20690000
207000         PERFORM 4200-SELECT-ONHAND-QTY                           20700000
207100                                                                  20710000
207200*** STORE ON-HAND                                                 20720000
207300***** THERE IS ONLY ONE WAY TO CALCULATE TOTAL STORE ON HAND **** 20730000
207400***** THAT IS TO SUBTRACT TOTAL STORE EXPECTED FROM TOTAL    **** 20740000
207500***** FASHION ON HAND GIVING TOTAL STORE ON HAND. 05/2006    **** 20750000
207600**       IF PV-STORE-EXPECTED > 0                                 20760000
207700             SUBTRACT  PV-STORE-EXPECTED                          20770000
207800                 FROM  PV-ONHAND-QTY                              20780000
207900               GIVING  PV-STORE-ON-HAND                           20790000
208000**       ELSE                                                     20800000
208100**           COMPUTE PV-STORE-ON-HAND =                           20810000
208200**               PV-STORE-EXPECTED + PV-ONHAND-QTY                20820000
208300**       END-IF                                                   20830000
208400                                                                  20840000
208500         IF  ASC-UNBAL-SEQ                                        20850000
208600           IF  PV-STORE-EXPECTED NOT EQUAL ZERO                   20860000
208700             IF  ASC-ITEMS-LEFT-ON-DB                             20870000
208800               IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL              20880000
208900                   ADD +1            TO ASC-ITEM-SUB              20890000
209000               ELSE                                               20900000
209100                   ADD +1            TO ASC-BLK-SUB               20910000
209200                   MOVE +1           TO ASC-ITEM-SUB              20920000
209300                                                                  20930000
209400                   IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       20940000
209500                       MOVE +1       TO ASC-BLK-SUB               20950000
209600                       SET ASC-BLOCK-MODIFIED (1) TO TRUE         20960000
209700                       PERFORM 5100-WRITE-TEMP-STORAGE            20970000
209800                       MOVE ASC-BLOCK-ENTRIES                     20980000
209900                                   (PC-MAX-BLOCKS-IN-ARRAY)       20990000
210000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21000000
210100                       ADD +1        TO ASC-BLK-SUB               21010000
210200                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB) 21020000
210300                       SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)    21030000
210400                                                          TO TRUE 21040000
210500                   END-IF                                         21050000
210600               END-IF                                             21060000
210700               ADD +1                TO ASC-NUMBER-OF-ITEMS-READ  21070000
210800               SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE        21080000
210900               MOVE ASC-NUMBER-OF-ITEMS-READ                      21090000
211000                                   TO ASC-LIST-ITEM-NUMBER        21100000
211100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21110000
211200               MOVE PCT00014-LOC-NBR                              21120000
211300                           TO ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)21130000
211400               PERFORM 4340-GET-STORE-NAME                        21140000
211500               MOVE XL071-LOC-10-ABBR-NM                          21150000
211600                       TO ASC-STR-NAME (ASC-BLK-SUB ASC-ITEM-SUB) 21160000
211700               MOVE PV-ONHAND-QTY                                 21170000
211800                        TO ASC-FASH-QTY (ASC-BLK-SUB ASC-ITEM-SUB)21180000
211900               MOVE PV-INTRANSIT-QTY                              21190000
212000                         TO ASC-TRN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)21200000
212100               MOVE PV-STORE-EXPECTED                             21210000
212200                         TO ASC-STR-EXP (ASC-BLK-SUB ASC-ITEM-SUB)21220000
212300               MOVE PV-STORE-ON-HAND                              21230000
212400                         TO ASC-STR-ONH (ASC-BLK-SUB ASC-ITEM-SUB)21240000
212500               MOVE PCT00014-LAST-UPD-DTE TO PV-TMST              21250000
212600               MOVE PV-TMST-CCYY  TO  PV-DISPLAY-CCYY             21260000
212700               MOVE PV-TMST-MM    TO  PV-DISPLAY-MM               21270000
212800               MOVE PV-TMST-DD    TO  PV-DISPLAY-DD               21280000
212900               MOVE PV-DATE-DISPLAY                               21290000
213000                            TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)21300000
213100             END-IF                                               21310000
213200           ELSE                                                   21320000
213300             CONTINUE                                             21330000
213400           END-IF                                                 21340000
213500         ELSE                                                     21350000
213600           IF  ASC-BALCD-SEQ                                      21360000
213700             IF  PV-STORE-EXPECTED EQUAL ZERO                     21370000
213800               IF  ASC-ITEMS-LEFT-ON-DB                           21380000
213900                 IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL            21390000
214000                     ADD +1            TO ASC-ITEM-SUB            21400000
214100                 ELSE                                             21410000
214200                     ADD +1            TO ASC-BLK-SUB             21420000
214300                     MOVE +1           TO ASC-ITEM-SUB            21430000
214400                                                                  21440000
214500                     IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY     21450000
214600                         MOVE +1       TO ASC-BLK-SUB             21460000
214700                         SET ASC-BLOCK-MODIFIED (1) TO TRUE       21470000
214800                         PERFORM 5100-WRITE-TEMP-STORAGE          21480000
214900                         MOVE ASC-BLOCK-ENTRIES                   21490000
215000                                   (PC-MAX-BLOCKS-IN-ARRAY)       21500000
215100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21510000
215200                         ADD +1        TO ASC-BLK-SUB             21520000
215300                         INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)21530000
215400                         SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)  21540000
215500                                                          TO TRUE 21550000
215600                     END-IF                                       21560000
215700                 END-IF                                           21570000
215800                 ADD +1                TO ASC-NUMBER-OF-ITEMS-READ21580000
215900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      21590000
216000                 MOVE ASC-NUMBER-OF-ITEMS-READ                    21600000
216100                                   TO ASC-LIST-ITEM-NUMBER        21610000
216200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21620000
216300                 MOVE PCT00014-LOC-NBR                            21630000
216400                           TO ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)21640000
216500                 PERFORM 4340-GET-STORE-NAME                      21650000
216600                 MOVE XL071-LOC-10-ABBR-NM                        21660000
216700                       TO ASC-STR-NAME (ASC-BLK-SUB ASC-ITEM-SUB) 21670000
216800                 MOVE PV-ONHAND-QTY                               21680000
216900                        TO ASC-FASH-QTY (ASC-BLK-SUB ASC-ITEM-SUB)21690000
217000                 MOVE PV-INTRANSIT-QTY                            21700000
217100                         TO ASC-TRN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)21710000
217200                 MOVE PV-STORE-EXPECTED                           21720000
217300                         TO ASC-STR-EXP (ASC-BLK-SUB ASC-ITEM-SUB)21730000
217400                 MOVE PV-STORE-ON-HAND                            21740000
217500                         TO ASC-STR-ONH (ASC-BLK-SUB ASC-ITEM-SUB)21750000
217600                 MOVE PCT00014-LAST-UPD-DTE TO PV-TMST            21760000
217700                 MOVE PV-TMST-CCYY  TO  PV-DISPLAY-CCYY           21770000
217800                 MOVE PV-TMST-MM    TO  PV-DISPLAY-MM             21780000
217900                 MOVE PV-TMST-DD    TO  PV-DISPLAY-DD             21790000
218000                 MOVE PV-DATE-DISPLAY                             21800000
218100                            TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)21810000
218200               END-IF                                             21820000
218300             ELSE                                                 21830000
218400               CONTINUE                                           21840000
218500             END-IF                                               21850000
218600           ELSE                                                   21860000
218700             IF  ASC-ITEMS-LEFT-ON-DB                             21870000
218800               IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL              21880000
218900                   ADD +1            TO ASC-ITEM-SUB              21890000
219000               ELSE                                               21900000
219100                   ADD +1            TO ASC-BLK-SUB               21910000
219200                   MOVE +1           TO ASC-ITEM-SUB              21920000
219300                                                                  21930000
219400                   IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       21940000
219500                       MOVE +1       TO ASC-BLK-SUB               21950000
219600                       SET ASC-BLOCK-MODIFIED (1) TO TRUE         21960000
219700                       PERFORM 5100-WRITE-TEMP-STORAGE            21970000
219800                       MOVE ASC-BLOCK-ENTRIES                     21980000
219900                                   (PC-MAX-BLOCKS-IN-ARRAY)       21990000
220000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22000000
220100                       ADD +1        TO ASC-BLK-SUB               22010000
220200                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB) 22020000
220300                       SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)    22030000
220400                                                          TO TRUE 22040000
220500                   END-IF                                         22050000
220600               END-IF                                             22060000
220700               ADD +1                TO ASC-NUMBER-OF-ITEMS-READ  22070000
220800               SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE        22080000
220900               MOVE ASC-NUMBER-OF-ITEMS-READ                      22090000
221000                                   TO ASC-LIST-ITEM-NUMBER        22100000
221100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22110000
221200               MOVE PCT00014-LOC-NBR                              22120000
221300                           TO ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)22130000
221400               PERFORM 4340-GET-STORE-NAME                        22140000
221500               MOVE XL071-LOC-10-ABBR-NM                          22150000
221600                       TO ASC-STR-NAME (ASC-BLK-SUB ASC-ITEM-SUB) 22160000
221700               MOVE PV-ONHAND-QTY                                 22170000
221800                        TO ASC-FASH-QTY (ASC-BLK-SUB ASC-ITEM-SUB)22180000
221900               MOVE PV-INTRANSIT-QTY                              22190000
222000                         TO ASC-TRN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)22200000
222100               MOVE PV-STORE-EXPECTED                             22210000
222200                         TO ASC-STR-EXP (ASC-BLK-SUB ASC-ITEM-SUB)22220000
222300               MOVE PV-STORE-ON-HAND                              22230000
222400                         TO ASC-STR-ONH (ASC-BLK-SUB ASC-ITEM-SUB)22240000
222500               MOVE PCT00014-LAST-UPD-DTE TO PV-TMST              22250000
222600               MOVE PV-TMST-CCYY  TO  PV-DISPLAY-CCYY             22260000
222700               MOVE PV-TMST-MM    TO  PV-DISPLAY-MM               22270000
222800               MOVE PV-TMST-DD    TO  PV-DISPLAY-DD               22280000
222900               MOVE PV-DATE-DISPLAY                               22290000
223000                            TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)22300000
223100             END-IF                                               22310000
223200           END-IF                                                 22320000
223300         END-IF                                                   22330000
223400     END-PERFORM.                                                 22340000
223500                                                                  22350000
223600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22360000
223700         MOVE +1               TO ASC-BLK-SUB                     22370000
223800         PERFORM 5100-WRITE-TEMP-STORAGE                          22380000
223900         ADD +1                TO ASC-BLK-SUB                     22390000
224000         PERFORM 5100-WRITE-TEMP-STORAGE                          22400000
224100                                                                  22410000
224200         MOVE 1                TO ASC-BLK-SUB                     22420000
224300                                  PV-BLOCK-NUMBER                 22430000
224400         PERFORM 4410-READ-TEMP-STORAGE                           22440000
224500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22450000
224600             MOVE 2            TO ASC-BLK-SUB                     22460000
224700                                  PV-BLOCK-NUMBER                 22470000
224800             PERFORM 4410-READ-TEMP-STORAGE                       22480000
224900         END-IF                                                   22490000
225000     END-IF.                                                      22500000
225100                                                                  22510000
225200*----------------------------------------------------------------*22520000
225300*    FETCH THE CURSOR                                             22530000
225400*----------------------------------------------------------------*22540000
225500 4310-FETCH.                                                      22550000
225600                                                                  22560000
225700     INITIALIZE DCLPCT00014.                                      22570000
225800                                                                  22580000
225900         EXEC SQL                                                 22590000
226000              FETCH SKU-CSR                                       22600000
226100                  INTO  :PCT00014-LOC-NBR                         22610000
226200                       ,:PCT00014-LAST-UPD-DTE                    22620000
226300         END-EXEC                                                 22630000
226400                                                                  22640000
226500     EVALUATE TRUE                                                22650000
226600         WHEN SQLCODE = ZERO                                      22660000
226700         WHEN SQLCODE = -305                                      22670000
226800              PERFORM 4320-GET-INTRANSIT                          22680000
226900              PERFORM 4330-GET-STORE-EXPECTED                     22690000
227000                                                                  22700000
227100         WHEN SQLCODE = +100                                      22710000
227200               SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                22720000
227300                                                                  22730000
227400         WHEN SQLWARN0 NOT = SPACE                                22740000
227500         WHEN SQLCODE NOT = ZERO                                  22750000
227600              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         22760000
227700              MOVE 'FETCH CURSOR PROBLEM '                        22770000
227800                               TO DP013-MESSAGE-TEXT (1)          22780000
227900              MOVE SQLCA       TO DP013-SQLCA                     22790000
228000              MOVE 'PCT_TRN_CLSN_BAL' TO                          22800000
228100                                   DP013-DB2-TABLE-NAME (1)       22810000
228200              SET DP013-DB2-ABEND TO TRUE                         22820000
228300              PERFORM DP013-0000-PROCESS-ABEND                    22830000
228400     END-EVALUATE.                                                22840000
228500                                                                  22850000
228600*----------------------------------------------------------------*22860000
228700* GET INTRANSIT QUANTITY                                         *22870000
228800*----------------------------------------------------------------*22880000
228900 4320-GET-INTRANSIT.                                              22890000
229000                                                                  22900000
229100     INITIALIZE PV-NULL-IND-1.                                    22910000
229200     EXEC SQL                                                     22920000
229300          SELECT  SUM(TRN_CLSN_PRCG_QTY)                          22930000
229400            INTO :PV-INTRANSIT-QTY  :PV-NULL-IND-1                22940000
229500            FROM  PCT_TRN_CLSN_DTL                                22950000
229600           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 22960000
229700             AND  LOC_NBR           =  :PCT00014-LOC-NBR          22970000
229800             AND  TRN_CLSN_CDE      =  'IT'                       22980000
229900             AND  PO_NBR            =  :ASC-PO-NBR                22990000
230000             AND  RCVR_SEQ_NBR      =  :ASC-RCVR-NBR              23000000
230100     END-EXEC.                                                    23010000
230200                                                                  23020000
230300     EVALUATE TRUE                                                23030000
230400         WHEN SQLCODE = ZERO                                      23040000
230500             IF PV-NULL-IND-1 < 0                                 23050000
230600                 MOVE ZEROES  TO  PV-INTRANSIT-QTY                23060000
230700             ELSE                                                 23070000
230800                 CONTINUE                                         23080000
230900             END-IF                                               23090000
231000                                                                  23100000
231100         WHEN SQLCODE = +100                                      23110000
231200              MOVE ZEROES  TO  PV-INTRANSIT-QTY                   23120000
231300                                                                  23130000
231400         WHEN OTHER                                               23140000
231500              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           23150000
231600              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC           23160000
231700              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         23170000
231800              MOVE '4320-GET-INTRANSIT' TO DP013-PARAGRAPH        23180000
231900              MOVE 'GET INTRANSIT QTY    '                        23190000
232000                               TO DP013-MESSAGE-TEXT (1)          23200000
232100              STRING 'SKU='    PV-DISPLAY-SKU     '  '            23210000
232200                     'UPC-ID=' PV-DISPLAY-UPC     '  '            23220000
232300                     'STORE='  PV-DISPLAY-STORE                   23230000
232400                                  DELIMITED BY SIZE               23240000
232500                             INTO DP013-MESSAGE-TEXT (2)          23250000
232600              MOVE SQLCA       TO DP013-SQLCA                     23260000
232700              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       23270000
232800              SET DP013-DB2-ABEND TO TRUE                         23280000
232900              PERFORM DP013-0000-PROCESS-ABEND                    23290000
233000     END-EVALUATE.                                                23300000
233100                                                                  23310000
233200*----------------------------------------------------------------*23320000
233300* GET STORE EXPECTED QUANTITY                                    *23330000
233400*----------------------------------------------------------------*23340000
233500 4330-GET-STORE-EXPECTED.                                         23350000
233600                                                                  23360000
233700     INITIALIZE PV-NULL-IND-2.                                    23370000
233800     EXEC SQL                                                     23380000
233900          SELECT  SUM(TRN_CLSN_PRCG_QTY)                          23390000
234000            INTO :PV-STORE-EXPECTED :PV-NULL-IND-2                23400000
234100            FROM  PCT_TRN_CLSN_DTL                                23410000
234200           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 23420000
234300             AND  LOC_NBR           =  :PCT00014-LOC-NBR          23430000
234400             AND  TRN_CLSN_CDE      =  'SE'                       23440000
234500             AND  PO_NBR            =  :ASC-PO-NBR                23450000
234600             AND  RCVR_SEQ_NBR      =  :ASC-RCVR-NBR              23460000
234700             AND  TRN_TYP_CDE NOT IN ('UM', 'NS', 'MM',           23470009
234800                                      'AM', 'SM')                 23480009
234900     END-EXEC.                                                    23490000
235000                                                                  23500000
235100     EVALUATE TRUE                                                23510000
235200         WHEN SQLCODE = ZERO                                      23520000
235300              IF PV-NULL-IND-2 < 0                                23530000
235400                  MOVE ZEROES  TO  PV-STORE-EXPECTED              23540000
235500              ELSE                                                23550000
235600                  CONTINUE                                        23560000
235700              END-IF                                              23570000
235800                                                                  23580000
235900         WHEN SQLCODE = +100                                      23590000
236000              MOVE ZEROES  TO  PV-STORE-EXPECTED                  23600000
236100                                                                  23610000
236200         WHEN OTHER                                               23620000
236300              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           23630000
236400              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC           23640000
236500              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         23650000
236600              MOVE '4330-GET-STORE-EXPECTED' TO DP013-PARAGRAPH   23660000
236700              MOVE 'GET STORE EXPECTED QUANTITY '                 23670000
236800                               TO DP013-MESSAGE-TEXT (1)          23680000
236900              STRING 'SKU='    PV-DISPLAY-SKU     '  '            23690000
237000                     'UPC-ID=' PV-DISPLAY-UPC     '  '            23700000
237100                     'STORE='  PV-DISPLAY-STORE                   23710000
237200                                  DELIMITED BY SIZE               23720000
237300                             INTO DP013-MESSAGE-TEXT (2)          23730000
237400              MOVE SQLCA       TO DP013-SQLCA                     23740000
237500              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       23750000
237600              SET DP013-DB2-ABEND TO TRUE                         23760000
237700              PERFORM DP013-0000-PROCESS-ABEND                    23770000
237800     END-EVALUATE.                                                23780000
237900                                                                  23790000
238000*----------------------------------------------------------------*23800000
238100* GET STORE NAME                                                 *23810000
238200*----------------------------------------------------------------*23820000
238300 4340-GET-STORE-NAME.                                             23830000
238400                                                                  23840000
238500     INITIALIZE XL071-COMMAREA-REC.                               23850000
238600     MOVE PCT00014-LOC-NBR       TO XL071-LOCATION-NUMBER.        23860000
238700                                                                  23870000
238800     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      23880000
238900                                    XL071-COMMAREA                23890000
239000                                    XL071-COMMAREA-REC.           23900000
239100     EVALUATE TRUE                                                23910000
239200         WHEN XL071-NO-ERRORS                                     23920000
239300              CONTINUE                                            23930000
239400         WHEN XL071-LOC-NOT-FOUND                                 23940000
239500              MOVE 'NO NAME'  TO  XL071-LOC-10-ABBR-NM            23950000
239600         WHEN XL071-BAD-DB2-RETURN                                23960000
239700              MOVE ASC-SKU           TO  PV-DISPLAY-SKU           23970000
239800              MOVE DK-UPC-ID         TO  PV-DISPLAY-UPC           23980000
239900              MOVE PCT00014-LOC-NBR  TO  PV-DISPLAY-STORE         23990000
240000              MOVE '4340-GET-STORE-NAME' TO DP013-PARAGRAPH       24000000
240100              MOVE 'GET STORE NAME USING LOCATION MODULE'         24010000
240200                               TO DP013-MESSAGE-TEXT (1)          24020000
240300              STRING 'SKU='    PV-DISPLAY-SKU     '  '            24030000
240400                     'UPC-ID=' PV-DISPLAY-UPC     '  '            24040000
240500                     'STORE='  PV-DISPLAY-STORE                   24050000
240600                                  DELIMITED BY SIZE               24060000
240700                             INTO DP013-MESSAGE-TEXT (2)          24070000
240800              MOVE SQLCA       TO DP013-SQLCA                     24080000
240900              MOVE 'XLT_LOC'   TO DP013-DB2-TABLE-NAME (1)        24090000
241000              SET DP013-DB2-ABEND TO TRUE                         24100000
241100              PERFORM DP013-0000-PROCESS-ABEND                    24110000
241200     END-EVALUATE.                                                24120000
241300                                                                  24130000
241400*----------------------------------------------------------------*24140000
241500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *24150000
241600*----------------------------------------------------------------*24160000
241700 4400-MOVE-COMMAREA-TO-SCREEN.                                    24170000
241800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             24180000
241900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          24190000
242000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          24200000
242100             MOVE +1    TO ASC-BLK-SUB                            24210000
242200             PERFORM 5100-WRITE-TEMP-STORAGE                      24220000
242300             ADD +1     TO ASC-BLK-SUB                            24230000
242400             PERFORM 5100-WRITE-TEMP-STORAGE                      24240000
242500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             24250000
242600                 GIVING PV-BLOCK-NUMBER                           24260000
242700                 REMAINDER PV-REMAINDER                           24270000
242800             IF  PV-REMAINDER > ZERO                              24280000
242900                 ADD +1 TO PV-BLOCK-NUMBER                        24290000
243000             END-IF                                               24300000
243100             MOVE +1    TO ASC-BLK-SUB                            24310000
243200             PERFORM 4410-READ-TEMP-STORAGE                       24320000
243300             ADD +1     TO ASC-BLK-SUB                            24330000
243400                           PV-BLOCK-NUMBER                        24340000
243500             PERFORM 4410-READ-TEMP-STORAGE                       24350000
243600     END-IF.                                                      24360000
243700     MOVE +1            TO ASC-BLK-SUB.                           24370000
243800     COMPUTE ASC-ITEM-SUB =                                       24380000
243900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              24390000
244000         + PC-ITEMS-PER-PANEL).                                   24400000
244100*                                                                 24410000
244200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        24420000
244300         ADD +1         TO ASC-BLK-SUB                            24430000
244400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24440000
244500     END-IF.                                                      24450000
244600*                                                                 24460000
244700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24470000
244800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24480000
244900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        24490000
245000     PERFORM 4420-FORMAT-LIST-LINES                               24500000
245100         VARYING PV-SUB                                           24510000
245200         FROM PC-ITEMS-PER-PANEL BY -1                            24520000
245300         UNTIL PV-SUB < +1.                                       24530000
245400*                                                                 24540000
245500     COMPUTE ASC-ITEMS-DISPLAYED =                                24550000
245600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24560000
245700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24570000
245800                                      ASTRTITO.                   24580000
245900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    24590000
246000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    24600000
246100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24610000
246200                                   TO ASELITO.                    24620000
246300                                                                  24630000
246400     MOVE ASC-SKU              TO  ASKUO.                         24640000
246500     MOVE ASC-SKU-DESC         TO  ADESCO.                        24650000
246600     MOVE  ASC-PO-NBR          TO  PV-DISPLAY-PO.                 24660000
246700                                                                  24670012
246800     PERFORM 4405-GET-BOSS-PARM-RCVR.                             24680018
246900** IF BOSS RECEIVER DISPLAY 'BSS' IN RECEIVER FIELD               24690019
247000     IF ASC-RCVR-NBR = PV-BOSS-PARM-RECV                          24700019
247100        STRING PV-DISPLAY-PO DELIMITED BY SIZE                    24710018
247200            '-'    DELIMITED BY SPACE                             24720018
247300            PC-DISPLAY-BSS   DELIMITED BY SIZE                    24730018
247400                      INTO            APORCVRO                    24740018
247500     ELSE                                                         24750018
247600        MOVE  ASC-RCVR-NBR        TO  PV-DISPLAY-RCVR             24760010
247700        STRING PV-DISPLAY-PO DELIMITED BY SIZE                    24770010
247800            '-'    DELIMITED BY SPACE                             24780010
247900            PV-DISPLAY-RCVR DELIMITED BY SIZE                     24790010
248000                      INTO            APORCVRO                    24800010
248100     END-IF.                                                      24810018
248200                                                                  24820000
248300     PERFORM 4500-GET-TOTALS.                                     24830000
248400                                                                  24840000
248500***** THERE IS ONLY ONE WAY TO CALCULATE TOTAL STORE ON HAND **** 24850000
248600***** THAT IS TO SUBTRACT TOTAL STORE EXPECTED FROM TOTAL    **** 24860000
248700***** FASHION ON HAND GIVING TOTAL STORE ON HAND. 05/2006    **** 24870000
248800**   IF  PV-TTL-STORE-EXPECT > 0                                  24880000
248900         SUBTRACT  PV-TTL-STORE-EXPECT                            24890000
249000             FROM  PV-TTL-ONHAND-QTY                              24900000
249100         GIVING  ASC-TTL-STORE-ON-HAND                            24910000
249200**   ELSE                                                         24920000
249300**       COMPUTE ASC-TTL-STORE-ON-HAND =                          24930000
249400**           PV-TTL-STORE-EXPECT  +  PV-TTL-ONHAND-QTY            24940000
249500**   END-IF.                                                      24950000
249600                                                                  24960000
249700     MOVE ASC-TTL-FASHION            TO AFASHO.                   24970000
249800     MOVE ASC-TTL-INTRNST            TO ATRANO.                   24980000
249900     MOVE ASC-TTL-STORE-EXPECT       TO AEXPTO.                   24990000
250000     MOVE ASC-TTL-STORE-ON-HAND      TO ASTORO.                   25000000
250100     IF ASC-BALCD-SEQ                                             25010000
250200         MOVE 'BALANCED  '           TO ASEQO                     25020000
250300     ELSE                                                         25030000
250400         IF ASC-UNBAL-SEQ                                         25040000
250500             MOVE 'UNBALANCED'       TO ASEQO                     25050000
250600         ELSE                                                     25060000
250700             MOVE SPACES             TO ASEQO                     25070000
250800         END-IF                                                   25080000
250900     END-IF.                                                      25090000
251000                                                                  25100000
251100     IF  DP020-MSG-NUMBER-X = SPACE                               25110000
251200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25120000
251300*            --- MORE ITEMS TO DISPLAY ----                       25130000
251400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25140000
251500             SET DP020-MSG-INFORMATIONAL TO TRUE                  25150000
251600         END-IF                                                   25160000
251700     END-IF.                                                      25170000
251800                                                                  25180000
251900*----------------------------------------------------------------*25190018
252000*- RETRIEVE THE PARAMETER FROM TKRPRPM TO DETERMINE IF THIS IS    25200019
252100*- A BOSS RECEIVER.                                               25210019
252200*----------------------------------------------------------------*25220018
252300 4405-GET-BOSS-PARM-RCVR.                                         25230018
252400                                                                  25240018
252500     EXEC SQL                                                     25250018
252600          SELECT FUNC_QTY                                         25260018
252700            INTO :PV-BOSS-PARM-RECV                               25270018
252800            FROM TKRPRPM                                          25280018
252900           WHERE LOC_ID            = 90                           25290018
253000             AND INTFC_SYS_CDE     = 'GIV'                        25300018
253100             AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                     25310018
253200             AND FUNC_PRC_STAT_CDE = 'AC'                         25320018
253300         WITH UR                                                  25330018
253400     END-EXEC.                                                    25340018
253500                                                                  25350018
253600     EVALUATE TRUE                                                25360018
253700         WHEN SQLCODE = ZERO                                      25370018
253800              CONTINUE                                            25380018
253900                                                                  25390018
254000         WHEN SQLCODE = +100                                      25400018
254100              MOVE ZERO             TO PV-BOSS-PARM-RECV          25410018
254200                                                                  25420018
254300         WHEN SQLWARN0 NOT = SPACE                                25430018
254400         WHEN SQLCODE NOT = ZERO                                  25440018
254500              MOVE '4405-GET-BOSS-PARM-RCVR'                      25450018
254600                                    TO DP013-PARAGRAPH            25460018
254700              MOVE 'SELECT BOSS PARM'                             25470018
254800                                    TO DP013-MESSAGE-TEXT (1)     25480018
254900              MOVE SQLCA            TO DP013-SQLCA                25490018
255000              MOVE 'TKRPRPM'        TO DP013-DB2-TABLE-NAME (1)   25500018
255100              SET DP013-DB2-ABEND   TO TRUE                       25510018
255200              PERFORM DP013-0000-PROCESS-ABEND                    25520018
255300     END-EVALUATE.                                                25530018
255400                                                                  25540018
255500*----------------------------------------------------------------*25550000
255600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25560000
255700*----------------------------------------------------------------*25570000
255800 4410-READ-TEMP-STORAGE.                                          25580000
255900                                                                  25590000
256000     EXEC CICS                                                    25600000
256100         READQ TS                                                 25610000
256200             QUEUE (ASC-LIST-QUEUE-NAME)                          25620000
256300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25630000
256400             ITEM  (PV-BLOCK-NUMBER)                              25640000
256500             RESP  (PV-CICS-RESP)                                 25650000
256600     END-EXEC.                                                    25660000
256700                                                                  25670000
256800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25680000
256900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25690000
257000         CONTINUE                                                 25700000
257100     ELSE                                                         25710000
257200         SET DP013-CICS-ABEND     TO TRUE                         25720000
257300         SET DP013-NO-ROLLBACK    TO TRUE                         25730000
257400         MOVE '4410-READ-TEMP-STORAGE'                            25740000
257500                                  TO DP013-PARAGRAPH              25750000
257600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25760000
257700                                  TO DP013-MESSAGE-TEXT(1)        25770000
257800         PERFORM DP013-0000-PROCESS-ABEND                         25780000
257900     END-IF.                                                      25790000
258000                                                                  25800000
258100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25810000
258200*                                                                 25820000
258300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         25830000
258400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               25840000
258500     END-IF.                                                      25850000
258600                                                                  25860000
258700*----------------------------------------------------------------*25870000
258800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *25880000
258900*----------------------------------------------------------------*25890000
259000 4420-FORMAT-LIST-LINES.                                          25900000
259100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      25910000
259200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                25920000
259300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           25930000
259400         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           25940000
259500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           25950000
259600         MOVE SPACE              TO MR-STORE         (PV-SUB)     25960000
259700                                    MR-STR-NAME      (PV-SUB)     25970000
259800                                    MR-FASH-QTY      (PV-SUB)     25980000
259900                                    MR-TRN-QTY       (PV-SUB)     25990000
260000                                    MR-STR-EXP       (PV-SUB)     26000000
260100                                    MR-STR-ONH       (PV-SUB)     26010000
260200                                    MR-DATE          (PV-SUB)     26020000
260300     ELSE                                                         26030000
260400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26040000
260500                                                   > SPACE        26050000
260600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26060000
260700                                 TO MR-SELECTI (PV-SUB)           26070000
260800         ELSE                                                     26080000
260900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26090000
261000                                 TO MR-SELECTI (PV-SUB)           26100000
261100         END-IF                                                   26110000
261200         IF  DP030-SET-CURSOR-TRAILER                             26120000
261300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)26130000
261400                 > SPACE)                                         26140000
261500               OR (PV-SUB = 1))                                   26150000
261600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               26160000
261700                MOVE -1          TO MR-SELECTL (PV-SUB)           26170000
261800             END-IF                                               26180000
261900         END-IF                                                   26190000
262000*                                                                 26200000
262100         MOVE ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)                26210000
262200                                           TO  MR-STORE  (PV-SUB) 26220000
262300         MOVE ASC-STR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)             26230000
262400                                         TO  MR-STR-NAME  (PV-SUB)26240000
262500         MOVE ASC-FASH-QTY (ASC-BLK-SUB ASC-ITEM-SUB)             26250000
262600                                        TO  MR-FASH-QTY-N (PV-SUB)26260000
262700         MOVE ASC-TRN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)              26270000
262800                                         TO MR-TRN-QTY-N (PV-SUB) 26280000
262900         MOVE ASC-STR-EXP (ASC-BLK-SUB ASC-ITEM-SUB)              26290000
263000                                         TO  MR-STR-EXP-N (PV-SUB)26300000
263100         MOVE ASC-STR-ONH (ASC-BLK-SUB ASC-ITEM-SUB)              26310000
263200                                         TO  MR-STR-ONH-N (PV-SUB)26320000
263300         MOVE ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)                 26330000
263400                                              TO  MR-DATE (PV-SUB)26340000
263500     END-IF.                                                      26350000
263600     SUBTRACT +1 FROM ASC-ITEM-SUB                                26360000
263700     IF  ASC-ITEM-SUB < + 1                                       26370000
263800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  26380000
263900         MOVE +1                 TO ASC-BLK-SUB                   26390000
264000     END-IF.                                                      26400000
264100                                                                  26410000
264200******************************************************************26420000
264300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **26430000
264400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **26440000
264500** ISSUE A WARNING.                                             **26450000
264600******************************************************************26460000
264700 4430-CHECK-FOR-BEGIN-AND-END.                                    26470000
264800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       26480000
264900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     26490000
265000*            -- NO END-OF-RANGE SPECFIED ---                      26500000
265100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            26510000
265200             SET DP020-MSG-WARNING TO TRUE                        26520000
265300             PERFORM 4431-POSITION-AT-WARNING                     26530000
265400         END-IF                                                   26540000
265500     ELSE                                                         26550000
265600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     26560000
265700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                26570000
265800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            26580000
265900             SET DP020-MSG-WARNING TO TRUE                        26590000
266000             PERFORM 4431-POSITION-AT-WARNING                     26600000
266100         END-IF                                                   26610000
266200     END-IF.                                                      26620000
266300******************************************************************26630000
266400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **26640000
266500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **26650000
266600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **26660000
266700** POSITION THE CURSOR THERE.                                   **26670000
266800******************************************************************26680000
266900 4431-POSITION-AT-WARNING.                                        26690000
267000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 26700000
267100                    - PV-TOP-ITEM + 1.                            26710000
267200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26720000
267300         CONTINUE                                                 26730000
267400     ELSE                                                         26740000
267500         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      26750000
267600         MOVE -1                   TO MR-SELECTL (PV-SUB)         26760000
267700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26770000
267800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         26780000
267900     END-IF.                                                      26790000
268000*                                                                 26800000
268100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   26810000
268200                    - PV-TOP-ITEM + 1.                            26820000
268300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26830000
268400         CONTINUE                                                 26840000
268500     ELSE                                                         26850000
268600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      26860000
268700         MOVE -1                   TO MR-SELECTL (PV-SUB)         26870000
268800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26880000
268900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         26890000
269000     END-IF.                                                      26900000
269100                                                                  26910000
269200******************************************************************26920000
269300* THE TOTALS IN THE HEADER PORTION OF THE SCREEN IS FOR THE       26930000
269400* ENTIRE SKU.                                                     26940000
269500******************************************************************26950000
269600 4500-GET-TOTALS.                                                 26960000
269700     EXEC SQL                                                     26970000
269800          SELECT  SUM(TRN_CLSN_QTY)                               26980000
269900            INTO :PV-TTL-INTRNST-QTY                              26990000
270000            FROM  PCT_TRN_CLSN_BAL                                27000000
270100           WHERE  INTR_UPC_ID       =  :ASC-UPC-ID                27010000
270200             AND  TRN_CLSN_CDE      =  'IT'                       27020000
270300     END-EXEC.                                                    27030000
270400                                                                  27040000
270500     EVALUATE TRUE                                                27050000
270600         WHEN SQLCODE = ZERO                                      27060000
270700              MOVE PV-TTL-INTRNST-QTY TO  ASC-TTL-INTRNST         27070000
270800         WHEN OTHER                                               27080000
270900              MOVE ZEROES             TO  ASC-TTL-INTRNST         27090000
271000     END-EVALUATE.                                                27100000
271100                                                                  27110000
271200     EXEC SQL                                                     27120000
271300          SELECT  SUM(TRN_CLSN_QTY)                               27130000
271400            INTO :PV-TTL-STORE-EXPECT                             27140000
271500            FROM  PCT_TRN_CLSN_BAL                                27150000
271600           WHERE  INTR_UPC_ID       =  :ASC-UPC-ID                27160000
271700             AND  TRN_CLSN_CDE      =  'SE'                       27170000
271800     END-EXEC.                                                    27180000
271900                                                                  27190000
272000     EVALUATE TRUE                                                27200000
272100         WHEN SQLCODE = ZERO                                      27210000
272200              MOVE PV-TTL-STORE-EXPECT TO ASC-TTL-STORE-EXPECT    27220000
272300         WHEN OTHER                                               27230000
272400              MOVE ZEROES              TO ASC-TTL-STORE-EXPECT    27240000
272500     END-EVALUATE.                                                27250000
272600                                                                  27260000
272700     INITIALIZE XM003-ITEM-COMMAREA.                              27270000
272800     SET XM003-ONHAND-YES  TO TRUE.                               27280000
272900                                                                  27290000
273000     MOVE ASC-SKU          TO XM003-KEY-SKU.                      27300000
273100     MOVE ZEROES           TO XM003-KEY-STR-NBR.                  27310000
273200     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    27320000
273300                                                                  27330000
273400     EXEC CICS                                                    27340000
273500          LINK                                                    27350000
273600               PROGRAM (PC-XMKCS001)                              27360000
273700              COMMAREA (XM003-ITEM-COMMAREA)                      27370000
273800                LENGTH (PV-COMMAREA-LENGTH)                       27380000
273900                  RESP (PV-CICS-RESPONSE)                         27390000
274000     END-EXEC.                                                    27400000
274100                                                                  27410000
274200     EVALUATE TRUE                                                27420000
274300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 27430000
274400              EVALUATE TRUE                                       27440000
274500                  WHEN XM003-SUCCESSFUL                           27450000
274600                       MOVE XM003-ONHAND    TO PV-TTL-ONHAND-QTY  27460000
274700                       MOVE PV-TTL-ONHAND-QTY TO ASC-TTL-FASHION  27470000
274800                  WHEN OTHER                                      27480000
274900                       IF XM003-RETURN-SQLCODE = +100             27490000
275000                           MOVE 0 TO PV-TTL-ONHAND-QTY            27500000
275100                                     ASC-TTL-FASHION              27510000
275200                       END-IF                                     27520000
275300              END-EVALUATE                                        27530000
275400                                                                  27540000
275500         WHEN OTHER                                               27550000
275600              MOVE 0 TO PV-TTL-ONHAND-QTY                         27560000
275700                        ASC-TTL-FASHION                           27570000
275800     END-EVALUATE.                                                27580000
275900                                                                  27590000
276000*----------------------------------------------------------------*27600000
276100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27610000
276200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27620000
276300* FOR THE SELECTED ITEMS QUEUE.                                  *27630000
276400*                                                                *27640000
276500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27650000
276600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *27660000
276700* THE ARRAY IS FULL.                                             *27670000
276800*----------------------------------------------------------------*27680000
276900 5000-PREPARE-SEL-QUEUE.                                          27690000
277000                                                                  27700000
277100     MOVE +1                   TO  ASC-BLK-SUB.                   27710000
277200     PERFORM 5100-WRITE-TEMP-STORAGE.                             27720000
277300     ADD +1                    TO  ASC-BLK-SUB.                   27730000
277400     PERFORM 5100-WRITE-TEMP-STORAGE.                             27740000
277500                                                                  27750000
277600     MOVE ASC-SEL-QUEUE-NAME-2 TO  ASC-SEL-QUEUE-NAME.            27760000
277700     MOVE ASC-SEL-QUEUE-NAME   TO  PC211-SEL-QUEUE-NAME.          27770000
277800     PERFORM 6010-DELETE-SEL-QUEUE.                               27780000
277900                                                                  27790000
278000     SET ASC-UPDATE-TSQ        TO  TRUE.                          27800000
278100                                                                  27810000
278200     SET PC212-IDX             TO  1.                             27820000
278300     MOVE ZERO                 TO PC211-NUMBER-OF-TS-ITEMS.       27830000
278400     INITIALIZE PC212-SELECTED-ITEM-ARRAY.                        27840000
278500                                                                  27850000
278600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           27860000
278700             VARYING PV-ITEM                                      27870000
278800             FROM 1 BY 1                                          27880000
278900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     27890000
279000                                                                  27900000
279100     IF  PC212-IDX > 1                                            27910000
279200         PERFORM 5205-WRITE-SEL-QUEUE                             27920000
279300         ADD +1                TO PC211-NUMBER-OF-TS-ITEMS        27930000
279400     END-IF.                                                      27940000
279500*----------------------------------------------------------------*27950000
279600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *27960000
279700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *27970000
279800*----------------------------------------------------------------*27980000
279900 5100-WRITE-TEMP-STORAGE.                                         27990000
280000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     28000000
280100                                   TO PV-LIST-ITEM-NUMBER.        28010000
280200     COMPUTE PV-BLOCK-NUMBER =                                    28020000
280300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    28030000
280400                                                                  28040000
280500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             28050000
280600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             28060000
280700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      28070000
280800             PERFORM 5105-REWRITE-ASC-LISTQ                       28080000
280900         END-IF                                                   28090000
281000     ELSE                                                         28100000
281100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       28110000
281200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            28120000
281300         PERFORM 5110-WRITE-ASC-LISTQ                             28130000
281400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   28140000
281500     END-IF.                                                      28150000
281600                                                                  28160000
281700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             28170000
281800                                                                  28180000
281900******************************************************************28190000
282000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **28200000
282100** SPECIFIC COMMAREA.                                           **28210000
282200******************************************************************28220000
282300 5105-REWRITE-ASC-LISTQ.                                          28230000
282400     EXEC CICS                                                    28240000
282500         WRITEQ TS                                                28250000
282600             QUEUE (ASC-LIST-QUEUE-NAME)                          28260000
282700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28270000
282800             ITEM  (PV-BLOCK-NUMBER)                              28280000
282900             REWRITE                                              28290000
283000             RESP  (PV-CICS-RESP)                                 28300000
283100     END-EXEC.                                                    28310000
283200                                                                  28320000
283300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28330000
283400         CONTINUE                                                 28340000
283500     ELSE                                                         28350000
283600         SET DP013-CICS-ABEND            TO TRUE                  28360000
283700         SET DP013-NO-ROLLBACK           TO TRUE                  28370000
283800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       28380000
283900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28390000
284000                                         TO DP013-MESSAGE-TEXT(1) 28400000
284100         PERFORM DP013-0000-PROCESS-ABEND                         28410000
284200     END-IF.                                                      28420000
284300                                                                  28430000
284400******************************************************************28440000
284500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **28450000
284600** SPECIFIC COMMAREA.                                           **28460000
284700******************************************************************28470000
284800 5110-WRITE-ASC-LISTQ.                                            28480000
284900     EXEC CICS                                                    28490000
285000         WRITEQ TS                                                28500000
285100             QUEUE (ASC-LIST-QUEUE-NAME)                          28510000
285200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28520000
285300             ITEM  (PV-BLOCK-NUMBER)                              28530000
285400             RESP  (PV-CICS-RESP)                                 28540000
285500     END-EXEC.                                                    28550000
285600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      28560000
285700         SET DP013-CICS-ABEND      TO TRUE                        28570000
285800         SET DP013-NO-ROLLBACK     TO TRUE                        28580000
285900         MOVE '5110-WRITE-ASC-LISTQ'                              28590000
286000                                   TO DP013-PARAGRAPH             28600000
286100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           28610000
286200                                   TO DP013-MESSAGE-TEXT(1)       28620000
286300         PERFORM DP013-0000-PROCESS-ABEND                         28630000
286400     END-IF.                                                      28640000
286500                                                                  28650000
286600*----------------------------------------------------------------*28660000
286700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *28670000
286800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *28680000
286900*----------------------------------------------------------------*28690000
287000 5200-FILL-SEL-QUEUE-RECORD.                                      28700000
287100                                                                  28710000
287200     PERFORM 6112-READ-LIST-QUEUE.                                28720000
287300                                                                  28730000
287400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28740000
287500         PERFORM                                                  28750000
287600         VARYING LQW-IDX                                          28760000
287700         FROM 1 BY 1                                              28770000
287800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            28780000
287900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          28790000
288000                                                                  28800000
288100             IF  LQW-SELECT (LQW-IDX)                             28810000
288200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              28820000
288300                                   TO PC212-ITEM (PC212-IDX)      28830000
288400                 MOVE SPACE        TO PC212-ACTION-SW (PC212-IDX) 28840000
288500                 MOVE LQW-STORE (LQW-IDX) TO                      28850000
288600                                    PC212-STORE-NBR (PC212-IDX)   28860000
288700                 MOVE LQW-STR-NAME (LQW-IDX) TO                   28870000
288800                                      PC212-STORE-NAME (PC212-IDX)28880000
288900                 MOVE LQW-FASH-QTY (LQW-IDX) TO                   28890000
289000                                    PC212-FASH-ON-HAND (PC212-IDX)28900000
289100                 MOVE LQW-TRN-QTY  (LQW-IDX) TO PC212-INTR-QTY    28910000
289200                                                       (PC212-IDX)28920000
289300                 MOVE LQW-STR-EXP (LQW-IDX) TO                    28930000
289400                                 PC212-STORE-EXPECTED (PC212-IDX) 28940000
289500                 MOVE LQW-STR-ONH (LQW-IDX) TO                    28950000
289600                                   PC212-STORE-ON-HAND (PC212-IDX)28960000
289700                 MOVE LQW-DATE (LQW-IDX) TO PC212-LAST-UPDT       28970000
289800                                                       (PC212-IDX)28980000
289900                                                                  28990000
290000                 SET PC212-IDX UP BY 1                            29000000
290100                 IF  PC212-IDX > PC212-MAX-ITEMS                  29010000
290200                     PERFORM 5205-WRITE-SEL-QUEUE                 29020000
290300                     ADD +1        TO PC211-NUMBER-OF-TS-ITEMS    29030000
290400                     INITIALIZE PC212-SELECTED-ITEM-ARRAY         29040000
290500                     SET PC212-IDX TO  1                          29050000
290600                 END-IF                                           29060000
290700             END-IF                                               29070000
290800         END-PERFORM                                              29080000
290900     END-IF.                                                      29090000
291000                                                                  29100000
291100*----------------------------------------------------------------*29110000
291200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29120000
291300*----------------------------------------------------------------*29130000
291400 5205-WRITE-SEL-QUEUE.                                            29140000
291500                                                                  29150000
291600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29160000
291700                                   TO PC212-SELECTED-ITEMS.       29170000
291800                                                                  29180000
291900     EXEC CICS                                                    29190000
292000          WRITEQ TS                                               29200000
292100              QUEUE (ASC-SEL-QUEUE-NAME)                          29210000
292200              FROM  (PC212-SELECT-RECORD)                         29220000
292300              ITEM  (PV-SEL-QUEUE-ITEM)                           29230000
292400              RESP  (PV-CICS-RESP)                                29240000
292500     END-EXEC.                                                    29250000
292600                                                                  29260000
292700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29270000
292800         CONTINUE                                                 29280000
292900     ELSE                                                         29290000
293000         SET DP013-CICS-ABEND      TO TRUE                        29300000
293100         SET DP013-NO-ROLLBACK     TO TRUE                        29310000
293200         MOVE '5205-WRITE-SEL-QUEUE'                              29320000
293300                                   TO DP013-PARAGRAPH             29330000
293400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          29340000
293500                                   TO DP013-MESSAGE-TEXT(1)       29350000
293600         PERFORM DP013-0000-PROCESS-ABEND                         29360000
293700     END-IF.                                                      29370000
293800******************************************************************29380000
293900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **29390000
294000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **29400000
294100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **29410000
294200** THE USER.                                                    **29420000
294300******************************************************************29430000
294400 6000-REFRESH-PANEL-FROM-TEMP.                                    29440000
294500     IF  ASC-UPDATE-TSQ                                           29450000
294600         SET ASC-NO-TSQ-UPDATE TO TRUE                            29460000
294700         MOVE ZERO                 TO PV-SAVE-ITEM                29470000
294800                                      PV-SEL-QUEUE-ITEM           29480000
294900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        29490000
295000                                   TO PV-HOLD-SELECTED-ITEMS      29500000
295100         MOVE +1                   TO PV-ITEMS-PROCESSED          29510000
295200         PERFORM 6100-UPDATE-TSQ                                  29520000
295300             UNTIL PV-ITEMS-PROCESSED >                           29530000
295400                                     PV-HOLD-SELECTED-ITEMS       29540000
295500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         29550000
295600                    ASC-BLOCK-ENTRIES (2)                         29560000
295700     END-IF.                                                      29570000
295800                                                                  29580000
295900*----------------------------------------------------------------*29590000
296000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *29600000
296100*----------------------------------------------------------------*29610000
296200 6010-DELETE-SEL-QUEUE.                                           29620000
296300                                                                  29630000
296400     EXEC CICS                                                    29640000
296500         DELETEQ TS                                               29650000
296600             QUEUE (ASC-SEL-QUEUE-NAME)                           29660000
296700             RESP  (PV-CICS-RESP)                                 29670000
296800     END-EXEC.                                                    29680000
296900*                                                                 29690000
297000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      29700000
297100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         29710000
297200         CONTINUE                                                 29720000
297300     ELSE                                                         29730000
297400         SET DP013-CICS-ABEND TO TRUE                             29740000
297500         SET DP013-NO-ROLLBACK TO TRUE                            29750000
297600         MOVE '6010-DELETE-SEL-QUEUE'                             29760000
297700                        TO DP013-PARAGRAPH                        29770000
297800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         29780000
297900                        TO DP013-MESSAGE-TEXT (1)                 29790000
298000         PERFORM DP013-0000-PROCESS-ABEND                         29800000
298100     END-IF.                                                      29810000
298200                                                                  29820000
298300*----------------------------------------------------------------*29830000
298400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *29840000
298500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *29850000
298600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *29860000
298700*    THE TEMP QUEUE.                                             *29870000
298800*----------------------------------------------------------------*29880000
298900 6100-UPDATE-TSQ.                                                 29890000
299000                                                                  29900000
299100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             29910000
299200     PERFORM 6150-READ-SEL-QUEUE.                                 29920000
299300     PERFORM                                                      29930000
299400         VARYING PC212-IDX                                        29940000
299500         FROM 1 BY 1                                              29950000
299600         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     29960000
299700         OR (PC212-IDX GREATER THAN PC212-MAX-ITEMS))             29970000
299800         IF  PC212-ACTION-SW (PC212-IDX) > SPACE                  29980000
299900             PERFORM 6110-PROCESS-ITEMS                           29990000
300000         END-IF                                                   30000000
300100         ADD +1                TO PV-ITEMS-PROCESSED              30010000
300200     END-PERFORM.                                                 30020000
300300     PERFORM 6111-WRITE-LIST-QUEUE.                               30030000
300400                                                                  30040000
300500*----------------------------------------------------------------*30050000
300600*    READ THE LIST QUEUE RECORD.                                 *30060000
300700*----------------------------------------------------------------*30070000
300800 6150-READ-SEL-QUEUE.                                             30080000
300900                                                                  30090000
301000     EXEC CICS                                                    30100000
301100          READQ TS                                                30110000
301200              QUEUE (ASC-SEL-QUEUE-NAME)                          30120000
301300              INTO  (PC212-SELECT-RECORD)                         30130000
301400              ITEM  (PV-SEL-QUEUE-ITEM)                           30140000
301500              RESP  (PV-CICS-RESP)                                30150000
301600     END-EXEC.                                                    30160000
301700*                                                                 30170000
301800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30180000
301900         CONTINUE                                                 30190000
302000     ELSE                                                         30200000
302100         SET DP013-CICS-ABEND      TO  TRUE                       30210000
302200         SET DP013-NO-ROLLBACK     TO  TRUE                       30220000
302300         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           30230000
302400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           30240000
302500                                   TO  DP013-MESSAGE-TEXT(1)      30250000
302600         PERFORM DP013-0000-PROCESS-ABEND                         30260000
302700     END-IF.                                                      30270000
302800                                                                  30280000
302900*----------------------------------------------------------------*30290000
303000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*30300000
303100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*30310000
303200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *30320000
303300*----------------------------------------------------------------*30330000
303400 6110-PROCESS-ITEMS.                                              30340000
303500                                                                  30350000
303600     COMPUTE PV-ITEM = 1 + ((PC212-ITEM (PC212-IDX) - 1)          30360000
303700                     / PC-ITEMS-PER-PANEL).                       30370000
303800                                                                  30380000
303900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           30390000
304000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          30400000
304100             PERFORM 6111-WRITE-LIST-QUEUE                        30410000
304200         END-IF                                                   30420000
304300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    30430000
304400                                                                  30440000
304500         PERFORM 6112-READ-LIST-QUEUE                             30450000
304600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               30460000
304700             CONTINUE                                             30470000
304800         END-IF                                                   30480000
304900     END-IF.                                                      30490000
305000                                                                  30500000
305100     COMPUTE PV-SUB = (PC212-ITEM (PC212-IDX)                     30510000
305200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              30520000
305300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         30530000
305400     MOVE LQW-SELECTED-SW (PV-SUB)                                30540000
305500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  30550000
305600                                                                  30560000
305700     EVALUATE TRUE                                                30570000
305800         WHEN PC212-INQ (PC212-IDX)                               30580000
305900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             30590000
306000                                                                  30600000
306100         WHEN PC212-UPD (PC212-IDX)                               30610000
306200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             30620000
306300                                                                  30630000
306400         WHEN PC212-DEL (PC212-IDX)                               30640000
306500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             30650000
306600                                                                  30660000
306700         WHEN PC212-ERR (PC212-IDX)                               30670000
306800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             30680000
306900     END-EVALUATE.                                                30690000
307000                                                                  30700000
307100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                30710000
307200                                                                  30720000
307300*----------------------------------------------------------------*30730000
307400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *30740000
307500*----------------------------------------------------------------*30750000
307600 6111-WRITE-LIST-QUEUE.                                           30760000
307700                                                                  30770000
307800     EXEC CICS                                                    30780000
307900         WRITEQ TS                                                30790000
308000             QUEUE (ASC-LIST-QUEUE-NAME)                          30800000
308100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     30810000
308200             ITEM  (PV-SAVE-ITEM)                                 30820000
308300             REWRITE                                              30830000
308400             RESP  (PV-CICS-RESP)                                 30840000
308500     END-EXEC.                                                    30850000
308600*                                                                 30860000
308700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30870000
308800         CONTINUE                                                 30880000
308900     ELSE                                                         30890000
309000         SET DP013-CICS-ABEND  TO  TRUE                           30900000
309100         SET DP013-NO-ROLLBACK TO  TRUE                           30910000
309200         MOVE '6111-WRITE-LIST-QUEUE'                             30920000
309300                               TO  DP013-PARAGRAPH                30930000
309400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  30940000
309500                               TO  DP013-MESSAGE-TEXT(1)          30950000
309600         PERFORM DP013-0000-PROCESS-ABEND                         30960000
309700     END-IF.                                                      30970000
309800                                                                  30980000
309900*----------------------------------------------------------------*30990000
310000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*31000000
310100*----------------------------------------------------------------*31010000
310200 6112-READ-LIST-QUEUE.                                            31020000
310300                                                                  31030000
310400     EXEC CICS                                                    31040000
310500         READQ TS                                                 31050000
310600             QUEUE (ASC-LIST-QUEUE-NAME)                          31060000
310700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     31070000
310800             ITEM  (PV-ITEM)                                      31080000
310900             RESP  (PV-CICS-RESP)                                 31090000
311000     END-EXEC.                                                    31100000
311100*                                                                 31110000
311200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31120000
311300         CONTINUE                                                 31130000
311400     ELSE                                                         31140000
311500         SET DP013-CICS-ABEND        TO TRUE                      31150000
311600         SET DP013-NO-ROLLBACK       TO TRUE                      31160000
311700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           31170000
311800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    31180000
311900                                     TO DP013-MESSAGE-TEXT(1)     31190000
312000         PERFORM DP013-0000-PROCESS-ABEND                         31200000
312100     END-IF.                                                      31210000
312200                                                                  31220000
312300*-----------------------------------------------------------------31230000
312400*  READ THE LIST QUEUE RECORD                                     31240000
312500*-----------------------------------------------------------------31250000
312600 9100-READ-SEL-QUEUE.                                             31260000
312700                                                                  31270000
312800     EXEC CICS                                                    31280000
312900         READQ TS                                                 31290000
313000             QUEUE (ASC-SEL-QUEUE-NAME)                           31300000
313100             INTO  (PC212-SELECT-RECORD)                          31310000
313200             ITEM  (ASC-SEL-ITEM)                                 31320000
313300             RESP  (PV-CICS-RESP)                                 31330000
313400     END-EXEC.                                                    31340000
313500     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        31350000
313600         CONTINUE                                                 31360000
313700     ELSE                                                         31370000
313800         SET DP013-LOGIC-ABEND                                    31380000
313900             DP013-NO-ROLLBACK   TO   TRUE                        31390000
314000         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          31400000
314100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   31410000
314200                                 TO   DP013-MESSAGE-TEXT (1)      31420000
314300         PERFORM DP013-0000-PROCESS-ABEND                         31430000
314400     END-IF.                                                      31440000
314500                                                                  31450000
314600*-----------------------------------------------------------------31460000
314700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *31470000
314800*-----------------------------------------------------------------31480000
314900 9200-REWRITE-SEL-QUEUE.                                          31490000
315000                                                                  31500000
315100     EXEC CICS                                                    31510000
315200          WRITEQ TS                                               31520000
315300              QUEUE  (ASC-SEL-QUEUE-NAME)                         31530000
315400              FROM   (PC212-SELECT-RECORD)                        31540000
315500              ITEM   (ASC-SEL-ITEM)                               31550000
315600              RESP   (PV-CICS-RESP)                               31560000
315700              REWRITE                                             31570000
315800     END-EXEC.                                                    31580000
315900                                                                  31590000
316000     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   31600000
316100         SET DP013-CICS-ABEND                                     31610000
316200             DP013-NO-ROLLBACK     TO TRUE                        31620000
316300         MOVE '9200-REWRITE-SEL-QUEUE'                            31630000
316400                                   TO DP013-PARAGRAPH             31640000
316500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   31650000
316600                                   TO DP013-MESSAGE-TEXT (1)      31660000
316700         PERFORM DP013-0000-PROCESS-ABEND                         31670000
316800     END-IF.                                                      31680000
316900                                                                  31690000
317000*----------------------------------------------------------------*31700000
317100*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *31710000
317200*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *31720000
317300*----------------------------------------------------------------*31730000
317400 9900-SOFT-ABORT.                                                 31740000
317500                                                                  31750000
317600     EXEC CICS SYNCPOINT                                          31760000
317700          ROLLBACK                                                31770000
317800     END-EXEC.                                                    31780000
317900                                                                  31790000
318000     SET  PS-ERROR                                                31800000
318100          PS-SOFT-ABORT-ERROR                                     31810000
318200          DP020-MSG-FATAL       TO  TRUE.                         31820000
318300                                                                  31830000
318400*----------------------------------------------------------------*31840000
318500*    ABEND PROCESSOR MODULE                                      *31850000
318600*----------------------------------------------------------------*31860000
318700                                                                  31870000
318800     COPY DPPD013.                                                31880000
