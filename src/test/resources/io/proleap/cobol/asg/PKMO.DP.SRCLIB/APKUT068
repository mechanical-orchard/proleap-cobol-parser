000100 IDENTIFICATION DIVISION.                                         00010029
000200 PROGRAM-ID.    APKUT068.                                         00020029
000300 AUTHOR.        NANCY EILBES.                                     00030029
000400 DATE-WRITTEN.  03/06/2019.                                       00040029
000500                                                                  00050029
000600*---------------------------------------------------------------* 00060029
000700*     COBOL II / DB2                                            * 00070029
000800*                                                               * 00080029
000900*   GENERATE EDI 820 RECORDS USING PAYMENT EXTRACT              * 00090029
001000*                                                               * 00100029
001100*   THE OBJECTIVE OF THIS PROGRAM IS TO CREATE THE EDI 820      * 00110029
001200*   REMITTANCE RECORDS USING THE PAYMENT EXTRACT FROM ORACLE    * 00120029
001300*   AS INPUT.  ADDITIONAL DATA ATTRIBUTES WILL BE GATHERED FROM * 00130029
001400*   VARIOUS DATABASES TO COMPLETE THE INFORMATION FOR THE       * 00140029
001500*   VENDOR.                                                     * 00150029
001600*---------------------------------------------------------------* 00160029
001700*                                                               * 00170029
001800* DB2 TABLES:                                                   * 00180029
001900*  1. AP-ADJUSTMENT JOURNAL                 (TADJRNL)           * 00190029
002000*  2. VN-EXTERNAL ENTERPRISE                (TEXTENT)           * 00200029
002100*  3. VN-EXTERNAL ENTERPRISE NAME           (TENTNME)           * 00210029
002200*  4. AP INVOICE HEADER                     (TINVOIC)           * 00220029
002300*  5. PO-PURCHASE TABLE                     (TPURCHS)           * 00230029
002400*  6. AP-TRANSACTION CODE TABLE             (TTRNCDE)           * 00240029
002500*  7. AP-INVOICE ALLOWANCE/CHARGE           (TALCHRG)           * 00250029
002600*  8. AP-ADJUSTMENT PS INTERFACE            (TAJPSINT)          * 00260029
002700*  9. AP-MERCHANDISE INVOICE                (TMDINVC)           * 00270029
002800* 10. AP-INVOICE TERMS                      (TINVCTM)           * 00280029
002900* 11. PO-PO AGREEMENTS                      (TPOAGMT)           * 00290029
003000* 12. VN-PAYMENT TERMS                      (TPAYTRM)           * 00300029
003100*                                                               * 00310029
003200* INPUT:                                                        * 00320029
003300*  1. PAYMENT DETAIL TRANSACTIONS           (APRD083)           * 00330029
003400*                                                               * 00340029
003500* OUTPUT:                                                       * 00350029
003600*  1. EDI 820 EXTRACT RECORDS               (APRD002)           * 00360029
003700*                                                               * 00370029
003800*---------------------------------------------------------------* 00380029
003900*   CHANGES:                                                    * 00390029
004000*                                                               * 00400029
004100*  DATE  03/27/2019                                             * 00410029
004200*      CHANGE MADE: ERP PROJECT.  INITIAL VERSION.              * 00420029
004300*      MADE BY: NANCY EILBES            WR/IR #: CHG0220043     * 00430029
004400*                                                               * 00440029
004500*  DATE  05/29/2019                                             * 00450029
004600*      CHANGE MADE: ERP PROJECT. POST SIT1 TESTING.  MODIFIED   * 00460029
004700*      LOGIC MOVING FORMATTED PAYMENT AMOUNT TO PACKED DECIMAL  * 00470029
004800*      OUTPUT FIELDS TO HANDLE ZERO AMOUNTS AND TO POPULATE BOTH* 00480029
004900*      NET AND GROSS AMOUNTS. CR WAS SUBMITTED TO ORACLE TO     * 00490029
005000*      SUPPRESS ZERO BEFORE DECIMAL POINT ON AMOUNTS LESS THAN  * 00500029
005100*      ONE DOLLAR AS COBOL CANNOT HANDLE CONVERTING THOSE       * 00510029
005200*      VALUES.                                                  * 00520029
005300*      MADE BY: NANCY EILBES            WR/IR #: CHG0223653     * 00530029
005400*                                                               * 00540029
005500*  DATE  08/08/2019                                             * 00550029
005600*      CHANGE MADE: CORRECTED LOGIC FOR I70 INVOICES TO MOVE    * 00560029
005700*      ZERO TO THE DISCOUNT AMOUNT.                             * 00570029
005800*      MADE BY: NANCY EILBES            WR/IR #: CHG0229024     * 00580029
005900*                                                               * 00590029
005910*  DATE  08/14/2019                                             * 00591029
005920*      CHANGE MADE: CORRECTED LOGIC FOR THE PO LOOKUP WHERE     * 00592029
005930*      DEPT NBR WAS NOT BEING RETURNED AND CHECK OF MATCH LEVEL * 00593029
005931*      WHERE DC WAS NOT BEING CHECKED, SO THOSE INVOICES WERE   * 00593129
005932*      GETTING ZERO IN THE LOCATION.                            * 00593229
005933*      MADE BY: NANCY EILBES            WR/IR #: CHG0229419     * 00593329
005934*                                                               * 00593429
005935*  DATE  08/16/2019                                             * 00593529
005936*      CHANGE MADE: MODIFIED LOGIC HANDLING THE COMMENTS TO     * 00593629
005937*      BYPASS CREATING A NEW COMMENT RECORDS IF COMMENTS WERE   * 00593729
005938*      PASSED FOR A CONVERTED INVOICE.  COMMENTS WERE BEING     * 00593829
005939*      DOUBLED, WHICH CAUSED CONFUSION FOR THE VENDOR.          * 00593929
005940*      MADE BY: NANCY EILBES            WR/IR #: CHG0229566     * 00594029
005950*                                                               * 00595029
005960*  DATE  08/20/2019                                             * 00596029
005970*      CHANGE MADE: CORRECTED TRUNCATION ISSUE IN THE COMMENTS. * 00597029
005980*      MADE BY: NANCY EILBES            WR/IR #: CHG0229772     * 00598029
005990*                                                               * 00599029
005991*  DATE  03/25/2020                                             * 00599129
005992*      CHANGE MADE: ADDED LOGIC TO CAPTURE LOCATION NUMBER AND  * 00599229
005993*      ALLOWANCES RELATED TO SHORTAGE TRANSACTIONS (ORIGIN M12) * 00599329
005994*      FROM THE INVOICE DATABASES AND INCLUDE THEM ON THE       * 00599429
005995*      OUTPUT RECORDS.                                          * 00599529
005996*      MADE BY: NANCY EILBES            WR/IR #: CHG0241973     * 00599629
005997*                                                               * 00599729
005998*  DATE  07/10/2020                                             * 00599829
005999*      CHANGE MADE: MODIFIED LOGIC TO SUBTRACT THE DISCOUNT     * 00599929
006000*      AMOUNT FROM GROSS AMOUNT INSTEAD OF NET AMOUNT TO AVOID  * 00600029
006010*      DUPLICATE DISCOUNT ISSUE IN EDI 820 DOCUMENTS.           * 00601029
006020*      MADE BY: SRINIVASAN SIVARAJ      WR/IR #: CHG0246004     * 00602029
006030*                                                               * 00603029
006040*  DATE  08/27/2020                                             * 00604029
006050*      CHANGE MADE: MODIFIED LOGIC TO SUBTRACT THE DISCOUNT     * 00605029
006060*      SAVED AS PERCENTAGE FROM INVOICE NET COST AMOUNT.  THIS  * 00606029
006070*      CHANGE CORRECTS AN ISSUE INTRODUCED BY THE PRIOR CHANGE  * 00607029
006080*      BECAUSE IT DIDN'T CONSIDER THAT CHARGES HAD BEEN APPLIED * 00608029
006090*      TO THE NET COST FOR SOME INVOICES.                       * 00609029
006091*      MADE BY: COGNIZANT               WR/IR #: CHG0248182     * 00609129
006092*                                                               * 00609229
006093*  DATE  02/05/2021                                             * 00609330
006094*      CHANGE MADE: MODIFIED LOGIC IN C100 AND B200 TO ENSURE   * 00609430
006095*      THAT THE PAYMENT TERMS DISCOUNT IS APPLIED TO THE        * 00609530
006096*      AP002-NET-AMT IF THE DISCOUNT WAS DEDUCTED FROM THE      * 00609630
006097*      PAYMENT.  THIS REQUIRED KEEPING A SEPARATE TOTAL OF JUST * 00609730
006098*      THE TERMS DISCOUNT.  IF A TERMS DISCOUNT WAS FOUND ON    * 00609830
006099*      THE INVOICE AND THE PAYMENT AMOUNT DOESN'T MATCH THE NET * 00609930
006100*      AMOUNT AFTER OTHER DISCOUNTS WERE APPLIED, THEN THE TERMS* 00610030
006101*      DISCOUNT IS FOUND, BUT PAYMENT AMOUNT DOES MATCH THE NET * 00610130
006102*      AMOUNT, THEN THE TERMS DISCOUNT IS SUBTRACTED FROM THE   * 00610230
006103*      AP002-DISCOUNT-AMT, AS THIS MEANS THE TERMS DISCOUNT WAS * 00610330
006104*      NOT APPLIED TO THE PAYMENT.                              * 00610430
006105*      MADE BY: NANCY EILBES            WR/IR #: CHG0253646     * 00610530
006092*                                                               * 00610631
006093*  DATE  05/11/2021                                             * 00610732
006094*      CHANGE MADE: PROCESS SEPHORA WITH SOURCE CODE OF P01     * 00610831
006095*      IN THE SAME MANNER AS THE EXISTING SOURC OF M01          * 00610931
006105*      MADE BY: JEAN KURK               CHG0256545              * 00611932
006106*                                                               * 00612030
006107***************************************************************** 00612130
006108                                                                  00612230
006109 ENVIRONMENT DIVISION.                                            00612330
006110 CONFIGURATION SECTION.                                           00612430
006111 SOURCE-COMPUTER. IBM-3090.                                       00612530
006112 OBJECT-COMPUTER. IBM-3090.                                       00612630
006113                                                                  00612730
006120                                                                  00613030
006200 INPUT-OUTPUT SECTION.                                            00620029
006300 FILE-CONTROL.                                                    00630029
006400                                                                  00640029
006500     SELECT PYMT-DETAILS-FILE              ASSIGN TO UT-S-INP01.  00650029
006600     SELECT EDI820-EXTRACT-FILE            ASSIGN TO UT-S-OUT01.  00660029
006700                                                                  00670029
006800 DATA DIVISION.                                                   00680029
006900 FILE SECTION.                                                    00690029
007000                                                                  00700029
007100 FD  PYMT-DETAILS-FILE                                            00710029
007200     RECORDING MODE IS F                                          00720029
007300     BLOCK CONTAINS 0 CHARACTERS                                  00730029
007400     LABEL RECORDS ARE STANDARD                                   00740029
007500     DATA RECORD IS PYMT-DETAILS-RECORD.                          00750029
007600 01  PYMT-DETAILS-RECORD          PIC X(222).                     00760029
007700                                                                  00770029
007800 FD  EDI820-EXTRACT-FILE                                          00780029
007900     RECORDING MODE IS F                                          00790029
008000     BLOCK CONTAINS 0 CHARACTERS                                  00800029
008100     LABEL RECORDS ARE STANDARD                                   00810029
008200     DATA RECORD IS EDI820-EXTRACT-RECORD.                        00820029
008300 01  EDI820-EXTRACT-RECORD        PIC X(385).                     00830029
008400                                                                  00840029
008500                                                                  00850029
008600 WORKING-STORAGE SECTION.                                         00860029
008700                                                                  00870029
008800 01  PC-PROGRAM-CONSTANTS.                                        00880029
008900     05  PC-WS-PROGRAM           PIC  X(32)     VALUE             00890029
009000         '**** WORKING STORAGE FOR ****'.                         00900029
009100     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT068'. 00910029
009200     05  PC-PAY-CDE              PIC X(03)   VALUE 'PAY'.         00920029
009300     05  PC-NSD-CDE              PIC X(03)   VALUE 'NSD'.         00930029
009400     05  PC-TRD-CDE              PIC X(03)   VALUE 'TRD'.         00940029
009500     05  PC-MOS-CDE              PIC X(03)   VALUE 'MOS'.         00950029
009600     05  PC-ADV-CDE              PIC X(03)   VALUE 'ADV'.         00960029
009700     05  PC-SAM-CDE              PIC X(03)   VALUE 'SAM'.         00970029
009800     05  PC-COOP-CDE             PIC X(03)   VALUE 'COP'.         00980029
009900     05  PC-ALW-CDE              PIC X(03)   VALUE 'ALW'.         00990029
010000     05  PC-MISC-CDE             PIC X(03)   VALUE 'MSC'.         01000029
010100     05  PC-PURCHASE-TERMS       PIC  X(01)  VALUE 'P'.           01010029
010200     05  PC-INVOICE-TERMS        PIC  X(01)  VALUE 'I'.           01020029
010300                                                                  01030029
010400 01  PS-PROGRAM-SWITCHES.                                         01040029
010500     05  PS-PYMT-DETAILS-SW      PIC  X(01)     VALUE 'Y'.        01050029
010600         88  PS-PYMT-DETAILS-FOUND              VALUE 'Y'.        01060029
010700         88  PS-PYMT-DETAILS-END                VALUE 'N'.        01070029
010800     05  PS-END-OF-ALLOW-SW      PIC  X(01)     VALUE 'Y'.        01080029
010900         88  END-OF-ALLOW-CSR                   VALUE 'Y'.        01090029
011000         88  NOT-END-OF-ALLOW-CSR               VALUE 'N'.        01100029
011100     05  PS-END-OF-TRNCDE-SW     PIC  X(01)     VALUE 'N'.        01110029
011200         88  END-OF-TRNCDE-CSR                  VALUE 'Y'.        01120029
011300         88  NOT-END-OF-TRNCDE-CSR              VALUE 'N'.        01130029
011400     05  PV-VENDOR-NAME-SW       PIC  X(01)     VALUE 'N'.        01140029
011500         88  PV-NAME-NOT-FOUND                  VALUE 'N'.        01150029
011600         88  PV-NAME-FOUND                      VALUE 'Y'.        01160029
011700     05  PV-DEPT-NBR-SW          PIC  X(01)     VALUE 'N'.        01170029
011800         88  PV-DEPT-NOT-FOUND                  VALUE 'N'.        01180029
011900         88  PV-DEPT-FOUND                      VALUE 'Y'.        01190029
012000     05  PV-INVOICE-SW           PIC  X(01)     VALUE 'N'.        01200029
012100         88  PV-INVC-NOT-FOUND                  VALUE 'N'.        01210029
012200         88  PV-INVC-FOUND                      VALUE 'Y'.        01220029
012300     05  PV-TRANCODE-NBR-SW      PIC  X(01)     VALUE 'N'.        01230029
012400         88  PV-TRANCODE-NOT-FOUND              VALUE 'N'.        01240029
012500         88  PV-TRANCODE-FOUND                  VALUE 'Y'.        01250029
012600     05  PV-ADJ-SW               PIC  X(01)     VALUE 'N'.        01260029
012700         88  PV-ADJ-NOT-FOUND                   VALUE 'N'.        01270029
012800         88  PV-ADJ-FOUND                       VALUE 'Y'.        01280029
012900     05  PV-ADJ-COMMENT-SW       PIC  X(01)     VALUE 'N'.        01290029
013000         88  PV-ADJ-COMMENT-NOT-FOUND           VALUE 'N'.        01300029
013100         88  PV-ADJ-COMMENT-FOUND               VALUE 'Y'.        01310029
013200     05  PV-PSC-COMMENT-SW       PIC  X(01)     VALUE 'N'.        01320029
013300         88  PV-PSC-COMMENT-NOT-FOUND           VALUE 'N'.        01330029
013400         88  PV-PSC-COMMENT-FOUND               VALUE 'Y'.        01340029
013500                                                                  01350029
013600 01  TRNCDE-TABLE.                                                01360029
013700     05  MAX-IDX1                PIC 9(03)   VALUE 500.           01370029
013800     05  TRNCDE-ENTRIES OCCURS 500 TIMES                          01380029
013900                       INDEXED BY IDX1.                           01390029
014000         10  TBL-ORIGIN.                                          01400029
014100             15  TBL-ORIGIN-CDE  PIC X(01)   VALUE SPACES.        01410029
014200             15  TBL-AP-TRN-CDE  PIC X(02)   VALUE SPACES.        01420029
014300                                                                  01430029
014400 01  PV-PROGRAM-VARIABLES.                                        01440029
014500     05  PV-COUNTERS             COMP.                            01450029
014600         10  PV-COUNT-READ       PIC 9(11)     VALUE ZEROES.      01460029
014700         10  PV-COUNT-WRITTEN    PIC S9(11)    VALUE ZEROES.      01470029
014800                                                                  01480029
014900     05  PV-RFMT-DATE.                                            01490029
015000         10  PV-RFMT-YYYY        PIC 9(4).                        01500029
015100         10  FILLER              PIC X(1).                        01510029
015110         10  PV-RFMT-MM          PIC 9(2).                        01511029
015120         10  FILLER              PIC X(1).                        01512029
015121         10  PV-RFMT-DD          PIC 9(2).                        01512129
015122                                                                  01512229
015123     05  PV-NUMERIC-DATE.                                         01512329
015124         10  PV-NUMERIC-YYYY     PIC 9(4).                        01512429
015125         10  PV-NUMERIC-MM       PIC 9(2).                        01512529
015126         10  PV-NUMERIC-DD       PIC 9(2).                        01512629
015127                                                                  01512729
015128     05  PV-CHECK-ORIGIN         PIC  X(3).                       01512829
015129         88  PV-ORIGIN-IMPORT    VALUE 'IMP'.                     01512929
015130         88  PV-ORIGIN-MERCH     VALUE 'MDS'.                     01513029
015140         88  PV-ORIGIN-PAYROLL   VALUE 'PAY'.                     01514029
015150         88  PV-ORIGIN-EXPENSE   VALUES 'EXL', 'EXP'.             01515029
015160         88  PV-ORIGIN-ADJUST    VALUES 'ADJ', 'BDA', 'FRT', 'RTV'01516029
015170                                      , 'VAA', 'VDA', 'VND'.      01517029
015180     05  PV-RSN-TXT              PIC X(240).                      01518029
015190     05  PV-RSN-TXT-REDEF REDEFINES PV-RSN-TXT.                   01519029
015200         10 PV-RSN-TXT1          PIC X(80).                       01520029
015300         10 PV-RSN-TXT2          PIC X(80).                       01530029
015400         10 PV-RSN-TXT3          PIC X(80).                       01540029
015500     05  PV-RSN-TXT-PSC-REDEF REDEFINES PV-RSN-TXT.               01550029
015600         10 PV-RSN-TXT-PSC-PFIX  PIC X(6).                        01560029
015700         10 PV-RSN-TXT1-PSC      PIC X(74).                       01570029
015800         10 PV-RSN-TXT2-PSC      PIC X(80).                       01580029
015900         10 PV-RSN-TXT3-PSC      PIC X(80).                       01590029
016000     05  PV-VENDOR-CHECK         PIC X(09).                       01600029
016100         88  PV-SAM-VENDOR           VALUES '102518706',          01610029
016200                                            '788923787',          01620029
016300                                            '001367051',          01630029
016400                                            '000320432',          01640029
016500                                            '001191055'.          01650029
016600     05  HOLD-DISC-PCT-DEC       PIC S9(1)V9(4)                   01660029
016700                                              VALUE ZEROS.        01670029
016800     05  PV-ADJ-TOTAL-DISCOUNT   PIC S9(7)V99 VALUE ZEROS.        01680029
016900     05  PV-TOTAL-DISC-AMT       PIC S9(7)V99 VALUE ZEROS.        01690029
017000     05  PV-DISC-AS-PCT-AMT      PIC S9(9)V99 VALUE ZEROS.        01700029
017100     05  PV-DISC-AS-AMT          PIC S9(9)V99 VALUE ZEROS.        01710029
017300     05  PV-TERMS-DISC-AMT       PIC S9(9)V99 VALUE ZEROS.        01730029
017400     05  PV-PYMNT-AMT-NUM        PIC S9(9)V99 VALUE ZEROS.        01740029
017500     05  PV-PYMNT-AMT-TEXT       PIC X(12).                       01750029
017600         88  PV-PYMNT-AMT-ZERO       VALUE '        0.00'.        01760029
017700     05  PV-START                PIC S9(03)  VALUE +0.            01770029
017800     05  PV-START-POINT          PIC S9(03)  VALUE +0.            01780029
017900                                                                  01790029
018000 01  COMMENT-BLOCK.                                               01800029
018100     05  COMMENT-ALLOW-PCT         PIC Z9.99.                     01810029
018200     05  FILLER                    PIC X(3)    VALUE '%'.         01820029
018300     05  COMMENT-ALLOW-CDE         PIC X(3).                      01830029
018400     05  FILLER                    PIC X(3)    VALUE ' = '.       01840029
018500     05  COMMENT-ALLOW-AMT         PIC -------.99.                01850029
018600                                                                  01860029
018700                                                                  01870029
018800*---------------------------------------------------------------  01880029
018900*    PAYMENT DETAILS FILE - INPUT                                 01890029
019000*---------------------------------------------------------------  01900029
019100     COPY APRD083.                                                01910029
019200                                                                  01920029
019300*----------------------------------------------------------------*01930029
019400*    EDIT 820 EXTRACT FILE - OUTPUT                               01940029
019500*----------------------------------------------------------------*01950029
019600     COPY APRD002.                                                01960029
019700                                                                  01970029
019800*----------------------------------------------------------------*01980029
019900*    WORKING STORAGE FOR APPD052                                  01990029
020000*----------------------------------------------------------------*02000029
020100     COPY APWS052.                                                02010029
020200                                                                  02020029
020300*---------------------------------------------------------------- 02030029
020400*  ABEND DATA AREAS                                               02040029
020500*---------------------------------------------------------------- 02050029
020600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02060029
020700                                             COMP SYNC.           02070029
020800     88  AC-TABLE-OVERFLOW                   VALUE +4008.         02080029
020900     88  AC-DB2-ERROR                        VALUE +4013.         02090029
021000                                                                  02100029
021100                                                                  02110029
021200 01  ABEND-AREAS.                                                 02120029
021300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02130029
021400             '*****       ABEND'.                                 02140029
021500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02150029
021600             '*****   PROGRAM: APKUT068'.                         02160029
021700     05  AA-PARAGRAPH-LIT.                                        02170029
021800         10  FILLER              PIC  X(17)  VALUE                02180029
021900             '***** PARAGRAPH: '.                                 02190029
022000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02200029
022100     05  AA-MESSAGE-LINE.                                         02210029
022200         10  FILLER              PIC  X(06)  VALUE '*****'.       02220029
022300         10  AA-MESSAGE.                                          02230029
022400             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        02240029
022500             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        02250029
022600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02260029
022700             '*****    DB2 ERROR'.                                02270029
022800     05  AA-DB2-OPERATION-LIT.                                    02280029
022900         10  FILLER              PIC  X(17)  VALUE                02290029
023000             '***** OPERATION: '.                                 02300029
023100         10  AA-DB2-OPERATION.                                    02310029
023200             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02320029
023300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02330029
023400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02340029
023500     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02350029
023600     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02360029
023700     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02370029
023800                                                                  02380029
023900*---------------------------------------------------------------- 02390029
024000*  SQLCA FORMATTED MESSAGE AREA                                   02400029
024100*---------------------------------------------------------------- 02410029
024200     COPY DPWS004.                                                02420029
024300                                                                  02430029
024400*----------------------------------------------------------------*02440029
024500*    SQL COMMUNICATIONS AREA DCLGEN                               02450029
024600*----------------------------------------------------------------*02460029
024700     EXEC SQL                                                     02470029
024800         INCLUDE SQLCA                                            02480029
024900     END-EXEC.                                                    02490029
025000                                                                  02500029
025100                                                                  02510029
025200*----------------------------------------------------------------*02520029
025300*  AP-ADJUSTMENT JOURNAL                                         *02530029
025400*----------------------------------------------------------------*02540029
025500     EXEC SQL                                                     02550029
025600          INCLUDE TADJRNL                                         02560029
025700     END-EXEC.                                                    02570029
025800                                                                  02580029
025900*----------------------------------------------------------------*02590029
026000*  AP-ADJUSTMENT JOURNAL PS INTERFACE TABLE                      *02600029
026100*----------------------------------------------------------------*02610029
026200     EXEC SQL                                                     02620029
026300          INCLUDE TAJPSINT                                        02630029
026400     END-EXEC.                                                    02640029
026500                                                                  02650029
026600*----------------------------------------------------------------*02660029
026700*  VN-EXTERNAL ENTERPRISE                                        *02670029
026800*----------------------------------------------------------------*02680029
026900     EXEC SQL                                                     02690029
027000          INCLUDE TEXTENT                                         02700029
027100     END-EXEC.                                                    02710029
027200                                                                  02720029
027300*----------------------------------------------------------------*02730029
027400*  VN-EXTERNAL ENTERPRISE NAME                                   *02740029
027500*----------------------------------------------------------------*02750029
027600     EXEC SQL                                                     02760029
027700          INCLUDE TENTNME                                         02770029
027800     END-EXEC.                                                    02780029
027900                                                                  02790029
028000*----------------------------------------------------------------*02800029
028100*  VN-PAYMENT TERMS TABLE                                        *02810029
028200*----------------------------------------------------------------*02820029
028300     EXEC SQL                                                     02830029
028400          INCLUDE TPAYTRM                                         02840029
028500     END-EXEC.                                                    02850029
028600                                                                  02860029
028700*----------------------------------------------------------------*02870029
028800*  AP INVOICE HEADER TABLE                                       *02880029
028900*----------------------------------------------------------------*02890029
029000     EXEC SQL                                                     02900029
029100          INCLUDE TINVOIC                                         02910029
029200     END-EXEC.                                                    02920029
029300                                                                  02930029
029400*----------------------------------------------------------------*02940029
029500*  AP INVOICE MERCHANDISE ATTRIBUTES TABLE                       *02950029
029600*----------------------------------------------------------------*02960029
029700     EXEC SQL                                                     02970029
029800          INCLUDE TMDINVC                                         02980029
029900     END-EXEC.                                                    02990029
030000                                                                  03000029
030100*----------------------------------------------------------------*03010029
030200*  AP INVOICE TERMS TABLE                                        *03020029
030300*----------------------------------------------------------------*03030029
030400     EXEC SQL                                                     03040029
030500          INCLUDE TINVCTM                                         03050029
030600     END-EXEC.                                                    03060029
030700                                                                  03070029
030800*----------------------------------------------------------------*03080029
030900*  PO-PURCHASING TABLE                                           *03090029
031000*----------------------------------------------------------------*03100029
031100     EXEC SQL                                                     03110029
031200          INCLUDE TPURCHS                                         03120029
031300     END-EXEC.                                                    03130029
031400                                                                  03140029
031500*----------------------------------------------------------------*03150029
031600*  PO-PURCHASE AGREEMENTS TABLE                                  *03160029
031700*----------------------------------------------------------------*03170029
031800     EXEC SQL                                                     03180029
031900          INCLUDE TPOAGMT                                         03190029
032000     END-EXEC.                                                    03200029
032100                                                                  03210029
032200*----------------------------------------------------------------*03220029
032300*  AP-TRANSACTION CODE                                           *03230029
032400*----------------------------------------------------------------*03240029
032500     EXEC SQL                                                     03250029
032600          INCLUDE TTRNCDE                                         03260029
032700     END-EXEC.                                                    03270029
032800                                                                  03280029
032900*----------------------------------------------------------------*03290029
033000*  AP-INVOICE ALLOWANCE/CHARGE TABLE                            * 03300029
033100*----------------------------------------------------------------*03310029
033200     EXEC SQL                                                     03320029
033300          INCLUDE TALCHRG                                         03330029
033400     END-EXEC.                                                    03340029
033500                                                                  03350029
033600*--------------------------------------------------------------*  03360029
033700*  TRANCODE_CSR - RETURNS ONLY TRANCODES THAT ARE INTERFACED   *  03370029
033800*  AND THEREFORE COULD POTENTIALLY BE ON THE PAYMENT FILE.     *  03380029
033900*--------------------------------------------------------------*  03390029
034000     EXEC SQL                                                     03400029
034100        DECLARE  TRANCODE_CSR CURSOR FOR                          03410029
034200         SELECT  AP_TRN_CDE                                       03420029
034300              ,  BTCH_SRC_CDE                                     03430029
034400           FROM  TTRNCDE                                          03440029
034500          WHERE EFF_STRT_DTE  <= CURRENT_DATE                     03450029
034600            AND EFF_END_DTE   >  CURRENT_DATE                     03460029
034700            AND AP_PSTG_IND  = 'Y'                                03470029
034800       ORDER BY  AP_TRN_CDE                                       03480029
034900     END-EXEC.                                                    03490029
035000                                                                  03500029
035100*----------------------------------------------------------------*03510029
035200*    ALLOWANCE CURSOR SELECTS ALLOWANCE INFO FOR PO/INVOICE NBR   03520029
035300*----------------------------------------------------------------*03530029
035400     EXEC SQL                                                     03540029
035500         DECLARE ALLOW_CSR CURSOR FOR                             03550029
035600             SELECT  ALW_CHRG_CDE                                 03560029
035700                    ,ALW_CHRG_AMT                                 03570029
035800                    ,ALW_CHRG_PCT                                 03580029
035900                    ,ALW_CHRG_TYP_CDE                             03590029
036000               FROM  TALCHRG                                      03600029
036100              WHERE  PO_NBR           =  :ALCHRG-PO-NBR           03610029
036200                AND  INVC_ID          =  :ALCHRG-INVC-ID          03620029
036300                AND  ALW_CHRG_TYP_CDE =  'A'                      03630029
036400     END-EXEC.                                                    03640029
036500 01  FILLER                      PIC  X(35)  VALUE                03650029
036600     '**** END OF W/S ** APKUT068 ****'.                          03660029
036700                                                                  03670029
036800 PROCEDURE DIVISION.                                              03680029
036900                                                                  03690029
037000     PERFORM A100-MAINLINE.                                       03700029
037100     GOBACK.                                                      03710029
037200                                                                  03720029
037300 A100-MAINLINE.                                                   03730029
037400                                                                  03740029
037500     PERFORM B100-INITIALIZE.                                     03750029
037600                                                                  03760029
037700     PERFORM B200-PROCESS-PYMT-DETAILS-FILE                       03770029
037800         UNTIL PS-PYMT-DETAILS-END.                               03780029
037900                                                                  03790029
038000     PERFORM B300-END-OF-PROGRAM.                                 03800029
038100                                                                  03810029
038200                                                                  03820029
038300 B100-INITIALIZE.                                                 03830029
038400*---------------------------------------------------------------- 03840029
038500*    INITIALIZATION PROCESSING                                    03850029
038600*---------------------------------------------------------------- 03860029
038700                                                                  03870029
038800     DISPLAY '*---------------------------*'.                     03880029
038900     DISPLAY '* APKUT068 START PROCESSING * '                     03890029
039000     DISPLAY '*---------------------------*'.                     03900029
039100                                                                  03910029
039200     OPEN INPUT  PYMT-DETAILS-FILE                                03920029
039300     OPEN OUTPUT EDI820-EXTRACT-FILE.                             03930029
039400                                                                  03940029
039500     INITIALIZE DCLTINVOIC                                        03950029
039600                DCLTADJRNL                                        03960029
039700                DCLTEXTENT                                        03970029
039800                DCLTENTNME                                        03980029
039900                DCLTALCHRG                                        03990029
040000                DCLTPURCHS                                        04000029
040100                DCLTTRNCDE                                        04010029
040200                DCLTPAYTRM                                        04020029
040300                DCLTMDINVC                                        04030029
040400                DCLTINVCTM                                        04040029
040500                DCLTPOAGMT                                        04050029
040600                DCLTAJPSINT                                       04060029
040700                AP002-REMIT-EXTRACT-RECORD.                       04070029
040800                                                                  04080029
040900     PERFORM R100-READ-PYMT-DETAILS-FILE.                         04090029
041000                                                                  04100029
041100     IF PS-PYMT-DETAILS-END                                       04110029
041200        DISPLAY 'APKUT068 - NO PAYMENT DETAILS TO PROCESS'        04120029
041300     ELSE                                                         04130029
041400        PERFORM L100-LOAD-AP-TRANCODES                            04140029
041500     END-IF.                                                      04150029
041600                                                                  04160029
041700*---------------------------------------------------------------- 04170029
041800*    FORMAT THE EDI 820 OUTPUT FILE.                              04180029
041801*---------------------------------------------------------------- 04180129
041802* NOTES ON SPECIAL HANDLING OF DISCOUNTS:                         04180229
041803* FOR ORIGINS M01, I01 AND M12, THE DISCOUNT DETAILS ARE          04180329
041804* CALCULATED IN PARAGRAPH C100.  SEPARATE TOTALS ARE KEPT OF      04180429
041805* DISCOUNTS STORED AS PERCENTS AND ANY TERMS DISCOUNTS, AS THESE  04180529
041806* MUST BE SUBTRACTED FROM THE INVOICE NET COST.                   04180629
041807* DISCOUNTS STORED AS AMOUNTS HAVE ALREADY BEEN SUBTRACTED FROM   04180730
041808* THE INVOIC-INVC-NET-COST-AMT.                                   04180830
041809*---------------------------------------------------------------- 04180930
041810 B200-PROCESS-PYMT-DETAILS-FILE.                                  04181030
041811                                                                  04181130
041820     INITIALIZE AP002-REMIT-EXTRACT-RECORD.                       04182029
041830                                                                  04183029
041840     MOVE AP083-PO-NBR         TO AP002-PO-NBR.                   04184029
041850     MOVE AP083-DOC-NBR        TO AP002-INVOICE-ID.               04185029
041860     MOVE AP083-REMIT-VENDOR   TO AP002-REMIT-VENDOR.             04186029
041870     MOVE AP083-PAYMENT-ID-REF TO AP002-PAYMENT-ID-REF.           04187029
041880     MOVE AP083-INVC-SRC       TO AP002-ORIGIN.                   04188029
041890     MOVE AP083-PYMT-DTE       TO AP002-PYMT-DTE.                 04189029
041900     MOVE AP083-VND-NBR        TO AP002-VCHR-VENDOR-ID.           04190029
042000     MOVE AP083-INVC-DTE       TO AP002-DOC-DTE.                  04200029
042100                                                                  04210029
042200     MOVE AP083-PYMT-METHOD    TO AP002-PAY-CYCLE.                04220029
042300     MOVE AP083-PYMT-DTE       TO PV-RFMT-DATE.                   04230029
042400     MOVE PV-RFMT-YYYY         TO PV-NUMERIC-YYYY.                04240029
042500     MOVE PV-RFMT-MM           TO PV-NUMERIC-MM.                  04250029
042600     MOVE PV-RFMT-DD           TO PV-NUMERIC-DD.                  04260029
042700     MOVE PV-NUMERIC-DATE      TO AP002-PAY-CYCLE-SEQ-NBR.        04270029
042800                                                                  04280029
042900     MOVE AP083-INVC-DESCR     TO PV-RSN-TXT.                     04290029
043000     PERFORM C300-CONVERSION-COMMENTS.                            04300029
043100                                                                  04310029
043110     MOVE AP083-PYMNT-AMT TO PV-PYMNT-AMT-TEXT.                   04311029
043120     IF PV-PYMNT-AMT-ZERO                                         04312029
043130        MOVE ZERO              TO AP002-PYMNT-AMT                 04313029
043140     ELSE                                                         04314029
043150        MOVE AP083-PYMNT-AMT   TO PV-PYMNT-AMT-NUM                04315029
043160        MOVE PV-PYMNT-AMT-NUM  TO AP002-PYMNT-AMT                 04316029
043170     END-IF.                                                      04317029
043180                                                                  04318029
043190     INITIALIZE DCLTENTNME.                                       04319029
043200     MOVE AP083-VND-NBR TO EXTENT-DUN-NBR.                        04320029
043300     PERFORM S100-SELECT-VENDOR-NAME.                             04330029
043400     IF PV-NAME-FOUND                                             04340029
043500        MOVE ENTNME-ENT-NAME-DESC TO AP002-VCHR-VENDOR-NME        04350029
043600     ELSE                                                         04360029
043700        MOVE SPACE TO AP002-VCHR-VENDOR-NME                       04370029
043800     END-IF.                                                      04380029
043900                                                                  04390029
044000     IF AP083-PO-NBR > 0                                          04400029
044100        INITIALIZE DCLTPURCHS                                     04410029
044200        MOVE AP083-PO-NBR TO  PURCHS-PO-NBR                       04420029
044300        PERFORM S200-SELECT-DEPT-NBR                              04430029
044400        IF PV-DEPT-FOUND                                          04440029
044500           MOVE PURCHS-DEPT-NBR TO AP002-DEPT-NBR                 04450029
044600        ELSE                                                      04460029
044700           MOVE SPACES TO AP002-DEPT-NBR                          04470029
044800        END-IF                                                    04480029
044900     ELSE                                                         04490029
045000        MOVE SPACES TO AP002-DEPT-NBR                             04500029
045100     END-IF.                                                      04510029
045200                                                                  04520029
045300     SET PV-TRANCODE-NOT-FOUND TO TRUE.                           04530029
045400     PERFORM L200-SEARCH-TRANCODES.                               04540029
045500                                                                  04550029
045700     IF AP083-INVC-SRC = 'M01' OR 'I01' OR 'M12' OR 'P01'         04570031
045800        INITIALIZE DCLTINVOIC                                     04580029
045900        INITIALIZE DCLTMDINVC                                     04590029
046000        MOVE AP083-PO-NBR  TO INVOIC-PO-NBR                       04600029
046100        IF AP083-INVC-SRC = 'M12'                                 04610029
046200           STRING AP083-DOC-NBR                                   04620029
046300                  DELIMITED BY 'SHTG' INTO INVOIC-INVC-ID         04630029
046400        ELSE                                                      04640029
046500           MOVE AP083-DOC-NBR TO INVOIC-INVC-ID                   04650029
046600        END-IF                                                    04660029
046700        PERFORM S300-SELECT-INVOICE-INFO                          04670029
046800        IF PV-INVC-FOUND                                          04680029
046900           MOVE INVOIC-GRO-COST-AMT      TO AP002-GROSS-AMT       04690029
047000           MOVE INVOIC-INVC-NET-COST-AMT TO AP002-NET-AMT         04700029
047100           EVALUATE TRUE                                          04710029
047200              WHEN INVOIC-MTCH-LVL-CDE = 'P'                      04720029
047300                   MOVE ZERO TO AP002-LOC-ID                      04730029
047400              WHEN INVOIC-MTCH-LVL-CDE = 'D'                      04740029
047500                   MOVE INVOIC-DC-NBR TO AP002-LOC-ID             04750029
047600              WHEN INVOIC-MTCH-LVL-CDE = 'S'                      04760029
047700                   MOVE INVOIC-STR-NBR TO AP002-LOC-ID            04770029
047800              WHEN OTHER                                          04780029
047900                   MOVE ZERO TO AP002-LOC-ID                      04790029
048000           END-EVALUATE                                           04800029
048100                                                                  04810029
048200* HANDLING OF DISCOUNTS BEGINS HERE                               04820029
048300           INITIALIZE APPD052-VARIABLES                           04830029
048400           INITIALIZE PV-DISC-AS-PCT-AMT                          04840029
048410                      PV-TERMS-DISC-AMT                           04841029
048411                      PV-DISC-AS-AMT                              04841129
048412                                                                  04841229
048413           MOVE AP083-INVC-NET-COST TO PV-PYMNT-AMT-NUM           04841329
048414           IF PV-PYMNT-AMT-NUM < ZERO                             04841429
048415              COMPUTE PV-PYMNT-AMT-NUM = -1 * PV-PYMNT-AMT-NUM    04841529
048416           END-IF                                                 04841629
048417                                                                  04841729
048418           MOVE INVOIC-GRO-COST-AMT TO APPD052-GROSS-INVOICE-COST 04841829
048419           PERFORM C100-PROCESS-INVOICE-DISCOUNTS                 04841929
048420                                                                  04842029
048430           MOVE PV-TOTAL-DISC-AMT TO AP002-DISCOUNT-AMT           04843029
048440                                                                  04844029
048450           IF PV-TOTAL-DISC-AMT NOT EQUAL ZERO                    04845029
048460              SUBTRACT PV-DISC-AS-PCT-AMT FROM                    04846029
048470              INVOIC-INVC-NET-COST-AMT GIVING AP002-NET-AMT       04847029
048480           END-IF                                                 04848029
048490                                                                  04849029
048500           IF PV-TERMS-DISC-AMT NOT EQUAL ZERO                    04850029
048600              IF AP002-NET-AMT NOT EQUAL PV-PYMNT-AMT-NUM         04860029
048700                 SUBTRACT PV-TERMS-DISC-AMT                       04870029
048710                     FROM AP002-NET-AMT                           04871029
048720                   GIVING AP002-NET-AMT                           04872029
048730              ELSE                                                04873029
048740                 SUBTRACT PV-TERMS-DISC-AMT                       04874029
048750                     FROM AP002-DISCOUNT-AMT                      04875029
048760                   GIVING AP002-DISCOUNT-AMT                      04876029
048761              END-IF                                              04876129
048762           END-IF                                                 04876229
048763                                                                  04876329
048764* HANDLING OF DISCOUNTS ENDS HERE                                 04876429
048765           IF AP083-INVC-SRC = 'M12'                              04876529
048766              MULTIPLY AP002-DISCOUNT-AMT BY -1 GIVING            04876629
048767                                       AP002-DISCOUNT-AMT         04876729
048768              MULTIPLY AP002-NET-AMT      BY -1 GIVING            04876829
048769                                       AP002-NET-AMT              04876929
048770              MULTIPLY AP002-GROSS-AMT    BY -1 GIVING            04877029
048780                                       AP002-GROSS-AMT            04878029
048790           END-IF                                                 04879029
048800        ELSE                                                      04880029
048900           MOVE AP083-INVC-NET-COST TO PV-PYMNT-AMT-TEXT          04890029
049000           IF PV-PYMNT-AMT-ZERO                                   04900029
049100              MOVE ZERO TO AP002-NET-AMT                          04910029
049200                           AP002-GROSS-AMT                        04920029
049300           ELSE                                                   04930029
049400              MOVE AP083-INVC-NET-COST TO PV-PYMNT-AMT-NUM        04940029
049500              MOVE PV-PYMNT-AMT-NUM    TO AP002-NET-AMT           04950029
049600                                          AP002-GROSS-AMT         04960029
049700           END-IF                                                 04970029
049800           MOVE ZERO TO AP002-LOC-ID                              04980029
049900                        AP002-DISCOUNT-AMT                        04990029
050000        END-IF                                                    05000029
050100     ELSE                                                         05010029
050200         IF AP083-INVC-SRC = 'I70'                                05020029
050300            INITIALIZE DCLTINVOIC                                 05030029
050400            MOVE AP083-PO-NBR  TO INVOIC-PO-NBR                   05040029
050500            MOVE AP083-DOC-NBR TO INVOIC-INVC-ID                  05050029
050600            PERFORM S325-SELECT-EXPENSE-INVOICE                   05060029
050700            IF PV-INVC-FOUND                                      05070029
050800               MOVE INVOIC-GRO-COST-AMT      TO AP002-GROSS-AMT   05080029
050900               MOVE INVOIC-INVC-NET-COST-AMT TO AP002-NET-AMT     05090029
051000               MOVE ZERO TO AP002-LOC-ID                          05100029
051100                            AP002-DISCOUNT-AMT                    05110029
051200            ELSE                                                  05120029
051300               MOVE AP083-INVC-NET-COST TO PV-PYMNT-AMT-TEXT      05130029
051400               IF PV-PYMNT-AMT-ZERO                               05140029
051500                  MOVE ZERO TO AP002-NET-AMT                      05150029
051600                               AP002-GROSS-AMT                    05160029
051700                               AP002-DISCOUNT-AMT                 05170029
051800               ELSE                                               05180029
051900                  MOVE AP083-INVC-NET-COST TO PV-PYMNT-AMT-NUM    05190029
052000                  MOVE PV-PYMNT-AMT-NUM    TO AP002-NET-AMT       05200029
052100                                              AP002-GROSS-AMT     05210029
052200                  MOVE ZERO TO AP002-LOC-ID                       05220029
052300                               AP002-DISCOUNT-AMT                 05230029
052400               END-IF                                             05240029
052500               MOVE ZERO TO AP002-LOC-ID                          05250029
052600                            AP002-DISCOUNT-AMT                    05260029
052700            END-IF                                                05270029
052800         ELSE                                                     05280029
052900             IF PV-TRANCODE-FOUND                                 05290029
053000                INITIALIZE DCLTADJRNL                             05300029
053100                INITIALIZE DCLTAJPSINT                            05310029
053200                MOVE AP083-VND-NBR        TO ADJRNL-VND-NBR       05320029
053300                                             AJPSINT-VND-NBR      05330029
053400                MOVE AP083-DOC-NBR        TO ADJRNL-DOC-NBR       05340029
053500                                             AJPSINT-DOC-NBR      05350029
053600                MOVE AP083-INVC-DTE       TO ADJRNL-DOC-DTE       05360029
053700                                             AJPSINT-DOC-DTE      05370029
053800                MOVE AP083-AP-TRN-CDE     TO ADJRNL-AP-TRN-CDE    05380029
053900                                             AJPSINT-AP-TRN-CDE   05390029
054000                PERFORM S350-SELECT-ADJRNL-INFO                   05400029
054100                IF PV-ADJ-FOUND                                   05410029
054200                   MOVE ADJRNL-GRO-COST-AMT TO AP002-GROSS-AMT    05420029
054300                   MOVE ADJRNL-NET-COST-AMT TO AP002-NET-AMT      05430029
054400                   MOVE ADJRNL-STR-NBR      TO AP002-LOC-ID       05440029
054500                   MOVE ADJRNL-DEPT-NBR     TO AP002-DEPT-NBR     05450029
054600                   PERFORM C200-PROCESS-ADJ-DISCOUNTS             05460029
054700                   MOVE PV-ADJ-TOTAL-DISCOUNT                     05470029
054800                                            TO AP002-DISCOUNT-AMT 05480029
054900                ELSE                                              05490029
055000                   MOVE AP083-INVC-NET-COST TO AP002-NET-AMT      05500029
055100                                               AP002-GROSS-AMT    05510029
055200                   MOVE ZERO                TO AP002-LOC-ID       05520029
055300                                               AP002-DISCOUNT-AMT 05530029
055400                END-IF                                            05540029
055500             ELSE                                                 05550029
055600                MOVE AP083-INVC-NET-COST TO AP002-NET-AMT         05560029
055700                                            AP002-GROSS-AMT       05570029
055800                MOVE ZERO                TO AP002-LOC-ID          05580029
055900                                            AP002-DISCOUNT-AMT    05590029
056000             END-IF                                               05600029
056100     END-IF.                                                      05610029
056200                                                                  05620029
056300     SET REMIT-LINE-RECORD TO TRUE.                               05630029
056400     PERFORM W100-WRITE-AP002-RECORD.                             05640029
056500                                                                  05650029
056600     IF PV-RSN-TXT = SPACES                                       05660029
056700        MOVE SPACES      TO AP002-COMMENT-LINE1                   05670029
056800                            AP002-COMMENT-LINE2                   05680029
056900                            AP002-COMMENT-LINE3                   05690029
057000     ELSE                                                         05700029
057100        MOVE SPACES      TO AP002-COMMENT-LINE1                   05710029
057200                            AP002-COMMENT-LINE2                   05720029
057300                            AP002-COMMENT-LINE3                   05730029
057400        MOVE PV-RSN-TXT1 TO AP002-COMMENT-LINE1                   05740029
057500        MOVE PV-RSN-TXT2 TO AP002-COMMENT-LINE2                   05750029
057600        MOVE PV-RSN-TXT3 TO AP002-COMMENT-LINE3                   05760029
057700        SET REMIT-COMMENT-RECORD TO TRUE                          05770029
057800        PERFORM W100-WRITE-AP002-RECORD                           05780029
057900     END-IF.                                                      05790029
058000                                                                  05800029
058100     PERFORM R100-READ-PYMT-DETAILS-FILE.                         05810029
058200                                                                  05820029
058300 B300-END-OF-PROGRAM.                                             05830029
058400                                                                  05840029
058500     DISPLAY ' '.                                                 05850029
058600     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     05860029
058700     DISPLAY ' '.                                                 05870029
058800                                                                  05880029
058900     DISPLAY 'TOTAL RECORDS READ        = ' PV-COUNT-READ.        05890029
059000     DISPLAY ' '.                                                 05900029
059100     DISPLAY 'EDITED RECORDS WRITTEN    = ' PV-COUNT-WRITTEN.     05910029
059200     DISPLAY ' '.                                                 05920029
059300     DISPLAY 'APKUT068 END OF PROCESSING '.                       05930029
059400     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     05940029
059500                                                                  05950029
059600     CLOSE PYMT-DETAILS-FILE                                      05960029
059700           EDI820-EXTRACT-FILE.                                   05970029
059800                                                                  05980029
059900                                                                  05990029
060000*---------------------------------------------------------------- 06000029
060100*  RETRIEVE ALL ALLOWANCES FOR AN INVOICE AND SUM THE DISCOUNTS   06010029
060200*  AND FORMAT THE COMMENT RECORD.                                 06020029
060300*                                                                 06030029
060400*  LOGIC WAS ADDED TO ACCUMULATE DISCOUNTS STORED AS PERCENTS     06040029
060500*  SEPARATE FROM THE DISCOUNT TOTAL.  DISCOUNTS STORED AS         06050029
060600*  PERCENTS NEED TO BE DEDUCTED FROM THE NET COST, WHEREAS        06060029
060610*  DISCOUNTS STORED AS AMOUNTS HAVE ALREADY BEEN DEDUCTED FROM    06061029
060620*  THE NET COST STORED IN THE TINVOIC DATABASE.                   06062029
060630*---------------------------------------------------------------- 06063029
060640 C100-PROCESS-INVOICE-DISCOUNTS.                                  06064029
060650                                                                  06065029
060660     IF MDINVC-TERM-SEL-CDE = PC-PURCHASE-TERMS                   06066029
060670         PERFORM S600-GET-PO-TERMS                                06067029
060680         MOVE PAYTRM-DISCOUNT-PCT TO HOLD-DISC-PCT-DEC            06068029
060690     ELSE                                                         06069029
060700         IF MDINVC-TERM-SEL-CDE = PC-INVOICE-TERMS                06070029
060800             MOVE INVOIC-PO-NBR TO INVCTM-PO-NBR                  06080029
060900             MOVE INVOIC-INVC-ID TO INVCTM-INVC-ID                06090029
061000             PERFORM S700-GET-INVOICE-TERMS                       06100029
061100             MOVE INVCTM-DISC-PCT TO HOLD-DISC-PCT-DEC            06110029
061200         END-IF                                                   06120029
061300     END-IF.                                                      06130029
061400                                                                  06140029
061500     IF HOLD-DISC-PCT-DEC = ZERO                                  06150029
061600        CONTINUE                                                  06160029
061700     ELSE                                                         06170029
061800        COMPUTE PV-TERMS-DISC-AMT =                               06180029
061900         (INVOIC-GRO-COST-AMT * HOLD-DISC-PCT-DEC) + .005         06190029
062100     END-IF.                                                      06210029
062110                                                                  06211029
062120     MOVE INVOIC-PO-NBR  TO ALCHRG-PO-NBR.                        06212029
062121     MOVE INVOIC-INVC-ID TO ALCHRG-INVC-ID.                       06212129
062122     PERFORM X300-OPEN-ALLOW-CSR.                                 06212229
062123                                                                  06212329
062124     SET NOT-END-OF-ALLOW-CSR TO TRUE.                            06212429
062125     PERFORM S500-FETCH-ALLOW-CSR.                                06212529
062126     PERFORM UNTIL END-OF-ALLOW-CSR                               06212629
062127         PERFORM E400-CALC-ALW-CHRG                               06212729
062128         IF ALCHRG-ALW-CHRG-PCT > 0                               06212829
062129            ADD APPD052-ALW-CHRG-AMT TO PV-DISC-AS-PCT-AMT        06212929
062130         END-IF                                                   06213029
062140         IF ALCHRG-ALW-CHRG-AMT > 0                               06214029
062150            ADD APPD052-ALW-CHRG-AMT TO PV-DISC-AS-AMT            06215029
062160         END-IF                                                   06216029
062170         PERFORM S500-FETCH-ALLOW-CSR                             06217029
062180     END-PERFORM.                                                 06218029
062190                                                                  06219029
062200     PERFORM X400-CLOSE-ALLOW-CSR.                                06220029
062300                                                                  06230029
062400     COMPUTE PV-TOTAL-DISC-AMT =                                  06240029
062500         (INVOIC-GRO-COST-AMT * HOLD-DISC-PCT-DEC) + .005         06250029
062600               + APPD052-NEW-STORE-AMT                            06260029
062700               + APPD052-TRADE-AMT                                06270029
062800               + APPD052-MOS-DISC-AMT                             06280029
062900               + APPD052-ADV-DISC-AMT                             06290029
063000               + APPD052-COOP-ADV-ALLOW-AMT                       06300029
063100               + APPD052-PRFT-ASST-COOP-AMT                       06310029
063200               + APPD052-MISC-DISC-AMT.                           06320029
063300                                                                  06330029
063400     PERFORM D100-PROCESS-DISCOUNTS-COMMENT.                      06340029
063500                                                                  06350029
063600*---------------------------------------------------------------- 06360029
063700*  STRING DISCOUNT PERCENTS INTO COMMENT BLOCK                    06370029
063800*---------------------------------------------------------------- 06380029
063900 C200-PROCESS-ADJ-DISCOUNTS.                                      06390029
064000                                                                  06400029
064100     COMPUTE PV-ADJ-TOTAL-DISCOUNT = ADJRNL-TERM-DISC-AMT         06410029
064200                                   + ADJRNL-NW-STR-DISC-AMT       06420029
064300                                   + ADJRNL-TRD-DISC-AMT          06430029
064400                                   + ADJRNL-MOS-DISC-AMT.         06440029
064500                                                                  06450029
064600     IF  PV-PSC-COMMENT-NOT-FOUND                                 06460029
064700     IF  ADJRNL-TERM-DISC-AMT = ZERO                              06470029
064800         CONTINUE                                                 06480029
064900     ELSE                                                         06490029
065000         MOVE PC-PAY-CDE        TO COMMENT-ALLOW-CDE              06500029
065100         MOVE ADJRNL-TERM-DISC-AMT TO COMMENT-ALLOW-AMT           06510029
065200         MOVE ADJRNL-TERM-DISC-PCT TO COMMENT-ALLOW-PCT           06520029
065300         IF  PV-PSC-COMMENT-NOT-FOUND                             06530029
065400             PERFORM D200-PROCESS-COMMENT-BLOCK                   06540029
065500         END-IF                                                   06550029
065600     END-IF.                                                      06560029
065700                                                                  06570029
065800     IF  ADJRNL-NW-STR-DISC-AMT = ZERO                            06580029
065900         CONTINUE                                                 06590029
066000     ELSE                                                         06600029
066100         MOVE AP083-VND-NBR         TO PV-VENDOR-CHECK            06610029
066200         IF  PV-SAM-VENDOR                                        06620029
066300             MOVE PC-SAM-CDE        TO COMMENT-ALLOW-CDE          06630029
066400         ELSE                                                     06640029
066500             MOVE PC-NSD-CDE        TO COMMENT-ALLOW-CDE          06650029
066600         END-IF                                                   06660029
066700         MOVE ADJRNL-NW-STR-DISC-AMT TO COMMENT-ALLOW-AMT         06670029
066800         MOVE ADJRNL-NW-STR-DISC-PCT TO COMMENT-ALLOW-PCT         06680029
066900         IF  PV-PSC-COMMENT-NOT-FOUND                             06690029
067000             PERFORM D200-PROCESS-COMMENT-BLOCK                   06700029
067100         END-IF                                                   06710029
067200     END-IF.                                                      06720029
067300                                                                  06730029
067400     IF ADJRNL-TRD-DISC-AMT = ZERO                                06740029
067500        CONTINUE                                                  06750029
067600     ELSE                                                         06760029
067700         MOVE PC-TRD-CDE          TO COMMENT-ALLOW-CDE            06770029
067800         MOVE ADJRNL-TRD-DISC-AMT TO COMMENT-ALLOW-AMT            06780029
067900         MOVE ADJRNL-TRD-DISC-PCT TO COMMENT-ALLOW-PCT            06790029
068000         IF  PV-PSC-COMMENT-NOT-FOUND                             06800029
068100             PERFORM D200-PROCESS-COMMENT-BLOCK                   06810029
068200         END-IF                                                   06820029
068300     END-IF.                                                      06830029
068400                                                                  06840029
068500     IF ADJRNL-MOS-DISC-AMT = ZERO                                06850029
068600       CONTINUE                                                   06860029
068700     ELSE                                                         06870029
068800         MOVE PC-MOS-CDE           TO COMMENT-ALLOW-CDE           06880029
068900         MOVE ADJRNL-MOS-DISC-AMT  TO COMMENT-ALLOW-AMT           06890029
069000         MOVE ADJRNL-MOS-DISC-PCT  TO COMMENT-ALLOW-PCT           06900029
069100         IF  PV-PSC-COMMENT-NOT-FOUND                             06910029
069200             PERFORM D200-PROCESS-COMMENT-BLOCK                   06920029
069300         END-IF                                                   06930029
069400     END-IF.                                                      06940029
069410                                                                  06941029
069420                                                                  06942029
069430*-----------------------------------------------------------------06943029
069440*  EXAMINE COMMENTS SENT FROM ORACLE TO SEE IF THEY ARE FROM      06944029
069450*  CONVERTED PEOPLESOFT INVOICES AND IF SO, SET FLAG SO ADDITIONAL06945029
069460*  COMMENTS WILL NOT BE GENERATED.                                06946029
069470*-----------------------------------------------------------------06947029
069480 C300-CONVERSION-COMMENTS.                                        06948029
069490                                                                  06949029
069500     IF  PV-RSN-TXT-PSC-PFIX = 'PSCPSC'                           06950029
069600         IF  PV-RSN-TXT1-PSC = SPACES                             06960029
069700         AND PV-RSN-TXT2-PSC = SPACES                             06970029
069800         AND PV-RSN-TXT3-PSC = SPACES                             06980029
069900             MOVE SPACES TO PV-RSN-TXT                            06990029
070000             SET PV-PSC-COMMENT-NOT-FOUND TO TRUE                 07000029
070100         ELSE                                                     07010029
070200             SET PV-PSC-COMMENT-FOUND TO TRUE                     07020029
070210             MOVE PV-RSN-TXT1-PSC TO PV-RSN-TXT1                  07021029
070220             MOVE PV-RSN-TXT2-PSC TO PV-RSN-TXT2                  07022029
070221             MOVE PV-RSN-TXT3-PSC TO PV-RSN-TXT3                  07022129
070222         END-IF                                                   07022229
070223     ELSE                                                         07022329
070224         SET PV-PSC-COMMENT-NOT-FOUND TO TRUE                     07022429
070225     END-IF.                                                      07022529
070226*-----------------------------------------------------------------07022629
070227*  STRING DISCOUNT PERCENTS INTO COMMENT BLOCK                    07022729
070228*-----------------------------------------------------------------07022829
070229 D100-PROCESS-DISCOUNTS-COMMENT.                                  07022929
070230                                                                  07023029
070240     IF  APPD052-NEW-STORE-AMT = ZERO                             07024029
070250         CONTINUE                                                 07025029
070260     ELSE                                                         07026029
070270         MOVE AP083-VND-NBR         TO PV-VENDOR-CHECK            07027029
070280         IF  PV-SAM-VENDOR                                        07028029
070290             MOVE PC-SAM-CDE        TO COMMENT-ALLOW-CDE          07029029
070300         ELSE                                                     07030029
070400             MOVE PC-NSD-CDE        TO COMMENT-ALLOW-CDE          07040029
070500         END-IF                                                   07050029
070600         MOVE APPD052-NEW-STORE-AMT TO COMMENT-ALLOW-AMT          07060029
070700         MOVE APPD052-NEW-STORE-DISC-PCT TO COMMENT-ALLOW-PCT     07070029
070800         IF  PV-PSC-COMMENT-NOT-FOUND                             07080029
070900             PERFORM D200-PROCESS-COMMENT-BLOCK                   07090029
071000         END-IF                                                   07100029
071100     END-IF.                                                      07110029
071200                                                                  07120029
071300     IF APPD052-TRADE-AMT = ZERO                                  07130029
071400        CONTINUE                                                  07140029
071500     ELSE                                                         07150029
071600         MOVE PC-TRD-CDE            TO COMMENT-ALLOW-CDE          07160029
071700         MOVE APPD052-TRADE-AMT     TO COMMENT-ALLOW-AMT          07170029
071800         MOVE APPD052-TRADE-DISC-PCT TO COMMENT-ALLOW-PCT         07180029
071900         IF  PV-PSC-COMMENT-NOT-FOUND                             07190029
072000             PERFORM D200-PROCESS-COMMENT-BLOCK                   07200029
072100         END-IF                                                   07210029
072200     END-IF.                                                      07220029
072300                                                                  07230029
072310     IF APPD052-MOS-DISC-AMT = ZERO                               07231029
072320       CONTINUE                                                   07232029
072330     ELSE                                                         07233029
072340         MOVE PC-MOS-CDE            TO COMMENT-ALLOW-CDE          07234029
072350         MOVE APPD052-MOS-DISC-AMT  TO COMMENT-ALLOW-AMT          07235029
072360         MOVE APPD052-MOS-DISC-PCT  TO COMMENT-ALLOW-PCT          07236029
072370         IF  PV-PSC-COMMENT-NOT-FOUND                             07237029
072380             PERFORM D200-PROCESS-COMMENT-BLOCK                   07238029
072390         END-IF                                                   07239029
072400     END-IF.                                                      07240029
072500                                                                  07250029
072600     IF  APPD052-ADV-DISC-AMT = ZERO                              07260029
072700         CONTINUE                                                 07270029
072800     ELSE                                                         07280029
072900         MOVE PC-ADV-CDE            TO COMMENT-ALLOW-CDE          07290029
073000         MOVE APPD052-ADV-DISC-AMT  TO COMMENT-ALLOW-AMT          07300029
073100         MOVE APPD052-ADV-DISC-PCT  TO COMMENT-ALLOW-PCT          07310029
073200         IF  PV-PSC-COMMENT-NOT-FOUND                             07320029
073300             PERFORM D200-PROCESS-COMMENT-BLOCK                   07330029
073400         END-IF                                                   07340029
073500     END-IF.                                                      07350029
073600                                                                  07360029
073700     IF  APPD052-COOP-ADV-ALLOW-AMT = ZERO                        07370029
073800         CONTINUE                                                 07380029
073900     ELSE                                                         07390029
074000         MOVE PC-COOP-CDE                TO COMMENT-ALLOW-CDE     07400029
074100         MOVE APPD052-COOP-ADV-ALLOW-AMT TO COMMENT-ALLOW-AMT     07410029
074200         MOVE APPD052-COOP-ADV-ALLOW-PCT TO COMMENT-ALLOW-PCT     07420029
074300         IF  PV-PSC-COMMENT-NOT-FOUND                             07430029
074400             PERFORM D200-PROCESS-COMMENT-BLOCK                   07440029
074500         END-IF                                                   07450029
074600     END-IF.                                                      07460029
074700                                                                  07470029
074800     IF  APPD052-PRFT-ASST-COOP-AMT = ZERO                        07480029
074900         CONTINUE                                                 07490029
075000     ELSE                                                         07500029
075100         MOVE PC-ALW-CDE                 TO COMMENT-ALLOW-CDE     07510029
075200         MOVE APPD052-PRFT-ASST-COOP-AMT TO COMMENT-ALLOW-AMT     07520029
075300         MOVE APPD052-PRFT-ASST-COOP-PCT TO COMMENT-ALLOW-PCT     07530029
075400         IF  PV-PSC-COMMENT-NOT-FOUND                             07540029
075500             PERFORM D200-PROCESS-COMMENT-BLOCK                   07550029
075600         END-IF                                                   07560029
075700     END-IF.                                                      07570029
075800                                                                  07580029
075900     IF  APPD052-MISC-DISC-AMT = ZERO                             07590029
076000         CONTINUE                                                 07600029
076100     ELSE                                                         07610029
076200         MOVE PC-MISC-CDE           TO COMMENT-ALLOW-CDE          07620029
076300         MOVE APPD052-MISC-DISC-AMT TO COMMENT-ALLOW-AMT          07630029
076400         MOVE APPD052-MISC-DISC-PCT TO COMMENT-ALLOW-PCT          07640029
076500         IF  PV-PSC-COMMENT-NOT-FOUND                             07650029
076600             PERFORM D200-PROCESS-COMMENT-BLOCK                   07660029
076700         END-IF                                                   07670029
076800     END-IF.                                                      07680029
076810                                                                  07681029
076820*----------------------------------------------------------------*07682029
076830*   PROCESSES THE COMMENT BLOCK INFORMATION FOR THE ALLOWANCES.  *07683029
076840*----------------------------------------------------------------*07684029
076850 D200-PROCESS-COMMENT-BLOCK.                                      07685029
076860                                                                  07686029
076870     IF PV-RSN-TXT = SPACES                                       07687029
076880        STRING COMMENT-BLOCK DELIMITED BY SIZE                    07688029
076890          INTO PV-RSN-TXT                                         07689029
076900     ELSE                                                         07690029
077000        MOVE LENGTH OF PV-RSN-TXT TO PV-START                     07700029
077100        PERFORM UNTIL PV-RSN-TXT (PV-START:1) > SPACES            07710029
077200                   OR PV-START = +0                               07720029
077300           COMPUTE PV-START = PV-START - 1                        07730029
077400        END-PERFORM                                               07740029
077500        EVALUATE TRUE                                             07750029
077600        WHEN PV-START < 56                                        07760029
077700           COMPUTE PV-START-POINT = PV-START + 2                  07770029
077800           STRING COMMENT-BLOCK DELIMITED BY SIZE                 07780029
077900             INTO PV-RSN-TXT                                      07790029
078000             WITH POINTER PV-START-POINT                          07800029
078100        WHEN PV-START > 55 AND PV-START < 81                      07810029
078200           MOVE 81 TO PV-START-POINT                              07820029
078300           STRING COMMENT-BLOCK DELIMITED BY SIZE                 07830029
078400             INTO PV-RSN-TXT                                      07840029
078500             WITH POINTER PV-START-POINT                          07850029
078600        WHEN PV-START > 81 AND PV-START < 136                     07860029
078700           COMPUTE PV-START-POINT = PV-START + 2                  07870029
078800           STRING COMMENT-BLOCK DELIMITED BY SIZE                 07880029
078900             INTO PV-RSN-TXT                                      07890029
079000             WITH POINTER PV-START-POINT                          07900029
079100        WHEN PV-START > 135 AND PV-START < 161                    07910029
079200           MOVE 161 TO PV-START-POINT                             07920029
079300           STRING COMMENT-BLOCK DELIMITED BY SIZE                 07930029
079400             INTO PV-RSN-TXT                                      07940029
079500             WITH POINTER PV-START-POINT                          07950029
079600        WHEN PV-START > 161 AND PV-START < 216                    07960029
079700           COMPUTE PV-START-POINT = PV-START + 2                  07970029
079800           STRING COMMENT-BLOCK DELIMITED BY SIZE                 07980029
079900             INTO PV-RSN-TXT                                      07990029
080000             WITH POINTER PV-START-POINT                          08000029
080100        END-EVALUATE                                              08010029
080200     END-IF.                                                      08020029
080300                                                                  08030029
080400*----------------------------------------------------------------*08040029
080500*    PERFORMS THE COPYBOOK SUBROUTINE THAT CALCULATES VARIOUS     08050029
080600*    DISCOUNT PERCENTS, DISCOUNT AMOUNTS, AND CHARGES             08060029
080700*----------------------------------------------------------------*08070029
080800 E400-CALC-ALW-CHRG.                                              08080029
080900                                                                  08090029
081000     PERFORM CALC-ALW-CHRG.                                       08100029
081100                                                                  08110029
081200     COPY APPD052.                                                08120029
081300                                                                  08130029
081400                                                                  08140029
081500*---------------------------------------------------------------- 08150029
081600*  FETCH ROWS FROM THE TRANCODE CURSOR AND LOAD INTERNAL TABLE.   08160029
081700*  NOTE THAT ENTRIES ARE NOT LOADED FOR PAYROLL, EXPENSE OR MDS.  08170029
081800*  THE TRANCODE TABLE WILL BE USED TO IDENTIFY SOURCES THAT WILL  08180029
081900*  BE FOUND ON THE ADJUSTMENT DATABASE, SO ONLY ADJUSTMENT        08190029
082000*  TRANCODES ARE LOADED.                                          08200029
082100*---------------------------------------------------------------- 08210029
082200 L100-LOAD-AP-TRANCODES.                                          08220029
082300                                                                  08230029
082400     PERFORM X100-OPEN-TRANCODE-CSR.                              08240029
082500                                                                  08250029
082600     PERFORM VARYING IDX1 FROM 1 BY 1                             08260029
082700       UNTIL IDX1 > MAX-IDX1                                      08270029
082800          OR END-OF-TRNCDE-CSR                                    08280029
082900       PERFORM S400-FETCH-TRANCODES                               08290029
083000       MOVE TRNCDE-BTCH-SRC-CDE  TO PV-CHECK-ORIGIN               08300029
083100       EVALUATE TRUE                                              08310029
083200         WHEN PV-ORIGIN-ADJUST                                    08320029
083300              MOVE 'A' TO TBL-ORIGIN-CDE(IDX1)                    08330029
083400              MOVE TRNCDE-AP-TRN-CDE TO TBL-AP-TRN-CDE (IDX1)     08340029
083500         WHEN PV-ORIGIN-MERCH                                     08350029
083600              MOVE SPACES TO TBL-ORIGIN-CDE(IDX1)                 08360029
083700                             TBL-AP-TRN-CDE (IDX1)                08370029
083800         WHEN PV-ORIGIN-IMPORT                                    08380029
083900              IF TRNCDE-AP-TRN-CDE = '70'                         08390029
084000                 MOVE SPACES TO TBL-ORIGIN-CDE(IDX1)              08400029
084100                                TBL-AP-TRN-CDE (IDX1)             08410029
084200              ELSE                                                08420029
084300                 MOVE 'A' TO TBL-ORIGIN-CDE(IDX1)                 08430029
084400                 MOVE TRNCDE-AP-TRN-CDE TO TBL-AP-TRN-CDE (IDX1)  08440029
084500              END-IF                                              08450029
084600         WHEN PV-ORIGIN-PAYROLL                                   08460029
084700              MOVE SPACES TO TBL-ORIGIN-CDE(IDX1)                 08470029
084800                             TBL-AP-TRN-CDE (IDX1)                08480029
084900         WHEN PV-ORIGIN-EXPENSE                                   08490029
085000              MOVE SPACES TO TBL-ORIGIN-CDE(IDX1)                 08500029
085100                             TBL-AP-TRN-CDE (IDX1)                08510029
085200       END-EVALUATE                                               08520029
085300     END-PERFORM.                                                 08530029
085400                                                                  08540029
085500     IF IDX1 > MAX-IDX1                                           08550029
085600        SET AC-TABLE-OVERFLOW TO TRUE                             08560029
085700        MOVE 'MAX ENTRIES ON TRANCODE TABLE EXCEEDED'             08570029
085800          TO AA-MESSAGE-LINE                                      08580029
085900        MOVE 'L100-LOAD-AP-TRANCODES' TO AA-PARAGRAPH-NAME        08590029
086000        PERFORM Z998-ABEND                                        08600029
086100     END-IF.                                                      08610029
086200                                                                  08620029
086300     PERFORM X200-CLOSE-TRANCODE-CSR.                             08630029
086400                                                                  08640029
086500*---------------------------------------------------------------- 08650029
086600*  SEARCH THE TRANCODE INTERNAL TABLE TO SEE IF THE TRANCODE IS   08660029
086700*  FOUND.  WHEN A TRANCODE IS FOUND, THE LOOKUP CAN BE DONE ON    08670029
086800*  THE ADJUSTMENT DATABASE.                                       08680029
086900*---------------------------------------------------------------- 08690029
087000 L200-SEARCH-TRANCODES.                                           08700029
087100                                                                  08710029
087200     PERFORM VARYING IDX1 FROM 1 BY 1                             08720029
087300       UNTIL IDX1 > MAX-IDX1                                      08730029
087400          OR PV-TRANCODE-FOUND                                    08740029
087500       IF TBL-AP-TRN-CDE(IDX1) = AP083-AP-TRN-CDE                 08750029
087600          SET PV-TRANCODE-FOUND TO TRUE                           08760029
087700       END-IF                                                     08770029
087800     END-PERFORM.                                                 08780029
087900                                                                  08790029
088000                                                                  08800029
088100 R100-READ-PYMT-DETAILS-FILE.                                     08810029
088200*---------------------------------------------------------------- 08820029
088300*    READ THE PYMT-DETAILS-FILE INTO COPYBOOK APRD060             08830029
088400*---------------------------------------------------------------- 08840029
088500                                                                  08850029
088600     READ PYMT-DETAILS-FILE INTO AP083-RECORD                     08860029
088700       AT END                                                     08870029
088800         SET PS-PYMT-DETAILS-END TO TRUE                          08880029
088900                                                                  08890029
089000       NOT AT END                                                 08900029
089100         ADD 1 TO PV-COUNT-READ                                   08910029
089200     END-READ.                                                    08920029
089300                                                                  08930029
089400*---------------------------------------------------------------- 08940029
089500*   SELECTS VENDOR NAME FROM TEXTENT, & TENTNME                   08950029
089600*---------------------------------------------------------------- 08960029
089700 S100-SELECT-VENDOR-NAME.                                         08970029
089800                                                                  08980029
089900     MOVE 'S100-SELECT-VENDOR-NAME '  TO AA-PARAGRAPH-NAME.       08990029
090000                                                                  09000029
090100     EXEC SQL                                                     09010029
090200         SELECT NM.ENT_NAME_DESC                                  09020029
090300           INTO :ENTNME-ENT-NAME-DESC                             09030029
090400           FROM TEXTENT EX                                        09040029
090500              , TENTNME NM                                        09050029
090600          WHERE DUN_NBR     =  :EXTENT-DUN-NBR                    09060029
090700            AND EX.ENT_ID   =  NM.ENT_ID                          09070029
090800            AND NM.TYPE_CDE = '01'                                09080029
090900     END-EXEC.                                                    09090029
091000                                                                  09100029
091100     EVALUATE TRUE                                                09110029
091200         WHEN SQLCODE = ZERO                                      09120029
091300             SET PV-NAME-FOUND TO TRUE                            09130029
091400         WHEN SQLCODE = +100                                      09140029
091500             SET PV-NAME-NOT-FOUND TO TRUE                        09150029
091600                                                                  09160029
091700         WHEN SQLWARN0 NOT = SPACES                               09170029
091800         WHEN SQLCODE  NOT = ZERO                                 09180029
091900             DISPLAY 'VENDOR NUMBER = ' EXTENT-DUN-NBR            09190029
092000             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       09200029
092100             MOVE 'TEXTENT'             TO AA-DB2-TABLE-1         09210029
092200             MOVE 'TENTNME'             TO AA-DB2-TABLE-2         09220029
092300             PERFORM Z999-DB2-ABEND                               09230029
092400     END-EVALUATE.                                                09240029
092500                                                                  09250029
092600*---------------------------------------------------------------- 09260029
092700*   SELECTS DEPT FROM TPURCHS                                     09270029
092800*---------------------------------------------------------------- 09280029
092900 S200-SELECT-DEPT-NBR.                                            09290029
093000                                                                  09300029
093100     MOVE 'S200-SELECT-DEPT-NBR'  TO AA-PARAGRAPH-NAME.           09310029
093200                                                                  09320029
093300     EXEC SQL                                                     09330029
093400         SELECT DEPT_NBR                                          09340029
093500           INTO :PURCHS-DEPT-NBR                                  09350029
093600           FROM TPURCHS                                           09360029
093700          WHERE PO_NBR          =  :PURCHS-PO-NBR                 09370029
093800            AND VER_STATUS_CDE  = 'A'                             09380029
093900     END-EXEC.                                                    09390029
094000                                                                  09400029
094100     EVALUATE TRUE                                                09410029
094200         WHEN SQLCODE = ZERO                                      09420029
094300             SET PV-DEPT-FOUND TO TRUE                            09430029
094400         WHEN SQLCODE = +100                                      09440029
094500             SET PV-DEPT-NOT-FOUND TO TRUE                        09450029
094600         WHEN SQLWARN0 NOT = SPACES                               09460029
094700         WHEN SQLCODE  NOT = ZERO                                 09470029
094800             DISPLAY 'AP083 PO-NBR      = ' AP083-PO-NBR          09480029
094900             MOVE 'UNSUCCESSFUL SELECT FOR PO' TO AA-DB2-OPERATION09490029
095000             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                09500029
095100             PERFORM Z999-DB2-ABEND                               09510029
095200     END-EVALUATE.                                                09520029
095300                                                                  09530029
095400*---------------------------------------------------------------- 09540029
095500*   SELECTS DATA FROM INVOICE HEADER TINVOIC                      09550029
095600*---------------------------------------------------------------- 09560029
095700 S300-SELECT-INVOICE-INFO.                                        09570029
095800                                                                  09580029
095900     MOVE 'S300-SELECT-INVOICE-INFO' TO AA-PARAGRAPH-NAME.        09590029
096000                                                                  09600029
096100     EXEC SQL                                                     09610029
096200         SELECT I.GRO_COST_AMT                                    09620029
096300              , I.INVC_NET_COST_AMT                               09630029
096400              , I.STR_NBR                                         09640029
096500              , I.DC_NBR                                          09650029
096600              , I.MTCH_LVL_CDE                                    09660029
096700              , M.TERM_SEL_CDE                                    09670029
096800           INTO :INVOIC-GRO-COST-AMT                              09680029
096900              , :INVOIC-INVC-NET-COST-AMT                         09690029
097000              , :INVOIC-STR-NBR                                   09700029
097100              , :INVOIC-DC-NBR                                    09710029
097200              , :INVOIC-MTCH-LVL-CDE                              09720029
097300              , :MDINVC-TERM-SEL-CDE                              09730029
097400           FROM TINVOIC I                                         09740029
097500              , TMDINVC M                                         09750029
097600          WHERE I.PO_NBR   = :INVOIC-PO-NBR                       09760029
097700            AND I.INVC_ID  = :INVOIC-INVC-ID                      09770029
097800            AND I.PO_NBR   = M.PO_NBR                             09780029
097900            AND I.INVC_ID  = M.INVC_ID                            09790029
098000     END-EXEC.                                                    09800029
098100                                                                  09810029
098200                                                                  09820029
098300     EVALUATE TRUE                                                09830029
098400         WHEN SQLCODE = ZERO                                      09840029
098500             SET PV-INVC-FOUND TO TRUE                            09850029
098600         WHEN SQLCODE = +100                                      09860029
098700             SET PV-INVC-NOT-FOUND TO TRUE                        09870029
098800         WHEN SQLWARN0 NOT = SPACES                               09880029
098900         WHEN SQLCODE  NOT = ZERO                                 09890029
099000             DISPLAY 'AP083 PO-NBR      = ' AP083-PO-NBR          09900029
099100             DISPLAY 'AP083 DOC-NBR     = ' AP083-DOC-NBR         09910029
099200             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OPERATION      09920029
099300             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                09930029
099400             PERFORM Z999-DB2-ABEND                               09940029
099500     END-EVALUATE.                                                09950029
099600                                                                  09960029
099700*---------------------------------------------------------------- 09970029
099800*   SELECTS DATA FROM INVOICE HEADER TINVOIC                      09980029
099900*---------------------------------------------------------------- 09990029
100000 S325-SELECT-EXPENSE-INVOICE.                                     10000029
100100                                                                  10010029
100200     MOVE 'S325-SELECT-EXPENSE-INVOICE' TO AA-PARAGRAPH-NAME.     10020029
100300                                                                  10030029
100400     EXEC SQL                                                     10040029
100500         SELECT I.GRO_COST_AMT                                    10050029
100600              , I.INVC_NET_COST_AMT                               10060029
100700              , I.STR_NBR                                         10070029
100800              , I.DC_NBR                                          10080029
100900              , I.MTCH_LVL_CDE                                    10090029
101000           INTO :INVOIC-GRO-COST-AMT                              10100029
101100              , :INVOIC-INVC-NET-COST-AMT                         10110029
101200              , :INVOIC-STR-NBR                                   10120029
101300              , :INVOIC-DC-NBR                                    10130029
101400              , :INVOIC-MTCH-LVL-CDE                              10140029
101500           FROM TINVOIC I                                         10150029
101600          WHERE I.PO_NBR   = :INVOIC-PO-NBR                       10160029
101700            AND I.INVC_ID  = :INVOIC-INVC-ID                      10170029
101800     END-EXEC.                                                    10180029
101900                                                                  10190029
102000     EVALUATE TRUE                                                10200029
102100         WHEN SQLCODE = ZERO                                      10210029
102200             SET PV-INVC-FOUND TO TRUE                            10220029
102300         WHEN SQLCODE = +100                                      10230029
102400             SET PV-INVC-NOT-FOUND TO TRUE                        10240029
102500         WHEN SQLWARN0 NOT = SPACES                               10250029
102600         WHEN SQLCODE  NOT = ZERO                                 10260029
102700             DISPLAY 'AP083 PO-NBR      = ' AP083-PO-NBR          10270029
102800             DISPLAY 'AP083 DOC-NBR     = ' AP083-DOC-NBR         10280029
102900             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OPERATION      10290029
103000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                10300029
103100             PERFORM Z999-DB2-ABEND                               10310029
103200     END-EVALUATE.                                                10320029
103300                                                                  10330029
103400*---------------------------------------------------------------- 10340029
103500*   SELECTS DATA FROM ADJUSTMENT JOURNAL HEADER TADJRNL           10350029
103600*---------------------------------------------------------------- 10360029
103700 S350-SELECT-ADJRNL-INFO.                                         10370029
103800                                                                  10380029
103900     MOVE 'S350-SELECT-ADJRNL-INFO' TO AA-PARAGRAPH-NAME.         10390029
104000                                                                  10400029
104100     EXEC SQL                                                     10410029
104200         SELECT GRO_COST_AMT                                      10420029
104300              , NET_COST_AMT                                      10430029
104400              , STR_NBR                                           10440029
104500              , DEPT_NBR                                          10450029
104600              , TERM_DISC_PCT                                     10460029
104700              , TERM_DISC_AMT                                     10470029
104800              , NW_STR_DISC_PCT                                   10480029
104900              , NW_STR_DISC_AMT                                   10490029
105000              , TRD_DISC_PCT                                      10500029
105100              , TRD_DISC_AMT                                      10510029
105200              , MOS_DISC_PCT                                      10520029
105300              , MOS_DISC_AMT                                      10530029
105400           INTO :ADJRNL-GRO-COST-AMT                              10540029
105500              , :ADJRNL-NET-COST-AMT                              10550029
105600              , :ADJRNL-STR-NBR                                   10560029
105700              , :ADJRNL-DEPT-NBR                                  10570029
105800              , :ADJRNL-TERM-DISC-PCT                             10580029
105900              , :ADJRNL-TERM-DISC-AMT                             10590029
106000              , :ADJRNL-NW-STR-DISC-PCT                           10600029
106100              , :ADJRNL-NW-STR-DISC-AMT                           10610029
106200              , :ADJRNL-TRD-DISC-PCT                              10620029
106300              , :ADJRNL-TRD-DISC-AMT                              10630029
106400              , :ADJRNL-MOS-DISC-PCT                              10640029
106500              , :ADJRNL-MOS-DISC-AMT                              10650029
106600           FROM TADJRNL                                           10660029
106700          WHERE VND_NBR    = :ADJRNL-VND-NBR                      10670029
106800            AND DOC_NBR    = :ADJRNL-DOC-NBR                      10680029
106900            AND DOC_DTE    = :ADJRNL-DOC-DTE                      10690029
107000            AND AP_TRN_CDE = :ADJRNL-AP-TRN-CDE                   10700029
107100     END-EXEC.                                                    10710029
107200                                                                  10720029
107300     EVALUATE TRUE                                                10730029
107400         WHEN SQLCODE = ZERO                                      10740029
107500             SET PV-ADJ-FOUND TO TRUE                             10750029
107600         WHEN SQLCODE = +100                                      10760029
107700             SET PV-ADJ-NOT-FOUND TO TRUE                         10770029
107800         WHEN SQLWARN0 NOT = SPACES                               10780029
107900         WHEN SQLCODE  NOT = ZERO                                 10790029
108000             DISPLAY 'AP083-VND-NBR     = ' AP083-VND-NBR         10800029
108100             DISPLAY 'AP083-DOC-NBR     = ' AP083-DOC-NBR         10810029
108200             DISPLAY 'AP083-INVC-DTE    = ' AP083-INVC-DTE        10820029
108300             DISPLAY 'AP083-INVC-SRC    = ' AP083-INVC-SRC        10830029
108400             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OPERATION      10840029
108500             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                10850029
108600             PERFORM Z999-DB2-ABEND                               10860029
108700     END-EVALUATE.                                                10870029
108800                                                                  10880029
108900*--------------------------------------------------------------*  10890029
109000*  RETRIEVES ALL VALID TRAN CODES AND BATCH SOURCES FROM       *  10900029
109100*  TTRNCDE TABLE FOR TRANCODES THAT ARE INTERFACED FOR PAYMENT *  10910029
109200*  (AP_PSTG_IND = 'Y') AND LOADS THEM INTO AN INTERNAL TABLE.  *  10920029
109300*--------------------------------------------------------------*  10930029
109400 S400-FETCH-TRANCODES.                                            10940029
109500                                                                  10950029
109600     EXEC SQL                                                     10960029
109700          FETCH  TRANCODE_CSR                                     10970029
109800           INTO  :TRNCDE-AP-TRN-CDE                               10980029
109900               , :TRNCDE-BTCH-SRC-CDE                             10990029
110000     END-EXEC.                                                    11000029
110100                                                                  11010029
110200     EVALUATE TRUE                                                11020029
110300         WHEN SQLCODE = ZERO                                      11030029
110400            CONTINUE                                              11040029
110500         WHEN SQLCODE = +100                                      11050029
110600             SET END-OF-TRNCDE-CSR TO TRUE                        11060029
110700         WHEN OTHER                                               11070029
110800             MOVE 'UNSUCCESSFUL FETCH ' TO AA-DB2-OPERATION       11080029
110900             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                11090029
111000             PERFORM Z999-DB2-ABEND                               11100029
111100     END-EVALUATE.                                                11110029
111200 EJECT.                                                           11120029
111300                                                                  11130029
111400                                                                  11140029
111500*----------------------------------------------------------------*11150029
111600*    FETCH THE ALLOW_CSR CURSOR                                   11160029
111700*----------------------------------------------------------------*11170029
111800 S500-FETCH-ALLOW-CSR.                                            11180029
111900                                                                  11190029
112000     EXEC SQL                                                     11200029
112100          FETCH  ALLOW_CSR                                        11210029
112200           INTO :ALCHRG-ALW-CHRG-CDE                              11220029
112300               ,:ALCHRG-ALW-CHRG-AMT                              11230029
112400               ,:ALCHRG-ALW-CHRG-PCT                              11240029
112500               ,:ALCHRG-ALW-CHRG-TYP-CDE                          11250029
112600     END-EXEC.                                                    11260029
112700                                                                  11270029
112800     EVALUATE TRUE                                                11280029
112900         WHEN SQLCODE = ZERO                                      11290029
113000             CONTINUE                                             11300029
113100         WHEN SQLCODE = +100                                      11310029
113200             SET END-OF-ALLOW-CSR TO TRUE                         11320029
113300                                                                  11330029
113400         WHEN SQLWARN0 NOT = SPACES                               11340029
113500         WHEN SQLCODE  NOT = ZERO                                 11350029
113600             MOVE 'S100-FETCH-ALLOW-CSR' TO AA-PARAGRAPH-NAME     11360029
113700             MOVE 'UNSUCCESSFUL FETCH' TO AA-DB2-OPERATION        11370029
113800             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                11380029
113900             MOVE SPACES         TO AA-DB2-TABLE-2                11390029
114000             PERFORM Z999-DB2-ABEND                               11400029
114100                                                                  11410029
114200     END-EVALUATE.                                                11420029
114300                                                                  11430029
114400*---------------------------------------------------------------- 11440029
114500*    RETRIEVES THE TERMS WHEN THE TERM SELECT CODE INDICATES      11450029
114600*    THEY EXIST ON THE PURCHASE ORDER TABLES.                     11460029
114700*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   11470029
114800*           CALCULATION OF THE PAYMENT DUE DATE SO PROCESSING     11480029
114900*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.            11490029
115000*---------------------------------------------------------------- 11500029
115100 S600-GET-PO-TERMS.                                               11510029
115200                                                                  11520029
115300     MOVE 'R600-GET-PO-TERMS' TO AA-PARAGRAPH-NAME.               11530029
115400                                                                  11540029
115500     EXEC SQL                                                     11550029
115600         SELECT PT.DISCOUNT_PCT                                   11560029
115700           INTO :PAYTRM-DISCOUNT-PCT                              11570029
115800           FROM TPOAGMT PA                                        11580029
115900              , TPAYTRM PT                                        11590029
116000         WHERE PA.PO_NBR         = :PURCHS-PO-NBR                 11600029
116100           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                 11610029
116200           AND PA.AGRMT_TYP_ID   = '2'                            11620029
116300           AND PA.VER_STATUS_CDE = 'A'                            11630029
116400     END-EXEC.                                                    11640029
116500                                                                  11650029
116600     EVALUATE TRUE                                                11660029
116700         WHEN SQLCODE = ZERO                                      11670029
116800         WHEN SQLCODE = +100                                      11680029
116900              CONTINUE                                            11690029
117000         WHEN SQLWARN0 NOT = SPACES                               11700029
117100         WHEN SQLCODE  NOT = ZERO                                 11710029
117200             DISPLAY 'PO NUMBER = ' PURCHS-PO-NBR                 11720029
117300             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       11730029
117400             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                11740029
117500             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                11750029
117600             PERFORM Z999-DB2-ABEND                               11760029
117700     END-EVALUATE.                                                11770029
117800                                                                  11780029
117900*---------------------------------------------------------------- 11790029
118000*    RETRIEVES THE TERMS WHEN THE TERM SELECT CODE INDICATES      11800029
118100*    THEY EXIST ON THE INVOICE TERMS TABLE.                       11810029
118200*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   11820029
118300*           CALCULATION OF THE PAYMENT DUE DATE SO PROCESSING     11830029
118400*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.            11840029
118500*---------------------------------------------------------------- 11850029
118600 S700-GET-INVOICE-TERMS.                                          11860029
118700                                                                  11870029
118800     MOVE 'S700-GET-INVOICE-TERMS' TO AA-PARAGRAPH-NAME.          11880029
118900                                                                  11890029
119000     EXEC SQL                                                     11900029
119100         SELECT DISC_PCT                                          11910029
119200           INTO :INVCTM-DISC-PCT                                  11920029
119300           FROM TINVCTM                                           11930029
119400          WHERE PO_NBR        = :INVCTM-PO-NBR                    11940029
119500            AND INVC_ID       = :INVCTM-INVC-ID                   11950029
119600            AND TERM_SEQ_NBR  = 1                                 11960029
119700     END-EXEC.                                                    11970029
119800                                                                  11980029
119900     EVALUATE TRUE                                                11990029
120000         WHEN SQLCODE = ZERO                                      12000029
120100         WHEN SQLCODE = +100                                      12010029
120200              CONTINUE                                            12020029
120300         WHEN SQLWARN0 NOT = SPACES                               12030029
120400         WHEN SQLCODE  NOT = ZERO                                 12040029
120500             DISPLAY 'PO NUMBER = ' INVCTM-PO-NBR                 12050029
120600             DISPLAY 'INVOICE ID = ' INVCTM-INVC-ID               12060029
120700             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       12070029
120800             MOVE 'TINVCTM'      TO AA-DB2-TABLE-1                12080029
120900             PERFORM Z999-DB2-ABEND                               12090029
121000     END-EVALUATE.                                                12100029
121100                                                                  12110029
121200*-----------------------------------------------------------------12120029
121300* NOTE - FOLLOWING CALL SHOULD NOT BE NEEDED AS THESE COMMENTS ARE12130029
121400*        STORED IN ORACLE AT THE INVOICE HEADER LEVEL, BUT LEFT   12140029
121500*        THE CALL HERE IN CASE IT NEEDS TO BE ADDED IN FUTURE.    12150029
121600*-----------------------------------------------------------------12160029
121700*   SELECTS COMMENT FROM ADJUSTMENT JOURNAL TAJPSINT              12170029
121800*---------------------------------------------------------------- 12180029
121900 S800-SELECT-ADJ-COMMENT-INFO.                                    12190029
122000                                                                  12200029
122100     MOVE 'S800-SELECT-ADJ-COMMENT-INFO' TO AA-PARAGRAPH-NAME.    12210029
122200                                                                  12220029
122300     EXEC SQL                                                     12230029
122400         SELECT RSN_1ST_LNE_TXT                                   12240029
122500              , RSN_2ND_LNE_TXT                                   12250029
122600           INTO :AJPSINT-RSN-1ST-LNE-TXT                          12260029
122700              , :AJPSINT-RSN-2ND-LNE-TXT                          12270029
122800           FROM TAJPSINT                                          12280029
122900          WHERE VND_NBR    = :AJPSINT-VND-NBR                     12290029
123000            AND DOC_NBR    = :AJPSINT-DOC-NBR                     12300029
123100            AND DOC_DTE    = :AJPSINT-DOC-DTE                     12310029
123200            AND AP_TRN_CDE = :AJPSINT-AP-TRN-CDE                  12320029
123300     END-EXEC.                                                    12330029
123400                                                                  12340029
123500     EVALUATE TRUE                                                12350029
123600         WHEN SQLCODE = ZERO                                      12360029
123700             SET PV-ADJ-COMMENT-FOUND TO TRUE                     12370029
123800         WHEN SQLCODE = +100                                      12380029
123900             SET PV-ADJ-COMMENT-NOT-FOUND TO TRUE                 12390029
124000         WHEN SQLWARN0 NOT = SPACES                               12400029
124100         WHEN SQLCODE  NOT = ZERO                                 12410029
124200             DISPLAY 'AP083-VND-NBR     = ' AP083-VND-NBR         12420029
124300             DISPLAY 'AP083-DOC-NBR     = ' AP083-DOC-NBR         12430029
124400             DISPLAY 'AP083-INVC-DTE    = ' AP083-INVC-DTE        12440029
124500             DISPLAY 'AP083-INVC-SRC    = ' AP083-INVC-SRC        12450029
124600             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OPERATION      12460029
124700             MOVE 'TAJPSINT'     TO AA-DB2-TABLE-1                12470029
124800             PERFORM Z999-DB2-ABEND                               12480029
124900     END-EVALUATE.                                                12490029
125000                                                                  12500029
125100                                                                  12510029
125200 W100-WRITE-AP002-RECORD.                                         12520029
125300*---------------------------------------------------------------- 12530029
125400*    WRITES THE AP002 EDITED RECORD.                              12540029
125500*---------------------------------------------------------------- 12550029
125600                                                                  12560029
125700     WRITE EDI820-EXTRACT-RECORD FROM AP002-REMIT-EXTRACT-RECORD. 12570029
125800     ADD +1                      TO PV-COUNT-WRITTEN.             12580029
125900                                                                  12590029
126000                                                                  12600029
126100                                                                  12610029
126200*----------------------------------------------------------------*12620029
126300*  OPEN TRANCODE CURSOR.                                         *12630029
126400*----------------------------------------------------------------*12640029
126500 X100-OPEN-TRANCODE-CSR.                                          12650029
126600                                                                  12660029
126700     EXEC SQL                                                     12670029
126800         OPEN TRANCODE_CSR                                        12680029
126900     END-EXEC.                                                    12690029
127000                                                                  12700029
127100     EVALUATE TRUE                                                12710029
127200         WHEN SQLCODE = ZERO                                      12720029
127300              CONTINUE                                            12730029
127400         WHEN SQLWARN0 NOT = SPACES                               12740029
127500         WHEN SQLCODE  NOT = ZERO                                 12750029
127600              MOVE 'X100-OPEN-TRANCODE-CSR' TO AA-PARAGRAPH-NAME  12760029
127700              MOVE 'UNSUCCESSFUL OPEN ' TO AA-DB2-OPERATION       12770029
127800              MOVE 'TTRNCDE '          TO AA-DB2-TABLE-1          12780029
127900              PERFORM Z999-DB2-ABEND                              12790029
128000     END-EVALUATE.                                                12800029
128100                                                                  12810029
128200*----------------------------------------------------------------*12820029
128300*  CLOSE TRANCODE CURSOR.                                        *12830029
128400*----------------------------------------------------------------*12840029
128500 X200-CLOSE-TRANCODE-CSR.                                         12850029
128600                                                                  12860029
128700     EXEC SQL                                                     12870029
128800         CLOSE TRANCODE_CSR                                       12880029
128900     END-EXEC.                                                    12890029
129000                                                                  12900029
129100     EVALUATE TRUE                                                12910029
129200         WHEN SQLCODE = ZERO                                      12920029
129300              CONTINUE                                            12930029
129400         WHEN SQLWARN0 NOT = SPACES                               12940029
129500         WHEN SQLCODE  NOT = ZERO                                 12950029
129600              MOVE 'X200-CLOSE-TRANCODE-CSR' TO AA-PARAGRAPH-NAME 12960029
129700              MOVE 'UNSUCCESSFUL OPEN ' TO AA-DB2-OPERATION       12970029
129800              MOVE 'TTRNCDE '          TO AA-DB2-TABLE-1          12980029
129900              PERFORM Z999-DB2-ABEND                              12990029
130000     END-EVALUATE.                                                13000029
130100                                                                  13010029
130200*----------------------------------------------------------------*13020029
130300*    OPEN ALLOW_CSR CURSOR                                        13030029
130400*----------------------------------------------------------------*13040029
130500 X300-OPEN-ALLOW-CSR.                                             13050029
130600                                                                  13060029
130700     EXEC SQL                                                     13070029
130800         OPEN ALLOW_CSR                                           13080029
130900     END-EXEC.                                                    13090029
131000                                                                  13100029
131100     EVALUATE TRUE                                                13110029
131200         WHEN SQLCODE = ZERO                                      13120029
131300             CONTINUE                                             13130029
131400                                                                  13140029
131500         WHEN SQLWARN0 NOT = SPACES                               13150029
131600         WHEN SQLCODE  NOT = ZERO                                 13160029
131700             MOVE 'X300-OPEN-ALLOW-CSR' TO AA-PARAGRAPH-NAME      13170029
131800             MOVE 'UNSUCCESSFUL OPEN' TO AA-DB2-OPERATION         13180029
131900             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                13190029
132000             PERFORM Z999-DB2-ABEND                               13200029
132100                                                                  13210029
132200     END-EVALUATE.                                                13220029
132300                                                                  13230029
132400*----------------------------------------------------------------*13240029
132500*    CLOSE THE ALLOW_CSR CURSOR                                   13250029
132600*----------------------------------------------------------------*13260029
132700 X400-CLOSE-ALLOW-CSR.                                            13270029
132800                                                                  13280029
132900     EXEC SQL                                                     13290029
133000         CLOSE ALLOW_CSR                                          13300029
133100     END-EXEC.                                                    13310029
133200                                                                  13320029
133300     EVALUATE TRUE                                                13330029
133400         WHEN SQLCODE = ZERO                                      13340029
133500             CONTINUE                                             13350029
133600         WHEN SQLWARN0 NOT = SPACES                               13360029
133700         WHEN SQLCODE  NOT = ZERO                                 13370029
133800             MOVE 'X400-CLOSE-ALLOW-CSR' TO AA-PARAGRAPH-NAME     13380029
133900             MOVE 'UNSUCCESSFUL CLOSE' TO AA-DB2-OPERATION        13390029
134000             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                13400029
134100             PERFORM Z999-DB2-ABEND                               13410029
134200                                                                  13420029
134300       END-EVALUATE.                                              13430029
134400                                                                  13440029
134500                                                                  13450029
134600 Z998-ABEND.                                                      13460029
134700*---------------------------------------------------------------- 13470029
134800*    ABEND ROUTINE FOR NON DB2 ERRORS                             13480029
134900*---------------------------------------------------------------- 13490029
135000                                                                  13500029
135100     DISPLAY AA-ABEND-LIT.                                        13510029
135200     DISPLAY AA-MESSAGE-LINE.                                     13520029
135300     DISPLAY AA-PROGRAM-LIT.                                      13530029
135400     DISPLAY AA-PARAGRAPH-LIT.                                    13540029
135500                                                                  13550029
135600     CALL 'ILBOABN0' USING ABEND-CODE.                            13560029
135700                                                                  13570029
135800                                                                  13580029
135900*---------------------------------------------------------------- 13590029
136000*    ABEND ROUTINE FOR DB2 ERRORS                                 13600029
136100*---------------------------------------------------------------- 13610029
136200 Z999-DB2-ABEND.                                                  13620029
136300                                                                  13630029
136400     DISPLAY AA-ABEND-LIT.                                        13640029
136500     DISPLAY AA-MESSAGE-LINE.                                     13650029
136600     DISPLAY AA-DB2-ERROR-LIT.                                    13660029
136700     DISPLAY AA-PROGRAM-LIT.                                      13670029
136800     DISPLAY AA-PARAGRAPH-LIT.                                    13680029
136900     DISPLAY AA-DB2-OPERATION-LIT.                                13690029
137000     DISPLAY AA-DB2-TABLE-1.                                      13700029
137100     DISPLAY AA-DB2-TABLE-2.                                      13710029
137200     DISPLAY AA-DB2-TABLE-3.                                      13720029
137300     SET AC-DB2-ERROR TO TRUE.                                    13730029
137400                                                                  13740029
137500     COPY DPPD004.                                                13750029
137600                                                                  13760029
137700     CALL 'ILBOABN0' USING ABEND-CODE.                            13770029
