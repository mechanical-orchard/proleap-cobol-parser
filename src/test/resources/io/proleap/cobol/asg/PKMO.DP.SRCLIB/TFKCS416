      ******************************************************************00010012
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020012
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030012
      *   TEMPORARY STORAGE QUEUE.                                      00040012
      ******************************************************************00050012
       IDENTIFICATION DIVISION.                                         00060012
      ******************************************************************00070012
                                                                        00080012
       PROGRAM-ID.       TFKCS416.                                      00090012
       AUTHOR.           DAVE WELLER.                                   00100012
       INSTALLATION.     KOHLS.                                         00110012
       DATE-WRITTEN      JANUARY, 2004.                                 00120012
       DATE-COMPILED.                                                   00130012
                                                                        00140012
      ******************************************************************00150012
      * THIS PROGRAM RETURNS A LIST OF TRANSFER TYPES FOR USER          00160012
      * SELECTION IN THE CREATE TRANSFER APPLICATION.                   00170012
      ******************************************************************00180012
      *   DATE 01/26/04                                                 00190013
      *   SORT1 (DC) AND SORT2 (RTV) DEF/DAMAGE TRANSFERS               00200013
      *   MADE BY: DAVE WELLER            WR/IR #: 25501                00210013
      ******************************************************************00220013
      *   DATE 10/20/04                                                 00230017
      *   STORE EXPANSION                                               00240017
      *   MADE BY: DAVE WELLER            WR/IR #: 27349                00250017
      ******************************************************************00260017
021605*   DATE 02/16/2005                                               00270017
021605*   STANDARDIZE TFWS007 USAGE                                     00280017
021605*   MADE BY: DAVE WELLER            WR/IR #: 27349                00290017
021605******************************************************************00300017
070711*   DATE 07/07/2011                                               00310018
070711*   ADD CODE FOR 2 MORE RTV LOCATIONS                             00320018
070711*   MADE BY: CHERI PARMLEY          WR/IR #: 40189                00330018
070711******************************************************************00340018
C82831******************************************************************00341027
C82831*   DATE 05/28/2014                                               00342027
C82831*   ADDED WHERE LOC_NBR = C.LOC_NBR IN THE RTV LOCATION QUERY.    00343027
C82831*   THIS IS ADDED TO FETCH THE CORRECT EFF_BEG_DTE FOR A SPECIFIC 00344027
C82831*   DC LOCATION.                                                  00344127
C82831*   FIND FOR THE TAG C82831 TO KNOW THE CHANGES.                  00344227
C82831*   MADE BY: SARVESWARAN N.S.K      WR/IR #: CHG0082831           00344327
C82831******************************************************************00345027
                                                                        00350012
      ******************************************************************00360012
       ENVIRONMENT DIVISION.                                            00370012
      ******************************************************************00380012
                                                                        00390012
      ******************************************************************00400012
       DATA DIVISION.                                                   00410012
      ******************************************************************00420012
                                                                        00430012
      ******************************************************************00440012
       WORKING-STORAGE SECTION.                                         00450012
      ******************************************************************00460012
                                                                        00470012
      ***                                                               00480012
      *  LISTENER QUEUE NAMES                                           00490012
      ***                                                               00500012
           COPY RFWS001.                                                00510012
                                                                        00520012
      ***                                                               00530012
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00540012
      ***                                                               00550012
           COPY TFRD001.                                                00560012
                                                                        00570012
      ***                                                               00580012
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00590012
      ***                                                               00600012
           COPY TFRD002.                                                00610012
                                                                        00620012
      ***                                                               00630012
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00640012
      ***                                                               00650012
           COPY DPWS013.                                                00660012
                                                                        00670012
      ***                                                               00680012
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00690012
      ***                                                               00700012
           COPY DPRD507I.                                               00710012
                                                                        00720012
      ***                                                               00730012
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00740012
      ***                                                               00750012
           COPY DPWS011.                                                00760012
                                                                        00770012
      ***                                                               00780013
      *  DCLGEN LAYOUTS AND COBOL DECLARATIONS FOR THE XS DOMAIN TABLES 00790013
      ***                                                               00800013
           EXEC SQL                                                     00810017
               INCLUDE XST00001                                         00820017
           END-EXEC.                                                    00830017
           EXEC SQL                                                     00840017
               INCLUDE XST00020                                         00850017
          END-EXEC.                                                     00860019
070711*---------------------------------------------------------------* 00870018
070711*  XST_RTV_LOC_RLTNSHP TABLE                                    * 00880018
070711*---------------------------------------------------------------* 00890018
070711     EXEC SQL                                                     00900018
070711          INCLUDE XST00135                                        00910018
070711     END-EXEC.                                                    00920018
                                                                        00930013
      ***                                                               00940012
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER CODE TABLE00950012
      ***                                                               00960012
           EXEC SQL                                                     00970012
               INCLUDE TTFTYCD                                          00980012
           END-EXEC.                                                    00990012
                                                                        01000012
      ***                                                               01010012
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     01020012
      ***                                                               01030012
           EXEC SQL                                                     01040012
               INCLUDE TTFMSTR                                          01050012
           END-EXEC.                                                    01060012
                                                                        01070012
      ***                                                               01080012
      *  COMMUNICATIONS AREA FOR DB2                                    01090012
      ***                                                               01100012
           EXEC SQL                                                     01110012
               INCLUDE SQLCA                                            01120012
           END-EXEC.                                                    01130012
                                                                        01140012
       01  WS-MQCONN                   PIC X(8)                         01150012
                                       VALUE 'CSQCCONN'.                01160012
       01  WS-MQOPEN                   PIC X(8)                         01170012
                                       VALUE 'CSQCOPEN'.                01180012
       01  WS-MQINQ                    PIC X(8)                         01190012
                                       VALUE 'CSQCINQ'.                 01200012
       01  WS-MQGET                    PIC X(8)                         01210012
                                       VALUE 'CSQCGET'.                 01220012
       01  WS-MQPUT1                   PIC X(8)                         01230012
                                       VALUE 'CSQCPUT1'.                01240012
       01  WS-MQPUT                    PIC X(8)                         01250012
                                       VALUE 'CSQCPUT'.                 01260012
       01  WS-MQBACK                   PIC X(8)                         01270012
                                       VALUE 'CSQCBACK'.                01280012
       01  WS-MQCMIT                   PIC X(8)                         01290012
                                       VALUE 'CSQCCOMM'.                01300012
       01  WS-MQCLOSE                  PIC X(8)                         01310012
                                       VALUE 'CSQCCLOS'.                01320012
       01  WS-MQDISC                   PIC X(8)                         01330012
                                       VALUE 'CSQCDISC'.                01340012
                                                                        01350012
      ***                                                               01360012
      *    API CONTROL BLOCKS                                           01370012
      ***                                                               01380012
                                                                        01390012
       01  MQM-OBJECT-DESCRIPTOR.                                       01400012
           COPY CMQODV.                                                 01410012
       01  MQM-MESSAGE-DESCRIPTOR.                                      01420012
           COPY CMQMDV.                                                 01430012
       01  MQM-GET-MESSAGE-OPTIONS.                                     01440012
           COPY CMQGMOV.                                                01450012
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01460012
           COPY CMQPMOV.                                                01470012
                                                                        01480012
      ***                                                               01490012
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01500012
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01510012
      ***                                                               01520012
                                                                        01530012
       01  MQM-CONSTANTS.                                               01540012
           COPY CMQV.                                                   01550012
                                                                        01560012
      ***************************************************************** 01570012
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE     01580012
      **  (EPPD000)                                                     01590012
      ***************************************************************** 01600012
                                                                        01610012
           COPY EPWS000.                                                01620012
021605     COPY TFWS007.                                                01630017
                                                                        01640012
       01  DK-DB2-KEYS.                                                 01650012
           05  DK-LOC-NBR                      PIC S9(04)  VALUE ZEROS  01660014
                                                           COMP SYNC.   01670014
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01680012
                                                           COMP SYNC.   01690012
           05  DK-FR-STR-NBR                   PIC S9(04)  VALUE ZEROS  01700012
                                                           COMP SYNC.   01710012
       01  PC-PROGRAM-CONSTANTS.                                        01720012
           05  PC-MENOMONEE-FALLS-DC           PIC  9(04)  VALUE 0085.  01730012
           05  PC-FINDLAY-DC                   PIC  9(04)  VALUE 0810.  01740012
           05  PC-CORPORATE-PLANOGRAM          PIC  9(04)  VALUE 0803.  01750012
           05  PC-DC2                          PIC  X(03)  VALUE 'DC2'. 01760012
           05  PC-811                          PIC S9(04)  VALUE +811   01770015
                                                           COMP SYNC.   01780015
           05  PC-801                          PIC S9(04)  VALUE +801   01790015
                                                           COMP SYNC.   01800015
           05  PC-803                          PIC S9(04)  VALUE +803   01810015
                                                           COMP SYNC.   01820015
           05  PC-OP-CO-NMBR                   PIC  X(02)  VALUE '03'.  01840012
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01850012
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01860012
           05  PC-DC                           PIC  X(02)  VALUE 'DC'.  01870012
           05  PC-RTV                          PIC  X(02)  VALUE 'RV'.  01880012
           05  PC-CS                           PIC  X(02)  VALUE 'CS'.  01890012
           05  PC-DEPT-STR                     PIC  X(02)  VALUE 'DS'.  01900012
           05  PC-MAX-TYP-CDE-TBL-OCCURS       PIC S9(04)  VALUE +10    01910012
                                                           COMP SYNC.   01920012
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01930012
               'TFKCS416'.                                              01940012
                                                                        01950012
           05  PC-TSYMSG-NUMBERS.                                       01960012
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01970012
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01980012
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01990012
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.02000012
                                                                        02010012
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02020012
           05  PH-COMPLETION-CODE              PIC  S9(09) BINARY.      02030012
           05  PH-REASON                       PIC  S9(09) BINARY.      02040012
                                                                        02050012
       01  PS-PROGRAM-SWITCHES.                                         02060012
           05  PS-END-OF-TYP-CDE-DATA-IND      PIC  X(01)  VALUE 'N'.   02070012
               88  PS-MORE-TYP-CDE-DATA                    VALUE 'N'.   02080012
               88  PS-END-OF-TYP-CDE-DATA                  VALUE 'Y'.   02090012
           05  PS-XFER-CREATED-IND             PIC  X(01)  VALUE 'N'.   02100012
               88  PS-XFER-NOT-CREATED                     VALUE 'N'.   02110012
               88  PS-XFER-CREATED                         VALUE 'Y'.   02120012
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02130012
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02140012
070711     05  PS-IS-RTV-LOC-FOUND             PIC  X(01)  VALUE 'N'.   02141024
070711         88 PS-RTV-LOC-FOUND                         VALUE 'Y'.   02142024
070711         88 PS-RTV-LOC-NOT-FOUND                     VALUE 'N'.   02143024
                                                                        02150012
       01  PV-PROGRAM-VARIABLES.                                        02160012
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02170012
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02180012
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02190012
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02200012
           05  PV-QM-NAME              PIC X(48).                       02210012
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02220012
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02230012
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02240012
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02250012
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02260012
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02270012
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02280012
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02290012
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02300012
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02310012
                                                                        02320012
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02470012
           05  PV-DISPLAY-STR-NBR              PIC  9(04)  VALUE ZEROS. 02480012
           05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 02490012
           05  PV-CUR-TMST  REDEFINES  PV-CURRENT-TIMESTAMP.            02500012
               10  FILLER                      PIC  X(14).              02510012
               10  PV-MINUTE                   PIC  X(02).              02520012
               10  FILLER                      PIC  X(02).              02530012
               10  PV-SECOND                   PIC  X(01).              02540012
               10  FILLER                      PIC  X(01).              02550012
               10  PV-NANOSEC-1-3              PIC  X(03).              02560012
               10  PV-NANOSEC-4-6              PIC  X(03).              02570012
                                                                        02580012
           05  PV-RANDOM-KEY                   PIC  9(09)  VALUE ZEROS. 02590012
           05  FILLER  REDEFINES PV-RANDOM-KEY.                         02600012
               10  PV-RANDOM-NANOSEC-4-6       PIC  X(03).              02610012
               10  PV-RANDOM-NANOSEC-1-3       PIC  X(03).              02620012
               10  PV-RANDOM-MINUTE            PIC  X(02).              02630012
               10  PV-RANDOM-SECOND            PIC  X(01).              02640012
           05  PV-STR-DC                       PIC  X(03)  VALUE SPACE. 02650012
           05  PV-TBL-LENGTH                   PIC  9(03)  VALUE ZEROS. 02660012
           05  PV-TOT-REC-LENGTH               PIC  9(04)  VALUE ZEROS. 02670012
           05  PV-FIXED-DATA-LENGTH            PIC  9(04)  VALUE ZEROS. 02680012
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02690012
                                                           COMP SYNC.   02700012
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02710012
                                                           COMP SYNC.   02720012
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02730012
                                                                        02740012
           05  PV-TCPIPPRQ-RECORD1.                                     02750012
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02760012
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02770012
               10  FILLER                      PIC X(4104) VALUE SPACE. 02780012
           05  PV-TCPIPPRQ-RECORD2.                                     02790012
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02800012
               10  FILLER                      PIC X(4112) VALUE SPACE. 02810012
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02820012
                                                           COMP SYNC.   02830012
           05  PV-STR-RTV-NBR                  PIC  9(04)  VALUE ZEROS. 02840012
           05  FILLER  REDEFINES  PV-STR-RTV-NBR.                       02850012
               10  FILLER                      PIC  9(01).              02860012
               10  PV-STR-RTV-3-NBR            PIC  X(03).              02870012
           05  PV-STR-RTV-LOC-NBR              PIC  9(04)  VALUE ZEROS. 02880012
           05  PV-STR-RTV-LOC-NAME             PIC  X(20)  VALUE SPACE. 02890012
           05  PV-STR-LOC-NAME                 PIC  X(20)  VALUE SPACE. 02900012
           05  PV-TYPE-CODE                    PIC  X(02)  VALUE SPACE. 02910012
                                                                        02920012
      *                                                                 02930012
      * CURSOR TO RETRIEVE THE DEFAULT RETURN TO VENDOR NUMBER AND NAME 02940012
      * FOR THE STORE CREATING THE TRANSFER                             02950012
      *                                                                 02960012
           EXEC SQL                                                     02970017
              DECLARE  STR_DC_CSR CURSOR FOR                            02980017
               SELECT  DC_NBR                                           02990017
                 FROM  XST_DC_LOC_ASGMT                                 03000017
                WHERE  LOC_NBR                     = :DK-LOC-NBR        03010017
                  AND  EFF_BEG_DTE                <= CURRENT DATE       03020017
           END-EXEC.                                                    03030017
      *                                                                 03040013
      * CURSOR TO RETRIEVE ALL TRANSFER TYPE CODES IN TYPE CODE SEQUENCE03050012
      *                                                                 03060012
           EXEC SQL                                                     03070012
              DECLARE  TYP_CDE_CSR CURSOR FOR                           03080012
               SELECT  XFER_TYP_CDE,                                    03090012
                       TYP_1ST_LNE_DESC,                                03100012
                       TYP_2ND_LNE_DESC,                                03110012
                       PTC_PTH_CDE,                                     03120012
                       PRIC_REQR_IND,                                   03130012
                       DFLT_STR_TYP_CDE                                 03140012
                 FROM  TTFTYCD                                          03150012
             ORDER BY  XFER_TYP_CDE                                     03160012
           END-EXEC.                                                    03170012
      *                                                                 03180012
      ******************************************************************03190012
       PROCEDURE DIVISION.                                              03200012
      ******************************************************************03210012
       0000-PROGRAM-MAINLINE.                                           03220012
           INITIALIZE TF002-XFER-TO-PTC-RECORD.                         03230012
                                                                        03240012
           PERFORM 1000-RETRIEVE-TEXT.                                  03250012
                                                                        03260012
           PERFORM 2000-PROCESS-PTC-REQUEST.                            03270012
                                                                        03280012
           GOBACK.                                                      03290012
                                                                        03300012
       1000-RETRIEVE-TEXT.                                              03310012
           EXEC CICS                                                    03320012
               RETRIEVE                                                 03330012
                   INTO  (TF001-XFER-FROM-PTC-RECORD)                   03340012
                   RESP  (PV-CICS-RESPONSE)                             03350012
           END-EXEC.                                                    03360012
                                                                        03370012
           EVALUATE TRUE                                                03380012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03390012
                   CONTINUE                                             03400012
               WHEN OTHER                                               03410012
                   MOVE '1000-RETRIEVE-TEXT'                            03420012
                                   TO DP013-PARAGRAPH                   03430015
                   MOVE 'UNABLE TO RECEIVE TEXT'                        03440012
                                   TO DP013-MESSAGE-TEXT (1)            03450015
                   MOVE  TF001-XFER-FROM-PTC-RECORD                     03460012
                                   TO DP013-MESSAGE-TEXT (2)            03470015
                   SET DP013-CICS-ABEND                                 03480012
                       DP013-NO-ROLLBACK                                03490012
                                   TO TRUE                              03500015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03510012
                   SET DP011-MSG-FATAL                                  03520015
                                   TO TRUE                              03530015
                   MOVE PC-TSYMSG-01064                                 03540012
                                   TO DP011-MSG-NUMBER                  03550015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03560012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03570012
           END-EVALUATE.                                                03580012
                                                                        03590012
           MOVE TF001-LISTENER-CODE                                     03600015
                                   TO PV-QUEUE-PARM.                    03610015
           IF  PV-VALID-PARM                                            03620012
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03630012
                                   TO PV-TSQ-NAME                       03640015
           ELSE                                                         03650012
               MOVE '1000-RETRIEVE-TEXT'                                03660012
                                   TO DP013-PARAGRAPH                   03670015
               MOVE 'INVALID PARM VALUE'                                03680012
                                   TO DP013-MESSAGE-TEXT (1)            03690015
               MOVE 'PARM VALUE = '                                     03700015
                                   TO DP013-MESSAGE-TEXT (2)            03710015
               MOVE TF001-LISTENER-CODE                                 03720012
                                   TO DP013-MESSAGE-TEXT (3)            03730015
               SET DP013-LOGIC-ABEND                                    03740012
                   DP013-NO-ROLLBACK                                    03750015
                                   TO TRUE                              03760015
                                                                        03770012
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03780012
                                                                        03790012
               SET DP011-MSG-FATAL TO TRUE                              03800015
                                                                        03810012
               MOVE PC-TSYMSG-01064                                     03820015
                                   TO DP011-MSG-NUMBER                  03830015
                                                                        03840012
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03850012
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03860012
           END-IF.                                                      03870012
                                                                        03880012
      ******************************************************************03890012
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03900012
      ******************************************************************03910012
       2000-PROCESS-PTC-REQUEST.                                        03920012
                                                                        03930012
           IF TF001-STR-NBR  =  PC-MENOMONEE-FALLS-DC                   03940012
               MOVE PC-801         TO DK-LOC-NBR                        03950017
                                      DK-FR-STR-NBR                     03960015
               MOVE PC-RTV              TO  PV-TYPE-CODE                03970012
           ELSE                                                         03980012
               IF TF001-STR-NBR  =  PC-FINDLAY-DC                       03990012
                   MOVE PC-811     TO  DK-LOC-NBR                       04000017
                                           DK-FR-STR-NBR                04010012
                   MOVE PC-RTV     TO  PV-TYPE-CODE                     04020015
               ELSE                                                     04030012
                   IF TF001-STR-NBR = PC-803                            04040012
                       MOVE PC-803 TO DK-LOC-NBR                        04050017
                                      DK-FR-STR-NBR                     04060016
                       MOVE PC-CS  TO PV-TYPE-CODE                      04070015
                   ELSE                                                 04080012
                       MOVE PC-DEPT-STR                                 04090012
                                   TO  PV-TYPE-CODE                     04100015
                   END-IF                                               04110012
               END-IF                                                   04120012
           END-IF.                                                      04130012
                                                                        04140012
           PERFORM 7600-SELECT-STR-NAME.                                04150012
           MOVE XST00001-LOC-NM    TO  PV-STR-LOC-NAME.                 04160017
                                                                        04170012
           PERFORM 2200-LOAD-TYP-CDE-TBL.                               04180012
                                                                        04190012
           PERFORM 2300-CREATE-XFER                                     04200012
               UNTIL PS-XFER-CREATED.                                   04210012
                                                                        04220012
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          04230012
      *                                                                 04240012
      ******************************************************************04241024
      *    OPEN STORE DC CURSOR                                         04242024
      ******************************************************************04243024
       2110-OPEN-STR-DC-CSR.                                            04250012
           EXEC SQL                                                     04260012
               OPEN STR_DC_CSR                                          04270012
           END-EXEC.                                                    04280012
                                                                        04290012
           EVALUATE SQLCODE                                             04300015
               WHEN ZERO                                                04310015
                   CONTINUE                                             04320015
               WHEN OTHER                                               04330015
                   MOVE '2110-OPEN-STR-DC-CSR'                          04340012
                                   TO DP013-PARAGRAPH                   04350015
                   MOVE 'OPEN THE STR_DC_CSR CURSOR'                    04360012
                                   TO DP013-MESSAGE-TEXT (1)            04370015
                   MOVE DK-LOC-NBR TO DP013-MESSAGE-TEXT (2)            04380017
                   MOVE SQLCA      TO DP013-SQLCA                       04390015
                   MOVE 'XST_DC_LOC_ASGMT'                              04400017
                                   TO DP013-DB2-TABLE-NAME (1)          04410017
                   SET DP013-DB2-ABEND                                  04420012
                       DP013-NO-ROLLBACK                                04430012
                                   TO TRUE                              04440015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04450012
                   SET DP011-MSG-FATAL                                  04460015
                                   TO TRUE                              04470015
                   MOVE PC-TSYMSG-01064                                 04480012
                                   TO DP011-MSG-NUMBER                  04490015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04500012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04510012
           END-EVALUATE.                                                04520012
                                                                        04530012
      ******************************************************************04531024
      *    CLOSE STORE DC CURSOR                                        04532024
      ******************************************************************04533024
       2120-CLOSE-STR-DC-CSR.                                           04540012
           EXEC SQL                                                     04550012
               CLOSE STR_DC_CSR                                         04560012
           END-EXEC.                                                    04570012
                                                                        04580012
           EVALUATE SQLCODE                                             04590015
               WHEN ZERO                                                04600015
                   CONTINUE                                             04610015
               WHEN OTHER                                               04620015
                   MOVE '2120-CLOSE-STR-DC-CSR'                         04630012
                                   TO DP013-PARAGRAPH                   04640015
                   MOVE 'CLOSE THE STR_DC_CSR CURSOR'                   04650012
                                   TO DP013-MESSAGE-TEXT (1)            04660015
                   MOVE DK-LOC-NBR TO DP013-MESSAGE-TEXT (2)            04670017
                   MOVE SQLCA      TO DP013-SQLCA                       04680015
                   MOVE 'XST_DC_LOC_ASGMT'                              04690017
                                   TO DP013-DB2-TABLE-NAME (1)          04700017
                   SET DP013-DB2-ABEND                                  04710012
                       DP013-NO-ROLLBACK                                04720012
                                   TO TRUE                              04730015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04740012
                   SET DP011-MSG-FATAL                                  04750015
                                   TO TRUE                              04760015
                   MOVE PC-TSYMSG-01064                                 04770012
                                   TO DP011-MSG-NUMBER                  04780015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04790012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04800012
           END-EVALUATE.                                                04810012
                                                                        04820012
      ******************************************************************04821024
      *    LOAD TRANSFER TYPE TABLE                                     04822024
      ******************************************************************04823024
       2200-LOAD-TYP-CDE-TBL.                                           04830012
           PERFORM 2210-OPEN-TYP-CDE-CSR.                               04840012
           PERFORM 7300-FETCH-TYP-CDE-CSR.                              04850012
           PERFORM 2220-FILL-TYP-CDE-TBL                                04860012
               VARYING TYP-CDE-IDX                                      04870012
               FROM    1 BY 1                                           04880012
               UNTIL   (TYP-CDE-IDX > PC-MAX-TYP-CDE-TBL-OCCURS         04890012
                  OR    PS-END-OF-TYP-CDE-DATA).                        04900012
           PERFORM 2230-CLOSE-TYP-CDE-CSR.                              04910012
                                                                        04920012
      ******************************************************************04921024
      *    OPEN TRANSFER TABLE CURSOR                                   04922024
      ******************************************************************04923024
       2210-OPEN-TYP-CDE-CSR.                                           04930012
           EXEC SQL                                                     04940012
               OPEN TYP_CDE_CSR                                         04950012
           END-EXEC.                                                    04960012
                                                                        04970012
           EVALUATE SQLCODE                                             04980015
               WHEN ZERO                                                04990015
                   CONTINUE                                             05000015
               WHEN OTHER                                               05010015
                   MOVE '2210-OPEN-TYP-CDE-CSR'                         05020012
                                   TO DP013-PARAGRAPH                   05030015
                   MOVE 'OPEN THE TYP_CDE_CSR CURSOR'                   05040012
                                   TO DP013-MESSAGE-TEXT (1)            05050015
                   MOVE SQLCA      TO DP013-SQLCA                       05060015
                   MOVE 'TTFTYCD'  TO DP013-DB2-TABLE-NAME (1)          05070015
                   SET DP013-DB2-ABEND                                  05080012
                       DP013-NO-ROLLBACK                                05090012
                                   TO TRUE                              05100015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05110012
                   SET DP011-MSG-FATAL                                  05120015
                                   TO TRUE                              05130015
                   MOVE PC-TSYMSG-01064                                 05140012
                                   TO DP011-MSG-NUMBER                  05150015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05160012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05170012
           END-EVALUATE.                                                05180012
                                                                        05190012
      ******************************************************************05191024
      *    MOVE TRANSFER VALUES TO TABLE                                05192024
      ******************************************************************05193024
       2220-FILL-TYP-CDE-TBL.                                           05200012
           MOVE TFTYCD-XFER-TYP-CDE                                     05210015
                                   TO TF002-XFER-TYP-CDE-X              05220015
                                      (TYP-CDE-IDX).                    05230015
           MOVE TFTYCD-PTC-PTH-CDE TO TF002-XFER-PATH-CDE               05240015
                                      (TYP-CDE-IDX).                    05250015
           MOVE TFTYCD-TYP-1ST-LNE-DESC                                 05260012
                                   TO TF002-XFER-TYP-CDE-DESC-LN1       05270015
                                      (TYP-CDE-IDX).                    05280015
           MOVE TFTYCD-TYP-2ND-LNE-DESC                                 05290012
                                   TO TF002-XFER-TYP-CDE-DESC-LN2       05300015
                                      (TYP-CDE-IDX).                    05310015
           MOVE TFTYCD-PRIC-REQR-IND                                    05320015
                                   TO TF002-XFER-PRICE-REQ-IND          05330015
                                      (TYP-CDE-IDX).                    05340015
           EVALUATE TRUE                                                05350012
               WHEN TFTYCD-DFLT-STR-TYP-CDE  =  SPACES                  05360012
                   MOVE PC-NO                                           05370012
                                   TO TF002-DEFAULT-TO-STR-IND          05380015
                                      (TYP-CDE-IDX)                     05390015
                   INITIALIZE  TF002-DEFAULT-STR-LOC-NBR (TYP-CDE-IDX)  05400012
                               TF002-DEFAULT-STR-LOC-NAME (TYP-CDE-IDX) 05410012
               WHEN TFTYCD-DFLT-STR-TYP-CDE  =  PC-RTV                  05420012
070711             PERFORM 7100-FIND-STR-RTV-SITE                       05430023
                   MOVE PC-YES                                          05440012
                                   TO TF002-DEFAULT-TO-STR-IND          05450015
                                      (TYP-CDE-IDX)                     05460015
                   MOVE PV-STR-RTV-LOC-NBR                              05470012
                                   TO TF002-DEFAULT-STR-LOC-NBR         05480015
                                      (TYP-CDE-IDX)                     05490015
                   MOVE PV-STR-RTV-LOC-NAME                             05500012
                                   TO TF002-DEFAULT-STR-LOC-NAME        05510015
                                      (TYP-CDE-IDX)                     05520015
               WHEN TFTYCD-DFLT-STR-TYP-CDE  =  PC-DEPT-STR             05530012
                   MOVE PC-YES                                          05540012
                                   TO TF002-DEFAULT-TO-STR-IND          05550015
                                      (TYP-CDE-IDX)                     05560015
                   MOVE TF001-STR-NBR                                   05570012
                                   TO TF002-DEFAULT-STR-LOC-NBR         05580015
                                      (TYP-CDE-IDX)                     05590015
                   MOVE PV-STR-LOC-NAME                                 05600012
                                   TO TF002-DEFAULT-STR-LOC-NAME        05610015
                                      (TYP-CDE-IDX)                     05620015
           END-EVALUATE.                                                05630012
                                                                        05640012
                                                                        05650012
           IF (TF001-STR-NBR  =  PC-MENOMONEE-FALLS-DC                  05660012
                     OR                                                 05670012
               TF001-STR-NBR  =  PC-FINDLAY-DC)                         05680018
               EVALUATE  TFTYCD-XFER-TYP-CDE                            05690012
021605             WHEN TF007-DEFECTIVES-DAMAGES-SORT1                  05700017
021605             WHEN TF007-DEFECTIVES-DAMAGES-SORT2                  05710017
021605             WHEN TF007-CALLBACK                                  05720017
021605             WHEN TF007-STOCK-BALANCE-CORPORATE                   05730017
021605             WHEN TF007-CUSTOMER                                  05740017
021605             WHEN TF007-OFFSITE-STORAGE                           05750017
                       INITIALIZE TF002-XFER-TYP-CDE-TBL (TYP-CDE-IDX)  05760012
                       SUBTRACT 1      FROM TF002-NBR-OF-OCCURS         05770012
                       SET TYP-CDE-IDX DOWN BY 1                        05780012
               END-EVALUATE                                             05790012
           END-IF.                                                      05800012
                                                                        05810012
           IF TF001-STR-NBR  =  PC-CORPORATE-PLANOGRAM                  05820012
               EVALUATE  TFTYCD-XFER-TYP-CDE                            05830012
021605             WHEN TF007-CALLBACK                                  05840017
021605             WHEN TF007-STOCK-BALANCE-CORPORATE                   05850017
021605             WHEN TF007-CUSTOMER                                  05860017
021605             WHEN TF007-NON-RETAIL                                05870017
021605             WHEN TF007-OFFSITE-STORAGE                           05880017
                       INITIALIZE TF002-XFER-TYP-CDE-TBL (TYP-CDE-IDX)  05890012
                       SUBTRACT 1      FROM TF002-NBR-OF-OCCURS         05900012
                       SET TYP-CDE-IDX DOWN BY 1                        05910012
               END-EVALUATE                                             05920012
           END-IF.                                                      05930012
           PERFORM 7300-FETCH-TYP-CDE-CSR.                              05940012
                                                                        05950012
      ******************************************************************05951024
      *    CLOSE TRANSFER TYPE TABLE                                    05952024
      ******************************************************************05953024
       2230-CLOSE-TYP-CDE-CSR.                                          05960012
           EXEC SQL                                                     05970012
               CLOSE TYP_CDE_CSR                                        05980012
           END-EXEC.                                                    05990012
                                                                        06000012
           EVALUATE SQLCODE                                             06010015
               WHEN ZERO                                                06020015
                   CONTINUE                                             06030015
               WHEN OTHER                                               06040015
                   MOVE '2230-CLOSE-TYP-CDE-CSR'                        06050012
                                   TO DP013-PARAGRAPH                   06060015
                   MOVE 'CLOSE THE TYP_CDE_SCR CURSOR'                  06070012
                                   TO DP013-MESSAGE-TEXT (1)            06080015
                   MOVE SQLCA      TO DP013-SQLCA                       06090015
                   MOVE 'TTFTYCD'  TO DP013-DB2-TABLE-NAME (1)          06100015
                   SET DP013-DB2-ABEND                                  06110012
                       DP013-NO-ROLLBACK                                06120012
                                   TO TRUE                              06130015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06140012
                   SET DP011-MSG-FATAL                                  06150015
                                   TO TRUE                              06160015
                   MOVE PC-TSYMSG-01064                                 06170012
                                   TO DP011-MSG-NUMBER                  06180015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06190012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06200012
           END-EVALUATE.                                                06210012
                                                                        06220012
      ******************************************************************06221024
      *    SET KEYS TO CREATE TRANSFER                                  06222024
      ******************************************************************06223024
       2300-CREATE-XFER.                                                06230012
           PERFORM 7400-SELECT-CURRENT-TIMESTAMP.                       06240012
                                                                        06250012
           MOVE PV-MINUTE          TO  PV-RANDOM-MINUTE.                06260015
           MOVE PV-SECOND          TO  PV-RANDOM-SECOND.                06270015
           MOVE PV-NANOSEC-1-3     TO  PV-RANDOM-NANOSEC-1-3.           06280015
           MOVE PV-NANOSEC-4-6     TO  PV-RANDOM-NANOSEC-4-6.           06290015
           MOVE PV-RANDOM-KEY      TO  DK-XFER-DKEY-ID                  06300015
                                       TF002-XFER-DKEY.                 06310015
           PERFORM 7500-INSERT-XFER.                                    06320012
                                                                        06330012
      ******************************************************************06331024
      *    FETCH STORE/DC                                               06332024
      ******************************************************************06333024
       7000-FETCH-STR-DC-CSR.                                           06340012
           INITIALIZE DCLXST00020.                                      06350017
                                                                        06360012
           EXEC SQL                                                     06370012
               FETCH  STR_DC_CSR                                        06380012
                INTO  :PV-STR-DC                                        06390012
           END-EXEC.                                                    06400012
                                                                        06410012
           EVALUATE SQLCODE                                             06420015
               WHEN ZERO                                                06430015
                   CONTINUE                                             06440015
               WHEN +100                                                06450015
                   CONTINUE                                             06460015
               WHEN -904                                                06470015
               WHEN -913                                                06480015
                   SET DP011-MSG-FATAL                                  06490015
                                   TO TRUE                              06500015
                   MOVE PC-TSYMSG-01063                                 06510012
                                   TO DP011-MSG-NUMBER                  06520015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06530012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06540012
               WHEN OTHER                                               06550015
                   MOVE '7000-FETCH-STR-DC-CSR'                         06560012
                                   TO DP013-PARAGRAPH                   06570015
                   MOVE 'FETCH STR_DC_CSR'                              06580012
                                   TO DP013-MESSAGE-TEXT (1)            06590015
                   MOVE DK-LOC-NBR TO DP013-MESSAGE-TEXT (2)            06600017
                   MOVE SQLCA      TO DP013-SQLCA                       06610015
                   MOVE 'XST_DC_LOC_ASGMT'                              06620017
                                   TO DP013-DB2-TABLE-NAME (1)          06630017
                   SET DP013-DB2-ABEND                                  06640012
                       DP013-NO-ROLLBACK                                06650012
                                   TO TRUE                              06660015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06670012
                   SET DP011-MSG-FATAL                                  06680015
                                   TO TRUE                              06690015
                   MOVE PC-TSYMSG-01064                                 06700012
                                   TO DP011-MSG-NUMBER                  06710015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06720012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06730012
           END-EVALUATE.                                                06740012
                                                                        06750012
      ******************************************************************06751024
      *    FIND THE STORES RTV LOCATION                                 06752024
      ******************************************************************06753024
070711 7100-FIND-STR-RTV-SITE.                                          06760023
070711     MOVE TF001-STR-NBR      TO  DK-LOC-NBR                       06770023
070711                                 DK-FR-STR-NBR                    06780023
070711                                 XST00020-LOC-NBR.                06790023
070711     MOVE TFTYCD-XFER-TYP-CDE TO XST00135-XFER-TYP-CDE.           06800023
070711     PERFORM 7200-SELECT-RTV-SITE.                                06810023
070711     IF PS-RTV-LOC-FOUND                                          06811025
070711         PERFORM 7210-FILL-RTV-NAME                               06812025
070711     END-IF.                                                      06812125
                                                                        06813025
                                                                        06820023
      ******************************************************************06821024
      *    SELECT TO GET THE RTV LOCATION                               06822024
      ******************************************************************06823024
       7200-SELECT-RTV-SITE.                                            06830012
                                                                        06840023
070711     EXEC SQL                                                     06850018
070711       SELECT  B.DC_NBR                                           06860018
070711              ,C.RTV_LOC_NBR                                      06870018
070711         INTO  :XST00020-DC-NBR                                   06880018
070711              ,:XST00135-RTV-LOC-NBR                              06890018
070711         FROM  XST_DC_LOC_ASGMT   B                               06900018
070711              ,XST_RTV_LOC_RLTNSHP C                              06910018
070711        WHERE  B.LOC_NBR      = :XST00020-LOC-NBR                 06920018
070711          AND  B.EFF_BEG_DTE  =                                   06930018
070711                    (SELECT MAX(EFF_BEG_DTE)                      06940018
070711                       FROM XST_DC_LOC_ASGMT                      06950018
070711                      WHERE LOC_NBR = B.LOC_NBR)                  06960018
070711          AND  B.DC_NBR  = C.LOC_NBR                              06970018
070711          AND  XFER_TYP_CDE = :XST00135-XFER-TYP-CDE              06980018
070711          AND  C.EFF_BEG_DTE  =                                   06990018
070711             (SELECT MAX(EFF_BEG_DTE)                             07000018
C82831                 FROM XST_RTV_LOC_RLTNSHP                         07010027
CRQFIX                      WHERE LOC_NBR = C.LOC_NBR AND               07011028
CRQFIX                            XFER_TYP_CDE = :XST00135-XFER-TYP-CDE)07012028
070711     END-EXEC.                                                    07020018
                                                                        07021024
070711     EVALUATE SQLCODE                                             07030018
070711         WHEN ZERO                                                07040018
                   SET PS-RTV-LOC-FOUND     TO TRUE                     07041024
070711         WHEN +100                                                07050018
070711             SET PS-RTV-LOC-NOT-FOUND TO TRUE                     07060024
070711         WHEN -904                                                07070018
070711         WHEN -913                                                07080018
070711             SET DP011-MSG-FATAL                                  07090018
070711                             TO TRUE                              07100018
070711             MOVE PC-TSYMSG-01063                                 07110018
070711                             TO DP011-MSG-NUMBER                  07120018
070711             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07130018
070711             PERFORM 8000-SEND-DATA-TO-LISTENER                   07140018
070711         WHEN OTHER                                               07150018
070711             MOVE '7200-SELECT-RTV-SITE'                          07160018
070711                             TO DP013-PARAGRAPH                   07170018
070711             MOVE 'SELECT RTV LOC FOR STORE NUMBER/TYPE CODE: '   07180018
070711                             TO DP013-MESSAGE-TEXT (1)            07190018
070711             MOVE DK-LOC-NBR TO PV-DISPLAY-STR-NBR                07200018
070711             MOVE PV-DISPLAY-STR-NBR                              07210018
070711                             TO DP013-MESSAGE-TEXT (2)            07220018
070711             MOVE PV-TYPE-CODE                                    07230018
070711                             TO DP013-MESSAGE-TEXT (3)            07240018
070711             MOVE SQLCA      TO DP013-SQLCA                       07250018
070711             MOVE 'XST_DC_LOC_ASGMT' TO                           07260018
070711                                DP013-DB2-TABLE-NAME (1)          07270018
070711             SET DP013-DB2-ABEND                                  07280018
070711                 DP013-NO-ROLLBACK                                07290018
070711                             TO TRUE                              07300018
070711             PERFORM 9999-WRITE-CICS-LOG-MSG                      07310018
070711             SET DP011-MSG-FATAL                                  07320018
070711                             TO TRUE                              07330018
070711             MOVE PC-TSYMSG-01064                                 07340018
070711                             TO DP011-MSG-NUMBER                  07350018
070711             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07360018
070711             PERFORM 8000-SEND-DATA-TO-LISTENER                   07370018
070711     END-EVALUATE.                                                07380018
                                                                        07390018
      ******************************************************************07393024
      *    GET RTV LOCATION NAME                                        07394024
      ******************************************************************07395024
                                                                        07395124
070711 7210-FILL-RTV-NAME.                                              07396024
070711                                                                  07397024
070711     IF PS-RTV-LOC-FOUND                                          07410024
070711                                                                  07411024
070711         MOVE XST00135-RTV-LOC-NBR TO PV-STR-RTV-LOC-NBR          07420018
070711                                                                  07420124
070711         EXEC SQL                                                 07421024
070711             SELECT LOC_NM                                        07422024
070711               INTO :XST00001-LOC-NM                              07423024
070711               FROM XST_LOC                                       07424024
070711               WHERE  LOC_NBR        = :XST00135-RTV-LOC-NBR      07425024
070711         END-EXEC                                                 07426024
070711         EVALUATE SQLCODE                                         07426124
070711             WHEN ZERO                                            07426224
070711                 MOVE XST00001-LOC-NM TO PV-STR-RTV-LOC-NAME      07426324
070711             WHEN +100                                            07426424
070711                 MOVE 'NOTFOUND'      TO PV-STR-RTV-LOC-NAME      07426524
070711             WHEN -904                                            07426624
070711             WHEN -913                                            07426724
070711                 SET DP011-MSG-FATAL                              07426824
070711                                 TO TRUE                          07426924
070711                 MOVE PC-TSYMSG-01063                             07427024
070711                                 TO DP011-MSG-NUMBER              07427124
070711                 PERFORM 9000-FMT-ERR-MSG-TO-PTC                  07427224
070711                 PERFORM 8000-SEND-DATA-TO-LISTENER               07427324
070711             WHEN OTHER                                           07427424
070711                 MOVE '7210-FILL-LOC-NAME'                        07427524
070711                                 TO DP013-PARAGRAPH               07427624
070711                 MOVE 'GET RTV NAME: '                            07427724
070711                                 TO DP013-MESSAGE-TEXT (1)        07427824
070711                 MOVE DK-LOC-NBR TO PV-DISPLAY-STR-NBR            07427924
070711                 MOVE PV-DISPLAY-STR-NBR                          07428024
070711                                 TO DP013-MESSAGE-TEXT (2)        07428124
070711                 MOVE PV-TYPE-CODE                                07428224
070711                                 TO DP013-MESSAGE-TEXT (3)        07428324
070711                 MOVE SQLCA      TO DP013-SQLCA                   07428424
070711                 MOVE 'XST_LOC' TO                                07428524
070711                                    DP013-DB2-TABLE-NAME (1)      07428624
070711                 SET DP013-DB2-ABEND                              07428724
070711                 DP013-NO-ROLLBACK                                07428824
070711                                  TO TRUE                         07428924
070711                 PERFORM 9999-WRITE-CICS-LOG-MSG                  07429024
070711                 SET DP011-MSG-FATAL                              07429124
070711                                 TO TRUE                          07429224
070711                 MOVE PC-TSYMSG-01064                             07429324
070711                                 TO DP011-MSG-NUMBER              07429424
070711                 PERFORM 9000-FMT-ERR-MSG-TO-PTC                  07429524
070711                 PERFORM 8000-SEND-DATA-TO-LISTENER               07429624
070711         END-EVALUATE                                             07429724
070711                                                                  07429824
070711     ELSE                                                         07429924
070711                                                                  07430024
070711         MOVE 811                  TO PV-STR-RTV-LOC-NBR          07450018
070711         MOVE 'RV-FINDLAY'         TO PV-STR-RTV-LOC-NAME         07460018
070711     END-IF.                                                      07470024
                                                                        07480012
      ******************************************************************07940024
      *    FETCH TYPE CODE                                              07950024
      ******************************************************************07960024
       7300-FETCH-TYP-CDE-CSR.                                          08010012
           INITIALIZE DCLTTFTYCD.                                       08020012
                                                                        08030012
           EXEC SQL                                                     08040012
               FETCH  TYP_CDE_CSR                                       08050012
                INTO  :TFTYCD-XFER-TYP-CDE,                             08060012
                      :TFTYCD-TYP-1ST-LNE-DESC,                         08070012
                      :TFTYCD-TYP-2ND-LNE-DESC,                         08080012
                      :TFTYCD-PTC-PTH-CDE,                              08090012
                      :TFTYCD-PRIC-REQR-IND,                            08100012
                      :TFTYCD-DFLT-STR-TYP-CDE                          08110012
           END-EXEC.                                                    08120012
                                                                        08130012
           EVALUATE SQLCODE                                             08140015
               WHEN ZERO                                                08150015
                   ADD 1           TO TF002-NBR-OF-OCCURS               08160015
               WHEN +100                                                08170015
                   SET PS-END-OF-TYP-CDE-DATA                           08180015
                                   TO TRUE                              08190015
               WHEN -904                                                08200015
               WHEN -913                                                08210015
                   SET DP011-MSG-FATAL                                  08220015
                                   TO TRUE                              08230015
                   MOVE PC-TSYMSG-01063                                 08240012
                                   TO DP011-MSG-NUMBER                  08250015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08260012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08270012
               WHEN OTHER                                               08280015
                   MOVE '7300-FETCH-TYP-CDE-CSR'                        08290012
                                   TO DP013-PARAGRAPH                   08300015
                   MOVE 'FETCH TYP_CDE_CSR'                             08310012
                                   TO DP013-MESSAGE-TEXT (1)            08320015
                   MOVE SQLCA      TO DP013-SQLCA                       08330015
                   MOVE 'TTFTYCD'  TO DP013-DB2-TABLE-NAME (1)          08340015
                   SET DP013-DB2-ABEND                                  08350012
                       DP013-NO-ROLLBACK                                08360012
                                   TO TRUE                              08370015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08380012
                   SET DP011-MSG-FATAL                                  08390015
                                   TO TRUE                              08400015
                   MOVE PC-TSYMSG-01064                                 08410012
                                   TO DP011-MSG-NUMBER                  08420015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08430012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08440012
           END-EVALUATE.                                                08450012
                                                                        08460012
      ******************************************************************08461024
      *    GET TIMESTAMP                                                08462024
      ******************************************************************08463024
       7400-SELECT-CURRENT-TIMESTAMP.                                   08470012
           EXEC SQL                                                     08480012
               SET  :PV-CURRENT-TIMESTAMP  =  CURRENT TIMESTAMP         08490012
           END-EXEC.                                                    08500012
                                                                        08510012
           EVALUATE SQLCODE                                             08520015
               WHEN ZERO                                                08530015
                   CONTINUE                                             08540015
               WHEN OTHER                                               08550015
                   MOVE '7400-SELECT-CURRENT-TIMESTAMP'                 08560012
                                   TO DP013-PARAGRAPH                   08570015
                   MOVE 'SELECT THE CURRENT TIMESTAMP'                  08580012
                                   TO DP013-MESSAGE-TEXT (1)            08590015
                   MOVE SQLCA      TO DP013-SQLCA                       08600015
                   SET DP013-DB2-ABEND                                  08610012
                       DP013-NO-ROLLBACK                                08620012
                                   TO TRUE                              08630015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08640012
                   SET DP011-MSG-FATAL                                  08650015
                                   TO TRUE                              08660015
                   MOVE PC-TSYMSG-01064                                 08670012
                                   TO DP011-MSG-NUMBER                  08680015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08690012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08700012
           END-EVALUATE.                                                08710012
                                                                        08720012
      ******************************************************************08721024
      *    INSERT TRANSFER                                              08722024
      ******************************************************************08723024
       7500-INSERT-XFER.                                                08730012
           EXEC SQL                                                     08740012
               INSERT INTO TTFMSTR                                      08750012
                   (XFER_DKEY_ID,                                       08760012
                    ENTR_MTHD_TYP_CDE,                                  08770012
                    FR_STR_NBR)                                         08780012
               VALUES                                                   08790012
                   (:DK-XFER-DKEY-ID,                                   08800012
                    '01',                                               08810012
                    :DK-FR-STR-NBR)                                     08820012
           END-EXEC.                                                    08830012
                                                                        08840012
           EVALUATE SQLCODE                                             08850015
               WHEN ZERO                                                08860015
                   SET PS-XFER-CREATED                                  08870015
                                   TO TRUE                              08880015
               WHEN -803                                                08890015
                   CONTINUE                                             08900015
               WHEN -904                                                08910015
               WHEN -913                                                08920015
                   SET DP011-MSG-FATAL                                  08930015
                                   TO TRUE                              08940015
                   MOVE PC-TSYMSG-01063                                 08950012
                                   TO DP011-MSG-NUMBER                  08960015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08970012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08980012
               WHEN OTHER                                               08990015
                   MOVE '7500-INSERT-XFER'                              09000012
                                   TO DP013-PARAGRAPH                   09010015
                   MOVE 'DB2 ERROR INSERTING ROW INTO TTFMSTR'          09020012
                                   TO DP013-MESSAGE-TEXT (1)            09030015
                   MOVE 'INSERT DATALESS KEY VALUE (XFER_DKEY_ID) WAS: '09040012
                                   TO DP013-MESSAGE-TEXT (2)            09050015
                   MOVE DK-XFER-DKEY-ID                                 09060012
                                   TO PV-DISPLAY-XFER-DKEY-ID           09070015
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         09080012
                                   TO DP013-MESSAGE-TEXT (3)            09090015
                   MOVE SQLCA      TO DP013-SQLCA                       09100015
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          09110015
                   SET DP013-DB2-ABEND                                  09120012
                       DP013-NO-ROLLBACK                                09130012
                                   TO TRUE                              09140015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09150012
                   SET DP011-MSG-FATAL                                  09160015
                                   TO TRUE                              09170015
                   MOVE PC-TSYMSG-01064                                 09180012
                                   TO DP011-MSG-NUMBER                  09190015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09200012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09210012
           END-EVALUATE.                                                09220012
                                                                        09230012
      ******************************************************************09231024
      *    GET STORE NAME                                               09232024
      ******************************************************************09233024
       7600-SELECT-STR-NAME.                                            09240012
           EXEC SQL                                                     09250017
               SELECT  LOC_NM                                           09260017
                 INTO  :XST00001-LOC-NM                                 09270017
                 FROM  XST_LOC                                          09280017
                WHERE  LOC_NBR      =  :DK-LOC-NBR                      09290017
           END-EXEC.                                                    09300014
                                                                        09310012
           EVALUATE SQLCODE                                             09320015
               WHEN ZERO                                                09330015
                   CONTINUE                                             09340015
               WHEN -904                                                09350015
               WHEN -913                                                09360015
                   SET DP011-MSG-FATAL                                  09370015
                                   TO TRUE                              09380015
                   MOVE PC-TSYMSG-01063                                 09390012
                                   TO DP011-MSG-NUMBER                  09400015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09410012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09420012
               WHEN OTHER                                               09430015
                   MOVE '7600-SELECT-STR-NAME'                          09440012
                                   TO DP013-PARAGRAPH                   09450015
                   MOVE 'SELECT STORE NAME FOR STORE NUMBER/TYPE CODE: '09460012
                                   TO DP013-MESSAGE-TEXT (1)            09470015
                   MOVE DK-LOC-NBR TO PV-DISPLAY-STR-NBR                09480017
                   MOVE PV-DISPLAY-STR-NBR                              09490012
                                   TO DP013-MESSAGE-TEXT (2)            09500015
                   MOVE PV-TYPE-CODE                                    09510015
                                   TO DP013-MESSAGE-TEXT (3)            09520015
                   MOVE SQLCA      TO DP013-SQLCA                       09530015
                   MOVE 'XST_LOC'  TO DP013-DB2-TABLE-NAME (1)          09540017
                   SET DP013-DB2-ABEND                                  09550012
                       DP013-NO-ROLLBACK                                09560012
                                   TO TRUE                              09570015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09580012
                   SET DP011-MSG-FATAL                                  09590012
                                   TO TRUE                              09600015
                   MOVE PC-TSYMSG-01064                                 09610012
                                   TO DP011-MSG-NUMBER                  09620015
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09630012
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09640012
           END-EVALUATE.                                                09650012
      *                                                                 09660012
      ******************************************************************09670012
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  09680012
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           09690012
      ******************************************************************09700012
       8000-SEND-DATA-TO-LISTENER.                                      09710012
           IF TF001-MQ-INDICATOR-Y                                      09720012
               PERFORM 8500-MQ-SETUP                                    09730012
               PERFORM 8510-MQ-SETUP-REMOTE                             09740012
               PERFORM 8520-PUT-QUEUE                                   09750012
               PERFORM 8600-CLOSE-PUT-Q                                 09760012
               PERFORM 8610-DISCONNECT-QMGR                             09770012
               PERFORM 9100-EXEC-CICS-RETURN                            09780012
           ELSE                                                         09790012
               PERFORM 8110-ENQ-TCPIPPRQ                                09800012
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      09810012
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      09820012
                                                                        09830012
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   09840012
                                                                        09850012
               ADD 1               TO PV-NEXT-RECORD                    09860015
                                                                        09870012
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     09880012
                   MOVE 3          TO PV-NEXT-RECORD                    09890015
               END-IF                                                   09900012
                                                                        09910012
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    09920012
               PERFORM 8160-DEQ-TCPIPPRQ                                09930012
                                                                        09940012
               PERFORM 9100-EXEC-CICS-RETURN                            09950012
           END-IF.                                                      09960012
                                                                        09970012
       8110-ENQ-TCPIPPRQ.                                               09980012
           EXEC CICS                                                    09990012
               ENQ                                                      10000012
                   RESOURCE  (PV-TSQ-NAME)                              10010012
                   RESP      (PV-CICS-RESPONSE)                         10020012
           END-EXEC.                                                    10030012
                                                                        10040012
           EVALUATE TRUE                                                10050012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10060012
                   CONTINUE                                             10070012
               WHEN OTHER                                               10080012
                   MOVE '8110-ENQ-TCPIPPRQ'                             10090012
                                   TO DP013-PARAGRAPH                   10100015
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q10110012
      -                 'UEUE: '                                        10120012
                                   TO DP013-MESSAGE-TEXT (1)            10130015
                   MOVE PV-TSQ-NAME                                     10140015
                                   TO DP013-MESSAGE-TEXT (2)            10150015
                   SET DP013-CICS-ABEND                                 10160012
                       DP013-NO-ROLLBACK                                10170012
                                   TO TRUE                              10180015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10190012
                   PERFORM 9100-EXEC-CICS-RETURN                        10200012
           END-EVALUATE.                                                10210012
                                                                        10220012
       8120-READQ-TCPIPPRQ-RECORD1.                                     10230012
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           10240012
                                   TO PV-TSQ-LENGTH.                    10250015
                                                                        10260012
           EXEC CICS                                                    10270012
               READQ TS                                                 10280012
                   QUEUE   (PV-TSQ-NAME)                                10290012
                   INTO    (PV-TCPIPPRQ-RECORD1)                        10300012
                   LENGTH  (PV-TSQ-LENGTH)                              10310012
                   ITEM    (1)                                          10320012
                   RESP    (PV-CICS-RESPONSE)                           10330012
           END-EXEC.                                                    10340012
                                                                        10350012
           EVALUATE TRUE                                                10360012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10370012
                   CONTINUE                                             10380012
               WHEN OTHER                                               10390012
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   10400012
                                   TO DP013-PARAGRAPH                   10410015
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10420012
      -                 'QUEUE: '                                       10430012
                                   TO DP013-MESSAGE-TEXT (1)            10440015
                   MOVE PV-TSQ-NAME                                     10450015
                                   TO DP013-MESSAGE-TEXT (2)            10460015
                   SET DP013-CICS-ABEND                                 10470012
                       DP013-NO-ROLLBACK                                10480012
                                   TO TRUE                              10490015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10500012
                   PERFORM 9100-EXEC-CICS-RETURN                        10510012
           END-EVALUATE.                                                10520012
                                                                        10530012
       8130-READQ-TCPIPPRQ-RECORD2.                                     10540012
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           10550015
                                   TO PV-TSQ-LENGTH.                    10560015
                                                                        10570012
           EXEC CICS                                                    10580012
               READQ TS                                                 10590012
                   QUEUE   (PV-TSQ-NAME)                                10600012
                   INTO    (PV-TCPIPPRQ-RECORD2)                        10610012
                   LENGTH  (PV-TSQ-LENGTH)                              10620012
                   ITEM    (2)                                          10630012
                   RESP    (PV-CICS-RESPONSE)                           10640012
           END-EXEC.                                                    10650012
                                                                        10660012
           EVALUATE TRUE                                                10670012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10680012
                   CONTINUE                                             10690012
               WHEN OTHER                                               10700012
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   10710012
                                   TO DP013-PARAGRAPH                   10720015
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10730012
      -                 'QUEUE: '                                       10740012
                                   TO DP013-MESSAGE-TEXT (1)            10750015
                   MOVE PV-TSQ-NAME                                     10760015
                                   TO DP013-MESSAGE-TEXT (2)            10770015
                   SET DP013-CICS-ABEND                                 10780012
                       DP013-NO-ROLLBACK                                10790012
                                   TO TRUE                              10800015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10810012
                   PERFORM 9100-EXEC-CICS-RETURN                        10820012
           END-EVALUATE.                                                10830012
                                                                        10840012
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  10850012
                                                                        10860012
           MOVE LENGTH OF TF002-XFER-TO-PTC-FIXED-DATA                  10870012
                                   TO PV-FIXED-DATA-LENGTH.             10880015
                                                                        10890012
           MOVE LENGTH OF TF002-XFER-TYP-CDE-TBL                        10900012
                                   TO PV-TBL-LENGTH.                    10910015
                                                                        10920012
           COMPUTE PV-TOT-REC-LENGTH  =                                 10930012
               (TF002-NBR-OF-OCCURS * PV-TBL-LENGTH)  +                 10940012
                PV-FIXED-DATA-LENGTH.                                   10950012
                                                                        10960012
           MOVE PV-TOT-REC-LENGTH  TO  TF002-TOT-REC-LENGTH.            10970015
           MOVE TF001-MATCHING-NBR-FIELD                                10980012
                                   TO  TF002-MATCHING-NBR-FIELD.        10990015
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     11000015
                                                                        11010012
           EXEC CICS                                                    11020012
               WRITEQ TS                                                11030012
                   QUEUE   (PV-TSQ-NAME)                                11040012
                   FROM    (TF002-XFER-TO-PTC-RECORD)                   11050012
                   LENGTH  (PV-TSQ-LENGTH)                              11060012
                   ITEM    (PV-ITEM-NBR)                                11070012
                       REWRITE                                          11080012
                   RESP    (PV-CICS-RESPONSE)                           11090012
           END-EXEC.                                                    11100012
                                                                        11110012
           EVALUATE TRUE                                                11120012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11130012
                   CONTINUE                                             11140012
               WHEN OTHER                                               11150012
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                11160012
                                   TO DP013-PARAGRAPH                   11170015
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA11180012
      -                 'STORAGE QUEUE: '                               11190012
                                   TO DP013-MESSAGE-TEXT (1)            11200015
                   MOVE PV-TSQ-NAME                                     11210015
                                   TO DP013-MESSAGE-TEXT (2)            11220015
                   SET DP013-CICS-ABEND                                 11230012
                       DP013-NO-ROLLBACK                                11240012
                                   TO TRUE                              11250015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11260012
                   PERFORM 9100-EXEC-CICS-RETURN                        11270012
           END-EVALUATE.                                                11280012
                                                                        11290012
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   11300012
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           11310012
                                   TO PV-TSQ-LENGTH.                    11320015
           MOVE +1                 TO PV-ITEM-NBR.                      11330015
                                                                        11340012
           EXEC CICS                                                    11350012
               WRITEQ TS                                                11360012
                   QUEUE   (PV-TSQ-NAME)                                11370012
                   FROM    (PV-TCPIPPRQ-RECORD1)                        11380012
                   LENGTH  (PV-TSQ-LENGTH)                              11390012
                   ITEM    (PV-ITEM-NBR)                                11400012
                       REWRITE                                          11410012
                   RESP    (PV-CICS-RESPONSE)                           11420012
           END-EXEC.                                                    11430012
                                                                        11440012
           EVALUATE TRUE                                                11450012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11460012
                   CONTINUE                                             11470012
               WHEN OTHER                                               11480012
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 11490012
                                   TO DP013-PARAGRAPH                   11500015
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   11510012
                                   TO DP013-MESSAGE-TEXT (1)            11520015
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     11530012
                                   TO DP013-MESSAGE-TEXT (2)            11540015
                   MOVE PV-TSQ-NAME                                     11550015
                                   TO DP013-MESSAGE-TEXT (3)            11560015
                   MOVE PV-TCPIPPRQ-RECORD1                             11570012
                                   TO DP013-MESSAGE-TEXT (4)            11580015
                   SET DP013-CICS-ABEND                                 11590012
                       DP013-NO-ROLLBACK                                11600012
                                   TO TRUE                              11610015
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11620012
                   PERFORM 9100-EXEC-CICS-RETURN                        11630012
           END-EVALUATE.                                                11640012
                                                                        11650012
       8160-DEQ-TCPIPPRQ.                                               11660012
           EXEC CICS                                                    11670012
               DEQ                                                      11680012
                   RESOURCE  (PV-TSQ-NAME)                              11690012
                   RESP      (PV-CICS-RESPONSE)                         11700012
           END-EXEC.                                                    11710012
                                                                        11720012
           EVALUATE TRUE                                                11730012
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11740012
                   CONTINUE                                             11750012
               WHEN OTHER                                               11760012
                   MOVE '8160-DEQ-TCPIPPRQ'                             11770012
                                   TO DP013-PARAGRAPH                   11780015
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q11790012
      -                 'UEUE: '                                        11800012
                                   TO DP013-MESSAGE-TEXT (1)            11810015
                   MOVE PV-TSQ-NAME                                     11820015
                                   TO DP013-MESSAGE-TEXT (2)            11830015
                   SET DP013-CICS-ABEND                                 11840012
                       DP013-NO-ROLLBACK                                11850012
                                   TO TRUE                              11860015
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        11870012
                 PERFORM 9100-EXEC-CICS-RETURN                          11880012
           END-EVALUATE.                                                11890012
                                                                        11900012
       8500-MQ-SETUP.                                                   11910012
                                                                        11920012
      ***                                                               11930012
      * DETERMINE THE SYSTEM                                            11940012
      ***                                                               11950012
                                                                        11960012
           PERFORM EP000-0000-INITIALIZE.                               11970012
           IF EP000-PV-KOHLS-PROD-SYSTEM                                11980012
               SET PV-PROD-QMGR-NAME                                    11990015
                                   TO TRUE                              12000015
           ELSE                                                         12010012
               IF EP000-PV-KOHLS-QA-SYSTEM                              12020012
                   SET PV-QA-QMGR-NAME                                  12030015
                                   TO TRUE                              12040015
               ELSE                                                     12050012
                   SET PV-TEST-QMGR-NAME                                12060012
                                   TO TRUE                              12070015
               END-IF                                                   12080012
           END-IF.                                                      12090012
                                                                        12100012
      ***************************************************************   12110012
      *    CONNECT TO THE QUEUE MANAGER                                 12120012
      ***************************************************************   12130012
                                                                        12140012
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       12150015
           CALL WS-MQCONN USING PV-QM-NAME                              12160012
                                PV-HCONN                                12170012
                                PV-COMPLETION-CODE                      12180012
                                PV-REASON.                              12190012
                                                                        12200012
      ***************************************************************   12210012
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              12220012
      *    AND EXIT                                                     12230012
      ***************************************************************   12240012
                                                                        12250012
           MOVE PV-REASON          TO PV-CON-REASON.                    12260015
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12270012
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  12280015
               MOVE '8500-MQ-SETUP'                                     12290015
                                   TO DP013-PARAGRAPH                   12300015
               MOVE  PV-ERROR-MESSAGE                                   12310015
                                   TO DP013-MESSAGE-TEXT (1)            12320015
               MOVE  PV-COMPLETION-CODE                                 12330012
                                   TO DP013-MESSAGE-TEXT (2)            12340015
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12350015
               SET DP013-CICS-ABEND                                     12360012
                   DP013-NO-ROLLBACK                                    12370015
                                   TO TRUE                              12380015
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12390012
               PERFORM 9100-EXEC-CICS-RETURN                            12400012
           END-IF.                                                      12410012
                                                                        12420012
       8510-MQ-SETUP-REMOTE.                                            12430012
      ***************************************************************   12440012
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     12450012
      *    THIS IS A REMOTE QUEUE.                                      12460012
      ***************************************************************   12470012
                                                                        12480012
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      12490012
                                     MQOO-FAIL-IF-QUIESCING.            12500012
                                                                        12510012
           MOVE TF001-REPLYTOQ     TO MQOD-OBJECTNAME.                  12520015
           MOVE TF001-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12530015
                                                                        12540012
           CALL WS-MQOPEN USING PV-HCONN                                12550012
                                MQM-OBJECT-DESCRIPTOR                   12560012
                                PV-OPEN-OPTIONS                         12570012
                                PV-PQ-HANDLE                            12580012
                                PV-COMPLETION-CODE                      12590012
                                PV-REASON.                              12600012
                                                                        12610012
      ********************************************************          12620012
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    12630012
      *    AND EXIT.                                                    12640012
      ********************************************************          12650012
                                                                        12660012
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12670012
               PERFORM 8600-CLOSE-PUT-Q                                 12680012
               PERFORM 8610-DISCONNECT-QMGR                             12690012
               MOVE 'MQOPEN WRITE Q'                                    12700015
                                   TO PV-ERROR-MESSAGE                  12710015
               MOVE '8510-MQ-SETUP-REMOTE'                              12720012
                                   TO DP013-PARAGRAPH                   12730015
               MOVE  PV-ERROR-MESSAGE                                   12740015
                                   TO DP013-MESSAGE-TEXT (1)            12750015
               MOVE  PV-COMPLETION-CODE                                 12760012
                                   TO DP013-MESSAGE-TEXT (2)            12770015
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12780015
               SET DP013-CICS-ABEND                                     12790012
                   DP013-NO-ROLLBACK                                    12800015
                                   TO TRUE                              12810015
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12820012
               PERFORM 9100-EXEC-CICS-RETURN                            12830012
           END-IF.                                                      12840012
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          12850015
                                                                        12860012
       8520-PUT-QUEUE.                                                  12870012
           MOVE TF001-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12880015
           MOVE TF001-REPLYTOQ     TO MQOD-OBJECTNAME.                  12890015
           MOVE TF001-MSGID        TO MQMD-CORRELID.                    12900015
           MOVE MQMI-NONE          TO MQMD-MSGID.                       12910015
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      12920015
           MOVE 5000               TO MQMD-EXPIRY.                      12930015
           MOVE LENGTH OF TF002-XFER-TO-PTC-RECORD                      12940012
                                   TO PV-DATA-LENGTH.                   12950015
           MOVE TF002-XFER-TO-PTC-RECORD                                12960015
                                   TO PV-MSGBUFFER.                     12970015
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 12980015
                                                                        12990012
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      13000012
                                                                        13010012
           CALL WS-MQPUT USING PV-HCONN                                 13020012
                               PV-FMT-OPEN-OUTPUT-HNDL                  13030012
                               MQM-MESSAGE-DESCRIPTOR                   13040012
                               MQM-PUT-MESSAGE-OPTIONS                  13050012
                               PV-DATA-LENGTH                           13060012
                               PV-MSGBUFFER                             13070012
                               PV-COMPLETION-CODE                       13080012
                               PV-REASON.                               13090012
                                                                        13100012
      ***********************************************************       13110012
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 13120012
      *        AND BREAK OUT OF LOOP                                    13130012
      ***********************************************************       13140012
                                                                        13150012
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   13160012
              MOVE PV-COMPLETION-CODE                                   13170015
                                   TO PH-COMPLETION-CODE                13180015
              MOVE PV-REASON       TO PH-REASON                         13190015
              PERFORM 8600-CLOSE-PUT-Q                                  13200012
              PERFORM 8610-DISCONNECT-QMGR                              13210012
              MOVE 'MQPUT ERR'     TO PV-ERROR-MESSAGE                  13220015
              MOVE '8520-PUT-QUEUE'                                     13230015
                                   TO DP013-PARAGRAPH                   13240015
              MOVE PV-ERROR-MESSAGE                                     13250015
                                   TO DP013-MESSAGE-TEXT (1)            13260015
              MOVE PH-COMPLETION-CODE                                   13270015
                                   TO DP013-MESSAGE-TEXT (2)            13280015
              MOVE PH-REASON       TO DP013-MESSAGE-TEXT (3)            13290015
              SET DP013-CICS-ABEND                                      13300012
                  DP013-NO-ROLLBACK                                     13310015
                                   TO TRUE                              13320015
              PERFORM 9999-WRITE-CICS-LOG-MSG                           13330012
              PERFORM 9100-EXEC-CICS-RETURN                             13340012
           ELSE                                                         13350012
               SET PS-MQPUT-SUCCESSFUL                                  13360015
                                   TO TRUE                              13370015
           END-IF.                                                      13380012
                                                                        13390012
       8600-CLOSE-PUT-Q.                                                13400012
           CALL WS-MQCLOSE USING PV-HCONN                               13410012
                                 PV-PQ-HANDLE                           13420012
                                 MQCO-NONE                              13430012
                                 PV-COMPLETION-CODE                     13440012
                                 PV-REASON.                             13450012
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   13460012
               MOVE 'MQCLOSE PQ HANDLE'                                 13470012
                                   TO PV-ERROR-MESSAGE                  13480015
               MOVE '8600-CLOSE-PUT-Q'                                  13490015
                                   TO DP013-PARAGRAPH                   13500015
               MOVE  PV-ERROR-MESSAGE                                   13510015
                                   TO DP013-MESSAGE-TEXT (1)            13520015
               MOVE  PV-COMPLETION-CODE                                 13530012
                                   TO DP013-MESSAGE-TEXT (2)            13540015
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            13550015
               SET DP013-CICS-ABEND                                     13560012
                   DP013-NO-ROLLBACK                                    13570015
                                   TO TRUE                              13580015
               PERFORM 9999-WRITE-CICS-LOG-MSG                          13590012
               PERFORM 9100-EXEC-CICS-RETURN                            13600012
           END-IF.                                                      13610012
                                                                        13620012
       8610-DISCONNECT-QMGR.                                            13630012
                                                                        13640012
           IF PV-CON-REASON IS NOT EQUAL                                13650015
                                   TO MQRC-ALREADY-CONNECTED            13660015
              CALL WS-MQDISC USING PV-HCONN                             13670012
                                   PV-COMPLETION-CODE                   13680012
                                   PV-REASON                            13690012
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                13700012
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  13710015
                  MOVE '8610-DISCONNECT'                                13720012
                                   TO DP013-PARAGRAPH                   13730015
                  MOVE PV-ERROR-MESSAGE                                 13740012
                                   TO DP013-MESSAGE-TEXT (1)            13750015
                  MOVE PV-COMPLETION-CODE                               13760012
                                   TO DP013-MESSAGE-TEXT (2)            13770015
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            13780015
                  SET DP013-CICS-ABEND                                  13790012
                      DP013-NO-ROLLBACK                                 13800012
                                   TO TRUE                              13810015
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       13820012
                  PERFORM 9100-EXEC-CICS-RETURN                         13830012
              END-IF                                                    13840012
           END-IF.                                                      13850012
                                                                        13860012
      ******************************************************************13870012
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          13880012
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   13890012
      *    STREAM BEING SENT BACK TO THE PTC.                           13900012
      ******************************************************************13910012
       9000-FMT-ERR-MSG-TO-PTC.                                         13920012
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         13930012
           MOVE DP011-MSG-LEVEL    TO  TF002-ERR-TYP-IND.               13940015
           MOVE DP011-MSG-TEXT     TO  TF002-ERR-MSG.                   13950015
      *                                                                 13960012
       9100-EXEC-CICS-RETURN.                                           13970012
           EXEC CICS                                                    13980012
               RETURN                                                   13990012
           END-EXEC.                                                    14000012
      *                                                                 14010012
       9999-WRITE-CICS-LOG-MSG.                                         14020012
           MOVE PC-CURRENT-PROGRAM-NAME                                 14030012
                                   TO  DP013-PROGRAM.                   14040015
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  14050015
                                                                        14060012
           INITIALIZE DP013-SRC-TASK-NUMBER                             14070012
                      DP013-STACK.                                      14080012
                                                                        14090012
           SET DP013-LINK-RETURN   TO  TRUE.                            14100015
                                                                        14110012
           EXEC CICS                                                    14120012
               LINK                                                     14130012
                   PROGRAM   (DP013-NAME)                               14140012
                   COMMAREA  (DP013-PARAMETERS)                         14150012
                   LENGTH    (DP013-LENGTH)                             14160012
           END-EXEC.                                                    14170012
                                                                        14180012
      ***                                                               14190012
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           14200012
      ***                                                               14210012
                                                                        14220012
           COPY DPPD011.                                                14230012
      ***                                                               14240012
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     14250012
      ***                                                               14260012
                                                                        14270012
           COPY DPPD014.                                                14280012
                                                                        14290012
           COPY EPPD000.                                                14300012
