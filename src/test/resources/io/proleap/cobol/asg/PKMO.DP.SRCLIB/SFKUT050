       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.      SFKUT050.                                       00020016
       AUTHOR.          KOHLS.                                          00030001
       DATE-WRITTEN.    APRIL 18, 2011.                                 00040001
                                                                        00050001
      *-----------------------------------------------------------      00060001
      *                STORE MANIFEST DATA QUEUE READER                 00070009
      *-----------------------------------------------------------      00080001
      *   THIS PROGRAM WILL READ THE SU.MLS.SURD103.TRAILER.MANIFEST.Q  00090001
      *   WHICH CONTAINS THE MANIFEST STATUS INFORMATION OF TRUCKS AT   00100001
      *   THE STORES.IT THEN WRITE OUT THE RECORDS READ SO THEY CAN     00110014
      *   BE SORTED INTO THE PROPER SEQUENCE TO BE PROCESSED IN         00120014
      *   SUKUT151.                                                     00121014
      *-----------------------------------------------------------      00130001
      * HISTORY LOG:                                                    00140001
      *-----------------------------------------------------------      00150001
      * DATE:                                                           00160001
      * WR/IR#:                                                         00170001
      * PROGRAMMER:                                                     00180001
      * DESCRIPTION:                                                    00190001
      *                                                                 00200001
      *----------------------------------------------------------       00210001
       ENVIRONMENT DIVISION.                                            00220001
      *----------------------------------------------------------       00230001
       CONFIGURATION SECTION.                                           00240001
       SOURCE-COMPUTER.        IBM-3090.                                00250001
       OBJECT-COMPUTER.        IBM-3090.                                00260001
                                                                        00270001
       INPUT-OUTPUT SECTION.                                            00280001
                                                                        00290001
       FILE-CONTROL.                                                    00300001
                                                                        00310001
           SELECT CC-QUEUE-MGR-CONNECT                                  00320001
                  ASSIGN TO INP01.                                      00330001
           SELECT CC-QUEUE-MGR                                          00340003
                  ASSIGN TO INP02.                                      00350001
           SELECT MNFST-STAT                                            00380014
                  ASSIGN TO OUT01.                                      00390001
                                                                        00400001
       DATA DIVISION.                                                   00410001
       FILE SECTION.                                                    00420001
                                                                        00430001
       FD  CC-QUEUE-MGR-CONNECT                                         00440001
           RECORDING MODE F                                             00450001
           BLOCK CONTAINS 0 RECORDS                                     00460001
           LABEL RECORDS ARE OMITTED                                    00470001
           DATA RECORD IS CC-QUEUE-MGR-CONNECT-RECORD.                  00480001
       01  CC-QUEUE-MGR-CONNECT-RECORD     PIC X(80).                   00490001
                                                                        00500001
       FD  CC-QUEUE-MGR                                                 00510003
           RECORDING MODE F                                             00520001
           BLOCK CONTAINS 0 RECORDS                                     00530001
           LABEL RECORDS ARE OMITTED                                    00540001
           DATA RECORD IS CC-QUEUE-MGR-RECORD.                          00550003
       01  CC-QUEUE-MGR-RECORD   PIC X(80).                             00560003
                                                                        00570001
       FD  MNFST-STAT                                                   00650014
           RECORDING MODE IS F                                          00660014
           BLOCK CONTAINS 0 RECORDS                                     00670014
           LABEL RECORDS ARE OMITTED                                    00700001
           DATA RECORD IS MNFST-STAT-RECORD.                            00710014
       01  MNFST-STAT-RECORD.                                           00720014
           05  FORM-SU-HR-FLD                  PIC X(60).               00730014
                                                                        00770001
       WORKING-STORAGE SECTION.                                         00780001
      *-----------------------------------------------------------      00790001
      * PS- PROGRAM SWITCHES                                            00800001
      *-----------------------------------------------------------      00810001
       01  PS-PROGRAM-SWITCHES.                                         00820001
           05  PS-STAT-HDR-REC-WRITEN-SW PIC X(01) VALUE 'N'.           00830006
               88  PS-STAT-HDR-REC-WRITEN         VALUE 'Y'.            00840006
               88  PS-STAT-HDR-REC-NOT-WRITEN     VALUE 'N'.            00850006
           05  PS-DATA-HDR-REC-WRITEN-SW PIC X(01) VALUE 'N'.           00850106
               88  PS-DATA-HDR-REC-WRITEN         VALUE 'Y'.            00850206
               88  PS-DATA-HDR-REC-NOT-WRITEN     VALUE 'N'.            00850306
           05  PS-PROCESS-QUEUE-SW      PIC X(01) VALUE 'Y'.            00860001
               88  PS-PROCESS-QUEUE-COMPLETE      VALUE 'N'.            00870001
               88  PS-PROCESS-QUEUE-CONTINUE      VALUE 'Y'.            00880001
           05  PS-END-OF-MNFST-FL-SW    PIC X(01) VALUE 'N'.            00890006
               88  PS-END-OF-MNFST-FL             VALUE 'Y'.            00900006
               88  PS-NOT-END-OF-MNFST-FL         VALUE 'N'.            00910006
           05  PS-MNFST-HDR-NOT-WRITEN-SW  PIC X(01) VALUE 'N'.         00920005
               88  PS-MNFST-HDR-WRITEN            VALUE 'N'.            00930006
               88  PS-MNFST-HDR-NOT-WRITEN        VALUE 'Y'.            00931006
                                                                        01000001
      *-----------------------------------------------------------      01010001
      * CONTROL CARD 1 RECORD LAYOUT - QUEUE MANAGER NAME               01020001
      *-----------------------------------------------------------      01030001
       01  CC-CONTROL-CARD-1-LAYOUT.                                    01040001
           05  CC-QUEUE-MANAGER-NAME    PIC X(48) VALUE SPACES.         01050001
           05  FILLER                   PIC X(32) VALUE SPACES.         01060001
                                                                        01070001
      *-----------------------------------------------------------      01080001
      * CONTROL CARD 2 RECORD LAYOUT - BUSINESS EVENT QUEUE NAME        01090001
      *-----------------------------------------------------------      01100001
       01  CC-CONTROL-CARD-2-LAYOUT.                                    01110001
           05  CC-QUEUE-NAME            PIC X(48) VALUE SPACES.         01120003
           05  FILLER                   PIC X(32) VALUE SPACES.         01130001
                                                                        01140001
      *-----------------------------------------------------------      01150001
      * PROGRAM CONSTANTS                                               01160001
      *-----------------------------------------------------------      01170001
       01  PC-PROGRAM-CONSTANTS.                                        01180001
           05  PC-CURRENT-PROGRAM-NAME  PIC X(08) VALUE 'SFKUT050'.     01190016
           05  PC-CSV-DELIMITER             PIC X(01) VALUE '|'.        01200001
           05  PC-UNDER-SCORE               PIC X(01) VALUE '_'.        01210001
           05  PC-ONE-SPACE                 PIC X(01) VALUE ' '.        01240001
           05  PC-ONE-ZERO                  PIC X(01) VALUE '0'.        01250001
           05  PC-STR-GRP-ID-99991          PIC X(05) VALUE '99991'.    01260001
           05  PC-STR-GRP-ID-5000           PIC X(05) VALUE '05000'.    01270001
           05  PC-STR-GRP-ID-1000           PIC X(05) VALUE '01000'.    01280001
           05  PC-FIVE-ZERO                 PIC X(05) VALUE '00000'.    01290001
           05  PC-HDR-IND                   PIC X(03) VALUE 'HDR'.      01300001
           05  PC-FILE-APPLY-TYPE-FUL       PIC X(01) VALUE 'N'.        01310001
           05  PC-FILE-APPLY-TYPE-CHG       PIC X(01) VALUE 'C'.        01320001
                                                                        01330001
      *-----------------------------------------------------------      01340001
      * PV- PROGRAM VARIABLES                                           01350001
      *-----------------------------------------------------------      01360001
       01  PV-PROGRAM-VARAIBLES.                                        01370001
           05  PV-MQ-ERROR-COUNT        PIC 9(04)  VALUE 0.             01380001
           05  PV-RECORD-ACTION         PIC X      VALUE SPACE.         01381005
           05  PV-CURRENT-DATE          PIC X(10) VALUE SPACES.         01390001
           05  PV-FORMAT-CORR-ID.                                       01400001
               10  PV-FORMAT-MQ-CORR-ID PIC X(03).                      01410001
               10  PV-NULL-VALUE        PIC X(21).                      01420001
           05  PV-MQ-CORR-COM           PIC X(03).                      01430001
           05  PV-MQ-CORR-ID-COM  REDEFINES                             01440001
              PV-MQ-CORR-COM            PIC S9(04) COMP-3.              01450001
           05  PV-MQ-CORR-ID            PIC S9(04) VALUE +0 COMP-3.     01460001
           05  PV-MQ-CORR-ID-CHAR REDEFINES                             01470001
              PV-MQ-CORR-ID             PIC X(03).                      01480001
           05  PV-PRGM-STAT-CDE         PIC X(02).                      01490001
               88  PV-SUCCESS                      VALUE '00'.          01500001
               88  PV-UPDATE-NEEDED                VALUE '01'.          01510001
               88  PV-UPDATE-NOT-NEEDED            VALUE '02'.          01520001
               88  PV-INSERT                       VALUE '03'.          01530001
               88  PV-UPDATE-BYPASS                VALUE '04'.          01540001
               88  PV-NO-SUCCESS                   VALUE '05'.          01550001
               88  PV-UNEXPECTED                   VALUE '06'.          01560001
           05  PV-SEVERITY-ERR-CDE      PIC X(02).                      01570001
               88  PV-CRITICAL-ERROR               VALUE '01'.          01580001
               88  PV-UNCRITICAL-ERROR             VALUE '02'.          01590001
           05  PV-REFER-INTEGRITY-ERR   PIC S9(04).                     01600001
               88  PV-RI-ERROR                     VALUES -530,         01610001
                                              -531, -532, -543.         01620001
           05  PV-END-OF-DAY            PIC 9(03)  VALUE 999.           01630001
                                                                        01640001
           05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01650001
           05  PV-PIPE-COUNT                PIC  9(04) VALUE ZERO.      01660001
           05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01670001
           05  PV-RECORD-COUNT              PIC  9(09) VALUE ZERO.      01680001
           05  PV-SPACE                     PIC  X(01).                 01690001
           05  PV-DISPLAY-INDEX             PIC S9(04) COMP.            01700001
           05  PV-STR-GRP-TYP-CDE           PIC 9(05) VALUE ZERO.       01700106
           05  PV-STR-GRP-ID-GRP.                                       01701006
               10  PV-FIRST-BYTES           PIC 9(05) VALUE ZERO.       01702006
               10  PV-STR-GRP-ID            PIC 9(05) VALUE ZERO.       01703006
                                                                        01710001
           05  PV-VARIABLE-OUTPUT-FIELD.                                01720001
               10  PV-BIT-VARIABLE          PIC X(01)                   01730001
                                                VALUE SPACES            01740001
                                                OCCURS 20 TIMES         01750001
                                                INDEXED BY              01760001
                                                PV-BIT-IDX              01770001
                                                PV-EOF-IDX.             01780001
                                                                        01790001
           05  PV-VARIABLE-CHAR-FIELD.                                  01800001
               10  PV-BIT-CHR-VARIABLE      PIC X(01)                   01810001
                                                VALUE SPACES            01820001
                                                OCCURS 260 TIMES        01830001
                                                INDEXED BY              01840001
                                                PV-CHR-BIT-IDX          01850001
                                                PV-CHR-EOF-IDX.         01860001
                                                                        01870001
           05  PV-SAVE-PREV-LOC-NBR         PIC X(05) VALUE SPACES.     01880001
           05  PV-RUN-TIME.                                             01881006
               15  R-HR                    PIC 99.                      01882006
               15  R-MIN                   PIC 99.                      01883006
               15  R-SEC                   PIC 99.                      01884006
               15  R-TH                    PIC 99.                      01885006
                                                                        01886006
           05  PV-DATE-IN.                                              01887006
               15 DATE-IN-CC               PIC XX.                      01888006
               15 DATE-IN-YY               PIC XX.                      01889006
               15 DATE-IN-MM               PIC XX.                      01889106
               15 DATE-IN-DD               PIC XX.                      01889206
           05  PV-TIMESTAMP                 PIC X(26) VALUE SPACES.     01890001
           05  PV-CURRENT-TMST REDEFINES    PV-TIMESTAMP.               01900001
               10  PV-CURR-YYYY             PIC 9(04).                  01910001
               10  FILLER                   PIC X(01).                  01920001
               10  PV-CURR-MO               PIC 9(02).                  01930001
               10  FILLER                   PIC X(01).                  01940001
               10  PV-CURR-DD               PIC 9(02).                  01950001
               10  FILLER                   PIC X(01).                  01960001
               10  PV-CURR-HH               PIC 9(02).                  01970001
               10  FILLER                   PIC X(01).                  01980001
               10  PV-CURR-MM               PIC 9(02).                  01990001
               10  FILLER                   PIC X(01).                  02000001
               10  PV-CURR-SS               PIC 9(02).                  02010001
               10  FILLER                   PIC X(01).                  02020001
               10  PV-CURR-SSSSSS           PIC 9(06).                  02030001
                                                                        02040001
           05  PV-HEADER-TMST.                                          02050001
               10  PV-HEADER-YYYY           PIC 9(04).                  02060001
               10  PV-HEADER-YYYY-RED REDEFINES PV-HEADER-YYYY.         02070001
                15  PV-HEADER-CC            PIC 9(02).                  02080001
                15  PV-HEADER-YY            PIC 9(02).                  02090001
               10  PV-HEADER-MO             PIC 9(02)  VALUE ZERO.      02100001
               10  PV-HEADER-DD             PIC 9(02)  VALUE ZERO.      02110001
               10  PV-HEADER-HH             PIC 9(02)  VALUE ZERO.      02120001
               10  PV-HEADER-MM             PIC 9(02)  VALUE ZERO.      02130001
               10  PV-HEADER-SS             PIC 9(02)  VALUE ZERO.      02140001
           05  PV-QUOTIENT                  PIC 9(04)  VALUE ZERO.      02141013
           05  PV-RMDR-4                    PIC 9(04)  VALUE ZERO.      02142013
           05  PV-RMDR-100                  PIC 9(04)  VALUE ZERO.      02143013
      *----------------------------------------------------------       02150001
      * COPYBOOK  EPRD217 LAYOUT (HEADER LAYOUT)                        02160001
      *----------------------------------------------------------       02170001
           COPY EPRD217.                                                02180001
                                                                        02190001
      *----------------------------------------------------------       02200001
      * COPYBOOK  SURD102 MANIFEST STATUS LAYOUT (MQ QUE LAYOUT)        02210002
      *----------------------------------------------------------       02220001
           COPY SURD102.                                                02230001
                                                                        02240001
      *----------------------------------------------------------       02250001
      * COPYBOOK  SFRD104 MANFIEST STATUS LAYOUT (OUTPUT FILE)          02260017
      *----------------------------------------------------------       02270001
           COPY SFRD104.                                                02280017
                                                                        02290001
      *----------------------------------------------------------       02300002
      * COPYBOOK  SFRD104 MANIFEST STATUS LAYOUT (MQ QUE LAYOUT)        02310017
      *           ALL NUMERIC FIELDS ARE UNPACKED FOR FORMATTING        02320002
      *----------------------------------------------------------       02330002
           COPY SFRD104.                                                02340017
                                                                        02350002
      *----------------------------------------------------------       02360002
      * COPYBOOK  SFRD105 MANFIEST DATA LAYOUT (INPUT FILE)             02370017
      *           ALL NUMERIC FIELDS ARE UNPACKED FOR FORMATTING        02380002
      *----------------------------------------------------------       02390002
           COPY SFRD105.                                                02400017
                                                                        02410002
      *----------------------------------------------------------       02420002
      * MQ WORKING STORAGE                                              02430001
      *----------------------------------------------------------       02440001
       01  MQV-WORKING-STORAGE.                                         02450001
           05  MQV-MQCONN               PIC  X(08) VALUE 'CSQBCONN'.    02460001
           05  MQV-MQOPEN               PIC  X(08) VALUE 'CSQBOPEN'.    02470001
           05  MQV-MQPUT                PIC  X(08) VALUE 'CSQBPUT '.    02480001
           05  MQV-MQGET                PIC  X(08) VALUE 'CSQBGET '.    02490001
           05  MQV-MQCMIT               PIC  X(08) VALUE 'CSQBCOMM'.    02500001
           05  MQV-MQBACK               PIC  X(08) VALUE 'CSQBBACK'.    02510001
           05  MQV-MQCLOSE              PIC  X(08) VALUE 'CSQBCLOS'.    02520001
           05  MQV-MQDISC               PIC  X(08) VALUE 'CSQBDISC'.    02530001
           05  MQV-MQCHECK              PIC  X(08) VALUE 'MQR2C'.       02540001
           05  MQV-HCONN                PIC S9(09) BINARY VALUE 0.      02550001
           05  MQV-COMPLETION-CODE      PIC S9(09) BINARY.              02560001
           05  MQV-REASON               PIC S9(09) BINARY.              02570001
           05  MQV-OPEN-OPTIONS         PIC S9(09) BINARY.              02580001
           05  MQV-PROMO-HANDLE         PIC S9(09) BINARY VALUE 0.      02590001
           05  MQV-ERROR-HANDLE         PIC S9(09) BINARY VALUE 0.      02600001
           05  MQV-REASON-TEXT          PIC X(030) VALUE SPACES.        02610001
           05  MQV-MSGBUFFER            PIC X(60) VALUE SPACES.         02620004
           05  MQV-MSG-LENGTH           PIC S9(09) BINARY VALUE         02630001
                                                    +60.                02640004
           05  MQV-DATA-LENGTH          PIC S9(09) BINARY.              02650001
                                                                        02660001
      *----------------------------------------------------------       02670001
      * DATE ROUTINE COPY MEMBERS                                       02680001
      *----------------------------------------------------------       02690001
           COPY DPWS500.                                                02700001
                                                                        02710001
      *-----------------------------------------------------------      02720001
      * OBJECT-DESCRIPTOR - MQ SERIES                                   02730001
      *-----------------------------------------------------------      02740001
       01  MQM-OBJECT-DESCRIPTOR.                                       02750001
           COPY CMQODV.                                                 02760001
                                                                        02770001
      *-----------------------------------------------------------      02780001
      * MESSAGE-DESCRIPTOR - MQ SERIES                                  02790001
      *-----------------------------------------------------------      02800001
       01  MQM-MESSAGE-DESCRIPTOR.                                      02810001
           COPY CMQMDV.                                                 02820001
                                                                        02830001
      *-----------------------------------------------------------      02840001
      * GET-MESSAGE-OPTIONS - MQ SERIES                                 02850001
      *-----------------------------------------------------------      02860001
       01  MQM-GET-MESSAGE-OPTIONS.                                     02870001
           COPY CMQGMOV.                                                02880001
                                                                        02890001
      *-----------------------------------------------------------      02900001
      * PUT-MESSAGE-OPTIONS - MQ SERIES                                 02910001
      *-----------------------------------------------------------      02920001
       01  MQM-PUT-MESSAGE-OPTIONS.                                     02930001
           COPY CMQPMOV.                                                02940001
                                                                        02950001
      *-----------------------------------------------------------      02960001
      * CONSTANTS - MQ SERIES                                           02970001
      *-----------------------------------------------------------      02980001
       01  MQM-CONSTANTS.                                               02990001
           COPY CMQV.                                                   03000001
                                                                        03010001
      *-----------------------------------------------------------      03020001
      * PROGRAM COUNTERS                                                03030001
      *-----------------------------------------------------------      03040001
       01  PC-PROGRAM-COUNTERS.                                         03050001
           05  PC-MESSAGE-FROM-QUEUE        PIC 9(09) VALUE ZEROS.      03060001
           05  PC-MESSAGE-FROM-ERROR-LOG    PIC 9(09) VALUE ZEROS.      03070001
           05  PC-MESSAGE-WRITTEN-TO-FILE   PIC 9(09) VALUE ZEROS.      03080001
           05  PC-MESSAGE-FROM-FILE         PIC 9(09) VALUE ZEROS.      03081006
           05  PC-MESSAGE-TO-BUSEVNT-QUEUE  PIC 9(09) VALUE ZEROS.      03090001
           05  PC-SQL-CARD-COUNT            PIC 9(09) VALUE ZEROS.      03100001
           05  PC-SQL-CARD-RETRIEVE-COUNT   PIC 9(09) VALUE ZEROS.      03110001
                                                                        03120001
      *-----------------------------------------------------------      03130001
      * ERROR HANDLING                                                  03140001
      *-----------------------------------------------------------      03150001
       01  PV-MISC-ABEND-FIELDS.                                        03160001
           05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      03170001
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      03180001
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      03190001
           05  PV-COMPLETION-CODE           PIC S9(09) BINARY.          03200001
           05  PV-REASON                    PIC S9(09) BINARY.          03210001
           05  PV-REASON-TEXT               PIC X(030) VALUE SPACES.    03220001
       01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 03230001
           88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           03240001
           88  ABEND-4020-MQ-ERROR               VALUE +4020.           03250001
                                                                        03260001
      *----------------------------------------------------------       03270001
       PROCEDURE DIVISION.                                              03280001
      *----------------------------------------------------------       03290001
       0000-MAINLINE.                                                   03300001
                                                                        03310001
           PERFORM 1000-INITIALIZATION.                                 03320001
                                                                        03330001
           PERFORM 2000-PROCESS-RECORDS.                                03340001
                                                                        03350001
           PERFORM 9000-WRAPUP.                                         03360001
                                                                        03370001
           GOBACK.                                                      03380001
                                                                        03390001
                                                                        03400001
      *----------------------------------------------------------       03410001
      * 1000-INITIALIZATION.                                            03420001
      *     INITIALIZATION AREA -                                       03430001
      *               INITIALIZES PROGRAM COUNTERS                      03440001
      *               READS CONTROL CARDS                               03450001
      *               CONNECT TO QUEUE                                  03460001
      *               OPEN QUEUE                                        03470001
      *----------------------------------------------------------       03480001
       1000-INITIALIZATION.                                             03490001
                                                                        03500001
                                                                        03510001
           INITIALIZE PC-PROGRAM-COUNTERS.                              03520001
      *** SET UP TIMESTAMP    INFORMATION FOR HEADER                    03521006
                                                                        03522006
           ACCEPT PV-RUN-TIME FROM TIME.                                03523006
           ACCEPT PV-DATE-IN  FROM DATE YYYYMMDD.                       03524006
           MOVE DATE-IN-CC           TO PV-HEADER-CC.                   03525006
                                                                        03526006
           MOVE DATE-IN-YY           TO PV-HEADER-YY.                   03527006
                                                                        03528006
           MOVE DATE-IN-MM           TO PV-HEADER-MO.                   03529006
                                                                        03529106
           MOVE DATE-IN-DD           TO PV-HEADER-DD.                   03529206
                                                                        03529306
           MOVE R-HR                 TO PV-HEADER-HH.                   03529406
                                                                        03529506
           MOVE R-MIN                TO PV-HEADER-MM.                   03529606
                                                                        03529706
           MOVE R-SEC                TO PV-HEADER-SS.                   03529806
                                                                        03530001
           OPEN INPUT  CC-QUEUE-MGR-CONNECT                             03540001
                       CC-QUEUE-MGR                                     03550003
                OUTPUT MNFST-STAT.                                      03570014
                                                                        03580001
           PERFORM 1010-READ-CC-Q-MGR-CONN.                             03590001
           PERFORM 1020-READ-CC-Q-MGR.                                  03600003
           MOVE +0 TO PC-SQL-CARD-COUNT.                                03630001
                                                                        03640001
           IF  CC-QUEUE-MANAGER-NAME    =  SPACES                       03650001
            OR CC-QUEUE-NAME            =  SPACES                       03660001
               DISPLAY 'EMPTY CONTROL CARD'                             03680001
               DISPLAY 'QUEUE MANAGER NAME: ' CC-QUEUE-MANAGER-NAME     03690001
               DISPLAY 'QUEUE NAME: ' CC-QUEUE-NAME                     03700001
               MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME          03720001
               MOVE 'CONTROL CARD IS EMPTY' TO PV-OPERATION-MSG-1       03730001
               SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   03740001
               PERFORM 9300-ABEND                                       03750001
           END-IF.                                                      03760001
                                                                        03770001
           PERFORM 1100-CONNECT-TO-QMGR.                                03780001
           PERFORM 1300-OPEN-QUEUE.                                     03800001
                                                                        03810001
                                                                        03820001
                                                                        03830001
                                                                        03840001
      *----------------------------------------------------------       03850001
      * 1010-READ-CC-Q-MGR-CONN.                                        03860001
      *     READ CONTROL CARD TO GET THE QUEUE MANAGER NAME.            03870001
      *----------------------------------------------------------       03880001
       1010-READ-CC-Q-MGR-CONN.                                         03890001
                                                                        03900001
           READ CC-QUEUE-MGR-CONNECT INTO CC-CONTROL-CARD-1-LAYOUT.     03910001
           DISPLAY 'QUEUE MANAGER NAME: ' CC-QUEUE-MANAGER-NAME.        03920001
                                                                        03930001
                                                                        03940001
      *----------------------------------------------------------       03950001
      * 1020-READ-CC-Q-MGR.                                             03960003
      *     READS CONTROL CARD TO GET THE BUSINESS EVENT QUEUE          03970001
      *     NAME.                                                       03980001
      *----------------------------------------------------------       03990001
       1020-READ-CC-Q-MGR.                                              04000003
                                                                        04010001
           READ CC-QUEUE-MGR INTO CC-CONTROL-CARD-2-LAYOUT.             04020003
                                                                        04030001
                                                                        04040001
      *----------------------------------------------------------       04050001
      * 1100-CONNECT-TO-QMGR.                                           04060001
      *     CONNECT TO THE QUEUE MANAGER.                               04070001
      *----------------------------------------------------------       04080001
       1100-CONNECT-TO-QMGR.                                            04090001
                                                                        04100001
           CALL MQV-MQCONN USING CC-QUEUE-MANAGER-NAME                  04110001
                                 MQV-HCONN                              04120001
                                 MQV-COMPLETION-CODE                    04130001
                                 MQV-REASON.                            04140001
                                                                        04150001
           EVALUATE TRUE                                                04160001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        04170001
                   DISPLAY ' '                                          04180001
                   DISPLAY 'SUCCESSFULLY CONNECTED TO: '                04190001
                                                  CC-QUEUE-MANAGER-NAME 04200001
              WHEN OTHER                                                04210001
                   CALL MQV-MQCHECK USING MQV-REASON                    04220001
                                          MQV-REASON-TEXT               04230001
                   DISPLAY 'QUEUE CONNECTING TO ' CC-QUEUE-MANAGER-NAME 04240001
                   MOVE '1100-CONNECT-TO-QMGR' TO PV-PARAGRAPH-NAME     04250001
                   MOVE 'UNABLE TO CONNECT'  TO PV-OPERATION-MSG-1      04260001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    04270001
                   MOVE MQV-REASON             TO PV-REASON             04280001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        04290001
                   PERFORM 9400-MQ-ABEND                                04300001
           END-EVALUATE.                                                04310001
                                                                        04320001
                                                                        04330001
      *----------------------------------------------------------       04340001
      * 1300-OPEN-QUEUE.                                                04350001
      *     OPEN THE QUEUE.                                             04360001
      *----------------------------------------------------------       04370001
       1300-OPEN-QUEUE.                                                 04380001
                                                                        04390001
           MOVE CC-QUEUE-NAME                TO MQOD-OBJECTNAME         04400001
           MOVE CC-QUEUE-MANAGER-NAME        TO MQOD-OBJECTQMGRNAME.    04410001
                                                                        04420001
           COMPUTE MQV-OPEN-OPTIONS      = MQOO-INPUT-SHARED            04430001
                                         + MQOO-SAVE-ALL-CONTEXT        04440001
TEST  * TO TEST WITH NO DELETE FROM QUE USE FOLLOWING PARM              04440112
TEST                                     + MQOO-BROWSE                  04441011
TEST  *                                                                 04442012
                                         + MQOO-FAIL-IF-QUIESCING.      04450001
                                                                        04460001
           CALL MQV-MQOPEN USING MQV-HCONN                              04470001
                                 MQM-OBJECT-DESCRIPTOR                  04480001
                                 MQV-OPEN-OPTIONS                       04490001
                                 MQV-ERROR-HANDLE                       04500001
                                 MQV-COMPLETION-CODE                    04510001
                                 MQV-REASON.                            04520001
                                                                        04530001
           EVALUATE TRUE                                                04540001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        04550001
                   DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                04560001
                                                CC-QUEUE-NAME           04570001
              WHEN OTHER                                                04580001
                   CALL MQV-MQCHECK USING MQV-REASON                    04590001
                                          MQV-REASON-TEXT               04600001
                   MOVE '1300-OPEN-QUEUE' TO PV-PARAGRAPH-NAME          04610001
                   MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      04620001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    04630001
                   MOVE MQV-REASON             TO PV-REASON             04640001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        04650001
                   PERFORM 9200-DISCONNECT-QMGR                         04660001
                   PERFORM 9400-MQ-ABEND                                04670001
           END-EVALUATE.                                                04680001
                                                                        04690001
                                                                        04700001
                                                                        04710001
      *----------------------------------------------------------       04720001
      * 2000-PROCESS-RECORDS.                                           04730001
      *----------------------------------------------------------       04740001
       2000-PROCESS-RECORDS.                                            04750001
                                                                        04760001
      *                                                                 05021208
      * READ MESSAGES FROM QUEUE                                        05021308
      *                                                                 05021408
      *** PROCESS STATUS RECORDS FROM MQ                                05021508
           MOVE +1 TO PC-SQL-CARD-RETRIEVE-COUNT.                       05022008
           PERFORM 4000-RETRIEVE-MESSAGE-QUEUE.                         05023008
           PERFORM UNTIL PS-PROCESS-QUEUE-COMPLETE                      05024008
             PERFORM 6000-WRITE-MNFST-STAT                              05025014
             PERFORM 4000-RETRIEVE-MESSAGE-QUEUE                        05029308
           END-PERFORM.                                                 05029408
                                                                        05029508
                                                                        07310001
      *----------------------------------------------------------       07320001
      * 4000-RETRIEVE-MESSAGE-QUEUE.                                    07330001
      *     RETRIEVES THE NEXT MESSAGE FROM THE QUEUE.                  07340001
      *----------------------------------------------------------       07350001
       4000-RETRIEVE-MESSAGE-QUEUE.                                     07360001
                                                                        07370001
           INITIALIZE MQV-MSGBUFFER.                                    07380004
                                                                        07390001
           MOVE +60                  TO MQV-MSG-LENGTH.                 07400004
                                                                        07410001
           MOVE MQMI-NONE            TO MQMD-MSGID.                     07420001
           MOVE MQCI-NONE            TO MQMD-CORRELID                   07430001
                                        PV-NULL-VALUE.                  07440001
                                                                        07450001
                                                                        07510001
           MOVE CC-QUEUE-NAME        TO MQOD-OBJECTNAME.                07520001
           MOVE MQFMT-STRING         TO MQMD-FORMAT.                    07530001
                                                                        07550001
TEST  *    COMPUTE MQGMO-OPTIONS  =                                     07560015
TEST  * TO TEST WITH NO DELETE FROM QUE USE FOLLOWING PARMS             07561012
TEST  *                              MQGMO-BROWSE-NEXT +                07561115
TEST  *                              MQGMO-CONVERT   +                  07570015
TEST  *                              MQGMO-ACCEPT-TRUNCATED-MSG.        07580015
TEST  * OTHERWISE USE PARMS BELOW(PRODUCTION CONFIGUATION)              07580112
TEST       COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  07581015
TEST                                 MQGMO-CONVERT   +                  07582015
TEST                                 MQGMO-ACCEPT-TRUNCATED-MSG.        07583015
      *                              MQGMO-WAIT.                        07590015
                                                                        07600001
           CALL MQV-MQGET USING MQV-HCONN                               07610011
                                MQV-ERROR-HANDLE                        07620001
                                MQM-MESSAGE-DESCRIPTOR                  07630001
                                MQM-GET-MESSAGE-OPTIONS                 07640001
                                MQV-MSG-LENGTH                          07650001
                                MQV-MSGBUFFER                           07660004
                                MQV-DATA-LENGTH                         07670001
                                MQV-COMPLETION-CODE                     07680001
                                MQV-REASON.                             07690001
                                                                        07700001
           IF  MQV-COMPLETION-CODE = MQCC-OK                            07710001
               ADD +1             TO PC-MESSAGE-FROM-QUEUE              07720001
               MOVE MQV-MSGBUFFER TO SU102-EXTRACT-RECORD               07730004
           ELSE                                                         07750001
               EVALUATE TRUE                                            07760001
                  WHEN MQV-REASON = MQRC-Q-MGR-QUIESCING                07770001
                  WHEN MQV-REASON = MQRC-Q-MGR-STOPPING                 07780001
                       CONTINUE                                         07790001
                  WHEN MQV-REASON = MQRC-NO-MSG-AVAILABLE               07800001
                          SET PS-PROCESS-QUEUE-COMPLETE     TO TRUE     07811007
      *                   PERFORM 9150-CLOSE-QUEUE                      07820001
      *                   PERFORM 1300-OPEN-QUEUE                       07830001
                  WHEN OTHER                                            07840001
                       CALL MQV-MQCHECK USING MQV-REASON                07850001
                                              MQV-REASON-TEXT           07860001
                       MOVE '4000-RETRIEVE-MESSAGE' TO PV-PARAGRAPH-NAME07870001
                       MOVE 'ERROR RETRIEVING MESSAGE'                  07880001
                                             TO PV-OPERATION-MSG-1      07890001
                       MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE07900001
                       MOVE MQV-REASON             TO PV-REASON         07910001
                       MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT    07920001
                       PERFORM 4100-BACK-OUT-MQV-CHANGES                07930001
                       PERFORM 9200-DISCONNECT-QMGR                     07940001
                       PERFORM 9400-MQ-ABEND                            07950001
               END-EVALUATE                                             07960001
           END-IF.                                                      07970001
      *                                                                 08060001
                                                                        08070001
      *----------------------------------------------------------       08080001
      * 4100-BACK-OUT-MQV-CHANGES.                                      08090001
      *     ROLLBACK MQ CHANGES.                                        08100001
      *----------------------------------------------------------       08110001
       4100-BACK-OUT-MQV-CHANGES.                                       08120001
                                                                        08130001
           CALL MQV-MQBACK USING MQV-HCONN                              08140001
                                 MQV-COMPLETION-CODE                    08150001
                                 MQV-REASON.                            08160001
                                                                        08170001
           EVALUATE TRUE                                                08180001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        08190001
                   CONTINUE                                             08200001
              WHEN OTHER                                                08210001
                   CALL MQV-MQCHECK USING MQV-REASON                    08220001
                                          MQV-REASON-TEXT               08230001
                   MOVE '4100-BACK-OUT-MQV-CHANGES' TO PV-PARAGRAPH-NAME08240001
                   MOVE 'MQBACK ERROR'  TO PV-OPERATION-MSG-1           08250001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    08260001
                   MOVE MQV-REASON             TO PV-REASON             08270001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        08280001
                   PERFORM 9200-DISCONNECT-QMGR                         08290001
                   PERFORM 9400-MQ-ABEND                                08300001
           END-EVALUATE.                                                08310001
                                                                        08320001
                                                                        08330001
                                                                        08340001
      *----------------------------------------------------------       08440001
      * 5500-COMMIT-MESSAGE.                                            08450001
      *     REMOVES THE MESSAGE FROM THE QUEUE.                         08460001
      *----------------------------------------------------------       08470001
       5500-COMMIT-MESSAGE.                                             08480001
                                                                        08490001
           CALL MQV-MQCMIT USING MQV-HCONN                              08500001
                                 MQV-COMPLETION-CODE                    08510001
                                 MQV-REASON.                            08520001
                                                                        08530001
           EVALUATE TRUE                                                08540001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        08550001
                   CONTINUE                                             08560001
              WHEN OTHER                                                08570001
                   CALL MQV-MQCHECK USING MQV-REASON                    08580001
                                          MQV-REASON-TEXT               08590001
                   MOVE '5500-COMMIT-MESSAGE'  TO PV-PARAGRAPH-NAME     08600001
                   MOVE 'ERROR COMMITING DATA' TO PV-OPERATION-MSG-1    08610001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    08620001
                   MOVE MQV-REASON             TO PV-REASON             08630001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        08640001
                   PERFORM 4100-BACK-OUT-MQV-CHANGES                    08650001
                   PERFORM 9200-DISCONNECT-QMGR                         08660001
                   PERFORM 9400-MQ-ABEND                                08670001
           END-EVALUATE.                                                08680001
                                                                        08690001
                                                                        08700001
      *----------------------------------------------------------       08710001
      * 6000-WRITE-MNFST-STAT.                                          08720014
      *     WRITES THE MESSAGE TO OUTPUT FILE.                          08730014
      *----------------------------------------------------------       08740001
       6000-WRITE-MNFST-STAT.                                           08750014
                                                                        08760001
           WRITE MNFST-STAT-RECORD FROM SU102-EXTRACT-RECORD.           08770014
                                                                        08780001
           ADD +1 TO PC-MESSAGE-WRITTEN-TO-FILE.                        08790001
                                                                        08800001
                                                                        08810001
                                                                        08820001
      *----------------------------------------------------------       08830001
      * 9000-WRAPUP.                                                    08840001
      *     END OF PROGRAM ROUTINE.  CLOSES ALL QUEUES, DISCONNECTS     08850001
      *     FROM THE QUEUE MANAGER, CLOSES ALL FILES, AND               08860001
      *     DISPLAYS ALL DATA.                                          08870001
      *----------------------------------------------------------       08880001
       9000-WRAPUP.                                                     08890001
                                                                        08900001
           PERFORM 9150-CLOSE-QUEUE.                                    08910001
      *    PERFORM 5500-COMMIT-MESSAGE.                                 08911006
           PERFORM 9200-DISCONNECT-QMGR.                                08920001
                                                                        08930001
           CLOSE CC-QUEUE-MGR-CONNECT                                   08940001
                 CC-QUEUE-MGR                                           08950004
                 MNFST-STAT.                                            08970014
                                                                        08980001
           DISPLAY ' '.                                                 08990001
           DISPLAY '*********************************************'.     09000001
           DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            09010001
           DISPLAY '*********************************************'.     09020001
           DISPLAY 'MESSAGES READ FROM QUEUE: '                         09081008
                           PC-MESSAGE-FROM-QUEUE.                       09082008
           DISPLAY '*********************************************'.     09083008
           DISPLAY 'MESSAGES WRITTEN TO FORMATTED FILE: '               09090008
                           PC-MESSAGE-WRITTEN-TO-FILE.                  09100001
           DISPLAY '*********************************************'.     09110001
                                                                        09150001
                                                                        09160001
      *----------------------------------------------------------       09170001
      * 9150-CLOSE-QUEUE.                                               09180001
      *     CLOSE QUEUE.                                                09190001
      *----------------------------------------------------------       09200001
       9150-CLOSE-QUEUE.                                                09210001
                                                                        09220001
                                                                        09230001
           CALL MQV-MQCLOSE USING MQV-HCONN                             09240001
                                  MQV-ERROR-HANDLE                      09250001
                                  MQCO-NONE                             09260001
                                  MQV-COMPLETION-CODE                   09270001
                                  MQV-REASON.                           09280001
                                                                        09290001
           EVALUATE TRUE                                                09300001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        09310001
                   CONTINUE                                             09320001
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                09330001
                   CALL MQV-MQCHECK USING MQV-REASON                    09340001
                                          MQV-REASON-TEXT               09350001
                   MOVE '9150-CLOSE-QUEUE'                              09360001
                                            TO PV-PARAGRAPH-NAME        09370001
                   MOVE 'CANNOT CLOSE QUEUE'   TO PV-OPERATION-MSG-1    09380001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    09390001
                   MOVE MQV-REASON             TO PV-REASON             09400001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        09410001
                   PERFORM 9400-MQ-ABEND                                09420001
           END-EVALUATE.                                                09430001
                                                                        09440001
                                                                        09450001
      *----------------------------------------------------------       09460001
      * 9200-DISCONNECT-QMGR.                                           09470001
      *     DISCONNECT FROM THE QUEUE MANAGER.                          09480001
      *----------------------------------------------------------       09490001
       9200-DISCONNECT-QMGR.                                            09500001
                                                                        09510001
           CALL MQV-MQDISC USING MQV-HCONN                              09520001
                                 MQV-COMPLETION-CODE                    09530001
                                 MQV-REASON.                            09540001
                                                                        09550001
           EVALUATE TRUE                                                09560001
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        09570001
                   CONTINUE                                             09580001
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                09590001
                   CALL MQV-MQCHECK USING MQV-REASON                    09600001
                                          MQV-REASON-TEXT               09610001
                   MOVE '9200-DISCONNECT-QMGR' TO PV-PARAGRAPH-NAME     09620001
                   MOVE 'MQDISC ERROR'         TO PV-OPERATION-MSG-1    09630001
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    09640001
                   MOVE MQV-REASON             TO PV-REASON             09650001
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        09660001
                   PERFORM 9400-MQ-ABEND                                09670001
           END-EVALUATE.                                                09680001
                                                                        09690001
                                                                        09700001
      *---------------------------------------------------------        09710001
      * 9300-ABEND.                                                     09720001
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  09730001
      *---------------------------------------------------------        09740001
       9300-ABEND.                                                      09750001
                                                                        09760001
           DISPLAY '** ABEND           **'.                             09770001
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  09780001
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        09790001
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       09800001
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       09810001
           CALL 'ILBOABN0' USING ABEND-CODE.                            09820001
                                                                        09830001
                                                                        09840001
      *----------------------------------------------------------       09850001
      * 9400-MQ-ABEND.                                                  09860001
      *     MQ ABEND ROUTINE.                                           09870001
      *----------------------------------------------------------       09880001
       9400-MQ-ABEND.                                                   09890001
                                                                        09900001
           SET ABEND-4020-MQ-ERROR TO TRUE.                             09910001
           DISPLAY '**** ABEND *************************************'.  09920001
           DISPLAY '** MQSERIES ERROR **'.                              09930001
           DISPLAY '** PROGRAM:    ' PC-CURRENT-PROGRAM-NAME.           09940001
           DISPLAY '** ABEND CODE: ' ABEND-CODE.                        09950001
           DISPLAY '** PARAGRAPH:  ' PV-PARAGRAPH-NAME.                 09960001
           DISPLAY '** MESSAGE:    ' PV-OPERATION-MSG-1.                09970001
           DISPLAY '** COMP CODE:  ' PV-COMPLETION-CODE.                09980001
           DISPLAY '** RSN CODE:   ' PV-REASON.                         09990001
           DISPLAY '** RSN TEXT:   ' PV-REASON-TEXT.                    10000001
           DISPLAY '************************************************'.  10010001
           CALL 'ILBOABN0' USING ABEND-CODE.                            10020001
                                                                        10030001
                                                                        10040001
                                                                        10050001
