000100*-----------------------*                                         00010050
000200 IDENTIFICATION DIVISION.                                         00020051
000300*-----------------------*                                         00030051
000400 PROGRAM-ID.    RVKCS105.                                         00040051
000500 AUTHOR.        NATALIYA PALATHIK.                                00050051
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060051
000700 DATE-WRITTEN.  12-14-92.                                         00070051
000800 DATE-COMPILED.                                                   00080051
000900                                                                  00090051
001000*---------------------------------------------------------------* 00100051
001100*    T105 - REQUEST RA DETAIL INQUIRY LIST.                     * 00110051
001200*                                                               * 00120051
001300*    THIS PROGRAM GENERATES THE REQUEST FOR RETURN AUTHORIZATION* 00130051
001400*    DETAIL LIST                                                * 00140051
001500*---------------------------------------------------------------* 00150051
001600*    04/11/03 - LAXMAN BOLINENI, IGSI   -  WR NO. 23022         * 00160051
001700*             - IN MAP RVKM105, SKU CONTAINS DEPT, CLASS AND    * 00170051
001800*               SEQUENCE NUMBER WAS REPLACED WITH DEPT AND UPC  * 00180051
001900*               NUMBER AND STYLE FIELD WAS REMOVED.             * 00190051
002000*             - ALL THE REFERENCES OF SKU NUMBER CONSISTING OF  * 00200051
002100*               3-DIGIT DEPARTMENT NUMBER, 2-DIGIT CLASS AND    * 00210051
002200*               3-DIGIT SEQUENCE ARE REPLACED WITH 3-DIGIT      * 00220051
002300*               DEPARTMENT NUMBER AND 15-DIGIT UPC NUMBER.      * 00230051
002400*             - ALL THE REFERENCES OF STYLE ARE DELETED.        * 00240051
002500*             - ALL THE REFERENCES OF 7-CHARACTER STATUS ARE    * 00250051
002600*               REDUCED TO 1-CHARACTER.                         * 00260051
002700*             - COPYBOOK TSK IS REPLACED WITH XLT00003,XLT00004 * 00270051
002800*               AND XLT00006 COPYBOOKS.                         * 00280051
002900*             - ALL THE REFERENCES OF TSK TABLE ARE REPLACED    * 00290051
003000*               WITH XLT_SKU, XLT_VND_STYL AND XLT_UPC TABLES.  * 00300051
003100*---------------------------------------------------------------* 00310051
003101* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00310151
003102* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00310251
003103* MAKING THE CALL DYNAMIC VS STATIC.                              00310351
003104*---------------------------------------------------------------* 00310451
003105                                                                  00310551
003106 ENVIRONMENT DIVISION.                                            00310651
003107                                                                  00310751
003108 DATA DIVISION.                                                   00310851
003109                                                                  00310951
003110 WORKING-STORAGE SECTION.                                         00311051
003120                                                                  00312051
003130 01  PC-PROGRAM-CONSTANTS.                                        00313051
003140     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00314051
003150     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC  S9(4)   VALUE +4072  00315051
003160                                                     COMP SYNC.   00316051
003170     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00317051
003180     'RV105A  '.                                                  00318051
003190     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00319051
003200     'RVKM105 '.                                                  00320051
003300     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00330051
003400     'RVKCS105'.                                                  00340051
003500     05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +11    00350051
003600                                                     COMP SYNC.   00360051
003700     05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +11    00370051
003800                                                     COMP SYNC.   00380051
003900     05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100   00390051
004000                                                     COMP SYNC.   00400051
004100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2     00410051
004200                                                     COMP SYNC.   00420051
004300     05  PC-MAX-ITEMS                   PIC S9(09)   VALUE        00430051
004400                                                     +1000000     00440051
004500                                                     COMP-3.      00450051
004600     05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314  00460051
004700                                                     COMP SYNC.   00470051
004800     05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5     00480051
004900                                                     COMP SYNC.   00490051
005000     05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128   00500051
005100                                                     COMP SYNC.   00510051
005200     05  FILLER REDEFINES PC-ERASE-EOF-COMP.                      00520051
005300         10  FILLER                     PIC X(01).                00530051
005400         10  PC-ERASE-EOF               PIC X(01).                00540051
005500     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00550051
005600                                                     COMP-3.      00560051
005700*                                                                 00570051
005800 01  PC-TSYMSG-NUMBERS.                                           00580051
005900     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00590051
006000     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  00600051
006100     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00610051
006200     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00620051
006300     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00630051
006400     05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.  00640051
006500*                                                                 00650051
006600 01  PM-PROGRAM-MESSAGES.                                         00660051
006700     05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE        00670051
006800     'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.       00680051
006900     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                   00690051
007000         10  FILLER                     PIC X(51).                00700051
007100         10  PM-RESP-9                  PIC Z(03)9-.              00710051
007200         10  FILLER                     PIC X(22).                00720051
007300     05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE        00730051
007400     'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.       00740051
007500     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                  00750051
007600         10  FILLER                     PIC X(51).                00760051
007700         10  PM-RESP-10                 PIC Z(03)9-.              00770051
007800         10  FILLER                     PIC X(22).                00780051
007900     05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE        00790051
008000     'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK00800051
008100-    '     '.                                                     00810051
008200     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                  00820051
008300         10  FILLER                     PIC X(61).                00830051
008400         10  PM-BLOCK-NUMBER            PIC Z(03)9-.              00840051
008500         10  FILLER                     PIC X(12).                00850051
008600     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE        00860051
008700     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                00870051
008800     05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE        00880051
008900     'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.         00890051
009000     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                  00900051
009100         10  FILLER                     PIC X(49).                00910051
009200         10  PM-RESP-23                 PIC Z(03)9-.              00920051
009300         10  FILLER                     PIC X(24).                00930051
009400     05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE        00940051
009500     'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.      00950051
009600     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                  00960051
009700         10  FILLER                     PIC X(52).                00970051
009800         10  PM-RESP-24                 PIC Z(03)9-.              00980051
009900         10  FILLER                     PIC X(21).                00990051
010000     05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE        01000051
010100     'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                 01010051
010200*                                                                 01020051
010300 01  PS-PROGRAM-SUBSCRIPTS.                                       01030051
010400     05  PS-SUB                         PIC S9(04)   VALUE +0     01040051
010500                                                     COMP SYNC.   01050051
010600     05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0     01060051
010700                                                     COMP-3.      01070051
010800                                                                  01080051
010900 01  PS-PROGRAM-SWITCHES.                                         01090051
011000     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   01100051
011100         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   01110051
011200         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   01120051
011300         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   01130051
011400         88  PS-SEND-DATA-ONLY                       VALUE '4'.   01140051
011500         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   01150051
011600         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   01160051
011700     05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.   01170051
011800         88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.   01180051
011900         88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.   01190051
012000     05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.   01200051
012100         88  PS-CURSOR-POSITIONED                    VALUE 'Y'.   01210051
012200         88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.   01220051
012300     05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.   01230051
012400         88  PS-VALID-SELECTIONS                     VALUE 'Y'.   01240051
012500         88  PS-INVALID-SELECTIONS                   VALUE 'N'.   01250051
012600     05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.   01260051
012700         88  PS-VALID-BEG-ITEM                       VALUE 'Y'.   01270051
012800         88  PS-INVALID-BEG-ITEM                     VALUE 'N'.   01280051
012900     05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.   01290051
013000         88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.   01300051
013100         88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.   01310051
013200     05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.   01320051
013300         88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.   01330051
013400         88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.   01340051
013500     05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.   01350051
013600         88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.   01360051
013700         88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.   01370051
013800     05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.   01380051
013900         88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.   01390051
014000         88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.   01400051
014100     05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.   01410051
014200         88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.   01420051
014300         88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.   01430051
014400     05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.   01440051
014500         88  PS-INFORMATIONAL                        VALUE 'Y'.   01450051
014600         88  PS-NO-INFORMATIONAL                     VALUE 'N'.   01460051
014700     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.   01470051
014800         88  PS-CONTINUE                             VALUE 'Y'.   01480051
014900         88  PS-DONT-PROCESS                         VALUE 'N'.   01490051
015000     05  PS-LIST-ITEMS-SW               PIC X(01)    VALUE 'N'.   01500051
015100         88  PS-LIST-ITEMS-FOUND                     VALUE 'Y'.   01510051
015200         88  PS-NO-LIST-ITEMS-FOUND                  VALUE 'N'.   01520051
015300     EJECT                                                        01530051
015400 01  PV-PROGRAM-VARIABLES.                                        01540051
015500     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     01550051
015600                                                     COMP SYNC.   01560051
015700     05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0     01570051
015800                                                     COMP-3.      01580051
015900     05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0     01590051
016000                                                     COMP-3.      01600051
016100     05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0     01610051
016200                                                     COMP-3.      01620051
016300     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01630051
016400                                                     COMP-3.      01640051
016500     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01650051
016600                                                     COMP-3.      01660051
016700     05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0     01670051
016800                                                     COMP-3.      01680051
016900     05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0     01690051
017000                                                     COMP-3.      01700051
017100     05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0     01710051
017200                                                     COMP-3.      01720051
017300     05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0     01730051
017400                                                     COMP-3.      01740051
017500     05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0     01750051
017600                                                     COMP-3.      01760051
017700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0     01770051
017800                                                     COMP-3.      01780051
017900     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01790051
018000                                                     COMP SYNC.   01800051
018100     05  PV-RESP                        PIC S9(04)   VALUE +0     01810051
018200                                                     COMP SYNC.   01820051
018300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01830051
018400                                                     COMP SYNC.   01840051
018500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01850051
018600                                                     COMP SYNC.   01860051
018700     05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0     01870051
018800                                                     COMP SYNC.   01880051
018900     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.01890051
019000     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01900051
019100     05  PV-BEGITMI.                                              01910051
019200         10  PV-BEGITMI-N               PIC 9(7).                 01920051
019300     05  PV-DISPLAY-S9                  PIC 999999999.            01930051
019400 EJECT                                                            01940051
019500*---------------------------------------------------------------* 01950051
019600*    STANDARD COMMAREA.                                         * 01960051
019700*---------------------------------------------------------------* 01970051
019800                                                                  01980051
019900     COPY DPWS020.                                                01990051
020000     05  RV105-FILLER  REDEFINES  DP020-VARIABLE-COMMAREA.        02000051
020100                                                                  02010051
020200*---------------------------------------------------------------* 02020051
020300*    INTER-APPLICATION COMMAREA.                                * 02030051
020400*---------------------------------------------------------------* 02040051
020500                                                                  02050051
020600         10  INTER-APPL-COMM-AREA       PIC X(200).               02060051
020700     COPY RVWS100.                                                02070051
020800*---------------------------------------------------------------* 02080051
020900*    SPECIFIC COMMMAREA FOR RVKCS105.                           * 02090051
021000*---------------------------------------------------------------* 02100051
021100         10  RV105-SPECIFIC-COMMAREA.                             02110051
021200             15  RV105-APPL-CURSOR-POSITION          PIC S9(04)   02120051
021300                                                     COMP.        02130051
021400                                                                  02140051
021500             15  RV105-BLOCK-ENTRIES OCCURS 2 TIMES.              02150051
021600                 20  RV105-BLOCK-MODIFIED-SW         PIC X(01).   02160051
021700                     88  RV105-BLOCK-NOT-MODIFIED    VALUE 'N'.   02170051
021800                     88  RV105-BLOCK-MODIFIED        VALUE 'Y'.   02180051
021900                                                                  02190051
022000                 20  RV105-ITEM-ARRAY.                            02200051
022100                     25  RV105-ITEM-ENTRIES OCCURS 11 TIMES.      02210051
022200                         30  RV105-LIST-ITEM-NUMBER               02220051
022300                                                     PIC S9(09)   02230051
022400                                                         COMP-3.  02240051
022500                         30  RV105-STATUS            PIC X(1).    02250051
022600                         30  RV105-AUTH              PIC 9(11).   02260051
022700                         30  RV105-DEPT              PIC X(03).   02270051
022800                         30  RV105-UPCX              PIC X(15).   02280051
022900                         30  RV105-UPC   REDEFINES  RV105-UPCX    02290051
023000                                                     PIC 9(15).   02300051
023100                         30  RV105-DESC              PIC X(20).   02310051
023200                         30  RV105-UCOST             PIC S9(6)V99 02320051
023300                                                         COMP-3.  02330051
023400                         30  RV105-URETAIL           PIC S9(6)V99 02340051
023500                                                         COMP-3.  02350051
023600                         30  RV105-URETAIL-CHG-SW    PIC X.       02360051
023700                             88  RV105-URETAIL-CHG     VALUE 'C'. 02370051
023800                             88  RV105-URETAIL-RESET   VALUE ' '. 02380051
023900                         30  RV105-SEQ-NUMBER        PIC S9(5)    02390051
024000                                                         COMP-3.  02400051
024100                         30  FILLER                  PIC X(3).    02410051
024200                                                                  02420051
024300                                                                  02430051
024400             15  RV105-BLK-SUB                       PIC S9(04)   02440051
024500                                                         COMP     02450051
024600                                                         SYNC.    02460051
024700             15  RV105-ITEM-SUB                      PIC S9(04)   02470051
024800                                                         COMP     02480051
024900                                                         SYNC.    02490051
025000             15  RV105-NUMBER-OF-ITEMS-READ          PIC S9(09)   02500051
025100                                                         COMP-3.  02510051
025200             15  RV105-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)   02520051
025300                                                         COMP-3.  02530051
025400             15  RV105-ITEM-AT-TOP-OF-PANEL          PIC S9(09)   02540051
025500                                                         COMP-3.  02550051
025600             15  RV105-ITEM-AT-BOT-OF-PANEL          PIC S9(09)   02560051
025700                                                         COMP-3.  02570051
025800             15  RV105-HIGHEST-BLOCK-WRITTEN         PIC S9(04)   02580051
025900                                                         COMP     02590051
026000                                                         SYNC.    02600051
026100             15  RV105-START-OF-SELECTED-RANGE       PIC S9(09)   02610051
026200                                                         COMP-3.  02620051
026300             15  RV105-END-OF-SELECTED-RANGE         PIC S9(09)   02630051
026400                                                         COMP-3.  02640051
026500             15  RV105-ITEMS-LEFT-INDICATOR          PIC X.       02650051
026600                 88  RV105-ITEMS-LEFT-ON-DB            VALUE 'Y'. 02660051
026700                 88  RV105-NO-ITEMS-LEFT-ON-DB         VALUE 'N'. 02670051
026800             15  RV105-TEMP-QUEUE-UPDATE-SW          PIC X.       02680051
026900                 88  RV105-UPDATE-TSQ                  VALUE 'Y'. 02690051
027000                 88  RV105-NO-TSQ-UPDATE               VALUE 'N'. 02700051
027100             15  RV105-TEMP-QUEUE-NAME.                           02710051
027200                 20  RV105-TERM-ID                   PIC X(4).    02720051
027300                 20  RV105-TASK-NUMBER               PIC S9(7)    02730051
027400                                                         COMP-3.  02740051
027500             15  RV105-HOLD-TSQB-QUEUE-NAME          PIC X(8).    02750051
027600             15  RV105-TSQB-QUEUE-LENGTH             PIC S9(04)   02760051
027700                                                     COMP.        02770051
027800             15  RV105-INT-APPL-FORMAT-IND           PIC X.       02780051
027900                                                                  02790051
028000             15  RV105-DB2-CURRENT-DATE.                          02800051
028100                 20  RV105-DC-CC                     PIC XX.      02810051
028200                 20  RV105-DC-YY                     PIC XX.      02820051
028300                 20  FILLER                          PIC X.       02830051
028400                     88  RV105-DC-DASH1              VALUE '-'.   02840051
028500                 20  RV105-DC-MM                     PIC XX.      02850051
028600                 20  FILLER                          PIC X.       02860051
028700                     88  RV105-DC-DASH2              VALUE '-'.   02870051
028800                 20  RV105-DC-DD                     PIC XX.      02880051
028900             15  RV105-LAST-ITEM-NUMBER              PIC S9(15)   02890051
029000                                                     COMP-3.      02900051
029100                                                                  02910051
029200             15  RV105-HOLD-HEADER-INFO.                          02920051
029300                 20  RV105-ORDER-TYPE                PIC X(8).    02930051
029400                 20  RV105-ORDER-STATUS              PIC X(8).    02940051
029500                 20  RV105-VENDOR-DUNS-NBR           PIC X(9).    02950051
029600                 20  RV105-VENDOR-DESCRIPTION        PIC X(25).   02960051
029700                 20  RV105-TOTAL-COST                PIC S9(6)V99 02970051
029800                                                     COMP-3.      02980051
029900                 20  RV105-TOTAL-RETAIL              PIC S9(6)V99 02990051
030000                                                     COMP-3.      03000051
030100                                                                  03010051
030200             15  RV105-SAVE-APPL-COMMAREA            PIC X(200).  03020051
030300                                                                  03030051
030400     EJECT                                                        03040051
030500*---------------------------------------------------------------* 03050051
030600*    TSQ 'B' RECORD LAYOUT FOR PASSING INFORMATION.             * 03060051
030700*---------------------------------------------------------------* 03070051
030800                                                                  03080051
030900     COPY RVWS103.                                                03090051
031000                                                                  03100051
031100     EJECT                                                        03110051
031200*---------------------------------------------------------------* 03120051
031300*    ABEND PROCESSING COPYBOOK.                                 * 03130051
031400*---------------------------------------------------------------* 03140051
031500                                                                  03150051
031600     COPY DPWS013.                                                03160051
031700                                                                  03170051
031800     EJECT                                                        03180051
031900*---------------------------------------------------------------* 03190051
032000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03200051
032100*---------------------------------------------------------------* 03210051
032200                                                                  03220051
032300     COPY DPWS015.                                                03230051
032400                                                                  03240051
032500*---------------------------------------------------------------* 03250051
032600*    CURRENT DATE AND TIME COPYBOOK.                            * 03260051
032700*---------------------------------------------------------------* 03270051
032800                                                                  03280051
032900     COPY DPWS017.                                                03290051
033000                                                                  03300051
033100*---------------------------------------------------------------* 03310051
033200*    TOGGLE FUNCTION KEY LINES COPYBOOK.                        * 03320051
033300*---------------------------------------------------------------* 03330051
033400                                                                  03340051
033500     COPY DPWS009.                                                03350051
033600                                                                  03360051
033700*---------------------------------------------------------------* 03370051
033800*    MESSAGES  COPYBOOK                                         * 03380051
033900*---------------------------------------------------------------* 03390051
034000                                                                  03400051
034100     COPY DPWS006.                                                03410051
034200                                                                  03420051
034300*---------------------------------------------------------------* 03430051
034400*    FUNCTION KEYS COPYBOOK.                                    * 03440051
034500*---------------------------------------------------------------* 03450051
034600                                                                  03460051
034700     COPY DPWS016.                                                03470051
034800                                                                  03480051
034900*---------------------------------------------------------------* 03490051
035000*    DPKUT045 COPYBOOK.                                         * 03500051
035100*---------------------------------------------------------------* 03510051
035200                                                                  03520051
035300     COPY DPWS045.                                                03530051
035400                                                                  03540051
035500*---------------------------------------------------------------* 03550051
035600*    NUMERIC EDIT LAYOUT.                                       * 03560051
035700*---------------------------------------------------------------* 03570051
035800                                                                  03580051
035900     COPY DPWS010I.                                               03590051
036000                                                                  03600051
036100*---------------------------------------------------------------* 03610051
036200*    MESSAGE RECORD LAYOUT                                      * 03620051
036300*---------------------------------------------------------------* 03630051
036400                                                                  03640051
036500     COPY DPRD507I.                                               03650051
036600                                                                  03660051
036700*---------------------------------------------------------------* 03670051
036800*    STANDARD ATTENTION IDENTIFIER LIST                         * 03680051
036900*---------------------------------------------------------------* 03690051
037000                                                                  03700051
037100     COPY DFHAID.                                                 03710051
037200                                                                  03720051
037300*---------------------------------------------------------------* 03730051
037400*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST      * 03740051
037500*---------------------------------------------------------------* 03750051
037600                                                                  03760051
037700     COPY DFHBMSCA.                                               03770051
037800                                                                  03780051
037900*---------------------------------------------------------------* 03790051
038000*    MAP LAYOUT                                                 * 03800051
038100*---------------------------------------------------------------* 03810051
038200                                                                  03820051
038300     COPY RVKM105.                                                03830051
038400 01  MD-MAP-DATA-AREA  REDEFINES RV105AO PIC X(2000).             03840051
038500*                                                                 03850051
038600 01  RVKM105-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.          03860051
038700     05  FILLER                PIC X(254).                        03870060
038800     05  RVKM105-SCROLL-AREA OCCURS 11 TIMES.                     03880051
038900         10  FILLER            PIC X(5).                          03890051
039000         10  RVKM105-STATUS    PIC X(1).                          03900051
039100                                                                  03910051
039200         10  FILLER            PIC X(5).                          03920051
039300         10  RVKM105-AUTHX.                                       03930051
039400             15  RVKM105-AUTH                                     03940051
039500                               PIC 9(11).                         03950051
039600                                                                  03960051
039700         10  FILLER            PIC X(5).                          03970051
039800         10  RVKM105-DEPT      PIC X(3).                          03980051
039900                                                                  03990051
040000         10  FILLER            PIC X(5).                          04000051
040100         10  RVKM105-UPC       PIC X(15).                         04010051
040200                                                                  04020051
040300         10  FILLER            PIC X(5).                          04030051
040400         10  RVKM105-DESC      PIC X(20).                         04040051
040500                                                                  04050051
040600         10  FILLER            PIC X(5).                          04060051
040700         10  RVKM105-UCOSTX.                                      04070051
040800             15  RVKM105-UCOST PIC ZZ,ZZZ.99.                     04080051
040900                                                                  04090051
041000         10  FILLER            PIC X(5).                          04100051
041100         10  RVKM105-URETAILX.                                    04110051
041200             15  RVKM105-URETAIL                                  04120051
041300                               PIC ZZ,ZZZ.99.                     04130051
041400                                                                  04140051
041500                                                                  04150051
041600 EJECT                                                            04160051
041700*---------------------------------------------------------------* 04170051
041800*    DB2 AREA FOR RTV DEFECT ORDER TABLE                        * 04180051
041900*---------------------------------------------------------------* 04190051
042000     EXEC SQL                                                     04200051
042100          INCLUDE TDFCTOR                                         04210051
042200     END-EXEC.                                                    04220051
042300*---------------------------------------------------------------* 04230051
042400*    DB2 AREA FOR RTV DEFECT ORDER MERCHANDISE ITEM TABLE       * 04240051
042500*---------------------------------------------------------------* 04250051
042600     EXEC SQL                                                     04260051
042700          INCLUDE TDFMEIT                                         04270051
042800     END-EXEC.                                                    04280051
042900*---------------------------------------------------------------* 04290051
043000*    DB2 AREA FOR THE SKU TABLE                                 * 04300051
043100*---------------------------------------------------------------* 04310051
043200     EXEC SQL                                                     04320051
043300          INCLUDE XLT00003                                        04330051
043400     END-EXEC.                                                    04340051
043500*---------------------------------------------------------------* 04350051
043600*    DB2 AREA FOR THE VENDOR STYLE TABLE                        * 04360051
043700*---------------------------------------------------------------* 04370051
043800     EXEC SQL                                                     04380051
043900          INCLUDE XLT00004                                        04390051
044000     END-EXEC.                                                    04400051
044100*---------------------------------------------------------------* 04410051
044200*    DB2 AREA FOR THE UPC NUMBER TABLE                          * 04420051
044300*---------------------------------------------------------------* 04430051
044400     EXEC SQL                                                     04440051
044500          INCLUDE XLT00006                                        04450051
044600     END-EXEC.                                                    04460051
044700*---------------------------------------------------------------* 04470051
044800*    DB2 AREA FOR COMMUNICATIONS                                * 04480051
044900*---------------------------------------------------------------* 04490051
045000     EXEC SQL                                                     04500051
045100          INCLUDE SQLCA                                           04510051
045200     END-EXEC.                                                    04520051
045300                                                                  04530051
045400*---------------------------------------------------------------* 04540051
045500*    CURSOR FOR THE LIST.                                       * 04550051
045600*---------------------------------------------------------------* 04560051
045700* LOGIC :                                                         04570051
045800*   - GET THE INTERNAL UPC WITH EDI-ORD-IND = 'Y'                 04580051
045900*   - IF THERE IS NO INTERNAL UPC WITH EDI-ORD-IND = 'Y', GET THE 04590051
046000*     GREATEST INTERANL UPC WITH ED-ORD-IND = 'N'                 04600051
046100*   - IF THERE IS NO INTERNAL UPCS, GET THE VENDOR UPC WHICH      04610051
046200*     HAVE EDI-ORD-IND = 'Y'                                      04620051
046300*   - IF THERE IS NO INTERNAL UPCS PRESENT AND THERE IS NO VENDOR 04630051
046400*     UPCS WITH EDI-ORD-IND = 'Y' PRESENT, GET THE GREATEST VENDOR04640051
046500*     UPC WITH EDI-ORD-IND = 'N'                                  04650051
046600*   - IF ALL THESE CONDITIONS ARE NOT SATISFIED, IT MIGHT BE A    04660051
046700*     DUMMY SKU OR A DELETED SKU.  GET THE CORRESPONDING ROWS FROM04670051
046800*     TABLE.                                                      04680051
046900*---------------------------------------------------------------* 04690051
047000     EXEC SQL                                                     04700051
047100          DECLARE ITEM-NUMBER-CSR CURSOR                          04710051
047200* ALL NON ZERO ITEMS WITH MATCHING SKU RECORD                     04720051
047300          FOR SELECT                                              04730051
047400                I.DFCT_ITEM_NBR                                   04740051
047500              , I.SEQ_NBR                                         04750051
047600              , I.RTL_COST_AMT                                    04760051
047700              , I.UNIT_COST_AMT                                   04770051
047800              , I.MKOUT_ORD_ID                                    04780051
047900              , I.MKOUT_ORD_STAT_CDE                              04790051
048000              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    04800051
048100              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  04810051
048200              , S.SKU_NBR                                         04820051
048300              , U.UPC_NBR                                         04830051
048400              , S.SKU_DESC                                        04840051
048500          FROM                                                    04850051
048600                TDFMEIT I                                         04860051
048700             ,  XLT_SKU S                                         04870051
048800             ,  XLT_VND_STYL V                                    04880051
048900             ,  XLT_UPC U                                         04890051
049000          WHERE                                                   04900051
049100                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          04910051
049200            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    04920051
049300            AND S.STYL_ID          = V.STYL_ID                    04930051
049400            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                04940051
049500            AND I.DFCT_ITEM_NBR   µ= 0                            04950051
049600            AND UPC_TYP_CDE        = 'I'                          04960051
049700            AND EDI_ORD_IND        = 'Y'                          04970051
049800        UNION ALL                                                 04980051
049900          SELECT                                                  04990051
050000                I.DFCT_ITEM_NBR                                   05000051
050100              , I.SEQ_NBR                                         05010051
050200              , I.RTL_COST_AMT                                    05020051
050300              , I.UNIT_COST_AMT                                   05030051
050400              , I.MKOUT_ORD_ID                                    05040051
050500              , I.MKOUT_ORD_STAT_CDE                              05050051
050600              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    05060051
050700              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  05070051
050800              , S.SKU_NBR                                         05080051
050900              , U.UPC_NBR                                         05090051
051000              , S.SKU_DESC                                        05100051
051100          FROM                                                    05110051
051200                TDFMEIT I                                         05120051
051300              , XLT_SKU S                                         05130051
051400              , XLT_VND_STYL V                                    05140051
051500              , XLT_UPC U                                         05150051
051600          WHERE                                                   05160051
051700                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          05170051
051800            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    05180051
051900            AND I.DFCT_ITEM_NBR   µ= 0                            05190051
052000            AND S.STYL_ID          = V.STYL_ID                    05200051
052100            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                05210051
052200            AND UPC_TYP_CDE        = 'I'                          05220051
052300            AND EDI_ORD_IND        = 'N'                          05230051
052400            AND UPC_NBR            =                              05240051
052500                (SELECT MAX(U1.UPC_NBR)                           05250051
052600                   FROM XLT_UPC U1                                05260051
052700                  WHERE U.INTR_UPC_ID  = U1.INTR_UPC_ID           05270051
052800                    AND U1.UPC_TYP_CDE = 'I'                      05280051
052900                    AND U1.EDI_ORD_IND = 'N' )                    05290051
053000            AND NOT EXISTS                                        05300051
053100                (SELECT 1                                         05310051
053200                   FROM XLT_UPC U2                                05320051
053300                  WHERE U.INTR_UPC_ID   = U2.INTR_UPC_ID          05330051
053400                    AND U2.UPC_TYP_CDE    = 'I'                   05340051
053500                    AND U2.EDI_ORD_IND    = 'Y' )                 05350051
053600      UNION ALL                                                   05360051
053700          SELECT                                                  05370051
053800                I.DFCT_ITEM_NBR                                   05380051
053900              , I.SEQ_NBR                                         05390051
054000              , I.RTL_COST_AMT                                    05400051
054100              , I.UNIT_COST_AMT                                   05410051
054200              , I.MKOUT_ORD_ID                                    05420051
054300              , I.MKOUT_ORD_STAT_CDE                              05430051
054400              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    05440051
054500              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  05450051
054600              , S.SKU_NBR                                         05460051
054700              , U.UPC_NBR                                         05470051
054800              , S.SKU_DESC                                        05480051
054900          FROM                                                    05490051
055000                TDFMEIT I                                         05500051
055100              , XLT_SKU S                                         05510051
055200              , XLT_VND_STYL V                                    05520051
055300              , XLT_UPC U                                         05530051
055400          WHERE                                                   05540051
055500                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          05550051
055600            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    05560051
055700            AND I.DFCT_ITEM_NBR   µ= 0                            05570051
055800            AND S.STYL_ID          = V.STYL_ID                    05580051
055900            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                05590051
056000            AND UPC_TYP_CDE        = 'V'                          05600051
056100            AND EDI_ORD_IND        = 'Y'                          05610051
056200            AND NOT EXISTS                                        05620051
056300                (SELECT 1                                         05630051
056400                   FROM XLT_UPC U2                                05640051
056500                  WHERE U.INTR_UPC_ID   = U2.INTR_UPC_ID          05650051
056600                    AND U2.UPC_TYP_CDE    = 'I' )                 05660051
056700      UNION ALL                                                   05670051
056800          SELECT                                                  05680051
056900                I.DFCT_ITEM_NBR                                   05690051
057000              , I.SEQ_NBR                                         05700051
057100              , I.RTL_COST_AMT                                    05710051
057200              , I.UNIT_COST_AMT                                   05720051
057300              , I.MKOUT_ORD_ID                                    05730051
057400              , I.MKOUT_ORD_STAT_CDE                              05740051
057500              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    05750051
057600              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  05760051
057700              , S.SKU_NBR                                         05770051
057800              , U.UPC_NBR                                         05780051
057900              , S.SKU_DESC                                        05790051
058000          FROM                                                    05800051
058100                TDFMEIT I                                         05810051
058200              , XLT_SKU S                                         05820051
058300              , XLT_VND_STYL V                                    05830051
058400              , XLT_UPC U                                         05840051
058500          WHERE                                                   05850051
058600                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          05860051
058700            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    05870051
058800            AND I.DFCT_ITEM_NBR   µ= 0                            05880051
058900            AND S.STYL_ID          = V.STYL_ID                    05890051
059000            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                05900051
059100            AND UPC_TYP_CDE        = 'V'                          05910051
059200            AND EDI_ORD_IND        = 'N'                          05920051
059300            AND UPC_NBR =                                         05930051
059400                (SELECT MAX(UPC_NBR)                              05940051
059500                   FROM XLT_UPC U5                                05950051
059600                   WHERE U5.INTR_UPC_ID = U.INTR_UPC_ID           05960051
059700                     AND U5.UPC_TYP_CDE = 'V'                     05970051
059800                     AND U5.EDI_ORD_IND = 'N' )                   05980051
059900            AND NOT EXISTS                                        05990051
060000                 (SELECT 1                                        06000051
060100                    FROM XLT_UPC U6                               06010051
060200                   WHERE U.INTR_UPC_ID = U6.INTR_UPC_ID           06020051
060300                     AND UPC_TYP_CDE    = 'V'                     06030051
060400                     AND U6.EDI_ORD_IND = 'Y' )                   06040051
060500            AND NOT EXISTS                                        06050051
060600                 (SELECT 1                                        06060051
060700                    FROM XLT_UPC U4                               06070051
060800                   WHERE U.INTR_UPC_ID = U4.INTR_UPC_ID           06080051
060900                     AND UPC_TYP_CDE   = 'I' )                    06090051
061000     UNION ALL                                                    06100051
061100* ALL ZERO ITEMS                                                  06110051
061200          SELECT                                                  06120051
061300                I.DFCT_ITEM_NBR                                   06130051
061400              , I.SEQ_NBR                                         06140051
061500              , I.RTL_COST_AMT                                    06150051
061600              , I.UNIT_COST_AMT                                   06160051
061700              , I.MKOUT_ORD_ID                                    06170051
061800              , I.MKOUT_ORD_STAT_CDE                              06180051
061900              , I.MDSE_DEPT_NBR                                   06190051
062000              , I.MDSE_CLASS_NBR                                  06200051
062100              , 0                                                 06210051
062200              , 0                                                 06220051
062300              , 'ZERO SKU'                                        06230051
062400          FROM                                                    06240051
062500                TDFMEIT I                                         06250051
062600          WHERE                                                   06260051
062700                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          06270051
062800            AND I.DFCT_ITEM_NBR    = 0                            06280051
062900        UNION ALL                                                 06290051
063000* ALL NON ZERO ITEMS WITH NO MATCHING SKU RECORD                  06300051
063100          SELECT                                                  06310051
063200                I.DFCT_ITEM_NBR                                   06320051
063300              , I.SEQ_NBR                                         06330051
063400              , I.RTL_COST_AMT                                    06340051
063500              , I.UNIT_COST_AMT                                   06350051
063600              , I.MKOUT_ORD_ID                                    06360051
063700              , I.MKOUT_ORD_STAT_CDE                              06370051
063800              , I.MDSE_DEPT_NBR                                   06380051
063900              , I.MDSE_CLASS_NBR                                  06390051
064000              , 0                                                 06400051
064100              , 0                                                 06410051
064200              , 'SKU DELETED'                                     06420051
064300          FROM                                                    06430051
064400                TDFMEIT I                                         06440051
064500          WHERE                                                   06450051
064600                I.DFCT_ORD_ID      = :DFMEIT-DFCT-ORD-ID          06460051
064700            AND I.DFCT_ITEM_NBR   µ= 0                            06470051
064800            AND NOT EXISTS                                        06480051
064900            ( SELECT 1                                            06490051
065000              FROM XLT_SKU    S                                   06500051
065100              WHERE I.DFCT_ITEM_NBR    = S.ITM_NBR)               06510051
065200          ORDER BY                                                06520051
065300                7, 8, 9, 3, 4                                     06530051
065400     END-EXEC.                                                    06540051
065500                                                                  06550051
065600                                                                  06560051
065700 EJECT                                                            06570051
065800 LINKAGE SECTION.                                                 06580051
065900                                                                  06590051
066000 01  DFHCOMMAREA.                                                 06600051
066100     05  FILLER                         OCCURS  1 TO 4072 TIMES   06610051
066200                                        DEPENDING ON EIBCALEN.    06620051
066300         10  FILLER                     PIC X.                    06630051
066400                                                                  06640051
066500 EJECT                                                            06650051
066600 PROCEDURE DIVISION.                                              06660051
066700                                                                  06670051
066800                                                                  06680051
066900 A100-MAIN-MODULE.                                                06690051
067000                                                                  06700051
067100*----------------------------------------------------------------*06710051
067200*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.          *06720051
067300*----------------------------------------------------------------*06730051
067400                                                                  06740051
067500     PERFORM DP015-0000-CHECK-COMMAREA.                           06750051
067600                                                                  06760051
067700     IF DP020-SRC-RETURN-W-TRAN-ID                                06770051
067800         PERFORM B100-CONTROL-PROCESSING                          06780051
067900     END-IF.                                                      06790051
068000                                                                  06800051
068100     PERFORM DP003-0000-RETURN-TO-CICS.                           06810051
068200                                                                  06820051
068300 EJECT                                                            06830051
068400*----------------------------------------------------------------*06840051
068500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06850051
068600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06860051
068700*                                                                *06870051
068800*    PERFORMED BY A100-MAIN-MODULE.                              *06880051
068900*----------------------------------------------------------------*06890051
069000                                                                  06900051
069100 B100-CONTROL-PROCESSING.                                         06910051
069200                                                                  06920051
069300     SET PS-CONTINUE           TO  TRUE.                          06930051
069400     MOVE LENGTH OF RV105-BLOCK-ENTRIES (1)                       06940051
069500                               TO  PC-BLOCK-LENGTH.               06950051
069600                                                                  06960051
069700     EVALUATE TRUE                                                06970051
069800         WHEN DP020-NEXT-ACT-INITIAL                              06980051
069900              INITIALIZE RV105-SPECIFIC-COMMAREA                  06990051
070000              MOVE INTER-APPL-COMM-AREA                           07000051
070100                               TO  RV105-SAVE-APPL-COMMAREA       07010051
070200              MOVE DP020-INT-APPL-FORMAT-IND                      07020051
070300                               TO  RV105-INT-APPL-FORMAT-IND      07030051
070400              SET PS-CONTINUE  TO  TRUE                           07040051
070500              SET PS-SEND-MAP-N-DATA-FRSET                        07050051
070600                               TO  TRUE                           07060051
070700              SET DP020-NEXT-ACT-READ-MAP                         07070051
070800                               TO  TRUE                           07080051
070900              PERFORM D100-SETUP-INIT-PANEL                       07090051
071000              IF  PS-NO-LIST-ITEMS-FOUND                          07100051
071100                  MOVE DP016-PF3                                  07110051
071200                               TO  DP020-SRC-AID                  07120051
071300                  PERFORM DP015-1000-START-NAVIGATOR              07130051
071400              END-IF                                              07140051
071500                                                                  07150051
071600         WHEN DP020-NEXT-ACT-READ-MAP                             07160051
071700              PERFORM C300-PROCESS-PANEL                          07170051
071800                                                                  07180051
071900         WHEN DP020-NEXT-ACT-RETURN                               07190051
072000              SET PS-SEND-MAP-N-DATA-FRSET                        07200051
072100                               TO  TRUE                           07210051
072200              MOVE RV105-SAVE-APPL-COMMAREA                       07220051
072300                               TO  INTER-APPL-COMM-AREA           07230051
072400              PERFORM C400-REFRESH-PANEL-FROM-TEMP                07240051
072500              PERFORM G100-DISPLAY-PANEL                          07250051
072600                                                                  07260051
072700         WHEN DP020-NEXT-ACT-ERROR                                07270051
072800              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                07280051
072900              IF  DP020-NAV-MNEMONIC = SPACES                     07290051
073000                  MOVE SPACES  TO  ANAVCMDO                       07300051
073100                  MOVE DP015-UNDERLINE                            07310051
073200                               TO  ANAVCMDH                       07320051
073300                  MOVE DP015-GREEN                                07330051
073400                               TO  ANAVCMDC                       07340051
073500              ELSE                                                07350051
073600                  MOVE DP020-NAV-MNEMONIC                         07360051
073700                               TO  ANAVCMDO                       07370051
073800                  MOVE DP015-REVERSE                              07380051
073900                               TO  ANAVCMDH                       07390051
074000                  MOVE DP015-RED                                  07400051
074100                               TO  ANAVCMDC                       07410051
074200              END-IF                                              07420051
074300                                                                  07430051
074400              PERFORM C400-REFRESH-PANEL-FROM-TEMP                07440051
074500              MOVE -1          TO  ANAVCMDL                       07450051
074600              MOVE PV-MESSAGE  TO  DP020-MSG-MESSAGE              07460051
074700                                                                  07470051
074800              SET DP020-MSG-FATAL                                 07480051
074900                               TO  TRUE                           07490051
075000              SET PS-SEND-MAP-N-DATA-FRSET                        07500051
075100                               TO  TRUE                           07510051
075200              SET PS-CURSOR-POSITIONED                            07520051
075300                               TO  TRUE                           07530051
075400              PERFORM G100-DISPLAY-PANEL                          07540051
075500                                                                  07550051
075600         WHEN OTHER                                               07560051
075700              SET DP013-LOGIC-ABEND TO TRUE                       07570051
075800              SET DP013-NO-ROLLBACK TO TRUE                       07580051
075900              MOVE 'B100-CONTROL-PROCESSING'                      07590051
076000                               TO  DP013-PARAGRAPH                07600051
076100              MOVE PM-PROGRAM-MESSAGE-12                          07610051
076200                               TO  DP013-MESSAGE-TEXT(1)          07620051
076300              PERFORM DP013-0000-PROCESS-ABEND                    07630051
076400     END-EVALUATE.                                                07640051
076500                                                                  07650051
076600 EJECT                                                            07660051
076700*----------------------------------------------------------------*07670051
076800*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *07680051
076900*    ON WHAT FUNCTION KEY WAS SELECTED.                          *07690051
077000*                                                                *07700051
077100*    PERFORMED BY B100-CONTROL-PROCESSING.                       *07710051
077200*----------------------------------------------------------------*07720051
077300                                                                  07730051
077400 C300-PROCESS-PANEL.                                              07740051
077500                                                                  07750051
077600     PERFORM DP007-0000-GET-PANEL.                                07760051
077700     SET PS-SEND-DATA-ONLY-FRSET                                  07770051
077800                               TO TRUE.                           07780051
077900     EVALUATE TRUE                                                07790051
078000                                                                  07800051
078100         WHEN DP020-SRC-AID = DP016-CLEAR                         07810051
078200              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                07820051
078300              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                07830051
078400              PERFORM D175-REFRESH-HEADER                         07840051
078500              PERFORM G100-DISPLAY-PANEL                          07850051
078600                                                                  07860051
078700         WHEN DP020-SRC-AID = DP016-PF5                           07870051
078800              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                07880051
078900              MOVE SPACES      TO  ANAVCMDO                       07890051
079000                                   ANAVKEYO                       07900051
079100              INITIALIZE RV105-SPECIFIC-COMMAREA                  07910051
079200              PERFORM Z050-DELETE-TEMP-STORAGE                    07920051
079300              PERFORM D100-SETUP-INIT-PANEL                       07930051
079400                                                                  07940051
079500         WHEN DP020-SRC-AID = DP016-PA2                           07950051
079600              PERFORM DP009-0000-LOAD-FK-LINES                    07960051
079700              PERFORM DP017-0000-GET-CURR-DATE-TIME               07970051
079800              SET PS-SEND-DATA-ONLY                               07980051
079900                               TO  TRUE                           07990051
080000              MOVE -1          TO  ANAVCMDL                       08000051
080100              PERFORM DP008-0000-WRITE-PANEL                      08010051
080200                                                                  08020051
080300         WHEN OTHER                                               08030051
080400              PERFORM D200-RECORD-SELECTIONS                      08040051
080500              IF (PS-VALID-SELECTIONS                             08050051
080600              AND PS-CONTINUE)                                    08060051
080700                  PERFORM D300-CHECK-FUNCTION-KEY                 08070051
080800              ELSE                                                08080051
080900                  SET PS-SAME-ITEMS-DISPLAYED TO TRUE             08090051
081000                  MOVE -1      TO  ANAVCMDL                       08100051
081100                  PERFORM G100-DISPLAY-PANEL                      08110051
081200             END-IF                                               08120051
081300     END-EVALUATE.                                                08130051
081400                                                                  08140051
081500 EJECT                                                            08150051
081600*----------------------------------------------------------------*08160051
081700*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,*08170051
081800*    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.      *08180051
081900*    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL *08190051
082000*    TO THE USER.                                                *08200051
082100*                                                                *08210051
082200*    PERFORMED BY B100-CONTROL-PROCESSING.                       *08220051
082300*----------------------------------------------------------------*08230051
082400                                                                  08240051
082500 C400-REFRESH-PANEL-FROM-TEMP.                                    08250051
082600                                                                  08260051
082700     PERFORM D175-REFRESH-HEADER.                                 08270051
082800     PERFORM D400-REFRESH-BLOCK-ARRAY.                            08280051
082900                                                                  08290051
083000     SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                    08300051
083100     MOVE RV105-HOLD-TSQB-QUEUE-NAME                              08310051
083200                               TO  RV100-TSQB-QUEUE-NAME.         08320051
083300                                                                  08330051
083400 EJECT                                                            08340051
083500*----------------------------------------------------------------*08350051
083600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08360051
083700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08370051
083800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08380051
083900*    DISPLAY THE PANEL TO USER.                                  *08390051
084000*                                                                *08400051
084100*    PERFORMED BY B100-CONTROL-PROCESSING.                       *08410051
084200*    PERFORMED BY C300-PROCESS-PANEL.                            *08420051
084300*----------------------------------------------------------------*08430051
084400                                                                  08440051
084500 D100-SETUP-INIT-PANEL.                                           08450051
084600                                                                  08460051
084700     INITIALIZE                  RV105-BLOCK-ENTRIES (1).         08470051
084800     INITIALIZE                  RV105-BLOCK-ENTRIES (2).         08480051
084900     MOVE SPACES             TO  RV105-HOLD-TSQB-QUEUE-NAME.      08490051
085000     MOVE +1                 TO  RV105-BLK-SUB.                   08500051
085100     MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.      08510051
085200     SET RV105-ITEMS-LEFT-ON-DB                                   08520051
085300                             TO  TRUE.                            08530051
085400                                                                  08540051
085500     MOVE +0                 TO  RV105-ITEM-SUB                   08550051
085600                                 RV105-NUMBER-OF-ITEMS-READ       08560051
085700                                 RV105-NUMBER-OF-SELECTED-ITEMS   08570051
085800                                 RV105-HIGHEST-BLOCK-WRITTEN      08580051
085900                                 RV105-START-OF-SELECTED-RANGE    08590051
086000                                 RV105-END-OF-SELECTED-RANGE.     08600051
086100                                                                  08610051
086200     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       08620051
086300     MOVE DP017-EDITED-DATE-YYYYMMDD                              08630051
086400                               TO  RV105-DB2-CURRENT-DATE.        08640051
086500     SET RV105-DC-DASH1        TO  TRUE.                          08650051
086600     SET RV105-DC-DASH2        TO  TRUE.                          08660051
086700                                                                  08670051
086800     PERFORM D150-GET-HEADER-INFO.                                08680051
086900     MOVE DFCTOR-VENDOR-DUNS-NBR                                  08690051
087000                               TO  RV105-VENDOR-DUNS-NBR.         08700051
087100     MOVE DFCTOR-VEND-NAME     TO  RV105-VENDOR-DESCRIPTION.      08710051
087200                                                                  08720051
087300     PERFORM L100-OPEN-CURSOR.                                    08730051
087400                                                                  08740051
087500     PERFORM H100-READ-ITEMS-FROM-DB.                             08750051
087600     SET PS-DIFFERENT-ITEMS-DISPLAYED                             08760051
087700                             TO  TRUE.                            08770051
087800                                                                  08780051
087900     MOVE +1                 TO  RV105-ITEM-AT-TOP-OF-PANEL.      08790051
088000                                                                  08800051
088100     IF  PS-NO-LIST-ITEMS-FOUND                                   08810051
088200         CONTINUE                                                 08820051
088300     ELSE                                                         08830051
088400         PERFORM D175-REFRESH-HEADER                              08840051
088500         MOVE  -1   TO ANAVCMDL                                   08850051
088600         PERFORM G100-DISPLAY-PANEL                               08860051
088700     END-IF.                                                      08870051
088800                                                                  08880051
088900 EJECT                                                            08890051
089000*----------------------------------------------------------------*08900051
089100*    USE THE RA NUMBER TO GET THE HEADER INFORMATION.            *08910051
089200*                                                                *08920051
089300*    PERFORMED BY D100                                           *08930051
089400*----------------------------------------------------------------*08940051
089500                                                                  08950051
089600 D150-GET-HEADER-INFO.                                            08960051
089700                                                                  08970051
089800     PERFORM                                                      08980051
089900         WITH TEST AFTER                                          08990051
090000         VARYING PV-SQL-SUB                                       09000051
090100         FROM 1 BY 1                                              09010051
090200         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             09020051
090300            OR SQLCODE = 0                                        09030051
090400            OR SQLCODE = +100                                     09040051
090500                                                                  09050051
090600         EXEC SQL                                                 09060051
090700              SELECT                                              09070051
090800                    VENDOR_DUNS_NBR                               09080051
090900                  , VEND_NAME                                     09090051
091000                  , DFCT_ORD_ID_CDE                               09100051
091100                  , DFCT_ORD_STAT_CDE                             09110051
091200              INTO                                                09120051
091300                    :DFCTOR-VENDOR-DUNS-NBR                       09130051
091400                  , :DFCTOR-VEND-NAME                             09140051
091500                  , :DFCTOR-DFCT-ORD-ID-CDE                       09150051
091600                  , :DFCTOR-DFCT-ORD-STAT-CDE                     09160051
091700              FROM                                                09170051
091800                    TDFCTOR                                       09180051
091900              WHERE                                               09190051
092000                    DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER       09200051
092100         END-EXEC                                                 09210051
092200                                                                  09220051
092300         EVALUATE TRUE                                            09230051
092400             WHEN SQLCODE = ZERO                                  09240051
092500             WHEN SQLCODE = +100                                  09250051
092600             WHEN SQLCODE = -904                                  09260051
092700             WHEN SQLCODE = -913                                  09270051
092800                  CONTINUE                                        09280051
092900             WHEN SQLWARN0 NOT EQUAL SPACE                        09290051
093000             WHEN SQLCODE NOT EQUAL ZERO                          09300051
093100                  MOVE 'D150-GET-HEADER-INFO'                     09310051
093200                               TO  DP013-PARAGRAPH                09320051
093300                  MOVE 'SELECT FOR HEADER INFORMATION'            09330051
093400                               TO  DP013-MESSAGE-TEXT (1)         09340051
093500                  MOVE SQLCA   TO  DP013-SQLCA                    09350051
093600                  SET DP013-DB2-ABEND                             09360051
093700                               TO  TRUE                           09370051
093800                  PERFORM DP013-0000-PROCESS-ABEND                09380051
093900         END-EVALUATE                                             09390051
094000     END-PERFORM.                                                 09400051
094100                                                                  09410051
094200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   09420051
094300         MOVE 'D150-GET-HEADER-INFO'                              09430051
094400                               TO  DP013-PARAGRAPH                09440051
094500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   09450051
094600                               TO  DP013-MESSAGE-TEXT (1)         09460051
094700         MOVE SQLCA            TO  DP013-SQLCA                    09470051
094800         SET DP013-DB2-ABEND   TO  TRUE                           09480051
094900         PERFORM DP013-0000-PROCESS-ABEND                         09490051
095000     END-IF.                                                      09500051
095100                                                                  09510051
095200     IF  SQLCODE EQUAL +100                                       09520051
095300         MOVE ZERO             TO  DFCTOR-VENDOR-DUNS-NBR         09530051
095400         MOVE 'NOT FOUND'      TO  DFCTOR-VEND-NAME               09540051
095500     ELSE                                                         09550051
095600         PERFORM D160-GET-ORDER-STATUS                            09560051
095700     END-IF.                                                      09570051
095800                                                                  09580051
095900 EJECT                                                            09590051
096000*----------------------------------------------------------------*09600051
096100*    USE THE ORDER STATUS CODE TO GET THE STATUS DESCRIPTION.    *09610051
096200*                                                                *09620051
096300*    PERFORMED BY D150                                           *09630051
096400*----------------------------------------------------------------*09640051
096500                                                                  09650051
096600 D160-GET-ORDER-STATUS.                                           09660051
096700                                                                  09670051
096800     EVALUATE DFCTOR-DFCT-ORD-ID-CDE                              09680051
096900         WHEN 'M'                                                 09690051
097000             MOVE 'MARKOUT '           TO RV105-ORDER-TYPE        09700051
097100                                                                  09710051
097200         WHEN 'R'                                                 09720051
097300             MOVE 'RTV     '           TO RV105-ORDER-TYPE        09730051
097400                                                                  09740051
097500         WHEN 'D'                                                 09750051
097600             MOVE 'DEBT/DIS'           TO RV105-ORDER-TYPE        09760051
097700                                                                  09770051
097800         WHEN 'C'                                                 09780051
097900             MOVE 'CALLBACK'           TO RV105-ORDER-TYPE        09790051
098000     END-EVALUATE.                                                09800051
098100                                                                  09810051
098200     EVALUATE DFCTOR-DFCT-ORD-STAT-CDE                            09820051
098300         WHEN 'N'                                                 09830051
098400             MOVE 'NEW     '           TO RV105-ORDER-STATUS      09840051
098500                                                                  09850051
098600         WHEN 'O'                                                 09860051
098700             MOVE 'OPEN    '           TO RV105-ORDER-STATUS      09870051
098800                                                                  09880051
098900         WHEN 'C'                                                 09890051
099000             MOVE 'CLOSED  '           TO RV105-ORDER-STATUS      09900051
099100                                                                  09910051
099200         WHEN 'S'                                                 09920051
099300             MOVE 'SHIPPED '           TO RV105-ORDER-STATUS      09930051
099400                                                                  09940051
099500         WHEN 'P'                                                 09950051
099600             MOVE 'PENDING '           TO RV105-ORDER-STATUS      09960051
099700                                                                  09970051
099800         WHEN 'A'                                                 09980051
099900             MOVE 'APPROVED'           TO RV105-ORDER-STATUS      09990051
100000                                                                  10000051
100100         WHEN 'D'                                                 10010051
100200             MOVE 'DEBT/DIS'           TO RV105-ORDER-STATUS      10020051
100300     END-EVALUATE.                                                10030051
100400                                                                  10040051
100500                                                                  10050051
100600 EJECT                                                            10060051
100700*----------------------------------------------------------------*10070051
100800*    RELOAD THE HEADER INFORMATION ON THE SCREEN.                *10080051
100900*                                                                *10090051
101000*    PERFORMED BY B100, C300, D100.                              *10100051
101100*----------------------------------------------------------------*10110051
101200                                                                  10120051
101300 D175-REFRESH-HEADER.                                             10130051
101400                                                                  10140051
101500     MOVE RV100-UK-RA-NUMBER   TO  ARANBRO.                       10150051
101600     MOVE RV105-ORDER-TYPE     TO  AORTYPEO.                      10160051
101700     MOVE RV105-ORDER-STATUS   TO  AORSTATO.                      10170051
101800     MOVE RV105-VENDOR-DUNS-NBR                                   10180051
101900                               TO  AVENUMO.                       10190051
102000     MOVE RV105-VENDOR-DESCRIPTION                                10200051
102100                               TO  AVENAMEO.                      10210051
102200     MOVE RV105-TOTAL-COST     TO  ATCOSTO.                       10220051
102300     MOVE RV105-TOTAL-RETAIL   TO  ATRETO.                        10230051
102400                                                                  10240051
102500 EJECT                                                            10250051
102600*----------------------------------------------------------------*10260051
102700*    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES   *10270051
102800*    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG   *10280051
102900*    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY *10290051
103000*    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT  *10300051
103100*    THOSE SELECTIONS.                                           *10310051
103200*                                                                *10320051
103300*    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT    *10330051
103400*    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.        *10340051
103500*                                                                *10350051
103600*    PERFORMED BY C300-PROCESS-PANEL.                            *10360051
103700*----------------------------------------------------------------*10370051
103800                                                                  10380051
103900 D200-RECORD-SELECTIONS.                                          10390051
104000                                                                  10400051
104100     SET RV105-NO-TSQ-UPDATE   TO  TRUE.                          10410051
104200                                                                  10420051
104300     IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                   10430051
104400        (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                   10440051
104500        (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR                   10450051
104600        (DP020-FK-RETURN(DP020-SRC-AID))                          10460051
104700         SET PS-VALID-SELECTIONS TO TRUE                          10470051
104800     ELSE                                                         10480051
104900         IF (DP020-SRC-AID EQUAL DP016-ENTER                      10490051
105000         AND DP020-NAV-MNEMONIC GREATER THAN SPACES)              10500051
105100             SET PS-VALID-SELECTIONS TO TRUE                      10510051
105200         END-IF                                                   10520051
105300     END-IF.                                                      10530051
105400                                                                  10540051
105500 EJECT                                                            10550051
105600*----------------------------------------------------------------*10560051
105700*    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION   *10570051
105800*    KEY HAD BEEN SELECTED BY THE USER.                          *10580051
105900*                                                                *10590051
106000*    PERFORMED BY C300-PROCESS-PANEL.                            *10600051
106100*----------------------------------------------------------------*10610051
106200                                                                  10620051
106300 D300-CHECK-FUNCTION-KEY.                                         10630051
106400                                                                  10640051
106500     EVALUATE TRUE                                                10650051
106600                                                                  10660051
106700         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      10670051
106800              PERFORM E300-NAVIGATE                               10680051
106900                                                                  10690051
107000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10700051
107100              IF  PS-CONTINUE                                     10710051
107200                  PERFORM E400-DISPLAY-TOP-OF-LIST                10720051
107300              END-IF                                              10730051
107400                                                                  10740051
107500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10750051
107600              IF  PS-CONTINUE                                     10760051
107700                  PERFORM E500-BROWSE-BACKWARD                    10770051
107800              END-IF                                              10780051
107900                                                                  10790051
108000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10800051
108100              IF  PS-CONTINUE                                     10810051
108200                  PERFORM E600-BROWSE-FORWARD                     10820051
108300              END-IF                                              10830051
108400                                                                  10840051
108500         WHEN DP020-SRC-AID = DP016-ENTER                         10850051
108600              IF  DP020-NAV-MNEMONIC GREATER THAN SPACES          10860051
108700                  PERFORM E300-NAVIGATE                           10870051
108800              ELSE                                                10880051
108900                  PERFORM E800-CHECK-FOR-JUMP-BROWSE              10890051
109000              END-IF                                              10900051
109100                                                                  10910051
109200                                                                  10920051
109300         WHEN OTHER                                               10930051
109400              MOVE PC-TSYMSG-00045                                10940051
109500                               TO  DP020-MSG-NUMBER               10950051
109600              SET DP020-MSG-FATAL                                 10960051
109700                               TO  TRUE                           10970051
109800              PERFORM G100-DISPLAY-PANEL                          10980051
109900                                                                  10990051
110000     END-EVALUATE.                                                11000051
110100                                                                  11010051
110200 EJECT                                                            11020051
110300*----------------------------------------------------------------*11030051
110400*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,*11040051
110500*    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY  *11050051
110600*    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE     *11060051
110700*    HAD LEFT PREVIOUSLY.                                        *11070051
110800*                                                                *11080051
110900*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                  *11090051
111000*----------------------------------------------------------------*11100051
111100                                                                  11110051
111200 D400-REFRESH-BLOCK-ARRAY.                                        11120051
111300                                                                  11130051
111400     COMPUTE PV-TEMP-BLOCK-NUMBER =                               11140051
111500         1 + ((RV105-LIST-ITEM-NUMBER(1 1) - 1) /                 11150051
111600               PC-ITEMS-PER-BLOCK).                               11160051
111700                                                                  11170051
111800     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                11180051
111900     MOVE +1                   TO RV105-BLK-SUB.                  11190051
112000                                                                  11200051
112100     PERFORM Z100-READ-TEMP-STORAGE.                              11210051
112200                                                                  11220051
112300     ADD +1 TO PV-BLOCK-NUMBER.                                   11230051
112400                                                                  11240051
112500     IF (PV-BLOCK-NUMBER < RV105-HIGHEST-BLOCK-WRITTEN) OR        11250051
112600        (PV-BLOCK-NUMBER = RV105-HIGHEST-BLOCK-WRITTEN)           11260051
112700         ADD +1 TO RV105-BLK-SUB                                  11270051
112800                                                                  11280051
112900         PERFORM Z100-READ-TEMP-STORAGE                           11290051
113000     END-IF.                                                      11300051
113100                                                                  11310051
113200 EJECT                                                            11320051
113300*----------------------------------------------------------------*11330051
113400*    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER    *11340051
113500*    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO  *11350051
113600*    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,   *11360051
113700*    AND START THE NAVIGATOR.                                    *11370051
113800*                                                                *11380051
113900*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *11390051
114000*----------------------------------------------------------------*11400051
114100                                                                  11410051
114200 E300-NAVIGATE.                                                   11420051
114300                                                                  11430051
114400     MOVE +1 TO RV105-BLK-SUB.                                    11440051
114500     PERFORM Z150-WRITE-TEMP-STORAGE.                             11450051
114600                                                                  11460051
114700     ADD +1 TO RV105-BLK-SUB.                                     11470051
114800     PERFORM Z150-WRITE-TEMP-STORAGE.                             11480051
114900                                                                  11490051
115000     MOVE INTER-APPL-COMM-AREA TO  RV105-SAVE-APPL-COMMAREA.      11500051
115100                                                                  11510051
115200     PERFORM DP015-1000-START-NAVIGATOR.                          11520051
115300                                                                  11530051
115400 EJECT                                                            11540051
115500*----------------------------------------------------------------*11550051
115600*    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM     *11560051
115700*    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM          *11570051
115800*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *11580051
115900*    TO BE READ.                                                 *11590051
116000*                                                                *11600051
116100*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *11610051
116200*----------------------------------------------------------------*11620051
116300                                                                  11630051
116400 E400-DISPLAY-TOP-OF-LIST.                                        11640051
116500                                                                  11650051
116600     IF  RV105-NUMBER-OF-ITEMS-READ > +0                          11660051
116700         MOVE +1 TO PV-TOP-ITEM                                   11670051
116800         PERFORM F500-BROWSE                                      11680051
116900     ELSE                                                         11690051
117000         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      11700051
117100         PERFORM G100-DISPLAY-PANEL                               11710051
117200     END-IF.                                                      11720051
117300                                                                  11730051
117400 EJECT                                                            11740051
117500*----------------------------------------------------------------*11750051
117600*    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP      *11760051
117700*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM     *11770051
117800*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *11780051
117900*    TO BE READ.                                                 *11790051
118000*                                                                *11800051
118100*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *11810051
118200*----------------------------------------------------------------*11820051
118300                                                                  11830051
118400 E500-BROWSE-BACKWARD.                                            11840051
118500                                                                  11850051
118600     IF  RV105-NUMBER-OF-ITEMS-READ > +0                          11860051
118700         COMPUTE PV-TOP-ITEM =                                    11870051
118800             RV105-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL      11880051
118900         PERFORM F500-BROWSE                                      11890051
119000     ELSE                                                         11900051
119100         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      11910051
119200         PERFORM G100-DISPLAY-PANEL                               11920051
119300     END-IF.                                                      11930051
119400                                                                  11940051
119500 EJECT                                                            11950051
119600*----------------------------------------------------------------*11960051
119700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11970051
119800*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM     *11980051
119900*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *11990051
120000*    TO BE READ.                                                 *12000051
120100*                                                                *12010051
120200*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *12020051
120300*----------------------------------------------------------------*12030051
120400                                                                  12040051
120500 E600-BROWSE-FORWARD.                                             12050051
120600                                                                  12060051
120700     IF  RV105-NUMBER-OF-ITEMS-READ > +0                          12070051
120800         COMPUTE PV-TOP-ITEM =                                    12080051
120900             RV105-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL      12090051
121000         PERFORM F500-BROWSE                                      12100051
121100     ELSE                                                         12110051
121200         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      12120051
121300         PERFORM G100-DISPLAY-PANEL                               12130051
121400     END-IF.                                                      12140051
121500                                                                  12150051
121600 EJECT                                                            12160051
121700*----------------------------------------------------------------*12170051
121800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12180051
121900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12190051
122000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12200051
122100*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *12210051
122200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12220051
122300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12230051
122400*                                                                *12240051
122500*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *12250051
122600*----------------------------------------------------------------*12260051
122700                                                                  12270051
122800 E800-CHECK-FOR-JUMP-BROWSE.                                      12280051
122900                                                                  12290051
123000     SET PS-VALID-BEG-ITEM TO TRUE.                               12300051
123100                                                                  12310051
123200     IF (ASTRTITA                   = PC-ERASE-EOF) OR            12320051
123300        (RV105-NUMBER-OF-ITEMS-READ = +0)                         12330051
123400         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      12340051
123500         PERFORM G100-DISPLAY-PANEL                               12350051
123600     ELSE                                                         12360051
123700                                                                  12370051
123800         MOVE ASTRTITI         TO  DP010I-UNEDITED-FIELD          12380051
123900         MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS          12390051
124000         MOVE +0               TO  DP010I-MAXIMUM-DECIMALS        12400051
124100         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  12410051
124200         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12420051
124300              USING DP010I-NUMERIC-EDIT-AREA                      12430051
124400                                                                  12440051
124500         IF  NOT DP010I-ERROR-DETECTED                            12450051
124600             MOVE DP010I-NUMERIC-FIELD                            12460051
124700                               TO  PV-BEGITMI-N                   12470051
124800             MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM              12480051
124900                                                                  12490051
125000             IF (PV-BEGINNING-ITEM >  0)          AND             12500051
125100                (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)               12510051
125200                 MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM            12520051
125300                                                                  12530051
125400                 COMPUTE PV-MAX-ITEMS-TO-BE-READ =                12540051
125500                     ((RV105-NUMBER-OF-ITEMS-READ +               12550051
125600                       PC-MAX-ITEMS-TO-BE-READ)   -               12560051
125700                       PC-ITEMS-PER-PANEL)        + 1             12570051
125800                                                                  12580051
125900                 IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ         12590051
126000                     MOVE PV-MAX-ITEMS-TO-BE-READ                 12600051
126100                               TO  PV-TOP-ITEM                    12610051
126200                     MOVE -1   TO  ASTRTITL                       12620051
126300                                                                  12630051
126400                     IF RV105-NO-ITEMS-LEFT-ON-DB                 12640051
126500                         MOVE PC-TSYMSG-00070                     12650051
126600                               TO  DP020-MSG-NUMBER               12660051
126700                     ELSE                                         12670051
126800                         MOVE PC-TSYMSG-00207                     12680051
126900                               TO  DP020-MSG-NUMBER               12690051
127000                     END-IF                                       12700051
127100                                                                  12710051
127200                     SET PS-CURSOR-POSITIONED                     12720051
127300                               TO  TRUE                           12730051
127400                     SET DP020-MSG-INFORMATIONAL                  12740051
127500                               TO  TRUE                           12750051
127600                 END-IF                                           12760051
127700                 PERFORM F500-BROWSE                              12770051
127800             END-IF                                               12780051
127900                                                                  12790051
128000         ELSE                                                     12800051
128100             MOVE PC-TSYMSG-00008                                 12810051
128200                               TO  DP020-MSG-NUMBER               12820051
128300             MOVE -1           TO  ASTRTITL                       12830051
128400             MOVE DP015-REVERSE                                   12840051
128500                               TO  ASTRTITH                       12850051
128600             MOVE DP015-RED    TO  ASTRTITC                       12860051
128700             MOVE DP015-UNP-NUM-BRT-MDT                           12870051
128800                               TO  ASTRTITA                       12880051
128900             SET PS-CURSOR-POSITIONED                             12890051
129000                               TO  TRUE                           12900051
129100             SET DP020-MSG-FATAL                                  12910051
129200                               TO  TRUE                           12920051
129300             SET PS-INVALID-BEG-ITEM                              12930051
129400                               TO  TRUE                           12940051
129500         END-IF                                                   12950051
129600     END-IF.                                                      12960051
129700                                                                  12970051
129800     IF  PS-INVALID-BEG-ITEM                                      12980051
129900         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      12990051
130000         PERFORM DP017-0000-GET-CURR-DATE-TIME                    13000051
130100         PERFORM I200-FORMAT-LIST-LINES                           13010051
130200         PERFORM DP005-0000-FORMAT-MSG-LINES                      13020051
130300         PERFORM DP008-0000-WRITE-PANEL                           13030051
130400     END-IF.                                                      13040051
130500                                                                  13050051
130600 EJECT                                                            13060051
130700*----------------------------------------------------------------*13070051
130800*    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE*13080051
130900*    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE    *13090051
131000*    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).   *13100051
131100*                                                                *13110051
131200*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                      *13120051
131300*    PERFORMED BY E500-BROWSE-BACKWARD.                          *13130051
131400*    PERFORMED BY E600-BROWSE-FORWARD.                           *13140051
131500*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *13150051
131600*----------------------------------------------------------------*13160051
131700                                                                  13170051
131800 F500-BROWSE.                                                     13180051
131900                                                                  13190051
132000     IF  PV-TOP-ITEM < +1                                         13200051
132100         MOVE +1               TO  PV-TOP-ITEM                    13210051
132200         IF  PS-CURSOR-NOT-POSITIONED                             13220051
132300             MOVE PC-TSYMSG-00069                                 13230051
132400                               TO  DP020-MSG-NUMBER               13240051
132500             SET DP020-MSG-INFORMATIONAL                          13250051
132600                               TO  TRUE                           13260051
132700             SET PS-INFORMATIONAL                                 13270051
132800                               TO  TRUE                           13280051
132900             SET PS-CURSOR-POSITIONED                             13290051
133000                               TO  TRUE                           13300051
133100         END-IF                                                   13310051
133200     END-IF.                                                      13320051
133300                                                                  13330051
133400     IF  RV105-NO-ITEMS-LEFT-ON-DB                                13340051
133500         IF  PV-TOP-ITEM > RV105-NUMBER-OF-ITEMS-READ             13350051
133600             IF  DP020-SRC-AID EQUAL DP016-ENTER                  13360051
133700                 MOVE RV105-NUMBER-OF-ITEMS-READ                  13370051
133800                               TO  PV-TOP-ITEM                    13380051
133900             ELSE                                                 13390051
134000                 MOVE RV105-ITEM-AT-TOP-OF-PANEL                  13400051
134100                               TO  PV-TOP-ITEM                    13410051
134200             END-IF                                               13420051
134300                                                                  13430051
134400             IF  PS-CURSOR-NOT-POSITIONED                         13440051
134500                 MOVE -1       TO  ANAVCMDL                       13450051
134600                 SET DP020-MSG-INFORMATIONAL                      13460051
134700                               TO  TRUE                           13470051
134800                 SET PS-CURSOR-POSITIONED                         13480051
134900                               TO  TRUE                           13490051
135000                 IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)            13500051
135100                     MOVE PC-TSYMSG-00070                         13510051
135200                               TO  DP020-MSG-NUMBER               13520051
135300                     SET PS-INFORMATIONAL                         13530051
135400                               TO  TRUE                           13540051
135500             END-IF                                               13550051
135600         END-IF                                                   13560051
135700     END-IF.                                                      13570051
135800                                                                  13580051
135900     COMPUTE PV-BOTTOM-ITEM =                                     13590051
136000         (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                  13600051
136100                                                                  13610051
136200     IF  RV105-NO-ITEMS-LEFT-ON-DB                                13620051
136300         IF  PV-BOTTOM-ITEM > RV105-NUMBER-OF-ITEMS-READ          13630051
136400             MOVE RV105-NUMBER-OF-ITEMS-READ                      13640051
136500                               TO  PV-BOTTOM-ITEM                 13650051
136600             IF  PS-CURSOR-NOT-POSITIONED                         13660051
136700                 IF  PV-TOP-ITEM NOT = +1                         13670051
136800                     IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)        13680051
136900                         MOVE PC-TSYMSG-00070                     13690051
137000                               TO  DP020-MSG-NUMBER               13700051
137100                         SET PS-INFORMATIONAL                     13710051
137200                               TO  TRUE                           13720051
137300                         SET DP020-MSG-INFORMATIONAL              13730051
137400                               TO  TRUE                           13740051
137500                         SET PS-CURSOR-POSITIONED                 13750051
137600                               TO  TRUE                           13760051
137700                     END-IF                                       13770051
137800                 END-IF                                           13780051
137900             END-IF                                               13790051
138000         END-IF                                                   13800051
138100     END-IF.                                                      13810051
138200                                                                  13820051
138300     PERFORM G300-DETERMINE-WHAT-IS-WHERE.                        13830051
138400                                                                  13840051
138500     IF  PS-TOP-ITEM-IN-ARRAY                                     13850051
138600         IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                          13860051
138700             IF  PS-BOTTOM-ITEM-IN-TEMP                           13870051
138800                 PERFORM G500-SCROLL-FORWARD                      13880051
138900             ELSE                                                 13890051
139000                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   13900051
139100                     PERFORM G500-SCROLL-FORWARD                  13910051
139200                 END-IF                                           13920051
139300                 PERFORM G400-READ-ITEMS-INTO-ARRAY               13930051
139400             END-IF                                               13940051
139500         END-IF                                                   13950051
139600     ELSE                                                         13960051
139700                                                                  13970051
139800         IF  PS-BOTTOM-ITEM-IN-ARRAY                              13980051
139900             PERFORM G600-SCROLL-BACKWARD                         13990051
140000         ELSE                                                     14000051
140100             IF  PS-TOP-ITEM-IN-TEMP                              14010051
140200                 PERFORM G700-GET-TOP-ITEMS-BLOCK                 14020051
140300                 PERFORM G300-DETERMINE-WHAT-IS-WHERE             14030051
140400                 IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                  14040051
140500                     PERFORM G400-READ-ITEMS-INTO-ARRAY           14050051
140600                 END-IF                                           14060051
140700             ELSE                                                 14070051
140800                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   14080051
140900                     PERFORM G800-GET-LAST-BLOCK-IN-TEMP          14090051
141000                 END-IF                                           14100051
141100                 PERFORM G400-READ-ITEMS-INTO-ARRAY               14110051
141200             END-IF                                               14120051
141300         END-IF                                                   14130051
141400     END-IF.                                                      14140051
141500                                                                  14150051
141600     IF  PV-TOP-ITEM = RV105-ITEM-AT-TOP-OF-PANEL                 14160051
141700         SET PS-SAME-ITEMS-DISPLAYED                              14170051
141800                               TO  TRUE                           14180051
141900     ELSE                                                         14190051
142000         SET PS-DIFFERENT-ITEMS-DISPLAYED                         14200051
142100                               TO  TRUE                           14210051
142200         MOVE PV-TOP-ITEM      TO  RV105-ITEM-AT-TOP-OF-PANEL     14220051
142300     END-IF.                                                      14230051
142400                                                                  14240051
142500     PERFORM G100-DISPLAY-PANEL.                                  14250051
142600                                                                  14260051
142700 EJECT                                                            14270051
142800*----------------------------------------------------------------*14280051
142900*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.      *14290051
143000*                                                                *14300051
143100*    PERFORMED BY B100-CONTROL-PROCESSING.                       *14310051
143200*    PERFORMED BY C300-PROCESS-PANEL.                            *14320051
143300*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                  *14330051
143400*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *14340051
143500*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                      *14350051
143600*    PERFORMED BY E500-BROWSE-BACKWARD.                          *14360051
143700*    PERFORMED BY E600-BROWSE-FORWARD.                           *14370051
143800*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *14380051
143900*    PERFORMED BY F500-BROWSE.                                   *14390051
144000*----------------------------------------------------------------*14400051
144100                                                                  14410051
144200 G100-DISPLAY-PANEL.                                              14420051
144300                                                                  14430051
144400     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       14440051
144500     MOVE DP017-EDITED-TIME-HMS                                   14450051
144600                               TO  ATIMEO.                        14460051
144700                                                                  14470051
144800     IF PS-SEND-MAP-N-DATA-FRSET                                  14480051
144900         PERFORM DP002-0000-FORMAT-TITLE-LINES                    14490051
145000         PERFORM DP009-0000-LOAD-FK-LINES                         14500051
145100     END-IF.                                                      14510051
145200                                                                  14520051
145300     PERFORM H200-FORMAT-PANEL-BODY.                              14530051
145400                                                                  14540051
145500     PERFORM DP005-0000-FORMAT-MSG-LINES.                         14550051
145600                                                                  14560051
145700     PERFORM DP008-0000-WRITE-PANEL.                              14570051
145800                                                                  14580051
145900 EJECT                                                            14590051
146000*----------------------------------------------------------------*14600051
146100*    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND *14610051
146200*    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.             *14620051
146300*                                                                *14630051
146400*    PERFORMED BY F500-BROWSE.                                   *14640051
146500*----------------------------------------------------------------*14650051
146600                                                                  14660051
146700 G300-DETERMINE-WHAT-IS-WHERE.                                    14670051
146800                                                                  14680051
146900     MOVE RV105-LIST-ITEM-NUMBER(1 1)                             14690051
147000                               TO  PV-FIRST-ITEM-IN-ARRAY.        14700051
147100     COMPUTE PV-LAST-ITEM-IN-ARRAY =                              14710051
147200         (PV-FIRST-ITEM-IN-ARRAY +                                14720051
147300         (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.      14730051
147400     IF  PV-LAST-ITEM-IN-ARRAY > RV105-NUMBER-OF-ITEMS-READ       14740051
147500         MOVE RV105-NUMBER-OF-ITEMS-READ                          14750051
147600                               TO  PV-LAST-ITEM-IN-ARRAY          14760051
147700     END-IF.                                                      14770051
147800                                                                  14780051
147900     COMPUTE PV-LAST-ITEM-IN-TEMP =                               14790051
148000         RV105-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.        14800051
148100     IF  PV-LAST-ITEM-IN-TEMP > RV105-NUMBER-OF-ITEMS-READ        14810051
148200         MOVE RV105-NUMBER-OF-ITEMS-READ                          14820051
148300                               TO  PV-LAST-ITEM-IN-TEMP           14830051
148400     END-IF.                                                      14840051
148500                                                                  14850051
148600     IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    14860051
148700     OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    14870051
148800         IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                 14880051
148900         OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                 14890051
149000             SET PS-TOP-ITEM-IN-ARRAY                             14900051
149100                               TO  TRUE                           14910051
149200         ELSE                                                     14920051
149300             SET PS-TOP-ITEM-NOT-IN-ARRAY                         14930051
149400                               TO  TRUE                           14940051
149500         END-IF                                                   14950051
149600     ELSE                                                         14960051
149700         SET PS-TOP-ITEM-NOT-IN-ARRAY                             14970051
149800                               TO  TRUE                           14980051
149900     END-IF.                                                      14990051
150000                                                                  15000051
150100     IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                 15010051
150200     OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                 15020051
150300         IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)              15030051
150400         OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)              15040051
150500             SET PS-BOTTOM-ITEM-IN-ARRAY                          15050051
150600                               TO  TRUE                           15060051
150700         ELSE                                                     15070051
150800             SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                      15080051
150900                               TO  TRUE                           15090051
151000         END-IF                                                   15100051
151100     ELSE                                                         15110051
151200         SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                          15120051
151300                               TO  TRUE                           15130051
151400     END-IF.                                                      15140051
151500                                                                  15150051
151600     IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                      15160051
151700     OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                      15170051
151800         SET PS-TOP-ITEM-IN-TEMP                                  15180051
151900                               TO  TRUE                           15190051
152000     ELSE                                                         15200051
152100         SET PS-TOP-ITEM-NOT-IN-TEMP                              15210051
152200                               TO  TRUE                           15220051
152300     END-IF.                                                      15230051
152400                                                                  15240051
152500     IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                   15250051
152600     OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                   15260051
152700         SET PS-BOTTOM-ITEM-IN-TEMP                               15270051
152800                               TO  TRUE                           15280051
152900     ELSE                                                         15290051
153000         SET PS-BOTTOM-ITEM-NOT-IN-TEMP                           15300051
153100                               TO  TRUE                           15310051
153200     END-IF.                                                      15320051
153300                                                                  15330051
153400     IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY              15340051
153500         SET PS-LAST-BLOCK-NOT-IN-ARRAY                           15350051
153600                               TO  TRUE                           15360051
153700     ELSE                                                         15370051
153800         SET PS-LAST-BLOCK-IN-ARRAY                               15380051
153900                               TO  TRUE                           15390051
154000     END-IF.                                                      15400051
154100                                                                  15410051
154200 EJECT                                                            15420051
154300*----------------------------------------------------------------*15430051
154400*    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM    *15440051
154500*    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW     *15450051
154600*    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600    *15460051
154700*    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.  *15470051
154800*                                                                *15480051
154900*    PERFORMED BY F500-BROWSE.                                   *15490051
155000*----------------------------------------------------------------*15500051
155100                                                                  15510051
155200 G400-READ-ITEMS-INTO-ARRAY.                                      15520051
155300                                                                  15530051
155400     COMPUTE PS-ITEM-SUB =                                        15540051
155500         (RV105-NUMBER-OF-ITEMS-READ -                            15550051
155600          RV105-LIST-ITEM-NUMBER(1 1)) + 1.                       15560051
155700                                                                  15570051
155800     MOVE PS-ITEM-SUB TO RV105-ITEM-SUB.                          15580051
155900                                                                  15590051
156000     IF  RV105-ITEM-SUB > PC-ITEMS-PER-BLOCK                      15600051
156100         SUBTRACT PC-ITEMS-PER-BLOCK                              15610051
156200                             FROM  RV105-ITEM-SUB                 15620051
156300         MOVE PC-MAX-BLOCKS-IN-ARRAY                              15630051
156400                               TO  RV105-BLK-SUB                  15640051
156500     ELSE                                                         15650051
156600         MOVE +1               TO  RV105-BLK-SUB                  15660051
156700     END-IF.                                                      15670051
156800                                                                  15680051
156900     MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.    15690051
157000                                                                  15700051
157100     PERFORM L100-OPEN-CURSOR.                                    15710051
157200     PERFORM H100-READ-ITEMS-FROM-DB.                             15720051
157300     IF  PV-ITEMS-READ EQUAL ZERO                                 15730051
157400         MOVE RV105-ITEM-AT-TOP-OF-PANEL                          15740051
157500                               TO  PV-TOP-ITEM                    15750051
157600     END-IF.                                                      15760051
157700                                                                  15770051
157800     IF  RV105-NO-ITEMS-LEFT-ON-DB                                15780051
157900         IF  PV-TOP-ITEM > RV105-NUMBER-OF-ITEMS-READ             15790051
158000             MOVE RV105-NUMBER-OF-ITEMS-READ                      15800051
158100                               TO  PV-TOP-ITEM                    15810051
158200         END-IF                                                   15820051
158300         IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)                    15830051
158400             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           15840051
158500             SET DP020-MSG-INFORMATIONAL                          15850051
158600                               TO  TRUE                           15860051
158700             SET PS-INFORMATIONAL                                 15870051
158800                               TO  TRUE                           15880051
158900         END-IF                                                   15890051
159000     END-IF.                                                      15900051
159100                                                                  15910051
159200 EJECT                                                            15920051
159300*----------------------------------------------------------------*15930051
159400*    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM     *15940051
159500*    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ   *15950051
159600*    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY      *15960051
159700*    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK  *15970051
159800*    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.  *15980051
159900*    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE      *15990051
160000*    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR      *16000051
160100*    WILL BE PLACED IN THE 2ND BLOCK.                            *16010051
160200*                                                                *16020051
160300*    PERFORMED BY F500-BROWSE.                                   *16030051
160400*----------------------------------------------------------------*16040051
160500                                                                  16050051
160600 G500-SCROLL-FORWARD.                                             16060051
160700                                                                  16070051
160800     MOVE +1                   TO  RV105-BLK-SUB.                 16080051
160900     PERFORM Z150-WRITE-TEMP-STORAGE.                             16090051
161000                                                                  16100051
161100     MOVE RV105-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO          16110051
161200          RV105-BLOCK-ENTRIES(RV105-BLK-SUB).                     16120051
161300                                                                  16130051
161400     COMPUTE PV-TEMP-BLOCK-NUMBER =                               16140051
161500         1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).         16150051
161600                                                                  16160051
161700     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               16170051
161800     ADD +1                    TO  RV105-BLK-SUB.                 16180051
161900     PERFORM Z100-READ-TEMP-STORAGE.                              16190051
162000                                                                  16200051
162100 EJECT                                                            16210051
162200*----------------------------------------------------------------*16220051
162300*    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM     *16230051
162400*    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE      *16240051
162500*    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.   *16250051
162600*    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK*16260051
162700*    OF THE ARRAY.                                               *16270051
162800*                                                                *16280051
162900*    PERFORMED BY F500-BROWSE.                                   *16290051
163000*----------------------------------------------------------------*16300051
163100                                                                  16310051
163200 G600-SCROLL-BACKWARD.                                            16320051
163300                                                                  16330051
163400     MOVE +1                   TO  RV105-BLK-SUB.                 16340051
163500     PERFORM Z150-WRITE-TEMP-STORAGE.                             16350051
163600                                                                  16360051
163700     ADD +1 TO RV105-BLK-SUB.                                     16370051
163800     PERFORM Z150-WRITE-TEMP-STORAGE.                             16380051
163900                                                                  16390051
164000     MOVE +1                   TO  RV105-BLK-SUB.                 16400051
164100     MOVE RV105-BLOCK-ENTRIES(RV105-BLK-SUB) TO                   16410051
164200          RV105-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).            16420051
164300                                                                  16430051
164400     COMPUTE PV-TEMP-BLOCK-NUMBER =                               16440051
164500         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            16450051
164600                                                                  16460051
164700     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                16470051
164800     PERFORM Z100-READ-TEMP-STORAGE.                              16480051
164900                                                                  16490051
165000 EJECT                                                            16500051
165100*----------------------------------------------------------------*16510051
165200*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE     *16520051
165300*    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH *16530051
165400*    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK   *16540051
165500*    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY. *16550051
165600*    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING    *16560051
165700*    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE  *16570051
165800*    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.     *16580051
165900*                                                                *16590051
166000*    PERFORMED BY F500-BROWSE.                                   *16600051
166100*----------------------------------------------------------------*16610051
166200                                                                  16620051
166300 G700-GET-TOP-ITEMS-BLOCK.                                        16630051
166400                                                                  16640051
166500     MOVE +1                   TO  RV105-BLK-SUB.                 16650051
166600     PERFORM Z150-WRITE-TEMP-STORAGE.                             16660051
166700                                                                  16670051
166800     ADD +1                    TO  RV105-BLK-SUB.                 16680051
166900     PERFORM Z150-WRITE-TEMP-STORAGE.                             16690051
167000                                                                  16700051
167100     COMPUTE PV-TEMP-BLOCK-NUMBER =                               16710051
167200         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            16720051
167300                                                                  16730051
167400     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               16740051
167500     MOVE +1                   TO  RV105-BLK-SUB.                 16750051
167600                                                                  16760051
167700     PERFORM Z100-READ-TEMP-STORAGE.                              16770051
167800                                                                  16780051
167900     ADD +1                    TO  PV-BLOCK-NUMBER.               16790051
168000     ADD +1                    TO  RV105-BLK-SUB.                 16800051
168100                                                                  16810051
168200     IF (PV-BLOCK-NUMBER < RV105-HIGHEST-BLOCK-WRITTEN) OR        16820051
168300        (PV-BLOCK-NUMBER = RV105-HIGHEST-BLOCK-WRITTEN)           16830051
168400         PERFORM Z100-READ-TEMP-STORAGE                           16840051
168500     ELSE                                                         16850051
168600         PERFORM I100-INITIALIZE-BLOCK                            16860051
168700     END-IF.                                                      16870051
168800                                                                  16880051
168900 EJECT                                                            16890051
169000*----------------------------------------------------------------*16900051
169100*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE     *16910051
169200*    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE      *16920051
169300*    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE   *16930051
169400*    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,  *16940051
169500*    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ  *16950051
169600*    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK   *16960051
169700*    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.    *16970051
169800*    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.    *16980051
169900*    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST     *16990051
170000*    READ FROM THE DATA BASE.                                    *17000051
170100*                                                                *17010051
170200*    PERFORMED BY F500-BROWSE.                                   *17020051
170300*----------------------------------------------------------------*17030051
170400                                                                  17040051
170500 G800-GET-LAST-BLOCK-IN-TEMP.                                     17050051
170600                                                                  17060051
170700     MOVE +1                   TO  RV105-BLK-SUB.                 17070051
170800     PERFORM Z150-WRITE-TEMP-STORAGE.                             17080051
170900                                                                  17090051
171000     ADD +1                    TO  RV105-BLK-SUB.                 17100051
171100     PERFORM Z150-WRITE-TEMP-STORAGE.                             17110051
171200                                                                  17120051
171300     MOVE RV105-HIGHEST-BLOCK-WRITTEN                             17130051
171400                               TO  PV-BLOCK-NUMBER.               17140051
171500     MOVE +1                   TO  RV105-BLK-SUB.                 17150051
171600     PERFORM Z100-READ-TEMP-STORAGE.                              17160051
171700                                                                  17170051
171800     ADD +1                    TO  RV105-BLK-SUB.                 17180051
171900     PERFORM I100-INITIALIZE-BLOCK.                               17190051
172000                                                                  17200051
172100 EJECT                                                            17210051
172200*----------------------------------------------------------------*17220051
172300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17230051
172400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17240051
172500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17250051
172600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17260051
172700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17270051
172800*                                                                *17280051
172900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17290051
173000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17300051
173100*    UPON INITIALIZATION.                                        *17310051
173200*                                                                *17320051
173300*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *17330051
173400*    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                    *17340051
173500*----------------------------------------------------------------*17350051
173600                                                                  17360051
173700 H100-READ-ITEMS-FROM-DB.                                         17370051
173800                                                                  17380051
173900     PERFORM                                                      17390051
174000         UNTIL  RV105-NO-ITEMS-LEFT-ON-DB                         17400051
174100*         OR    RV105-NUMBER-OF-ITEMS-READ =                      17410051
174200*               PV-HIGHEST-ITEM-TO-BE-READ                        17420051
174300                                                                  17430051
174400         PERFORM L200-FETCH                                       17440051
174500                                                                  17450051
174600         IF  RV105-ITEMS-LEFT-ON-DB                               17460051
174700             IF  RV105-ITEM-SUB < PC-ITEMS-PER-BLOCK              17470051
174800                 ADD +1            TO  RV105-ITEM-SUB             17480051
174900             ELSE                                                 17490051
175000                 ADD +1            TO  RV105-BLK-SUB              17500051
175100                 MOVE +1           TO  RV105-ITEM-SUB             17510051
175200                                                                  17520051
175300                 IF  RV105-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       17530051
175400                     MOVE +1       TO  RV105-BLK-SUB              17540051
175500                     SET RV105-BLOCK-MODIFIED (1)                 17550051
175600                               TO  TRUE                           17560051
175700                     PERFORM Z150-WRITE-TEMP-STORAGE              17570051
175800                     MOVE RV105-BLOCK-ENTRIES                     17580051
175900                               (PC-MAX-BLOCKS-IN-ARRAY)           17590051
176000                     TO   RV105-BLOCK-ENTRIES(RV105-BLK-SUB)      17600051
176100                     ADD +1        TO  RV105-BLK-SUB              17610051
176200                     PERFORM I100-INITIALIZE-BLOCK                17620051
176300                 END-IF                                           17630051
176400             END-IF                                               17640051
176500                                                                  17650051
176600             ADD 1             TO  RV105-NUMBER-OF-ITEMS-READ     17660051
176700                                   PV-ITEMS-READ                  17670051
176800             MOVE RV105-NUMBER-OF-ITEMS-READ                      17680051
176900                               TO  RV105-LIST-ITEM-NUMBER         17690051
177000                                       (RV105-BLK-SUB             17700051
177100                                        RV105-ITEM-SUB)           17710051
177200                                                                  17720051
177300             MOVE DFCTOR-DFCT-ORD-STAT-CDE  TO RV105-STATUS       17730051
177400                              (RV105-BLK-SUB                      17740051
177500                               RV105-ITEM-SUB)                    17750051
177600*            IF DFCTOR-DFCT-ORD-ID-CDE = 'R'                      17760051
177700*                MOVE 'R'      TO RV105-STATUS                    17770051
177800*                                     (RV105-BLK-SUB              17780051
177900*                                      RV105-ITEM-SUB)            17790051
178000*            ELSE                                                 17800051
178100*                EVALUATE DFMEIT-MKOUT-ORD-STAT-CDE               17810051
178200*                    WHEN 'P'                                     17820051
178300*                        MOVE 'P'                                 17830051
178400*                                  TO  RV105-STATUS               17840051
178500*                                          (RV105-BLK-SUB         17850051
178600*                                           RV105-ITEM-SUB)       17860051
178700*                                                                 17870051
178800*                    WHEN 'A'                                     17880051
178900*                        MOVE 'A'                                 17890051
179000*                                  TO  RV105-STATUS               17900051
179100*                                          (RV105-BLK-SUB         17910051
179200*                                           RV105-ITEM-SUB)       17920051
179300*                    WHEN OTHER                                   17930051
179400*                        MOVE 'O'                                 17940051
179500*                                  TO  RV105-STATUS               17950051
179600*                                          (RV105-BLK-SUB         17960051
179700*                                           RV105-ITEM-SUB)       17970051
179800*                END-EVALUATE                                     17980051
179900*            END-IF                                               17990051
180000             MOVE DFMEIT-MKOUT-ORD-ID                             18000051
180100                               TO RV105-AUTH                      18010051
180200                                       (RV105-BLK-SUB             18020051
180300                                        RV105-ITEM-SUB)           18030051
180400             MOVE DFMEIT-RTL-COST-AMT                             18040051
180500                               TO  RV105-URETAIL                  18050051
180600                                       (RV105-BLK-SUB             18060051
180700                                        RV105-ITEM-SUB)           18070051
180800             ADD DFMEIT-RTL-COST-AMT                              18080051
180900                               TO  RV105-TOTAL-RETAIL             18090051
181000                                                                  18100051
181100             MOVE DFMEIT-SEQ-NBR                                  18110051
181200                               TO  RV105-SEQ-NUMBER               18120051
181300                                       (RV105-BLK-SUB             18130051
181400                                        RV105-ITEM-SUB)           18140051
181500                                                                  18150051
181600             MOVE DFMEIT-MDSE-DEPT-NBR                            18160051
181700                               TO  RV105-DEPT                     18170051
181800                                   (RV105-BLK-SUB                 18180051
181900                                    RV105-ITEM-SUB)               18190051
182000             IF  XLT00003-SKU-DESC = 'SKU DELETED'                18200051
182100                 MOVE 'DDDDDDDDDDDDDDD'                           18210051
182200                               TO  RV105-UPCX                     18220051
182300                                   (RV105-BLK-SUB                 18230051
182400                                    RV105-ITEM-SUB)               18240051
182500             ELSE                                                 18250051
182600                 MOVE XLT00006-UPC-NBR                            18260051
182700                               TO  RV105-UPC                      18270051
182800                                   (RV105-BLK-SUB                 18280051
182900                                    RV105-ITEM-SUB)               18290051
183000             END-IF                                               18300051
183100                                                                  18310051
183200                                                                  18320051
183300             MOVE XLT00003-SKU-DESC                               18330051
183400                               TO  RV105-DESC                     18340051
183500                                       (RV105-BLK-SUB             18350051
183600                                        RV105-ITEM-SUB)           18360051
183700                                                                  18370051
183800             MOVE DFMEIT-UNIT-COST-AMT                            18380051
183900                               TO  RV105-UCOST                    18390051
184000                                       (RV105-BLK-SUB             18400051
184100                                        RV105-ITEM-SUB)           18410051
184200             ADD DFMEIT-UNIT-COST-AMT                             18420051
184300                               TO  RV105-TOTAL-COST               18430051
184400                                                                  18440051
184500         END-IF                                                   18450051
184600     END-PERFORM.                                                 18460051
184700                                                                  18470051
184800     IF  RV105-NUMBER-OF-ITEMS-READ EQUAL ZERO                    18480051
184900         SET PS-NO-LIST-ITEMS-FOUND                               18490051
185000                               TO  TRUE                           18500051
185100         SET DP020-MSG-FATAL   TO  TRUE                           18510051
185200         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               18520051
185300     ELSE                                                         18530051
185400         SET PS-LIST-ITEMS-FOUND                                  18540051
185500                               TO  TRUE                           18550051
185600         MOVE DFMEIT-DFCT-ITEM-NBR                                18560051
185700                               TO  RV105-LAST-ITEM-NUMBER         18570051
185800     END-IF.                                                      18580051
185900                                                                  18590051
186000     MOVE +1                   TO  RV105-BLK-SUB.                 18600051
186100     PERFORM Z150-WRITE-TEMP-STORAGE.                             18610051
186200     ADD +1                    TO  RV105-BLK-SUB.                 18620051
186300     PERFORM Z150-WRITE-TEMP-STORAGE.                             18630051
186400                                                                  18640051
186500     MOVE 1                    TO  RV105-BLK-SUB                  18650051
186600                                   PV-BLOCK-NUMBER.               18660051
186700     PERFORM Z100-READ-TEMP-STORAGE.                              18670051
186800     IF  RV105-HIGHEST-BLOCK-WRITTEN GREATER THAN 1               18680051
186900         MOVE 2                TO  RV105-BLK-SUB                  18690051
187000                                   PV-BLOCK-NUMBER                18700051
187100         PERFORM Z100-READ-TEMP-STORAGE                           18710051
187200     END-IF.                                                      18720051
187300                                                                  18730051
187400 EJECT                                                            18740051
187500*----------------------------------------------------------------*18750051
187600*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *18760051
187700*                                                                *18770051
187800*    PERFORMED BY G100-DISPLAY-PANEL.                            *18780051
187900*----------------------------------------------------------------*18790051
188000                                                                  18800051
188100 H200-FORMAT-PANEL-BODY.                                          18810051
188200                                                                  18820051
188300     PERFORM I700-FORMAT-FROM-TO-LINE.                            18830051
188400     PERFORM I200-FORMAT-LIST-LINES.                              18840051
188500                                                                  18850051
188600     IF NOT DP020-NEXT-ACT-ERROR                                  18860051
188700         PERFORM I800-SET-CURSOR-POSITION                         18870051
188800     END-IF.                                                      18880051
188900                                                                  18890051
189000 EJECT                                                            18900051
189100*----------------------------------------------------------------*18910051
189200*    INITIALIZE A BLOCK IN THE ARRAY.                            *18920051
189300*                                                                *18930051
189400*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *18940051
189500*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *18950051
189600*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *18960051
189700*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                       *18970051
189800*----------------------------------------------------------------*18980051
189900                                                                  18990051
190000 I100-INITIALIZE-BLOCK.                                           19000051
190100                                                                  19010051
190200     INITIALIZE  RV105-BLOCK-ENTRIES (RV105-BLK-SUB).             19020051
190300     SET RV105-BLOCK-NOT-MODIFIED(RV105-BLK-SUB) TO TRUE.         19030051
190400 EJECT                                                            19040051
190500*----------------------------------------------------------------*19050051
190600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19060051
190700*                                                                *19070051
190800*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *19080051
190900*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *19090051
191000*----------------------------------------------------------------*19100051
191100                                                                  19110051
191200 I200-FORMAT-LIST-LINES.                                          19120051
191300                                                                  19130051
191400     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            19140051
191500         (RV105-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   19150051
191600                                                                  19160051
191700     MOVE RV105-ITEM-AT-TOP-OF-PANEL                              19170051
191800                               TO  PV-ITEM-IN-USE.                19180051
191900     MOVE +1                   TO  PS-SUB.                        19190051
192000                                                                  19200051
192100     PERFORM J100-PROCESS-ITEMS                                   19210051
192200         UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.          19220051
192300                                                                  19230051
192400 EJECT                                                            19240051
192500*----------------------------------------------------------------*19250051
192600*    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE *19260051
192700*    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE   *19270051
192800*    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE   *19280051
192900*    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.              *19290051
193000*                                                                *19300051
193100*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *19310051
193200*----------------------------------------------------------------*19320051
193300                                                                  19330051
193400 I700-FORMAT-FROM-TO-LINE.                                        19340051
193500                                                                  19350051
193600     MOVE RV105-ITEM-AT-TOP-OF-PANEL                              19360051
193700                               TO  ASTRTITO.                      19370051
193800                                                                  19380051
193900                                                                  19390051
194000     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            19400051
194100         (RV105-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   19410051
194200                                                                  19420051
194300     IF PV-ENDING-ITEM-ON-PANEL < RV105-NUMBER-OF-ITEMS-READ      19430051
194400         MOVE PV-ENDING-ITEM-ON-PANEL                             19440051
194500                               TO  AENDITO                        19450051
194600     ELSE                                                         19460051
194700         MOVE RV105-NUMBER-OF-ITEMS-READ                          19470051
194800                               TO  AENDITO                        19480051
194900     END-IF.                                                      19490051
195000                                                                  19500051
195100     MOVE RV105-NUMBER-OF-ITEMS-READ                              19510051
195200                               TO  ATOTITO                        19520051
195300                                   ATOTALO.                       19530051
195400 EJECT                                                            19540051
195500*----------------------------------------------------------------*19550051
195600*    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR  *19560051
195700*    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF   *19570051
195800*    THE SELECTION ENTRIES.                                      *19580051
195900*                                                                *19590051
196000*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *19600051
196100*----------------------------------------------------------------*19610051
196200                                                                  19620051
196300 I800-SET-CURSOR-POSITION.                                        19630051
196400                                                                  19640051
196500     IF RV105-NUMBER-OF-ITEMS-READ = +0                           19650051
196600     AND DP020-MSG-NUMBER NOT NUMERIC                             19660051
196700         MOVE -1               TO  ANAVCMDL                       19670051
196800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19680051
196900         SET DP020-MSG-WARNING TO  TRUE                           19690051
197000     END-IF.                                                      19700051
197100                                                                  19710051
197200                                                                  19720051
197300 EJECT                                                            19730051
197400*----------------------------------------------------------------*19740051
197500*    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.      *19750051
197600*    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF    *19760051
197700*    MAP ENTRIES.                                                *19770051
197800*                                                                *19780051
197900*    PERFORMED BY I200-FORMAT-LIST-LINES.                        *19790051
198000*----------------------------------------------------------------*19800051
198100                                                                  19810051
198200 J100-PROCESS-ITEMS.                                              19820051
198300                                                                  19830051
198400     IF (PV-ITEM-IN-USE < RV105-NUMBER-OF-ITEMS-READ) OR          19840051
198500        (PV-ITEM-IN-USE = RV105-NUMBER-OF-ITEMS-READ)             19850051
198600         PERFORM K100-SET-SUBSCRIPTS                              19860051
198700                                                                  19870051
198800         IF (PS-SEND-MAP-N-DATA-FRSET)                            19880051
198900         OR (PS-DIFFERENT-ITEMS-DISPLAYED)                        19890051
199000                                                                  19900051
199100            MOVE RV105-STATUS      (RV105-BLK-SUB RV105-ITEM-SUB) 19910051
199200                               TO  RVKM105-STATUS        (PS-SUB) 19920051
199300                                                                  19930051
199400            MOVE RV105-AUTH        (RV105-BLK-SUB RV105-ITEM-SUB) 19940051
199500                               TO  RVKM105-AUTH          (PS-SUB) 19950051
199600                                                                  19960051
199700            MOVE RV105-DEPT        (RV105-BLK-SUB RV105-ITEM-SUB) 19970051
199800                               TO  RVKM105-DEPT          (PS-SUB) 19980051
199900            MOVE RV105-UPCX        (RV105-BLK-SUB RV105-ITEM-SUB) 19990051
200000                               TO  RVKM105-UPC           (PS-SUB) 20000051
200100                                                                  20010051
200200                                                                  20020051
200300            MOVE RV105-DESC        (RV105-BLK-SUB RV105-ITEM-SUB) 20030051
200400                               TO  RVKM105-DESC          (PS-SUB) 20040051
200500                                                                  20050051
200600            MOVE RV105-UCOST       (RV105-BLK-SUB RV105-ITEM-SUB) 20060051
200700                               TO  RVKM105-UCOST         (PS-SUB) 20070051
200800                                                                  20080051
200900            MOVE RV105-URETAIL     (RV105-BLK-SUB RV105-ITEM-SUB) 20090051
201000                               TO  RVKM105-URETAIL       (PS-SUB) 20100051
201100         END-IF                                                   20110051
201200                                                                  20120051
201300     ELSE                                                         20130051
201400                                                                  20140051
201500         IF (PS-SEND-MAP-N-DATA-FRSET                             20150051
201600         OR  PS-DIFFERENT-ITEMS-DISPLAYED)                        20160051
201700             MOVE SPACES       TO  RVKM105-STATUS        (PS-SUB) 20170051
201800                                   RVKM105-AUTHX         (PS-SUB) 20180051
201900                                   RVKM105-DEPT          (PS-SUB) 20190051
202000                                   RVKM105-UPC           (PS-SUB) 20200051
202100                                   RVKM105-DESC          (PS-SUB) 20210051
202200                                   RVKM105-UCOSTX        (PS-SUB) 20220051
202300                                   RVKM105-URETAILX      (PS-SUB) 20230051
202400         END-IF                                                   20240051
202500                                                                  20250051
202600     END-IF.                                                      20260051
202700                                                                  20270051
202800     ADD +1 TO PV-ITEM-IN-USE.                                    20280051
202900     ADD +1 TO PS-SUB.                                            20290051
203000                                                                  20300051
203100 EJECT                                                            20310051
203200*----------------------------------------------------------------*20320051
203300*    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT        *20330051
203400*    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.    *20340051
203500*    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR   *20350051
203600*    TO THE 1ST SELECTION ENTRY IN THE MAP.                      *20360051
203700*                                                                *20370051
203800*    PERFORMED BY I800-SET-CURSOR-POSITION.                      *20380051
203900*----------------------------------------------------------------*20390051
204000                                                                  20400051
204100*J200-FIND-LAST-SELECTION.                                        20410051
204200*                                                                 20420051
204300*    MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                           20430051
204400*                                                                 20440051
204500*    SET PS-NO-SELECTION-FOUND TO TRUE.                           20450051
204600*                                                                 20460051
204700*    PERFORM                                                      20470051
204800*        UNTIL (PS-SUB = +1)                                      20480051
204900*           OR (PS-SELECTION-FOUND)                               20490051
205000*                                                                 20500051
205100*        IF (RVKM105-SELECTI(PS-SUB) NOT EQUAL SPACES             20510051
205200*        AND RVKM105-SELECTI(PS-SUB) NOT EQUAL LOW-VALUE)         20520051
205300*            SET PS-SELECTION-FOUND                               20530051
205400*                              TO  TRUE                           20540051
205500*        ELSE                                                     20550051
205600*            SUBTRACT +1     FROM  PS-SUB                         20560051
205700*        END-IF                                                   20570051
205800*    END-PERFORM.                                                 20580051
205900*                                                                 20590051
206000*    MOVE -1                 TO  RVKM105-SELECTL(PS-SUB).         20600051
206100*                                                                 20610051
206200*EJECT                                                            20620051
206300*----------------------------------------------------------------*20630051
206400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *20640051
206500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*20650051
206600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *20660051
206700*                                                                *20670051
206800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *20680051
206900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *20690051
207000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *20700051
207100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *20710051
207200*                                                                *20720051
207300*    PERFORMED BY E100-EDIT-SELECTIONS.                          *20730051
207400*    PERFORMED BY F100-EDIT.                                     *20740051
207500*    PERFORMED BY F300-CHECK-SELECTIONS.                         *20750051
207600*    PERFORMED BY J100-PROCESS-ITEMS.                            *20760051
207700*----------------------------------------------------------------*20770051
207800                                                                  20780051
207900 K100-SET-SUBSCRIPTS.                                             20790051
208000                                                                  20800051
208100     COMPUTE PS-ITEM-SUB =                                        20810051
208200         (PV-ITEM-IN-USE - RV105-LIST-ITEM-NUMBER(1 1)) + 1.      20820051
208300                                                                  20830051
208400     MOVE PS-ITEM-SUB TO RV105-ITEM-SUB.                          20840051
208500                                                                  20850051
208600     IF RV105-ITEM-SUB > PC-ITEMS-PER-BLOCK                       20860051
208700         SUBTRACT PC-ITEMS-PER-BLOCK FROM RV105-ITEM-SUB          20870051
208800                                                                  20880051
208900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO RV105-BLK-SUB             20890051
209000     ELSE                                                         20900051
209100         MOVE +1                     TO RV105-BLK-SUB             20910051
209200     END-IF.                                                      20920051
209300                                                                  20930051
209400 EJECT                                                            20940051
209500*----------------------------------------------------------------*20950051
209600*    OPEN THE TMESSAGE CURSOR.                                   *20960051
209700*                                                                *20970051
209800*    PERFORMED BY D100-SETUP-INITIAL-PANEL                       *20980051
209900*                 G400-READ-ITEMS-INTO-ARRAY.                    *20990051
210000*----------------------------------------------------------------*21000051
210100                                                                  21010051
210200 L100-OPEN-CURSOR.                                                21020051
210300                                                                  21030051
210400     MOVE RV100-UK-RA-NUMBER TO  DFMEIT-DFCT-ORD-ID               21040051
210500                                                                  21050051
210600     PERFORM                                                      21060051
210700         WITH TEST AFTER                                          21070051
210800         VARYING PV-SQL-SUB                                       21080051
210900         FROM 1 BY 1                                              21090051
211000         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             21100051
211100            OR SQLCODE = 0                                        21110051
211200            OR SQLCODE = +100                                     21120051
211300                                                                  21130051
211400         EXEC SQL                                                 21140051
211500              OPEN ITEM-NUMBER-CSR                                21150051
211600         END-EXEC                                                 21160051
211700                                                                  21170051
211800                                                                  21180051
211900         EVALUATE TRUE                                            21190051
212000             WHEN SQLCODE = ZERO                                  21200051
212100             WHEN SQLCODE = +100                                  21210051
212200             WHEN SQLCODE = -913                                  21220051
212300             WHEN SQLCODE = -904                                  21230051
212400                  CONTINUE                                        21240051
212500             WHEN SQLWARN0 NOT EQUAL SPACE                        21250051
212600             WHEN SQLCODE NOT EQUAL ZERO                          21260051
212700                  MOVE 'L100-OPEN-CURSOR'                         21270051
212800                               TO  DP013-PARAGRAPH                21280051
212900                  MOVE 'OPEN RTV CURSOR'                          21290051
213000                               TO  DP013-MESSAGE-TEXT (1)         21300051
213100                  MOVE SQLCA   TO  DP013-SQLCA                    21310051
213200                  SET DP013-DB2-ABEND                             21320051
213300                               TO  TRUE                           21330051
213400                  PERFORM DP013-0000-PROCESS-ABEND                21340051
213500         END-EVALUATE                                             21350051
213600     END-PERFORM.                                                 21360051
213700                                                                  21370051
213800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   21380051
213900         MOVE 'L100-OPEN-CURSOR'                                  21390051
214000                               TO  DP013-PARAGRAPH                21400051
214100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              21410051
214200                               TO  DP013-MESSAGE-TEXT (1)         21420051
214300         MOVE SQLCA            TO  DP013-SQLCA                    21430051
214400         SET DP013-DB2-ABEND   TO  TRUE                           21440051
214500         PERFORM DP013-0000-PROCESS-ABEND                         21450051
214600     END-IF.                                                      21460051
214700                                                                  21470051
214800 EJECT                                                            21480051
214900*----------------------------------------------------------------*21490051
215000*    OBTAIN THE NEXT ROW FOR THE APPROPRIATE CURSOR.             *21500051
215100*                                                                *21510051
215200*    PERFORMED BY H100                                           *21520051
215300*----------------------------------------------------------------*21530051
215400                                                                  21540051
215500 L200-FETCH.                                                      21550051
215600                                                                  21560051
215700     EXEC SQL                                                     21570051
215800          FETCH                                                   21580051
215900                ITEM-NUMBER-CSR                                   21590051
216000           INTO                                                   21600051
216100                :DFMEIT-DFCT-ITEM-NBR                             21610051
216200              , :DFMEIT-SEQ-NBR                                   21620051
216300              , :DFMEIT-RTL-COST-AMT                              21630051
216400              , :DFMEIT-UNIT-COST-AMT                             21640051
216500              , :DFMEIT-MKOUT-ORD-ID                              21650051
216600              , :DFMEIT-MKOUT-ORD-STAT-CDE                        21660051
216700              , :DFMEIT-MDSE-DEPT-NBR                             21670051
216800              , :DFMEIT-MDSE-CLASS-NBR                            21680051
216900              , :XLT00003-SKU-NBR                                 21690051
217000              , :XLT00006-UPC-NBR                                 21700051
217100              , :XLT00003-SKU-DESC                                21710051
217200     END-EXEC.                                                    21720051
217300                                                                  21730051
217400     EVALUATE TRUE                                                21740051
217500         WHEN SQLCODE = ZERO                                      21750051
217600         WHEN SQLCODE = +100                                      21760051
217700              CONTINUE                                            21770051
217800         WHEN SQLWARN0 NOT EQUAL SPACE                            21780051
217900         WHEN SQLCODE NOT EQUAL ZERO                              21790051
218000              MOVE 'L200-FETCH-CURSOR'                            21800051
218100                               TO  DP013-PARAGRAPH                21810051
218200              MOVE 'FETCH ITEM CURSOR'                            21820051
218300                               TO  DP013-MESSAGE-TEXT (1)         21830051
218400              MOVE SQLCA       TO  DP013-SQLCA                    21840051
218500              SET DP013-DB2-ABEND                                 21850051
218600                               TO  TRUE                           21860051
218700              PERFORM DP013-0000-PROCESS-ABEND                    21870051
218800     END-EVALUATE.                                                21880051
218900                                                                  21890051
219000     IF  SQLCODE EQUAL +100                                       21900051
219100         SET RV105-NO-ITEMS-LEFT-ON-DB                            21910051
219200                               TO  TRUE                           21920051
219300     END-IF.                                                      21930051
219400                                                                  21940051
219500 EJECT                                                            21950051
219600*----------------------------------------------------------------*21960051
219700*    DELETE THE TEMPORARY STORAGE QUEUE.                         *21970051
219800*                                                                *21980051
219900*    PERFORMED BY C300-PROCESS-PANEL.                            *21990051
220000*----------------------------------------------------------------*22000051
220100                                                                  22010051
220200 Z050-DELETE-TEMP-STORAGE.                                        22020051
220300                                                                  22030051
220400     EXEC CICS                                                    22040051
220500         DELETEQ TS                                               22050051
220600         QUEUE(RV105-TEMP-QUEUE-NAME)                             22060051
220700         RESP(PV-RESP)                                            22070051
220800     END-EXEC.                                                    22080051
220900                                                                  22090051
221000     IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                       22100051
221100        (PV-RESP NOT = DFHRESP(QIDERR))                           22110051
221200         MOVE PV-RESP TO PM-RESP-23                               22120051
221300                                                                  22130051
221400         SET DP013-LOGIC-ABEND TO TRUE                            22140051
221500         SET DP013-NO-ROLLBACK TO TRUE                            22150051
221600                                                                  22160051
221700         MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH       22170051
221800         MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1) 22180051
221900                                                                  22190051
222000         PERFORM DP013-0000-PROCESS-ABEND                         22200051
222100     END-IF.                                                      22210051
222200                                                                  22220051
222300     MOVE +0 TO RV105-HIGHEST-BLOCK-WRITTEN.                      22230051
222400                                                                  22240051
222500 EJECT                                                            22250051
222600*----------------------------------------------------------------*22260051
222700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22270051
222800*                                                                *22280051
222900*    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                      *22290051
223000*    PERFORMED BY G500-SCROLL-FORWARD.                           *22300051
223100*    PERFORMED BY G600-SCROLL-BACKWARD.                          *22310051
223200*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *22320051
223300*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *22330051
223400*----------------------------------------------------------------*22340051
223500                                                                  22350051
223600 Z100-READ-TEMP-STORAGE.                                          22360051
223700                                                                  22370051
223800     EXEC CICS                                                    22380051
223900         READQ TS                                                 22390051
224000         QUEUE(RV105-TEMP-QUEUE-NAME)                             22400051
224100         INTO(RV105-BLOCK-ENTRIES(RV105-BLK-SUB))                 22410051
224200         LENGTH(PC-BLOCK-LENGTH)                                  22420051
224300         ITEM(PV-BLOCK-NUMBER)                                    22430051
224400         RESP(PV-RESP)                                            22440051
224500     END-EXEC.                                                    22450051
224600                                                                  22460051
224700     IF PV-RESP NOT = DFHRESP(NORMAL)                             22470051
224800         MOVE PV-RESP          TO  PM-RESP-24                     22480051
224900         EXEC CICS                                                22490051
225000              DELETEQ TS                                          22500051
225100              QUEUE(RV105-TEMP-QUEUE-NAME)                        22510051
225200              RESP(PV-RESP)                                       22520051
225300         END-EXEC                                                 22530051
225400         SET DP013-LOGIC-ABEND TO  TRUE                           22540051
225500         SET DP013-NO-ROLLBACK TO  TRUE                           22550051
225600         MOVE 'Z100-READ-TEMP-STORAGE'                            22560051
225700                               TO  DP013-PARAGRAPH                22570051
225800         MOVE PM-PROGRAM-MESSAGE-24                               22580051
225900                               TO  DP013-MESSAGE-TEXT(1)          22590051
226000         PERFORM DP013-0000-PROCESS-ABEND                         22600051
226100     END-IF.                                                      22610051
226200                                                                  22620051
226300     SET RV105-BLOCK-NOT-MODIFIED(RV105-BLK-SUB) TO TRUE.         22630051
226400                                                                  22640051
226500 EJECT                                                            22650051
226600*----------------------------------------------------------------*22660051
226700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22670051
226800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22680051
226900*                                                                *22690051
227000*    PERFORMED BY E300-NAVIGATE.                                 *22700051
227100*    PERFORMED BY G500-SCROLL-FORWARD.                           *22710051
227200*    PERFORMED BY G600-SCROLL-BACKWARD.                          *22720051
227300*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *22730051
227400*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *22740051
227500*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                       *22750051
227600*----------------------------------------------------------------*22760051
227700                                                                  22770051
227800 Z150-WRITE-TEMP-STORAGE.                                         22780051
227900                                                                  22790051
228000     IF RV105-HIGHEST-BLOCK-WRITTEN = +0                          22800051
228100         MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER          22810051
228200         MOVE EIBTASKN         TO  RV105-TASK-NUMBER              22820051
228300         MOVE EIBTRMID         TO  RV105-TERM-ID                  22830051
228400     END-IF.                                                      22840051
228500                                                                  22850051
228600     MOVE RV105-LIST-ITEM-NUMBER(RV105-BLK-SUB 1)                 22860051
228700                               TO  PV-LIST-ITEM-NUMBER.           22870051
228800     COMPUTE PV-BLOCK-NUMBER =                                    22880051
228900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).    22890051
229000                                                                  22900051
229100     IF (PV-BLOCK-NUMBER < RV105-HIGHEST-BLOCK-WRITTEN)           22910051
229200     OR (PV-BLOCK-NUMBER = RV105-HIGHEST-BLOCK-WRITTEN)           22920051
229300         IF  RV105-BLOCK-MODIFIED(RV105-BLK-SUB)                  22930051
229400             EXEC CICS                                            22940051
229500                 WRITEQ TS                                        22950051
229600                 QUEUE(RV105-TEMP-QUEUE-NAME)                     22960051
229700                 FROM(RV105-BLOCK-ENTRIES(RV105-BLK-SUB))         22970051
229800                 LENGTH(PC-BLOCK-LENGTH)                          22980051
229900                 ITEM(PV-BLOCK-NUMBER)                            22990051
230000                 REWRITE                                          23000051
230100                 RESP(PV-RESP)                                    23010051
230200             END-EXEC                                             23020051
230300                                                                  23030051
230400             IF  PV-RESP NOT = DFHRESP(NORMAL)                    23040051
230500                 MOVE PV-RESP  TO  PM-RESP-9                      23050051
230600                 MOVE PV-BLOCK-NUMBER TO PV-DISPLAY-S9            23060051
230700                 MOVE PV-DISPLAY-S9 TO DP013-MESSAGE-TEXT(2)      23070051
230800*VML             EXEC CICS                                        23080051
230900*VML                 DELETEQ TS                                   23090051
231000*VML                 QUEUE(RV105-TEMP-QUEUE-NAME)                 23100051
231100*VML                 RESP(PV-RESP)                                23110051
231200*VML             END-EXEC                                         23120051
231300                                                                  23130051
231400                 SET DP013-LOGIC-ABEND                            23140051
231500                               TO  TRUE                           23150051
231600                 SET DP013-NO-ROLLBACK                            23160051
231700                               TO  TRUE                           23170051
231800                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   23180051
231900                               TO  DP013-PARAGRAPH                23190051
232000                 MOVE PM-PROGRAM-MESSAGE-9                        23200051
232100                               TO  DP013-MESSAGE-TEXT(1)          23210051
232200                 PERFORM DP013-0000-PROCESS-ABEND                 23220051
232300             END-IF                                               23230051
232400         END-IF                                                   23240051
232500     ELSE                                                         23250051
232600                                                                  23260051
232700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23270051
232800             RV105-HIGHEST-BLOCK-WRITTEN + 1                      23280051
232900         IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN           23290051
233000             EXEC CICS                                            23300051
233100                 WRITEQ TS                                        23310051
233200                 QUEUE(RV105-TEMP-QUEUE-NAME)                     23320051
233300                 FROM(RV105-BLOCK-ENTRIES(RV105-BLK-SUB))         23330051
233400                 LENGTH(PC-BLOCK-LENGTH)                          23340051
233500                 ITEM(PV-BLOCK-NUMBER)                            23350051
233600                 RESP(PV-RESP)                                    23360051
233700             END-EXEC                                             23370051
233800                                                                  23380051
233900             IF  PV-RESP NOT = DFHRESP(NORMAL)                    23390051
234000                 MOVE PV-RESP  TO  PM-RESP-10                     23400051
234100                 EXEC CICS                                        23410051
234200                     DELETEQ TS                                   23420051
234300                     QUEUE(RV105-TEMP-QUEUE-NAME)                 23430051
234400                     RESP(PV-RESP)                                23440051
234500                 END-EXEC                                         23450051
234600                                                                  23460051
234700                 SET DP013-LOGIC-ABEND                            23470051
234800                               TO  TRUE                           23480051
234900                 SET DP013-NO-ROLLBACK                            23490051
235000                               TO  TRUE                           23500051
235100                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   23510051
235200                               TO  DP013-PARAGRAPH                23520051
235300                 MOVE PM-PROGRAM-MESSAGE-10                       23530051
235400                               TO  DP013-MESSAGE-TEXT(1)          23540051
235500                 PERFORM DP013-0000-PROCESS-ABEND                 23550051
235600             END-IF                                               23560051
235700             ADD +1            TO  RV105-HIGHEST-BLOCK-WRITTEN    23570051
235800         ELSE                                                     23580051
235900             SET DP013-LOGIC-ABEND                                23590051
236000                               TO  TRUE                           23600051
236100             SET DP013-NO-ROLLBACK                                23610051
236200                               TO  TRUE                           23620051
236300             MOVE 'Z150-WRITE-TEMP-STORAGE'                       23630051
236400                               TO  DP013-PARAGRAPH                23640051
236500             MOVE PV-BLOCK-NUMBER                                 23650051
236600                               TO  PM-BLOCK-NUMBER                23660051
236700             MOVE PM-PROGRAM-MESSAGE-11                           23670051
236800                               TO  DP013-MESSAGE-TEXT(1)          23680051
236900             PERFORM DP013-0000-PROCESS-ABEND                     23690051
237000         END-IF                                                   23700051
237100     END-IF.                                                      23710051
237200                                                                  23720051
237300     SET RV105-BLOCK-NOT-MODIFIED(RV105-BLK-SUB) TO TRUE.         23730051
237400                                                                  23740051
237500 EJECT                                                            23750051
237600*----------------------------------------------------------------*23760051
237700*    FILL IN SCREEN HEADER MODULE                                *23770051
237800*----------------------------------------------------------------*23780051
237900                                                                  23790051
238000     COPY DPPD022.                                                23800051
238100 EJECT                                                            23810051
238200*----------------------------------------------------------------*23820051
238300*    RETURN TO CICS MODULE                                       *23830051
238400*----------------------------------------------------------------*23840051
238500                                                                  23850051
238600     COPY DPPD003.                                                23860051
238700 EJECT                                                            23870051
238800*----------------------------------------------------------------*23880051
238900*    FORMAT MESSAGE LINES MODULE                                 *23890051
239000*----------------------------------------------------------------*23900051
239100                                                                  23910051
239200     COPY DPPD005.                                                23920051
239300 EJECT                                                            23930051
239400*----------------------------------------------------------------*23940051
239500*    GET PANEL MODULE                                            *23950051
239600*----------------------------------------------------------------*23960051
239700                                                                  23970051
239800     COPY DPPD007.                                                23980051
239900 EJECT                                                            23990051
240000*----------------------------------------------------------------*24000051
240100*    WRITE PANEL MODULE                                          *24010051
240200*----------------------------------------------------------------*24020051
240300                                                                  24030051
240400     COPY DPPD008.                                                24040051
240500 EJECT                                                            24050051
240600*----------------------------------------------------------------*24060051
240700*    TOGGLE THE FUNCTION KEY LINE MODULE                         *24070051
240800*----------------------------------------------------------------*24080051
240900                                                                  24090051
241000     COPY DPPD009.                                                24100051
241100 EJECT                                                            24110051
241200*----------------------------------------------------------------*24120051
241300*    ABEND PROCESSOR MODULE                                      *24130051
241400*----------------------------------------------------------------*24140051
241500                                                                  24150051
241600     COPY DPPD013.                                                24160051
241700 EJECT                                                            24170051
241800*----------------------------------------------------------------*24180051
241900*    CHECK COMMUNICATION AREA MODULE                             *24190051
242000*----------------------------------------------------------------*24200051
242100                                                                  24210051
242200     COPY DPPD015.                                                24220051
242300 EJECT                                                            24230051
242400*----------------------------------------------------------------*24240051
242500*    UPDATE TIME AND DATE MODULE                                 *24250051
242600*----------------------------------------------------------------*24260051
242700                                                                  24270051
242800     COPY DPPD017.                                                24280051
242900 EJECT                                                            24290051
