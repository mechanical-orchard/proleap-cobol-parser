000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SVKRP033.                                00030000
000400 AUTHOR.                 DANIEL OKYERE.                           00040000
000500 INSTALLATION.           KOHLS.                                   00050000
000600 DATE-WRITTEN            SEPTEMBER 2004.                          00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*  SAFEWAY/STORED VALUE SETTLEMENT REPORTING                     *00100000
001100******************************************************************00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 CONFIGURATION SECTION.                                           00130000
001400                                                                  00140000
001500 SOURCE-COMPUTER.        IBM-3090.                                00150000
001600 OBJECT-COMPUTER.        IBM-3090.                                00160000
001700                                                                  00170000
001800 INPUT-OUTPUT SECTION.                                            00180000
001900                                                                  00190000
002000 FILE-CONTROL.                                                    00200000
002100     SELECT DATE-CARD-FILE                                        00210000
002200         ASSIGN TO INP01.                                         00220000
002300                                                                  00230000
002400     SELECT REPORT-FILE-IN                                        00240000
002500         ASSIGN TO INP02.                                         00250000
002600                                                                  00260000
002700     SELECT SETTLED-REPORT                                        00270000
002800         ASSIGN TO RPT01.                                         00280000
002900                                                                  00290000
003000     SELECT UNSETTLED-REPORT                                      00300000
003100         ASSIGN TO RPT02.                                         00310000
003101                                                                  00310100
003102     SELECT SETTLED-CSV-FILE                                      00310200
003103         ASSIGN TO CSV01.                                         00310300
003200                                                                  00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700 FD  DATE-CARD-FILE                                               00370000
003800     RECORDING MODE IS F                                          00380000
003900     BLOCK CONTAINS 0 RECORDS                                     00390000
004000     LABEL RECORDS ARE STANDARD.                                  00400000
004100                                                                  00410000
004200 01  DATE-CARD-RECORD                       PIC X(80).            00420000
004300                                                                  00430000
004400 FD  REPORT-FILE-IN                                               00440000
004500     RECORDING MODE IS F                                          00450000
004600     BLOCK CONTAINS 0 RECORDS                                     00460000
004700     LABEL RECORDS ARE STANDARD.                                  00470000
004800                                                                  00480000
004900 01  REPORT-RECORD                          PIC X(110).           00490000
005000                                                                  00500000
005100 FD  SETTLED-REPORT                                               00510000
005200     RECORDING MODE IS F                                          00520000
005300     BLOCK CONTAINS 0 RECORDS                                     00530000
005400     LABEL RECORDS ARE STANDARD.                                  00540000
005500                                                                  00550000
005600 01  SETTLED-RECORD                         PIC X(132).           00560000
005700                                                                  00570000
005800 FD  UNSETTLED-REPORT                                             00580000
005900     RECORDING MODE IS F                                          00590000
006000     LABEL RECORDS ARE STANDARD                                   00600000
006100     BLOCK CONTAINS 0 RECORDS.                                    00610000
006200                                                                  00620000
006300 01  UNSETTLED-RECORD                       PIC X(132).           00630000
006301                                                                  00630100
006302 FD  SETTLED-CSV-FILE                                             00630200
006303     RECORDING MODE IS F                                          00630300
006304     BLOCK CONTAINS 0 RECORDS                                     00630400
006305     LABEL RECORDS ARE STANDARD.                                  00630500
006306                                                                  00630600
006307 01  SETTLED-CSV-RECORD                     PIC X(132).           00630700
006400                                                                  00640000
006500******************************************************************00650000
006600 WORKING-STORAGE SECTION.                                         00660000
006700******************************************************************00670000
006800                                                                  00680000
006900******************************************************************00690000
007000*  SAFEWAY REPORT  RECORD LAYOUT                                 *00700000
007100******************************************************************00710000
007200     COPY SVRD054.                                                00720000
007300                                                                  00730000
007400******************************************************************00740000
007500*  KOHL'S STANDARD REPORT HEADING                                *00750000
007600******************************************************************00760000
007700     COPY DPWS132.                                                00770000
007800                                                                  00780000
007900 01  RP1-HEADING-LINE-2.                                          00790000
008000     05  FILLER                       PIC  X(46)  VALUE SPACES.   00800000
008100     05  RP1-SUBTITLE.                                            00810000
008200         10  FILLER                   PIC  X(05)  VALUE SPACES.   00820000
008300         10  RP1-SUBNAME              PIC  X(24)  VALUE SPACES.   00830000
008400     05  FILLER                       PIC  X(01)  VALUE SPACES.   00840000
008500     05  RP1-DATE.                                                00850000
008600         10  RP1-DATE-MM              PIC  X(02).                 00860000
008700         10  FILLER                   PIC  X(01)  VALUE '/'.      00870000
008800         10  RP1-DATE-DD              PIC  X(02).                 00880000
008900         10  FILLER                   PIC  X(01)  VALUE '/'.      00890000
009000         10  RP1-DATE-CC              PIC  X(02).                 00900000
009100         10  RP1-DATE-YY              PIC  X(02).                 00910000
009200     05  FILLER                       PIC  X(46)  VALUE SPACES.   00920000
009300                                                                  00930000
009400 01  RP1-HEADING-LINE-3.                                          00940000
009500     05  FILLER                       PIC  X(42)  VALUE SPACES.   00950000
009600     05  FILLER                       PIC  X(53)  VALUE           00960000
009700        'APPROVED   ----------------SAFEWAY-------------------'.  00970000
009800     05  FILLER                       PIC  X(37)  VALUE SPACES.   00980000
009900                                                                  00990000
010000 01  RP1-HEADING-LINE-4.                                          01000000
010100     05  FILLER                       PIC  X(01)  VALUE SPACE.    01010000
010200     05  FILLER                       PIC  X(10)  VALUE           01020000
010300                                          'TRANS DATE'.           01030000
010400     05  FILLER                       PIC  X(05)  VALUE SPACES.   01040000
010500     05  FILLER                       PIC  X(07)  VALUE 'CARD ID'.01050000
010600     05  FILLER                       PIC  X(07)  VALUE SPACES.   01060000
010700     05  FILLER                       PIC  X(04)  VALUE 'TYPE'.   01070000
010800     05  FILLER                       PIC  X(04)  VALUE SPACES.   01080000
010900     05  FILLER                       PIC  X(09)  VALUE           01090000
011000                                          'TRANS AMT'.            01100000
011100     05  FILLER                       PIC  X(02)  VALUE SPACES.   01110000
011200     05  FILLER                       PIC  X(05)  VALUE 'STORE'.  01120000
011300     05  FILLER                       PIC  X(02)  VALUE SPACES.   01130000
011400     05  FILLER                       PIC  X(08)  VALUE           01140000
011500                                          'REGISTER'.             01150000
011600     05  FILLER                       PIC  X(02)  VALUE SPACES.   01160000
011700     05  FILLER                       PIC  X(08)  VALUE           01170000
011800                                          'DIVISION'.             01180000
011900     05  FILLER                       PIC  X(02)  VALUE SPACES.   01190000
012000     05  FILLER                       PIC  X(05)  VALUE 'STATE'.  01200000
012100     05  FILLER                       PIC  X(02)  VALUE SPACES.   01210000
012200     05  FILLER                       PIC  X(08)  VALUE           01220000
012300                                          'ZIP CODE'.             01230000
012400     05  FILLER                       PIC  X(03)  VALUE SPACES.   01240000
012500     05  RP1-COMMENT-LINE             PIC  X(38)  VALUE SPACES.   01250000
012600                                                                  01260000
012700 01  RP1-DETAIL-LINE.                                             01270000
012800     05  FILLER                       PIC  X(01)  VALUE SPACE.    01280000
012900     05  RP1-TRANS-DATE               PIC  X(10)  VALUE SPACES.   01290000
013000     05  FILLER                       PIC  X(03)  VALUE SPACES.   01300000
013100     05  RP1-CARD-ID                  PIC  ZZ9999999999.          01310000
013200     05  FILLER                       PIC  X(02)  VALUE SPACES.   01320000
013300     05  RP1-CARD-TYPE                PIC  X(08)  VALUE SPACES.   01330000
013400     05  FILLER                       PIC  X(02)  VALUE SPACES.   01340000
013500     05  RP1-TRANS-AMT                PIC  ZZ,Z99.99-.            01350000
013600     05  FILLER                       PIC  X(02)  VALUE SPACES.   01360000
013700     05  RP1-STORE                    PIC  X(05)  VALUE SPACES.   01370000
013800     05  FILLER                       PIC  X(03)  VALUE SPACES.   01380000
013900     05  RP1-REGISTER                 PIC  X(04)  VALUE SPACES.   01390000
014000     05  FILLER                       PIC  X(07)  VALUE SPACES.   01400000
014100     05  RP1-DIVISION                 PIC  X(05)  VALUE SPACES.   01410000
014200     05  FILLER                       PIC  X(03)  VALUE SPACES.   01420000
014300     05  RP1-STATE                    PIC  X(02)  VALUE SPACES.   01430000
014400     05  FILLER                       PIC  X(04)  VALUE SPACES.   01440000
014500     05  RP1-ZIP-CODE                 PIC  X(11)  VALUE SPACES.   01450000
014600     05  RP1-DETAIL-COMMENT           PIC  X(38)  VALUE SPACES.   01460000
014601                                                                  01460100
014602 01  CSV-HEADER.                                                  01460200
014603     05  CSH-TRANS-DATE               PIC  X(10)  VALUE           01460300
014604         'TRANSDATE'.                                             01460400
014605     05  FILLER                       PIC  X(01)  VALUE ','.      01460500
014606     05  CSH-CARD-ID                  PIC  X(14)  VALUE           01460600
014607         'CARDNUMBER'.                                            01460700
014608     05  FILLER                       PIC  X(01)  VALUE ','.      01460800
014609     05  CSH-CARD-TYPE                PIC  X(08)  VALUE           01460900
014610         'CARDTYPE'.                                              01461000
014611     05  FILLER                       PIC  X(01)  VALUE ','.      01461100
014612     05  CSH-TRANS-AMT                PIC  X(11)  VALUE           01461200
014613         'TRANSAMT'.                                              01461300
014614     05  FILLER                       PIC  X(01)  VALUE ','.      01461400
014615     05  CSH-STORE                    PIC  X(05)  VALUE 'STORE'.  01461500
014616     05  FILLER                       PIC  X(01)  VALUE ','.      01461600
014617     05  CSH-REGISTER                 PIC  X(04)  VALUE 'REGT'.   01461700
014618     05  FILLER                       PIC  X(01)  VALUE ','.      01461800
014619     05  CSH-DIVISION                 PIC  X(05)  VALUE 'DIV'.    01461900
014620     05  FILLER                       PIC  X(01)  VALUE ','.      01462000
014621                                                                  01462100
014622 01  CSV-DETAIL.                                                  01462200
014623     05  CSV-TRANS-DATE               PIC  X(10)  VALUE SPACES.   01462300
014624     05  FILLER                       PIC  X(03)  VALUE ',# '.    01462400
014625     05  CSV-CARD-ID                  PIC  ZZ9999999999.          01462500
014626     05  FILLER                       PIC  X(01)  VALUE ','.      01462600
014627     05  CSV-CARD-TYPE                PIC  X(08)  VALUE SPACES.   01462700
014628     05  FILLER                       PIC  X(01)  VALUE ','.      01462800
014629     05  CSV-TRANS-AMT                PIC  9(7).99-.              01462900
014630     05  FILLER                       PIC  X(01)  VALUE ','.      01463000
014631     05  CSV-STORE                    PIC  X(05)  VALUE SPACES.   01463100
014632     05  FILLER                       PIC  X(01)  VALUE ','.      01463200
014633     05  CSV-REGISTER                 PIC  X(04)  VALUE SPACES.   01463300
014634     05  FILLER                       PIC  X(01)  VALUE ','.      01463400
014635     05  CSV-DIVISION                 PIC  X(05)  VALUE SPACES.   01463500
014636     05  FILLER                       PIC  X(01)  VALUE ','.      01463600
014700                                                                  01470000
014800 01  RPT-TOTAL-LINE-1.                                            01480000
014900     05  FILLER                       PIC  X(01)  VALUE SPACE.    01490000
015000     05  FILLER                       PIC  X(06)  VALUE 'TOTALS'. 01500000
015100     05  FILLER                       PIC  X(14)  VALUE SPACES.   01510000
015200     05  FILLER                       PIC  X(08)  VALUE           01520000
015300                                          'VERIFIED'.             01530000
015400     05  FILLER                       PIC  X(18)  VALUE SPACES.   01540000
015500     05  FILLER                       PIC  X(13)  VALUE           01550000
015600                                          'MISSING KOHLS'.        01560000
015700     05  FILLER                       PIC  X(13)  VALUE SPACES.   01570000
015800     05  FILLER                       PIC  X(15)  VALUE           01580000
015900                                          'MISSING SAFEWAY'.      01590000
016000     05  FILLER                       PIC  X(12)  VALUE SPACES.   01600000
016100     05  FILLER                       PIC  X(12)  VALUE           01610000
016200                                          'VOIDED CARDS'.         01620000
016300     05  FILLER                       PIC  X(20)  VALUE SPACES.   01630000
016400                                                                  01640000
016500 01  RPT-TOTAL-LINE-2.                                            01650000
016600     05  FILLER                       PIC  X(14)  VALUE SPACE.    01660000
016700     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 01670000
016800     05  FILLER                       PIC  X(10)  VALUE SPACES.   01680000
016900     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 01690000
017000     05  FILLER                       PIC  X(06)  VALUE SPACES.   01700000
017100     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 01710000
017200     05  FILLER                       PIC  X(10)  VALUE SPACES.   01720000
017300     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 01730000
017400     05  FILLER                       PIC  X(06)  VALUE SPACES.   01740000
017500     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 01750000
017600     05  FILLER                       PIC  X(11)  VALUE SPACES.   01760000
017700     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 01770000
017800     05  FILLER                       PIC  X(07)  VALUE SPACES.   01780000
017900     05  FILLER                       PIC  X(06)  VALUE 'NUMBER'. 01790000
018000     05  FILLER                       PIC  X(07)  VALUE SPACES.   01800000
018100     05  FILLER                       PIC  X(06)  VALUE 'AMOUNT'. 01810000
018200     05  FILLER                       PIC  X(26)  VALUE SPACES.   01820000
018300                                                                  01830000
018400 01  RPT-TOTAL-DETAIL-LINE.                                       01840000
018500     05  FILLER                       PIC  X(01)  VALUE SPACE.    01850000
018600     05  TOTAL-DATE                   PIC  X(10)  VALUE SPACES.   01860000
018700     05  FILLER                       PIC  X(02)  VALUE SPACES.   01870000
018800     05  TOTAL-VERIFIED-NBR           PIC  ZZZ,ZZ9.               01880000
018900     05  FILLER                       PIC  X(03)  VALUE SPACES.   01890000
019000     05  TOTAL-VERIFIED-AMT           PIC  ZZ,ZZZ,Z99.99.         01900000
019100     05  FILLER                       PIC  X(05)  VALUE SPACES.   01910000
019200     05  TOTAL-SV-NBR                 PIC  ZZZ,ZZ9.               01920000
019300     05  FILLER                       PIC  X(04)  VALUE SPACES.   01930000
019400     05  TOTAL-SV-AMT                 PIC  Z,ZZZ,Z99.99.          01940000
019500     05  FILLER                       PIC  X(05)  VALUE SPACES.   01950000
019600     05  TOTAL-SAFEWAY-NBR            PIC  ZZZ,ZZ9.               01960000
019700     05  FILLER                       PIC  X(04)  VALUE SPACES.   01970000
019800     05  TOTAL-SAFEWAY-AMT            PIC  ZZ,ZZZ,Z99.99.         01980000
019900     05  FILLER                       PIC  X(06)  VALUE SPACES.   01990000
019910     05  TOTAL-VOID-NBR               PIC  ZZZ,ZZ9.               01991000
019920     05  FILLER                       PIC  X(03)  VALUE SPACES.   01992000
019930     05  TOTAL-VOID-AMT               PIC  ZZZ,Z99.99.            01993000
019940     05  FILLER                       PIC  X(10)  VALUE SPACES.   01994000
019950                                                                  01995000
019960 01  END-OF-REPORT-LINE.                                          01996000
019970     05  FILLER                       PIC  X(51)  VALUE SPACE.    01997000
019980     05  FILLER                       PIC  X(29)  VALUE           01998000
019990         '*****   END OF REPORT   *****'.                         01999000
020000     05  FILLER                       PIC  X(52)  VALUE SPACE.    02000000
020100                                                                  02010000
020200 01  PC-PROGRAM-CONSTANTS.                                        02020000
020300     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE           02030000
020400                                                    'SVKRP033'.   02040000
020500     05  PC-LINES-PER-PAGE            PIC S9(04)  VALUE +60       02050000
020600                                                     COMP SYNC.   02060000
020700                                                                  02070000
020800 01  PS-PROGRAM-SWITCHES.                                         02080000
020900     05  PS-END-OF-REPORT-FILE-SW     PIC X(01)   VALUE 'N'.      02090000
021000         88  PS-END-OF-REPORT-FILE                VALUE 'Y'.      02100000
021100     05  PS-END-OF-CARD-FILE-SW       PIC X(01)   VALUE 'N'.      02110000
021200         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      02120000
021300     05  PS-DETAIL-RECORDS-YES-SW     PIC X(01)   VALUE 'N'.      02130000
021400         88  PS-DETAIL-RECORDS-YES                VALUE 'Y'.      02140000
021500                                                                  02150000
021600 01  PV-PROGRAM-VARIABLES.                                        02160000
021700     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACE.    02170000
021800     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACE.    02180000
021900     05  PV-DB2-OPERATION             PIC  X(30)  VALUE SPACE.    02190000
022000     05  PV-SUB                       PIC S9(04)  COMP.           02200000
022100     05  PV-MAX-ARRAY                 PIC S9(04)  COMP.           02210000
022200     05  PV-MAX-SUB                   PIC S9(04) VALUE +1500 COMP.02220000
022300     05  PV-PAGE-COUNT                PIC S9(04)  VALUE +0 COMP.  02230000
022400     05  PV-PAGE-COUNT1               PIC S9(04)  VALUE +0 COMP.  02240000
022500     05  PV-LINE-COUNT                PIC S9(04)  VALUE +0 COMP.  02250000
022600     05  PV-LINE-COUNT1               PIC S9(04)  VALUE +0 COMP.  02260000
022700     05  PV-PREV-CARD-NBR             PIC S9(12)  VALUE +0 COMP-3.02270000
022800                                                                  02280000
022900 01  PV-REFORMAT-DATE.                                            02290000
023000     05  PV-REFORMAT-YEAR             PIC  X(04) VALUE SPACES.    02300000
023100     05  FILLER                       PIC  X(01) VALUE '/'.       02310000
023200     05  PV-REFORMAT-MONTH            PIC  X(02) VALUE SPACES.    02320000
023300     05  FILLER                       PIC  X(01) VALUE '/'.       02330000
023400     05  PV-REFORMAT-DAY              PIC  X(02) VALUE SPACES.    02340000
023500                                                                  02350000
023600 01  PV-TRANSACTION-DATE.                                         02360000
023700     05  PV-YEAR                      PIC  X(04) VALUE SPACES.    02370000
023800     05  PV-MONTH                     PIC  X(02) VALUE SPACES.    02380000
023900     05  PV-DAY                       PIC  X(02) VALUE SPACES.    02390000
024000                                                                  02400000
024100 01  PV-PROGRAM-ACCUMULATORS.                                     02410000
024200     05  PV-TOTAL-ENTRY OCCURS 1500 TIMES.                        02420000
024300         10  PV-DATE                  PIC X(08)     VALUE SPACES. 02430000
024400         10  PV-VERIFIED-NBR          PIC S9(09)    VALUE ZEROES. 02440000
024500         10  PV-VERIFIED-AMT          PIC S9(09)V99 VALUE ZEROES. 02450000
024600         10  PV-MISSING-SV-NBR        PIC S9(07)    VALUE ZEROES. 02460000
024700         10  PV-MISSING-SV-AMT        PIC S9(09)V99 VALUE ZEROES. 02470000
024800         10  PV-MISSING-SAFEWAY-NBR   PIC S9(07)    VALUE ZEROES. 02480000
024900         10  PV-MISSING-SAFEWAY-AMT   PIC S9(09)V99 VALUE ZEROES. 02490000
025000         10  PV-VOIDED-CARDS-NBR      PIC S9(07)    VALUE ZEROES. 02500000
025100         10  PV-VOIDED-CARDS-AMT      PIC S9(09)V99 VALUE ZEROES. 02510000
025200                                                                  02520000
025300******************************************************************02530000
025400* RECORD LAYOUT FOR INPUT DATE CARD                               02540000
025500******************************************************************02550000
025600 01  CC-CONTROL-CARD.                                             02560000
025700     05  CC-DATE-CCYY-MM-DD.                                      02570000
025800         10  CC-CONTROL-DATE-CC       PIC  X(02)   VALUE SPACES.  02580000
025900         10  CC-CONTROL-DATE-YY       PIC  X(02)   VALUE SPACES.  02590000
026000         10  FILLER                   PIC  X(01)   VALUE SPACES.  02600000
026100         10  CC-CONTROL-DATE-MM       PIC  X(02)   VALUE SPACES.  02610000
026200         10  FILLER                   PIC  X(01)   VALUE SPACES.  02620000
026300         10  CC-CONTROL-DATE-DD       PIC  X(02)   VALUE SPACES.  02630000
026400      05  FILLER                      PIC  X(70)   VALUE SPACES.  02640000
026500                                                                  02650000
026600 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       02660000
026700                                                 COMP SYNC.       02670000
026800     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     02680000
026900     88  AC-TABLE-OVERFLOW                       VALUE +4004.     02690000
027000     88  AC-SQL-ERROR                            VALUE +4013.     02700000
027100     88  AC-DATE-ERROR                           VALUE +4019.     02710000
027200                                                                  02720000
027300 01  SD-SYSTEM-DATE.                                              02730000
027400     05  SD-SYSTEM-YEAR               PIC  9(02)  VALUE ZEROS.    02740000
027500     05  SD-SYSTEM-MONTH              PIC  9(02)  VALUE ZEROS.    02750000
027600     05  SD-SYSTEM-DAY                PIC  9(02)  VALUE ZEROS.    02760000
027700                                                                  02770000
027800 01  ST-SYSTEM-TIME.                                              02780000
027900     05  ST-SYSTEM-HOUR               PIC  9(02)  VALUE ZEROS.    02790000
028000     05  ST-SYSTEM-MINUTE             PIC  9(02)  VALUE ZEROS.    02800000
028100     05  FILLER                       PIC  9(04)  VALUE ZEROS.    02810000
028200                                                                  02820000
028300******************************************************************02830000
028400* DATE ROUTINE COPY MEMBERS                                       02840000
028500******************************************************************02850000
028600     COPY DPWS500.                                                02860000
028700                                                                  02870000
028800******************************************************************02880000
028900*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02890000
029000******************************************************************02900000
029100     COPY DPWS004.                                                02910000
029200                                                                  02920000
029300******************************************************************02930000
029400*  DB2 TABLE SVT_CRD_PROD                                         02940000
029500******************************************************************02950000
029600     EXEC SQL                                                     02960000
029700           INCLUDE SVT00000                                       02970000
029800     END-EXEC.                                                    02980000
029900                                                                  02990000
030000******************************************************************03000000
030100*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                             *03010000
030200*    SV-KOHL'S MERCHANDISE CARD TABLE                            *03020000
030300******************************************************************03030000
030400     EXEC SQL                                                     03040000
030500         INCLUDE SVT00001                                         03050000
030600     END-EXEC.                                                    03060000
030700                                                                  03070000
030800******************************************************************03080000
030900*  DB2 COMMUNICATION AREA.                                        03090000
031000******************************************************************03100000
031100     EXEC SQL                                                     03110000
031200           INCLUDE SQLCA                                          03120000
031300     END-EXEC.                                                    03130000
031400                                                                  03140000
031500******************************************************************03150000
031600 PROCEDURE DIVISION.                                              03160000
031700******************************************************************03170000
031800 0000-PROGRAM-MAINLINE.                                           03180000
031900                                                                  03190000
032000     PERFORM 1000-INITIALIZE.                                     03200000
032100                                                                  03210000
032200     PERFORM 2000-PROCESS-REPORT-FILE                             03220000
032300       UNTIL PS-END-OF-REPORT-FILE.                               03230000
032400                                                                  03240000
032500     IF PS-DETAIL-RECORDS-YES                                     03250000
032600         PERFORM 8000-WRITE-TOTAL-LINE                            03260000
032700     END-IF.                                                      03270000
032800                                                                  03280000
032900     PERFORM 9000-EOJ-ROUTINE.                                    03290000
033000                                                                  03300000
033100     STOP RUN.                                                    03310000
033200                                                                  03320000
033300******************************************************************03330000
033400*  1000-INITIALIZE                                                03340000
033500******************************************************************03350000
033600 1000-INITIALIZE.                                                 03360000
033700                                                                  03370000
033800     OPEN INPUT  DATE-CARD-FILE                                   03380000
033900                 REPORT-FILE-IN                                   03390000
034000          OUTPUT SETTLED-REPORT                                   03400000
034010                 SETTLED-CSV-FILE                                 03401000
034100                 UNSETTLED-REPORT.                                03410000
034110     WRITE SETTLED-CSV-RECORD FROM CSV-HEADER                     03411000
034200                                                                  03420000
034300     MOVE ZEROS  TO  PV-PAGE-COUNT                                03430000
034400                     PV-PAGE-COUNT1                               03440000
034500                     PV-SUB.                                      03450000
034600                                                                  03460000
034700     ACCEPT SD-SYSTEM-DATE  FROM DATE.                            03470000
034800     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            03480000
034900                                                                  03490000
035000     MOVE SD-SYSTEM-MONTH          TO  DP132-RUN-MONTH.           03500000
035100     MOVE SD-SYSTEM-DAY            TO  DP132-RUN-DAY.             03510000
035200     MOVE SD-SYSTEM-YEAR           TO  DP132-RUN-YEAR.            03520000
035300     MOVE ST-SYSTEM-HOUR           TO  DP132-RUN-HOUR.            03530000
035400     MOVE ST-SYSTEM-MINUTE         TO  DP132-RUN-MINUTE.          03540000
035500                                                                  03550000
035600     MOVE PC-PROGRAM-NAME  TO  DP132-PROGRAM-NAME.                03560000
035700                                                                  03570000
035800     PERFORM 1400-PROCESS-CONTROL-CARD.                           03580000
035900                                                                  03590000
036000     PERFORM 5000-SETTLED-REPORT-HEADER.                          03600000
036100     PERFORM 6000-UNSETTLED-REPORT-HEADER.                        03610000
036200                                                                  03620000
036300     PERFORM 7000-READ-REPORT-FILE.                               03630000
036400                                                                  03640000
036500     IF PS-END-OF-REPORT-FILE                                     03650000
036600         CONTINUE                                                 03660000
036700     ELSE                                                         03670000
036800         SET PS-DETAIL-RECORDS-YES TO TRUE                        03680000
036900     END-IF.                                                      03690000
037000                                                                  03700000
037100***************************************************************** 03710000
037200* 1400-PROCESS-CONTROL-CARD                                       03720000
037300* READ DATE CONTROL CARD FOR FISCAL MONTH-END DATE.               03730000
037400* CALL DATE ROUTINE TO GET MAX FISCAL PERIOD.                     03740000
037500***************************************************************** 03750000
037600 1400-PROCESS-CONTROL-CARD.                                       03760000
037700                                                                  03770000
037800     PERFORM 1410-READ-DATE-CARD-FILE.                            03780000
037900                                                                  03790000
038000     IF PS-END-OF-CARD-FILE                                       03800000
038100         MOVE '1400-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   03810000
038200         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  03820000
038300         SET AC-CONTROL-CARD-ERROR TO TRUE                        03830000
038400         PERFORM 9999-ABEND                                       03840000
038500     END-IF.                                                      03850000
038600                                                                  03860000
038700     PERFORM 9975-DATE-ROUTINE.                                   03870000
038800                                                                  03880000
038900     MOVE CC-CONTROL-DATE-CC       TO RP1-DATE-CC.                03890000
039000     MOVE CC-CONTROL-DATE-YY       TO RP1-DATE-YY.                03900000
039100     MOVE CC-CONTROL-DATE-MM       TO RP1-DATE-MM.                03910000
039200     MOVE CC-CONTROL-DATE-DD       TO RP1-DATE-DD.                03920000
039300                                                                  03930000
039400     DISPLAY 'SVKRP033 CONTROL CARD DATE: '                       03940000
039500                          CC-CONTROL-CARD.                        03950000
039600                                                                  03960000
039700******************************************************************03970000
039800* 1410-READ-DATE-CARD-FILE                                        03980000
039900******************************************************************03990000
040000 1410-READ-DATE-CARD-FILE.                                        04000000
040100                                                                  04010000
040200     READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     04020000
040300       AT END                                                     04030000
040400           SET PS-END-OF-CARD-FILE TO TRUE.                       04040000
040500                                                                  04050000
040600******************************************************************04060000
040700* 2000-PROCESS-REPORT-FILE                                       *04070000
040800******************************************************************04080000
040900 2000-PROCESS-REPORT-FILE.                                        04090000
041000                                                                  04100000
041100     PERFORM 3000-GET-CARD-STOCK-TYPE.                            04110000
041200                                                                  04120000
041300     IF SV054-TRANSACTION-DATE = PV-TRANSACTION-DATE              04130000
041400         CONTINUE                                                 04140000
041500     ELSE                                                         04150000
041600         MOVE SV054-TRANSACTION-DATE TO PV-TRANSACTION-DATE       04160000
041700         MOVE PV-YEAR                TO PV-REFORMAT-YEAR          04170000
041800         MOVE PV-MONTH               TO PV-REFORMAT-MONTH         04180000
041900         MOVE PV-DAY                 TO PV-REFORMAT-DAY           04190000
042000         ADD +1                      TO PV-SUB                    04200000
042100         IF PV-SUB > PV-MAX-SUB                                   04210000
042200             MOVE '2000-PROCESS-REPORT-FILE' TO PV-PARAGRAPH-NAME 04220000
042300             MOVE 'DATE TABLE OVER LIMIT' TO PV-OPERATION-MSG-1   04230000
042400             SET AC-TABLE-OVERFLOW TO TRUE                        04240000
042500             PERFORM 9999-ABEND                                   04250000
042600         END-IF                                                   04260000
042700     END-IF.                                                      04270000
042800                                                                  04280000
042900     EVALUATE TRUE                                                04290000
043000         WHEN SV054-RF-VERIFIED                                   04300000
043100              PERFORM 2200-PROCESS-VERIFIED-DATA                  04310000
043200         WHEN SV054-RF-MISSING-SV                                 04320000
043300              PERFORM 2400-PROCESS-MISSING-SV-DATA                04330000
043400         WHEN SV054-RF-MISSING-SAFEWAY                            04340000
043500              PERFORM 2600-PROCESS-MISSING-SAFEWAY                04350000
043600         WHEN SV054-RF-REVERSAL                                   04360000
043700              PERFORM 2800-PROCESS-REVERSAL                       04370000
043800         WHEN OTHER                                               04380000
043900              PERFORM 9999-ABEND                                  04390000
044000     END-EVALUATE.                                                04400000
044100                                                                  04410000
044200     PERFORM 7000-READ-REPORT-FILE.                               04420000
044300                                                                  04430000
044400******************************************************************04440000
044500* 2200-PROCESS-VERIFIED-DATA                                     *04450000
044600******************************************************************04460000
044700 2200-PROCESS-VERIFIED-DATA.                                      04470000
044800                                                                  04480000
044900     PERFORM 4000-MOVE-REPORT-DATA.                               04490000
045000                                                                  04500000
045100     ADD +1                       TO PV-VERIFIED-NBR(PV-SUB).     04510000
045200     ADD SV054-TRANSACTION-AMT    TO PV-VERIFIED-AMT(PV-SUB).     04520000
045300     MOVE SV054-TRANSACTION-DATE  TO PV-DATE(PV-SUB).             04530000
045400     MOVE SPACES                  TO RP1-DETAIL-COMMENT.          04540000
045500                                                                  04550000
045600     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         04560000
045700         PERFORM 5000-SETTLED-REPORT-HEADER                       04570000
045800     END-IF.                                                      04580000
045900                                                                  04590000
046000     WRITE SETTLED-RECORD FROM RP1-DETAIL-LINE AFTER              04600000
046100            ADVANCING 1 LINE                                      04610000
046200     ADD +1 TO PV-LINE-COUNT.                                     04620000
046210     WRITE SETTLED-CSV-RECORD FROM CSV-DETAIL.                    04621000
046300                                                                  04630000
046400******************************************************************04640000
046500* 2400-PROCESS-MISSING-SV-DATA                                   *04650000
046600******************************************************************04660000
046700 2400-PROCESS-MISSING-SV-DATA.                                    04670000
046800                                                                  04680000
046900     PERFORM 4000-MOVE-REPORT-DATA.                               04690000
047000     MOVE SPACES                      TO RP1-DETAIL-COMMENT.      04700000
047100     MOVE 'MISSING KOHLS TRANSACTION' TO RP1-DETAIL-COMMENT.      04710000
047200                                                                  04720000
047300     ADD +1                       TO PV-MISSING-SV-NBR(PV-SUB).   04730000
047400     ADD SV054-TRANSACTION-AMT    TO PV-MISSING-SV-AMT(PV-SUB).   04740000
047500     MOVE SV054-TRANSACTION-DATE  TO PV-DATE(PV-SUB).             04750000
047600                                                                  04760000
047700     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        04770000
047800         PERFORM 6000-UNSETTLED-REPORT-HEADER                     04780000
047900     END-IF.                                                      04790000
048000                                                                  04800000
048100     WRITE UNSETTLED-RECORD FROM RP1-DETAIL-LINE AFTER            04810000
048200            ADVANCING 1 LINE                                      04820000
048300     ADD +1 TO PV-LINE-COUNT1.                                    04830000
048400                                                                  04840000
048500******************************************************************04850000
048600* 2600-PROCESS-MISSING-SAFEWAY                                   *04860000
048700******************************************************************04870000
048800 2600-PROCESS-MISSING-SAFEWAY.                                    04880000
048900                                                                  04890000
049000     PERFORM 4000-MOVE-REPORT-DATA.                               04900000
049100     MOVE SPACES                        TO RP1-DETAIL-COMMENT.    04910000
049200     MOVE 'MISSING SAFEWAY TRANSACTION' TO RP1-DETAIL-COMMENT.    04920000
049300                                                                  04930000
049400     ADD +1                     TO PV-MISSING-SAFEWAY-NBR(PV-SUB).04940000
049500     ADD SV054-TRANSACTION-AMT  TO PV-MISSING-SAFEWAY-AMT(PV-SUB).04950000
049600     MOVE SV054-TRANSACTION-DATE TO PV-DATE(PV-SUB).              04960000
049700                                                                  04970000
049800     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        04980000
049900         PERFORM 6000-UNSETTLED-REPORT-HEADER                     04990000
050000     END-IF.                                                      05000000
050100                                                                  05010000
050200     WRITE UNSETTLED-RECORD FROM RP1-DETAIL-LINE AFTER            05020000
050300            ADVANCING 1 LINE                                      05030000
050400     ADD +1 TO PV-LINE-COUNT1.                                    05040000
050500                                                                  05050000
050510******************************************************************05051000
050520* 2800-PROCESS-REVERSAL                                          *05052000
050530******************************************************************05053000
050540 2800-PROCESS-REVERSAL.                                           05054000
050550                                                                  05055000
050560     IF SV054-GIFT-CARD-NBR = PV-PREV-CARD-NBR                    05056000
050570         CONTINUE                                                 05057000
050580     ELSE                                                         05058000
050590         ADD +1                     TO PV-VOIDED-CARDS-NBR(PV-SUB)05059000
050591         ADD SV054-TRANSACTION-AMT  TO PV-VOIDED-CARDS-AMT(PV-SUB)05059100
050592         MOVE SV054-TRANSACTION-DATE TO PV-DATE(PV-SUB)           05059200
050593         MOVE SV054-GIFT-CARD-NBR    TO PV-PREV-CARD-NBR          05059300
050594     END-IF.                                                      05059400
050595                                                                  05059500
050596******************************************************************05059600
050597*3000-GET-CARD-STOCK-TYPE                                        *05059700
050598******************************************************************05059800
050599 3000-GET-CARD-STOCK-TYPE.                                        05059900
050600                                                                  05060000
050700     EXEC SQL                                                     05070000
050800          SELECT CRD_STK_TYP_ID                                   05080000
050900            INTO :SVT00000-CRD-STK-TYP-ID                         05090000
051000            FROM SVT_CRD_PROD A,                                  05100000
051100                 SVT_KOHLS_CRD_ACCT B                             05110000
051200           WHERE A.CRD_PROD_YR = B.CRD_PROD_YR                    05120000
051300             AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                05130000
051400             AND B.CRD_NBR = :SV054-GIFT-CARD-NBR                 05140000
051500            WITH UR                                               05150000
051600     END-EXEC.                                                    05160000
051700                                                                  05170000
051800     EVALUATE TRUE                                                05180000
051900         WHEN SQLCODE = ZERO                                      05190000
052000               CONTINUE                                           05200000
052100         WHEN OTHER                                               05210000
052200               MOVE 'UNKNOWN' TO SVT00000-CRD-STK-TYP-ID          05220000
052300     END-EVALUATE.                                                05230000
052400                                                                  05240000
052500******************************************************************05250000
052600* 4000-MOVE-REPORT-DATA                                          *05260000
052700******************************************************************05270000
052800 4000-MOVE-REPORT-DATA.                                           05280000
052900                                                                  05290000
053000     MOVE PV-REFORMAT-DATE        TO RP1-TRANS-DATE               05300000
053100                                     CSV-TRANS-DATE.              05310000
053200     MOVE SV054-GIFT-CARD-NBR     TO RP1-CARD-ID                  05320000
053300                                     CSV-CARD-ID.                 05330000
053400     MOVE SVT00000-CRD-STK-TYP-ID TO RP1-CARD-TYPE                05340000
053500                                     CSV-CARD-TYPE.               05350000
053600     MOVE SV054-TRANSACTION-AMT   TO RP1-TRANS-AMT                05360000
053700                                     CSV-TRANS-AMT.               05370000
053800     MOVE SV054-SAFEWAY-STORE-NBR TO RP1-STORE                    05380000
053900                                     CSV-STORE.                   05390000
054000     MOVE SV054-SAFEWAY-RGST-NBR  TO RP1-REGISTER                 05400000
054100                                     CSV-REGISTER.                05410000
054200     MOVE SV054-SAFEWAY-DIVISION  TO RP1-DIVISION                 05420000
054201                                     CSV-DIVISION.                05420100
054202     MOVE SV054-SAFEWAY-STATE-CDE TO RP1-STATE.                   05420200
054203     MOVE SV054-SAFEWAY-ZIP-CDE   TO RP1-ZIP-CODE.                05420300
054204                                                                  05420400
054205******************************************************************05420500
054206* 5000-SETTLED-REPORT-HEADER                                     *05420600
054207******************************************************************05420700
054300 5000-SETTLED-REPORT-HEADER.                                      05430000
054400                                                                  05440000
054500     MOVE 4             TO PV-LINE-COUNT.                         05450000
054600     ADD  1             TO PV-PAGE-COUNT.                         05460000
054700     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     05470000
054800     MOVE 1             TO DP132-REPORT-NUMBER.                   05480000
054900     MOVE SPACES        TO RP1-COMMENT-LINE.                      05490000
055000     MOVE 'SAFEWAY SETTLEMENT REPORT FOR' TO RP1-SUBTITLE.        05500000
055100                                                                  05510000
055200     WRITE SETTLED-RECORD                                         05520000
055300       FROM DP132-STANDRD-HEADER-132-COLS                         05530000
055400         AFTER ADVANCING PAGE.                                    05540000
055500                                                                  05550000
055600     WRITE SETTLED-RECORD                                         05560000
055700         FROM RP1-HEADING-LINE-2                                  05570000
055800         AFTER ADVANCING 1 LINE.                                  05580000
055900                                                                  05590000
056000     WRITE SETTLED-RECORD                                         05600000
056100         FROM RP1-HEADING-LINE-3                                  05610000
056200         AFTER ADVANCING 2 LINES.                                 05620000
056300                                                                  05630000
056400     WRITE SETTLED-RECORD                                         05640000
056500         FROM RP1-HEADING-LINE-4                                  05650000
056600         AFTER ADVANCING 1 LINE.                                  05660000
056700                                                                  05670000
056800******************************************************************05680000
056900* 6000-WRITE-UNSETTLED-REPORT-HEADER                             *05690000
057000******************************************************************05700000
057100 6000-UNSETTLED-REPORT-HEADER.                                    05710000
057200                                                                  05720000
057300     MOVE 4               TO PV-LINE-COUNT1.                      05730000
057400     ADD  1               TO PV-PAGE-COUNT1.                      05740000
057500     MOVE PV-PAGE-COUNT1  TO DP132-PAGE-NUMBER.                   05750000
057600     MOVE 2               TO DP132-REPORT-NUMBER.                 05760000
057700     MOVE 'ERROR MESSAGE' TO RP1-COMMENT-LINE.                    05770000
057800     MOVE SPACES          TO RP1-SUBTITLE.                        05780000
057900     MOVE 'SAFEWAY AUDIT REPORT FOR' TO RP1-SUBNAME.              05790000
058000                                                                  05800000
058100     WRITE UNSETTLED-RECORD                                       05810000
058200       FROM DP132-STANDRD-HEADER-132-COLS                         05820000
058300         AFTER ADVANCING PAGE.                                    05830000
058400                                                                  05840000
058500     WRITE UNSETTLED-RECORD                                       05850000
058600         FROM RP1-HEADING-LINE-2                                  05860000
058700         AFTER ADVANCING 1 LINE.                                  05870000
058800                                                                  05880000
058900     WRITE UNSETTLED-RECORD                                       05890000
059000         FROM RP1-HEADING-LINE-3                                  05900000
059100         AFTER ADVANCING 2 LINES.                                 05910000
059200                                                                  05920000
059300     WRITE UNSETTLED-RECORD                                       05930000
059400         FROM RP1-HEADING-LINE-4                                  05940000
059500         AFTER ADVANCING 1 LINE.                                  05950000
059600                                                                  05960000
059700******************************************************************05970000
059800* 7000-READ-REPORT-FILE                                          *05980000
059900*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *05990000
060000*    THERE IS NO MORE RECORDS TO READ.                           *06000000
060100******************************************************************06010000
060200 7000-READ-REPORT-FILE.                                           06020000
060300                                                                  06030000
060400     INITIALIZE SV054-DETAIL-TRANS.                               06040000
060500                                                                  06050000
060600     READ REPORT-FILE-IN INTO SV054-DETAIL-TRANS                  06060000
060700         AT END                                                   06070000
060800             SET PS-END-OF-REPORT-FILE TO TRUE.                   06080000
060900                                                                  06090000
061000******************************************************************06100000
061100* 8000-WRITE-TOTAL-LINE                                          *06110000
061200******************************************************************06120000
061300 8000-WRITE-TOTAL-LINE.                                           06130000
061400                                                                  06140000
061500     MOVE PV-SUB TO PV-MAX-ARRAY.                                 06150000
061600     ADD +4      TO PV-LINE-COUNT                                 06160000
061700                    PV-LINE-COUNT1.                               06170000
061800                                                                  06180000
061900     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         06190000
062000         PERFORM 5000-SETTLED-REPORT-HEADER                       06200000
062100     END-IF.                                                      06210000
062200                                                                  06220000
062300     WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-1                   06230000
062400           AFTER ADVANCING 2 LINES                                06240000
062500                                                                  06250000
062600     WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-2                   06260000
062700           AFTER ADVANCING 1 LINE                                 06270000
062800                                                                  06280000
062900     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        06290000
063000         PERFORM 6000-UNSETTLED-REPORT-HEADER                     06300000
063100     END-IF.                                                      06310000
063200                                                                  06320000
063300     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-1                 06330000
063400           AFTER ADVANCING 2 LINES                                06340000
063500                                                                  06350000
063600     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-2                 06360000
063700           AFTER ADVANCING 1 LINE                                 06370000
063800                                                                  06380000
063900     PERFORM 8100-UNLOAD-TOTAL-DATA                               06390000
064000     VARYING PV-SUB FROM 1 BY 1                                   06400000
064100       UNTIL PV-SUB > PV-MAX-ARRAY.                               06410000
064200                                                                  06420000
064300     WRITE SETTLED-RECORD FROM END-OF-REPORT-LINE                 06430000
064400           AFTER ADVANCING 2 LINES.                               06440000
064500                                                                  06450000
064600     WRITE UNSETTLED-RECORD FROM END-OF-REPORT-LINE               06460000
064700           AFTER ADVANCING 2 LINES.                               06470000
064800                                                                  06480000
064900******************************************************************06490000
065000* 8100-UNLOAD-TOTAL-DATA                                         *06500000
065100******************************************************************06510000
065200 8100-UNLOAD-TOTAL-DATA.                                          06520000
065300                                                                  06530000
065400     MOVE PV-DATE(PV-SUB)                TO PV-TRANSACTION-DATE.  06540000
065500     MOVE PV-YEAR                        TO PV-REFORMAT-YEAR.     06550000
065600     MOVE PV-MONTH                       TO PV-REFORMAT-MONTH.    06560000
065700     MOVE PV-DAY                         TO PV-REFORMAT-DAY.      06570000
065800     MOVE PV-REFORMAT-DATE               TO TOTAL-DATE.           06580000
065900     MOVE PV-VERIFIED-NBR(PV-SUB)        TO TOTAL-VERIFIED-NBR.   06590000
066000     MOVE PV-VERIFIED-AMT(PV-SUB)        TO TOTAL-VERIFIED-AMT.   06600000
066100     MOVE PV-MISSING-SV-NBR(PV-SUB)      TO TOTAL-SV-NBR.         06610000
066200     MOVE PV-MISSING-SV-AMT(PV-SUB)      TO TOTAL-SV-AMT.         06620000
066300     MOVE PV-MISSING-SAFEWAY-NBR(PV-SUB) TO TOTAL-SAFEWAY-NBR.    06630000
066400     MOVE PV-MISSING-SAFEWAY-AMT(PV-SUB) TO TOTAL-SAFEWAY-AMT.    06640000
066500     MOVE PV-VOIDED-CARDS-NBR(PV-SUB)    TO TOTAL-VOID-NBR.       06650000
066600     MOVE PV-VOIDED-CARDS-AMT(PV-SUB)    TO TOTAL-VOID-AMT.       06660000
066700                                                                  06670000
066800     IF PV-LINE-COUNT > PC-LINES-PER-PAGE                         06680000
066900         PERFORM 5000-SETTLED-REPORT-HEADER                       06690000
067000         WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-1               06700000
067100           AFTER ADVANCING 2 LINES                                06710000
067200                                                                  06720000
067300         WRITE SETTLED-RECORD FROM RPT-TOTAL-LINE-2               06730000
067400           AFTER ADVANCING 1 LINE                                 06740000
067500     END-IF.                                                      06750000
067600                                                                  06760000
067700     WRITE SETTLED-RECORD FROM RPT-TOTAL-DETAIL-LINE              06770000
067800           AFTER ADVANCING 1 LINE.                                06780000
067900     ADD +1 TO PV-LINE-COUNT.                                     06790000
068000                                                                  06800000
068100     IF PV-LINE-COUNT1 > PC-LINES-PER-PAGE                        06810000
068200         PERFORM 6000-UNSETTLED-REPORT-HEADER                     06820000
068300         WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-1             06830000
068400           AFTER ADVANCING 2 LINES                                06840000
068500                                                                  06850000
068600         WRITE UNSETTLED-RECORD FROM RPT-TOTAL-LINE-2             06860000
068700           AFTER ADVANCING 1 LINE                                 06870000
068800     END-IF.                                                      06880000
068900                                                                  06890000
069000     WRITE UNSETTLED-RECORD FROM RPT-TOTAL-DETAIL-LINE            06900000
069100           AFTER ADVANCING 1 LINE.                                06910000
069200                                                                  06920000
069300     ADD +1 TO PV-LINE-COUNT1.                                    06930000
069400                                                                  06940000
069500******************************************************************06950000
069600* 9000-EOJ-ROUTINE.                                              *06960000
069700******************************************************************06970000
069800 9000-EOJ-ROUTINE.                                                06980000
069900                                                                  06990000
070000     CLOSE DATE-CARD-FILE                                         07000000
070100           REPORT-FILE-IN                                         07010000
070200           SETTLED-REPORT                                         07020000
070210           SETTLED-CSV-FILE                                       07021000
070300           UNSETTLED-REPORT.                                      07030000
070400                                                                  07040000
070500******************************************************************07050000
070600*     9975-DATE-ROUTINE.                                         *07060000
070700* ==> PROCESSES:                                                 *07070000
070800*     -VALIDATES THE DATE INPUT ON THE CONTROL FILE              *07080000
070900* ==> PERFORMED FROM: B100-INITIALIZE                            *07090000
071000******************************************************************07100000
071100 9975-DATE-ROUTINE.                                               07110000
071200                                                                  07120000
071300     INITIALIZE DPG51 DPG52 DPG53                                 07130000
071400                DPG54 DPG55 DPG56.                                07140000
071500                                                                  07150000
071600     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     07160000
071700                                                                  07170000
071800     MOVE CC-DATE-CCYY-MM-DD        TO DPG52-LK-DATE-INPUT.       07180000
071900     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      07190000
072000                                                                  07200000
072100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            07210000
072200       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 07220000
072300                                                                  07230000
072400     EVALUATE TRUE                                                07240000
072500         WHEN DPG54-SEVERE-ERROR                                  07250000
072600         WHEN DPG54-DATE-INVALID                                  07260000
072700             SET AC-DATE-ERROR TO TRUE                            07270000
072800             PERFORM 9999-ABEND                                   07280000
072900     END-EVALUATE.                                                07290000
073000******************************************************************07300000
073100* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           07310000
073200******************************************************************07320000
073300 9999-ABEND.                                                      07330000
073400     DISPLAY '** ABEND           **'.                             07340000
073500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          07350000
073600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07360000
073700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07370000
073800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07380000
