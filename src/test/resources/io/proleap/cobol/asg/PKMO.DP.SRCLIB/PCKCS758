000100 IDENTIFICATION DIVISION.                                         00010024
000200 PROGRAM-ID.    PCKCS758.                                         00020025
000300 AUTHOR.        DEANNA BRANTNER.                                  00030025
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040025
000500 DATE-WRITTEN.  MARCH, 2005.                                      00050025
000600 DATE-COMPILED.                                                   00060025
000700*---------------------------------------------------------------* 00070025
000800*    E758 - PO/RCVR UNBALANCED STORE EXPECTED SKU LIST            00080025
000900*---------------------------------------------------------------* 00090025
000910* DATE  11/04/2021                                                00091026
000920*            - CHANGE CALL OF 'DPKUT100' TO                     * 00092026
000930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00093026
000940*              MAKING THE CALL DYNAMIC VS STATIC                * 00094026
000950*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00095027
000960*-----------------------------------------------------------------00096026
1122RM* DATE  11/07/2022                                              * 00097028
1122RM*            - ADD COPYBOOK DPWS930                             * 00098028
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00099028
1122RM*              DYNAMIC.                                         * 00099128
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00099228
1122RM*-----------------------------------------------------------------00099328
001000 ENVIRONMENT DIVISION.                                            00100025
001100 DATA DIVISION.                                                   00110025
001200                                                                  00120025
001300 WORKING-STORAGE SECTION.                                         00130025
001400 01  DK-DB2-KEYS.                                                 00140025
001500     05  DK-PO                     PIC S9(9)   VALUE ZERO COMP.   00150025
001600     05  DK-RCVR                   PIC S9(9)   VALUE ZERO COMP.   00160025
001700     05  DK-SKU                    PIC S9(08)V VALUE ZERO COMP-3. 00170025
001800     05  DK-UPC                    PIC S9(09)  VALUE ZERO COMP.   00180025
001900     05  DK-STORE                  PIC S9(04)  VALUE ZERO COMP.   00190025
002000                                                                  00200025
002100 01  PC-PROGRAM-CONSTANTS.                                        00210025
002200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC758A  '.  00220025
002300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM758'.   00230025
002400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS758'.  00240025
002500     05  PC-XL001-VSM-PGM          PIC  X(08)  VALUE 'XLKUT001'.  00250025
002600     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE 'XLKUT071'.  00260025
002700     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00270025
002800     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00280025
002900     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00290025
003000     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00300025
003100     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00310025
003200                                               COMP SYNC.         00320025
003300     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00330025
003400                                               COMP SYNC.         00340025
003500     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00350025
003600                                               COMP-3.            00360025
003700     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00370025
003800                                               COMP SYNC.         00380025
003900     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00390025
004000                                               COMP-3.            00400025
004100     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00410025
004200     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00420025
004300     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00430025
004400     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00440025
004500     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00450025
004600     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00460000
004700                                               COMP.              00470000
004800     05  PC-DISPLAY-BSS            PIC  X(04)  VALUE 'BSS '.      00480023
004900*                                                                 00490000
005000*----------------------------------------------------------------*00500000
005100*  SYSTEM MESSAGES                                               *00510000
005200*----------------------------------------------------------------*00520000
005300*   00005 = INVALID VALUE                                        *00530000
005400*   00007 = REQUIRED ENTRY                                        00540000
005500*   00008 = MUST BE NUMERIC                                      *00550000
005600*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00560000
005700*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00570000
005800*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00580000
005900*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00590000
006000*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00600000
006100*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00610000
006200*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00620000
006300*   00069 - TOP OF LIST                                          *00630000
006400*   00070 - BOTTOM OF LIST                                       *00640000
006500*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00650000
006600*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00660000
006700*   00279 - MORE ITEMS TO DISPLAY                                *00670000
006800*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *00680000
006900*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00690000
007000*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00700000
007100*   99901 = INVALID COMMAND WAS ENTERED                          *00710000
007200*----------------------------------------------------------------*00720000
007300     05  PC-TSYMSG-NUMBERS.                                       00730000
007400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00740000
007500         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00750000
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00760000
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770000
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780000
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790000
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800000
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810000
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820000
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830000
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840000
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850000
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860000
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870000
008800         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00880000
008900         10  PC-TSYMSG-00758            PIC  9(05)  VALUE 00758.  00890000
009000         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  00900000
009100         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  00910000
009200         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  00920000
009300         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  00930000
009400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00940000
009500*                                                                 00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009700     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00970000
009800         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00980000
009900         88  PS-BLOCK-ERROR                         VALUE 'N'.    00990000
010000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01000000
010100         88  PS-NO-ERROR                            VALUE 'Y'.    01010000
010200         88  PS-ERROR                               VALUE 'N'.    01020000
010300     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01030000
010400         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01040000
010500         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01050000
010600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01060000
010700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01070000
010800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01080000
010900     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01090000
011000         88  PS-DONE                                VALUE 'Y'.    01100000
011100         88  PS-NOT-DONE                            VALUE 'N'.    01110000
011200     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01120000
011300         88  PS-LIST-END                            VALUE  'Y'.   01130000
011400         88  PS-NO-LIST-END                         VALUE  'N'.   01140000
011500     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01150000
011600         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01160000
011700         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01170000
011800     05  PS-END-OF-CSR-SW               PIC  X(01)  VALUE  'N'.   01180001
011900         88  PS-END-OF-CSR                          VALUE  'Y'.   01190001
012000         88  PS-NOT-END-OF-CSR                      VALUE  'N'.   01200001
012100     05  PS-DISPLAY-SW                  PIC  X(01)  VALUE  'N'.   01210001
012200         88  PS-DISPLAY-YES                         VALUE  'Y'.   01220001
012300         88  PS-DISPLAY-NO                          VALUE  'N'.   01230001
012400*                                                                 01240000
012500 01  PV-PROGRAM-VARIABLES.                                        01250000
012600     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01260000
012700                                                     COMP SYNC.   01270000
012800     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01280000
012900     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01290000
013000     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01300000
013100     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01310000
013200                                        COMP SYNC.                01320000
013300     05  PV-SUB                         PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01370000
013800                                                    COMP-3.       01380000
013900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01390000
014000                                                    COMP-3.       01400000
014100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01410000
014200                                                    COMP-3.       01420000
014300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01430000
014400                                                    COMP-3.       01440000
014500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01450000
014600                                                    COMP-3.       01460000
014700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01470000
014800                                                    COMP-3.       01480000
014900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01490000
015000                                                    COMP-3.       01500000
015100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01510000
015200                                                    COMP SYNC.    01520000
015300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01530000
015400                                                    COMP SYNC.    01540000
015500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01550000
015600                                                    COMP SYNC.    01560000
015700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01570000
015800                                                    COMP SYNC.    01580000
015900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01590000
016000                                                    COMP SYNC.    01600000
016100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01610000
016200                                                    COMP SYNC.    01620000
016300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01630000
016400                                                    COMP SYNC.    01640000
016500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01650000
016600                                                    COMP SYNC.    01660000
016700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01670000
016800                                                    COMP SYNC.    01680000
016900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01690000
017000                                                    COMP SYNC.    01700000
017100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01710000
017200                                                    COMP SYNC.    01720000
017300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01730000
017400                                                    COMP SYNC.    01740000
017500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01750000
017600                                                    COMP SYNC.    01760000
017700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01770000
017800                                                    COMP SYNC.    01780000
017900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01790000
018000                                                    COMP SYNC.    01800000
018100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01810000
018200                                                    COMP SYNC.    01820000
018300     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01830000
018400                                                    COMP.         01840000
018500     05  PV-SOFT-ABORT-MSG.                                       01850000
018600         10  FILLER            PIC X(12) VALUE ' PCKCS758 - '.    01860000
018700         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01870000
018800         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01880000
018900         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01890000
019000         10  PV-SOFT-PARAGRAPH PIC X(30).                         01900000
019100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01910000
019200                                                     COMP SYNC.   01920000
019300     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01930000
019400     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01940000
019500     05  PV-CICS-MSG-HOLD.                                        01950000
019600         10  FILLER                      PIC  X(01)  VALUE SPACE. 01960000
019700         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01970000
019800     05  PV-CICS-MSG-HOLD2.                                       01980000
019900         10  FILLER                      PIC  X(01)  VALUE SPACE. 01990000
020000         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02000000
020100                                                                  02010000
020200     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02020000
020300     05  PV-TMST-R REDEFINES  PV-TMST.                            02030000
020400         10   PV-TMST-CC                PIC X(02).                02040000
020500         10   PV-TMST-YY                PIC X(02).                02050000
020600         10   FILLER                    PIC X(01).                02060000
020700         10   PV-TMST-MM                PIC X(02).                02070000
020800         10   FILLER                    PIC X(01).                02080000
020900         10   PV-TMST-DD                PIC X(02).                02090000
021000         10   FILLER                    PIC X(01).                02100000
021100         10   PV-TMST-HRS               PIC X(02).                02110000
021200         10   FILLER                    PIC X(01).                02120000
021300         10   PV-TMST-MIN               PIC X(02).                02130000
021400         10   FILLER                    PIC X(01).                02140000
021500         10   PV-TMST-SEC               PIC X(02).                02150000
021600         10   FILLER                    PIC X(07).                02160000
021700     05  PV-DATE-DISPLAY.                                         02170000
021800         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02180000
021900         10   PV-SLASH-1                PIC X(01)   VALUE '/'.    02190000
022000         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02200000
022100         10   PV-SLASH-2                PIC X(01)   VALUE '/'.    02210000
022200         10   PV-DISPLAY-YY             PIC X(02)   VALUE SPACES. 02220000
022300     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02230000
022400     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02240000
022500     05  PV-SEL-TERM-ID                  PIC  X(04).              02250000
022600     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02260000
022700     05  PV-SEL-SEQ                      PIC  9(01).              02270000
022800     05  PV-DISPLAY-SKU                  PIC  9(08).              02280000
022900     05  PV-DISPLAY-UPC-ID               PIC  9(09).              02290000
023000     05  PV-DISPLAY-STORE                PIC  9(04).              02300000
023100     05  PV-DISPLAY-PO                   PIC  ZZZZZZZZ9.          02310023
023200     05  PV-DISPLAY-RCVR                 PIC  9999.               02320000
023300     05  PV-STORE-EXPECTED               PIC S9(9) COMP.          02330000
023400     05  PV-QTY-TOTAL                    PIC S9(9) COMP.          02340006
023500     05  PV-BOSS-PARM-RECV               PIC S9(9) COMP.          02350023
023600                                                                  02360000
023700******************************************************************02370000
023800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02380000
023900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02390000
024000**  APPLICATION-SPECIFIC COMMAREA.                              **02400000
024100******************************************************************02410000
024200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02420000
024300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02430000
024400     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           02440000
024500                                        INDEXED BY LQW-IDX.       02450000
024600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02460000
024700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02470000
024800         10  LQW-SELECTED-SW            PIC  X(01).               02480000
024900             88  LQW-SELECT                         VALUE 'S'.    02490000
025000             88  LQW-DESELECT                       VALUE ' '.    02500000
025100         10  LQW-ACTION                 PIC  X(03).               02510000
025200             88  LQW-DEL                            VALUE 'DEL'.  02520000
025300             88  LQW-INQ                            VALUE 'INQ'.  02530000
025400             88  LQW-UPD                            VALUE 'UPD'.  02540000
025500             88  LQW-ERR                            VALUE 'ERR'.  02550000
025600         10  LQW-DEPT                   PIC  9(04).               02560000
025700         10  LQW-CLASS                  PIC  X(04).               02570000
025800         10  LQW-SKU                    PIC  9(08).               02580000
025900         10  LQW-UPC                    PIC  9(15).               02590000
026000         10  LQW-EXPT-QTY               PIC S9(05).               02600000
026100                                                                  02610000
026200*---------------------------------------------------------------* 02620000
026300* SELECTON QUEUE LAYOUT                                         * 02630000
026400*---------------------------------------------------------------* 02640000
026500     COPY PCWS212.                                                02650000
026600                                                                  02660000
026700*---------------------------------------------------------------* 02670000
026800*    MAP LAYOUT                                                 * 02680000
026900*---------------------------------------------------------------* 02690000
027000     COPY PCKM758.                                                02700000
027100*                                                                 02710000
027200 01  MR-OCCURS-LAYOUT                   REDEFINES  PC758AO.       02720000
027300     05  FILLER                         PIC X(076).               02730000
027400     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02740000
027500         10  MR-SELECTL                 PIC S9(04) COMP.          02750000
027600         10  MR-SELECTA                 PIC  X(01).               02760000
027700         10  MR-SELECTC                 PIC  X(01).               02770000
027800         10  MR-SELECTH                 PIC  X(01).               02780000
027900         10  MR-SELECTI                 PIC  X(01).               02790000
028000                                                                  02800000
028100         10  MR-ACTIONL                 PIC S9(04) COMP.          02810000
028200         10  MR-ACTIONA                 PIC  X(01).               02820000
028300         10  MR-ACTIONC                 PIC  X(01).               02830000
028400         10  MR-ACTIONH                 PIC  X(01).               02840000
028500         10  MR-ACTION                  PIC  X(03).               02850000
028600                                                                  02860000
028700         10  MR-DEPTL                   PIC S9(04) COMP.          02870000
028800         10  MR-DEPTA                   PIC  X(01).               02880000
028900         10  MR-DEPTC                   PIC  X(01).               02890000
029000         10  MR-DEPTH                   PIC  X(01).               02900000
029100         10  MR-DEPT                    PIC  X(04).               02910000
029200                                                                  02920000
029300         10  MR-CLASSL                  PIC S9(04) COMP.          02930000
029400         10  MR-CLASSA                  PIC  X(01).               02940000
029500         10  MR-CTASSC                  PIC  X(01).               02950000
029600         10  MR-CLASSH                  PIC  X(01).               02960000
029700         10  MR-CLASS                   PIC  X(04).               02970000
029800                                                                  02980000
029900         10  MR-SKUL                    PIC S9(04) COMP.          02990000
030000         10  MR-SKUA                    PIC  X(01).               03000000
030100         10  MR-SKUC                    PIC  X(01).               03010000
030200         10  MR-SKUH                    PIC  X(01).               03020000
030300         10  MR-SKU                     PIC  X(08).               03030000
030400         10  MR-SKU-X REDEFINES MR-SKU.                           03040000
030500             15 MR-SKU-N                PIC Z9999999.             03050000
030600                                                                  03060000
030700         10  MR-UPCL                    PIC S9(04) COMP.          03070000
030800         10  MR-UPCA                    PIC  X(01).               03080000
030900         10  MR-UPCC                    PIC  X(01).               03090000
031000         10  MR-UPCH                    PIC  X(01).               03100000
031100         10  MR-UPC                     PIC  X(15).               03110000
031200         10  MR-UPC-X REDEFINES MR-UPC.                           03120000
031300             15 MR-UPC-N                PIC ZZ9999999999999.      03130000
031400                                                                  03140000
031500         10  MR-EXPT-QTYL               PIC S9(04) COMP.          03150000
031600         10  MR-EXPT-QTYA               PIC  X(01).               03160000
031700         10  MR-EXPT-QTYC               PIC  X(01).               03170000
031800         10  MR-EXPT-QTYH               PIC  X(01).               03180000
031900         10  MR-EXPT-QTY                PIC  X(05).               03190000
032000         10  MR-EXPT-QTY-X REDEFINES MR-EXPT-QTY.                 03200000
032100             15 MR-EXPT-QTY-N           PIC ZZZ9-.                03210000
032200                                                                  03220000
032300*----------------------------------------------------------------*03230000
032400*    XLKUT001 COPYBOOK USED WITH XLKUT001 - SKU CALLED MODULE    *03240000
032500*----------------------------------------------------------------*03250000
032600     COPY XLWS001.                                                03260000
032700                                                                  03270000
032800*----------------------------------------------------------------*03280000
032900*    XLKUT071 COPYBOOK USED WITH XLKUT071 - LOCATION MODULE      *03290000
033000*----------------------------------------------------------------*03300000
033100     COPY XLWS071.                                                03310000
033200                                                                  03320000
033300*---------------------------------------------------------------* 03330000
033400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03340000
033500*---------------------------------------------------------------* 03350000
033600     COPY DPWS015.                                                03360000
033700                                                                  03370000
033800*---------------------------------------------------------------* 03380000
033900*    FUNCTION KEYS COPYBOOK.                                    * 03390000
034000*---------------------------------------------------------------* 03400000
034100     COPY DPWS016.                                                03410000
034200                                                                  03420000
034300*---------------------------------------------------------------* 03430000
034400*    NUMERIC EDIT LAYOUT.                                       * 03440000
034500*---------------------------------------------------------------* 03450000
034600     COPY DPWS010I.                                               03460000
034700                                                                  03470000
034800*---------------------------------------------------------------* 03480000
034900*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03490000
035000*---------------------------------------------------------------* 03500000
035100     COPY DPWS030.                                                03510000
1122RM     COPY DPWS930.                                                03511028
035200                                                                  03520000
035300*---------------------------------------------------------------* 03530000
035400*    STANDARD COMMAREA.                                         * 03540000
035500*---------------------------------------------------------------* 03550000
035600     COPY DPWS020.                                                03560000
035700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03570000
035800                                                                  03580000
035900*---------------------------------------------------------------* 03590000
036000* INTER-APPLICATION COMMAREA.                                   * 03600000
036100*   PCWS210 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03610000
036200*             SPEC SCREEN.                                      * 03620000
036300*   PCWS211 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03630000
036400*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03640000
036500*---------------------------------------------------------------* 03650000
036600         10  INTER-APPL-COMM-AREA       PIC X(200).               03660000
036700     COPY PCWS210.                                                03670000
036800     COPY PCWS211.                                                03680000
036900                                                                  03690000
037000*---------------------------------------------------------------* 03700000
037100* COPYBOOK NEEDED TO PASS INFO TO SUKCS598 PO LINE LIST SCREEN  * 03710000
037200*---------------------------------------------------------------* 03720000
037300     COPY SUWS008.                                                03730000
037400                                                                  03740000
037500*---------------------------------------------------------------* 03750000
037600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03760000
037700*---------------------------------------------------------------* 03770000
037800         10  ASC-SPECIFIC-COMMAREA.                               03780000
037900             15  ASC-PO-RCVR                 PIC X(12).           03790000
038000             15  ASC-PO-NBR                  PIC S9(9) COMP.      03800000
038100             15  ASC-RCVR-NBR                PIC S9(9) COMP.      03810000
038200             15  ASC-DEPT-NBR                PIC S9(4)V COMP-3.   03820000
038300             15  ASC-CLASS-NBR               PIC S9(4)V COMP-3.   03830000
038400             15  ASC-SKU-NBR                 PIC S9(08)V COMP-3.  03840000
038500             15  ASC-UPC-NBR                 PIC S9(15)V COMP-3.  03850000
038600             15  ASC-EXPT-QTY-N              PIC S9(05).          03860000
038700             15  ASC-SWITCH                  PIC X(01).           03870000
038800                 88  ASC-BALCD-SEQ              VALUE 'B'.        03880000
038900                 88  ASC-UNBAL-SEQ              VALUE 'U'.        03890000
039000                 88  ASC-ALL-SEQ                VALUE ' '.        03900000
039100             15  FILLER                      PIC  X(010).         03910000
039200*-----------------------------------------------------------------03920000
039300             15  ASC-BLK-SUB                  PIC S9(04) COMP     03930000
039400                                                         SYNC.    03940000
039500             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03950000
039600                                                         SYNC.    03960000
039700             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03970000
039800             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03980000
039900             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03990000
040000             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04000000
040100             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04010000
040200             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04020000
040300                                                         SYNC.    04030000
040400             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04040000
040500             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04050000
040600             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04060000
040700                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04070000
040800                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04080000
040900             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04090000
041000                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04100000
041100                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04110000
041200             15  ASC-LIST-QUEUE-NAME.                             04120000
041300                 20  ASC-LIST-TERM-ID         PIC  X(04).         04130000
041400                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04140000
041500                 20  ASC-LIST-SEQ             PIC  9(01).         04150000
041600                                                                  04160000
041700             15  ASC-START-ITEM-REQUEST.                          04170000
041800                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04180000
041900                                                                  04190000
042000             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04200000
042100             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04210000
042200             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04220000
042300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04230000
042400             15  ASC-SEL-QUEUE-NAME.                              04240000
042500                 20  ASC-SEL-TERM-ID          PIC  X(04).         04250000
042600                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04260000
042700                 20  ASC-SEL-SEQ              PIC  9(01).         04270000
042800             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04280000
042900                                                                  04290000
043000*-----------------------------------------------------------------04300000
043100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04310000
043200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04320000
043300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04330000
043400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04340000
043500                                                                  04350000
043600                 20  ASC-ITEM-ARRAY.                              04360000
043700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        04370000
043800                         30  ASC-LIST-ITEM-NUMBER                 04380000
043900                                                     PIC S9(09)   04390000
044000                                                     COMP-3.      04400000
044100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04410000
044200                             88  ASC-VALID-SELECT    VALUE ' '    04420000
044300                                                           'S'    04430000
044400                                                           'B'    04440000
044500                                                           'E'.   04450000
044600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04460000
044700                             88  ASC-TEMP-SELECT     VALUE 'S'.   04470000
044800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04480000
044900                             88  ASC-TEMP-END        VALUE 'E'.   04490000
045000                         30  ASC-SELECTED-SW         PIC  X(01).  04500000
045100                             88  ASC-NO-SELECT       VALUE ' '.   04510000
045200                             88  ASC-SELECT          VALUE 'S'.   04520000
045300                             88  ASC-BEGIN           VALUE 'B'.   04530000
045400                             88  ASC-END             VALUE 'E'.   04540000
045500                         30  ASC-ACTION              PIC  X(03).  04550000
045600                         30  ASC-DEPT                PIC  X(04).  04560000
045700                         30  ASC-CLASS               PIC  X(04).  04570000
045800                         30  ASC-SKU                 PIC  9(08).  04580000
045900                         30  ASC-UPC                 PIC  9(15).  04590000
046000                         30  ASC-EXPT-QTY            PIC S9(05).  04600000
046100                                                                  04610000
046200*---------------------------------------------------------------* 04620000
046300*    ABEND PROCESSING COPYBOOK.                                 * 04630000
046400*---------------------------------------------------------------* 04640000
046500     COPY DPWS013.                                                04650000
046600                                                                  04660000
046700*---------------------------------------------------------------* 04670000
046800*    PCT_TRN_CLSN_DTL -                                         * 04680000
046900*---------------------------------------------------------------* 04690000
047000     EXEC SQL                                                     04700000
047100          INCLUDE PCT00015                                        04710000
047200     END-EXEC.                                                    04720000
047300                                                                  04730000
047400*---------------------------------------------------------------* 04740000
047500*    XLT_SKU          -                                         * 04750000
047600*---------------------------------------------------------------* 04760000
047700     EXEC SQL                                                     04770000
047800          INCLUDE XLT00003                                        04780000
047900     END-EXEC.                                                    04790000
048000                                                                  04800000
048100*---------------------------------------------------------------* 04810019
048200*    TKRPRPM          -                                         * 04820019
048300*---------------------------------------------------------------* 04830019
048400     EXEC SQL                                                     04840019
048500          INCLUDE TKRPRPM                                         04850019
048600     END-EXEC.                                                    04860019
048700                                                                  04870019
048800*---------------------------------------------------------------* 04880000
048900*    DB2 AREA FOR COMMUNICATIONS                                * 04890000
049000*---------------------------------------------------------------* 04900000
049100     EXEC SQL                                                     04910000
049200          INCLUDE SQLCA                                           04920000
049300     END-EXEC.                                                    04930000
049400                                                                  04940000
049500*---------------------------------------------------------------* 04950000
049600*    LIST CURSOR                                                  04960000
049700*---------------------------------------------------------------* 04970000
049800     EXEC SQL                                                     04980000
049900          DECLARE LIST-CSR CURSOR WITH HOLD FOR                   04990002
050000              SELECT                                              05000000
050100                      SUM(TRN_CLSN_PRCG_QTY)                      05010000
050200                    , A.INTR_UPC_ID                               05020000
050300                    , SKU_NBR                                     05030000
050400                FROM  PCT_TRN_CLSN_DTL A                          05040000
050500                    , XLT_SKU B                                   05050000
050600               WHERE  PO_NBR              =  :DK-PO               05060000
050700                 AND  RCVR_SEQ_NBR        =  :DK-RCVR             05070000
050800                 AND  TRN_CLSN_CDE        =  'SE'                 05080000
050900                 AND  A.INTR_UPC_ID       =  B.INTR_UPC_ID        05090000
051000                 AND  A.TRN_TYP_CDE NOT IN ('UM', 'NS', 'MM',     05100015
051100                                            'AM', 'SM')           05110015
051200              GROUP BY  SKU_NBR, A.INTR_UPC_ID                    05120000
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500*---------------------------------------------------------------* 05150001
051600*    STORE CURSOR                                                 05160001
051700*---------------------------------------------------------------* 05170001
051800     EXEC SQL                                                     05180001
051900          DECLARE STORE-CSR CURSOR FOR                            05190001
052000              SELECT                                              05200001
052100                      SUM(TRN_CLSN_PRCG_QTY)                      05210001
052200                    , LOC_NBR                                     05220001
052300                FROM  PCT_TRN_CLSN_DTL                            05230001
052400               WHERE  PO_NBR            =  :DK-PO                 05240001
052500                 AND  RCVR_SEQ_NBR      =  :DK-RCVR               05250001
052600                 AND  TRN_CLSN_CDE      =  'SE'                   05260001
052700                 AND  INTR_UPC_ID       =  :PCT00015-INTR-UPC-ID  05270001
052800                 AND  TRN_TYP_CDE NOT IN ('UM', 'NS', 'MM',       05280015
052900                                          'AM', 'SM')             05290015
053000              GROUP BY  LOC_NBR                                   05300001
053100     END-EXEC.                                                    05310001
053200                                                                  05320001
053300*-----------------------------------------------------------------05330000
053400 LINKAGE SECTION.                                                 05340000
053500                                                                  05350000
053600 01  DFHCOMMAREA.                                                 05360000
053700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05370000
053800                                        DEPENDING ON EIBCALEN.    05380000
053900         10  FILLER                     PIC X.                    05390000
054000                                                                  05400000
054100                                                                  05410000
054200 PROCEDURE DIVISION.                                              05420000
054300******************************************************************05430000
054400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05440000
054500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05450000
054600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05460000
054700******************************************************************05470000
054800 0000-MAIN-MODULE.                                                05480000
054900     INITIALIZE DP030-CICS-API-FIELDS.                            05490000
055000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05500000
055100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05510000
055200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05520000
055300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05530000
055400     MOVE LENGTH OF PC758AI        TO DP030-MAP-LENGTH (1).       05540000
055500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05550000
055600     PERFORM 0001-CALL-CICS-ARCH-API.                             05560000
055700*                                                                 05570000
055800     PERFORM 1000-CONTROL-PROCESSING                              05580000
055900*                                                                 05590000
056000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05600000
056100     PERFORM 0001-CALL-CICS-ARCH-API.                             05610000
056200                                                                  05620000
056300******************************************************************05630000
056400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05640000
056500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05650000
056600******************************************************************05660000
056700 0001-CALL-CICS-ARCH-API.                                         05670000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               05680028
1122RM     CALL DP930-CICS-ARCH-API                                     05681028
1122RM                     USING DFHEIBLK                               05682028
056900                           DFHCOMMAREA                            05690000
057000                           DP030-CICS-API-FIELDS                  05700000
057100                           DP020-STANDARD-COMMAREA                05710000
057200                           PC758AI.                               05720000
057300*                                                                 05730000
057400     IF  DP030-RC-CALL-SUCCESSFUL                                 05740000
057500         CONTINUE                                                 05750000
057600     ELSE                                                         05760000
057700         SET DP013-NO-ROLLBACK                                    05770000
057800             DP013-XCTL-DISPLAY-RESTART                           05780000
057900             DP013-CICS-ABEND      TO TRUE                        05790000
058000         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        05800000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05810028
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05820028
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05821028
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05822028
058300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05830000
058400         PERFORM DP013-0000-PROCESS-ABEND                         05840000
058500     END-IF.                                                      05850000
058600                                                                  05860000
058700*----------------------------------------------------------------*05870000
058800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05880000
058900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05890000
059000*                                                                *05900000
059100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05910000
059200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05920000
059300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05930000
059400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05940000
059500*----------------------------------------------------------------*05950000
059600 1000-CONTROL-PROCESSING.                                         05960000
059700                                                                  05970000
059800     EVALUATE TRUE                                                05980000
059900         WHEN DP020-NEXT-ACT-INITIAL                              05990000
060000             INITIALIZE ASC-SPECIFIC-COMMAREA                     06000000
060100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06010000
060200                                      ASC-SEL-TERM-ID             06020000
060300             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06030000
060400                                           ASC-SEL-TASK-NUMBER    06040000
060500             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06050000
060600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06060000
060700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06070000
060800***-----$TEMPLATE NOTE$-------------------------------------------06080000
060900*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06090000
061000*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06100000
061100*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06110000
061200***---------------------------------------------------------------06120000
061300             IF  PS-COMMAREA-NOT-VALID                            06130000
061400                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            06140000
061500             ELSE                                                 06150000
061600                 SET ASC-ALL-SEQ  TO  TRUE                        06160000
061700                 PERFORM 4000-BUILD-INITIAL-PANEL                 06170000
061800             END-IF                                               06180000
061900                                                                  06190000
062000         WHEN DP020-NEXT-ACT-READ-MAP                             06200000
062100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06210000
062200             PERFORM 2000-PROCESS-PANEL                           06220000
062300                                                                  06230000
062400         WHEN DP020-NEXT-ACT-RETURN                               06240000
062500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06250000
062600             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               06260000
062700             IF ASC-BALCD-SEQ                                     06270000
062800                 MOVE 'BALANCED  '     TO ASEQO                   06280000
062900             ELSE                                                 06290000
063000                 IF ASC-UNBAL-SEQ                                 06300000
063100                     MOVE 'UNBALANCED' TO ASEQO                   06310000
063200                 ELSE                                             06320000
063300                     MOVE SPACES       TO ASEQO                   06330000
063400                 END-IF                                           06340000
063500             END-IF                                               06350000
063600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06360000
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06370000
063800                                                                  06380000
063900         WHEN OTHER                                               06390000
064000             SET DP013-LOGIC-ABEND TO TRUE                        06400000
064100             SET DP013-NO-ROLLBACK TO TRUE                        06410000
064200             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06420000
064300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06430000
064400                                   TO DP013-MESSAGE-TEXT(1)       06440000
064500             PERFORM DP013-0000-PROCESS-ABEND                     06450000
064600     END-EVALUATE.                                                06460000
064700                                                                  06470000
064800*----------------------------------------------------------------*06480000
064900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06490000
065000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06500000
065100*----------------------------------------------------------------*06510000
065200 1100-PROCESS-INTER-APPL-COMM.                                    06520000
065300                                                                  06530000
065400     SET PS-COMMAREA-VALID         TO TRUE.                       06540000
065500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06550000
065600                                                                  06560000
065700     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06570000
065800         MOVE PC210-PO-NBR            TO ASC-PO-NBR               06580000
065900         MOVE PC210-RCVR-NBR          TO ASC-RCVR-NBR             06590000
066000     ELSE                                                         06600000
066100         MOVE PC211-SKU               TO ASC-SKU-NBR              06610000
066200     END-IF.                                                      06620000
066300                                                                  06630000
066400*-----------------------------------------------------------------06640000
066500 1120-PREPARE-LIST-ENTRY.                                         06650000
066600                                                                  06660000
066700     MOVE PC212-MAX-ITEMS          TO ASC-SEL-SUB.                06670000
066800     MOVE ZERO                     TO ASC-SEL-ITEM.               06680000
066900     PERFORM 1130-GET-NEXT-RECORD.                                06690000
067000                                                                  06700000
067100*-----------------------------------------------------------------06710000
067200*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06720000
067300*-----------------------------------------------------------------06730000
067400 1130-GET-NEXT-RECORD.                                            06740000
067500                                                                  06750000
067600     ADD +1                       TO ASC-SEL-SUB.                 06760000
067700                                                                  06770000
067800     IF  ASC-SEL-SUB > PC212-MAX-ITEMS                            06780000
067900         ADD +1                   TO ASC-SEL-ITEM                 06790000
068000         MOVE +1                  TO ASC-SEL-SUB                  06800000
068100     END-IF.                                                      06810000
068200                                                                  06820000
068300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06830000
068400         PERFORM 9100-READ-SEL-QUEUE                              06840000
068500         IF  PC212-ITEM (ASC-SEL-SUB) > ZERO                      06850000
068600             MOVE PC212-PO-RCVR (ASC-SEL-SUB)   TO ASC-PO-RCVR    06860000
068700             SET PC212-INQ (ASC-SEL-SUB)        TO TRUE           06870000
068800             PERFORM 9200-REWRITE-SEL-QUEUE                       06880000
068900         ELSE                                                     06890000
069000             SUBTRACT +1 FROM ASC-SEL-SUB                         06900000
069100             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06910000
069200             SET DP020-MSG-INFORMATIONAL                          06920000
069300                 PS-LIST-END             TO TRUE                  06930000
069400         END-IF                                                   06940000
069500     ELSE                                                         06950000
069600         SUBTRACT +1 FROM ASC-SEL-ITEM                            06960000
069700         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  06970000
069800         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06980000
069900         SET DP020-MSG-INFORMATIONAL                              06990000
070000             PS-LIST-END             TO TRUE                      07000000
070100     END-IF.                                                      07010000
070200                                                                  07020000
070300*-----------------------------------------------------------------07030000
070400*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07040000
070500*    PROCESSED.                                                  *07050000
070600*-----------------------------------------------------------------07060000
070700 1140-GET-PREV-RECORD.                                            07070000
070800                                                                  07080000
070900     SUBTRACT +1 FROM ASC-SEL-SUB.                                07090000
071000                                                                  07100000
071100     IF  ASC-SEL-SUB < +1                                         07110000
071200         SUBTRACT +1 FROM ASC-SEL-ITEM                            07120000
071300         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  07130000
071400     END-IF.                                                      07140000
071500                                                                  07150000
071600     IF  ASC-SEL-ITEM > ZERO                                      07160000
071700         PERFORM 9100-READ-SEL-QUEUE                              07170000
071800         MOVE PC212-PO-RCVR (ASC-SEL-SUB)   TO ASC-PO-RCVR        07180000
071900         SET PC212-INQ (ASC-SEL-SUB)        TO TRUE               07190000
072000         PERFORM 9200-REWRITE-SEL-QUEUE                           07200000
072100     ELSE                                                         07210000
072200         MOVE +1                  TO ASC-SEL-ITEM                 07220000
072300                                     ASC-SEL-SUB                  07230000
072400         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07240000
072500         SET DP020-MSG-INFORMATIONAL                              07250000
072600             PS-LIST-END             TO TRUE                      07260000
072700     END-IF.                                                      07270000
072800                                                                  07280000
072900*----------------------------------------------------------------*07290000
073000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07300000
073100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07310000
073200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07320000
073300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07330000
073400* FUNCTION KEYS CAN GET THIS FAR.                                *07340000
073500*----------------------------------------------------------------*07350000
073600 2000-PROCESS-PANEL.                                              07360000
073700     EVALUATE TRUE                                                07370000
073800         WHEN DP020-SRC-AID = DP016-CLEAR                         07380000
073900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07390000
074000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07400000
074100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07410000
074200                                                                  07420000
074300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07430000
074400             SET ASC-ALL-SEQ  TO  TRUE                            07440000
074500             PERFORM 2050-DELETE-LIST-QUEUE                       07450000
074600             PERFORM 4000-BUILD-INITIAL-PANEL                     07460000
074700                                                                  07470000
074800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07480000
074900             PERFORM 2140-DESELECT-ALL-ITEMS                      07490000
075000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07500000
075100                                                                  07510000
075200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07520000
075300             PERFORM 2150-SELECT-ALL-ITEMS                        07530000
075400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07540000
075500                                                                  07550000
075600         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07560000
075700             IF  ASC-USE-SELECTION-QUEUE                          07570000
075800                 PERFORM 1130-GET-NEXT-RECORD                     07580000
075900                 IF PS-LIST-END                                   07590000
076000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07600000
076100                     SET PS-NO-LIST-END TO TRUE                   07610000
076200                 ELSE                                             07620000
076300                     PERFORM 2050-DELETE-LIST-QUEUE               07630000
076400                     PERFORM 3200-RESET-ATTRIBUTES                07640000
076500                     PERFORM 4000-BUILD-INITIAL-PANEL             07650000
076600                 END-IF                                           07660000
076700              ELSE                                                07670000
076800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07680000
076900*                --- BOTTOM OF LIST ---                           07690000
077000                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07700000
077100                 SET DP020-MSG-INFORMATIONAL TO TRUE              07710000
077200             END-IF                                               07720000
077300                                                                  07730000
077400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07740000
077500             IF  ASC-USE-SELECTION-QUEUE                          07750000
077600                 PERFORM 1140-GET-PREV-RECORD                     07760000
077700                 IF PS-LIST-END                                   07770000
077800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07780000
077900                     SET PS-NO-LIST-END TO TRUE                   07790000
078000                 ELSE                                             07800000
078100                     PERFORM 2050-DELETE-LIST-QUEUE               07810000
078200                     PERFORM 3200-RESET-ATTRIBUTES                07820000
078300                     PERFORM 4000-BUILD-INITIAL-PANEL             07830000
078400                 END-IF                                           07840000
078500             ELSE                                                 07850000
078600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07860000
078700                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07870000
078800                 SET DP020-MSG-INFORMATIONAL TO TRUE              07880000
078900             END-IF                                               07890000
079000                                                                  07900000
079100         WHEN OTHER                                               07910000
079200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07920000
079300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07930000
079400                                                                  07940000
079500             IF  PS-NO-ERROR                                      07950000
079600                 SET DP030-CONTINUE-GO TO TRUE                    07960000
079700                 PERFORM 2100-CHECK-FUNCTION-KEY                  07970000
079800             ELSE                                                 07980000
079900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07990000
080000                 SET DP030-OVERRIDE-GO TO TRUE                    08000000
080100             END-IF                                               08010000
080200     END-EVALUATE.                                                08020000
080300                                                                  08030000
080400*----------------------------------------------------------------*08040000
080500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08050000
080600*----------------------------------------------------------------*08060000
080700 2050-DELETE-LIST-QUEUE.                                          08070000
080800                                                                  08080000
080900     EXEC CICS                                                    08090000
081000         DELETEQ TS                                               08100000
081100             QUEUE (ASC-LIST-QUEUE-NAME)                          08110000
081200             RESP  (PV-CICS-RESP)                                 08120000
081300     END-EXEC.                                                    08130000
081400                                                                  08140000
081500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08150000
081600        (PV-CICS-RESP = DFHRESP(QIDERR))                          08160000
081700         CONTINUE                                                 08170000
081800     ELSE                                                         08180000
081900         SET DP013-CICS-ABEND      TO TRUE                        08190000
082000         SET DP013-NO-ROLLBACK     TO TRUE                        08200000
082100                                                                  08210000
082200         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         08220000
082300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08230000
082400                                   TO DP013-MESSAGE-TEXT (1)      08240000
082500         PERFORM DP013-0000-PROCESS-ABEND                         08250000
082600     END-IF.                                                      08260000
082700                                                                  08270000
082800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08280000
082900                                                                  08290000
083000*----------------------------------------------------------------*08300000
083100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08310000
083200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08320000
083300* CICS ARCHITECTURE API.                                         *08330000
083400*----------------------------------------------------------------*08340000
083500 2100-CHECK-FUNCTION-KEY.                                         08350000
083600                                                                  08360000
083700     EVALUATE TRUE                                                08370000
083800*                                                                 08380000
083900* F17 - PO/RCVR UNBALANCED STORE EXCEPTION STORE LIST             08390000
084000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08400000
084100             IF PS-NO-ERROR                                       08410000
084200*                IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          08420000
084300                     SET ASC-USE-SELECTION-QUEUE TO TRUE          08430000
084400                     INITIALIZE PC211-INTER-APPL-COMMAREA         08440000
084500                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            08450000
084600                                TO PC211-NUMBER-OF-SELECTED-ITEMS 08460000
084700                     MOVE ASC-NUMBER-OF-TS-ITEMS                  08470000
084800                                      TO PC211-NUMBER-OF-TS-ITEMS 08480000
084900                     MOVE ASC-SEL-QUEUE-NAME                      08490000
085000                                           TO PC211-SEL-QUEUE-NAME08500000
085100                     MOVE ASC-PO-NBR      TO PC211-PO-NBR         08510000
085200                     MOVE ASC-RCVR-NBR    TO PC211-RCVR-NBR       08520000
085300                     MOVE ASC-SWITCH      TO PC211-SEQ-SW         08530000
085400                     PERFORM 5000-PREPARE-SEL-QUEUE               08540000
085500                 ELSE                                             08550000
085600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08560000
085700                     SET DP030-OVERRIDE-GO TO TRUE                08570000
085800                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     08580000
085900                     SET DP020-MSG-WARNING TO TRUE                08590000
086000*                END-IF                                           08600000
086100             END-IF                                               08610000
086200                                                                  08620000
086300*                                                                 08630000
086400* F23 - PO/RCVR/LINE LIST                                         08640000
086500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08650000
086600             IF PS-NO-ERROR                                       08660000
086700                 INITIALIZE SU008-INTER-APPL-COMMAREA             08670000
086800                 MOVE ASC-PO-NBR      TO SU008-PO-NBR             08680000
086900                 MOVE ASC-RCVR-NBR    TO SU008-RCVR-NBR           08690000
087000             ELSE                                                 08700000
087100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08710000
087200                 SET DP030-OVERRIDE-GO TO TRUE                    08720000
087300                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         08730000
087400                 SET DP020-MSG-WARNING TO TRUE                    08740000
087500             END-IF                                               08750000
087600                                                                  08760000
087700* F16 - BALANCED ONLY ROWS                                        08770000
087800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08780000
087900             MOVE 'BALANCED  '     TO ASEQO                       08790000
088000             SET ASC-BALCD-SEQ     TO TRUE                        08800000
088100             PERFORM 2050-DELETE-LIST-QUEUE                       08810000
088200             PERFORM 4000-BUILD-INITIAL-PANEL                     08820000
088300                                                                  08830000
088400* F22 - UNBALANCED ONLY ROWS                                      08840000
088500         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              08850000
088600             MOVE 'UNBALANCED'     TO ASEQO                       08860000
088700             SET ASC-UNBAL-SEQ     TO TRUE                        08870000
088800             PERFORM 2050-DELETE-LIST-QUEUE                       08880000
088900             PERFORM 4000-BUILD-INITIAL-PANEL                     08890000
089000                                                                  08900000
089100*                                                                 08910000
089200* F6 - FIRST PAGE                                                 08920000
089300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08930000
089400             MOVE +1               TO PV-TOP-ITEM                 08940000
089500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08950000
089600*                                                                 08960000
089700* F7 - PREVIOUS PAGE                                              08970000
089800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08980000
089900             PERFORM 2110-BROWSE-BACKWARD                         08990000
090000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09000000
090100*                                                                 09010000
090200* F8 - NEXT PAGE                                                  09020000
090300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09030000
090400             PERFORM 2120-BROWSE-FORWARD                          09040000
090500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09050000
090600*                                                                 09060000
090700* ENTER KEY                                                       09070000
090800         WHEN DP020-SRC-AID = DP016-ENTER                         09080000
090900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09090000
091000             IF  PS-ERROR                                         09100000
091100                 CONTINUE                                         09110000
091200             ELSE                                                 09120000
091300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09130000
091400             END-IF                                               09140000
091500                                                                  09150000
091600         WHEN OTHER                                               09160000
091700             SET DP013-NO-ROLLBACK                                09170000
091800                 DP013-XCTL-DISPLAY-RESTART                       09180000
091900                 DP013-CICS-ABEND  TO TRUE                        09190000
092000             MOVE '2100-CHECK-FUNCTION-KEY'                       09200000
092100                                   TO DP013-PARAGRAPH             09210000
092200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09220000
092300                                   TO DP013-MESSAGE-TEXT (1)      09230000
092400             PERFORM DP013-0000-PROCESS-ABEND                     09240000
092500     END-EVALUATE.                                                09250000
092600*                                                                 09260000
092700*----------------------------------------------------------------*09270000
092800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09280000
092900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09290000
093000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09300000
093100*    MESSAGE.                                                    *09310000
093200*----------------------------------------------------------------*09320000
093300 2110-BROWSE-BACKWARD.                                            09330000
093400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09340000
093500         GIVING PV-TOP-ITEM.                                      09350000
093600*                                                                 09360000
093700     IF  ((PV-TOP-ITEM < +1)                                      09370000
093800       OR (PV-TOP-ITEM = +1))                                     09380000
093900         MOVE +1                   TO PV-TOP-ITEM                 09390000
094000*        -- TOP OF LIST --                                        09400000
094100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09410000
094200         SET DP020-MSG-INFORMATIONAL TO TRUE                      09420000
094300     END-IF.                                                      09430000
094400                                                                  09440000
094500*----------------------------------------------------------------*09450000
094600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09460000
094700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09470000
094800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09480000
094900*----------------------------------------------------------------*09490000
095000 2120-BROWSE-FORWARD.                                             09500000
095100                                                                  09510000
095200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09520000
095300         GIVING PV-TOP-ITEM.                                      09530000
095400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09540000
095500         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09550000
095600*        -- BOTTOM OF LIST --                                     09560000
095700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09570000
095800         SET DP020-MSG-INFORMATIONAL  TO TRUE                     09580000
095900     ELSE                                                         09590000
096000         COMPUTE PV-BOTTOM-ITEM =                                 09600000
096100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09610000
096200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09620000
096300*            -- BOTTOM OF LIST --                                 09630000
096400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09640000
096500             SET DP020-MSG-INFORMATIONAL TO TRUE                  09650000
096600         END-IF                                                   09660000
096700     END-IF.                                                      09670000
096800                                                                  09680000
096900*----------------------------------------------------------------*09690000
097000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09700000
097100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09710000
097200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09720000
097300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09730000
097400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09740000
097500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09750000
097600*----------------------------------------------------------------*09760000
097700 2130-CHECK-FOR-JUMP-BROWSE.                                      09770000
097800     SET PS-NO-ERROR               TO TRUE.                       09780000
097900     IF (ASC-START-ITEM-REQUEST = SPACE)                          09790000
098000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09800000
098100                                   TO PV-TOP-ITEM                 09810000
098200     ELSE                                                         09820000
098300         MOVE ASC-START-ITEM-REQUEST                              09830000
098400                                   TO DP010I-UNEDITED-FIELD       09840000
098500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09850000
098600         MOVE LENGTH OF ASC-START-ITEM-REQUEST                    09860000
098700                                 TO DP010I-MAXIMUM-DIGITS         09870000
098800         SET DP010I-NEGATIVE-NOT-ALLOWED                          09880000
098900                                   TO TRUE                        09890000
099010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09901025
099020                         USING DP010I-NUMERIC-EDIT-AREA           09902025
099100                                                                  09910000
099200         IF  NOT DP010I-ERROR-DETECTED                            09920000
099300             MOVE DP010I-NUMERIC-FIELD                            09930000
099400                                   TO  ASC-START-ITEM-REQUEST-N   09940000
099500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09950000
099600                 IF  ASC-START-ITEM-REQUEST-N >                   09960000
099700                                          ASC-NUMBER-OF-ITEMS-READ09970000
099800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09980000
099900                     COMPUTE PV-TOP-ITEM =                        09990000
100000                             ASC-NUMBER-OF-ITEMS-READ             10000000
100100                             - PC-ITEMS-PER-PANEL + 1             10010000
100200                     IF  PV-TOP-ITEM < +1                         10020000
100300                         MOVE +1   TO PV-TOP-ITEM                 10030000
100400                         MOVE PC-TSYMSG-00070                     10040000
100500                                   TO DP020-MSG-NUMBER            10050000
100600                         SET DP020-MSG-INFORMATIONAL              10060000
100700                                   TO TRUE                        10070000
100800                     ELSE                                         10080000
100900                         MOVE  PV-TOP-ITEM                        10090000
101000                           TO  ASC-START-ITEM-REQUEST-N           10100000
101100                     END-IF                                       10110000
101200                 ELSE                                             10120000
101300                     MOVE ASC-START-ITEM-REQUEST-N                10130000
101400                                   TO PV-TOP-ITEM                 10140000
101500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10150000
101600                     COMPUTE PV-BOTTOM-ITEM =                     10160000
101700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10170000
101800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10180000
101900                         SUBTRACT  PV-TOP-ITEM                    10190000
102000                             FROM  ASC-NUMBER-OF-ITEMS-READ       10200000
102100                           GIVING  ASC-ITEMS-DISPLAYED            10210000
102200                         MOVE  ASC-NUMBER-OF-ITEMS-READ           10220000
102300                           TO  PV-BOTTOM-ITEM                     10230000
102400*                        -- BOTTOM OF LIST --                     10240000
102500                         MOVE PC-TSYMSG-00070                     10250000
102600                                   TO DP020-MSG-NUMBER            10260000
102700                         SET DP020-MSG-INFORMATIONAL              10270000
102800                                   TO TRUE                        10280000
102900                     END-IF                                       10290000
103000                 END-IF                                           10300000
103100             ELSE                                                 10310000
103200*                --- VALUE OUT OF RANGE ----                      10320000
103300                 MOVE PC-TSYMSG-00101                             10330000
103400                                   TO DP020-MSG-NUMBER            10340000
103500                 MOVE -1           TO ASTRTITL                    10350000
103600                 SET DP030-SET-CURSOR-APPL-1                      10360000
103700                                   TO TRUE                        10370000
103800                 MOVE DP015-REVERSE                               10380000
103900                                   TO ASTRTITH                    10390000
104000                 MOVE DP015-RED    TO ASTRTITC                    10400000
104100                 MOVE DP015-UNP-NUM-BRT-MDT                       10410000
104200                                   TO ASTRTITA                    10420000
104300                 SET DP020-MSG-FATAL                              10430000
104400                                   TO TRUE                        10440000
104500                 SET PS-ERROR      TO TRUE                        10450000
104600             END-IF                                               10460000
104700         ELSE                                                     10470000
104800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10480000
104900             MOVE -1               TO ASTRTITL                    10490000
105000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10500000
105100             MOVE DP015-REVERSE    TO ASTRTITH                    10510000
105200             MOVE DP015-RED        TO ASTRTITC                    10520000
105300             MOVE DP015-UNP-NUM-BRT-MDT                           10530000
105400                                   TO ASTRTITA                    10540000
105500             SET DP020-MSG-FATAL   TO TRUE                        10550000
105600             SET PS-ERROR          TO TRUE                        10560000
105700         END-IF                                                   10570000
105800     END-IF.                                                      10580000
105900                                                                  10590000
106000*----------------------------------------------------------------*10600000
106100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10610000
106200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10620000
106300*----------------------------------------------------------------*10630000
106400 2140-DESELECT-ALL-ITEMS.                                         10640000
106500     MOVE +1                       TO ASC-BLK-SUB.                10650000
106600                                                                  10660000
106700     PERFORM 2141-CLEAR-SELECTED-INDS                             10670000
106800         VARYING ASC-ITEM-SUB                                     10680000
106900         FROM 1 BY 1                                              10690000
107000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10700000
107100                                                                  10710000
107200     ADD +1                        TO ASC-BLK-SUB.                10720000
107300                                                                  10730000
107400     PERFORM 2141-CLEAR-SELECTED-INDS                             10740000
107500         VARYING ASC-ITEM-SUB                                     10750000
107600         FROM 1 BY 1                                              10760000
107700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10770000
107800                                                                  10780000
107900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10790000
108000                                   TO PV-LIST-ITEM-NUMBER.        10800000
108100                                                                  10810000
108200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10820000
108300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10830000
108400                                                                  10840000
108500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10850000
108600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10860000
108700         MOVE +1                   TO ASC-BLK-SUB                 10870000
108800                                                                  10880000
108900         PERFORM 5100-WRITE-TEMP-STORAGE                          10890000
109000         MOVE +2                   TO ASC-BLK-SUB                 10900000
109100         PERFORM 5100-WRITE-TEMP-STORAGE                          10910000
109200         MOVE +1                   TO ASC-BLK-SUB                 10920000
109300                                                                  10930000
109400         MOVE +1                   TO PV-BLOCK-NUMBER             10940000
109500                                                                  10950000
109600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10960000
109700             PV-FIRST-BLOCK-IN-ARRAY - 1                          10970000
109800                                                                  10980000
109900         PERFORM                                                  10990000
110000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11000000
110100                                                                  11010000
110200             PERFORM 4410-READ-TEMP-STORAGE                       11020000
110300                                                                  11030000
110400             PERFORM 2141-CLEAR-SELECTED-INDS                     11040000
110500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11050000
110600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11060000
110700                                                                  11070000
110800             PERFORM 5100-WRITE-TEMP-STORAGE                      11080000
110900                                                                  11090000
111000             ADD +1                TO PV-BLOCK-NUMBER             11100000
111100                                                                  11110000
111200         END-PERFORM                                              11120000
111300                                                                  11130000
111400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11140000
111500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11150000
111600                                                                  11160000
111700         PERFORM                                                  11170000
111800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11180000
111900                   ASC-HIGHEST-BLOCK-WRITTEN                      11190000
112000                                                                  11200000
112100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11210000
112200                                   TO PV-BLOCK-NUMBER             11220000
112300                                                                  11230000
112400             PERFORM 4410-READ-TEMP-STORAGE                       11240000
112500                                                                  11250000
112600             PERFORM 2141-CLEAR-SELECTED-INDS                     11260000
112700                 VARYING ASC-ITEM-SUB                             11270000
112800                 FROM 1 BY 1                                      11280000
112900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11290000
113000                                                                  11300000
113100             PERFORM 5100-WRITE-TEMP-STORAGE                      11310000
113200                                                                  11320000
113300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11330000
113400         END-PERFORM                                              11340000
113500                                                                  11350000
113600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          11360000
113700         PERFORM 4410-READ-TEMP-STORAGE                           11370000
113800     END-IF.                                                      11380000
113900                                                                  11390000
114000                                                                  11400000
114100     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.11410000
114200     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 11420000
114300     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   11430000
114400                                                                  11440000
114500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11450000
114600                                                                  11460000
114700*----------------------------------------------------------------*11470000
114800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11480000
114900*----------------------------------------------------------------*11490000
115000 2141-CLEAR-SELECTED-INDS.                                        11500000
115100                                                                  11510000
115200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11520000
115300             NOT EQUAL ZERO                                       11530000
115400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11540000
115500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11550000
115600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11560000
115700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11570000
115800                                   TO TRUE                        11580000
115900         END-IF                                                   11590000
116000     END-IF.                                                      11600000
116100                                                                  11610000
116200*----------------------------------------------------------------*11620000
116300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11630000
116400*  FOR ALL ITEMS.                                                *11640000
116500*----------------------------------------------------------------*11650000
116600 2150-SELECT-ALL-ITEMS.                                           11660000
116700                                                                  11670000
116800     MOVE +1                       TO ASC-BLK-SUB.                11680000
116900                                                                  11690000
117000     PERFORM 2151-SET-SELECTED-INDS                               11700000
117100         VARYING ASC-ITEM-SUB                                     11710000
117200         FROM 1 BY 1                                              11720000
117300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11730000
117400                                                                  11740000
117500     ADD +1                        TO ASC-BLK-SUB.                11750000
117600                                                                  11760000
117700     PERFORM 2151-SET-SELECTED-INDS                               11770000
117800         VARYING ASC-ITEM-SUB                                     11780000
117900         FROM 1 BY 1                                              11790000
118000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11800000
118100                                                                  11810000
118200     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       11820000
118300                                                                  11830000
118400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11840000
118500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11850000
118600                                                                  11860000
118700     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            11870000
118800         MOVE +1                   TO ASC-BLK-SUB                 11880000
118900                                                                  11890000
119000         PERFORM 5100-WRITE-TEMP-STORAGE                          11900000
119100         MOVE +2                   TO ASC-BLK-SUB                 11910000
119200         PERFORM 5100-WRITE-TEMP-STORAGE                          11920000
119300         MOVE +1                   TO ASC-BLK-SUB                 11930000
119400         MOVE +1                   TO PV-BLOCK-NUMBER             11940000
119500     END-IF.                                                      11950000
119600*                                                                 11960000
119700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11970000
119800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11980000
119900         MOVE +1                   TO ASC-BLK-SUB                 11990000
120000                                                                  12000000
120100         PERFORM 5100-WRITE-TEMP-STORAGE                          12010000
120200         MOVE +2                   TO ASC-BLK-SUB                 12020000
120300         PERFORM 5100-WRITE-TEMP-STORAGE                          12030000
120400         MOVE +1                   TO ASC-BLK-SUB                 12040000
120500         MOVE +1                   TO PV-BLOCK-NUMBER             12050000
120600                                                                  12060000
120700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12070000
120800             PV-FIRST-BLOCK-IN-ARRAY - 1                          12080000
120900                                                                  12090000
121000         PERFORM                                                  12100000
121100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12110000
121200                                                                  12120000
121300             PERFORM 4410-READ-TEMP-STORAGE                       12130000
121400                                                                  12140000
121500             PERFORM 2151-SET-SELECTED-INDS                       12150000
121600                 VARYING ASC-ITEM-SUB                             12160000
121700                 FROM 1 BY 1                                      12170000
121800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12180000
121900                                                                  12190000
122000             PERFORM 5100-WRITE-TEMP-STORAGE                      12200000
122100                                                                  12210000
122200             ADD +1                TO PV-BLOCK-NUMBER             12220000
122300                                                                  12230000
122400         END-PERFORM                                              12240000
122500                                                                  12250000
122600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12260000
122700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12270000
122800                                                                  12280000
122900         PERFORM                                                  12290000
123000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12300000
123100                   ASC-HIGHEST-BLOCK-WRITTEN                      12310000
123200                                                                  12320000
123300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12330000
123400                                   TO PV-BLOCK-NUMBER             12340000
123500                                                                  12350000
123600             PERFORM 4410-READ-TEMP-STORAGE                       12360000
123700                                                                  12370000
123800             PERFORM 2151-SET-SELECTED-INDS                       12380000
123900                 VARYING ASC-ITEM-SUB                             12390000
124000                 FROM 1 BY 1                                      12400000
124100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12410000
124200                                                                  12420000
124300             PERFORM 5100-WRITE-TEMP-STORAGE                      12430000
124400                                                                  12440000
124500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12450000
124600                                                                  12460000
124700         END-PERFORM                                              12470000
124800                                                                  12480000
124900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12490000
125000                                   TO PV-BLOCK-NUMBER             12500000
125100                                                                  12510000
125200         PERFORM 4410-READ-TEMP-STORAGE                           12520000
125300     END-IF.                                                      12530000
125400                                                                  12540000
125500                                                                  12550000
125600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12560000
125700                       ASC-NUMBER-OF-SELECTED-ITEMS.              12570000
125800                                                                  12580000
125900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12590000
126000                                                                  12600000
126100*----------------------------------------------------------------*12610000
126200*    MARK EACH ITEM AS BEING SELECTED.                           *12620000
126300*----------------------------------------------------------------*12630000
126400 2151-SET-SELECTED-INDS.                                          12640000
126500                                                                  12650000
126600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12660000
126700             NOT EQUAL ZERO                                       12670000
126800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12680000
126900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12690000
127000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12700000
127100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12710000
127200                               TO  TRUE                           12720000
127300         END-IF                                                   12730000
127400     END-IF.                                                      12740000
127500                                                                  12750000
127600******************************************************************12760000
127700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12770000
127800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12780000
127900******************************************************************12790000
128000 2200-MOVE-SCREEN-TO-COMMAREA.                                    12800000
128100                                                                  12810000
128200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12820000
128300     MOVE +1                       TO PV-SUB.                     12830000
128400*                                                                 12840000
128500     PERFORM 3100-SET-SUBSCRIPTS.                                 12850000
128600     IF  ASTRTITL > ZERO                                          12860000
128700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12870000
128800     ELSE                                                         12880000
128900         IF  ASTRTITF = DP015-ERASE-EOF                           12890000
129000             INITIALIZE ASC-START-ITEM-REQUEST                    12900000
129100         END-IF                                                   12910000
129200     END-IF.                                                      12920000
129300                                                                  12930000
129400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12940000
129500         VARYING PV-SUB                                           12950000
129600         FROM 1 BY 1                                              12960000
129700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12970000
129800******************************************************************12980000
129900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12990000
130000******************************************************************13000000
130100 2210-MOVE-LINES-TO-COMMAREA.                                     13010000
130200     IF  MR-SELECTL (PV-SUB) > ZERO                               13020000
130300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13030000
130400         MOVE MR-SELECTI (PV-SUB)                                 13040000
130500                                   TO ASC-TEMP-SELECTED-SW        13050000
130600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13060000
130700     ELSE                                                         13070000
130800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13080000
130900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13090000
131000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13100000
131100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13110000
131200         END-IF                                                   13120000
131300     END-IF.                                                      13130000
131400     ADD +1                        TO ASC-ITEM-SUB.               13140000
131500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13150000
131600         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13160000
131700             COMPUTE PV-BLOCK-NUMBER  =                           13170000
131800                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         13180000
131900                    PC-ITEMS-PER-PANEL                            13190000
132000             PERFORM 5105-REWRITE-ASC-LISTQ                       13200000
132100         END-IF                                                   13210000
132200         ADD +1                    TO ASC-BLK-SUB                 13220000
132300         MOVE +1                   TO ASC-ITEM-SUB                13230000
132400     ELSE                                                         13240000
132500     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             13250000
132600         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13260000
132700             COMPUTE PV-BLOCK-NUMBER  =                           13270000
132800                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         13280000
132900                    PC-ITEMS-PER-PANEL                            13290000
133000             PERFORM 5105-REWRITE-ASC-LISTQ                       13300000
133100         END-IF                                                   13310000
133200     END-IF.                                                      13320000
133300                                                                  13330000
133400******************************************************************13340000
133500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13350000
133600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13360000
133700******************************************************************13370000
133800 3000-EDIT-DATA-IN-COMMAREA.                                      13380000
133900     SET PS-NO-ERROR               TO TRUE.                       13390000
134000     PERFORM 3200-RESET-ATTRIBUTES.                               13400000
134100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13410000
134200                                                                  13420000
134300**                                                                13430000
134400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13440000
134500* EDITTING IS DONE FROM THE BOTTOM UP.                            13450000
134600**                                                                13460000
134700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13470000
134800         ASC-ITEMS-DISPLAYED - 1.                                 13480000
134900     PERFORM 3100-SET-SUBSCRIPTS.                                 13490000
135000                                                                  13500000
135100     IF  PS-NO-ERROR                                              13510000
135200         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        13520000
135300     END-IF.                                                      13530000
135400*                                                                 13540000
135500     IF  PS-NO-ERROR                                              13550000
135600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13560000
135700     END-IF.                                                      13570000
135800*                                                                 13580000
135900     IF  ((PS-NO-ERROR)                                           13590000
136000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13600000
136100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13610000
136200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13620000
136300     END-IF.                                                      13630000
136400                                                                  13640000
136500*----------------------------------------------------------------*13650000
136600*   3005-EDIT-COMMAREA-BLOCKS                                    *13660000
136700*----------------------------------------------------------------*13670000
136800 3005-EDIT-COMMAREA-BLOCKS.                                       13680000
136900     MOVE +1                       TO PV-BLOCK-NUMBER.            13690000
137000     MOVE +1                       TO ASC-BLK-SUB.                13700000
137100     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               13710000
137200                                                                  13720000
137300     COMPUTE PV-BLOCK-NUMBER  =                                   13730000
137400        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 13740000
137500            PC-ITEMS-PER-PANEL.                                   13750000
137600                                                                  13760000
137700     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          13770000
137800                                                                  13780000
137900     PERFORM                                                      13790000
138000       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          13800000
138100          OR PS-ERROR                                             13810000
138200          OR PS-BLOCK-ERROR                                       13820000
138300                                                                  13830000
138400             COMPUTE PV-ITEMS-HOLD  =                             13840000
138500                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        13850000
138600                     PC-ITEMS-PER-PANEL - 1                       13860000
138700                                                                  13870000
138800             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       13880000
138900                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               13890000
139000                     FROM  PV-ITEMS-HOLD                          13900000
139100                   GIVING  PV-ITEMS-DIFF                          13910000
139200                 SUBTRACT  PV-ITEMS-DIFF                          13920000
139300                     FROM  PC-ITEMS-PER-PANEL                     13930000
139400                   GIVING  PV-ITEMS-HOLD                          13940000
139500                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              13950000
139600                                              ASC-ITEM-SUB        13960000
139700                                              ASC-ITEMS-DISPLAYED 13970000
139800             ELSE                                                 13980000
139900                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              13990000
140000                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        14000000
140100             END-IF                                               14010000
140200                                                                  14020000
140300             PERFORM 3300-EDIT-SELECTIONS                         14030000
140400                     VARYING PV-SUB                               14040000
140500                        FROM PV-SUB BY -1                         14050000
140600                       UNTIL PV-SUB < +1                          14060000
140700                                                                  14070000
140800             MOVE +1               TO ASC-BLK-SUB                 14080000
140900                                                                  14090000
141000             PERFORM 5105-REWRITE-ASC-LISTQ                       14100000
141100                                                                  14110000
141200             MOVE +1                TO ASC-BLK-SUB                14120000
141300                                                                  14130000
141400             IF  PS-BLOCK-ERROR                                   14140000
141500                 SET  PS-ERROR     TO TRUE                        14150000
141600                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        14160000
141700                                   TO PV-TOP-ITEM                 14170000
141800             ELSE                                                 14180000
141900                 ADD  +1           TO PV-BLOCK-NUMBER             14190000
142000                 IF  PV-BLOCK-NUMBER >                            14200000
142100                     ASC-HIGHEST-BLOCK-WRITTEN                    14210000
142200                     MOVE +2       TO ASC-BLK-SUB                 14220000
142300                     PERFORM 4410-READ-TEMP-STORAGE               14230000
142400                     MOVE +1       TO ASC-BLK-SUB                 14240000
142500                 ELSE                                             14250000
142600                     PERFORM 4410-READ-TEMP-STORAGE               14260000
142700                     ADD  +1        TO PV-BLOCK-NUMBER            14270000
142800                     MOVE +2        TO ASC-BLK-SUB                14280000
142900                     PERFORM 4410-READ-TEMP-STORAGE               14290000
143000                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            14300000
143100                     MOVE +1        TO ASC-BLK-SUB                14310000
143200                 END-IF                                           14320000
143300             END-IF                                               14330000
143400     END-PERFORM.                                                 14340000
143500                                                                  14350000
143600     IF  PV-ORIGINAL-BLOCK  = +1    OR                            14360000
143700         PS-ERROR                   OR                            14370000
143800         PS-BLOCK-ERROR                                           14380000
143900         CONTINUE                                                 14390000
144000     ELSE                                                         14400000
144100         MOVE +1                 TO PV-BLOCK-NUMBER               14410000
144200         MOVE +1                 TO ASC-BLK-SUB                   14420000
144300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  14430000
144400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           14440000
144500         PERFORM 4410-READ-TEMP-STORAGE                           14450000
144600                                                                  14460000
144700         PERFORM                                                  14470000
144800           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              14480000
144900              OR PS-ERROR                                         14490000
145000              OR PS-BLOCK-ERROR                                   14500000
145100                                                                  14510000
145200                 COMPUTE PV-ITEMS-HOLD  =                         14520000
145300                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    14530000
145400                         PC-ITEMS-PER-PANEL - 1                   14540000
145500                                                                  14550000
145600                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     14560000
145700                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           14570000
145800                         FROM  PV-ITEMS-HOLD                      14580000
145900                       GIVING  PV-ITEMS-DIFF                      14590000
146000                     SUBTRACT  PV-ITEMS-DIFF                      14600000
146100                         FROM  PC-ITEMS-PER-PANEL                 14610000
146200                       GIVING  PV-ITEMS-HOLD                      14620000
146300                         MOVE  PV-ITEMS-HOLD TO PV-SUB            14630000
146400                                                ASC-ITEM-SUB      14640000
146500                                               ASC-ITEMS-DISPLAYED14650000
146600                 ELSE                                             14660000
146700                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          14670000
146800                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    14680000
146900                 END-IF                                           14690000
147000                                                                  14700000
147100                 PERFORM 3300-EDIT-SELECTIONS                     14710000
147200                         VARYING PV-SUB                           14720000
147300                            FROM PV-SUB BY -1                     14730000
147400                           UNTIL PV-SUB < +1                      14740000
147500                                                                  14750000
147600                 MOVE +1               TO ASC-BLK-SUB             14760000
147700                                                                  14770000
147800                 PERFORM 5105-REWRITE-ASC-LISTQ                   14780000
147900                                                                  14790000
148000                 MOVE +1                TO ASC-BLK-SUB            14800000
148100                                                                  14810000
148200                 IF  PS-BLOCK-ERROR                               14820000
148300                     SET  PS-ERROR     TO TRUE                    14830000
148400                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    14840000
148500                                       TO PV-TOP-ITEM             14850000
148600                 ELSE                                             14860000
148700                     ADD  +1            TO PV-BLOCK-NUMBER        14870000
148800                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      14880000
148900                         MOVE +2        TO ASC-BLK-SUB            14890000
149000                         PERFORM 4410-READ-TEMP-STORAGE           14900000
149100                         MOVE +1        TO ASC-BLK-SUB            14910000
149200                     ELSE                                         14920000
149300                         PERFORM 4410-READ-TEMP-STORAGE           14930000
149400                         ADD  +1        TO PV-BLOCK-NUMBER        14940000
149500                         MOVE +2        TO ASC-BLK-SUB            14950000
149600                         PERFORM 4410-READ-TEMP-STORAGE           14960000
149700                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        14970000
149800                         MOVE +1        TO ASC-BLK-SUB            14980000
149900                     END-IF                                       14990000
150000                 END-IF                                           15000000
150100     END-PERFORM.                                                 15010000
150200                                                                  15020000
150300*----------------------------------------------------------------*15030000
150400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15040000
150500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15050000
150600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15060000
150700*                                                                *15070000
150800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15080000
150900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15090000
151000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15100000
151100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15110000
151200*----------------------------------------------------------------*15120000
151300 3100-SET-SUBSCRIPTS.                                             15130000
151400                                                                  15140000
151500     COMPUTE ASC-ITEM-SUB =                                       15150000
151600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15160000
151700                                                                  15170000
151800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15180000
151900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15190000
152000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15200000
152100     ELSE                                                         15210000
152200         MOVE +1                     TO ASC-BLK-SUB               15220000
152300     END-IF.                                                      15230000
152400******************************************************************15240000
152500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15250000
152600******************************************************************15260000
152700 3200-RESET-ATTRIBUTES.                                           15270000
152800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15280000
152900     MOVE DP015-GREEN              TO ASTRTITC.                   15290000
153000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15300000
153100                                                                  15310000
153200     PERFORM                                                      15320000
153300         VARYING PV-SUB                                           15330000
153400         FROM 1 BY 1                                              15340000
153500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15350000
153600             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    15360000
153700             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      15370000
153800             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      15380000
153900     END-PERFORM.                                                 15390000
154000                                                                  15400000
154100******************************************************************15410000
154200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15420000
154300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15430000
154400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15440000
154500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **15450000
154600******************************************************************15460000
154700 3300-EDIT-SELECTIONS.                                            15470000
154800     EVALUATE TRUE                                                15480000
154900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15490000
155000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15500000
155100                 CONTINUE                                         15510000
155200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15520000
155300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15530000
155400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15540000
155500                 MOVE ASC-TEMP-SELECTED-SW                        15550000
155600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15560000
155700                                TO ASC-SELECTED-SW                15570000
155800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15580000
155900             END-IF                                               15590000
156000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15600000
156100                 = SPACE                                          15610000
156200             EVALUATE TRUE                                        15620000
156300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15630000
156400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15640000
156500                     MOVE SPACE TO ASC-SELECTED-SW                15650000
156600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15660000
156700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15670000
156800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15680000
156900                     MOVE SPACE TO ASC-SELECTED-SW                15690000
157000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15700000
157100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15710000
157200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15720000
157300                     MOVE SPACE TO ASC-SELECTED-SW                15730000
157400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15740000
157500             END-EVALUATE                                         15750000
157600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15760000
157700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15770000
157800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15780000
157900             END-IF                                               15790000
158000             PERFORM 3310-EDIT-RANGE                              15800000
158100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15810000
158200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15820000
158300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15830000
158400             END-IF                                               15840000
158500             PERFORM 3310-EDIT-RANGE                              15850000
158600         WHEN OTHER                                               15860000
158700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15870000
158800             SET DP020-MSG-FATAL    TO TRUE                       15880000
158900             MOVE -1                TO MR-SELECTL (PV-SUB)        15890000
159000             SET DP030-SET-CURSOR-APPL-1                          15900000
159100                                    TO TRUE                       15910000
159200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15920000
159300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15930000
159400             SET PS-ERROR TO TRUE                                 15940000
159500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15950000
159600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15960000
159700                 MOVE SPACE         TO ASC-SELECTED-SW            15970000
159800                                        (ASC-BLK-SUB ASC-ITEM-SUB)15980000
159900             END-IF                                               15990000
160000     END-EVALUATE.                                                16000000
160100                                                                  16010000
160200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16020000
160300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16030000
160400     IF  ASC-ITEM-SUB < 1                                         16040000
160500         SUBTRACT +1 FROM ASC-BLK-SUB                             16050000
160600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16060000
160700     END-IF.                                                      16070000
160800                                                                  16080000
160900******************************************************************16090000
161000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16100000
161100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16110000
161200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16120000
161300** THE ENDING.                                                  **16130000
161400******************************************************************16140000
161500 3310-EDIT-RANGE.                                                 16150000
161600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16160000
161700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16170000
161800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16180000
161900                                   TO ASC-SELECTED-SW             16190000
162000                                        (ASC-BLK-SUB ASC-ITEM-SUB)16200000
162100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16210000
162200         ELSE                                                     16220000
162300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16230000
162400                 CONTINUE                                         16240000
162500             ELSE                                                 16250000
162600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16260000
162700                 MOVE PC-TSYMSG-00054                             16270000
162800                                       TO DP020-MSG-NUMBER        16280000
162900                 MOVE -1               TO MR-SELECTL (PV-SUB)     16290000
163000                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     16300000
163100                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     16310000
163200                 SET DP020-MSG-FATAL                              16320000
163300                     DP030-SET-CURSOR-APPL-1                      16330000
163400                     PS-ERROR          TO TRUE                    16340000
163500             END-IF                                               16350000
163600         END-IF                                                   16360000
163700     ELSE                                                         16370000
163800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16380000
163900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16390000
164000                                   TO ASC-SELECTED-SW             16400000
164100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16410000
164200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16420000
164300         ELSE                                                     16430000
164400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16440000
164500                 CONTINUE                                         16450000
164600             ELSE                                                 16460000
164700*                -- ONLY ONE END-OF-RANGE ALLOWED --              16470000
164800                 MOVE PC-TSYMSG-00055                             16480000
164900                                        TO DP020-MSG-NUMBER       16490000
165000                 MOVE -1                TO MR-SELECTL (PV-SUB)    16500000
165100                 SET DP020-MSG-FATAL                              16510000
165200                     DP030-SET-CURSOR-APPL-1                      16520000
165300                     PS-ERROR           TO TRUE                   16530000
165400             END-IF                                               16540000
165500         END-IF                                                   16550000
165600     END-IF.                                                      16560000
165700*                                                                 16570000
165800******************************************************************16580000
165900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **16590000
166000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **16600000
166100******************************************************************16610000
166200 3400-CHECK-RANGE-SEQUENCE.                                       16620000
166300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16630000
166400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16640000
166500       AND  ASC-START-OF-SELECTED-RANGE >                         16650000
166600                                         ASC-END-OF-SELECTED-RANGE16660000
166700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16670000
166800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16680000
166900         SET DP020-MSG-FATAL TO TRUE                              16690000
167000         SET PS-ERROR TO TRUE                                     16700000
167100         PERFORM 3410-POSITION-AT-ERROR                           16710000
167200     END-IF.                                                      16720000
167300******************************************************************16730000
167400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16740000
167500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16750000
167600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16760000
167700******************************************************************16770000
167800 3410-POSITION-AT-ERROR.                                          16780000
167900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16790000
168000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16800000
168100                    - PV-TOP-ITEM + 1.                            16810000
168200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16820000
168300         CONTINUE                                                 16830000
168400     ELSE                                                         16840000
168500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16850000
168600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16860000
168700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16870000
168800     END-IF.                                                      16880000
168900*                                                                 16890000
169000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16900000
169100                    - PV-TOP-ITEM + 1.                            16910000
169200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16920000
169300         CONTINUE                                                 16930000
169400     ELSE                                                         16940000
169500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16950000
169600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16960000
169700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16970000
169800     END-IF.                                                      16980000
169900                                                                  16990000
170000*----------------------------------------------------------------*17000000
170100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17010000
170200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17020000
170300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17030000
170400*----------------------------------------------------------------*17040000
170500 3500-MARK-RANGE-AS-SELECTED.                                     17050000
170600     MOVE +1                       TO  ASC-BLK-SUB.               17060000
170700     PERFORM 3510-MARK-SELECTED-INDS                              17070000
170800         VARYING ASC-ITEM-SUB                                     17080000
170900         FROM 1 BY 1                                              17090000
171000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17100000
171100                                                                  17110000
171200     ADD +1                        TO ASC-BLK-SUB.                17120000
171300     PERFORM 3510-MARK-SELECTED-INDS                              17130000
171400         VARYING ASC-ITEM-SUB                                     17140000
171500         FROM 1 BY 1                                              17150000
171600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17160000
171700                                                                  17170000
171800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17180000
171900                                   TO  PV-LIST-ITEM-NUMBER.       17190000
172000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17200000
172100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17210000
172200               PC-ITEMS-PER-PANEL).                               17220000
172300                                                                  17230000
172400     MOVE ASC-START-OF-SELECTED-RANGE                             17240000
172500                                   TO PV-START-OF-SELECTED-RANGE. 17250000
172600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17260000
172700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17270000
172800               PC-ITEMS-PER-PANEL).                               17280000
172900                                                                  17290000
173000     MOVE ASC-END-OF-SELECTED-RANGE                               17300000
173100                                   TO  PV-END-OF-SELECTED-RANGE.  17310000
173200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17320000
173300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17330000
173400               PC-ITEMS-PER-PANEL).                               17340000
173500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17350000
173600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17360000
173700                                                                  17370000
173800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17380000
173900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17390000
174000         MOVE +1                   TO ASC-BLK-SUB                 17400000
174100         PERFORM 5100-WRITE-TEMP-STORAGE                          17410000
174200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17420000
174300             PV-FIRST-BLOCK-IN-ARRAY - 1                          17430000
174400                                                                  17440000
174500         PERFORM                                                  17450000
174600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17460000
174700                   PV-PREV-BLOCK-IN-ARRAY                         17470000
174800             MOVE PV-FIRST-BLOCK-IN-RANGE                         17480000
174900                                   TO PV-BLOCK-NUMBER             17490000
175000             PERFORM 4410-READ-TEMP-STORAGE                       17500000
175100             PERFORM 3510-MARK-SELECTED-INDS                      17510000
175200                 VARYING ASC-ITEM-SUB                             17520000
175300                 FROM 1 BY 1                                      17530000
175400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17540000
175500             PERFORM 5100-WRITE-TEMP-STORAGE                      17550000
175600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17560000
175700         END-PERFORM                                              17570000
175800                                                                  17580000
175900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17590000
176000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17600000
176100         PERFORM                                                  17610000
176200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17620000
176300                   PV-LAST-BLOCK-IN-RANGE                         17630000
176400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17640000
176500                                   TO PV-BLOCK-NUMBER             17650000
176600             PERFORM 4410-READ-TEMP-STORAGE                       17660000
176700             PERFORM 3510-MARK-SELECTED-INDS                      17670000
176800                 VARYING ASC-ITEM-SUB                             17680000
176900                 FROM 1 BY 1                                      17690000
177000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17700000
177100             PERFORM 5100-WRITE-TEMP-STORAGE                      17710000
177200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17720000
177300         END-PERFORM                                              17730000
177400                                                                  17740000
177500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17750000
177600                                   TO PV-BLOCK-NUMBER             17760000
177700         PERFORM 4410-READ-TEMP-STORAGE                           17770000
177800     END-IF.                                                      17780000
177900                                                                  17790000
178000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17800000
178100                                      ASC-END-OF-SELECTED-RANGE.  17810000
178200                                                                  17820000
178300*----------------------------------------------------------------*17830000
178400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17840000
178500*----------------------------------------------------------------*17850000
178600 3510-MARK-SELECTED-INDS.                                         17860000
178700                                                                  17870000
178800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17880000
178900                                ASC-ITEM-SUB) >                   17890000
179000         ASC-START-OF-SELECTED-RANGE)                             17900000
179100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17910000
179200                                ASC-ITEM-SUB) =                   17920000
179300         ASC-START-OF-SELECTED-RANGE)                             17930000
179400                                                                  17940000
179500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17950000
179600                                    ASC-ITEM-SUB) <               17960000
179700             ASC-END-OF-SELECTED-RANGE)                           17970000
179800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17980000
179900                                    ASC-ITEM-SUB) =               17990000
180000             ASC-END-OF-SELECTED-RANGE)                           18000000
180100                                                                  18010000
180200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18020000
180300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18030000
180400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18040000
180500                               TO TRUE                            18050000
180600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18060000
180700                               TO TRUE                            18070000
180800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18080000
180900             END-IF                                               18090000
181000         END-IF                                                   18100000
181100     END-IF.                                                      18110000
181200                                                                  18120000
181300*----------------------------------------------------------------*18130000
181400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18140000
181500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18150000
181600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18160000
181700*    DISPLAY THE PANEL TO USER.                                  *18170000
181800*----------------------------------------------------------------*18180000
181900 4000-BUILD-INITIAL-PANEL.                                        18190000
182000                                                                  18200000
182100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18210000
182200                                 ASC-BLOCK-ENTRIES (2).           18220000
182300     MOVE +1                 TO ASC-BLK-SUB.                      18230000
182400     SET ASC-ITEMS-LEFT-ON-DB                                     18240000
182500                             TO TRUE.                             18250000
182600                                                                  18260000
182700     MOVE +0                 TO ASC-ITEM-SUB                      18270000
182800                                ASC-NUMBER-OF-ITEMS-READ          18280000
182900                                ASC-NUMBER-OF-SELECTED-ITEMS      18290000
183000                                ASC-HIGHEST-BLOCK-WRITTEN         18300000
183100                                ASC-START-OF-SELECTED-RANGE       18310000
183200                                ASC-END-OF-SELECTED-RANGE         18320000
183300                                ASC-ITEM-AT-TOP-OF-PANEL.         18330000
183400                                                                  18340000
183500     MOVE ASC-PO-NBR         TO DK-PO.                            18350000
183600     MOVE ASC-RCVR-NBR       TO DK-RCVR.                          18360000
183700                                                                  18370000
183800     PERFORM 4010-OPEN-CURSOR.                                    18380000
183900     PERFORM 4300-READ-ITEMS-FROM-DB.                             18390000
184000     PERFORM 4020-CLOSE-CURSOR.                                   18400000
184100                                                                  18410000
184200     MOVE +1                   TO  PV-TOP-ITEM.                   18420000
184300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18430000
184400         IF  ASC-BALCD-SEQ OR ASC-UNBAL-SEQ                       18440000
184500             SET DP020-MSG-WARNING TO  TRUE                       18450000
184600             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           18460000
184700             PERFORM 2050-DELETE-LIST-QUEUE                       18470000
184800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18480000
184900         ELSE                                                     18490000
185000             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                18500000
185100             SET DP020-MSG-FATAL   TO  TRUE                       18510000
185200             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           18520000
185300         END-IF                                                   18530000
185400     ELSE                                                         18540000
185500         MOVE -1               TO MR-SELECTL (1)                  18550000
185600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18560000
185700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18570000
185800     END-IF.                                                      18580000
185900                                                                  18590000
186000*----------------------------------------------------------------*18600000
186100* OPEN THE CURSOR                                                 18610000
186200*----------------------------------------------------------------*18620000
186300 4010-OPEN-CURSOR.                                                18630000
186400     PERFORM                                                      18640000
186500         WITH TEST AFTER                                          18650000
186600         VARYING PV-RETRY-COUNTER                                 18660000
186700         FROM 1 BY 1                                              18670000
186800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18680000
186900                   OR (SQLCODE = ZERO))                           18690000
187000                                                                  18700000
187100         EXEC SQL                                                 18710000
187200              OPEN LIST-CSR                                       18720000
187300         END-EXEC                                                 18730000
187400                                                                  18740000
187500         EVALUATE TRUE                                            18750000
187600             WHEN SQLCODE = ZERO                                  18760000
187700             WHEN SQLCODE = -904                                  18770000
187800             WHEN SQLCODE = -913                                  18780000
187900                 CONTINUE                                         18790000
188000             WHEN SQLWARN0 NOT = SPACES                           18800000
188100             WHEN SQLCODE < ZERO                                  18810000
188200             WHEN SQLCODE > ZERO                                  18820000
188300                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       18830000
188400                 MOVE 'OPEN CURSOR PROBLEM    - '                 18840000
188500                                   TO DP013-MESSAGE-TEXT (1)      18850000
188600                 MOVE SQLCA        TO DP013-SQLCA                 18860000
188700                 MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)    18870000
188800                 SET DP013-DB2-ABEND                              18880000
188900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18890000
189000                 PERFORM DP013-0000-PROCESS-ABEND                 18900000
189100         END-EVALUATE                                             18910000
189200     END-PERFORM.                                                 18920000
189300*                                                                 18930000
189400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18940000
189500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18950000
189600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18960000
189700                                   TO DP013-MESSAGE-TEXT (1)      18970000
189800         MOVE SQLCA                TO DP013-SQLCA                 18980000
189900         MOVE 'IN-TRNST'           TO DP013-DB2-TABLE-NAME (1)    18990000
190000         SET DP013-DB2-ABEND                                      19000000
190100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19010000
190200         PERFORM DP013-0000-PROCESS-ABEND                         19020000
190300     END-IF.                                                      19030000
190400                                                                  19040000
190500*----------------------------------------------------------------*19050000
190600* CLOSE THE CURSOR.                                               19060000
190700*----------------------------------------------------------------*19070000
190800 4020-CLOSE-CURSOR.                                               19080000
190900                                                                  19090000
191000     EXEC SQL                                                     19100000
191100          CLOSE LIST-CSR                                          19110000
191200     END-EXEC                                                     19120000
191300                                                                  19130000
191400     EVALUATE TRUE                                                19140000
191500         WHEN SQLCODE = ZERO                                      19150000
191600         WHEN SQLCODE = +100                                      19160000
191700             CONTINUE                                             19170000
191800         WHEN SQLWARN0 NOT = SPACES                               19180000
191900         WHEN SQLCODE < ZERO                                      19190000
192000         WHEN SQLCODE > ZERO                                      19200000
192100             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          19210000
192200             MOVE 'CLOSE CURSOR PROBLEM   '                       19220000
192300                               TO DP013-MESSAGE-TEXT (1)          19230000
192400             MOVE SQLCA        TO DP013-SQLCA                     19240000
192500             MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)        19250000
192600             SET DP013-DB2-ABEND                                  19260000
192700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19270000
192800             PERFORM DP013-0000-PROCESS-ABEND                     19280000
192900     END-EVALUATE.                                                19290000
193000                                                                  19300000
193100*----------------------------------------------------------------*19310000
193200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19320000
193300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19330000
193400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19340000
193500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19350000
193600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19360000
193700*                                                                *19370000
193800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19380000
193900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19390000
194000*    UPON INITIALIZATION.                                        *19400000
194100*----------------------------------------------------------------*19410000
194200 4300-READ-ITEMS-FROM-DB.                                         19420000
194300                                                                  19430000
194400     PERFORM                                                      19440000
194500       VARYING PV-READ-COUNT                                      19450000
194600       FROM 1 BY 1                                                19460000
194700       UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                      19470000
194800          OR (ASC-NO-ITEMS-LEFT-ON-DB))                           19480000
194900                                                                  19490000
195000       PERFORM 4310-FETCH                                         19500000
195100                                                                  19510000
195200       IF ASC-UNBAL-SEQ                                           19520000
195300           IF PCT00015-TRN-CLSN-PRCG-QTY NOT EQUAL ZERO           19530000
195400             IF  ASC-ITEMS-LEFT-ON-DB                             19540000
195500                 IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL            19550000
195600                     ADD +1            TO ASC-ITEM-SUB            19560000
195700                 ELSE                                             19570000
195800                     ADD +1            TO ASC-BLK-SUB             19580000
195900                     MOVE +1           TO ASC-ITEM-SUB            19590000
196000                                                                  19600000
196100                     IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY     19610000
196200                         MOVE +1       TO ASC-BLK-SUB             19620000
196300                         SET ASC-BLOCK-MODIFIED (1) TO TRUE       19630000
196400                         PERFORM 5100-WRITE-TEMP-STORAGE          19640000
196500                         MOVE ASC-BLOCK-ENTRIES                   19650000
196600                                   (PC-MAX-BLOCKS-IN-ARRAY)       19660000
196700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19670000
196800                         ADD +1        TO ASC-BLK-SUB             19680000
196900                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)19690000
197000                        SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)   19700000
197100                                                          TO TRUE 19710000
197200                     END-IF                                       19720000
197300                 END-IF                                           19730000
197400                 ADD +1                TO ASC-NUMBER-OF-ITEMS-READ19740000
197500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      19750000
197600                 MOVE ASC-NUMBER-OF-ITEMS-READ                    19760000
197700                                       TO ASC-LIST-ITEM-NUMBER    19770000
197800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19780000
197900                 PERFORM 4320-CALL-XLKUT001                       19790000
198000                 MOVE XL001-DEPT-NBR                              19800000
198100                         TO ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)   19810000
198200                 MOVE XL001-MAJ-CL-NBR                            19820000
198300                         TO ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)  19830000
198400                 MOVE XLT00003-SKU-NBR                            19840000
198500                         TO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)    19850000
198600                 MOVE XL001-UPC-NBR                               19860000
198700                         TO ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)    19870000
198800                 MOVE PCT00015-TRN-CLSN-PRCG-QTY                  19880000
198900                        TO ASC-EXPT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)19890000
199000             END-IF                                               19900000
199100           ELSE                                                   19910000
199200               PERFORM 4330-CHECK-STORES                          19920001
199300               IF  PS-DISPLAY-YES                                 19930002
199400                 IF  ASC-ITEMS-LEFT-ON-DB                         19940007
199500                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL          19950002
199600                       ADD +1            TO ASC-ITEM-SUB          19960002
199700                   ELSE                                           19970002
199800                       ADD +1            TO ASC-BLK-SUB           19980002
199900                       MOVE +1           TO ASC-ITEM-SUB          19990002
200000                                                                  20000002
200100                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY   20010002
200200                           MOVE +1       TO ASC-BLK-SUB           20020002
200300                           SET ASC-BLOCK-MODIFIED (1) TO TRUE     20030002
200400                           PERFORM 5100-WRITE-TEMP-STORAGE        20040002
200500                           MOVE ASC-BLOCK-ENTRIES                 20050002
200600                                   (PC-MAX-BLOCKS-IN-ARRAY)       20060002
200700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20070002
200800                           ADD +1        TO ASC-BLK-SUB           20080002
200900                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)20090002
201000                          SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) 20100002
201100                                                          TO TRUE 20110002
201200                       END-IF                                     20120002
201300                   END-IF                                         20130002
201400                   ADD +1              TO ASC-NUMBER-OF-ITEMS-READ20140002
201500                   SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE    20150002
201600                   MOVE ASC-NUMBER-OF-ITEMS-READ                  20160002
201700                                       TO ASC-LIST-ITEM-NUMBER    20170002
201800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20180002
201900                   PERFORM 4320-CALL-XLKUT001                     20190002
202000                   MOVE XL001-DEPT-NBR                            20200002
202100                         TO ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)   20210002
202200                   MOVE XL001-MAJ-CL-NBR                          20220002
202300                         TO ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)  20230002
202400                   MOVE XLT00003-SKU-NBR                          20240002
202500                         TO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)    20250002
202600                   MOVE XL001-UPC-NBR                             20260002
202700                         TO ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)    20270002
202800                   MOVE PV-QTY-TOTAL TO PCT00015-TRN-CLSN-PRCG-QTY20280006
202900                   MOVE PCT00015-TRN-CLSN-PRCG-QTY                20290006
203000                        TO ASC-EXPT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)20300006
203100                 END-IF                                           20310007
203200               ELSE                                               20320006
203300                   CONTINUE                                       20330006
203400               END-IF                                             20340006
203500           END-IF                                                 20350002
203600       ELSE                                                       20360000
203700           IF ASC-BALCD-SEQ                                       20370000
203800               IF PCT00015-TRN-CLSN-PRCG-QTY EQUAL ZERO           20380000
203900                   PERFORM 4330-CHECK-STORES                      20390004
204000                   IF  PS-DISPLAY-NO                              20400004
204100                     IF  ASC-ITEMS-LEFT-ON-DB                     20410007
204200                       IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL      20420004
204300                           ADD +1            TO ASC-ITEM-SUB      20430004
204400                       ELSE                                       20440004
204500                           ADD +1            TO ASC-BLK-SUB       20450004
204600                           MOVE +1           TO ASC-ITEM-SUB      20460004
204700                          IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY 20470004
204800                              MOVE +1       TO ASC-BLK-SUB        20480004
204900                              SET ASC-BLOCK-MODIFIED (1) TO TRUE  20490004
205000                              PERFORM 5100-WRITE-TEMP-STORAGE     20500004
205100                              MOVE ASC-BLOCK-ENTRIES              20510004
205200                                          (PC-MAX-BLOCKS-IN-ARRAY)20520004
205300                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)20530004
205400                              ADD +1        TO ASC-BLK-SUB        20540004
205500                              INITIALIZE ASC-BLOCK-ENTRIES        20550004
205600                                                     (ASC-BLK-SUB)20560004
205700                              SET ASC-BLOCK-NOT-MODIFIED          20570004
205800                                          (ASC-BLK-SUB)   TO TRUE 20580004
205900                          END-IF                                  20590004
206000                       END-IF                                     20600004
206100                       ADD +1          TO ASC-NUMBER-OF-ITEMS-READ20610004
206200                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE20620004
206300                       MOVE ASC-NUMBER-OF-ITEMS-READ              20630004
206400                                           TO ASC-LIST-ITEM-NUMBER20640004
206500                                        (ASC-BLK-SUB ASC-ITEM-SUB)20650004
206600                       PERFORM 4320-CALL-XLKUT001                 20660004
206700                       MOVE XL001-DEPT-NBR                        20670004
206800                            TO ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)20680004
206900                       MOVE XL001-MAJ-CL-NBR                      20690004
207000                           TO ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)20700004
207100                       MOVE XLT00003-SKU-NBR                      20710004
207200                             TO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)20720004
207300                       MOVE XL001-UPC-NBR                         20730004
207400                             TO ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)20740004
207500                       MOVE PV-QTY-TOTAL TO                       20750006
207600                                        PCT00015-TRN-CLSN-PRCG-QTY20760006
207700                       MOVE PCT00015-TRN-CLSN-PRCG-QTY            20770004
207800                        TO ASC-EXPT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)20780000
207900                     END-IF                                       20790007
208000                   ELSE                                           20800004
208100                       CONTINUE                                   20810004
208200                   END-IF                                         20820004
208300               ELSE                                               20830000
208400                   CONTINUE                                       20840000
208500               END-IF                                             20850000
208600           ELSE                                                   20860000
208700               IF ASC-ITEMS-LEFT-ON-DB                            20870000
208800                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL          20880000
208900                       ADD +1            TO ASC-ITEM-SUB          20890000
209000                   ELSE                                           20900000
209100                       ADD +1            TO ASC-BLK-SUB           20910000
209200                       MOVE +1           TO ASC-ITEM-SUB          20920000
209300                                                                  20930000
209400                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY   20940000
209500                           MOVE +1       TO ASC-BLK-SUB           20950000
209600                           SET ASC-BLOCK-MODIFIED (1) TO TRUE     20960000
209700                           PERFORM 5100-WRITE-TEMP-STORAGE        20970000
209800                           MOVE ASC-BLOCK-ENTRIES                 20980000
209900                                   (PC-MAX-BLOCKS-IN-ARRAY)       20990000
210000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21000000
210100                           ADD +1        TO ASC-BLK-SUB           21010000
210200                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)21020000
210300                           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)21030000
210400                                                          TO TRUE 21040000
210500                       END-IF                                     21050000
210600                   END-IF                                         21060000
210700                   ADD +1              TO ASC-NUMBER-OF-ITEMS-READ21070000
210800                   SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE    21080000
210900                   MOVE ASC-NUMBER-OF-ITEMS-READ                  21090000
211000                                       TO ASC-LIST-ITEM-NUMBER    21100000
211100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21110000
211200                   PERFORM 4320-CALL-XLKUT001                     21120000
211300                   MOVE XL001-DEPT-NBR                            21130000
211400                         TO ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)   21140000
211500                   MOVE XL001-MAJ-CL-NBR                          21150000
211600                         TO ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)  21160000
211700                   MOVE XLT00003-SKU-NBR                          21170000
211800                         TO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)    21180000
211900                   MOVE XL001-UPC-NBR                             21190000
212000                         TO ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)    21200000
212100                   MOVE PCT00015-TRN-CLSN-PRCG-QTY                21210000
212200                        TO ASC-EXPT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)21220000
212300               END-IF                                             21230000
212400           END-IF                                                 21240000
212500       END-IF                                                     21250000
212600     END-PERFORM.                                                 21260000
212700                                                                  21270000
212800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21280000
212900         MOVE +1               TO ASC-BLK-SUB                     21290000
213000         PERFORM 5100-WRITE-TEMP-STORAGE                          21300000
213100         ADD +1                TO ASC-BLK-SUB                     21310000
213200         PERFORM 5100-WRITE-TEMP-STORAGE                          21320000
213300                                                                  21330000
213400         MOVE 1                TO ASC-BLK-SUB                     21340000
213500                                  PV-BLOCK-NUMBER                 21350000
213600         PERFORM 4410-READ-TEMP-STORAGE                           21360000
213700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21370000
213800             MOVE 2            TO ASC-BLK-SUB                     21380000
213900                                  PV-BLOCK-NUMBER                 21390000
214000             PERFORM 4410-READ-TEMP-STORAGE                       21400000
214100         END-IF                                                   21410000
214200     END-IF.                                                      21420000
214300                                                                  21430000
214400*----------------------------------------------------------------*21440000
214500*    FETCH THE CURSOR                                             21450000
214600*----------------------------------------------------------------*21460000
214700 4310-FETCH.                                                      21470000
214800                                                                  21480000
214900     EXEC SQL                                                     21490000
215000          FETCH LIST-CSR                                          21500000
215100            INTO :PCT00015-TRN-CLSN-PRCG-QTY                      21510000
215200                ,:PCT00015-INTR-UPC-ID                            21520000
215300                ,:XLT00003-SKU-NBR                                21530000
215400     END-EXEC                                                     21540000
215500                                                                  21550000
215600                                                                  21560000
215700     EVALUATE TRUE                                                21570000
215800         WHEN SQLCODE = ZERO                                      21580000
215900              CONTINUE                                            21590000
216000                                                                  21600000
216100         WHEN SQLCODE = +100                                      21610000
216200              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 21620000
216300                                                                  21630000
216400         WHEN SQLWARN0 NOT = SPACE                                21640000
216500         WHEN SQLCODE NOT = ZERO                                  21650000
216600              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         21660000
216700              MOVE 'FETCH CURSOR PROBLEM '                        21670000
216800                               TO DP013-MESSAGE-TEXT (1)          21680000
216900              MOVE SQLCA       TO DP013-SQLCA                     21690000
217000              MOVE 'IN_TRNST'   TO DP013-DB2-TABLE-NAME (1)       21700000
217100              SET DP013-DB2-ABEND TO TRUE                         21710000
217200              PERFORM DP013-0000-PROCESS-ABEND                    21720000
217300     END-EVALUATE.                                                21730000
217400                                                                  21740000
217500*----------------------------------------------------------------*21750000
217600* CALL XLKUT001 MODULE                                           *21760000
217700*----------------------------------------------------------------*21770000
217800 4320-CALL-XLKUT001.                                              21780000
217900                                                                  21790000
218000     INITIALIZE XL001-ITEM-COMMAREA.                              21800000
218100     MOVE PCT00015-INTR-UPC-ID TO  XL001-KEY-INTR-UPC-ID.         21810000
218200     SET XL001-BY-INTR-UPC-ID                                     21820000
218300         XL001-SELECT-UPC                                         21830000
218400         XL001-SELECT-VND-STYL TO TRUE.                           21840000
218500                                                                  21850000
218600     CALL PC-XL001-VSM-PGM USING DFHEIBLK                         21860000
218700                                 XL001-COMMAREA                   21870000
218800                                 XL001-ITEM-COMMAREA.             21880000
218900                                                                  21890000
219000     IF XL001-SUCCESSFUL                                          21900000
219100         CONTINUE                                                 21910000
219200     ELSE                                                         21920000
219300         MOVE ZEROES  TO  XL001-DEPT-NBR                          21930000
219400                          XL001-MAJ-CL-NBR                        21940000
219500                          XL001-UPC-NBR                           21950000
219600     END-IF.                                                      21960000
219700                                                                  21970000
219800*----------------------------------------------------------------*21980001
219900* A SKU COULD HAVE 2 STORES OUT OF BALANCE BUT COMBINED THEY     *21990001
220000* EQUAL 0 (FOR EX: STORE 8 = -2 AND STORE 4 = +2).  IF A STORE   *22000001
220100* HAS A QUANTITY NOT EQUAL TO ZERO, SHOW THIS SKU AS UNBALANCED. *22010001
220200*----------------------------------------------------------------*22020001
220300 4330-CHECK-STORES.                                               22030001
220400                                                                  22040001
220500     INITIALIZE PV-QTY-TOTAL.                                     22050006
220600     SET PS-DISPLAY-NO                                            22060006
220700         PS-NOT-END-OF-CSR  TO TRUE.                              22070006
220800     PERFORM 4331-OPEN-CURSOR.                                    22080006
220900     PERFORM 4332-FETCH-CURSOR UNTIL PS-END-OF-CSR.               22090006
221000     PERFORM 4333-CLOSE-CURSOR.                                   22100006
221100                                                                  22110006
221200*----------------------------------------------------------------*22120006
221300* OPEN THE CURSOR                                                 22130006
221400*----------------------------------------------------------------*22140006
221500 4331-OPEN-CURSOR.                                                22150006
221600     PERFORM                                                      22160006
221700         WITH TEST AFTER                                          22170006
221800         VARYING PV-RETRY-COUNTER                                 22180006
221900         FROM 1 BY 1                                              22190006
222000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22200006
222100                   OR (SQLCODE = ZERO))                           22210006
222200                                                                  22220006
222300         EXEC SQL                                                 22230006
222400              OPEN STORE-CSR                                      22240006
222500         END-EXEC                                                 22250006
222600                                                                  22260006
222700         EVALUATE TRUE                                            22270006
222800             WHEN SQLCODE = ZERO                                  22280006
222900             WHEN SQLCODE = -904                                  22290006
223000             WHEN SQLCODE = -913                                  22300006
223100                 CONTINUE                                         22310006
223200             WHEN SQLWARN0 NOT = SPACES                           22320006
223300             WHEN SQLCODE < ZERO                                  22330006
223400             WHEN SQLCODE > ZERO                                  22340006
223500                 MOVE '4331-OPEN-CURSOR' TO DP013-PARAGRAPH       22350006
223600                 MOVE 'OPEN CURSOR PROBLEM    - '                 22360001
223700                                   TO DP013-MESSAGE-TEXT (1)      22370001
223800                 MOVE SQLCA        TO DP013-SQLCA                 22380001
223900                 MOVE 'TRN_CLSN'   TO DP013-DB2-TABLE-NAME (1)    22390001
224000                 SET DP013-DB2-ABEND                              22400001
224100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22410001
224200                 PERFORM DP013-0000-PROCESS-ABEND                 22420001
224300         END-EVALUATE                                             22430001
224400     END-PERFORM.                                                 22440001
224500*                                                                 22450001
224600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22460001
224700         MOVE '4331-OPEN-CURSOR'   TO DP013-PARAGRAPH             22470001
224800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22480001
224900                                   TO DP013-MESSAGE-TEXT (1)      22490001
225000         MOVE SQLCA                TO DP013-SQLCA                 22500001
225100         MOVE 'TRN_CLSN'           TO DP013-DB2-TABLE-NAME (1)    22510001
225200         SET DP013-DB2-ABEND                                      22520001
225300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   22530001
225400         PERFORM DP013-0000-PROCESS-ABEND                         22540001
225500     END-IF.                                                      22550001
225600                                                                  22560001
225700*----------------------------------------------------------------*22570001
225800* FETCH THE STORE CURSOR.                                         22580001
225900*----------------------------------------------------------------*22590001
226000 4332-FETCH-CURSOR.                                               22600001
226100                                                                  22610001
226200     EXEC SQL                                                     22620001
226300          FETCH STORE-CSR                                         22630001
226400            INTO :PCT00015-TRN-CLSN-PRCG-QTY                      22640001
226500                ,:PCT00015-LOC-NBR                                22650001
226600     END-EXEC                                                     22660001
226700                                                                  22670001
226800     EVALUATE TRUE                                                22680001
226900         WHEN SQLCODE = ZERO                                      22690001
227000              IF PCT00015-TRN-CLSN-PRCG-QTY NOT = 0               22700001
227100                  ADD PCT00015-TRN-CLSN-PRCG-QTY TO PV-QTY-TOTAL  22710006
227200                  SET PS-DISPLAY-YES TO TRUE                      22720006
227300              ELSE                                                22730001
227400                  SET PS-DISPLAY-NO  TO TRUE                      22740001
227500              END-IF                                              22750001
227600         WHEN SQLCODE = +100                                      22760001
227700              SET PS-END-OF-CSR TO TRUE                           22770001
227800         WHEN SQLWARN0 NOT = SPACE                                22780001
227900         WHEN SQLCODE NOT = ZERO                                  22790001
228000              MOVE '4332-FETCH-CURSOR' TO DP013-PARAGRAPH         22800001
228100              MOVE 'FETCH CURSOR PROBLEM '                        22810001
228200                               TO DP013-MESSAGE-TEXT (1)          22820001
228300              MOVE SQLCA       TO DP013-SQLCA                     22830001
228400              MOVE 'TRN_CLSN'   TO DP013-DB2-TABLE-NAME (1)       22840001
228500              SET DP013-DB2-ABEND TO TRUE                         22850001
228600              PERFORM DP013-0000-PROCESS-ABEND                    22860001
228700     END-EVALUATE.                                                22870001
228800                                                                  22880001
228900*----------------------------------------------------------------*22890001
229000* CLOSE THE CURSOR.                                               22900001
229100*----------------------------------------------------------------*22910001
229200 4333-CLOSE-CURSOR.                                               22920001
229300                                                                  22930001
229400     EXEC SQL                                                     22940001
229500          CLOSE STORE-CSR                                         22950002
229600     END-EXEC                                                     22960001
229700                                                                  22970001
229800     EVALUATE TRUE                                                22980001
229900         WHEN SQLCODE = ZERO                                      22990001
230000         WHEN SQLCODE = +100                                      23000001
230100             CONTINUE                                             23010001
230200         WHEN SQLWARN0 NOT = SPACES                               23020001
230300         WHEN SQLCODE < ZERO                                      23030001
230400         WHEN SQLCODE > ZERO                                      23040001
230500             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          23050001
230600             MOVE 'CLOSE CURSOR PROBLEM   '                       23060001
230700                               TO DP013-MESSAGE-TEXT (1)          23070001
230800             MOVE SQLCA        TO DP013-SQLCA                     23080001
230900             MOVE 'TRN_CLSN'   TO DP013-DB2-TABLE-NAME (1)        23090001
231000             SET DP013-DB2-ABEND                                  23100001
231100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23110001
231200             PERFORM DP013-0000-PROCESS-ABEND                     23120001
231300     END-EVALUATE.                                                23130001
231400                                                                  23140001
231500*----------------------------------------------------------------*23150001
231600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23160001
231700*----------------------------------------------------------------*23170000
231800 4400-MOVE-COMMAREA-TO-SCREEN.                                    23180000
231900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23190000
232000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23200000
232100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23210000
232200             MOVE +1    TO ASC-BLK-SUB                            23220000
232300             PERFORM 5100-WRITE-TEMP-STORAGE                      23230000
232400             ADD +1     TO ASC-BLK-SUB                            23240000
232500             PERFORM 5100-WRITE-TEMP-STORAGE                      23250000
232600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23260000
232700                 GIVING PV-BLOCK-NUMBER                           23270000
232800                 REMAINDER PV-REMAINDER                           23280000
232900             IF  PV-REMAINDER > ZERO                              23290000
233000                 ADD +1 TO PV-BLOCK-NUMBER                        23300000
233100             END-IF                                               23310000
233200             MOVE +1    TO ASC-BLK-SUB                            23320000
233300             PERFORM 4410-READ-TEMP-STORAGE                       23330000
233400             ADD +1     TO ASC-BLK-SUB                            23340000
233500                           PV-BLOCK-NUMBER                        23350000
233600             PERFORM 4410-READ-TEMP-STORAGE                       23360000
233700     END-IF.                                                      23370000
233800     MOVE +1            TO ASC-BLK-SUB.                           23380000
233900     COMPUTE ASC-ITEM-SUB =                                       23390000
234000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23400000
234100         + PC-ITEMS-PER-PANEL).                                   23410000
234200*                                                                 23420000
234300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23430000
234400         ADD +1         TO ASC-BLK-SUB                            23440000
234500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23450000
234600     END-IF.                                                      23460000
234700*                                                                 23470000
234800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23480000
234900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23490000
235000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23500000
235100     PERFORM 4420-FORMAT-LIST-LINES                               23510000
235200         VARYING PV-SUB                                           23520000
235300         FROM PC-ITEMS-PER-PANEL BY -1                            23530000
235400         UNTIL PV-SUB < +1.                                       23540000
235500*                                                                 23550000
235600     COMPUTE ASC-ITEMS-DISPLAYED =                                23560000
235700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23570000
235800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23580000
235900                                      ASTRTITO.                   23590000
236000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23600000
236100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23610000
236200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23620000
236300                                   TO ASELITO.                    23630000
236400                                                                  23640000
236500     MOVE  ASC-PO-NBR   TO PV-DISPLAY-PO.                         23650000
236600                                                                  23660019
236700     PERFORM 4405-GET-BOSS-PARM-RCVR.                             23670023
236800     IF ASC-RCVR-NBR = PV-BOSS-PARM-RECV                          23680023
236900        STRING PV-DISPLAY-PO DELIMITED BY SIZE                    23690023
237000            '-'    DELIMITED BY SPACE                             23700023
237100            PC-DISPLAY-BSS    DELIMITED BY SIZE                   23710023
237200                      INTO            APORCVRO                    23720023
237300     ELSE                                                         23730023
237400        MOVE ASC-RCVR-NBR TO PV-DISPLAY-RCVR                      23740016
237500        STRING PV-DISPLAY-PO DELIMITED BY SIZE                    23750017
237600            '-'    DELIMITED BY SPACE                             23760000
237700            PV-DISPLAY-RCVR DELIMITED BY SIZE                     23770000
237800                      INTO            APORCVRO                    23780017
237900     END-IF.                                                      23790023
238000                                                                  23800000
238100     IF  DP020-MSG-NUMBER-X = SPACE                               23810000
238200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23820000
238300*            --- MORE ITEMS TO DISPLAY ----                       23830000
238400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23840000
238500             SET DP020-MSG-INFORMATIONAL TO TRUE                  23850000
238600         END-IF                                                   23860000
238700     END-IF.                                                      23870000
238800                                                                  23880000
238900******************************************************************23890024
239000*- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                23900024
239100******************************************************************23910024
239200 4405-GET-BOSS-PARM-RCVR.                                         23920023
239300                                                                  23930023
239400     EXEC SQL                                                     23940023
239500          SELECT FUNC_QTY                                         23950023
239600            INTO :PV-BOSS-PARM-RECV                               23960023
239700            FROM TKRPRPM                                          23970023
239800           WHERE LOC_ID            = 90                           23980023
239900             AND INTFC_SYS_CDE     = 'GIV'                        23990023
240000             AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                     24000023
240100             AND FUNC_PRC_STAT_CDE = 'AC'                         24010023
240200          WITH UR                                                 24020024
240300     END-EXEC.                                                    24030023
240400                                                                  24040023
240500     EVALUATE TRUE                                                24050023
240600         WHEN SQLCODE = ZERO                                      24060023
240700              CONTINUE                                            24070023
240800                                                                  24080023
240900         WHEN SQLCODE = +100                                      24090023
241000              MOVE ZERO             TO PV-BOSS-PARM-RECV          24100023
241100                                                                  24110023
241200         WHEN SQLWARN0 NOT = SPACE                                24120023
241300         WHEN SQLCODE NOT = ZERO                                  24130023
241400              MOVE '4405-GET-BOSS-PARM-RCVR'                      24140023
241500                                    TO DP013-PARAGRAPH            24150023
241600              MOVE 'SELECT BOSS PARM'                             24160023
241700                                    TO DP013-MESSAGE-TEXT (1)     24170023
241800              MOVE SQLCA            TO DP013-SQLCA                24180023
241900              MOVE 'TKRPRPM'        TO DP013-DB2-TABLE-NAME (1)   24190023
242000              SET DP013-DB2-ABEND   TO TRUE                       24200023
242100              PERFORM DP013-0000-PROCESS-ABEND                    24210023
242200     END-EVALUATE.                                                24220023
242300                                                                  24230023
242400*----------------------------------------------------------------*24240000
242500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *24250000
242600*----------------------------------------------------------------*24260000
242700 4410-READ-TEMP-STORAGE.                                          24270000
242800                                                                  24280000
242900     EXEC CICS                                                    24290000
243000         READQ TS                                                 24300000
243100             QUEUE (ASC-LIST-QUEUE-NAME)                          24310000
243200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24320000
243300             ITEM  (PV-BLOCK-NUMBER)                              24330000
243400             RESP  (PV-CICS-RESP)                                 24340000
243500     END-EXEC.                                                    24350000
243600                                                                  24360000
243700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       24370000
243800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     24380000
243900         CONTINUE                                                 24390000
244000     ELSE                                                         24400000
244100         SET DP013-CICS-ABEND     TO TRUE                         24410000
244200         SET DP013-NO-ROLLBACK    TO TRUE                         24420000
244300         MOVE '4410-READ-TEMP-STORAGE'                            24430000
244400                                  TO DP013-PARAGRAPH              24440000
244500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24450000
244600                                  TO DP013-MESSAGE-TEXT(1)        24460000
244700         PERFORM DP013-0000-PROCESS-ABEND                         24470000
244800     END-IF.                                                      24480000
244900                                                                  24490000
245000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24500000
245100*                                                                 24510000
245200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24520000
245300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24530000
245400     END-IF.                                                      24540000
245500                                                                  24550000
245600*----------------------------------------------------------------*24560000
245700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24570000
245800*----------------------------------------------------------------*24580000
245900 4420-FORMAT-LIST-LINES.                                          24590000
246000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24600000
246100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24610000
246200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           24620000
246300         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           24630000
246400         MOVE SPACE              TO MR-SELECTI (PV-SUB)           24640000
246500                                    MR-ACTION  (PV-SUB)           24650000
246600                                    MR-DEPT     (PV-SUB)          24660000
246700                                    MR-CLASS    (PV-SUB)          24670000
246800                                    MR-SKU      (PV-SUB)          24680000
246900                                    MR-UPC      (PV-SUB)          24690000
247000                                    MR-EXPT-QTY (PV-SUB)          24700000
247100     ELSE                                                         24710000
247200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24720000
247300                                                   > SPACE        24730000
247400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24740000
247500                                 TO MR-SELECTI (PV-SUB)           24750000
247600         ELSE                                                     24760000
247700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24770000
247800                                 TO MR-SELECTI (PV-SUB)           24780000
247900         END-IF                                                   24790000
248000         IF  DP030-SET-CURSOR-TRAILER                             24800000
248100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24810000
248200                 > SPACE)                                         24820000
248300               OR (PV-SUB = 1))                                   24830000
248400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24840000
248500                MOVE -1          TO MR-SELECTL (PV-SUB)           24850000
248600             END-IF                                               24860000
248700         END-IF                                                   24870000
248800*                                                                 24880000
248900         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               24890000
249000                                             TO MR-ACTION (PV-SUB)24900000
249100         MOVE ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)                 24910000
249200                                             TO MR-DEPT (PV-SUB)  24920000
249300         MOVE ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)                24930000
249400                                             TO MR-CLASS (PV-SUB) 24940000
249500         MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)                  24950000
249600                                             TO MR-SKU-N (PV-SUB) 24960000
249700         MOVE ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)                  24970000
249800                                             TO MR-UPC-N (PV-SUB) 24980000
249900         MOVE ASC-EXPT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)             24990000
250000                                         TO MR-EXPT-QTY-N (PV-SUB)25000000
250100     END-IF.                                                      25010000
250200     SUBTRACT +1 FROM ASC-ITEM-SUB                                25020000
250300     IF  ASC-ITEM-SUB < + 1                                       25030000
250400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  25040000
250500         MOVE +1                 TO ASC-BLK-SUB                   25050000
250600     END-IF.                                                      25060000
250700                                                                  25070000
250800******************************************************************25080000
250900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **25090000
251000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **25100000
251100** ISSUE A WARNING.                                             **25110000
251200******************************************************************25120000
251300 4430-CHECK-FOR-BEGIN-AND-END.                                    25130000
251400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25140000
251500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25150000
251600*            -- NO END-OF-RANGE SPECFIED ---                      25160000
251700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25170000
251800             SET DP020-MSG-WARNING TO TRUE                        25180000
251900             PERFORM 4431-POSITION-AT-WARNING                     25190000
252000         END-IF                                                   25200000
252100     ELSE                                                         25210000
252200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25220000
252300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25230000
252400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25240000
252500             SET DP020-MSG-WARNING TO TRUE                        25250000
252600             PERFORM 4431-POSITION-AT-WARNING                     25260000
252700         END-IF                                                   25270000
252800     END-IF.                                                      25280000
252900******************************************************************25290000
253000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **25300000
253100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **25310000
253200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **25320000
253300** POSITION THE CURSOR THERE.                                   **25330000
253400******************************************************************25340000
253500 4431-POSITION-AT-WARNING.                                        25350000
253600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25360000
253700                    - PV-TOP-ITEM + 1.                            25370000
253800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25380000
253900         CONTINUE                                                 25390000
254000     ELSE                                                         25400000
254100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25410000
254200         MOVE -1                   TO MR-SELECTL (PV-SUB)         25420000
254300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25430000
254400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25440000
254500     END-IF.                                                      25450000
254600*                                                                 25460000
254700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25470000
254800                    - PV-TOP-ITEM + 1.                            25480000
254900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25490000
255000         CONTINUE                                                 25500000
255100     ELSE                                                         25510000
255200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25520000
255300         MOVE -1                   TO MR-SELECTL (PV-SUB)         25530000
255400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25540000
255500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25550000
255600     END-IF.                                                      25560000
255700                                                                  25570000
255800*----------------------------------------------------------------*25580000
255900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25590000
256000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25600000
256100* FOR THE SELECTED ITEMS QUEUE.                                  *25610000
256200*                                                                *25620000
256300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25630000
256400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25640000
256500* THE ARRAY IS FULL.                                             *25650000
256600*----------------------------------------------------------------*25660000
256700 5000-PREPARE-SEL-QUEUE.                                          25670000
256800                                                                  25680000
256900     MOVE +1                   TO  ASC-BLK-SUB.                   25690000
257000     PERFORM 5100-WRITE-TEMP-STORAGE.                             25700000
257100     ADD +1                    TO  ASC-BLK-SUB.                   25710000
257200     PERFORM 5100-WRITE-TEMP-STORAGE.                             25720000
257300                                                                  25730000
257400     MOVE ASC-SEL-QUEUE-NAME   TO  PC211-SEL-QUEUE-NAME.          25740000
257500     PERFORM 6010-DELETE-SEL-QUEUE.                               25750000
257600                                                                  25760000
257700     SET ASC-UPDATE-TSQ        TO  TRUE.                          25770000
257800                                                                  25780000
257900     SET PC212-IDX             TO  1.                             25790000
258000     MOVE ZERO                 TO PC211-NUMBER-OF-TS-ITEMS.       25800000
258100     INITIALIZE PC212-SELECTED-ITEM-ARRAY.                        25810000
258200                                                                  25820000
258300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25830000
258400             VARYING PV-ITEM                                      25840000
258500             FROM 1 BY 1                                          25850000
258600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25860000
258700                                                                  25870000
258800     IF  PC212-IDX > 1                                            25880000
258900         PERFORM 5205-WRITE-SEL-QUEUE                             25890000
259000         ADD +1                TO PC211-NUMBER-OF-TS-ITEMS        25900000
259100     END-IF.                                                      25910000
259200*----------------------------------------------------------------*25920000
259300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25930000
259400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25940000
259500*----------------------------------------------------------------*25950000
259600 5100-WRITE-TEMP-STORAGE.                                         25960000
259700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25970000
259800                                   TO PV-LIST-ITEM-NUMBER.        25980000
259900     COMPUTE PV-BLOCK-NUMBER =                                    25990000
260000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26000000
260100                                                                  26010000
260200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26020000
260300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26030000
260400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26040000
260500             PERFORM 5105-REWRITE-ASC-LISTQ                       26050000
260600         END-IF                                                   26060000
260700     ELSE                                                         26070000
260800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26080000
260900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26090000
261000         PERFORM 5110-WRITE-ASC-LISTQ                             26100000
261100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26110000
261200     END-IF.                                                      26120000
261300                                                                  26130000
261400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26140000
261500                                                                  26150000
261600******************************************************************26160000
261700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **26170000
261800** SPECIFIC COMMAREA.                                           **26180000
261900******************************************************************26190000
262000 5105-REWRITE-ASC-LISTQ.                                          26200000
262100     EXEC CICS                                                    26210000
262200         WRITEQ TS                                                26220000
262300             QUEUE (ASC-LIST-QUEUE-NAME)                          26230000
262400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26240000
262500             ITEM  (PV-BLOCK-NUMBER)                              26250000
262600             REWRITE                                              26260000
262700             RESP  (PV-CICS-RESP)                                 26270000
262800     END-EXEC.                                                    26280000
262900                                                                  26290000
263000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26300000
263100         CONTINUE                                                 26310000
263200     ELSE                                                         26320000
263300         SET DP013-CICS-ABEND            TO TRUE                  26330000
263400         SET DP013-NO-ROLLBACK           TO TRUE                  26340000
263500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26350000
263600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26360000
263700                                         TO DP013-MESSAGE-TEXT(1) 26370000
263800         PERFORM DP013-0000-PROCESS-ABEND                         26380000
263900     END-IF.                                                      26390000
264000                                                                  26400000
264100******************************************************************26410000
264200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **26420000
264300** SPECIFIC COMMAREA.                                           **26430000
264400******************************************************************26440000
264500 5110-WRITE-ASC-LISTQ.                                            26450000
264600     EXEC CICS                                                    26460000
264700         WRITEQ TS                                                26470000
264800             QUEUE (ASC-LIST-QUEUE-NAME)                          26480000
264900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26490000
265000             ITEM  (PV-BLOCK-NUMBER)                              26500000
265100             RESP  (PV-CICS-RESP)                                 26510000
265200     END-EXEC.                                                    26520000
265300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26530000
265400         SET DP013-CICS-ABEND      TO TRUE                        26540000
265500         SET DP013-NO-ROLLBACK     TO TRUE                        26550000
265600         MOVE '5110-WRITE-ASC-LISTQ'                              26560000
265700                                   TO DP013-PARAGRAPH             26570000
265800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26580000
265900                                   TO DP013-MESSAGE-TEXT(1)       26590000
266000         PERFORM DP013-0000-PROCESS-ABEND                         26600000
266100     END-IF.                                                      26610000
266200                                                                  26620000
266300*----------------------------------------------------------------*26630000
266400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26640000
266500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26650000
266600*----------------------------------------------------------------*26660000
266700 5200-FILL-SEL-QUEUE-RECORD.                                      26670000
266800                                                                  26680000
266900     PERFORM 6112-READ-LIST-QUEUE.                                26690000
267000                                                                  26700000
267100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26710000
267200         PERFORM                                                  26720000
267300         VARYING LQW-IDX                                          26730000
267400         FROM 1 BY 1                                              26740000
267500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26750000
267600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26760000
267700                                                                  26770000
267800             IF  LQW-SELECT (LQW-IDX)                             26780000
267900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26790000
268000                             TO PC212-ITEM (PC212-IDX)            26800000
268100                 MOVE SPACE  TO PC212-ACTION-SW (PC212-IDX)       26810000
268200                                                                  26820000
268300                 MOVE LQW-SKU(LQW-IDX) TO PC212-SKU (PC212-IDX)   26830000
268400                                                                  26840000
268500                 SET PC212-IDX UP BY 1                            26850000
268600                 IF  PC212-IDX > PC212-MAX-ITEMS                  26860000
268700                     PERFORM 5205-WRITE-SEL-QUEUE                 26870000
268800                     ADD +1        TO PC211-NUMBER-OF-TS-ITEMS    26880000
268900                     INITIALIZE PC212-SELECTED-ITEM-ARRAY         26890000
269000                     SET PC212-IDX TO  1                          26900000
269100                 END-IF                                           26910000
269200             END-IF                                               26920000
269300         END-PERFORM                                              26930000
269400     END-IF.                                                      26940000
269500                                                                  26950000
269600*----------------------------------------------------------------*26960000
269700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26970000
269800*----------------------------------------------------------------*26980000
269900 5205-WRITE-SEL-QUEUE.                                            26990000
270000                                                                  27000000
270100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27010000
270200                                   TO PC212-SELECTED-ITEMS.       27020000
270300                                                                  27030000
270400     EXEC CICS                                                    27040000
270500          WRITEQ TS                                               27050000
270600              QUEUE (ASC-SEL-QUEUE-NAME)                          27060000
270700              FROM  (PC212-SELECT-RECORD)                         27070000
270800              ITEM  (PV-SEL-QUEUE-ITEM)                           27080000
270900              RESP  (PV-CICS-RESP)                                27090000
271000     END-EXEC.                                                    27100000
271100                                                                  27110000
271200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27120000
271300         CONTINUE                                                 27130000
271400     ELSE                                                         27140000
271500         SET DP013-CICS-ABEND      TO TRUE                        27150000
271600         SET DP013-NO-ROLLBACK     TO TRUE                        27160000
271700         MOVE '5205-WRITE-SEL-QUEUE'                              27170000
271800                                   TO DP013-PARAGRAPH             27180000
271900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27190000
272000                                   TO DP013-MESSAGE-TEXT(1)       27200000
272100         PERFORM DP013-0000-PROCESS-ABEND                         27210000
272200     END-IF.                                                      27220000
272300******************************************************************27230000
272400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **27240000
272500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **27250000
272600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **27260000
272700** THE USER.                                                    **27270000
272800******************************************************************27280000
272900 6000-REFRESH-PANEL-FROM-TEMP.                                    27290000
273000     IF  ASC-UPDATE-TSQ                                           27300000
273100         SET ASC-NO-TSQ-UPDATE TO TRUE                            27310000
273200         MOVE ZERO                 TO PV-SAVE-ITEM                27320000
273300                                      PV-SEL-QUEUE-ITEM           27330000
273400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27340000
273500                                   TO PV-HOLD-SELECTED-ITEMS      27350000
273600         MOVE +1                   TO PV-ITEMS-PROCESSED          27360000
273700         PERFORM 6100-UPDATE-TSQ                                  27370000
273800             UNTIL PV-ITEMS-PROCESSED >                           27380000
273900                                     PV-HOLD-SELECTED-ITEMS       27390000
274000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27400000
274100                    ASC-BLOCK-ENTRIES (2)                         27410000
274200     END-IF.                                                      27420000
274300                                                                  27430000
274400*----------------------------------------------------------------*27440000
274500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27450000
274600*----------------------------------------------------------------*27460000
274700 6010-DELETE-SEL-QUEUE.                                           27470000
274800                                                                  27480000
274900     EXEC CICS                                                    27490000
275000         DELETEQ TS                                               27500000
275100             QUEUE (ASC-SEL-QUEUE-NAME)                           27510000
275200             RESP  (PV-CICS-RESP)                                 27520000
275300     END-EXEC.                                                    27530000
275400*                                                                 27540000
275500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27550000
275600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27560000
275700         CONTINUE                                                 27570000
275800     ELSE                                                         27580000
275900         SET DP013-CICS-ABEND TO TRUE                             27590000
276000         SET DP013-NO-ROLLBACK TO TRUE                            27600000
276100         MOVE '6010-DELETE-SEL-QUEUE'                             27610000
276200                        TO DP013-PARAGRAPH                        27620000
276300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27630000
276400                        TO DP013-MESSAGE-TEXT (1)                 27640000
276500         PERFORM DP013-0000-PROCESS-ABEND                         27650000
276600     END-IF.                                                      27660000
276700                                                                  27670000
276800*----------------------------------------------------------------*27680000
276900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27690000
277000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27700000
277100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27710000
277200*    THE TEMP QUEUE.                                             *27720000
277300*----------------------------------------------------------------*27730000
277400 6100-UPDATE-TSQ.                                                 27740000
277500                                                                  27750000
277600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27760000
277700     PERFORM 6150-READ-SEL-QUEUE.                                 27770000
277800     PERFORM                                                      27780000
277900         VARYING PC212-IDX                                        27790000
278000         FROM 1 BY 1                                              27800000
278100         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     27810000
278200         OR (PC212-IDX GREATER THAN PC212-MAX-ITEMS))             27820000
278300         IF  PC212-ACTION-SW (PC212-IDX) > SPACE                  27830000
278400             PERFORM 6110-PROCESS-ITEMS                           27840000
278500         END-IF                                                   27850000
278600         ADD +1                TO PV-ITEMS-PROCESSED              27860000
278700     END-PERFORM.                                                 27870000
278800     PERFORM 6111-WRITE-LIST-QUEUE.                               27880000
278900                                                                  27890000
279000*----------------------------------------------------------------*27900000
279100*    READ THE LIST QUEUE RECORD.                                 *27910000
279200*----------------------------------------------------------------*27920000
279300 6150-READ-SEL-QUEUE.                                             27930000
279400                                                                  27940000
279500     EXEC CICS                                                    27950000
279600          READQ TS                                                27960000
279700              QUEUE (ASC-SEL-QUEUE-NAME)                          27970000
279800              INTO  (PC212-SELECT-RECORD)                         27980000
279900              ITEM  (PV-SEL-QUEUE-ITEM)                           27990000
280000              RESP  (PV-CICS-RESP)                                28000000
280100     END-EXEC.                                                    28010000
280200*                                                                 28020000
280300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28030000
280400         CONTINUE                                                 28040000
280500     ELSE                                                         28050000
280600         SET DP013-CICS-ABEND      TO  TRUE                       28060000
280700         SET DP013-NO-ROLLBACK     TO  TRUE                       28070000
280800         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           28080000
280900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           28090000
281000                                   TO  DP013-MESSAGE-TEXT(1)      28100000
281100         PERFORM DP013-0000-PROCESS-ABEND                         28110000
281200     END-IF.                                                      28120000
281300                                                                  28130000
281400*----------------------------------------------------------------*28140000
281500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28150000
281600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28160000
281700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28170000
281800*----------------------------------------------------------------*28180000
281900 6110-PROCESS-ITEMS.                                              28190000
282000                                                                  28200000
282100     COMPUTE PV-ITEM = 1 + ((PC212-ITEM (PC212-IDX) - 1)          28210000
282200                     / PC-ITEMS-PER-PANEL).                       28220000
282300                                                                  28230000
282400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28240000
282500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28250000
282600             PERFORM 6111-WRITE-LIST-QUEUE                        28260000
282700         END-IF                                                   28270000
282800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28280000
282900                                                                  28290000
283000         PERFORM 6112-READ-LIST-QUEUE                             28300000
283100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28310000
283200             CONTINUE                                             28320000
283300         END-IF                                                   28330000
283400     END-IF.                                                      28340000
283500                                                                  28350000
283600     COMPUTE PV-SUB = (PC212-ITEM (PC212-IDX)                     28360000
283700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28370000
283800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28380000
283900     MOVE LQW-SELECTED-SW (PV-SUB)                                28390000
284000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28400000
284100                                                                  28410000
284200     EVALUATE TRUE                                                28420000
284300         WHEN PC212-INQ (PC212-IDX)                               28430000
284400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             28440000
284500                                                                  28450000
284600         WHEN PC212-UPD (PC212-IDX)                               28460000
284700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             28470000
284800                                                                  28480000
284900         WHEN PC212-DEL (PC212-IDX)                               28490000
285000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             28500000
285100                                                                  28510000
285200         WHEN PC212-ERR (PC212-IDX)                               28520000
285300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             28530000
285400     END-EVALUATE.                                                28540000
285500                                                                  28550000
285600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28560000
285700                                                                  28570000
285800*----------------------------------------------------------------*28580000
285900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28590000
286000*----------------------------------------------------------------*28600000
286100 6111-WRITE-LIST-QUEUE.                                           28610000
286200                                                                  28620000
286300     EXEC CICS                                                    28630000
286400         WRITEQ TS                                                28640000
286500             QUEUE (ASC-LIST-QUEUE-NAME)                          28650000
286600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28660000
286700             ITEM  (PV-SAVE-ITEM)                                 28670000
286800             REWRITE                                              28680000
286900             RESP  (PV-CICS-RESP)                                 28690000
287000     END-EXEC.                                                    28700000
287100*                                                                 28710000
287200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28720000
287300         CONTINUE                                                 28730000
287400     ELSE                                                         28740000
287500         SET DP013-CICS-ABEND  TO  TRUE                           28750000
287600         SET DP013-NO-ROLLBACK TO  TRUE                           28760000
287700         MOVE '6111-WRITE-LIST-QUEUE'                             28770000
287800                               TO  DP013-PARAGRAPH                28780000
287900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28790000
288000                               TO  DP013-MESSAGE-TEXT(1)          28800000
288100         PERFORM DP013-0000-PROCESS-ABEND                         28810000
288200     END-IF.                                                      28820000
288300                                                                  28830000
288400*----------------------------------------------------------------*28840000
288500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28850000
288600*----------------------------------------------------------------*28860000
288700 6112-READ-LIST-QUEUE.                                            28870000
288800                                                                  28880000
288900     EXEC CICS                                                    28890000
289000         READQ TS                                                 28900000
289100             QUEUE (ASC-LIST-QUEUE-NAME)                          28910000
289200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28920000
289300             ITEM  (PV-ITEM)                                      28930000
289400             RESP  (PV-CICS-RESP)                                 28940000
289500     END-EXEC.                                                    28950000
289600*                                                                 28960000
289700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28970000
289800         CONTINUE                                                 28980000
289900     ELSE                                                         28990000
290000         SET DP013-CICS-ABEND        TO TRUE                      29000000
290100         SET DP013-NO-ROLLBACK       TO TRUE                      29010000
290200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           29020000
290300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29030000
290400                                     TO DP013-MESSAGE-TEXT(1)     29040000
290500         PERFORM DP013-0000-PROCESS-ABEND                         29050000
290600     END-IF.                                                      29060000
290700                                                                  29070000
290800*-----------------------------------------------------------------29080000
290900*  READ THE LIST QUEUE RECORD                                     29090000
291000*-----------------------------------------------------------------29100000
291100 9100-READ-SEL-QUEUE.                                             29110000
291200                                                                  29120000
291300     EXEC CICS                                                    29130000
291400         READQ TS                                                 29140000
291500             QUEUE (ASC-SEL-QUEUE-NAME)                           29150000
291600             INTO  (PC212-SELECT-RECORD)                          29160000
291700             ITEM  (ASC-SEL-ITEM)                                 29170000
291800             RESP  (PV-CICS-RESP)                                 29180000
291900     END-EXEC.                                                    29190000
292000     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        29200000
292100         CONTINUE                                                 29210000
292200     ELSE                                                         29220000
292300         SET DP013-LOGIC-ABEND                                    29230000
292400             DP013-NO-ROLLBACK   TO   TRUE                        29240000
292500         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          29250000
292600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   29260000
292700                                 TO   DP013-MESSAGE-TEXT (1)      29270000
292800         PERFORM DP013-0000-PROCESS-ABEND                         29280000
292900     END-IF.                                                      29290000
293000                                                                  29300000
293100*-----------------------------------------------------------------29310000
293200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *29320000
293300*-----------------------------------------------------------------29330000
293400 9200-REWRITE-SEL-QUEUE.                                          29340000
293500                                                                  29350000
293600     EXEC CICS                                                    29360000
293700          WRITEQ TS                                               29370000
293800              QUEUE  (ASC-SEL-QUEUE-NAME)                         29380000
293900              FROM   (PC212-SELECT-RECORD)                        29390000
294000              ITEM   (ASC-SEL-ITEM)                               29400000
294100              RESP   (PV-CICS-RESP)                               29410000
294200              REWRITE                                             29420000
294300     END-EXEC.                                                    29430000
294400                                                                  29440000
294500     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   29450000
294600         SET DP013-CICS-ABEND                                     29460000
294700             DP013-NO-ROLLBACK     TO TRUE                        29470000
294800         MOVE '9200-REWRITE-SEL-QUEUE'                            29480000
294900                                   TO DP013-PARAGRAPH             29490000
295000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29500000
295100                                   TO DP013-MESSAGE-TEXT (1)      29510000
295200         PERFORM DP013-0000-PROCESS-ABEND                         29520000
295300     END-IF.                                                      29530000
295400                                                                  29540000
295500*----------------------------------------------------------------*29550000
295600*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *29560000
295700*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *29570000
295800*----------------------------------------------------------------*29580000
295900 9900-SOFT-ABORT.                                                 29590000
296000                                                                  29600000
296100     EXEC CICS SYNCPOINT                                          29610000
296200          ROLLBACK                                                29620000
296300     END-EXEC.                                                    29630000
296400                                                                  29640000
296500     SET  PS-ERROR                                                29650000
296600          PS-SOFT-ABORT-ERROR                                     29660000
296700          DP020-MSG-FATAL       TO  TRUE.                         29670000
296800                                                                  29680000
296900*----------------------------------------------------------------*29690000
297000*    ABEND PROCESSOR MODULE                                      *29700000
297100*----------------------------------------------------------------*29710000
297200                                                                  29720000
297300     COPY DPPD013.                                                29730000
