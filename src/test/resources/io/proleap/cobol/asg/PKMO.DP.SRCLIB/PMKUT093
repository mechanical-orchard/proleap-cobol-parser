      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.             PMKUT093.                                        
       AUTHOR.                 AMANDA NEWHART                                   
       INSTALLATION.           KOHLS DEPARTMENT STORES.                         
       DATE-WRITTEN.           APRIL 2003.                                      
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                *        
      *    PMKUT093 -                                                  *        
      *      LOG ON TO ORACLE, FIND THE SYS DATE AND TRUNCATE THE      *        
      *      PMTT_STR_SELN_STR_ASSOC TABLE.  RETRIEVE DISTINCT PROMO   *        
      *      IDS FROM THE PMTT_PROMO_ITM_SLS_RSLT_LOD TABLE.  FOR EACH *        
      *      PROMO ID THAT IS NOT IN THE PMTT_STR_SELN_STR_ASSOC       *        
      *      RETRIEVE THE STORES FOR ALL PRINT VERSIONS FOR THAT PROMO *        
      *      AND INSERT INTO THE PMTT_STR_SELN_STR_ASSOC TABLE.  IF A  *        
      *      PRINT VERSION IS NOT FOUND AND THE PROMO HAS A PROMO ITM  *        
      *      THEN RETRIEVE ALL STORES FOR UNADVERTISED. INSERT WHAT    *        
      *      IS RETRIEVED TO THE PMTT_STR_SELN_STR_ASSOC.  WHEN ALL    *        
      *      THE DISTINCT PROMO IDS ARE FOUND FROM THE PROMO_ITM TABLE *        
      *      RETRIEVE THE DISTINCT PROMO IDS FROM THE PMTT_SLS_RSLT_LOD*        
      *      TABLE.  FOR EACH PROMO ID THAT IS NOT IN THE              *        
      *      PMTT_STR_SELN_STR_ASSOC RETRIEVE STORES FOR ALL PRINT     *        
      *      VERSIONS FOR THAT PROMOTON AND INSERT INTO THE            *        
      *      PMTT_STR_SELN_STR_ASSOC.  IF A PRINT VERSION ISN'T FOUND  *        
      *      AND THE PROMO DOES NOT HAVE A PROMO ITEM THEN RETRIEVE    *        
      *      ALL STORES FOR CLEARANCED. INSERT WHAT IS RETRIEVED       *        
      *      TO THE PMT_STR_SELN_STR_ASSOC TABLE.  WHEN ALL DISTINCT   *        
      *      PROMO IDS ARE FOUND RUN A COMMIT TO KEEP WHAT WAS JUST    *        
      *      INSERTED AND DISPLAY TOTAL LINES TO THE OUTPUT FILE.      *        
      ******NOTE - IF A DELETE IS DONE CALL KURT SO HE CAN DO A        *        
      ******       REORG ON THE TABLE(S).                              *        
      ******************************************************************        
      **   CHANGE LOG:                                                 *        
      ******************************************************************        
      *    07/17/2003 - AMANDA NEWHART - WR21770                       *        
      *     - DO NOT ABEND WHEN THE SALES DATE FILE IS EMPTY.  JUST    *        
      *       DISPLAY A MESSAGE INSTEAD.                               *        
      *                                                                *        
      *    10/13/2003 - COLLEEN CUMMINGS - P000596550                  *        
      *     - ADDED MDSE_SELN_ID TO PMTT_STR_SELN_STR_ASSOC TABLE TO   *        
      *       ACCOMODATE UNADVERTISED PROMOTION PROMO ITEMS TO AN      *        
      *       ADHOC.  WE WERE OVER-STATING SALES BECAUSE THE SAME      *        
      *       STR_NBR WAS IN MORE THAN ONE ADHOC, PLUS CORPORATE FOR   *        
      *       UNADVERTISED PROMOTION PROMO ITEMS.  ADDING THIS NEW     *        
      *       FIELD WILL ALLOW SALES RESULTS ROLLUP TO JOIN ON THIS    *        
      *       ALSO BEFORE ROLLING UP - MAKING IT MORE UNIQUE.          *        
      *                                                                *        
      *    11/11/2003 - COLLEEN CUMMINGS - P000596550                  *        
      *     - CHANGED K_EMT TABLES TO XKT - EAI COMPLIANT, PERFORMANCE *        
      *       ENHANCEMENT BECAUSE XKT TABLES ARE LOCAL.                *        
      *       THIS IS ALSO THE DAY THE PRIOR CHANGE WAS MOVED BACK IN. *        
      *       (IT WAS BACKED OUT ON 10/23 - RUNNING TOO LONG TRYING    *        
      *        TO ROLL UP BOGO SALES RESULTS.)                         *        
      *                                                                *        
      *    09/27/2004 - COLLEEN CUMMINGS - P000696329                  *        
      * 5   - FIX TO ADD STAT_CDE = 'S' FOR PRINT VERSION CURSORS.     *        
      *       WAS DOUBLE COUNTING SALES DUE TO THE PRINT VERSIONS IN   *        
      *       THE 9/26 MAIN PROMOTION BEING DELETED AND RECREATED AS   *        
      *       ADHOCS.                                                  *        
      *                                                                *        
      *    10/21/2004 - COLLEEN CUMMINGS - P000703971                  *        
      *     - ADDED 'ORDERED' HINT IN C340- CURSOR (UNADCSR).          *        
      *       GETTING "ORA-01652: UNABLE TO EXTEND TEMP SEGMENT BY 128 *        
      *       IN TABLESPACE TEMP."                                     *        
      *                                                                *        
      *    02/11/2008 - DARYL STEWART - INC000000256300                *        
      *     - MODIFIED CODE TO NOT USE SYSDATE AND TO INSTEAD USE      *        
      *       CC-SALES-DATE TO DETERMINE THE EFFECTIVE BEGINNING AND   *        
      *       ENDING DATE RANGE.                                       *        
      *                                                                *        
      *    08/20/2013 - COGNIZANT  - INC0253050                        *        
      *     - EXPIRED PROMO_ID ARE PROCESSEING DUE TO ECOMM STORES     *        
      *       809, 819, 829, 873. DUE TO THIS THE JOB RUNNING LONG     *        
      *       THAN USUAL. CHANGES MADE TO CHECK VALID PROMO_ID FROM    *        
      *       TABLE PMTT_PROMO_ITM_SLS_RSLT_LOD                        *        
      *                                                                *        
      *    10/02/2013 - COGNIZANT  - CHG0064489                        *        
      *     - INCLUDED TRUNC FUNCTION IN THE CURSOR TO FIX THE EB/NO   *        
      *       ISSUE. SALES FOR SOME PROMOS WHICH STARTS AT MID-DAY IS  *        
      *       NOT BEING REPORTED ON THE FIRST DAY.                     *        
      *                                                                *        
      *    07/30/2018 - COGNIZANT  - CHG0204126                        *        
      *     - ORACLE LOGON STANDARDS PROGRAM CHANGE                    *        
      ******************************************************************        
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT SALES-DATE-FILE                                               
               ASSIGN                       TO INP01.                           
                                                                                
070941     SELECT ORACLE-LOGON-FILE                                             
070941         ASSIGN                       TO ORALOGON.                        
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  SALES-DATE-FILE                                                      
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED.                                           
       01  SALES-DATE-LINE                  PIC X(80).                          
                                                                                
070941 FD  ORACLE-LOGON-FILE                                                    
070941     RECORDING MODE IS F                                                  
070941     LABEL RECORDS ARE STANDARD                                           
070941     BLOCK CONTAINS 0 RECORDS                                             
070941     RECORD CONTAINS 80 CHARACTERS                                        
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
070941 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                          
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  ABEND-CODE                       PIC S9(04)   COMP VALUE +0.         
           88  ABEND-4001-WRITE-ERROR                    VALUE +4001.           
           88  ABEND-4002-READ-ERROR                     VALUE +4002.           
           88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.           
           88  ABEND-4004-TABLE-ERROR                    VALUE +4004.           
           88  ABEND-4005-OPEN-ERROR                     VALUE +4005.           
           88  ABEND-4006-CLOSE-ERROR                    VALUE +4006.           
           88  ABEND-4007-SEQUENCE-ERROR                 VALUE +4007.           
           88  ABEND-4008-DATA-ERROR                     VALUE +4008.           
           88  ABEND-4009-KEY-DATA-ERROR                 VALUE +4009.           
           88  ABEND-4013-DB2-ERROR                      VALUE +4013.           
           88  ABEND-4014-ORACLE-LOGON-ERROR             VALUE +4014.           
           88  ABEND-4019-DATE-ROUTINE-ERROR             VALUE +4019.           
           88  ABEND-4444-FORCED-ABEND                   VALUE +4444.           
                                                                                
       01  CC-SALES-DATE-FILE.                                                  
           05  CC-SALES-DATE                 PIC X(10).                         
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
070941     05  PS-END-OF-LOGON-FILE-SW       PIC  X(01) VALUE 'N'.              
070941         88  PS-END-OF-LOGON-FILE                 VALUE 'Y'.              
070941     05  PS-ORA-SRC-CTL-DONE-SW        PIC  X(01) VALUE 'N'.              
070941         88  PS-ORA-SRC-EMPTY                     VALUE 'Y'.              
           05  PS-SALES-DATE-EXIST-SWITCH    PIC  X(01) VALUE 'N'.              
               88  PS-SALES-DATE-EXIST                  VALUE 'Y'.              
               88  PS-SALES-DATE-NOT-EXIST              VALUE 'N'.              
           05  PS-SALES-DATE-FILE-SWITCH     PIC  X(01) VALUE 'N'.              
               88  PS-SALES-DATE-FILE-END               VALUE 'Y'.              
               88  PS-SALES-DATE-FILE-START             VALUE 'N'.              
           05  PS-END-OF-PROMO-CSR-SWITCH    PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-PROMO-CSR                  VALUE 'Y'.              
               88  PS-NOT-END-OF-PROMO-CSR              VALUE 'N'.              
           05  PS-END-OF-PRT-VER-CSR-SWITCH  PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-PRT-VER-CSR                VALUE 'Y'.              
               88  PS-NOT-END-OF-PRT-VER-CSR            VALUE 'N'.              
           05  PS-END-NONUPRTVER-CSR-SWITCH  PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-NONUPRTVER-CSR             VALUE 'Y'.              
               88  PS-NOT-END-OF-NONUPRTVER-CSR         VALUE 'N'.              
           05  PS-END-REUSEPRTVER-CSR-SWITCH PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-REUSEPRTVER-CSR            VALUE 'Y'.              
               88  PS-NOT-END-OF-REUSEPRTVER-CSR        VALUE 'N'.              
           05  PS-END-OF-CLRNC-CSR-SWITCH    PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-CLRNC-CSR                  VALUE 'Y'.              
               88  PS-NOT-END-OF-CLRNC-CSR              VALUE 'N'.              
           05  PS-END-NONUCLRNC-CSR-SWITCH   PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-NONUCLRNC-CSR              VALUE 'Y'.              
               88  PS-NOT-END-OF-NONUCLRNC-CSR          VALUE 'N'.              
           05  PS-END-REUSECLRNC-CSR-SWITCH  PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-REUSECLRNC-CSR             VALUE 'Y'.              
               88  PS-NOT-END-OF-REUSECLRNC-CSR         VALUE 'N'.              
           05  PS-END-OF-UNAD-CSR-SWITCH     PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-UNAD-CSR                   VALUE 'Y'.              
               88  PS-NOT-END-OF-UNAD-CSR               VALUE 'N'.              
           05  PS-END-NONUUNAD-CSR-SWITCH    PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-NONUUNAD-CSR               VALUE 'Y'.              
               88  PS-NOT-END-OF-NONUUNAD-CSR           VALUE 'N'.              
           05  PS-END-REUSEUNAD-CSR-SWITCH   PIC  X(01) VALUE 'N'.              
               88  PS-END-OF-REUSEUNAD-CSR              VALUE 'Y'.              
               88  PS-NOT-END-OF-REUSEUNAD-CSR          VALUE 'N'.              
           05  PS-PROMO-EXISTS-CSR           PIC  X(01) VALUE 'N'.              
               88  PS-PROMO-EXISTS                      VALUE 'Y'.              
               88  PS-PROMO-NOT-EXISTS                  VALUE 'N'.              
           05  PS-PRT-VER-FOUND-SWITCH       PIC X(01)  VALUE 'Y'.              
               88  PS-PRT-VER-FOUND                     VALUE 'Y'.              
               88  PS-PRT-VER-NOT-FOUND                 VALUE 'N'.              
           05  PS-TYPE                       PIC X(01).                         
               88  PS-PROMO-ITM                         VALUE 'I'.              
               88  PS-NO-PROMO-ITM                      VALUE 'P'.              
                                                                                
070941 01  CC-ORACLE-CONNECTION.                                                
070941     05  CC-ORACLE-USERID             PIC X(40).                          
070941         88 CC-AUTO-LOGON                         VALUE '/'.              
070941     05  CC-ORACLE-PASSWORD           PIC X(40).                          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
070941*    05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)  VALUE                   
070941     05  PC-AUTO-LOGON                PIC  X(1)   VALUE '/'.              
070941     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE                   
                                                           'PMKUT093'.          
           05  PC-SIMPLE                    PIC  X(01)  VALUE 'S'.              
           05  PC-CLRNC                     PIC  X(01)  VALUE 'C'.              
           05  PC-TIERED                    PIC  X(01)  VALUE 'T'.              
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4)   VALUE ZEROS             
070941                                                  COMP SYNC.              
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4)   VALUE ZEROS             
070941                                                  COMP SYNC.              
070941     05  PC-AUTO-LOGON                PIC  X(01)  VALUE '/'.              
           05  PV-SQL                       PIC S9(04)  VALUE ZEROS.            
           05  PV-TABLE-NAME                PIC  X(12)  VALUE SPACES.           
           05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.           
           05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.           
           05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.           
           05  PV-SYS-DATE                  PIC  X(26)  VALUE SPACES.           
                                                                                
       01  PV-PROMO-VARIABLES.                                                  
           05  PV-EXIST-PROMO-ID            PIC  9(10)  VALUE ZEROS.            
           05  PV-PROMO-ID                  PIC  9(10)  VALUE ZEROS.            
           05  PV-PROMO-ITM-ID              PIC  9(10)  VALUE ZEROS.            
           05  PV-MDSE-SELN-ID              PIC  9(10)  VALUE ZEROS.            
                                                                                
       01  PV-STR-NBR-VARIABLES.                                                
           05  PV-STR-NBR                   PIC  9(04)  VALUE ZEROS.            
           05  PV-STR-SELN-ID               PIC  9(10)  VALUE ZEROS.            
                                                                                
       01  CT-CPU-TIME.                                                         
           05  CT-CPU-HR                        PIC  9(02) VALUE ZERO.          
           05  CT-CPU-MIN                       PIC  9(02) VALUE ZERO.          
           05  CT-CPU-SEC                       PIC  9(02) VALUE ZERO.          
           05  CT-CPU-HSEC                      PIC  9(02) VALUE ZERO.          
                                                                                
       01  PV-CPU-TIME.                                                         
           05  PV-CPU-HR                        PIC  9(02) VALUE ZERO.          
           05  FILLER                           PIC  X(01) VALUE ":".           
           05  PV-CPU-MIN                       PIC  9(02) VALUE ZERO.          
           05  FILLER                           PIC  X(01) VALUE ":".           
           05  PV-CPU-SEC                       PIC  9(02) VALUE ZERO.          
           05  FILLER                           PIC  X(01) VALUE ":".           
           05  PV-CPU-HSEC                      PIC  9(02) VALUE ZERO.          
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-PROMO-CNT                 PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-PRT-VER-CNT               PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-NONREUSE-PRT-VER-CNT      PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-REUSE-PRT-VER-CNT         PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-TOTAL-PRT-VER-CNT         PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-CLRNC-CNT                 PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-NONREUSE-CLRNC-CNT        PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-REUSE-CLRNC-CNT           PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-TOTAL-CLRNC-CNT           PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-UNAD-CNT                  PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-NONREUSE-UNAD-CNT         PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-REUSE-UNAD-CNT            PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-TOTAL-UNAD-CNT            PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
           05  PA-INSERT                    PIC S9(11)  COMP-3                  
                                                        VALUE ZEROES.           
                                                                                
      *****************************************************************         
      *                      O  R  A  C  L  E                                   
      *================================================================         
      * ORACLE DECLARE SECTION                                                  
      * ORACLE USED AND RETURNED VARIABLES                                      
      *****************************************************************         
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                             
                                                                                
      *---------------------------------------------------------------*         
      * ORACLE LOGON WORKING STORAGE COPYBOOK                                   
      *---------------------------------------------------------------*         
       01      PC-ENT01-TYPE-CDE          PIC X(02)      VALUE '01'.            
       01      PV-ORACLE-ID               PIC X(1)       VALUE '/'.             
                                                                                
       01      USERNAME                   PIC X(10)      VARYING.               
       01      PASSWD                     PIC X(10)      VARYING.               
                                                                                
       01      ORACLE-RETURN              PIC X(200)     VALUE SPACES.          
                                                                                
           EXEC SQL END DECLARE SECTION END-EXEC.                               
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                               
                                                                                
      ********************                                                      
       EJECT                                                                    
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
      *****************************************************************         
      * A100-MAINLINE.                                                *         
      * ==> PROCESSES:                                                *         
      *  - SET UP ORACLE                                              *         
      *  - FIND THE CURRENT SYS DATE                                  *         
      *  - RETRIVE DISTINCT PROMO ID FROM PMTT_PROMO_ITM_SLS_RSLT_LOD *         
      *  - RETRIVE DISTINCT PROMO ID FROM PMTT_SLS_RSLT_LOD           *         
      *  - PRINT TOTAL LINES IN LOG OUTPUT                            *         
      * ==> PERFORMED FROM: START                                     *         
      *****************************************************************         
       A100-MAINLINE.                                                           
                                                                                
070941*    PERFORM PM700-A000-ORACLE-SETUP.                                     
                                                                                
           PERFORM B100-OPEN-FILES.                                             
           PERFORM B200-READ-SALES-DATE-FILE.                                   
                                                                                
           IF PS-SALES-DATE-EXIST                                               
256300*        PERFORM C100-FIND-SYSDATE                                        
256300         STRING CC-SALES-DATE DELIMITED BY SIZE                           
256300             '.23.59.00' DELIMITED BY SIZE INTO PV-SYS-DATE               
256300         DISPLAY 'SYS DATE = ' PV-SYS-DATE                                
               PERFORM C105-TRUNCATE                                            
                                                                                
      *** RETRIEVE DISTINCT PROMO IDS FROM PROMO-ITM-SLS-RSLT-TBL.              
               SET PS-PROMO-ITM TO TRUE                                         
               PERFORM C200-DECLARE-PROMO-ITM-CSR                               
               PERFORM C300-OPEN-PROMO-ITM-CSR                                  
               PERFORM C400-FETCH-PROMO-ITM-CSR                                 
               PERFORM C500-PROCESS-PROMO-CSR                                   
                   UNTIL PS-END-OF-PROMO-CSR                                    
               PERFORM C600-CLOSE-PROMO-ITM-CSR                                 
                                                                                
      *** RETRIEVE DISTINCT PROMO IDS FROM SLS-RSLT-TBL                         
               SET PS-NO-PROMO-ITM TO TRUE                                      
               SET PS-NOT-END-OF-PROMO-CSR TO TRUE                              
               PERFORM C210-DECLARE-PROMO-CSR                                   
               PERFORM C310-OPEN-PROMO-CSR                                      
               PERFORM C410-FETCH-PROMO-CSR                                     
               PERFORM C500-PROCESS-PROMO-CSR                                   
                   UNTIL PS-END-OF-PROMO-CSR                                    
               PERFORM C610-CLOSE-PROMO-CSR                                     
                                                                                
               PERFORM C130-COMMIT                                              
                                                                                
               DISPLAY 'FINAL PROMO COUNT   = ' PA-PROMO-CNT                    
               DISPLAY 'FINAL PRT VER COUNT = ' PA-TOTAL-PRT-VER-CNT            
               DISPLAY 'FINAL CLRNC COUNT   = ' PA-TOTAL-CLRNC-CNT              
               DISPLAY 'FINAL UNAD COUNT    = ' PA-TOTAL-UNAD-CNT               
               DISPLAY 'FINAL INSERT COUNT  = ' PA-INSERT                       
           END-IF.                                                              
                                                                                
           PERFORM B900-CLOSE-FILES.                                            
                                                                                
           STOP RUN.                                                            
                                                                                
      *****************************************************************         
      * B100-OPEN-FILES.                                              *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE INPUT FILE                                        *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       B100-OPEN-FILES.                                                         
                                                                                
070941     DISPLAY 'ORACLE FILE OPEN'.                                          
070941     OPEN INPUT ORACLE-LOGON-FILE.                                        
070941                                                                          
070941     DISPLAY 'ORACLE FILE READ'.                                          
070941     PERFORM 7000-READ-ORACLE-LOGON.                                      
070941                                                                          
070941     DISPLAY 'ORACLE FILE CLOSE'.                                         
070941     CLOSE ORACLE-LOGON-FILE.                                             
070941                                                                          
070941     IF ((PS-END-OF-LOGON-FILE)                                           
070941             OR (CC-ORACLE-CONNECTION = SPACES))                          
070941         DISPLAY '** ABEND **'                                            
070941         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '          
070941                   'NOT PROVIDED'                                         
070941         SET PS-ORA-SRC-EMPTY TO TRUE                                     
070941         CALL 'ILBOABN0' USING ABEND-CODE                                 
070941     END-IF.                                                              
070941                                                                          
070941     IF CC-AUTO-LOGON                                                     
070941         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'                
070941         EXEC SQL                                                         
070941              CONNECT :USERNAME                                           
070941         END-EXEC                                                         
070941     ELSE                                                                 
070941         INITIALIZE PV-ORACLE-USERID-LEN                                  
070941                    PV-ORACLE-PASSWORD-LEN                                
070941         INSPECT CC-ORACLE-USERID                                         
070941             TALLYING PV-ORACLE-USERID-LEN                                
070941          FOR CHARACTERS BEFORE INITIAL SPACE                             
070941      INSPECT CC-ORACLE-PASSWORD                                          
070941          TALLYING PV-ORACLE-PASSWORD-LEN                                 
070941          FOR CHARACTERS BEFORE INITIAL SPACE                             
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                   
070941                USERNAME-ARR                                              
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                           
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO               
070941                PASSWD-ARR                                                
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                           
070941      DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '               
070941                USERNAME-ARR                                              
070941      EXEC SQL                                                            
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                           
070941      END-EXEC                                                            
070941      INITIALIZE CC-ORACLE-PASSWORD                                       
070941                 PASSWD                                                   
070941      END-IF.                                                             
070941                                                                          
070941     IF (SQLCODE NOT = 0)                                                 
070941         DISPLAY PV-PARAGRAPH-NAME                                        
070941         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'          
070941         PERFORM 9900-ORACLE-ABEND                                        
070941     END-IF.                                                              
                                                                                
           OPEN INPUT  SALES-DATE-FILE.                                         
                                                                                
      *****************************************************************         
      * B200-READ-SALES-DATE-FILE.                                    *         
      * ==> PROCESSES:                                                *         
      *  - READ IN THE SALES DATE FILE                                *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       B200-READ-SALES-DATE-FILE.                                               
                                                                                
           READ SALES-DATE-FILE INTO CC-SALES-DATE-FILE                         
              AT END                                                            
                 SET PS-SALES-DATE-FILE-END TO TRUE                             
           END-READ.                                                            
                                                                                
           IF PS-SALES-DATE-FILE-END OR CC-SALES-DATE-FILE = SPACES             
               DISPLAY 'SALES DATE HAS NOTHING TO PROCESS'                      
               DISPLAY '**** END OF PROGRAM ****'                               
               SET PS-SALES-DATE-NOT-EXIST TO TRUE                              
           ELSE                                                                 
               DISPLAY 'CC-SALES-DATE = ' CC-SALES-DATE                         
               SET PS-SALES-DATE-EXIST TO TRUE                                  
           END-IF.                                                              
                                                                                
      *****************************************************************         
      * B900-CLOSE-FILES                                              *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE SALES DATE FILE                                  *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       B900-CLOSE-FILES.                                                        
                                                                                
           CLOSE  SALES-DATE-FILE.                                              
                                                                                
      *****************************************************************         
      * C100-FIND-SYSDATE:                                            *         
      * ==> PROCESSES:                                                *         
      *   - SINCE NO TABLE IS ACTUAL USED WE USE THE DUAL TABLE.      *         
      *   - FIND THE CURRENT DATE AND TIME.                           *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = A ROW WAS FOUND.                                       *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C100-FIND-SYSDATE.                                                       
           EXEC SQL                                                             
               SELECT                                                           
                   SYSDATE                                                      
               INTO :PV-SYS-DATE                                                
               FROM                                                             
                   DUAL                                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 DISPLAY 'SYS DATE = ' PV-SYS-DATE                              
                                                                                
             WHEN OTHER                                                         
               MOVE SQLCODE               TO PV-SQL                             
               MOVE 'DUAL'                TO PV-TABLE-NAME                      
               MOVE 'C100-FIND-SYSDATE'   TO PV-PARAGRAPH-NAME                  
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C105-TRUNCATE:                                                *         
      * ==> PROCESSES:                                                *         
      *  - CLEAR OUT WHAT IS IN THE TABLE.  WANT A CLEAR SLATE.       *         
      *  - K_PM01 OR K_PM02 IS WHAT IS USED BASED ON THE ENVIRONMENT  *         
      * ==> PERFORMED FROM: A100-MAINFRAME                            *         
      *****************************************************************         
       C105-TRUNCATE.                                                           
                                                                                
           EXEC SQL EXECUTE                                                     
             BEGIN                                                              
               PMSP_TRUNC_TABLE('K_PM01.PMTT_STR_SELN_STR_ASSOC');              
             END;                                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 CONTINUE                                                       
             WHEN OTHER                                                         
               MOVE SQLCODE                    TO PV-SQL                        
               MOVE 'PMTT_STR_SELN_STR_ASSOC'  TO PV-TABLE-NAME                 
               MOVE 'C105-TRUNCATE'            TO PV-PARAGRAPH-NAME             
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C110-INSERT:                                                  *         
      * ==> PROCESSES:                                                *         
      *  - INSERT A ROW INTO PMTT_STR_SELN_STR_ASSOC TABLE            *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = INSERT WAS SUCCESSFULL                                           
      * ==> PERFORMED FROM: C520-PROCESS-PRT-VER-CSR,                 *         
      *    C530-PROCESS-CLRNC-CSR, C540-PROCESS-UNAD-CSR              *         
      *****************************************************************         
       C110-INSERT.                                                             
                                                                                
           EXEC SQL                                                             
               INSERT INTO PMTT_STR_SELN_STR_ASSOC                              
                   (PROMO_ID                                                    
                   ,PROMO_ITM_ID                                                
                   ,STR_SELN_ID                                                 
                   ,STR_NBR                                                     
                   ,MDSE_SELN_ID)                                               
               VALUES                                                           
                   (:PV-PROMO-ID                                                
                   ,:PV-PROMO-ITM-ID                                            
                   ,:PV-STR-SELN-ID                                             
                   ,:PV-STR-NBR                                                 
                   ,:PV-MDSE-SELN-ID)                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 ADD 1 TO PA-INSERT                                             
                                                                                
             WHEN OTHER                                                         
               DISPLAY ' COUNT PA-INSERT = ' PA-INSERT                          
               DISPLAY ' COUNT PA-PRT-VER-CNT = ' PA-PRT-VER-CNT                
               DISPLAY ' PV-PROMO-ID     = ' PV-PROMO-ID                        
               DISPLAY ' PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                    
               DISPLAY ' PV-STR-SELN-ID  = ' PV-STR-SELN-ID                     
               DISPLAY ' PV-STR-NBR        = ' PV-STR-NBR                       
               DISPLAY ' PV-MDSE-SELN-ID = ' PV-MDSE-SELN-ID                    
               MOVE SQLCODE               TO PV-SQL                             
               MOVE 'DUAL'                TO PV-TABLE-NAME                      
               MOVE 'C110-INSERT'         TO PV-PARAGRAPH-NAME                  
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
           INITIALIZE PV-STR-NBR-VARIABLES.                                     
           MOVE ZEROES TO PV-PROMO-ITM-ID                                       
                          PV-MDSE-SELN-ID.                                      
                                                                                
      *****************************************************************         
      * C120-PROMO-EXISTS                                             *         
      * ==> PROCESSES:                                                *         
      *  - CHECK TO SEE IF TE PROMO EXISTS ON THE STR_SELN_STR_ASSOC  *         
      *    TABLE.                                                     *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND.                                    *         
      *  - 2112 OR -2112 = MULTIPLE ROWS WERE FOUND                   *         
      *  - 1403 = NO ROW WAS FOUND.                                   *         
      * ==> PERFORMED FROM: C410-FETCH-PROMO-CSR                      *         
      *****************************************************************         
       C120-PROMO-EXISTS.                                                       
                                                                                
           EXEC SQL                                                             
               SELECT                                                           
                   PROMO_ID                                                     
               INTO                                                             
                   :PV-EXIST-PROMO-ID                                           
               FROM                                                             
                   PMTT_STR_SELN_STR_ASSOC                                      
               WHERE                                                            
                   PROMO_ID = :PV-PROMO-ID                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
             WHEN SQLCODE = -2112                                               
               SET PS-PROMO-EXISTS TO TRUE                                      
                                                                                
             WHEN SQLCODE = 1403                                                
               SET PS-PROMO-NOT-EXISTS TO TRUE                                  
                                                                                
             WHEN OTHER                                                         
               MOVE SQLCODE                   TO PV-SQL                         
               MOVE 'PMTT_STR_SELN_STR_ASSOC' TO PV-TABLE-NAME                  
               MOVE 'C120-PROMO-EXISTS'       TO PV-PARAGRAPH-NAME              
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C130-COMMIT                                                   *         
      * ==> PROCESSES:                                                *         
      *  - SAVE WHAT HAS BEEN DONE TO THE DATABASE SO FAR             *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = COMMIT WAS SUCCEFULL                                   *         
      * ==> PERFORMED FROM:  A100-MAINLINE                            *         
      *****************************************************************         
       C130-COMMIT.                                                             
                                                                                
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               CONTINUE                                                         
                                                                                
             WHEN OTHER                                                         
               MOVE SQLCODE                     TO PV-SQL                       
               MOVE 'PGM ABEND DURING A COMMIT' TO PV-OPERATION-MSG             
               MOVE 'C130-COMMIT'               TO PV-PARAGRAPH-NAME            
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C200-DECLARE-PROMO-ITM-CSR                                    *         
      * ==> PROCESSES:                                                *         
      *  - DELCARE THE CURSOR THAT FINDS THE PROMO ON THE             *         
      *    PROMO_ITM_SLS_RSLT_LOD TABLE                               *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCEFULL                                  *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C200-DECLARE-PROMO-ITM-CSR.                                              
                                                                                
           EXEC SQL                                                             
               DECLARE PROMOITMCSR                                              
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        A.PROMO_ID                                              
                   FROM                                                         
                        PMTT_PROMO_ITM_SLS_RSLT_LOD A                           
                       ,PMT_PROMO B                                             
                   WHERE                                                        
                      A.TRN_SLS_DTE =                                           
                                TO_DATE(:CC-SALES-DATE, 'YYYY-MM-DD')           
                  AND A.PROMO_ID = B.PROMO_ID                                   
                  AND TRUNC(B.DFLT_STRT_TMST) <= TRUNC(A.TRN_SLS_DTE)           
                  AND TRUNC(B.DFLT_END_TMST)  >= TRUNC(A.TRN_SLS_DTE)           
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C210-DECLARE-PROMO-CSR                                        *         
      * ==> PROCESSES:                                                *         
      *  - DELCARE THE CURSOR THAT FINDS THE PROMO ON THE             *         
      *    SLS_RSLT_LOD TABLE                                         *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCEFULL                                  *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C210-DECLARE-PROMO-CSR.                                                  
                                                                                
           EXEC SQL                                                             
               DECLARE PROMOCSR                                                 
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        PROMO_ID                                                
                   FROM                                                         
                        PMTT_SLS_RSLT_LOD                                       
                   WHERE                                                        
                        TRN_SLS_DTE =                                           
                                TO_DATE(:CC-SALES-DATE, 'YYYY-MM-DD')           
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C220-DECLARE-PRT-VER-CSR                                      *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PRINT VERSIONS FOR A PROMOTION.    *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C220-DECLARE-PRT-VER-CSR.                                                
                                                                                
           EXEC SQL                                                             
               DECLARE PRTVERCSR                                                
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        A.STR_NBR                                               
                       ,D.STR_SELN_ID                                           
                   FROM                                                         
                        XKT_STR_GP_MBSHP A                                      
                       ,XKT_STR_GP_DTE B                                        
                       ,PMT_STR_SELN C                                          
                       ,PMT_PROMO_PRT_VER D                                     
                       ,PMT_PROMO_PRIC_VER E                                    
                   WHERE                                                        
                        A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE                     
                    AND A.STR_GP_ID = B.STR_GP_ID                               
                    AND B.EFF_STR_GP_ID = C.EFF_STR_GP_ID                       
                    AND C.STR_SELN_ID = D.STR_SELN_ID                           
                    AND D.PROMO_PRIC_VER_ID = E.PROMO_PRIC_VER_ID               
                    AND TO_CHAR(A.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                              <= :PV-SYS-DATE                   
                    AND (TO_CHAR(A.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                              >= :PV-SYS-DATE                   
                     OR  A.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(B.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                              <= :PV-SYS-DATE                   
                    AND (TO_CHAR(B.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  B.EFF_END_DTE IS NULL)                                 
                    AND D.STAT_CDE = 'S'                                        
                    AND E.STAT_CDE = 'S'                                        
                    AND C.STR_SELN_TYP_CDE = 'P'                                
                    AND E.PRMY_PROMO_ID = :PV-PROMO-ID                          
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C222-DECLARE-NONREUSE-PRTVER                                  *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PRINT VERSIONS FOR A PROMOTION.    *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C222-DECLARE-NONREUSE-PRTVER.                                            
                                                                                
           EXEC SQL                                                             
               DECLARE NONREUPRTVERCSR                                          
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        E.STR_NBR                                               
                       ,B.STR_SELN_ID                                           
                   FROM                                                         
                        PMT_STR_SELN A                                          
                       ,PMT_PROMO_PRT_VER B                                     
                       ,PMT_PROMO_PRIC_VER C                                    
                       ,PMT_ADHC_STR_GP D                                       
                       ,PMT_PROMO_INTFC_ADHC_STR E                              
                   WHERE                                                        
                        E.ADHC_STR_GP_ID = D.ADHC_STR_GP_ID                     
                    AND D.ADHC_STR_GP_ID = A.ADHC_STR_GP_ID                     
                    AND A.STR_SELN_ID = B.STR_SELN_ID                           
                    AND B.PROMO_PRIC_VER_ID = C.PROMO_PRIC_VER_ID               
                    AND TO_CHAR(E.EFF_STRT_TMST,                                
                              'YYYY-MM-DD.HH24.MI.SS') <= :PV-SYS-DATE          
                    AND (TO_CHAR(E.EFF_END_TMST,                                
                              'YYYY-MM-DD.HH24.MI.SS') >= :PV-SYS-DATE          
                     OR  E.EFF_END_TMST IS NULL)                                
                    AND A.STR_SELN_TYP_CDE = 'A'                                
                    AND B.STAT_CDE = 'S'                                        
                    AND C.STAT_CDE = 'S'                                        
                    AND D.RUSBL_IND = 'N'                                       
                    AND C.PRMY_PROMO_ID = :PV-PROMO-ID                          
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C224-DECLARE-REUSABLE-PRTVER                                  *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PRINT VERSIONS FOR A PROMOTION.    *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C224-DECLARE-REUSABLE-PRTVER.                                            
                                                                                
           EXEC SQL                                                             
               DECLARE REUSEPRTVERCSR                                           
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        A.STR_NBR                                               
                       ,D.STR_SELN_ID                                           
                   FROM                                                         
                        XKT_STR_GP_MBSHP A                                      
                       ,XKT_STR_GP_DTE B                                        
                       ,PMT_STR_SELN C                                          
                       ,PMT_PROMO_PRT_VER D                                     
                       ,PMT_PROMO_PRIC_VER E                                    
                       ,PMT_ADHC_STR_GP F                                       
                       ,PMT_ADHC_STR_GP_XREF G                                  
                   WHERE                                                        
                        A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE                     
                    AND A.STR_GP_ID = B.STR_GP_ID                               
                    AND B.EFF_STR_GP_ID = G.EFF_STR_GP_ID                       
                    AND G.ADHC_STR_GP_ID = F.ADHC_STR_GP_ID                     
                    AND F.ADHC_STR_GP_ID = C.ADHC_STR_GP_ID                     
                    AND C.STR_SELN_ID = D.STR_SELN_ID                           
                    AND D.PROMO_PRIC_VER_ID = E.PROMO_PRIC_VER_ID               
                    AND TO_CHAR(A.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                              <= :PV-SYS-DATE                   
                    AND (TO_CHAR(A.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                              >= :PV-SYS-DATE                   
                     OR  A.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(B.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                              <= :PV-SYS-DATE                   
                    AND (TO_CHAR(B.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  B.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(G.STRT_TMST, 'YYYY-MM-DD.HH24.MI.SS')           
                                              <= :PV-SYS-DATE                   
                    AND (TO_CHAR(G.END_TMST, 'YYYY-MM-DD.HH24.MI.SS')           
                                               >= :PV-SYS-DATE                  
                     OR  G.END_TMST IS NULL)                                    
                    AND C.STR_SELN_TYP_CDE = 'A'                                
                    AND D.STAT_CDE = 'S'                                        
                    AND E.STAT_CDE = 'S'                                        
                    AND F.RUSBL_IND = 'Y'                                       
                    AND E.PRMY_PROMO_ID = :PV-PROMO-ID                          
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C230-DECLARE-CLRNC-CSR                                        *         
      * ==> PROCESSES:                                                *         
      *  - RETREVE STORES FOR A CLEARANCE PROMOTION.                  *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C230-DECLARE-CLRNC-CSR.                                                  
                                                                                
           EXEC SQL                                                             
               DECLARE CLRNCCSR                                                 
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        A.STR_NBR                                               
                       ,F.STR_SELN_ID                                           
                   FROM                                                         
                        XKT_STR_GP_MBSHP A                                      
                       ,XKT_STR_GP_DTE B                                        
                       ,PMT_STR_SELN C                                          
                       ,PMT_CLRNC_PROMO D                                       
                       ,PMT_CLRNC_MDSE_LNE E                                    
                       ,PMT_CLRNC_PRICG F                                       
                   WHERE                                                        
                        A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE                     
                    AND A.STR_GP_ID = B.STR_GP_ID                               
                    AND B.EFF_STR_GP_ID = C.EFF_STR_GP_ID                       
                    AND C.STR_SELN_ID = F.STR_SELN_ID                           
                    AND F.MDSE_SELN_LNE_ID = E.MDSE_SELN_LNE_ID                 
                    AND E.CLRNC_PROMO_ID = D.CLRNC_PROMO_ID                     
                    AND TO_CHAR(A.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                               <= :PV-SYS-DATE                  
                    AND (TO_CHAR(A.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  A.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(B.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                               <= :PV-SYS-DATE                  
                    AND (TO_CHAR(B.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  B.EFF_END_DTE IS NULL)                                 
                    AND C.STR_SELN_TYP_CDE = 'P'                                
                    AND D.CLRNC_PROMO_ID = :PV-PROMO-ID                         
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C232-DECLARE-NONREUSE-CLRNC                                  *          
      * ==> PROCESSES:                                                *         
      *  - RETREVE STORES FOR A CLEARANCE PROMOTION.                  *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C232-DECLARE-NONREUSE-CLRNC.                                             
                                                                                
           EXEC SQL                                                             
               DECLARE NONREUCLRNCCSR                                           
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        F.STR_NBR                                               
                       ,D.STR_SELN_ID                                           
                   FROM                                                         
                        PMT_STR_SELN A                                          
                       ,PMT_CLRNC_PROMO B                                       
                       ,PMT_CLRNC_MDSE_LNE C                                    
                       ,PMT_CLRNC_PRICG D                                       
                       ,PMT_ADHC_STR_GP E                                       
                       ,PMT_PROMO_INTFC_ADHC_STR F                              
                   WHERE                                                        
                        F.ADHC_STR_GP_ID = E.ADHC_STR_GP_ID                     
                    AND E.ADHC_STR_GP_ID = A.ADHC_STR_GP_ID                     
                    AND A.STR_SELN_ID = D.STR_SELN_ID                           
                    AND D.MDSE_SELN_LNE_ID = C.MDSE_SELN_LNE_ID                 
                    AND C.CLRNC_PROMO_ID = B.CLRNC_PROMO_ID                     
                    AND TO_CHAR(F.EFF_STRT_TMST,                                
                             'YYYY-MM-DD.HH24.MI.SS') <= :PV-SYS-DATE           
                    AND (TO_CHAR(F.EFF_END_TMST,                                
                             'YYYY-MM-DD.HH24.MI.SS') >= :PV-SYS-DATE           
                     OR  F.EFF_END_TMST IS NULL)                                
                    AND E.RUSBL_IND = 'N'                                       
                    AND A.STR_SELN_TYP_CDE = 'A'                                
                    AND B.CLRNC_PROMO_ID = :PV-PROMO-ID                         
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C234-DECLARE-REUSABLE-CLRNC                                   *         
      * ==> PROCESSES:                                                *         
      *  - RETREVE STORES FOR A CLEARANCE PROMOTION.                  *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C234-DECLARE-REUSABLE-CLRNC.                                             
                                                                                
           EXEC SQL                                                             
               DECLARE REUSECLRNCCSR                                            
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        A.STR_NBR                                               
                       ,F.STR_SELN_ID                                           
                   FROM                                                         
                        XKT_STR_GP_MBSHP A                                      
                       ,XKT_STR_GP_DTE B                                        
                       ,PMT_STR_SELN C                                          
                       ,PMT_CLRNC_PROMO D                                       
                       ,PMT_CLRNC_MDSE_LNE E                                    
                       ,PMT_CLRNC_PRICG F                                       
                       ,PMT_ADHC_STR_GP G                                       
                       ,PMT_ADHC_STR_GP_XREF H                                  
                   WHERE                                                        
                        A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE                     
                    AND A.STR_GP_ID = B.STR_GP_ID                               
                    AND B.EFF_STR_GP_ID = H.EFF_STR_GP_ID                       
                    AND H.ADHC_STR_GP_ID = G.ADHC_STR_GP_ID                     
                    AND G.ADHC_STR_GP_ID = C.ADHC_STR_GP_ID                     
                    AND C.STR_SELN_ID = F.STR_SELN_ID                           
                    AND F.MDSE_SELN_LNE_ID = E.MDSE_SELN_LNE_ID                 
                    AND E.CLRNC_PROMO_ID = D.CLRNC_PROMO_ID                     
                    AND TO_CHAR(A.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                               <= :PV-SYS-DATE                  
                    AND (TO_CHAR(A.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  A.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(B.EFF_BEG_DTE, 'YYYY-MM-DD.HH24.MI.SS')         
                                               <= :PV-SYS-DATE                  
                    AND (TO_CHAR(B.EFF_END_DTE, 'YYYY-MM-DD.HH24.MI.SS')        
                                               >= :PV-SYS-DATE                  
                     OR  B.EFF_END_DTE IS NULL)                                 
                    AND TO_CHAR(H.STRT_TMST,                                    
                             'YYYY-MM-DD.HH24.MI.SS') <= :PV-SYS-DATE           
                    AND (TO_CHAR(H.END_TMST,                                    
                             'YYYY-MM-DD.HH24.MI.SS') >= :PV-SYS-DATE           
                     OR  H.END_TMST IS NULL)                                    
                    AND G.RUSBL_IND = 'Y'                                       
                    AND C.STR_SELN_TYP_CDE = 'P'                                
                    AND D.CLRNC_PROMO_ID = :PV-PROMO-ID                         
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C240-DECLARE-UNAD-CSR                                         *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PROMO ITEMS FOR THE UNADVERTISED *           
      *    PROMOTION.                                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C240-DECLARE-UNAD-CSR.                                                   
                                                                                
           EXEC SQL                                                             
               DECLARE UNADCSR                                                  
               CURSOR FOR                                                       
                   SELECT /*+ ORDERED */                                        
                        DISTINCT                                                
                        I.STR_NBR                                               
                       ,F.STR_SELN_ID                                           
                       ,A.PROMO_ITM_ID                                          
                       ,B.MDSE_SELN_ID                                          
                   FROM                                                         
                        PMT_PROMO_ITM A                                         
                       ,PMT_MDSE_SELN     B                                     
                       ,PMT_MDSE_SELN_LNE C                                     
                       ,PMT_MDSE_LNE_PRICG D                                    
                       ,PMT_MDSE_LNE_PRICG_ASSN E                               
                       ,PMT_PROMO_ITM_ASSN F                                    
                       ,PMT_STR_SELN G                                          
                       ,XKT_STR_GP_DTE H                                        
                       ,XKT_STR_GP_MBSHP I                                      
                   WHERE                                                        
                        A.PROMO_ITM_ID      = B.PROMO_ITM_ID                    
                    AND B.MDSE_SELN_ID      = C.MDSE_SELN_ID                    
                    AND C.MDSE_SELN_LNE_ID  = D.MDSE_SELN_LNE_ID                
                    AND D.MDSE_LNE_PRICG_ID = E.MDSE_LNE_PRICG_ID               
                    AND E.STR_SELN_ID       = F.STR_SELN_ID                     
                    AND F.STR_SELN_ID       = G.STR_SELN_ID                     
                    AND F.PROMO_ITM_ID      = A.PROMO_ITM_ID                    
                    AND G.STR_SELN_TYP_CDE  = 'P'                               
                    AND G.EFF_STR_GP_ID     = H.EFF_STR_GP_ID                   
                    AND H.STR_GP_TYP_CDE    = I.STR_GP_TYP_CDE                  
                    AND H.STR_GP_ID         = I.STR_GP_ID                       
                    AND (E.STAT_CDE = 'S'                                       
                     OR  (E.STAT_CDE IN ('C', 'D')                              
                     AND  E.LAST_UPD_TMST >= F.PROMO_ITM_STRT_TMST))            
                    AND H.EFF_BEG_DTE      <=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (H.EFF_END_DTE     >=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  H.EFF_END_DTE  IS NULL)                                
                    AND I.EFF_BEG_DTE      <=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (I.EFF_END_DTE     >=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  I.EFF_END_DTE  IS NULL)                                
                    AND A.PROMO_ID = :PV-PROMO-ID                               
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C242-DECLARE-NONREUSE-UNAD                                    *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PROMO ITEMS FOR THE UNADVERTISED *           
      *    PROMOTION.                                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C242-DECLARE-NONREUSE-UNAD.                                              
                                                                                
           EXEC SQL                                                             
               DECLARE NONREUUNADCSR                                            
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        I.STR_NBR                                               
                       ,F.STR_SELN_ID                                           
                       ,A.PROMO_ITM_ID                                          
                       ,B.MDSE_SELN_ID                                          
                   FROM                                                         
                        PMT_PROMO_ITM A                                         
                       ,PMT_MDSE_SELN     B                                     
                       ,PMT_MDSE_SELN_LNE C                                     
                       ,PMT_MDSE_LNE_PRICG D                                    
                       ,PMT_MDSE_LNE_PRICG_ASSN E                               
                       ,PMT_PROMO_ITM_ASSN F                                    
                       ,PMT_STR_SELN G                                          
                       ,PMT_ADHC_STR_GP H                                       
                       ,PMT_PROMO_INTFC_ADHC_STR I                              
                   WHERE                                                        
                        A.PROMO_ITM_ID      = B.PROMO_ITM_ID                    
                    AND B.MDSE_SELN_ID      = C.MDSE_SELN_ID                    
                    AND C.MDSE_SELN_LNE_ID  = D.MDSE_SELN_LNE_ID                
                    AND D.MDSE_LNE_PRICG_ID = E.MDSE_LNE_PRICG_ID               
                    AND E.STR_SELN_ID       = F.STR_SELN_ID                     
                    AND F.STR_SELN_ID       = G.STR_SELN_ID                     
                    AND F.PROMO_ITM_ID      = A.PROMO_ITM_ID                    
                    AND G.STR_SELN_TYP_CDE  = 'A'                               
                    AND G.ADHC_STR_GP_ID    = H.ADHC_STR_GP_ID                  
                    AND H.RUSBL_IND         = 'N'                               
                    AND H.ADHC_STR_GP_ID    = I.ADHC_STR_GP_ID                  
                    AND I.EFF_STRT_TMST    <=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (I.EFF_END_TMST    >=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  I.EFF_END_TMST IS NULL)                                
                    AND (E.STAT_CDE = 'S'                                       
                     OR  (E.STAT_CDE IN ('C', 'D')                              
                     AND  E.LAST_UPD_TMST >= F.PROMO_ITM_STRT_TMST))            
                    AND A.PROMO_ID = :PV-PROMO-ID                               
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C244-DECLARE-REUSABLE-UNAD                                    *         
      * ==> PROCESSES:                                                *         
      *  - RETRIEVE STORES FOR ALL PROMO ITEMS FOR THE UNADVERTISED *           
      *    PROMOTION.                                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = DECLARE WAS SUCCESSFULL                                *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C244-DECLARE-REUSABLE-UNAD.                                              
                                                                                
           EXEC SQL                                                             
               DECLARE REUSEUNADCSR                                             
               CURSOR FOR                                                       
                   SELECT DISTINCT                                              
                        K.STR_NBR                                               
                       ,F.STR_SELN_ID                                           
                       ,A.PROMO_ITM_ID                                          
                       ,B.MDSE_SELN_ID                                          
                   FROM                                                         
                        PMT_PROMO_ITM A                                         
                       ,PMT_MDSE_SELN     B                                     
                       ,PMT_MDSE_SELN_LNE C                                     
                       ,PMT_MDSE_LNE_PRICG D                                    
                       ,PMT_MDSE_LNE_PRICG_ASSN E                               
                       ,PMT_PROMO_ITM_ASSN F                                    
                       ,PMT_STR_SELN G                                          
                       ,PMT_ADHC_STR_GP H                                       
                       ,PMT_ADHC_STR_GP_XREF I                                  
                       ,XKT_STR_GP_DTE J                                        
                       ,XKT_STR_GP_MBSHP K                                      
                   WHERE                                                        
                        A.PROMO_ITM_ID      = B.PROMO_ITM_ID                    
                    AND B.MDSE_SELN_ID      = C.MDSE_SELN_ID                    
                    AND C.MDSE_SELN_LNE_ID  = D.MDSE_SELN_LNE_ID                
                    AND D.MDSE_LNE_PRICG_ID = E.MDSE_LNE_PRICG_ID               
                    AND E.STR_SELN_ID       = F.STR_SELN_ID                     
                    AND F.STR_SELN_ID       = G.STR_SELN_ID                     
                    AND F.PROMO_ITM_ID      = A.PROMO_ITM_ID                    
                    AND G.STR_SELN_TYP_CDE  = 'A'                               
                    AND G.ADHC_STR_GP_ID    = H.ADHC_STR_GP_ID                  
                    AND H.RUSBL_IND         = 'Y'                               
                    AND H.ADHC_STR_GP_ID    = I.ADHC_STR_GP_ID                  
                    AND I.EFF_STR_GP_ID     = J.EFF_STR_GP_ID                   
                    AND J.STR_GP_TYP_CDE    = K.STR_GP_TYP_CDE                  
                    AND J.STR_GP_ID         = K.STR_GP_ID                       
                    AND (E.STAT_CDE = 'S'                                       
                     OR  (E.STAT_CDE IN ('C', 'D')                              
                     AND  E.LAST_UPD_TMST >= F.PROMO_ITM_STRT_TMST))            
                    AND I.STRT_TMST    <=                                       
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (I.END_TMST    >=                                       
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  I.END_TMST IS NULL)                                    
                    AND J.EFF_BEG_DTE      <=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (J.EFF_END_DTE     >=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  J.EFF_END_DTE IS NULL)                                 
                    AND K.EFF_BEG_DTE      <=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                    AND (K.EFF_END_DTE     >=                                   
                        TO_DATE(:PV-SYS-DATE, 'YYYY-MM-DD.HH24.MI.SS')          
                     OR  K.EFF_END_DTE IS NULL)                                 
                    AND A.PROMO_ID = :PV-PROMO-ID                               
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * C300-OPEN-PROMO-ITM-CSR.                                      *         
      * ==> PROCESSES:                                                *         
      *  - OPEN PROMITMCSR                                            *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = SUCCESSFULL OPEN                                       *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C300-OPEN-PROMO-ITM-CSR.                                                 
                                                                                
           EXEC SQL                                                             
               OPEN PROMOITMCSR                                                 
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C300-OPEN-PROMO-ITM-CSR     '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON PROMOITM-CSR '                           
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C310-OPEN-PROMO-CSR.                                          *         
      * ==> PROCESSES:                                                *         
      *  - OPEN PROMO CSR                                             *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = SUCCESSFULL OPEN                                       *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C310-OPEN-PROMO-CSR.                                                     
                                                                                
           EXEC SQL                                                             
               OPEN PROMOCSR                                                    
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C310-OPEN-PROMO-CSR      '                             
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON PROMO-CSR '                              
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C320-OPEN-PRT-VER-CSR.                                        *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE PRINT VERSION CSR                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C320-OPEN-PRT-VER-CSR.                                                   
                                                                                
           EXEC SQL                                                             
               OPEN PRTVERCSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C320-OPEN-PRT-VER-CSR      '                           
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON PRTVERCSR '                              
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C322-OPEN-NONREUSE-PRTVER                                     *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE NONREUSABLE PRINT VERSION CURSOR                  *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C322-OPEN-NONREUSE-PRTVER.                                               
                                                                                
           EXEC SQL                                                             
               OPEN NONREUPRTVERCSR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C322-OPEN-NONREUSE-PRTVER    '                         
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON NONREUPRTVERCSR '                        
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C324-OPEN-REUSABLE-PRTVER                                     *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE PRINT VERSION CSR                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C324-OPEN-REUSABLE-PRTVER.                                               
                                                                                
           EXEC SQL                                                             
               OPEN REUSEPRTVERCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C324-OPEN-REUSABLE-PRTVER     '                        
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON REUSEPRTVERCSR '                         
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C330-OPEN-CLRNC-CSR.                                          *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE CLEARNCE CURSOR                                   *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C330-OPEN-CLRNC-CSR.                                                     
                                                                                
           EXEC SQL                                                             
                 OPEN CLRNCCSR                                                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C330-OPEN-CLRNC-CSR      '                             
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON CLRNC-CSR '                              
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C332-OPEN-NONREUSE-CLRNC                                      *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE CLEARNCE CURSOR                                   *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C332-OPEN-NONREUSE-CLRNC.                                                
                                                                                
           EXEC SQL                                                             
                 OPEN NONREUCLRNCCSR                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C332-OPEN-NONREUSE-CLRNC  '                            
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON NONREUCLRNCCSR '                         
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C334-OPEN-REUSABLE-CLRNC                                      *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE CLEARNCE CURSOR                                   *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C334-OPEN-REUSABLE-CLRNC.                                                
                                                                                
           EXEC SQL                                                             
                 OPEN REUSECLRNCCSR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C334-OPEN-REUSABLE-CLRNC    '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON REUSECLRNCCSR '                          
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C340-OPEN-UNAD-CSR.                                           *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE UNADVERTISED CURSOR                               *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C340-OPEN-UNAD-CSR.                                                      
                                                                                
           EXEC SQL                                                             
                 OPEN UNADCSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C340-OPEN-UNAD-CSR      '                              
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON UNADCSR '                                
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C342-OPEN-NONREUSE-UNAD                                       *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE UNADVERTISED CURSOR                               *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C342-OPEN-NONREUSE-UNAD.                                                 
                                                                                
           EXEC SQL                                                             
                 OPEN NONREUUNADCSR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C342-OPEN-NONREUSE-UNAD  '                             
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON NONREUUNADCSR '                          
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C344-OPEN-REUSABLE-UNAD                                       *         
      * ==> PROCESSES:                                                *         
      *  - OPEN THE UNADVERTISED CURSOR                               *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = OPEN WAS SUCCESSFULL                                   *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C344-OPEN-REUSABLE-UNAD.                                                 
                                                                                
           EXEC SQL                                                             
                 OPEN REUSEUNADCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'C344-OPEN-REUSABLE-UNAD    '                           
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'OPEN ERROR ON REUSEUNADCSR '                           
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C400-FETCH-PROMO-ITM-CSR.                                     *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLE LISTED.                                           *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM: A100-MAINLINE, C500-PROCESS-PROMO-CSR     *         
      *****************************************************************         
       C400-FETCH-PROMO-ITM-CSR.                                                
                                                                                
           EXEC SQL                                                             
               FETCH PROMOITMCSR                                                
                INTO  :PV-PROMO-ID                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-PROMO-CNT                                        
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' PROMO COUNT FROM FETCH = ' PA-PROMO-CNT            
                   DISPLAY ' END OF PROMO CSR'                                  
                   SET PS-END-OF-PROMO-CSR TO TRUE                              
                                                                                
               WHEN OTHER                                                       
                   DISPLAY ' PROMO ID = ' PV-PROMO-ID                           
                   MOVE 'C400-FETCH-PROMO-ITM-CSR        '                      
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON PROMO-CSR   '                           
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C410-FETCH-PROMO-CSR.                                         *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLE LISTED.                                           *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM: A100-MAINLINE, C500-PROCESS-PROMO-CSR     *         
      *****************************************************************         
       C410-FETCH-PROMO-CSR.                                                    
                                                                                
           EXEC SQL                                                             
               FETCH PROMOCSR                                                   
                INTO  :PV-PROMO-ID                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   PERFORM C120-PROMO-EXISTS                                    
                   IF PS-PROMO-NOT-EXISTS                                       
                       ADD 1 TO PA-PROMO-CNT                                    
                   END-IF                                                       
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' PROMO COUNT FROM FETCH = ' PA-PROMO-CNT            
                   DISPLAY ' END OF PROMO CSR'                                  
                   SET PS-END-OF-PROMO-CSR TO TRUE                              
                                                                                
               WHEN OTHER                                                       
                   DISPLAY ' PROMO ID = ' PV-PROMO-ID                           
                   MOVE 'C410-FETCH-PROMO-CSR        '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON PROMO-CSR   '                           
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C420-FETCH-PRT-VER-CSR.                                       *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C520-PROCESS-PRT-VER-CSR        *         
      *****************************************************************         
       C420-FETCH-PRT-VER-CSR.                                                  
                                                                                
           EXEC SQL                                                             
               FETCH PRTVERCSR                                                  
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   SET PS-PRT-VER-FOUND TO TRUE                                 
                   ADD 1 TO PA-PRT-VER-CNT                                      
                   ADD 1 TO PA-TOTAL-PRT-VER-CNT                                
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' PRT VER CNT FROM FETCH = ' PA-PRT-VER-CNT  NT      
                   DISPLAY ' END OF PRT VER CSR'                                
                   SET PS-END-OF-PRT-VER-CSR TO TRUE                            
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C420-FETCH-PRT-VER-CSR        '                        
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON PRT-VER-CSR   '                         
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C422-FETCH-NONREUSE-PRTVER                                    *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C520-PROCESS-PRT-VER-CSR        *         
      *****************************************************************         
       C422-FETCH-NONREUSE-PRTVER.                                              
                                                                                
           EXEC SQL                                                             
               FETCH NONREUPRTVERCSR                                            
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   SET PS-PRT-VER-FOUND TO TRUE                                 
                   ADD 1 TO PA-NONREUSE-PRT-VER-CNT                             
                   ADD 1 TO PA-TOTAL-PRT-VER-CNT                                
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' NONREUSE-PRT-VER-CNT FROM FETCH = '        NT      
                                               PA-NONREUSE-PRT-VER-CNT          
                   DISPLAY ' END OF NONREUPRTVERCSR'                            
                   SET PS-END-OF-NONUPRTVER-CSR TO TRUE                         
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C422-FETCH-NONREUSE-PRTVER  '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON NONREUPRTVERCSR  '                      
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C424-FETCH-REUSABLE-PRTVER                                    *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C520-PROCESS-PRT-VER-CSR        *         
      *****************************************************************         
       C424-FETCH-REUSABLE-PRTVER.                                              
                                                                                
           EXEC SQL                                                             
               FETCH REUSEPRTVERCSR                                             
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   SET PS-PRT-VER-FOUND TO TRUE                                 
                   ADD 1 TO PA-REUSE-PRT-VER-CNT                                
                   ADD 1 TO PA-TOTAL-PRT-VER-CNT                                
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' REUSE-PRT-VER-CNT FROM FETCH = '           NT      
                                               PA-REUSE-PRT-VER-CNT             
                   DISPLAY ' END OF REUSEPRTVERCSR'                             
                   SET PS-END-OF-REUSEPRTVER-CSR TO TRUE                        
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C424-FETCH-REUSABLE-PRTVER  '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON REUSEPRTVERCSR  '                       
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C430-FETCH-CLRNC-CSR.                                         *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C530-PROCESS-CLRNC-CSR          *         
      *****************************************************************         
       C430-FETCH-CLRNC-CSR.                                                    
                                                                                
           EXEC SQL                                                             
               FETCH CLRNCCSR                                                   
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-CLRNC-CNT                                        
                   ADD 1 TO PA-TOTAL-CLRNC-CNT                                  
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' CLRNC COUNT FROM FETCH = ' PA-CLRNC-CNT            
                   DISPLAY ' END OF CLRNCCSR'                                   
                   SET PS-END-OF-CLRNC-CSR TO TRUE                              
                                                                                
               WHEN OTHER                                                       
                   DISPLAY ' PROMO ID = ' PV-PROMO-ID                           
                   MOVE 'C430-FETCH-CLRNC-CSR    '                              
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON CLRNC-CSR   '                           
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C432-FETCH-NONREUSE-CLRNC                                     *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C530-PROCESS-CLRNC-CSR          *         
      *****************************************************************         
       C432-FETCH-NONREUSE-CLRNC.                                               
                                                                                
           EXEC SQL                                                             
               FETCH NONREUCLRNCCSR                                             
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-NONREUSE-CLRNC-CNT                               
                   ADD 1 TO PA-TOTAL-CLRNC-CNT                                  
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' NONREUSE-CLRNC-CNT FROM FETCH = '                  
                                              PA-NONREUSE-CLRNC-CNT             
                   DISPLAY ' END OF NONREUCLRNCCSR'                             
                   SET PS-END-OF-NONUCLRNC-CSR TO TRUE                          
                                                                                
               WHEN OTHER                                                       
                   DISPLAY ' PROMO ID = ' PV-PROMO-ID                           
                   MOVE 'C432-FETCH-NONREUSE-CLRNC   '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON NONREUCLRNCCSR'                         
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C434-FETCH-REUSABLE-CLRNC                                     *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C530-PROCESS-CLRNC-CSR          *         
      *****************************************************************         
       C434-FETCH-REUSABLE-CLRNC.                                               
                                                                                
           EXEC SQL                                                             
               FETCH REUSECLRNCCSR                                              
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-REUSE-CLRNC-CNT                                  
                   ADD 1 TO PA-TOTAL-CLRNC-CNT                                  
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' REUSE-CLRNC-CNT FROM FETCH = '                     
                                                 PA-REUSE-CLRNC-CNT             
                   DISPLAY ' END OF REUSECLRNCCSR'                              
                   SET PS-END-OF-REUSECLRNC-CSR TO TRUE                         
                                                                                
               WHEN OTHER                                                       
                   DISPLAY ' PROMO ID = ' PV-PROMO-ID                           
                   MOVE 'C434-FETCH-REUSABLE-CLRNC '                            
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON REUSECLRNCCSR   '                       
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C440-FETCH-UNAD-CSR.                                          *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C540-PROCESS-UNAD-CSR           *         
      *****************************************************************         
       C440-FETCH-UNAD-CSR.                                                     
                                                                                
           EXEC SQL                                                             
               FETCH UNADCSR                                                    
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
                    , :PV-PROMO-ITM-ID                                          
                    , :PV-MDSE-SELN-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-UNAD-CNT                                         
                   ADD 1 TO PA-TOTAL-UNAD-CNT                                   
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' UNAD COUNT FROM FETCH = ' PA-UNAD-CNT              
                   DISPLAY ' END OF UNADCSR'                                    
                   SET PS-END-OF-UNAD-CSR TO TRUE                               
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C440-FETCH-UNAD-CSR        '                           
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON UNAD-CSR   '                            
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C442-FETCH-NONREUSE-UNAD                                      *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C540-PROCESS-UNAD-CSR           *         
      *****************************************************************         
       C442-FETCH-NONREUSE-UNAD.                                                
                                                                                
           EXEC SQL                                                             
               FETCH NONREUUNADCSR                                              
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
                    , :PV-PROMO-ITM-ID                                          
                    , :PV-MDSE-SELN-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-NONREUSE-UNAD-CNT                                
                   ADD 1 TO PA-TOTAL-UNAD-CNT                                   
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' NONREUSE-UNAD-CNT FROM FETCH = '                   
                                                PA-NONREUSE-UNAD-CNT            
                   DISPLAY ' END OF NONREUUNADCSR'                              
                   SET PS-END-OF-NONUUNAD-CSR TO TRUE                           
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C442-FETCH-NONREUSE-UNAD    '                          
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON NONREUUNADCSR'                          
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C444-FETCH-REUSABLE-UNAD                                      *         
      * ==> PROCESSES:                                                *         
      *  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  *         
      *    VARIABLES LISTED.                                          *         
      * ==> SQLCODE:                                                  *         
      *  - 0    = A ROW WAS FOUND                                     *         
      *  - 1403 = WHEN NO DATA WAS FOUND                              *         
      * ==> PERFORMED FROM:                                           *         
      *       C500-PROCESS-PROMO-CSR, C540-PROCESS-UNAD-CSR           *         
      *****************************************************************         
       C444-FETCH-REUSABLE-UNAD.                                                
                                                                                
           EXEC SQL                                                             
               FETCH REUSEUNADCSR                                               
                INTO  :PV-STR-NBR                                               
                    , :PV-STR-SELN-ID                                           
                    , :PV-PROMO-ITM-ID                                          
                    , :PV-MDSE-SELN-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   ADD 1 TO PA-REUSE-UNAD-CNT                                   
                   ADD 1 TO PA-TOTAL-UNAD-CNT                                   
                                                                                
               WHEN SQLCODE = 1403                                              
                   DISPLAY ' REUSE-UNAD-CNT FROM FETCH = '                      
                                                     PA-REUSE-UNAD-CNT          
                   DISPLAY ' END OF REUSEUNADCSR'                               
                   SET PS-END-OF-REUSEUNAD-CSR TO TRUE                          
                                                                                
               WHEN OTHER                                                       
                   MOVE 'C444-FETCH-REUSABLE-UNAD '                             
                                     TO PV-PARAGRAPH-NAME                       
                   MOVE 'FETCH ERROR ON REUSEUNADCSR '                          
                                     TO PV-OPERATION-MSG-1                      
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C500-PROCESS-PROMO-CSR.                                       *         
      * ==> PROCESSES:                                                *         
      *  - IF PROMO DOES NOT EXIST IN PMTT_STR_SELN_STR_ASSOC TABLE   *         
      *    THEN LOOK FOR IT IN PRINT VERSION.                         *         
      *  - IF NOT FOUND IN PRINT VERSION AND IT HAS A PROMO ITM THEN  *         
      *    LOOK IN UNADVERTISED.                                      *         
      *  - IF NOT FOUND IN PRINT VERSION AND IT DOES NOT HAVE A       *         
      *    PROMO ITM LOOK IN CLEARANCE.                               *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE PROMO OR PROMO *         
      *    ITEM SLS RSLT TBL.                                         *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C500-PROCESS-PROMO-CSR.                                                  
                                                                                
           IF PS-PROMO-NOT-EXISTS                                               
               MOVE 0 TO PA-PRT-VER-CNT                                         
               SET PS-PRT-VER-NOT-FOUND TO TRUE                                 
               SET PS-NOT-END-OF-PRT-VER-CSR TO TRUE                            
               SET PS-NOT-END-OF-NONUPRTVER-CSR TO TRUE                         
               SET PS-NOT-END-OF-REUSEPRTVER-CSR TO TRUE                        
               SET PS-NOT-END-OF-UNAD-CSR TO TRUE                               
               SET PS-NOT-END-OF-NONUUNAD-CSR TO TRUE                           
               SET PS-NOT-END-OF-REUSEUNAD-CSR TO TRUE                          
               SET PS-NOT-END-OF-CLRNC-CSR TO TRUE                              
               SET PS-NOT-END-OF-NONUCLRNC-CSR TO TRUE                          
               SET PS-NOT-END-OF-REUSECLRNC-CSR TO TRUE                         
                                                                                
               PERFORM C220-DECLARE-PRT-VER-CSR                                 
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'OPENING C320 PRT-VER-CSR: '                             
                        PV-CPU-TIME                                             
               PERFORM C320-OPEN-PRT-VER-CSR                                    
               PERFORM C420-FETCH-PRT-VER-CSR                                   
               PERFORM C520-PROCESS-PRT-VER-CSR                                 
                 UNTIL PS-END-OF-PRT-VER-CSR                                    
               PERFORM C620-CLOSE-PRT-VER-CSR                                   
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'CLOSED C620 PRT-VER-CSR: '                              
                        PV-CPU-TIME                                             
               DISPLAY '*************************'                              
                                                                                
               PERFORM C222-DECLARE-NONREUSE-PRTVER                             
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'OPENING C322 NONREUSE-PRTVER: '                         
                        PV-CPU-TIME                                             
               PERFORM C322-OPEN-NONREUSE-PRTVER                                
               PERFORM C422-FETCH-NONREUSE-PRTVER                               
               PERFORM C522-PROCESS-NONREUSE-PRTVER                             
                 UNTIL PS-END-OF-NONUPRTVER-CSR                                 
               PERFORM C622-CLOSE-NONREUSE-PRTVER                               
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'CLOSED C622 NONREUSE-PRTVER: '                          
                        PV-CPU-TIME                                             
               DISPLAY '*************************'                              
                                                                                
               PERFORM C224-DECLARE-REUSABLE-PRTVER                             
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'OPENING C324 REUSABLE-PRTVER: '                         
                        PV-CPU-TIME                                             
               PERFORM C324-OPEN-REUSABLE-PRTVER                                
               PERFORM C424-FETCH-REUSABLE-PRTVER                               
               PERFORM C524-PROCESS-REUSABLE-PRTVER                             
                 UNTIL PS-END-OF-REUSEPRTVER-CSR                                
               PERFORM C624-CLOSE-REUSABLE-PRTVER                               
               ACCEPT CT-CPU-TIME FROM TIME                                     
               MOVE CT-CPU-HR     TO  PV-CPU-HR                                 
               MOVE CT-CPU-MIN    TO  PV-CPU-MIN                                
               MOVE CT-CPU-SEC    TO  PV-CPU-SEC                                
               MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                               
               DISPLAY 'CLOSED C624 REUSABLE-PRTVER: '                          
                        PV-CPU-TIME                                             
               DISPLAY '*************************'                              
                                                                                
               IF PS-PRT-VER-NOT-FOUND                                          
                   IF PS-PROMO-ITM                                              
                       MOVE 0 TO PA-TOTAL-UNAD-CNT                              
                       PERFORM C240-DECLARE-UNAD-CSR                            
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C340 UNAD-CSR: '                        
                                PV-CPU-TIME                                     
                       PERFORM C340-OPEN-UNAD-CSR                               
                       PERFORM C440-FETCH-UNAD-CSR                              
                       PERFORM C540-PROCESS-UNAD-CSR                            
                         UNTIL PS-END-OF-UNAD-CSR                               
                       PERFORM C640-CLOSE-UNAD-CSR                              
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C640 UNAD-CSR: '                         
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                                                                                
                       PERFORM C242-DECLARE-NONREUSE-UNAD                       
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C342 NONREUSE-UNAD'                     
                                PV-CPU-TIME                                     
                       PERFORM C342-OPEN-NONREUSE-UNAD                          
                       PERFORM C442-FETCH-NONREUSE-UNAD                         
                       PERFORM C542-PROCESS-NONREUSE-UNAD                       
                         UNTIL PS-END-OF-NONUUNAD-CSR                           
                       PERFORM C642-CLOSE-NONREUSE-UNAD                         
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C642 NONREUSE-UNAD: '                    
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                                                                                
                       PERFORM C244-DECLARE-REUSABLE-UNAD                       
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C344 REUSABLE-UNAD: '                   
                                PV-CPU-TIME                                     
                       PERFORM C344-OPEN-REUSABLE-UNAD                          
                       PERFORM C444-FETCH-REUSABLE-UNAD                         
                       PERFORM C544-PROCESS-REUSABLE-UNAD                       
                         UNTIL PS-END-OF-REUSEUNAD-CSR                          
                       PERFORM C644-CLOSE-REUSABLE-UNAD                         
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C344 REUSABLE-UNAD: '                    
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                   ELSE                                                         
                       MOVE 0 TO PA-TOTAL-CLRNC-CNT                             
                       PERFORM C230-DECLARE-CLRNC-CSR                           
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C330 CLRNC-CSR: '                       
                                PV-CPU-TIME                                     
                       PERFORM C330-OPEN-CLRNC-CSR                              
                       PERFORM C430-FETCH-CLRNC-CSR                             
                       PERFORM C530-PROCESS-CLRNC-CSR                           
                         UNTIL PS-END-OF-CLRNC-CSR                              
                       PERFORM C630-CLOSE-CLRNC-CSR                             
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C630 CLRNC-CSR: '                        
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                                                                                
                       PERFORM C232-DECLARE-NONREUSE-CLRNC                      
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C332 NONREUSE-CLRNC: '                  
                                PV-CPU-TIME                                     
                       PERFORM C332-OPEN-NONREUSE-CLRNC                         
                       PERFORM C432-FETCH-NONREUSE-CLRNC                        
                       PERFORM C532-PROCESS-NONREUSE-CLRNC                      
                         UNTIL PS-END-OF-NONUCLRNC-CSR                          
                       PERFORM C632-CLOSE-NONREUSE-CLRNC                        
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C632 NONREUSE-CLRNC: '                   
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                                                                                
                       PERFORM C234-DECLARE-REUSABLE-CLRNC                      
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'OPENING C334 REUSABLE-CLRNC: '                  
                                PV-CPU-TIME                                     
                       PERFORM C334-OPEN-REUSABLE-CLRNC                         
                       PERFORM C434-FETCH-REUSABLE-CLRNC                        
                       PERFORM C534-PROCESS-REUSABLE-CLRNC                      
                         UNTIL PS-END-OF-REUSECLRNC-CSR                         
                       PERFORM C634-CLOSE-REUSABLE-CLRNC                        
                       ACCEPT CT-CPU-TIME FROM TIME                             
                       MOVE CT-CPU-HR     TO  PV-CPU-HR                         
                       MOVE CT-CPU-MIN    TO  PV-CPU-MIN                        
                       MOVE CT-CPU-SEC    TO  PV-CPU-SEC                        
                       MOVE CT-CPU-HSEC   TO  PV-CPU-HSEC                       
                       DISPLAY 'CLOSED C634 REUSABLE-CLRNC: '                   
                                PV-CPU-TIME                                     
                       DISPLAY '*************************'                      
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           INITIALIZE PV-PROMO-VARIABLES.                                       
           MOVE ZEROES TO PV-PROMO-ITM-ID                                       
                          PV-MDSE-SELN-ID.                                      
           IF PS-PROMO-ITM                                                      
               PERFORM C400-FETCH-PROMO-ITM-CSR                                 
           ELSE                                                                 
               PERFORM C410-FETCH-PROMO-CSR                                     
           END-IF.                                                              
                                                                                
      *****************************************************************         
      * C520-PROCESS-PRT-VER-CSR.                                     *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE PRINT VER CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C520-PROCESS-PRT-VER-CSR.                                                
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C420-FETCH-PRT-VER-CSR.                                      
                                                                                
      *****************************************************************         
      * C522-PROCESS-NONREUSE-PRTVER                                  *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE PRINT VER CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C522-PROCESS-NONREUSE-PRTVER.                                            
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C422-FETCH-NONREUSE-PRTVER.                                  
                                                                                
      *****************************************************************         
      * C524-PROCESS-REUSABLE-PRTVER                                  *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE PRINT VER CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C524-PROCESS-REUSABLE-PRTVER.                                            
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C424-FETCH-REUSABLE-PRTVER.                                  
                                                                                
      *****************************************************************         
      * C530-PROCESS-CLRNC-CSR.                                       *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE CLEARANCE CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C530-PROCESS-CLRNC-CSR.                                                  
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C430-FETCH-CLRNC-CSR.                                        
                                                                                
      *****************************************************************         
      * C532-PROCESS-NONREUSE-CLRNC                                   *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE CLEARANCE CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C532-PROCESS-NONREUSE-CLRNC.                                             
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C432-FETCH-NONREUSE-CLRNC.                                   
                                                                                
      *****************************************************************         
      * C534-PROCESS-REUSABLE-CLRNC                                   *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE CLEARANCE CSR  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C534-PROCESS-REUSABLE-CLRNC.                                             
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C434-FETCH-REUSABLE-CLRNC.                                   
                                                                                
      *****************************************************************         
      * C540-PROCESS-UNAD-CSR.                                        *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE UNAD CSR       *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C540-PROCESS-UNAD-CSR.                                                   
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C440-FETCH-UNAD-CSR.                                         
                                                                                
      *****************************************************************         
      * C542-PROCESS-NONREUSE-UNAD                                    *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE UNAD CSR       *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C542-PROCESS-NONREUSE-UNAD.                                              
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C442-FETCH-NONREUSE-UNAD.                                    
                                                                                
      *****************************************************************         
      * C544-PROCESS-REUSABLE-UNAD                                    *         
      * ==> PROCESSES:                                                *         
      *  - INSERT THE PROMO ITM IN THE STR_SELN_STR_ASSOC.            *         
      *  - REINITIALIZE THE VARIABLES                                 *         
      *  - THEN GO AND FETCH THE NEXT ROW FOUND IN THE UNAD CSR       *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C544-PROCESS-REUSABLE-UNAD.                                              
                                                                                
           PERFORM C110-INSERT.                                                 
           PERFORM C444-FETCH-REUSABLE-UNAD.                                    
                                                                                
      *****************************************************************         
      * C600-CLOSE-PROMO-ITM-CSR.                                     *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE PROMO ITEM CURSOR                                *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C600-CLOSE-PROMO-ITM-CSR.                                                
                                                                                
           EXEC SQL                                                             
                CLOSE PROMOITMCSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C600-CLOSE-PROMO-ITM-CSR      '                         
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON PROMO-CSR     '                          
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C610-CLOSE-PROMO-CSR.                                         *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE PROMO CURSOR                                     *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: A100-MAINLINE                             *         
      *****************************************************************         
       C610-CLOSE-PROMO-CSR.                                                    
                                                                                
           EXEC SQL                                                             
                CLOSE PROMOCSR                                                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C610-CLOSE-PROMO-CSR      '                             
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON PROMO-CSR     '                          
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C620-CLOSE-PRT-VER-CSR.                                       *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE PRINT VERSION CURSOR                             *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C620-CLOSE-PRT-VER-CSR.                                                  
                                                                                
           EXEC SQL                                                             
                CLOSE PRTVERCSR                                                 
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C620-CLOSE-PRT-VER-CSR      '                           
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON PRT-VER-CSR     '                        
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C622-CLOSE-NONREUSE-PRTVER                                    *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE PRINT VERSION CURSOR                             *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C622-CLOSE-NONREUSE-PRTVER.                                              
                                                                                
           EXEC SQL                                                             
                CLOSE NONREUPRTVERCSR                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C622-CLOSE-NONREUSE-PRTVER    '                         
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON NONREUPRTVERCSR'                         
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C624-CLOSE-REUSABLE-PRTVER                                    *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE PRINT VERSION CURSOR                             *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C624-CLOSE-REUSABLE-PRTVER.                                              
                                                                                
           EXEC SQL                                                             
                CLOSE REUSEPRTVERCSR                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C624-CLOSE-REUSABLE-PRTVER '                            
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON REUSEPRTVERCSR'                          
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C630-CLOSE-CLRNC-CSR.                                         *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE CLEARANCE CURSOR                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C630-CLOSE-CLRNC-CSR.                                                    
                                                                                
           EXEC SQL                                                             
                CLOSE CLRNCCSR                                                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C630-CLOSE-CLRNC-CSR      '                             
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON CLRNC-CSR     '                          
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C632-CLOSE-NONREUSE-CLRNC                                     *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE CLEARANCE CURSOR                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C632-CLOSE-NONREUSE-CLRNC.                                               
                                                                                
           EXEC SQL                                                             
                CLOSE NONREUCLRNCCSR                                            
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C632-CLOSE-NONREUSE-CLRNC   '                           
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON NONREUCLRNCCSR'                          
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C634-CLOSE-REUSABLE-CLRNC                                     *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE CLEARANCE CURSOR                                 *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C634-CLOSE-REUSABLE-CLRNC.                                               
                                                                                
           EXEC SQL                                                             
                CLOSE REUSECLRNCCSR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C634-CLOSE-REUSABLE-CLRNC'                              
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON REUSECLRNCCSR'                           
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C640-CLOSE-UNAD-CSR.                                          *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE UNADVERTISED CURSOR                              *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C640-CLOSE-UNAD-CSR.                                                     
                                                                                
           EXEC SQL                                                             
                CLOSE UNADCSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C640-CLOSE-UNAD-CSR      '                              
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON UNAD-CSR     '                           
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C642-CLOSE-NONREUSE-UNAD                                      *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE UNADVERTISED CURSOR                              *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C642-CLOSE-NONREUSE-UNAD.                                                
                                                                                
           EXEC SQL                                                             
                CLOSE NONREUUNADCSR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C642-CLOSE-NONREUSE-UNAD  '                             
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON NONREUUNADCSR'                           
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * C644-CLOSE-REUSABLE-UNAD                                      *         
      * ==> PROCESSES:                                                *         
      *  - CLOSE THE UNADVERTISED CURSOR                              *         
      * ==> SQLCODE:                                                  *         
      *  - 0 = CLOSE WAS SUCCESSFULL                                  *         
      * ==> PERFORMED FROM: C500-PROCESS-PROMO-CSR                    *         
      *****************************************************************         
       C644-CLOSE-REUSABLE-UNAD.                                                
                                                                                
           EXEC SQL                                                             
                CLOSE REUSEUNADCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                  MOVE 'C644-CLOSE-REUSABLE-UNAD'                               
                                    TO PV-PARAGRAPH-NAME                        
                  MOVE 'CLOSE ERROR ON REUSEUNADCSR'                            
                                    TO PV-OPERATION-MSG-1                       
                   DISPLAY PV-PARAGRAPH-NAME                                    
                   PERFORM 9900-ORACLE-ABEND                                    
           END-EVALUATE.                                                        
                                                                                
070941****************************************************************          
070941** READ THE ORACLE LOGON CONTROL CARD.                        **          
070941****************************************************************          
070941 7000-READ-ORACLE-LOGON.                                                  
070941                                                                          
070941     READ ORACLE-LOGON-FILE                                               
070941         INTO CC-ORACLE-CONNECTION                                        
070941         AT END                                                           
070941             SET PS-END-OF-LOGON-FILE TO TRUE                             
070941     END-READ.                                                            
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT     *        
      * LOGONS TO ORACLE.                                              *        
      ******************************************************************        
070941*    COPY PMPD700.                                                        
                                                                                
      *----------------------------------------------------------               
      * 9900-ORACLE-ABEND.                                                      
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.                    
      *----------------------------------------------------------               
       9900-ORACLE-ABEND.                                                       
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
070941*    DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.           
070941     DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.                   
           DISPLAY '** SQLCODE        ** = ' PV-SQL.                            
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.                     
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      ******************************************************************        
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *        
      ******************************************************************        
       Z910-ABEND.                                                              
                                                                                
           DISPLAY '** ABEND           **'.                                     
070941*    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.          
           DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.                  
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.                 
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.               
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
