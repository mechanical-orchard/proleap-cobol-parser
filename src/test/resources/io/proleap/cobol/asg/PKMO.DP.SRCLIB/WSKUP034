000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.   WSKUP034.                                          00040000
000500 AUTHOR.       JOE LAROSA.                                        00050000
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. SEPTEMBER 2001.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*         STOCK ORDER REPOSITORY LOAD (FOR RDM DOWNLOAD)          00100000
001100* THIS PROGRAM READS THE CENTRAL STOCK RDM EXTRACT FILES & INSERTS00110000
001200* THEM INTO THE E-FULFILLMENT REPOSITORY FOR LATER PROCESSING.    00120000
001200*                                                                 00121000
001200* CHANGES                                                         00122000
001200* 05/15/2020 JEAN KURK RENAMED FROM WFKUP014 TO WSKUP034          00123000
001300******************************************************************00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500******************************************************************00150000
001600 CONFIGURATION SECTION.                                           00160000
001700 SOURCE-COMPUTER.        IBM-3090.                                00170000
001800 OBJECT-COMPUTER.        IBM-3090.                                00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000                                                                  00200000
002100 FILE-CONTROL.                                                    00210000
002200     SELECT INPUT1-FILE                 ASSIGN TO INP01.          00220000
002300     SELECT INPUT2-FILE                 ASSIGN TO INP02.          00230000
002400******************************************************************00240000
002500 DATA DIVISION.                                                   00250000
002600******************************************************************00260000
002700 FILE SECTION.                                                    00270000
002800                                                                  00280000
002900 FD  INPUT1-FILE                                                  00290000
003000     RECORDING MODE IS F                                          00300000
003100     LABEL RECORDS ARE STANDARD                                   00310000
003200     BLOCK CONTAINS 0 RECORDS.                                    00320000
003300 01  INPUT1-RECORD                  PIC X(1156).                  00330000
003400                                                                  00340000
003500 FD  INPUT2-FILE                                                  00350000
003600     RECORDING MODE IS F                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     BLOCK CONTAINS 0 RECORDS.                                    00380000
003900 01  INPUT2-RECORD                  PIC X(219).                   00390000
004000                                                                  00400000
004100******************************************************************00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300******************************************************************00430000
004400 01  PS-PROGRAM-SWITCHES.                                         00440000
004500     05  PS-END-OF-INPUT1-SW        PIC  X(01) VALUE 'N'.         00450000
004600         88  PS-END-OF-INPUT1-YES              VALUE 'Y'.         00460000
004700         88  PS-END-OF-INPUT1-NO               VALUE 'N'.         00470000
004800     05  PS-END-OF-INPUT2-SW        PIC  X(01) VALUE 'N'.         00480000
004900         88  PS-END-OF-INPUT2-YES              VALUE 'Y'.         00490000
005000         88  PS-END-OF-INPUT2-NO               VALUE 'N'.         00500000
005100                                                                  00510000
005200 01  PC-PROGRAM-CONSTANTS.                                        00520000
005300     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKUP034'.  00530000
005400     05  PC-SOHDR                   PIC X(06)  VALUE 'SOHDR '.    00540000
005500     05  PC-SODTL                   PIC X(06)  VALUE 'SODTL '.    00550000
005600     05  PC-READY                   PIC X(06)  VALUE 'READY '.    00560000
005700     05  PC-N                       PIC X(01)  VALUE 'N'.         00570000
005800     05  PC-DEFAULT-TMST            PIC X(26)  VALUE              00580000
005900                                    '0001-01-01-00.00.00.000000'. 00590000
006000                                                                  00600000
006100 01  PV-PROGRAM-VARIABLES.                                        00610000
006200     05  PV-COMMIT-COUNT-SOHDR      PIC  9(07) VALUE ZEROES.      00620000
006300     05  PV-COMMIT-COUNT-SODTL      PIC  9(07) VALUE ZEROES.      00630000
006400     05  PV-DISPLAY-RECORD          PIC Z,ZZZ,ZZ9-.               00640000
006500     05  PV-VERSION-CNTL-NBR        PIC S9(02)V9(02) COMP-3.      00650000
006600     05  PV-REC-SEQ-NBR             PIC S9(09) VALUE +0 COMP.     00660000
006700     05  PV-HOLD-LOCATION           PIC S9(04) VALUE +0 COMP.     00670000
006800     05  PV-PRC-CNTL-TMST           PIC  X(26) VALUE SPACE.       00680000
006900*    05  FILLER REDEFINES PV-PRC-CNTL-TMST.                       00690000
007000*        10 PV-TMST-CCYY            PIC  9(04).                   00700000
007100*        10 FILLER                  PIC  X(01).                   00710000
007200*        10 PV-TMST-MONTH           PIC  9(02).                   00720000
007300*        10 FILLER                  PIC  X(01).                   00730000
007400*        10 PV-TMST-DAY             PIC  9(02).                   00740000
007500*        10 FILLER                  PIC  X(01).                   00750000
007600*        10 PV-TMST-HOUR            PIC  9(02).                   00760000
007700*        10 FILLER                  PIC  X(01).                   00770000
007800*        10 PV-TMST-MINUTE          PIC  9(02).                   00780000
007900*        10 FILLER                  PIC  X(01).                   00790000
008000*        10 PV-TMST-SECOND          PIC  9(02).                   00800000
008100*        10 FILLER                  PIC  X(01).                   00810000
008200*        10 PV-TMST-LAST6           PIC  9(06).                   00820000
008300     05  PV-SQLCODE                 PIC S9(09).                   00830000
008400     05  PV-DISPLAY-SQLCODE         PIC -------999.               00840000
008500                                                                  00850000
008600 01  ABEND-CODE                     PIC S9(04) VALUE +0 COMP SYNC.00860000
008700                                                                  00870000
008800 01  PA-PROGRAM-ACCUMULATORS.                                     00880000
008900     05  PA-TOTALS.                                               00890000
009000         10 PA-TOTAL-REC1-READ      PIC S9(07) VALUE +0 COMP-3.   00900000
009100         10 PA-TOTAL-REC2-READ      PIC S9(07) VALUE +0 COMP-3.   00910000
009200         10 PA-TOTAL-REC1-WRITTEN   PIC S9(07) VALUE +0 COMP-3.   00920000
009300         10 PA-TOTAL-REC2-WRITTEN   PIC S9(07) VALUE +0 COMP-3.   00930000
009400                                                                  00940000
009500 01  PV-ABEND-FIELDS.                                             00950000
009600     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.00960000
009700     05  PV-ABEND-PROGRAM           PIC  X(08) VALUE 'WSKUP034'.  00970000
009800     05  PV-ABEND-PARAGRAPH         PIC  X(25) VALUE SPACES.      00980000
009900     05  PV-ABEND-OPERATION         PIC  X(20) VALUE SPACES.      00990000
010000     05  PV-ABEND-STRUCTURE-1       PIC  X(08) VALUE SPACES.      01000000
010100     05  PV-ABEND-STRUCTURE-2       PIC  X(08) VALUE SPACES.      01010000
010200     05  PV-ABEND-STATUS            PIC  XX    VALUE SPACES.      01020000
010300     05  PV-DB2-OPERATION-MESSAGE-1 PIC  X(79) VALUE SPACES.      01030000
010400     05  PV-DB2-OPERATION-MESSAGE-2 PIC  X(79) VALUE SPACES.      01040000
010500                                                                  01050000
010600******************************************************************01060000
010700*  DB2 TABLE DECLARATION - WEB FULFILLMENT LOAD CONTROL.          01070000
010800*      (WFT_LOD_CNTL)                                             01080000
010900******************************************************************01090000
011000     EXEC SQL                                                     01100000
011100          INCLUDE WFT00001                                        01110000
011200     END-EXEC.                                                    01120000
011300                                                                  01130000
011400******************************************************************01140000
011500*  DB2 TABLE DECLARATION - WEB FULFILLMENT LOAD TRANSACTIONS.     01150000
011600*      (WFT_LOD_XFER)                                             01160000
011700******************************************************************01170000
011800     EXEC SQL                                                     01180000
011900          INCLUDE WFT00002                                        01190000
012000     END-EXEC.                                                    01200000
012100                                                                  01210000
012200******************************************************************01220000
012300* INPUT LAYOUT - STOCK ORDER HEADER / DETAIL.                     01230000
012400******************************************************************01240000
012500* I/O LAYOUT1 - CE009-SOHDR-DOWNLOAD-REC.                         01250000
012600     COPY CERD009.                                                01260000
012700                                                                  01270000
012800* I/O LAYOUT2 - CE021-SODTL-DOWNLOAD-REC.                         01280001
012900     COPY CERD021.                                                01290001
013000                                                                  01300000
013100******************************************************************01310000
013200*  DB2 FORMATTED MESSAGE AREA                                     01320000
013300******************************************************************01330000
013400     COPY DPWS004.                                                01340000
013500                                                                  01350000
013600******************************************************************01360000
013700*  COMMUNICATIONS AREA FOR DB2                                    01370000
013800******************************************************************01380000
013900     EXEC SQL                                                     01390000
014000         INCLUDE SQLCA                                            01400000
014100     END-EXEC.                                                    01410000
014200                                                                  01420000
014300******************************************************************01430000
014400 LINKAGE SECTION.                                                 01440000
014500******************************************************************01450000
014600                                                                  01460000
014700/*****************************************************************01470000
014800 PROCEDURE DIVISION.                                              01480000
014900******************************************************************01490000
015000 0000-PROGRAM-MAINLINE.                                           01500000
015100     DISPLAY '************ START OF WSKUP034 ***************'     01510000
015200                                                                  01520000
015300     PERFORM 1000-INITIALIZE.                                     01530000
015400                                                                  01540000
015500*READ FIRST RECORD(S).                                            01550000
015600     PERFORM 1200-READ-INPUT1-FILE.                               01560000
015700     PERFORM 1300-READ-INPUT2-FILE.                               01570000
015800                                                                  01580000
015900     IF PS-END-OF-INPUT1-YES                                      01590000
016000         DISPLAY ' '                                              01600000
016100         DISPLAY ' ****** NO RECORDS ON SOHDR INPUT FILE ******'  01610000
016200         DISPLAY ' '                                              01620000
016300     END-IF.                                                      01630000
016400                                                                  01640000
016500     IF PS-END-OF-INPUT2-YES                                      01650000
016600         DISPLAY ' '                                              01660000
016700         DISPLAY ' ****** NO RECORDS ON SODTL INPUT FILE ******'  01670000
016800         DISPLAY ' '                                              01680000
016900     END-IF.                                                      01690000
017000                                                                  01700000
017100*PROCESS THE RECORDS.                                             01710000
017200     IF PS-END-OF-INPUT1-NO                                       01720000
017300         PERFORM 2000-INSERT-INPUT1-WFT00001                      01730000
017400         MOVE ZEROES TO PV-REC-SEQ-NBR                            01740000
017500         PERFORM 2100-INSERT-INPUT1-WFT00002                      01750000
017600           UNTIL PS-END-OF-INPUT1-YES                             01760000
017700     END-IF.                                                      01770000
017800                                                                  01780000
017900     IF PS-END-OF-INPUT2-NO                                       01790000
018000         PERFORM 2200-INSERT-INPUT2-WFT00001                      01800000
018100         MOVE ZEROES TO PV-REC-SEQ-NBR                            01810000
018200         PERFORM 2300-INSERT-INPUT2-WFT00002                      01820000
018300           UNTIL PS-END-OF-INPUT2-YES                             01830000
018400     END-IF.                                                      01840000
018500                                                                  01850000
018600*CLOSE FILES.                                                     01860000
018700      CLOSE INPUT1-FILE                                           01870000
018800            INPUT2-FILE.                                          01880000
018900                                                                  01890000
019000*PRINT PROGRAM ACCUMULATORS.                                      01900000
019100      DISPLAY ' '.                                                01910000
019200      DISPLAY '*********************************************'.    01920000
019300      DISPLAY '     * WSKUP034 SUMMARY STATISTICS *         '.    01930000
019400      DISPLAY ' '.                                                01940000
019500      DISPLAY '     -------------------------------         '.    01950000
019600      DISPLAY '      CENTRAL STOCK HDR/DTL INSERTS          '.    01960000
019700      DISPLAY '     -------------------------------         '.    01970000
019800      DISPLAY ' '.                                                01980000
019900      MOVE PA-TOTAL-REC1-READ            TO PV-DISPLAY-RECORD.    01990000
020000      DISPLAY '     TOTAL SOHDRS READ   = ' PV-DISPLAY-RECORD.    02000000
020100      MOVE PA-TOTAL-REC2-READ            TO PV-DISPLAY-RECORD.    02010000
020200      DISPLAY '     TOTAL SODTLS READ   = ' PV-DISPLAY-RECORD.    02020000
020300      DISPLAY ' '.                                                02030000
020400      MOVE PA-TOTAL-REC1-WRITTEN         TO PV-DISPLAY-RECORD.    02040000
020500      DISPLAY '     TOTAL SOHDR INSERTS = ' PV-DISPLAY-RECORD.    02050000
020600      MOVE PA-TOTAL-REC2-WRITTEN         TO PV-DISPLAY-RECORD.    02060000
020700      DISPLAY '     TOTAL SODTL INSERTS = ' PV-DISPLAY-RECORD.    02070000
020800      DISPLAY ' '.                                                02080000
020900      DISPLAY '*********************************************'.    02090000
021000      DISPLAY ' '.                                                02100000
021100                                                                  02110000
021200                                                                  02120000
021300*STOP                                                             02130000
021400     DISPLAY '************  END OF WSKUP034  ***************'     02140000
021500     STOP RUN.                                                    02150000
021600                                                                  02160000
021700******************************************************************02170000
021800*                                                                *02180000
021900*                I N I T I A L I Z A T I O N                     *02190000
022000*                                                                *02200000
022100******************************************************************02210000
022200 1000-INITIALIZE.                                                 02220000
022300                                                                  02230000
022400*INIT COUNTERS.                                                   02240000
022500     INITIALIZE PA-TOTAL-REC1-READ                                02250000
022600                PA-TOTAL-REC2-READ                                02260000
022700                PA-TOTAL-REC1-WRITTEN                             02270000
022800                PA-TOTAL-REC2-WRITTEN                             02280000
022900                PV-COMMIT-COUNT-SOHDR                             02290000
023000                PV-COMMIT-COUNT-SODTL.                            02300000
023100                                                                  02310000
023200*SET FILE AND PROCESS SWITHES.                                    02320000
023300     SET PS-END-OF-INPUT1-NO TO TRUE.                             02330000
023400     SET PS-END-OF-INPUT2-NO TO TRUE.                             02340000
023500                                                                  02350000
023600*OPEN INPUT FILES.                                                02360000
023700     OPEN INPUT INPUT1-FILE                                       02370000
023800                INPUT2-FILE.                                      02380000
023900                                                                  02390000
024000* CREATE THE PROCESS CONTROL TMST BY GETTING THE DB2 CURRENT TMST 02400000
024100     EXEC SQL                                                     02410000
024200         SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP                02420000
024300     END-EXEC.                                                    02430000
024400                                                                  02440000
024500     EVALUATE TRUE                                                02450000
024600       WHEN SQLCODE = ZERO                                        02460000
024700           CONTINUE                                               02470000
024800                                                                  02480000
024900       WHEN OTHER                                                 02490000
025000           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       02500000
025100           MOVE 'GET DB2 TMST'        TO PV-ABEND-OPERATION       02510000
025200           PERFORM 9900-DB2-ABEND                                 02520000
025300         END-EVALUATE.                                            02530000
025400                                                                  02540000
025500******************************************************************02550000
025600* READ THE INPUT1 FILE.                                           02560000
025700******************************************************************02570000
025800 1200-READ-INPUT1-FILE.                                           02580000
025900                                                                  02590000
026000     READ INPUT1-FILE                                             02600000
026100       INTO CE009-SOHDR-DOWNLOAD-REC                              02610000
026200         AT END                                                   02620000
026300           SET PS-END-OF-INPUT1-YES TO TRUE.                      02630000
026400                                                                  02640000
026500     IF PS-END-OF-INPUT1-NO                                       02650000
026600         ADD +1 TO PA-TOTAL-REC1-READ                             02660000
026700     END-IF.                                                      02670000
026800                                                                  02680000
026900******************************************************************02690000
027000* READ THE INPUT2 FILE.                                           02700000
027100******************************************************************02710000
027200 1300-READ-INPUT2-FILE.                                           02720000
027300                                                                  02730000
027400     READ INPUT2-FILE                                             02740000
027500       INTO CE021-SODTL-DOWNLOAD-REC                              02750001
027600         AT END                                                   02760000
027700           SET PS-END-OF-INPUT2-YES TO TRUE.                      02770000
027800                                                                  02780000
027900     IF PS-END-OF-INPUT2-NO                                       02790000
028000         ADD +1 TO PA-TOTAL-REC2-READ                             02800000
028100     END-IF.                                                      02810000
028200                                                                  02820000
028300******************************************************************02830000
028400*                                                                *02840000
028500*          I N S E R T   I N P U T   R E C O R D S               *02850000
028600*                                                                *02860000
028700******************************************************************02870000
028800 2000-INSERT-INPUT1-WFT00001.                                     02880000
028900                                                                  02890000
029000     MOVE +9.10          TO PV-VERSION-CNTL-NBR.                  02900000
029100     MOVE CE009-LOCATION TO PV-HOLD-LOCATION.                     02910000
029200                                                                  02920000
029300     EXEC SQL                                                     02930000
029400         INSERT INTO WFT_LOD_CNTL                                 02940000
029500             ( PRC_CNTL_TMST                                      02950000
029600              ,TRN_TYP_CDE                                        02960000
029700              ,STAT_CDE                                           02970000
029800              ,INIT_PRCG_BEG_TMST                                 02980000
029900              ,END_TMST                                           02990000
030000              ,ARCH_DAT_IND                                       03000000
030100              ,DAT_LOD_VER_NBR                                    03010000
030200              ,STR_NBR                                            03020000
030300             )                                                    03030000
030400         VALUES                                                   03040000
030500             (:PV-PRC-CNTL-TMST                                   03050000
030600             ,:PC-SOHDR                                           03060000
030700             ,:PC-READY                                           03070000
030800             ,:PC-DEFAULT-TMST                                    03080000
030900             ,:PC-DEFAULT-TMST                                    03090000
031000             ,:PC-N                                               03100000
031100             ,:PV-VERSION-CNTL-NBR                                03110000
031200             ,:PV-HOLD-LOCATION                                   03120000
031300             )                                                    03130000
031400     END-EXEC.                                                    03140000
031500                                                                  03150000
031600     EVALUATE TRUE                                                03160000
031700       WHEN SQLCODE = ZERO                                        03170000
031800           CONTINUE                                               03180000
031900                                                                  03190000
032000       WHEN OTHER                                                 03200000
032100           MOVE '2000-INSERT-INPUT1-WFT00001'                     03210000
032200                               TO PV-ABEND-PARAGRAPH              03220000
032300           MOVE 'ISRT WFT00001' TO PV-ABEND-OPERATION             03230000
032400           PERFORM 9900-DB2-ABEND                                 03240000
032500     END-EVALUATE.                                                03250000
032600                                                                  03260000
032700******************************************************************03270000
032800 2100-INSERT-INPUT1-WFT00002.                                     03280000
032900                                                                  03290000
033000*IF RECORDS ARE SPECIFIC TO A DC, USE THE FOLLOWING CODE.         03300000
033100     IF CE009-LOCATION NOT = PV-HOLD-LOCATION                     03310000
033200         EXEC SQL                                                 03320000
033300             SELECT                                               03330000
033400                 TIMESTAMP(:PV-PRC-CNTL-TMST) + 1 SECOND          03340000
033500             INTO                                                 03350000
033600                 :PV-PRC-CNTL-TMST                                03360000
033700             FROM SYSIBM.SYSDUMMY1                                03370000
033800         END-EXEC                                                 03380000
033900*        ADD  1      TO PV-TMST-SECOND                            03390000
034000         PERFORM 2000-INSERT-INPUT1-WFT00001                      03400000
034100         MOVE ZEROES TO PV-REC-SEQ-NBR                            03410000
034200     END-IF.                                                      03420000
034300*END OF DC SPECIFIC.                                              03430000
034400                                                                  03440000
034500     ADD +1 TO PV-REC-SEQ-NBR.                                    03450000
034600                                                                  03460000
034700     INITIALIZE WFT00002-LOD-DAT-TXT.                             03470000
034800                                                                  03480000
034900     MOVE LENGTH OF CE009-SOHDR-DOWNLOAD-REC                      03490000
035000       TO WFT00002-LOD-DAT-TXT-LEN.                               03500000
035100                                                                  03510000
035200     MOVE CE009-SOHDR-DOWNLOAD-REC                                03520000
035300       TO WFT00002-LOD-DAT-TXT-TEXT.                              03530000
035400                                                                  03540000
035500     EXEC SQL                                                     03550000
035600         INSERT INTO WFT_LOD_XFER                                 03560000
035700             ( PRC_CNTL_TMST                                      03570000
035800              ,TRN_TYP_CDE                                        03580000
035900              ,BTCH_LOD_SEQ_ID                                    03590000
036000              ,LOD_DAT_TXT                                        03600000
036100             )                                                    03610000
036200         VALUES                                                   03620000
036300             (:PV-PRC-CNTL-TMST                                   03630000
036400             ,:PC-SOHDR                                           03640000
036500             ,:PV-REC-SEQ-NBR                                     03650000
036600             ,:WFT00002-LOD-DAT-TXT                               03660000
036700             )                                                    03670000
036800     END-EXEC.                                                    03680000
036900                                                                  03690000
037000     EVALUATE TRUE                                                03700000
037100       WHEN SQLCODE = ZERO                                        03710000
037200           ADD +1 TO PA-TOTAL-REC1-WRITTEN                        03720000
037300                     PV-COMMIT-COUNT-SOHDR                        03730000
037400           IF PV-COMMIT-COUNT-SOHDR > 499                         03740000
037500               DISPLAY '  2100-COMMIT-SOHDR = '                   03750000
037600                       PV-COMMIT-COUNT-SOHDR                      03760000
037700               PERFORM 3000-COMMIT                                03770000
037800               MOVE ZEROES TO PV-COMMIT-COUNT-SOHDR               03780000
037900           END-IF                                                 03790000
038000                                                                  03800000
038100       WHEN OTHER                                                 03810000
038200           MOVE '2100-INSERT-INPUT1-WFT00002'                     03820000
038300                               TO PV-ABEND-PARAGRAPH              03830000
038400           MOVE 'ISRT WFT00002' TO PV-ABEND-OPERATION             03840000
038500           PERFORM 9900-DB2-ABEND                                 03850000
038600     END-EVALUATE.                                                03860000
038700                                                                  03870000
038800*READ THE NEXT INPUT RECORD.                                      03880000
038900     PERFORM 1200-READ-INPUT1-FILE.                               03890000
039000                                                                  03900000
039100******************************************************************03910000
039200******************************************************************03920000
039300 2200-INSERT-INPUT2-WFT00001.                                     03930000
039400                                                                  03940000
039500     MOVE +9.10          TO PV-VERSION-CNTL-NBR.                  03950000
039600     MOVE CE021-LOCATION TO PV-HOLD-LOCATION.                     03960001
039700                                                                  03970000
039800     EXEC SQL                                                     03980000
039900         INSERT INTO WFT_LOD_CNTL                                 03990000
040000             ( PRC_CNTL_TMST                                      04000000
040100              ,TRN_TYP_CDE                                        04010000
040200              ,STAT_CDE                                           04020000
040300              ,INIT_PRCG_BEG_TMST                                 04030000
040400              ,END_TMST                                           04040000
040500              ,ARCH_DAT_IND                                       04050000
040600              ,DAT_LOD_VER_NBR                                    04060000
040700              ,STR_NBR                                            04070000
040800             )                                                    04080000
040900         VALUES                                                   04090000
041000             (:PV-PRC-CNTL-TMST                                   04100000
041100             ,:PC-SODTL                                           04110000
041200             ,:PC-READY                                           04120000
041300             ,:PC-DEFAULT-TMST                                    04130000
041400             ,:PC-DEFAULT-TMST                                    04140000
041500             ,:PC-N                                               04150000
041600             ,:PV-VERSION-CNTL-NBR                                04160000
041700             ,:PV-HOLD-LOCATION                                   04170000
041800             )                                                    04180000
041900     END-EXEC.                                                    04190000
042000                                                                  04200000
042100     EVALUATE TRUE                                                04210000
042200       WHEN SQLCODE = ZERO                                        04220000
042300           CONTINUE                                               04230000
042400                                                                  04240000
042500       WHEN OTHER                                                 04250000
042600           MOVE '2200-INSERT-INPUT2-WFT00001'                     04260000
042700                               TO PV-ABEND-PARAGRAPH              04270000
042800           MOVE 'ISRT WFT00001' TO PV-ABEND-OPERATION             04280000
042900           PERFORM 9900-DB2-ABEND                                 04290000
043000     END-EVALUATE.                                                04300000
043100                                                                  04310000
043200******************************************************************04320000
043300 2300-INSERT-INPUT2-WFT00002.                                     04330000
043400                                                                  04340000
043500*IF RECORDS ARE SPECIFIC TO A DC, USE THE FOLLOWING CODE.         04350000
043600     IF CE021-LOCATION NOT = PV-HOLD-LOCATION                     04360001
043700         EXEC SQL                                                 04370000
043800             SELECT                                               04380000
033400                 TIMESTAMP(:PV-PRC-CNTL-TMST) + 1 SECOND          04390000
044000             INTO                                                 04400000
044100                 :PV-PRC-CNTL-TMST                                04410000
044200             FROM SYSIBM.SYSDUMMY1                                04420000
044300         END-EXEC                                                 04430000
044400*        ADD  1      TO PV-TMST-SECOND                            04440000
044500         PERFORM 2200-INSERT-INPUT2-WFT00001                      04450000
044600         MOVE ZEROES TO PV-REC-SEQ-NBR                            04460000
044700     END-IF.                                                      04470000
044800*END OF DC SPECIFIC.                                              04480000
044900                                                                  04490000
045000     ADD +1 TO PV-REC-SEQ-NBR.                                    04500000
045100                                                                  04510000
045200     INITIALIZE WFT00002-LOD-DAT-TXT.                             04520000
045300                                                                  04530000
045400     MOVE LENGTH OF CE021-SODTL-DOWNLOAD-REC                      04540001
045500       TO WFT00002-LOD-DAT-TXT-LEN.                               04550000
045600                                                                  04560000
045700     MOVE CE021-SODTL-DOWNLOAD-REC                                04570001
045800       TO WFT00002-LOD-DAT-TXT-TEXT.                              04580000
045900                                                                  04590000
046000     EXEC SQL                                                     04600000
046100         INSERT INTO WFT_LOD_XFER                                 04610000
046200             ( PRC_CNTL_TMST                                      04620000
046300              ,TRN_TYP_CDE                                        04630000
046400              ,BTCH_LOD_SEQ_ID                                    04640000
046500              ,LOD_DAT_TXT                                        04650000
046600             )                                                    04660000
046700         VALUES                                                   04670000
046800             (:PV-PRC-CNTL-TMST                                   04680000
046900             ,:PC-SODTL                                           04690000
047000             ,:PV-REC-SEQ-NBR                                     04700000
047100             ,:WFT00002-LOD-DAT-TXT                               04710000
047200             )                                                    04720000
047300     END-EXEC.                                                    04730000
047400                                                                  04740000
047500     EVALUATE TRUE                                                04750000
047600       WHEN SQLCODE = ZERO                                        04760000
047700           ADD +1 TO PA-TOTAL-REC2-WRITTEN                        04770000
047800                     PV-COMMIT-COUNT-SODTL                        04780000
047900           IF PV-COMMIT-COUNT-SODTL > 499                         04790000
048000               DISPLAY '  2300-COMMIT-SODTL = '                   04800000
048100                       PV-COMMIT-COUNT-SODTL                      04810000
048200               PERFORM 3000-COMMIT                                04820000
048300               MOVE ZEROES TO PV-COMMIT-COUNT-SODTL               04830000
048400           END-IF                                                 04840000
048500                                                                  04850000
048600       WHEN OTHER                                                 04860000
048700           MOVE '2300-INSERT-INPUT2-WFT00002'                     04870000
048800                               TO PV-ABEND-PARAGRAPH              04880000
048900           MOVE 'ISRT WFT00002' TO PV-ABEND-OPERATION             04890000
049000           PERFORM 9900-DB2-ABEND                                 04900000
049100     END-EVALUATE.                                                04910000
049200                                                                  04920000
049300*READ THE NEXT INPUT RECORD.                                      04930000
049400     PERFORM 1300-READ-INPUT2-FILE.                               04940000
049500                                                                  04950000
049600******************************************************************04960000
049700 3000-COMMIT.                                                     04970000
049800                                                                  04980000
049900     EXEC SQL                                                     04990000
050000         COMMIT                                                   05000000
050100     END-EXEC.                                                    05010000
050200                                                                  05020000
050300     EVALUATE TRUE                                                05030000
050400       WHEN SQLCODE = ZERO                                        05040000
050500           CONTINUE                                               05050000
050600                                                                  05060000
050700       WHEN OTHER                                                 05070000
050800           MOVE '3000-COMMIT'         TO PV-ABEND-PARAGRAPH       05080000
050900           MOVE 'COMMIT WFT_LOD_XFER' TO PV-ABEND-OPERATION       05090000
051000           PERFORM 9900-DB2-ABEND                                 05100000
051100     END-EVALUATE.                                                05110000
051200                                                                  05120000
051300******************************************************************05130000
051400*                                                                *05140000
051500*               A B E N D   P R O C E S S I N G                  *05150000
051600*                                                                *05160000
051700******************************************************************05170000
051800 9900-DB2-ABEND.                                                  05180000
051900                                                                  05190000
052000     MOVE SQLCODE    TO PV-SQLCODE.                               05200000
052100     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       05210000
052200     DISPLAY '*** DB2 ERROR ***'.                                 05220000
052300     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               05230000
052400     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 05240000
052500     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               05250000
052600     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               05260000
052700     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       05270000
052800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       05280000
052900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             05290000
053000                                                                  05300000
053100******************************************************************05310000
053200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05320000
053300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05330000
053400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05340000
053500* FORMAT.                                                         05350000
053600******************************************************************05360000
053700     COPY DPPD004.                                                05370000
053800                                                                  05380000
053900     IF SQLCODE NOT = -911                                        05390000
054000         EXEC SQL                                                 05400000
054100             ROLLBACK                                             05410000
054200         END-EXEC                                                 05420000
054300     END-IF.                                                      05430000
054400                                                                  05440000
054500     MOVE +4013         TO PV-ABEND-CODE.                         05450000
054600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05460000
054700******************************************************************05470000
054800******************************************************************05480000
