000100******************************************************************00010005
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030005
000400 PROGRAM-ID.    PCKUT122.                                         00040005
000500 AUTHOR.        DENISE HAHN.                                      00050022
000600 DATE-WRITTEN.  FEBRUARY 2024.                                    00060005
000700******************************************************************00070005
000800* THIS PROGRAM WILL BE USED TO                                    00080008
000900*    -  EXPAND PICK MADE EVENTS INTOCOMPONENT SKUS                00090008
001000*                                                                 00100019
001100*  INPUT FILE IS IN OPER-RCVR-LINE-STORE ORDER                    00110019
001500******************************************************************00150005
001600 ENVIRONMENT DIVISION.                                            00160005
001700 INPUT-OUTPUT SECTION.                                            00170005
001800                                                                  00180005
001900 FILE-CONTROL.                                                    00190005
002000     SELECT PICKMADE-EXTRACT-IN      ASSIGN INP01.                00200008
002100                                                                  00210005
002200     SELECT PICKMADE-EXTRACT-OUT     ASSIGN OUT01.                00220008
002300                                                                  00230005
002400 DATA DIVISION.                                                   00240005
002500 FILE SECTION.                                                    00250005
002600                                                                  00260005
002700 FD  PICKMADE-EXTRACT-IN                                          00270005
002800     RECORDING MODE IS F                                          00280005
002900     LABEL RECORDS ARE STANDARD                                   00290005
003000     BLOCK CONTAINS 0 RECORDS.                                    00300005
003100                                                                  00310005
003200 01  PICKMADE-RECORD-IN               PIC X(300).                 00320005
003300                                                                  00330005
003400 FD  PICKMADE-EXTRACT-OUT                                         00340005
003500     RECORDING MODE IS F                                          00350005
003600     LABEL RECORDS ARE STANDARD                                   00360005
003700     BLOCK CONTAINS 0 RECORDS.                                    00370005
003800                                                                  00380005
003900 01  PICKMADE-RECORD-OUT              PIC X(300).                 00390005
004000                                                                  00400005
004100                                                                  00410005
004200*----------------------------------------------------------------*00420005
004300 WORKING-STORAGE SECTION.                                         00430008
004400                                                                  00440006
004500 01  DK-DB2-KEYS.                                                 00450006
004600     05  DK-OPER-UNT-ID              PIC S9(04)  COMP.            00460019
004700     05  DK-PO-NBR                   PIC S9(09)  COMP.            00470019
004710     05  DK-RCVR-SEQ-NBR             PIC S9(09)  COMP.            00471019
004800     05  DK-PO-LINE-NBR              PIC S9(09)  COMP.            00480019
004900     05  DK-PREPK-ID                 PIC S9(09)  COMP.            00490019
004920                                                                  00492006
004930*----------------------------------------------------------------*00493005
004940* INPUT/OUTPUT RECORD LAYOUT                                      00494005
004950*----------------------------------------------------------------*00495005
004960     COPY PCRD086.                                                00496005
004970                                                                  00497005
004980                                                                  00498005
005600*----------------------------------------------------------------*00560005
005700*  PROGRAM SWITCHES                                              *00570005
005800*----------------------------------------------------------------*00580005
005900 01  PS-PROGRAM-SWITCHES.                                         00590005
006000     05  PS-END-OF-FILE-SW               PIC  X(01)  VALUE 'N'.   00600005
006100         88  PS-EOF                                  VALUE 'Y'.   00610005
006200         88  PS-EOF-NO                               VALUE 'N'.   00620005
006201     05  PS-EOF-CSR-SW                   PIC  X(01)  VALUE 'N'.   00620106
006202         88  PS-EOF-CSR                              VALUE 'Y'.   00620206
006203         88  PS-EOF-CSR-NO                           VALUE 'N'.   00620309
006300     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00630008
006400         88  PS-ERROR                                VALUE 'Y'.   00640008
006500         88  PS-ERROR-NO                             VALUE 'N'.   00650008
007200                                                                  00720006
007300                                                                  00730006
007400*----------------------------------------------------------------*00740005
007500*  PROGRAM VARIABLES                                             *00750005
007600*----------------------------------------------------------------*00760005
007700 01  PV-PROGRAM-VARIABLES.                                        00770005
007800                                                                  00780005
007900     05  PV-DISP-OPER                 PIC 9(04)  VALUE ZEROS.     00790005
008000     05  PV-DISP-PO                   PIC 9(08)  VALUE ZEROS.     00800005
008100     05  PV-DISP-RCVR                 PIC 9(04)  VALUE ZEROS.     00810005
008200     05  PV-DISP-LINE                 PIC 9(04)  VALUE ZEROS.     00820005
008300     05  PV-DISP-PREPK                PIC 9(04)  VALUE ZEROS.     00830005
008400     05  PV-PACKED-QTY                PIC 9(05)  VALUE ZEROS.     00840008
008410     05  PV-WHOLE-PACKS               PIC S9(07) COMP VALUE ZERO. 00841009
008420     05  PV-ODD-UNITS                 PIC S9(07) COMP VALUE ZERO. 00842009
008500     05  PV-BULK-COUNT                PIC 9(09)  VALUE ZEROS.     00850005
008501     05  PV-PREPK-COUNT               PIC 9(09)  VALUE ZEROS.     00850105
008502     05  PV-COMPONENT-COUNT           PIC 9(09)  VALUE ZEROS.     00850205
008510     05  PV-EVENT-INPUT-COUNT         PIC 9(09)  VALUE ZEROS.     00851005
008520     05  PV-EVENT-OUTPUT-COUNT        PIC 9(09)  VALUE ZEROS.     00852006
008521     05  PV-DISP-COUNT                PIC ZZZ,ZZZ,ZZ9.            00852106
008522     05  PV-DISP-WHOLE                PIC Z(6)9.                  00852215
008523     05  PV-SQLCODE                   PIC -999.                   00852315
008530                                                                  00853006
008540     05  PV-PREV-OPER-UNT-ID          PIC S9(04)  COMP.           00854019
008550     05  PV-PREV-PO-NBR               PIC S9(09)  COMP.           00855019
008560     05  PV-PREV-RCVR-SEQ-NBR         PIC S9(09)  COMP.           00856019
008570     05  PV-PREV-PO-LINE-NBR          PIC S9(09)  COMP.           00857019
015200                                                                  01520006
015300 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO.    01530005
015400                                                                  01540005
015500 01  PV-ABEND-FIELDS.                                             01550005
015600     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT121'.01560005
015700     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01570005
015800     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01580005
015900     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01590005
016000     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    01600005
016100     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    01610005
016200     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01620005
016300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01630005
016400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01640005
016500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01650005
016600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01660005
016700                                                                  01670005
016800                                                                  01680005
016810*---------------------------------------------------------------* 01681005
016820*    DB2 AREA FOR THE RECEIVER TABLE                            * 01682005
016830*---------------------------------------------------------------* 01683005
016840     EXEC SQL                                                     01684005
016850          INCLUDE TRECEIV                                         01685005
016860     END-EXEC.                                                    01686005
016870                                                                  01687005
016880*---------------------------------------------------------------* 01688005
016890*    DB2 AREA FOR RECEIVER ITEM TABLE                           * 01689005
016891*---------------------------------------------------------------* 01689105
016892     EXEC SQL                                                     01689206
016893          INCLUDE TRECITM                                         01689306
016894     END-EXEC.                                                    01689406
016895                                                                  01689506
016896*---------------------------------------------------------------* 01689606
016897*    DB2 AREA FOR PURCHASE ORDER ITEM TABLE                     * 01689706
016898*---------------------------------------------------------------* 01689806
016899     EXEC SQL                                                     01689906
016900          INCLUDE TPURITM                                         01690006
017000     END-EXEC.                                                    01700006
017100                                                                  01710006
019700*---------------------------------------------------------------* 01970006
019800* PREPACK CURSOR FOR LINES FOR A SPECIFIC PULL THAT WERE NOT    * 01980006
019900* USED AS THE DRIVER/PROCESS LINE                               * 01990006
020000*---------------------------------------------------------------* 02000006
020100     EXEC SQL                                                     02010006
020200          DECLARE PRE-PACK-LNE-CSR CURSOR FOR                     02020009
020300              SELECT A.ORD_LNE_NBR                                02030006
020400                   , A.PREPK_ID                                   02040006
020410                   , A.PREPK_RATO_QTY                             02041008
020600              FROM                                                02060006
020700                  TRECITM A                                       02070006
020800                , TPURITM B                                       02080006
020900               WHERE A.ORD_NBR        = :DK-PO-NBR                02090007
021000                 AND A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR          02100007
021010                 AND A.PREPK_ID       = :DK-PREPK-ID              02101006
021020                 AND A.PREPK_RATO_QTY > 0                         02102008
021030                 AND A.ORD_NBR        = B.PO_NBR                  02103006
021040                 AND A.ORD_LNE_NBR   <> :DK-PO-LINE-NBR           02104008
021050                 AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR          02105006
021060                 AND A.PO_VER_NBR     = B.VER_NBR                 02106006
021070                 AND B.VER_STATUS_CDE = 'A'                       02107012
021071                 AND A.VER_STATUS_CDE = 'A'                       02107112
021080               ORDER BY                                           02108008
021090                     A.ORD_LNE_NBR                                02109009
021091                WITH UR                                           02109108
021092     END-EXEC.                                                    02109206
021093                                                                  02109306
021094                                                                  02109406
021100*-----------------------------------------------------------------02110005
021200*  USED FOR DB2 ERROR MESSAGE BUILDING                            02120005
021300*-----------------------------------------------------------------02130005
021400     COPY DPWS004.                                                02140005
021500                                                                  02150005
021600*----------------------------------------------------------------*02160005
021700*  COMMUNICATIONS AREA FOR DB2                                   *02170005
021800*----------------------------------------------------------------*02180005
021900     EXEC SQL                                                     02190005
022000         INCLUDE SQLCA                                            02200005
022100     END-EXEC.                                                    02210005
022200                                                                  02220005
022300*----------------------------------------------------------------*02230005
022400 PROCEDURE DIVISION.                                              02240005
022500*----------------------------------------------------------------*02250005
022600                                                                  02260005
022700     DISPLAY '************************'.                          02270005
022800     DISPLAY '******* PCKUT122 *******'.                          02280005
022900     DISPLAY '************************'.                          02290005
023000                                                                  02300005
023100     SET  PS-ERROR-NO             TO TRUE.                        02310009
023400                                                                  02340005
023500     PERFORM 1000-INIT.                                           02350005
023600                                                                  02360005
023700     PERFORM 2000-PROCESS                                         02370005
023800       UNTIL PS-EOF                                               02380005
023900          OR PS-ERROR.                                            02390005
024000                                                                  02400005
024100     PERFORM 9000-TERMINATE.                                      02410005
024200                                                                  02420005
024300     GOBACK.                                                      02430005
024400                                                                  02440005
024500*-----------------------------------------------------------------02450005
024600*                                                                 02460005
024700*-----------------------------------------------------------------02470005
024800 1000-INIT.                                                       02480005
024900                                                                  02490005
025000     OPEN INPUT  PICKMADE-EXTRACT-IN.                             02500005
025100     OPEN OUTPUT PICKMADE-EXTRACT-OUT.                            02510005
025200                                                                  02520005
025300     PERFORM 7000-READ-INPUT.                                     02530005
025400                                                                  02540005
025500                                                                  02550005
025600*-----------------------------------------------------------------02560005
025700*                                                                 02570005
025800*-----------------------------------------------------------------02580005
025900 2000-PROCESS.                                                    02590005
026000                                                                  02600005
026400     MOVE PC086-OPER-UNT-ID       TO PV-DISP-OPER.                02640009
026500     MOVE PC086-ORD-NBR           TO PV-DISP-PO.                  02650009
026600     MOVE PC086-RCVR-SEQ-NBR      TO PV-DISP-RCVR.                02660009
026700     MOVE PC086-ORD-LNE-NBR       TO PV-DISP-LINE.                02670009
026800                                                                  02680005
026900     IF  PC086-OPER-UNT-ID   =  PV-PREV-OPER-UNT-ID  AND          02690019
027000         PC086-ORD-NBR       =  PV-PREV-PO-NBR       AND          02700019
027100         PC086-RCVR-SEQ-NBR  =  PV-PREV-RCVR-SEQ-NBR              02710019
027200         CONTINUE                                                 02720019
027300     ELSE                                                         02730019
027500         PERFORM 2100-CHECK-IF-PREPK                              02750019
027510     END-IF.                                                      02751019
027600                                                                  02760005
027700     IF  RECEIV-PKGNG-CDE = 'M'                                   02770005
027705                                                                  02770510
027706*        DISPLAY 'RCVR:  '                                        02770621
027707*                 PV-DISP-OPER '-'                                02770721
027708*                 PV-DISP-PO   '-'                                02770821
027709*                 PV-DISP-RCVR '-'                                02770921
027710*                 PV-DISP-LINE                                    02771021
027711                                                                  02771110
027720         ADD  1  TO PV-PREPK-COUNT                                02772008
027800         PERFORM 3000-EXPAND-PREPACK                              02780005
027900     ELSE                                                         02790005
028000         ADD  1  TO PV-BULK-COUNT                                 02800008
028800         PERFORM 8000-WRITE-EXTRACT-REC                           02880005
028900     END-IF.                                                      02890005
029000                                                                  02900005
029010     MOVE PC086-OPER-UNT-ID       TO PV-PREV-OPER-UNT-ID.         02901019
029020     MOVE PC086-ORD-NBR           TO PV-PREV-PO-NBR.              02902019
029030     MOVE PC086-RCVR-SEQ-NBR      TO PV-PREV-RCVR-SEQ-NBR.        02903019
029040     MOVE PC086-ORD-LNE-NBR       TO PV-PREV-PO-LINE-NBR.         02904019
029050                                                                  02905019
029100     PERFORM 7000-READ-INPUT.                                     02910005
029200                                                                  02920005
029300                                                                  02930005
029400*-----------------------------------------------------------------02940005
029500*                                                                 02950005
029600*-----------------------------------------------------------------02960005
029700 2100-CHECK-IF-PREPK.                                             02970005
029800                                                                  02980005
029900     MOVE PC086-ORD-NBR          TO  DK-PO-NBR                    02990008
030000     MOVE PC086-RCVR-SEQ-NBR     TO  DK-RCVR-SEQ-NBR              03000008
030100     MOVE PC086-ORD-LNE-NBR      TO  DK-PO-LINE-NBR               03010008
030500                                                                  03050005
030600     EXEC SQL                                                     03060005
030700          SELECT PKGNG_CDE                                        03070005
030800            INTO :RECEIV-PKGNG-CDE                                03080008
030900            FROM TRECEIV                                          03090005
031000           WHERE ORD_NBR             = :DK-PO-NBR                 03100005
031100             AND REC_SEQ_NBR         = :DK-RCVR-SEQ-NBR           03110005
031200            WITH UR                                               03120005
031300     END-EXEC.                                                    03130005
031400                                                                  03140005
031500     EVALUATE TRUE                                                03150005
031600         WHEN SQLCODE = ZERO                                      03160005
031700             CONTINUE                                             03170005
032100                                                                  03210005
032200         WHEN SQLWARN0 NOT = SPACES                               03220005
032300         WHEN SQLCODE NOT EQUAL ZERO                              03230005
032310             MOVE DK-OPER-UNT-ID TO PV-DISP-OPER                  03231008
032320             MOVE PC086-ORD-NBR      TO PV-DISP-PO                03232008
032330             MOVE PC086-RCVR-SEQ-NBR TO PV-DISP-RCVR              03233008
032340             MOVE PC086-ORD-LNE-NBR  TO PV-DISP-LINE              03234008
032350             SET PS-ERROR TO TRUE                                 03235008
032360             DISPLAY ' RCVR: '                                    03236005
032370                     PV-DISP-OPER '-'                             03237005
032380                     PV-DISP-PO   '-'                             03238005
032390                     PV-DISP-RCVR '-'                             03239005
032391                     PV-DISP-LINE ' '                             03239105
032393             MOVE '2100-CHECK-IF-PREPK'                           03239305
032394                                       TO PV-ABEND-PARAGRAPH      03239405
032395             MOVE 'GET PKGNG CODE    ' TO PV-ABEND-OPERATION      03239505
032396             MOVE 'TRECEIV '           TO PV-ABEND-STRUCTURE-1    03239605
032397             PERFORM 9900-DB2-ABEND                               03239705
032398     END-EVALUATE.                                                03239805
032399                                                                  03239905
032500                                                                  03250006
032600*-----------------------------------------------------------------03260005
032700*                                                                 03270005
032800*-----------------------------------------------------------------03280005
032810 3000-EXPAND-PREPACK.                                             03281006
032813                                                                  03281306
032814     MOVE PC086-ORD-NBR       TO DK-PO-NBR.                       03281408
032815     MOVE PC086-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR.                 03281508
032816     MOVE PC086-ORD-LNE-NBR   TO DK-PO-LINE-NBR.                  03281608
032817     MOVE PC086-PICKED-QTY    TO PV-PACKED-QTY.                   03281708
032818                                                                  03281806
032819     IF  PC086-ORD-NBR        =  PV-PREV-PO-NBR       AND         03281919
032820         PC086-RCVR-SEQ-NBR   =  PV-PREV-RCVR-SEQ-NBR AND         03282019
032821         PC086-ORD-LNE-NBR    =  PV-PREV-PO-LINE-NBR              03282119
032822         CONTINUE                                                 03282219
032823     ELSE                                                         03282319
032824         PERFORM 5000-GET-DRIVER-RATIO                            03282419
032825     END-IF.                                                      03282519
032826                                                                  03282619
032827     MOVE RECITM-PREPK-ID     TO PC086-PREPK-ID                   03282708
032828                                 DK-PREPK-ID.                     03282815
032829     MOVE 'D'                 TO PC086-PREPK-LNE-PRC-CDE.         03282915
032830                                                                  03283015
032831     DIVIDE PV-PACKED-QTY BY RECITM-PREPK-RATO-QTY                03283115
032832     GIVING                                                       03283215
032833         PV-WHOLE-PACKS                                           03283315
032834     REMAINDER                                                    03283415
032835         PV-ODD-UNITS                                             03283515
032836     END-DIVIDE.                                                  03283615
032837                                                                  03283711
032838     MOVE PC086-OPER-UNT-ID       TO PV-DISP-OPER.                03283813
032839     MOVE PC086-ORD-NBR           TO PV-DISP-PO.                  03283913
032840     MOVE PC086-RCVR-SEQ-NBR      TO PV-DISP-RCVR.                03284013
032841     MOVE PC086-ORD-LNE-NBR       TO PV-DISP-LINE.                03284113
032842     MOVE PC086-PREPK-ID          TO PV-DISP-PREPK.               03284213
032843     MOVE PV-WHOLE-PACKS          TO PV-DISP-WHOLE.               03284315
032844                                                                  03284415
032845*    DISPLAY 'DRVR:  '                                            03284521
032846*             PV-DISP-OPER '-'                                    03284621
032847*             PV-DISP-PO   '-'                                    03284721
032848*             PV-DISP-RCVR '-'                                    03284821
032849*             PV-DISP-LINE '  PREPK:'                             03284921
032850*             PV-DISP-PREPK  '   WHOLE:'                          03285021
032851*             PV-DISP-WHOLE.                                      03285121
032852                                                                  03285215
032860     PERFORM 8000-WRITE-EXTRACT-REC.                              03286006
032900                                                                  03290006
033320     SET PS-EOF-CSR-NO  TO TRUE.                                  03332008
033330                                                                  03333006
033400     PERFORM 4000-OPEN-PREPK-CSR.                                 03340006
033401     PERFORM 4010-FETCH-PREPK-CSR.                                03340114
033410     PERFORM 3010-PROCESS-CSR                                     03341006
033420       UNTIL PS-EOF-CSR                                           03342006
033430          OR PS-ERROR.                                            03343006
033500     PERFORM 4020-CLOSE-PREPK-CSR.                                03350006
033600                                                                  03360006
033610                                                                  03361006
033611*-----------------------------------------------------------------03361106
033612*                                                                 03361206
033613*-----------------------------------------------------------------03361306
033614 3010-PROCESS-CSR.                                                03361406
033615                                                                  03361506
033616     MOVE RECITM-ORD-LNE-NBR     TO PC086-ORD-LNE-NBR             03361608
033617     MOVE RECITM-PREPK-ID        TO PC086-PREPK-ID                03361708
033618     MULTIPLY PV-WHOLE-PACKS                                      03361817
033619           BY RECITM-PREPK-RATO-QTY                               03361908
033620       GIVING PC086-PICKED-QTY.                                   03362006
033621     MOVE 'P'                 TO PC086-PREPK-LNE-PRC-CDE.         03362115
033622                                                                  03362206
033623     MOVE PC086-OPER-UNT-ID       TO PV-DISP-OPER.                03362313
033624     MOVE PC086-ORD-NBR           TO PV-DISP-PO.                  03362413
033625     MOVE PC086-RCVR-SEQ-NBR      TO PV-DISP-RCVR.                03362513
033626     MOVE PC086-ORD-LNE-NBR       TO PV-DISP-LINE.                03362613
033627     MOVE PC086-PREPK-ID          TO PV-DISP-PREPK.               03362713
033628                                                                  03362813
033632     DISPLAY 'COMP:  '                                            03363213
033633              PV-DISP-OPER '-'                                    03363313
033634              PV-DISP-PO   '-'                                    03363413
033635              PV-DISP-RCVR '-'                                    03363513
033636              PV-DISP-LINE '  PREPK-'                             03363613
033637              PV-DISP-PREPK                                       03363713
033638                                                                  03363813
033639     ADD  1  TO  PV-COMPONENT-COUNT.                              03363913
033640     PERFORM 8000-WRITE-EXTRACT-REC                               03364013
033641                                                                  03364113
033642     PERFORM 4010-FETCH-PREPK-CSR.                                03364213
033643                                                                  03364313
033644                                                                  03364413
033645*-----------------------------------------------------------------03364513
033646*                                                                 03364613
033650*-----------------------------------------------------------------03365006
033700 4000-OPEN-PREPK-CSR.                                             03370006
033800                                                                  03380006
033917     EXEC SQL                                                     03391706
033918         OPEN PRE-PACK-LNE-CSR                                    03391809
033919     END-EXEC.                                                    03391906
033920                                                                  03392006
033921     EVALUATE TRUE                                                03392106
033922         WHEN SQLCODE = ZERO                                      03392206
033923              CONTINUE                                            03392309
033924                                                                  03392409
033925         WHEN SQLWARN0 NOT = SPACES                               03392506
033926         WHEN SQLCODE NOT EQUAL ZERO                              03392606
033927             MOVE DK-OPER-UNT-ID TO  PV-DISP-OPER                 03392708
033928             MOVE PC086-ORD-NBR      TO PV-DISP-PO                03392808
033929             MOVE PC086-RCVR-SEQ-NBR TO PV-DISP-RCVR              03392908
033930             MOVE PC086-ORD-LNE-NBR  TO PV-DISP-LINE              03393008
033931             SET PS-ERROR TO  TRUE                                03393108
033932             DISPLAY ' RCVR: '                                    03393206
033933                     PV-DISP-OPER '-'                             03393306
033934                     PV-DISP-PO   '-'                             03393406
033935                     PV-DISP-RCVR '-'                             03393506
033936                     PV-DISP-LINE ' '                             03393606
033937             MOVE '4000-OPEN-PREPK-CSR '                          03393706
033938                                       TO PV-ABEND-PARAGRAPH      03393806
033939             MOVE 'OPEN PREPK CSR    ' TO PV-ABEND-OPERATION      03393906
033940             MOVE 'TRECITM '           TO PV-ABEND-STRUCTURE-1    03394006
033941             MOVE 'TPURITM '           TO PV-ABEND-STRUCTURE-2    03394106
033942             PERFORM 9900-DB2-ABEND                               03394206
033963     END-EVALUATE.                                                03396306
033964                                                                  03396406
033965                                                                  03396506
033966*-----------------------------------------------------------------03396606
033967*                                                                 03396706
033968*-----------------------------------------------------------------03396806
033969 4010-FETCH-PREPK-CSR.                                            03396906
033970                                                                  03397006
033971     EXEC SQL                                                     03397106
033972         FETCH PRE-PACK-LNE-CSR                                   03397209
033973         INTO                                                     03397308
033974             :RECITM-ORD-LNE-NBR                                  03397406
033975         ,   :RECITM-PREPK-ID                                     03397508
033976         ,   :RECITM-PREPK-RATO-QTY                               03397608
033977     END-EXEC.                                                    03397706
033978                                                                  03397806
033979                                                                  03397906
033980     EVALUATE TRUE                                                03398006
033981         WHEN SQLCODE = ZERO                                      03398106
033982              CONTINUE                                            03398206
033983                                                                  03398306
033984         WHEN SQLCODE = +100                                      03398406
033985             SET PS-EOF-CSR           TO  TRUE                    03398508
033986                                                                  03398606
033987         WHEN SQLWARN0 NOT = SPACES                               03398706
033988         WHEN SQLCODE NOT EQUAL ZERO                              03398806
033989             MOVE DK-OPER-UNT-ID TO  PV-DISP-OPER                 03398908
033990             MOVE PC086-ORD-NBR      TO PV-DISP-PO                03399008
033991             MOVE PC086-RCVR-SEQ-NBR TO PV-DISP-RCVR              03399108
033992             MOVE PC086-ORD-LNE-NBR  TO PV-DISP-LINE              03399208
033993             SET PS-ERROR TO  TRUE                                03399308
033994             DISPLAY ' RCVR: '                                    03399406
033995                     PV-DISP-OPER '-'                             03399506
033996                     PV-DISP-PO   '-'                             03399606
033997                     PV-DISP-RCVR '-'                             03399706
033998                     PV-DISP-LINE ' '                             03399806
033999             MOVE '4010-FETCH-PREPK-CSR'                          03399906
034000                                       TO PV-ABEND-PARAGRAPH      03400006
034001             MOVE 'OPEN PREPK CSR    ' TO PV-ABEND-OPERATION      03400106
034002             MOVE 'TRECITM '           TO PV-ABEND-STRUCTURE-1    03400206
034003             MOVE 'TPURITM '           TO PV-ABEND-STRUCTURE-2    03400306
034004             PERFORM 9900-DB2-ABEND                               03400406
034005     END-EVALUATE.                                                03400506
034016                                                                  03401606
034017                                                                  03401706
034018*-----------------------------------------------------------------03401806
034019*                                                                 03401906
034020*-----------------------------------------------------------------03402006
034021 4020-CLOSE-PREPK-CSR.                                            03402106
034022                                                                  03402206
034023     EXEC SQL                                                     03402306
034024         CLOSE PRE-PACK-LNE-CSR                                   03402409
034025     END-EXEC.                                                    03402506
034026                                                                  03402606
034027     EVALUATE TRUE                                                03402706
034028         WHEN SQLCODE = ZERO                                      03402806
034029              CONTINUE                                            03402906
034030         WHEN SQLWARN0 NOT = SPACES                               03403006
034031         WHEN SQLCODE NOT EQUAL ZERO                              03403106
034032             MOVE DK-OPER-UNT-ID TO PV-DISP-OPER                  03403208
034033             MOVE PC086-ORD-NBR      TO  PV-DISP-PO               03403308
034034             MOVE PC086-RCVR-SEQ-NBR TO  PV-DISP-RCVR             03403408
034035             MOVE PC086-ORD-LNE-NBR  TO  PV-DISP-LINE             03403508
034036             SET PS-ERROR TO TRUE                                 03403608
034037             DISPLAY ' RCVR: '                                    03403706
034038                     PV-DISP-OPER '-'                             03403806
034039                     PV-DISP-PO   '-'                             03403906
034040                     PV-DISP-RCVR '-'                             03404006
034041                     PV-DISP-LINE ' '                             03404106
034042             MOVE '4020-CLOSE-PREPK-CSR'                          03404206
034043                                       TO PV-ABEND-PARAGRAPH      03404306
034044             MOVE 'CLOSE PREPK CSR   ' TO PV-ABEND-OPERATION      03404406
034045             MOVE 'TRECITM '           TO PV-ABEND-STRUCTURE-1    03404506
034046             MOVE 'TPURITM '           TO PV-ABEND-STRUCTURE-2    03404606
034047             PERFORM 9900-DB2-ABEND                               03404706
034048     END-EVALUATE.                                                03404806
034058                                                                  03405806
034059*----------------------------------------------------------------*03405905
034060* GET DRIVER LINE RATIO                                           03406006
034100*----------------------------------------------------------------*03410005
034200 5000-GET-DRIVER-RATIO.                                           03420006
034300                                                                  03430006
034400     EXEC SQL                                                     03440006
034500         SELECT PREPK_ID                                          03450006
034600              , PREPK_RATO_QTY                                    03460008
034700           INTO :RECITM-PREPK-ID                                  03470008
034800              , :RECITM-PREPK-RATO-QTY                            03480008
034810           FROM TRECITM                                           03481006
034900          WHERE ORD_NBR      =  :DK-PO-NBR                        03490006
035000            AND REC_SEQ_NBR  =  :DK-RCVR-SEQ-NBR                  03500008
035100            AND ORD_LNE_NBR  =  :DK-PO-LINE-NBR                   03510008
036000           WITH UR                                                03600006
036100     END-EXEC.                                                    03610006
036200                                                                  03620006
036300     EVALUATE TRUE                                                03630006
036400         WHEN SQLCODE = +0                                        03640006
036500              CONTINUE                                            03650006
037000                                                                  03700006
037010         WHEN SQLWARN0 NOT = SPACES                               03701006
037020         WHEN SQLCODE NOT EQUAL ZERO                              03702006
037030             MOVE DK-OPER-UNT-ID TO PV-DISP-OPER                  03703008
037040             MOVE PC086-ORD-NBR      TO  PV-DISP-PO               03704008
037050             MOVE PC086-RCVR-SEQ-NBR TO  PV-DISP-RCVR             03705008
037060             MOVE PC086-ORD-LNE-NBR  TO  PV-DISP-LINE             03706008
037070             SET PS-ERROR TO  TRUE                                03707008
037080             DISPLAY ' RCVR: '                                    03708006
037090                     PV-DISP-OPER '-'                             03709006
037091                     PV-DISP-PO   '-'                             03709106
037092                     PV-DISP-RCVR '-'                             03709206
037093                     PV-DISP-LINE ' '                             03709306
037094             MOVE '5000-GET-DRIVER-RATIO'                         03709406
037095                                       TO PV-ABEND-PARAGRAPH      03709506
037096             MOVE 'DRIVER LINE RATIO ' TO PV-ABEND-OPERATION      03709606
037097             MOVE 'TRECITM '           TO PV-ABEND-STRUCTURE-1    03709706
037098             PERFORM 9900-DB2-ABEND                               03709806
037099     END-EVALUATE.                                                03709906
037900                                                                  03790006
038000                                                                  03800006
070300*-----------------------------------------------------------------07030005
070400*                                                                 07040005
070500*-----------------------------------------------------------------07050005
070600 7000-READ-INPUT.                                                 07060005
070700                                                                  07070005
070800     READ PICKMADE-EXTRACT-IN INTO                                07080008
070900           PC086-EXPORT-RECORD-LAYOUT                             07090005
071000           AT END                                                 07100005
071100              SET  PS-EOF  TO TRUE                                07110009
071200           NOT AT END                                             07120005
071300              ADD 1 TO PV-EVENT-INPUT-COUNT.                      07130008
071400                                                                  07140005
071500                                                                  07150005
071600*-----------------------------------------------------------------07160005
071700*                                                                 07170005
071800*-----------------------------------------------------------------07180005
071900 8000-WRITE-EXTRACT-REC.                                          07190005
072000                                                                  07200005
072100     ADD 1 TO PV-EVENT-OUTPUT-COUNT.                              07210009
072200     WRITE PICKMADE-RECORD-OUT  FROM                              07220005
072300           PC086-EXPORT-RECORD-LAYOUT.                            07230005
072400                                                                  07240005
072500                                                                  07250005
072600*-----------------------------------------------------------------07260005
072700*                                                                 07270005
072800*-----------------------------------------------------------------07280005
072900 9000-TERMINATE.                                                  07290005
073000                                                                  07300005
073100     CLOSE PICKMADE-EXTRACT-IN.                                   07310005
073200     CLOSE PICKMADE-EXTRACT-OUT.                                  07320005
073300                                                                  07330005
073400     IF  PV-EVENT-OUTPUT-COUNT = 0                                07340005
073500         MOVE 1 TO  RETURN-CODE                                   07350008
073600     END-IF.                                                      07360005
073700                                                                  07370005
073800     DISPLAY SPACES                                               07380005
073900                                                                  07390005
074000     MOVE PV-EVENT-INPUT-COUNT         TO PV-DISP-COUNT.          07400005
074100     DISPLAY 'TOTAL INPUT COUNT              = ' PV-DISP-COUNT.   07410005
074200                                                                  07420005
074210     DISPLAY SPACES                                               07421005
074211                                                                  07421105
074220     MOVE PV-BULK-COUNT                TO PV-DISP-COUNT.          07422005
074230     DISPLAY 'TOTAL BULK COUNT               = ' PV-DISP-COUNT.   07423005
074240                                                                  07424005
074250     DISPLAY SPACES                                               07425005
074260     MOVE PV-PREPK-COUNT               TO PV-DISP-COUNT.          07426005
074270     DISPLAY 'TOTAL PREPK COUNT              = ' PV-DISP-COUNT.   07427005
074280                                                                  07428005
074290     DISPLAY SPACES                                               07429005
074291     MOVE PV-COMPONENT-COUNT           TO PV-DISP-COUNT.          07429105
074292     DISPLAY 'TOTAL COMPONENT COUNT          = ' PV-DISP-COUNT.   07429205
074293                                                                  07429305
074294     DISPLAY SPACES                                               07429405
074295                                                                  07429505
074600     MOVE PV-EVENT-OUTPUT-COUNT        TO PV-DISP-COUNT.          07460005
074700     DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN  = ' PV-DISP-COUNT.   07470005
074800                                                                  07480005
074900     DISPLAY SPACES                                               07490005
075000     DISPLAY '************************'.                          07500005
075100                                                                  07510005
075200                                                                  07520005
075300*-----------------------------------------------------------------07530005
075400*                                                                 07540005
075500*-----------------------------------------------------------------07550005
075600 9900-DB2-ABEND.                                                  07560005
075700                                                                  07570005
075800     MOVE SQLCODE TO  PV-SQLCODE.                                 07580008
075900     DISPLAY '*** DB2 ERROR '.                                    07590005
076000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       07600005
076100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 07610005
076200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07620005
076300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07630005
076400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       07640005
076500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       07650005
076600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       07660005
076700     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07670005
076800                                                                  07680005
076900                                                                  07690005
077000     COPY DPPD004.                                                07700005
077100                                                                  07710005
077200     MOVE +4013                  TO PV-ABEND-CODE.                07720008
077300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07730005
077400                                                                  07740005
