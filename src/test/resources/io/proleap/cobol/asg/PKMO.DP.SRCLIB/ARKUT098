000100*##############################################################   00010001
000200*    ARKUT098 - FINANCIAL TRANSACTION REPORT                      00020009
000300*##############################################################   00030001
000400 IDENTIFICATION DIVISION.                                         00040001
000500 PROGRAM-ID.     ARKUT098.                                        00050009
000600 AUTHOR.         J Zimbal.                                        00060012
000700 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00070012
000800 DATE-WRITTEN    01-07-12.                                        00080012
000900 DATE-COMPILED.                                                   00090001
001000/                                                                 00100001
001100 ENVIRONMENT DIVISION.                                            00110001
001200******************************************************************00120001
001300**DESC: FTD File From First Data Report by element ID.            00130001
001300**This will take the multiple occurences of the FTD file and      00130001
001300**write out a record for every element occurence.                 00130001
001500******************************************************************00150001
001600 CONFIGURATION SECTION.                                           00160011
001700                                                                  00170011
001800 SOURCE-COMPUTER.        IBM-3090.                                00180011
001900 OBJECT-COMPUTER.        IBM-3090.                                00190011
002000                                                                  00200011
002100 INPUT-OUTPUT SECTION.                                            00210011
002200                                                                  00220011
002300 FILE-CONTROL.                                                    00230011
002400                                                                  00240011
002500     SELECT FTD-FILE             ASSIGN TO INP01.                 00250011
002500     SELECT ELEM-FILE            ASSIGN TO INP02.                 00250011
002600     SELECT FTD-FILE-RFMT        ASSIGN TO OUT01.                 00260011
002700                                                                  00270011
002800******************************************************************00280011
002900 DATA DIVISION.                                                   00290011
003000******************************************************************00300011
003100                                                                  00310011
003200 FILE SECTION.                                                    00320011
00050  FD  FTD-FILE                                                        CL**2
00051      RECORDING MODE IS V                                             CL**2
00052      LABEL RECORDS ARE STANDARD                                      CL**2
00053      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00056                                                                      CL**2
00057  01  FTD-RECORD                  PIC X(21145).                       CL**2
004000                                                                  00400011
004100                                                                  00410011
00050  FD  ELEM-FILE                                                       CL**2
00051      RECORDING MODE IS F                                             CL**2
00052      LABEL RECORDS ARE STANDARD                                      CL**2
00053      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00056                                                                      CL**2
00057  01  ELEM-RECORD.                                                    CL**2
019400     10 IN-ELEM-CDE                 PIC X(4).                             
019400     10 FILLER                      PIC X(1).                             
019600     10 IN-ELEM-DESC                PIC X(75).                            
004000                                                                  00400011
004100                                                                  00410011
004200 FD  FTD-FILE-RFMT                                                00420011
004300     RECORDING MODE IS F                                          00430011
004400     BLOCK CONTAINS 0 RECORDS                                     00440011
004500     LABEL RECORDS ARE STANDARD.                                  00450011
004600                                                                  00460011
004700 01  FTD-FILE-RFMT-RECORD        PIC X(132).                      00470011
004800                                                                  00480011
004900*                                                                 00490011
005000******************************************************************00500001
005100 WORKING-STORAGE              SECTION.                            00510001
005200******************************************************************00520001
005300*                     LOCAL WORKING STORAGE                       00530001
005400*                     ---------------------                       00540001
005500******************************************************************00550001
005600 01  WS-LOCAL-DATA.                                               00560004
005700     05 WS-DATA                       PIC X.                      00570016
           05 WS-ELE-IDX                    PIC 9(4).                           
           05 WS-ELEDSC-IDX                 PIC 9(4).                           
005800     05 WS-PGM-NAME                   PIC X(08)  VALUE "ARKUT098".00580016
005900     05 WS-ERRORS                     PIC 9(10).                  00590016
006000     05 WS-RESULTS                    PIC S9(04) COMP.            00600016
016810     05 PV-ELEM-TABLE-MAX             PIC S9(4)  VALUE +600               
016820                                                 COMP.                    
                                                                        00900001
009100 01  WS-LOCAL-CONSTANTS.                                          00910004
009400     05 WS-FTD-EOF                 PIC X     VALUE "N".           00940016
009500        88 FTD-EOF                           VALUE "Y".           00950016
009400     05 WS-ELEM-EOF                PIC X     VALUE "N".           00940016
009500        88 ELEM-EOF                          VALUE "Y".           00950016
009400     05 WS-ELEM-LEFT               PIC X     VALUE "N".           00940016
009400        88 ELEM-LEFT                         VALUE "N".           00940016
009500        88 NO-ELEM-LEFT                      VALUE "Y".           00950016
010200*                                                                 01020009
019200    01 PV-ELEM-TABLE.                                                     
019200     05 PV-ELEM-TABLE-ENTRY            OCCURS 600 TIMES                   
019300                                      INDEXED BY PV-ELEM-IDX.             
019400       10 PV-ELEM-CDE                 PIC X(4)   VALUE SPACES.            
019400       10 FILLER                      PIC X(1)   VALUE SPACES.            
019600       10 PV-ELEM-DESC                PIC X(75)  VALUE SPACES.            
019700                                                                          
010400*** FTD FILE LAYOUT - 184 BYTES.                                  01040009
010500     COPY ARRD077.                                                01050009
010600                                                                  01060009
010700*** STANDARD HEADER LINE - 132 BYTES.                             01070009
010800     COPY DPWS132O.                                               01080009
010900                                                                  01090009
011000/***********************************************************      01100002
011100 01  WS-OUTPUT-FILE.                                              01110011
015200     05 WS-FTD-FILE-RFMT.                                         01500011
017300        10 WD-RPT-ACTION               PIC X(1).                  01710004
035800        10 WD-RPT-SYSTEM               PIC X(4).                  03330012
035900        10 WD-RPT-PRIN                 PIC X(4).                  03340012
036000        10 WD-RPT-AGENT                PIC X(4).                  03350012
017300        10 WD-ACCOUNT-ID               PIC X(16).                 01710004
017300        10 WD-ELEMENT-ID               PIC 9(04).                 01710004
017500        10 WD-RPT-ELEM-DESC            PIC X(75).                 01730004
018100        10 WD-ELEMENT-AMT          PIC ZZZZZ,ZZZ,ZZZ,ZZZ.99-.     01790012
018200                                                                  01810003
025400 PROCEDURE DIVISION.                                              02460004
069500*-----------------------------*                                           
025500 0000-MAIN SECTION.                                               02470009
069500*-----------------------------*                                           
025600                                                                  02480003
025700     PERFORM 1000-INITIALIZE.                                     02490005
025900                                                                  02510003
026000     PERFORM 3500-PROCESS-ELEM-RECORDS                            02520006
026100       UNTIL FTD-EOF.                                             02530006
025900                                                                  02510003
026700     PERFORM 9999-CLOSE                                           02550011
026800                                                                  02560003
026900     GOBACK.                                                      02570006
027000                                                                  02580003
069500*-----------------------------*                                           
027100 1000-INITIALIZE.                                                 02590005
069500*-----------------------------*                                           
027200                                                                  02600003
027300     OPEN INPUT  FTD-FILE                                         02610012
027300                 ELEM-FILE                                        02610012
027400          OUTPUT FTD-FILE-RFMT.                                   02620011
027500                                                                  02630006
                                                                                
027600     PERFORM 2000-READ-FTD-FILE.                                  02640008
           PERFORM 2500-READ-ELEM-FILE                                          
027900                                                                          
069600     PERFORM 3000-LOAD-ELEM-TABLE.                                        
027900                                                                          
069500*-----------------------------*                                           
028000 2000-READ-FTD-FILE.                                              02660008
069500*-----------------------------*                                           
028100                                                                  02670008
028200     READ FTD-FILE                                                02680013
028300     INTO AR077-FTD-RECORD                                        02690006
028400       AT END                                                     02700006
028500          SET FTD-EOF TO TRUE.                                    02710006
028600                                                                  02720006
069500*-----------------------------*                                           
028000 2500-READ-ELEM-FILE.                                             02660008
069500*-----------------------------*                                           
028100                                                                  02670008
028200     READ ELEM-FILE                                               02680013
028400       AT END                                                     02700006
028500          SET ELEM-EOF TO TRUE.                                   02710006
004000                                                                  00400011
004000                                                                  00400011
069500*-----------------------------*                                           
028700 3500-PROCESS-ELEM-RECORDS.                                       02730006
069500*-----------------------------*                                           
           MOVE 1                 TO WS-ELE-IDX.                                
                                                                                
028900     IF (AR077-TOTL-ELEM-CT NUMERIC) AND                          02750010
028900        (AR077-TOTL-ELEM-CT > 0)                                  02750010
029600           PERFORM 4000-WRITE-OUTPUT UNTIL                        02830010
                         WS-ELE-IDX > AR077-TOTL-ELEM-CT                        
029700           PERFORM 2000-READ-FTD-FILE                             02840010
           ELSE                                                                 
029700           PERFORM 2000-READ-FTD-FILE                             02840010
029900     END-IF.                                                      02860010
030000*                                                                 02870010
034600******************************************************************03210010
034700 4000-WRITE-OUTPUT.                                               03220010
034800                                                                  03230010
017300     MOVE AR077-ACTION-CD             TO WD-RPT-ACTION.           01710004
035800     MOVE AR077-SYSTEM-ID             TO WD-RPT-SYSTEM.           03330012
035900     MOVE AR077-PRIN-ID               TO WD-RPT-PRIN.             03340012
036000     MOVE AR077-AGENT-ID              TO WD-RPT-AGENT.            03350012
036000     MOVE AR077-ACCT-ID               TO WD-ACCOUNT-ID.           03350012
036100                                                                  03360010
036200     MOVE AR077-ELEMENT-ID(WS-ELE-IDX)                                    
                                            TO WD-ELEMENT-ID.                   
                                                                                
           MOVE 0                           TO WD-ELEMENT-AMT.          03430012
036600                                                                  03410010
036700     IF (AR077-ELEMENT-AMT(WS-ELE-IDX) NUMERIC) AND               03420012
036700        (AR077-ELEMENT-AMT(WS-ELE-IDX) > 0)                       03420012
036700        MOVE AR077-ELEMENT-AMT(WS-ELE-IDX)                        03420012
                                            TO WD-ELEMENT-AMT           03430012
037300     END-IF.                                                      03480010
037400                                                                  03490010
036700     IF (AR077-ELEMENT-AMT(WS-ELE-IDX) NUMERIC) AND               03420012
036700        (AR077-ELEMENT-AMT(WS-ELE-IDX) < 0)                       03420012
036700        MOVE AR077-ELEMENT-AMT(WS-ELE-IDX)                        03420012
                                            TO WD-ELEMENT-AMT           03430012
037300     END-IF.                                                      03480010
037400                                                                  03490010
071600     PERFORM  4100-SEARCH-FOR-ELEM-DESC.                                  
037400                                                                  03490010
037700     WRITE FTD-FILE-RFMT-RECORD FROM WS-FTD-FILE-RFMT.            03520012
           ADD +1            TO WS-ELE-IDX.                                     
040000                                                                  03750010
048000/*****************************************************************04550007
057700                                                                  05520003
069500*-----------------------------*                                           
069600 3000-LOAD-ELEM-TABLE.                                                    
069700*-----------------------------*                                           
070100                                                                          
           INITIALIZE PV-ELEM-TABLE.                                            
                                                                                
           PERFORM                                                              
                   VARYING PV-ELEM-IDX                                          
                   FROM 1 BY 1                                                  
                   UNTIL (PV-ELEM-IDX >= PV-ELEM-TABLE-MAX)                     
                           OR (ELEM-EOF)                                        
              MOVE IN-ELEM-CDE           TO PV-ELEM-CDE(PV-ELEM-IDX)    02720006
              MOVE IN-ELEM-DESC          TO PV-ELEM-DESC(PV-ELEM-IDX)   02720006
               PERFORM 2500-READ-ELEM-FILE                                      
           END-PERFORM.                                                         
                                                                                
071500*-----------------------------*                                           
071600 4100-SEARCH-FOR-ELEM-DESC.                                               
071700*-----------------------------*                                           
            SET PV-ELEM-IDX        TO 1.                                        
                                                                                
            SEARCH PV-ELEM-TABLE-ENTRY                                          
                AT END                                                          
072100           DISPLAY 'ELEM CDE/ELEM RSN NOT FOUND.'                         
072200           DISPLAY 'ELEM CDE: ' WD-ELEMENT-ID                             
036300            MOVE "*** Element needs to be added to table"                 
                              TO WD-RPT-ELEM-DESC                               
072700         WHEN WD-ELEMENT-ID = PV-ELEM-CDE (PV-ELEM-IDX)                   
036300            MOVE PV-ELEM-DESC(PV-ELEM-IDX)  TO WD-RPT-ELEM-DESC   03380010
                  CONTINUE                                                      
            END-SEARCH.                                                         
                                                                                
071500*-----------------------------*                                           
060600 9999-CLOSE.                                                      05810011
071500*-----------------------------*                                           
060700                                                                  05820011
060800     CLOSE FTD-FILE                                               05830011
070000           ELEM-FILE                                                      
060900           FTD-FILE-RFMT.                                         05840011
                                                                                
