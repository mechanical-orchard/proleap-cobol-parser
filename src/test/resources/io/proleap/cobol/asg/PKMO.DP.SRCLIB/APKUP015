000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    APKUP015.                                         00040001
000500 AUTHOR.        L SCHALLHORN.                                     00050001
000600 DATE-WRITTEN.  11/17/98.                                         00060001
000700                                                                  00070001
000710***************************************************************** 00071017
000720* COBOL II WITH SQL                                             * 00072017
000800*---------------------------------------------------------------* 00080001
001000* THE PURPOSE OF THIS PROGRAM IS TO SELECT INVOICES WHERE       * 00100037
001100* THE PO OR PO/MATCH LEVEL CODE COMBINATION  WAS PAY-RELEASED   * 00110037
001200* AND THEN THE STATUS ON THE INVOICE WAS ACCIDENTLY RESET FROM  * 00120037
001300* FROM 'RL' TO 'EN'.  THESE INVOICES WILL BE OUTPUT TO A FILE   * 00130037
001400* WHICH WILL BE PROCESSED BY APKUP300 TO REET THE RECEIPTS      * 00140037
001500* FROM 'MATCHED' TO 'UNMATCHED'.  IT WILL ALSO CREATE A FILE    * 00150037
001600* CONTAINING THE INFORMATION ON THESE INVOICES TO BE SENT TO    * 00160037
001600* ACCOUNTS PAYABLE AND SRE.                                     * 00170037
001900*---------------------------------------------------------------* 00190001
002100* INPUT:                                                        * 00210017
002300*  1. INVOICE TABLE                    (TINVOIC)                * 00230012
002300*  2. RELEASED PO/STORES               (TPOSTRR)                * 00240051
002300*  3. PURCHASE ORDER HEADER            (TPURCHS)                * 00250051
002300*  4. ENTERPRISE NAME                  (TENTNME)                * 00251051
002600*---------------------------------------------------------------* 00260001
002700* CHANGES:                                                      * 00270017
002800*                                                               * 00280001
002900*   MM/DD/YY   WHO  WHY                                         * 00290001
003000*   12/08/98   LAS  PITS # 254767 PROGRAM IS EXPECTING TPOSTRR  * 00300007
003100*                   TABLE TO HAVE A ROW THE PO/STORE IN 'EN'    * 00310007
003200*                   STATUS.  IF THE USERS HAVE NOT RE-PAY       * 00320007
003300*                   RELEASED THE CORRECTED PO/STORE  A ROW WILL * 00330007
003400*                   NOT BE FOUND.  THIS IS OK.                  * 00340007
003500*                                                               * 00350001
003600*   11/14/2000 MAB  IR # 1240 TO CHANGE REFERENCES OF ABEND     * 00360009
003700*                   CODE 4021 TO 4050.  THIS IS TO CONFORM TO   * 00370009
003800*                   ESP ABEND CODE STANDARDS.                   * 00380009
003900*                                                               * 00390009
004000*   04/11/2002 KPC  PITS #461298 ADDED ADDITIONAL STATUS_CDE OF * 00400010
004100*                   'DE' TO WHERE CLAUSE IN CURSOR.  CURSOR     * 00410009
004200*                   WILL NOW RETRIEVE INVOICES WITH A STATUS    * 00420010
004210*                   OF 'DELETED'.                               * 00421010
004300*                                                               * 00430009
004310*   06/17/2002                                                  * 00431011
004320*      ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.      * 00432011
004330*   MADE BY: KEVIN CATLIN                WR#: 23500             * 00433011
004340*                                                               * 00434011
004350*   06/18/2002                                                  * 00435013
004360*      REMOVED TABLE TPAYREQ. REPLACED ALL COLUMN REFERENCES    * 00436013
004361*      WITH TINVOIC REPLACEMENT.                                * 00436113
004370*   MADE BY: NANCY EILBES                WR#: 23500             * 00437013
004380*                                                               * 00438013
004390*   03/11/2007                                                  * 00439026
004391*      MATCH BY DC -- ALTERED THE INVOICE_CSR SELECT STATEMENT  * 00439114
004392*      TO INCLUDE THE DC_NBR AND MTCH_LVL_CDE FIELDS AND        * 00439214
004393*      CHANGED THE FETCH STATEMENT ACCORDINGLY.  IN PARAGRAPH   * 00439314
004394*      B200-PROCESS-CURSOR, ADDED DISPLAY STATEMENTS FOR THE    * 00439424
004395*      DC-NBR AND MTCH-LVL-CDE FIELDS.  CHANGED THE LOGIC IN    * 00439514
004396*      PARAGRAPH U400-UPDATE-TPOSTRR TO BE DRIVEN BY            * 00439614
004397*      MTCH-LVL-CDE.                                            * 00439714
004398*   MADE BY: KRYSTEN LEARY               WR#: 21578             * 00439814
004380*                                                               * 00439947
004390*   02/01/2021                                                  * 00440046
004391*      ADD 2 OUTPUT FILES TO AUTOMATICALLY UPDATE THE PAY-      * 00440127
004392*      RELEASED INVOICES THAT ARE IN THE INCORRECT STATUS.      * 00441027
004393*      ONE FILE WILL BE FED INTO APKUP300 TO UPDATE THE INVOICES* 00442027
004394*      AND THE 2ND WILL BE USED TO EMAIL THE DETAILS.  REMOVE   * 00443046
004394*      THE UPDATE OF THE TPOSTRR TABLE.                         * 00444046
004398*   MADE BY: JEAN KURK                   CHG0252998             * 00447046
004380*                                                               * 00448047
004390*   05/11/2021                                                  * 00449052
004391*      INCLUDE STATUS 'PJ' ON INVOICE_CSR, TO INCLUDE SEPHORA   * 00449147
004392*      AT KOHLS TRANSACTIONS. ADD ENT-ID TO OUTPUT RECORD       * 00449248
004398*   MADE BY: JEAN KURK                   CHG0256545             * 00449652
004380*                                                               * 00449753
004390*   11/05/2021                                                  * 00449853
004391*      CHG LOGIC TO POPULATE AP091-LOCN-NBR IF MATCH LVL IS P   * 00449953
004322*      THEN 0, IF S THEN INVOIC-STR-NBR, IF D THEN INVOIC-DC-NBR* 00450053
004398*   MADE BY: JEAN KURK                   CHG0263626             * 00450153
004400***************************************************************** 00451017
004600                                                                  00460001
004700 ENVIRONMENT DIVISION.                                            00470001
004800 CONFIGURATION SECTION.                                           00480001
004900 SOURCE-COMPUTER. IBM-3090.                                       00490001
005000 OBJECT-COMPUTER. IBM-3090.                                       00500001
005100                                                                  00510001
005300 INPUT-OUTPUT SECTION.                                            00530001
005300 FILE-CONTROL.                                                    00531027
005300                                                                  00532027
005300     SELECT  OUT-INV-UPD-FILE             ASSIGN TO OUT01.        00533027
005300     SELECT  OUT-EMAIL-FILE               ASSIGN TO OUT02.        00534032
005400 DATA DIVISION.                                                   00540001
005400 FILE SECTION.                                                    00541027
005400                                                                  00542027
005400 FD  OUT-INV-UPD-FILE                                             00543027
005400     RECORDING MODE IS F                                          00544027
005400     LABEL RECORDS ARE STANDARD                                   00545027
005400     BLOCK CONTAINS 0 RECORDS.                                    00546027
005400 01  OUT-UPDATE-RECORD               PIC  X(80).                  00547027
005400*                                                                 00548027
005400 FD  OUT-EMAIL-FILE                                               00549032
005400     RECORDING MODE IS F                                          00549127
005400     LABEL RECORDS ARE STANDARD                                   00549227
005400     BLOCK CONTAINS 0 RECORDS.                                    00549327
005400 01  OUT-EMAIL-RECORD                PIC  X(80).                  00549427
005400*                                                                 00549527
005500 WORKING-STORAGE SECTION.                                         00550001
005600                                                                  00560001
005700 01  PC-PROGRAM-CONSTANTS.                                        00570001
005800     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                00580001
005900         '**** WORKING STORAGE ** APKUP015 ****'.                 00590001
006000     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUP015'.    00600001
006100     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3             00610001
006200                                             COMP SYNC.           00620001
006300     05  PC-RETRY-COUNT          PIC S9(04)  VALUE ZEROS.         00630001
006400                                                                  00640001
006500 01  PV-PROGRAM-VARIABLES.                                        00650001
006600     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      00660001
006700     05  PV-INVOICE-COUNT        PIC 9(9)     VALUE ZEROS.        00670002
006700     05  PV-UPDATE-COUNT         PIC 9(9)     VALUE ZEROS.        00670129
006700     05  PV-IMPORT-IND           PIC X        VALUE SPACES.       00671029
006700     05  PV-EMAIL-MSG            PIC X(80)    VALUE SPACES.       00672030
006700     05  PV-DISPLAY-PO           PIC 9(9)     VALUE ZEROS.        00673032
006700     05  PV-DISPLAY-STORE        PIC 9(4)     VALUE ZEROS.        00674032
006700     05  PV-DISPLAY-DATE         PIC X(10)    VALUE SPACES.       00675031
006800*    05  TPOSTRR-UPDATE-COUNT    PIC 9(9)     VALUE ZEROS.        00680037
006900*    05  TPOSTRR-NOT-FOUND       PIC 9(9)     VALUE ZEROS.        00690037
007000                                                                  00700001
007100 01  PS-PROGRAM-SWITCHES.                                         00710001
007200     05  PS-END-INVOICES-SW       PIC X(01)  VALUE ' '.           00720021
007300         88  PS-END-INVOICES                 VALUE 'Y'.           00730001
007400         88  PS-MORE-INVOICES                VALUE ' '.           00740001
007500                                                                  00750001
008400*--------------------------------------------------------------*  00840016
008500* INVOICE TABLE                                                *  00850016
008600*--------------------------------------------------------------*  00860016
008700     EXEC SQL                                                     00870001
008800         INCLUDE TINVOIC                                          00880001
008900     END-EXEC.                                                    00890001
009000                                                                  00900016
009010*--------------------------------------------------------------*  00901016
009020* PO/STORE TABLE                                               *  00902016
009030*--------------------------------------------------------------*  00903016
009300*    EXEC SQL                                                     00930037
009400*        INCLUDE TPOSTRR                                          00940037
009500*    END-EXEC.                                                    00950037
009600                                                                  00960016
009010*--------------------------------------------------------------*  00960129
009020* PO TABLE                                               *        00960229
009030*--------------------------------------------------------------*  00960329
009300     EXEC SQL                                                     00960429
009400         INCLUDE TPURCHS                                          00960529
009500     END-EXEC.                                                    00960629
009600                                                                  00960729
009010*--------------------------------------------------------------*  00960843
009020* ENTITY NAME TABLE                                            *  00960943
009030*--------------------------------------------------------------*  00961043
009300     EXEC SQL                                                     00961143
009400         INCLUDE TENTNME                                          00961243
009500     END-EXEC.                                                    00961343
009600                                                                  00961443
009610*--------------------------------------------------------------*  00961516
009620* SQL COMMUNICATIONS AREA DCLGEN                               *  00962024
009630*--------------------------------------------------------------*  00963016
009900     EXEC SQL                                                     00990001
010000         INCLUDE SQLCA                                            01000001
010100     END-EXEC.                                                    01010001
010200                                                                  01020016
010600*--------------------------------------------------------------*  01060016
010700* INVOICE_CSR RETURNS ALL ROWS WHERE THE STATUS HAS BEEN RESET *  01070016
010800* FROM 'RL'.                                                   *  01080016
010900*--------------------------------------------------------------*  01090016
011000     EXEC SQL                                                     01100001
011100         DECLARE INVOICE_CSR CURSOR FOR                           01110020
011200          SELECT                                                  01120001
011300                 PO_NBR                                           01130012
011400                ,INVC_ID                                          01140012
011500                ,STR_NBR                                          01150012
011600                ,CRE_DTE                                          01160012
011700                ,STATUS_CDE                                       01170012
011800                ,PAYT_RLSE_TMST                                   01180012
011900                ,STATUS_CHG_TMST                                  01190012
011910                ,DC_NBR                                           01191014
011920                ,MTCH_LVL_CDE                                     01192014
012000          FROM   TINVOIC IV                                       01200012
012300*         WHERE  STATUS_CDE   IN ('EN', 'RC', 'OB', 'IB', 'DE')   01230047
012300          WHERE  STATUS_CDE   IN ('EN', 'RC', 'OB', 'IB',         01240047
012300                                  'DE', 'PJ')                     01241047
012500            AND  PAYT_RLSE_TMST ^= '9999-09-09-09.09.09.999999'   01250018
012600          ORDER BY 1,2,3                                          01260001
012700     END-EXEC.                                                    01270001
012800                                                                  01280016
012900*--------------------------------------------------------------*  01290016
013000*  ABEND DATA AREAS                                            *  01300016
013100*--------------------------------------------------------------*  01310016
013200 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01320001
013300                                             COMP SYNC.           01330001
013400     88  AC-DB2-ERROR                        VALUE +4013.         01340001
013500     88  AC-DATE-ERROR                       VALUE +4019.         01350001
013600     88  AC-ROWS-FOUND                       VALUE +4050.         01360008
013700                                                                  01370001
013900 01  ABEND-AREAS.                                                 01390001
014000     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01400001
014100             '*****       ABEND'.                                 01410001
014200     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01420001
014300             '*****   PROGRAM: APKUP015'.                         01430001
014400     05  AA-PARAGRAPH-LIT.                                        01440001
014500         10  FILLER              PIC  X(17)  VALUE                01450001
014600             '***** PARAGRAPH: '.                                 01460001
014700         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01470001
014800     05  AA-MESSAGE-LINE.                                         01480001
014900         10  FILLER              PIC  X(06)  VALUE '*****'.       01490001
015000         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01500001
015100     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01510001
015200             '*****    DB2 ERROR'.                                01520001
015300     05  AA-DB2-OPERATION-LIT.                                    01530001
015400         10  FILLER              PIC  X(17)  VALUE                01540001
015500             '***** OPERATION: '.                                 01550001
015600         10  AA-DB2-OPERATION.                                    01560001
015700             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01570001
015800             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01580001
015900     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01590001
016000     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01600001
016100     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01610001
016200                                                                  01620001
016400*--------------------------------------------------------------*  01640016
016500* SQLCA FORMATTED MESSAGE AREA                                 *  01650025
016600*--------------------------------------------------------------*  01660016
016700     COPY DPWS004.                                                01670001
016800                                                                  01680016
016400*--------------------------------------------------------------*  01690028
016500* UPDATE RECORD FOR INVALID PAY-RELEASE RECORDS           *       01691028
016600*--------------------------------------------------------------*  01692028
016700     COPY APRD091.                                                01693028
016800                                                                  01694028
017000 01  FILLER                      PIC  X(35)  VALUE                01700001
017100     '**** END OF W/S ** APKUP015 ****'.                          01710001
017200                                                                  01720016
017210*-----------------------------*                                   01721016
017300 PROCEDURE DIVISION.                                              01730001
017400*-----------------------------*                                   01740016
017500                                                                  01750016
018300     PERFORM B100-INITIALIZE.                                     01830001
018500     PERFORM B200-PROCESS-CURSOR                                  01850001
018600       UNTIL PS-END-INVOICES.                                     01860016
018800     PERFORM B300-END-OF-PROGRAM.                                 01880001
018810     GOBACK.                                                      01881016
018900                                                                  01890001
019100*--------------------------------------------------------------*  01910016
019200* INITIALIZATION PROCESSING                                    *  01920016
019300*--------------------------------------------------------------*  01930016
019400 B100-INITIALIZE.                                                 01940001
019500                                                                  01950001
019500     OPEN OUTPUT OUT-INV-UPD-FILE                                 01951027
019500                 OUT-EMAIL-FILE.                                  01951127
019500                                                                  01952027
019600     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              01960001
019800     INITIALIZE DCLTINVOIC.                                       01980037
020000*               DCLTPOSTRR.                                       02000037
020100                                                                  02010001
020200     INITIALIZE PS-PROGRAM-SWITCHES.                              02020001
020300*    INITIALIZE PV-INVOICE-COUNT, TPOSTRR-UPDATE-COUNT.           02030037
020300     INITIALIZE PV-INVOICE-COUNT.                                 02031037
020400                                                                  02040001
020500     PERFORM X100-OPEN-INVOICE-CSR.                               02050002
020600     PERFORM R100-FETCH-INVOICES.                                 02060002
020700                                                                  02070001
020900*--------------------------------------------------------------*  02090016
021000* CONTROLS THE PROCESSING OF THE INVOICE ROW                   *  02100016
021100*  - CREATES OUTPUT FILES FOR INVOICES TO BE RESET             *  02110037
021300*--------------------------------------------------------------*  02130016
021400 B200-PROCESS-CURSOR.                                             02140001
021500                                                                  02150001
021600     MOVE 'B200-PROCESS-CURSOR' TO PV-CURRENT-PARAGRAPH.          02160016
021800                                                                  02180001
021900*    PERFORM U400-UPDATE-TPOSTRR.                                 02190028
021900     PERFORM W100-WRITE-UPDATE-RECORD.                            02191028
021900     PERFORM W105-GET-VENDOR-NAME.                                02191143
021900     PERFORM W102-WRITE-EMAIL-RECORD.                             02191243
021800                                                                  02192030
022000*    DISPLAY 'PO NBR:     ' INVOIC-PO-NBR.                        02263030
022100*    DISPLAY '  INVC ID:         ' INVOIC-INVC-ID.                02264030
022200*    DISPLAY '  STR NBR:         ' INVOIC-STR-NBR.                02265030
022300*    DISPLAY '  ENTR DTE:        ' INVOIC-CRE-DTE.                02266030
022400*    DISPLAY '  STATUS CDE:      ' INVOIC-STATUS-CDE.             02267030
022500*    DISPLAY '  PAYT RLSE TMST:  ' INVOIC-PAYT-RLSE-TMST.         02268030
022600*    DISPLAY '  STATUS CHG TMST: ' INVOIC-STATUS-CHG-TMST.        02269030
022610*    DISPLAY '  DC NBR:          ' INVOIC-DC-NBR.                 02270030
022620*    DISPLAY '  MATCH LEVEL CD:  ' INVOIC-MTCH-LVL-CDE.           02271030
022620                                                                  02272030
022800     PERFORM R100-FETCH-INVOICES.                                 02280002
022900                                                                  02290001
023100*--------------------------------------------------------------*  02310016
023200* END OF PROGRAM PROCESSING                                    *  02320016
023300*--------------------------------------------------------------*  02330016
023400 B300-END-OF-PROGRAM.                                             02340001
023500                                                                  02350001
023600     DISPLAY 'NBR OF ROWS FOUND             = ' PV-INVOICE-COUNT. 02360002
023700     DISPLAY 'NBR OF PAY RELEASES TO REVERSE= ' PV-UPDATE-COUNT.  02370040
023700*    DISPLAY 'NBR OF TPOSTRR NOT FOUND      = ' TPOSTRR-NOT-FOUND.02371037
023800*    DISPLAY 'NBR OF TPOSTRR UPDATES        = '                   02380037
023900*                             TPOSTRR-UPDATE-COUNT.               02390037
023900                                                                  02390142
021800     STRING  'PLEASE REPROCESS THE '   DELIMITED BY SIZE          02391042
021800             'ABOVE PAY-RELEASE(S) '   DELIMITED BY SIZE          02392042
021800             'AT YOUR EARLIEST '       DELIMITED BY SIZE          02393042
021800             'CONVENIENCE.'            DELIMITED BY SIZE          02393142
021800                                       INTO PV-EMAIL-MSG.         02394042
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02395042
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02396042
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02397042
021800     STRING  'ANY QUESTIONS CAN BE '   DELIMITED BY SIZE          02398042
021800             'SENT TO IT-APTEAM.   '   DELIMITED BY SIZE          02399042
021800                                       INTO PV-EMAIL-MSG.         02399342
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02399442
024000                                                                  02400001
024100     PERFORM Y100-CLOSE-INVOICE-CSR.                              02410001
024000                                                                  02410127
019500     CLOSE OUT-INV-UPD-FILE                                       02411027
019500           OUT-EMAIL-FILE.                                        02412027
024200                                                                  02420001
024300     IF PV-INVOICE-COUNT = ZEROES                                 02430002
024400        DISPLAY 'NO INVALID PAY-RELEASED STATUSES FOUND'          02440005
024500     ELSE                                                         02450002
024600        MOVE 4050 TO RETURN-CODE                                  02460008
024700     END-IF.                                                      02470002
024800                                                                  02480002
024900*--------------------------------------------------------------*  02490016
025000* FETCH INVOICE_CSR                                            *  02500016
025100*--------------------------------------------------------------*  02510016
025200 R100-FETCH-INVOICES.                                             02520001
025300                                                                  02530001
025400     MOVE 'R100-FETCH-INVOICES' TO PV-CURRENT-PARAGRAPH.          02540001
025500                                                                  02550001
025600     EXEC SQL                                                     02560001
025700         FETCH INVOICE_CSR                                        02570001
025800         INTO :INVOIC-PO-NBR                                      02580012
025900             ,:INVOIC-INVC-ID                                     02590001
026000             ,:INVOIC-STR-NBR                                     02600001
026100             ,:INVOIC-CRE-DTE                                     02610012
026200             ,:INVOIC-STATUS-CDE                                  02620001
026300             ,:INVOIC-PAYT-RLSE-TMST                              02630001
026400             ,:INVOIC-STATUS-CHG-TMST                             02640001
026410             ,:INVOIC-DC-NBR                                      02641014
026420             ,:INVOIC-MTCH-LVL-CDE                                02642014
026500     END-EXEC.                                                    02650001
026600                                                                  02660001
026700     EVALUATE TRUE                                                02670001
026800         WHEN SQLCODE = ZERO                                      02680001
026900              ADD 1 TO PV-INVOICE-COUNT                           02690001
027000         WHEN SQLCODE = +100                                      02700001
027100              SET PS-END-INVOICES TO TRUE                         02710001
027200         WHEN SQLWARN0 NOT = SPACES                               02720001
027300         WHEN SQLCODE  NOT = ZERO                                 02730001
027400             MOVE PV-CURRENT-PARAGRAPH                            02740001
027500                                TO AA-PARAGRAPH-NAME              02750001
027600             MOVE 'BAD FETCH WITH INVOICE_CSR'                    02760001
027700                                TO AA-DB2-OPERATION               02770001
027900             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 02790012
028000             MOVE SPACES        TO AA-DB2-TABLE-2                 02800012
028010                                   AA-DB2-TABLE-3                 02801012
028100             PERFORM Z999-DB2-ABEND                               02810001
028200     END-EVALUATE.                                                02820001
028300                                                                  02830001
028500*--------------------------------------------------------------*  02850016
028600* WRITE OUTPUT RECORD FOR APKUP300 TO RESET THE INVALID        *  02860028
028700* PAY-RELEASED INVOICES                                        *  02870035
028800*--------------------------------------------------------------*  02880016
028300 W100-WRITE-UPDATE-RECORD.                                        02881128
025300                                                                  02881230
025400     MOVE 'W100-WRITE-UPDATE-RECORD' TO PV-CURRENT-PARAGRAPH.     02881330
028300                                                                  02881428
028300     INITIALIZE AP091-UPDATE-RECORD.                              02881528
028300     MOVE INVOIC-PO-NBR         TO AP091-PO-NBR.                  02881641
028300*    MOVE INVOIC-STR-NBR        TO AP091-LOCN-NBR.                02881753
028300     IF INVOIC-MTCH-LVL-CDE = 'P'                                 02881853
028300         MOVE ZERO               TO AP091-LOCN-NBR                02881953
028300     ELSE                                                         02882053
028300         IF INVOIC-MTCH-LVL-CDE = 'S'                             02882153
028300             MOVE INVOIC-STR-NBR TO AP091-LOCN-NBR                02882253
028300         ELSE                                                     02882353
028300             MOVE INVOIC-DC-NBR  TO AP091-LOCN-NBR                02882453
028300         END-IF                                                   02882553
028300     END-IF.                                                      02882653
028300     MOVE INVOIC-PAYT-RLSE-TMST TO AP091-RELEASE-DT.              02882753
028300     MOVE 'M'                   TO AP091-PROCESS-CDE.             02882853
028300     MOVE INVOIC-MTCH-LVL-CDE   TO AP091-MATCH-LVL-CDE.           02882953
028300     PERFORM W101-GET-IMPORT-IND.                                 02883053
028300     MOVE PV-IMPORT-IND         TO AP091-IMPORT-IND.              02883153
028300     MOVE PURCHS-ENT-ID         TO AP091-PO-ENT-ID.               02883253
028300     MOVE PURCHS-DEPT-NBR       TO AP091-PO-DEPT-NBR.             02883353
028300                                                                  02883453
028300     WRITE OUT-UPDATE-RECORD FROM AP091-UPDATE-RECORD.            02883553
028300     ADD 1 TO PV-UPDATE-COUNT.                                    02883653
028300                                                                  02883753
028500*--------------------------------------------------------------*  02883853
028600* DETERMINE IF THE INVOICE IS FOR AN IMPORT OR NOT          *     02883953
028800*--------------------------------------------------------------*  02884053
028300 W101-GET-IMPORT-IND.                                             02884153
025300                                                                  02884253
025400     MOVE 'W101-GET-IMPORT-IND' TO PV-CURRENT-PARAGRAPH.          02884353
028300                                                                  02884453
028300     MOVE SPACES TO PV-IMPORT-IND.                                02884553
039600     EXEC SQL                                                     02884653
039700         SELECT IMPRT_AGNT_PO_IND                                 02884753
039700              , ENT_ID                                            02884853
039700              , DEPT_NBR                                          02884953
039800           INTO :PV-IMPORT-IND                                    02885053
039800              , :PURCHS-ENT-ID                                    02885153
039800              , :PURCHS-DEPT-NBR                                  02885253
039900           FROM TPURCHS                                           02885353
040000         WHERE PO_NBR = :INVOIC-PO-NBR                            02885453
D40100           AND VER_STATUS_CDE = 'A'                               02885553
040600     END-EXEC.                                                    02885653
040700                                                                  02885753
040800     EVALUATE TRUE                                                02885853
040900        WHEN SQLCODE = ZERO                                       02885953
041000        WHEN SQLCODE = +100                                       02886053
041100          CONTINUE                                                02886153
041200        WHEN SQLWARN0 NOT = SPACES                                02886253
027300         WHEN SQLCODE  NOT = ZERO                                 02886730
027400             MOVE PV-CURRENT-PARAGRAPH                            02886830
027500                                TO AA-PARAGRAPH-NAME              02886930
027600             MOVE 'UNSUCCESSFUL SELECT'                           02887030
027700                                TO AA-DB2-OPERATION               02887130
027900             MOVE 'TPURCHS'     TO AA-DB2-TABLE-1                 02887230
028000             MOVE SPACES        TO AA-DB2-TABLE-2                 02887330
028010                                   AA-DB2-TABLE-3                 02887430
028100             PERFORM Z999-DB2-ABEND                               02887530
028200     END-EVALUATE.                                                02887630
028300                                                                  02887929
028500*--------------------------------------------------------------*  02888030
028600* WRITE OUTPUT RECORD FOR EMAIL TO AP/SUPPORT ON THE           *  02888130
028700* PAY-RELEASED INVOICES THAT HAVE BEEN REVERSED.               *  02888230
028800*--------------------------------------------------------------*  02888330
028300 W102-WRITE-EMAIL-RECORD.                                         02888430
025300                                                                  02888530
025400     MOVE 'W102-WRITE-EMAIL-RECORD' TO PV-CURRENT-PARAGRAPH.      02888630
028300                                                                  02888730
021800     STRING  'THE PAY-RELEASE FOR '    DELIMITED BY SIZE          02888931
021800             'THE FOLLOWING PO HAS '   DELIMITED BY SIZE          02889031
021800             'BEEN REVERSED: '         DELIMITED BY SIZE          02889131
021800                                       INTO PV-EMAIL-MSG.         02889231
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02889331
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02889439
021800     STRING  '  VENDOR:         '      DELIMITED BY SIZE          02889645
021800             ENTNME-ENT-NAME-DESC      DELIMITED BY SIZE          02889743
022000                                       INTO PV-EMAIL-MSG.         02889931
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02890031
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02890143
028300     MOVE INVOIC-PO-NBR                TO PV-DISPLAY-PO.          02890243
021800     STRING  '  PO NBR:         '      DELIMITED BY SIZE          02890345
021800             PV-DISPLAY-PO             DELIMITED BY SIZE          02890443
022000                                       INTO PV-EMAIL-MSG.         02890543
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02890643
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02890739
021800     STRING  '  INVC ID:        '      DELIMITED BY SIZE          02890831
021800             INVOIC-INVC-ID            DELIMITED BY SIZE          02890931
022000                                       INTO PV-EMAIL-MSG.         02891031
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02891131
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02891239
021800     MOVE INVOIC-STR-NBR               TO PV-DISPLAY-STORE.       02891331
021800     STRING  '  STR NBR:        '      DELIMITED BY SIZE          02891431
021800             PV-DISPLAY-STORE          DELIMITED BY SIZE          02891531
022000                                       INTO PV-EMAIL-MSG.         02891631
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02891731
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02891839
021800     MOVE INVOIC-CRE-DTE               TO PV-DISPLAY-DATE.        02891931
021800     STRING  '  ENTR DTE:       '      DELIMITED BY SIZE          02892031
021800             PV-DISPLAY-DATE           DELIMITED BY SIZE          02892131
022000                                       INTO PV-EMAIL-MSG.         02892231
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02892331
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02892439
021800     STRING  '  STATUS CDE:     '      DELIMITED BY SIZE          02892531
021800             INVOIC-STATUS-CDE         DELIMITED BY SIZE          02892631
022000                                       INTO PV-EMAIL-MSG.         02892731
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02892831
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02892939
021800     STRING  '  PAYT RLSE TMST: '      DELIMITED BY SIZE          02893031
021800             INVOIC-PAYT-RLSE-TMST     DELIMITED BY SIZE          02893131
022000                                       INTO PV-EMAIL-MSG.         02893231
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02893331
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02893439
021800     STRING  '  STATUS CHG TMST:'      DELIMITED BY SIZE          02893531
021800             INVOIC-STATUS-CHG-TMST    DELIMITED BY SIZE          02893631
022000                                       INTO PV-EMAIL-MSG.         02893731
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02893831
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02893939
021800     MOVE INVOIC-DC-NBR                TO PV-DISPLAY-STORE.       02894031
021800     STRING  '  DC NBR:         '      DELIMITED BY SIZE          02894131
021800             PV-DISPLAY-STORE          DELIMITED BY SIZE          02894231
022000                                       INTO PV-EMAIL-MSG.         02894331
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02894531
028300     MOVE SPACES                       TO PV-EMAIL-MSG.           02894639
021800     STRING  '  MATCH LEVEL CD: '      DELIMITED BY SIZE          02894731
021800             INVOIC-MTCH-LVL-CDE       DELIMITED BY SIZE          02894831
022000                                       INTO PV-EMAIL-MSG.         02894931
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02895131
022000     MOVE SPACES                       TO PV-EMAIL-MSG.           02895231
028300     WRITE OUT-EMAIL-RECORD            FROM PV-EMAIL-MSG.         02895331
022620                                                                  02895431
118100*-----------------------------------------------------------      02895643
118200*  RETRIEVES VENDOR NAME FOR PO BEING PROCESSED.                  02895743
118300*-----------------------------------------------------------      02895843
118000 W105-GET-VENDOR-NAME.                                            02895943
025400     MOVE 'W105-GET-VENDOR-NAME' TO PV-CURRENT-PARAGRAPH.         02896043
118500                                                                  02896243
118600     EXEC SQL                                                     02896343
118601         SELECT  B.ENT_NAME_DESC                                  02897043
118602         INTO    :ENTNME-ENT-NAME-DESC                            02897443
118603         FROM    TENTNME B                                        02897843
118604                ,TPURCHS C                                        02897943
118605         WHERE   C.PO_NBR         = :INVOIC-PO-NBR                02898043
118606           AND   C.VER_STATUS_CDE ='A'                            02898143
118607           AND   B.ENT_ID         = C.ENT_ID                      02898343
118608           AND   B.TYPE_CDE       = '01'                          02898443
119200     END-EXEC.                                                    02899043
040700                                                                  02899943
040800     EVALUATE TRUE                                                02900043
040900        WHEN SQLCODE = ZERO                                       02900143
041000        WHEN SQLCODE = +100                                       02900243
041100          CONTINUE                                                02900343
041200        WHEN SQLWARN0 NOT = SPACES                                02900443
027300        WHEN SQLCODE  NOT = ZERO                                  02900543
027400             MOVE PV-CURRENT-PARAGRAPH                            02900643
027500                                TO AA-PARAGRAPH-NAME              02900743
027600             MOVE 'UNSUCCESSFUL SELECT'                           02900843
027700                                TO AA-DB2-OPERATION               02900943
027900             MOVE 'TENTNME'     TO AA-DB2-TABLE-1                 02901043
028000             MOVE 'TPURCHS'     TO AA-DB2-TABLE-2                 02901143
028010             MOVE SPACES        TO AA-DB2-TABLE-3                 02901244
028100             PERFORM Z999-DB2-ABEND                               02901343
028200     END-EVALUATE.                                                02901443
121200                                                                  02901543
121300                                                                  02901643
028500*--------------------------------------------------------------*  02901731
028600* UPDATE THE REVERSAL INDICATOR WHEN THE REVERSAL AMOUNT       *  02901831
028700* EQUALS THE ORIGINAL POSTING AMOUNT                           *  02901931
028800*--------------------------------------------------------------*  02902031
028900*U400-UPDATE-TPOSTRR.                                             02902128
029000*                                                                 02903028
029100*    MOVE 'U400-UPDATE-TPOSTRR' TO PV-CURRENT-PARAGRAPH.          02910028
029300*    MOVE INVOIC-PO-NBR         TO POSTRR-PO-NBR.                 02930028
029500*                                                                 02950028
029600*    IF INVOIC-MTCH-LVL-CDE = 'P'                                 02960028
029700*       EXEC SQL                                                  02970028
029800*           UPDATE TPOSTRR                                        02980028
029900*              SET STATUS_CDE = 'I'                               02990028
030000*            WHERE PO_NBR = :POSTRR-PO-NBR                        03000028
030100*       END-EXEC                                                  03010028
030200*    ELSE                                                         03020028
030210*       IF INVOIC-MTCH-LVL-CDE = 'S'                              03021028
030220*          MOVE INVOIC-STR-NBR TO POSTRR-STR-NBR                  03022028
030300*          EXEC SQL                                               03030028
030400*              UPDATE TPOSTRR                                     03040028
030500*                 SET STATUS_CDE = 'I'                            03050028
030600*               WHERE PO_NBR = :POSTRR-PO-NBR                     03060028
030700*                 AND STR_NBR = :POSTRR-STR-NBR                   03070028
030800*          END-EXEC                                               03080028
030810*       ELSE                                                      03081028
030820*          MOVE INVOIC-DC-NBR TO POSTRR-STR-NBR                   03082028
030830*          EXEC SQL                                               03083028
030831*              UPDATE TPOSTRR                                     03083128
030832*                 SET STATUS_CDE = 'I'                            03083228
030833*               WHERE PO_NBR = :POSTRR-PO-NBR                     03083328
030834*                 AND STR_NBR = :POSTRR-STR-NBR                   03083428
030840*          END-EXEC                                               03084028
030850*       END-IF                                                    03085028
030900*    END-IF.                                                      03090028
031000*                                                                 03100028
031100*    EVALUATE TRUE                                                03110028
031200*        WHEN SQLCODE = ZEROS                                     03120028
031300*            ADD 1 TO TPOSTRR-UPDATE-COUNT                        03130028
031400*        WHEN SQLCODE = +100                                      03140028
031500*            ADD 1 TO TPOSTRR-NOT-FOUND                           03150028
031600*        WHEN OTHER                                               03160028
031700*            MOVE PV-CURRENT-PARAGRAPH                            03170028
031800*                                TO AA-PARAGRAPH-NAME             03180028
031900*            DISPLAY '******** PO:'                               03190028
032000*                     POSTRR-PO-NBR                               03200028
032100*            DISPLAY '******** STORE NBR:'                        03210028
032200*                     POSTRR-STR-NBR                              03220028
032300*            MOVE 'UNSUCCESSFUL UPDATE'                           03230028
032400*                                TO AA-DB2-OPERATION              03240028
032500*            MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                03250028
032600*            MOVE SPACES         TO AA-DB2-TABLE-2                03260028
032700*                                   AA-DB2-TABLE-3                03270028
032800*            PERFORM Z999-DB2-ABEND                               03280028
032900*    END-EVALUATE.                                                03290028
033000                                                                  03300001
033200*--------------------------------------------------------------*  03320016
033300* OPEN THE INVOICE_CSR                                         *  03330016
033400*--------------------------------------------------------------*  03340016
033500 X100-OPEN-INVOICE-CSR.                                           03350001
033600                                                                  03360001
033700     MOVE 'X100-OPEN-INVOICE-CSR '    TO PV-CURRENT-PARAGRAPH.    03370016
033800                                                                  03380001
033900     EXEC SQL                                                     03390001
034000         OPEN INVOICE_CSR                                         03400001
034100     END-EXEC.                                                    03410001
034200                                                                  03420001
034300     EVALUATE TRUE                                                03430001
034400         WHEN SQLCODE = ZERO                                      03440001
034500              CONTINUE                                            03450001
034600         WHEN SQLWARN0 NOT = SPACES                               03460001
034700         WHEN SQLCODE  NOT = ZERO                                 03470001
034800             MOVE PV-CURRENT-PARAGRAPH                            03480001
034900                                TO AA-PARAGRAPH-NAME              03490001
035000             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              03500001
035100                                TO AA-DB2-OPERATION               03510001
035300             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 03530012
035400             MOVE SPACES        TO AA-DB2-TABLE-2                 03540012
035410                                   AA-DB2-TABLE-3                 03541012
035500             PERFORM Z999-DB2-ABEND                               03550001
035600     END-EVALUATE.                                                03560001
035700                                                                  03570001
035800*--------------------------------------------------------------*  03580016
035900* CLOSE THE INVOICE_CSR                                        *  03590016
036000*--------------------------------------------------------------*  03600016
036100 Y100-CLOSE-INVOICE-CSR.                                          03610001
036200                                                                  03620001
036300     MOVE 'Y100-CLOSE-INVOICE-CSR'     TO PV-CURRENT-PARAGRAPH.   03630016
036400                                                                  03640001
036500     EXEC SQL                                                     03650001
036600         CLOSE INVOICE_CSR                                        03660001
036700     END-EXEC.                                                    03670001
036800                                                                  03680001
036900     EVALUATE TRUE                                                03690001
037000         WHEN SQLCODE = ZERO                                      03700001
037100              CONTINUE                                            03710001
037200         WHEN SQLWARN0 NOT = SPACES                               03720001
037300         WHEN SQLCODE  NOT = ZERO                                 03730001
037400             MOVE PV-CURRENT-PARAGRAPH                            03740001
037500                                   TO AA-PARAGRAPH-NAME           03750001
037600             MOVE 'UNSUCCESSFUL CLOSE OF INVOICE_CSR'             03760001
037700                                   TO AA-DB2-OPERATION            03770001
037900             MOVE 'TINVOIC'        TO AA-DB2-TABLE-1              03790012
038000             MOVE SPACES           TO AA-DB2-TABLE-2              03800012
038010             MOVE SPACES           TO AA-DB2-TABLE-3              03801012
038100             PERFORM Z999-DB2-ABEND                               03810001
038200     END-EVALUATE.                                                03820001
038300                                                                  03830001
038500*--------------------------------------------------------------*  03850016
038600* ABEND ROUTINE FOR DB2 ERRORS                                 *  03860016
038700*--------------------------------------------------------------*  03870016
038800 Z999-DB2-ABEND.                                                  03880001
038900                                                                  03890001
039000     DISPLAY 'PO BEING PROCESSED = ' INVOIC-PO-NBR.               03900012
039100     DISPLAY 'STORE BEING PROCESSED = ' INVOIC-STR-NBR.           03910012
039200     DISPLAY AA-ABEND-LIT.                                        03920001
039300     DISPLAY AA-DB2-ERROR-LIT.                                    03930001
039400     DISPLAY AA-PROGRAM-LIT.                                      03940001
039500     DISPLAY AA-PARAGRAPH-LIT.                                    03950001
039600     DISPLAY AA-DB2-OPERATION-LIT.                                03960001
039700     DISPLAY AA-DB2-TABLE-1.                                      03970001
039800     DISPLAY AA-DB2-TABLE-2.                                      03980001
039900     DISPLAY AA-DB2-TABLE-3.                                      03990001
040000     SET AC-DB2-ERROR TO TRUE.                                    04000001
040100                                                                  04010001
040200     COPY DPPD004.                                                04020001
040300                                                                  04030001
040400     CALL 'ILBOABN0' USING ABEND-CODE.                            04040001
