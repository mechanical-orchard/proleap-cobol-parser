000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS154.                                         00040000
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  08/93.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E154 - WORK ORDER INSTRUCTION LIST.                        * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF WORK ORDER INSTRUCTIONS   * 00130000
001400*    FOR THE REQUESTED WORK ORDER.                              * 00140000
001500*                                                               * 00150000
001600*    IR-122: SET WORK ORDER TO 'CM' AND SHUT DOWN ALL NON-ZERO  * 00160000
001700*            WORK ORDER INSTRUCTIONS WHEN STOPPING THE LAST     * 00170000
001800*            ZERO LINE WORK ORDER INSTRUCTION AND PACK SLIP IS  * 00180000
001900*            EQUAL TO 'Y'.                                      * 00190000
002000*            6/8/94 BY M. FURLICK                               * 00200000
002100*                                                               * 00210000
002200*    IR-159: DON'T ALLOW THE LAST INSTRUCTION TO BE COMPLETE    * 00220000
002300*            IF THERE ARE NO TRECDIS ROWS OR UNRESOLVED TROUBLE * 00230000
002400*            EXISTS.                                            * 00240000
002500*            6/27/94 BY M. FURLICK                              * 00250000
002600*                                                               * 00260000
002700*    WR-28767 REMOVE ARCHIVING OF TRECEIVER SEGMENT REPLACE     * 00270000
002800*             WITH UPDATE.                                      * 00280000
002900*             BY GARDNER     8/26/94                            * 00290000
003000*                                                               * 00300000
003100*    IR-280   CHANGED TO LET ZERO LINE WORK ORDER OPEN WHEN     * 00310000
003200*             A NON ZER LINE IS STARTED.  ALSO CHANGED PGM TO   * 00320000
003300*             CLOSE THE ZERO LINE WHEN ALL NON ZER LINE'S ARE   * 00330000
003400*             COMPLETED.                                        * 00340000
003500*             BY BILSKI      1/11/95                            * 00350000
003600*                                                               * 00360000
003700*    IR-340   IF SQLCODE = -913, -911, -904, PUT THE MESSAGES   * 00370000
003800*             TO THE SCREEN INSTEAD OF ABENDING THE PROGRAM.    * 00380000
003900*             BY H. KIM     08/09/95                            * 00390000
004000*                                                                *00400000
004100*  NOTE**NOTE**NOTE**NOTE**                                      *00410000
004200*    WHEN MAKING CHANGES TO THE DELETE STATUS ROLL-UP, THE SAME  *00420000
004300*    CHANGES MUST BE MADE TO THE STATUS ROLL-UP IN PGM PCKCS155. *00430000
004400*    (IR-257)                                                  . *00440000
004500*                                                                *00450000
004510*-----------------------------------------------------------------00451066
004520* DATE  11/07/2022                                               *00452067
004530*            - ADD COPYBOOK DPWS930                              *00453067
004540*              CHANGE CALL TO DPWS030 FROM STATIC TO             *00454067
004550*              DYNAMIC.                                          *00455067
004560*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910       *00456067
004600*----------------------------------------------------------------*00460000
004700/                                                                 00470000
004800 ENVIRONMENT DIVISION.                                            00480000
004900                                                                  00490000
005000 DATA DIVISION.                                                   00500000
005100                                                                  00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005300                                                                  00530000
005400 01  PC-PROGRAM-CONSTANTS.                                        00540000
005500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00550000
005600                                                    'PC154A  '.   00560000
005700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00570000
005800                                                    'PCKM154 '.   00580000
005900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00590000
006000                                                    'PCKCS154'.   00600000
006100     05  PC-AUDIT-RTN                   PIC  X(08)  VALUE         00610000
006200                                                    'RCKCS290'.   00620000
006300     05  PC-AUDIT-RTN-LENGTH            PIC S9(04)  VALUE  +300   00630000
006400                                                    COMP SYNC.    00640000
006500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00650000
006600     05  PC-SEL-QUEUE-SEQ2              PIC  9(01)  VALUE 3.      00660000
006700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     00670000
006800                                                    COMP SYNC.    00680000
006900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00690000
007000                                                    COMP SYNC.    00700000
007100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00710000
007200                                                    +1000000      00720000
007300                                                    COMP-3.       00730000
007400     05  PC-0                           PIC S9(04)  VALUE +0      00740000
007500                                                    COMP.         00750000
007600     05  PC-ONE                         PIC S9(04)  VALUE +1      00760000
007700                                                    COMP.         00770000
007800     05  PC-998                         PIC S9(04)  VALUE +998    00780009
007900                                                    COMP.         00790000
008000     05  PC-999                         PIC S9(04)  VALUE +999    00800000
008100                                                    COMP.         00810000
008200     05  PC-A                           PIC  X(01)  VALUE 'A'.    00820000
008300     05  PC-R                           PIC  X(01)  VALUE 'R'.    00830009
008400     05  PC-S                           PIC  X(01)  VALUE 'S'.    00840000
008500     05  PC-I                           PIC  X(01)  VALUE 'I'.    00850000
008600     05  PC-N                           PIC  X(01)  VALUE 'N'.    00860000
008700     05  PC-M                           PIC  X(01)  VALUE 'M'.    00870012
008800     05  PC-T                           PIC  X(01)  VALUE 'T'.    00880011
008900     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00890000
009000     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    00900000
009100     05  PC-CM                          PIC  X(02)  VALUE 'CM'.   00910000
009200     05  PC-IP                          PIC  X(02)  VALUE 'IP'.   00920000
009300     05  PC-DB2-DEFAULT-DATE            PIC  X(26)  VALUE         00930000
009400         '9999-09-09-09.09.09.999999'.                            00940000
009500     05  PC-DEF-DATE                    PIC  X(10)  VALUE         00950000
009600         '9999-09-09'.                                            00960000
009700     05  PC-INTER-APPL-CODES.                                     00970000
009800         10  PC-INTER-APPL-CRIT-SPEC                              00980000
009900                                  PIC  X(01)  VALUE '1'.          00990000
010000         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '5'.          01000000
010100         10  PC-INTER-APPL-RCVR-UPDATE                            01010000
010200                                  PIC  X(01)  VALUE '6'.          01020000
010300                                                                  01030000
010400     05  PC-TSYMSG-NUMBERS.                                       01040000
010500         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  01050025
010600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01060025
010700         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01070000
010800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01080000
010900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01090000
011000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01100000
011100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01110000
011200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01120000
011300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01130000
011400         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01140000
011500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01150000
011600         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01160000
011700         10  PC-TSYMSG-00736            PIC  9(05)  VALUE 00736.  01170000
011800         10  PC-TSYMSG-00737            PIC  9(05)  VALUE 00737.  01180000
011900         10  PC-TSYMSG-00738            PIC  9(05)  VALUE 00738.  01190000
012000         10  PC-TSYMSG-00739            PIC  9(05)  VALUE 00739.  01200000
012100         10  PC-TSYMSG-00810            PIC  9(05)  VALUE 00810.  01210000
012200*  FUNCTION ONLY AVAILABLE FOR ZERO LEVEL WORK ORDER              01220000
012300         10  PC-TSYMSG-00908            PIC  9(05)  VALUE 00908.  01230000
012400*  MUST SELECT ONLY THE LAST INSTRUCTION, WHICH MUST BE STARTED   01240000
012500         10  PC-TSYMSG-00909            PIC  9(05)  VALUE 00909.  01250000
012600*  WO COMPLETE; NO MAINT ALLOWED                                  01260000
012700         10  PC-TSYMSG-00910            PIC  9(05)  VALUE 00910.  01270000
012800*  WORK ORDER HEADER PROBLEM                                      01280000
012900         10  PC-TSYMSG-00911            PIC  9(05)  VALUE 00911.  01290000
013000*  PURCHASE ORDER PROBLEM                                         01300000
013100         10  PC-TSYMSG-00912            PIC  9(05)  VALUE 00912.  01310000
013200*  PURCHASE ORDER ITEM PROBLEM                                    01320000
013300         10  PC-TSYMSG-00913            PIC  9(05)  VALUE 00913.  01330000
013400*  INSTRUCTION HAS ALREADY BEEN STARTED                           01340000
013500         10  PC-TSYMSG-00914            PIC  9(05)  VALUE 00914.  01350000
013600*  MUST WORK PREVIOUS INSTRUCTION FIRST                           01360000
013700         10  PC-TSYMSG-00915            PIC  9(05)  VALUE 00915.  01370000
013800*  INSTRUCTION MUST BE STARTED FIRST                              01380000
013900         10  PC-TSYMSG-00916            PIC  9(05)  VALUE 00916.  01390000
014000*  INSTRUCTION ALREADY STOPPED                                    01400000
014100         10  PC-TSYMSG-00917            PIC  9(05)  VALUE 00917.  01410000
014200*  RECEIPT ITEM NOT TRANSCRIBED                                   01420000
014300         10  PC-TSYMSG-00918            PIC  9(05)  VALUE 00918.  01430000
014400*  RECEIPT ITEM IN TROUBLE                                        01440000
014500         10  PC-TSYMSG-00919            PIC  9(05)  VALUE 00919.  01450000
014600*  NO NON-ZERO WORK ORDERS EXIST; CAN'T STOP LAST ZERO LINE INSTR 01460000
014700         10  PC-TSYMSG-00920            PIC  9(05)  VALUE 00920.  01470000
014800*  INSTRUCTION HAS BEEN STOPPED                                   01480000
014900         10  PC-TSYMSG-00921            PIC  9(05)  VALUE 00921.  01490000
015000*  CAN'T ADD INSTRUCTION HERE                                     01500000
015100         10  PC-TSYMSG-00922            PIC  9(05)  VALUE 00922.  01510000
015200*  CAN'T UPDATE THIS INSTRUCTION                                  01520000
015300         10  PC-TSYMSG-00923            PIC  9(05)  VALUE 00923.  01530000
015400*  CAN'T DELETE THIS INSTRUCTION                                  01540000
015500         10  PC-TSYMSG-00924            PIC  9(05)  VALUE 00924.  01550000
015600*  CAN'T DELETE THIS INSTRUCTION - ONLY ONE EXISTS                01560000
015700         10  PC-TSYMSG-00925            PIC  9(05)  VALUE 00925.  01570000
015800*  INSTRUCTION HAS BEEN STARTED                                   01580000
015900         10  PC-TSYMSG-00926            PIC  9(05)  VALUE 00926.  01590000
016000* THE RESTART FUNCTION CAN ONLY BE USED ON INSTRUCTIONS THAT ARE  01600027
016100* STOPPED                                                         01610027
016200         10  PC-TSYMSG-02832            PIC  9(05)  VALUE 02832.  01620027
016300* ONLY THE LATEST STOPPED INSTRUCTION CAN BE RESTARTED            01630027
016400         10  PC-TSYMSG-02833            PIC  9(05)  VALUE 02833.  01640033
016500*  FUNCTION NOT AVAILABLE FOR ZERO LEVEL WORK ORDER               01650027
016600         10  PC-TSYMSG-02834            PIC  9(05)  VALUE 02834.  01660027
016700*  INSTRUCTION HAS BEEN RESTARTED                                 01670028
016800         10  PC-TSYMSG-02835            PIC  9(05)  VALUE 02835.  01680028
016900*                                                                 01690000
017000 01  PS-PROGRAM-SWITCHES.                                         01700000
017100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01710000
017200         88  PS-NO-ERROR                            VALUE 'Y'.    01720000
017300         88  PS-ERROR                               VALUE 'N'.    01730000
017400     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'N'.    01740000
017500         88  PS-DATA-OK                             VALUE 'Y'.    01750000
017600         88  PS-DATA-NOT-OK                         VALUE 'N'.    01760000
017610     05  PS-ITEM-FOUND-SW               PIC  X(01)  VALUE 'Y'.    01761050
017620         88  PS-ITEM-FOUND                          VALUE 'Y'.    01762042
017630         88  PS-ITEM-NOT-FOUND                      VALUE 'N'.    01763042
017700     05  PS-CHECK-NEXT-SW               PIC  X(01)  VALUE 'N'.    01770000
017800         88  PS-CHECK-NEXT                          VALUE 'Y'.    01780000
017900         88  PS-DONT-CHECK-NEXT                     VALUE 'N'.    01790000
018000     05  PS-ZERO-LEVEL-WO-SW            PIC  X(01)  VALUE 'N'.    01800000
018100         88  PS-ZERO-LEVEL-WO-COMPLETE              VALUE 'Y'.    01810000
018200         88  PS-ZERO-LEVEL-WO-NOT-COMPLETE          VALUE 'N'.    01820000
018300*                                                                 01830000
018400     05  PS-UPDATE-SW                   PIC  X(01)  VALUE 'N'.    01840000
018500         88  PS-NO-UPDATES-DONE                     VALUE 'N'.    01850000
018600         88  PS-UPDATES-DONE                        VALUE 'Y'.    01860000
018700 01  PV-PROGRAM-VARIABLES.                                        01870000
018800     05  PV-SUB                         PIC S9(04)  VALUE +0      01880000
018900                                                    COMP SYNC.    01890000
019000     05  PV-SUB2                        PIC S9(04)  VALUE +0      01900000
019100                                                    COMP SYNC.    01910000
019200     05  PV-BLK                         PIC S9(04)  VALUE +0      01920000
019300                                                    COMP SYNC.    01930000
019400     05  PV-ITM                         PIC S9(04)  VALUE +0      01940000
019500                                                    COMP SYNC.    01950000
019600     05  PV-HOLD-BLK                    PIC S9(04)  VALUE +0      01960000
019700                                                    COMP SYNC.    01970000
019800     05  PV-HOLD-ITEM                   PIC S9(04)  VALUE +0      01980000
019900                                                    COMP SYNC.    01990000
020000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02000000
020100                                                    COMP SYNC.    02010000
020200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02020000
020300                                                    COMP-3.       02030000
020400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02040000
020500                                                    COMP-3.       02050000
020600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02060000
020700                                                    COMP-3.       02070000
020800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02080000
020900                                                    COMP-3.       02090000
021000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02100000
021100                                                    COMP SYNC.    02110000
021200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02120000
021300                                                    COMP SYNC.    02130000
021400     05  PV-ITEM                        PIC S9(04)  VALUE +0      02140000
021500                                                    COMP SYNC.    02150000
021600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02160000
021700                                                    COMP SYNC.    02170000
021800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02180000
021900                                                    COMP SYNC.    02190000
022000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02200000
022100                                                    COMP SYNC.    02210000
022200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02220000
022300                                                    COMP SYNC.    02230000
022400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02240000
022500                                                    COMP SYNC.    02250000
022600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02260000
022700                                                    COMP SYNC.    02270000
022800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02280000
022900                                                    COMP SYNC.    02290000
023000     05  PV-NULL-IND                    PIC S9(4)   VALUE +0      02300000
023100                                                    COMP.         02310000
023200     05  PV-WO-STOP-COUNT               PIC S9(04)  VALUE +0      02320000
023300                                                    COMP.         02330000
023400     05  PV-COUNT                       PIC S9(9)   VALUE +0      02340000
023500                                                    COMP-3.       02350000
023600     05  PV-DB2-COUNT                   PIC S9(9)   VALUE +0      02360000
023700                                                    COMP-3.       02370000
023800     05  PV-DB2-TROUBLE-COUNT           PIC S9(9)   VALUE +0      02380000
023900                                                    COMP-3.       02390000
024000     05  PV-KEY-LINE-NBR                PIC S9(04)  COMP.         02400000
024100     05  PV-WORK-ORD-INSTR-MAX          PIC S9(04)  COMP.         02410000
024200     05  PV-WORK-ORD-INSTR-MAX-START    PIC  X(05)  VALUE SPACES. 02420000
024300     05  PV-WORK-ORD-INSTR-SELECTED     PIC S9(04)  COMP.         02430000
024400     05  PV-STATUS-CDE                  PIC  X(02).               02440000
024500                                                                  02450000
024600     05  PV-SELECT-ERROR-TABLE.                                   02460000
024700         10  PV-SELECT-ITEM-ENTRY  OCCURS 8 INDEXED BY PV-IDX     02470000
024800                                        PIC  X(01).               02480000
024900     05  PV-START-DATE                  PIC  X(05).               02490000
025000     05  PV-STOP-DATE                   PIC  X(05).               02500000
025100     05  PV-PREV-START-DATE             PIC  X(05).               02510000
025200     05  PV-PREV-STOP-DATE              PIC  X(05).               02520000
025300     05  PV-NEXT-START-DATE             PIC  X(05).               02530025
025400     05  PV-NEXT-INSTR-SEQ              PIC S9(04) COMP.          02540025
025500     05  PV-DUMMY-TMST                  PIC  X(26)  VALUE         02550000
025600         '9998-09-09-09.09.09.999999'.                            02560000
025700     05  PV-WORK-TMST.                                            02570000
025800         10  PV-WT-CCYY                 PIC  X(04).               02580000
025900             88  PV-WT-NULL-DATE                    VALUE '9999'. 02590000
026000         10  FILLER                     PIC  X(01).               02600000
026100         10  PV-WT-MO                   PIC  X(02).               02610000
026200         10  FILLER                     PIC  X(01).               02620000
026300         10  PV-WT-DA                   PIC  X(02).               02630000
026400         10  FILLER                     PIC  X(01).               02640000
026500         10  PV-WT-HH                   PIC  X(02).               02650000
026600         10  FILLER                     PIC  X(01).               02660000
026700         10  PV-WT-MM                   PIC  X(02).               02670000
026800         10  FILLER                     PIC  X(10).               02680000
026900     05  PV-SCREEN-DISPLAY-DATE.                                  02690000
027000         10  PV-SD-MO                   PIC  X(02).               02700000
027100         10  FILLER                     PIC  X(01)   VALUE '/'.   02710000
027200         10  PV-SD-DA                   PIC  X(02).               02720000
027300     05  PV-SCREEN-DISPLAY-TIME.                                  02730000
027400         10  PV-SD-HH                   PIC  X(02).               02740000
027500         10  FILLER                     PIC  X(01)   VALUE ':'.   02750000
027600         10  PV-SD-MM                   PIC  X(02).               02760000
027700     05  PV-WO-INSTR-SEQ-NBR            PIC  S9(4) COMP SYNC.     02770022
027710     05  PV-DISPLAY-SKU-NBR             PIC  X(08).               02771055
027800/                                                                 02780000
027900*----------------------------------------------------------------*02790000
028000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02800000
028100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *02810000
028200*   APPLICATION-SPECIFIC COMMAREA.                               *02820000
028300*----------------------------------------------------------------*02830000
028400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02840000
028500     05  LQW-BLOCK-MODIFIED             PIC  X(01)    VALUE SPACE.02850000
028600     05  LQW-ITEM-ENTRIES               OCCURS 08 TIMES           02860000
028700                                        INDEXED BY LQW-IDX.       02870000
028800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)    COMP-3.     02880000
028900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02890000
029000         10  LQW-SELECTED-SW            PIC  X(01).               02900000
029100             88  LQW-SELECT                           VALUE 'S'.  02910000
029200             88  LQW-DESELECT                         VALUE ' '.  02920000
029300         10  LQW-ACTION                 PIC  X(03).               02930000
029400         10  LQW-LNE-LOC-CDE            PIC  X(05).               02940000
029500         10  LQW-SEQ                    PIC S9(04)    COMP.       02950000
029600         10  LQW-INSTR-DESC             PIC  X(25).               02960000
029700         10  LQW-FCLTY-AREA-ID          PIC  X(06).               02970000
029800         10  LQW-EXPECTED-CTNS          PIC S9(05)    COMP-3.     02980000
029900         10  LQW-ACTUAL-CTNS            PIC S9(05)    COMP-3.     02990000
030000         10  LQW-RPK-IND                PIC  X(01).               03000000
030100         10  LQW-START-DATE             PIC  X(05).               03010000
030200         10  LQW-STOP-DATE              PIC  X(05).               03020000
030300         10  LQW-START-TIME             PIC  X(05).               03030000
030400         10  LQW-STOP-TIME              PIC  X(05).               03040000
030500         10  LQW-WO-INSTR-SEQ           PIC S9(04)    COMP.       03050000
030600/                                                                 03060000
030700*---------------------------------------------------------------* 03070000
030800*  RECORD LAYOUT 'INSERT AUDIT MODULE'  RCKCS290                * 03080000
030900*---------------------------------------------------------------* 03090000
031000                                                                  03100000
031100     COPY RCWS031.                                                03110000
031200                                                                  03120000
031300*---------------------------------------------------------------* 03130000
031400*  RECORD LAYOUT FOR THE INPUT SELECTION QUEUE.                 * 03140000
031500*---------------------------------------------------------------* 03150000
031600                                                                  03160000
031700     COPY PCWS016.                                                03170000
031800                                                                  03180000
031900*---------------------------------------------------------------* 03190000
032000*  RECORD LAYOUT FOR THE OUTPUT SELECTED ITEMS QUEUE.           * 03200000
032100*---------------------------------------------------------------* 03210000
032200                                                                  03220000
032300     COPY PCWS017.                                                03230000
032400                                                                  03240000
032500/                                                                 03250000
032600*---------------------------------------------------------------* 03260000
032700*    MAP LAYOUT                                                 * 03270000
032800*---------------------------------------------------------------* 03280000
032900                                                                  03290000
033000     COPY PCKM154.                                                03300000
033100*                                                                 03310000
033200 01  MR-OCCURS-LAYOUT                   REDEFINES  PC154AO.       03320000
033300     05  FILLER                         PIC X(190).               03330042
033400     05  MR-SCROLL-AREA                 OCCURS  8 TIMES.          03340000
033500         10  MR-SELECTL                 PIC S9(04) COMP.          03350000
033600         10  MR-SELECTA                 PIC  X(01).               03360000
033700         10  MR-SELECTC                 PIC  X(01).               03370000
033800         10  MR-SELECTH                 PIC  X(01).               03380000
033900         10  MR-SELECTI                 PIC  X(01).               03390000
034000                                                                  03400000
034100         10  MR-SEQL                    PIC S9(04) COMP.          03410000
034200         10  MR-SEQA                    PIC  X(01).               03420000
034300         10  MR-SEQC                    PIC  X(01).               03430000
034400         10  MR-SEQH                    PIC  X(01).               03440000
034500         10  MR-SEQ-X.                                            03450000
034600             15  MR-SEQ                 PIC  ZZZ9.                03460000
034700                                                                  03470000
034800         10  MR-INSTR-DESCL             PIC S9(04) COMP.          03480000
034900         10  MR-INSTR-DESCA             PIC  X(01).               03490000
035000         10  MR-INSTR-DESCC             PIC  X(01).               03500000
035100         10  MR-INSTR-DESCH             PIC  X(01).               03510000
035200         10  MR-INSTR-DESC              PIC  X(24).               03520000
035300                                                                  03530000
035400         10  MR-LNE-LOC-CDEL            PIC S9(04) COMP.          03540000
035500         10  MR-LNE-LOC-CDEA            PIC  X(01).               03550000
035600         10  MR-LNE-LOC-CDEC            PIC  X(01).               03560000
035700         10  MR-LNE-LOC-CDEH            PIC  X(01).               03570000
035800         10  MR-LNE-LOC-CDE             PIC  X(05).               03580000
035900                                                                  03590000
036000         10  MR-EXPECTED-CTNSL          PIC S9(04) COMP.          03600000
036100         10  MR-EXPECTED-CTNSA          PIC  X(01).               03610000
036200         10  MR-EXPECTED-CTNSC          PIC  X(01).               03620000
036300         10  MR-EXPECTED-CTNSH          PIC  X(01).               03630000
036400         10  MR-EXPECTED-CTNS-X.                                  03640000
036500             15  MR-EXPECTED-CTNS       PIC ZZZZZ.                03650000
036600                                                                  03660000
036700         10  MR-ACTUAL-CTNSL            PIC S9(04) COMP.          03670000
036800         10  MR-ACTUAL-CTNSA            PIC  X(01).               03680000
036900         10  MR-ACTUAL-CTNSC            PIC  X(01).               03690000
037000         10  MR-ACTUAL-CTNSH            PIC  X(01).               03700000
037100         10  MR-ACTUAL-CTNS-X.                                    03710000
037200             15  MR-ACTUAL-CTNS         PIC ZZZZZ.                03720000
037300                                                                  03730000
037400         10  MR-RPK-INDL                PIC S9(04) COMP.          03740000
037500         10  MR-RPK-INDA                PIC  X(01).               03750000
037600         10  MR-RPK-INDC                PIC  X(01).               03760000
037700         10  MR-RPK-INDH                PIC  X(01).               03770000
037800         10  MR-RPK-IND                 PIC  X(01).               03780000
037900                                                                  03790000
038000         10  MR-START-DATEL             PIC S9(04) COMP.          03800000
038100         10  MR-START-DATEA             PIC  X(01).               03810000
038200         10  MR-START-DATEC             PIC  X(01).               03820000
038300         10  MR-START-DATEH             PIC  X(01).               03830000
038400         10  MR-START-DATE              PIC  X(05).               03840000
038500                                                                  03850000
038600         10  MR-START-TIMEL             PIC S9(04) COMP.          03860000
038700         10  MR-START-TIMEA             PIC  X(01).               03870000
038800         10  MR-START-TIMEC             PIC  X(01).               03880000
038900         10  MR-START-TIMEH             PIC  X(01).               03890000
039000         10  MR-START-TIME              PIC  X(05).               03900000
039100                                                                  03910000
039200         10  MR-STOP-DATEL              PIC S9(04) COMP.          03920000
039300         10  MR-STOP-DATEA              PIC  X(01).               03930000
039400         10  MR-STOP-DATEC              PIC  X(01).               03940000
039500         10  MR-STOP-DATEH              PIC  X(01).               03950000
039600         10  MR-STOP-DATE               PIC  X(05).               03960000
039700                                                                  03970000
039800         10  MR-STOP-TIMEL              PIC S9(04) COMP.          03980000
039900         10  MR-STOP-TIMEA              PIC  X(01).               03990000
040000         10  MR-STOP-TIMEC              PIC  X(01).               04000000
040100         10  MR-STOP-TIMEH              PIC  X(01).               04010000
040200         10  MR-STOP-TIME               PIC  X(05).               04020000
040300                                                                  04030000
040400/                                                                 04040000
040500*---------------------------------------------------------------* 04050000
040600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04060000
040700*---------------------------------------------------------------* 04070000
040800                                                                  04080000
040900     COPY DPWS015.                                                04090000
041000                                                                  04100000
041100*---------------------------------------------------------------* 04110000
041200*    FUNCTION KEYS COPYBOOK.                                    * 04120000
041300*---------------------------------------------------------------* 04130000
041400                                                                  04140000
041500     COPY DPWS016.                                                04150000
041600                                                                  04160000
041700*---------------------------------------------------------------* 04170000
041800*    NUMERIC EDIT LAYOUT.                                       * 04180000
041900*---------------------------------------------------------------* 04190000
042000                                                                  04200000
042100     COPY DPWS010I.                                               04210000
042200/                                                                 04220000
042300*---------------------------------------------------------------* 04230000
042400*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04240000
042500*---------------------------------------------------------------* 04250000
042600                                                                  04260000
042700     COPY DPWS030.                                                04270000
042710     COPY DPWS930.                                                04271067
042800/                                                                 04280000
042810*---------------------------------------------------------------* 04281046
042820*    LOGISTICS DOMAIN ITEM ACCESS MODULE COPYBOOK               * 04282056
042830*---------------------------------------------------------------* 04283046
042840                                                                  04284046
042850     COPY XLWS001.                                                04285046
042860*                                                                 04286046
042900*---------------------------------------------------------------* 04290000
043000*    STANDARD COMMAREA.                                         * 04300000
043100*---------------------------------------------------------------* 04310000
043200                                                                  04320000
043300     COPY DPWS020.                                                04330000
043400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04340000
043500                                                                  04350000
043600         10  INTER-APPL-COMM-AREA       PIC X(200).               04360000
043700     COPY PCWS000.                                                04370000
043800     COPY RCWS012.                                                04380000
043900     COPY RCWS015.                                                04390017
044000*---------------------------------------------------------------* 04400000
044100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04410000
044200*---------------------------------------------------------------* 04420000
044300                                                                  04430000
044400         10  ASC-SPECIFIC-COMMAREA.                               04440000
044500             15  ASC-LIST-KEYS.                                   04450000
044600                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   04460000
044700                                                     COMP.        04470000
044800                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   04480000
044900                                                     COMP.        04490000
045000                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04500000
045100                                                     COMP.        04510000
045200                 20  ASC-KEY-ORD-NBR  REDEFINES  ASC-KEY-PO-NBR   04520000
045300                                          PIC S9(09) COMP.        04530000
045400                 20  ASC-KEY-RCVR-SEQ-NBR            PIC S9(09)   04540000
045500                                                     COMP.        04550000
045600                 20  ASC-KEY-LINE-NBR                PIC S9(04)   04560000
045700                                                     COMP.        04570000
045800                 20  ASC-KEY-WORK-ORD-SEQ-NBR        PIC S9(04)   04580000
045900                                                     COMP.        04590000
046000                 20  ASC-KEY-PREPK-ID                PIC S9(04)   04600012
046100                                                     COMP.        04610012
046110                 20  ASC-NIS-SKU-NBR                 PIC  X(08).  04611043
046200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04620000
046300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04630000
046400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04640000
046500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04650000
046600                                                                  04660000
046700                 20  ASC-ITEM-ARRAY.                              04670000
046800                     25  ASC-ITEM-ENTRIES OCCURS 08 TIMES.        04680000
046900                         30  ASC-LIST-ITEM-NUMBER                 04690000
047000                                                     PIC S9(09)   04700000
047100                                                     COMP-3.      04710000
047200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04720000
047300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04730000
047400                             88  ASC-TEMP-SELECT     VALUE 'S'.   04740000
047500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04750000
047600                             88  ASC-TEMP-END        VALUE 'E'.   04760000
047700                         30  ASC-SELECTED-SW         PIC  X(01).  04770000
047800                             88  ASC-NO-SELECT       VALUE ' '.   04780000
047900                             88  ASC-SELECT          VALUE 'S'.   04790000
048000                             88  ASC-BEGIN           VALUE 'B'.   04800000
048100                             88  ASC-END             VALUE 'E'.   04810000
048200                                                                  04820000
048300                         30  ASC-ACTION              PIC  X(03).  04830000
048400                         30  ASC-LNE-LOC-CDE         PIC  X(05).  04840000
048500                         30  ASC-SEQ                 PIC S9(04)   04850000
048600                                                          COMP.   04860000
048700                         30  ASC-INSTR-DESC          PIC  X(25).  04870000
048800                         30  ASC-FCLTY-AREA-ID       PIC  X(06).  04880000
048900                         30  ASC-EXPECTED-CTNS       PIC S9(05)   04890000
049000                                                          COMP-3. 04900000
049100                         30  ASC-ACTUAL-CTNS         PIC S9(05)   04910000
049200                                                          COMP-3. 04920000
049300                         30  ASC-RPK-IND             PIC  X(01).  04930000
049400                         30  ASC-START-DATE          PIC  X(05).  04940000
049500                         30  ASC-STOP-DATE           PIC  X(05).  04950000
049600                         30  ASC-START-TIME          PIC  X(05).  04960000
049700                         30  ASC-STOP-TIME           PIC  X(05).  04970000
049800                         30  ASC-WO-INSTR-SEQ        PIC S9(04)   04980000
049900                                                          COMP.   04990000
050000                                                                  05000000
050100             15  ASC-DEPT-NBR                        PIC  X(03).  05010000
050200             15  ASC-CL-NBR                          PIC  X(02).  05020000
050400             15  ASC-VEND-STYLE                      PIC  X(20).  05040000
050500             15  ASC-SKU-DESC                        PIC  X(25).  05050000
050600             15  ASC-EXPECTED-CARTS                  PIC S9(05)   05060000
050700                                                          COMP-3. 05070000
050800             15  ASC-ACTUAL-CARTS                    PIC S9(05)   05080000
050900                                                          COMP-3. 05090000
051000             15  ASC-EXPECTED-ITEMS                  PIC S9(05)   05100000
051100                                                          COMP-3. 05110000
051200             15  ASC-ACTUAL-ITEMS                    PIC S9(05)   05120000
051300                                                          COMP-3. 05130000
051400             15  ASC-STATUS-CDE                      PIC  X(02).  05140000
051500                 88  ASC-WO-COMPLETE                 VALUE 'CM'.  05150000
051600                                                                  05160000
051700             15  ASC-BLK-SUB                         PIC S9(04)   05170000
051800                                                          COMP    05180000
051900                                                          SYNC.   05190000
052000             15  ASC-ITEM-SUB                        PIC S9(04)   05200000
052100                                                          COMP    05210000
052200                                                          SYNC.   05220000
052300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05230000
052400                                                          COMP-3. 05240000
052500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05250000
052600                                                          COMP-3. 05260000
052700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05270000
052800                                                          COMP-3. 05280000
052900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05290000
053000                                                          COMP-3. 05300000
053100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05310000
053200                                                          COMP-3. 05320000
053300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05330000
053400                                                          COMP    05340000
053500                                                          SYNC.   05350000
053600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05360000
053700                                                          COMP-3. 05370000
053800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05380000
053900                                                          COMP-3. 05390000
054000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05400000
054100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05410000
054200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05420000
054300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05430000
054400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05440000
054500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05450000
054600             15  ASC-LIST-QUEUE-NAME.                             05460000
054700                 20  ASC-LIST-TERM-ID                PIC  X(04).  05470000
054800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05480000
054900                                                          COMP-3. 05490000
055000                 20  ASC-LIST-SEQ                    PIC  9(01).  05500000
055100             15  ASC-SEL-QUEUE-NAME.                              05510000
055200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05520000
055300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05530000
055400                                                          COMP-3. 05540000
055500                 20  ASC-SEL-SEQ                     PIC  9(01).  05550000
055600             15  ASC-SEL-QUEUE-NAME2.                             05560000
055700                 20  ASC-SEL-TERM-ID2                PIC  X(04).  05570000
055800                 20  ASC-SEL-TASK-NUMBER2            PIC S9(05)   05580000
055900                                                          COMP-3. 05590000
056000                 20  ASC-SEL-SEQ2                    PIC  9(01).  05600000
056100                                                                  05610000
056200             15  ASC-INT-APPL-FORMAT-IND             PIC  X(01).  05620000
056300             15  ASC-USE-SELECTION-QUEUE-IND                      05630000
056400                                           PIC  X(01).            05640000
056500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05650000
056600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    05660000
056700             15  ASC-SEL-SUB               PIC S9(04)  COMP.      05670000
056800             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      05680000
056900                                                                  05690000
057000             15  ASC-PACK-BY-ST-IND                  PIC  X(01).  05700000
057100             15  ASC-CURSOR-SW                       PIC  X(01).  05710000
057200                 88  ASC-NO-CURSOR                   VALUE 'Z'.   05720000
057300                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   05730000
057400                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   05740000
057500                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   05750000
057600             15  ASC-START-ITEM-REQUEST.                          05760000
057700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05770000
057800             15  ASC-HOLD-INTER-APPL                 PIC X(200).  05780000
057900/                                                                 05790000
058000*---------------------------------------------------------------* 05800000
058100*    ABEND PROCESSING COPYBOOK.                                 * 05810000
058200*---------------------------------------------------------------* 05820000
058300                                                                  05830000
058400     COPY DPWS013.                                                05840000
058500                                                                  05850000
058600/                                                                 05860000
058700*---------------------------------------------------------------* 05870000
058800*    DB2 AREA FOR TWKORIN                                       * 05880000
058900*---------------------------------------------------------------* 05890000
059000     EXEC SQL                                                     05900000
059100          INCLUDE TWKORIN                                         05910000
059200     END-EXEC.                                                    05920000
059300*---------------------------------------------------------------* 05930000
059400*    DB2 AREA FOR TWRKORD                                       * 05940000
059500*---------------------------------------------------------------* 05950000
059600     EXEC SQL                                                     05960000
059700          INCLUDE TWRKORD                                         05970000
059800     END-EXEC.                                                    05980000
059900*---------------------------------------------------------------* 05990000
060000*    DB2 AREA FOR TPURCHS                                       * 06000000
060100*---------------------------------------------------------------* 06010000
060200     EXEC SQL                                                     06020000
060300          INCLUDE TPURCHS                                         06030000
060400     END-EXEC.                                                    06040000
060500*---------------------------------------------------------------* 06050000
060600*    DB2 AREA FOR TPURITM                                       * 06060000
060700*---------------------------------------------------------------* 06070000
060800     EXEC SQL                                                     06080000
060900          INCLUDE TPURITM                                         06090000
061000     END-EXEC.                                                    06100000
061100*---------------------------------------------------------------* 06110000
061200*    DB2 AREA FOR TRECITM                                       * 06120000
061300*---------------------------------------------------------------* 06130000
061400     EXEC SQL                                                     06140000
061500          INCLUDE TRECITM                                         06150000
061600     END-EXEC.                                                    06160000
061700*---------------------------------------------------------------* 06170000
061800*    DB2 AREA FOR TRECEIV                                       * 06180000
061900*---------------------------------------------------------------* 06190000
062000     EXEC SQL                                                     06200000
062100          INCLUDE TRECEIV                                         06210000
062200     END-EXEC.                                                    06220000
062300*---------------------------------------------------------------* 06230000
062400*    DB2 AREA FOR TRECDIS                                       * 06240000
062500*---------------------------------------------------------------* 06250000
062600     EXEC SQL                                                     06260000
062700          INCLUDE TRECDIS                                         06270000
062800     END-EXEC.                                                    06280000
062900*IR-159 FROM HERE                                                 06290000
063000*---------------------------------------------------------------* 06300000
063100*    DB2 AREA FOR TROUBLE NOTIFICATION TABLE                    * 06310000
063200*---------------------------------------------------------------* 06320000
063300     EXEC SQL                                                     06330000
063400          INCLUDE TTRBNTF                                         06340000
063500     END-EXEC.                                                    06350000
063600*IR-159 TO HERE                                                   06360000
063700*---------------------------------------------------------------* 06370012
063800*    DB2 AREA FOR TROUBLE REASON TABLE                          * 06380010
063900*---------------------------------------------------------------* 06390010
064000     EXEC SQL                                                     06400010
064100          INCLUDE TTRBRSN                                         06410010
064200     END-EXEC.                                                    06420010
064300*---------------------------------------------------------------* 06430000
064400*    DB2 AREA FOR TOPERAT                                       * 06440000
064500*---------------------------------------------------------------* 06450000
064600     EXEC SQL                                                     06460000
064700          INCLUDE TOPERAT                                         06470000
064800     END-EXEC.                                                    06480000
064900*---------------------------------------------------------------* 06490000
065000*    DB2 AREA FOR COMMUNICATIONS                                * 06500000
065100*---------------------------------------------------------------* 06510000
065200     EXEC SQL                                                     06520000
065300          INCLUDE SQLCA                                           06530000
065400     END-EXEC.                                                    06540000
065500                                                                  06550000
065600*---------------------------------------------------------------* 06560000
065700*    CURSOR DECLARATION FOR LIST.                               * 06570000
065800*---------------------------------------------------------------* 06580000
065900                                                                  06590000
066000     EXEC SQL                                                     06600000
066100          DECLARE LIST-CSR CURSOR                                 06610000
066200          FOR SELECT                                              06620000
066300                O.OPER_DESC                                       06630000
066400              , W.SCREEN_SEQ_NBR                                  06640000
066500              , W.FCLTY_AREA_ID                                   06650000
066600              , W.EXPTED_CART_CNT                                 06660000
066700              , W.ACTL_CART_CNT                                   06670000
066800              , W.REPACK_IND                                      06680000
066900              , W.STRT_TMST                                       06690000
067000              , W.STOP_TMST                                       06700000
067100              , W.WO_INSTR_SEQ_NBR                                06710000
067200              , W.LNE_LOC_CDE                                     06720000
067300          FROM                                                    06730000
067400                TOPERAT O                                         06740000
067500              , TWKORIN W                                         06750000
067600          WHERE                                                   06760000
067700                W.ORD_NBR          =  :ASC-KEY-ORD-NBR            06770000
067800            AND W.ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR           06780000
067900            AND W.RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR       06790000
068000            AND W.WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR   06800000
068100***10/09    AND W.OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID        06810061
068200***10/09    AND W.FCLTY_ID         =  :ASC-KEY-FCLTY-ID           06820061
068300            AND W.VER_STATUS_CDE   =  :PC-A                       06830000
068400            AND W.OPER_ID          =  O.OPER_ID                   06840000
068500          ORDER BY                                                06850000
068600                W.SCREEN_SEQ_NBR                                  06860000
068700     END-EXEC.                                                    06870000
068800                                                                  06880000
068900*---------------------------------------------------------------* 06890000
069000*    ZEROLINE UPDATE CURSOR.                                    * 06900000
069100*---------------------------------------------------------------* 06910000
069200                                                                  06920000
069300     EXEC SQL                                                     06930000
069400          DECLARE ZEROLINE CURSOR                                 06940000
069500          FOR  SELECT                                             06950000
069600               ORD_NBR                                            06960000
069700              ,RCVR_SEQ_NBR                                       06970000
069800              ,ORD_LNE_NBR                                        06980000
069900              ,WORK_ORD_SEQ_NBR                                   06990000
070000              ,OPER_UNT_ID                                        07000000
070100              ,FCLTY_ID                                           07010000
070200              ,WO_INSTR_SEQ_NBR                                   07020000
070300              ,CRE_TMST                                           07030000
070400              ,VER_STATUS_CDE                                     07040000
070500              ,CRE_UID_ID                                         07050000
070600              ,OPER_ID                                            07060000
070700              ,FCLTY_AREA_ID                                      07070000
070800              ,PRC_FCLTY_AREA_ID                                  07080000
070900              ,EXPTED_CART_CNT                                    07090000
071000              ,ACTL_CART_CNT                                      07100000
071100              ,ALLOC_IND                                          07110000
071200              ,REPACK_IND                                         07120000
071300              ,STRT_TMST                                          07130000
071400              ,STOP_TMST                                          07140000
071500              ,SCREEN_SEQ_NBR                                     07150000
071600              ,LNE_LOC_CDE                                        07160000
071700              ,REC_SEL_IND                                        07170000
071800          FROM                                                    07180000
071900               TWKORIN                                            07190000
072000          WHERE                                                   07200000
072100               ORD_NBR          =  :ASC-KEY-PO-NBR                07210000
072200          AND  RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR          07220000
072300          AND  ORD_LNE_NBR      =  0                              07230000
072400          AND  OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID           07240000
072500          AND  FCLTY_ID         =  :ASC-KEY-FCLTY-ID              07250000
072600          AND  VER_STATUS_CDE   =  :PC-A                          07260000
072700          AND  STOP_TMST        >  :PV-DUMMY-TMST                 07270000
072800          FOR UPDATE OF                                           07280000
072900               REC_SEL_IND                                        07290000
073000             , STOP_TMST                                          07300000
073100             , STRT_TMST                                          07310000
073200             , CRE_UID_ID                                         07320000
073300      END-EXEC.                                                   07330000
073400                                                                  07340022
073500/                                                                 07350000
073600 LINKAGE SECTION.                                                 07360000
073700                                                                  07370000
073800 01  DFHCOMMAREA.                                                 07380000
073900     05  FILLER                         OCCURS  1 TO 4072 TIMES   07390000
074000                                        DEPENDING ON EIBCALEN.    07400000
074100         10  FILLER                     PIC X.                    07410000
074200                                                                  07420000
074300 PROCEDURE DIVISION.                                              07430000
074400**--------------------------------------------------------------**07440000
074500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **07450000
074600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **07460000
074700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **07470000
074800**--------------------------------------------------------------**07480000
074900                                                                  07490000
075000 0000-MAIN-MODULE.                                                07500000
075100                                                                  07510000
075200     INITIALIZE DP030-CICS-API-FIELDS.                            07520000
075300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07530000
075400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07540000
075500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07550000
075600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07560000
075700                                                                  07570000
075800     MOVE LENGTH OF PC154AI        TO DP030-MAP-LENGTH (1).       07580000
075900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07590000
076000     PERFORM 0001-CALL-CICS-ARCH-API.                             07600000
076100                                                                  07610000
076200     PERFORM 1000-CONTROL-PROCESSING                              07620000
076300                                                                  07630000
076400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07640000
076500     PERFORM 0001-CALL-CICS-ARCH-API.                             07650000
076600                                                                  07660000
076700*----------------------------------------------------------------*07670000
076800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *07680000
076900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *07690000
077000*----------------------------------------------------------------*07700000
077100                                                                  07710000
077200 0001-CALL-CICS-ARCH-API.                                         07720000
077300                                                                  07730000
077400*    CALL 'DPKCS030' USING DFHEIBLK                               07740067
077410     CALL DP930-CICS-ARCH-API                                     07741067
077420                     USING DFHEIBLK                               07742067
077500                           DFHCOMMAREA                            07750000
077600                           DP030-CICS-API-FIELDS                  07760000
077700                           DP020-STANDARD-COMMAREA                07770000
077800                           PC154AI.                               07780000
077900                                                                  07790000
078000     IF  DP030-RC-CALL-SUCCESSFUL                                 07800000
078100         CONTINUE                                                 07810000
078200     ELSE                                                         07820000
078300         SET DP013-NO-ROLLBACK                                    07830000
078400             DP013-XCTL-DISPLAY-RESTART                           07840000
078500             DP013-CICS-ABEND      TO TRUE                        07850000
078600         MOVE '0001-CALL-CICS-ARCH-API'                           07860000
078700                                   TO DP013-PARAGRAPH             07870000
078800*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX07880067
078900*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      07890067
078910         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07891067
078920-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07892067
079000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07900000
079100         PERFORM DP013-0000-PROCESS-ABEND                         07910000
079200     END-IF.                                                      07920000
079300                                                                  07930000
079400*----------------------------------------------------------------*07940000
079500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07950000
079600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07960000
079700*                                                                *07970000
079800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07980000
079900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07990000
080000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08000000
080100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08010000
080200*----------------------------------------------------------------*08020000
080300                                                                  08030000
080400 1000-CONTROL-PROCESSING.                                         08040000
080500                                                                  08050000
080600     EVALUATE TRUE                                                08060000
080700         WHEN DP020-NEXT-ACT-INITIAL                              08070000
080800              PERFORM 1100-FIND-OBJECT-KEYS                       08080000
080900              IF  PS-ERROR                                        08090000
081000                  CONTINUE                                        08100000
081100              ELSE                                                08110000
081200                  MOVE INTER-APPL-COMM-AREA                       08120000
081300                                   TO ASC-HOLD-INTER-APPL         08130000
081400                  MOVE EIBTRMID    TO ASC-LIST-TERM-ID            08140000
081500                                      ASC-SEL-TERM-ID2            08150000
081600                  MOVE DP020-SRC-TASK-NUMBER                      08160000
081700                                   TO ASC-LIST-TASK-NUMBER        08170000
081800                                      ASC-SEL-TASK-NUMBER2        08180000
081900                  MOVE PC-LIST-QUEUE-SEQ                          08190000
082000                                   TO ASC-LIST-SEQ                08200000
082100                  MOVE PC-SEL-QUEUE-SEQ2                          08210000
082200                                   TO ASC-SEL-SEQ2                08220000
082300                                                                  08230000
082400                  PERFORM 4000-BUILD-INITIAL-PANEL                08240000
082500                  IF  SQLCODE = +100                              08250000
082600                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       08260000
082700                  END-IF                                          08270000
082800                  IF  ASC-NUMBER-OF-ITEMS-READ = ZERO             08280000
082900                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       08290000
083000                  END-IF                                          08300000
083100              END-IF                                              08310000
083200                                                                  08320000
083300         WHEN DP020-NEXT-ACT-READ-MAP                             08330000
083400              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       08340000
083500                                   TO PV-TOP-ITEM                 08350000
083600              PERFORM 2000-PROCESS-PANEL                          08360000
083700                                                                  08370000
083800         WHEN DP020-NEXT-ACT-RETURN                               08380000
083900              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       08390000
084000                                   TO PV-TOP-ITEM                 08400000
084100              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    08410000
084200              MOVE ASC-HOLD-INTER-APPL                            08420000
084300                                   TO INTER-APPL-COMM-AREA        08430000
084400*                                                                 08440000
084500*    THIS PROGRAM REQUIRES THAT THE LIST QUEUE BE REBUILT UPON    08450000
084600*    RETURN FROM PCKCS155 (IF AN UPDATE OCCURRED).                08460000
084700*    THEREFORE, THE FOLLOWING IF TEST LOGIC IS NOT QUITE TYPICAL  08470000
084800*    OF THE MAJORITY OF LIST PROGRAMS.                            08480000
084900*                                                                 08490000
085000              PERFORM 2050-DELETE-LIST-QUEUE                      08500000
085100              PERFORM 4000-BUILD-INITIAL-PANEL                    08510000
085200                                                                  08520000
085300         WHEN OTHER                                               08530000
085400              SET DP013-LOGIC-ABEND                               08540000
085500                                   TO TRUE                        08550000
085600              SET DP013-NO-ROLLBACK                               08560000
085700                                   TO TRUE                        08570000
085800              MOVE '1000-CONTROL-PROCESSING'                      08580000
085900                                   TO DP013-PARAGRAPH             08590000
086000              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   08600000
086100                                   TO DP013-MESSAGE-TEXT(1)       08610000
086200              PERFORM DP013-0000-PROCESS-ABEND                    08620000
086300     END-EVALUATE.                                                08630000
086400                                                                  08640000
086500*----------------------------------------------------------------*08650000
086600*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *08660000
086700*  INTER-APPLICATION FORMAT CODE.                                *08670000
086800*----------------------------------------------------------------*08680000
086900                                                                  08690000
087000 1100-FIND-OBJECT-KEYS.                                           08700000
087100                                                                  08710000
087200     INITIALIZE ASC-SPECIFIC-COMMAREA.                            08720000
087300     MOVE DP020-INT-APPL-FORMAT-IND                               08730000
087400                                   TO ASC-INT-APPL-FORMAT-IND.    08740000
087500                                                                  08750000
087600     EVALUATE DP020-INT-APPL-FORMAT-IND                           08760000
087700         WHEN PC-INTER-APPL-CRIT-SPEC                             08770000
087800                                                                  08780000
087900              IF PC000-PO-NBR-N GREATER THAN ZERO                 08790000
088000                 MOVE PC000-PO-NBR-N                              08800000
088100                                   TO ASC-KEY-PO-NBR              08810000
088200              ELSE                                                08820000
088300                 MOVE PC-TSYMSG-00736                             08830000
088400                                   TO DP020-MSG-NUMBER            08840000
088500                 SET DP020-MSG-FATAL                              08850000
088600                     DP020-NEXT-ACT-APPL-ERROR                    08860000
088700                     DP020-FK-RETURN (DP020-SRC-AID)              08870000
088800                     PS-ERROR                                     08880000
088900                                   TO TRUE                        08890000
089000              END-IF                                              08900000
089100                                                                  08910000
089200              IF PC000-REC-SEQ-NBR-N GREATER THAN ZERO            08920000
089300                 MOVE PC000-REC-SEQ-NBR-N                         08930000
089400                                   TO ASC-KEY-RCVR-SEQ-NBR        08940000
089500              ELSE                                                08950000
089600                 MOVE PC-TSYMSG-00737                             08960000
089700                                   TO DP020-MSG-NUMBER            08970000
089800                 SET DP020-MSG-FATAL                              08980000
089900                     DP020-NEXT-ACT-APPL-ERROR                    08990000
090000                     DP020-FK-RETURN (DP020-SRC-AID)              09000000
090100                     PS-ERROR                                     09010000
090200                                   TO TRUE                        09020000
090300              END-IF                                              09030000
090400                                                                  09040000
090500              IF PC000-LINE-NBR-X = SPACES                        09050000
090600                 MOVE PC-TSYMSG-00738                             09060000
090700                                   TO DP020-MSG-NUMBER            09070000
090800                 SET DP020-MSG-FATAL                              09080000
090900                     DP020-NEXT-ACT-APPL-ERROR                    09090000
091000                     DP020-FK-RETURN (DP020-SRC-AID)              09100000
091100                     PS-ERROR                                     09110000
091200                                   TO TRUE                        09120000
091300              ELSE                                                09130000
091400                 MOVE PC000-LINE-NBR-N                            09140000
091500                                   TO ASC-KEY-LINE-NBR            09150000
091600              END-IF                                              09160000
091700                                                                  09170000
091800              IF PC000-WO-NBR-N GREATER THAN ZERO                 09180000
091900                 MOVE PC000-WO-NBR-N                              09190000
092000                                   TO ASC-KEY-WORK-ORD-SEQ-NBR    09200000
092100              ELSE                                                09210000
092200                 MOVE PC-TSYMSG-00739                             09220000
092300                                   TO DP020-MSG-NUMBER            09230000
092400                 SET DP020-MSG-FATAL                              09240000
092500                     DP020-NEXT-ACT-APPL-ERROR                    09250000
092600                     DP020-FK-RETURN (DP020-SRC-AID)              09260000
092700                     PS-ERROR                                     09270000
092800                                   TO TRUE                        09280000
092900              END-IF                                              09290000
093000                                                                  09300000
093100              MOVE PC000-OPERATING-UNIT-ID                        09310000
093200                                   TO ASC-KEY-OPER-UNT-ID         09320000
093300              MOVE PC000-FACILITY-ID                              09330000
093400                                   TO ASC-KEY-FCLTY-ID            09340000
093500                                                                  09350000
093600                                                                  09360000
093700         WHEN PC-INTER-APPL-LIST                                  09370000
093800              SET ASC-USE-SELECTION-QUEUE                         09380000
093900                                   TO TRUE                        09390000
094000              MOVE PC000-OPERATING-UNIT-ID                        09400000
094100                                   TO ASC-KEY-OPER-UNT-ID         09410000
094200              MOVE PC000-FACILITY-ID                              09420000
094300                                   TO ASC-KEY-FCLTY-ID            09430000
094400              MOVE PC000-NUMBER-OF-SELECTED-ITEMS                 09440000
094500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS09450000
094600              MOVE PC000-NUMBER-OF-TS-ITEMS                       09460000
094700                                   TO ASC-NUMBER-OF-TS-ITEMS      09470000
094800              MOVE PC000-SEL-QUEUE-NAME                           09480000
094900                                   TO ASC-SEL-QUEUE-NAME          09490000
095000              PERFORM 1120-PREPARE-LIST-ENTRY                     09500000
095100                                                                  09510000
095200         WHEN PC-INTER-APPL-RCVR-UPDATE                           09520000
095300              IF RC012-PO-NBR > ZERO                              09530000
095400                 MOVE RC012-PO-NBR TO ASC-KEY-PO-NBR              09540000
095500              ELSE                                                09550000
095600                 MOVE PC-TSYMSG-00736                             09560000
095700                                   TO DP020-MSG-NUMBER            09570000
095800                 SET DP020-MSG-FATAL                              09580000
095900                     DP020-NEXT-ACT-APPL-ERROR                    09590000
096000                     DP020-FK-RETURN (DP020-SRC-AID)              09600000
096100                     PS-ERROR      TO TRUE                        09610000
096200              END-IF                                              09620000
096300                                                                  09630000
096400              IF RC012-REC-SEQ-NBR > ZERO                         09640000
096500                 MOVE RC012-REC-SEQ-NBR                           09650000
096600                                   TO ASC-KEY-RCVR-SEQ-NBR        09660000
096700              ELSE                                                09670000
096800                 MOVE PC-TSYMSG-00737                             09680000
096900                                   TO DP020-MSG-NUMBER            09690000
097000                 SET DP020-MSG-FATAL                              09700000
097100                     DP020-NEXT-ACT-APPL-ERROR                    09710000
097200                     DP020-FK-RETURN (DP020-SRC-AID)              09720000
097300                     PS-ERROR      TO TRUE                        09730000
097400              END-IF                                              09740000
097500                                                                  09750000
097600              MOVE ZERO            TO ASC-KEY-LINE-NBR            09760000
097700              MOVE PC-ONE          TO ASC-KEY-WORK-ORD-SEQ-NBR    09770000
097800              MOVE RC012-OPER-UNT-ID                              09780000
097900                                   TO ASC-KEY-OPER-UNT-ID         09790000
098000              MOVE RC012-FCLTY-ID  TO ASC-KEY-FCLTY-ID            09800000
098100                                                                  09810000
098200              MOVE ASC-KEY-PO-NBR  TO PC000-PO-NBR-N              09820009
098300              MOVE ASC-KEY-RCVR-SEQ-NBR                           09830009
098400                                   TO PC000-REC-SEQ-NBR-N         09840009
098500              MOVE ASC-KEY-OPER-UNT-ID                            09850009
098600                                   TO PC000-OPERATING-UNIT-ID     09860009
098700              MOVE ASC-KEY-FCLTY-ID                               09870009
098800                                   TO PC000-FACILITY-ID           09880009
098900                                                                  09890009
099000         WHEN OTHER                                               09900000
099100              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            09910000
099200              SET DP020-MSG-FATAL                                 09920000
099300                  DP020-FK-RETURN (DP020-SRC-AID)                 09930000
099400                  PS-ERROR                                        09940000
099500                                   TO TRUE                        09950000
099600     END-EVALUATE.                                                09960000
099700                                                                  09970000
099800*----------------------------------------------------------------*09980000
099900* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *09990000
100000* STORAGE QUEUE PASSED FROM THE LIST.                            *10000000
100100*----------------------------------------------------------------*10010000
100200                                                                  10020000
100300 1120-PREPARE-LIST-ENTRY.                                         10030000
100400                                                                  10040000
100500     MOVE PC016-MAX-ITEMS          TO ASC-SEL-SUB.                10050000
100600     MOVE ZERO                     TO ASC-SEL-ITEM.               10060000
100700     PERFORM 2101-GET-NEXT-AREA.                                  10070000
100800                                                                  10080000
100900/                                                                 10090000
101000*----------------------------------------------------------------*10100000
101100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10110000
101200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10120000
101300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10130000
101400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10140000
101500* FUNCTION KEYS CAN GET THIS FAR.                                *10150000
101600*----------------------------------------------------------------*10160000
101700                                                                  10170000
101800 2000-PROCESS-PANEL.                                              10180000
101900                                                                  10190000
102000     IF  PC000-PO-NBR-N NOT GREATER THAN ZERO                     10200000
102100         MOVE ASC-HOLD-INTER-APPL  TO INTER-APPL-COMM-AREA        10210000
102200     END-IF.                                                      10220000
102300                                                                  10230000
102400     EVALUATE TRUE                                                10240000
102500         WHEN DP020-SRC-AID = DP016-CLEAR                         10250000
102600             MOVE ASC-HOLD-INTER-APPL                             10260000
102700                                   TO INTER-APPL-COMM-AREA        10270000
102800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10280000
102900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10290000
103000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10300000
103100                                                                  10310000
103200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10320000
103300             MOVE ASC-HOLD-INTER-APPL                             10330000
103400                                   TO INTER-APPL-COMM-AREA        10340000
103500             PERFORM 2050-DELETE-LIST-QUEUE                       10350000
103600             PERFORM 4000-BUILD-INITIAL-PANEL                     10360000
103700                                                                  10370000
103800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    10380000
103900             PERFORM 2140-DESELECT-ALL-ITEMS                      10390000
104000             PERFORM 3200-RESET-ATTRIBUTES                        10400000
104100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10410000
104200                                                                  10420000
104300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  10430000
104400             PERFORM 2150-SELECT-ALL-ITEMS                        10440000
104500             PERFORM 3200-RESET-ATTRIBUTES                        10450000
104600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10460000
104700                                                                  10470000
104800         WHEN OTHER                                               10480000
104900              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                10490000
105000                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              10500000
105100                  IF  PS-NO-ERROR                                 10510000
105200                      SET DP030-CONTINUE-GO                       10520000
105300                                   TO TRUE                        10530000
105400                      PERFORM 2100-CHECK-FUNCTION-KEY             10540000
105500                  ELSE                                            10550000
105600                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        10560000
105700                      SET DP030-OVERRIDE-GO                       10570000
105800                                   TO TRUE                        10580000
105900                  END-IF                                          10590000
106000     END-EVALUATE.                                                10600000
106100/                                                                 10610000
106200*----------------------------------------------------------------*10620000
106300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10630000
106400*----------------------------------------------------------------*10640000
106500 2050-DELETE-LIST-QUEUE.                                          10650000
106600                                                                  10660000
106700     EXEC CICS                                                    10670000
106800         DELETEQ TS                                               10680000
106900             QUEUE (ASC-LIST-QUEUE-NAME)                          10690000
107000             RESP  (PV-CICS-RESP)                                 10700000
107100     END-EXEC.                                                    10710000
107200                                                                  10720000
107300     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           10730000
107400     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          10740000
107500         CONTINUE                                                 10750000
107600     ELSE                                                         10760000
107700         SET DP013-CICS-ABEND      TO TRUE                        10770000
107800         SET DP013-NO-ROLLBACK     TO TRUE                        10780000
107900                                                                  10790000
108000         MOVE '2050-DELETE-LIST-QUEUE'                            10800000
108100                                   TO DP013-PARAGRAPH             10810000
108200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10820000
108300                                   TO DP013-MESSAGE-TEXT (1)      10830000
108400         PERFORM DP013-0000-PROCESS-ABEND                         10840000
108500     END-IF.                                                      10850000
108600                                                                  10860000
108700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10870000
108800/                                                                 10880000
108900*----------------------------------------------------------------*10890000
109000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10900000
109100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10910000
109200* CICS ARCHITECTURE API.                                         *10920000
109300*----------------------------------------------------------------*10930000
109400                                                                  10940000
109500 2100-CHECK-FUNCTION-KEY.                                         10950000
109600                                                                  10960000
109700     EVALUATE TRUE                                                10970000
109800         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               10980000
109900         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               10990000
110000         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               11000000
110100         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               11010000
110200              IF DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)            11020000
110300                  IF  ASC-KEY-LINE-NBR NOT = ZERO                 11030000
110400                      SET DP030-OVERRIDE-GO                       11040000
110500                                   TO TRUE                        11050000
110600                      MOVE PC-TSYMSG-00908                        11060000
110700                                   TO DP020-MSG-NUMBER            11070000
110800                      SET DP020-MSG-FATAL                         11080000
110900                                   TO TRUE                        11090000
111000                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        11100000
111100                  ELSE                                            11110000
111200                      IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO     11120000
111300                          MOVE ASC-NUMBER-OF-SELECTED-ITEMS       11130000
111400                                   TO PC017-SELECTED-ITEMS        11140000
111500                          PERFORM 5000-PREPARE-SEL-QUEUE          11150000
111600                          IF  PS-ERROR                            11160000
111700                              SET DP030-OVERRIDE-GO               11170000
111800                                   TO TRUE                        11180000
111900                              SET DP020-MSG-FATAL                 11190000
112000                                   TO TRUE                        11200000
112100                              PERFORM 3010-SET-SEL-ERROR          11210000
112200                              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN11220000
112300                          ELSE                                    11230000
112400                              PERFORM 5100-GET-MAX-WO-INSTR       11240000
112500                              IF  PV-WORK-ORD-INSTR-MAX =         11250000
112600                                  PV-WORK-ORD-INSTR-SELECTED      11260000
112700                              AND PV-WORK-ORD-INSTR-MAX-START >   11270000
112800                                  SPACES                          11280000
112811                                  MOVE ASC-KEY-PO-NBR             11281158
112812                                       TO PC000-PO-NBR-N          11281258
112813                                  MOVE ASC-KEY-RCVR-SEQ-NBR       11281358
112814                                       TO PC000-REC-SEQ-NBR-N     11281458
112815                                  MOVE ASC-KEY-OPER-UNT-ID        11281558
112816                                       TO PC000-OPERATING-UNIT-ID 11281658
112817                                  MOVE ASC-KEY-FCLTY-ID           11281758
112818                                       TO PC000-FACILITY-ID       11281858
112820                                  MOVE ASC-KEY-WORK-ORD-SEQ-NBR   11282058
112821                                       TO PC000-WO-NBR-N          11282158
113000                              ELSE                                11300000
113100                                  MOVE PC-TSYMSG-00909            11310000
113200                                      TO DP020-MSG-NUMBER         11320000
113300                                  SET DP020-MSG-FATAL             11330000
113400                                      DP030-OVERRIDE-GO           11340000
113500                                      TO TRUE                     11350000
113600                                  PERFORM                         11360000
113700                                      4400-MOVE-COMMAREA-TO-SCREEN11370000
113800                              END-IF                              11380000
113900                          END-IF                                  11390000
114000                      ELSE                                        11400000
114100                          SET DP030-OVERRIDE-GO                   11410000
114200                                   TO TRUE                        11420000
114300                          MOVE PC-TSYMSG-00057                    11430000
114400                                   TO DP020-MSG-NUMBER            11440000
114500                          SET DP020-MSG-WARNING                   11450000
114600                                   TO TRUE                        11460000
114700                          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN    11470000
114800                      END-IF                                      11480000
114900                  END-IF                                          11490000
115000              ELSE                                                11500000
115100                  IF  ASC-WO-COMPLETE                             11510000
115200                      SET DP030-OVERRIDE-GO                       11520000
115300                                   TO TRUE                        11530000
115400                      MOVE PC-TSYMSG-00910                        11540000
115500                                   TO DP020-MSG-NUMBER            11550000
115600                      SET DP020-MSG-FATAL                         11560000
115700                                   TO TRUE                        11570000
115800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        11580000
115900                  ELSE                                            11590000
116000                      IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO     11600000
116100                          MOVE ASC-NUMBER-OF-SELECTED-ITEMS       11610000
116200                                   TO PC017-SELECTED-ITEMS        11620000
116300                          PERFORM 5000-PREPARE-SEL-QUEUE          11630000
116400                          IF  PS-ERROR                            11640000
116500                              SET DP030-OVERRIDE-GO               11650000
116600                                   TO TRUE                        11660000
116700                              SET DP020-MSG-FATAL                 11670000
116800                                   TO TRUE                        11680000
116900                              PERFORM 3010-SET-SEL-ERROR          11690000
117000                              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN11700000
117100                          END-IF                                  11710000
117200                      ELSE                                        11720000
117300                          SET DP030-OVERRIDE-GO                   11730000
117400                                   TO TRUE                        11740000
117500                          MOVE PC-TSYMSG-00057                    11750000
117600                                   TO DP020-MSG-NUMBER            11760000
117700                          SET DP020-MSG-WARNING                   11770000
117800                                   TO TRUE                        11780000
117900                          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN    11790000
118000                      END-IF                                      11800000
118100                  END-IF                                          11810000
118200              END-IF                                              11820000
118300                                                                  11830000
118400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               11840000
118500              IF  ASC-WO-COMPLETE                                 11850000
118600                  SET DP030-OVERRIDE-GO                           11860000
118700                                   TO TRUE                        11870000
118800                  MOVE PC-TSYMSG-00910                            11880000
118900                                   TO DP020-MSG-NUMBER            11890000
119000                  SET DP020-MSG-FATAL                             11900000
119100                                   TO TRUE                        11910000
119200                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            11920000
119300              ELSE                                                11930000
119600                  IF ASC-KEY-LINE-NBR = PC-0                      11960000
119700                      SET PS-ZERO-LEVEL-WO-COMPLETE               11970000
119800                                   TO TRUE                        11980000
119900                  ELSE                                            11990000
120000                      SET PS-ZERO-LEVEL-WO-NOT-COMPLETE           12000025
120100                                   TO TRUE                        12010000
120200                  END-IF                                          12020000
120300                  IF PS-ZERO-LEVEL-WO-COMPLETE                    12030000
120400                      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +      12040000
120500                              ASC-ITEMS-DISPLAYED - 1             12050000
120600                      PERFORM 3100-SET-SUBSCRIPTS                 12060000
120700                      PERFORM 7000-PROCESS-START                  12070000
120800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12080000
120900                  ELSE                                            12090000
121000                      SET DP030-OVERRIDE-GO                       12100000
121100                                   TO TRUE                        12110000
121200                      MOVE PC-TSYMSG-00810                        12120000
121300                                   TO DP020-MSG-NUMBER            12130000
121400                      SET DP020-MSG-FATAL                         12140000
121500                                   TO TRUE                        12150000
121600                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12160000
121700                  END-IF                                          12170000
121800              END-IF                                              12180000
121900                                                                  12190000
122000                                                                  12200026
122100         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               12210026
122200              IF  ASC-WO-COMPLETE                                 12220026
122300                  SET DP030-OVERRIDE-GO                           12230026
122400                                   TO TRUE                        12240026
122500                  MOVE PC-TSYMSG-00910                            12250026
122600                                   TO DP020-MSG-NUMBER            12260026
122700                  SET DP020-MSG-FATAL                             12270026
122800                                   TO TRUE                        12280026
122900                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            12290026
123000              ELSE                                                12300026
123100                  IF  ASC-KEY-LINE-NBR = 0                        12310037
123200                      SET DP030-OVERRIDE-GO                       12320026
123300                                       TO TRUE                    12330026
123400                      MOVE PC-TSYMSG-02834                        12340026
123500                                       TO DP020-MSG-NUMBER        12350026
123600                      SET DP020-MSG-FATAL                         12360026
123700                                       TO TRUE                    12370026
123800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12380026
123900                  ELSE                                            12390026
124000                      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +      12400026
124100                              ASC-ITEMS-DISPLAYED - 1             12410026
124200                      PERFORM 3100-SET-SUBSCRIPTS                 12420026
124300                      PERFORM 7200-PROCESS-STOP                   12430026
124400                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12440026
124500                  END-IF                                          12450026
124600              END-IF                                              12460026
124700                                                                  12470000
124800                                                                  12480019
124900         WHEN DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)               12490019
125000         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     12500025
125100              COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +              12510023
125200                      ASC-ITEMS-DISPLAYED - 1                     12520023
125300              PERFORM 3100-SET-SUBSCRIPTS                         12530023
125400              PERFORM 7400-PROCESS-RESTART                        12540023
125500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                12550023
125600                                                                  12560023
125700         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              12570017
125800             PERFORM 2105-PREPARE-INTER-APPL-COMM                 12580017
125900                                                                  12590017
126000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12600000
126100             MOVE +1               TO PV-TOP-ITEM                 12610000
126200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12620000
126300                                                                  12630000
126400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12640000
126500             PERFORM 2110-BROWSE-BACKWARD                         12650000
126600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12660000
126700                                                                  12670000
126800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12680000
126900             PERFORM 2120-BROWSE-FORWARD                          12690000
127000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12700000
127100                                                                  12710000
127200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             12720000
127300              IF  ASC-USE-SELECTION-QUEUE                         12730000
127400                  PERFORM 2101-GET-NEXT-AREA                      12740000
127500                  PERFORM 3200-RESET-ATTRIBUTES                   12750000
127600                  PERFORM 4000-BUILD-INITIAL-PANEL                12760000
127700              ELSE                                                12770000
127800*                 --- BOTTOM OF LIST ---                          12780000
127900                  MOVE PC-TSYMSG-00070                            12790000
128000                                   TO DP020-MSG-NUMBER            12800000
128100                  SET DP020-MSG-INFORMATIONAL                     12810000
128200                                   TO TRUE                        12820000
128300                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            12830000
128400              END-IF                                              12840000
128500                                                                  12850000
128600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             12860000
128700              IF  ASC-USE-SELECTION-QUEUE                         12870000
128800                  PERFORM 2102-GET-PREV-AREA                      12880000
128900                  PERFORM 3200-RESET-ATTRIBUTES                   12890000
129000                  PERFORM 4000-BUILD-INITIAL-PANEL                12900000
129100              ELSE                                                12910000
129200*                 --- TOP OF LIST ---                             12920000
129300                  MOVE PC-TSYMSG-00069                            12930000
129400                                   TO DP020-MSG-NUMBER            12940000
129500                  SET DP020-MSG-INFORMATIONAL                     12950000
129600                                   TO TRUE                        12960000
129700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            12970000
129800              END-IF                                              12980000
129900                                                                  12990000
130000         WHEN DP020-SRC-AID = DP016-ENTER                         13000000
130100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13010000
130200                                                                  13020000
130300         WHEN OTHER                                               13030000
130400             SET DP013-NO-ROLLBACK                                13040000
130500                 DP013-XCTL-DISPLAY-RESTART                       13050000
130600                 DP013-CICS-ABEND  TO TRUE                        13060000
130700             MOVE '2100-CHECK-FUNCTION-KEY'                       13070000
130800                                   TO DP013-PARAGRAPH             13080000
130900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      13090000
131000                                   TO DP013-MESSAGE-TEXT (1)      13100000
131100             PERFORM DP013-0000-PROCESS-ABEND                     13110000
131200     END-EVALUATE.                                                13120000
131300                                                                  13130000
131400*----------------------------------------------------------------*13140000
131500*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *13150000
131600*----------------------------------------------------------------*13160000
131700                                                                  13170000
131800 2101-GET-NEXT-AREA.                                              13180000
131900                                                                  13190000
132000     ADD +1                        TO ASC-SEL-SUB.                13200000
132100     IF  ASC-SEL-SUB > PC016-MAX-ITEMS                            13210000
132200         ADD +1                    TO ASC-SEL-ITEM                13220000
132300         MOVE +1                   TO ASC-SEL-SUB                 13230000
132400     END-IF.                                                      13240000
132500                                                                  13250000
132600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                13260000
132700         PERFORM 9100-READ-SEL-QUEUE                              13270000
132800         IF  PC016-ITEM (ASC-SEL-SUB) > ZERO                      13280000
132900             MOVE PC016-PO-NBR-N (ASC-SEL-SUB)                    13290000
133000                                   TO ASC-KEY-PO-NBR              13300000
133100             MOVE PC016-REC-SEQ-NBR-N (ASC-SEL-SUB)               13310000
133200                                   TO ASC-KEY-RCVR-SEQ-NBR        13320000
133300             MOVE PC016-LINE-NBR-N (ASC-SEL-SUB)                  13330000
133400                                   TO ASC-KEY-LINE-NBR            13340000
133500             MOVE PC016-WO-NBR-N (ASC-SEL-SUB)                    13350000
133600                                   TO ASC-KEY-WORK-ORD-SEQ-NBR    13360000
133700             SET PC016-INQ (ASC-SEL-SUB)                          13370000
133800                                   TO TRUE                        13380000
133900             PERFORM 9200-REWRITE-LIST-QUEUE                      13390000
134000         ELSE                                                     13400000
134100             SUBTRACT +1 FROM ASC-SEL-SUB                         13410000
134200*            --- BOTTOM OF LIST ---                               13420000
134300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13430000
134400             SET DP020-MSG-INFORMATIONAL                          13440000
134500                                   TO TRUE                        13450000
134600         END-IF                                                   13460000
134700     ELSE                                                         13470000
134800         SUBTRACT +1 FROM ASC-SEL-ITEM                            13480000
134900         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 13490000
135000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13500000
135100         SET DP020-MSG-INFORMATIONAL                              13510000
135200                                   TO TRUE                        13520000
135300     END-IF.                                                      13530000
135400                                                                  13540000
135500*----------------------------------------------------------------*13550000
135600*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *13560000
135700*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *13570000
135800*----------------------------------------------------------------*13580000
135900                                                                  13590000
136000 2102-GET-PREV-AREA.                                              13600000
136100                                                                  13610000
136200     SUBTRACT +1 FROM ASC-SEL-SUB.                                13620000
136300     IF  ASC-SEL-SUB < +1                                         13630000
136400         SUBTRACT +1 FROM ASC-SEL-ITEM                            13640000
136500         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 13650000
136600     END-IF.                                                      13660000
136700                                                                  13670000
136800     IF  ASC-SEL-ITEM > ZERO                                      13680000
136900         PERFORM 9100-READ-SEL-QUEUE                              13690000
137000         MOVE PC016-PO-NBR-N (ASC-SEL-SUB)                        13700000
137100                                   TO ASC-KEY-PO-NBR              13710000
137200         MOVE PC016-REC-SEQ-NBR-N (ASC-SEL-SUB)                   13720000
137300                                   TO ASC-KEY-RCVR-SEQ-NBR        13730000
137400         MOVE PC016-LINE-NBR-N (ASC-SEL-SUB)                      13740000
137500                                   TO ASC-KEY-LINE-NBR            13750000
137600         MOVE PC016-WO-NBR-N (ASC-SEL-SUB)                        13760000
137700                                   TO ASC-KEY-WORK-ORD-SEQ-NBR    13770000
137800     ELSE                                                         13780000
137900         MOVE +1                   TO ASC-SEL-ITEM                13790000
138000                                      ASC-SEL-SUB                 13800000
138100*        --- TOP OF LIST ---                                      13810000
138200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13820000
138300         SET DP020-MSG-INFORMATIONAL                              13830000
138400                                   TO TRUE                        13840000
138500     END-IF.                                                      13850000
138600                                                                  13860000
138700******************************************************************13870017
138800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **13880017
138900** INTER-APPLICATION COMMAREA.                                    13890017
139000******************************************************************13900017
139100                                                                  13910017
139200 2105-PREPARE-INTER-APPL-COMM.                                    13920017
139300                                                                  13930017
139400     INITIALIZE RC015-INTER-APPL-COMMAREA.                        13940017
139500     MOVE ASC-KEY-OPER-UNT-ID    TO RC015-OPER-UNT-ID.            13950018
139600     MOVE ASC-KEY-FCLTY-ID       TO RC015-FCLTY-ID.               13960018
139700     MOVE ASC-KEY-PO-NBR         TO RC015-PO-NBR                  13970018
139800     MOVE ASC-KEY-RCVR-SEQ-NBR   TO RC015-REC-SEQ-NBR             13980018
139900     MOVE ASC-KEY-LINE-NBR       TO RC015-PO-LNE-NBR.             13990018
140000     MOVE ASC-SEL-QUEUE-NAME     TO RC015-SEL-QUEUE-NAME.         14000017
140100                                                                  14010017
140200*----------------------------------------------------------------*14020000
140300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14030000
140400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14040000
140500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14050000
140600*    MESSAGE.                                                    *14060000
140700*----------------------------------------------------------------*14070000
140800                                                                  14080000
140900 2110-BROWSE-BACKWARD.                                            14090000
141000                                                                  14100000
141100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14110000
141200         GIVING PV-TOP-ITEM.                                      14120000
141300                                                                  14130000
141400     IF  ((PV-TOP-ITEM < +1)                                      14140000
141500       OR (PV-TOP-ITEM = +1))                                     14150000
141600         MOVE +1                   TO PV-TOP-ITEM                 14160000
141700*        -- TOP OF LIST --                                        14170000
141800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14180000
141900         SET DP020-MSG-INFORMATIONAL TO TRUE                      14190000
142000     END-IF.                                                      14200000
142100                                                                  14210000
142200/                                                                 14220000
142300*----------------------------------------------------------------*14230000
142400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14240000
142500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14250000
142600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14260000
142700*----------------------------------------------------------------*14270000
142800                                                                  14280000
142900 2120-BROWSE-FORWARD.                                             14290000
143000                                                                  14300000
143100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14310000
143200         GIVING PV-TOP-ITEM.                                      14320000
143300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   14330000
143400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14340000
143500                                   TO PV-TOP-ITEM                 14350000
143600*        -- BOTTOM OF LIST --                                     14360000
143700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14370000
143800         SET DP020-MSG-INFORMATIONAL                              14380000
143900                                   TO TRUE                        14390000
144000     ELSE                                                         14400000
144100         COMPUTE PV-BOTTOM-ITEM =                                 14410000
144200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 14420000
144300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            14430000
144400*            -- BOTTOM OF LIST --                                 14440000
144500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14450000
144600             SET DP020-MSG-INFORMATIONAL                          14460000
144700                                   TO TRUE                        14470000
144800         END-IF                                                   14480000
144900     END-IF.                                                      14490000
145000/                                                                 14500000
145100*----------------------------------------------------------------*14510000
145200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14520000
145300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14530000
145400*----------------------------------------------------------------*14540000
145500                                                                  14550000
145600 2140-DESELECT-ALL-ITEMS.                                         14560000
145700                                                                  14570000
145800     MOVE +1                       TO ASC-BLK-SUB.                14580000
145900                                                                  14590000
146000     PERFORM 2141-CLEAR-SELECTED-INDS                             14600000
146100         VARYING ASC-ITEM-SUB                                     14610000
146200         FROM 1 BY 1                                              14620000
146300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14630000
146400                                                                  14640000
146500     ADD +1                        TO ASC-BLK-SUB.                14650000
146600                                                                  14660000
146700     PERFORM 2141-CLEAR-SELECTED-INDS                             14670000
146800         VARYING ASC-ITEM-SUB                                     14680000
146900         FROM 1 BY 1                                              14690000
147000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14700000
147100                                                                  14710000
147200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14720000
147300                                   TO PV-LIST-ITEM-NUMBER.        14730000
147400                                                                  14740000
147500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14750000
147600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14760000
147700                                                                  14770000
147800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14780000
147900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14790000
148000         MOVE +1                   TO ASC-BLK-SUB                 14800000
148100                                                                  14810000
148200         PERFORM 8100-WRITE-TEMP-STORAGE                          14820000
148300                                                                  14830000
148400         MOVE +1                   TO PV-BLOCK-NUMBER             14840000
148500                                                                  14850000
148600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14860000
148700             PV-FIRST-BLOCK-IN-ARRAY - 1                          14870000
148800                                                                  14880000
148900         PERFORM                                                  14890000
149000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14900000
149100                                                                  14910000
149200             PERFORM 4410-READ-TEMP-STORAGE                       14920000
149300                                                                  14930000
149400             PERFORM 2141-CLEAR-SELECTED-INDS                     14940000
149500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 14950000
149600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14960000
149700                                                                  14970000
149800             PERFORM 8100-WRITE-TEMP-STORAGE                      14980000
149900                                                                  14990000
150000             ADD +1                TO PV-BLOCK-NUMBER             15000000
150100                                                                  15010000
150200         END-PERFORM                                              15020000
150300                                                                  15030000
150400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15040000
150500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15050000
150600                                                                  15060000
150700         PERFORM                                                  15070000
150800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15080000
150900                   ASC-HIGHEST-BLOCK-WRITTEN                      15090000
151000                                                                  15100000
151100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15110000
151200                                   TO PV-BLOCK-NUMBER             15120000
151300                                                                  15130000
151400             PERFORM 4410-READ-TEMP-STORAGE                       15140000
151500                                                                  15150000
151600             PERFORM 2141-CLEAR-SELECTED-INDS                     15160000
151700                 VARYING ASC-ITEM-SUB                             15170000
151800                 FROM 1 BY 1                                      15180000
151900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15190000
152000                                                                  15200000
152100             PERFORM 8100-WRITE-TEMP-STORAGE                      15210000
152200                                                                  15220000
152300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15230000
152400                                                                  15240000
152500         END-PERFORM                                              15250000
152600                                                                  15260000
152700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15270000
152800                                   TO PV-BLOCK-NUMBER             15280000
152900                                                                  15290000
153000         PERFORM 4410-READ-TEMP-STORAGE                           15300000
153100     END-IF.                                                      15310000
153200                                                                  15320000
153300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 15330000
153400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.15340000
153500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  15350000
153600                                                                  15360000
153700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15370000
153800                                                                  15380000
153900/                                                                 15390000
154000*----------------------------------------------------------------*15400000
154100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15410000
154200*----------------------------------------------------------------*15420000
154300                                                                  15430000
154400 2141-CLEAR-SELECTED-INDS.                                        15440000
154500                                                                  15450000
154600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15460000
154700             NOT EQUAL ZERO                                       15470000
154800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15480000
154900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15490000
155000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15500000
155100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15510000
155200                                   TO TRUE                        15520000
155300         END-IF                                                   15530000
155400     END-IF.                                                      15540000
155500                                                                  15550000
155600/                                                                 15560000
155700*----------------------------------------------------------------*15570000
155800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15580000
155900*  FOR ALL ITEMS.                                                *15590000
156000*----------------------------------------------------------------*15600000
156100                                                                  15610000
156200 2150-SELECT-ALL-ITEMS.                                           15620000
156300                                                                  15630000
156400     MOVE +1                       TO ASC-BLK-SUB.                15640000
156500                                                                  15650000
156600     PERFORM 2151-SET-SELECTED-INDS                               15660000
156700         VARYING ASC-ITEM-SUB                                     15670000
156800         FROM 1 BY 1                                              15680000
156900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15690000
157000                                                                  15700000
157100     ADD +1                        TO ASC-BLK-SUB.                15710000
157200                                                                  15720000
157300     PERFORM 2151-SET-SELECTED-INDS                               15730000
157400         VARYING ASC-ITEM-SUB                                     15740000
157500         FROM 1 BY 1                                              15750000
157600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15760000
157700                                                                  15770000
157800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15780000
157900                                   TO PV-LIST-ITEM-NUMBER.        15790000
158000                                                                  15800000
158100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15810000
158200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15820000
158300                                                                  15830000
158400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15840000
158500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15850000
158600         MOVE +1                   TO ASC-BLK-SUB                 15860000
158700                                                                  15870000
158800         PERFORM 8100-WRITE-TEMP-STORAGE                          15880000
158900                                                                  15890000
159000         MOVE +1                   TO PV-BLOCK-NUMBER             15900000
159100                                                                  15910000
159200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15920000
159300             PV-FIRST-BLOCK-IN-ARRAY - 1                          15930000
159400                                                                  15940000
159500         PERFORM                                                  15950000
159600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15960000
159700                                                                  15970000
159800             PERFORM 4410-READ-TEMP-STORAGE                       15980000
159900                                                                  15990000
160000             PERFORM 2151-SET-SELECTED-INDS                       16000000
160100                 VARYING ASC-ITEM-SUB                             16010000
160200                 FROM 1 BY 1                                      16020000
160300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16030000
160400                                                                  16040000
160500             PERFORM 8100-WRITE-TEMP-STORAGE                      16050000
160600                                                                  16060000
160700             ADD +1                TO PV-BLOCK-NUMBER             16070000
160800                                                                  16080000
160900         END-PERFORM                                              16090000
161000                                                                  16100000
161100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16110000
161200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16120000
161300                                                                  16130000
161400         PERFORM                                                  16140000
161500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16150000
161600                   ASC-HIGHEST-BLOCK-WRITTEN                      16160000
161700                                                                  16170000
161800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16180000
161900                                   TO PV-BLOCK-NUMBER             16190000
162000                                                                  16200000
162100             PERFORM 4410-READ-TEMP-STORAGE                       16210000
162200                                                                  16220000
162300             PERFORM 2151-SET-SELECTED-INDS                       16230000
162400                 VARYING ASC-ITEM-SUB                             16240000
162500                 FROM 1 BY 1                                      16250000
162600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16260000
162700                                                                  16270000
162800             PERFORM 8100-WRITE-TEMP-STORAGE                      16280000
162900                                                                  16290000
163000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16300000
163100                                                                  16310000
163200         END-PERFORM                                              16320000
163300                                                                  16330000
163400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16340000
163500                                   TO PV-BLOCK-NUMBER             16350000
163600                                                                  16360000
163700         PERFORM 4410-READ-TEMP-STORAGE                           16370000
163800     END-IF.                                                      16380000
163900                                                                  16390000
164000                                                                  16400000
164100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16410000
164200                       ASC-NUMBER-OF-SELECTED-ITEMS.              16420000
164300                                                                  16430000
164400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16440000
164500                                                                  16450000
164600/                                                                 16460000
164700*----------------------------------------------------------------*16470000
164800*    MARK EACH ITEM AS BEING SELECTED.                           *16480000
164900*----------------------------------------------------------------*16490000
165000                                                                  16500000
165100 2151-SET-SELECTED-INDS.                                          16510000
165200                                                                  16520000
165300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16530000
165400             NOT EQUAL ZERO                                       16540000
165500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16550000
165600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16560000
165700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16570000
165800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16580000
165900                                   TO TRUE                        16590000
166000         END-IF                                                   16600000
166100     END-IF.                                                      16610000
166200                                                                  16620000
166300*----------------------------------------------------------------*16630000
166400*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *16640000
166500*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *16650000
166600*----------------------------------------------------------------*16660000
166700                                                                  16670000
166800 2200-MOVE-SCREEN-TO-COMMAREA.                                    16680000
166900                                                                  16690000
167000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16700000
167100     MOVE +1                       TO PV-SUB.                     16710000
167200                                                                  16720000
167300     INITIALIZE ASC-START-ITEM-REQUEST.                           16730000
167400                                                                  16740000
167500     PERFORM 3100-SET-SUBSCRIPTS.                                 16750000
167600                                                                  16760000
167700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16770000
167800         VARYING PV-SUB                                           16780000
167900         FROM 1 BY 1                                              16790000
168000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16800000
168100                                                                  16810000
168200******************************************************************16820000
168300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**16830000
168400******************************************************************16840000
168500                                                                  16850000
168600 2210-MOVE-LINES-TO-COMMAREA.                                     16860000
168700                                                                  16870000
168800     IF  MR-SELECTL (PV-SUB) > ZERO                               16880000
168900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             16890000
169000         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        16900000
169100                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 16910000
169200     ELSE                                                         16920000
169300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16930000
169400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16940000
169500             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        16950000
169600                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 16960000
169700         END-IF                                                   16970000
169800     END-IF.                                                      16980000
169900                                                                  16990000
170000     ADD +1                        TO ASC-ITEM-SUB.               17000000
170100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17010000
170200         ADD +1                    TO ASC-BLK-SUB                 17020000
170300         MOVE +1                   TO ASC-ITEM-SUB                17030000
170400     END-IF.                                                      17040000
170500                                                                  17050000
170600*----------------------------------------------------------------*17060000
170700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *17070000
170800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *17080000
170900*----------------------------------------------------------------*17090000
171000                                                                  17100000
171100 3000-EDIT-DATA-IN-COMMAREA.                                      17110000
171200                                                                  17120000
171300     SET PS-NO-ERROR               TO TRUE.                       17130000
171400     PERFORM 3200-RESET-ATTRIBUTES.                               17140000
171500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17150000
171600**                                                                17160000
171700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17170000
171800* EDITTING IS DONE FROM THE BOTTOM UP.                            17180000
171900**                                                                17190000
172000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17200000
172100         ASC-ITEMS-DISPLAYED - 1.                                 17210000
172200     PERFORM 3100-SET-SUBSCRIPTS.                                 17220000
172300     PERFORM 3300-EDIT-SELECTIONS                                 17230000
172400         VARYING PV-SUB                                           17240000
172500         FROM PV-SUB BY -1                                        17250000
172600         UNTIL PV-SUB < +1.                                       17260000
172700                                                                  17270000
172800     IF  ASC-NUMBER-OF-SELECTED-ITEMS GREATER +1                  17280000
172900         MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER            17290000
173000         SET DP020-MSG-FATAL                                      17300000
173100             DP030-SET-CURSOR-APPL-1                              17310000
173200             PS-ERROR              TO TRUE                        17320000
173300         PERFORM 3010-SET-SEL-ERROR                               17330000
173400     END-IF.                                                      17340000
173500                                                                  17350000
173600 3010-SET-SEL-ERROR.                                              17360000
173700                                                                  17370000
173800     PERFORM VARYING PV-SUB                                       17380000
173900             FROM 1 BY 1                                          17390000
174000             UNTIL PV-SUB GREATER PC-ITEMS-PER-PANEL              17400000
174100                                                                  17410000
174200              IF  PV-SELECT-ITEM-ENTRY (PV-SUB) EQUAL PC-Y        17420000
174300                 MOVE -1           TO MR-SELECTL (PV-SUB)         17430000
174400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         17440000
174500                 MOVE DP015-REVERSE                               17450000
174600                                   TO MR-SELECTH (PV-SUB)         17460000
174700             END-IF                                               17470000
174800                                                                  17480000
174900     END-PERFORM.                                                 17490000
175000/                                                                 17500000
175100*----------------------------------------------------------------*17510000
175200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17520000
175300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17530000
175400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17540000
175500*                                                                *17550000
175600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17560000
175700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17570000
175800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17580000
175900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17590000
176000*----------------------------------------------------------------*17600000
176100                                                                  17610000
176200 3100-SET-SUBSCRIPTS.                                             17620000
176300                                                                  17630000
176400     COMPUTE ASC-ITEM-SUB =                                       17640000
176500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17650000
176600                                                                  17660000
176700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17670000
176800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17680000
176900                                                                  17690000
177000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              17700000
177100                                   TO ASC-BLK-SUB                 17710000
177200     ELSE                                                         17720000
177300         MOVE +1                   TO ASC-BLK-SUB                 17730000
177400     END-IF.                                                      17740000
177500                                                                  17750000
177600*----------------------------------------------------------------*17760000
177700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *17770000
177800*----------------------------------------------------------------*17780000
177900                                                                  17790000
178000 3200-RESET-ATTRIBUTES.                                           17800000
178100                                                                  17810000
178200     PERFORM                                                      17820000
178300         VARYING PV-SUB                                           17830000
178400         FROM 1 BY 1                                              17840000
178500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        17850000
178600         MOVE DP015-UNP-ALP-NOR-OFF                               17860000
178700                                   TO MR-SELECTA (PV-SUB)         17870000
178800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         17880000
178900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         17890000
179000     END-PERFORM.                                                 17900000
179100                                                                  17910000
179200*----------------------------------------------------------------*17920000
179300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *17930000
179400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *17940000
179500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *17950000
179600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *17960000
179700*----------------------------------------------------------------*17970000
179800                                                                  17980000
179900 3300-EDIT-SELECTIONS.                                            17990000
180000                                                                  18000000
180100     EVALUATE TRUE                                                18010000
180200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18020000
180300              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)        18030000
180400              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)           18040000
180500                  MOVE PC-Y       TO PV-SELECT-ITEM-ENTRY (PV-SUB)18050000
180600              END-IF                                              18060000
180700                                                                  18070000
180800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18080000
180900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18090000
181000                 ADD +1           TO ASC-NUMBER-OF-SELECTED-ITEMS 18100000
181100                 MOVE PC-Y        TO PV-SELECT-ITEM-ENTRY (PV-SUB)18110000
181200                 MOVE ASC-TEMP-SELECTED-SW                        18120000
181300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18130000
181400                                  TO ASC-SELECTED-SW              18140000
181500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18150000
181600             END-IF                                               18160000
181700                                                                  18170000
181800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18180000
181900                 = SPACE                                          18190000
182000             EVALUATE TRUE                                        18200000
182100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       18210000
182200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18220000
182300                     MOVE SPACE   TO ASC-SELECTED-SW              18230000
182400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18240000
182500             END-EVALUATE                                         18250000
182600                                                                  18260000
182700         WHEN OTHER                                               18270000
182800             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             18280000
182900             SET DP020-MSG-FATAL  TO TRUE                         18290000
183000             MOVE -1              TO MR-SELECTL (PV-SUB)          18300000
183100             SET DP030-SET-CURSOR-APPL-1                          18310000
183200                                  TO TRUE                         18320000
183300             MOVE DP015-RED       TO MR-SELECTC (PV-SUB)          18330000
183400             MOVE DP015-REVERSE   TO MR-SELECTH (PV-SUB)          18340000
183500             SET PS-ERROR         TO TRUE                         18350000
183600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18360000
183700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18370000
183800                 MOVE SPACE       TO ASC-SELECTED-SW              18380000
183900                                        (ASC-BLK-SUB ASC-ITEM-SUB)18390000
184000             END-IF                                               18400000
184100                                                                  18410000
184200     END-EVALUATE.                                                18420000
184300                                                                  18430000
184400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18440000
184500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18450000
184600     IF  ASC-ITEM-SUB < 1                                         18460000
184700         SUBTRACT +1 FROM ASC-BLK-SUB                             18470000
184800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18480000
184900     END-IF.                                                      18490000
185000                                                                  18500000
185100/                                                                 18510000
185200*----------------------------------------------------------------*18520000
185300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18530000
185400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18540000
185500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18550000
185600*    DISPLAY THE PANEL TO USER.                                  *18560000
185700*----------------------------------------------------------------*18570000
185800                                                                  18580000
185900 4000-BUILD-INITIAL-PANEL.                                        18590000
186000                                                                  18600000
186100     PERFORM 5120-DELETE-ASC-LISTQ.                               18610000
186200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18620000
186300                                 ASC-BLOCK-ENTRIES (2).           18630000
186400     MOVE +1                      TO ASC-BLK-SUB.                 18640000
186500     SET ASC-ITEMS-LEFT-ON-DB     TO TRUE.                        18650000
186600                                                                  18660000
186700     MOVE +0                      TO ASC-ITEM-SUB                 18670000
186800                                ASC-NUMBER-OF-ITEMS-READ          18680000
186900                                ASC-NUMBER-OF-SELECTED-ITEMS      18690000
187000                                ASC-HIGHEST-BLOCK-WRITTEN         18700000
187100                                ASC-START-OF-SELECTED-RANGE       18710000
187200                                ASC-END-OF-SELECTED-RANGE         18720000
187300                                ASC-ITEM-AT-TOP-OF-PANEL.         18730000
187400                                                                  18740000
187500     PERFORM 4100-PREPARE-CURSOR.                                 18750000
187600                                                                  18760000
187700     PERFORM 4200-GET-FIRST-DATA.                                 18770000
187800     IF  PS-DATA-OK                                               18780000
187900         PERFORM 4005-CONTINUE-BUILD                              18790000
188000     ELSE                                                         18800000
188100         SET DP020-MSG-FATAL      TO TRUE                         18810000
188200         SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE              18820000
188300     END-IF.                                                      18830000
188400                                                                  18840000
188500 4005-CONTINUE-BUILD.                                             18850000
188600                                                                  18860000
188700     PERFORM 4010-OPEN-CURSOR.                                    18870000
188800                                                                  18880000
188900     PERFORM 4300-READ-ITEMS-FROM-DB.                             18890000
189000                                                                  18900000
189100     PERFORM 4020-CLOSE-CURSOR.                                   18910000
189200                                                                  18920000
189300     MOVE +1                       TO PV-TOP-ITEM.                18930000
189400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     18940000
189500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18950000
189600         SET DP020-MSG-FATAL       TO TRUE                        18960000
189700         SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE              18970000
189800         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            18980000
189900     ELSE                                                         18990000
190000         MOVE -1                   TO MR-SELECTL (1)              19000000
190100         SET DP030-SET-CURSOR-APPL-1                              19010000
190200                                   TO TRUE                        19020000
190300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19030000
190400     END-IF.                                                      19040000
190500/                                                                 19050000
190600*----------------------------------------------------------------*19060000
190700* OPEN THE CURSOR.                                               *19070000
190800*----------------------------------------------------------------*19080000
190900                                                                  19090000
191000 4010-OPEN-CURSOR.                                                19100000
191100                                                                  19110000
191200     EXEC SQL                                                     19120000
191300          OPEN LIST-CSR                                           19130000
191400     END-EXEC                                                     19140000
191500                                                                  19150000
191600     EVALUATE TRUE                                                19160000
191700         WHEN SQLCODE = ZERO                                      19170000
191800             CONTINUE                                             19180000
191900         WHEN SQLCODE = -904                                      19190000
192000         WHEN SQLCODE = -911                                      19200000
192100         WHEN SQLCODE = -913                                      19210000
192200             PERFORM 9900-SOFT-ABORT                              19220000
192300         WHEN SQLWARN0 NOT = SPACES                               19230000
192400         WHEN SQLCODE < ZERO                                      19240000
192500         WHEN SQLCODE > ZERO                                      19250000
192600             MOVE '4010-OPEN-CURSOR'                              19260000
192700                               TO DP013-PARAGRAPH                 19270000
192800             MOVE 'OPEN LINE CURSOR - '                           19280000
192900                               TO DP013-MESSAGE-TEXT (1)          19290000
193000             MOVE SQLCA        TO DP013-SQLCA                     19300000
193100             MOVE 'TOPERAT '   TO DP013-DB2-TABLE-NAME (1)        19310000
193200             MOVE 'TWKORIN'    TO DP013-DB2-TABLE-NAME (2)        19320000
193300             SET DP013-DB2-ABEND                                  19330000
193400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19340000
193500             PERFORM DP013-0000-PROCESS-ABEND                     19350000
193600     END-EVALUATE.                                                19360000
193700/                                                                 19370000
193800*----------------------------------------------------------------*19380000
193900*                                                                *19390000
194000* CLOSE THE LINE CURSOR.                                         *19400000
194100*                                                                *19410000
194200*----------------------------------------------------------------*19420000
194300                                                                  19430000
194400 4020-CLOSE-CURSOR.                                               19440000
194500                                                                  19450000
194600     EXEC SQL                                                     19460000
194700          CLOSE LIST-CSR                                          19470000
194800     END-EXEC.                                                    19480000
194900                                                                  19490000
195000     EVALUATE TRUE                                                19500000
195100         WHEN SQLCODE = ZERO                                      19510000
195200             CONTINUE                                             19520000
195300         WHEN SQLCODE = -904                                      19530000
195400         WHEN SQLCODE = -911                                      19540000
195500         WHEN SQLCODE = -913                                      19550000
195600              PERFORM 9900-SOFT-ABORT                             19560000
195700         WHEN SQLWARN0 NOT = SPACES                               19570000
195800         WHEN SQLCODE < ZERO                                      19580000
195900         WHEN SQLCODE > ZERO                                      19590000
196000             MOVE '4020-CLOSE-CURSOR'                             19600000
196100                                   TO DP013-PARAGRAPH             19610000
196200             MOVE 'CLOSE LINE CURSOR '                            19620000
196300                                   TO DP013-MESSAGE-TEXT (1)      19630000
196400             MOVE SQLCA            TO DP013-SQLCA                 19640000
196500             MOVE 'TOPERAT '       TO DP013-DB2-TABLE-NAME (1)    19650000
196600             MOVE 'TWKORIN'        TO DP013-DB2-TABLE-NAME (2)    19660000
196700             SET DP013-DB2-ABEND                                  19670000
196800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19680000
196900             PERFORM DP013-0000-PROCESS-ABEND                     19690000
197000     END-EVALUATE.                                                19700000
197100/                                                                 19710000
197200*----------------------------------------------------------------*19720000
197300*    SET UP THE HOST VARIABLES.                                  *19730000
197400*----------------------------------------------------------------*19740000
197500                                                                  19750000
197600 4100-PREPARE-CURSOR.                                             19760000
197700                                                                  19770000
197800     IF  ASC-INT-APPL-FORMAT-IND EQUAL PC-INTER-APPL-CRIT-SPEC    19780000
197900         MOVE PC000-PO-NBR-N       TO ASC-KEY-PO-NBR              19790000
198000         MOVE PC000-REC-SEQ-NBR-N                                 19800000
198100                                   TO ASC-KEY-RCVR-SEQ-NBR        19810000
198200         MOVE PC000-LINE-NBR-N     TO ASC-KEY-LINE-NBR            19820000
198300         MOVE PC000-WO-NBR-N       TO ASC-KEY-WORK-ORD-SEQ-NBR    19830000
198400     END-IF.                                                      19840000
198500/                                                                 19850000
198600*----------------------------------------------------------------*19860000
198700*    GET THE 'STATIC' INFORMATION FOR THE TOP OF THE SCREEN.     *19870000
198800*    1ST - ENSURE THE DATA EXISTS.                               *19880000
198900*----------------------------------------------------------------*19890000
199000                                                                  19900000
199100 4200-GET-FIRST-DATA.                                             19910000
199200                                                                  19920000
199300     SET PS-DATA-OK                TO TRUE.                       19930000
199400                                                                  19940000
199500     PERFORM 4220-GET-TPURCHS.                                    19950000
199600     IF  PS-DATA-OK                                               19960059
199700         PERFORM 4230-GET-TPURITM                                 19970059
199800                                                                  19980059
199900         IF  PS-ITEM-FOUND                                        19990059
199910             PERFORM 4231-CALL-CICS-API-ARCH                      19991059
199920         END-IF                                                   19992059
199921     END-IF.                                                      19992159
199930                                                                  19993042
200000     IF  PS-DATA-OK                                               20000000
200100         PERFORM 7511-SELECT-TWRKORD                              20010000
200200         IF  NOT PS-DATA-OK                                       20020000
200300             MOVE PC-TSYMSG-00911                                 20030000
200400                                   TO DP020-MSG-NUMBER            20040000
200500         ELSE                                                     20050000
200600             MOVE WRKORD-EXPTED-CART-CNT TO ASC-EXPECTED-CARTS    20060000
200700             MOVE WRKORD-EXPTED-ITM-CNT  TO ASC-EXPECTED-ITEMS    20070000
200800             MOVE WRKORD-ACTL-CART-CNT   TO ASC-ACTUAL-CARTS      20080000
200900             MOVE WRKORD-ACTL-ITM-CNT    TO ASC-ACTUAL-ITEMS      20090000
201000             MOVE WRKORD-STAT-CDE        TO ASC-STATUS-CDE        20100000
201100         END-IF                                                   20110000
201200     END-IF.                                                      20120000
201300                                                                  20130000
201400                                                                  20140000
201500 4220-GET-TPURCHS.                                                20150000
201600                                                                  20160000
201700     EXEC SQL                                                     20170000
201800          SELECT                                                  20180000
201900                DEPT_NBR                                          20190000
202000          INTO                                                    20200000
202100               :PURCHS-DEPT-NBR                                   20210000
202200          FROM                                                    20220000
202300                TPURCHS PO                                        20230000
202400               ,TRECEIV REC                                       20240000
202500          WHERE                                                   20250000
202600                REC.ORD_NBR        =  :ASC-KEY-PO-NBR             20260000
202700            AND REC.REC_SEQ_NBR    =  :ASC-KEY-RCVR-SEQ-NBR       20270000
202800            AND REC.VER_STATUS_CDE =  :PC-A                       20280000
202900            AND REC.ORD_NBR        =  PO.PO_NBR                   20290000
203000            AND REC.PO_VER_NBR     =  PO.VER_NBR                  20300000
203100     END-EXEC.                                                    20310000
203200                                                                  20320000
203300     EVALUATE TRUE                                                20330000
203400         WHEN SQLCODE = ZERO                                      20340000
203500              MOVE PURCHS-DEPT-NBR TO ASC-DEPT-NBR                20350000
203600         WHEN SQLCODE = -904                                      20360000
203700         WHEN SQLCODE = -911                                      20370000
203800         WHEN SQLCODE = -913                                      20380000
203900              PERFORM 9900-SOFT-ABORT                             20390000
204000         WHEN SQLCODE = +100                                      20400000
204100              SET PS-DATA-NOT-OK   TO TRUE                        20410000
204200              MOVE PC-TSYMSG-00912 TO DP020-MSG-NUMBER            20420000
204300         WHEN SQLWARN0 NOT = SPACE                                20430000
204400         WHEN SQLCODE NOT = ZERO                                  20440000
204500              MOVE '4220-GET-TPURCHS'                             20450000
204600                                   TO DP013-PARAGRAPH             20460000
204700              MOVE 'SELECT TPURCHS'                               20470000
204800                                   TO DP013-MESSAGE-TEXT (1)      20480000
204900              MOVE SQLCA           TO DP013-SQLCA                 20490000
205000              MOVE 'TPURCHS '      TO DP013-DB2-TABLE-NAME (1)    20500000
205100              SET DP013-DB2-ABEND  TO TRUE                        20510000
205200              PERFORM DP013-0000-PROCESS-ABEND                    20520000
205300     END-EVALUATE.                                                20530000
205400                                                                  20540000
205500 4230-GET-TPURITM.                                                20550000
205600                                                                  20560000
205700     EXEC SQL                                                     20570000
205800             SELECT                                               20580000
205900                  POITM.CL_NBR                                    20590000
206000                 ,POITM.ITM_NBR                                   20600042
206100                 ,POITM.VEND_STYL_NAME                            20610000
206200                 ,POITM.SKU_DESC                                  20620000
206300                 ,REC.PREPK_ID                                    20630014
206400             INTO                                                 20640000
206500                  :PURITM-CL-NBR                                  20650000
206600                 ,:PURITM-ITM-NBR                                 20660042
206700                 ,:PURITM-VEND-STYL-NAME                          20670000
206800                 ,:PURITM-SKU-DESC                                20680000
206900                 ,:RECITM-PREPK-ID                                20690014
207000             FROM                                                 20700000
207100                   TPURITM POITM                                  20710000
207200                  ,TRECITM REC                                    20720000
207300             WHERE                                                20730000
207400                   REC.ORD_NBR        = :ASC-KEY-PO-NBR           20740000
207500               AND REC.ORD_LNE_NBR    = :ASC-KEY-LINE-NBR         20750000
207600               AND REC.REC_SEQ_NBR    = :ASC-KEY-RCVR-SEQ-NBR     20760000
207700               AND OPER_UNT_ID        = :ASC-KEY-OPER-UNT-ID      20770000
207800               AND FCLTY_ID           = :ASC-KEY-FCLTY-ID         20780000
207900               AND REC.VER_STATUS_CDE = :PC-A                     20790000
208000               AND REC.ORD_NBR        =  POITM.PO_NBR             20800000
208100               AND REC.PO_VER_NBR     =  POITM.VER_NBR            20810000
208200               AND REC.ORD_LNE_NBR    =  POITM.APP_PO_LNE_NBR     20820000
208300     END-EXEC.                                                    20830000
208400                                                                  20840000
208500     EVALUATE TRUE                                                20850000
208600         WHEN SQLCODE = ZERO                                      20860000
208700              MOVE PURITM-CL-NBR         TO ASC-CL-NBR            20870012
208810                                                                  20881042
208900              MOVE PURITM-VEND-STYL-NAME TO ASC-VEND-STYLE        20890000
209000              MOVE PURITM-SKU-DESC       TO ASC-SKU-DESC          20900012
209100              MOVE RECITM-PREPK-ID       TO ASC-KEY-PREPK-ID      20910014
209200         WHEN SQLCODE = -904                                      20920000
209300         WHEN SQLCODE = -911                                      20930000
209400         WHEN SQLCODE = -913                                      20940000
209500              PERFORM 9900-SOFT-ABORT                             20950000
209600         WHEN SQLCODE = +100                                      20960000
209700*AWB-03/01/94 (ADDED IF)                                          20970000
209710              SET PS-ITEM-NOT-FOUND   TO TRUE                     20971042
209800              IF ASC-KEY-LINE-NBR EQUAL ZERO                      20980000
209900                 MOVE SPACES       TO ASC-DEPT-NBR                20990000
210000                 MOVE SPACES       TO ASC-CL-NBR                  21000000
210110                 MOVE '00000000'   TO ASC-NIS-SKU-NBR             21011042
210200                 MOVE SPACES       TO ASC-VEND-STYLE              21020000
210300                 MOVE SPACES       TO ASC-SKU-DESC                21030000
210400                 MOVE +0           TO ASC-KEY-PREPK-ID            21040016
210500              ELSE                                                21050000
210600                 SET PS-DATA-NOT-OK    TO TRUE                    21060000
210700                 MOVE PC-TSYMSG-00913  TO DP020-MSG-NUMBER        21070000
210800              END-IF                                              21080000
210900         WHEN SQLWARN0 NOT = SPACE                                21090000
211000         WHEN SQLCODE NOT = ZERO                                  21100000
211100              MOVE '4230-GET-TPURITM'                             21110000
211200                                   TO DP013-PARAGRAPH             21120000
211300              MOVE 'SELECT TPURITM'                               21130000
211400                                   TO DP013-MESSAGE-TEXT (1)      21140000
211500              MOVE SQLCA           TO DP013-SQLCA                 21150000
211600              MOVE 'TPURITM '      TO DP013-DB2-TABLE-NAME (1)    21160000
211700              SET DP013-DB2-ABEND  TO TRUE                        21170000
211800              PERFORM DP013-0000-PROCESS-ABEND                    21180000
211900     END-EVALUATE.                                                21190000
212000/                                                                 21200000
212100*----------------------------------------------------------------*21210000
212200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *21220000
212300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *21230000
212400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *21240000
212500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21250000
212600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21260000
212700*                                                                *21270000
212800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21280000
212900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21290000
213000*    UPON INITIALIZATION.                                        *21300000
213100*----------------------------------------------------------------*21310000
213200* ITEM ACCESS MODULE                                              21320049
213210 4231-CALL-CICS-API-ARCH.                                         21321042
213220                                                                  21322042
213231     INITIALIZE XL001-ITEM-COMMAREA.                              21323142
213232     MOVE PURITM-ITM-NBR    TO XL001-KEY-ITM-NBR.                 21323242
213233     SET XL001-BY-ITEM                                            21323342
213234         XL001-SELECT-SKU   TO TRUE.                              21323445
213235     CALL XL001-VSM-PGM USING DFHEIBLK                            21323542
213240                              XL001-COMMAREA                      21324042
213241                              XL001-ITEM-COMMAREA.                21324142
213242                                                                  21324242
213243     EVALUATE TRUE                                                21324342
213244                                                                  21324442
213245        WHEN XL001-SUCCESSFUL                                     21324542
213246             MOVE XL001-SKU-NBR   TO ASC-NIS-SKU-NBR              21324642
213250        WHEN XL001-SQL-ERROR                                      21325055
213260             IF XL001-SKU-SQLCODE = +100                          21326052
213270                MOVE '00000000'   TO ASC-NIS-SKU-NBR              21327052
213280             ELSE                                                 21328052
213281                MOVE XL001-SKU-NBR TO PV-DISPLAY-SKU-NBR          21328155
213282                MOVE '4231-CALL-CICS-API-ARCH'                    21328252
213283                                  TO DP013-PARAGRAPH              21328352
213284                MOVE 'UNSUCCESSFUL SELECT ON XLV SKU'             21328452
213285                                  TO DP013-MESSAGE-TEXT (1)       21328552
213286                STRING 'XL VIEW ERROR PARA- ' DELIMITED BY SIZE   21328652
213287                    XL001-ERROR-PARAGRAPH-NBR DELIMITED BY SIZE   21328752
213288                                  INTO DP013-MESSAGE-TEXT (2)     21328852
213289                STRING 'SKU NUMBER : ' DELIMITED BY SIZE          21328952
213290                  PV-DISPLAY-SKU-NBR DELIMITED BY SIZE            21329055
213291                                  INTO DP013-MESSAGE-TEXT (3)     21329152
213292                MOVE XL001-SKU-SQLCODE TO DP013-SQLCA             21329252
213293                MOVE 'XLV_SKU'    TO DP013-DB2-TABLE-NAME (1)     21329353
213294                SET DP013-DB2-ABEND                               21329452
213295                    DP013-XCTL-DISPLAY-RESTART                    21329552
213296                                  TO TRUE                         21329652
213297                PERFORM DP013-0000-PROCESS-ABEND                  21329752
213298             END-IF                                               21329852
213299                                                                  21329952
213300        WHEN XL001-INVALID-ACCESS                                 21330042
213301             MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'            21330142
213302                                TO DP013-PARAGRAPH                21330242
213303             MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'                21330342
213304                                TO DP013-MESSAGE-TEXT (1)         21330442
213305             MOVE SQLCA         TO DP013-SQLCA                    21330542
213306             MOVE 'XLV_SKU'     TO DP013-DB2-TABLE-NAME (1)       21330642
213307              SET DP013-DB2-ABEND                                 21330742
213308                  DP013-XCTL-DISPLAY-RESTART                      21330842
213309                                TO TRUE                           21330948
213310                                                                  21331042
213311              PERFORM DP013-0000-PROCESS-ABEND                    21331142
213312           WHEN OTHER                                             21331242
213313              MOVE '4231-CALL-CICS-API-ARCH'                      21331342
213314                                TO DP013-PARAGRAPH                21331448
213315              MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'               21331542
213316                                TO DP013-MESSAGE-TEXT (1)         21331648
213317              MOVE SQLCA        TO DP013-SQLCA                    21331748
213318              MOVE 'XLV_SKU'    TO DP013-DB2-TABLE-NAME (1)       21331848
213319              SET DP013-DB2-ABEND                                 21331942
213320                  DP013-XCTL-DISPLAY-RESTART                      21332042
213321                                TO TRUE                           21332148
213322              PERFORM DP013-0000-PROCESS-ABEND                    21332242
213323      END-EVALUATE.                                               21332342
213324                                                                  21332442
213325                                                                  21332542
213330 4300-READ-ITEMS-FROM-DB.                                         21333042
213400                                                                  21340000
213500     PERFORM                                                      21350000
213600         VARYING PV-READ-COUNT                                    21360000
213700         FROM 1 BY 1                                              21370000
213800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21380000
213900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21390000
214000                                                                  21400000
214100         PERFORM 4310-FETCH                                       21410000
214200                                                                  21420000
214300         IF  ASC-ITEMS-LEFT-ON-DB                                 21430000
214400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21440000
214500                 ADD +1            TO ASC-ITEM-SUB                21450000
214600             ELSE                                                 21460000
214700                 ADD +1            TO ASC-BLK-SUB                 21470000
214800                 MOVE +1           TO ASC-ITEM-SUB                21480000
214900                                                                  21490000
215000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21500000
215100                     MOVE +1       TO ASC-BLK-SUB                 21510000
215200                     SET ASC-BLOCK-MODIFIED (1)                   21520000
215300                                   TO TRUE                        21530000
215400                     PERFORM 8100-WRITE-TEMP-STORAGE              21540000
215500                     MOVE ASC-BLOCK-ENTRIES                       21550000
215600                               (PC-MAX-BLOCKS-IN-ARRAY)           21560000
215700                               TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)  21570000
215800                     ADD +1        TO ASC-BLK-SUB                 21580000
215900                     INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    21590000
216000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21600000
216100                                   TO TRUE                        21610000
216200                 END-IF                                           21620000
216300             END-IF                                               21630000
216400                                                                  21640000
216500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21650000
216600             MOVE ASC-NUMBER-OF-ITEMS-READ                        21660000
216700                                   TO ASC-LIST-ITEM-NUMBER        21670000
216800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21680000
216900             STRING OPERAT-OPER-DESC     DELIMITED BY '  '        21690000
217000                    ' '                  DELIMITED BY SIZE        21700000
217100                    WKORIN-FCLTY-AREA-ID DELIMITED BY SIZE        21710000
217200                                 INTO  ASC-INSTR-DESC             21720000
217300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21730000
217400             MOVE WKORIN-FCLTY-AREA-ID                            21740000
217500                                   TO ASC-FCLTY-AREA-ID           21750000
217600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21760000
217700             MOVE WKORIN-SCREEN-SEQ-NBR                           21770000
217800                                   TO ASC-SEQ                     21780000
217900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21790000
218000             MOVE WKORIN-LNE-LOC-CDE                              21800000
218100                                   TO ASC-LNE-LOC-CDE             21810000
218200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21820000
218300             MOVE WKORIN-WO-INSTR-SEQ-NBR                         21830000
218400                                   TO ASC-WO-INSTR-SEQ            21840000
218500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21850000
218600             MOVE WKORIN-EXPTED-CART-CNT                          21860000
218700                                   TO ASC-EXPECTED-CTNS           21870000
218800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21880000
218900             MOVE WKORIN-ACTL-CART-CNT                            21890000
219000                                   TO ASC-ACTUAL-CTNS             21900000
219100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21910000
219200             IF  WKORIN-REPACK-IND EQUAL PC-N                     21920000
219300                 MOVE SPACE        TO ASC-RPK-IND                 21930000
219400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21940000
219500             ELSE                                                 21950000
219600                 MOVE WKORIN-REPACK-IND                           21960000
219700                                   TO ASC-RPK-IND                 21970000
219800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21980000
219900             END-IF                                               21990000
220000                                                                  22000000
220100             MOVE WKORIN-STRT-TMST TO PV-WORK-TMST                22010000
220200             IF  PV-WT-NULL-DATE                                  22020000
220300                 MOVE SPACES       TO ASC-START-DATE              22030000
220400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22040000
220500                                       ASC-START-TIME             22050000
220600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22060000
220700             ELSE                                                 22070000
220800                 MOVE PV-WT-MO     TO PV-SD-MO                    22080000
220900                 MOVE PV-WT-DA     TO PV-SD-DA                    22090000
221000                 MOVE PV-WT-HH     TO PV-SD-HH                    22100000
221100                 MOVE PV-WT-MM     TO PV-SD-MM                    22110000
221200                 MOVE PV-SCREEN-DISPLAY-DATE                      22120000
221300                                   TO ASC-START-DATE              22130000
221400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22140000
221500                 MOVE PV-SCREEN-DISPLAY-TIME                      22150000
221600                                   TO ASC-START-TIME              22160000
221700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22170000
221800             END-IF                                               22180000
221900                                                                  22190000
222000             MOVE WKORIN-STOP-TMST TO PV-WORK-TMST                22200000
222100             IF  PV-WT-NULL-DATE                                  22210000
222200                 MOVE SPACES       TO ASC-STOP-DATE               22220000
222300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22230000
222400                                       ASC-STOP-TIME              22240000
222500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22250000
222600             ELSE                                                 22260000
222700                 MOVE PV-WT-MO     TO PV-SD-MO                    22270000
222800                 MOVE PV-WT-DA     TO PV-SD-DA                    22280000
222900                 MOVE PV-WT-HH     TO PV-SD-HH                    22290000
223000                 MOVE PV-WT-MM     TO PV-SD-MM                    22300000
223100                 MOVE PV-SCREEN-DISPLAY-DATE                      22310000
223200                                   TO ASC-STOP-DATE               22320000
223300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22330000
223400                 MOVE PV-SCREEN-DISPLAY-TIME                      22340000
223500                                   TO ASC-STOP-TIME               22350000
223600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22360000
223700             END-IF                                               22370000
223800         END-IF                                                   22380000
223900     END-PERFORM.                                                 22390000
224000                                                                  22400000
224100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22410000
224200         MOVE +1                   TO ASC-BLK-SUB                 22420000
224300         PERFORM 8100-WRITE-TEMP-STORAGE                          22430000
224400         ADD +1                    TO ASC-BLK-SUB                 22440000
224500         PERFORM 8100-WRITE-TEMP-STORAGE                          22450000
224600                                                                  22460000
224700         MOVE 1                    TO ASC-BLK-SUB                 22470000
224800                                  PV-BLOCK-NUMBER                 22480000
224900         PERFORM 4410-READ-TEMP-STORAGE                           22490000
225000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22500000
225100             MOVE 2                TO ASC-BLK-SUB                 22510000
225200                                  PV-BLOCK-NUMBER                 22520000
225300             PERFORM 4410-READ-TEMP-STORAGE                       22530000
225400         END-IF                                                   22540000
225500     END-IF.                                                      22550000
225600/                                                                 22560000
225700*----------------------------------------------------------------*22570000
225800*    FETCH THE CURSOR.                                           *22580000
225900*----------------------------------------------------------------*22590000
226000                                                                  22600000
226100 4310-FETCH.                                                      22610000
226200                                                                  22620000
226300     EXEC SQL                                                     22630000
226400          FETCH                                                   22640000
226500                LIST-CSR                                          22650000
226600          INTO                                                    22660000
226700                :OPERAT-OPER-DESC                                 22670000
226800              , :WKORIN-SCREEN-SEQ-NBR                            22680000
226900              , :WKORIN-FCLTY-AREA-ID                             22690000
227000              , :WKORIN-EXPTED-CART-CNT                           22700000
227100              , :WKORIN-ACTL-CART-CNT                             22710000
227200              , :WKORIN-REPACK-IND                                22720000
227300              , :WKORIN-STRT-TMST                                 22730000
227400              , :WKORIN-STOP-TMST                                 22740000
227500              , :WKORIN-WO-INSTR-SEQ-NBR                          22750000
227600              , :WKORIN-LNE-LOC-CDE                               22760000
227700     END-EXEC.                                                    22770000
227800                                                                  22780000
227900     EVALUATE TRUE                                                22790000
228000         WHEN SQLCODE = ZERO                                      22800000
228100              IF  WKORIN-LNE-LOC-CDE EQUAL LOW-VALUE              22810000
228200                  MOVE SPACES      TO WKORIN-LNE-LOC-CDE          22820000
228300              END-IF                                              22830000
228400         WHEN SQLCODE = +100                                      22840000
228500              CONTINUE                                            22850000
228600         WHEN SQLCODE = -904                                      22860000
228700         WHEN SQLCODE = -911                                      22870000
228800         WHEN SQLCODE = -913                                      22880000
228900              PERFORM 9900-SOFT-ABORT                             22890000
229000         WHEN SQLWARN0 NOT = SPACE                                22900000
229100         WHEN SQLCODE NOT = ZERO                                  22910000
229200              MOVE '4310-FETCH-CURSOR'                            22920000
229300                                   TO DP013-PARAGRAPH             22930000
229400              MOVE 'FETCH LINE CURSOR'                            22940000
229500                                   TO DP013-MESSAGE-TEXT (1)      22950000
229600              MOVE SQLCA           TO DP013-SQLCA                 22960000
229700              MOVE 'TOPERAT '      TO DP013-DB2-TABLE-NAME (1)    22970000
229800              MOVE 'TWKORIN '      TO DP013-DB2-TABLE-NAME (2)    22980000
229900              SET DP013-DB2-ABEND  TO TRUE                        22990000
230000              PERFORM DP013-0000-PROCESS-ABEND                    23000000
230100     END-EVALUATE.                                                23010000
230200                                                                  23020000
230300     IF  SQLCODE EQUAL +100                                       23030000
230400         SET ASC-NO-ITEMS-LEFT-ON-DB                              23040000
230500                                   TO TRUE                        23050000
230600     END-IF.                                                      23060000
230700/                                                                 23070000
230800*----------------------------------------------------------------*23080000
230900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23090000
231000*----------------------------------------------------------------*23100000
231100                                                                  23110000
231200 4400-MOVE-COMMAREA-TO-SCREEN.                                    23120000
231300                                                                  23130000
231400     MOVE ASC-KEY-OPER-UNT-ID      TO AOPERIDO.                   23140000
231500     MOVE ASC-KEY-FCLTY-ID         TO AFACLIDO.                   23150000
231600     MOVE ASC-KEY-PO-NBR           TO ARECVRO.                    23160000
231700     MOVE ASC-KEY-RCVR-SEQ-NBR     TO AHSEQO.                     23170000
231800     MOVE ASC-KEY-LINE-NBR         TO ALINEO.                     23180000
231900                                                                  23190000
232000     MOVE ASC-EXPECTED-CARTS       TO AECTNCTO.                   23200000
232100     MOVE ASC-EXPECTED-ITEMS       TO AEITMCTO.                   23210000
232200     MOVE ASC-KEY-WORK-ORD-SEQ-NBR TO AWORDERO.                   23220000
232300     MOVE ASC-ACTUAL-CARTS         TO AACTNCTO.                   23230000
232400     MOVE ASC-ACTUAL-ITEMS         TO AAITMCTO.                   23240000
232500                                                                  23250000
232600     MOVE ASC-DEPT-NBR             TO ASDEPTO.                    23260000
232700     MOVE ASC-CL-NBR               TO ASCLASSO.                   23270000
232810     MOVE ASC-NIS-SKU-NBR          TO ASKUO.                      23281042
232900     MOVE ASC-SKU-DESC             TO ASDESCO.                    23290000
233000     MOVE ASC-VEND-STYLE           TO AVSTYLEO.                   23300000
233100                                                                  23310000
233200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23320000
233300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23330000
233400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23340000
233500             MOVE +1               TO ASC-BLK-SUB                 23350000
233600             PERFORM 8100-WRITE-TEMP-STORAGE                      23360000
233700             ADD +1                TO ASC-BLK-SUB                 23370000
233800             PERFORM 8100-WRITE-TEMP-STORAGE                      23380000
233900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23390000
234000                 GIVING PV-BLOCK-NUMBER                           23400000
234100                 REMAINDER PV-REMAINDER                           23410000
234200             IF  PV-REMAINDER > ZERO                              23420000
234300                 ADD +1            TO PV-BLOCK-NUMBER             23430000
234400             END-IF                                               23440000
234500             MOVE +1               TO ASC-BLK-SUB                 23450000
234600             PERFORM 4410-READ-TEMP-STORAGE                       23460000
234700             ADD +1                TO ASC-BLK-SUB                 23470000
234800                           PV-BLOCK-NUMBER                        23480000
234900             PERFORM 4410-READ-TEMP-STORAGE                       23490000
235000     END-IF.                                                      23500000
235100                                                                  23510000
235200     MOVE +1                       TO ASC-BLK-SUB.                23520000
235300     COMPUTE ASC-ITEM-SUB =                                       23530000
235400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23540000
235500         + PC-ITEMS-PER-PANEL).                                   23550000
235600                                                                  23560000
235700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23570000
235800         ADD +1                    TO ASC-BLK-SUB                 23580000
235900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23590000
236000     END-IF.                                                      23600000
236100                                                                  23610000
236200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23620000
236300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23630000
236400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23640000
236500     PERFORM 4420-FORMAT-LIST-LINES                               23650000
236600         VARYING PV-SUB                                           23660000
236700         FROM PC-ITEMS-PER-PANEL BY -1                            23670000
236800         UNTIL PV-SUB < +1.                                       23680000
236900                                                                  23690000
237000     COMPUTE ASC-ITEMS-DISPLAYED =                                23700000
237100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23710000
237200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   23720000
237300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     23730000
237400                                                                  23740000
237500     IF  DP020-MSG-NUMBER-X = SPACE                               23750000
237600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23760000
237700*            --- MORE ITEMS TO DISPLAY ----                       23770000
237800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23780000
237900             SET DP020-MSG-INFORMATIONAL TO TRUE                  23790000
238000         END-IF                                                   23800000
238100     END-IF.                                                      23810000
238200                                                                  23820000
238300*----------------------------------------------------------------*23830000
238400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23840000
238500*----------------------------------------------------------------*23850000
238600                                                                  23860000
238700 4410-READ-TEMP-STORAGE.                                          23870000
238800                                                                  23880000
238900     EXEC CICS                                                    23890000
239000         READQ TS                                                 23900000
239100             QUEUE (ASC-LIST-QUEUE-NAME)                          23910000
239200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23920000
239300             ITEM  (PV-BLOCK-NUMBER)                              23930000
239400             RESP  (PV-CICS-RESP)                                 23940000
239500     END-EXEC.                                                    23950000
239600                                                                  23960000
239700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23970000
239800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23980000
239900         CONTINUE                                                 23990000
240000     ELSE                                                         24000000
240100         SET DP013-CICS-ABEND      TO TRUE                        24010000
240200         SET DP013-NO-ROLLBACK     TO TRUE                        24020000
240300         MOVE '4410-READ-TEMP-STORAGE'                            24030000
240400                                   TO DP013-PARAGRAPH             24040000
240500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24050000
240600                                   TO DP013-MESSAGE-TEXT(1)       24060000
240700         PERFORM DP013-0000-PROCESS-ABEND                         24070000
240800     END-IF.                                                      24080000
240900                                                                  24090000
241000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24100000
241100                                                                  24110000
241200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24120000
241300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24130000
241400     END-IF.                                                      24140000
241500/                                                                 24150000
241600*----------------------------------------------------------------*24160000
241700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24170000
241800*----------------------------------------------------------------*24180000
241900                                                                  24190000
242000 4420-FORMAT-LIST-LINES.                                          24200000
242100                                                                  24210000
242200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24220000
242300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24230000
242400         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA        (PV-SUB)  24240000
242500         MOVE SPACE                TO MR-SELECTI        (PV-SUB)  24250000
242600                                      MR-SEQ-X          (PV-SUB)  24260000
242700                                      MR-LNE-LOC-CDE    (PV-SUB)  24270000
242800                                      MR-INSTR-DESC     (PV-SUB)  24280000
242900                                      MR-EXPECTED-CTNS-X(PV-SUB)  24290000
243000                                      MR-ACTUAL-CTNS-X  (PV-SUB)  24300000
243100                                      MR-RPK-IND        (PV-SUB)  24310000
243200                                      MR-START-DATE     (PV-SUB)  24320000
243300                                      MR-STOP-DATE      (PV-SUB)  24330000
243400                                      MR-START-TIME     (PV-SUB)  24340000
243500                                      MR-STOP-TIME      (PV-SUB)  24350000
243600     ELSE                                                         24360000
243700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24370000
243800                                                   > SPACE        24380000
243900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24390000
244000                                   TO MR-SELECTI (PV-SUB)         24400000
244100         ELSE                                                     24410000
244200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24420000
244300                                   TO MR-SELECTI (PV-SUB)         24430000
244400         END-IF                                                   24440000
244500                                                                  24450000
244600         IF  DP030-SET-CURSOR-TRAILER                             24460000
244700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24470000
244800                 > SPACE)                                         24480000
244900               OR (PV-SUB = 1))                                   24490000
245000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24500000
245100                MOVE -1            TO MR-SELECTL (PV-SUB)         24510000
245200             END-IF                                               24520000
245300         END-IF                                                   24530000
245400                                                                  24540000
245500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24550000
245600             MOVE ASC-SEQ           (ASC-BLK-SUB ASC-ITEM-SUB)    24560000
245700                                   TO MR-SEQ           (PV-SUB)   24570000
245800             MOVE ASC-LNE-LOC-CDE   (ASC-BLK-SUB ASC-ITEM-SUB)    24580000
245900                                   TO MR-LNE-LOC-CDE   (PV-SUB)   24590000
246000             MOVE ASC-INSTR-DESC    (ASC-BLK-SUB ASC-ITEM-SUB)    24600000
246100                                   TO MR-INSTR-DESC    (PV-SUB)   24610000
246200             MOVE ASC-EXPECTED-CTNS (ASC-BLK-SUB ASC-ITEM-SUB)    24620000
246300                                   TO MR-EXPECTED-CTNS (PV-SUB)   24630000
246400             MOVE ASC-ACTUAL-CTNS   (ASC-BLK-SUB ASC-ITEM-SUB)    24640000
246500                                   TO MR-ACTUAL-CTNS   (PV-SUB)   24650000
246600             MOVE ASC-RPK-IND       (ASC-BLK-SUB ASC-ITEM-SUB)    24660000
246700                                   TO MR-RPK-IND       (PV-SUB)   24670000
246800             MOVE ASC-START-DATE    (ASC-BLK-SUB ASC-ITEM-SUB)    24680000
246900                                   TO MR-START-DATE    (PV-SUB)   24690000
247000             MOVE ASC-STOP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        24700000
247100                                   TO MR-STOP-DATE (PV-SUB)       24710000
247200             MOVE ASC-START-TIME    (ASC-BLK-SUB ASC-ITEM-SUB)    24720000
247300                                   TO MR-START-TIME    (PV-SUB)   24730000
247400             MOVE ASC-STOP-TIME (ASC-BLK-SUB ASC-ITEM-SUB)        24740000
247500                                   TO MR-STOP-TIME (PV-SUB)       24750000
247600         END-IF                                                   24760000
247700     END-IF.                                                      24770000
247800                                                                  24780000
247900     SUBTRACT +1 FROM ASC-ITEM-SUB                                24790000
248000     IF  ASC-ITEM-SUB < + 1                                       24800000
248100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                24810000
248200         MOVE +1                   TO ASC-BLK-SUB                 24820000
248300     END-IF.                                                      24830000
248400                                                                  24840000
248500******************************************************************24850000
248600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24860000
248700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24870000
248800** ISSUE A WARNING.                                             **24880000
248900******************************************************************24890000
249000                                                                  24900000
249100 4430-CHECK-FOR-BEGIN-AND-END.                                    24910000
249200                                                                  24920000
249300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24930000
249400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24940000
249500*            -- NO END-OF-RANGE SPECFIED ---                      24950000
249600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24960000
249700             SET DP020-MSG-WARNING TO TRUE                        24970000
249800             PERFORM 4431-POSITION-AT-WARNING                     24980000
249900         END-IF                                                   24990000
250000     ELSE                                                         25000000
250100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25010000
250200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25020000
250300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25030000
250400             SET DP020-MSG-WARNING TO TRUE                        25040000
250500             PERFORM 4431-POSITION-AT-WARNING                     25050000
250600         END-IF                                                   25060000
250700     END-IF.                                                      25070000
250800******************************************************************25080000
250900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **25090000
251000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **25100000
251100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **25110000
251200** POSITION THE CURSOR THERE.                                   **25120000
251300******************************************************************25130000
251400                                                                  25140000
251500 4431-POSITION-AT-WARNING.                                        25150000
251600                                                                  25160000
251700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25170000
251800                    - PV-TOP-ITEM + 1.                            25180000
251900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25190000
252000         CONTINUE                                                 25200000
252100     ELSE                                                         25210000
252200         SET DP030-SET-CURSOR-APPL-1                              25220000
252300                                   TO TRUE                        25230000
252400         MOVE -1                   TO MR-SELECTL (PV-SUB)         25240000
252500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25250000
252600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25260000
252700     END-IF.                                                      25270000
252800                                                                  25280000
252900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25290000
253000                    - PV-TOP-ITEM + 1.                            25300000
253100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25310000
253200         CONTINUE                                                 25320000
253300     ELSE                                                         25330000
253400         SET DP030-SET-CURSOR-APPL-1                              25340000
253500                                   TO TRUE                        25350000
253600         MOVE -1                   TO MR-SELECTL (PV-SUB)         25360000
253700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25370000
253800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25380000
253900     END-IF.                                                      25390000
254000/                                                                 25400000
254100*----------------------------------------------------------------*25410000
254200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25420000
254300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25430000
254400* FOR THE SELECTED ITEMS QUEUE.                                  *25440000
254500*                                                                *25450000
254600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25460000
254700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25470000
254800* THE ARRAY IS FULL.                                             *25480000
254900*----------------------------------------------------------------*25490000
255000                                                                  25500000
255100 5000-PREPARE-SEL-QUEUE.                                          25510000
255200                                                                  25520000
255300     MOVE +1                       TO ASC-BLK-SUB.                25530000
255400     PERFORM 8100-WRITE-TEMP-STORAGE.                             25540000
255500     ADD +1                        TO ASC-BLK-SUB.                25550000
255600     PERFORM 8100-WRITE-TEMP-STORAGE.                             25560000
255700                                                                  25570000
255800     MOVE ASC-SEL-QUEUE-NAME2      TO PC000-SEL-QUEUE-NAME.       25580000
255900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25590000
256000                                TO PC000-NUMBER-OF-SELECTED-ITEMS.25600000
256100     PERFORM 6010-DELETE-SEL-QUEUE.                               25610000
256200                                                                  25620000
256300     SET ASC-UPDATE-TSQ            TO TRUE.                       25630000
256400                                                                  25640000
256500     SET PC017-IDX                 TO 1.                          25650000
256600     MOVE ZERO                     TO PC000-NUMBER-OF-TS-ITEMS.   25660000
256700     INITIALIZE PC017-SELECTED-ITEM-ARRAY.                        25670000
256800                                                                  25680000
256900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25690000
257000             VARYING PV-ITEM                                      25700000
257100             FROM 1 BY 1                                          25710000
257200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25720000
257300                                                                  25730000
257400     IF  PC017-IDX > 1                                            25740000
257500         PERFORM 5205-WRITE-SEL-QUEUE                             25750000
257600         ADD +1                    TO PC000-NUMBER-OF-TS-ITEMS    25760000
257700     END-IF.                                                      25770000
257800/                                                                 25780000
257900*----------------------------------------------------------------*25790000
258000*    GET THE MAXIMUM WORK ORDER INSTRUCTION SEQUENCE NUMBER      *25800000
258100*----------------------------------------------------------------*25810000
258200                                                                  25820000
258300 5100-GET-MAX-WO-INSTR.                                           25830000
258400                                                                  25840000
258500     EXEC SQL                                                     25850000
258600          SELECT MAX(WO_INSTR_SEQ_NBR)                            25860000
258700            INTO :PV-WORK-ORD-INSTR-MAX :PV-NULL-IND              25870000
258800            FROM TWKORIN                                          25880000
258900           WHERE ORD_NBR          =  :ASC-KEY-PO-NBR              25890000
259000             AND RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        25900000
259100             AND ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            25910000
259200             AND WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    25920000
259210             AND VER_STATUS_CDE   =  :PC-A                        25921039
259300     END-EXEC.                                                    25930000
259400                                                                  25940000
259500     EVALUATE TRUE                                                25950000
259600         WHEN SQLCODE = ZERO                                      25960000
259700         WHEN SQLCODE = +100                                      25970000
259800              CONTINUE                                            25980000
259900         WHEN SQLCODE = -904                                      25990000
260000         WHEN SQLCODE = -911                                      26000000
260100         WHEN SQLCODE = -913                                      26010000
260200               PERFORM 9900-SOFT-ABORT                            26020000
260300         WHEN SQLWARN0 NOT = SPACES                               26030000
260400         WHEN SQLCODE < ZERO                                      26040000
260500         WHEN SQLCODE > ZERO                                      26050000
260600              MOVE '5100-GET-MAX-WO-INSTR'                        26060000
260700                                   TO DP013-PARAGRAPH             26070000
260800              MOVE 'GET MAX WO INSTRUCTION SEQ NBR'               26080000
260900                                   TO DP013-MESSAGE-TEXT(1)       26090000
261000              MOVE SQLCA           TO DP013-SQLCA                 26100000
261100              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    26110000
261200              SET DP013-DB2-ABEND                                 26120000
261300                  DP013-XCTL-DISPLAY-RESTART                      26130000
261400                                   TO TRUE                        26140000
261500              PERFORM DP013-0000-PROCESS-ABEND                    26150000
261600     END-EVALUATE.                                                26160000
261700/                                                                 26170000
261800******************************************************************26180000
261900** DELETE THE LIST TEMP STORAGE QUEUE.                          **26190000
262000******************************************************************26200000
262100                                                                  26210000
262200 5120-DELETE-ASC-LISTQ.                                           26220000
262300                                                                  26230000
262400     EXEC CICS                                                    26240000
262500          DELETEQ TS                                              26250000
262600             QUEUE (ASC-LIST-QUEUE-NAME)                          26260000
262700             RESP  (PV-CICS-RESP)                                 26270000
262800     END-EXEC.                                                    26280000
262900                                                                  26290000
263000     IF (PV-CICS-RESP = DFHRESP (NORMAL)                          26300000
263100     OR  PV-CICS-RESP = DFHRESP (QIDERR))                         26310000
263200         CONTINUE                                                 26320000
263300     ELSE                                                         26330000
263400         SET DP013-CICS-ABEND      TO TRUE                        26340000
263500         SET DP013-NO-ROLLBACK     TO TRUE                        26350000
263600         MOVE '5120-DELETE-ASC-LISTQ'                             26360000
263700                                   TO DP013-PARAGRAPH             26370000
263800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26380000
263900                                   TO DP013-MESSAGE-TEXT(1)       26390000
264000         PERFORM DP013-0000-PROCESS-ABEND                         26400000
264100     END-IF.                                                      26410000
264200/                                                                 26420000
264300*----------------------------------------------------------------*26430000
264400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26440000
264500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26450000
264600*----------------------------------------------------------------*26460000
264700                                                                  26470000
264800 5200-FILL-SEL-QUEUE-RECORD.                                      26480000
264900                                                                  26490000
265000     PERFORM 8112-READ-LIST-QUEUE.                                26500000
265100                                                                  26510000
265200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26520000
265300         PERFORM                                                  26530000
265400         VARYING LQW-IDX                                          26540000
265500         FROM 1 BY 1                                              26550000
265600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26560000
265700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26570000
265800                                                                  26580000
265900             IF  PS-CHECK-NEXT                                    26590000
266000                 SET PS-DONT-CHECK-NEXT TO TRUE                   26600000
266100                 EVALUATE TRUE                                    26610000
266200                 WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)       26620000
266300                     IF  LQW-START-DATE(LQW-IDX) > SPACES         26630000
266400                         SET PS-ERROR  TO TRUE                    26640000
266500                         MOVE PC-TSYMSG-00922                     26650000
266600                                   TO DP020-MSG-NUMBER            26660000
266700                     END-IF                                       26670000
266800                 END-EVALUATE                                     26680000
266900             END-IF                                               26690000
267000                                                                  26700000
267100             IF  LQW-SELECT (LQW-IDX)                             26710000
267200                                                                  26720000
267300                 EVALUATE TRUE                                    26730000
267400                 WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)       26740000
267500                     IF (LQW-START-DATE(LQW-IDX) NOT > SPACES     26750000
267600                     OR  LQW-STOP-DATE(LQW-IDX) > SPACES)         26760000
267700                         SET PS-ERROR  TO TRUE                    26770000
267800                         MOVE PC-TSYMSG-00924                     26780000
267900                                   TO DP020-MSG-NUMBER            26790000
268000                     END-IF                                       26800000
268100                 WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)       26810000
268200                     IF  LQW-STOP-DATE(LQW-IDX) > SPACES          26820000
268300                         SET PS-ERROR  TO TRUE                    26830000
268400                         MOVE PC-TSYMSG-00923                     26840000
268500                                   TO DP020-MSG-NUMBER            26850000
268600                     ELSE                                         26860000
268700                         PERFORM 5203-COUNT-WKORIN                26870000
268800                     END-IF                                       26880000
268900                 END-EVALUATE                                     26890000
269000                                                                  26900000
269100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26910000
269200                                   TO PC017-ITEM (PC017-IDX)      26920000
269300                 MOVE LQW-SEQ            (LQW-IDX)                26930000
269400                                   TO PC017-SCREEN-SEQ-NBR        26940000
269500                                        (PC017-IDX)               26950000
269600                 MOVE LQW-WO-INSTR-SEQ   (LQW-IDX)                26960000
269700                   TO PC017-WO-INSTR-SEQ-NBR (PC017-IDX)          26970000
269800                      PV-WORK-ORD-INSTR-SELECTED                  26980000
269900                 MOVE LQW-START-DATE     (LQW-IDX)                26990000
270000                   TO PV-WORK-ORD-INSTR-MAX-START                 27000000
270100                 MOVE LQW-EXPECTED-CTNS  (LQW-IDX)                27010000
270200                                   TO PC017-EXPECTED-CTNS         27020000
270300                                        (PC017-IDX)               27030000
270400                 MOVE LQW-ACTUAL-CTNS  (LQW-IDX)                  27040000
270500                                   TO PC017-ACTUAL-CTNS           27050000
270600                                        (PC017-IDX)               27060000
270700                 MOVE SPACE        TO PC017-ACTION-SW (PC017-IDX) 27070000
270800                 SET PC017-IDX UP BY 1                            27080000
270900                 IF  PC017-IDX > PC017-MAX-ITEMS                  27090000
271000                     PERFORM 5205-WRITE-SEL-QUEUE                 27100000
271100                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    27110000
271200                     INITIALIZE PC017-SELECTED-ITEM-ARRAY         27120000
271300                     SET PC017-IDX TO 1                           27130000
271400                 END-IF                                           27140000
271500                 SET PS-CHECK-NEXT TO TRUE                        27150000
271600             END-IF                                               27160000
271700         END-PERFORM                                              27170000
271800     END-IF.                                                      27180000
271900                                                                  27190000
272000 5203-COUNT-WKORIN.                                               27200000
272100                                                                  27210000
272200     MOVE +0 TO PV-COUNT                                          27220000
272300                                                                  27230000
272400     EXEC SQL                                                     27240000
272500         SELECT COUNT(*)                                          27250000
272600          INTO  :PV-COUNT                                         27260000
272700          FROM                                                    27270000
272800                TOPERAT O                                         27280000
272900              , TWKORIN W                                         27290000
273000          WHERE                                                   27300000
273100                W.ORD_NBR          =  :ASC-KEY-ORD-NBR            27310000
273200            AND W.ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR           27320000
273300            AND W.RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR       27330000
273400            AND W.WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR   27340000
273500            AND W.OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID        27350000
273600            AND W.FCLTY_ID         =  :ASC-KEY-FCLTY-ID           27360000
273700            AND W.VER_STATUS_CDE   =  :PC-A                       27370000
273800            AND W.OPER_ID          =  O.OPER_ID                   27380000
273900     END-EXEC.                                                    27390000
274000                                                                  27400000
274100     EVALUATE TRUE                                                27410000
274200         WHEN SQLCODE = +0                                        27420000
274300         WHEN SQLCODE = +100                                      27430000
274400         WHEN SQLCODE = -305                                      27440000
274500              CONTINUE                                            27450000
274600         WHEN SQLCODE = -904                                      27460000
274700         WHEN SQLCODE = -911                                      27470000
274800         WHEN SQLCODE = -913                                      27480000
274900              PERFORM 9900-SOFT-ABORT                             27490000
275000         WHEN SQLWARN0 NOT = SPACE                                27500000
275100         WHEN SQLCODE NOT = ZERO                                  27510000
275200              MOVE '5203-COUNT-WKORIN'                            27520000
275300                                   TO DP013-PARAGRAPH             27530000
275400              MOVE 'COUNT ROWS'    TO DP013-MESSAGE-TEXT (1)      27540000
275500              MOVE SQLCA           TO DP013-SQLCA                 27550000
275600              MOVE 'TOPERAT '      TO DP013-DB2-TABLE-NAME (1)    27560000
275700              MOVE 'TWKORIN '      TO DP013-DB2-TABLE-NAME (2)    27570000
275800              SET DP013-DB2-ABEND  TO TRUE                        27580000
275900              PERFORM DP013-0000-PROCESS-ABEND                    27590000
276000     END-EVALUATE.                                                27600000
276100                                                                  27610000
276200     IF PV-COUNT  < +2                                            27620000
276300         SET PS-ERROR              TO TRUE                        27630000
276400         MOVE PC-TSYMSG-00926      TO DP020-MSG-NUMBER            27640000
276500     END-IF.                                                      27650000
276600                                                                  27660000
276700/                                                                 27670000
276800*----------------------------------------------------------------*27680000
276900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *27690000
277000*----------------------------------------------------------------*27700000
277100                                                                  27710000
277200 5205-WRITE-SEL-QUEUE.                                            27720000
277300                                                                  27730000
277400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27740000
277500                                   TO PC017-SELECTED-ITEMS.       27750000
277600     MOVE ASC-KEY-PO-NBR           TO PC017-PO-NBR.               27760000
277700     MOVE ASC-KEY-RCVR-SEQ-NBR     TO PC017-RCVR-SEQ-NBR.         27770000
277800     MOVE ASC-KEY-WORK-ORD-SEQ-NBR TO PC017-WORK-ORD-SEQ-NBR.     27780000
277900     MOVE ASC-KEY-LINE-NBR         TO PC017-LINE-NBR.             27790000
278000                                                                  27800000
278100     EXEC CICS                                                    27810000
278200          WRITEQ TS                                               27820000
278300              QUEUE (ASC-SEL-QUEUE-NAME2)                         27830000
278400              FROM  (PC017-TS-SEL-REC)                            27840000
278500              ITEM  (PV-SEL-QUEUE-ITEM)                           27850000
278600              RESP  (PV-CICS-RESP)                                27860000
278700     END-EXEC.                                                    27870000
278800                                                                  27880000
278900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27890000
279000         CONTINUE                                                 27900000
279100     ELSE                                                         27910000
279200         SET DP013-CICS-ABEND      TO TRUE                        27920000
279300         SET DP013-NO-ROLLBACK     TO TRUE                        27930000
279400         MOVE '5205-WRITE-SEL-QUEUE'                              27940000
279500                                   TO DP013-PARAGRAPH             27950000
279600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27960000
279700                                   TO DP013-MESSAGE-TEXT(1)       27970000
279800         PERFORM DP013-0000-PROCESS-ABEND                         27980000
279900     END-IF.                                                      27990000
280000/                                                                 28000000
280100*----------------------------------------------------------------*28010000
280200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *28020000
280300*----------------------------------------------------------------*28030000
280400                                                                  28040000
280500 6010-DELETE-SEL-QUEUE.                                           28050000
280600                                                                  28060000
280700     EXEC CICS                                                    28070000
280800         DELETEQ TS                                               28080000
280900             QUEUE (ASC-SEL-QUEUE-NAME2)                          28090000
281000             RESP  (PV-CICS-RESP)                                 28100000
281100     END-EXEC.                                                    28110000
281200                                                                  28120000
281300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      28130000
281400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         28140000
281500         CONTINUE                                                 28150000
281600     ELSE                                                         28160000
281700         SET DP013-CICS-ABEND TO TRUE                             28170000
281800         SET DP013-NO-ROLLBACK TO TRUE                            28180000
281900         MOVE '6010-DELETE-SEL-QUEUE'                             28190000
282000                        TO DP013-PARAGRAPH                        28200000
282100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         28210000
282200                        TO DP013-MESSAGE-TEXT (1)                 28220000
282300         PERFORM DP013-0000-PROCESS-ABEND                         28230000
282400     END-IF.                                                      28240000
282500                                                                  28250000
282600*----------------------------------------------------------------*28260000
282700*    FIRST, FIND THE ITEM SELECTED.                              *28270000
282800*    NEXT, VALIDATE THAT IT CAN BE STARTED.                      *28280000
282900*    IF OK, UPDATE TWKORIN, THE MAP, AND ASC WITH NEW INFO.      *28290000
283000*----------------------------------------------------------------*28300000
283100                                                                  28310000
283200 7000-PROCESS-START.                                              28320000
283300                                                                  28330000
283400     MOVE HIGH-VALUES           TO PV-START-DATE                  28340000
283500                                    PV-PREV-START-DATE            28350000
283600                                    PV-PREV-STOP-DATE.            28360000
283700     PERFORM VARYING PV-SUB                                       28370000
283800         FROM ASC-ITEM-SUB BY -1                                  28380000
283900         UNTIL PV-SUB < +1                                        28390000
284000                                                                  28400000
284100         EVALUATE TRUE                                            28410000
284200                                                                  28420000
284300             WHEN ASC-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)          28430000
284400                  MOVE ASC-START-DATE(ASC-BLK-SUB ASC-ITEM-SUB)   28440000
284500                                TO PV-START-DATE                  28450000
284600                  MOVE PV-SUB   TO PV-SUB2                        28460000
284700                  SUBTRACT PC-ITEMS-PER-PANEL                     28470000
284800                              FROM  PV-SUB                        28480000
284900                                                                  28490000
285000             WHEN OTHER                                           28500000
285100                  SUBTRACT +1 FROM ASC-ITEM-SUB                   28510000
285200                  IF  ASC-ITEM-SUB < 1                            28520000
285300                      SUBTRACT +1 FROM ASC-BLK-SUB                28530000
285400                      MOVE PC-ITEMS-PER-PANEL                     28540000
285500                                TO ASC-ITEM-SUB                   28550000
285600                  END-IF                                          28560000
285700                                                                  28570000
285800         END-EVALUATE                                             28580000
285900     END-PERFORM.                                                 28590000
286000                                                                  28600000
286100     IF  ASC-ITEM-SUB GREATER THAN 1                              28610000
286200         COMPUTE PV-ITM  = ASC-ITEM-SUB - 1                       28620000
286300         MOVE ASC-STOP-DATE (ASC-BLK-SUB PV-ITM)                  28630000
286400                                TO PV-PREV-STOP-DATE              28640000
286500         MOVE ASC-START-DATE (ASC-BLK-SUB PV-ITM)                 28650000
286600                                TO PV-PREV-START-DATE             28660000
286700         MOVE ASC-BLK-SUB       TO PV-HOLD-BLK                    28670000
286800         MOVE PV-ITM            TO PV-HOLD-ITEM                   28680000
286900     ELSE                                                         28690000
287000         IF  ASC-BLK-SUB GREATER THAN 1                           28700000
287100             COMPUTE PV-BLK = ASC-BLK-SUB - 1                     28710000
287200             MOVE ASC-STOP-DATE (PV-BLK PC-ITEMS-PER-PANEL)       28720000
287300                                TO PV-PREV-STOP-DATE              28730000
287400*** MADE A CHANGE TO THIS MOVE STATEMENT TO USE THE CORRECT       28740036
287410*** SUBSCRIPTS  - LARRY                                           28741036
287500             MOVE ASC-START-DATE (PV-BLK PC-ITEMS-PER-PANEL)      28750025
287600                                TO PV-PREV-START-DATE             28760000
287700             MOVE PV-BLK        TO PV-HOLD-BLK                    28770000
287800             MOVE PC-ITEMS-PER-PANEL                              28780000
287900                                TO PV-HOLD-ITEM                   28790000
288000         END-IF                                                   28800000
288100     END-IF.                                                      28810000
288200                                                                  28820000
288300     IF  PV-START-DATE EQUAL HIGH-VALUES                          28830000
288400         MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER               28840000
288500         SET DP020-MSG-FATAL                                      28850000
288600             PS-ERROR           TO TRUE                           28860000
288700     ELSE                                                         28870000
288800         IF  PV-START-DATE NOT EQUAL SPACES                       28880000
288900             MOVE PC-TSYMSG-00914                                 28890000
289000                                TO DP020-MSG-NUMBER               28900000
289100             SET DP020-MSG-FATAL                                  28910000
289110                 DP030-SET-CURSOR-APPL-1                          28911057
289200                 PS-ERROR       TO TRUE                           28920000
289210             IF PV-SUB2 > ZERO                                    28921058
289300                 MOVE -1        TO MR-SELECTL (PV-SUB2)           28930057
289600                 MOVE DP015-RED TO MR-SELECTC (PV-SUB2)           28960057
289700                 MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB2)       28970057
289710             ELSE                                                 28971058
289720                 MOVE -1        TO MR-SELECTL (1)                 28972057
289750                 MOVE DP015-RED TO MR-SELECTC (1)                 28975057
289760                 MOVE DP015-REVERSE TO MR-SELECTH (1)             28976057
289770             END-IF                                               28977057
289800         END-IF                                                   28980000
289900     END-IF.                                                      28990000
290000                                                                  29000000
290100     IF  PV-PREV-STOP-DATE EQUAL SPACES                           29010000
290200         IF  PV-PREV-START-DATE EQUAL SPACES                      29020000
290300             MOVE PC-TSYMSG-00915                                 29030000
290400                                TO DP020-MSG-NUMBER               29040000
290401             SET DP020-MSG-FATAL                                  29040157
290402                 DP030-SET-CURSOR-APPL-1                          29040257
290403                 PS-ERROR   TO TRUE                               29040357
290410             IF PV-SUB2 > ZERO                                    29041057
290700                 MOVE -1        TO MR-SELECTL (PV-SUB2)           29070057
291000                 MOVE DP015-RED TO MR-SELECTC (PV-SUB2)           29100057
291100                 MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB2)       29110057
291110             ELSE                                                 29111057
291111                 MOVE -1        TO MR-SELECTL (1)                 29111157
291112                 MOVE DP015-RED TO MR-SELECTC (1)                 29111257
291113                 MOVE DP015-REVERSE TO MR-SELECTH (1)             29111357
291120             END-IF                                               29112057
291200         ELSE                                                     29120000
291300             IF (ASC-BLK-SUB EQUAL 1                              29130000
291400             AND ASC-ITEM-SUB EQUAL 1)                            29140000
291500                 CONTINUE                                         29150000
291600             ELSE                                                 29160000
291700                 MOVE ASC-BLK-SUB   TO PV-BLK                     29170000
291800                 MOVE ASC-ITEM-SUB  TO PV-ITM                     29180000
291900                 MOVE PV-HOLD-BLK   TO ASC-BLK-SUB                29190000
292000                 MOVE PV-HOLD-ITEM  TO ASC-ITEM-SUB               29200000
292100***  REPLACED THE FOLLOWING SUBTRACT WITH JUST THE FIELD SO THAT  29210036
292110***  VALUE WILL BE MOVED INTO IT  - LARRY                         29211036
292200***              SUBTRACT 1       FROM  PV-SUB2                   29220025
292300                                       PV-SUB2                    29230025
292400                 PERFORM 7300-STOP-INSTRUCTION                    29240000
292500                 MOVE PV-BLK        TO ASC-BLK-SUB                29250000
292600                 MOVE PV-ITM        TO ASC-ITEM-SUB               29260000
292610***  REPLACED THE FOLLOWING ADD WITH JUST THE FIELD SO THAT       29261036
292620***  VALUE WILL BE MOVED INTO IT  - LARRY                         29262036
292800***              ADD 1              TO PV-SUB2                    29280025
292900                                      PV-SUB2                     29290025
293000             END-IF                                               29300000
293100         END-IF                                                   29310000
293200     END-IF.                                                      29320000
293300                                                                  29330000
293400     IF  PS-ERROR                                                 29340000
293500         CONTINUE                                                 29350000
293600     ELSE                                                         29360000
293700         PERFORM 7100-START-INSTRUCTION                           29370000
293800     END-IF.                                                      29380000
293900/                                                                 29390000
294000 7052-SELECT-ZEROLINE-WRKORD.                                     29400000
294100                                                                  29410000
294200     EXEC SQL                                                     29420000
294300          SELECT                                                  29430000
294400                ACTL_CART_CNT                                     29440000
294500          INTO                                                    29450000
294600               :WRKORD-ACTL-CART-CNT                              29460000
294700          FROM                                                    29470000
294800                TWRKORD                                           29480000
294900          WHERE                                                   29490000
295000                ORD_NBR            =  :ASC-KEY-PO-NBR             29500000
295100          AND   ORD_LNE_NBR        =  0                           29510000
295200          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       29520000
295300          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   29530000
295400***10/09  AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        29540060
295500***10/09  AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           29550060
295600          AND   VER_STATUS_CDE     =  :PC-A                       29560000
295700     END-EXEC.                                                    29570000
295800                                                                  29580000
295900     EVALUATE TRUE                                                29590000
296000         WHEN SQLCODE = ZERO                                      29600000
296100              CONTINUE                                            29610000
296200         WHEN SQLCODE = -904                                      29620000
296300         WHEN SQLCODE = -911                                      29630000
296400         WHEN SQLCODE = -913                                      29640000
296500              PERFORM 9900-SOFT-ABORT                             29650000
296600         WHEN SQLCODE = +100                                      29660000
296700              SET PS-DATA-NOT-OK    TO TRUE                       29670000
296800         WHEN SQLWARN0 NOT = SPACE                                29680000
296900         WHEN SQLCODE NOT = ZERO                                  29690000
297000              MOVE '7052-SELECT-ZEROLINE-WRKORD'                  29700000
297100                               TO DP013-PARAGRAPH                 29710000
297200              MOVE 'SELECT TWRKORD'                               29720000
297300                               TO DP013-MESSAGE-TEXT (1)          29730000
297400              MOVE SQLCA       TO DP013-SQLCA                     29740000
297500              MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)        29750000
297600              SET DP013-DB2-ABEND                                 29760000
297700                               TO TRUE                            29770000
297800              PERFORM DP013-0000-PROCESS-ABEND                    29780000
297900     END-EVALUATE.                                                29790000
298000/                                                                 29800000
298100*----------------------------------------------------------------*29810000
298200*    STEP THROUGH ALL ROWS RETURNED FROM THE CURSOR.             *29820000
298300*    UPDATE THE TWRKORD ROW TO COMPLETE.                         *29830000
298400*----------------------------------------------------------------*29840000
298500                                                                  29850000
298600 7053-UPDATE-WKORIN-DATES.                                        29860000
298700                                                                  29870000
298800     PERFORM 7054-OPEN-WKORIN-CSR.                                29880000
298900     IF  SQLCODE EQUAL ZERO                                       29890000
299000         PERFORM 7055-PROCESS-WKORIN-UPDATES                      29900000
299100             UNTIL SQLCODE NOT EQUAL ZERO                         29910000
299200         PERFORM 7059-CLOSE-WKORIN-CSR                            29920000
299300         MOVE ASC-KEY-LINE-NBR  TO PV-KEY-LINE-NBR                29930000
299400         MOVE ZERO              TO ASC-KEY-LINE-NBR               29940000
299500         MOVE ASC-STATUS-CDE    TO PV-STATUS-CDE                  29950000
299600         PERFORM 7510-COMPLETE-WORK-ORDER                         29960000
299700         MOVE PV-KEY-LINE-NBR   TO ASC-KEY-LINE-NBR               29970000
299800         MOVE PV-STATUS-CDE     TO ASC-STATUS-CDE                 29980000
299900     END-IF.                                                      29990000
300000                                                                  30000000
300100/                                                                 30010000
300200*----------------------------------------------------------------*30020000
300300*    HERE WE OPEN THE ZEROLINE CURSOR.                           *30030000
300400*----------------------------------------------------------------*30040000
300500                                                                  30050000
300600 7054-OPEN-WKORIN-CSR.                                            30060000
300700                                                                  30070000
300800     EXEC SQL                                                     30080000
300900          OPEN ZEROLINE                                           30090000
301000     END-EXEC.                                                    30100000
301100                                                                  30110000
301200     EVALUATE TRUE                                                30120000
301300         WHEN SQLCODE = ZERO                                      30130000
301400         WHEN SQLCODE = +100                                      30140000
301500              CONTINUE                                            30150000
301600         WHEN SQLCODE = -904                                      30160000
301700         WHEN SQLCODE = -911                                      30170000
301800         WHEN SQLCODE = -913                                      30180000
301900              PERFORM 9900-SOFT-ABORT                             30190000
302000         WHEN SQLWARN0 NOT = SPACES                               30200000
302100         WHEN SQLCODE < ZERO                                      30210000
302200         WHEN SQLCODE > ZERO                                      30220000
302300             MOVE '7054-OPEN-WKORIN-CSR'                          30230000
302400                                   TO DP013-PARAGRAPH             30240000
302500             MOVE 'OPEN ZEROLINE CURSOR - '                       30250000
302600                                   TO DP013-MESSAGE-TEXT (1)      30260000
302700             MOVE SQLCA        TO DP013-SQLCA                     30270000
302800             MOVE 'TWKORIN '   TO DP013-DB2-TABLE-NAME (1)        30280000
302900                 SET DP013-DB2-ABEND                              30290000
303000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30300000
303100                 PERFORM DP013-0000-PROCESS-ABEND                 30310000
303200     END-EVALUATE.                                                30320000
303300/                                                                 30330000
303400*----------------------------------------------------------------*30340000
303500*    FETCH, UPDATE, AND INSERT.                                  *30350000
303600*----------------------------------------------------------------*30360000
303700                                                                  30370000
303800 7055-PROCESS-WKORIN-UPDATES.                                     30380000
303900                                                                  30390000
304000     PERFORM 7056-FETCH-ZEROLINE.                                 30400000
304100     IF  SQLCODE EQUAL ZERO                                       30410000
304200         IF  WKORIN-STRT-TMST GREATER PV-DUMMY-TMST               30420000
304300             EXEC SQL                                             30430000
304400                  SET :WKORIN-STRT-TMST = CURRENT TIMESTAMP       30440000
304500             END-EXEC                                             30450000
304600         END-IF                                                   30460000
304700         EXEC SQL                                                 30470000
304800              SET :WKORIN-STOP-TMST = CURRENT TIMESTAMP           30480000
304900         END-EXEC                                                 30490000
305000         PERFORM 7057-UPDATE-ZEROLINE                             30500000
305100     END-IF.                                                      30510000
305200                                                                  30520000
305300 7056-FETCH-ZEROLINE.                                             30530000
305400                                                                  30540000
305500     EXEC SQL                                                     30550000
305600          FETCH                                                   30560000
305700                ZEROLINE                                          30570000
305800          INTO                                                    30580000
305900               :WKORIN-ORD-NBR                                    30590000
306000             , :WKORIN-RCVR-SEQ-NBR                               30600000
306100             , :WKORIN-ORD-LNE-NBR                                30610000
306200             , :WKORIN-WORK-ORD-SEQ-NBR                           30620000
306300             , :WKORIN-OPER-UNT-ID                                30630000
306400             , :WKORIN-FCLTY-ID                                   30640000
306500             , :WKORIN-WO-INSTR-SEQ-NBR                           30650000
306600             , :WKORIN-CRE-TMST                                   30660000
306700             , :WKORIN-VER-STATUS-CDE                             30670000
306800             , :WKORIN-CRE-UID-ID                                 30680000
306900             , :WKORIN-OPER-ID                                    30690000
307000             , :WKORIN-FCLTY-AREA-ID                              30700000
307100             , :WKORIN-PRC-FCLTY-AREA-ID                          30710000
307200             , :WKORIN-EXPTED-CART-CNT                            30720000
307300             , :WKORIN-ACTL-CART-CNT                              30730000
307400             , :WKORIN-ALLOC-IND                                  30740000
307500             , :WKORIN-REPACK-IND                                 30750000
307600             , :WKORIN-STRT-TMST                                  30760000
307700             , :WKORIN-STOP-TMST                                  30770000
307800             , :WKORIN-SCREEN-SEQ-NBR                             30780000
307900             , :WKORIN-LNE-LOC-CDE                                30790000
308000             , :WKORIN-REC-SEL-IND                                30800000
308100     END-EXEC.                                                    30810000
308200                                                                  30820000
308300     EVALUATE TRUE                                                30830000
308400         WHEN SQLCODE = ZERO                                      30840000
308500         WHEN SQLCODE = +100                                      30850000
308600              CONTINUE                                            30860000
308700         WHEN SQLCODE = -904                                      30870000
308800         WHEN SQLCODE = -911                                      30880000
308900         WHEN SQLCODE = -913                                      30890000
309000              PERFORM 9900-SOFT-ABORT                             30900000
309100         WHEN SQLWARN0 NOT = SPACE                                30910000
309200         WHEN SQLCODE NOT = ZERO                                  30920000
309300              MOVE '7056-FETCH-ZEROLINE'                          30930000
309400                               TO DP013-PARAGRAPH                 30940000
309500              MOVE 'FETCH ZEROLINE CUROSR'                        30950000
309600                               TO DP013-MESSAGE-TEXT (1)          30960000
309700              MOVE SQLCA       TO DP013-SQLCA                     30970000
309800              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        30980000
309900              SET DP013-DB2-ABEND                                 30990000
310000                               TO TRUE                            31000000
310100              PERFORM DP013-0000-PROCESS-ABEND                    31010000
310200     END-EVALUATE.                                                31020000
310300/                                                                 31030000
310400 7057-UPDATE-ZEROLINE.                                            31040000
310500                                                                  31050000
310600     EXEC SQL                                                     31060000
310700          UPDATE TWKORIN                                          31070000
310800          SET   STOP_TMST         =  :WKORIN-STOP-TMST            31080000
310900              , STRT_TMST         =  :WKORIN-STRT-TMST            31090000
311000              , CRE_UID_ID        =  :PC-CURRENT-PROGRAM-NAME     31100000
311100          WHERE                                                   31110000
311200                CURRENT OF ZEROLINE                               31120000
311300     END-EXEC.                                                    31130000
311400                                                                  31140000
311500     EVALUATE TRUE                                                31150000
311600         WHEN SQLCODE = ZERO                                      31160000
311700              CONTINUE                                            31170000
311800         WHEN SQLCODE = -904                                      31180000
311900         WHEN SQLCODE = -911                                      31190000
312000         WHEN SQLCODE = -913                                      31200000
312100              SET PS-UPDATES-DONE TO TRUE                         31210000
312200              PERFORM 9900-SOFT-ABORT                             31220000
312300         WHEN SQLWARN0 NOT = SPACE                                31230000
312400         WHEN SQLCODE NOT = ZERO                                  31240000
312500              MOVE '7057-UPDATE-ZEROLINE'                         31250000
312600                               TO DP013-PARAGRAPH                 31260000
312700              MOVE 'UPDATE START/STOP TIMESTAMPS'                 31270000
312800                               TO DP013-MESSAGE-TEXT (1)          31280000
312900              MOVE SQLCA       TO DP013-SQLCA                     31290000
313000              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        31300000
313100              SET DP013-DB2-ABEND                                 31310000
313200                               TO TRUE                            31320000
313300              PERFORM DP013-0000-PROCESS-ABEND                    31330000
313400     END-EVALUATE.                                                31340000
313500/                                                                 31350000
313600 7059-CLOSE-WKORIN-CSR.                                           31360000
313700                                                                  31370000
313800     EXEC SQL                                                     31380000
313900          CLOSE ZEROLINE                                          31390000
314000     END-EXEC.                                                    31400000
314100                                                                  31410000
314200     EVALUATE TRUE                                                31420000
314300         WHEN SQLCODE = ZERO                                      31430000
314400         WHEN SQLCODE = +100                                      31440000
314500              CONTINUE                                            31450000
314600         WHEN SQLCODE = -904                                      31460000
314700         WHEN SQLCODE = -911                                      31470000
314800         WHEN SQLCODE = -913                                      31480000
314900              PERFORM 9900-SOFT-ABORT                             31490000
315000         WHEN SQLWARN0 NOT = SPACES                               31500000
315100         WHEN SQLCODE < ZERO                                      31510000
315200         WHEN SQLCODE > ZERO                                      31520000
315300              MOVE '7059-CLOSE-WKORIN-CSR'                        31530000
315400                                   TO DP013-PARAGRAPH             31540000
315500              MOVE 'CLOSE ZEROLINE CURSOR - '                     31550000
315600                                   TO DP013-MESSAGE-TEXT (1)      31560000
315700              MOVE SQLCA       TO DP013-SQLCA                     31570000
315800              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        31580000
315900              SET DP013-DB2-ABEND                                 31590000
316000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31600000
316100              PERFORM DP013-0000-PROCESS-ABEND                    31610000
316200     END-EVALUATE.                                                31620000
316300/                                                                 31630000
316400                                                                  31640000
316500 7060-COUNT-ZEROLINE-INSTR.                                       31650000
316600                                                                  31660000
316700     MOVE ZERO            TO PV-WO-STOP-COUNT.                    31670000
316800     EXEC SQL                                                     31680000
316900          SELECT                                                  31690000
317000                COUNT(*)                                          31700000
317100          INTO                                                    31710000
317200                :PV-WO-STOP-COUNT :PV-NULL-IND                    31720000
317300          FROM                                                    31730000
317400                TWKORIN                                           31740000
317500          WHERE                                                   31750000
317600                ORD_NBR            =  :ASC-KEY-PO-NBR             31760000
317700          AND   ORD_LNE_NBR        =  0                           31770000
317800          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       31780000
317900          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        31790000
318000          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           31800000
318100          AND   VER_STATUS_CDE     =  :PC-A                       31810000
318200          AND   DATE(STOP_TMST)    =  DATE(:PC-DEF-DATE)          31820000
318300     END-EXEC.                                                    31830000
318400                                                                  31840000
318500     EVALUATE TRUE                                                31850000
318600         WHEN SQLCODE = ZERO                                      31860000
318700         WHEN SQLCODE = +100                                      31870000
318800              CONTINUE                                            31880000
318900         WHEN SQLCODE = -904                                      31890000
319000         WHEN SQLCODE = -911                                      31900000
319100         WHEN SQLCODE = -913                                      31910000
319200              PERFORM 9900-SOFT-ABORT                             31920000
319300         WHEN SQLWARN0 NOT = SPACE                                31930000
319400         WHEN SQLCODE NOT = ZERO                                  31940000
319500              MOVE '7060-COUNT-ZEROLINE-INSTR'                    31950000
319600                               TO DP013-PARAGRAPH                 31960000
319700              MOVE 'COUNT NUMBER OF 0 LINE INSTR NOT COMPLETE'    31970000
319800                               TO DP013-MESSAGE-TEXT (1)          31980000
319900              MOVE SQLCA       TO DP013-SQLCA                     31990000
320000              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        32000000
320100              SET DP013-DB2-ABEND                                 32010000
320200                               TO TRUE                            32020000
320300              PERFORM DP013-0000-PROCESS-ABEND                    32030000
320400     END-EVALUATE.                                                32040000
320500/                                                                 32050000
320600*----------------------------------------------------------------*32060000
320700*    UPDATE THE ROW, ASC, AND MAP.                               *32070000
320800*----------------------------------------------------------------*32080000
320900                                                                  32090000
321000 7100-START-INSTRUCTION.                                          32100000
321100                                                                  32110000
321200     MOVE ASC-WO-INSTR-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)             32120000
321300                                TO WKORIN-WO-INSTR-SEQ-NBR.       32130000
321400     PERFORM 7110-UPDATE-TWKORIN.                                 32140000
321500     IF  SQLCODE EQUAL ZERO                                       32150000
321600         PERFORM 7120-GET-TWKORIN                                 32160000
321700         IF  SQLCODE EQUAL ZERO                                   32170000
321800             MOVE WKORIN-STRT-TMST TO PV-WORK-TMST                32180000
321900             MOVE PV-WT-MO         TO PV-SD-MO                    32190000
322000             MOVE PV-WT-DA         TO PV-SD-DA                    32200000
322100             MOVE PV-WT-HH         TO PV-SD-HH                    32210000
322200             MOVE PV-WT-MM         TO PV-SD-MM                    32220000
322300                                                                  32230000
322400             MOVE PV-SCREEN-DISPLAY-DATE                          32240000
322500                                   TO ASC-START-DATE              32250000
322600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  32260000
322700                                       MR-START-DATE (PV-SUB2)    32270000
322800             MOVE PV-SCREEN-DISPLAY-TIME                          32280000
322900                                   TO ASC-START-TIME              32290000
323000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  32300000
323100                                       MR-START-TIME (PV-SUB2)    32310000
323200             MOVE PC-TSYMSG-00925                                 32320000
323300                               TO DP020-MSG-NUMBER                32330000
323400             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  32340000
323500                               TO TRUE                            32350000
323600         END-IF                                                   32360000
323700     END-IF.                                                      32370000
323800                                                                  32380000
323900 7110-UPDATE-TWKORIN.                                             32390000
324000                                                                  32400000
324100     EXEC SQL                                                     32410000
324200          UPDATE TWKORIN                                          32420000
324300          SET    STRT_TMST        =   CURRENT TIMESTAMP           32430000
324400          WHERE                                                   32440000
324500                 ORD_NBR          =  :ASC-KEY-PO-NBR              32450000
324600          AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        32460000
324700          AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            32470000
324800          AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    32480000
324900***10/09  AND    OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         32490063
325000***10/09  AND    FCLTY_ID         =  :ASC-KEY-FCLTY-ID            32500063
325100          AND    WO_INSTR_SEQ_NBR =  :WKORIN-WO-INSTR-SEQ-NBR     32510000
325200          AND    VER_STATUS_CDE   =  :PC-A                        32520000
325300     END-EXEC.                                                    32530000
325400                                                                  32540000
325500     EVALUATE TRUE                                                32550000
325600         WHEN SQLCODE = ZERO                                      32560000
325700              CONTINUE                                            32570000
325800         WHEN SQLCODE = -904                                      32580000
325900         WHEN SQLCODE = -911                                      32590000
326000         WHEN SQLCODE = -913                                      32600000
326100              SET PS-UPDATES-DONE TO TRUE                         32610000
326200              PERFORM 9900-SOFT-ABORT                             32620000
326300         WHEN SQLWARN0 NOT = SPACE                                32630000
326400         WHEN SQLCODE NOT = ZERO                                  32640000
326500              MOVE '7110-UPDATE-TWKORIN'                          32650000
326600                               TO DP013-PARAGRAPH                 32660000
326700              MOVE 'UPDATE START TIMESTAMP'                       32670000
326800                               TO DP013-MESSAGE-TEXT (1)          32680000
326900              MOVE SQLCA       TO DP013-SQLCA                     32690000
327000              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        32700000
327100              SET DP013-DB2-ABEND                                 32710000
327200                               TO TRUE                            32720000
327300              PERFORM DP013-0000-PROCESS-ABEND                    32730000
327400     END-EVALUATE.                                                32740000
327500                                                                  32750000
327600 7120-GET-TWKORIN.                                                32760000
327700                                                                  32770000
327800     EXEC SQL                                                     32780000
327900          SELECT STRT_TMST                                        32790000
328000          INTO   :WKORIN-STRT-TMST                                32800000
328100          FROM                                                    32810000
328200                 TWKORIN                                          32820000
328300          WHERE                                                   32830000
328400                 ORD_NBR          =  :ASC-KEY-PO-NBR              32840000
328500          AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        32850000
328600          AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            32860000
328700          AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    32870000
328800***10/09  AND    OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         32880063
328900***10/09  AND    FCLTY_ID         =  :ASC-KEY-FCLTY-ID            32890063
329000          AND    WO_INSTR_SEQ_NBR =  :WKORIN-WO-INSTR-SEQ-NBR     32900000
329100          AND    VER_STATUS_CDE   =  :PC-A                        32910000
329200     END-EXEC.                                                    32920000
329300                                                                  32930000
329400     EVALUATE TRUE                                                32940000
329500         WHEN SQLCODE = ZERO                                      32950000
329600              CONTINUE                                            32960000
329700         WHEN SQLCODE = -904                                      32970000
329800         WHEN SQLCODE = -911                                      32980000
329900         WHEN SQLCODE = -913                                      32990000
330000              PERFORM 9900-SOFT-ABORT                             33000000
330100         WHEN SQLWARN0 NOT = SPACE                                33010000
330200         WHEN SQLCODE NOT = ZERO                                  33020000
330300              MOVE '7120-GET-TWKORIN'                             33030000
330400                               TO DP013-PARAGRAPH                 33040000
330500              MOVE 'GET START TIMESTAMP AFTER UPDATE'             33050000
330600                               TO DP013-MESSAGE-TEXT (1)          33060000
330700              MOVE SQLCA       TO DP013-SQLCA                     33070000
330800              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        33080000
330900              SET DP013-DB2-ABEND                                 33090000
331000                               TO TRUE                            33100000
331100              PERFORM DP013-0000-PROCESS-ABEND                    33110000
331200     END-EVALUATE.                                                33120000
331300/                                                                 33130000
331400*----------------------------------------------------------------*33140000
331500*    FIRST, FIND THE ITEM SELECTED.                              *33150000
331600*    NEXT, VALIDATE THAT IT CAN BE STARTED.                      *33160000
331700*    IF OK, UPDATE TWKORIN, THE MAP, AND ASC WITH NEW INFO.      *33170000
331800*----------------------------------------------------------------*33180000
331900                                                                  33190000
332000 7200-PROCESS-STOP.                                               33200000
332100                                                                  33210000
332200     MOVE HIGH-VALUES           TO PV-START-DATE                  33220000
332300                                    PV-STOP-DATE.                 33230000
332400     PERFORM VARYING PV-SUB                                       33240000
332500         FROM ASC-ITEM-SUB BY -1                                  33250000
332600         UNTIL PV-SUB < +1                                        33260000
332700                                                                  33270000
332800         EVALUATE TRUE                                            33280000
332900                                                                  33290000
333000             WHEN ASC-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)          33300000
333100                  MOVE ASC-START-DATE(ASC-BLK-SUB ASC-ITEM-SUB)   33310000
333200                                TO PV-START-DATE                  33320000
333300                  MOVE ASC-STOP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)   33330000
333400                                TO PV-STOP-DATE                   33340000
333500                  MOVE PV-SUB   TO PV-SUB2                        33350000
333600                  SUBTRACT PC-ITEMS-PER-PANEL                     33360000
333700                              FROM  PV-SUB                        33370000
333800                                                                  33380000
333900             WHEN OTHER                                           33390000
334000                  SUBTRACT +1 FROM ASC-ITEM-SUB                   33400000
334100                  IF  ASC-ITEM-SUB < 1                            33410000
334200                      SUBTRACT +1 FROM ASC-BLK-SUB                33420000
334300                      MOVE PC-ITEMS-PER-PANEL                     33430000
334400                                TO ASC-ITEM-SUB                   33440000
334500                  END-IF                                          33450000
334600                                                                  33460000
334700         END-EVALUATE                                             33470000
334800     END-PERFORM.                                                 33480000
334900                                                                  33490000
335000     EVALUATE TRUE                                                33500000
335100     WHEN PV-START-DATE EQUAL HIGH-VALUES                         33510000
335200          MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER               33520000
335300          SET DP020-MSG-FATAL                                     33530000
335400              PS-ERROR          TO TRUE                           33540000
335500                                                                  33550000
335600     WHEN PV-START-DATE EQUAL SPACES                              33560000
335700          MOVE PC-TSYMSG-00916  TO DP020-MSG-NUMBER               33570000
335800          SET DP020-MSG-FATAL                                     33580000
335810              DP030-SET-CURSOR-APPL-1                             33581057
335900              PS-ERROR          TO TRUE                           33590000
335910         IF PV-SUB2 > ZERO                                        33591057
336000              MOVE -1           TO MR-SELECTL (PV-SUB2)           33600057
336300              MOVE DP015-RED    TO MR-SELECTC (PV-SUB2)           33630057
336400              MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB2)          33640057
336401         ELSE                                                     33640157
336410              MOVE -1           TO MR-SELECTL (1)                 33641057
336420              MOVE DP015-RED    TO MR-SELECTC (1)                 33642057
336430              MOVE DP015-REVERSE TO MR-SELECTH (1)                33643057
336440         END-IF                                                   33644057
336500                                                                  33650000
336600     WHEN PV-STOP-DATE NOT EQUAL SPACES                           33660000
336700          MOVE PC-TSYMSG-00917  TO DP020-MSG-NUMBER               33670000
336800          SET DP020-MSG-FATAL                                     33680000
336810              DP030-SET-CURSOR-APPL-1                             33681057
336900              PS-ERROR          TO TRUE                           33690000
336910         IF PV-SUB2 > ZERO                                        33691057
337000              MOVE -1           TO MR-SELECTL (PV-SUB2)           33700057
337300              MOVE DP015-RED    TO MR-SELECTC (PV-SUB2)           33730057
337400              MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB2)          33740057
337410         ELSE                                                     33741057
337420              MOVE -1           TO MR-SELECTL (1)                 33742057
337430              MOVE DP015-RED    TO MR-SELECTC (1)                 33743057
337440              MOVE DP015-REVERSE TO MR-SELECTH (1)                33744057
337450         END-IF                                                   33745057
337500     END-EVALUATE.                                                33750000
337600                                                                  33760000
337700     IF  PS-ERROR                                                 33770000
337800         CONTINUE                                                 33780000
337900     ELSE                                                         33790000
338000         PERFORM 7300-STOP-INSTRUCTION                            33800000
338100     END-IF.                                                      33810000
338200/                                                                 33820000
338300*----------------------------------------------------------------*33830000
338400*    UPDATE THE ROW, ASC, AND MAP.                               *33840000
338500*    IF THIS IS THE LAST INSTRUCTION, ENSURE THEY CAN'T STOP     *33850000
338600*    IT UNLESS A TRANSCRIPTION HAS OCCURRED.  THIS IS DETERMINED *33860000
338700*    BY THE EXISTANCE OF A ROW ON TRECDIS.                       *33870000
338800*----------------------------------------------------------------*33880000
338900                                                                  33890000
339000 7300-STOP-INSTRUCTION.                                           33900000
339100                                                                  33910000
339200     IF (ASC-KEY-LINE-NBR NOT EQUAL ZERO                          33920000
339300     AND ASC-SEQ (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL                 33930000
339400         ASC-NUMBER-OF-ITEMS-READ)                                33940000
339500         PERFORM 7302-COUNT-TRECDIS                               33950000
339600*IR-159 FROM HERE                                                 33960000
339700         PERFORM 7304-CHECK-FOR-TROUBLE                           33970000
339800*IR-159 TO HERE; AND RESTRUCTURED IF TEST TO AN EVALUATE.         33980000
339900                                                                  33990000
340000         EVALUATE TRUE                                            34000000
340100             WHEN PV-DB2-COUNT EQUAL ZERO                         34010000
340200                  MOVE PC-TSYMSG-00918                            34020000
340300                                TO DP020-MSG-NUMBER               34030000
340400                  MOVE -1       TO MR-SELECTL (PV-SUB2)           34040000
340500                  SET DP030-SET-CURSOR-APPL-1                     34050000
340600                     PS-ERROR                                     34060000
340700                     DP020-MSG-FATAL                              34070000
340800                                    TO TRUE                       34080057
340810                 IF PV-SUB2 > ZERO                                34081057
340900                     MOVE DP015-RED                               34090057
341000                                    TO MR-SELECTC (PV-SUB2)       34100057
341100                     MOVE DP015-REVERSE                           34110057
341200                                    TO MR-SELECTH (PV-SUB2)       34120057
341201                 ELSE                                             34120157
341210                     MOVE DP015-RED                               34121057
341220                                    TO MR-SELECTC (1)             34122057
341230                     MOVE DP015-REVERSE                           34123057
341240                                    TO MR-SELECTH (1)             34124057
341250                 END-IF                                           34125057
341300                                                                  34130000
341400*IR-159 FROM HERE                                                 34140000
341500             WHEN PV-DB2-TROUBLE-COUNT GREATER THAN ZERO          34150000
341600                  MOVE PC-TSYMSG-00919                            34160000
341700                                TO DP020-MSG-NUMBER               34170000
341800                  MOVE -1       TO MR-SELECTL (PV-SUB2)           34180000
341900                  SET DP030-SET-CURSOR-APPL-1                     34190000
342000                     PS-ERROR                                     34200000
342100                     DP020-MSG-FATAL                              34210000
342200                                TO TRUE                           34220000
342210                 IF PV-SUB2 > ZERO                                34221057
342300                     MOVE DP015-RED                               34230057
342400                                TO MR-SELECTC (PV-SUB2)           34240000
342500                     MOVE DP015-REVERSE                           34250057
342600                                TO MR-SELECTH (PV-SUB2)           34260000
342601                 ELSE                                             34260157
342610                     MOVE DP015-RED                               34261057
342620                                    TO MR-SELECTC (1)             34262057
342630                     MOVE DP015-REVERSE                           34263057
342640                                    TO MR-SELECTH (1)             34264057
342650                 END-IF                                           34265057
342700*IR-159 TO HERE                                                   34270000
342800             WHEN OTHER                                           34280000
342900                  PERFORM 7305-CONTINUE-STOP                      34290000
343000         END-EVALUATE                                             34300009
343100     ELSE                                                         34310000
343200         PERFORM 7303-CHECK-FOR-NON-ZERO                          34320000
343300     END-IF.                                                      34330000
343400                                                                  34340000
343500 7302-COUNT-TRECDIS.                                              34350000
343600                                                                  34360000
343700     MOVE ZERO            TO PV-DB2-COUNT.                        34370000
343800     EXEC SQL                                                     34380000
343900          SELECT                                                  34390000
344000                COUNT(*)                                          34400000
344100          INTO                                                    34410000
344200                :PV-DB2-COUNT :PV-NULL-IND                        34420000
344300          FROM                                                    34430000
344400                TRECDIS                                           34440000
344500          WHERE                                                   34450000
344600                ORD_NBR            =  :ASC-KEY-PO-NBR             34460000
344700          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           34470000
344800          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       34480000
344900          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        34490000
345000          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           34500000
345200     END-EXEC.                                                    34520000
345300                                                                  34530000
345400     EVALUATE TRUE                                                34540069
345500         WHEN SQLCODE = ZERO                                      34550000
345600         WHEN SQLCODE = +100                                      34560000
345700              CONTINUE                                            34570000
345800         WHEN SQLCODE = -904                                      34580000
345900         WHEN SQLCODE = -911                                      34590000
346000         WHEN SQLCODE = -913                                      34600000
346100              PERFORM 9900-SOFT-ABORT                             34610000
346200         WHEN SQLWARN0 NOT = SPACE                                34620000
346300         WHEN SQLCODE NOT = ZERO                                  34630000
346400              MOVE '7302-COUNT-TRECDIS'                           34640000
346500                               TO DP013-PARAGRAPH                 34650000
346600              MOVE 'COUNT NUMBER OF RECEIPT DISTRIBUTION ROWS'    34660000
346700                               TO DP013-MESSAGE-TEXT (1)          34670000
346800              MOVE SQLCA       TO DP013-SQLCA                     34680000
346900              MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)        34690000
347000              SET DP013-DB2-ABEND                                 34700000
347100                               TO TRUE                            34710000
347200              PERFORM DP013-0000-PROCESS-ABEND                    34720000
347300     END-EVALUATE.                                                34730000
347400/                                                                 34740000
347500 7303-CHECK-FOR-NON-ZERO.                                         34750000
347600                                                                  34760000
347700     PERFORM 7551-SELECT-TRECEIV.                                 34770000
347800                                                                  34780000
347900     IF (ASC-NUMBER-OF-ITEMS-READ EQUAL                           34790000
348000         ASC-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)                       34800000
348100     AND RECEIV-PACK-BY-ST-IND NOT EQUAL 'Y')                     34810000
348200         PERFORM 7502-COUNT-NON-LNE-ZEROS                         34820000
348300         IF  PV-COUNT GREATER THAN ZERO                           34830000
348400             PERFORM 7305-CONTINUE-STOP                           34840000
348500         ELSE                                                     34850000
348600             MOVE PC-TSYMSG-00920                                 34860000
348700                                TO DP020-MSG-NUMBER               34870000
348800             SET DP020-MSG-FATAL                                  34880000
348900                 PS-ERROR       TO TRUE                           34890000
349000         END-IF                                                   34900000
349100     ELSE                                                         34910000
349200         PERFORM 7305-CONTINUE-STOP                               34920000
349300     END-IF.                                                      34930000
349400/                                                                 34940000
349500*IR-159 FROM HERE                                                 34950000
349600 7304-CHECK-FOR-TROUBLE.                                          34960000
349700                                                                  34970000
349800     MOVE ZERO                   TO PV-DB2-TROUBLE-COUNT.         34980000
349900     EXEC SQL                                                     34990000
350000          SELECT                                                  35000000
350100                 COUNT(*)                                         35010000
350200          INTO                                                    35020000
350300                :PV-DB2-TROUBLE-COUNT :PV-NULL-IND                35030000
350400          FROM                                                    35040000
350500                 TTRBNTF A                                        35050011
350600                ,TTRBRSN B                                        35060011
350700          WHERE                                                   35070000
350800                A.PO_NBR           =  :ASC-KEY-PO-NBR             35080012
350900          AND ((A.PO_LNE_NBR       =  :ASC-KEY-LINE-NBR           35090012
351000          AND   B.TRBL_LVL_IND       <> :PC-M)                    35100012
351100          OR   (A.PREPK_ID         =  :ASC-KEY-PREPK-ID           35110012
351200          AND   B.TRBL_LVL_IND       =  :PC-M))                   35120013
351300          AND   A.REC_SEQ_NBR      =  :ASC-KEY-RCVR-SEQ-NBR       35130012
351400          AND   A.OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID        35140012
351500          AND   A.FCLTY_ID         =  :ASC-KEY-FCLTY-ID           35150012
351600          AND  (A.RESOLVED_IND     =  :PC-N                       35160012
351700           OR   A.RESOLVED_IND     =  :PC-R                       35170012
351800           OR   A.RESOLVED_IND     =  :PC-I)                      35180012
351900          AND   B.TRBL_RSN_CDE     =  A.TRBL_RSN_CDE              35190012
352000          AND   B.NOTIF_IND        =  :PC-T                       35200012
352100     END-EXEC.                                                    35210000
352200                                                                  35220000
352300     EVALUATE TRUE                                                35230000
352400         WHEN SQLCODE = ZERO                                      35240000
352500         WHEN SQLCODE = +100                                      35250000
352600              CONTINUE                                            35260000
352700         WHEN SQLCODE = -904                                      35270000
352800         WHEN SQLCODE = -911                                      35280000
352900         WHEN SQLCODE = -913                                      35290000
353000              PERFORM 9900-SOFT-ABORT                             35300000
353100         WHEN SQLWARN0 NOT = SPACE                                35310000
353200         WHEN SQLCODE NOT = ZERO                                  35320000
353300              MOVE '7304-CHECK-FOR-TROUBLE'                       35330000
353400                                    TO DP013-PARAGRAPH            35340000
353500              MOVE 'COUNT UNRESOLVED TROUBLE ROWS'                35350000
353600                                    TO DP013-MESSAGE-TEXT (1)     35360000
353700              MOVE SQLCA       TO DP013-SQLCA                     35370000
353800              SET DP013-DB2-ABEND                                 35380000
353900                               TO TRUE                            35390000
354000              PERFORM DP013-0000-PROCESS-ABEND                    35400000
354100     END-EVALUATE.                                                35410000
354200                                                                  35420000
354300     IF  PV-DB2-TROUBLE-COUNT EQUAL ZERO                          35430000
354400         PERFORM 7307-CHECK-PO-LEVEL                              35440000
354500     END-IF.                                                      35450000
354600*IR-159 TO HERE                                                   35460000
354700/                                                                 35470000
354800*----------------------------------------------------------------*35480000
354900*    HERE IS THE ACTUAL STOP INSTRUCTION LOGIC.                  *35490000
355000*----------------------------------------------------------------*35500000
355100                                                                  35510000
355200 7305-CONTINUE-STOP.                                              35520000
355300                                                                  35530000
355400     MOVE ASC-WO-INSTR-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)             35540000
355500                                TO WKORIN-WO-INSTR-SEQ-NBR.       35550000
355600     MOVE ASC-FCLTY-AREA-ID(ASC-BLK-SUB ASC-ITEM-SUB)             35560000
355700                                TO WKORIN-FCLTY-AREA-ID.          35570000
355800                                                                  35580000
355900     PERFORM 7310-UPDATE-TWKORIN.                                 35590000
356000                                                                  35600000
356100     IF  SQLCODE EQUAL ZERO                                       35610000
356200         PERFORM 7320-GET-TWKORIN                                 35620000
356300         IF  SQLCODE EQUAL ZERO                                   35630000
356400             MOVE WKORIN-STOP-TMST                                35640000
356500                               TO PV-WORK-TMST                    35650000
356600             MOVE PV-WT-MO     TO PV-SD-MO                        35660000
356700             MOVE PV-WT-DA     TO PV-SD-DA                        35670000
356800             MOVE PV-WT-HH     TO PV-SD-HH                        35680000
356900             MOVE PV-WT-MM     TO PV-SD-MM                        35690000
357000                                                                  35700000
357100             MOVE PV-SCREEN-DISPLAY-DATE                          35710000
357200                               TO ASC-STOP-DATE                   35720000
357300                                  (ASC-BLK-SUB ASC-ITEM-SUB)      35730000
357400                                   MR-STOP-DATE (PV-SUB2)         35740000
357500             MOVE PV-SCREEN-DISPLAY-TIME                          35750000
357600                               TO ASC-STOP-TIME                   35760000
357700                                  (ASC-BLK-SUB ASC-ITEM-SUB)      35770000
357800                                   MR-STOP-TIME (PV-SUB2)         35780000
357900             MOVE PC-TSYMSG-00921                                 35790000
358000                               TO DP020-MSG-NUMBER                35800000
358100             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  35810000
358200                               TO TRUE                            35820028
358300             IF  ASC-SEQ (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL         35830000
358400                 ASC-NUMBER-OF-ITEMS-READ                         35840000
358500                 PERFORM 7500-SET-STATUS                          35850000
358600             ELSE                                                 35860000
358700                 PERFORM 7330-UPDATE-EXPECTED-CARTON              35870000
358800             END-IF                                               35880000
358900         END-IF                                                   35890000
359000     END-IF.                                                      35900000
359100/                                                                 35910000
359200*IR-159 FROM HERE                                                 35920000
359300 7307-CHECK-PO-LEVEL.                                             35930000
359400                                                                  35940000
359500     MOVE ZERO                   TO PV-DB2-TROUBLE-COUNT.         35950000
359600     EXEC SQL                                                     35960000
359700          SELECT                                                  35970000
359800                 COUNT(*)                                         35980000
359900          INTO                                                    35990000
360000                :PV-DB2-TROUBLE-COUNT :PV-NULL-IND                36000000
360100          FROM                                                    36010000
360200                 TTRBNTF A                                        36020010
360300                ,TTRBRSN B                                        36030010
360400          WHERE                                                   36040000
360500               A.PO_NBR           =  :ASC-KEY-PO-NBR              36050010
360600          AND  A.PO_LNE_NBR       =  0                            36060010
360700          AND  A.PREPK_ID         =  0                            36070017
360800          AND  A.REC_SEQ_NBR      =  :ASC-KEY-RCVR-SEQ-NBR        36080010
360900          AND  A.OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         36090010
361000          AND  A.FCLTY_ID         =  :ASC-KEY-FCLTY-ID            36100010
361100          AND  A.TRBL_RSN_CDE    ^=  :PC-998                      36110010
361200          AND  A.TRBL_RSN_CDE    ^=  :PC-999                      36120010
361300          AND (A.RESOLVED_IND     =  :PC-N                        36130010
361400           OR  A.RESOLVED_IND     =  :PC-I                        36140010
361500           OR  A.RESOLVED_IND     =  :PC-R)                       36150010
361600          AND  B.TRBL_RSN_CDE     =  A.TRBL_RSN_CDE               36160010
361700          AND  B.NOTIF_IND        =  :PC-T                        36170010
361800     END-EXEC.                                                    36180000
361900                                                                  36190000
362000     EVALUATE TRUE                                                36200000
362100         WHEN SQLCODE = ZERO                                      36210000
362200         WHEN SQLCODE = +100                                      36220000
362300              CONTINUE                                            36230000
362400         WHEN SQLCODE = -904                                      36240000
362500         WHEN SQLCODE = -911                                      36250000
362600         WHEN SQLCODE = -913                                      36260000
362700              PERFORM 9900-SOFT-ABORT                             36270000
362800         WHEN SQLWARN0 NOT = SPACE                                36280000
362900         WHEN SQLCODE NOT = ZERO                                  36290000
363000              MOVE '7307-CHECK-PO-LEVEL'                          36300000
363100                                    TO DP013-PARAGRAPH            36310000
363200              MOVE 'COUNT UNRESOLVED TROUBLE ROWS: PO LEVEL'      36320000
363300                                    TO DP013-MESSAGE-TEXT (1)     36330000
363400              MOVE SQLCA       TO DP013-SQLCA                     36340000
363500              SET DP013-DB2-ABEND                                 36350000
363600                               TO TRUE                            36360000
363700              PERFORM DP013-0000-PROCESS-ABEND                    36370000
363800     END-EVALUATE.                                                36380000
363900*IR-159 TO HERE                                                   36390000
364000/                                                                 36400000
364100 7310-UPDATE-TWKORIN.                                             36410000
364200                                                                  36420000
364300**   SEE ANY OF THE NEXT AREA'S INSTRUCTIONS HAVE A REC_SEL_IND.  36430000
364400**   OF 'S' IF SO, SET THE CURRENT REC_SEL_IND TO 'S' TOO.        36440000
364500                                                                  36450000
364600     MOVE +0 TO PV-COUNT                                          36460000
364700                                                                  36470000
364800     EXEC SQL                                                     36480000
364900          SELECT COUNT(*)                                         36490000
365000          INTO   :PV-COUNT                                        36500000
365100          FROM   TWKORIN                                          36510000
365200          WHERE                                                   36520000
365300                 ORD_NBR            =  :ASC-KEY-PO-NBR            36530000
365400          AND    RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR      36540000
365500* 11/17   AND    OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       36550065
365600* 11/17   AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          36560065
365700          AND    FCLTY_AREA_ID      =  :WKORIN-FCLTY-AREA-ID      36570000
365800          AND    VER_STATUS_CDE     =  :PC-A                      36580000
365900          AND    REC_SEL_IND        =  :PC-S                      36590000
366000     END-EXEC.                                                    36600000
366100                                                                  36610000
366200     EVALUATE TRUE                                                36620000
366300         WHEN SQLCODE = ZERO                                      36630000
366400         WHEN SQLCODE = +100                                      36640000
366500         WHEN SQLCODE = -305                                      36650000
366600              CONTINUE                                            36660000
366700         WHEN SQLCODE = -904                                      36670000
366800         WHEN SQLCODE = -911                                      36680000
366900         WHEN SQLCODE = -913                                      36690000
367000              PERFORM 9900-SOFT-ABORT                             36700000
367100         WHEN SQLWARN0 NOT = SPACE                                36710000
367200         WHEN SQLCODE NOT = ZERO                                  36720000
367300              MOVE '7310-COUNT-TWKORIN'                           36730000
367400                               TO DP013-PARAGRAPH                 36740000
367500              MOVE SQLCA       TO DP013-SQLCA                     36750000
367600              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        36760000
367700              SET DP013-DB2-ABEND                                 36770000
367800                               TO TRUE                            36780000
367900              PERFORM DP013-0000-PROCESS-ABEND                    36790000
368000     END-EVALUATE.                                                36800000
368100     IF PV-COUNT = +0                                             36810000
368200         MOVE PC-SPACE       TO WKORIN-REC-SEL-IND                36820000
368300     ELSE                                                         36830000
368400         MOVE PC-S           TO WKORIN-REC-SEL-IND                36840000
368500     END-IF.                                                      36850000
368600                                                                  36860000
368700     PERFORM 7311-FINISH-UPDATE.                                  36870000
368800                                                                  36880000
368900 7311-FINISH-UPDATE.                                              36890000
369000                                                                  36900000
369100     EXEC SQL                                                     36910000
369200          UPDATE TWKORIN                                          36920000
369300          SET    REC_SEL_IND      =  :WKORIN-REC-SEL-IND          36930000
369400               , CRE_UID_ID       =  :PC-CURRENT-PROGRAM-NAME     36940000
369500               , STOP_TMST        =   CURRENT TIMESTAMP           36950000
369600          WHERE                                                   36960000
369700                 ORD_NBR          =  :ASC-KEY-PO-NBR              36970000
369800          AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        36980000
369900          AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            36990000
370000          AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    37000000
370100* 11/17   AND    OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         37010065
370200* 11/17   AND    FCLTY_ID         =  :ASC-KEY-FCLTY-ID            37020065
370300          AND    WO_INSTR_SEQ_NBR =  :WKORIN-WO-INSTR-SEQ-NBR     37030000
370400          AND    VER_STATUS_CDE   =  :PC-A                        37040000
370500     END-EXEC.                                                    37050000
370600                                                                  37060000
370700     EVALUATE TRUE                                                37070000
370800         WHEN SQLCODE = ZERO                                      37080000
370900         WHEN SQLCODE = +100                                      37090000
371000              CONTINUE                                            37100000
371100         WHEN SQLCODE = -904                                      37110000
371200         WHEN SQLCODE = -911                                      37120000
371300         WHEN SQLCODE = -913                                      37130000
371400              SET PS-UPDATES-DONE TO TRUE                         37140000
371500              PERFORM 9900-SOFT-ABORT                             37150000
371600         WHEN SQLWARN0 NOT = SPACE                                37160000
371700         WHEN SQLCODE NOT = ZERO                                  37170000
371800              MOVE '7311-FINISH-UPDATE'                           37180000
371900                               TO DP013-PARAGRAPH                 37190000
372000              MOVE 'UPDATE STOP TIMESTAMP'                        37200000
372100                               TO DP013-MESSAGE-TEXT (1)          37210000
372200              MOVE SQLCA       TO DP013-SQLCA                     37220000
372300              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        37230000
372400              SET DP013-DB2-ABEND                                 37240000
372500                               TO TRUE                            37250000
372600              PERFORM DP013-0000-PROCESS-ABEND                    37260000
372700     END-EVALUATE.                                                37270000
372800                                                                  37280000
372900                                                                  37290000
373000 7320-GET-TWKORIN.                                                37300000
373100                                                                  37310000
373200     EXEC SQL                                                     37320000
373300          SELECT STOP_TMST                                        37330000
373400                ,SCREEN_SEQ_NBR                                   37340000
373500          INTO   :WKORIN-STOP-TMST                                37350000
373600                ,:WKORIN-SCREEN-SEQ-NBR                           37360000
373700          FROM                                                    37370000
373800                 TWKORIN                                          37380000
373900          WHERE                                                   37390000
374000                 ORD_NBR          =  :ASC-KEY-PO-NBR              37400000
374100          AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        37410000
374200          AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            37420000
374300          AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    37430000
374400* 11/17   AND    OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         37440065
374500* 11/17   AND    FCLTY_ID         =  :ASC-KEY-FCLTY-ID            37450065
374600          AND    WO_INSTR_SEQ_NBR =  :WKORIN-WO-INSTR-SEQ-NBR     37460000
374700          AND    VER_STATUS_CDE   =  :PC-A                        37470000
374800     END-EXEC.                                                    37480000
374900                                                                  37490000
375000     EVALUATE TRUE                                                37500000
375100         WHEN SQLCODE = ZERO                                      37510000
375200              CONTINUE                                            37520000
375300         WHEN SQLCODE = -904                                      37530000
375400         WHEN SQLCODE = -911                                      37540000
375500         WHEN SQLCODE = -913                                      37550000
375600              PERFORM 9900-SOFT-ABORT                             37560000
375700         WHEN SQLWARN0 NOT = SPACE                                37570000
375800         WHEN SQLCODE NOT = ZERO                                  37580000
375900              MOVE '7320-GET-TWKORIN'                             37590000
376000                               TO DP013-PARAGRAPH                 37600000
376100              MOVE 'GET STOP TIMESTAMP AFTER UPDATE'              37610000
376200                               TO DP013-MESSAGE-TEXT (1)          37620000
376300              MOVE SQLCA       TO DP013-SQLCA                     37630000
376400              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        37640000
376500              SET DP013-DB2-ABEND                                 37650000
376600                               TO TRUE                            37660000
376700              PERFORM DP013-0000-PROCESS-ABEND                    37670000
376800     END-EVALUATE.                                                37680000
376900/                                                                 37690000
377000*----------------------------------------------------------------*37700000
377100*    HERE WE UPDATE TWKORIN EXPECTED CARTON COUNT FOR THE "NEXT" *37710000
377200*    ITEM AND THE ASC (SETTING THE MODIFIED FLAG ON).            *37720000
377300*----------------------------------------------------------------*37730000
377400                                                                  37740000
377500 7330-UPDATE-EXPECTED-CARTON.                                     37750000
377600                                                                  37760000
377700     MOVE ASC-ACTUAL-CTNS (ASC-BLK-SUB ASC-ITEM-SUB)              37770000
377800                                  TO WKORIN-EXPTED-CART-CNT       37780000
377900                                      WKORIN-ACTL-CART-CNT.       37790000
378000     IF  PV-SUB2 LESS THAN 8                                      37800000
378100         MOVE WKORIN-EXPTED-CART-CNT                              37810000
378200                              TO MR-ACTUAL-CTNS (PV-SUB2 + 1)     37820000
378300                                  MR-EXPECTED-CTNS (PV-SUB2 + 1)  37830000
378400     END-IF.                                                      37840000
378500                                                                  37850000
378600     PERFORM 7340-UPDATE-EXPECTED-TWKORIN.                        37860000
378700                                                                  37870000
378800     ADD 1                        TO ASC-ITEM-SUB.                37880000
378900     IF  ASC-ITEM-SUB GREATER THAN PC-ITEMS-PER-PANEL             37890000
379000         ADD 1                    TO ASC-BLK-SUB                  37900000
379100         IF  ASC-BLK-SUB GREATER THAN PC-MAX-BLOCKS-IN-ARRAY      37910000
379200             PERFORM 7350-WORK-WITH-LQW                           37920000
379300         ELSE                                                     37930000
379400             MOVE WKORIN-EXPTED-CART-CNT                          37940000
379500                                  TO ASC-ACTUAL-CTNS              37950000
379600                                     (ASC-BLK-SUB 1)              37960000
379700                                      ASC-EXPECTED-CTNS           37970000
379800                                     (ASC-BLK-SUB 1)              37980000
379900             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  37990000
380000                                  TO TRUE                         38000000
380100             SUBTRACT 1         FROM  ASC-BLK-SUB                 38010000
380200         END-IF                                                   38020000
380300     ELSE                                                         38030000
380400         MOVE WKORIN-EXPTED-CART-CNT                              38040000
380500                                  TO ASC-ACTUAL-CTNS              38050000
380600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   38060000
380700                                      ASC-EXPECTED-CTNS           38070000
380800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   38080000
380900     END-IF.                                                      38090000
381000     SUBTRACT 1                 FROM  ASC-ITEM-SUB.               38100000
381100                                                                  38110000
381200 7340-UPDATE-EXPECTED-TWKORIN.                                    38120000
381300                                                                  38130000
381400     EXEC SQL                                                     38140000
381500          UPDATE                                                  38150000
381600                 TWKORIN                                          38160000
381700             SET                                                  38170000
381800                 EXPTED_CART_CNT   =  :WKORIN-EXPTED-CART-CNT     38180000
381900               , ACTL_CART_CNT     =  :WKORIN-ACTL-CART-CNT       38190000
382000          WHERE                                                   38200000
382100                ORD_NBR            =  :ASC-KEY-PO-NBR             38210000
382200            AND RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       38220000
382300            AND ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           38230000
382400            AND WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   38240000
382500* 11/17     AND OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        38250065
382600* 11/17     AND FCLTY_ID           =  :ASC-KEY-FCLTY-ID           38260065
382700            AND VER_STATUS_CDE     =  :PC-A                       38270000
382800            AND SCREEN_SEQ_NBR     =  :WKORIN-SCREEN-SEQ-NBR + 1  38280000
382900     END-EXEC.                                                    38290000
383000                                                                  38300000
383100     EVALUATE TRUE                                                38310000
383200         WHEN SQLCODE = ZERO                                      38320000
383300         WHEN SQLCODE = +100                                      38330000
383400              CONTINUE                                            38340000
383500         WHEN SQLCODE = -904                                      38350000
383600         WHEN SQLCODE = -911                                      38360000
383700         WHEN SQLCODE = -913                                      38370000
383800              SET PS-UPDATES-DONE TO TRUE                         38380000
383900              PERFORM 9900-SOFT-ABORT                             38390000
384000         WHEN SQLWARN0 NOT = SPACES                               38400000
384100         WHEN SQLCODE NOT EQUAL ZERO                              38410000
384200              MOVE '7340-UPDATE-EXPECTED-TWKORIN'                 38420000
384300                                   TO DP013-PARAGRAPH             38430000
384400              MOVE 'UPDATE EXPECTED CARTON COUNT'                 38440000
384500                                   TO DP013-MESSAGE-TEXT (1)      38450000
384600              MOVE SQLCA           TO DP013-SQLCA                 38460000
384700              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    38470000
384800              SET DP013-DB2-ABEND                                 38480000
384900                  DP013-XCTL-DISPLAY-RESTART                      38490000
385000                                   TO TRUE                        38500000
385100              PERFORM DP013-0000-PROCESS-ABEND                    38510000
385200     END-EVALUATE.                                                38520000
385300/                                                                 38530000
385400*----------------------------------------------------------------*38540000
385500*    THE ITEM WE NEED TO UPDATE DOES NOT EXIST IN THE ASC,       *38550000
385600*    THEREFORE, WE MUST UPDATE THE TEMP STORAGE QUEUE.           *38560000
385700*----------------------------------------------------------------*38570000
385800                                                                  38580000
385900 7350-WORK-WITH-LQW.                                              38590000
386000                                                                  38600000
386100     MOVE +1                   TO ASC-BLK-SUB.                    38610000
386200     PERFORM 8100-WRITE-TEMP-STORAGE.                             38620000
386300     ADD +1                    TO ASC-BLK-SUB.                    38630000
386400     PERFORM 8100-WRITE-TEMP-STORAGE.                             38640000
386500                                                                  38650000
386600     COMPUTE PV-SAVE-ITEM = 1 + (((ASC-LIST-ITEM-NUMBER           38660000
386700                                  (PC-MAX-BLOCKS-IN-ARRAY         38670000
386800                                   PC-ITEMS-PER-PANEL) + 1)       38680000
386900                          - 1)                                    38690000
387000                          / PC-ITEMS-PER-PANEL).                  38700000
387100                                                                  38710000
387200     MOVE PV-SAVE-ITEM    TO PV-ITEM.                             38720000
387300     PERFORM 8112-READ-LIST-QUEUE.                                38730000
387400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       38740000
387500         MOVE WKORIN-EXPTED-CART-CNT                              38750000
387600                          TO LQW-EXPECTED-CTNS (1)                38760000
387700                              LQW-ACTUAL-CTNS (1)                 38770000
387800         PERFORM 8111-WRITE-LIST-QUEUE                            38780000
387900     END-IF.                                                      38790000
388000/                                                                 38800019
388100*----------------------------------------------------------------*38810019
388200*    UPDATE THE ROW, ASC, AND MAP.                               *38820019
388300*    REMOVE THE STOP DATE AND TIME FROM THE SELECTED LINE        *38830019
388400*    ALSO REMOVE THE START AND STOP DATE AND TIME FROM ALL LINES *38840019
388500*    WITH A HIGHER SEQUENCE NUMBER THAN THE LINE SELECTED        *38850019
388600*    UPDATE THE STATUS OF TRECEIV TO 'IP' IF IT IS 'CM'          *38860019
388700*    UPDATE THE STATUS OF TWRKORD TO 'IP' IF IT IS 'CM'          *38870019
388800*----------------------------------------------------------------*38880019
388900                                                                  38890019
389000 7400-PROCESS-RESTART.                                            38900019
389100                                                                  38910019
389200     MOVE HIGH-VALUES           TO PV-START-DATE                  38920019
389300                                   PV-STOP-DATE                   38930019
389400                                   PV-NEXT-START-DATE.            38940025
389500     PERFORM VARYING PV-SUB                                       38950022
389600         FROM ASC-ITEM-SUB BY -1                                  38960022
389700         UNTIL PV-SUB < +1                                        38970022
389800                                                                  38980022
389900         EVALUATE TRUE                                            38990022
390000                                                                  39000022
390100             WHEN ASC-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)          39010022
390200                  MOVE ASC-START-DATE(ASC-BLK-SUB ASC-ITEM-SUB)   39020025
390300                                TO PV-START-DATE                  39030022
390400                  MOVE ASC-STOP-DATE(ASC-BLK-SUB ASC-ITEM-SUB)    39040022
390500                                TO PV-STOP-DATE                   39050022
390600                  MOVE PV-SUB   TO PV-SUB2                        39060022
390700                  SUBTRACT PC-ITEMS-PER-PANEL                     39070022
390800                              FROM  PV-SUB                        39080022
390900                                                                  39090022
391000             WHEN OTHER                                           39100022
391100                  SUBTRACT +1 FROM ASC-ITEM-SUB                   39110022
391200                  IF  ASC-ITEM-SUB < 1                            39120022
391300                      SUBTRACT +1 FROM ASC-BLK-SUB                39130022
391400                      MOVE PC-ITEMS-PER-PANEL                     39140022
391500                                TO ASC-ITEM-SUB                   39150022
391600                  END-IF                                          39160022
391700                                                                  39170022
391800         END-EVALUATE                                             39180022
391900     END-PERFORM.                                                 39190022
392000                                                                  39200019
392100     IF  PV-START-DATE EQUAL HIGH-VALUES                          39210022
392200         MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER               39220022
392300         SET DP020-MSG-FATAL                                      39230022
392400             PS-ERROR           TO TRUE                           39240022
392500     ELSE                                                         39250022
392600         IF  PV-START-DATE EQUAL SPACES                           39260022
392700             MOVE PC-TSYMSG-00916   TO DP020-MSG-NUMBER           39270022
392800             SET DP020-MSG-FATAL                                  39280022
392810                 DP030-SET-CURSOR-APPL-1                          39281057
392900                 PS-ERROR           TO TRUE                       39290022
392910             IF PV-SUB2 > ZERO                                    39291057
393000                MOVE -1               TO MR-SELECTL (PV-SUB2)     39300023
393300                MOVE DP015-RED        TO MR-SELECTC (PV-SUB2)     39330023
393400                MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB2)     39340023
393401             ELSE                                                 39340157
393410                MOVE -1               TO MR-SELECTL (1)           39341057
393420                MOVE DP015-RED        TO MR-SELECTC (1)           39342057
393430                MOVE DP015-REVERSE    TO MR-SELECTH (1)           39343057
393440             END-IF                                               39344057
393500         ELSE                                                     39350022
393600             IF PV-STOP-DATE EQUAL SPACES                         39360022
393700**  'THE RESTART FUNCTION CAN ONLY BE USED ON INSTRUCTIONS THAT   39370027
393800**   ARE STOPPED'                                                 39380027
393900                MOVE PC-TSYMSG-02832  TO DP020-MSG-NUMBER         39390027
394000                SET DP020-MSG-FATAL                               39400022
394010                    DP030-SET-CURSOR-APPL-1                       39401057
394100                    PS-ERROR          TO TRUE                     39410022
394110                IF PV-SUB2 > ZERO                                 39411057
394200                  MOVE -1             TO MR-SELECTL (PV-SUB2)     39420057
394500                  MOVE DP015-RED      TO MR-SELECTC (PV-SUB2)     39450057
394600                  MOVE DP015-REVERSE  TO MR-SELECTH (PV-SUB2)     39460057
394601                ELSE                                              39460157
394610                  MOVE -1             TO MR-SELECTL (1)           39461057
394620                  MOVE DP015-RED      TO MR-SELECTC (1)           39462057
394630                  MOVE DP015-REVERSE  TO MR-SELECTH (1)           39463057
394640                END-IF                                            39464057
394700         END-IF                                                   39470022
394800     END-IF.                                                      39480022
394900                                                                  39490019
395000     MOVE ASC-WO-INSTR-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)             39500023
395100                                TO WKORIN-WO-INSTR-SEQ-NBR        39510023
395200                                   PV-WO-INSTR-SEQ-NBR.           39520023
395300     PERFORM 7460-COUNT-TWKORIN.                                  39530023
395400     IF  SQLCODE EQUAL ZERO                                       39540023
395500         IF PV-COUNT > 0                                          39550023
395600**  ONLY THE LATEST STOPPED INSTRUCTION CAN BE RESTARTED          39560027
395700             MOVE PC-TSYMSG-02833                                 39570027
395800                                TO DP020-MSG-NUMBER               39580022
395900             SET DP020-MSG-FATAL                                  39590022
395910                 DP030-SET-CURSOR-APPL-1                          39591057
396000                 PS-ERROR       TO TRUE                           39600022
396010             IF PV-SUB2 > ZERO                                    39601057
396100                 MOVE -1        TO MR-SELECTL (PV-SUB2)           39610057
396400                 MOVE DP015-RED TO MR-SELECTC (PV-SUB2)           39640057
396500                 MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB2)       39650057
396501             ELSE                                                 39650157
396510                 MOVE -1        TO MR-SELECTL (1)                 39651057
396520                 MOVE DP015-RED TO MR-SELECTC (1)                 39652057
396530                 MOVE DP015-REVERSE TO MR-SELECTH (1)             39653057
396600         END-IF                                                   39660023
396700     END-IF.                                                      39670022
396800                                                                  39680020
396900     IF  PS-ERROR                                                 39690020
397000         CONTINUE                                                 39700020
397100     ELSE                                                         39710020
397200         IF DP020-FK-LOCAL-FUNC-08(DP020-SRC-AID)                 39720025
397300***   PRESS F2 TO CONFIRM REQUEST                                 39730025
397400             MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER             39740025
397500             SET DP020-MSG-WARNING TO TRUE                        39750025
397600         ELSE                                                     39760025
397700             PERFORM 7405-PROCESS-NEXT-INSTRUCTION                39770025
397800             PERFORM 7410-RESTART-INSTRUCTION                     39780025
397900             MOVE SPACES       TO ASC-STOP-TIME                   39790029
398000                                  (ASC-BLK-SUB ASC-ITEM-SUB)      39800029
398100                                   MR-STOP-TIME (PV-SUB2)         39810029
398200                                  ASC-STOP-DATE                   39820031
398300                                  (ASC-BLK-SUB ASC-ITEM-SUB)      39830030
398400                                   MR-STOP-DATE (PV-SUB2)         39840030
398410             MOVE 'IP'             TO ASC-STATUS-CDE              39841032
398500             MOVE PC-TSYMSG-02835                                 39850028
398600                               TO DP020-MSG-NUMBER                39860028
398700             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  39870028
398800                               TO TRUE                            39880028
398900     END-IF.                                                      39890020
399000                                                                  39900022
399100 7405-PROCESS-NEXT-INSTRUCTION.                                   39910025
399200     IF  ASC-ITEM-SUB LESS THAN PC-ITEMS-PER-PANEL                39920025
399300         COMPUTE PV-ITM  = ASC-ITEM-SUB + 1                       39930025
399400         MOVE ASC-START-DATE (ASC-BLK-SUB PV-ITM)                 39940025
399500                                TO PV-NEXT-START-DATE             39950025
399600         MOVE ASC-WO-INSTR-SEQ (ASC-BLK-SUB PV-ITM)               39960025
399700                                TO PV-NEXT-INSTR-SEQ              39970025
399800         MOVE ASC-BLK-SUB       TO PV-HOLD-BLK                    39980025
399900         MOVE PV-ITM            TO PV-HOLD-ITEM                   39990025
400000     ELSE                                                         40000025
400100         IF  ASC-BLK-SUB EQUAL TO 1                               40010025
400200             COMPUTE PV-BLK = ASC-BLK-SUB + 1                     40020025
400300             MOVE ASC-START-DATE (PV-BLK 1)                       40030025
400400                                TO PV-NEXT-START-DATE             40040025
400500             MOVE PV-BLK        TO PV-HOLD-BLK                    40050025
400600             MOVE PC-ITEMS-PER-PANEL                              40060025
400700                                TO PV-HOLD-ITEM                   40070025
400800         END-IF                                                   40080025
400900     END-IF.                                                      40090025
401000                                                                  40100025
401100     IF  PV-NEXT-START-DATE NOT EQUAL SPACES                      40110025
401200         MOVE ASC-BLK-SUB   TO PV-BLK                             40120025
401300         MOVE ASC-ITEM-SUB  TO PV-ITM                             40130025
401400         MOVE PV-HOLD-BLK   TO ASC-BLK-SUB                        40140025
401500         MOVE PV-HOLD-ITEM  TO ASC-ITEM-SUB                       40150025
401600                               PV-SUB2                            40160025
401700         PERFORM 7490-CHG-START-TWRKORD                           40170025
401701         IF SQLCODE = ZERO                                        40170135
401710             MOVE SPACES       TO ASC-START-TIME                  40171035
401720                                  (ASC-BLK-SUB ASC-ITEM-SUB)      40172035
401730                                   MR-START-TIME (PV-SUB2)        40173035
401740                                  ASC-START-DATE                  40174035
401750                                  (ASC-BLK-SUB ASC-ITEM-SUB)      40175035
401760                                   MR-START-DATE (PV-SUB2)        40176035
401770         END-IF                                                   40177035
401800         MOVE PV-BLK        TO ASC-BLK-SUB                        40180025
401900         MOVE PV-ITM        TO ASC-ITEM-SUB                       40190025
402000                               PV-SUB2                            40200025
402100     END-IF.                                                      40210025
402200                                                                  40220025
402300 7410-RESTART-INSTRUCTION.                                        40230022
402400     PERFORM 7450-UPDATE-TWKORIN.                                 40240022
402500     PERFORM 7420-SELECT-TRECEIV.                                 40250022
402600     IF SQLCODE EQUAL ZERO AND                                    40260022
402700         RECEIV-STATUS-CDE = PC-CM                                40270022
402800         PERFORM 7430-UPDATE-TRECEIV                              40280022
402900     END-IF.                                                      40290022
403000     PERFORM 7470-UPDATE-TWRKORD.                                 40300023
403100     IF ASC-KEY-LINE-NBR = PC-0                                   40310023
403200         PERFORM 7480-UPDATE-ALL-TWRKORD                          40320023
403300     END-IF.                                                      40330023
403400                                                                  40340022
403500*----------------------------------------------------------------*40350022
403600*    CHANGE THE CURRENT ROW TO IN PROCESS.                       *40360022
403700*----------------------------------------------------------------*40370022
403800                                                                  40380022
403900 7420-SELECT-TRECEIV.                                             40390022
404000                                                                  40400022
404100     EXEC SQL                                                     40410022
404200          SELECT STATUS_CDE                                       40420022
404300          INTO  :RECEIV-STATUS-CDE                                40430022
404400          FROM  TRECEIV                                           40440025
404500          WHERE ORD_NBR            =  :ASC-KEY-PO-NBR             40450022
404600          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       40460022
404700          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        40470022
404800          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           40480022
404900          AND   VER_STATUS_CDE     =  :PC-A                       40490022
405000     END-EXEC.                                                    40500022
405100                                                                  40510022
405200     EVALUATE TRUE                                                40520022
405300         WHEN SQLCODE = ZERO                                      40530022
405400         WHEN SQLCODE = +100                                      40540022
405500              CONTINUE                                            40550022
405600         WHEN SQLCODE = -904                                      40560022
405700         WHEN SQLCODE = -911                                      40570022
405800         WHEN SQLCODE = -913                                      40580022
405900              SET PS-UPDATES-DONE TO TRUE                         40590022
406000              PERFORM 9900-SOFT-ABORT                             40600022
406100         WHEN SQLWARN0 NOT = SPACE                                40610022
406200         WHEN SQLCODE NOT = ZERO                                  40620022
406300              MOVE '7420-SELECT-TRECEIV'                          40630022
406400                               TO DP013-PARAGRAPH                 40640022
406500              MOVE 'SELECT TRECEIV STATUS CODE'                   40650022
406600                               TO DP013-MESSAGE-TEXT (1)          40660022
406700              MOVE SQLCA       TO DP013-SQLCA                     40670022
406800              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        40680022
406900              SET DP013-DB2-ABEND                                 40690022
407000                               TO TRUE                            40700022
407100              PERFORM DP013-0000-PROCESS-ABEND                    40710022
407200     END-EVALUATE.                                                40720022
407300/                                                                 40730022
407400                                                                  40740022
407500*----------------------------------------------------------------*40750022
407600*    CHANGE THE CURRENT ROW TO IN PROCESS.                       *40760022
407700*----------------------------------------------------------------*40770022
407800                                                                  40780022
407900 7430-UPDATE-TRECEIV.                                             40790022
408000                                                                  40800022
408100     EXEC SQL                                                     40810022
408200          UPDATE                                                  40820022
408300                TRECEIV                                           40830022
408400          SET   STATUS_CDE         =  :PC-IP                      40840022
408500               ,VER_STATUS_CDE     =  :PC-A                       40850022
408600               ,UPD_TMST           =  CURRENT TIMESTAMP           40860022
408700               ,UPD_UID            =  :DP020-USERID               40870022
408800               ,UPD_PGM_ID         =  :PC-CURRENT-PROGRAM-NAME    40880022
408900          WHERE                                                   40890022
409000                ORD_NBR            =  :ASC-KEY-PO-NBR             40900022
409100          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       40910022
409200          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        40920022
409300          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           40930022
409400          AND   VER_STATUS_CDE     =  :PC-A                       40940022
409500          AND   STATUS_CDE         =  :PC-CM                      40950022
409600     END-EXEC.                                                    40960022
409700                                                                  40970022
409800     EVALUATE TRUE                                                40980022
409900         WHEN SQLCODE = ZERO                                      40990022
410000         WHEN SQLCODE = +100                                      41000022
410100              CONTINUE                                            41010022
410200         WHEN SQLCODE = -904                                      41020022
410300         WHEN SQLCODE = -911                                      41030022
410400         WHEN SQLCODE = -913                                      41040022
410500              SET PS-UPDATES-DONE TO TRUE                         41050022
410600              PERFORM 9900-SOFT-ABORT                             41060022
410700         WHEN SQLWARN0 NOT = SPACE                                41070022
410800         WHEN SQLCODE NOT = ZERO                                  41080022
410900              MOVE '7552-UPDATE-TRECEIV'                          41090022
411000                               TO DP013-PARAGRAPH                 41100022
411100              MOVE 'UPDATE TRECEIV STATUS CODE'                   41110022
411200                               TO DP013-MESSAGE-TEXT (1)          41120022
411300              MOVE SQLCA       TO DP013-SQLCA                     41130022
411400              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        41140022
411500              SET DP013-DB2-ABEND                                 41150022
411600                               TO TRUE                            41160022
411700              PERFORM DP013-0000-PROCESS-ABEND                    41170022
411800     END-EVALUATE.                                                41180022
411900/                                                                 41190022
412000                                                                  41200022
412100 7450-UPDATE-TWKORIN.                                             41210022
412200                                                                  41220022
412300     EXEC SQL                                                     41230022
412400          UPDATE TWKORIN                                          41240022
412500          SET    STOP_TMST        =   :PC-DB2-DEFAULT-DATE        41250022
412600          WHERE                                                   41260022
412700                 ORD_NBR          =  :ASC-KEY-PO-NBR              41270022
412800          AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR        41280022
412900          AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR            41290022
413000          AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR    41300022
413100***       AND    OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID         41310064
413200***       AND    FCLTY_ID         =  :ASC-KEY-FCLTY-ID            41320064
413300          AND    WO_INSTR_SEQ_NBR =  :WKORIN-WO-INSTR-SEQ-NBR     41330022
413400          AND    VER_STATUS_CDE   =  :PC-A                        41340023
413500     END-EXEC.                                                    41350022
413600                                                                  41360022
413700     EVALUATE TRUE                                                41370022
413800         WHEN SQLCODE = ZERO                                      41380022
413900              CONTINUE                                            41390022
414000         WHEN SQLCODE = -904                                      41400022
414100         WHEN SQLCODE = -911                                      41410022
414200         WHEN SQLCODE = -913                                      41420022
414300              SET PS-UPDATES-DONE TO TRUE                         41430022
414400              PERFORM 9900-SOFT-ABORT                             41440022
414500         WHEN SQLWARN0 NOT = SPACE                                41450022
414600         WHEN SQLCODE NOT = ZERO                                  41460022
414700              MOVE '7450-UPDATE-TWKORIN'                          41470022
414800                               TO DP013-PARAGRAPH                 41480022
414900              MOVE 'UPDATE STOP TIMESTAMP'                        41490022
415000                               TO DP013-MESSAGE-TEXT (1)          41500022
415100              MOVE SQLCA       TO DP013-SQLCA                     41510022
415200              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        41520022
415300              SET DP013-DB2-ABEND                                 41530022
415400                               TO TRUE                            41540022
415500              PERFORM DP013-0000-PROCESS-ABEND                    41550022
415600     END-EVALUATE.                                                41560022
415700                                                                  41570022
415800 7460-COUNT-TWKORIN.                                              41580022
415900                                                                  41590022
416000     MOVE +0 TO PV-COUNT                                          41600022
416100                                                                  41610022
416200     EXEC SQL                                                     41620022
416300         SELECT COUNT(*)                                          41630022
416400          INTO  :PV-COUNT                                         41640022
416500          FROM  TWKORIN                                           41650022
416600          WHERE ORD_NBR          =  :ASC-KEY-ORD-NBR              41660022
416700            AND ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR             41670022
416800            AND RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR         41680022
416900            AND WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR     41690022
417000***         AND OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID          41700064
417100***         AND FCLTY_ID         =  :ASC-KEY-FCLTY-ID             41710064
417200            AND WO_INSTR_SEQ_NBR >  :WKORIN-WO-INSTR-SEQ-NBR      41720022
417300            AND STOP_TMST        <> :PC-DB2-DEFAULT-DATE          41730025
417310            AND VER_STATUS_CDE   =  :PC-A                         41731038
417400     END-EXEC.                                                    41740022
417500                                                                  41750022
417600     EVALUATE TRUE                                                41760022
417700         WHEN SQLCODE = +0                                        41770022
417800         WHEN SQLCODE = +100                                      41780022
417900         WHEN SQLCODE = -305                                      41790022
418000              CONTINUE                                            41800022
418100         WHEN SQLCODE = -904                                      41810022
418200         WHEN SQLCODE = -911                                      41820022
418300         WHEN SQLCODE = -913                                      41830022
418400              PERFORM 9900-SOFT-ABORT                             41840022
418500         WHEN SQLWARN0 NOT = SPACE                                41850022
418600         WHEN SQLCODE NOT = ZERO                                  41860022
418700              MOVE '7460-COUNT-TWKORIN'                           41870022
418800                                   TO DP013-PARAGRAPH             41880022
418900              MOVE 'COUNT ROWS'    TO DP013-MESSAGE-TEXT (1)      41890022
419000              MOVE SQLCA           TO DP013-SQLCA                 41900022
419100              MOVE 'TWKORIN '      TO DP013-DB2-TABLE-NAME (1)    41910022
419200              SET DP013-DB2-ABEND  TO TRUE                        41920022
419300              PERFORM DP013-0000-PROCESS-ABEND                    41930022
419400     END-EVALUATE.                                                41940022
419500                                                                  41950022
419600 7470-UPDATE-TWRKORD.                                             41960023
419700                                                                  41970023
419800     EXEC SQL                                                     41980023
419900          UPDATE                                                  41990023
420000                TWRKORD                                           42000023
420100          SET   STAT_CDE           =  :PC-IP                      42010023
420200              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    42020023
420300          WHERE                                                   42030023
420400                ORD_NBR            =  :ASC-KEY-PO-NBR             42040023
420500          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           42050023
420600          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       42060023
420700          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   42070023
420800***       AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        42080064
420900***       AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           42090064
421000          AND   VER_STATUS_CDE     =  :PC-A                       42100023
421100     END-EXEC.                                                    42110023
421200                                                                  42120023
421300     EVALUATE TRUE                                                42130023
421400         WHEN SQLCODE = ZERO                                      42140023
421500         WHEN SQLCODE = +100                                      42150023
421600              CONTINUE                                            42160023
421700         WHEN SQLCODE = -904                                      42170023
421800         WHEN SQLCODE = -911                                      42180023
421900         WHEN SQLCODE = -913                                      42190023
422000              SET PS-UPDATES-DONE TO TRUE                         42200023
422100              PERFORM 9900-SOFT-ABORT                             42210023
422200         WHEN SQLWARN0 NOT = SPACE                                42220023
422300         WHEN SQLCODE NOT = ZERO                                  42230023
422400              MOVE '7470-UPDATE-TWRKORD'                          42240023
422500                               TO DP013-PARAGRAPH                 42250023
422600              MOVE 'UPDATE TWRKORD STATUS CODE'                   42260023
422700                               TO DP013-MESSAGE-TEXT (1)          42270023
422800              MOVE SQLCA       TO DP013-SQLCA                     42280023
422900              MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)        42290023
423000              SET DP013-DB2-ABEND                                 42300023
423100                               TO TRUE                            42310023
423200              PERFORM DP013-0000-PROCESS-ABEND                    42320023
423300     END-EVALUATE.                                                42330023
423400/                                                                 42340023
423500 7480-UPDATE-ALL-TWRKORD.                                         42350023
423600                                                                  42360023
423700     EXEC SQL                                                     42370023
423800          UPDATE                                                  42380023
423900                TWRKORD                                           42390023
424000          SET   CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    42400023
424100              , STAT_CDE           =  :PC-IP                      42410023
424200          WHERE                                                   42420023
424300                ORD_NBR            =  :ASC-KEY-PO-NBR             42430023
424400          AND   ORD_LNE_NBR        >  0                           42440023
424500          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       42450023
424600***       AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        42460064
424700***       AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           42470064
424800          AND   VER_STATUS_CDE     =  :PC-A                       42480023
424900     END-EXEC.                                                    42490023
425000                                                                  42500023
425100     EVALUATE TRUE                                                42510023
425200         WHEN SQLCODE = ZERO                                      42520023
425300         WHEN SQLCODE = +100                                      42530023
425400              CONTINUE                                            42540023
425500         WHEN SQLCODE = -904                                      42550023
425600         WHEN SQLCODE = -911                                      42560023
425700         WHEN SQLCODE = -913                                      42570023
425800              SET PS-UPDATES-DONE TO TRUE                         42580023
425900              PERFORM 9900-SOFT-ABORT                             42590023
426000         WHEN SQLWARN0 NOT = SPACE                                42600023
426100         WHEN SQLCODE NOT = ZERO                                  42610023
426200              MOVE '7480-UPDATE-ALL-TWRKORD'                      42620023
426300                               TO DP013-PARAGRAPH                 42630023
426400              MOVE 'SET THE STATUS TO IN PROCESS FOR ALL TWRKORD' 42640023
426500                               TO DP013-MESSAGE-TEXT (1)          42650023
426600              MOVE SQLCA       TO DP013-SQLCA                     42660023
426700              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (1)        42670023
426800              SET DP013-DB2-ABEND                                 42680023
426900                               TO TRUE                            42690023
427000              PERFORM DP013-0000-PROCESS-ABEND                    42700023
427100     END-EVALUATE.                                                42710023
427200                                                                  42720025
427300 7490-CHG-START-TWRKORD.                                          42730025
427400     EXEC SQL                                                     42740025
427500          UPDATE                                                  42750025
427600                TWKORIN                                           42760025
427700          SET   STRT_TMST          =  :PC-DB2-DEFAULT-DATE        42770025
427800              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    42780025
427900          WHERE                                                   42790025
428000                ORD_NBR            =  :ASC-KEY-PO-NBR             42800025
428100          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           42810025
428200          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       42820025
428300          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   42830034
428310          AND   WO_INSTR_SEQ_NBR   =  :PV-NEXT-INSTR-SEQ          42831034
428400***       AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        42840064
428500***       AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           42850064
428600          AND   VER_STATUS_CDE     =  :PC-A                       42860025
428700     END-EXEC.                                                    42870025
428800                                                                  42880025
428900     EVALUATE TRUE                                                42890025
429000         WHEN SQLCODE = ZERO                                      42900025
429100         WHEN SQLCODE = +100                                      42910025
429200              CONTINUE                                            42920025
429300         WHEN SQLCODE = -904                                      42930025
429400         WHEN SQLCODE = -911                                      42940025
429500         WHEN SQLCODE = -913                                      42950025
429600              SET PS-UPDATES-DONE TO TRUE                         42960025
429700              PERFORM 9900-SOFT-ABORT                             42970025
429800         WHEN SQLWARN0 NOT = SPACE                                42980025
429900         WHEN SQLCODE NOT = ZERO                                  42990025
430000              MOVE '7490-CHG-START-TWRKORD'                       43000025
430100                               TO DP013-PARAGRAPH                 43010025
430200              MOVE 'SET THE START TIMESTAMP FOR NEXT TWKORIN'     43020025
430300                               TO DP013-MESSAGE-TEXT (1)          43030025
430400              MOVE SQLCA       TO DP013-SQLCA                     43040025
430500              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        43050025
430600              SET DP013-DB2-ABEND                                 43060025
430700                               TO TRUE                            43070025
430800              PERFORM DP013-0000-PROCESS-ABEND                    43080025
430900     END-EVALUATE.                                                43090025
431000                                                                  43100025
431100/                                                                 43110021
431200*----------------------------------------------------------------*43120021
431300*    ALL INSTRUCTIONS HAVE BEEN COMPLETED.  SET THE PROPER       *43130021
431400*    STATUS ON ALL TABLES.                                       *43140021
431500*----------------------------------------------------------------*43150021
431600                                                                  43160000
431700 7500-SET-STATUS.                                                 43170000
431800                                                                  43180000
431900     PERFORM 7510-COMPLETE-WORK-ORDER.                            43190000
432000     IF  ASC-KEY-LINE-NBR NOT EQUAL ZERO                          43200000
432100         PERFORM 7505-SET-ALL-STATUSES                            43210000
432200     ELSE                                                         43220000
432300         PERFORM 7503-UPDATE-REC-STATUS                           43230000
432400     END-IF.                                                      43240000
432500/                                                                 43250000
432600                                                                  43260000
432700 7502-COUNT-NON-LNE-ZEROS.                                        43270000
432800                                                                  43280000
432900     MOVE +0 TO PV-COUNT                                          43290000
433000                                                                  43300000
433100     EXEC SQL                                                     43310000
433200         SELECT COUNT(*)                                          43320000
433300          INTO  :PV-COUNT                                         43330000
433400          FROM  TWRKORD W                                         43340000
433500          WHERE                                                   43350000
433600                W.ORD_NBR          =  :ASC-KEY-ORD-NBR            43360000
433700            AND W.ORD_LNE_NBR      >  :PC-0                       43370000
433800            AND W.RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR       43380000
433900            AND W.OPER_UNT_ID      =  :ASC-KEY-OPER-UNT-ID        43390000
434000            AND W.FCLTY_ID         =  :ASC-KEY-FCLTY-ID           43400000
434100            AND W.VER_STATUS_CDE   =  :PC-A                       43410000
434200     END-EXEC.                                                    43420000
434300                                                                  43430000
434400     EVALUATE TRUE                                                43440000
434500         WHEN SQLCODE = +0                                        43450000
434600         WHEN SQLCODE = +100                                      43460000
434700         WHEN SQLCODE = -305                                      43470000
434800              CONTINUE                                            43480000
434900         WHEN SQLCODE = -904                                      43490000
435000         WHEN SQLCODE = -911                                      43500000
435100         WHEN SQLCODE = -913                                      43510000
435200              PERFORM 9900-SOFT-ABORT                             43520000
435300         WHEN SQLWARN0 NOT = SPACE                                43530000
435400         WHEN SQLCODE NOT = ZERO                                  43540000
435500              MOVE '7502-COUNT-NON-LNE-ZEROS'                     43550000
435600                               TO DP013-PARAGRAPH                 43560000
435700              MOVE SQLCA       TO DP013-SQLCA                     43570000
435800              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (2)        43580000
435900              SET DP013-DB2-ABEND                                 43590000
436000                               TO TRUE                            43600000
436100              PERFORM DP013-0000-PROCESS-ABEND                    43610000
436200     END-EVALUATE.                                                43620000
436300                                                                  43630000
436400/                                                                 43640000
436500 7503-UPDATE-REC-STATUS.                                          43650000
436600                                                                  43660000
436700     PERFORM 7551-SELECT-TRECEIV.                                 43670000
436800                                                                  43680000
436900     IF RECEIV-PACK-BY-ST-IND = 'Y'                               43690000
437000         PERFORM 7553-LINK-AUDIT-MODULE                           43700000
437100         PERFORM 7552-UPDATE-TRECEIV                              43710000
437200                                                                  43720000
437300*IR-122: SHUT DOWN ALL NON-ZERO WORK ORDER INSTRUCTIONS AND SET   43730000
437400*        THE WORK ORDERS TO 'CM'.                                 43740000
437500         PERFORM 7506-COMPLETE-TWRKORD                            43750000
437600         PERFORM 7507-COMPLETE-TWKORIN                            43760000
437700*IR-122                                                           43770000
437800     END-IF.                                                      43780000
437900                                                                  43790000
438000/                                                                 43800000
438100*----------------------------------------------------------------*43810000
438200*    IT IS NOT A ZERO LINE NUMBER SO SET THE PROPER STATUS ON    *43820000
438300*    ALL TABLES.                                                 *43830000
438400*----------------------------------------------------------------*43840000
438500                                                                  43850000
438600*AWB-03/01/94 (ADDED)                                             43860000
438700                                                                  43870000
438800 7505-SET-ALL-STATUSES.                                           43880000
438900                                                                  43890000
439000     PERFORM 7520-COUNT-TWRKORD.                                  43900000
439100     IF  PV-DB2-COUNT EQUAL ZERO                                  43910000
439200         PERFORM 7540-COUNT-TWKORIN                               43920000
439300         IF  PV-DB2-COUNT EQUAL ZERO                              43930000
439400             PERFORM 7550-COMPLETE-RECEIVER                       43940000
439500* BAB WR280 FROM HERE                                             43950000
439600             PERFORM 7060-COUNT-ZEROLINE-INSTR                    43960000
439700             IF  PV-WO-STOP-COUNT > ZERO                          43970000
439800                 PERFORM 7052-SELECT-ZEROLINE-WRKORD              43980000
439900                 PERFORM 7053-UPDATE-WKORIN-DATES                 43990000
440000             END-IF                                               44000000
440100* BAB WR280 TO HERE                                               44010000
440200*        END-IF                                                   44020000
440300     END-IF.                                                      44030000
440400/                                                                 44040000
440500                                                                  44050000
440600 7506-COMPLETE-TWRKORD.                                           44060000
440700                                                                  44070000
440800                                                                  44080000
440900     EXEC SQL                                                     44090000
441000          UPDATE                                                  44100000
441100                TWRKORD                                           44110000
441200          SET   CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    44120000
441300              , STAT_CDE           =  :PC-CM                      44130000
441400          WHERE                                                   44140000
441500                ORD_NBR            =  :ASC-KEY-PO-NBR             44150000
441600          AND   ORD_LNE_NBR        >  0                           44160000
441700          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       44170000
441800          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        44180000
441900          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           44190000
442000          AND   VER_STATUS_CDE     =  :PC-A                       44200000
442100     END-EXEC.                                                    44210000
442200                                                                  44220000
442300     EVALUATE TRUE                                                44230000
442400         WHEN SQLCODE = ZERO                                      44240000
442500         WHEN SQLCODE = +100                                      44250000
442600              CONTINUE                                            44260000
442700         WHEN SQLCODE = -904                                      44270000
442800         WHEN SQLCODE = -911                                      44280000
442900         WHEN SQLCODE = -913                                      44290000
443000              SET PS-UPDATES-DONE TO TRUE                         44300000
443100              PERFORM 9900-SOFT-ABORT                             44310000
443200         WHEN SQLWARN0 NOT = SPACE                                44320000
443300         WHEN SQLCODE NOT = ZERO                                  44330000
443400              MOVE '7506-COMPLETE-TWRKORD'                        44340000
443500                               TO DP013-PARAGRAPH                 44350000
443600              MOVE 'SET THE STATUS TO COMPLETE FOR ALL TWRKORD'   44360000
443700                               TO DP013-MESSAGE-TEXT (1)          44370000
443800              MOVE SQLCA       TO DP013-SQLCA                     44380000
443900              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (1)        44390000
444000              SET DP013-DB2-ABEND                                 44400000
444100                               TO TRUE                            44410000
444200              PERFORM DP013-0000-PROCESS-ABEND                    44420000
444300     END-EVALUATE.                                                44430000
444400/                                                                 44440000
444500 7507-COMPLETE-TWKORIN.                                           44450000
444600                                                                  44460000
444700     EXEC SQL                                                     44470000
444800          UPDATE                                                  44480000
444900                TWKORIN                                           44490000
445000          SET   STRT_TMST          =  CURRENT TIMESTAMP           44500000
445100              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    44510000
445200          WHERE                                                   44520000
445300                ORD_NBR            =  :ASC-KEY-PO-NBR             44530000
445400          AND   ORD_LNE_NBR        >  0                           44540000
445500          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       44550000
445600* 11/17   AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        44560065
445700* 11/17   AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           44570065
445800          AND   VER_STATUS_CDE     =  :PC-A                       44580000
445900          AND   STRT_TMST          >  CURRENT TIMESTAMP           44590000
446000     END-EXEC.                                                    44600000
446100                                                                  44610000
446200     EVALUATE TRUE                                                44620000
446300         WHEN SQLCODE = ZERO                                      44630000
446400         WHEN SQLCODE = +100                                      44640000
446500              CONTINUE                                            44650000
446600         WHEN SQLCODE = -904                                      44660000
446700         WHEN SQLCODE = -911                                      44670000
446800         WHEN SQLCODE = -913                                      44680000
446900              SET PS-UPDATES-DONE TO TRUE                         44690000
447000              PERFORM 9900-SOFT-ABORT                             44700000
447100         WHEN SQLWARN0 NOT = SPACE                                44710000
447200         WHEN SQLCODE NOT = ZERO                                  44720000
447300              MOVE '7507-COMPLETE-TWKORIN'                        44730000
447400                               TO DP013-PARAGRAPH                 44740000
447500              MOVE 'SET THE START TIMESTAMP FOR ALL TWKORIN'      44750000
447600                               TO DP013-MESSAGE-TEXT (1)          44760000
447700              MOVE SQLCA       TO DP013-SQLCA                     44770000
447800              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        44780000
447900              SET DP013-DB2-ABEND                                 44790000
448000                               TO TRUE                            44800000
448100              PERFORM DP013-0000-PROCESS-ABEND                    44810000
448200     END-EVALUATE.                                                44820000
448300                                                                  44830000
448400     EXEC SQL                                                     44840000
448500          UPDATE                                                  44850000
448600                TWKORIN                                           44860000
448700          SET   STOP_TMST          =  CURRENT TIMESTAMP           44870000
448800              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    44880000
448900          WHERE                                                   44890000
449000                ORD_NBR            =  :ASC-KEY-PO-NBR             44900000
449100          AND   ORD_LNE_NBR        >  0                           44910000
449200          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       44920000
449300* 11/17   AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        44930065
449400* 11/17   AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           44940065
449500          AND   VER_STATUS_CDE     =  :PC-A                       44950000
449600          AND   STOP_TMST          >  CURRENT TIMESTAMP           44960000
449700     END-EXEC.                                                    44970000
449800                                                                  44980000
449900     EVALUATE TRUE                                                44990000
450000         WHEN SQLCODE = ZERO                                      45000000
450100         WHEN SQLCODE = +100                                      45010000
450200              CONTINUE                                            45020000
450300         WHEN SQLCODE = -904                                      45030000
450400         WHEN SQLCODE = -911                                      45040000
450500         WHEN SQLCODE = -913                                      45050000
450600              SET PS-UPDATES-DONE TO TRUE                         45060000
450700              PERFORM 9900-SOFT-ABORT                             45070000
450800         WHEN SQLWARN0 NOT = SPACE                                45080000
450900         WHEN SQLCODE NOT = ZERO                                  45090000
451000              MOVE '7507-COMPLETE-TWKORIN'                        45100000
451100                               TO DP013-PARAGRAPH                 45110000
451200              MOVE 'SET THE STOP TIMESTAMP FOR ALL TWKORIN'       45120000
451300                               TO DP013-MESSAGE-TEXT (1)          45130000
451400              MOVE SQLCA       TO DP013-SQLCA                     45140000
451500              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        45150000
451600              SET DP013-DB2-ABEND                                 45160000
451700                               TO TRUE                            45170000
451800              PERFORM DP013-0000-PROCESS-ABEND                    45180000
451900     END-EVALUATE.                                                45190000
452000/                                                                 45200000
452100*----------------------------------------------------------------*45210000
452200*    SET THE STATUS CODE TO COMPLETE FOR THIS WORK ORDER.        *45220000
452300*    RATHER THAN JUST UPDATING THE "CURRENT" ROW, WE MUST        *45230000
452400*    SET THE VER_STATUS_CODE TO INACTIVE, AND INSERT A NEW       *45240000
452500*    ROW WITH THE PROPER STATUS CODE.                            *45250000
452600*----------------------------------------------------------------*45260000
452700                                                                  45270000
452800 7510-COMPLETE-WORK-ORDER.                                        45280000
452900                                                                  45290000
453000     PERFORM 7512-UPDATE-TWRKORD.                                 45300000
453100     MOVE PC-CM                      TO ASC-STATUS-CDE.           45310000
453200/                                                                 45320000
453300*----------------------------------------------------------------*45330000
453400*    GET THE CURRENT ROW FOR PROCESSING.                         *45340000
453500*----------------------------------------------------------------*45350000
453600                                                                  45360000
453700 7511-SELECT-TWRKORD.                                             45370000
453800                                                                  45380000
453900     EXEC SQL                                                     45390000
454000          SELECT                                                  45400000
454100                ORD_NBR                                           45410000
454200              , RCVR_SEQ_NBR                                      45420000
454300              , ORD_LNE_NBR                                       45430000
454400              , WORK_ORD_SEQ_NBR                                  45440000
454500              , OPER_UNT_ID                                       45450000
454600              , FCLTY_ID                                          45460000
454700              , CRE_TMST                                          45470000
454800              , VER_STATUS_CDE                                    45480000
454900              , CRE_UID_ID                                        45490000
455000              , EXPTED_CART_CNT                                   45500000
455100              , EXPTED_ITM_CNT                                    45510000
455200              , ACTL_CART_CNT                                     45520000
455300              , ACTL_ITM_CNT                                      45530000
455400              , STAT_CDE                                          45540000
455500              , WORK_ORD_DISTR_IND                                45550000
455600              , OPER_SET_ID                                       45560000
455700          INTO                                                    45570000
455800               :WRKORD-ORD-NBR                                    45580000
455900              ,:WRKORD-RCVR-SEQ-NBR                               45590000
456000              ,:WRKORD-ORD-LNE-NBR                                45600000
456100              ,:WRKORD-WORK-ORD-SEQ-NBR                           45610000
456200              ,:WRKORD-OPER-UNT-ID                                45620000
456300              ,:WRKORD-FCLTY-ID                                   45630000
456400              ,:WRKORD-CRE-TMST                                   45640000
456500              ,:WRKORD-VER-STATUS-CDE                             45650000
456600              ,:WRKORD-CRE-UID-ID                                 45660000
456700              ,:WRKORD-EXPTED-CART-CNT                            45670000
456800              ,:WRKORD-EXPTED-ITM-CNT                             45680000
456900              ,:WRKORD-ACTL-CART-CNT                              45690000
457000              ,:WRKORD-ACTL-ITM-CNT                               45700000
457100              ,:WRKORD-STAT-CDE                                   45710000
457200              ,:WRKORD-WORK-ORD-DISTR-IND                         45720000
457300              ,:WRKORD-OPER-SET-ID                                45730000
457400          FROM                                                    45740000
457500                TWRKORD                                           45750000
457600          WHERE                                                   45760000
457700                ORD_NBR            =  :ASC-KEY-PO-NBR             45770000
457800          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           45780000
457900          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       45790000
458000          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   45800000
458100***10/09  AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        45810062
458200***10/09  AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           45820062
458300          AND   VER_STATUS_CDE     =  :PC-A                       45830000
458400     END-EXEC.                                                    45840000
458500                                                                  45850000
458600     EVALUATE TRUE                                                45860000
458700         WHEN SQLCODE = ZERO                                      45870000
458800              CONTINUE                                            45880000
458900         WHEN SQLCODE = +100                                      45890000
459000              SET PS-DATA-NOT-OK    TO TRUE                       45900000
459100         WHEN SQLCODE = -904                                      45910000
459200         WHEN SQLCODE = -911                                      45920000
459300         WHEN SQLCODE = -913                                      45930000
459400              PERFORM 9900-SOFT-ABORT                             45940000
459500         WHEN SQLWARN0 NOT = SPACE                                45950000
459600         WHEN SQLCODE NOT = ZERO                                  45960000
459700              MOVE '7511-SELECT-TWRKORD'                          45970000
459800                               TO DP013-PARAGRAPH                 45980000
459900              MOVE 'SELECT TWRKORD'                               45990000
460000                               TO DP013-MESSAGE-TEXT (1)          46000000
460100              MOVE SQLCA       TO DP013-SQLCA                     46010000
460200              MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)        46020000
460300              SET DP013-DB2-ABEND                                 46030000
460400                               TO TRUE                            46040000
460500              PERFORM DP013-0000-PROCESS-ABEND                    46050000
460600     END-EVALUATE.                                                46060000
460700/                                                                 46070000
460800*----------------------------------------------------------------*46080000
460900*    CHANGE THE CURRENT ROW TO NOT ACTIVE.                       *46090000
461000*----------------------------------------------------------------*46100000
461100                                                                  46110000
461200 7512-UPDATE-TWRKORD.                                             46120000
461300                                                                  46130000
461400     EXEC SQL                                                     46140000
461500          UPDATE                                                  46150000
461600                TWRKORD                                           46160000
461700          SET   STAT_CDE           =  :PC-CM                      46170000
461800              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    46180000
461900          WHERE                                                   46190000
462000                ORD_NBR            =  :ASC-KEY-PO-NBR             46200000
462100          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           46210000
462200          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       46220000
462300          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   46230000
462400          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        46240000
462500          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           46250000
462600          AND   VER_STATUS_CDE     =  :PC-A                       46260000
462700     END-EXEC.                                                    46270000
462800                                                                  46280000
462900     EVALUATE TRUE                                                46290000
463000         WHEN SQLCODE = ZERO                                      46300000
463100         WHEN SQLCODE = +100                                      46310000
463200              CONTINUE                                            46320000
463300         WHEN SQLCODE = -904                                      46330000
463400         WHEN SQLCODE = -911                                      46340000
463500         WHEN SQLCODE = -913                                      46350000
463600              SET PS-UPDATES-DONE TO TRUE                         46360000
463700              PERFORM 9900-SOFT-ABORT                             46370000
463800         WHEN SQLWARN0 NOT = SPACE                                46380000
463900         WHEN SQLCODE NOT = ZERO                                  46390000
464000              MOVE '7512-UPDATE-TWRKORD'                          46400000
464100                               TO DP013-PARAGRAPH                 46410000
464200              MOVE 'UPDATE TWRKORD STATUS CODE'                   46420000
464300                               TO DP013-MESSAGE-TEXT (1)          46430000
464400              MOVE SQLCA       TO DP013-SQLCA                     46440000
464500              MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)        46450000
464600              SET DP013-DB2-ABEND                                 46460000
464700                               TO TRUE                            46470000
464800              PERFORM DP013-0000-PROCESS-ABEND                    46480000
464900     END-EVALUATE.                                                46490000
465000/                                                                 46500000
465100*----------------------------------------------------------------*46510000
465200*    SEE IF THERE ARE ANY OTHER ORDERS TO COMPLETE.              *46520000
465300*----------------------------------------------------------------*46530000
465400                                                                  46540000
465500 7520-COUNT-TWRKORD.                                              46550000
465600                                                                  46560000
465700     MOVE ZERO            TO PV-DB2-COUNT.                        46570000
465800     EXEC SQL                                                     46580000
465900          SELECT                                                  46590000
466000                COUNT(*)                                          46600000
466100          INTO                                                    46610000
466200                :PV-DB2-COUNT :PV-NULL-IND                        46620000
466300          FROM                                                    46630000
466400                TWRKORD                                           46640000
466500          WHERE                                                   46650000
466600                ORD_NBR            =  :ASC-KEY-PO-NBR             46660000
466700          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           46670000
466800          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       46680000
466900          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        46690000
467000          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           46700000
467100          AND   STAT_CDE          ^=  :PC-CM                      46710000
467200          AND   VER_STATUS_CDE     =  :PC-A                       46720000
467300     END-EXEC.                                                    46730000
467400                                                                  46740000
467500     EVALUATE TRUE                                                46750000
467600         WHEN SQLCODE = ZERO                                      46760000
467700         WHEN SQLCODE = +100                                      46770000
467800              CONTINUE                                            46780000
467900         WHEN SQLCODE = -904                                      46790000
468000         WHEN SQLCODE = -911                                      46800000
468100         WHEN SQLCODE = -913                                      46810000
468200              PERFORM 9900-SOFT-ABORT                             46820000
468300         WHEN SQLWARN0 NOT = SPACE                                46830000
468400         WHEN SQLCODE NOT = ZERO                                  46840000
468500              MOVE '7520-COUNT-TWRKORD'                           46850000
468600                               TO DP013-PARAGRAPH                 46860000
468700              MOVE 'COUNT NUMBER OF WORK ORDERS NOT COMPLETE'     46870000
468800                               TO DP013-MESSAGE-TEXT (1)          46880000
468900              MOVE SQLCA       TO DP013-SQLCA                     46890000
469000              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (1)        46900000
469100              SET DP013-DB2-ABEND                                 46910000
469200                               TO TRUE                            46920000
469300              PERFORM DP013-0000-PROCESS-ABEND                    46930000
469400     END-EVALUATE.                                                46940000
469500/                                                                 46950000
469600*----------------------------------------------------------------*46960000
469700*    SEE IF THERE ARE ANY OTHER ORDERS TO COMPLETE.              *46970000
469800*----------------------------------------------------------------*46980000
469900                                                                  46990000
470000 7540-COUNT-TWKORIN.                                              47000000
470100                                                                  47010000
470200     MOVE ZERO            TO PV-DB2-COUNT.                        47020000
470300     EXEC SQL                                                     47030000
470400          SELECT                                                  47040000
470500                COUNT(*)                                          47050000
470600          INTO                                                    47060000
470700                :PV-DB2-COUNT :PV-NULL-IND                        47070000
470800          FROM                                                    47080000
470900                TWKORIN                                           47090000
471000          WHERE                                                   47100000
471100                ORD_NBR            =  :ASC-KEY-PO-NBR             47110000
471200            AND RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       47120000
471300* 11/17     AND OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        47130065
471400* 11/17     AND FCLTY_ID           =  :ASC-KEY-FCLTY-ID           47140065
471500            AND ORD_LNE_NBR        >  0                           47150000
471600            AND VER_STATUS_CDE     =  :PC-A                       47160000
471700            AND STOP_TMST          =  :PC-DB2-DEFAULT-DATE        47170000
471800     END-EXEC.                                                    47180000
471900                                                                  47190000
472000     EVALUATE TRUE                                                47200000
472100         WHEN SQLCODE = ZERO                                      47210000
472200         WHEN SQLCODE = +100                                      47220000
472300              CONTINUE                                            47230000
472400         WHEN SQLCODE = -904                                      47240000
472500         WHEN SQLCODE = -911                                      47250000
472600         WHEN SQLCODE = -913                                      47260000
472700              PERFORM 9900-SOFT-ABORT                             47270000
472800         WHEN SQLWARN0 NOT = SPACE                                47280000
472900         WHEN SQLCODE NOT = ZERO                                  47290000
473000              MOVE '7540-COUNT-TWKORIN'                           47300000
473100                               TO DP013-PARAGRAPH                 47310000
473200              MOVE 'COUNT NUMBER OF WORK ORDERS NOT COMPLETE'     47320000
473300                               TO DP013-MESSAGE-TEXT (1)          47330000
473400              MOVE SQLCA       TO DP013-SQLCA                     47340000
473500              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        47350000
473600              SET DP013-DB2-ABEND                                 47360000
473700                               TO TRUE                            47370000
473800              PERFORM DP013-0000-PROCESS-ABEND                    47380000
473900     END-EVALUATE.                                                47390000
474000/                                                                 47400000
474100*----------------------------------------------------------------*47410000
474200*    SET THE STATUS CODE TO COMPLETE FOR THIS RECEIVER.          *47420000
474300*    RATHER THAN JUST UPDATING THE "CURRENT" ROW, WE MUST        *47430000
474400*    SET THE VER_STATUS_CODE TO INACTIVE, AND INSERT A NEW       *47440000
474500*    ROW WITH THE PROPER STATUS CODE.                            *47450000
474600*----------------------------------------------------------------*47460000
474700                                                                  47470000
474800 7550-COMPLETE-RECEIVER.                                          47480000
474900                                                                  47490000
475000     PERFORM 7553-LINK-AUDIT-MODULE.                              47500000
475100     PERFORM 7552-UPDATE-TRECEIV.                                 47510000
475200/                                                                 47520000
475300*----------------------------------------------------------------*47530000
475400*    GET THE CURRENT ROW FOR PROCESSING.                         *47540000
475500*----------------------------------------------------------------*47550000
475600                                                                  47560000
475700 7551-SELECT-TRECEIV.                                             47570000
475800                                                                  47580000
475900     EXEC SQL                                                     47590000
476000          SELECT                                                  47600000
476100              PACK_BY_ST_IND                                      47610000
476200          INTO                                                    47620000
476300             :RECEIV-PACK-BY-ST-IND                               47630025
476400          FROM                                                    47640000
476500                TRECEIV                                           47650000
476600          WHERE                                                   47660000
476700                ORD_NBR            =  :ASC-KEY-PO-NBR             47670000
476800          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       47680000
476900          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        47690000
477000          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           47700000
477100          AND   VER_STATUS_CDE     =  :PC-A                       47710000
477200     END-EXEC.                                                    47720000
477300                                                                  47730000
477400     EVALUATE TRUE                                                47740000
477500         WHEN SQLCODE = ZERO                                      47750000
477600              CONTINUE                                            47760000
477700         WHEN SQLCODE = +100                                      47770000
477800              SET PS-DATA-NOT-OK    TO TRUE                       47780000
477900         WHEN SQLCODE = -904                                      47790000
478000         WHEN SQLCODE = -911                                      47800000
478100         WHEN SQLCODE = -913                                      47810000
478200              PERFORM 9900-SOFT-ABORT                             47820000
478300         WHEN SQLWARN0 NOT = SPACE                                47830000
478400         WHEN SQLCODE NOT = ZERO                                  47840000
478500              MOVE '7551-SELECT-TRECEIV'                          47850000
478600                               TO DP013-PARAGRAPH                 47860000
478700              MOVE 'SELECT TRECEIV'                               47870000
478800                               TO DP013-MESSAGE-TEXT (1)          47880000
478900              MOVE SQLCA       TO DP013-SQLCA                     47890000
479000              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        47900000
479100              SET DP013-DB2-ABEND                                 47910000
479200                               TO TRUE                            47920000
479300              PERFORM DP013-0000-PROCESS-ABEND                    47930000
479400     END-EVALUATE.                                                47940000
479500/                                                                 47950000
479600*----------------------------------------------------------------*47960000
479700*    CHANGE THE CURRENT ROW TO NOT ACTIVE.                       *47970000
479800*----------------------------------------------------------------*47980000
479900                                                                  47990000
480000 7552-UPDATE-TRECEIV.                                             48000000
480100                                                                  48010000
480200     EXEC SQL                                                     48020000
480300          UPDATE                                                  48030000
480400                TRECEIV                                           48040000
480500          SET   STATUS_CDE         =  :PC-CM                      48050000
480600               ,VER_STATUS_CDE     =  :PC-A                       48060000
480700               ,UPD_TMST           =  CURRENT TIMESTAMP           48070000
480800               ,UPD_UID            =  :DP020-USERID               48080000
480900               ,UPD_PGM_ID         =  :PC-CURRENT-PROGRAM-NAME    48090000
481000          WHERE                                                   48100000
481100                ORD_NBR            =  :ASC-KEY-PO-NBR             48110000
481200          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       48120000
481300          AND   OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID        48130000
481400          AND   FCLTY_ID           =  :ASC-KEY-FCLTY-ID           48140000
481500          AND   VER_STATUS_CDE     =  :PC-A                       48150000
481600          AND   STATUS_CDE         =  :PC-IP                      48160000
481700     END-EXEC.                                                    48170000
481800                                                                  48180000
481900     EVALUATE TRUE                                                48190000
482000         WHEN SQLCODE = ZERO                                      48200000
482100         WHEN SQLCODE = +100                                      48210000
482200              CONTINUE                                            48220000
482300         WHEN SQLCODE = -904                                      48230000
482400         WHEN SQLCODE = -911                                      48240000
482500         WHEN SQLCODE = -913                                      48250000
482600              SET PS-UPDATES-DONE TO TRUE                         48260000
482700              PERFORM 9900-SOFT-ABORT                             48270000
482800         WHEN SQLWARN0 NOT = SPACE                                48280000
482900         WHEN SQLCODE NOT = ZERO                                  48290000
483000              MOVE '7552-UPDATE-TRECEIV'                          48300022
483100                               TO DP013-PARAGRAPH                 48310000
483200              MOVE 'UPDATE TRECEIV STATUS CODE'                   48320000
483300                               TO DP013-MESSAGE-TEXT (1)          48330000
483400              MOVE SQLCA       TO DP013-SQLCA                     48340000
483500              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        48350000
483600              SET DP013-DB2-ABEND                                 48360000
483700                               TO TRUE                            48370000
483800              PERFORM DP013-0000-PROCESS-ABEND                    48380000
483900     END-EVALUATE.                                                48390000
484000/                                                                 48400000
484100*----------------------------------------------------------------*48410000
484200*    LINK TO AUDIT MODULE * RCKCS290                             *48420000
484300*----------------------------------------------------------------*48430000
484400                                                                  48440000
484500 7553-LINK-AUDIT-MODULE.                                          48450000
484600                                                                  48460000
484700     MOVE 'V'                   TO RC031-TABLE-TO-AUDIT.          48470000
484800     MOVE 'B'                   TO RC031-AUD-TYP-CDE.             48480000
484900     MOVE 'U'                   TO RC031-AUD-FUNC-CDE.            48490000
485000     MOVE ASC-KEY-OPER-UNT-ID   TO RC031-OPER-UNT-ID.             48500000
485100     MOVE ASC-KEY-FCLTY-ID      TO RC031-FCLTY-ID.                48510000
485200     MOVE ASC-KEY-PO-NBR        TO RC031-PO-NBR.                  48520000
485300     MOVE ASC-KEY-RCVR-SEQ-NBR  TO RC031-REC-SEQ-NBR.             48530000
485400                                                                  48540000
485500     EXEC CICS                                                    48550000
485600          LINK PROGRAM  (PC-AUDIT-RTN)                            48560000
485700          COMMAREA (RC031-FIELDS)                                 48570000
485800          LENGTH   (PC-AUDIT-RTN-LENGTH)                          48580000
485900     END-EXEC.                                                    48590000
486000                                                                  48600000
486100     EVALUATE TRUE                                                48610000
486200         WHEN RC031-CALL-SUCCESSFUL                               48620000
486300             CONTINUE                                             48630000
486400         WHEN OTHER                                               48640000
486500             MOVE '7553-LINK-AUDIT-MODULE'                        48650000
486600                                 TO DP013-PARAGRAPH               48660000
486700             MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                48670000
486800                                 TO DP013-MESSAGE-TEXT (1)        48680000
486900             MOVE RC031-RETURN-DESC                               48690000
487000                                 TO DP013-MESSAGE-TEXT (2)        48700000
487100             MOVE RC031-SQLCA    TO DP013-SQLCA                   48710000
487200             SET DP013-DB2-ABEND                                  48720000
487300                 DP013-XCTL-DISPLAY-RESTART                       48730000
487400                                 TO TRUE                          48740000
487500             PERFORM DP013-0000-PROCESS-ABEND                     48750000
487600     END-EVALUATE.                                                48760000
487700/                                                                 48770000
487800*----------------------------------------------------------------*48780000
487900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *48790000
488000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *48800000
488100*----------------------------------------------------------------*48810000
488200                                                                  48820000
488300 8100-WRITE-TEMP-STORAGE.                                         48830000
488400                                                                  48840000
488500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     48850000
488600                                   TO PV-LIST-ITEM-NUMBER.        48860000
488700     COMPUTE PV-BLOCK-NUMBER =                                    48870000
488800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    48880000
488900                                                                  48890000
489000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             48900000
489100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             48910000
489200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      48920000
489300             PERFORM 8105-REWRITE-ASC-LISTQ                       48930000
489400         END-IF                                                   48940000
489500     ELSE                                                         48950000
489600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       48960000
489700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            48970000
489800         PERFORM 8110-WRITE-ASC-LISTQ                             48980000
489900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   48990000
490000     END-IF.                                                      49000000
490100                                                                  49010000
490200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             49020000
490300                                                                  49030000
490400******************************************************************49040000
490500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **49050000
490600** SPECIFIC COMMAREA.                                           **49060000
490700******************************************************************49070000
490800                                                                  49080000
490900 8105-REWRITE-ASC-LISTQ.                                          49090000
491000                                                                  49100000
491100     EXEC CICS                                                    49110000
491200         WRITEQ TS                                                49120000
491300             QUEUE (ASC-LIST-QUEUE-NAME)                          49130000
491400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               49140000
491500             ITEM  (PV-BLOCK-NUMBER)                              49150000
491600             REWRITE                                              49160000
491700             RESP  (PV-CICS-RESP)                                 49170000
491800     END-EXEC.                                                    49180000
491900                                                                  49190000
492000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           49200000
492100         CONTINUE                                                 49210000
492200     ELSE                                                         49220000
492300         SET DP013-CICS-ABEND            TO TRUE                  49230000
492400         SET DP013-NO-ROLLBACK           TO TRUE                  49240000
492500         MOVE '8105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       49250000
492600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     49260000
492700                                         TO DP013-MESSAGE-TEXT(1) 49270000
492800         PERFORM DP013-0000-PROCESS-ABEND                         49280000
492900     END-IF.                                                      49290000
493000                                                                  49300000
493100******************************************************************49310000
493200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **49320000
493300** SPECIFIC COMMAREA.                                           **49330000
493400******************************************************************49340000
493500                                                                  49350000
493600 8110-WRITE-ASC-LISTQ.                                            49360000
493700                                                                  49370000
493800     EXEC CICS                                                    49380000
493900         WRITEQ TS                                                49390000
494000             QUEUE (ASC-LIST-QUEUE-NAME)                          49400000
494100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               49410000
494200             ITEM  (PV-BLOCK-NUMBER)                              49420000
494300             RESP  (PV-CICS-RESP)                                 49430000
494400     END-EXEC.                                                    49440000
494500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      49450000
494600         SET DP013-CICS-ABEND      TO TRUE                        49460000
494700         SET DP013-NO-ROLLBACK     TO TRUE                        49470000
494800         MOVE '8110-WRITE-ASC-LISTQ'                              49480000
494900                                   TO DP013-PARAGRAPH             49490000
495000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           49500000
495100                                   TO DP013-MESSAGE-TEXT(1)       49510000
495200         PERFORM DP013-0000-PROCESS-ABEND                         49520000
495300     END-IF.                                                      49530000
495400                                                                  49540000
495500*----------------------------------------------------------------*49550000
495600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *49560000
495700*----------------------------------------------------------------*49570000
495800                                                                  49580000
495900 8111-WRITE-LIST-QUEUE.                                           49590000
496000                                                                  49600000
496100     EXEC CICS                                                    49610000
496200         WRITEQ TS                                                49620000
496300             QUEUE (ASC-LIST-QUEUE-NAME)                          49630000
496400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     49640000
496500             ITEM  (PV-SAVE-ITEM)                                 49650000
496600             REWRITE                                              49660000
496700             RESP  (PV-CICS-RESP)                                 49670000
496800     END-EXEC.                                                    49680000
496900                                                                  49690000
497000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          49700000
497100         CONTINUE                                                 49710000
497200     ELSE                                                         49720000
497300         SET DP013-CICS-ABEND  TO TRUE                            49730000
497400         SET DP013-NO-ROLLBACK TO TRUE                            49740000
497500         MOVE '8111-WRITE-LIST-QUEUE'                             49750000
497600                               TO DP013-PARAGRAPH                 49760000
497700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  49770000
497800                               TO DP013-MESSAGE-TEXT(1)           49780000
497900         PERFORM DP013-0000-PROCESS-ABEND                         49790000
498000     END-IF.                                                      49800000
498100/                                                                 49810000
498200*----------------------------------------------------------------*49820000
498300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*49830000
498400*----------------------------------------------------------------*49840000
498500                                                                  49850000
498600 8112-READ-LIST-QUEUE.                                            49860000
498700                                                                  49870000
498800     EXEC CICS                                                    49880000
498900         READQ TS                                                 49890000
499000             QUEUE (ASC-LIST-QUEUE-NAME)                          49900000
499100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     49910000
499200             ITEM  (PV-ITEM)                                      49920000
499300             RESP  (PV-CICS-RESP)                                 49930000
499400     END-EXEC.                                                    49940000
499500                                                                  49950000
499600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          49960000
499700         CONTINUE                                                 49970000
499800     ELSE                                                         49980000
499900         SET DP013-CICS-ABEND        TO TRUE                      49990000
500000         SET DP013-NO-ROLLBACK       TO TRUE                      50000000
500100         MOVE '8112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           50010000
500200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    50020000
500300                                     TO DP013-MESSAGE-TEXT(1)     50030000
500400         PERFORM DP013-0000-PROCESS-ABEND                         50040000
500500     END-IF.                                                      50050000
500600/                                                                 50060000
500700*----------------------------------------------------------------*50070000
500800* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *50080000
500900*----------------------------------------------------------------*50090000
501000                                                                  50100000
501100 9100-READ-SEL-QUEUE.                                             50110000
501200                                                                  50120000
501300     EXEC CICS                                                    50130000
501400         READQ TS                                                 50140000
501500             QUEUE (ASC-SEL-QUEUE-NAME)                           50150000
501600             INTO  (PC016-TS-SEL-REC)                             50160000
501700             ITEM  (ASC-SEL-ITEM)                                 50170000
501800             RESP  (PV-CICS-RESP)                                 50180000
501900     END-EXEC.                                                    50190000
502000                                                                  50200000
502100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       50210000
502200         CONTINUE                                                 50220000
502300     ELSE                                                         50230000
502400         SET DP013-LOGIC-ABEND                                    50240000
502500             DP013-NO-ROLLBACK     TO TRUE                        50250000
502600         MOVE '9100-READ-SEL-QUEUE'                               50260000
502700                                   TO DP013-PARAGRAPH             50270000
502800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   50280000
502900                                   TO DP013-MESSAGE-TEXT (1)      50290000
503000         PERFORM DP013-0000-PROCESS-ABEND                         50300000
503100     END-IF.                                                      50310000
503200                                                                  50320000
503300*----------------------------------------------------------------*50330000
503400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *50340000
503500*----------------------------------------------------------------*50350000
503600                                                                  50360000
503700 9200-REWRITE-LIST-QUEUE.                                         50370000
503800                                                                  50380000
503900     EXEC CICS                                                    50390000
504000          WRITEQ TS                                               50400000
504100              QUEUE  (ASC-SEL-QUEUE-NAME)                         50410000
504200              FROM   (PC016-TS-SEL-REC)                           50420000
504300              ITEM   (ASC-SEL-ITEM)                               50430000
504400              RESP   (PV-CICS-RESP)                               50440000
504500              REWRITE                                             50450000
504600     END-EXEC.                                                    50460000
504700                                                                  50470000
504800     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   50480000
504900         SET DP013-CICS-ABEND                                     50490000
505000             DP013-NO-ROLLBACK     TO TRUE                        50500000
505100         MOVE '9200-REWRITE-LIST-QUEUE'                           50510000
505200                                   TO DP013-PARAGRAPH             50520000
505300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   50530000
505400                                   TO DP013-MESSAGE-TEXT (1)      50540000
505500         PERFORM DP013-0000-PROCESS-ABEND                         50550000
505600     END-IF.                                                      50560000
505700/                                                                 50570000
505800*----------------------------------------------------------------*50580000
505900*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *50590000
506000*    AND THE ERROR SWITCHES.                                     *50600000
506100*----------------------------------------------------------------*50610000
506200                                                                  50620000
506300 9900-SOFT-ABORT.                                                 50630000
506400                                                                  50640000
506500     SET PS-ERROR                TO TRUE.                         50650000
506600     SET DP020-MSG-FATAL         TO TRUE.                         50660000
506700     MOVE PC-TSYMSG-00551        TO DP020-MSG-NUMBER.             50670000
506800     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       50680000
506900     IF PS-UPDATES-DONE AND SQLCODE = -913                        50690000
507000        PERFORM 9901-BACKUP                                       50700000
507100     END-IF.                                                      50710000
507200     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      50720000
507300     PERFORM 0001-CALL-CICS-ARCH-API.                             50730000
507400                                                                  50740000
507500 9901-BACKUP.                                                     50750000
507600     EXEC CICS SYNCPOINT                                          50760000
507700          ROLLBACK                                                50770000
507800     END-EXEC.                                                    50780000
507900/                                                                 50790000
508000*----------------------------------------------------------------*50800000
508100*    ABEND PROCESSOR MODULE                                      *50810000
508200*----------------------------------------------------------------*50820000
508300                                                                  50830000
508400     COPY DPPD013.                                                50840000
