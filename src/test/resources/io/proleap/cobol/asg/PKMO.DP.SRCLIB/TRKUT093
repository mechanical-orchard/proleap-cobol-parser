000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.              TRKUT093.                               00020001
000300 AUTHOR.                  DENISE HAHN.                            00030001
000400 DATE-WRITTEN.            FEBRUARY 2021.                          00040001
000500 DATE-COMPILED.                                                   00050001
000600                                                                  00060001
000700******************************************************************00070001
000800* THIS PROGRAM WILL EXTRACT DATA FROM TTRIPST WHERE THE CURRENT  *00080001
000810* TRIP STATUS  IS NOT (DE, ET) AND THE TRIP DOES NOT EXIST ON    *00081001
000811* TVEHICL.                                                       *00081101
000812* SECOND CURSOR WILL BE THE SAME BUT IT WILL USE TSHIPST         *00081201
000813*                                                                *00081301
000814* EXTRACT WILL BE USED BY TRKUP093 TO INSERT DE & ET ROWS INTO   *00081401
000815* TSHIPST & TTRIPST                                              *00081501
000816******************************************************************00081601
000817 ENVIRONMENT DIVISION.                                            00081701
000818 CONFIGURATION SECTION.                                           00081801
000819                                                                  00081901
000820 INPUT-OUTPUT SECTION.                                            00082001
000830 FILE-CONTROL.                                                    00083001
000840                                                                  00084001
000850     SELECT TRIP-FILE                                             00085001
000860        ASSIGN TO OUT01.                                          00086001
000870                                                                  00087001
000880     SELECT SHPMT-FILE                                            00088001
000890        ASSIGN TO OUT02.                                          00089001
000900                                                                  00090001
000910 DATA DIVISION.                                                   00091001
000920 FILE SECTION.                                                    00092001
000921                                                                  00092101
000922 FD  TRIP-FILE                                                    00092201
000923     RECORDING MODE IS F                                          00092301
000924     LABEL RECORDS ARE STANDARD                                   00092401
000925     RECORD CONTAINS 125 CHARACTERS                               00092501
000926     DATA RECORD IS TRIP-RECORD.                                  00092601
000927                                                                  00092701
000928 01  TRIP-RECORD                 PIC X(125).                      00092801
000929                                                                  00092901
000930                                                                  00093001
000940 FD  SHPMT-FILE                                                   00094001
000950     RECORDING MODE IS F                                          00095001
000960     LABEL RECORDS ARE STANDARD                                   00096001
000970     RECORD CONTAINS 100 CHARACTERS                               00097001
000980     DATA RECORD IS SHPMT-RECORD.                                 00098001
000990                                                                  00099001
001000 01  SHPMT-RECORD                PIC X(100).                      00100001
001100                                                                  00110001
001200                                                                  00120001
001300 WORKING-STORAGE SECTION.                                         00130001
001400                                                                  00140001
001500                                                                  00150001
001600 01  PROGRAM-SWITCHES.                                            00160001
001700     05  PS-END-OF-TRIP-CSR-SW       PIC  X(01)  VALUE 'N'.       00170001
001800         88  PS-END-OF-TRIP-CSR-YES              VALUE 'Y'.       00180001
001900         88  PS-END-OF-TRIP-CSR-NO               VALUE 'N'.       00190001
002000     05  PS-END-OF-SHPMT-CSR-SW      PIC  X(01)  VALUE 'N'.       00200001
002010         88  PS-END-OF-SHPMT-CSR-YES             VALUE 'Y'.       00201001
002020         88  PS-END-OF-SHPMT-CSR-NO              VALUE 'N'.       00202001
002030     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00203001
002040         88  PS-ERROR-YES                        VALUE 'Y'.       00204001
002050         88  PS-ERROR-NO                         VALUE 'N'.       00205001
002060                                                                  00206001
002070 01  PV-ABEND-FIELDS.                                             00207001
002080     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUT093'.00208001
002090     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00209001
002100                                                 COMP SYNC.       00210001
002200     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00220001
002300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00230001
002400     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00240001
002500     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00250001
002600     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00260001
002700     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00270001
002800     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00280001
002900     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00290001
003000     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00300001
003100     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00310001
003200     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00320001
003300     05  PV-DAYS-BACK-DISP           PIC  Z(09)  VALUE ZEROES.    00330001
003400     05  PV-DAYS-BACK                PIC S9(09)  VALUE ZEROES     00340001
003500                                                 COMP.            00350001
003600     05  PV-CURRENT-DATE             PIC  X(10)  VALUE SPACES.    00360001
003700     05  PV-CHECK-DATE               PIC  X(10)  VALUE SPACES.    00370001
003710     05  PV-NULL-IND                    PIC S9(04)  VALUE ZEROS   00371003
003720                                                    COMP SYNC.    00372003
003900                                                                  00390001
004000 01  DK-DB2-KEYS.                                                 00400001
004100     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00410001
004200 01  PROGRAM-VARIABLES.                                           00420001
004300     05  PV-TRIP-COUNT               PIC  9(09).                  00430001
004400     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00440001
004500                                                 COMP.            00450001
004600     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00460001
004700                                                 COMP SYNC.       00470001
004800     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00480001
004900                                                 COMP SYNC.       00490001
005000     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00500001
005100     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00510001
005200                                                                  00520001
005300 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00530001
005400     88 ABEND-4013                         VALUE +4013.           00540001
005500                                                                  00550001
005600***************************************************************** 00560001
005610*    TRIP FILE LAYOUT                                           * 00561001
005620***************************************************************** 00562001
005630     COPY TRRD074.                                                00563001
005640                                                                  00564001
005650***************************************************************** 00565001
005660*    SHPMT FILE LAYOUT                                          * 00566001
005670***************************************************************** 00567001
005680     COPY TRRD075.                                                00568001
005690                                                                  00569001
005700***************************************************************** 00570001
005800*    SQL ABEND ROUTINE WORKING STORAGE                          * 00580001
005900***************************************************************** 00590001
005910     COPY DPWS004.                                                00591001
005920                                                                  00592001
005930     EXEC SQL                                                     00593001
005940        INCLUDE TVEHICL                                           00594001
005950     END-EXEC.                                                    00595001
005960                                                                  00596001
005961     EXEC SQL                                                     00596102
005962        INCLUDE TVHTRIP                                           00596202
005963     END-EXEC.                                                    00596302
005964                                                                  00596402
005970     EXEC SQL                                                     00597001
005980        INCLUDE TTRIPST                                           00598001
005990     END-EXEC.                                                    00599001
006000                                                                  00600001
006100     EXEC SQL                                                     00610001
006200        INCLUDE TTRSTYP                                           00620001
006300     END-EXEC.                                                    00630001
006400                                                                  00640001
006500     EXEC SQL                                                     00650001
006600        INCLUDE TSHIPMT                                           00660001
006700     END-EXEC.                                                    00670001
006800                                                                  00680001
006900     EXEC SQL                                                     00690001
007000        INCLUDE TSHIPST                                           00700001
007100     END-EXEC.                                                    00710001
007200                                                                  00720001
007300     EXEC SQL                                                     00730001
007400        INCLUDE TSHSTYP                                           00740001
007500     END-EXEC.                                                    00750001
007600                                                                  00760001
008100     EXEC SQL                                                     00810001
008200        INCLUDE TKRPRPM                                           00820001
008210     END-EXEC.                                                    00821001
008211                                                                  00821101
008212******************************************************************00821201
008213* CURSOR WILL SELECT ANY TRIP FROM TVHTRIP/TTRIPST NOT           *00821301
008214* ET (END TRIP) OR DE (DELETED) -  THE TRIP IS NOT ON TVEHICL    *00821401
008215* AND STATUS DATE X DAYS OLD (PARM TRIPG3)                       *00821501
008220******************************************************************00822001
008221                                                                  00822101
008222     EXEC SQL                                                     00822201
008223        DECLARE TRIP_CSR CURSOR FOR                               00822301
008224         SELECT DISTINCT                                          00822401
008225                C.OWNER_SCAC_ID                                   00822501
008226              , C.VEH_NBR                                         00822601
008227              , A.TRIP_ID                                         00822701
008228              , A.TRIP_STATUS_CDE                                 00822801
008229              , A.STATUS_DTE                                      00822901
008230              , A.STATUS_TME                                      00823001
008231              , A.STATUS_UID                                      00823101
008240              , A.OPER_UNT_ID                                     00824001
008250              , A.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            00825001
008260           FROM TTRIPST A                                         00826004
008270              , TTRSTYP B                                         00827001
008280              , TVHTRIP C                                         00828004
008290          WHERE A.TRIP_STATUS_CDE  =  B.TRIP_STATUS_CDE           00829001
008300            AND B.PRTY_CDE IN                                     00830001
008500                (SELECT MAX(BB.PRTY_CDE)                          00850001
008600                   FROM TTRIPST AA                                00860004
008700                      , TTRSTYP BB                                00870001
008800                  WHERE A.TRIP_ID = AA.TRIP_ID                    00880001
008900                    AND AA.TRIP_STATUS_CDE =  BB.TRIP_STATUS_CDE  00890001
009000                )                                                 00900001
009100            AND NOT A.TRIP_STATUS_CDE IN ('DE','ET')              00910001
009110            AND A.STATUS_DTE <= CURRENT DATE - :PV-DAYS-BACK DAYS 00911001
009120            AND A.TRIP_ID  =  C.TRIP_ID                           00912001
009121            AND NOT C.TRIP_ID  IN                                 00912101
009122                (SELECT D.CURR_TRIP_ID                            00912201
009123                   FROM TVEHICL D                                 00912304
009124                  WHERE C.TRIP_ID  =  D.CURR_TRIP_ID)             00912401
009130          ORDER BY A.OPER_UNT_ID                                  00913001
009140                 , A.STATUS_DTE                                   00914001
009150                 , A.STATUS_TME                                   00915001
009207         WITH UR                                                  00920701
009208     END-EXEC.                                                    00920801
009209                                                                  00920901
009210                                                                  00921001
009220     EXEC SQL                                                     00922001
009230        DECLARE SHPMT_CSR CURSOR FOR                              00923001
009240         SELECT DISTINCT                                          00924001
009250                C.TRIP_ID                                         00925001
009260              , A.SHIPT_ID                                        00926001
009270              , A.SHIPT_STATUS_CDE                                00927001
009271              , A.STATUS_DTE                                      00927101
009272              , A.STATUS_TME                                      00927201
009273              , A.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            00927301
009274           FROM TSHIPST A                                         00927404
009275              , TSHSTYP B                                         00927501
009276              , TSHIPMT C                                         00927604
009277         WHERE A.SHIPT_STATUS_CDE  =  B.SHIPT_STATUS_CDE          00927701
009278           AND B.PRTY_CDE IN                                      00927801
009280                (SELECT MAX(BB.PRTY_CDE)                          00928001
009290                  FROM TSHIPST AA                                 00929004
009300                     , TSHSTYP BB                                 00930001
009400                 WHERE A.SHIPT_ID = AA.SHIPT_ID                   00940001
009500                   AND AA.SHIPT_STATUS_CDE = BB.SHIPT_STATUS_CDE  00950001
009600                )                                                 00960001
009700           AND NOT A.SHIPT_STATUS_CDE IN ('DE','ET')              00970001
009800           AND A.STATUS_DTE <= CURRENT DATE - :PV-DAYS-BACK DAYS  00980001
009801           AND A.CRE_TMST   <= CURRENT TIMESTAMP                  00980105
009802                                            - :PV-DAYS-BACK DAYS  00980205
009810           AND A.SHIPT_ID  =  C.SHIPT_ID                          00981001
009820           AND NOT C.TRIP_ID  IN                                  00982001
009830               (SELECT D.CURR_TRIP_ID                             00983001
009840                  FROM TVEHICL D                                  00984004
009850                 WHERE C.TRIP_ID  =  D.CURR_TRIP_ID)              00985001
009860         ORDER BY A.STATUS_DTE                                    00986001
009870                , A.STATUS_TME                                    00987001
010200          WITH UR                                                 01020001
010210     END-EXEC.                                                    01021001
010220                                                                  01022001
010230                                                                  01023001
010240*   DB2 SQL COMMUNICATION AREA                                    01024001
010250     EXEC SQL                                                     01025001
010260          INCLUDE SQLCA                                           01026001
010270     END-EXEC.                                                    01027001
010280                                                                  01028001
010290                                                                  01029001
010300******************************************************************01030001
010400 PROCEDURE DIVISION.                                              01040001
010500******************************************************************01050001
010600* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01060001
010700*      PROGRAM.                                                   01070001
010800******************************************************************01080001
010900 0000-PROGRAM-MAINLINE.                                           01090001
010910                                                                  01091001
010920     DISPLAY '************************************************'   01092001
010930     DISPLAY '** TRKUT093'                                        01093001
010940     DISPLAY '** '                                                01094001
010950                                                                  01095001
010960     OPEN OUTPUT TRIP-FILE                                        01096001
010970                 SHPMT-FILE.                                      01097001
010980                                                                  01098001
010990     PERFORM 0100-GET-DAYS-BACK.                                  01099001
011000     MOVE PV-DAYS-BACK  TO  PV-DAYS-BACK-DISP                     01100001
011100     DISPLAY '** PARM TRIPRG:  '  PV-DAYS-BACK-DISP               01110001
011200     DISPLAY '** CURRENT DATE: '  PV-CURRENT-DATE                 01120001
011210     DISPLAY '** EXTRACT DATE: '  PV-CHECK-DATE                   01121001
011220     DISPLAY '** '.                                               01122001
011230                                                                  01123001
011240     PERFORM 8000-OPEN-TRIP-CSR.                                  01124001
011250     PERFORM 8010-FETCH-TRIP-CSR.                                 01125001
011260                                                                  01126001
011270     PERFORM 2000-PROCESS-TRIP                                    01127001
011280       UNTIL PS-END-OF-TRIP-CSR-YES.                              01128001
011290                                                                  01129001
011300     PERFORM 8020-CLOSE-TRIP-CSR.                                 01130001
011400                                                                  01140001
011401     SET  PS-END-OF-SHPMT-CSR-NO  TO  TRUE.                       01140101
011410     PERFORM 8030-OPEN-SHPMT-CSR                                  01141001
011420     PERFORM 8040-FETCH-SHPMT-CSR                                 01142001
011430                                                                  01143001
011440     PERFORM 2100-PROCESS-SHPMT                                   01144001
011450       UNTIL PS-END-OF-SHPMT-CSR-YES.                             01145001
011460                                                                  01146001
011470     PERFORM 8050-CLOSE-SHPMT-CSR.                                01147001
011471                                                                  01147101
011480                                                                  01148001
011500     DISPLAY '************************************************'   01150001
011600     DISPLAY '** TRKUT093'                                        01160001
011700     DISPLAY '** '                                                01170001
011800     DISPLAY '** TRIP COUNT:  ' PV-TRIP-COUNT                     01180001
011900     DISPLAY '** SHPMT COUNT: ' PV-SHPMT-COUNT                    01190001
012000     DISPLAY '************************************************'   01200001
012100                                                                  01210001
012200     CLOSE TRIP-FILE                                              01220001
012300           SHPMT-FILE.                                            01230001
012400                                                                  01240001
012500     STOP RUN.                                                    01250001
012600                                                                  01260001
012700***********************************************************       01270001
012800*                                                         *       01280001
012900***********************************************************       01290001
013000 0100-GET-DAYS-BACK.                                              01300001
013100                                                                  01310001
013200     EXEC SQL                                                     01320001
013300        SELECT FUNC_QTY                                           01330001
013310             , CURRENT DATE                                       01331001
013320             , CURRENT DATE - FUNC_QTY DAYS                       01332001
013330          INTO :PV-DAYS-BACK                                      01333001
013340             , :PV-CURRENT-DATE                                   01334001
013350             , :PV-CHECK-DATE                                     01335001
013360          FROM TKRPRPM                                            01336001
013370         WHERE LOC_ID             =  90                           01337001
013380           AND INTFC_SYS_CDE      = 'KHL'                         01338001
013390           AND SYS_PRC_FUNC_CDE   = 'TRIPG3'                      01339001
013391           AND FUNC_PRC_STAT_CDE  = 'AC'                          01339101
013392           AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP             01339201
013393           AND FUNC_END_TMST     >= CURRENT TIMESTAMP             01339301
013394     END-EXEC.                                                    01339401
013395                                                                  01339501
013396     EVALUATE TRUE                                                01339601
013397         WHEN SQLCODE = ZERO                                      01339701
013398              CONTINUE                                            01339801
013399                                                                  01339901
013400         WHEN SQLCODE = +100                                      01340001
013401              MOVE 1000         TO  PV-DAYS-BACK                  01340101
013402         WHEN OTHER                                               01340201
013403             MOVE '0100-GET-DAYS-BACK '                           01340301
013404                                       TO PV-ABEND-PARAGRAPH      01340401
013405             MOVE 'CHECK DAYS BACK'    TO PV-ABEND-OPERATION      01340501
013406             PERFORM 9900-DB2-ABEND                               01340601
013407     END-EVALUATE.                                                01340701
013408                                                                  01340801
013409                                                                  01340901
013410***********************************************************       01341001
013420*                                                         *       01342001
013430***********************************************************       01343001
013440 2000-PROCESS-TRIP.                                               01344001
013450                                                                  01345001
013460     PERFORM 3000-WRITE-TRIP-RECORD.                              01346001
013470                                                                  01347001
014500     PERFORM 8010-FETCH-TRIP-CSR.                                 01450001
014600                                                                  01460001
014700                                                                  01470001
014800***********************************************************       01480001
014900*                                                         *       01490001
015000***********************************************************       01500001
015100 2100-PROCESS-SHPMT.                                              01510001
015200                                                                  01520001
015300     PERFORM 3100-WRITE-SHPMT-RECORD.                             01530001
015400                                                                  01540001
015500     PERFORM 8040-FETCH-SHPMT-CSR.                                01550001
015600                                                                  01560001
015700                                                                  01570001
015800***********************************************************       01580001
015900*                                                         *       01590001
016000***********************************************************       01600001
016100 3000-WRITE-TRIP-RECORD.                                          01610001
016110                                                                  01611001
016111     INITIALIZE  TR074-RECORD.                                    01611101
016112     MOVE VHTRIP-OWNER-SCAC-ID     TO TR074-OWNER-SCAC-ID.        01611201
016113     MOVE VHTRIP-VEH-NBR           TO TR074-VEH-NBR.              01611301
016114     MOVE TRIPST-TRIP-ID           TO TR074-TRIP-ID.              01611401
016115     MOVE TRIPST-TRIP-STATUS-CDE   TO TR074-TRIP-STATUS-CDE.      01611501
016116     MOVE TRIPST-STATUS-DTE        TO TR074-TRIP-STATUS-DTE.      01611601
016117     MOVE TRIPST-STATUS-TME        TO TR074-TRIP-STATUS-TME.      01611701
016118     MOVE TRIPST-STATUS-UID        TO TR074-TRIP-STATUS-UID.      01611801
016119     MOVE TRIPST-OPER-UNT-ID       TO TR074-OPER-UNT-ID.          01611901
016120     MOVE TRIPST-FCLTY-ID          TO TR074-FCLTY-ID.             01612001
016130     MOVE TRIPST-TRIP-STATUS-CDE   TO TR074-VEH-STATUS-CDE.       01613001
016140     MOVE VHTRIP-TRIP-ID           TO TR074-VEH-TRIP-ID.          01614001
016150                                                                  01615001
016160     MOVE PV-NEW-STATUS-DTE        TO TR074-NEW-STATUS-DTE.       01616001
016170                                                                  01617001
016180     WRITE TRIP-RECORD                                            01618001
016190      FROM TR074-RECORD.                                          01619001
016200                                                                  01620001
016300     MOVE  TR074-OPER-UNT-ID TO PV-DISP-OPER.                     01630001
016400     MOVE  TR074-TRIP-ID     TO PV-DISP-TRIP.                     01640001
016500                                                                  01650001
016600     DISPLAY 'OPER: '           PV-DISP-OPER                      01660001
016700             '  TRIP: '         PV-DISP-TRIP                      01670001
016800             '   '              TR074-OWNER-SCAC-ID               01680001
016900             '/'                TR074-VEH-NBR                     01690001
017000             '  ST: '           TR074-TRIP-STATUS-CDE             01700001
017100             '  '               TR074-TRIP-STATUS-DTE             01710001
017200             ' @ '              TR074-TRIP-STATUS-TME             01720001
017300             '  '               TR074-TRIP-STATUS-UID             01730001
017400             '  NEW DTE:'       TR074-NEW-STATUS-DTE.             01740001
017500                                                                  01750001
017600     ADD +1                      TO PV-TRIP-COUNT.                01760001
017700                                                                  01770001
017800                                                                  01780001
017900***********************************************************       01790001
018000*                                                         *       01800001
018100***********************************************************       01810001
018200 3100-WRITE-SHPMT-RECORD.                                         01820001
018300                                                                  01830001
018400     INITIALIZE  TR075-RECORD.                                    01840001
018500     MOVE SHIPMT-TRIP-ID           TO TR075-TRIP-ID.              01850001
018600     MOVE SHIPMT-SHIPT-ID          TO TR075-SHIPT-ID.             01860001
018700     MOVE SHIPST-SHIPT-STATUS-CDE  TO TR075-SHIPT-STATUS-CDE.     01870001
018800     MOVE SHIPST-STATUS-DTE        TO TR075-STATUS-DTE.           01880001
018900     MOVE SHIPST-STATUS-TME        TO TR075-STATUS-TME.           01890001
019000                                                                  01900001
019100     MOVE PV-NEW-STATUS-DTE        TO TR075-NEW-STATUS-DTE.       01910001
019200                                                                  01920001
019300     WRITE SHPMT-RECORD                                           01930001
019400      FROM TR075-RECORD.                                          01940001
019500                                                                  01950001
019600     ADD +1                      TO PV-SHPMT-COUNT.               01960001
019700                                                                  01970001
019800                                                                  01980001
019900***********************************************************       01990001
020000*                                                         *       02000001
020100***********************************************************       02010001
020200 8000-OPEN-TRIP-CSR.                                              02020001
020300                                                                  02030001
020400     EXEC SQL                                                     02040001
020500        OPEN TRIP_CSR                                             02050001
020600     END-EXEC.                                                    02060001
020700                                                                  02070001
020800     EVALUATE TRUE                                                02080001
020900         WHEN SQLCODE = ZERO                                      02090001
021000             CONTINUE                                             02100001
021100         WHEN OTHER                                               02110001
021200             MOVE '8000-OPEN-TRIP-CSR'                            02120001
021300                                       TO PV-ABEND-PARAGRAPH      02130001
021400             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02140001
021500             PERFORM 9900-DB2-ABEND                               02150001
021600     END-EVALUATE.                                                02160001
021700                                                                  02170001
021800                                                                  02180001
021900***********************************************************       02190001
022000*                                                         *       02200001
022100***********************************************************       02210001
022200 8010-FETCH-TRIP-CSR.                                             02220001
022300                                                                  02230001
022400     EXEC SQL                                                     02240001
022500        FETCH TRIP_CSR                                            02250001
022600        INTO :VHTRIP-OWNER-SCAC-ID                                02260001
022700           , :VHTRIP-VEH-NBR  :PV-NULL-IND                        02270003
022800           , :TRIPST-TRIP-ID                                      02280001
022900           , :TRIPST-TRIP-STATUS-CDE                              02290001
023000           , :TRIPST-STATUS-DTE                                   02300001
023100           , :TRIPST-STATUS-TME                                   02310001
023200           , :TRIPST-STATUS-UID                                   02320001
023300           , :TRIPST-OPER-UNT-ID                                  02330001
023400           , :PV-NEW-STATUS-DTE                                   02340001
023500     END-EXEC.                                                    02350001
023600                                                                  02360001
023700     EVALUATE TRUE                                                02370001
023800         WHEN SQLCODE = ZERO                                      02380001
023900                                                                  02390001
024000             MOVE SPACES  TO  VEHICL-CURR-STATUS-CDE              02400001
024010             IF  PV-NULL-IND  =  -1                               02401003
024020                 MOVE SPACES TO  VHTRIP-VEH-NBR                   02402003
024030             END-IF                                               02403003
024100                                                                  02410001
024200         WHEN SQLCODE = +100                                      02420001
024300             SET  PS-END-OF-TRIP-CSR-YES  TO TRUE                 02430001
024400         WHEN OTHER                                               02440001
024500             MOVE '8010-FETCH-TRIP-CSR'                           02450001
024600                                       TO PV-ABEND-PARAGRAPH      02460001
024700             MOVE 'FETCH TRIP CSR'     TO PV-ABEND-OPERATION      02470001
024800             PERFORM 9900-DB2-ABEND                               02480001
024900     END-EVALUATE.                                                02490001
025000                                                                  02500001
025100                                                                  02510001
025200***********************************************************       02520001
025300*                                                         *       02530001
025400***********************************************************       02540001
025500 8020-CLOSE-TRIP-CSR.                                             02550001
025600                                                                  02560001
025700     EXEC SQL                                                     02570001
025800        CLOSE TRIP_CSR                                            02580001
025900     END-EXEC.                                                    02590001
026000                                                                  02600001
026100     EVALUATE TRUE                                                02610001
026200         WHEN SQLCODE = ZERO                                      02620001
026300             CONTINUE                                             02630001
026400         WHEN OTHER                                               02640001
026500             MOVE '8020-CLOSE-TRIP-CSR'                           02650001
026600                                       TO PV-ABEND-PARAGRAPH      02660001
026700             MOVE 'CLOSE TRIP CSR'     TO PV-ABEND-OPERATION      02670001
026800             PERFORM 9900-DB2-ABEND                               02680001
026900     END-EVALUATE.                                                02690001
027000                                                                  02700001
027100                                                                  02710001
027200***********************************************************       02720001
027300*                                                         *       02730001
027400***********************************************************       02740001
027500 8030-OPEN-SHPMT-CSR.                                             02750001
027600                                                                  02760001
027700     EXEC SQL                                                     02770001
027800        OPEN SHPMT_CSR                                            02780001
027900     END-EXEC.                                                    02790001
028000                                                                  02800001
028100     EVALUATE TRUE                                                02810001
028200         WHEN SQLCODE = ZERO                                      02820001
028300             CONTINUE                                             02830001
028400         WHEN OTHER                                               02840001
028410             MOVE '8030-OPEN-SHPMT-CSR'                           02841001
028420                                       TO PV-ABEND-PARAGRAPH      02842001
028430             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02843001
028431             PERFORM 9900-DB2-ABEND                               02843101
028432     END-EVALUATE.                                                02843201
028433                                                                  02843301
028434                                                                  02843401
028435***********************************************************       02843501
028436*                                                         *       02843601
028437***********************************************************       02843701
028438 8040-FETCH-SHPMT-CSR.                                            02843801
028439                                                                  02843901
028440     EXEC SQL                                                     02844001
028450        FETCH SHPMT_CSR                                           02845001
028451        INTO :SHIPMT-TRIP-ID                                      02845101
028452           , :SHIPMT-SHIPT-ID                                     02845201
028453           , :SHIPST-SHIPT-STATUS-CDE                             02845301
028454           , :SHIPST-STATUS-DTE                                   02845401
028455           , :SHIPST-STATUS-TME                                   02845501
028456           , :PV-NEW-STATUS-DTE                                   02845601
028457     END-EXEC.                                                    02845701
028458                                                                  02845801
028459     EVALUATE TRUE                                                02845901
028460         WHEN SQLCODE = ZERO                                      02846001
028461             CONTINUE                                             02846101
028462         WHEN SQLCODE = +100                                      02846201
028463             SET  PS-END-OF-SHPMT-CSR-YES  TO TRUE                02846301
028464         WHEN OTHER                                               02846401
028465             MOVE '8040-FETCH-SHPMT-CSR'                          02846501
028466                                       TO PV-ABEND-PARAGRAPH      02846601
028467             MOVE 'FETCH SHPMT CSR'    TO PV-ABEND-OPERATION      02846701
028468             PERFORM 9900-DB2-ABEND                               02846801
028469     END-EVALUATE.                                                02846901
028470                                                                  02847001
028471                                                                  02847101
028472***********************************************************       02847201
028473*                                                         *       02847301
028474***********************************************************       02847401
028475 8050-CLOSE-SHPMT-CSR.                                            02847501
028476                                                                  02847601
028477     EXEC SQL                                                     02847701
028478        CLOSE SHPMT_CSR                                           02847801
028479     END-EXEC.                                                    02847901
028480                                                                  02848001
028481     EVALUATE TRUE                                                02848101
028482         WHEN SQLCODE = ZERO                                      02848201
028483             CONTINUE                                             02848301
028484         WHEN OTHER                                               02848401
028485             MOVE '8050-CLOSE-TRIP-CSR'                           02848501
028486                                       TO PV-ABEND-PARAGRAPH      02848601
028487             MOVE 'CLOSE SHPMT CSR'    TO PV-ABEND-OPERATION      02848701
028488             PERFORM 9900-DB2-ABEND                               02848801
028489     END-EVALUATE.                                                02848901
028490                                                                  02849001
028491                                                                  02849101
028492                                                                  02849201
028493                                                                  02849301
028494***********************************************************       02849401
028495*                                                         *       02849501
028496***********************************************************       02849601
028497 9900-DB2-ABEND.                                                  02849701
028498                                                                  02849801
028499     MOVE SQLCODE TO PV-SQLCODE.                                  02849901
028500     DISPLAY '*** DB2 ERROR '.                                    02850001
028600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02860001
028700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02870001
028800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02880001
028900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02890001
029000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02900001
029100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02910001
029200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02920001
029300                                                                  02930001
029400     COPY DPPD004.                                                02940001
029500                                                                  02950001
029510     IF SQLCODE NOT = -911                                        02951001
029520         EXEC SQL                                                 02952001
029530              ROLLBACK                                            02953001
029540         END-EXEC                                                 02954001
029550     END-IF.                                                      02955001
029560                                                                  02956001
029570     MOVE +4013                  TO PV-ABEND-CODE.                02957001
029580     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02958001
029590                                                                  02959001
