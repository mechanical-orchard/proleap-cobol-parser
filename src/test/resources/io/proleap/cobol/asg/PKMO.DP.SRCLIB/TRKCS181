000100*----------------------------------------------------------------*00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*----------------------------------------------------------------*00030099
000400 PROGRAM-ID.    TRKCS181.                                         00040099
000500 AUTHOR.        NIRMAL KUMAR.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  03-10-98.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y181 - VESSEL/VOYAGE LIST PROGRAM.                         * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL OCCURENCES OF A       * 00130099
001400*    VESSEL BY VOYAGE. THE APPROPRIATE PROGRAM IS INVOKED       * 00140099
001500*    WHEN THE OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES    * 00150099
001600*    A FUNCTION KEY.                                            * 00160099
001700*                                                               * 00170099
001800*---------------------------------------------------------------* 00180099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00182099
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00183099
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00184099
263697*---------------------------------------------------------------* 00185099
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00186099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00187099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00188099
CICS  *-----------------------------------------------------------------00189099
001900                                                                  00190099
002000 ENVIRONMENT DIVISION.                                            00200099
002100                                                                  00210099
002200 DATA DIVISION.                                                   00220099
002300                                                                  00230099
002400 WORKING-STORAGE SECTION.                                         00240099
002500                                                                  00250099
002600 01  DK-DB2-KEYS.                                                 00260099
002700     05  DK-VSL-NAME                    PIC  X(25)  VALUE SPACE.  00270099
002800     05  DK-VOY-NBR                     PIC  X(10)  VALUE SPACE.  00280099
002900                                                                  00290099
003000 01  PC-PROGRAM-CONSTANTS.                                        00300099
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00310099
003200                                                    'TR181A  '.   00320099
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00330099
003400                                                    'TRKM181 '.   00340099
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00350099
003600                                                    'TRKCS181'.   00360099
003700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00370099
003800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00380099
003900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00390099
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00400099
004100                                                    COMP SYNC.    00410099
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00420099
004300                                                    COMP SYNC.    00430099
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00440099
004500                                                    +1000000      00450099
004600                                                    COMP-3.       00460099
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00470099
004800                                                    COMP SYNC.    00480099
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00490099
005000                                                    COMP-3.       00500099
005100     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00510099
005200                                                    '0001-01-01'. 00520099
005210     05  PC-INIT-TIME                   PIC  X(05)  VALUE         00521099
005220                                                    '00.00'.      00522099
005300     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00530099
005400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00540099
005500                                                                  00550099
005600     05  PC-TSYMSG-NUMBERS.                                       00560099
005700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00570099
005800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00580099
005900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00590099
006000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00600099
006100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00610099
006200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00620099
006300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00630099
006400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00640099
006500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00650099
006600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00660099
006700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00670099
006800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00680099
006900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00690099
007000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00700099
007100                                                                  00710099
007200 01  PS-PROGRAM-SWITCHES.                                         00720099
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00730099
007400         88  PS-NO-ERROR                            VALUE 'Y'.    00740099
007500         88  PS-ERROR                               VALUE 'N'.    00750099
007600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00760099
007700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00770099
007800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00780099
007900                                                                  00790099
008000 01  PV-PROGRAM-VARIABLES.                                        00800099
008100     05  PV-SUB                         PIC S9(04)  VALUE +0      00810099
008200                                                    COMP SYNC.    00820099
008300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00830099
008400                                                    COMP SYNC.    00840099
008500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00850099
008600                                                    COMP-3.       00860099
008700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00870099
008800                                                    COMP-3.       00880099
008900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00890099
009000                                                    COMP-3.       00900099
009100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00910099
009200                                                    COMP-3.       00920099
009300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00930099
009400                                                    COMP-3.       00940099
009500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00950099
009600                                                    COMP-3.       00960099
009700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00970099
009800                                                    COMP-3.       00980099
009900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00990099
010000                                                    COMP SYNC.    01000099
010100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01010099
010200                                                    COMP SYNC.    01020099
010300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01030099
010400                                                    COMP SYNC.    01040099
010500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01050099
010600                                                    COMP SYNC.    01060099
010700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01070099
010800                                                    COMP SYNC.    01080099
010900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01090099
011000                                                    COMP SYNC.    01100099
011100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01110099
011200                                                    COMP SYNC.    01120099
011300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01130099
011400                                                    COMP SYNC.    01140099
011500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01150099
011600                                                    COMP SYNC.    01160099
011700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01170099
011800                                                    COMP SYNC.    01180099
011900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01190099
012000                                                    COMP SYNC.    01200099
012100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01210099
012200                                                    COMP SYNC.    01220099
012300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01230099
012400                                                    COMP SYNC.    01240099
012500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01250099
012600                                                    COMP SYNC.    01260099
012700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01270099
012800                                                    COMP SYNC.    01280099
012900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01290099
013000                                                    COMP SYNC.    01300099
013100     05  PV-TALLY-COUNTER               PIC S9(04)  VALUE +0      01310099
013200                                                    COMP SYNC.    01320099
013300     05  PV-DATE-BREAK.                                           01330099
013400         10 FILLER                      PIC  X(02).               01340099
013500         10 PV-DB-YY                    PIC  X(02).               01350099
013600         10 FILLER                      PIC  X(01).               01360099
013700         10 PV-DB-MM                    PIC  X(02).               01370099
013800         10 FILLER                      PIC  X(01).               01380099
013900         10 PV-DB-DD                    PIC  X(02).               01390099
014000                                                                  01400099
014010     05  PV-TIME-BREAK.                                           01401099
014020         10 PV-TB-HH                    PIC  X(02).               01402099
014030         10 FILLER                      PIC  X(01).               01403099
014031         10 PV-TB-MM                    PIC  X(02).               01403199
014040                                                                  01404099
014100     05 PV-DATE-DISPLAY.                                          01410099
014200         10 PV-DD-MM                    PIC  X(02).               01420099
014300         10 FILLER                      PIC  X(01)  VALUE '/'.    01430099
014400         10 PV-DD-DD                    PIC  X(02).               01440099
014500         10 FILLER                      PIC  X(01)  VALUE '/'.    01450099
014600         10 PV-DD-YY                    PIC  X(02).               01460099
014601                                                                  01460199
014610     05 PV-TIME-DISPLAY.                                          01461099
014620         10 PV-TD-HH                    PIC  X(02).               01462099
014630         10 FILLER                      PIC  X(01)  VALUE ':'.    01463099
014640         10 PV-TD-MM                    PIC  X(02).               01464099
014700*----------------------------------------------------------------*01470099
014800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01480099
014900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *01490099
015000*   APPLICATION-SPECIFIC COMMAREA.                               *01500099
015100*----------------------------------------------------------------*01510099
015200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01520099
015300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01530099
015400     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01540099
015500                                        INDEXED BY LQW-IDX.       01550099
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01560099
015700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01570099
015800         10  LQW-SELECTED-SW            PIC  X(01).               01580099
015900             88  LQW-SELECT                         VALUE 'S'.    01590099
016000             88  LQW-DESELECT                       VALUE ' '.    01600099
016100         10  LQW-ACTION                 PIC  X(03).               01610099
016200         10  LQW-VSL-NAME               PIC  X(25).               01620099
016300         10  LQW-TRIP-TYP-CDE           PIC  X(01).               01630099
016400         10  LQW-VOY-NBR                PIC  X(10).               01640099
016500         10  LQW-FOB                    PIC  X(03).               01650099
016600         10  LQW-ATD                    PIC  X(08).               01660099
016700         10  LQW-POE                    PIC  X(03).               01670099
016800         10  LQW-ETA                    PIC  X(08).               01680099
016900         10  LQW-ETA-TIME               PIC  X(05).               01690099
017000                                                                  01700099
017100 EJECT                                                            01710099
017200*---------------------------------------------------------------* 01720099
017300*  RECORD LAYOUT FOR THE VOYAGE  SELECTION TEMP STORAGE QUEUE.  * 01730099
017400*---------------------------------------------------------------* 01740099
017500                                                                  01750099
017600     COPY TRWS103.                                                01760099
017700                                                                  01770099
017800 EJECT                                                            01780099
017900*---------------------------------------------------------------* 01790099
018000*    MAP LAYOUT                                                 * 01800099
018100*---------------------------------------------------------------* 01810099
018200                                                                  01820099
018300     COPY TRKM181.                                                01830099
018400*                                                                 01840099
018500 01  MR-OCCURS-LAYOUT                   REDEFINES  TR181AO.       01850099
018600     05  FILLER                         PIC X(87).                01860099
018700     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          01870099
018800         10  MR-SELECTL                 PIC S9(04) COMP.          01880099
018900         10  MR-SELECTA                 PIC  X(01).               01890099
019000         10  MR-SELECTC                 PIC  X(01).               01900099
019100         10  MR-SELECTH                 PIC  X(01).               01910099
019200         10  MR-SELECTI                 PIC  X(01).               01920099
019300                                                                  01930099
019400         10  MR-ACTIONL                 PIC S9(04) COMP.          01940099
019500         10  MR-ACTIONA                 PIC  X(01).               01950099
019600         10  MR-ACTIONC                 PIC  X(01).               01960099
019700         10  MR-ACTIONH                 PIC  X(01).               01970099
019800         10  MR-ACTION                  PIC  X(03).               01980099
019900                                                                  01990099
020000         10  MR-VSL-NAMEL               PIC S9(04) COMP.          02000099
020100         10  MR-VSL-NAMEA               PIC  X(01).               02010099
020200         10  MR-VSL-NAMEC               PIC  X(01).               02020099
020300         10  MR-VSL-NAMEH               PIC  X(01).               02030099
020400         10  MR-VSL-NAME                PIC  X(25).               02040099
020500                                                                  02050099
020600         10  MR-TRIP-TYP-CDEL           PIC S9(04) COMP.          02060099
020700         10  MR-TRIP-TYP-CDEA           PIC  X(01).               02070099
020800         10  MR-TRIP-TYP-CDEC           PIC  X(01).               02080099
020900         10  MR-TRIP-TYP-CDEH           PIC  X(01).               02090099
021000         10  MR-TRIP-TYP-CDE            PIC  X(01).               02100099
021100                                                                  02110099
021200         10  MR-VOY-NBRL                PIC S9(04) COMP.          02120099
021300         10  MR-VOY-NBRA                PIC  X(01).               02130099
021400         10  MR-VOY-NBRC                PIC  X(01).               02140099
021500         10  MR-VOY-NBRH                PIC  X(01).               02150099
021600         10  MR-VOY-NBR                 PIC  X(10).               02160099
021700                                                                  02170099
021800         10  MR-FOBL                    PIC S9(04) COMP.          02180099
021900         10  MR-FOBA                    PIC  X(01).               02190099
022000         10  MR-FOBC                    PIC  X(01).               02200099
022100         10  MR-FOBH                    PIC  X(01).               02210099
022200         10  MR-FOB                     PIC  X(03).               02220099
022300                                                                  02230099
022400         10  MR-ATDL                    PIC S9(04) COMP.          02240099
022500         10  MR-ATDA                    PIC  X(01).               02250099
022600         10  MR-ATDC                    PIC  X(01).               02260099
022700         10  MR-ATDH                    PIC  X(01).               02270099
022800         10  MR-ATD                     PIC  X(08).               02280099
022900                                                                  02290099
023000         10  MR-POEL                    PIC S9(04) COMP.          02300099
023100         10  MR-POEA                    PIC  X(01).               02310099
023200         10  MR-POEC                    PIC  X(01).               02320099
023300         10  MR-POEH                    PIC  X(01).               02330099
023400         10  MR-POE                     PIC  X(03).               02340099
023500                                                                  02350099
023600         10  MR-ETAL                    PIC S9(04) COMP.          02360099
023700         10  MR-ETAA                    PIC  X(01).               02370099
023800         10  MR-ETAC                    PIC  X(01).               02380099
023900         10  MR-ETAH                    PIC  X(01).               02390099
024000         10  MR-ETA                     PIC  X(08).               02400099
024100                                                                  02410099
024200         10  MR-ETA-TIMEL               PIC S9(04) COMP.          02420099
024300         10  MR-ETA-TIMEA               PIC  X(01).               02430099
024400         10  MR-ETA-TIMEC               PIC  X(01).               02440099
024500         10  MR-ETA-TIMEH               PIC  X(01).               02450099
024600         10  MR-ETA-TIME                PIC  X(05).               02460099
024700                                                                  02470099
024800     05  FILLER                         PIC  X(16).               02480099
024900                                                                  02490099
025000 EJECT                                                            02500099
025100*---------------------------------------------------------------* 02510099
025200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02520099
025300*---------------------------------------------------------------* 02530099
025400                                                                  02540099
025500     COPY DPWS015.                                                02550099
025600                                                                  02560099
025700 EJECT                                                            02570099
025800*---------------------------------------------------------------* 02580099
025900*    FUNCTION KEYS COPYBOOK.                                    * 02590099
026000*---------------------------------------------------------------* 02600099
026100                                                                  02610099
026200     COPY DPWS016.                                                02620099
026300                                                                  02630099
026400 EJECT                                                            02640099
026500*---------------------------------------------------------------* 02650099
026600*    NUMERIC EDIT LAYOUT.                                       * 02660099
026700*---------------------------------------------------------------* 02670099
026800                                                                  02680099
026900     COPY DPWS010I.                                               02690099
027000                                                                  02700099
027100 EJECT                                                            02710099
027200*---------------------------------------------------------------* 02720099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02730099
027400*---------------------------------------------------------------* 02740099
027500                                                                  02750099
027600     COPY DPWS030.                                                02760099
CICS       COPY DPWS930.                                                02770099
027800 EJECT                                                            02780099
027900*---------------------------------------------------------------* 02790099
028000*    STANDARD COMMAREA.                                         * 02800099
028100*---------------------------------------------------------------* 02810099
028200                                                                  02820099
028300     COPY DPWS020.                                                02830099
028400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02840099
028500*---------------------------------------------------------------* 02850099
028600* INTER-APPLICATION COMMAREA.                                   * 02860099
028700*   TRWS180 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02870099
028800*             SPEC SCREEN.                                      * 02880099
028900*   TRWS104 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02890099
029000*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02900099
029100*---------------------------------------------------------------* 02910099
029200         10  INTER-APPL-COMM-AREA       PIC X(200).               02920099
029300     COPY TRWS180.                                                02930099
029400     COPY TRWS104.                                                02940099
029500                                                                  02950099
029600 EJECT                                                            02960099
029700*---------------------------------------------------------------* 02970099
029800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02980099
029900*---------------------------------------------------------------* 02990099
030000         10  ASC-SPECIFIC-COMMAREA.                               03000099
030100             15  ASC-LIST-KEYS.                                   03010099
030200                 20  ASC-KEY-VSL-NAME                PIC  X(25).  03020099
030300                 20  ASC-KEY-VOY-NBR                 PIC  X(10).  03030099
030400                                                                  03040099
030500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03050099
030600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03060099
030700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03070099
030800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03080099
030900                                                                  03090099
031000                 20  ASC-ITEM-ARRAY.                              03100099
031100                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03110099
031200                         30  ASC-LIST-ITEM-NUMBER                 03120099
031300                                                     PIC S9(09)   03130099
031400                                                     COMP-3.      03140099
031500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03150099
031600                             88  ASC-VALID-SELECT    VALUE ' '    03160099
031700                                                           'S'    03170099
031800                                                           'B'    03180099
031900                                                           'E'.   03190099
032000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03200099
032100                             88  ASC-TEMP-SELECT     VALUE 'S'.   03210099
032200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03220099
032300                             88  ASC-TEMP-END        VALUE 'E'.   03230099
032400                         30  ASC-SELECTED-SW         PIC  X(01).  03240099
032500                             88  ASC-NO-SELECT       VALUE ' '.   03250099
032600                             88  ASC-SELECT          VALUE 'S'.   03260099
032700                             88  ASC-BEGIN           VALUE 'B'.   03270099
032800                             88  ASC-END             VALUE 'E'.   03280099
032900                         30  ASC-ACTION              PIC  X(03).  03290099
033000                         30  ASC-VSL-NAME            PIC  X(25).  03300099
033100                         30  ASC-TRIP-TYP-CDE        PIC  X(01).  03310099
033200                         30  ASC-VOY-NBR             PIC  X(10).  03320099
033300                         30  ASC-FOB                 PIC  X(03).  03330099
033400                         30  ASC-ATD                 PIC  X(08).  03340099
033500                         30  ASC-POE                 PIC  X(03).  03350099
033600                         30  ASC-ETA                 PIC  X(08).  03360099
033700                         30  ASC-ETA-TIME            PIC  X(05).  03370099
033800                                                                  03380099
033900             15  ASC-BLK-SUB                         PIC S9(04)   03390099
034000                                                          COMP    03400099
034100                                                          SYNC.   03410099
034200             15  ASC-ITEM-SUB                        PIC S9(04)   03420099
034300                                                          COMP    03430099
034400                                                          SYNC.   03440099
034500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03450099
034600                                                          COMP-3. 03460099
034700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03470099
034800                                                          COMP-3. 03480099
034900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03490099
035000                                                          COMP-3. 03500099
035100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03510099
035200                                                          COMP-3. 03520099
035300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03530099
035400                                                          COMP-3. 03540099
035500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03550099
035600                                                          COMP    03560099
035700                                                          SYNC.   03570099
035800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03580099
035900                                                          COMP-3. 03590099
036000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03600099
036100                                                          COMP-3. 03610099
036200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03620099
036300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03630099
036400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03640099
036500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03650099
036600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03660099
036700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03670099
036800             15  ASC-LIST-QUEUE-NAME.                             03680099
036900                 20  ASC-LIST-TERM-ID                PIC  X(04).  03690099
037000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03700099
037100                                                          COMP-3. 03710099
037200                 20  ASC-LIST-SEQ                    PIC  9(01).  03720099
037300             15  ASC-SEL-QUEUE-NAME.                              03730099
037400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03740099
037500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03750099
037600                                                          COMP-3. 03760099
037700                 20  ASC-SEL-SEQ                     PIC  9(01).  03770099
037800                                                                  03780099
037900             15  ASC-START-ITEM-REQUEST.                          03790099
038000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03800099
038100                                                                  03810099
038200 EJECT                                                            03820099
038300*---------------------------------------------------------------* 03830099
038400*    ABEND PROCESSING COPYBOOK.                                 * 03840099
038500*---------------------------------------------------------------* 03850099
038600                                                                  03860099
038700     COPY DPWS013.                                                03870099
038800                                                                  03880099
038900 EJECT                                                            03890099
039000*---------------------------------------------------------------* 03900099
039100*    DB2 AREA FOR TIMCNTK                                       * 03910099
039200*---------------------------------------------------------------* 03920099
039300     EXEC SQL                                                     03930099
039400          INCLUDE TIMCNTK                                         03940099
039500     END-EXEC.                                                    03950099
039600*---------------------------------------------------------------* 03960099
039700*    DB2 AREA FOR TIMFOB                                        * 03970099
039800*---------------------------------------------------------------* 03980099
039900     EXEC SQL                                                     03990099
040000          INCLUDE TIMFOB                                          04000099
040100     END-EXEC.                                                    04010099
040200*---------------------------------------------------------------* 04020099
040300*    DB2 AREA FOR TIMPOE                                        * 04030099
040400*---------------------------------------------------------------* 04040099
040500     EXEC SQL                                                     04050099
040600          INCLUDE TIMPOE                                          04060099
040700     END-EXEC.                                                    04070099
040800*---------------------------------------------------------------* 04080099
040900*    DB2 AREA FOR COMMUNICATIONS                                * 04090099
041000*---------------------------------------------------------------* 04100099
041100     EXEC SQL                                                     04110099
041200          INCLUDE SQLCA                                           04120099
041300     END-EXEC.                                                    04130099
041400*---------------------------------------------------------------* 04140099
041500*    CURSOR WHEN VESSEL NAME IS REQUESTED                       * 04150099
041600*---------------------------------------------------------------* 04160099
041700                                                                  04170099
041800     EXEC SQL                                                     04180099
041900          DECLARE VSL-LST-CSR CURSOR                              04190099
042000          FOR SELECT  DISTINCT                                    04200099
042100                A.MOM_IMPRT_VEH_NM                                04210099
042200              , A.MOM_IMPRT_TRIP_ID                               04220099
042300              , A.FDR_FOB_CDE                                     04230099
042400              , A.MOM_FOB_CDE                                     04240099
042500              , A.FDR_DPRTR_TMST                                  04250099
042600              , A.MOM_DPRTR_TMST                                  04260099
042700              , A.MOM_DEST_POE_CDE                                04270099
042800              , A.MOM_POE_DELY_TMST                               04280099
043000              , A.MOM_TRIP_TYP_CDE                                04300099
043100              , A.FDR_TRIP_TYP_CDE                                04310099
043200          FROM                                                    04320099
043300                TIMCNTK A                                         04330099
043400          WHERE                                                   04340099
043500                A.MOM_IMPRT_VEH_NM  LIKE :DK-VSL-NAME             04350099
043600          AND   A.MOM_IMPRT_TRIP_ID LIKE :DK-VOY-NBR              04360099
043700          ORDER BY                                                04370099
043800                MOM_IMPRT_VEH_NM                                  04380099
043900     END-EXEC.                                                    04390099
044000                                                                  04400099
044100 EJECT                                                            04410099
044101                                                                  04410199
044102*---------------------------------------------------------------* 04410299
044103*    CURSOR DECLARATION FOR SELECTING POE CODE.                 * 04410399
044104*---------------------------------------------------------------* 04410499
044105                                                                  04410599
044106     EXEC SQL                                                     04410699
044107          DECLARE  POE-CSR CURSOR                                 04410799
044108              FOR  SELECT DISTINCT                                04410899
044109                   POE_CDE                                        04410999
044110             FROM  TIMPOE                                         04411099
044111            WHERE  POE_STD_EDI_CDE = :IMCNTK-MOM-DEST-POE-CDE     04411199
044112              AND  STAT_CDE        = 'A'                          04411299
044113         ORDER BY  POE_CDE                                        04411399
044114     END-EXEC.                                                    04411499
044115                                                                  04411599
044120 EJECT                                                            04412099
044200*                                                                 04420099
044300 LINKAGE SECTION.                                                 04430099
044400                                                                  04440099
044500 01  DFHCOMMAREA.                                                 04450099
044600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04460099
044700                                        DEPENDING ON EIBCALEN.    04470099
044800         10  FILLER                     PIC X.                    04480099
044900                                                                  04490099
045000 EJECT                                                            04500099
045100*----------------------------------------------------------------*04510099
045200 PROCEDURE DIVISION.                                              04520099
045300*----------------------------------------------------------------*04530099
045400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *04540099
045500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *04550099
045600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *04560099
045700*----------------------------------------------------------------*04570099
045800 0000-MAIN-MODULE.                                                04580099
045900                                                                  04590099
046000     INITIALIZE DP030-CICS-API-FIELDS.                            04600099
046100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04610099
046200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04620099
046300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04630099
046400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04640099
046500     MOVE LENGTH OF TR181AI        TO DP030-MAP-LENGTH (1).       04650099
046600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04660099
046700     PERFORM 0001-CALL-CICS-ARCH-API.                             04670099
046800*                                                                 04680099
046900     PERFORM 1000-CONTROL-PROCESSING                              04690099
047000*                                                                 04700099
047100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04710099
047200     PERFORM 0001-CALL-CICS-ARCH-API.                             04720099
047300                                                                  04730099
047400*----------------------------------------------------------------*04740099
047500*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04750099
047600*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04760099
047700*----------------------------------------------------------------*04770099
047800 0001-CALL-CICS-ARCH-API.                                         04780099
047900                                                                  04790099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04800099
048100                                    DFHCOMMAREA                   04810099
048200                                    DP030-CICS-API-FIELDS         04820099
048300                                    DP020-STANDARD-COMMAREA       04830099
048400                                    TR181AI.                      04840099
048500*                                                                 04850099
048600     IF  DP030-RC-CALL-SUCCESSFUL                                 04860099
048700         CONTINUE                                                 04870099
048800     ELSE                                                         04880099
048900         SET DP013-NO-ROLLBACK                                    04890099
049000             DP013-XCTL-DISPLAY-RESTART                           04900099
049100             DP013-CICS-ABEND      TO TRUE                        04910099
049200         MOVE '0001-CALL-CICS-ARCH-API'                           04920099
049300                                   TO DP013-PARAGRAPH             04930099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04940099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04950099
049600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04960099
049700         PERFORM DP013-0000-PROCESS-ABEND                         04970099
049800     END-IF.                                                      04980099
049900                                                                  04990099
050000 EJECT                                                            05000099
050100*----------------------------------------------------------------*05010099
050200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05020099
050300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05030099
050400*                                                                *05040099
050500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05050099
050600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05060099
050700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05070099
050800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05080099
050900*----------------------------------------------------------------*05090099
051000 1000-CONTROL-PROCESSING.                                         05100099
051100                                                                  05110099
051200     EVALUATE TRUE                                                05120099
051300         WHEN DP020-NEXT-ACT-INITIAL                              05130099
051400             INITIALIZE ASC-SPECIFIC-COMMAREA                     05140099
051500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05150099
051600                                      ASC-SEL-TERM-ID             05160099
051700             MOVE DP020-SRC-TASK-NUMBER                           05170099
051800                                   TO ASC-LIST-TASK-NUMBER        05180099
051900                                      ASC-SEL-TASK-NUMBER         05190099
052000             MOVE PC-LIST-QUEUE-SEQ                               05200099
052100                                   TO ASC-LIST-SEQ                05210099
052200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05220099
052300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05230099
052400***-----$TEMPLATE NOTE$-------------------------------------------05240099
052500*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05250099
052600*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05260099
052700*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05270099
052800***---------------------------------------------------------------05280099
052900             IF  PS-COMMAREA-NOT-VALID                            05290099
053000                 SET DP020-NEXT-ACT-APPL-ERROR                    05300099
053100                                   TO TRUE                        05310099
053200             ELSE                                                 05320099
053300                 PERFORM 4000-BUILD-INITIAL-PANEL                 05330099
053400             END-IF                                               05340099
053500                                                                  05350099
053600         WHEN DP020-NEXT-ACT-READ-MAP                             05360099
053700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05370099
053800                                   TO PV-TOP-ITEM                 05380099
053900             PERFORM 2000-PROCESS-PANEL                           05390099
054000                                                                  05400099
054100         WHEN DP020-NEXT-ACT-RETURN                               05410099
054200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05420099
054300                                   TO PV-TOP-ITEM                 05430099
054400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05440099
054500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05450099
054600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05460099
054700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05470099
054800                                                                  05480099
054900         WHEN OTHER                                               05490099
055000             SET DP013-LOGIC-ABEND TO TRUE                        05500099
055100             SET DP013-NO-ROLLBACK TO TRUE                        05510099
055200             MOVE '1000-CONTROL-PROCESSING'                       05520099
055300                                   TO DP013-PARAGRAPH             05530099
055400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05540099
055500                                   TO DP013-MESSAGE-TEXT(1)       05550099
055600             PERFORM DP013-0000-PROCESS-ABEND                     05560099
055700     END-EVALUATE.                                                05570099
055800                                                                  05580099
055900 EJECT                                                            05590099
056000*----------------------------------------------------------------*05600099
056100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05610099
056200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05620099
056300*----------------------------------------------------------------*05630099
056400 1100-PROCESS-INTER-APPL-COMM.                                    05640099
056500                                                                  05650099
056600     SET PS-COMMAREA-VALID         TO TRUE.                       05660099
056700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05670099
056800*                                                                 05680099
056900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05690099
057000         MOVE TR180-VSL-NAME       TO ASC-KEY-VSL-NAME            05700099
057100                                      DK-VSL-NAME                 05710099
057200         MOVE TR180-VOY-NBR        TO ASC-KEY-VOY-NBR             05720099
057300                                      DK-VOY-NBR                  05730099
057400     END-IF.                                                      05740099
057500                                                                  05750099
057600 EJECT                                                            05760099
057700*----------------------------------------------------------------*05770099
057800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05780099
057900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05790099
058000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05800099
058100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05810099
058200* FUNCTION KEYS CAN GET THIS FAR.                                *05820099
058300*----------------------------------------------------------------*05830099
058400 2000-PROCESS-PANEL.                                              05840099
058500                                                                  05850099
058600     EVALUATE TRUE                                                05860099
058700         WHEN DP020-SRC-AID = DP016-CLEAR                         05870099
058800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05880099
058900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05890099
059000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05900099
059100                                                                  05910099
059200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05920099
059300             MOVE ASC-KEY-VSL-NAME TO DK-VSL-NAME                 05930099
059400             MOVE ASC-KEY-VOY-NBR  TO DK-VOY-NBR                  05940099
059500             PERFORM 2050-DELETE-LIST-QUEUE                       05950099
059600             PERFORM 4000-BUILD-INITIAL-PANEL                     05960099
059700                                                                  05970099
059800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05980099
059900             PERFORM 2140-DESELECT-ALL-ITEMS                      05990099
060000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06000099
060100                                                                  06010099
060200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06020099
060300             PERFORM 2150-SELECT-ALL-ITEMS                        06030099
060400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06040099
060500                                                                  06050099
060600         WHEN OTHER                                               06060099
060700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06070099
060800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06080099
060900             IF  PS-NO-ERROR                                      06090099
061000                 SET DP030-CONTINUE-GO                            06100099
061100                                 TO TRUE                          06110099
061200                 PERFORM 2100-CHECK-FUNCTION-KEY                  06120099
061300             ELSE                                                 06130099
061400                 SET DP030-OVERRIDE-GO                            06140099
061500                                 TO TRUE                          06150099
061600             END-IF                                               06160099
061700     END-EVALUATE.                                                06170099
061800                                                                  06180099
061900 EJECT                                                            06190099
062000*----------------------------------------------------------------*06200099
062100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06210099
062200*----------------------------------------------------------------*06220099
062300 2050-DELETE-LIST-QUEUE.                                          06230099
062400                                                                  06240099
062500     EXEC CICS                                                    06250099
062600         DELETEQ TS                                               06260099
062700             QUEUE (ASC-LIST-QUEUE-NAME)                          06270099
062800             RESP  (PV-CICS-RESP)                                 06280099
062900     END-EXEC.                                                    06290099
063000                                                                  06300099
063100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06310099
063200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06320099
063300         CONTINUE                                                 06330099
063400     ELSE                                                         06340099
063500         SET DP013-CICS-ABEND      TO TRUE                        06350099
063600         SET DP013-NO-ROLLBACK     TO TRUE                        06360099
063700                                                                  06370099
063800         MOVE '2050-DELETE-LIST-QUEUE'                            06380099
063900                                   TO DP013-PARAGRAPH             06390099
064000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06400099
064100                                   TO DP013-MESSAGE-TEXT (1)      06410099
064200         PERFORM DP013-0000-PROCESS-ABEND                         06420099
064300     END-IF.                                                      06430099
064400                                                                  06440099
064500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06450099
064600                                                                  06460099
064700 EJECT                                                            06470099
064800*----------------------------------------------------------------*06480099
064900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06490099
065000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06500099
065100* CICS ARCHITECTURE API.                                         *06510099
065200*----------------------------------------------------------------*06520099
065300 2100-CHECK-FUNCTION-KEY.                                         06530099
065400                                                                  06540099
065500     EVALUATE TRUE                                                06550099
065600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06560099
065700            IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                  06570099
065800                INITIALIZE TR104-INTER-APPL-COMMAREA              06580099
065900                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 06590099
066000                                TO TR104-NUMBER-OF-SELECTED-ITEMS 06600099
066100                PERFORM 5000-PREPARE-SEL-QUEUE                    06610099
066200            ELSE                                                  06620099
066300                IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1              06630099
066400                    SET DP030-OVERRIDE-GO                         06640099
066500                                   TO TRUE                        06650099
066600                    MOVE PC-TSYMSG-00047                          06660099
066700                                   TO DP020-MSG-NUMBER            06670099
066800                    SET DP020-MSG-WARNING                         06680099
066900                                   TO TRUE                        06690099
067000                ELSE                                              06700099
067100                    IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0          06710099
067200                        SET DP030-OVERRIDE-GO                     06720099
067300                                   TO TRUE                        06730099
067400                        MOVE PC-TSYMSG-00057                      06740099
067500                                   TO DP020-MSG-NUMBER            06750099
067600                        SET DP020-MSG-WARNING                     06760099
067700                                   TO TRUE                        06770099
067800                    END-IF                                        06780099
067900                END-IF                                            06790099
068000            END-IF                                                06800099
068100                                                                  06810099
068200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06820099
068300             MOVE +1               TO PV-TOP-ITEM                 06830099
068400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06840099
068500             PERFORM 3200-RESET-ATTRIBUTES                        06850099
068600                                                                  06860099
068700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06870099
068800             PERFORM 2110-BROWSE-BACKWARD                         06880099
068900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06890099
069000             PERFORM 3200-RESET-ATTRIBUTES                        06900099
069100                                                                  06910099
069200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06920099
069300             PERFORM 2120-BROWSE-FORWARD                          06930099
069400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06940099
069500                                                                  06950099
069600         WHEN DP020-SRC-AID = DP016-ENTER                         06960099
069700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06970099
069800             IF  PS-ERROR                                         06980099
069900                 CONTINUE                                         06990099
070000             ELSE                                                 07000099
070100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07010099
070200             END-IF                                               07020099
070300                                                                  07030099
070400         WHEN OTHER                                               07040099
070500             SET DP013-NO-ROLLBACK                                07050099
070600                 DP013-XCTL-DISPLAY-RESTART                       07060099
070700                 DP013-CICS-ABEND  TO TRUE                        07070099
070800             MOVE '2100-CHECK-FUNCTION-KEY'                       07080099
070900                                   TO DP013-PARAGRAPH             07090099
071000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07100099
071100                                   TO DP013-MESSAGE-TEXT (1)      07110099
071200             PERFORM DP013-0000-PROCESS-ABEND                     07120099
071300     END-EVALUATE.                                                07130099
071400                                                                  07140099
071500 EJECT                                                            07150099
071600*----------------------------------------------------------------*07160099
071700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07170099
071800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07180099
071900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07190099
072000*    MESSAGE.                                                    *07200099
072100*----------------------------------------------------------------*07210099
072200 2110-BROWSE-BACKWARD.                                            07220099
072300                                                                  07230099
072400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07240099
072500         GIVING PV-TOP-ITEM.                                      07250099
072600*                                                                 07260099
072700     IF  ((PV-TOP-ITEM < +1)                                      07270099
072800       OR (PV-TOP-ITEM = +1))                                     07280099
072900         MOVE +1                   TO PV-TOP-ITEM                 07290099
073000*---------- TOP OF LIST -----                                     07300099
073100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07310099
073200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07320099
073300     END-IF.                                                      07330099
073400                                                                  07340099
073500 EJECT                                                            07350099
073600*----------------------------------------------------------------*07360099
073700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07370099
073800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07380099
073900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07390099
074000*----------------------------------------------------------------*07400099
074100 2120-BROWSE-FORWARD.                                             07410099
074200                                                                  07420099
074300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07430099
074400         GIVING PV-TOP-ITEM.                                      07440099
074500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07450099
074600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07460099
074700                                   TO PV-TOP-ITEM                 07470099
074800*---------- BOTTOM OF LIST --                                     07480099
074900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07490099
075000         SET DP020-MSG-INFORMATIONAL                              07500099
075100                                   TO TRUE                        07510099
075200     ELSE                                                         07520099
075300         COMPUTE PV-BOTTOM-ITEM =                                 07530099
075400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07540099
075500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07550099
075600*-------------- BOTTOM OF LIST --                                 07560099
075700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07570099
075800             SET DP020-MSG-INFORMATIONAL                          07580099
075900                                   TO TRUE                        07590099
076000         END-IF                                                   07600099
076100     END-IF.                                                      07610099
076200                                                                  07620099
076300 EJECT                                                            07630099
076400*----------------------------------------------------------------*07640099
076500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07650099
076600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07660099
076700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07670099
076800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07680099
076900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07690099
077000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07700099
077100*----------------------------------------------------------------*07710099
077200 2130-CHECK-FOR-JUMP-BROWSE.                                      07720099
077300                                                                  07730099
077400     SET PS-NO-ERROR               TO TRUE.                       07740099
077500     IF (ASC-START-ITEM-REQUEST = SPACE)                          07750099
077600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07760099
077700                                   TO PV-TOP-ITEM                 07770099
077800     ELSE                                                         07780099
077900         MOVE ASC-START-ITEM-REQUEST                              07790099
078000                                   TO DP010I-UNEDITED-FIELD       07800099
078100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07810099
078200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07820099
078300         SET DP010I-NEGATIVE-NOT-ALLOWED                          07830099
078400                                   TO TRUE                        07840099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07851099
263697              USING DP010I-NUMERIC-EDIT-AREA                      07852099
078600                                                                  07860099
078700         IF  NOT DP010I-ERROR-DETECTED                            07870099
078800             MOVE DP010I-NUMERIC-FIELD                            07880099
078900                                   TO  ASC-START-ITEM-REQUEST-N   07890099
079000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07900099
079100                 IF  ASC-START-ITEM-REQUEST-N >                   07910099
079200                                          ASC-NUMBER-OF-ITEMS-READ07920099
079300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07930099
079400                     COMPUTE PV-TOP-ITEM =                        07940099
079500                             ASC-NUMBER-OF-ITEMS-READ             07950099
079600                             - PC-ITEMS-PER-PANEL + 1             07960099
079700                     IF  PV-TOP-ITEM < +1                         07970099
079800                         MOVE +1   TO PV-TOP-ITEM                 07980099
079900                         MOVE PC-TSYMSG-00070                     07990099
080000                                   TO DP020-MSG-NUMBER            08000099
080100                         SET DP020-MSG-INFORMATIONAL              08010099
080200                                   TO TRUE                        08020099
080300                     END-IF                                       08030099
080400                 ELSE                                             08040099
080500                     MOVE ASC-START-ITEM-REQUEST-N                08050099
080600                                   TO PV-TOP-ITEM                 08060099
080700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08070099
080800                     COMPUTE PV-BOTTOM-ITEM =                     08080099
080900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08090099
081000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08100099
081100*-------------------------- BOTTOM OF LIST --                     08110099
081200                         MOVE PC-TSYMSG-00070                     08120099
081300                                   TO DP020-MSG-NUMBER            08130099
081400                         SET DP020-MSG-INFORMATIONAL              08140099
081500                                   TO TRUE                        08150099
081600                     END-IF                                       08160099
081700                 END-IF                                           08170099
081800             ELSE                                                 08180099
081900*------------------- VALUE OUT OF RANGE ----                      08190099
082000                 MOVE PC-TSYMSG-00101                             08200099
082100                                   TO DP020-MSG-NUMBER            08210099
082200                 MOVE -1           TO ASTRTITL                    08220099
082300                 SET DP030-SET-CURSOR-APPL-1                      08230099
082400                                   TO TRUE                        08240099
082500                 MOVE DP015-REVERSE                               08250099
082600                                   TO ASTRTITH                    08260099
082700                 MOVE DP015-RED    TO ASTRTITC                    08270099
082800                 MOVE DP015-UNP-NUM-BRT-MDT                       08280099
082900                                   TO ASTRTITA                    08290099
083000                 SET DP020-MSG-FATAL                              08300099
083100                                   TO TRUE                        08310099
083200                 SET PS-ERROR      TO TRUE                        08320099
083300             END-IF                                               08330099
083400                                                                  08340099
083500         ELSE                                                     08350099
083600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08360099
083700             MOVE -1               TO ASTRTITL                    08370099
083800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08380099
083900             MOVE DP015-REVERSE    TO ASTRTITH                    08390099
084000             MOVE DP015-RED        TO ASTRTITC                    08400099
084100             MOVE DP015-UNP-NUM-BRT-MDT                           08410099
084200                                   TO ASTRTITA                    08420099
084300             SET DP020-MSG-FATAL   TO TRUE                        08430099
084400             SET PS-ERROR          TO TRUE                        08440099
084500         END-IF                                                   08450099
084600     END-IF.                                                      08460099
084700                                                                  08470099
084800 EJECT                                                            08480099
084900*----------------------------------------------------------------*08490099
085000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08500099
085100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08510099
085200*----------------------------------------------------------------*08520099
085300 2140-DESELECT-ALL-ITEMS.                                         08530099
085400                                                                  08540099
085500     MOVE +1                       TO ASC-BLK-SUB.                08550099
085600                                                                  08560099
085700     PERFORM 2141-CLEAR-SELECTED-INDS                             08570099
085800         VARYING ASC-ITEM-SUB                                     08580099
085900         FROM 1 BY 1                                              08590099
086000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08600099
086100                                                                  08610099
086200     ADD +1                        TO ASC-BLK-SUB.                08620099
086300                                                                  08630099
086400     PERFORM 2141-CLEAR-SELECTED-INDS                             08640099
086500         VARYING ASC-ITEM-SUB                                     08650099
086600         FROM 1 BY 1                                              08660099
086700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08670099
086800                                                                  08680099
086900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08690099
087000                                   TO PV-LIST-ITEM-NUMBER.        08700099
087100                                                                  08710099
087200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08720099
087300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08730099
087400                                                                  08740099
087500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08750099
087600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08760099
087700         MOVE +1                   TO ASC-BLK-SUB                 08770099
087800                                                                  08780099
087900         PERFORM 5100-WRITE-TEMP-STORAGE                          08790099
088000                                                                  08800099
088100         MOVE +1                   TO PV-BLOCK-NUMBER             08810099
088200                                                                  08820099
088300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08830099
088400             PV-FIRST-BLOCK-IN-ARRAY - 1                          08840099
088500                                                                  08850099
088600         PERFORM                                                  08860099
088700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08870099
088800                                                                  08880099
088900             PERFORM 4410-READ-TEMP-STORAGE                       08890099
089000                                                                  08900099
089100             PERFORM 2141-CLEAR-SELECTED-INDS                     08910099
089200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08920099
089300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08930099
089400                                                                  08940099
089500             PERFORM 5100-WRITE-TEMP-STORAGE                      08950099
089600                                                                  08960099
089700             ADD +1                TO PV-BLOCK-NUMBER             08970099
089800                                                                  08980099
089900         END-PERFORM                                              08990099
090000                                                                  09000099
090100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09010099
090200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09020099
090300                                                                  09030099
090400         PERFORM                                                  09040099
090500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09050099
090600                   ASC-HIGHEST-BLOCK-WRITTEN                      09060099
090700                                                                  09070099
090800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09080099
090900                                   TO PV-BLOCK-NUMBER             09090099
091000                                                                  09100099
091100             PERFORM 4410-READ-TEMP-STORAGE                       09110099
091200                                                                  09120099
091300             PERFORM 2141-CLEAR-SELECTED-INDS                     09130099
091400                 VARYING ASC-ITEM-SUB                             09140099
091500                 FROM 1 BY 1                                      09150099
091600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09160099
091700                                                                  09170099
091800             PERFORM 5100-WRITE-TEMP-STORAGE                      09180099
091900                                                                  09190099
092000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09200099
092100                                                                  09210099
092200         END-PERFORM                                              09220099
092300                                                                  09230099
092400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09240099
092500                                   TO PV-BLOCK-NUMBER             09250099
092600                                                                  09260099
092700         PERFORM 4410-READ-TEMP-STORAGE                           09270099
092800     END-IF.                                                      09280099
092900                                                                  09290099
093000     MOVE +0                    TO ASC-NUMBER-OF-SELECTED-ITEMS.  09300099
093100     MOVE +0                    TO ASC-START-OF-SELECTED-RANGE.   09310099
093200     MOVE +0                    TO ASC-END-OF-SELECTED-RANGE.     09320099
093300                                                                  09330099
093400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09340099
093500                                                                  09350099
093600 EJECT                                                            09360099
093700*----------------------------------------------------------------*09370099
093800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09380099
093900*----------------------------------------------------------------*09390099
094000 2141-CLEAR-SELECTED-INDS.                                        09400099
094100                                                                  09410099
094200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09420099
094300             NOT EQUAL ZERO                                       09430099
094400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09440099
094500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09450099
094600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09460099
094700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09470099
094800                                   TO TRUE                        09480099
094900         END-IF                                                   09490099
095000     END-IF.                                                      09500099
095100                                                                  09510099
095200 EJECT                                                            09520099
095300*----------------------------------------------------------------*09530099
095400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09540099
095500*  FOR ALL ITEMS.                                                *09550099
095600*----------------------------------------------------------------*09560099
095700 2150-SELECT-ALL-ITEMS.                                           09570099
095800                                                                  09580099
095900     MOVE +1                       TO ASC-BLK-SUB.                09590099
096000                                                                  09600099
096100     PERFORM 2151-SET-SELECTED-INDS                               09610099
096200         VARYING ASC-ITEM-SUB                                     09620099
096300         FROM 1 BY 1                                              09630099
096400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09640099
096500                                                                  09650099
096600     ADD +1                        TO ASC-BLK-SUB.                09660099
096700                                                                  09670099
096800     PERFORM 2151-SET-SELECTED-INDS                               09680099
096900         VARYING ASC-ITEM-SUB                                     09690099
097000         FROM 1 BY 1                                              09700099
097100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09710099
097200                                                                  09720099
097300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09730099
097400                                   TO PV-LIST-ITEM-NUMBER.        09740099
097500                                                                  09750099
097600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09760099
097700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09770099
097800                                                                  09780099
097900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09790099
098000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09800099
098100         MOVE +1                   TO ASC-BLK-SUB                 09810099
098200                                                                  09820099
098300         PERFORM 5100-WRITE-TEMP-STORAGE                          09830099
098400                                                                  09840099
098500         MOVE +1                   TO PV-BLOCK-NUMBER             09850099
098600                                                                  09860099
098700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09870099
098800             PV-FIRST-BLOCK-IN-ARRAY - 1                          09880099
098900                                                                  09890099
099000         PERFORM                                                  09900099
099100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09910099
099200                                                                  09920099
099300             PERFORM 4410-READ-TEMP-STORAGE                       09930099
099400                                                                  09940099
099500             PERFORM 2151-SET-SELECTED-INDS                       09950099
099600                 VARYING ASC-ITEM-SUB                             09960099
099700                 FROM 1 BY 1                                      09970099
099800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09980099
099900                                                                  09990099
100000             PERFORM 5100-WRITE-TEMP-STORAGE                      10000099
100100                                                                  10010099
100200             ADD +1                TO PV-BLOCK-NUMBER             10020099
100300                                                                  10030099
100400         END-PERFORM                                              10040099
100500                                                                  10050099
100600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10060099
100700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10070099
100800                                                                  10080099
100900         PERFORM                                                  10090099
101000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10100099
101100                   ASC-HIGHEST-BLOCK-WRITTEN                      10110099
101200                                                                  10120099
101300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10130099
101400                                   TO PV-BLOCK-NUMBER             10140099
101500                                                                  10150099
101600             PERFORM 4410-READ-TEMP-STORAGE                       10160099
101700                                                                  10170099
101800             PERFORM 2151-SET-SELECTED-INDS                       10180099
101900                 VARYING ASC-ITEM-SUB                             10190099
102000                 FROM 1 BY 1                                      10200099
102100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10210099
102200                                                                  10220099
102300             PERFORM 5100-WRITE-TEMP-STORAGE                      10230099
102400                                                                  10240099
102500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10250099
102600                                                                  10260099
102700         END-PERFORM                                              10270099
102800                                                                  10280099
102900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10290099
103000                                   TO PV-BLOCK-NUMBER             10300099
103100                                                                  10310099
103200         PERFORM 4410-READ-TEMP-STORAGE                           10320099
103300     END-IF.                                                      10330099
103400                                                                  10340099
103500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10350099
103600                       ASC-NUMBER-OF-SELECTED-ITEMS.              10360099
103700                                                                  10370099
103800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10380099
103900                                                                  10390099
104000 EJECT                                                            10400099
104100*----------------------------------------------------------------*10410099
104200*    MARK EACH ITEM AS BEING SELECTED.                           *10420099
104300*----------------------------------------------------------------*10430099
104400 2151-SET-SELECTED-INDS.                                          10440099
104500                                                                  10450099
104600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10460099
104700             NOT EQUAL ZERO                                       10470099
104800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10480099
104900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10490099
105000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10500099
105100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10510099
105200                               TO  TRUE                           10520099
105300         END-IF                                                   10530099
105400     END-IF.                                                      10540099
105500                                                                  10550099
105600 EJECT                                                            10560099
105700**--------------------------------------------------------------**10570099
105800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10580099
105900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10590099
106000**--------------------------------------------------------------**10600099
106100 2200-MOVE-SCREEN-TO-COMMAREA.                                    10610099
106200                                                                  10620099
106300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10630099
106400     MOVE +1                       TO PV-SUB.                     10640099
106500*                                                                 10650099
106600     PERFORM 3100-SET-SUBSCRIPTS.                                 10660099
106700     IF  ASTRTITL > ZERO                                          10670099
106800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10680099
106900     ELSE                                                         10690099
107000         IF  ASTRTITF = DP015-ERASE-EOF                           10700099
107100             INITIALIZE ASC-START-ITEM-REQUEST                    10710099
107200         END-IF                                                   10720099
107300     END-IF.                                                      10730099
107400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10740099
107500         VARYING PV-SUB                                           10750099
107600         FROM 1 BY 1                                              10760099
107700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10770099
107800                                                                  10780099
107900 EJECT                                                            10790099
108000*----------------------------------------------------------------*10800099
108100*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *10810099
108200*----------------------------------------------------------------*10820099
108300 2210-MOVE-LINES-TO-COMMAREA.                                     10830099
108400                                                                  10840099
108500     IF  MR-SELECTL (PV-SUB) > ZERO                               10850099
108600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10860099
108700         MOVE MR-SELECTI (PV-SUB)                                 10870099
108800                                   TO ASC-TEMP-SELECTED-SW        10880099
108900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10890099
109000     ELSE                                                         10900099
109100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10910099
109200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10920099
109300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10930099
109400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10940099
109500         END-IF                                                   10950099
109600     END-IF.                                                      10960099
109700     ADD +1                        TO ASC-ITEM-SUB.               10970099
109800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10980099
109900         ADD +1                    TO ASC-BLK-SUB                 10990099
110000         MOVE +1                   TO ASC-ITEM-SUB                11000099
110100     END-IF.                                                      11010099
110200                                                                  11020099
110300 EJECT                                                            11030099
110400*----------------------------------------------------------------*11040099
110500*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *11050099
110600*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *11060099
110700*----------------------------------------------------------------*11070099
110800 3000-EDIT-DATA-IN-COMMAREA.                                      11080099
110900                                                                  11090099
111000     SET PS-NO-ERROR               TO TRUE.                       11100099
111100     PERFORM 3200-RESET-ATTRIBUTES.                               11110099
111200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11120099
111300**                                                                11130099
111400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11140099
111500* EDITTING IS DONE FROM THE BOTTOM UP.                            11150099
111600**                                                                11160099
111700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11170099
111800         ASC-ITEMS-DISPLAYED - 1.                                 11180099
111900     PERFORM 3100-SET-SUBSCRIPTS.                                 11190099
112000     PERFORM 3300-EDIT-SELECTIONS                                 11200099
112100         VARYING PV-SUB                                           11210099
112200         FROM PV-SUB BY -1                                        11220099
112300         UNTIL PV-SUB < +1                                        11230099
112400*                                                                 11240099
112500     IF  PS-NO-ERROR                                              11250099
112600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11260099
112700     END-IF.                                                      11270099
112800*                                                                 11280099
112900     IF  ((PS-NO-ERROR)                                           11290099
113000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11300099
113100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11310099
113200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11320099
113300     END-IF.                                                      11330099
113400                                                                  11340099
113500 EJECT                                                            11350099
113600*----------------------------------------------------------------*11360099
113700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11370099
113800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11380099
113900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11390099
114000*                                                                *11400099
114100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11410099
114200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11420099
114300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11430099
114400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11440099
114500*----------------------------------------------------------------*11450099
114600 3100-SET-SUBSCRIPTS.                                             11460099
114700                                                                  11470099
114800     COMPUTE ASC-ITEM-SUB =                                       11480099
114900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11490099
115000                                                                  11500099
115100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11510099
115200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11520099
115300                                                                  11530099
115400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11540099
115500     ELSE                                                         11550099
115600         MOVE +1                     TO ASC-BLK-SUB               11560099
115700     END-IF.                                                      11570099
115800                                                                  11580099
115900 EJECT                                                            11590099
116000*----------------------------------------------------------------*11600099
116100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *11610099
116200*----------------------------------------------------------------*11620099
116300 3200-RESET-ATTRIBUTES.                                           11630099
116400                                                                  11640099
116500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11650099
116600     MOVE DP015-GREEN              TO ASTRTITC.                   11660099
116700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11670099
116800*                                                                 11680099
116900     PERFORM                                                      11690099
117000        VARYING PV-SUB                                            11700099
117100        FROM 1 BY 1                                               11710099
117200        UNTIL PV-SUB > (PC-ITEMS-PER-PANEL OR ASC-ITEMS-DISPLAYED)11720099
117300        MOVE DP015-UNP-ALP-NOR-OFF                                11730099
117400                                   TO MR-SELECTA (PV-SUB)         11740099
117500        MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)         11750099
117600        MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)         11760099
117700     END-PERFORM.                                                 11770099
117800                                                                  11780099
117900 EJECT                                                            11790099
118000*----------------------------------------------------------------*11800099
118100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *11810099
118200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *11820099
118300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *11830099
118400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *11840099
118500*----------------------------------------------------------------*11850099
118600 3300-EDIT-SELECTIONS.                                            11860099
118700                                                                  11870099
118800     EVALUATE TRUE                                                11880099
118900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11890099
119000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11900099
119100                 CONTINUE                                         11910099
119200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11920099
119300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11930099
119400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11940099
119500                 MOVE ASC-TEMP-SELECTED-SW                        11950099
119600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11960099
119700                                TO ASC-SELECTED-SW                11970099
119800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11980099
119900             END-IF                                               11990099
120000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12000099
120100                 = SPACE                                          12010099
120200             EVALUATE TRUE                                        12020099
120300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12030099
120400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12040099
120500                     MOVE SPACE TO ASC-SELECTED-SW                12050099
120600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12060099
120700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12070099
120800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12080099
120900                     MOVE SPACE TO ASC-SELECTED-SW                12090099
121000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12100099
121100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12110099
121200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12120099
121300                     MOVE SPACE TO ASC-SELECTED-SW                12130099
121400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12140099
121500             END-EVALUATE                                         12150099
121600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12160099
121700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12170099
121800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12180099
121900             END-IF                                               12190099
122000             PERFORM 3310-EDIT-RANGE                              12200099
122100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12210099
122200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12220099
122300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12230099
122400             END-IF                                               12240099
122500             PERFORM 3310-EDIT-RANGE                              12250099
122600         WHEN OTHER                                               12260099
122700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12270099
122800             SET DP020-MSG-FATAL    TO TRUE                       12280099
122900             MOVE -1                TO MR-SELECTL (PV-SUB)        12290099
123000             SET DP030-SET-CURSOR-APPL-1                          12300099
123100                                    TO TRUE                       12310099
123200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12320099
123300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12330099
123400             SET PS-ERROR TO TRUE                                 12340099
123500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12350099
123600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12360099
123700                 MOVE SPACE         TO ASC-SELECTED-SW            12370099
123800                                        (ASC-BLK-SUB ASC-ITEM-SUB)12380099
123900             END-IF                                               12390099
124000     END-EVALUATE.                                                12400099
124100                                                                  12410099
124200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12420099
124300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12430099
124400     IF  ASC-ITEM-SUB < 1                                         12440099
124500         SUBTRACT +1 FROM ASC-BLK-SUB                             12450099
124600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12460099
124700     END-IF.                                                      12470099
124800                                                                  12480099
124900 EJECT                                                            12490099
125000*----------------------------------------------------------------*12500099
125100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *12510099
125200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *12520099
125300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *12530099
125400*  THE ENDING.                                                   *12540099
125500*----------------------------------------------------------------*12550099
125600 3310-EDIT-RANGE.                                                 12560099
125700                                                                  12570099
125800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12580099
125900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12590099
126000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12600099
126100                                   TO ASC-SELECTED-SW             12610099
126200                                        (ASC-BLK-SUB ASC-ITEM-SUB)12620099
126300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12630099
126400         ELSE                                                     12640099
126500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12650099
126600                 CONTINUE                                         12660099
126700             ELSE                                                 12670099
126800*----------------ONLY ONE BEGINNING-OF-RANGE-ALLOWED --           12680099
126900                 MOVE PC-TSYMSG-00054                             12690099
127000                                   TO DP020-MSG-NUMBER            12700099
127100                 SET DP020-MSG-FATAL                              12710099
127200                                   TO TRUE                        12720099
127300                 MOVE -1           TO MR-SELECTL (PV-SUB)         12730099
127400                 SET DP030-SET-CURSOR-APPL-1                      12740099
127500                                   TO TRUE                        12750099
127600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12760099
127700                 MOVE DP015-UNDERLINE                             12770099
127800                                   TO MR-SELECTH (PV-SUB)         12780099
127900                 SET PS-ERROR      TO TRUE                        12790099
128000             END-IF                                               12800099
128100         END-IF                                                   12810099
128200     ELSE                                                         12820099
128300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12830099
128400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12840099
128500                                   TO ASC-SELECTED-SW             12850099
128600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12860099
128700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12870099
128800         ELSE                                                     12880099
128900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12890099
129000                 CONTINUE                                         12900099
129100             ELSE                                                 12910099
129200*----------------ONLY ONE END-OF-RANGE ALLOWED --                 12920099
129300                 MOVE PC-TSYMSG-00055                             12930099
129400                                   TO DP020-MSG-NUMBER            12940099
129500                 SET DP020-MSG-FATAL                              12950099
129600                                   TO TRUE                        12960099
129700                 MOVE -1           TO MR-SELECTL (PV-SUB)         12970099
129800                 SET DP030-SET-CURSOR-APPL-1                      12980099
129900                                   TO TRUE                        12990099
130000                 SET PS-ERROR      TO TRUE                        13000099
130100             END-IF                                               13010099
130200         END-IF                                                   13020099
130300     END-IF.                                                      13030099
130400                                                                  13040099
130500 EJECT                                                            13050099
130600*----------------------------------------------------------------*13060099
130700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *13070099
130800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *13080099
130900*----------------------------------------------------------------*13090099
131000 3400-CHECK-RANGE-SEQUENCE.                                       13100099
131100                                                                  13110099
131200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13120099
131300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13130099
131400       AND  ASC-START-OF-SELECTED-RANGE >                         13140099
131500                                         ASC-END-OF-SELECTED-RANGE13150099
131600*--------END-OF-RANGE BEFORE BEGINNING-OF-RANGE--                 13160099
131700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13170099
131800         SET DP020-MSG-FATAL TO TRUE                              13180099
131900         SET PS-ERROR TO TRUE                                     13190099
132000         PERFORM 3410-POSITION-AT-ERROR                           13200099
132100     END-IF.                                                      13210099
132200                                                                  13220099
132300 EJECT                                                            13230099
132400*----------------------------------------------------------------*13240099
132500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *13250099
132600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *13260099
132700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *13270099
132800*----------------------------------------------------------------*13280099
132900 3410-POSITION-AT-ERROR.                                          13290099
133000                                                                  13300099
133100     SET DP030-SET-CURSOR-APPL-1                                  13310099
133200                                   TO TRUE.                       13320099
133300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13330099
133400                    - PV-TOP-ITEM + 1.                            13340099
133500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13350099
133600         CONTINUE                                                 13360099
133700     ELSE                                                         13370099
133800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13380099
133900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13390099
134000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13400099
134100     END-IF.                                                      13410099
134200*                                                                 13420099
134300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13430099
134400                    - PV-TOP-ITEM + 1.                            13440099
134500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13450099
134600         CONTINUE                                                 13460099
134700     ELSE                                                         13470099
134800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13480099
134900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13490099
135000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13500099
135100     END-IF.                                                      13510099
135200                                                                  13520099
135300 EJECT                                                            13530099
135400*----------------------------------------------------------------*13540099
135500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13550099
135600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13560099
135700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13570099
135800*----------------------------------------------------------------*13580099
135900 3500-MARK-RANGE-AS-SELECTED.                                     13590099
136000                                                                  13600099
136100     MOVE +1                       TO  ASC-BLK-SUB.               13610099
136200     PERFORM 3510-MARK-SELECTED-INDS                              13620099
136300         VARYING ASC-ITEM-SUB                                     13630099
136400         FROM 1 BY 1                                              13640099
136500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13650099
136600                                                                  13660099
136700     ADD +1                        TO ASC-BLK-SUB.                13670099
136800     PERFORM 3510-MARK-SELECTED-INDS                              13680099
136900         VARYING ASC-ITEM-SUB                                     13690099
137000         FROM 1 BY 1                                              13700099
137100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13710099
137200                                                                  13720099
137300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13730099
137400                                   TO  PV-LIST-ITEM-NUMBER.       13740099
137500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13750099
137600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13760099
137700               PC-ITEMS-PER-PANEL).                               13770099
137800                                                                  13780099
137900     MOVE ASC-START-OF-SELECTED-RANGE                             13790099
138000                                   TO PV-START-OF-SELECTED-RANGE. 13800099
138100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13810099
138200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13820099
138300               PC-ITEMS-PER-PANEL).                               13830099
138400                                                                  13840099
138500     MOVE ASC-END-OF-SELECTED-RANGE                               13850099
138600                                   TO  PV-END-OF-SELECTED-RANGE.  13860099
138700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13870099
138800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13880099
138900               PC-ITEMS-PER-PANEL).                               13890099
139000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13900099
139100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13910099
139200                                                                  13920099
139300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13930099
139400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13940099
139500         MOVE +1                   TO ASC-BLK-SUB                 13950099
139600         PERFORM 5100-WRITE-TEMP-STORAGE                          13960099
139700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13970099
139800             PV-FIRST-BLOCK-IN-ARRAY - 1                          13980099
139900                                                                  13990099
140000         PERFORM                                                  14000099
140100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14010099
140200                   PV-PREV-BLOCK-IN-ARRAY                         14020099
140300             MOVE PV-FIRST-BLOCK-IN-RANGE                         14030099
140400                                   TO PV-BLOCK-NUMBER             14040099
140500             PERFORM 4410-READ-TEMP-STORAGE                       14050099
140600             PERFORM 3510-MARK-SELECTED-INDS                      14060099
140700                 VARYING ASC-ITEM-SUB                             14070099
140800                 FROM 1 BY 1                                      14080099
140900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14090099
141000             PERFORM 5100-WRITE-TEMP-STORAGE                      14100099
141100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14110099
141200         END-PERFORM                                              14120099
141300                                                                  14130099
141400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14140099
141500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14150099
141600         PERFORM                                                  14160099
141700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14170099
141800                   PV-LAST-BLOCK-IN-RANGE                         14180099
141900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14190099
142000                                   TO PV-BLOCK-NUMBER             14200099
142100             PERFORM 4410-READ-TEMP-STORAGE                       14210099
142200             PERFORM 3510-MARK-SELECTED-INDS                      14220099
142300                 VARYING ASC-ITEM-SUB                             14230099
142400                 FROM 1 BY 1                                      14240099
142500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14250099
142600             PERFORM 5100-WRITE-TEMP-STORAGE                      14260099
142700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14270099
142800         END-PERFORM                                              14280099
142900                                                                  14290099
143000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14300099
143100                                   TO PV-BLOCK-NUMBER             14310099
143200         PERFORM 4410-READ-TEMP-STORAGE                           14320099
143300     END-IF.                                                      14330099
143400                                                                  14340099
143500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14350099
143600                                      ASC-END-OF-SELECTED-RANGE.  14360099
143700                                                                  14370099
143800 EJECT                                                            14380099
143900*----------------------------------------------------------------*14390099
144000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14400099
144100*----------------------------------------------------------------*14410099
144200 3510-MARK-SELECTED-INDS.                                         14420099
144300                                                                  14430099
144400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14440099
144500                                ASC-ITEM-SUB) >                   14450099
144600         ASC-START-OF-SELECTED-RANGE)                             14460099
144700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14470099
144800                                ASC-ITEM-SUB) =                   14480099
144900         ASC-START-OF-SELECTED-RANGE)                             14490099
145000                                                                  14500099
145100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14510099
145200                                    ASC-ITEM-SUB) <               14520099
145300             ASC-END-OF-SELECTED-RANGE)                           14530099
145400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14540099
145500                                    ASC-ITEM-SUB) =               14550099
145600             ASC-END-OF-SELECTED-RANGE)                           14560099
145700                                                                  14570099
145800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14580099
145900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14590099
146000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14600099
146100                               TO TRUE                            14610099
146200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14620099
146300                               TO TRUE                            14630099
146400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14640099
146500             END-IF                                               14650099
146600         END-IF                                                   14660099
146700     END-IF.                                                      14670099
146800                                                                  14680099
146900 EJECT                                                            14690099
147000*----------------------------------------------------------------*14700099
147100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14710099
147200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14720099
147300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14730099
147400*    DISPLAY THE PANEL TO USER.                                  *14740099
147500*----------------------------------------------------------------*14750099
147600 4000-BUILD-INITIAL-PANEL.                                        14760099
147700                                                                  14770099
147800     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             14780099
147900                                ASC-BLOCK-ENTRIES (2).            14790099
148000     MOVE +1                 TO ASC-BLK-SUB.                      14800099
148100     SET ASC-ITEMS-LEFT-ON-DB                                     14810099
148200                             TO TRUE.                             14820099
148300                                                                  14830099
148400     MOVE +0                 TO ASC-ITEM-SUB                      14840099
148500                                ASC-NUMBER-OF-ITEMS-READ          14850099
148600                                ASC-NUMBER-OF-SELECTED-ITEMS      14860099
148700                                ASC-HIGHEST-BLOCK-WRITTEN         14870099
148800                                ASC-START-OF-SELECTED-RANGE       14880099
148900                                ASC-END-OF-SELECTED-RANGE         14890099
149000                                ASC-ITEM-AT-TOP-OF-PANEL.         14900099
149100                                                                  14910099
149200     PERFORM 4100-PREPARE-CURSOR.                                 14920099
149300                                                                  14930099
149400     PERFORM 4010-OPEN-CURSOR.                                    14940099
149500                                                                  14950099
149600     PERFORM 4300-READ-ITEMS-FROM-DB.                             14960099
149700                                                                  14970099
149800     PERFORM 4020-CLOSE-CURSOR.                                   14980099
149900                                                                  14990099
150000     MOVE +1                   TO  PV-TOP-ITEM.                   15000099
150100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15010099
150200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15020099
150300         SET DP020-MSG-FATAL   TO  TRUE                           15030099
150400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15040099
150500     ELSE                                                         15050099
150600         MOVE -1               TO MR-SELECTL (1)                  15060099
150700         SET DP030-SET-CURSOR-APPL-1                              15070099
150800                               TO TRUE                            15080099
150900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15090099
151000     END-IF.                                                      15100099
151100                                                                  15110099
151200 EJECT                                                            15120099
151300*----------------------------------------------------------------*15130099
151400*   OPEN THE VESSEL LIST CURSOR                                  *15140099
151500*----------------------------------------------------------------*15150099
151600 4010-OPEN-CURSOR.                                                15160099
151700                                                                  15170099
151800     PERFORM                                                      15180099
151900         WITH TEST AFTER                                          15190099
152000         VARYING PV-RETRY-COUNTER                                 15200099
152100         FROM 1 BY 1                                              15210099
152200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15220099
152300                   OR (SQLCODE = ZERO))                           15230099
152400         MOVE 'CURSOR:  VSL-LST-CSR'                              15240099
152500                                 TO DP013-MESSAGE-TEXT (2)        15250099
152600         EXEC SQL                                                 15260099
152700              OPEN VSL-LST-CSR                                    15270099
152800         END-EXEC                                                 15280099
152900                                                                  15290099
153000                                                                  15300099
153100         EVALUATE TRUE                                            15310099
153200             WHEN SQLCODE = ZERO                                  15320099
153300             WHEN SQLCODE = -904                                  15330099
153400             WHEN SQLCODE = -913                                  15340099
153500                 CONTINUE                                         15350099
153600             WHEN SQLWARN0 NOT = SPACES                           15360099
153700             WHEN SQLCODE < ZERO                                  15370099
153800             WHEN SQLCODE > ZERO                                  15380099
153900                 MOVE '4010-OPEN-CURSOR'                          15390099
154000                                   TO DP013-PARAGRAPH             15400099
154100                 MOVE 'OPEN VESSEL LIST CURSOR - '                15410099
154200                                   TO DP013-MESSAGE-TEXT (1)      15420099
154300                 MOVE SQLCA        TO DP013-SQLCA                 15430099
154400                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    15440099
154500                 SET DP013-DB2-ABEND                              15450099
154600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15460099
154700                 PERFORM DP013-0000-PROCESS-ABEND                 15470099
154800         END-EVALUATE                                             15480099
154900     END-PERFORM.                                                 15490099
155000*                                                                 15500099
155100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15510099
155200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15520099
155300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15530099
155400                                   TO DP013-MESSAGE-TEXT (1)      15540099
155500         MOVE SQLCA                TO DP013-SQLCA                 15550099
155600         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    15560099
155700         SET DP013-DB2-ABEND                                      15570099
155800             DP013-XCTL-DISPLAY-RESTART                           15580099
155900                                   TO TRUE                        15590099
156000         PERFORM DP013-0000-PROCESS-ABEND                         15600099
156100     END-IF.                                                      15610099
156200                                                                  15620099
156300 EJECT                                                            15630099
156400*----------------------------------------------------------------*15640099
156500*   CLOSE THE VESSEL LIST CURSOR                                 *15650099
156600*----------------------------------------------------------------*15660099
156700 4020-CLOSE-CURSOR.                                               15670099
156800                                                                  15680099
156900     EXEC SQL                                                     15690099
157000          CLOSE VSL-LST-CSR                                       15700099
157100     END-EXEC.                                                    15710099
157200*                                                                 15720099
157300     EVALUATE TRUE                                                15730099
157400         WHEN SQLCODE = ZERO                                      15740099
157500             CONTINUE                                             15750099
157600         WHEN SQLWARN0 NOT = SPACES                               15760099
157700         WHEN SQLCODE < ZERO                                      15770099
157800         WHEN SQLCODE > ZERO                                      15780099
157900             MOVE '4020-CLOSE-CURSOR'                             15790099
158000                               TO DP013-PARAGRAPH                 15800099
158100             MOVE 'CLOSE VESSEL LIST CURSOR '                     15810099
158200                               TO DP013-MESSAGE-TEXT (1)          15820099
158300             MOVE SQLCA        TO DP013-SQLCA                     15830099
158400             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        15840099
158500             SET DP013-DB2-ABEND                                  15850099
158600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15860099
158700             PERFORM DP013-0000-PROCESS-ABEND                     15870099
158800     END-EVALUATE.                                                15880099
158900                                                                  15890099
159000 EJECT                                                            15900099
159100*----------------------------------------------------------------*15910099
159200*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *15920099
159300*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *15930099
159400*----------------------------------------------------------------*15940099
159500 4100-PREPARE-CURSOR.                                             15950099
159600                                                                  15960099
159700     IF  DK-VSL-NAME > SPACES                                     15970099
159800         INSPECT DK-VSL-NAME                                      15980099
159900                     TALLYING PV-TALLY-COUNTER                    15990099
160000                     FOR ALL '*'                                  16000099
160100         IF PV-TALLY-COUNTER > 0                                  16010099
160200             INSPECT DK-VSL-NAME                                  16020099
160300                     REPLACING  ALL SPACES BY PC-PERCENT          16030099
160400                                    AFTER  INITIAL '*',           16040099
160500                                     '*'  BY PC-PERCENT           16050099
160600         END-IF                                                   16060099
160700         IF  DK-VOY-NBR = SPACES                                  16070099
160800             MOVE ALL '%'            TO DK-VOY-NBR                16080099
160900         END-IF                                                   16090099
161000     ELSE                                                         16100099
161100         IF  DK-VOY-NBR > SPACES                                  16110099
161200             MOVE ALL '%'            TO DK-VSL-NAME               16120099
161300         END-IF                                                   16130099
161400     END-IF.                                                      16140099
161500                                                                  16150099
161600 EJECT                                                            16160099
161700*----------------------------------------------------------------*16170099
161800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16180099
161900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16190099
162000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16200099
162100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16210099
162200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16220099
162300*                                                                *16230099
162400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16240099
162500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16250099
162600*    UPON INITIALIZATION.                                        *16260099
162700*----------------------------------------------------------------*16270099
162800 4300-READ-ITEMS-FROM-DB.                                         16280099
162900                                                                  16290099
163000     PERFORM                                                      16300099
163100         VARYING PV-READ-COUNT                                    16310099
163200         FROM 1 BY 1                                              16320099
163300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16330099
163400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16340099
163500                                                                  16350099
163600         PERFORM 4310-FETCH                                       16360099
163700                                                                  16370099
163800         IF  ASC-ITEMS-LEFT-ON-DB                                 16380099
163900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16390099
164000                 ADD +1            TO ASC-ITEM-SUB                16400099
164100             ELSE                                                 16410099
164200                 ADD +1            TO ASC-BLK-SUB                 16420099
164300                 MOVE +1           TO ASC-ITEM-SUB                16430099
164400                                                                  16440099
164500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16450099
164600                     MOVE +1       TO ASC-BLK-SUB                 16460099
164700                     SET ASC-BLOCK-MODIFIED (1)                   16470099
164800                                   TO TRUE                        16480099
164900                     PERFORM 5100-WRITE-TEMP-STORAGE              16490099
165000                     MOVE ASC-BLOCK-ENTRIES                       16500099
165100                               (PC-MAX-BLOCKS-IN-ARRAY)           16510099
165200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16520099
165300                     ADD +1        TO ASC-BLK-SUB                 16530099
165400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16540099
165500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16550099
165600                                   TO TRUE                        16560099
165700                 END-IF                                           16570099
165800             END-IF                                               16580099
165900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16590099
166000             MOVE ASC-NUMBER-OF-ITEMS-READ                        16600099
166100                                   TO ASC-LIST-ITEM-NUMBER        16610099
166200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16620099
166300             MOVE IMCNTK-MOM-IMPRT-VEH-NM TO ASC-VSL-NAME         16630099
166400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16640099
166500             MOVE IMCNTK-MOM-TRIP-TYP-CDE TO ASC-TRIP-TYP-CDE     16650099
166600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16660099
166700             MOVE IMCNTK-MOM-IMPRT-TRIP-ID                        16670099
166800                                   TO  ASC-VOY-NBR                16680099
166900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16690099
167300             PERFORM 4330-FOB-CDE-CHECK                           16730099
167400             PERFORM 4340-POE-CDE-CHECK                           16740099
167500*                                                                 16750099
167600             IF IMCNTK-FDR-DPRTR-TMST (1:10)                      16760099
167700                                   = SPACES OR PC-INIT-DATE       16770099
167800                MOVE IMCNTK-MOM-DPRTR-TMST (1:10)                 16780099
167900                                   TO  PV-DATE-BREAK              16790099
168000             ELSE                                                 16800099
168100                MOVE IMCNTK-FDR-DPRTR-TMST (1:10)                 16810099
168200                                   TO  PV-DATE-BREAK              16820099
168300             END-IF                                               16830099
168400             IF PV-DATE-BREAK      =   SPACES OR PC-INIT-DATE     16840099
168500                MOVE SPACES        TO  ASC-ATD                    16850099
168600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16860099
168700             ELSE                                                 16870099
168800                PERFORM 4320-FORMAT-DATE                          16880099
168900                MOVE PV-DATE-DISPLAY                              16890099
169000                                   TO  ASC-ATD                    16900099
169100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16910099
169200             END-IF                                               16920099
169300*                                                                 16930099
169400             MOVE IMCNTK-MOM-POE-DELY-TMST (1:10)                 16940099
169500                                   TO  PV-DATE-BREAK              16950099
169600             IF PV-DATE-BREAK = SPACES OR PC-INIT-DATE            16960099
169700                MOVE SPACES        TO  ASC-ETA                    16970099
169800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16980099
169900             ELSE                                                 16990099
170000                PERFORM 4320-FORMAT-DATE                          17000099
170100                MOVE PV-DATE-DISPLAY                              17010099
170200                                   TO  ASC-ETA                    17020099
170300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17030099
170400             END-IF                                               17040099
170410*                                                                 17041099
170420             MOVE IMCNTK-MOM-POE-DELY-TMST (12:5)                 17042099
170430                                   TO  PV-TIME-BREAK              17043099
170440             IF PV-TIME-BREAK = SPACES OR PC-INIT-TIME            17044099
170450                MOVE SPACES        TO  ASC-ETA-TIME               17045099
170460                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17046099
170470             ELSE                                                 17047099
170480                PERFORM 4325-FORMAT-TIME                          17048099
170490                MOVE PV-TIME-DISPLAY                              17049099
170491                                   TO  ASC-ETA-TIME               17049199
170492                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17049299
170493             END-IF                                               17049399
170500*                                                                 17050099
170600         END-IF                                                   17060099
170700     END-PERFORM.                                                 17070099
170800*                                                                 17080099
170900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17090099
171000         MOVE +1               TO ASC-BLK-SUB                     17100099
171100         PERFORM 5100-WRITE-TEMP-STORAGE                          17110099
171200         ADD +1                TO ASC-BLK-SUB                     17120099
171300         PERFORM 5100-WRITE-TEMP-STORAGE                          17130099
171400                                                                  17140099
171500         MOVE 1                TO ASC-BLK-SUB                     17150099
171600                                  PV-BLOCK-NUMBER                 17160099
171700         PERFORM 4410-READ-TEMP-STORAGE                           17170099
171800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17180099
171900             MOVE 2            TO ASC-BLK-SUB                     17190099
172000                                  PV-BLOCK-NUMBER                 17200099
172100             PERFORM 4410-READ-TEMP-STORAGE                       17210099
172200         END-IF                                                   17220099
172300     END-IF.                                                      17230099
172400                                                                  17240099
172500 EJECT                                                            17250099
172600*----------------------------------------------------------------*17260099
172700*    FETCH THE VESSEL LIST CURSOR                                *17270099
172800*----------------------------------------------------------------*17280099
172900 4310-FETCH.                                                      17290099
173000                                                                  17300099
173100     EXEC SQL                                                     17310099
173200          FETCH VSL-LST-CSR                                       17320099
173300          INTO  :IMCNTK-MOM-IMPRT-VEH-NM                          17330099
173400              , :IMCNTK-MOM-IMPRT-TRIP-ID                         17340099
173500              , :IMCNTK-FDR-FOB-CDE                               17350099
173600              , :IMCNTK-MOM-FOB-CDE                               17360099
173700              , :IMCNTK-FDR-DPRTR-TMST                            17370099
173800              , :IMCNTK-MOM-DPRTR-TMST                            17380099
173900              , :IMCNTK-MOM-DEST-POE-CDE                          17390099
174000              , :IMCNTK-MOM-POE-DELY-TMST                         17400099
174200              , :IMCNTK-MOM-TRIP-TYP-CDE                          17420099
174300              , :IMCNTK-FDR-TRIP-TYP-CDE                          17430099
174400     END-EXEC.                                                    17440099
174500                                                                  17450099
174600     EVALUATE TRUE                                                17460099
174700         WHEN SQLCODE = ZERO                                      17470099
174800         WHEN SQLCODE = +100                                      17480099
174900              CONTINUE                                            17490099
175000         WHEN SQLWARN0 NOT = SPACE                                17500099
175100         WHEN SQLCODE NOT = ZERO                                  17510099
175200              MOVE '4310-FETCH-CURSOR'                            17520099
175300                               TO DP013-PARAGRAPH                 17530099
175400              MOVE 'FETCH VESSEL LIST CURSOR'                     17540099
175500                               TO DP013-MESSAGE-TEXT (1)          17550099
175600              MOVE SQLCA       TO DP013-SQLCA                     17560099
175700              SET DP013-DB2-ABEND                                 17570099
175800                               TO TRUE                            17580099
175900              PERFORM DP013-0000-PROCESS-ABEND                    17590099
176000     END-EVALUATE.                                                17600099
176100                                                                  17610099
176200     IF  SQLCODE EQUAL +100                                       17620099
176300         SET ASC-NO-ITEMS-LEFT-ON-DB                              17630099
176400                                   TO TRUE                        17640099
176500     END-IF.                                                      17650099
176600                                                                  17660099
176700 EJECT                                                            17670099
176800*----------------------------------------------------------------*17680099
176900*      FORMAT THE DB2 DATE TO MM/DD/YY                           *17690099
177000*----------------------------------------------------------------*17700099
177100 4320-FORMAT-DATE.                                                17710099
177200                                                                  17720099
177300     MOVE PV-DB-MM          TO  PV-DD-MM.                         17730099
177400     MOVE PV-DB-DD          TO  PV-DD-DD.                         17740099
177500     MOVE PV-DB-YY          TO  PV-DD-YY.                         17750099
177600                                                                  17760099
177700 EJECT                                                            17770099
177710*----------------------------------------------------------------*17771099
177720*      FORMAT THE DB2 TIME TO HH:MM                              *17772099
177730*----------------------------------------------------------------*17773099
177740 4325-FORMAT-TIME.                                                17774099
177750                                                                  17775099
177760     MOVE PV-TB-HH          TO  PV-TD-HH.                         17776099
177770     MOVE PV-TB-MM          TO  PV-TD-MM.                         17777099
177790                                                                  17779099
177791 EJECT                                                            17779199
177800*----------------------------------------------------------------*17780099
177900*   CHECK FOR TRIP-TYPE-CODE AND MOVE FOB CODE                   *17790099
178000*----------------------------------------------------------------*17800099
178100 4330-FOB-CDE-CHECK.                                              17810099
178200                                                                  17820099
178300     EVALUATE TRUE                                                17830099
178400          WHEN  (IMCNTK-FDR-TRIP-TYP-CDE  = 'A') OR               17840099
178500                (IMCNTK-MOM-TRIP-TYP-CDE  = 'A')                  17850099
178600                IF IMCNTK-FDR-FOB-CDE = SPACES                    17860099
178700                   MOVE IMCNTK-MOM-FOB-CDE TO ASC-FOB             17870099
178800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17880099
178900                ELSE                                              17890099
179000                   MOVE IMCNTK-FDR-FOB-CDE TO ASC-FOB             17900099
179100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17910099
179200                END-IF                                            17920099
179300                                                                  17930099
179400          WHEN  (IMCNTK-FDR-TRIP-TYP-CDE  = 'O' OR 'M') OR        17940099
179500                (IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M')           17950099
179600                IF IMCNTK-FDR-FOB-CDE = SPACES                    17960099
179700                   PERFORM 4350-SELECT-MOM-FOB-CDE                17970099
179800                ELSE                                              17980099
179900                   PERFORM 4360-SELECT-FDR-FOB-CDE                17990099
180000                END-IF                                            18000099
180100                MOVE IMFOB-FOB-CDE      TO ASC-FOB                18010099
180200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18020099
180300                                                                  18030099
180400          WHEN  OTHER                                             18040099
180500                MOVE SPACES             TO ASC-FOB                18050099
180600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18060099
180700     END-EVALUATE.                                                18070099
180800                                                                  18080099
180900 EJECT                                                            18090099
181000*----------------------------------------------------------------*18100099
181100*   CHECK FOR TRIP-TYPE-CODE AND MOVE POE CODE                   *18110099
181200*----------------------------------------------------------------*18120099
181300 4340-POE-CDE-CHECK.                                              18130099
181400                                                                  18140099
181500     EVALUATE TRUE                                                18150099
182100          WHEN  IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M' OR 'A'      18210099
182201                PERFORM 4380-OPEN-POE-CURSOR                      18220199
182202                PERFORM 4384-FETCH-POE-CURSOR                     18220299
182210                PERFORM 4382-CLOSE-POE-CURSOR                     18221099
182300                MOVE IMPOE-POE-CDE      TO ASC-POE                18230099
182400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18240099
182500                                                                  18250099
182600          WHEN  OTHER                                             18260099
182700                MOVE SPACES             TO ASC-POE                18270099
182800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18280099
182900     END-EVALUATE.                                                18290099
183000                                                                  18300099
183100 EJECT                                                            18310099
183200*----------------------------------------------------------------*18320099
183300*      SELECT MOM FOB CODE FROM TIMFOB                           *18330099
183400*----------------------------------------------------------------*18340099
183500 4350-SELECT-MOM-FOB-CDE.                                         18350099
183600                                                                  18360099
183700     EXEC SQL                                                     18370099
183800         SELECT DISTINCT                                          18380099
183900               A.FOB_CDE                                          18390099
184000         INTO   :IMFOB-FOB-CDE                                    18400099
184100         FROM   TIMFOB A                                          18410099
184200         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-MOM-FOB-CDE           18420099
184300            AND A.STAT_CDE = 'A'                                  18430099
184400     END-EXEC.                                                    18440099
184500                                                                  18450099
184600     EVALUATE TRUE                                                18460099
184700         WHEN SQLCODE = ZERO                                      18470099
184800              CONTINUE                                            18480099
184900         WHEN SQLCODE = +100                                      18490099
185000         WHEN SQLCODE = -811                                      18500099
185100              MOVE SPACES          TO IMFOB-FOB-CDE               18510099
185200         WHEN SQLWARN0 NOT = SPACE                                18520099
185300         WHEN SQLCODE NOT = ZERO                                  18530099
185400              MOVE '4350-SELECT-MOM-FOB-CDE'                      18540099
185500                               TO DP013-PARAGRAPH                 18550099
185600              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             18560099
185700                               TO DP013-MESSAGE-TEXT (1)          18570099
185800              MOVE SQLCA       TO DP013-SQLCA                     18580099
185900              SET DP013-DB2-ABEND                                 18590099
186000                               TO TRUE                            18600099
186100              PERFORM DP013-0000-PROCESS-ABEND                    18610099
186200     END-EVALUATE.                                                18620099
186300                                                                  18630099
186400 EJECT                                                            18640099
186500*----------------------------------------------------------------*18650099
186600*      SELECT FDR FOB CODE FROM TIMFOB                           *18660099
186700*----------------------------------------------------------------*18670099
186800 4360-SELECT-FDR-FOB-CDE.                                         18680099
186900                                                                  18690099
187000     EXEC SQL                                                     18700099
187100         SELECT DISTINCT                                          18710099
187200               A.FOB_CDE                                          18720099
187300         INTO   :IMFOB-FOB-CDE                                    18730099
187400         FROM   TIMFOB A                                          18740099
187500         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-FDR-FOB-CDE           18750099
187600            AND A.STAT_CDE = 'A'                                  18760099
187700     END-EXEC.                                                    18770099
187800                                                                  18780099
187900     EVALUATE TRUE                                                18790099
188000         WHEN SQLCODE = ZERO                                      18800099
188100              CONTINUE                                            18810099
188200         WHEN SQLCODE = +100                                      18820099
188300         WHEN SQLCODE = -811                                      18830099
188400              MOVE SPACES          TO IMFOB-FOB-CDE               18840099
188500         WHEN SQLWARN0 NOT = SPACE                                18850099
188600         WHEN SQLCODE NOT = ZERO                                  18860099
188700              MOVE '4360-SELECT-FDR-FOB-CDE'                      18870099
188800                               TO DP013-PARAGRAPH                 18880099
188900              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             18890099
189000                               TO DP013-MESSAGE-TEXT (1)          18900099
189100              MOVE SQLCA       TO DP013-SQLCA                     18910099
189200              SET DP013-DB2-ABEND                                 18920099
189300                               TO TRUE                            18930099
189400              PERFORM DP013-0000-PROCESS-ABEND                    18940099
189500     END-EVALUATE.                                                18950099
189600                                                                  18960099
189700 EJECT                                                            18970099
192801*----------------------------------------------------------------*19280199
192802*   OPEN THE POE CODE CURSOR                                     *19280299
192803*----------------------------------------------------------------*19280399
192804 4380-OPEN-POE-CURSOR.                                            19280499
192805                                                                  19280599
192806     PERFORM                                                      19280699
192807         WITH TEST AFTER                                          19280799
192808         VARYING PV-RETRY-COUNTER                                 19280899
192809         FROM 1 BY 1                                              19280999
192810         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19281099
192811                   OR (SQLCODE = ZERO))                           19281199
192812                                                                  19281299
192813         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)    19281399
192814                                                                  19281499
192815         EXEC SQL                                                 19281599
192816              OPEN POE-CSR                                        19281699
192817         END-EXEC                                                 19281799
192818                                                                  19281899
192819         EVALUATE TRUE                                            19281999
192820             WHEN SQLCODE = ZERO                                  19282099
192821             WHEN SQLCODE = -904                                  19282199
192822             WHEN SQLCODE = -913                                  19282299
192823                 CONTINUE                                         19282399
192824             WHEN SQLWARN0 NOT = SPACES                           19282499
192825             WHEN SQLCODE < ZERO                                  19282599
192826             WHEN SQLCODE > ZERO                                  19282699
192827                 MOVE '4380-OPEN-POE-CURSOR'                      19282799
192828                                   TO DP013-PARAGRAPH             19282899
192829                 MOVE 'OPEN POE CURSOR - '                        19282999
192830                                   TO DP013-MESSAGE-TEXT (1)      19283099
192831                 MOVE SQLCA        TO DP013-SQLCA                 19283199
192832                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    19283299
192833                 SET DP013-DB2-ABEND                              19283399
192834                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19283499
192835                 PERFORM DP013-0000-PROCESS-ABEND                 19283599
192836         END-EVALUATE                                             19283699
192837     END-PERFORM.                                                 19283799
192838*                                                                 19283899
192839     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19283999
192840         MOVE '4382-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           19284099
192841         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19284199
192842                                   TO DP013-MESSAGE-TEXT (1)      19284299
192843         MOVE SQLCA                TO DP013-SQLCA                 19284399
192844         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    19284499
192845         SET DP013-DB2-ABEND                                      19284599
192846             DP013-XCTL-DISPLAY-RESTART                           19284699
192847                                   TO TRUE                        19284799
192848         PERFORM DP013-0000-PROCESS-ABEND                         19284899
192849     END-IF.                                                      19284999
192850                                                                  19285099
192851 EJECT                                                            19285199
192852*----------------------------------------------------------------*19285299
192853*   CLOSE THE POE CODE CURSOR                                    *19285399
192854*----------------------------------------------------------------*19285499
192855 4382-CLOSE-POE-CURSOR.                                           19285599
192856                                                                  19285699
192857     EXEC SQL                                                     19285799
192858          CLOSE POE-CSR                                           19285899
192859     END-EXEC.                                                    19285999
192860                                                                  19286099
192861     EVALUATE TRUE                                                19286199
192862         WHEN SQLCODE = ZERO                                      19286299
192863             CONTINUE                                             19286399
192864         WHEN SQLWARN0 NOT = SPACES                               19286499
192865         WHEN SQLCODE < ZERO                                      19286599
192866         WHEN SQLCODE > ZERO                                      19286699
192867             MOVE '4382-CLOSE-POE-CURSOR'                         19286799
192868                               TO DP013-PARAGRAPH                 19286899
192869             MOVE 'CLOSE POE CURSOR '                             19286999
192870                               TO DP013-MESSAGE-TEXT (1)          19287099
192871             MOVE SQLCA        TO DP013-SQLCA                     19287199
192872             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)        19287299
192873             SET DP013-DB2-ABEND                                  19287399
192874                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19287499
192875             PERFORM DP013-0000-PROCESS-ABEND                     19287599
192876     END-EVALUATE.                                                19287699
192877                                                                  19287799
192878 EJECT                                                            19287899
192879*----------------------------------------------------------------*19287999
192880*    FETCH THE POE CODE CURSOR                                   *19288099
192881*----------------------------------------------------------------*19288199
192882 4384-FETCH-POE-CURSOR.                                           19288299
192883                                                                  19288399
192884     EXEC SQL                                                     19288499
192885          FETCH POE-CSR                                           19288599
192886          INTO  :IMPOE-POE-CDE                                    19288699
192887     END-EXEC.                                                    19288799
192888                                                                  19288899
192889     EVALUATE TRUE                                                19288999
192890         WHEN SQLCODE = ZERO                                      19289099
192891         WHEN SQLCODE = -811                                      19289199
192892              CONTINUE                                            19289299
192893         WHEN SQLCODE = +100                                      19289399
192894              MOVE SPACES TO IMPOE-POE-CDE                        19289499
192895         WHEN SQLWARN0 NOT = SPACE                                19289599
192896         WHEN SQLCODE NOT = ZERO                                  19289699
192897              MOVE '4384-FETCH-POE-CURSOR'                        19289799
192898                               TO DP013-PARAGRAPH                 19289899
192899              MOVE 'FETCH POE CURSOR'                             19289999
192900                               TO DP013-MESSAGE-TEXT (1)          19290099
192901              MOVE SQLCA       TO DP013-SQLCA                     19290199
192902              SET DP013-DB2-ABEND                                 19290299
192903                               TO TRUE                            19290399
192904              PERFORM DP013-0000-PROCESS-ABEND                    19290499
192905     END-EVALUATE.                                                19290599
192906                                                                  19290699
192907 EJECT                                                            19290799
192910*----------------------------------------------------------------*19291099
193000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19300099
193100*----------------------------------------------------------------*19310099
193200 4400-MOVE-COMMAREA-TO-SCREEN.                                    19320099
193300                                                                  19330099
193400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19340099
193500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19350099
193600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19360099
193700             MOVE +1    TO ASC-BLK-SUB                            19370099
193800             PERFORM 5100-WRITE-TEMP-STORAGE                      19380099
193900             ADD +1     TO ASC-BLK-SUB                            19390099
194000             PERFORM 5100-WRITE-TEMP-STORAGE                      19400099
194100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19410099
194200                 GIVING PV-BLOCK-NUMBER                           19420099
194300                 REMAINDER PV-REMAINDER                           19430099
194400             IF  PV-REMAINDER > ZERO                              19440099
194500                 ADD +1 TO PV-BLOCK-NUMBER                        19450099
194600             END-IF                                               19460099
194700             MOVE +1    TO ASC-BLK-SUB                            19470099
194800             PERFORM 4410-READ-TEMP-STORAGE                       19480099
194900             ADD +1     TO ASC-BLK-SUB                            19490099
195000                           PV-BLOCK-NUMBER                        19500099
195100             PERFORM 4410-READ-TEMP-STORAGE                       19510099
195200     END-IF.                                                      19520099
195300     MOVE +1            TO ASC-BLK-SUB.                           19530099
195400     COMPUTE ASC-ITEM-SUB =                                       19540099
195500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19550099
195600         + PC-ITEMS-PER-PANEL).                                   19560099
195700*                                                                 19570099
195800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19580099
195900         ADD +1         TO ASC-BLK-SUB                            19590099
196000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19600099
196100     END-IF.                                                      19610099
196200*                                                                 19620099
196300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19630099
196400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19640099
196500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19650099
196600     PERFORM 4420-FORMAT-LIST-LINES                               19660099
196700         VARYING PV-SUB                                           19670099
196800         FROM PC-ITEMS-PER-PANEL BY -1                            19680099
196900         UNTIL PV-SUB < +1.                                       19690099
197000*                                                                 19700099
197100     COMPUTE ASC-ITEMS-DISPLAYED =                                19710099
197200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19720099
197300     MOVE ASC-KEY-VSL-NAME         TO AVSNMO.                     19730099
197400     MOVE ASC-KEY-VOY-NBR          TO AVYNOO.                     19740099
197500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19750099
197600                                      ASTRTITO.                   19760099
197700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19770099
197800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19780099
197900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19790099
198000                                   TO ASELITO.                    19800099
198100*                                                                 19810099
198200     IF  DP020-MSG-NUMBER-X = SPACE                               19820099
198300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19830099
198400*--------------- MORE ITEMS TO DISPLAY ----                       19840099
198500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19850099
198600             SET DP020-MSG-INFORMATIONAL TO TRUE                  19860099
198700         END-IF                                                   19870099
198800     END-IF.                                                      19880099
198900                                                                  19890099
199000 EJECT                                                            19900099
199100*----------------------------------------------------------------*19910099
199200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19920099
199300*----------------------------------------------------------------*19930099
199400 4410-READ-TEMP-STORAGE.                                          19940099
199500                                                                  19950099
199600     EXEC CICS                                                    19960099
199700         READQ TS                                                 19970099
199800             QUEUE (ASC-LIST-QUEUE-NAME)                          19980099
199900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19990099
200000             ITEM  (PV-BLOCK-NUMBER)                              20000099
200100             RESP  (PV-CICS-RESP)                                 20010099
200200     END-EXEC.                                                    20020099
200300                                                                  20030099
200400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20040099
200500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20050099
200600         CONTINUE                                                 20060099
200700     ELSE                                                         20070099
200800         SET DP013-CICS-ABEND     TO TRUE                         20080099
200900         SET DP013-NO-ROLLBACK    TO TRUE                         20090099
201000         MOVE '4410-READ-TEMP-STORAGE'                            20100099
201100                                  TO DP013-PARAGRAPH              20110099
201200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20120099
201300                                  TO DP013-MESSAGE-TEXT(1)        20130099
201400         PERFORM DP013-0000-PROCESS-ABEND                         20140099
201500     END-IF.                                                      20150099
201600                                                                  20160099
201700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20170099
201800                                                                  20180099
201900*                                                                 20190099
202000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20200099
202100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20210099
202200     END-IF.                                                      20220099
202300                                                                  20230099
202400 EJECT                                                            20240099
202500*----------------------------------------------------------------*20250099
202600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20260099
202700*----------------------------------------------------------------*20270099
202800 4420-FORMAT-LIST-LINES.                                          20280099
202900                                                                  20290099
203000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20300099
203100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20310099
203200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20320099
203300         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20330099
203400         MOVE SPACES             TO MR-SELECTI (PV-SUB)           20340099
203500                                    MR-ACTION (PV-SUB)            20350099
203600                                    MR-VSL-NAME (PV-SUB)          20360099
203700                                    MR-TRIP-TYP-CDE (PV-SUB)      20370099
203800                                    MR-VOY-NBR (PV-SUB)           20380099
203900                                    MR-FOB (PV-SUB)               20390099
204000                                    MR-ATD (PV-SUB)               20400099
204100                                    MR-POE (PV-SUB)               20410099
204200                                    MR-ETA (PV-SUB)               20420099
204300                                    MR-ETA-TIME (PV-SUB)          20430099
204400     ELSE                                                         20440099
204500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20450099
204600                                                   > SPACE        20460099
204700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20470099
204800                                 TO MR-SELECTI (PV-SUB)           20480099
204900         ELSE                                                     20490099
205000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20500099
205100                                 TO MR-SELECTI (PV-SUB)           20510099
205200         END-IF                                                   20520099
205300*                                                                 20530099
205400         IF  DP030-SET-CURSOR-TRAILER                             20540099
205500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20550099
205600                 > SPACE)                                         20560099
205700               OR (PV-SUB = 1))                                   20570099
205800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20580099
205900                MOVE -1          TO MR-SELECTL (PV-SUB)           20590099
206000             END-IF                                               20600099
206100         END-IF                                                   20610099
206200*                                                                 20620099
206300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20630099
206400             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           20640099
206500                                 TO MR-ACTION (PV-SUB)            20650099
206600             MOVE ASC-VSL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         20660099
206700                                 TO MR-VSL-NAME (PV-SUB)          20670099
206800             MOVE ASC-TRIP-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     20680099
206900                                 TO MR-TRIP-TYP-CDE (PV-SUB)      20690099
207000             MOVE ASC-VOY-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          20700099
207100                                 TO MR-VOY-NBR (PV-SUB)           20710099
207200             MOVE ASC-FOB (ASC-BLK-SUB ASC-ITEM-SUB)              20720099
207300                                 TO MR-FOB (PV-SUB)               20730099
207400             MOVE ASC-ATD (ASC-BLK-SUB ASC-ITEM-SUB)              20740099
207500                                 TO MR-ATD (PV-SUB)               20750099
207600             MOVE ASC-POE (ASC-BLK-SUB ASC-ITEM-SUB)              20760099
207700                                 TO MR-POE (PV-SUB)               20770099
207800             MOVE ASC-ETA (ASC-BLK-SUB ASC-ITEM-SUB)              20780099
207900                                 TO MR-ETA (PV-SUB)               20790099
208000             MOVE ASC-ETA-TIME (ASC-BLK-SUB ASC-ITEM-SUB)         20800099
208100                                 TO MR-ETA-TIME (PV-SUB)          20810099
208200         END-IF                                                   20820099
208300     END-IF.                                                      20830099
208400     SUBTRACT +1 FROM ASC-ITEM-SUB                                20840099
208500     IF  ASC-ITEM-SUB < + 1                                       20850099
208600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20860099
208700         MOVE +1                 TO ASC-BLK-SUB                   20870099
208800     END-IF.                                                      20880099
208900                                                                  20890099
209000 EJECT                                                            20900099
209100**--------------------------------------------------------------**20910099
209200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20920099
209300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20930099
209400** ISSUE A WARNING.                                             **20940099
209500**--------------------------------------------------------------**20950099
209600 4430-CHECK-FOR-BEGIN-AND-END.                                    20960099
209700                                                                  20970099
209800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20980099
209900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20990099
210000*-------------- NO END-OF-RANGE SPECFIED ---                      21000099
210100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21010099
210200             SET DP020-MSG-WARNING TO TRUE                        21020099
210300             PERFORM 4431-POSITION-AT-WARNING                     21030099
210400         END-IF                                                   21040099
210500     ELSE                                                         21050099
210600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21060099
210700*-------------- NO BEGINNING-OF-RANGE SPECFIED ---                21070099
210800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21080099
210900             SET DP020-MSG-WARNING TO TRUE                        21090099
211000             PERFORM 4431-POSITION-AT-WARNING                     21100099
211100         END-IF                                                   21110099
211200     END-IF.                                                      21120099
211300                                                                  21130099
211400 EJECT                                                            21140099
211500**--------------------------------------------------------------**21150099
211600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21160099
211700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21170099
211800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21180099
211900** POSITION THE CURSOR THERE.                                   **21190099
212000**--------------------------------------------------------------**21200099
212100 4431-POSITION-AT-WARNING.                                        21210099
212200                                                                  21220099
212300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21230099
212400                    - PV-TOP-ITEM + 1.                            21240099
212500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21250099
212600         CONTINUE                                                 21260099
212700     ELSE                                                         21270099
212800         SET DP030-SET-CURSOR-APPL-1                              21280099
212900                                   TO TRUE                        21290099
213000         MOVE -1                   TO MR-SELECTL (PV-SUB)         21300099
213100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21310099
213200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21320099
213300     END-IF.                                                      21330099
213400*                                                                 21340099
213500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21350099
213600                    - PV-TOP-ITEM + 1.                            21360099
213700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21370099
213800         CONTINUE                                                 21380099
213900     ELSE                                                         21390099
214000         SET DP030-SET-CURSOR-APPL-1                              21400099
214100                                   TO TRUE                        21410099
214200         MOVE -1                   TO MR-SELECTL (PV-SUB)         21420099
214300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21430099
214400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21440099
214500     END-IF.                                                      21450099
214600                                                                  21460099
214700 EJECT                                                            21470099
214800*----------------------------------------------------------------*21480099
214900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21490099
215000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21500099
215100* FOR THE SELECTED ITEMS QUEUE.                                  *21510099
215200*                                                                *21520099
215300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21530099
215400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21540099
215500* THE ARRAY IS FULL.                                             *21550099
215600*----------------------------------------------------------------*21560099
215700 5000-PREPARE-SEL-QUEUE.                                          21570099
215800                                                                  21580099
215900     MOVE +1                   TO  ASC-BLK-SUB.                   21590099
216000     PERFORM 5100-WRITE-TEMP-STORAGE.                             21600099
216100     ADD +1                    TO  ASC-BLK-SUB.                   21610099
216200     PERFORM 5100-WRITE-TEMP-STORAGE.                             21620099
216300                                                                  21630099
216400     MOVE ASC-SEL-QUEUE-NAME    TO  TR104-SEL-QUEUE-NAME.         21640099
216500     PERFORM 6010-DELETE-SEL-QUEUE.                               21650099
216600                                                                  21660099
216700     SET ASC-UPDATE-TSQ        TO  TRUE.                          21670099
216800                                                                  21680099
216900     SET TR103-IDX             TO  1.                             21690099
217000     MOVE ZERO                 TO TR104-NUMBER-OF-TS-ITEMS.       21700099
217100     INITIALIZE TR103-SELECTED-ITEM-ARRAY.                        21710099
217200                                                                  21720099
217300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21730099
217400             VARYING PV-ITEM                                      21740099
217500             FROM 1 BY 1                                          21750099
217600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21760099
217700                                                                  21770099
217800     IF  TR103-IDX > 1                                            21780099
217900         PERFORM 5205-WRITE-SEL-QUEUE                             21790099
218000         ADD +1                TO TR104-NUMBER-OF-TS-ITEMS        21800099
218100     END-IF.                                                      21810099
218200                                                                  21820099
218300 EJECT                                                            21830099
218400*----------------------------------------------------------------*21840099
218500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21850099
218600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21860099
218700*----------------------------------------------------------------*21870099
218800 5100-WRITE-TEMP-STORAGE.                                         21880099
218900                                                                  21890099
219000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21900099
219100                                   TO PV-LIST-ITEM-NUMBER.        21910099
219200     COMPUTE PV-BLOCK-NUMBER =                                    21920099
219300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21930099
219400                                                                  21940099
219500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21950099
219600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21960099
219700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21970099
219800             PERFORM 5105-REWRITE-ASC-LISTQ                       21980099
219900         END-IF                                                   21990099
220000     ELSE                                                         22000099
220100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22010099
220200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22020099
220300         PERFORM 5110-WRITE-ASC-LISTQ                             22030099
220400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22040099
220500     END-IF.                                                      22050099
220600                                                                  22060099
220700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22070099
220800                                                                  22080099
220900 EJECT                                                            22090099
221000**--------------------------------------------------------------**22100099
221100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22110099
221200** SPECIFIC COMMAREA.                                           **22120099
221300**--------------------------------------------------------------**22130099
221400 5105-REWRITE-ASC-LISTQ.                                          22140099
221500                                                                  22150099
221600     EXEC CICS                                                    22160099
221700         WRITEQ TS                                                22170099
221800             QUEUE (ASC-LIST-QUEUE-NAME)                          22180099
221900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22190099
222000             ITEM  (PV-BLOCK-NUMBER)                              22200099
222100             REWRITE                                              22210099
222200             RESP  (PV-CICS-RESP)                                 22220099
222300     END-EXEC.                                                    22230099
222400                                                                  22240099
222500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22250099
222600         CONTINUE                                                 22260099
222700     ELSE                                                         22270099
222800         SET DP013-CICS-ABEND            TO TRUE                  22280099
222900         SET DP013-NO-ROLLBACK           TO TRUE                  22290099
223000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22300099
223100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22310099
223200                                         TO DP013-MESSAGE-TEXT(1) 22320099
223300         PERFORM DP013-0000-PROCESS-ABEND                         22330099
223400     END-IF.                                                      22340099
223500                                                                  22350099
223600 EJECT                                                            22360099
223700**--------------------------------------------------------------**22370099
223800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22380099
223900** SPECIFIC COMMAREA.                                           **22390099
224000**--------------------------------------------------------------**22400099
224100 5110-WRITE-ASC-LISTQ.                                            22410099
224200                                                                  22420099
224300     EXEC CICS                                                    22430099
224400         WRITEQ TS                                                22440099
224500             QUEUE (ASC-LIST-QUEUE-NAME)                          22450099
224600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22460099
224700             ITEM  (PV-BLOCK-NUMBER)                              22470099
224800             RESP  (PV-CICS-RESP)                                 22480099
224900     END-EXEC.                                                    22490099
225000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22500099
225100         SET DP013-CICS-ABEND      TO TRUE                        22510099
225200         SET DP013-NO-ROLLBACK     TO TRUE                        22520099
225300         MOVE '5110-WRITE-ASC-LISTQ'                              22530099
225400                                   TO DP013-PARAGRAPH             22540099
225500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22550099
225600                                   TO DP013-MESSAGE-TEXT(1)       22560099
225700         PERFORM DP013-0000-PROCESS-ABEND                         22570099
225800     END-IF.                                                      22580099
225900                                                                  22590099
226000 EJECT                                                            22600099
226100*----------------------------------------------------------------*22610099
226200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22620099
226300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22630099
226400*----------------------------------------------------------------*22640099
226500 5200-FILL-SEL-QUEUE-RECORD.                                      22650099
226600                                                                  22660099
226700     PERFORM 6112-READ-LIST-QUEUE.                                22670099
226800                                                                  22680099
226900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22690099
227000         PERFORM                                                  22700099
227100         VARYING LQW-IDX                                          22710099
227200         FROM 1 BY 1                                              22720099
227300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22730099
227400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22740099
227500                                                                  22750099
227600             IF  LQW-SELECT (LQW-IDX)                             22760099
227700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22770099
227800                                TO TR103-ITEM (TR103-IDX)         22780099
227900                 MOVE LQW-VSL-NAME (LQW-IDX)                      22790099
228000                                TO TR104-VSL-NAME                 22800099
228100                                   TR103-VSL-NAME                 22810099
228200                                       (TR103-IDX)                22820099
228300                 MOVE LQW-VOY-NBR (LQW-IDX)                       22830099
228400                                TO TR104-VOY-NBR                  22840099
228500                                   TR103-VOY-NBR                  22850099
228600                                       (TR103-IDX)                22860099
228700                 MOVE 'I'       TO TR103-ACTION-SW (TR103-IDX)    22870099
228800                 SET TR103-IDX UP BY 1                            22880099
228900                 IF  TR103-IDX > TR103-MAX-ITEMS                  22890099
229000                     PERFORM 5205-WRITE-SEL-QUEUE                 22900099
229100                     ADD +1        TO TR104-NUMBER-OF-TS-ITEMS    22910099
229200                     INITIALIZE TR103-SELECTED-ITEM-ARRAY         22920099
229300                     SET TR103-IDX TO  1                          22930099
229400                 END-IF                                           22940099
229500             END-IF                                               22950099
229600         END-PERFORM                                              22960099
229700     END-IF.                                                      22970099
229800                                                                  22980099
229900 EJECT                                                            22990099
230000*----------------------------------------------------------------*23000099
230100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23010099
230200*----------------------------------------------------------------*23020099
230300 5205-WRITE-SEL-QUEUE.                                            23030099
230400                                                                  23040099
230500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23050099
230600                                   TO TR103-SELECTED-ITEMS.       23060099
230700                                                                  23070099
230800     EXEC CICS                                                    23080099
230900          WRITEQ TS                                               23090099
231000              QUEUE (ASC-SEL-QUEUE-NAME)                          23100099
231100              FROM  (TR103-VESSEL-SEL-REC)                        23110099
231200              ITEM  (PV-SEL-QUEUE-ITEM)                           23120099
231300              RESP  (PV-CICS-RESP)                                23130099
231400     END-EXEC.                                                    23140099
231500                                                                  23150099
231600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23160099
231700         CONTINUE                                                 23170099
231800     ELSE                                                         23180099
231900         SET DP013-CICS-ABEND      TO TRUE                        23190099
232000         SET DP013-NO-ROLLBACK     TO TRUE                        23200099
232100         MOVE '5205-WRITE-SEL-QUEUE'                              23210099
232200                                   TO DP013-PARAGRAPH             23220099
232300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23230099
232400                                   TO DP013-MESSAGE-TEXT(1)       23240099
232500         PERFORM DP013-0000-PROCESS-ABEND                         23250099
232600     END-IF.                                                      23260099
232700                                                                  23270099
232800 EJECT                                                            23280099
232900**--------------------------------------------------------------**23290099
233000** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23300099
233100** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23310099
233200** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23320099
233300** THE USER.                                                    **23330099
233400**--------------------------------------------------------------**23340099
233500 6000-REFRESH-PANEL-FROM-TEMP.                                    23350099
233600                                                                  23360099
233700     IF  ASC-UPDATE-TSQ                                           23370099
233800         SET ASC-NO-TSQ-UPDATE TO TRUE                            23380099
233900         MOVE ZERO                 TO PV-SAVE-ITEM                23390099
234000                                      PV-SEL-QUEUE-ITEM           23400099
234100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23410099
234200                                   TO PV-HOLD-SELECTED-ITEMS      23420099
234300         MOVE +1                   TO PV-ITEMS-PROCESSED          23430099
234400         PERFORM 6100-UPDATE-TSQ                                  23440099
234500             UNTIL PV-ITEMS-PROCESSED >                           23450099
234600                                     PV-HOLD-SELECTED-ITEMS       23460099
234700         PERFORM 6010-DELETE-SEL-QUEUE                            23470099
234800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23480099
234900                    ASC-BLOCK-ENTRIES (2)                         23490099
235000     END-IF.                                                      23500099
235100                                                                  23510099
235200 EJECT                                                            23520099
235300*----------------------------------------------------------------*23530099
235400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23540099
235500*----------------------------------------------------------------*23550099
235600 6010-DELETE-SEL-QUEUE.                                           23560099
235700                                                                  23570099
235800     EXEC CICS                                                    23580099
235900         DELETEQ TS                                               23590099
236000             QUEUE (ASC-SEL-QUEUE-NAME)                           23600099
236100             RESP  (PV-CICS-RESP)                                 23610099
236200     END-EXEC.                                                    23620099
236300*                                                                 23630099
236400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23640099
236500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23650099
236600         CONTINUE                                                 23660099
236700     ELSE                                                         23670099
236800         SET DP013-CICS-ABEND TO TRUE                             23680099
236900         SET DP013-NO-ROLLBACK TO TRUE                            23690099
237000         MOVE '6010-DELETE-SEL-QUEUE'                             23700099
237100                        TO DP013-PARAGRAPH                        23710099
237200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23720099
237300                        TO DP013-MESSAGE-TEXT (1)                 23730099
237400         PERFORM DP013-0000-PROCESS-ABEND                         23740099
237500     END-IF.                                                      23750099
237600                                                                  23760099
237700 EJECT                                                            23770099
237800*----------------------------------------------------------------*23780099
237900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23790099
238000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23800099
238100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23810099
238200*    THE TEMP QUEUE.                                             *23820099
238300*----------------------------------------------------------------*23830099
238400 6100-UPDATE-TSQ.                                                 23840099
238500                                                                  23850099
238600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             23860099
238700     PERFORM 6105-READ-SEL-QUEUE.                                 23870099
238800     PERFORM                                                      23880099
238900         VARYING TR103-IDX                                        23890099
239000         FROM 1 BY 1                                              23900099
239100         UNTIL ((PV-ITEMS-PROCESSED >                             23910099
239200                              PV-HOLD-SELECTED-ITEMS)             23920099
239300         OR (TR103-IDX GREATER THAN TR103-MAX-ITEMS))             23930099
239400         IF  TR103-ACTION-SW (TR103-IDX) > SPACE                  23940099
239500             PERFORM 6110-PROCESS-ITEMS                           23950099
239600         END-IF                                                   23960099
239700         ADD +1                TO PV-ITEMS-PROCESSED              23970099
239800     END-PERFORM.                                                 23980099
239900     PERFORM 6111-WRITE-LIST-QUEUE.                               23990099
240000                                                                  24000099
240100 EJECT                                                            24010099
240200*----------------------------------------------------------------*24020099
240300*    READ THE LIST QUEUE RECORD.                                 *24030099
240400*----------------------------------------------------------------*24040099
240500 6105-READ-SEL-QUEUE.                                             24050099
240600                                                                  24060099
240700     EXEC CICS                                                    24070099
240800          READQ TS                                                24080099
240900              QUEUE (ASC-SEL-QUEUE-NAME)                          24090099
241000              INTO  (TR103-VESSEL-SEL-REC)                        24100099
241100              ITEM  (PV-SEL-QUEUE-ITEM)                           24110099
241200              RESP  (PV-CICS-RESP)                                24120099
241300     END-EXEC.                                                    24130099
241400*                                                                 24140099
241500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24150099
241600         CONTINUE                                                 24160099
241700     ELSE                                                         24170099
241800         SET DP013-CICS-ABEND      TO  TRUE                       24180099
241900         SET DP013-NO-ROLLBACK     TO  TRUE                       24190099
242000         MOVE '6105-READ-SEL-QUEUE'                               24200099
242100                                   TO  DP013-PARAGRAPH            24210099
242200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24220099
242300                                   TO  DP013-MESSAGE-TEXT(1)      24230099
242400         PERFORM DP013-0000-PROCESS-ABEND                         24240099
242500     END-IF.                                                      24250099
242600                                                                  24260099
242700 EJECT                                                            24270099
242800*----------------------------------------------------------------*24280099
242900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24290099
243000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24300099
243100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24310099
243200*----------------------------------------------------------------*24320099
243300 6110-PROCESS-ITEMS.                                              24330099
243400                                                                  24340099
243500     COMPUTE PV-ITEM = 1 + ((TR103-ITEM (TR103-IDX) - 1)          24350099
243600                     / PC-ITEMS-PER-PANEL).                       24360099
243700                                                                  24370099
243800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24380099
243900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24390099
244000             PERFORM 6111-WRITE-LIST-QUEUE                        24400099
244100         END-IF                                                   24410099
244200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24420099
244300                                                                  24430099
244400         PERFORM 6112-READ-LIST-QUEUE                             24440099
244500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24450099
244600             CONTINUE                                             24460099
244700         END-IF                                                   24470099
244800     END-IF.                                                      24480099
244900                                                                  24490099
245000     COMPUTE PV-SUB = (TR103-ITEM (TR103-IDX)                     24500099
245100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24510099
245200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24520099
245300     MOVE LQW-SELECTED-SW (PV-SUB)                                24530099
245400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24540099
245500                                                                  24550099
245600     IF TR103-INQ (TR103-IDX)                                     24560099
245700        MOVE PC-INQ      TO LQW-ACTION (PV-SUB)                   24570099
245800     END-IF.                                                      24580099
245900                                                                  24590099
246000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24600099
246100                                                                  24610099
246200 EJECT                                                            24620099
246300*----------------------------------------------------------------*24630099
246400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24640099
246500*----------------------------------------------------------------*24650099
246600 6111-WRITE-LIST-QUEUE.                                           24660099
246700                                                                  24670099
246800     EXEC CICS                                                    24680099
246900         WRITEQ TS                                                24690099
247000             QUEUE (ASC-LIST-QUEUE-NAME)                          24700099
247100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24710099
247200             ITEM  (PV-SAVE-ITEM)                                 24720099
247300             REWRITE                                              24730099
247400             RESP  (PV-CICS-RESP)                                 24740099
247500     END-EXEC.                                                    24750099
247600*                                                                 24760099
247700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24770099
247800         CONTINUE                                                 24780099
247900     ELSE                                                         24790099
248000         SET DP013-CICS-ABEND  TO  TRUE                           24800099
248100         SET DP013-NO-ROLLBACK TO  TRUE                           24810099
248200         MOVE '6111-WRITE-LIST-QUEUE'                             24820099
248300                               TO  DP013-PARAGRAPH                24830099
248400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24840099
248500                               TO  DP013-MESSAGE-TEXT(1)          24850099
248600         PERFORM DP013-0000-PROCESS-ABEND                         24860099
248700     END-IF.                                                      24870099
248800                                                                  24880099
248900 EJECT                                                            24890099
249000*----------------------------------------------------------------*24900099
249100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24910099
249200*----------------------------------------------------------------*24920099
249300 6112-READ-LIST-QUEUE.                                            24930099
249400                                                                  24940099
249500     EXEC CICS                                                    24950099
249600         READQ TS                                                 24960099
249700             QUEUE (ASC-LIST-QUEUE-NAME)                          24970099
249800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24980099
249900             ITEM  (PV-ITEM)                                      24990099
250000             RESP  (PV-CICS-RESP)                                 25000099
250100     END-EXEC.                                                    25010099
250200*                                                                 25020099
250300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25030099
250400         CONTINUE                                                 25040099
250500     ELSE                                                         25050099
250600         SET DP013-CICS-ABEND        TO TRUE                      25060099
250700         SET DP013-NO-ROLLBACK       TO TRUE                      25070099
250800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25080099
250900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25090099
251000                                     TO DP013-MESSAGE-TEXT(1)     25100099
251100         PERFORM DP013-0000-PROCESS-ABEND                         25110099
251200     END-IF.                                                      25120099
251300                                                                  25130099
251400 EJECT                                                            25140099
251500*----------------------------------------------------------------*25150099
251600*    ABEND PROCESSOR MODULE                                      *25160099
251700*----------------------------------------------------------------*25170099
251800                                                                  25180099
251900     COPY DPPD013.                                                25190099
