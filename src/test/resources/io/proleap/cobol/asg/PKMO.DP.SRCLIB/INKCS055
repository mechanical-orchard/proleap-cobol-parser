       IDENTIFICATION DIVISION.                                         INKCS055
00004  PROGRAM-ID.    INKCS055.                                         INKCS055
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          INKCS055
00007  DATE-WRITTEN.  04-26-2002.                                       INKCS055
00008  DATE-COMPILED.                                                   INKCS055
00009                                                                   INKCS055
00010 ***************************************************************** INKCS055
00055 *    I055 - PI PHYSICAL INVENTORY ADJUSTMENT LIST               * INKCS055
00012 *                                                               * INKCS055
00013 *    THIS PROGRAM GENERATES A LIST OF THE SKUS FOR THE REQUESTED* INKCS055
00014 *    STORE/AREA.  QUANTITY, PRICE, AND EXTENDED PRICE ARE THE   * INKCS055
00015 *    FIELDS THAT ARE DISPLAYED.  THE USER CAN SELECT ONE OR     * INKCS055
00016 *    MORE SKUS FOR PROCESSING IN INKCS056.                      * INKCS055
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
W23511* W23511   04-25-2002  PHYS INV TOP EXCEPTION RPT ENHANCEMENT             
W23511*                      (CREATION) -ROD JANSSEN                            
W21732* W21732   11-27-2002  TO DISPLAY 8 DIGIT NON-INTELLIGENT SKU             
W21732*                      INSTAED OF DEPT, CLASS AND SEQ NBR.                
W21732*                      CHANGED BY : IGSI                                  
W25428* W25428   11-14-2003  INCORPORATE UPC INTO INVENTORY DB2 TABLES.         
W25428*                      ACCUMULATE ROWS WITH THE SAME SKU/RETAIL           
W25428*                      AND CONTINUE TO DISPLAY 1 ROW FOR SKU/RTL.         
P25428* P25428   12-05-2003  ALLOW PRINT FUNCTIONALITY                          
W26600* W26600   07-27-2004  STORE NUMBER EXPANSION CHANGES.                    
W26600*                      -SCOTT JACKSON                                     
W30692* W30692   02-01-2006  DEFINE THE DEFAULT PRINTER FOR THE USER.           
W30692*                      -ROD JANSSEN                                       
00010 ***************************************************************** INKCS055
263126* CHANGED 10/26/2021    BY JIM HUNTER      WR: CHG0263126                 
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263126* MAKING THE CALL DYNAMIC VS STATIC.                                      
00010 ***************************************************************** INKCS055
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
1122RM* THE CICS ARCHITECTURE API.                                              
      *----------------------------------------------------------------*        
00019                                                                   INKCS055
00020  ENVIRONMENT DIVISION.                                            INKCS055
00022  DATA DIVISION.                                                   INKCS055
00023                                                                   INKCS055
00010 /**************************************************************** INKCS055
00024  WORKING-STORAGE SECTION.                                         INKCS055
00010 ***************************************************************** INKCS055
00025                                                                   INKCS055
P25428                                                                  INKCS046
P25428 01  TD-TRANSIENT-DATA-AREA.                                              
P25428     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.               
P25428     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4                    
P25428                                 COMP SYNC.                               
P25428     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.               
P25428     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80                   
P25428                                 COMP SYNC.                               
P25428                                                                          
P25428 01  JL-JCL-WORK-AREA.                                            INKCS046
P25428     05  JL-JCL-INK950-LINE-1.                                            
P25428         10  FILLER                     PIC X(02)    VALUE '//'.          
P25428         10  JL-JCL-INK950-JOBNAME      PIC X(08)    VALUE SPACES.        
P25428         10  FILLER REDEFINES JL-JCL-INK950-JOBNAME.                      
P25428             15  FILLER                 PIC X(07).                        
P25428             15  JL-JCL-INK950-JOB-UNQ  PIC X(01).                        
P25428         10  FILLER                     PIC X(11)    VALUE                
P25428             ' JOB KOHLS,'.                                               
P25428         10  FILLER                     PIC X(01)    VALUE QUOTE.         
P25428         10  FILLER                     PIC X(18)    VALUE                
P25428             'INV ADJUST DTL RPT'.                                        
P25428         10  FILLER                     PIC X(01)    VALUE QUOTE.         
P25428         10  FILLER                     PIC X(01)    VALUE ','.           
P25428     05  JL-JCL-INK950-LINE-2.                                            
P25428         10  FILLER                     PIC X(21)    VALUE                
P25428             '//             CLASS='.                                     
P25428         10  JL-JCL-INK950-JOBCLASS     PIC X(01)    VALUE 'Q'.           
P25428         10  FILLER                     PIC X(10)    VALUE                
P25428             ',MSGCLASS='.                                                
P25428         10  JL-JCL-INK950-MSGCLASS     PIC X(01)    VALUE 'P'.           
P25428         10  JL-JCL-INK950-NOTIFY-OPT   PIC X(16)    VALUE SPACES.        
P25428     05  JL-JCL-INK950-LINE-3.                                            
P25428         10  FILLER                     PIC X(13)    VALUE                
P25428             '/*JOBPARM K=0'.                                             
P25428     05  JL-JCL-INK950-CMT-SHORT.                                         
P25428         10  FILLER                     PIC X(03)    VALUE '//*'.         
P25428     05  JL-JCL-INK950-CMT-LONG.                                          
P25428         10  FILLER                     PIC X(40)    VALUE                
P25428             '//**************************************'.          ********
P25428         10  FILLER                     PIC X(32)    VALUE                
P25428             '********************************'.                  ********
P25428     05  JL-JCL-INK950-CMT-USER-INFO.                                     
P25428         10  FILLER                     PIC X(26)    VALUE                
P25428             '//* INK950 - SUBMITTED BY '.                                
P25428         10  JL-JCL-INK950-CMT-USRID    PIC X(08)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(06)    VALUE                
P25428             ' FROM '.                                                    
P25428         10  JL-JCL-INK950-CMT-REGION   PIC X(08)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(04)    VALUE                
P25428             ' ON '.                                                      
P25428         10  JL-JCL-INK950-CMT-SUBDATE  PIC X(10)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(02)    VALUE SPACES.        
P25428         10  JL-JCL-INK950-CMT-SUBTIME  PIC X(08)    VALUE SPACES.        
P25428     05  JL-JCL-INK950-CMT-1.                                             
P25428         10  FILLER                     PIC X(40)    VALUE                
P25428             '//* THIS JOB PRODUCES A DETAILED REPORT '.          ********
P25428         10  FILLER                     PIC X(32)    VALUE                
P25428             'OF SKU / UPC ADJUSTMENTS        '.                  ********
P25428     05  JL-JCL-INK950-CMT-2.                                             
P25428         10  FILLER                     PIC X(40)    VALUE                
P25428             '//* REPORT AND PRINT THEM AT THE USER DE'.          ********
P25428         10  FILLER                     PIC X(32)    VALUE                
P25428             'FAULT PRINT DESTINATION OR      '.                  ********
P25428     05  JL-JCL-INK950-CMT-3.                                             
P25428         10  FILLER                     PIC X(40)    VALUE                
P25428             '//* LOCAL, IF THERE IS NO DEFAULT PRINTE'.          ********
P25428         10  FILLER                     PIC X(32)    VALUE                
P25428             'R DEFINED TO THE USER.          '.                  ********
P25428     05  JL-JCL-INK950-CMT-4.                                             
P25428         10  FILLER                     PIC X(22)    VALUE                
P25428             '//* OPTION REQUESTED: '.                            ********
P25428         10  JL-JCL-INK950-CMT-OPTION   PIC X(35)    VALUE SPACES.        
P25428     05  JL-JCL-INK950-LINE-10.                                           
P25428         10  FILLER                     PIC X(39)    VALUE                
P25428             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.                   
P25428     05  JL-JCL-INK950-LINE-11.                                           
P25428         10  FILLER                     PIC X(03)    VALUE                
P25428             '//*'.                                                       
P25428     05  JL-JCL-INK950-LINE-12.                                           
P25428         10  FILLER                     PIC X(32)    VALUE                
P25428             '//PS020    EXEC INK9501,PRTDEST='.                          
P25428         10  JL-JCL-INK950-PRTDEST      PIC X(08)    VALUE                
P25428             'LOCAL'.                                                     
P25428     05  JL-JCL-INK950-LINE-13.                                           
P25428         10  FILLER                     PIC X(20)    VALUE                
P25428             '//S010.SYSUT1   DD *'.                                      
P25428     05  JL-JCL-INK950-LINE-14.                                           
W30692         10  JL-JCL-INK950-REQ-OPTION   PIC X(56).                        
P25428     05  JL-JCL-INK950-LINE-EOD.                                          
P25428         10  FILLER                     PIC X(02)    VALUE '/*'.          
P25428     05  JL-JCL-INK950-LINE-EOF.                                          
P25428         10  FILLER                     PIC X(05)    VALUE                
P25428             '/*EOF'.                                                     
P25428     05  JL-JCL-TEST-LINE-10.                                             
P25428         10  FILLER                     PIC X(35)    VALUE                
P25428             '//PROCS  JCLLIB ORDER=(TKMA.PROCLIB'.                       
P25428         10  FILLER                     PIC X(20)    VALUE                
P25428             ',QKMO.PROCLIB.STAGE)'.                                      
P25428     05  JL-JCL-TEST-LINE-11A.                                            
P25428         10  FILLER                     PIC X(39)    VALUE                
P25428             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.                   
P25428     05  JL-JCL-TEST-LINE-11B.                                            
P25428         10  FILLER                     PIC X(39)    VALUE                
P25428             '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.                   
P25428     05  JL-JCL-TEST-LINE-11C.                                            
P25428         10  FILLER                     PIC X(39)    VALUE                
P25428             '//         DD DSN=PKMO.LOADLIB,DISP=SHR'.                   
P25428     05  JL-JCL-TEST-NOTIFY.                                              
P25428         10  FILLER                     PIC X(08)    VALUE                
P25428             ',NOTIFY='.                                                  
P25428         10  JL-JCL-TEST-USER           PIC X(08)    VALUE SPACES.        
P25428     05  JL-JCL-INK950-CC-INFO.                                           
P25428         10  FILLER                     PIC X(03)    VALUE                
P25428             'SKU'.                                                       
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.        
P25428         10  JL-JCL-INK950-STR-NBR.                                       
P25428*            15  FILLER                 PIC X(01)    VALUE '0'.           
P25428*            15  JL-JCL-INK950-STORE    PIC X(03)    VALUE SPACES.        
W26600             15  JL-JCL-INK950-STORE    PIC X(04)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.        
P25428         10  JL-JCL-INK950-AREA         PIC X(07)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.        
P25428         10  JL-JCL-INK950-SKU          PIC X(08)    VALUE SPACES.        
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.        
W30692         10  JL-JCL-INK950-RETAIL       PIC X(09)    VALUE SPACES.        
P25428                                                                  INKCS011
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.        
W26600         10  JL-JCL-INK950-USERID       PIC X(07)    VALUE SPACES.        
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.        
W26600         10  JL-JCL-INK950-PRT-IND      PIC X(01)    VALUE SPACES.        
W28545         10  FILLER                     PIC X(01)    VALUE SPACES.        
W28545         10  JL-JCL-DB2-ACTL-INV-DTE    PIC X(10)    VALUE SPACES.        
W26600                                                                          
W25428 01  PA-PROGRAM-ACCUMULATOR.                                      INKCS011
W25428     05  PA-ACCUM-SKU          PIC  S9(8)V     COMP-3 VALUE +0.   INKCS011
W25428     05  PA-ACCUM-UPC          PIC  S9(15)V    COMP-3 VALUE +0.   INKCS011
W25428     05  PA-ACCUM-QTY          PIC  S9(8)V     COMP-3 VALUE +0.   INKCS011
W25428     05  PA-ACCUM-RTL          PIC  S9(5)V99   COMP-3 VALUE +0.   INKCS011
W25428     05  PA-ACCUM-EXTD-RTL     PIC  S9(8)V99   COMP-3 VALUE +0.   INKCS011
W25428                                                                  INKCS011
00026  01  PC-PROGRAM-CONSTANTS.                                        INKCS055
00027      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         INKCS055
00028                                                     'IN055A  '.   INKCS055
00029      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         INKCS055
00030                                                     'INKM055 '.   INKCS055
00031      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         INKCS055
00032                                                     'INKCS055'.   INKCS055
00033      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      INKCS055
00034      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      INKCS055
00035      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    INKCS055
00036      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     INKCS055
00037                                                     COMP SYNC.    INKCS055
00038      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      INKCS055
00039                                                     COMP SYNC.    INKCS055
00040      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         INKCS055
00041                                                     +1000000      INKCS055
00042                                                     COMP-3.       INKCS055
00043      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      INKCS055
00044                                                     COMP SYNC.    INKCS055
00045      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       INKCS055
00046                                                     COMP-3.       INKCS055
00047      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  INKCS055
00048      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  INKCS055
00049      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  INKCS055
00050      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  INKCS055
00051      05  PC-Y                           PIC  X(01)  VALUE 'Y'.    INKCS055
00052      05  PC-CORPORATE                   PIC  X(02)  VALUE 'HQ'.   INKCS055
00053      05  PC-COMPLETE                    PIC  X(08)  VALUE         INKCS055
00054                                                    'COMPLETE'.    INKCS055
W21015     05  PC-ADJ-MESSAGE.                                          INKCS055
W21015         10  PC-ADJ-MSG1                PIC  X(10)  VALUE                 
W21015                                                   'ADJUSTMENT'.          
W21015         10  PC-ADJ-MSG2                PIC  X(10)  VALUE                 
W21015                                                   'ADJ ADD   '.          
W21015         10  PC-NO-ADJ-MSG              PIC  X(10)  VALUE         INKCS055
W21015                                                   '          '.          
00055      05  PC-TOTAL                       PIC  X(03)  VALUE 'TTL'.  INKCS055
00057      05  PC-TSYMSG-NUMBERS.                                       INKCS055
00058          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  INKCS055
00059          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  INKCS055
00060          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  INKCS055
00061          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  INKCS055
00062          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  INKCS055
00063          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  INKCS055
00064          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  INKCS055
00065          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  INKCS055
00066          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  INKCS055
00067          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  INKCS055
00068          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  INKCS055
W25428         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  INKCS011
00069          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  INKCS055
00070          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  INKCS055
00071          10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  INKCS055
00071          10  PC-TSYMSG-01714            PIC  9(05)  VALUE 01714.  INKCS055
00072          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  INKCS055
00073 *                                                                 INKCS055
00074  01  PS-PROGRAM-SWITCHES.                                         INKCS055
00075      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    INKCS055
00076          88  PS-NO-ERROR                            VALUE 'Y'.    INKCS055
00077          88  PS-ERROR                               VALUE 'N'.    INKCS055
R25428     05  PS-PROCESSED-SW                PIC  X(01)  VALUE 'N'.    INKCS011
R25428         88  RECORD-PROCESSED                       VALUE 'Y'.    INKCS011
00078      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    INKCS055
00079          88  PS-COMMAREA-VALID                      VALUE 'Y'.    INKCS055
00080          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    INKCS055
00081      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    INKCS055
00082          88  PS-DONE                                VALUE 'Y'.    INKCS055
00083          88  PS-NOT-DONE                            VALUE 'N'.    INKCS055
00084      05  PS-STORE-REC-SW                PIC  X(01)  VALUE 'N'.    INKCS055
00085          88  PS-STORE-REC                           VALUE 'Y'.    INKCS055
00086          88  PS-NO-STORE-REC                        VALUE 'N'.    INKCS055
W25428     05  PS-DUPLICATE-RECORD-SW         PIC  X(01)  VALUE 'N'.    INKCS011
W25428         88  PS-END-OF-DUP-CHECK                    VALUE 'Y'.    INKCS011
W25428         88  PS-DUPLICATE-KEY                       VALUE 'N'.    INKCS011
W25428     05  PS-INTERNAL-READER-ENQ-DEQ-IND PIC X(1)    VALUE 'D'.            
W25428         88  PS-INTERNAL-READER-ENQUEUED            VALUE 'E'.            
W25428         88  PS-INTERNAL-READER-DEQUEUED            VALUE 'D'.            
00087 *                                                                 INKCS055
00088  01  PV-PROGRAM-VARIABLES.                                        INKCS055
00089      05  PV-SUB                         PIC S9(04)  VALUE +0      INKCS055
00090                                                     COMP SYNC.    INKCS055
00091      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      INKCS055
00092                                                     COMP SYNC.    INKCS055
00093      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      INKCS055
00094                                                     COMP-3.       INKCS055
00095      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      INKCS055
00096                                                     COMP-3.       INKCS055
00097      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      INKCS055
00098                                                     COMP-3.       INKCS055
00099      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      INKCS055
00100                                                     COMP-3.       INKCS055
00101      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      INKCS055
00102                                                     COMP-3.       INKCS055
00103      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      INKCS055
00104                                                     COMP-3.       INKCS055
00105      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      INKCS055
00106                                                     COMP-3.       INKCS055
00107      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      INKCS055
00108                                                     COMP SYNC.    INKCS055
00109      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      INKCS055
00550                                                     COMP SYNC.    INKCS055
00551      05  PV-ITEM                        PIC S9(04)  VALUE +0      INKCS055
00552                                                     COMP SYNC.    INKCS055
00553      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      INKCS055
00554                                                     COMP SYNC.    INKCS055
00555      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      INKCS055
00556                                                     COMP SYNC.    INKCS055
00557      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      INKCS055
00558                                                     COMP SYNC.    INKCS055
00559      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      INKCS055
00120                                                     COMP SYNC.    INKCS055
00121      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      INKCS055
00122                                                     COMP SYNC.    INKCS055
00123      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      INKCS055
00124                                                     COMP SYNC.    INKCS055
00125      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      INKCS055
00126                                                     COMP SYNC.    INKCS055
00127      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      INKCS055
00128                                                     COMP SYNC.    INKCS055
00129      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      INKCS055
00130                                                     COMP SYNC.    INKCS055
00131      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      INKCS055
00132                                                     COMP SYNC.    INKCS055
00133      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      INKCS055
00134                                                     COMP SYNC.    INKCS055
P0133      05  PV-INV-QTY-TTL                 PIC S9(08)  VALUE +0      INKCS055
P0134                                                     COMP SYNC.    INKCS055
W21015     05  PV-PR-EXT-AMT-TTL              PIC S9(12)V99 VALUE +0    INKCS055
P0134                                                     COMP-3.       INKCS055
00135      05  PV-START-ITEM-REQUEST          PIC  X(05).               INKCS055
00136      05  PV-ROW-TYPE                    PIC  X(03).               INKCS055
00137          88  PV-TSUMINV-ROW                         VALUE 'SUM'.  INKCS055
00138          88  PV-TADJADD                             VALUE 'ADJ'.  INKCS055
W21015         88  PV-TADJDTL                             VALUE 'DTL'.  INKCS055
00139                                                                   INKCS055
W21015     05  PV-TADJDTL-ROW.                                          INKCS055
W21732         10  PV-TADJDTL-SKU-NBR         PIC X(08)   VALUE SPACES. INKCS055
W21015         10  PV-TADJDTL-PR-AMT          PIC S9(07)V99  COMP-3     INKCS055
W21015                                                    VALUE +0.     INKCS055
W25428     05  PV-SKU                         PIC 9(08).                        
W25428     05  PV-PREVIOUS-KEY.                                         INKCS011
W25428         10  PV-PREV-SKU-NBR            PIC  S9(8)V     COMP-3.   INKCS011
W25428         10  PV-PREV-UPC-NBR            PIC  S9(15)V    COMP-3.   INKCS011
W25428         10  PV-PREV-UNIT-RETAIL        PIC  S9(5)V9(2) COMP-3.   INKCS011
W25428         10  PV-PREV-SOURCE-TABLE       PIC  X(3)   VALUE SPACES. INKCS011
W25428                                                                  INKCS011
W25428     05  PV-CURRENT-KEY.                                          INKCS011
W25428         10  PV-CURR-SKU-NBR            PIC  S9(8)V     COMP-3.   INKCS011
W25428         10  PV-CURR-UPC-NBR            PIC  S9(15)V    COMP-3.   INKCS011
W25428         10  PV-CURR-UNIT-RETAIL        PIC  S9(5)V9(2) COMP-3.   INKCS011
W25428         10  PV-CURR-SOURCE-TABLE       PIC  X(3)   VALUE SPACES. INKCS011
W25428                                                                  INKCS011
W25428     05  PV-KEY-RECORD.                                           INKCS011
W25428         10 PV-KEY-SKU           PIC  S9(8)V     COMP-3 VALUE +0. INKCS011
W25428         10 PV-KEY-UPC           PIC  S9(15)V    COMP-3 VALUE +0. INKCS011
W25428         10 PV-KEY-QTY           PIC  S9(5)V     COMP-3 VALUE +0. INKCS011
W25428         10 PV-KEY-RTL           PIC  S9(5)V9(2) COMP-3 VALUE +0. INKCS011
W25428         10 PV-KEY-EXTD-RTL      PIC  S9(8)V9(2) COMP-3 VALUE +0. INKCS011
W25428                                                                  INKCS011
W25428     05  PV-HOLD-DMS.                                             INKCS011
W25428         10  PV-DMS-DEPT                PIC X(03).                INKCS011
W25428         10  FILLER                     PIC X(01)   VALUE '-'.    INKCS011
W25428         10  PV-DMS-MCL                 PIC X(03).                INKCS011
W25428         10  FILLER                     PIC X(01)   VALUE '-'.    INKCS011
W25428         10  PV-DMS-SCL                 PIC X(03).                INKCS011
W25428                                                                  INKCS011
W25428     05  PV-HOLD-SKU                    PIC 9(08)   VALUE ZEROES. INKCS011
W25428     05  PV-HOLD-DEPT                   PIC 9(03)   VALUE  0.     INKCS011
W25428     05  PV-HOLD-MCL                    PIC 9(03)   VALUE  0.     INKCS011
W25428     05  PV-HOLD-SCL                    PIC 9(03)   VALUE  0.     INKCS011
W25428                                                                  INKCS011
W25428     05  PV-HOLD-TEMP-MCL.                                        INKCS011
W25428         10 FILLER                      PIC 9(02)   VALUE ZEROES. INKCS011
W25428         10 PV-HOLD-MCL-HLQ             PIC 9(01)   VALUE ZEROES. INKCS011
W25428         10 FILLER                      PIC 9(01)   VALUE ZEROES. INKCS011
W25428     05  PV-MAJOR-CLASS                 PIC 9(04)   VALUE ZEROES. INKCS011
P25428     05  PV-CICS-ID.                                                      
P25428         10  PV-FIRST-4              PIC X(4)       VALUE SPACES.         
P25428         10  PV-CICS-REGION-TYPE     PIC X          VALUE SPACE.          
P25428             88  PV-CICS-REGION-PRODUCTION          VALUE 'P'.            
P25428             88  PV-CICS-REGION-ACCEPTANCE          VALUE 'A'.            
P25428             88  PV-CICS-REGION-QUALITY             VALUE 'Q'.            
P25428             88  PV-CICS-REGION-LEARNING            VALUE 'L'.            
P25428             88  PV-CICS-REGION-TEST                VALUE 'T'.            
P25428             88  PV-CICS-REGION-SYSTEST             VALUE 'S'.            
P25428         10  PV-CICS-REGION-CODE     PIC X          VALUE SPACES.         
P25428         10  PV-LAST-2               PIC X(2)       VALUE SPACES.         
                                                                                
W30692     05  PV-EDIT-LOC-NBR           PIC 9(04)  VALUE ZEROS.        INKCS011
W30692     05  PV-EDIT-LOC-NBR-RED REDEFINES                            INKCS011
W30692         PV-EDIT-LOC-NBR.                                         INKCS011
W30692         10  PV-EDIT-LOC-NBR-P1    PIC 9(01).                     INKCS011
W30692         10  PV-EDIT-LOC-NBR-P2    PIC 9(03).                     INKCS011
W30692     05  PV-USER-USER-CODE         PIC X(08)  VALUE SPACES.       INKCS011
W30692                                                                          
00145  01  LQW-LIST-QUEUE-WORK-AREA.                                    INKCS055
00146      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  INKCS055
00147      05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           INKCS055
00148                                         INDEXED BY LQW-IDX.       INKCS055
00149          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       INKCS055
00150          10  LQW-TEMP-SELECTED-SW       PIC  X(01).               INKCS055
00151          10  LQW-SELECTED-SW            PIC  X(01).               INKCS055
00152              88  LQW-SELECT                         VALUE 'S'.    INKCS055
00153              88  LQW-DESELECT                       VALUE ' '.    INKCS055
00154          10  LQW-ACTION                 PIC  X(03).               INKCS055
W25428         10  LQW-DMS                    PIC  X(11).               INKCS011
W25428         10  LQW-KEY.                                             INKCS011
W25428             15  LQW-UPC                PIC  9(07)  VALUE ZEROES. INKCS011
W25428             15  LQW-SKU                PIC  9(08)  VALUE ZEROES. INKCS011
W25428         10  LQW-INV-QTY                PIC S9(06)        COMP.   INKCS011
00158***       10  LQW-INV-QTY                PIC S9(08)        COMP.   INKCS055
00159          10  LQW-PR-AMT                 PIC S9(07)V99     COMP-3. INKCS055
00160          10  LQW-PR-EXT-AMT             PIC S9(09)V99     COMP-3. INKCS055
00161          10  LQW-COLOR                  PIC X.                    INKCS055
00162                                                                   INKCS055
00168      COPY INWS012.                                                INKCS055
00169                                                                   INKCS055
00175      COPY INKM055.                                                INKCS055
                                                                        INKCS055
00177  01  MR-OCCURS-LAYOUT                   REDEFINES  IN055AO.       INKCS055
00178 *    05  FILLER                         PIC X(84).                INKCS055
W26600     05  FILLER                         PIC X(93).                INKCS055
00179      05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          INKCS055
00180          10  MR-SELECTL                 PIC S9(04) COMP.          INKCS055
00181          10  MR-SELECTA                 PIC  X(01).               INKCS055
00182          10  MR-SELECTC                 PIC  X(01).               INKCS055
00183          10  MR-SELECTH                 PIC  X(01).               INKCS055
00184          10  MR-SELECTI                 PIC  X(01).               INKCS055
00185                                                                   INKCS055
00186          10  MR-ACTIONL                 PIC S9(04) COMP.          INKCS055
00187          10  MR-ACTIONA                 PIC  X(01).               INKCS055
00188          10  MR-ACTIONC                 PIC  X(01).               INKCS055
00189          10  MR-ACTIONH                 PIC  X(01).               INKCS055
00190          10  MR-ACTION                  PIC  X(03).               INKCS055
00191                                                                   INKCS055
W25248         10  MR-DMSL                    PIC S9(04) COMP.          INKCS011
W25248         10  MR-DMSA                    PIC  X(01).               INKCS011
W25248         10  MR-DMSC                    PIC  X(01).               INKCS011
W25248         10  MR-DMSH                    PIC  X(01).               INKCS011
W25248         10  MR-DMS                     PIC  X(11).               INKCS011
W25248                                                                  INKCS011
W21732         10  MR-SKUL                    PIC S9(04) COMP.          INKCS055
W21732         10  MR-SKUA                    PIC  X(01).               INKCS055
W21732         10  MR-SKUC                    PIC  X(01).               INKCS055
W21732         10  MR-SKUH                    PIC  X(01).               INKCS055
W21732         10  MR-SKU                     PIC  X(08).               INKCS055
00209                                                                   INKCS055
00210          10  MR-INV-QTYL                PIC S9(04) COMP.          INKCS055
00211          10  MR-INV-QTYA                PIC  X(01).               INKCS055
00212          10  MR-INV-QTYC                PIC  X(01).               INKCS055
00213          10  MR-INV-QTYH                PIC  X(01).               INKCS055
00214          10  MR-INV-QTY-X.                                        INKCS055
00215 ***          15  MR-INV-QTY             PIC  -(6)9.               INKCS055
W25428             15  MR-INV-QTY             PIC  -(5)9.               INKCS055
00216                                                                   INKCS055
00217          10  MR-PR-AMTL                 PIC S9(04) COMP.          INKCS055
00218          10  MR-PR-AMTA                 PIC  X(01).               INKCS055
00219          10  MR-PR-AMTC                 PIC  X(01).               INKCS055
00220          10  MR-PR-AMTH                 PIC  X(01).               INKCS055
00221          10  MR-PR-AMT-X.                                         INKCS055
00222              15  MR-PR-AMT              PIC  Z(7).99.             INKCS055
00223                                                                   INKCS055
00224          10  MR-PR-EXT-AMTL             PIC S9(04) COMP.          INKCS055
00225          10  MR-PR-EXT-AMTA             PIC  X(01).               INKCS055
00226          10  MR-PR-EXT-AMTC             PIC  X(01).               INKCS055
00227          10  MR-PR-EXT-AMTH             PIC  X(01).               INKCS055
00228          10  MR-PR-EXT-AMT-X.                                     INKCS055
00229**            15  MR-PR-EXT-AMT          PIC  -(10).99.            INKCS055
W25428             15  MR-PR-EXT-AMT          PIC  -(9).99.             INKCS055
00230                                                                   INKCS055
00231          10  MR-ADJ-MSGL                PIC S9(04) COMP.          INKCS055
00232          10  MR-ADJ-MSGA                PIC  X(01).               INKCS055
00233          10  MR-ADJ-MSGC                PIC  X(01).               INKCS055
00234          10  MR-ADJ-MSGH                PIC  X(01).               INKCS055
00235          10  MR-ADJ-MSG                 PIC  X(10).               INKCS055
00236                                                                   INKCS055
W30692     COPY DPWS026.                                                        
W30692                                                                  INKCS055
00242      COPY DPWS015.                                                INKCS055
00243                                                                   INKCS055
00248      COPY DPWS016.                                                INKCS055
00249                                                                   INKCS055
00254      COPY DPWS010I.                                               INKCS055
                                                                        INKCS055
00260      COPY DPWS030.                                                INKCS055
1122RM     COPY DPWS930.                                                INKCS055
                                                                        INKCS055
00266      COPY DPWS020.                                                INKCS055
00267      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                INKCS055
00268                                                                   INKCS055
00269          10  INTER-APPL-COMM-AREA       PIC X(200).               INKCS055
                                                                                
00270      COPY INWS001.                                                INKCS055
00274          10  ASC-SPECIFIC-COMMAREA.                               INKCS055
00275              15  ASC-LIST-KEYS.                                   INKCS055
00276 *                20  ASC-KEY-STORE-NBR               PIC  X(03).  INKCS055
W26600                 20  ASC-KEY-STORE-NBR               PIC  9(04).  INKCS055
00277                  20  ASC-KEY-AREA-NBR                PIC S9(08)   INKCS055
00278                                                      COMP.        INKCS055
00279              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                INKCS055
00280                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  INKCS055
00281                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   INKCS055
00282                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   INKCS055
00283                                                                   INKCS055
00284                  20  ASC-ITEM-ARRAY.                              INKCS055
00285                      25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        INKCS055
00286                          30  ASC-LIST-ITEM-NUMBER                 INKCS055
00287                                                      PIC S9(09)   INKCS055
00288                                                      COMP-3.      INKCS055
00289                          30  ASC-TEMP-SELECTED-SW    PIC  X(01).  INKCS055
00290                              88  ASC-TEMP-NO-SELECT  VALUE ' '.   INKCS055
00291                              88  ASC-TEMP-SELECT     VALUE 'S'.   INKCS055
00292                              88  ASC-TEMP-BEGIN      VALUE 'B'.   INKCS055
00293                              88  ASC-TEMP-END        VALUE 'E'.   INKCS055
00294                          30  ASC-SELECTED-SW         PIC  X(01).  INKCS055
00295                              88  ASC-NO-SELECT       VALUE ' '.   INKCS055
00296                              88  ASC-SELECT          VALUE 'S'.   INKCS055
00297                              88  ASC-BEGIN           VALUE 'B'.   INKCS055
00298                              88  ASC-END             VALUE 'E'.   INKCS055
00299                          30  ASC-ACTION              PIC  X(03).  INKCS055
W25428                         30  ASC-DMS                 PIC  X(11).  INKCS011
W25428                         30  ASC-KEY-NUMBER.                      INKCS011
W25428                             35  ASC-KEY-UPC         PIC 9(07).   INKCS011
W25428                             35  ASC-SKU             PIC 9(08).   INKCS011
W26600                             35  ASC-SKU-X    REDEFINES           INKCS011
W26600                                 ASC-SKU             PIC X(08).   INKCS011
W25428                         30  ASC-INV-QTY             PIC S9(06)   INKCS055
00304                                                           COMP.   INKCS055
W25428                         30  ASC-PR-AMT              PIC S9(07)V99INKCS055
00306                                                           COMP-3. INKCS055
W25428                         30  ASC-PR-EXT-AMT          PIC S9(09)V99INKCS055
00308                                                           COMP-3. INKCS055
00309                          30  ASC-COLOR               PIC X.       INKCS055
00310                                                                   INKCS055
00311              15  ASC-BLK-SUB                         PIC S9(04)   INKCS055
00312                                                           COMP    INKCS055
00313                                                           SYNC.   INKCS055
00314              15  ASC-ITEM-SUB                        PIC S9(04)   INKCS055
00315                                                           COMP    INKCS055
00316                                                           SYNC.   INKCS055
00317              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   INKCS055
00318                                                           COMP-3. INKCS055
00319              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   INKCS055
00320                                                           COMP-3. INKCS055
00321              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   INKCS055
00322                                                           COMP-3. INKCS055
00323              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   INKCS055
00324                                                           COMP-3. INKCS055
00325              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   INKCS055
00326                                                           COMP-3. INKCS055
00327              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   INKCS055
00328                                                           COMP    INKCS055
00329                                                           SYNC.   INKCS055
00330              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   INKCS055
00331                                                           COMP-3. INKCS055
00332              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   INKCS055
00333                                                           COMP-3. INKCS055
00334              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  INKCS055
00335                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   INKCS055
00336                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   INKCS055
00337              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  INKCS055
00338                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   INKCS055
00339                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   INKCS055
00340              15  ASC-LIST-QUEUE-NAME.                             INKCS055
00341                  20  ASC-LIST-TERM-ID                PIC  X(04).  INKCS055
00342                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   INKCS055
00343                                                           COMP-3. INKCS055
00344                  20  ASC-LIST-SEQ                    PIC  9(01).  INKCS055
00345              15  ASC-SEL-QUEUE-NAME.                              INKCS055
00346                  20  ASC-SEL-TERM-ID                 PIC  X(04).  INKCS055
00347                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   INKCS055
00348                                                           COMP-3. INKCS055
00349                  20  ASC-SEL-SEQ                     PIC  9(01).  INKCS055
00350                                                                   INKCS055
00351              15  ASC-CURSOR-SW                       PIC  X(01).  INKCS055
00352                  88  ASC-NO-CURSOR                   VALUE 'Z'.   INKCS055
00353                  88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   INKCS055
00354                  88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   INKCS055
00355                  88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   INKCS055
00356              15  ASC-START-ITEM-REQUEST.                          INKCS055
00357                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  INKCS055
00358              15  ASC-HOLD-INTER-APPL                 PIC X(200).  INKCS055
W26600         10  FILLER                                  PIC X(1240). INKCS055
                                                                        INKCS055
00364      COPY DPWS013.                                                INKCS055
00365                                                                   INKCS055
00367 ***************************************************************** INKCS055
00368 *    DB2 AREA FOR SUMMARIZED INVENTORY DATA TABLE               * INKCS055
00367 ***************************************************************** INKCS055
00370      EXEC SQL                                                     INKCS055
00371           INCLUDE TSUMINV                                         INKCS055
00372      END-EXEC.                                                    INKCS055
                                                                                
00367 ***************************************************************** INKCS055
00374 *    DB2 AREA FOR ADJUSTMENT ADD TABLE                          * INKCS055
00367 ***************************************************************** INKCS055
00376      EXEC SQL                                                     INKCS055
00377           INCLUDE TADJADD                                         INKCS055
00378      END-EXEC.                                                    INKCS055
                                                                                
00367 ***************************************************************** INKCS055
W21015*    DB2 AREA FOR ADJUSTMENT DETAIL TABLE                       * INKCS055
00367 ***************************************************************** INKCS055
W21015     EXEC SQL                                                     INKCS055
W21015          INCLUDE TADJDTL                                         INKCS055
W21015     END-EXEC.                                                    INKCS055
                                                                                
W25428*---------------------------------------------------------------* INKCS011
W25428*    DB2 AREA FOR SKU CROSS-REFERENCE TABLE                     * INKCS011
W25428*---------------------------------------------------------------* INKCS011
W25428     EXEC SQL                                                     INKCS011
W25428          INCLUDE TSKXREF                                         INKCS011
W25428     END-EXEC.                                                    INKCS011
P25428*---------------------------------------------------------------* INKCS011
P25428*    DB2 AREA FOR USER PRINTER DEFAULT ID                      *  INKCS011
P25428*---------------------------------------------------------------* INKCS011
P25428     EXEC SQL                                                     INKCS011
P25428          INCLUDE TUSER                                           INKCS011
P25428     END-EXEC.                                                    INKCS011
00367 ***************************************************************** INKCS055
00380 *    DB2 AREA FOR COMMUNICATIONS                                * INKCS055
00367 ***************************************************************** INKCS055
00382      EXEC SQL                                                     INKCS055
00383           INCLUDE SQLCA                                           INKCS055
00384      END-EXEC.                                                    INKCS055
00385                                                                   INKCS055
00367 ***************************************************************** INKCS055
00387 *    TSUMINV UNION WITH TADJADD CURSOR DECLARATION.             * INKCS055
00367 ***************************************************************** INKCS055
00389                                                                   INKCS055
00390      EXEC SQL                                                     INKCS055
00391           DECLARE SUMMARY-CSR CURSOR                              INKCS055
00392           FOR SELECT                                              INKCS055
W21732                SKU_NBR                                           INKCS055
W25428              , UPC_NBR                                           INKCS055
00396               , INV_UNIT_PR_AMT                                   INKCS055
00397               , INV_QTY                                           INKCS055
00398               , EXTD_AMT                                          INKCS055
00399               , 'SUM'                                             INKCS055
00400           FROM                                                    INKCS055
00401                 TSUMINV                                           INKCS055
00402           WHERE                                                   INKCS055
W21732*               STORE_NBR    =   :SUMINV-STORE-NBR                INKCS055
W26600                LOC_NBR      =   :SUMINV-LOC-NBR                  INKCS055
00404             AND                                                   INKCS055
W21732                AREA_NBR     =   :SUMINV-AREA-NBR                 INKCS055
00406                                                                   INKCS055
00407         UNION                                                     INKCS055
00408                                                                   INKCS055
00409           SELECT                                                  INKCS055
W21732                SKU_NBR                                           INKCS055
W25428              , UPC_NBR                                           INKCS055
00413               , ADJ_UNIT_PR_AMT                                   INKCS055
00414               , ADJ_QTY                                           INKCS055
00415               , ADJ_EXTD_AMT                                      INKCS055
00416               , 'ADJ'                                             INKCS055
00417           FROM                                                    INKCS055
00418                 TADJADD                                           INKCS055
00419           WHERE                                                   INKCS055
W21732*               STORE_NBR    =   :ADJADD-STORE-NBR                INKCS055
W26600                LOC_NBR      =   :ADJADD-LOC-NBR                  INKCS055
00421             AND                                                   INKCS055
W21732                AREA_NBR     =   :ADJADD-AREA-NBR                 INKCS055
00423           ORDER BY                                                INKCS055
00424                 1                                                 INKCS055
00427      END-EXEC.                                                    INKCS055
00428                                                                   INKCS055
00367 /**************************************************************** INKCS055
00430  LINKAGE SECTION.                                                 INKCS055
00367 ***************************************************************** INKCS055
00432  01  DFHCOMMAREA.                                                 INKCS055
00433      05  FILLER                         OCCURS  1 TO 4072 TIMES   INKCS055
00434                                         DEPENDING ON EIBCALEN.    INKCS055
00435          10  FILLER                     PIC X.                    INKCS055
00436                                                                   INKCS055
00437  PROCEDURE DIVISION.                                              INKCS055
00438 ******************************************************************INKCS055
00439 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **INKCS055
00440 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **INKCS055
00441 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **INKCS055
00442 ******************************************************************INKCS055
00443                                                                   INKCS055
00444  0000-MAIN-MODULE.                                                INKCS055
00445                                                                   INKCS055
00446      INITIALIZE DP030-CICS-API-FIELDS.                            INKCS055
00447      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       INKCS055
00448      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          INKCS055
00449      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         INKCS055
00450      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       INKCS055
00451                                                                   INKCS055
00452      MOVE LENGTH OF IN055AI        TO DP030-MAP-LENGTH (1).       INKCS055
00453      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     INKCS055
00454      PERFORM 0001-CALL-CICS-ARCH-API.                             INKCS055
00455                                                                   INKCS055
00456      PERFORM 1000-CONTROL-PROCESSING                              INKCS055
00457                                                                   INKCS055
00458      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     INKCS055
00459      PERFORM 0001-CALL-CICS-ARCH-API.                             INKCS055
00460                                                                   INKCS055
00461 *----------------------------------------------------------------*INKCS055
00462 *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *INKCS055
00463 *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *INKCS055
00464 *----------------------------------------------------------------*INKCS055
00465                                                                   INKCS055
00466  0001-CALL-CICS-ARCH-API.                                         INKCS055
00467                                                                   INKCS055
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               INKCS055
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
00469                            DFHCOMMAREA                            INKCS055
00470                            DP030-CICS-API-FIELDS                  INKCS055
00471                            DP020-STANDARD-COMMAREA                INKCS055
00472                            IN055AI.                               INKCS055
00473                                                                   INKCS055
00474      IF  DP030-RC-CALL-SUCCESSFUL                                 INKCS055
00475          CONTINUE                                                 INKCS055
00476      ELSE                                                         INKCS055
00477          SET DP013-NO-ROLLBACK                                    INKCS055
00478              DP013-XCTL-DISPLAY-RESTART                           INKCS055
00479              DP013-CICS-ABEND      TO TRUE                        INKCS055
00480          MOVE '0001-CALL-CICS-ARCH-API'                           INKCS055
00481                                    TO DP013-PARAGRAPH             INKCS055
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEXINKCS055
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      INKCS055
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
00484          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      INKCS055
00485          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
00486      END-IF.                                                      INKCS055
00487                                                                   INKCS055
00488 *----------------------------------------------------------------*INKCS055
00489 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *INKCS055
00490 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *INKCS055
00491 *                                                                *INKCS055
00492 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *INKCS055
00493 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *INKCS055
00494 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *INKCS055
00495 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *INKCS055
00496 *----------------------------------------------------------------*INKCS055
00497                                                                   INKCS055
00498  1000-CONTROL-PROCESSING.                                         INKCS055
00499                                                                   INKCS055
00500      EVALUATE TRUE                                                INKCS055
00501          WHEN DP020-NEXT-ACT-INITIAL                              INKCS055
00502               INITIALIZE ASC-SPECIFIC-COMMAREA                    INKCS055
00503               MOVE EIBTRMID         TO  ASC-LIST-TERM-ID          INKCS055
00504                                         ASC-SEL-TERM-ID           INKCS055
00505               MOVE DP020-SRC-TASK-NUMBER                          INKCS055
00506                                     TO  ASC-LIST-TASK-NUMBER      INKCS055
00507                                         ASC-SEL-TASK-NUMBER       INKCS055
00508               MOVE PC-LIST-QUEUE-SEQ                              INKCS055
00509                                     TO  ASC-LIST-SEQ              INKCS055
00510               MOVE PC-SEL-QUEUE-SEQ TO  ASC-SEL-SEQ               INKCS055
00511                                                                   INKCS055
00512               MOVE INTER-APPL-COMM-AREA                           INKCS055
00513                                     TO  ASC-HOLD-INTER-APPL       INKCS055
00514               PERFORM 4000-BUILD-INITIAL-PANEL                    INKCS055
00515                                                                   INKCS055
00516          WHEN DP020-NEXT-ACT-READ-MAP                             INKCS055
00517               MOVE ASC-ITEM-AT-TOP-OF-PANEL                       INKCS055
00518                                    TO PV-TOP-ITEM                 INKCS055
00519               PERFORM 2000-PROCESS-PANEL                          INKCS055
00520                                                                   INKCS055
00521          WHEN DP020-NEXT-ACT-RETURN                               INKCS055
00522               MOVE ASC-ITEM-AT-TOP-OF-PANEL                       INKCS055
00523                                    TO PV-TOP-ITEM                 INKCS055
00524               MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    INKCS055
00525               MOVE ASC-HOLD-INTER-APPL                            INKCS055
00526                                    TO INTER-APPL-COMM-AREA        INKCS055
00527               PERFORM 6000-REFRESH-PANEL-FROM-TEMP                INKCS055
00528               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  INKCS055
00529               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                INKCS055
00530                                                                   INKCS055
00531          WHEN OTHER                                               INKCS055
00532               SET DP013-LOGIC-ABEND TO TRUE                       INKCS055
00533               SET DP013-NO-ROLLBACK TO TRUE                       INKCS055
00534               MOVE '1000-CONTROL-PROCESSING'                      INKCS055
00535                                    TO DP013-PARAGRAPH             INKCS055
00536               MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   INKCS055
00537                                    TO DP013-MESSAGE-TEXT(1)       INKCS055
00538               PERFORM DP013-0000-PROCESS-ABEND                    INKCS055
00539      END-EVALUATE.                                                INKCS055
00540 /                                                                 INKCS055
00541 *----------------------------------------------------------------*INKCS055
00542 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *INKCS055
00543 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *INKCS055
00544 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *INKCS055
00545 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *INKCS055
00546 * FUNCTION KEYS CAN GET THIS FAR.                                *INKCS055
00547 *----------------------------------------------------------------*INKCS055
00548                                                                   INKCS055
00549  2000-PROCESS-PANEL.                                              INKCS055
00550                                                                   INKCS055
00551      IF  IN001-STORE-NBR NOT NUMERIC                              INKCS055
00552          MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         INKCS055
00553      END-IF.                                                      INKCS055
00554                                                                   INKCS055
00555      EVALUATE TRUE                                                INKCS055
00556          WHEN DP020-SRC-AID = DP016-CLEAR                         INKCS055
00557              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    INKCS055
00558              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   INKCS055
00559              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00560                                                                   INKCS055
00561          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    INKCS055
00562              PERFORM 2050-DELETE-LIST-QUEUE                       INKCS055
00563              PERFORM 4000-BUILD-INITIAL-PANEL                     INKCS055
00564                                                                   INKCS055
00565          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    INKCS055
00566              PERFORM 2140-DESELECT-ALL-ITEMS                      INKCS055
00567              PERFORM 3200-RESET-ATTRIBUTES                        INKCS055
00568              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00569                                                                   INKCS055
00570          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  INKCS055
00571              PERFORM 2150-SELECT-ALL-ITEMS                        INKCS055
00572              PERFORM 3200-RESET-ATTRIBUTES                        INKCS055
00573              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00574                                                                   INKCS055
00575          WHEN OTHER                                               INKCS055
00576              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 INKCS055
00577              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   INKCS055
00578              IF  PS-NO-ERROR                                      INKCS055
00579                  SET DP030-CONTINUE-GO                            INKCS055
00580                                  TO TRUE                          INKCS055
00581                  PERFORM 2100-CHECK-FUNCTION-KEY                  INKCS055
00582              ELSE                                                 INKCS055
00583                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             INKCS055
00584                  SET DP030-OVERRIDE-GO                            INKCS055
00585                                  TO TRUE                          INKCS055
00586              END-IF                                               INKCS055
00587      END-EVALUATE.                                                INKCS055
00588  EJECT                                                            INKCS055
00589 *----------------------------------------------------------------*INKCS055
00590 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *INKCS055
00591 *----------------------------------------------------------------*INKCS055
00592  2050-DELETE-LIST-QUEUE.                                          INKCS055
00593                                                                   INKCS055
00594      EXEC CICS                                                    INKCS055
00595          DELETEQ TS                                               INKCS055
00596              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
00597              RESP  (PV-CICS-RESP)                                 INKCS055
00598      END-EXEC.                                                    INKCS055
00599                                                                   INKCS055
00600      IF (PV-CICS-RESP = DFHRESP(NORMAL)                           INKCS055
00601      OR  PV-CICS-RESP = DFHRESP(QIDERR))                          INKCS055
00602          CONTINUE                                                 INKCS055
00603      ELSE                                                         INKCS055
00604          SET DP013-CICS-ABEND      TO TRUE                        INKCS055
00605          SET DP013-NO-ROLLBACK     TO TRUE                        INKCS055
00606                                                                   INKCS055
00607          MOVE '2050-DELETE-LIST-QUEUE'                            INKCS055
00608                                    TO DP013-PARAGRAPH             INKCS055
00609          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    INKCS055
00610                                    TO DP013-MESSAGE-TEXT (1)      INKCS055
00611          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
00612      END-IF.                                                      INKCS055
00613                                                                   INKCS055
00614      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  INKCS055
00615 /                                                                 INKCS055
00616 *----------------------------------------------------------------*INKCS055
00617 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*INKCS055
00618 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *INKCS055
00619 * CICS ARCHITECTURE API.                                         *INKCS055
00620 *----------------------------------------------------------------*INKCS055
00621                                                                   INKCS055
00622  2100-CHECK-FUNCTION-KEY.                                         INKCS055
00623                                                                   INKCS055
00624      EVALUATE TRUE                                                INKCS055
00625          WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  INKCS055
00626              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              INKCS055
00627                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                INKCS055
00628                                 TO IN012-SELECTED-ITEMS           INKCS055
00629                                    IN001-NUMBER-OF-SELECTED-ITEMS INKCS055
00630                  PERFORM 5000-PREPARE-SEL-QUEUE                   INKCS055
00631              ELSE                                                 INKCS055
00632                  SET DP030-OVERRIDE-GO                            INKCS055
00633                                    TO TRUE                        INKCS055
00634                  MOVE PC-TSYMSG-00057                             INKCS055
00635                                    TO DP020-MSG-NUMBER            INKCS055
00636                  SET DP020-MSG-WARNING                            INKCS055
00637                                    TO TRUE                        INKCS055
00638              END-IF                                               INKCS055
00639                                                                   INKCS055
00640          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  INKCS055
00641              MOVE +1               TO PV-TOP-ITEM                 INKCS055
00642              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00643                                                                   INKCS055
00644          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   INKCS055
00645              PERFORM 2110-BROWSE-BACKWARD                         INKCS055
00646              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00647                                                                   INKCS055
00648          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   INKCS055
00649              PERFORM 2120-BROWSE-FORWARD                          INKCS055
00650              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00651                                                                   INKCS055
00652          WHEN DP020-SRC-AID = DP016-ENTER                         INKCS055
00653              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   INKCS055
00654              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS055
00655                                                                   INKCS055
P25428*        PRINT SKU LISTING (INKRP193)                                     
P25428         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                      
W30692             PERFORM DP026-0000-GET-LOGON-INFO                            
W30692             IF DP026-CICS-RESPONSE = DFHRESP(NORMAL)                     
W30692                 IF DP026-DFLT-PRTR-ID EQUAL SPACES                       
W30692                   IF DP026-LOCATION-TYPE NOT EQUAL 'HQ'                  
W30692                     PERFORM 8XXX-USE-STORE-DEFAULT-PRTR                  
W30692                     IF JL-JCL-INK950-PRTDEST EQUAL SPACES                
W30692                         SET DP030-OVERRIDE-GO                            
W30692                             DP020-MSG-FATAL TO TRUE                      
W30692                         MOVE PC-TSYMSG-01714                             
W30692                                           TO DP020-MSG-NUMBER            
W30692                     ELSE                                                 
W30692                         PERFORM 8000-FORMAT-AND-SUBMIT                   
W30692                         PERFORM 2130-CHECK-FOR-JUMP-BROWSE       INKCS046
W30692                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     INKCS046
W30692                         MOVE PC-TSYMSG-00098                             
W30692                                              TO DP020-MSG-NUMBER         
W30692                         SET DP020-MSG-INFORMATIONAL TO TRUE              
W30692                     END-IF                                               
W30692                   ELSE                                                   
W30692                       MOVE 'LOCAL'  TO JL-JCL-INK950-PRTDEST             
W30692                       MOVE 'Y'      TO JL-JCL-INK950-PRT-IND             
W30692                       PERFORM 8000-FORMAT-AND-SUBMIT                     
W30692                       PERFORM 2130-CHECK-FOR-JUMP-BROWSE         INKCS046
W30692                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       INKCS046
W30692                       MOVE PC-TSYMSG-00098   TO DP020-MSG-NUMBER         
W30692                       SET DP020-MSG-INFORMATIONAL TO TRUE                
W30692                   END-IF                                                 
W30692                 ELSE                                                     
W30692                     MOVE DP026-DFLT-PRTR-ID                              
W30692                                        TO JL-JCL-INK950-PRTDEST          
W30692                     MOVE 'Y'           TO JL-JCL-INK950-PRT-IND          
W30692                     PERFORM 8000-FORMAT-AND-SUBMIT                       
W30692                     PERFORM 2130-CHECK-FOR-JUMP-BROWSE           INKCS046
W30692                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         INKCS046
W30692                     MOVE PC-TSYMSG-00098   TO DP020-MSG-NUMBER           
W30692                     SET DP020-MSG-INFORMATIONAL TO TRUE                  
W30692                 END-IF                                                   
W30692             ELSE                                                         
W30692                 SET DP013-NO-ROLLBACK                            INKCS055
W30692                     DP013-XCTL-DISPLAY-RESTART                   INKCS055
W30692                     DP013-CICS-ABEND  TO TRUE                    INKCS055
W30692                 MOVE '2100-CHECK-FUNCTION-KEY'                   INKCS055
W30692                                       TO DP013-PARAGRAPH         INKCS055
W30692                 MOVE 'DP026-0000-GET-LOGON-INFO ERROR'           INKCS055
W30692                                       TO DP013-MESSAGE-TEXT (1)  INKCS055
W30692                 PERFORM DP013-0000-PROCESS-ABEND                         
W30692             END-IF                                                       
P25428*            PERFORM 8000-FORMAT-AND-SUBMIT                               
P25428*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   INKCS046
P25428*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 INKCS046
P25428*            MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER                     
P25428*            SET DP020-MSG-INFORMATIONAL TO TRUE                          
P25428                                                                  INKCS011
00656          WHEN OTHER                                               INKCS055
00657              SET DP013-NO-ROLLBACK                                INKCS055
00658                  DP013-XCTL-DISPLAY-RESTART                       INKCS055
00659                  DP013-CICS-ABEND  TO TRUE                        INKCS055
00660              MOVE '2100-CHECK-FUNCTION-KEY'                       INKCS055
00661                                    TO DP013-PARAGRAPH             INKCS055
00662              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      INKCS055
00663                                    TO DP013-MESSAGE-TEXT (1)      INKCS055
00664              PERFORM DP013-0000-PROCESS-ABEND                     INKCS055
00665      END-EVALUATE.                                                INKCS055
00666                                                                   INKCS055
00667 *----------------------------------------------------------------*INKCS055
00668 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *INKCS055
00669 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *INKCS055
00670 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *INKCS055
00671 *    MESSAGE.                                                    *INKCS055
00672 *----------------------------------------------------------------*INKCS055
00673                                                                   INKCS055
00674  2110-BROWSE-BACKWARD.                                            INKCS055
00675                                                                   INKCS055
00676      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    INKCS055
00677          GIVING PV-TOP-ITEM.                                      INKCS055
00678                                                                   INKCS055
00679      IF  ((PV-TOP-ITEM < +1)                                      INKCS055
00680        OR (PV-TOP-ITEM = +1))                                     INKCS055
00681          MOVE +1                   TO PV-TOP-ITEM                 INKCS055
00682 *        -- TOP OF LIST --                                        INKCS055
00683          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            INKCS055
00684          SET DP020-MSG-INFORMATIONAL TO TRUE                      INKCS055
00685      END-IF.                                                      INKCS055
00686                                                                   INKCS055
00687 /                                                                 INKCS055
00688 *----------------------------------------------------------------*INKCS055
00689 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *INKCS055
00690 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *INKCS055
00691 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *INKCS055
00692 *----------------------------------------------------------------*INKCS055
00693                                                                   INKCS055
00694  2120-BROWSE-FORWARD.                                             INKCS055
00695                                                                   INKCS055
00696      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              INKCS055
00697          GIVING PV-TOP-ITEM.                                      INKCS055
00698      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   INKCS055
00699          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            INKCS055
00700                                    TO PV-TOP-ITEM                 INKCS055
00701 *        -- BOTTOM OF LIST --                                     INKCS055
00702          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            INKCS055
00703          SET DP020-MSG-INFORMATIONAL                              INKCS055
00704                                    TO TRUE                        INKCS055
00705      ELSE                                                         INKCS055
00706          COMPUTE PV-BOTTOM-ITEM =                                 INKCS055
00707              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 INKCS055
00708          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            INKCS055
00709 *            -- BOTTOM OF LIST --                                 INKCS055
00710              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            INKCS055
00711              SET DP020-MSG-INFORMATIONAL                          INKCS055
00712                                    TO TRUE                        INKCS055
00713          END-IF                                                   INKCS055
00714      END-IF.                                                      INKCS055
00715 /                                                                 INKCS055
00716 *----------------------------------------------------------------*INKCS055
00717 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *INKCS055
00718 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *INKCS055
00719 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *INKCS055
00720 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *INKCS055
00721 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *INKCS055
00722 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *INKCS055
00723 *----------------------------------------------------------------*INKCS055
00724                                                                   INKCS055
00725  2130-CHECK-FOR-JUMP-BROWSE.                                      INKCS055
00726                                                                   INKCS055
00727      SET PS-NO-ERROR               TO TRUE.                       INKCS055
00728      IF  ASC-START-ITEM-REQUEST = SPACE                           INKCS055
00729          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            INKCS055
00730                                    TO PV-TOP-ITEM                 INKCS055
00731      ELSE                                                         INKCS055
00732          MOVE ASC-START-ITEM-REQUEST                              INKCS055
00733                                    TO DP010I-UNEDITED-FIELD       INKCS055
00734                                       PV-START-ITEM-REQUEST       INKCS055
00735          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       INKCS055
00736          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     INKCS055
00737          SET DP010I-NEGATIVE-NOT-ALLOWED                          INKCS055
00738                                    TO TRUE                        INKCS055
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
00740                                                                   INKCS055
00741          IF  NOT DP010I-ERROR-DETECTED                            INKCS055
00742              MOVE DP010I-NUMERIC-FIELD                            INKCS055
00743                                    TO  ASC-START-ITEM-REQUEST-N   INKCS055
00744              IF  ASC-START-ITEM-REQUEST-N > ZERO                  INKCS055
00745                  IF  ASC-START-ITEM-REQUEST-N >                   INKCS055
00746                                           ASC-NUMBER-OF-ITEMS-READINKCS055
00747                      MOVE SPACE TO ASC-START-ITEM-REQUEST         INKCS055
00748                      COMPUTE PV-TOP-ITEM =                        INKCS055
00749                              ASC-NUMBER-OF-ITEMS-READ             INKCS055
00750                              - PC-ITEMS-PER-PANEL + 1             INKCS055
00751                      IF  PV-TOP-ITEM < +1                         INKCS055
00752                          MOVE +1   TO PV-TOP-ITEM                 INKCS055
00753                          MOVE PC-TSYMSG-00070                     INKCS055
00754                                    TO DP020-MSG-NUMBER            INKCS055
00755                          SET DP020-MSG-INFORMATIONAL              INKCS055
00756                                    TO TRUE                        INKCS055
00757                      END-IF                                       INKCS055
00758                  ELSE                                             INKCS055
00759                      MOVE ASC-START-ITEM-REQUEST-N                INKCS055
00760                                    TO PV-TOP-ITEM                 INKCS055
00761                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      INKCS055
00762                      COMPUTE PV-BOTTOM-ITEM =                     INKCS055
00763                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     INKCS055
00764                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READINKCS055
00765 *                        -- BOTTOM OF LIST --                     INKCS055
00766                          MOVE PC-TSYMSG-00070                     INKCS055
00767                                    TO DP020-MSG-NUMBER            INKCS055
00768                          SET DP020-MSG-INFORMATIONAL              INKCS055
00769                                    TO TRUE                        INKCS055
00770                      END-IF                                       INKCS055
00771                  END-IF                                           INKCS055
00772              ELSE                                                 INKCS055
00773 *                --- VALUE OUT OF RANGE ----                      INKCS055
00774                  MOVE PC-TSYMSG-00101                             INKCS055
00775                                    TO DP020-MSG-NUMBER            INKCS055
00776                  MOVE -1           TO ASTRTITL                    INKCS055
00777                  SET DP030-SET-CURSOR-APPL-1                      INKCS055
00778                                    TO TRUE                        INKCS055
00779                  MOVE DP015-REVERSE                               INKCS055
00780                                    TO ASTRTITH                    INKCS055
00781                  MOVE DP015-RED    TO ASTRTITC                    INKCS055
00782                  MOVE DP015-UNP-NUM-BRT-OFF                       INKCS055
00783                                    TO ASTRTITA                    INKCS055
00784                  SET DP020-MSG-FATAL                              INKCS055
00785                                    TO TRUE                        INKCS055
00786                  SET PS-ERROR      TO TRUE                        INKCS055
00787              END-IF                                               INKCS055
00788                                                                   INKCS055
00789          ELSE                                                     INKCS055
00790              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            INKCS055
00791              MOVE -1               TO ASTRTITL                    INKCS055
00792              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  INKCS055
00793              MOVE DP015-REVERSE    TO ASTRTITH                    INKCS055
00794              MOVE DP015-RED        TO ASTRTITC                    INKCS055
00795              MOVE DP015-UNP-NUM-BRT-OFF                           INKCS055
00796                                    TO ASTRTITA                    INKCS055
00797              SET DP020-MSG-FATAL   TO TRUE                        INKCS055
00798              SET PS-ERROR          TO TRUE                        INKCS055
00799          END-IF                                                   INKCS055
00800      END-IF.                                                      INKCS055
00801 /                                                                 INKCS055
00802 *----------------------------------------------------------------*INKCS055
00803 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *INKCS055
00804 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *INKCS055
00805 *----------------------------------------------------------------*INKCS055
00806                                                                   INKCS055
00807  2140-DESELECT-ALL-ITEMS.                                         INKCS055
00808                                                                   INKCS055
00809      MOVE +1                       TO ASC-BLK-SUB.                INKCS055
00810                                                                   INKCS055
00811      PERFORM 2141-CLEAR-SELECTED-INDS                             INKCS055
00812          VARYING ASC-ITEM-SUB                                     INKCS055
00813          FROM 1 BY 1                                              INKCS055
00814          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
00815                                                                   INKCS055
00816      ADD +1                        TO ASC-BLK-SUB.                INKCS055
00817                                                                   INKCS055
00818      PERFORM 2141-CLEAR-SELECTED-INDS                             INKCS055
00819          VARYING ASC-ITEM-SUB                                     INKCS055
00820          FROM 1 BY 1                                              INKCS055
00821          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
00822                                                                   INKCS055
00823      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               INKCS055
00824                                    TO PV-LIST-ITEM-NUMBER.        INKCS055
00825                                                                   INKCS055
00826      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            INKCS055
00827          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    INKCS055
00828                                                                   INKCS055
00829      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     INKCS055
00830         (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      INKCS055
00831          MOVE +1                   TO ASC-BLK-SUB                 INKCS055
00832                                                                   INKCS055
00833          PERFORM 5100-WRITE-TEMP-STORAGE                          INKCS055
00834                                                                   INKCS055
00835          MOVE +1                   TO PV-BLOCK-NUMBER             INKCS055
00836                                                                   INKCS055
00837          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         INKCS055
00838              PV-FIRST-BLOCK-IN-ARRAY - 1                          INKCS055
00839                                                                   INKCS055
00840          PERFORM                                                  INKCS055
00841              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       INKCS055
00842                                                                   INKCS055
00843              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
00844                                                                   INKCS055
00845              PERFORM 2141-CLEAR-SELECTED-INDS                     INKCS055
00846                  VARYING ASC-ITEM-SUB FROM 1 BY 1                 INKCS055
00847                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
00848                                                                   INKCS055
00849              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
00850                                                                   INKCS055
00851              ADD +1                TO PV-BLOCK-NUMBER             INKCS055
00852                                                                   INKCS055
00853          END-PERFORM                                              INKCS055
00854                                                                   INKCS055
00855          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         INKCS055
00856              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     INKCS055
00857                                                                   INKCS055
00858          PERFORM                                                  INKCS055
00859              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       INKCS055
00860                    ASC-HIGHEST-BLOCK-WRITTEN                      INKCS055
00861                                                                   INKCS055
00862              MOVE PV-NEXT-BLOCK-IN-ARRAY                          INKCS055
00863                                    TO PV-BLOCK-NUMBER             INKCS055
00864                                                                   INKCS055
00865              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
00866                                                                   INKCS055
00867              PERFORM 2141-CLEAR-SELECTED-INDS                     INKCS055
00868                  VARYING ASC-ITEM-SUB                             INKCS055
00869                  FROM 1 BY 1                                      INKCS055
00870                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
00871                                                                   INKCS055
00872              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
00873                                                                   INKCS055
00874              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      INKCS055
00875                                                                   INKCS055
00876          END-PERFORM                                              INKCS055
00877                                                                   INKCS055
00878          MOVE PV-FIRST-BLOCK-IN-ARRAY                             INKCS055
00879                                    TO PV-BLOCK-NUMBER             INKCS055
00880                                                                   INKCS055
00881          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
00882      END-IF.                                                      INKCS055
00883                                                                   INKCS055
00884      MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. INKCS055
00885      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.INKCS055
00886      MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  INKCS055
00887                                                                   INKCS055
00888      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        INKCS055
00889                                                                   INKCS055
00890 /                                                                 INKCS055
00891 *----------------------------------------------------------------*INKCS055
00892 *    MARK EACH ITEM AS BEING NOT SELECTED.                       *INKCS055
00893 *----------------------------------------------------------------*INKCS055
00894                                                                   INKCS055
00895  2141-CLEAR-SELECTED-INDS.                                        INKCS055
00896                                                                   INKCS055
00897      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           INKCS055
00898              NOT EQUAL ZERO                                       INKCS055
00899          IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          INKCS055
00900              SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          INKCS055
00901                  ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS055
00902                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  INKCS055
00903                                    TO TRUE                        INKCS055
00904          END-IF                                                   INKCS055
00905      END-IF.                                                      INKCS055
00906                                                                   INKCS055
00907 /                                                                 INKCS055
00908 *----------------------------------------------------------------*INKCS055
00909 *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *INKCS055
00910 *  FOR ALL ITEMS.                                                *INKCS055
00911 *----------------------------------------------------------------*INKCS055
00912                                                                   INKCS055
00913  2150-SELECT-ALL-ITEMS.                                           INKCS055
00914                                                                   INKCS055
00915      MOVE +1                       TO ASC-BLK-SUB.                INKCS055
00916                                                                   INKCS055
00917      PERFORM 2151-SET-SELECTED-INDS                               INKCS055
00918          VARYING ASC-ITEM-SUB                                     INKCS055
00919          FROM 1 BY 1                                              INKCS055
00920          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
00921                                                                   INKCS055
00922      ADD +1                        TO ASC-BLK-SUB.                INKCS055
00923                                                                   INKCS055
00924      PERFORM 2151-SET-SELECTED-INDS                               INKCS055
00925          VARYING ASC-ITEM-SUB                                     INKCS055
00926          FROM 1 BY 1                                              INKCS055
00927          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
00928                                                                   INKCS055
00929      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               INKCS055
00930                                    TO PV-LIST-ITEM-NUMBER.        INKCS055
00931                                                                   INKCS055
00932      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            INKCS055
00933          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    INKCS055
00934                                                                   INKCS055
00935      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     INKCS055
00936         (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    INKCS055
00937          MOVE +1                   TO ASC-BLK-SUB                 INKCS055
00938                                                                   INKCS055
00939          PERFORM 5100-WRITE-TEMP-STORAGE                          INKCS055
00940                                                                   INKCS055
00941          MOVE +1                   TO PV-BLOCK-NUMBER             INKCS055
00942                                                                   INKCS055
00943          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         INKCS055
00944              PV-FIRST-BLOCK-IN-ARRAY - 1                          INKCS055
00945                                                                   INKCS055
00946          PERFORM                                                  INKCS055
00947              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       INKCS055
00948                                                                   INKCS055
00949              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
00950                                                                   INKCS055
00951              PERFORM 2151-SET-SELECTED-INDS                       INKCS055
00952                  VARYING ASC-ITEM-SUB                             INKCS055
00953                  FROM 1 BY 1                                      INKCS055
00954                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
00955                                                                   INKCS055
00956              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
00957                                                                   INKCS055
00958              ADD +1                TO PV-BLOCK-NUMBER             INKCS055
00959                                                                   INKCS055
00960          END-PERFORM                                              INKCS055
00961                                                                   INKCS055
00962          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         INKCS055
00963              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     INKCS055
00964                                                                   INKCS055
00965          PERFORM                                                  INKCS055
00966              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       INKCS055
00967                    ASC-HIGHEST-BLOCK-WRITTEN                      INKCS055
00968                                                                   INKCS055
00969              MOVE PV-NEXT-BLOCK-IN-ARRAY                          INKCS055
00970                                    TO PV-BLOCK-NUMBER             INKCS055
00971                                                                   INKCS055
00972              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
00973                                                                   INKCS055
00974              PERFORM 2151-SET-SELECTED-INDS                       INKCS055
00975                  VARYING ASC-ITEM-SUB                             INKCS055
00976                  FROM 1 BY 1                                      INKCS055
00977                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
00978                                                                   INKCS055
00979              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
00980                                                                   INKCS055
00981              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      INKCS055
00982                                                                   INKCS055
00983          END-PERFORM                                              INKCS055
00984                                                                   INKCS055
00985          MOVE PV-FIRST-BLOCK-IN-ARRAY                             INKCS055
00986                                    TO PV-BLOCK-NUMBER             INKCS055
00987                                                                   INKCS055
00988          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
00989      END-IF.                                                      INKCS055
00990                                                                   INKCS055
00991                                                                   INKCS055
00992      MOVE ASC-NUMBER-OF-ITEMS-READ TO                             INKCS055
00993                        ASC-NUMBER-OF-SELECTED-ITEMS.              INKCS055
P0993      IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                       INKCS055
P0993          SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            INKCS055
P0994      END-IF.                                                      INKCS055
00994                                                                   INKCS055
00995      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        INKCS055
00996                                                                   INKCS055
00997 /                                                                 INKCS055
00998 *----------------------------------------------------------------*INKCS055
00999 *    MARK EACH ITEM AS BEING SELECTED.                           *INKCS055
01000 *----------------------------------------------------------------*INKCS055
01001                                                                   INKCS055
01002  2151-SET-SELECTED-INDS.                                          INKCS055
01003                                                                   INKCS055
01004      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           INKCS055
01005              NOT EQUAL ZERO                                       INKCS055
01006          IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             INKCS055
01007              SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             INKCS055
01008                  ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        INKCS055
01009                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  INKCS055
01010                                TO  TRUE                           INKCS055
01055          END-IF                                                   INKCS055
01012      END-IF.                                                      INKCS055
01013                                                                   INKCS055
01014 *----------------------------------------------------------------*INKCS055
01015 *  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *INKCS055
01016 *  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *INKCS055
01017 *----------------------------------------------------------------*INKCS055
01018                                                                   INKCS055
01019  2200-MOVE-SCREEN-TO-COMMAREA.                                    INKCS055
01020                                                                   INKCS055
01021      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             INKCS055
01022      MOVE +1                       TO PV-SUB.                     INKCS055
01023                                                                   INKCS055
01024      IF  ASTRTITL > ZERO                                          INKCS055
01025          MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          INKCS055
01026      ELSE                                                         INKCS055
01027          IF  ASTRTITF EQUAL DP015-ERASE-EOF                       INKCS055
01028              INITIALIZE ASC-START-ITEM-REQUEST                    INKCS055
01029          END-IF                                                   INKCS055
01030      END-IF.                                                      INKCS055
01031                                                                   INKCS055
01032      PERFORM 3100-SET-SUBSCRIPTS.                                 INKCS055
01033                                                                   INKCS055
01034      PERFORM 2210-MOVE-LINES-TO-COMMAREA                          INKCS055
01035          VARYING PV-SUB                                           INKCS055
01036          FROM 1 BY 1                                              INKCS055
01037          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      INKCS055
01038                                                                   INKCS055
01039 ******************************************************************INKCS055
01040 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**INKCS055
01041 ******************************************************************INKCS055
01042                                                                   INKCS055
01043  2210-MOVE-LINES-TO-COMMAREA.                                     INKCS055
01044                                                                   INKCS055
01045      IF  MR-SELECTL (PV-SUB) > ZERO                               INKCS055
01046          SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             INKCS055
01047          MOVE MR-SELECTI (PV-SUB)                                 INKCS055
01048                                    TO ASC-TEMP-SELECTED-SW        INKCS055
01049                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      INKCS055
01050      ELSE                                                         INKCS055
01051          IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                INKCS055
01052                  SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     INKCS055
01053                  MOVE SPACE        TO ASC-TEMP-SELECTED-SW        INKCS055
01054                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      INKCS055
01055          END-IF                                                   INKCS055
01056      END-IF.                                                      INKCS055
01057                                                                   INKCS055
01058      ADD +1                        TO ASC-ITEM-SUB.               INKCS055
01059      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        INKCS055
01060          ADD +1                    TO ASC-BLK-SUB                 INKCS055
01061          MOVE +1                   TO ASC-ITEM-SUB                INKCS055
01062      END-IF.                                                      INKCS055
01063                                                                   INKCS055
01064 *----------------------------------------------------------------*INKCS055
01065 *  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *INKCS055
01066 *  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *INKCS055
01067 *----------------------------------------------------------------*INKCS055
01068                                                                   INKCS055
01069  3000-EDIT-DATA-IN-COMMAREA.                                      INKCS055
01070                                                                   INKCS055
01071      SET PS-NO-ERROR               TO TRUE.                       INKCS055
01072      PERFORM 3200-RESET-ATTRIBUTES.                               INKCS055
01073      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     INKCS055
W25428*                                                                 INKCS011
W25428     MOVE +0 TO ASC-START-OF-SELECTED-RANGE                       INKCS011
W25428                ASC-END-OF-SELECTED-RANGE.                        INKCS011
01074 **                                                                INKCS055
01075 * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              INKCS055
01076 * EDITTING IS DONE FROM THE BOTTOM UP.                            INKCS055
01077 **                                                                INKCS055
01078      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       INKCS055
01079          ASC-ITEMS-DISPLAYED - 1.                                 INKCS055
01080      PERFORM 3100-SET-SUBSCRIPTS.                                 INKCS055
01081      PERFORM 3300-EDIT-SELECTIONS                                 INKCS055
01082          VARYING PV-SUB                                           INKCS055
01083          FROM PV-SUB BY -1                                        INKCS055
01084          UNTIL PV-SUB < +1.                                       INKCS055
01085                                                                   INKCS055
01086      IF  PS-NO-ERROR                                              INKCS055
01087          PERFORM 3400-CHECK-RANGE-SEQUENCE                        INKCS055
01088      END-IF.                                                      INKCS055
01089                                                                   INKCS055
01090      IF  ((PS-NO-ERROR)                                           INKCS055
01091        AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   INKCS055
01092        AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    INKCS055
01093              PERFORM 3500-MARK-RANGE-AS-SELECTED                  INKCS055
01094      END-IF.                                                      INKCS055
01095 /                                                                 INKCS055
01096 *----------------------------------------------------------------*INKCS055
01097 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *INKCS055
01098 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*INKCS055
01099 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *INKCS055
05500 *                                                                *INKCS055
05501 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *INKCS055
05502 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *INKCS055
05503 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *INKCS055
05504 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *INKCS055
05505 *----------------------------------------------------------------*INKCS055
05506                                                                   INKCS055
05507  3100-SET-SUBSCRIPTS.                                             INKCS055
05508                                                                   INKCS055
05509      COMPUTE ASC-ITEM-SUB =                                       INKCS055
05510          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        INKCS055
05511                                                                   INKCS055
05512      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         INKCS055
05513          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            INKCS055
05514                                                                   INKCS055
05515          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               INKCS055
05516      ELSE                                                         INKCS055
05517          MOVE +1                     TO ASC-BLK-SUB               INKCS055
05518      END-IF.                                                      INKCS055
05519                                                                   INKCS055
05520 *----------------------------------------------------------------*INKCS055
05521 *  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *INKCS055
05522 *----------------------------------------------------------------*INKCS055
05523                                                                   INKCS055
05524  3200-RESET-ATTRIBUTES.                                           INKCS055
05525                                                                   INKCS055
05526      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   INKCS055
05527      MOVE DP015-GREEN              TO ASTRTITC.                   INKCS055
05528      MOVE DP015-UNDERLINE          TO ASTRTITH.                   INKCS055
05529                                                                   INKCS055
05530      PERFORM                                                      INKCS055
05531          VARYING PV-SUB                                           INKCS055
05532          FROM 1 BY 1                                              INKCS055
05533          UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        INKCS055
05534          MOVE DP015-UNP-ALP-NOR-OFF                               INKCS055
05535                                    TO MR-SELECTA (PV-SUB)         INKCS055
05536          MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         INKCS055
05537          MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         INKCS055
05538      END-PERFORM.                                                 INKCS055
05539                                                                   INKCS055
05540 *----------------------------------------------------------------*INKCS055
05541 *  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *INKCS055
05542 *  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *INKCS055
05543 *  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *INKCS055
05544 *  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *INKCS055
05545 *----------------------------------------------------------------*INKCS055
05546                                                                   INKCS055
05547  3300-EDIT-SELECTIONS.                                            INKCS055
05548                                                                   INKCS055
05549      EVALUATE TRUE                                                INKCS055
05550          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     INKCS055
05551              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         INKCS055
05552                  CONTINUE                                         INKCS055
05553                                                                   INKCS055
05554          WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         INKCS055
05555              IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        INKCS055
05556                  ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   INKCS055
05557                  MOVE ASC-TEMP-SELECTED-SW                        INKCS055
05558                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS055
05559                                 TO ASC-SELECTED-SW                INKCS055
05560                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS055
05561              END-IF                                               INKCS055
05562                                                                   INKCS055
05563          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     INKCS055
05564                  = SPACE                                          INKCS055
05565              EVALUATE TRUE                                        INKCS055
05566                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       INKCS055
05567                      SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSINKCS055
05568                      MOVE SPACE TO ASC-SELECTED-SW                INKCS055
05569                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS055
05570                  WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        INKCS055
05571                      MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    INKCS055
05572                      MOVE SPACE TO ASC-SELECTED-SW                INKCS055
05573                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS055
05574                  WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          INKCS055
05575                      MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      INKCS055
05576                      MOVE SPACE TO ASC-SELECTED-SW                INKCS055
05577                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS055
05578              END-EVALUATE                                         INKCS055
05579                                                                   INKCS055
05580          WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           INKCS055
05581              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            INKCS055
05582                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    INKCS055
05583              END-IF                                               INKCS055
05584              PERFORM 3310-EDIT-RANGE                              INKCS055
05585                                                                   INKCS055
05586          WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             INKCS055
05587              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            INKCS055
05588                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    INKCS055
05589              END-IF                                               INKCS055
05590              PERFORM 3310-EDIT-RANGE                              INKCS055
05591                                                                   INKCS055
05592          WHEN OTHER                                               INKCS055
05593              MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           INKCS055
05594              SET DP020-MSG-FATAL    TO TRUE                       INKCS055
05595              MOVE -1                TO MR-SELECTL (PV-SUB)        INKCS055
05596              SET DP030-SET-CURSOR-APPL-1                          INKCS055
05597                                     TO TRUE                       INKCS055
05598              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        INKCS055
05599              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        INKCS055
01200              SET PS-ERROR TO TRUE                                 INKCS055
01201              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            INKCS055
01202                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     INKCS055
01203                  MOVE SPACE         TO ASC-SELECTED-SW            INKCS055
01204                                         (ASC-BLK-SUB ASC-ITEM-SUB)INKCS055
01205              END-IF                                               INKCS055
01206                                                                   INKCS055
01207      END-EVALUATE.                                                INKCS055
01208                                                                   INKCS055
01209      SUBTRACT +1             FROM PV-ITEM-IN-USE.                 INKCS055
01210      SUBTRACT +1 FROM ASC-ITEM-SUB.                               INKCS055
01211      IF  ASC-ITEM-SUB < 1                                         INKCS055
01212          SUBTRACT +1 FROM ASC-BLK-SUB                             INKCS055
01213          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                INKCS055
01214      END-IF.                                                      INKCS055
01215                                                                   INKCS055
01216 *----------------------------------------------------------------*INKCS055
01217 *  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *INKCS055
01218 *  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *INKCS055
01219 *  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *INKCS055
01220 *  THE ENDING.                                                   *INKCS055
01221 *----------------------------------------------------------------*INKCS055
01222                                                                   INKCS055
01223  3310-EDIT-RANGE.                                                 INKCS055
01224                                                                   INKCS055
01225      IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                INKCS055
01226          IF  ASC-START-OF-SELECTED-RANGE = ZERO                   INKCS055
01227              MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)INKCS055
01228                                    TO ASC-SELECTED-SW             INKCS055
01229                                         (ASC-BLK-SUB ASC-ITEM-SUB)INKCS055
01230              MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE INKCS055
01231          ELSE                                                     INKCS055
01232              IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     INKCS055
01233                  CONTINUE                                         INKCS055
01234              ELSE                                                 INKCS055
01235 *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        INKCS055
01236                  MOVE PC-TSYMSG-00054                             INKCS055
01237                                    TO DP020-MSG-NUMBER            INKCS055
01238                  SET DP020-MSG-FATAL                              INKCS055
01239                                    TO TRUE                        INKCS055
01240                  MOVE -1           TO MR-SELECTL (PV-SUB)         INKCS055
01241                  SET DP030-SET-CURSOR-APPL-1                      INKCS055
01242                                    TO TRUE                        INKCS055
01243                  MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         INKCS055
01244                  MOVE DP015-UNDERLINE                             INKCS055
01245                                    TO MR-SELECTH (PV-SUB)         INKCS055
01246                  SET PS-ERROR      TO TRUE                        INKCS055
01247              END-IF                                               INKCS055
01248          END-IF                                                   INKCS055
01249      ELSE                                                         INKCS055
01250          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     INKCS055
01251              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) INKCS055
01252                                    TO ASC-SELECTED-SW             INKCS055
01253                                      (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
01254              MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   INKCS055
01255          ELSE                                                     INKCS055
01256              IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       INKCS055
01257                  CONTINUE                                         INKCS055
01258              ELSE                                                 INKCS055
01259 *                -- ONLY ONE END-OF-RANGE ALLOWED --              INKCS055
01260                  MOVE PC-TSYMSG-00055                             INKCS055
01261                                    TO DP020-MSG-NUMBER            INKCS055
01262                  SET DP020-MSG-FATAL                              INKCS055
01263                                    TO TRUE                        INKCS055
01264                  MOVE -1           TO MR-SELECTL (PV-SUB)         INKCS055
01265                  SET DP030-SET-CURSOR-APPL-1                      INKCS055
01266                                    TO TRUE                        INKCS055
01267                  SET PS-ERROR      TO TRUE                        INKCS055
01268              END-IF                                               INKCS055
01269          END-IF                                                   INKCS055
01270      END-IF.                                                      INKCS055
01271                                                                   INKCS055
01272 *----------------------------------------------------------------*INKCS055
01273 *  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *INKCS055
01274 *  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *INKCS055
01275 *----------------------------------------------------------------*INKCS055
01276                                                                   INKCS055
01277  3400-CHECK-RANGE-SEQUENCE.                                       INKCS055
01278                                                                   INKCS055
01279      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       INKCS055
01280        AND  ASC-END-OF-SELECTED-RANGE > ZERO                      INKCS055
01281        AND  ASC-START-OF-SELECTED-RANGE >                         INKCS055
01282                                          ASC-END-OF-SELECTED-RANGEINKCS055
01283 *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                INKCS055
01284          MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 INKCS055
01285          SET DP020-MSG-FATAL TO TRUE                              INKCS055
01286          SET PS-ERROR TO TRUE                                     INKCS055
01287          PERFORM 3410-POSITION-AT-ERROR                           INKCS055
01288      END-IF.                                                      INKCS055
01289                                                                   INKCS055
01290 *----------------------------------------------------------------*INKCS055
01291 *  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *INKCS055
01292 *  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *INKCS055
01293 *  SHOULD BE POSITIONED ON A RANGE ERROR.                        *INKCS055
01294 *----------------------------------------------------------------*INKCS055
01295                                                                   INKCS055
01296  3410-POSITION-AT-ERROR.                                          INKCS055
01297                                                                   INKCS055
01298      SET DP030-SET-CURSOR-APPL-1                                  INKCS055
01299                                    TO TRUE.                       INKCS055
01300      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 INKCS055
01301                     - PV-TOP-ITEM + 1.                            INKCS055
01302      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      INKCS055
01303          CONTINUE                                                 INKCS055
01304      ELSE                                                         INKCS055
01305          MOVE -1                   TO MR-SELECTL (PV-SUB)         INKCS055
01306          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         INKCS055
01307          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         INKCS055
01308      END-IF.                                                      INKCS055
01309 *                                                                 INKCS055
01310      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   INKCS055
01311                     - PV-TOP-ITEM + 1.                            INKCS055
01312      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      INKCS055
01313          CONTINUE                                                 INKCS055
01314      ELSE                                                         INKCS055
01315          MOVE -1                   TO MR-SELECTL (PV-SUB)         INKCS055
01316          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         INKCS055
01317          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         INKCS055
01318      END-IF.                                                      INKCS055
01319 /                                                                 INKCS055
01320 *----------------------------------------------------------------*INKCS055
01321 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *INKCS055
01322 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *INKCS055
01323 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *INKCS055
01324 *----------------------------------------------------------------*INKCS055
01325                                                                   INKCS055
01326  3500-MARK-RANGE-AS-SELECTED.                                     INKCS055
01327                                                                   INKCS055
01328      MOVE +1                       TO  ASC-BLK-SUB.               INKCS055
01329      PERFORM 3510-MARK-SELECTED-INDS                              INKCS055
01330          VARYING ASC-ITEM-SUB                                     INKCS055
01331          FROM 1 BY 1                                              INKCS055
01332          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
01333                                                                   INKCS055
01334      ADD +1                        TO ASC-BLK-SUB.                INKCS055
01335      PERFORM 3510-MARK-SELECTED-INDS                              INKCS055
01336          VARYING ASC-ITEM-SUB                                     INKCS055
01337          FROM 1 BY 1                                              INKCS055
01338          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 INKCS055
01339                                                                   INKCS055
01340      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               INKCS055
01341                                    TO  PV-LIST-ITEM-NUMBER.       INKCS055
01342      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            INKCS055
01343          1 + ((PV-LIST-ITEM-NUMBER - 1) /                         INKCS055
01344                PC-ITEMS-PER-PANEL).                               INKCS055
01345                                                                   INKCS055
01346      MOVE ASC-START-OF-SELECTED-RANGE                             INKCS055
01347                                    TO PV-START-OF-SELECTED-RANGE. INKCS055
01348      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            INKCS055
01349          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  INKCS055
01350                PC-ITEMS-PER-PANEL).                               INKCS055
01351                                                                   INKCS055
01352      MOVE ASC-END-OF-SELECTED-RANGE                               INKCS055
01353                                    TO  PV-END-OF-SELECTED-RANGE.  INKCS055
01354      COMPUTE PV-LAST-BLOCK-IN-RANGE =                             INKCS055
01355          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    INKCS055
01356                PC-ITEMS-PER-PANEL).                               INKCS055
01357      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             INKCS055
01358          PV-FIRST-BLOCK-IN-ARRAY + 1.                             INKCS055
01359                                                                   INKCS055
01360      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    INKCS055
01361         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        INKCS055
01362          MOVE +1                   TO ASC-BLK-SUB                 INKCS055
01363          PERFORM 5100-WRITE-TEMP-STORAGE                          INKCS055
01364          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         INKCS055
01365              PV-FIRST-BLOCK-IN-ARRAY - 1                          INKCS055
01366                                                                   INKCS055
01367          PERFORM                                                  INKCS055
01368              UNTIL PV-FIRST-BLOCK-IN-RANGE >                      INKCS055
01369                    PV-PREV-BLOCK-IN-ARRAY                         INKCS055
01370              MOVE PV-FIRST-BLOCK-IN-RANGE                         INKCS055
01371                                    TO PV-BLOCK-NUMBER             INKCS055
01372              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
01373              PERFORM 3510-MARK-SELECTED-INDS                      INKCS055
01374                  VARYING ASC-ITEM-SUB                             INKCS055
01375                  FROM 1 BY 1                                      INKCS055
01376                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
01377              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
01378              ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     INKCS055
01379          END-PERFORM                                              INKCS055
01380                                                                   INKCS055
01381          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         INKCS055
01382              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     INKCS055
01383          PERFORM                                                  INKCS055
01384              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       INKCS055
01385                    PV-LAST-BLOCK-IN-RANGE                         INKCS055
01386              MOVE PV-NEXT-BLOCK-IN-ARRAY                          INKCS055
01387                                    TO PV-BLOCK-NUMBER             INKCS055
01388              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
01389              PERFORM 3510-MARK-SELECTED-INDS                      INKCS055
01390                  VARYING ASC-ITEM-SUB                             INKCS055
01391                  FROM 1 BY 1                                      INKCS055
01392                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          INKCS055
01393              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
01394              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      INKCS055
01395          END-PERFORM                                              INKCS055
01396                                                                   INKCS055
01397          MOVE PV-FIRST-BLOCK-IN-ARRAY                             INKCS055
01398                                    TO PV-BLOCK-NUMBER             INKCS055
01399          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
01400      END-IF.                                                      INKCS055
01401                                                                   INKCS055
01402      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE INKCS055
01403                                       ASC-END-OF-SELECTED-RANGE.  INKCS055
01404 /                                                                 INKCS055
01405 *----------------------------------------------------------------*INKCS055
01406 * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *INKCS055
01407 *----------------------------------------------------------------*INKCS055
01408                                                                   INKCS055
01409  3510-MARK-SELECTED-INDS.                                         INKCS055
01410                                                                   INKCS055
01411      IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         INKCS055
01412                                 ASC-ITEM-SUB) >                   INKCS055
01413          ASC-START-OF-SELECTED-RANGE)                             INKCS055
01414      OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         INKCS055
01415                                 ASC-ITEM-SUB) =                   INKCS055
01416          ASC-START-OF-SELECTED-RANGE)                             INKCS055
01417                                                                   INKCS055
01418          IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     INKCS055
01419                                     ASC-ITEM-SUB) <               INKCS055
01420              ASC-END-OF-SELECTED-RANGE)                           INKCS055
01421          OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     INKCS055
01422                                     ASC-ITEM-SUB) =               INKCS055
01423              ASC-END-OF-SELECTED-RANGE)                           INKCS055
01424                                                                   INKCS055
01425              IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          INKCS055
01426                  SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   INKCS055
01427                      ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   INKCS055
01428                                TO TRUE                            INKCS055
01429                  SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              INKCS055
01430                                TO TRUE                            INKCS055
01431                  ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    INKCS055
01432              END-IF                                               INKCS055
01433          END-IF                                                   INKCS055
01434      END-IF.                                                      INKCS055
01435 /                                                                 INKCS055
01436 *----------------------------------------------------------------*INKCS055
01437 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *INKCS055
01438 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *INKCS055
01439 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *INKCS055
01440 *    DISPLAY THE PANEL TO USER.                                  *INKCS055
01441 *----------------------------------------------------------------*INKCS055
01442                                                                   INKCS055
01443  4000-BUILD-INITIAL-PANEL.                                        INKCS055
01444                                                                   INKCS055
01445      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            INKCS055
01446                                  ASC-BLOCK-ENTRIES (2).           INKCS055
01447      MOVE +1                 TO  ASC-BLK-SUB.                     INKCS055
01448      SET ASC-ITEMS-LEFT-ON-DB                                     INKCS055
01449                              TO TRUE.                             INKCS055
01450                                                                   INKCS055
01451      MOVE +0                 TO ASC-ITEM-SUB                      INKCS055
01452                                 ASC-NUMBER-OF-ITEMS-READ          INKCS055
01453                                 ASC-NUMBER-OF-SELECTED-ITEMS      INKCS055
01454                                 ASC-HIGHEST-BLOCK-WRITTEN         INKCS055
01455                                 ASC-START-OF-SELECTED-RANGE       INKCS055
01456                                 ASC-END-OF-SELECTED-RANGE         INKCS055
01457                                 ASC-ITEM-AT-TOP-OF-PANEL.         INKCS055
01458      PERFORM 4100-PREPARE-CURSOR.                                 INKCS055
01459                                                                   INKCS055
01460      PERFORM 4010-OPEN-CURSOR.                                    INKCS055
01461                                                                   INKCS055
W25428     MOVE 'N' TO PS-DUPLICATE-RECORD-SW.                          INKCS011
W25428                                                                  INKCS011
01462      PERFORM 4300-READ-ITEMS-FROM-DB.                             INKCS055
01463                                                                   INKCS055
01464      PERFORM 4020-CLOSE-CURSOR.                                   INKCS055
01465                                                                   INKCS055
01466      MOVE +1                   TO  PV-TOP-ITEM.                   INKCS055
01467      MOVE SPACE                TO  ASC-START-ITEM-REQUEST.        INKCS055
01468      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          INKCS055
01469          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    INKCS055
01470          SET DP020-MSG-FATAL   TO  TRUE                           INKCS055
01471          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               INKCS055
01472      ELSE                                                         INKCS055
01473          MOVE -1               TO MR-SELECTL (1)                  INKCS055
01474          SET DP030-SET-CURSOR-APPL-1                              INKCS055
01475                                TO TRUE                            INKCS055
01476          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     INKCS055
01477      END-IF.                                                      INKCS055
01478 /                                                                 INKCS055
01479 *----------------------------------------------------------------*INKCS055
01480 * OPEN THE CURSOR.                                               *INKCS055
01481 *----------------------------------------------------------------*INKCS055
01482                                                                   INKCS055
01483  4010-OPEN-CURSOR.                                                INKCS055
01484                                                                   INKCS055
W21732*        MOVE ASC-KEY-STORE-NBR      TO SUMINV-STORE-NBR          INKCS055
W21732*                                       ADJADD-STORE-NBR.         INKCS055
W21732         MOVE ASC-KEY-STORE-NBR      TO SUMINV-LOC-NBR            INKCS055
W21732                                        ADJADD-LOC-NBR.           INKCS055
W21732         MOVE ASC-KEY-AREA-NBR       TO SUMINV-AREA-NBR           INKCS055
W21732                                        ADJADD-AREA-NBR.          INKCS055
01484                                                                   INKCS055
01485          EXEC SQL                                                 INKCS055
01486               OPEN SUMMARY-CSR                                    INKCS055
01487          END-EXEC.                                                INKCS055
01488                                                                   INKCS055
01489          EVALUATE TRUE                                            INKCS055
01490              WHEN SQLCODE = ZERO                                  INKCS055
01491              WHEN SQLCODE = +100                                  INKCS055
01492                  CONTINUE                                         INKCS055
01493              WHEN SQLCODE = -904                                  INKCS055
01494              WHEN SQLCODE = -913                                  INKCS055
01495                   PERFORM 9900-SOFT-ABORT                         INKCS055
01496              WHEN SQLWARN0 NOT = SPACES                           INKCS055
01497              WHEN SQLCODE < ZERO                                  INKCS055
01498              WHEN SQLCODE > ZERO                                  INKCS055
01499                  MOVE '4010-OPEN-CURSOR'                          INKCS055
01500                                    TO DP013-PARAGRAPH             INKCS055
01501                  MOVE 'OPEN SUMMARY INVENTORY CURSOR - '          INKCS055
01502                                    TO DP013-MESSAGE-TEXT (1)      INKCS055
01503                  MOVE SQLCA        TO DP013-SQLCA                 INKCS055
01504                  MOVE 'TSUMINV '   TO DP013-DB2-TABLE-NAME (1)    INKCS055
01505                  SET DP013-DB2-ABEND                              INKCS055
01506                      DP013-XCTL-DISPLAY-RESTART TO TRUE           INKCS055
01507                  PERFORM DP013-0000-PROCESS-ABEND                 INKCS055
01508          END-EVALUATE.                                            INKCS055
01509 /                                                                 INKCS055
01510 *----------------------------------------------------------------*INKCS055
01511 * CLOSE THE TMESSAGE CURSOR.                                     *INKCS055
01512 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *INKCS055
01513 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *INKCS055
01514 *   USER.                                                        *INKCS055
01515 *----------------------------------------------------------------*INKCS055
01516                                                                   INKCS055
01517  4020-CLOSE-CURSOR.                                               INKCS055
01518                                                                   INKCS055
01519      EXEC SQL                                                     INKCS055
01520           CLOSE SUMMARY-CSR                                       INKCS055
01521      END-EXEC.                                                    INKCS055
01522                                                                   INKCS055
01523      EVALUATE TRUE                                                INKCS055
01524          WHEN SQLCODE = ZERO                                      INKCS055
01525              CONTINUE                                             INKCS055
01526          WHEN SQLWARN0 NOT = SPACES                               INKCS055
01527          WHEN SQLCODE < ZERO                                      INKCS055
01528          WHEN SQLCODE > ZERO                                      INKCS055
01529              MOVE '4020-CLOSE-CURSOR'                             INKCS055
01530                                TO DP013-PARAGRAPH                 INKCS055
01531              MOVE 'CLOSE SUMMARY INVENTORY CURSOR'                INKCS055
01532                                TO DP013-MESSAGE-TEXT (1)          INKCS055
01533              MOVE SQLCA        TO DP013-SQLCA                     INKCS055
01534              MOVE 'TSUMINV '   TO DP013-DB2-TABLE-NAME (1)        INKCS055
01535              SET DP013-DB2-ABEND                                  INKCS055
01536                  DP013-XCTL-DISPLAY-RESTART TO TRUE               INKCS055
01537              PERFORM DP013-0000-PROCESS-ABEND                     INKCS055
01538      END-EVALUATE.                                                INKCS055
01539 /                                                                 INKCS055
01540 *----------------------------------------------------------------*INKCS055
01541 *    SET UP THE HOST VARIABLES.                                  *INKCS055
01542 *----------------------------------------------------------------*INKCS055
01543                                                                   INKCS055
01544  4100-PREPARE-CURSOR.                                             INKCS055
01545                                                                   INKCS055
01546      MOVE IN001-STORE-NBR    TO  ASC-KEY-STORE-NBR.               INKCS055
01547      MOVE IN001-AREA-NBR     TO  ASC-KEY-AREA-NBR.                INKCS055
01548                                                                   INKCS055
01549 /                                                                 INKCS055
01550 *----------------------------------------------------------------*INKCS055
01551 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *INKCS055
01552 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *INKCS055
01553 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *INKCS055
01554 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *INKCS055
01555 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *INKCS055
01556 *                                                                *INKCS055
01557 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *INKCS055
01558 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *INKCS055
01559 *    UPON INITIALIZATION.                                        *INKCS055
W25428*    WITH UPC FUNCTIONALITY ADDED TO DB2 TABLES, MULTIPLE ROWS   *INKCS011
W25428*                                                                 INKCS011
W25428*    MAY EXIST AT A SKU/RETAIL LEVEL. THESE RECORDS WILL NOW BE  *INKCS011
W25428*    SUMMED TO ONE DISPLAY ROW EVEN IF MULTIPLE ROWS WERE FETCHED*INKCS011
W25428*                                                                 INKCS011
W25428*    DATABASE PROCESSING FLOW....                                 INKCS011
W25428*    1) FETCH INITIAL ROW SAVING OFF ROW TO CURRENT VARIABLE      INKCS011
W25428*    2) CHECK IF THE CURRENT ROW MATCHES THE PREVIOUS KEY FETCHED INKCS011
W25428*      A) IF CURRENT =  PREVIOUS, ACCUMULATE QTY AND EXTD VALUES  INKCS011
W25428*      B) IF CURRENT <> PREVIOUS, WRITE ACCUMULATED VALUES TO ASC-INKCS011
W25428*    3) FETCH SKU ATTRIBUTES TO DISPLAY ON SCREEN AS WELL         INKCS011
W25428*    4) WRITE ASC- SCREEN VALUES TO TEMP STORAGE                  INKCS011
01560 *----------------------------------------------------------------*INKCS055
01561                                                                   INKCS055
01562  4300-READ-ITEMS-FROM-DB.                                         INKCS055
01563                                                                   INKCS055
W25428     INITIALIZE PV-CURRENT-KEY.                                   INKCS011
W25428     INITIALIZE PV-PREVIOUS-KEY.                                  INKCS011
W25428*    INITIAL FETCH                                                INKCS011
R25428     MOVE 'N'                    TO PS-PROCESSED-SW.                      
W25428     PERFORM 4310-FETCH.                                          INKCS011
W25428*                                                                 INKCS011
W25428     MOVE SUMINV-SKU-NBR         TO PV-CURR-SKU-NBR               INKCS011
W25428                                    PV-PREV-SKU-NBR.              INKCS011
W25428     MOVE SUMINV-UPC-NBR         TO PV-CURR-UPC-NBR               INKCS011
W25428                                    PV-PREV-UPC-NBR.              INKCS011
W25428     MOVE SUMINV-INV-UNIT-PR-AMT TO PV-CURR-UNIT-RETAIL           INKCS011
W25428                                    PV-PREV-UNIT-RETAIL.          INKCS011
W25428     MOVE PV-CURR-SOURCE-TABLE   TO PV-PREV-SOURCE-TABLE.         INKCS011
W25428*                                                                 INKCS011
01564      PERFORM                                                      INKCS055
01565          VARYING PV-READ-COUNT                                    INKCS055
01566          FROM 1 BY 1                                              INKCS055
01567          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    INKCS055
01568             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         INKCS055
01569                                                                   INKCS055
W25428*        PERFORM 4310-FETCH                                       INKCS055
W25428         PERFORM 4320-PROCESS-DUP-KEYS                            INKCS011
W25428             UNTIL                                                        
W25428             ((PV-CURR-SKU-NBR     NOT EQUAL PV-PREV-SKU-NBR)             
W25428           OR (PV-CURR-UNIT-RETAIL NOT EQUAL PV-PREV-UNIT-RETAIL))INKCS011
W25428           OR (ASC-NO-ITEMS-LEFT-ON-DB)                           INKCS011
W25428                                                                  INKCS011
W25428             MOVE PA-ACCUM-SKU      TO PV-KEY-SKU                         
W25428             MOVE PA-ACCUM-UPC      TO PV-KEY-UPC                         
W25428             MOVE PA-ACCUM-QTY      TO PV-KEY-QTY                         
W25428             MOVE PA-ACCUM-RTL      TO PV-KEY-RTL                 INKCS011
W25428             MOVE PA-ACCUM-EXTD-RTL TO PV-KEY-EXTD-RTL            INKCS011
W25428*                                                                 INKCS011
W25428             PERFORM 4325-LOAD-ASC-AREA                           INKCS011
W25428                                                                  INKCS011
W25428             INITIALIZE PV-KEY-RECORD                             INKCS011
W25428                        PA-PROGRAM-ACCUMULATOR                    INKCS011
W25428                                                                  INKCS011
W25428             MOVE PV-CURR-SKU-NBR      TO PV-PREV-SKU-NBR                 
W25428             MOVE PV-CURR-UPC-NBR      TO PV-PREV-UPC-NBR                 
W25428             MOVE PV-CURR-UNIT-RETAIL  TO PV-PREV-UNIT-RETAIL     INKCS011
W25428             MOVE PV-CURR-SOURCE-TABLE TO PV-ROW-TYPE             INKCS011
W25428                                          PV-PREV-SOURCE-TABLE    INKCS011
01571                                                                   INKCS055
01627      END-PERFORM.                                                 INKCS055
01628                                                                   INKCS055
01629      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          INKCS055
01630          MOVE +1               TO ASC-BLK-SUB                     INKCS055
01631          PERFORM 5100-WRITE-TEMP-STORAGE                          INKCS055
01632          ADD +1                TO ASC-BLK-SUB                     INKCS055
01633          PERFORM 5100-WRITE-TEMP-STORAGE                          INKCS055
01634                                                                   INKCS055
01635          MOVE 1                TO ASC-BLK-SUB                     INKCS055
01636                                   PV-BLOCK-NUMBER                 INKCS055
01637          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
01638          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             INKCS055
01639              MOVE 2            TO ASC-BLK-SUB                     INKCS055
01640                                   PV-BLOCK-NUMBER                 INKCS055
01641              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
01642          END-IF                                                   INKCS055
01643      END-IF.                                                      INKCS055
01644                                                                   INKCS055
01645 /                                                                 INKCS055
01646 *----------------------------------------------------------------*INKCS055
01647 *    FETCH THE CURSOR.                                           *INKCS055
01648 *----------------------------------------------------------------*INKCS055
01649                                                                   INKCS055
01650  4310-FETCH.                                                      INKCS055
01651                                                                   INKCS055
01652      EXEC SQL                                                     INKCS055
01653           FETCH                                                   INKCS055
01654                 SUMMARY-CSR                                       INKCS055
01655           INTO                                                    INKCS055
W21732                :SUMINV-SKU-NBR                                   INKCS055
W25428              , :SUMINV-UPC-NBR                                   INKCS011
01659               , :SUMINV-INV-UNIT-PR-AMT                           INKCS055
01660               , :SUMINV-INV-QTY                                   INKCS055
01661               , :SUMINV-EXTD-AMT                                  INKCS055
01662               , :PV-ROW-TYPE                                      INKCS055
01663      END-EXEC.                                                    INKCS055
01664                                                                   INKCS055
01665      EVALUATE TRUE                                                INKCS055
01666          WHEN SQLCODE = ZERO                                      INKCS055
W25428              MOVE SUMINV-SKU-NBR         TO PV-CURR-SKU-NBR      INKCS011
W25428              MOVE SUMINV-UPC-NBR         TO PV-CURR-UPC-NBR      INKCS011
W25428              MOVE SUMINV-INV-UNIT-PR-AMT TO PV-CURR-UNIT-RETAIL  INKCS011
W25428              MOVE PV-ROW-TYPE            TO PV-CURR-SOURCE-TABLE         
01667          WHEN SQLCODE = +100                                      INKCS011
01668 *             CONTINUE                                            INKCS055
W25428              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 INKCS011
01669          WHEN SQLCODE = -904                                      INKCS055
01670          WHEN SQLCODE = -913                                      INKCS055
01671               PERFORM 9900-SOFT-ABORT                             INKCS055
01672          WHEN SQLWARN0 NOT = SPACE                                INKCS055
01673          WHEN SQLCODE NOT = ZERO                                  INKCS055
01674               MOVE '4310-FETCH-CURSOR'                            INKCS055
01675                                TO DP013-PARAGRAPH                 INKCS055
01676               MOVE 'FETCH SUMMARY INVENTORY CURSOR'               INKCS055
01677                                TO DP013-MESSAGE-TEXT (1)          INKCS055
01678               MOVE SQLCA       TO DP013-SQLCA                     INKCS055
01679               MOVE 'TSUMINV '  TO DP013-DB2-TABLE-NAME (1)        INKCS055
01680               SET DP013-DB2-ABEND                                 INKCS055
01681                                TO TRUE                            INKCS055
01682               PERFORM DP013-0000-PROCESS-ABEND                    INKCS055
01683      END-EVALUATE.                                                INKCS055
01684                                                                   INKCS055
01685      IF  SQLCODE EQUAL +100                                       INKCS055
01686          SET ASC-NO-ITEMS-LEFT-ON-DB                              INKCS055
01687                                TO TRUE                            INKCS055
01688      END-IF.                                                      INKCS055
01689 /                                                                 INKCS055
W25428*----------------------------------------------------------------*INKCS011
W25428* CHECK IF THIS RECORD IS THE SAME KEY AS WAS PREVIOUSLY FETCHED. INKCS011
W25428* DUPLICATE RECORDS WILL HAVE THE SAME STORE/AREA/SKU/RETAIL,     INKCS011
W25428* BUT WILL HAVE DIFFERENT UPC NUMBERS AND DKEY_NBR.               INKCS011
W25428*----------------------------------------------------------------*INKCS011
W25428                                                                  INKCS011
W25428 4320-PROCESS-DUP-KEYS.                                           INKCS011
W25428                                                                  INKCS011
W25428     MOVE PV-PREV-SKU-NBR     TO PA-ACCUM-SKU.                            
W25428     MOVE PV-PREV-UPC-NBR     TO PA-ACCUM-UPC.                            
W25428     MOVE PV-PREV-UNIT-RETAIL TO PA-ACCUM-RTL.                            
W25428                                                                          
W25428     COMPUTE PA-ACCUM-QTY      = PA-ACCUM-QTY                             
W25428                               + SUMINV-INV-QTY.                          
W25428     COMPUTE PA-ACCUM-EXTD-RTL = PA-ACCUM-EXTD-RTL                INKCS011
W25428                               + SUMINV-EXTD-AMT.                 INKCS011
W25428                                                                  INKCS011
W25428*    IF PV-TADJADD                                                INKCS011
W25428*        MOVE 'ADJ' TO PV-PREV-SOURCE-TABLE                       INKCS011
W25428*    END-IF.                                                      INKCS011
W25428                                                                  INKCS011
R25428     MOVE 'Y'                    TO PS-PROCESSED-SW.                      
W25428     PERFORM 4310-FETCH.                                          INKCS011
W25428                                                                  INKCS011
W25428*----------------------------------------------------------------*INKCS011
W25428*    PREP SCREEN. THIS LOGIC WAS CONTAINED IN THE 4300-READ PARA. INKCS011
W25428*    MOVE TO SEPARATE MODULE TO ACCOUNT FOR DUP RECORDS HANDLING. INKCS011
W25428*----------------------------------------------------------------*INKCS011
W25428                                                                  INKCS011
W25428 4325-LOAD-ASC-AREA.                                              INKCS011
01645 /                                                                 INKCS011
01574          IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    INKCS011
01575              ADD +1                TO  ASC-ITEM-SUB               INKCS011
01576          ELSE                                                     INKCS011
01577              ADD +1                TO  ASC-BLK-SUB                INKCS011
01578              MOVE +1               TO  ASC-ITEM-SUB               INKCS011
01579                                                                           
01580              IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             INKCS011
01581                  MOVE +1           TO  ASC-BLK-SUB                INKCS011
01582                  SET ASC-BLOCK-MODIFIED (1)                       INKCS011
01583                                    TO  TRUE                       INKCS011
01584                  PERFORM 5100-WRITE-TEMP-STORAGE                  INKCS011
01585                  MOVE ASC-BLOCK-ENTRIES                           INKCS011
01586                            (PC-MAX-BLOCKS-IN-ARRAY)               INKCS011
01587                             TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)             
01588                  ADD +1            TO  ASC-BLK-SUB                INKCS011
01589                  INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        INKCS011
01590                  SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          INKCS011
01591                                    TO  TRUE                       INKCS011
01592              END-IF                                               INKCS011
01593          END-IF                                                   INKCS011
01573                                                                   INKCS011
01572          IF  ASC-ITEMS-LEFT-ON-DB                                 INKCS011
R25428             MOVE 'N'              TO PS-PROCESSED-SW                     
01595              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    INKCS011
01596              MOVE ASC-NUMBER-OF-ITEMS-READ                        INKCS011
01597                                    TO ASC-LIST-ITEM-NUMBER        INKCS011
01598                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS011
W25428             MOVE PA-ACCUM-SKU     TO  PV-SKU                     INKCS011
W21732             MOVE PV-SKU           TO  ASC-SKU                    INKCS011
W21732                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
W25428             MOVE PA-ACCUM-RTL                                    INKCS011
01609                                    TO  ASC-PR-AMT                 INKCS011
01610                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
W25428             MOVE PA-ACCUM-QTY     TO  ASC-INV-QTY                INKCS011
01613                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
W25428             ADD PA-ACCUM-QTY      TO  PV-INV-QTY-TTL             INKCS011
W25428             MOVE PA-ACCUM-EXTD-RTL TO  ASC-PR-EXT-AMT            INKCS011
01616                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
W25428             ADD PA-ACCUM-EXTD-RTL TO  PV-PR-EXT-AMT-TTL          INKCS011
W25428*                                                                 INKCS011
W25428*            RETRIEVE ASSOCIATED SKU ATTRIBUTES (TSUMINV ROWS)    INKCS011
01617              IF  PV-PREV-SOURCE-TABLE = 'SUM' OR                  INKCS011
R25428                 PV-PREV-SOURCE-TABLE = '   '                     INKCS011
01619                  MOVE DP015-BLUE                                  INKCS011
01620                      TO ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)      INKCS011
W25428*                                                                 INKCS011
W25428                 PERFORM 4600-TSUMINV-SKU-ATTR                    INKCS011
W25428                     MOVE SUMINV-DEPT-NBR   TO PV-HOLD-DEPT       INKCS011
W25428                     MOVE SUMINV-MAJ-CL-NBR TO PV-HOLD-MCL        INKCS011
W25428                     MOVE SUMINV-SUB-CL-NBR TO PV-HOLD-SCL        INKCS011
W25428                     MOVE PV-HOLD-DEPT      TO PV-DMS-DEPT        INKCS011
W25428                     MOVE PV-HOLD-MCL       TO PV-DMS-MCL         INKCS011
W25428                     MOVE PV-HOLD-SCL       TO PV-DMS-SCL         INKCS011
W25428                     MOVE PV-HOLD-DMS       TO ASC-DMS            INKCS011
W25428                                        (ASC-BLK-SUB ASC-ITEM-SUB)INKCS011
01621              ELSE                                                 INKCS011
W25428*                RETRIEVE ASSOCIATED SKU ATTRIBUTES (TADJADD ROWS)INKCS011
01622                  MOVE DP015-TURQUOISE                             INKCS011
01624                       TO ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)     INKCS011
W25428                 MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)                  
W25428                                                    TO SKXREF-SKU         
W25428                 PERFORM 4700-TSKXREF-SKU-ATTR                            
W25428                     MOVE SKXREF-DEPT       TO PV-HOLD-DEPT       INKCS011
W25428                     MOVE SKXREF-CLASS      TO PV-HOLD-MCL        INKCS011
W25428                     MOVE SKXREF-SUBCLASS   TO PV-HOLD-SCL        INKCS011
W25428                     MOVE PV-HOLD-DEPT      TO PV-DMS-DEPT        INKCS011
W25428                     MOVE PV-HOLD-MCL       TO PV-DMS-MCL         INKCS011
W25428                     MOVE PV-HOLD-SCL       TO PV-DMS-SCL         INKCS011
W25428                     MOVE PV-HOLD-DMS       TO ASC-DMS            INKCS011
W25428                                        (ASC-BLK-SUB ASC-ITEM-SUB)INKCS011
01625              END-IF                                               INKCS011
01594                                                                   INKCS011
P1572          ELSE                                                     INKCS011
R25428         IF RECORD-PROCESSED                                              
R25428             PERFORM 4526-ADD-ROW                                         
R25428         ELSE                                                             
P1595              IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   INKCS011
P1595                  ADD +1            TO ASC-NUMBER-OF-ITEMS-READ    INKCS011
P1596                  MOVE ASC-NUMBER-OF-ITEMS-READ                    INKCS011
P1597                                    TO ASC-LIST-ITEM-NUMBER        INKCS011
P1598                                       (ASC-BLK-SUB ASC-ITEM-SUB)  INKCS011
W21732*                MOVE SPACES       TO  ASC-SKU                    INKCS011
W25428**               MOVE ZEROES       TO  ASC-SKU                    INKCS011
W26600                 MOVE SPACES       TO  ASC-SKU-X                  INKCS011
W21732                                       (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
R25428                 MOVE 'AREA TOTAL:'  TO ASC-DMS                   INKCS011
R25428                                        (ASC-BLK-SUB ASC-ITEM-SUB)INKCS011
P1609                  MOVE ZERO         TO  ASC-PR-AMT                 INKCS011
P1610                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
P1612                  MOVE PV-INV-QTY-TTL                              INKCS011
P1612                                    TO  ASC-INV-QTY                INKCS011
P1613                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
P1615                  MOVE PV-PR-EXT-AMT-TTL                           INKCS011
P1615                                    TO  ASC-PR-EXT-AMT             INKCS011
P1616                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
P1619                  MOVE DP015-BLUE   TO  ASC-COLOR                  INKCS011
P1620                                        (ASC-BLK-SUB ASC-ITEM-SUB) INKCS011
P1626              END-IF                                               INKCS011
01626          END-IF.                                                  INKCS011
W25428                                                                  INKCS011
R25428******************************************************************INKCS011
  |   * 4526-ADD-ROW.                                                   INKCS011
  |   *     END OF AREA_NBR LOGIC TO MAKE SURE WE HAVE LOADED THE LAST  INKCS011
  |   * SKU/UPC FOR THE AREA...                                         INKCS011
  |   ******************************************************************INKCS011
  |    4526-ADD-ROW.                                                    INKCS011
  |                                                                     INKCS011
  |        ADD +1                TO ASC-NUMBER-OF-ITEMS-READ.                   
  |        MOVE ASC-NUMBER-OF-ITEMS-READ                                        
  |                              TO ASC-LIST-ITEM-NUMBER                        
  |                                 (ASC-BLK-SUB ASC-ITEM-SUB).                 
  |        MOVE PA-ACCUM-SKU     TO  PV-SKU.                                    
  |        MOVE PV-SKU           TO  ASC-SKU                                    
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB).                
  |        MOVE PA-ACCUM-RTL                                                    
  |                              TO  ASC-PR-AMT                                 
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB).                
  |        MOVE PA-ACCUM-QTY     TO  ASC-INV-QTY                                
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB).                
  |        ADD PA-ACCUM-QTY      TO  PV-INV-QTY-TTL.                            
  |        MOVE PA-ACCUM-EXTD-RTL TO  ASC-PR-EXT-AMT                            
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB).                
  |        ADD PA-ACCUM-EXTD-RTL TO  PV-PR-EXT-AMT-TTL.                         
  |                                                                             
  |        IF  PV-PREV-SOURCE-TABLE = 'SUM' OR                                  
  |            PV-PREV-SOURCE-TABLE = '   '                                     
  |            MOVE DP015-BLUE                                                  
  |                TO ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)                      
  |                                                                             
  |            PERFORM 4600-TSUMINV-SKU-ATTR                                    
  |                MOVE SUMINV-DEPT-NBR   TO PV-HOLD-DEPT                       
  |                MOVE SUMINV-MAJ-CL-NBR TO PV-HOLD-MCL                        
  |                MOVE SUMINV-SUB-CL-NBR TO PV-HOLD-SCL                        
  |                MOVE PV-HOLD-DEPT      TO PV-DMS-DEPT                        
  |                MOVE PV-HOLD-MCL       TO PV-DMS-MCL                         
  |                MOVE PV-HOLD-SCL       TO PV-DMS-SCL                         
  |                MOVE PV-HOLD-DMS       TO ASC-DMS                            
  |                                   (ASC-BLK-SUB ASC-ITEM-SUB)                
  |        ELSE                                                                 
  |            MOVE DP015-TURQUOISE                                             
  |                 TO ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)                     
  |            MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)                          
  |                                               TO SKXREF-SKU                 
  |            PERFORM 4700-TSKXREF-SKU-ATTR                                    
  |                MOVE SKXREF-DEPT       TO PV-HOLD-DEPT                       
  |                MOVE SKXREF-CLASS      TO PV-HOLD-MCL                        
  |                MOVE SKXREF-SUBCLASS   TO PV-HOLD-SCL                        
  |                MOVE PV-HOLD-DEPT      TO PV-DMS-DEPT                        
  |                MOVE PV-HOLD-MCL       TO PV-DMS-MCL                         
  |                MOVE PV-HOLD-SCL       TO PV-DMS-SCL                         
  |                MOVE PV-HOLD-DMS       TO ASC-DMS                            
  |                                   (ASC-BLK-SUB ASC-ITEM-SUB)                
  |        END-IF.                                                              
  |                                                                             
  |        IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        S011    
  |            ADD +1                TO  ASC-ITEM-SUB                   S011    
  |        ELSE                                                         S011    
  |            ADD +1                TO  ASC-BLK-SUB                    S011    
  |            MOVE +1               TO  ASC-ITEM-SUB                   S011    
  |                                                                             
  |            IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 S011    
  |                MOVE +1           TO  ASC-BLK-SUB                    S011    
  |                SET ASC-BLOCK-MODIFIED (1)                           S011    
  |                                  TO  TRUE                           S011    
  |                PERFORM 5100-WRITE-TEMP-STORAGE                      S011    
  |                MOVE ASC-BLOCK-ENTRIES                               S011    
  |                          (PC-MAX-BLOCKS-IN-ARRAY)                   S011    
  |                           TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                 
  |                ADD +1            TO  ASC-BLK-SUB                    S011    
  |                INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)            S011    
  |                SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              S011    
  |                                  TO  TRUE                           S011    
  |            END-IF                                                   S011    
  |        END-IF.                                                      S011    
  |                                                                     S011    
  |        MOVE 'N' TO PS-PROCESSED-SW.                                         
  |                                                                     S011    
  |        IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           S011    
  |            ADD +1            TO ASC-NUMBER-OF-ITEMS-READ            S011    
  |            MOVE ASC-NUMBER-OF-ITEMS-READ                            S011    
  |                              TO ASC-LIST-ITEM-NUMBER                S011    
  |                                     (ASC-BLK-SUB ASC-ITEM-SUB)      S011    
  |            MOVE 'AREA TOTAL:'  TO ASC-DMS                           INKCS011
  |                                       (ASC-BLK-SUB ASC-ITEM-SUB)    INKCS011
W26600*        MOVE ZEROES       TO  ASC-SKU                            S011    
W26600*                                   (ASC-BLK-SUB ASC-ITEM-SUB)    S011    
W26600         MOVE SPACES       TO  ASC-SKU-X                          S011    
W26600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     S011    
  |            MOVE ZERO         TO  ASC-PR-AMT                         S011    
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB)         S011    
  |            MOVE PV-INV-QTY-TTL  TO ASC-INV-QTY                      S011    
  |                                    (ASC-BLK-SUB ASC-ITEM-SUB)       S011    
  |            MOVE PV-PR-EXT-AMT-TTL                                   S011    
  |                              TO  ASC-PR-EXT-AMT                     S011    
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB)         S011    
  |            MOVE DP015-BLUE   TO  ASC-COLOR                          S011    
  |                                  (ASC-BLK-SUB ASC-ITEM-SUB)         S011    
  |        END-IF.                                                      S011    
R25428                                                                  INKCS011
01690 *----------------------------------------------------------------*INKCS055
01691 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *INKCS055
01692 *----------------------------------------------------------------*INKCS055
01693                                                                   INKCS055
01694  4400-MOVE-COMMAREA-TO-SCREEN.                                    INKCS055
01695                                                                   INKCS055
01696      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             INKCS055
01697          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          INKCS055
01698          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          INKCS055
01699              MOVE +1    TO ASC-BLK-SUB                            INKCS055
01700              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
01701              ADD +1     TO ASC-BLK-SUB                            INKCS055
01702              PERFORM 5100-WRITE-TEMP-STORAGE                      INKCS055
01703              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             INKCS055
01704                  GIVING PV-BLOCK-NUMBER                           INKCS055
01705                  REMAINDER PV-REMAINDER                           INKCS055
01706              IF  PV-REMAINDER > ZERO                              INKCS055
01707                  ADD +1 TO PV-BLOCK-NUMBER                        INKCS055
01708              END-IF                                               INKCS055
01709              MOVE +1    TO ASC-BLK-SUB                            INKCS055
01710              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
01711              ADD +1     TO ASC-BLK-SUB                            INKCS055
01712                            PV-BLOCK-NUMBER                        INKCS055
01713              PERFORM 4410-READ-TEMP-STORAGE                       INKCS055
01714      END-IF.                                                      INKCS055
01715                                                                   INKCS055
01716      MOVE +1            TO ASC-BLK-SUB.                           INKCS055
01717      COMPUTE ASC-ITEM-SUB =                                       INKCS055
01718          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              INKCS055
01719          + PC-ITEMS-PER-PANEL).                                   INKCS055
01720                                                                   INKCS055
01721      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        INKCS055
01722          ADD +1         TO ASC-BLK-SUB                            INKCS055
01723          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            INKCS055
01724      END-IF.                                                      INKCS055
01725                                                                   INKCS055
01726      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           INKCS055
01727          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                INKCS055
01728      PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        INKCS055
01729      PERFORM 4420-FORMAT-LIST-LINES                               INKCS055
01730          VARYING PV-SUB                                           INKCS055
01731          FROM PC-ITEMS-PER-PANEL BY -1                            INKCS055
01732          UNTIL PV-SUB < +1.                                       INKCS055
01733                                                                   INKCS055
01734      COMPUTE ASC-ITEMS-DISPLAYED =                                INKCS055
01735          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          INKCS055
01736      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   INKCS055
01737      IF  PS-NO-ERROR                                              INKCS055
01738          MOVE PV-TOP-ITEM          TO ASTRTITO                    INKCS055
01739      END-IF.                                                      INKCS055
01740                                                                   INKCS055
01741      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    INKCS055
01742      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    INKCS055
01743      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            INKCS055
01744                                    TO ASELITO.                    INKCS055
01745      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     INKCS055
W26600     MOVE IN001-STORE-NBR          TO ASTRNBRO.                   INKCS055
01746      MOVE IN001-STORE-NAME         TO ASTRNAMO.                   INKCS055
01747      MOVE IN001-AREA-NBR           TO AAREAO.                     INKCS055
01748                                                                   INKCS055
01749      IF  DP020-MSG-NUMBER-X = SPACE                               INKCS055
01750          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  INKCS055
01751 *            --- MORE ITEMS TO DISPLAY ----                       INKCS055
01752              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            INKCS055
01753              SET DP020-MSG-INFORMATIONAL TO TRUE                  INKCS055
01754          END-IF                                                   INKCS055
01755      END-IF.                                                      INKCS055
01756                                                                   INKCS055
01757 *----------------------------------------------------------------*INKCS055
01758 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *INKCS055
01759 *----------------------------------------------------------------*INKCS055
01760                                                                   INKCS055
01761  4410-READ-TEMP-STORAGE.                                          INKCS055
01762                                                                   INKCS055
01763      EXEC CICS                                                    INKCS055
01764          READQ TS                                                 INKCS055
01765              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
01766              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               INKCS055
01767              ITEM  (PV-BLOCK-NUMBER)                              INKCS055
01768              RESP  (PV-CICS-RESP)                                 INKCS055
01769      END-EXEC.                                                    INKCS055
01770                                                                   INKCS055
01771      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       INKCS055
01772        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     INKCS055
01773          CONTINUE                                                 INKCS055
01774      ELSE                                                         INKCS055
01775          SET DP013-CICS-ABEND     TO TRUE                         INKCS055
01776          SET DP013-NO-ROLLBACK    TO TRUE                         INKCS055
01777          MOVE '4410-READ-TEMP-STORAGE'                            INKCS055
01778                                   TO DP013-PARAGRAPH              INKCS055
01779          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      INKCS055
01780                                   TO DP013-MESSAGE-TEXT(1)        INKCS055
01781          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
01782      END-IF.                                                      INKCS055
01783                                                                   INKCS055
01784      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             INKCS055
01785                                                                   INKCS055
01786      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         INKCS055
01787          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               INKCS055
01788      END-IF.                                                      INKCS055
01789 /                                                                 INKCS055
01790 *----------------------------------------------------------------*INKCS055
01791 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *INKCS055
01792 *----------------------------------------------------------------*INKCS055
01793                                                                   INKCS055
01794  4420-FORMAT-LIST-LINES.                                          INKCS055
01795                                                                   INKCS055
01796      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      INKCS055
01797          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                INKCS055
01798          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      INKCS055
01799          MOVE SPACE              TO MR-SELECTI      (PV-SUB)      INKCS055
01800                                     MR-ACTION       (PV-SUB)      INKCS055
W25428                                    MR-DMS          (PV-SUB)      INKCS011
W21732                                    MR-SKU          (PV-SUB)      INKCS055
01804                                     MR-INV-QTY-X    (PV-SUB)      INKCS055
01805                                     MR-PR-AMT-X     (PV-SUB)      INKCS055
01806                                     MR-PR-EXT-AMT-X (PV-SUB)      INKCS055
01807                                     MR-ADJ-MSG      (PV-SUB)      INKCS055
01808      ELSE                                                         INKCS055
01809          IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      INKCS055
01810                                                    > SPACE        INKCS055
01811              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) INKCS055
01812                                  TO MR-SELECTI (PV-SUB)           INKCS055
01813          ELSE                                                     INKCS055
01814              MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      INKCS055
01815                                  TO MR-SELECTI (PV-SUB)           INKCS055
01816          END-IF                                                   INKCS055
01817                                                                   INKCS055
01818          IF  DP030-SET-CURSOR-TRAILER                             INKCS055
01819              IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)INKCS055
01820                  > SPACE)                                         INKCS055
01821                OR (PV-SUB = 1))                                   INKCS055
01822                 SET DP030-SET-CURSOR-APPL-1 TO TRUE               INKCS055
01823                 MOVE -1          TO MR-SELECTL (PV-SUB)           INKCS055
01824              END-IF                                               INKCS055
01825          END-IF                                                   INKCS055
01826                                                                   INKCS055
01827          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           INKCS055
01828              MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
01829                                  TO  MR-ACTION        (PV-SUB)    INKCS055
W25428             MOVE ASC-DMS            (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS011
W25428                                 TO  MR-DMS           (PV-SUB)    INKCS011
W21732             MOVE ASC-SKU            (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
W21732                                 TO  MR-SKU           (PV-SUB)    INKCS055
01836                                                                   INKCS055
01837              MOVE ASC-INV-QTY        (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
01838                                  TO  MR-INV-QTY       (PV-SUB)    INKCS055
01839              MOVE ASC-PR-AMT         (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
01840                                  TO  MR-PR-AMT        (PV-SUB)    INKCS055
01841              MOVE ASC-PR-EXT-AMT     (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
01842                                  TO  MR-PR-EXT-AMT    (PV-SUB)    INKCS055
01843              MOVE ASC-COLOR          (ASC-BLK-SUB ASC-ITEM-SUB)   INKCS055
W21732                                 TO  MR-SKUC          (PV-SUB)    INKCS055
01847                                      MR-INV-QTYC      (PV-SUB)    INKCS055
01848                                      MR-PR-AMTC       (PV-SUB)    INKCS055
01849                                      MR-PR-EXT-AMTC   (PV-SUB)    INKCS055
01850                                                                   INKCS055
W21015******************************************************************INKCS055
W21015** THE LIST SCREEN INDICATES IF THE INITIAL ADJUSTMENT HAS COME **INKCS055
W21015** FROM THE MASS ADD SCREEN - BY LISTING A REASON 'ADJ ADD'.    **INKCS055
W21015** THESE RECORDS RESIDE ON TADJADD.  ADJUSTMENTS TO A SCANNING  **        
W21015** SERVICES DATA WILL HAVE NO REASON - THESE COME FROM TSUMINV. **        
W21015******************************************************************INKCS055
W21015** TADJADD ROW                                                    INKCS055
                   IF  ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL       INKCS055
                       DP015-TURQUOISE                                  INKCS055
W21015                     MOVE PC-ADJ-MSG2                                     
W21015                                      TO MR-ADJ-MSG (PV-SUB)              
                   ELSE                                                 INKCS055
W21015** TOTAL ROW                                                      INKCS055
W21015                 PERFORM 4500-SELECT-TADJDTL-ROW                  INKCS055
W21015*                    EVALUATE TRUE                                INKCS055
W21015*                        WHEN SQLCODE = ZERO                              
W21015*                        WHEN SQLCODE = -811                              
W21015** TADJDTL ROW FOR ADJUSTED SCANNED DATA                          INKCS055
W21015*                             MOVE PC-ADJ-MSG1                            
W21015*                                     TO MR-ADJ-MSG (PV-SUB)              
W25428                 EVALUATE TRUE                                    INKCS011
W25428                     WHEN SQLCODE = ZERO                                  
W25428                     WHEN SQLCODE = -811                                  
W25428                          MOVE PC-ADJ-MSG1  TO MR-ADJ-MSG (PV-SUB)        
W25428                          MOVE ADJDTL-SKU-NBR TO SKXREF-SKU               
W25428*                         RETRIEVE SKU ATTR FROM TSKXREF                  
W25428                          PERFORM 4700-TSKXREF-SKU-ATTR                   
W25428*                                                                 INKCS011
W25428                          MOVE SKXREF-DEPT     TO PV-HOLD-DEPT    INKCS011
W25428                          MOVE SKXREF-CLASS    TO PV-HOLD-MCL     INKCS011
W25428                          MOVE SKXREF-SUBCLASS TO PV-HOLD-SCL     INKCS011
W25428*                                                                 INKCS011
W25428                          MOVE PV-HOLD-DEPT    TO PV-DMS-DEPT     INKCS011
W25428                          MOVE PV-HOLD-MCL     TO PV-DMS-MCL      INKCS011
W25428                          MOVE PV-HOLD-SCL     TO PV-DMS-SCL      INKCS011
W25428*                                                                 INKCS011
W25428                          MOVE PV-HOLD-DMS     TO MR-DMS (PV-SUB) INKCS011
W25428*                                       (ASC-BLK-SUB ASC-ITEM-SUB)INKCS011
W21015                         WHEN SQLCODE = +100                              
W21015** TSUMINV ROW                                                    INKCS055
W21015                              MOVE PC-NO-ADJ-MSG                          
W21015                                      TO MR-ADJ-MSG (PV-SUB)              
W21015                         WHEN SQLCODE = -904                              
W21015                         WHEN SQLCODE = -913                              
W21015                              PERFORM 9900-SOFT-ABORT                     
W21015                         WHEN SQLWARN0 NOT = SPACE                        
W21015                         WHEN SQLCODE NOT = ZERO                          
W21015                              MOVE '4500-SELECT-TADJDTL-ROW'              
W21015                                       TO DP013-PARAGRAPH                 
W21015                              MOVE 'SELECT TADJDTL ROW'                   
W21015                                       TO DP013-MESSAGE-TEXT (1)          
W21015                              MOVE SQLCA TO DP013-SQLCA                   
W21015                              MOVE 'TSUMINV '                             
W21015                                       TO DP013-DB2-TABLE-NAME (1)        
W21015                              SET DP013-DB2-ABEND                         
W21015                                       TO TRUE                            
W21015                            PERFORM DP013-0000-PROCESS-ABEND              
W21015                    END-EVALUATE                                          
01858          END-IF                                                   INKCS055
01859      END-IF.                                                      INKCS055
01860                                                                   INKCS055
01861      SUBTRACT +1 FROM ASC-ITEM-SUB                                INKCS055
01862      IF  ASC-ITEM-SUB < + 1                                       INKCS055
01863          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  INKCS055
01864          MOVE +1                 TO ASC-BLK-SUB                   INKCS055
01865      END-IF.                                                      INKCS055
01866                                                                   INKCS055
01867 ******************************************************************INKCS055
01868 ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **INKCS055
01869 ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **INKCS055
01870 ** ISSUE A WARNING.                                             **INKCS055
01871 ******************************************************************INKCS055
01872                                                                   INKCS055
01873  4430-CHECK-FOR-BEGIN-AND-END.                                    INKCS055
01874                                                                   INKCS055
01875      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       INKCS055
01876          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     INKCS055
01877 *            -- NO END-OF-RANGE SPECFIED ---                      INKCS055
01878              MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            INKCS055
01879              SET DP020-MSG-WARNING TO TRUE                        INKCS055
01880              PERFORM 4431-POSITION-AT-WARNING                     INKCS055
01881          END-IF                                                   INKCS055
01882      ELSE                                                         INKCS055
01883          IF  ASC-END-OF-SELECTED-RANGE > ZERO                     INKCS055
01884 *            -- NO BEGINNING-OF-RANGE SPECFIED ---                INKCS055
01885              MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            INKCS055
01886              SET DP020-MSG-WARNING TO TRUE                        INKCS055
01887              PERFORM 4431-POSITION-AT-WARNING                     INKCS055
01888          END-IF                                                   INKCS055
01889      END-IF.                                                      INKCS055
01890 ******************************************************************INKCS055
01891 ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **INKCS055
01892 ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **INKCS055
01893 ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **INKCS055
01894 ** POSITION THE CURSOR THERE.                                   **INKCS055
01895 ******************************************************************INKCS055
01896                                                                   INKCS055
01897  4431-POSITION-AT-WARNING.                                        INKCS055
01898                                                                   INKCS055
01899      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 INKCS055
01900                     - PV-TOP-ITEM + 1.                            INKCS055
01901      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      INKCS055
01902          CONTINUE                                                 INKCS055
01903      ELSE                                                         INKCS055
01904          SET DP030-SET-CURSOR-APPL-1                              INKCS055
01905                                    TO TRUE                        INKCS055
01906          MOVE -1                   TO MR-SELECTL (PV-SUB)         INKCS055
01907          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         INKCS055
01908          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         INKCS055
01909      END-IF.                                                      INKCS055
01910                                                                   INKCS055
01911      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   INKCS055
01912                     - PV-TOP-ITEM + 1.                            INKCS055
01913      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      INKCS055
01914          CONTINUE                                                 INKCS055
01915      ELSE                                                         INKCS055
01916          SET DP030-SET-CURSOR-APPL-1                              INKCS055
01917                                    TO TRUE                        INKCS055
01918          MOVE -1                   TO MR-SELECTL (PV-SUB)         INKCS055
01919          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         INKCS055
01920          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         INKCS055
01921      END-IF.                                                      INKCS055
01922 /                                                                 INKCS055
W21015*----------------------------------------------------------------*INKCS055
W21015* DETERMINE IF THE ORIGINAL LOADED INVENTORY DATA (TO TSUMINV)   *INKCS055
W21015* HAS BEEN ADJUSTED FROM THE ORIGINAL QUANTITY AND/OR PRICE      *INKCS055
W21015* THIS OCCURS IF DB2 TABLE TADJDTL CONTAINS ADJUSTMENT ROWS FOR  *INKCS055
W21015* STORE / AREA / SKU / PRICE.                                    *INKCS055
W21015*----------------------------------------------------------------*INKCS055
W21015 4500-SELECT-TADJDTL-ROW.                                         INKCS055
W21015*                                                                 INKCS055
W21732     MOVE ASC-SKU    (ASC-BLK-SUB ASC-ITEM-SUB)                   INKCS055
W21732                                          TO PV-SKU.              INKCS055
W21732     MOVE PV-SKU                          TO ADJDTL-SKU-NBR.      INKCS055
W21732*    MOVE ASC-KEY-STORE-NBR               TO ADJDTL-STORE-NBR.    INKCS055
W26600     MOVE ASC-KEY-STORE-NBR               TO ADJDTL-LOC-NBR.      INKCS055
W21732     MOVE ASC-KEY-AREA-NBR                TO ADJDTL-AREA-NBR.     INKCS055
W21732                                                                  INKCS055
W21015     EXEC SQL                                                     INKCS055
W21732          SELECT SKU_NBR                                          INKCS055
W21015*              , ADJ_UNIT_PR_AMT                                  INKCS055
W21015          INTO                                                    INKCS055
W21732                :ADJDTL-SKU-NBR                                   INKCS055
W21015*             , :ADJDTL-ADJ-UNIT-PR-AMT                           INKCS055
W21015          FROM TADJDTL                                            INKCS055
W21732*         WHERE STORE_NBR = :ADJDTL-STORE-NBR                     INKCS055
W26600          WHERE LOC_NBR   = :ADJDTL-LOC-NBR                       INKCS055
W21732            AND AREA_NBR  = :ADJDTL-AREA-NBR                      INKCS055
W21732            AND SKU_NBR   = :ADJDTL-SKU-NBR                       INKCS055
W21015     END-EXEC.                                                    INKCS055
W21015*                                                                 INKCS055
W25428*----------------------------------------------------------------*INKCS011
W25428* RETRIEVE ATTRIBUTES ASSOCIATED WITH THE SKU NUMBER (TSUMINV)    INKCS011
W25428*----------------------------------------------------------------*INKCS011
W25428 4600-TSUMINV-SKU-ATTR.                                           INKCS011
W25428                                                                  INKCS011
W25428     EXEC SQL                                                     INKCS011
W25428          SELECT DEPT_NBR                                         INKCS011
W25428               , MAJ_CL_NBR                                       INKCS011
W25428               , SUB_CL_NBR                                       INKCS011
W25428          INTO  :SUMINV-DEPT-NBR                                  INKCS011
W25428               ,:SUMINV-MAJ-CL-NBR                                INKCS011
W25428               ,:SUMINV-SUB-CL-NBR                                INKCS011
W25428          FROM TSUMINV                                            INKCS011
W25428*         WHERE STORE_NBR       = :SUMINV-STORE-NBR               INKCS011
W26600          WHERE LOC_NBR         = :SUMINV-LOC-NBR                 INKCS011
W25428            AND AREA_NBR        = :SUMINV-AREA-NBR                INKCS011
W25428            AND SKU_NBR         = :PV-KEY-SKU                     INKCS011
W25428            AND UPC_NBR         = :PV-KEY-UPC                     INKCS011
W25428            AND INV_UNIT_PR_AMT = :PV-KEY-RTL                     INKCS011
W25428     END-EXEC.                                                    INKCS011
W25428*                                                                 INKCS011
W25428     EVALUATE TRUE                                                INKCS011
W25428         WHEN SQLCODE = ZERO                                              
W25428             CONTINUE                                                     
W25428         WHEN SQLCODE = +100                                              
W25428             MOVE ZEROES    TO  SUMINV-DEPT-NBR                   INKCS011
W25428                                SUMINV-MAJ-CL-NBR                 INKCS011
W25428                                SUMINV-SUB-CL-NBR                 INKCS011
W25428         WHEN SQLCODE = -904                                              
W25428         WHEN SQLCODE = -913                                              
W25428             PERFORM 9900-SOFT-ABORT                                      
W25428             WHEN SQLWARN0 NOT = SPACE                                    
W25428             WHEN SQLCODE NOT = ZERO                                      
W25428             MOVE '4600-TSUMINV-SKU-ATTR'                                 
W25428                   TO DP013-PARAGRAPH                                     
W25428             MOVE 'SELECT TSUMINV ROW'                                    
W25428                   TO DP013-MESSAGE-TEXT (1)                              
W25428             MOVE SQLCA TO DP013-SQLCA                                    
W25428             MOVE 'TSUMINV '                                              
W25428                   TO DP013-DB2-TABLE-NAME (1)                            
W25428             SET DP013-DB2-ABEND       TO TRUE                            
W25428             PERFORM DP013-0000-PROCESS-ABEND                             
W25428         END-EVALUATE.                                                    
W25428*----------------------------------------------------------------*INKCS011
W25428* RETRIEVE ATTRIBUTES ASSOCIATED WITH THE SKU NUMBER (TADJADD)    INKCS011
W25428*----------------------------------------------------------------*INKCS011
W25428 4700-TSKXREF-SKU-ATTR.                                           INKCS011
W25428                                                                  INKCS011
W25428     MOVE SKXREF-SKU TO PV-HOLD-SKU.                              INKCS011
W25428*    BUILD ATTRIBUTES FOR DUMMY SKUS. OTHERWISE GET FROM TSKXREF  INKCS011
W25428     IF PV-HOLD-SKU(6:3) = ZERO                                   INKCS011
W25428         MOVE ZEROS             TO PV-HOLD-TEMP-MCL               INKCS011
W25428         MOVE PV-HOLD-SKU(1:3)  TO SKXREF-DEPT                    INKCS011
W25428         MOVE PV-HOLD-SKU(4:1)  TO PV-HOLD-MCL-HLQ                INKCS011
W25428         MOVE PV-HOLD-TEMP-MCL  TO PV-MAJOR-CLASS                 INKCS011
W25428         MOVE PV-MAJOR-CLASS    TO SKXREF-CLASS                   INKCS011
W25428         MOVE PV-HOLD-SKU(4:2)  TO SKXREF-SUBCLASS                INKCS011
W25428     ELSE                                                         INKCS011
W25428                                                                  INKCS011
W25428         EXEC SQL                                                 INKCS011
W25428              SELECT DEPT                                         INKCS011
W25428                   , CLASS                                        INKCS011
W25428                   , SUBCLASS                                     INKCS011
W25428              INTO   :SKXREF-DEPT                                 INKCS011
W25428                   , :SKXREF-CLASS                                INKCS011
W25428                   , :SKXREF-SUBCLASS                             INKCS011
W25428              FROM TSKXREF                                        INKCS011
W25428              WHERE SKU = :SKXREF-SKU                             INKCS011
W25428         END-EXEC                                                 INKCS011
W25428*                                                                 INKCS011
W25428         EVALUATE TRUE                                            INKCS011
W25428             WHEN SQLCODE = ZERO                                          
W25428                 CONTINUE                                                 
W25428             WHEN SQLCODE = +100                                          
W25428                 MOVE ZEROES    TO  SKXREF-DEPT                   INKCS011
W25428                                    SKXREF-CLASS                  INKCS011
W25428                                    SKXREF-SUBCLASS               INKCS011
W25428             WHEN SQLCODE = -904                                          
W25428             WHEN SQLCODE = -913                                          
W25428                 PERFORM 9900-SOFT-ABORT                                  
W25428             WHEN SQLWARN0 NOT = SPACE                                    
W25428             WHEN SQLCODE NOT = ZERO                                      
W25428                 MOVE '4700-TSKXREF-SKU-ATTR'                             
W25428                   TO DP013-PARAGRAPH                                     
W25428             MOVE 'SELECT TSKXREF ROW'                                    
W25428                   TO DP013-MESSAGE-TEXT (1)                              
W25428             MOVE SQLCA TO DP013-SQLCA                                    
W25428             MOVE 'TSKXREF '                                              
W25428                   TO DP013-DB2-TABLE-NAME (1)                            
W25428             SET DP013-DB2-ABEND       TO TRUE                            
W25428             PERFORM DP013-0000-PROCESS-ABEND                             
W25428         END-EVALUATE                                                     
W25428      END-IF.                                                             
01923 *----------------------------------------------------------------*INKCS055
01924 * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *INKCS055
01925 * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *INKCS055
01926 * FOR THE SELECTED ITEMS QUEUE.                                  *INKCS055
01927 *                                                                *INKCS055
01928 * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *INKCS055
01929 * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *INKCS055
01930 * THE ARRAY IS FULL.                                             *INKCS055
01931 *----------------------------------------------------------------*INKCS055
01932                                                                   INKCS055
01933  5000-PREPARE-SEL-QUEUE.                                          INKCS055
01934                                                                   INKCS055
01935      MOVE +1                   TO  ASC-BLK-SUB.                   INKCS055
01936      PERFORM 5100-WRITE-TEMP-STORAGE.                             INKCS055
01937      ADD +1                    TO  ASC-BLK-SUB.                   INKCS055
01938      PERFORM 5100-WRITE-TEMP-STORAGE.                             INKCS055
01939                                                                   INKCS055
01940      MOVE ASC-SEL-QUEUE-NAME   TO  IN001-SEL-QUEUE-NAME.          INKCS055
01941      PERFORM 6010-DELETE-SEL-QUEUE.                               INKCS055
01942                                                                   INKCS055
01943      SET ASC-UPDATE-TSQ        TO  TRUE.                          INKCS055
01944                                                                   INKCS055
01945      SET IN012-IDX             TO  1.                             INKCS055
01946      MOVE ZERO                 TO IN001-NUMBER-OF-TS-ITEMS.       INKCS055
01947      INITIALIZE IN012-SELECTED-ITEM-ARRAY.                        INKCS055
01948                                                                   INKCS055
01949      PERFORM 5200-FILL-SEL-QUEUE-RECORD                           INKCS055
01950              VARYING PV-ITEM                                      INKCS055
01951              FROM 1 BY 1                                          INKCS055
01952              UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     INKCS055
01953                                                                   INKCS055
01954      IF  IN012-IDX > 1                                            INKCS055
01955          PERFORM 5205-WRITE-SEL-QUEUE                             INKCS055
01956          ADD +1                TO IN001-NUMBER-OF-TS-ITEMS        INKCS055
01957      END-IF.                                                      INKCS055
01958  EJECT                                                            INKCS055
01959 *----------------------------------------------------------------*INKCS055
01960 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *INKCS055
01961 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *INKCS055
01962 *----------------------------------------------------------------*INKCS055
01963                                                                   INKCS055
01964  5100-WRITE-TEMP-STORAGE.                                         INKCS055
01965                                                                   INKCS055
01966      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     INKCS055
01967                                    TO PV-LIST-ITEM-NUMBER.        INKCS055
01968      COMPUTE PV-BLOCK-NUMBER =                                    INKCS055
01969          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    INKCS055
01970                                                                   INKCS055
01971      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             INKCS055
01972      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             INKCS055
01973          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      INKCS055
01974              PERFORM 5105-REWRITE-ASC-LISTQ                       INKCS055
01975          END-IF                                                   INKCS055
01976      ELSE                                                         INKCS055
01977          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       INKCS055
01978          ASC-HIGHEST-BLOCK-WRITTEN + 1                            INKCS055
01979          PERFORM 5110-WRITE-ASC-LISTQ                             INKCS055
01980          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   INKCS055
01981      END-IF.                                                      INKCS055
01982                                                                   INKCS055
01983      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             INKCS055
01984                                                                   INKCS055
01985 ******************************************************************INKCS055
01986 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **INKCS055
01987 ** SPECIFIC COMMAREA.                                           **INKCS055
01988 ******************************************************************INKCS055
01989                                                                   INKCS055
01990  5105-REWRITE-ASC-LISTQ.                                          INKCS055
01991                                                                   INKCS055
01992      EXEC CICS                                                    INKCS055
01993          WRITEQ TS                                                INKCS055
01994              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
01995              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               INKCS055
01996              ITEM  (PV-BLOCK-NUMBER)                              INKCS055
01997              REWRITE                                              INKCS055
01998              RESP  (PV-CICS-RESP)                                 INKCS055
01999      END-EXEC.                                                    INKCS055
02000                                                                   INKCS055
02001      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           INKCS055
02002          CONTINUE                                                 INKCS055
02003      ELSE                                                         INKCS055
02004          SET DP013-CICS-ABEND            TO TRUE                  INKCS055
02005          SET DP013-NO-ROLLBACK           TO TRUE                  INKCS055
02006          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       INKCS055
02007          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     INKCS055
02008                                          TO DP013-MESSAGE-TEXT(1) INKCS055
02009          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02010      END-IF.                                                      INKCS055
02055                                                                   INKCS055
02012 ******************************************************************INKCS055
02013 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **INKCS055
02014 ** SPECIFIC COMMAREA.                                           **INKCS055
02015 ******************************************************************INKCS055
02016                                                                   INKCS055
02017  5110-WRITE-ASC-LISTQ.                                            INKCS055
02018                                                                   INKCS055
02019      EXEC CICS                                                    INKCS055
02020          WRITEQ TS                                                INKCS055
02021              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
02022              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               INKCS055
02023              ITEM  (PV-BLOCK-NUMBER)                              INKCS055
02024              RESP  (PV-CICS-RESP)                                 INKCS055
02025      END-EXEC.                                                    INKCS055
02026      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      INKCS055
02027          SET DP013-CICS-ABEND      TO TRUE                        INKCS055
02028          SET DP013-NO-ROLLBACK     TO TRUE                        INKCS055
02029          MOVE '5110-WRITE-ASC-LISTQ'                              INKCS055
02030                                    TO DP013-PARAGRAPH             INKCS055
02031          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           INKCS055
02032                                    TO DP013-MESSAGE-TEXT(1)       INKCS055
02033          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02034      END-IF.                                                      INKCS055
02035 /                                                                 INKCS055
02036 *----------------------------------------------------------------*INKCS055
02037 * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *INKCS055
02038 * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *INKCS055
02039 *----------------------------------------------------------------*INKCS055
02040                                                                   INKCS055
02041  5200-FILL-SEL-QUEUE-RECORD.                                      INKCS055
02042                                                                   INKCS055
02043      PERFORM 6112-READ-LIST-QUEUE.                                INKCS055
02044                                                                   INKCS055
02045      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       INKCS055
02046          PERFORM                                                  INKCS055
02047          VARYING LQW-IDX                                          INKCS055
02048          FROM 1 BY 1                                              INKCS055
02049          UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            INKCS055
02050            OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          INKCS055
02051                                                                   INKCS055
02052              IF  LQW-SELECT (LQW-IDX)                             INKCS055
02053                  MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              INKCS055
02054                                    TO IN012-ITEM      (IN012-IDX) INKCS055
W21732                 MOVE LQW-SKU  (LQW-IDX)                          INKCS055
W21732                                   TO IN012-SKU-NBR   (IN012-IDX) INKCS055
02061                  MOVE SPACE        TO IN012-ACTION-SW (IN012-IDX) INKCS055
02062                  MOVE LQW-INV-QTY (LQW-IDX)                       INKCS055
02063                                    TO IN012-QTY       (IN012-IDX) INKCS055
02064                  MOVE LQW-PR-AMT (LQW-IDX)                        INKCS055
02065                                    TO IN012-PRICE     (IN012-IDX) INKCS055
02066                  IF  LQW-COLOR (LQW-IDX) EQUAL DP015-BLUE         INKCS055
02067                      SET IN012-FROM-TSUMINV (IN012-IDX) TO TRUE   INKCS055
02068                  ELSE                                             INKCS055
02069                      SET IN012-FROM-TADJADD (IN012-IDX) TO TRUE   INKCS055
02070                  END-IF                                           INKCS055
02071                                                                   INKCS055
02072                  SET IN012-IDX UP BY 1                            INKCS055
02073                  IF  IN012-IDX > IN012-MAX-ITEMS                  INKCS055
02074                      PERFORM 5205-WRITE-SEL-QUEUE                 INKCS055
02075                      ADD +1        TO IN001-NUMBER-OF-TS-ITEMS    INKCS055
02076                      INITIALIZE IN012-SELECTED-ITEM-ARRAY         INKCS055
02077                      SET IN012-IDX TO  1                          INKCS055
02078                  END-IF                                           INKCS055
02079              END-IF                                               INKCS055
02080          END-PERFORM                                              INKCS055
02081      END-IF.                                                      INKCS055
02082                                                                   INKCS055
02083 *----------------------------------------------------------------*INKCS055
02084 *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *INKCS055
02085 *----------------------------------------------------------------*INKCS055
02086                                                                   INKCS055
02087  5205-WRITE-SEL-QUEUE.                                            INKCS055
02088                                                                   INKCS055
02089      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            INKCS055
02090                                    TO IN012-SELECTED-ITEMS.       INKCS055
02091                                                                   INKCS055
02092      EXEC CICS                                                    INKCS055
02093           WRITEQ TS                                               INKCS055
02094               QUEUE (ASC-SEL-QUEUE-NAME)                          INKCS055
02095               FROM  (IN012-SELECTED-SKUS)                         INKCS055
02096               ITEM  (PV-SEL-QUEUE-ITEM)                           INKCS055
02097               RESP  (PV-CICS-RESP)                                INKCS055
02098      END-EXEC.                                                    INKCS055
02099                                                                   INKCS055
02100      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          INKCS055
02101          CONTINUE                                                 INKCS055
02102      ELSE                                                         INKCS055
02103          SET DP013-CICS-ABEND      TO TRUE                        INKCS055
02104          SET DP013-NO-ROLLBACK     TO TRUE                        INKCS055
02105          MOVE '5205-WRITE-SEL-QUEUE'                              INKCS055
02106                                    TO DP013-PARAGRAPH             INKCS055
02107          MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          INKCS055
02108                                    TO DP013-MESSAGE-TEXT(1)       INKCS055
02109          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02110      END-IF.                                                      INKCS055
02111 /                                                                 INKCS055
02112 *----------------------------------------------------------------*INKCS055
02113 *  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *INKCS055
02114 *  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *INKCS055
02115 *  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *INKCS055
02116 *  THE USER.                                                     *INKCS055
02117 *----------------------------------------------------------------*INKCS055
02118                                                                   INKCS055
02119  6000-REFRESH-PANEL-FROM-TEMP.                                    INKCS055
02120                                                                   INKCS055
02121      IF  ASC-UPDATE-TSQ                                           INKCS055
02122          SET ASC-NO-TSQ-UPDATE TO TRUE                            INKCS055
02123          MOVE ZERO                 TO PV-SAVE-ITEM                INKCS055
02124                                       PV-SEL-QUEUE-ITEM           INKCS055
02125          MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        INKCS055
02126                                    TO PV-HOLD-SELECTED-ITEMS      INKCS055
02127          PERFORM 6100-UPDATE-TSQ                                  INKCS055
02128              UNTIL PV-ITEMS-PROCESSED >                           INKCS055
02129                                      ASC-NUMBER-OF-SELECTED-ITEMS INKCS055
02130          PERFORM 6010-DELETE-SEL-QUEUE                            INKCS055
02131          INITIALIZE ASC-BLOCK-ENTRIES (1)                         INKCS055
02132                     ASC-BLOCK-ENTRIES (2)                         INKCS055
02133                                                                   INKCS055
02134          DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 INKCS055
02135                 GIVING PV-BLOCK-NUMBER                            INKCS055
02136                 REMAINDER PV-REMAINDER                            INKCS055
02137          IF  PV-REMAINDER > ZERO                                  INKCS055
02138              ADD +1     TO PV-BLOCK-NUMBER                        INKCS055
02139          END-IF                                                   INKCS055
02140                                                                   INKCS055
02141          MOVE +1        TO ASC-BLK-SUB                            INKCS055
02142          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
02143          ADD +1         TO ASC-BLK-SUB                            INKCS055
02144                            PV-BLOCK-NUMBER                        INKCS055
02145          PERFORM 4410-READ-TEMP-STORAGE                           INKCS055
02146      END-IF.                                                      INKCS055
02147                                                                   INKCS055
02148 *----------------------------------------------------------------*INKCS055
02149 *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *INKCS055
02150 *----------------------------------------------------------------*INKCS055
02151                                                                   INKCS055
02152  6010-DELETE-SEL-QUEUE.                                           INKCS055
02153                                                                   INKCS055
02154      EXEC CICS                                                    INKCS055
02155          DELETEQ TS                                               INKCS055
02156              QUEUE (ASC-SEL-QUEUE-NAME)                           INKCS055
02157              RESP  (PV-CICS-RESP)                                 INKCS055
02158      END-EXEC.                                                    INKCS055
02159                                                                   INKCS055
02160      IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      INKCS055
02161         (PV-CICS-RESP = DFHRESP(QIDERR)))                         INKCS055
02162          CONTINUE                                                 INKCS055
02163      ELSE                                                         INKCS055
02164          SET DP013-CICS-ABEND TO TRUE                             INKCS055
02165          SET DP013-NO-ROLLBACK TO TRUE                            INKCS055
02166          MOVE '6010-DELETE-SEL-QUEUE'                             INKCS055
02167                         TO DP013-PARAGRAPH                        INKCS055
02168          MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         INKCS055
02169                         TO DP013-MESSAGE-TEXT (1)                 INKCS055
02170          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02171      END-IF.                                                      INKCS055
02172                                                                   INKCS055
02173 *----------------------------------------------------------------*INKCS055
02174 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *INKCS055
02175 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *INKCS055
02176 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *INKCS055
02177 *    THE TEMP QUEUE.                                             *INKCS055
02178 *----------------------------------------------------------------*INKCS055
02179                                                                   INKCS055
02180  6100-UPDATE-TSQ.                                                 INKCS055
02181                                                                   INKCS055
02182      ADD 1                     TO  PV-SEL-QUEUE-ITEM.             INKCS055
02183      PERFORM 6105-READ-SEL-QUEUE.                                 INKCS055
02184      PERFORM                                                      INKCS055
02185          VARYING IN012-IDX                                        INKCS055
02186          FROM 1 BY 1                                              INKCS055
02187          UNTIL ((PV-ITEMS-PROCESSED >                             INKCS055
02188                               PV-HOLD-SELECTED-ITEMS)             INKCS055
02189          OR (IN012-IDX GREATER THAN IN012-MAX-ITEMS))             INKCS055
02190          IF  IN012-ACTION-SW (IN012-IDX) > SPACE                  INKCS055
02191              PERFORM 6110-PROCESS-ITEMS                           INKCS055
02192          END-IF                                                   INKCS055
02193          ADD +1                TO PV-ITEMS-PROCESSED              INKCS055
02194      END-PERFORM.                                                 INKCS055
02195      PERFORM 6111-WRITE-LIST-QUEUE.                               INKCS055
02196 *----------------------------------------------------------------*INKCS055
02197 *    READ THE LIST QUEUE RECORD.                                 *INKCS055
02198 *----------------------------------------------------------------*INKCS055
02199                                                                   INKCS055
02200  6105-READ-SEL-QUEUE.                                             INKCS055
02201                                                                   INKCS055
02202      EXEC CICS                                                    INKCS055
02203           READQ TS                                                INKCS055
02204               QUEUE (ASC-SEL-QUEUE-NAME)                          INKCS055
02205               INTO  (IN012-SELECTED-SKUS)                         INKCS055
02206               ITEM  (PV-SEL-QUEUE-ITEM)                           INKCS055
02207               RESP  (PV-CICS-RESP)                                INKCS055
02208      END-EXEC.                                                    INKCS055
02209                                                                   INKCS055
02210      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          INKCS055
02211          CONTINUE                                                 INKCS055
02212      ELSE                                                         INKCS055
02213          SET DP013-CICS-ABEND      TO  TRUE                       INKCS055
02214          SET DP013-NO-ROLLBACK     TO  TRUE                       INKCS055
02215          MOVE '6105-READ-SEL-QUEUE'                               INKCS055
02216                                    TO  DP013-PARAGRAPH            INKCS055
02217          MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           INKCS055
02218                                    TO  DP013-MESSAGE-TEXT(1)      INKCS055
02219          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02220      END-IF.                                                      INKCS055
02221 /                                                                 INKCS055
02222 *----------------------------------------------------------------*INKCS055
02223 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*INKCS055
02224 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*INKCS055
02225 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *INKCS055
02226 *----------------------------------------------------------------*INKCS055
02227                                                                   INKCS055
02228  6110-PROCESS-ITEMS.                                              INKCS055
02229                                                                   INKCS055
02230      COMPUTE PV-ITEM = 1 + ((IN012-ITEM (IN012-IDX) - 1)          INKCS055
02231                      / PC-ITEMS-PER-PANEL).                       INKCS055
02232                                                                   INKCS055
02233      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           INKCS055
02234          IF  PV-SAVE-ITEM NOT EQUAL ZERO                          INKCS055
02235              PERFORM 6111-WRITE-LIST-QUEUE                        INKCS055
02236          END-IF                                                   INKCS055
02237          MOVE PV-ITEM          TO PV-SAVE-ITEM                    INKCS055
02238                                                                   INKCS055
02239          PERFORM 6112-READ-LIST-QUEUE                             INKCS055
02240      END-IF.                                                      INKCS055
02241                                                                   INKCS055
02242      COMPUTE PV-SUB = (IN012-ITEM (IN012-IDX)                     INKCS055
02243                     - LQW-LIST-ITEM-NUMBER (1)) + 1.              INKCS055
02244      SET LQW-DESELECT (PV-SUB) TO    TRUE                         INKCS055
02245      MOVE LQW-SELECTED-SW (PV-SUB)                                INKCS055
02246                                TO LQW-TEMP-SELECTED-SW (PV-SUB).  INKCS055
02247      EVALUATE TRUE                                                INKCS055
02248          WHEN IN012-INQ (IN012-IDX)                               INKCS055
02249               MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             INKCS055
02250                                                                   INKCS055
02251          WHEN IN012-UPD (IN012-IDX)                               INKCS055
02252               MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             INKCS055
02253                                                                   INKCS055
02254          WHEN IN012-DEL (IN012-IDX)                               INKCS055
02255               MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             INKCS055
02256                                                                   INKCS055
02257          WHEN IN012-ERR (IN012-IDX)                               INKCS055
02258               MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             INKCS055
02259      END-EVALUATE.                                                INKCS055
02260                                                                   INKCS055
02261      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                INKCS055
02262                                                                   INKCS055
02263 *----------------------------------------------------------------*INKCS055
02264 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *INKCS055
02265 *----------------------------------------------------------------*INKCS055
02266                                                                   INKCS055
02267  6111-WRITE-LIST-QUEUE.                                           INKCS055
02268                                                                   INKCS055
02269      EXEC CICS                                                    INKCS055
02270          WRITEQ TS                                                INKCS055
02271              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
02272              FROM  (LQW-LIST-QUEUE-WORK-AREA)                     INKCS055
02273              ITEM  (PV-SAVE-ITEM)                                 INKCS055
02274              REWRITE                                              INKCS055
02275              RESP  (PV-CICS-RESP)                                 INKCS055
02276      END-EXEC.                                                    INKCS055
02277                                                                   INKCS055
02278      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          INKCS055
02279          CONTINUE                                                 INKCS055
02280      ELSE                                                         INKCS055
02281          SET DP013-CICS-ABEND  TO  TRUE                           INKCS055
02282          SET DP013-NO-ROLLBACK TO  TRUE                           INKCS055
02283          MOVE '6111-WRITE-LIST-QUEUE'                             INKCS055
02284                                TO  DP013-PARAGRAPH                INKCS055
02285          MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  INKCS055
02286                                TO  DP013-MESSAGE-TEXT(1)          INKCS055
02287          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02288      END-IF.                                                      INKCS055
02289 /                                                                 INKCS055
02290 *----------------------------------------------------------------*INKCS055
02291 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*INKCS055
02292 *----------------------------------------------------------------*INKCS055
02293                                                                   INKCS055
02294  6112-READ-LIST-QUEUE.                                            INKCS055
02295                                                                   INKCS055
02296      EXEC CICS                                                    INKCS055
02297          READQ TS                                                 INKCS055
02298              QUEUE (ASC-LIST-QUEUE-NAME)                          INKCS055
02299              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     INKCS055
02300              ITEM  (PV-ITEM)                                      INKCS055
02301              RESP  (PV-CICS-RESP)                                 INKCS055
02302      END-EXEC.                                                    INKCS055
02303                                                                   INKCS055
02304      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          INKCS055
02305          CONTINUE                                                 INKCS055
02306      ELSE                                                         INKCS055
02307          SET DP013-CICS-ABEND        TO TRUE                      INKCS055
02308          SET DP013-NO-ROLLBACK       TO TRUE                      INKCS055
02309          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           INKCS055
02310          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    INKCS055
02311                                      TO DP013-MESSAGE-TEXT(1)     INKCS055
02312          PERFORM DP013-0000-PROCESS-ABEND                         INKCS055
02313      END-IF.                                                      INKCS055
02314                                                                   INKCS055
W30692/******************************************************************       
W30692* 8XXX-USE-STORE-DEFAULT-PRTR.                                            
W30692*******************************************************************       
W30692 8XXX-USE-STORE-DEFAULT-PRTR.                                             
W30692                                                                          
W30692     MOVE DP026-LOCATION-NBR TO PV-EDIT-LOC-NBR.                          
W30692     IF PV-EDIT-LOC-NBR-P1 IS EQUAL TO ZERO                               
W30692         STRING 'TKST' DELIMITED BY SIZE                                  
W30692                PV-EDIT-LOC-NBR-P2 DELIMITED BY SIZE                      
W30692                            INTO PV-USER-USER-CODE                        
W30692     ELSE                                                                 
W30692         STRING 'TKS' DELIMITED BY SIZE                                   
W30692                PV-EDIT-LOC-NBR DELIMITED BY SIZE                         
W30692                            INTO PV-USER-USER-CODE                        
W30692     END-IF.                                                              
W30692                                                                          
W30692     MOVE PV-USER-USER-CODE TO USER-USER-CODE.                            
W30692                                                                          
W30692     EXEC SQL                                                             
W30692         SELECT DFLT_PRTR_ID                                              
W30692         INTO  :USER-DFLT-PRTR-ID                                         
W30692         FROM  TUSER                                                      
W30692         WHERE USER_CODE = :USER-USER-CODE                                
W30692         WITH UR                                                          
W30692     END-EXEC.                                                            
W30692                                                                          
W30692     EVALUATE TRUE                                                        
W30692         WHEN SQLCODE = ZERO                                              
W30692             IF USER-DFLT-PRTR-ID GREATER SPACES                          
W30692                 MOVE USER-DFLT-PRTR-ID                                   
W30692                               TO JL-JCL-INK950-PRTDEST                   
W30692                 MOVE 'Y'      TO JL-JCL-INK950-PRT-IND                   
W30692             ELSE                                                         
W30692                 MOVE SPACES   TO JL-JCL-INK950-PRTDEST                   
W30692                 MOVE 'N'      TO JL-JCL-INK950-PRT-IND                   
W30692             END-IF                                                       
W30692         WHEN SQLCODE = +100                                              
W30692             MOVE SPACES       TO JL-JCL-INK950-PRTDEST                   
W30692             MOVE 'N'          TO JL-JCL-INK950-PRT-IND                   
W30692         WHEN OTHER                                                       
W30692             MOVE SPACES       TO JL-JCL-INK950-PRTDEST                   
W30692             MOVE 'N'          TO JL-JCL-INK950-PRT-IND                   
W30692             MOVE '8XXX-USE-STORE-DEFAULT-PRTR'                           
W30692                               TO DP013-PARAGRAPH                         
W30692             MOVE 'SELECT DFLT-PRT-ID'                                    
W30692                               TO DP013-MESSAGE-TEXT (1)                  
W30692             MOVE SQLCA        TO DP013-SQLCA                             
W30692             MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)                
W30692             SET DP013-DB2-ABEND                                          
W30692                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
W30692             PERFORM DP013-0000-PROCESS-ABEND                             
W30692     END-EVALUATE.                                                        
W30692                                                                          
P25428/******************************************************************       
P25428*** FORMAT AND SUBMIT BATCH JOB.                                **        
P25428*******************************************************************       
P25428 8000-FORMAT-AND-SUBMIT.                                                  
P25428                                                                          
P25428     PERFORM 9500-ENQUEUE-INTERNAL-READER.                                
P25428                                                                          
P25428     EXEC CICS                                                            
P25428       ASSIGN                                                             
P25428         APPLID (PV-CICS-ID)                                              
P25428     END-EXEC.                                                            
P25428                                                                          
P25428     IF PV-CICS-REGION-PRODUCTION                                         
P25428         MOVE 'INK950'     TO JL-JCL-INK950-JOBNAME                       
P25428         MOVE 'Q'          TO JL-JCL-INK950-JOBCLASS                      
P25428         MOVE 'P'          TO JL-JCL-INK950-MSGCLASS                      
P25428         MOVE SPACES       TO JL-JCL-INK950-NOTIFY-OPT                    
P25428     ELSE                                                                 
P25428         MOVE DP020-USERID TO JL-JCL-INK950-JOBNAME                       
P25428                              JL-JCL-TEST-USER                            
P25428         MOVE 'P'          TO JL-JCL-INK950-JOB-UNQ                       
P25428         MOVE 'A'          TO JL-JCL-INK950-JOBCLASS                      
P25428         MOVE 'X'          TO JL-JCL-INK950-MSGCLASS                      
P25428         MOVE JL-JCL-TEST-NOTIFY TO JL-JCL-INK950-NOTIFY-OPT              
P25428     END-IF.                                                              
P25428     MOVE JL-JCL-INK950-LINE-1 TO TD-JCL-LINE.                            
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-2 TO TD-JCL-LINE.                            
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-3 TO TD-JCL-LINE.                            
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE DP020-USERID TO JL-JCL-INK950-CMT-USRID                         
P25428     MOVE PV-CICS-ID   TO JL-JCL-INK950-CMT-REGION.                       
P25428     MOVE JL-JCL-INK950-CMT-USER-INFO TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-1         TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-2         TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-3         TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428**   CONTROL CARD INFORMATION (JL-JCL-INK950-LINE-14)                     
P25428     MOVE IN001-STORE-NBR         TO  JL-JCL-INK950-STORE.                
P25428     MOVE IN001-AREA-NBR          TO  JL-JCL-INK950-AREA.                 
P25428     MOVE ZEROES                  TO  JL-JCL-INK950-SKU                   
P25428                                      JL-JCL-INK950-RETAIL.               
W30692     MOVE IN001-DB2-ACTL-INV-DTE TO                                       
W30692                                     JL-JCL-DB2-ACTL-INV-DTE              
P25428                                                                          
W26600     EXEC CICS ASSIGN                                                     
W26600         USERID(JL-JCL-INK950-USERID)                                     
W26600     END-EXEC.                                                            
W26600                                                                          
P25428     MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-CMT-OPTION.        
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-4         TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     IF PV-CICS-REGION-PRODUCTION                                         
P25428         MOVE JL-JCL-INK950-LINE-10       TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428     ELSE                                                                 
P25428         MOVE JL-JCL-TEST-LINE-10         TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428         MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428                                                                          
P25428         MOVE JL-JCL-TEST-LINE-11A        TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428         MOVE JL-JCL-TEST-LINE-11B        TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428         MOVE JL-JCL-TEST-LINE-11C        TO TD-JCL-LINE                  
P25428         PERFORM 8100-WRITE-TD-LINE                                       
P25428     END-IF.                                                              
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-11       TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
W30692*    EXEC SQL                                                             
W30692*        SELECT DFLT_PRTR_ID                                              
W30692*        INTO  :USER-DFLT-PRTR-ID                                         
W30692*        FROM  TUSER                                                      
W30692*        WHERE USER_CODE = :DP020-USERID                                  
W30692*    END-EXEC.                                                            
W30692*    MOVE 'LOCAL'           TO JL-JCL-INK950-PRTDEST.                     
W30692*    MOVE 'N'               TO JL-JCL-INK950-PRT-IND.                     
W30692*    EVALUATE TRUE                                                        
W30692*        WHEN SQLCODE = ZERO                                              
W30692*            IF USER-DFLT-PRTR-ID NOT = SPACES                            
W30692*                MOVE USER-DFLT-PRTR-ID TO JL-JCL-INK950-PRTDEST          
W30692*                MOVE 'Y'               TO JL-JCL-INK950-PRT-IND          
W30692*            END-IF                                                       
W30692*        WHEN SQLCODE = +100                                              
W30692*            CONTINUE                                                     
W30692*        WHEN OTHER                                                       
W30692*            MOVE '8100-FORMAT-AND-SUBMIT'                                
W30692*                              TO DP013-PARAGRAPH                         
W30692*            MOVE 'SELECT DFLT-PRT-ID'                                    
W30692*                              TO DP013-MESSAGE-TEXT (1)                  
W30692*            MOVE SQLCA        TO DP013-SQLCA                             
W30692*            MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)                
W30692*            SET DP013-DB2-ABEND                                          
W30692*                DP013-XCTL-DISPLAY-RESTART                               
W30692*                              TO TRUE                                    
W30692*            PERFORM DP013-0000-PROCESS-ABEND                             
W30692*    END-EVALUATE.                                                        
W30692*                                                                         
P25428     MOVE JL-JCL-INK950-LINE-12       TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-13       TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428**   CONTROL CARD INFORMATION (IN-STREAM DATA ON JOB CARD)                
P25428**                                    JL-JCL-INK950-UPC                   
P25428     MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-REQ-OPTION.        
P25428     MOVE JL-JCL-INK950-LINE-14       TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-EOD      TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     MOVE JL-JCL-INK950-LINE-EOF      TO TD-JCL-LINE.                     
P25428     PERFORM 8100-WRITE-TD-LINE.                                          
P25428                                                                          
P25428     PERFORM 9600-DEQUEUE-INTERNAL-READER.                                
P25428                                                                          
P25428                                                                          
P25428*******************************************************************       
P25428** WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *        
P25428** READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER AND ABEND. *        
P25428*******************************************************************       
P25428 8100-WRITE-TD-LINE.                                                      
P25428     EXEC CICS                                                            
P25428         WRITEQ TD                                                        
P25428             QUEUE(TD-QUEUE-NAME)                                         
P25428             FROM(TD-JCL-LINE)                                            
P25428             LENGTH(TD-JCL-LINE-LENGTH)                                   
P25428             RESP(PV-CICS-RESP)                                           
P25428     END-EXEC.                                                            
P25428                                                                          
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
P25428         SET DP013-CICS-ABEND      TO TRUE                                
P25428         SET DP013-NO-ROLLBACK     TO TRUE                                
P25428         MOVE '8100-WRITE-TD-LINE' TO DP013-PARAGRAPH                     
P25428         MOVE 'ATTEMPTING TO WRITE TO INTERNAL READER TD QUEUE'           
P25428                                   TO DP013-MESSAGE-TEXT(1)               
P25428         PERFORM 9600-DEQUEUE-INTERNAL-READER                             
P25428         PERFORM DP013-0000-PROCESS-ABEND                                 
P25428     END-IF.                                                              
P25428                                                                          
P25428/                                                                 INKCS011
P25428*******************************************************************       
P25428** ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *        
P25428** THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *        
P25428** BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *        
P25428** WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *        
P25428** CONDITION.                                                    *        
P25428*******************************************************************       
P25428 9500-ENQUEUE-INTERNAL-READER.                                            
P25428     EXEC CICS                                                            
P25428         ENQ                                                              
P25428             RESOURCE(TD-QUEUE-NAME)                                      
P25428             LENGTH(TD-QUEUE-NAME-LENGTH)                                 
P25428             RESP(PV-CICS-RESP)                                           
P25428     END-EXEC.                                                            
P25428                                                                          
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
P25428         SET DP013-CICS-ABEND      TO TRUE                                
P25428         SET DP013-NO-ROLLBACK     TO TRUE                                
P25428         MOVE '9500-ENQUEUE-INTERNAL-READER'                              
P25428                                   TO DP013-PARAGRAPH                     
P25428         STRING 'ENQUEUE '            DELIMITED BY SIZE                   
P25428                TD-QUEUE-NAME         DELIMITED BY SIZE                   
P25428                ' (INTERNAL READER)'  DELIMITED BY SIZE                   
P25428             INTO DP013-MESSAGE-TEXT (1)                                  
P25428         PERFORM DP013-0000-PROCESS-ABEND                                 
P25428     END-IF.                                                              
P25428                                                                          
P25428     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                             
P25428                                                                          
P25428*******************************************************************       
P25428** DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *        
P25428** THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *        
P25428** SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *        
P25428** ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *        
P25428** FOR THE NEXT USER.                                            *        
P25428*******************************************************************       
P25428 9600-DEQUEUE-INTERNAL-READER.                                            
P25428     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                             
P25428                                                                          
P25428     EXEC CICS                                                            
P25428         DEQ                                                              
P25428             RESOURCE(TD-QUEUE-NAME)                                      
P25428             LENGTH(TD-QUEUE-NAME-LENGTH)                                 
P25428             RESP(PV-CICS-RESP)                                           
P25428     END-EXEC.                                                            
P25428                                                                          
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                                
P25428         SET DP013-CICS-ABEND      TO TRUE                                
P25428         SET DP013-NO-ROLLBACK     TO TRUE                                
P25428         MOVE '9600-DEQUEUE-INTERNAL-READER'                              
P25428                                   TO DP013-PARAGRAPH                     
P25428         STRING 'DEQUEUE '            DELIMITED BY SIZE                   
P25428                TD-QUEUE-NAME         DELIMITED BY SIZE                   
P25428                ' (INTERNAL READER)'  DELIMITED BY SIZE                   
P25428             INTO DP013-MESSAGE-TEXT (1)                                  
P25428         PERFORM DP013-0000-PROCESS-ABEND                                 
P25428     END-IF.                                                              
P25428                                                                          
02315 *----------------------------------------------------------------*INKCS055
02316 *    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *INKCS055
02317 *    AND THE ERROR SWITCHES.                                     *INKCS055
02318 *----------------------------------------------------------------*INKCS055
02319                                                                   INKCS055
02320  9900-SOFT-ABORT.                                                 INKCS055
02321                                                                   INKCS055
02322      SET PS-ERROR                TO  TRUE.                        INKCS055
02323      SET DP020-MSG-FATAL         TO  TRUE.                        INKCS055
02324      MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            INKCS055
02325                                                                   INKCS055
02326                                                                   INKCS055
02327 *----------------------------------------------------------------*INKCS055
02328 *    ABEND PROCESSOR MODULE                                      *INKCS055
02329 *----------------------------------------------------------------*INKCS055
02330                                                                   INKCS055
02331      COPY DPPD013.                                                INKCS055
W30692*----------------------------------------------------------------*        
W30692*    RETRIEVE LOGON INFORMATION FOR DEFAULT PRINTER DESTINATION  *        
W30692*----------------------------------------------------------------*        
W30692     COPY DPPD026.                                                        
