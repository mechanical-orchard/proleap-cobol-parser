*********************************************************************** 00300000
*                                                                     * 00600000
*   MODULE NAME = DPKCS223                                            * 00900000
*                                                                     * 01200000
*********************************************************************** 55600000
*/*(   START OF ABSTRACT COMMENTING                     */              56000000
**********************************************************              56400000
* THIS INSTRUCTION SETS UP THE SAMPLE USER EXIT POINT.   *              56800000
**********************************************************              57200000
*                                                                       57600000
         DFHUEXIT TYPE=EP,ID=XMEOUT                                     58000000
*                                                                       58400000
**********************************************************              58800000
* THE FOLLOWING DSECT MAPS A STORAGE AREA YOU CAN USE TO *              59200000
* MAKE THE EXIT PROGRAM REENTRANT BY STORING THE ADDRESS *              59600000
* OF THE STORAGE YOU ACQUIRE IN THE FIRST FOUR BYTES OF  *              60000000
* THE 260-BYTE AREA PROVIDED BY THE USER EXIT HANDLER    *              60400000
* (DFHUEH) AND ADDRESSED BY UEPXSTOR.                    *              60800000
**********************************************************              61200000
*                                                                       61600000
TRANSTOR DSECT                                                          62000000
*                                                                       62400000
**********************************************************              62800000
* REGISTER EQUATES                                       *              63200000
**********************************************************              63600000
*                                                                       64000000
R0       EQU   0                                                        64020000
R1       EQU   1                                                        64040000
R2       EQU   2                                                        64060000
R3       EQU   3                                                        64080000
R4       EQU   4                                                        64100000
R5       EQU   5                                                        64120000
R6       EQU   6                                                        64140000
R7       EQU   7                                                        64160000
R8       EQU   8                                                        64180000
R9       EQU   9                                                        64200000
R10      EQU   10                                                       64220000
R11      EQU   11                                                       64250000
R12      EQU   12                                                       64280000
R13      EQU   13                                                       64310000
R14      EQU   14                                                       64340000
R15      EQU   15                                                       64370000
PMNTD    EQU   R3                  NUMBER OF TD QUEUES                  64400000
PMNRC    EQU   R4                  NUMBER OF ROUTE CODES                64800000
PMTDQ    EQU   R5                  ARRAY OF TD QUEUES                   65200000
PMNUM    EQU   R6                  MESSAGE NUMBER                       65700000
PMDOM    EQU   R7                  DOMAIN ID                            66200000
PMROU    EQU   R8                  ROUTE CODE ARRAY                     66500000
EXIT_RC  EQU   R15                                                      66600000
*                                                                       66800000
**********************************************************              67200000
* THE NEXT SEVEN INSTRUCTIONS FORM THE NORMAL START OF A *              67600000
* SAMPLE USER EXIT PROGRAM, SETTING THE ADDRESSING MODE  *              68000000
* TO 31-BIT, SAVING THE CALLING PROGRAM'S REGISTERS,     *              68400000
* ESTABLISHING BASE ADDRESSING, AND ESTABLISHING THE     *              68800000
* ADDRESSING OF THE USER EXIT PARAMETER LIST             *              69200000
**********************************************************              69600000
DPKCS223 CSECT                                                          70000000
DPKCS223 AMODE 31                                                       70400000
         SAVE  (14,12)             SAVE REGISTERS                       70800000
         LR    R11,R15                                                  71200000
         USING DPKCS223,R11        SET UP PROGRAM BASE REGISTER         71600000
         LR    R2,R1                                                    72000000
         USING DFHUEPAR,R2         ADDRESS USER EXIT PARAMETER LIST     72400000
*                                                                       72450000
**********************************************************              72500000
* <<<<<< SECTION TO BE MODIFIED BY THE USERS.     >>>>>> *              72560000
*                        START.                          *              72620000
**********************************************************              72680000
*                                                                       72740000
**********************************************************              72800000
*/*|   IS THE NUMBER OF TD QUEUES ZERO ?  NTD = 0 ?     */              73200000
*/*|   IF YES, THEN WE HAVE NO WORK TO DO, AND EXIT     */              73600000
*/*|            RETURN CODE NORMAL                      */              74000000
**********************************************************              74400000
         L     PMNTD,UEPMNTD       GET ADDRESS OF NUMBER OF TD QUEUES   74800000
         CLC   0(2,PMNTD),=H'0'                                         75200000
         BE    RCNORMAL                                                 75600000
**********************************************************              76000000
*/*|   SET UP MESSAGE NUMBER, DOMAIN ID, AND TRANSIENT  */              76400000
*/*|            DATA QUEUE.                             */              76800000
**********************************************************              77200000
         L     PMNUM,UEPMNUM       GET ADDRESS OF MESSAGE NUMBER        77600000
         L     PMDOM,UEPMDOM       GET ADDRESS OF DOMAIN ID             78000000
         L     PMTDQ,UEPMTDQ       GET ADDRESS OF TRANSIENT DATA QUEUE  78400000
         L     PMROU,UEPMROU       GET ADDRESS OF ROUTE CODES ARRAY     78500000
         L     PMNRC,UEPMNRC       GET ADDRESS OF NUMBER OF ROUTES      78600000
**********************************************************              78800000
*/*|   IS MESSAGE NUMBER = 2236?...                     */              79200000
*/*|     & DOMAIN ID = AC?...                           */              79600000
*/*|     & ONLY TD QUEUE = CSMT?                        */              80000000
*/*|   YES? THEN WE'VE FOUND WHAT WE WANT               */              80400000
*/*|   NO?  EXIT - RETURN CODE NORMAL                   */              80800000
**********************************************************              81200000
         CLC   0(4,PMNUM),=F'2236' MESSAGE NUMBER = 2236?          @P1C 81600002
         BNE   RCNORMAL                                                 82000000
         CLC   0(2,PMDOM),=C'AC'   DOMAIN ID = AC?                      82400002
         BNE   RCNORMAL                                                 82800000
         CLC   0(4,PMTDQ),=C'CSMT' TD QUEUE = CSMT?                     84000002
         BNE   RCNORMAL                                                 84400000
         CLC   0(2,PMNTD),=H'1'    NUMBER TD QUEUES = 1?                84500000
         BNE   RCNORMAL                                                 84600000
**********************************************************              84800000
*/*|   HAVING FOUND THE CORRECT MESSAGE,                */              85200000
*/*|   WE DECREASE THE NUMBER OF TRANSIENT DATA QUEUES  */              85600000
*/*|   ...INCREASE THE NUMBER OF ROUTE CODES TO 2       */              86000000
*/*|   ...AND SET THE ROUTE CODES TO 2 AND 11           */              86400000
**********************************************************              86800000
         MVC   0(2,PMNTD),=H'0'    SET NUMBER OF TD QUEUES TO 0         87200005
         MVC   0(2,PMNRC),=H'2'    SET NUMBER ROUTE CODES TO 2          87600005
         MVI   0(PMROU),X'02'      SET FIRST ROUTE CODE TO 2            88000005
         MVI   1(PMROU),X'0B'      SET SECOND ROUTE CODE TO 11     @P1C 88400005
*                                                                       88450000
**********************************************************              88500000
*                         END.                           *              88560000
* <<<<<< SECTION TO BE MODIFIED BY THE USERS.     >>>>>> *              88620000
**********************************************************              88680000
*                                                                       88740000
*/*)   RETURN CODE NORMAL                              */               88800000
*                                                                       89200000
**********************************************************              89600000
*   RCNORMAL WILL SET THE RETURN CODE TO UERCNORM        *              90000000
**********************************************************              90400000
*                                                                       90800000
RCNORMAL DS    0H                                                       91200000
         LA    EXIT_RC,UERCNORM    SET THE RETURN CODE TO NORMAL   @P2C 91600000
         B     STEND                                                    92000000
*                                                                       92400000
**********************************************************              96000000
* RESTORE REGISTERS, SET RETURN CODE, AND RETURN TO USER *              96400000
* EXIT HANDLER.                                          *              96800000
**********************************************************              97200000
*                                                                       97600000
STEND    DS    0H                                                       98000000
         L     R13,UEPEPSA                                              98400000
         RETURN (14,12),RC=(15)                                         98800000
         LTORG                                                          99200000
         END   DPKCS223                                                 99600000
