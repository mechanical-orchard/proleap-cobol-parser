000100 IDENTIFICATION DIVISION.                                         00010007
000200 PROGRAM-ID.    RCKUT004.                                         00020007
000300 AUTHOR.        BETH A. BILSKI.                                   00030007
000400 DATE-WRITTEN.  03/94.                                            00040007
000500****************************************************************  00050007
000600*                                                                 00060007
000700*   PROCESSES ALL VERIFIED RECEIVERS UPDATING THE POSTING         00070007
000800*   TIMESTAMPS AND CREATING AN EXTRACT ROW FOR EACH STORE ON      00080007
000900*   THE RECEIVER                                                  00090007
001000                                                                  00100007
001100 ENVIRONMENT DIVISION.                                            00110007
001200 INPUT-OUTPUT SECTION.                                            00120007
001300                                                                  00130007
001400 FILE-CONTROL.                                                    00140007
001500     SELECT ERROR-FILE     ASSIGN TO UT-S-OUT01.                  00150007
001600     SELECT DATETIME-FILE  ASSIGN TO UT-S-OUT02.                  00160007
001700                                                                  00170007
001800 DATA DIVISION.                                                   00180007
001900                                                                  00190007
002000 FILE SECTION.                                                    00200007
002100*                                                                 00210007
002200 FD  ERROR-FILE                                                   00220007
002300     RECORDING MODE IS F                                          00230007
002400     LABEL RECORDS ARE STANDARD                                   00240007
002500     RECORD CONTAINS 80                                           00250007
002600     BLOCK CONTAINS 0 RECORDS                                     00260007
002700     DATA RECORD IS ERROR-RECORD.                                 00270007
002800 01  ERROR-RECORD                PIC X(80).                       00280007
002900*                                                                 00290007
003000 FD  DATETIME-FILE                                                00300007
003100     RECORDING MODE IS F                                          00310007
003200     LABEL RECORDS ARE STANDARD                                   00320007
003300     RECORD CONTAINS 80                                           00330007
003400     BLOCK CONTAINS 0 RECORDS                                     00340007
003500     DATA RECORD IS DATETIME-RECORD.                              00350007
003600 01  DATETIME-RECORD             PIC X(80).                       00360007
003700*                                                                 00370007
003800/                                                                 00380007
003900 WORKING-STORAGE SECTION.                                         00390007
004000                                                                  00400007
004100 01  PV-ABEND-CODE                    PIC S9(04)   VALUE +0       00410007
004200                                                   COMP SYNC.     00420007
004300*                                                                 00430030
004400 01  WS-FIELDS.                                                   00440030
004500     05  WS-BTCH-PRC-DTE              PIC X(10).                  00450030
004600                                                                  00460050
004700*                                                                 00470051
004800 01  CC-CONTROL-CARD                  PIC X(27).                  00480051
004900 01  CC-CONTROL-CARDR REDEFINES CC-CONTROL-CARD.                  00490051
005000     05  CC-YEAR                      PIC X(04).                  00500051
005100     05  CC-DASH1                     PIC X(01).                  00510051
005200     05  CC-MONTH                     PIC X(02).                  00520051
005300     05  CC-DASH2                     PIC X(01).                  00530051
005400     05  CC-DAY                       PIC X(02).                  00540051
005500     05  FILLER                       PIC X(01).                  00550051
005600     05  CC-RUN-DESCRIPTION           PIC X(16).                  00560051
005700         88  CC-VALID-MODE-IND        VALUE 'ORIG-NIGHTLY-RUN'    00570051
005800                                            'PRE-RUN         '.   00580051
005900         88  CC-ORIG-NIGHTLY-RUN      VALUE 'ORIG-NIGHTLY-RUN'.   00590051
006000         88  CC-PRE-RUN               VALUE 'PRE-RUN         '.   00600051
006100*                                                                 00610051
006200 01  PS-PROGRAM-SWITCHES.                                         00620051
006300     05  PS-XLT-LOC-CURSOR-SW         PIC X(01)  VALUE 'N'.       00630051
006400         88  PS-EOF-XLT-LOC-CSR                  VALUE 'Y'.       00640051
006500     05  PS-TRECEIV-CURSOR-SW         PIC X(01)  VALUE 'N'.       00650051
006600         88  PS-EOF-TRECEIV-CSR                  VALUE 'Y'.       00660051
006700     05  PS-TWKORIN-CURSOR-SW         PIC X(01)  VALUE 'N'.       00670051
006800         88  PS-EOF-TWKORIN-CSR                  VALUE 'Y'.       00680051
006900     05  PS-TRECDIS-CSR-SW            PIC X(01)  VALUE 'N'.       00690051
007000         88  PS-START-TRECDIS-CSR                VALUE 'N'.       00700051
007100         88  PS-EOF-TRECDIS-CSR                  VALUE 'Y'.       00710051
007200                                                                  00720051
007300     05  PS-TWKORIN-ZERO-SW           PIC X(01)  VALUE 'N'.       00730051
007400         88  PS-EOF-TWKORIN-ZERO                 VALUE 'Y'.       00740051
007500     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00750051
007600         88  PS-ERROR                            VALUE 'Y'.       00760051
007700     05  PS-TRECEIV-UPDATE-SW         PIC X(01)  VALUE 'N'.       00770051
007800         88  PS-TRECEIV-NOT-FOUND                VALUE 'Y'.       00780051
007900                                                                  00790051
008000 01  PV-PROGRAM-VARIABLES.                                        00800051
008100     05  PV-RETRY-COUNT               PIC S9(04)  VALUE +0        00810051
008200                                                  COMP SYNC.      00820051
008300     05  PV-AMT                       PIC  9(07)V99.              00830051
008400     05  PV-ORD-NBR                   PIC S9(09)  COMP.           00840051
008500     05  PV-REC-SEQ-NBR               PIC S9(09)  COMP.           00850051
008600     05  PV-RCVR-NBR                  PIC  9(09).                 00860051
008700     05  PV-RCVR-NBR-R REDEFINES PV-RCVR-NBR.                     00870051
008800         10  FILLER                   PIC  X(01).                 00880051
008900         10  PV-RCVR-KEYREC           PIC  X(08).                 00890051
009000     05  PV-TRECEIV-COUNT             PIC S9(09) VALUE ZERO       00900051
009100                                                 COMP SYNC.       00910051
009200     05  PV-TRECEIV-OK-COUNT          PIC S9(09) VALUE ZERO       00920051
009300                                                 COMP SYNC.       00930051
009400     05  PV-INSERT-COUNT              PIC S9(09) VALUE ZERO       00940051
009500                                                 COMP SYNC.       00950051
009600     05  PV-ERROR-COUNT               PIC S9(09) VALUE ZERO       00960051
009700                                                 COMP SYNC.       00970051
009800     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00980051
009900     05  PV-DISPLAY-TMST             PIC X(26) VALUE SPACES.      00990051
010000     05  PV-DISPLAY-TMST-30          PIC X(26) VALUE SPACES.      01000051
010100     05  PV-DISPLAY-RUN              PIC X(15) VALUE SPACES.      01010051
010200     05  PV-OPER-UNT-ID               PIC S9(04)  COMP.           01020051
010300     05  PV-LINE                      PIC S9(04)  COMP.           01030051
010400     05  PV-RECEIV-CRE-TMST           PIC  X(26)  VALUE SPACES.   01040051
010500     05  PV-CURR-TMST                 PIC  X(26)  VALUE SPACES.   01050051
010600     05  PV-CURR-TMST-30-MIN          PIC  X(26)  VALUE SPACES.   01060051
010700     05  PV-CONTROL-BEG               PIC  X(26).                 01070051
010800     05  PV-CONTROL-BEG-RDF REDEFINES PV-CONTROL-BEG.             01080051
010900         10  PV-CONTROL-DATE-BEG      PIC  X(10).                 01090051
011000         10  PV-RECEIV-TMST-BEG       PIC  X(16).                 01100051
011100     05  PV-CONTROL-END               PIC  X(26).                 01110051
011200     05  PV-CONTROL-END-RDF REDEFINES PV-CONTROL-END.             01120051
011300         10  PV-CONTROL-DATE-END      PIC  X(10).                 01130051
011400         10  PV-RECEIV-TMST-END       PIC  X(16).                 01140051
011500     05  PV-PRC-FCLTY-AREA-ID         PIC  X(06)  VALUE SPACES.   01150051
011600     05  PV-PURCHS-ENT-ID             PIC S9(09)  COMP.           01160051
011700     05  PV-STORE-NBR                 PIC S9(04)  COMP.           01170051
011800     05  PV-UNT-COST-AMT              PIC S9(4)V999 COMP-3        01180051
011900                                          VALUE +0.               01190051
012000     05  PV-CLASS-NMBR.                                           01200051
012100         10  PV-CLASS1                PIC  X(02).                 01210051
012200         10  PV-CLASS3                PIC  9(01).                 01220051
012300     05  PV-DEPT                      PIC  X(03).                 01230051
012400     05  PV-ITM-NBR                   PIC S9(15)V COMP-3.         01240051
012500     05  PV-VERIFIED-DATE             PIC  X(26).                 01250051
012600     05  PV-VERIFIED-DATER REDEFINES PV-VERIFIED-DATE.            01260051
012700         10  FILLER                   PIC  X(02).                 01270051
012800         10  PV-VER-YY                PIC  X(02).                 01280051
012900         10  FILLER                   PIC  X(01).                 01290051
013000         10  PV-VER-MM                PIC  X(02).                 01300051
013100         10  FILLER                   PIC  X(01).                 01310051
013200         10  PV-VER-DD                PIC  X(02).                 01320051
013300         10  FILLER                   PIC  X(16).                 01330051
013400     05  PV-VER-DATE.                                             01340051
013500         10  PV-DV-MM                 PIC  X(02).                 01350051
013600         10  PV-DV-DD                 PIC  X(02).                 01360051
013700         10  PV-DV-YY                 PIC  X(02).                 01370051
013800     05  PV-REC-TMST                  PIC  X(26).                 01380051
013900     05  PV-REC-TMSTR REDEFINES PV-REC-TMST.                      01390051
014000         10  FILLER                   PIC  X(02).                 01400051
014100         10  PV-REC-YY                PIC  X(02).                 01410051
014200         10  FILLER                   PIC  X(01).                 01420051
014300         10  PV-REC-MM                PIC  X(02).                 01430051
014400         10  FILLER                   PIC  X(01).                 01440051
014500         10  PV-REC-DD                PIC  X(02).                 01450051
014600         10  FILLER                   PIC  X(16).                 01460051
014700     05  PV-REC-DATE.                                             01470051
014800         10  PV-DR-MM                 PIC  X(02).                 01480051
014900         10  PV-DR-DD                 PIC  X(02).                 01490051
015000         10  PV-DR-YY                 PIC  X(02).                 01500051
015100     05  PV-DIVISION-SEQNO.                                       01510051
015200         10  PV-DIV-ZERO              PIC  X(01).                 01520051
015300         10  PV-DIV-SEQNO             PIC  X(02).                 01530051
015400     05  PV-EOF-TRECITM-SW            PIC  X(01)  VALUE 'N'.      01540051
015500         88  PV-EOF-TRECITM                       VALUE 'Y'.      01550051
015600     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   01560051
015700     05  PV-ERROR-MESSAGE-1           PIC  X(60)  VALUE SPACES.   01570051
015800     05  PV-ERROR-MESSAGE-2           PIC  X(60)  VALUE SPACES.   01580051
015900     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       01590051
016000 01  PV-ERROR-RECORD.                                             01600051
016100     05  PV-ERROR-PO                  PIC 9(08)  VALUE ZEROES.    01610051
016200     05  FILLER                       PIC X(01)  VALUE SPACES.    01620051
016300     05  PV-ERROR-REC-SEQ             PIC 9(09)  VALUE ZEROES.    01630051
016400     05  FILLER                       PIC X(01)  VALUE SPACES.    01640051
016500     05  PV-ERROR-PARA                PIC X(50)  VALUE SPACES.    01650051
016600     05  FILLER                       PIC X(11)  VALUE SPACES.    01660051
016700                                                                  01670051
016800 01  PV-DATETIME-WORK.                                            01680051
016900     05  PV-DATETIME-CC           PIC 9(02).                      01690051
017000     05  PV-DATETIME-YY           PIC 9(02).                      01700051
017100     05  FILLER                   PIC X(01)  VALUE '-'.           01710051
017200     05  PV-DATETIME-MM           PIC 9(02).                      01720051
017300     05  FILLER                   PIC X(01)  VALUE '-'.           01730051
017400     05  PV-DATETIME-DD           PIC 9(02).                      01740051
017500     05  FILLER                   PIC X(01)  VALUE '-'.           01750051
017600     05  PV-DATETIME-HO           PIC 9(02).                      01760051
017700     05  FILLER                   PIC X(01)  VALUE '.'.           01770051
017800     05  PV-DATETIME-MI           PIC 9(02).                      01780051
017900     05  FILLER                   PIC X(01)  VALUE '.'.           01790051
018000     05  PV-DATETIME-SS           PIC 9(02).                      01800051
018100     05  FILLER                   PIC X(01)  VALUE '.'.           01810051
018200     05  PV-DATETIME-MSEC         PIC 9(06).                      01820051
018300                                                                  01830051
018400 01  PV-DATETIME-RECORD.                                          01840051
018500     05  PV-DATETIME                  PIC X(26).                  01850051
018600     05  FILLER                       PIC X(54)  VALUE SPACES.    01860051
018700                                                                  01870051
018800 01  PC-PROGRAM-CONSTANTS.                                        01880051
018900     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT004'.01890051
019000     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         01900051
019100                                                 COMP SYNC.       01910051
019200     05  PC-DEFAULT-DATE              PIC X(26)   VALUE           01920051
019300                                   '9999-09-09-09.09.09.999999'.  01930051
019400     05  PC-MPS-PROGRAM-NAME         PIC  X(08)    VALUE          01940051
019500         'DPKUT039'.                                              01950051
019600     05  PC-CURRENT-OPERATING-COMPANY                             01960051
019700                                     PIC  X(02)    VALUE '03'.    01970051
019800     05  PC-SYSTEM-CODE              PIC  X(02)    VALUE 'MP'.    01980051
019900     05  PC-19                       PIC  9(02)    VALUE 19.      01990051
020000     05  PC-20                       PIC  9(02)    VALUE 20.      02000051
020100     05  PC-60                       PIC  9(02)    VALUE 60.      02010051
020200     05  PC-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    02020051
020300     05  FILLER REDEFINES PC-SYSTEM-DATE.                         02030051
020400         10  PC-SYSTEM-YY            PIC  9(02).                  02040051
020500         10  PC-SYSTEM-MM            PIC  9(02).                  02050051
020600         10  PC-SYSTEM-DD            PIC  9(02).                  02060051
020700     05  PC-SYSTEM-TIME              PIC  9(08)    VALUE ZERO.    02070051
020800     05  FILLER REDEFINES PC-SYSTEM-TIME.                         02080051
020900         10  PC-SYSTEM-HO            PIC  9(02).                  02090051
021000         10  PC-SYSTEM-MI            PIC  9(02).                  02100051
021100         10  PC-SYSTEM-SS            PIC  9(02).                  02110051
021200         10  FILLER                  PIC  X(02).                  02120051
021300     05  PC-DEFAULT-MESSAGE          PIC  X(50)    VALUE          02130051
021400         'RECEIV-VERFYD-TMST = 9999-09-09-09.09.09.999999 '.      02140051
021500                                                                  02150051
021600                                                                  02160051
021700 01  PT-STORE-TABLE.                                              02170051
021800     05  PT-STORE-TBL     OCCURS 50  TIMES                        02180051
021900                          INDEXED BY PT-STR-IDX.                  02190051
022000         10  PT-STR-NBR              PIC  S9(4)  COMP.            02200051
022100                                                                  02210051
022200                                                                  02220051
022300 01  PV-ABEND-FIELDS.                                             02230051
022400     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT004'.02240051
022500     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    02250051
022600     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    02260051
022700     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    02270051
022800     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    02280051
022900     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    02290051
023000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    02300051
023100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    02310051
023200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    02320051
023300     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    02330051
023400/                                                                 02340051
023500*                                                                 02350051
023600******************************************************************02360051
023700*  USED FOR DB2 ERROR MESSAGE BUILDING                            02370051
023800******************************************************************02380051
023900     COPY DPWS004.                                                02390051
024000*                                                                 02400051
024100/                                                                 02410051
024200******************************************************************02420051
024300*   DB2 SQL COMMUNICATION AREA                                    02430051
024400******************************************************************02440051
024500     EXEC SQL                                                     02450051
024600          INCLUDE SQLCA                                           02460051
024700     END-EXEC.                                                    02470051
024800                                                                  02480051
024900******************************************************************02490051
025000*   DB2 DCLGEN FOR TSTREXT TABLE (KEYREC/STORE TABLE)             02500051
025100******************************************************************02510051
025200     EXEC SQL                                                     02520051
025300          INCLUDE TSTREXT                                         02530051
025400     END-EXEC.                                                    02540051
025500                                                                  02550051
025600                                                                  02560051
025700******************************************************************02570051
025800*   DB2 DCLGEN FOR TWKORIN TABLE                                  02580051
025900******************************************************************02590051
026000     EXEC SQL                                                     02600051
026100          INCLUDE TWKORIN                                         02610051
026200     END-EXEC.                                                    02620051
026300                                                                  02630051
026400                                                                  02640051
026500******************************************************************02650051
026600*   DB2 DCLGEN FOR TPAYTRM TABLE                                  02660051
026700******************************************************************02670051
026800     EXEC SQL                                                     02680051
026900          INCLUDE TPAYTRM                                         02690051
027000     END-EXEC.                                                    02700051
027100                                                                  02710051
027200******************************************************************02720051
027300*   DB2 DCLGEN FOR TPOAGMT TABLE                                  02730051
027400******************************************************************02740051
027500     EXEC SQL                                                     02750051
027600          INCLUDE TPOAGMT                                         02760051
027700     END-EXEC.                                                    02770051
027800                                                                  02780051
027900******************************************************************02790051
028000*   DB2 DCLGEN FOR TPLNSHP TABLE                                  02800051
028100******************************************************************02810051
028200     EXEC SQL                                                     02820051
028300          INCLUDE TPLNSHP                                         02830051
028400     END-EXEC.                                                    02840051
028500                                                                  02850051
028600******************************************************************02860051
028700*   DB2 DCLGEN FOR TVNDDPT TABLE                                  02870051
028800******************************************************************02880051
028900     EXEC SQL                                                     02890051
029000          INCLUDE TVNDDPT                                         02900051
029100     END-EXEC.                                                    02910051
029200                                                                  02920051
029300******************************************************************02930051
029400*   DB2 DCLGEN FOR TEXTENT TABLE                                  02940051
029500******************************************************************02950051
029600     EXEC SQL                                                     02960051
029700          INCLUDE TEXTENT                                         02970051
029800     END-EXEC.                                                    02980051
029900                                                                  02990051
030000******************************************************************03000051
030100*   DB2 DCLGEN FOR TENTNME TABLE                                  03010051
030200******************************************************************03020051
030300     EXEC SQL                                                     03030051
030400          INCLUDE TENTNME                                         03040051
030500     END-EXEC.                                                    03050051
030600                                                                  03060051
030700                                                                  03070051
030800******************************************************************03080051
030900*   DB2 DCLGEN FOR RECEIVER TABLE                                 03090051
031000******************************************************************03100051
031100     EXEC SQL                                                     03110051
031200          INCLUDE TRECEIV                                         03120051
031300     END-EXEC.                                                    03130051
031400                                                                  03140051
031500******************************************************************03150051
031600*   DB2 DCLGEN FOR RECEIVER ITEM TABLE                            03160051
031700******************************************************************03170051
031800     EXEC SQL                                                     03180051
031900          INCLUDE TRECITM                                         03190051
032000     END-EXEC.                                                    03200051
032100                                                                  03210051
032200******************************************************************03220051
032300*   DB2 DCLGEN FOR RECEIVER DISTRIBUTION TABLE                    03230051
032400******************************************************************03240051
032500     EXEC SQL                                                     03250051
032600          INCLUDE TRECDIS                                         03260051
032700     END-EXEC.                                                    03270051
032800                                                                  03280051
032900******************************************************************03290051
033000*  DCLGEN FOR THE DB2 PURCHASE ORDER TABLE                        03300051
033100******************************************************************03310051
033200     EXEC SQL                                                     03320051
033300         INCLUDE TPURCHS                                          03330051
033400     END-EXEC.                                                    03340051
033500                                                                  03350051
033600******************************************************************03360051
033700*  DCLGEN FOR THE DB2 PURCHASE ORDER LINE ITEM TABLE              03370051
033800******************************************************************03380051
033900     EXEC SQL                                                     03390051
034000         INCLUDE TPURITM                                          03400051
034100     END-EXEC.                                                    03410051
034200                                                                  03420051
034300******************************************************************03430051
034400*  DCLGEN FOR THE STORE TABLE                                     03440051
034500******************************************************************03450051
034600     EXEC SQL                                                     03460051
034700         INCLUDE XLT00010                                         03470051
034800     END-EXEC.                                                    03480051
034900                                                                  03490051
035000******************************************************************03500051
035100*  DCLGEN FOR THE COMPANY CONTROL TABLE                           03510051
035200******************************************************************03520051
035300     EXEC SQL                                                     03530051
035400         INCLUDE TCOCNTL                                          03540051
035500     END-EXEC.                                                    03550051
035600                                                                  03560051
035700******    WR # 27201 - START                                      03570051
035800******************************************************************03580051
035900*  DCLGEN FOR THE RCT_PRC_RCPT TABLE                              03590051
036000******************************************************************03600051
036100     EXEC SQL                                                     03610051
036200         INCLUDE RCT00019                                         03620051
036300     END-EXEC.                                                    03630051
036400******    WR # 27201 - END                                        03640051
036500******************************************************************03650051
036600* TRECEIV CURSOR                                                 *03660051
036700******************************************************************03670051
036800* THE FOLLOWING CURSOR IS FOR THE ORIGINAL AFTER MIDNITE RUN      03680051
036900     EXEC SQL                                                     03690051
037000          DECLARE TRECEIV-CSR1 CURSOR WITH HOLD FOR               03700051
037100           SELECT A.ORD_NBR                                       03710051
037200                 ,A.REC_SEQ_NBR                                   03720051
037300                 ,A.CRE_TMST                                      03730051
037400                 ,A.OPER_UNT_ID                                   03740051
037500                 ,A.FCLTY_ID                                      03750051
037600                 ,A.REC_TMST                                      03760051
037700                 ,A.RCVR_NBR                                      03770051
037800                 ,A.VERFYD_TMST                                   03780051
037900                 ,A.CURR_OPER_UNT_ID                              03790051
038000                 ,A.CURR_FCLTY_ID                                 03800051
038100           FROM   TRECEIV A                                       03810051
038200           WHERE  A.STATUS_CDE       = 'VE'                       03820051
038300           AND  A.ML_POST_TMST       = :PC-DEFAULT-DATE           03830051
038400           AND  A.FS_POST_TMST       = :PC-DEFAULT-DATE           03840051
038500           AND  DATE(VERFYD_TMST)   <= :COCNTL-BTCH-PRC-DTE       03850051
038600           AND  A.VER_STATUS_CDE     = 'A'                        03860051
038700           ORDER BY A.ORD_NBR                                     03870051
038800     END-EXEC.                                                    03880051
038900                                                                  03890051
039000* THE FOLLOWING CURSOR FOR THE PRE-RUN                            03900051
039100     EXEC SQL                                                     03910051
039200        DECLARE TRECEIV-CSR2 CURSOR WITH HOLD FOR                 03920051
039300         SELECT A.ORD_NBR                                         03930051
039400               ,A.REC_SEQ_NBR                                     03940051
039500               ,A.CRE_TMST                                        03950051
039600               ,A.OPER_UNT_ID                                     03960051
039700               ,A.FCLTY_ID                                        03970051
039800               ,A.REC_TMST                                        03980051
039900               ,A.RCVR_NBR                                        03990051
040000               ,A.VERFYD_TMST                                     04000051
040100               ,A.CURR_OPER_UNT_ID                                04010051
040200               ,A.CURR_FCLTY_ID                                   04020051
040300         FROM   TRECEIV A                                         04030051
040400         WHERE  A.STATUS_CDE      = 'VE'                          04040051
040500         AND A.ML_POST_TMST       = :PC-DEFAULT-DATE              04050051
040600         AND A.FS_POST_TMST       = :PC-DEFAULT-DATE              04060051
040700         AND DATE(VERFYD_TMST)   <= :WS-BTCH-PRC-DTE              04070051
040800         AND VERFYD_TMST       < (CURRENT TIMESTAMP - 30 MINUTES) 04080054
040900         AND A.VER_STATUS_CDE     = 'A'                           04090039
041000         ORDER BY A.ORD_NBR                                       04100039
041100     END-EXEC.                                                    04110039
041200                                                                  04120039
041300******************************************************************04130039
041400*  STORE CURSOR                                                  *04140039
041500******************************************************************04150039
041600     EXEC SQL                                                     04160039
041700          DECLARE XLT-LOC-CSR CURSOR WITH HOLD FOR                04170039
041800           SELECT                                                 04180039
041900                  LOC_NBR                                         04190039
042000           FROM   XLT_LOC                                         04200039
042100           WHERE  LOC_TYP_CDE = 'DC'                              04210039
042200     END-EXEC.                                                    04220039
042300                                                                  04230039
042400*                                                                 04240039
042500******************************************************************04250039
042600*  TRECITM CURSOR                                                *04260039
042700******************************************************************04270039
042800******    WR # 27201 - ADDED RETAIL FIELDS TO CURSOR              04280039
042900     EXEC SQL                                                     04290039
043000          DECLARE TRECITM-CSR CURSOR WITH HOLD FOR                04300039
043100           SELECT                                                 04310039
043200                  ORD_LNE_NBR                                     04320039
043300                 ,PO_VER_NBR                                      04330039
043400                 ,PKSL_NBR                                        04340039
043500                 ,UNT_RTL_AMT                                     04350039
043600                 ,GP_RTL_AMT                                      04360039
043700                 ,GP_QTY                                          04370039
043800           FROM   TRECITM                                         04380039
043900           WHERE  ORD_NBR = :PV-ORD-NBR                           04390039
044000              AND VER_STATUS_CDE     = 'A'                        04400039
044100              AND REC_SEQ_NBR        = :PV-REC-SEQ-NBR            04410039
044200              AND ORD_LNE_NBR        < 1000                       04420039
044300           ORDER BY ORD_LNE_NBR                                   04430039
044400     END-EXEC.                                                    04440039
044500                                                                  04450039
044600******************************************************************04460039
044700*  TRECDIS CURSOR                                                *04470039
044800******************************************************************04480039
044900     EXEC SQL                                                     04490039
045000         DECLARE TRECDIS-CSR CURSOR WITH HOLD FOR                 04500039
045100         SELECT                                                   04510039
045200                STR_NBR                                           04520039
045300              , EXPTED_ITM_QTY                                    04530039
045400              , PLAN_ITM_QTY                                      04540039
045500              , AP_VERIFY_ITM_QTY                                 04550039
045600                                                                  04560039
045700              FROM  TRECDIS                                       04570039
045800                                                                  04580039
045900              WHERE ORD_NBR        = :PV-ORD-NBR                  04590039
046000                AND ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR          04600039
046100                AND REC_SEQ_NBR    = :PV-REC-SEQ-NBR              04610039
046500*            ORDER BY STR_NBR                                     04650039
046600     END-EXEC.                                                    04660039
046700                                                                  04670039
046800*                                                                 04680039
046900******************************************************************04690039
047000*  TWKORIN CURSOR                                                *04700039
047100******************************************************************04710039
047200     EXEC SQL                                                     04720039
047300          DECLARE TWKORIN-CSR CURSOR WITH HOLD FOR                04730039
047400             SELECT                                               04740039
047500                    STRT_TMST                                     04750039
047600                   ,STOP_TMST                                     04760039
047700                   ,PRC_FCLTY_AREA_ID                             04770039
047800                   ,SCREEN_SEQ_NBR                                04780039
047900             FROM   TWKORIN                                       04790039
048000             WHERE ORD_NBR            = :PV-ORD-NBR               04800039
048100               AND RCVR_SEQ_NBR       = :PV-REC-SEQ-NBR           04810039
048200               AND ORD_LNE_NBR        = :PV-LINE                  04820039
048300               AND WORK_ORD_SEQ_NBR   = 1                         04830039
048400               AND OPER_UNT_ID        = :PV-OPER-UNT-ID           04840039
048500               AND VER_STATUS_CDE     = 'A'                       04850039
048600             ORDER BY SCREEN_SEQ_NBR                              04860039
048700     END-EXEC.                                                    04870039
048800                                                                  04880039
048900*                                                                 04890039
049000******************************************************************04900039
049100*  TWKORIN CURSOR - FOR LINE NUMBER = ZERO                       *04910039
049200******************************************************************04920039
049300     EXEC SQL                                                     04930039
049400          DECLARE WKORIN0-CSR CURSOR WITH HOLD FOR                04940039
049500             SELECT STRT_TMST                                     04950039
049600                   ,STOP_TMST                                     04960039
049700                   ,PRC_FCLTY_AREA_ID                             04970039
049800                   ,SCREEN_SEQ_NBR                                04980039
049900             FROM   TWKORIN                                       04990039
050000             WHERE ORD_NBR            = :PV-ORD-NBR               05000039
050100               AND RCVR_SEQ_NBR       = :PV-REC-SEQ-NBR           05010039
050200               AND ORD_LNE_NBR        = 0                         05020039
050300               AND WORK_ORD_SEQ_NBR   = 1                         05030039
050400               AND OPER_UNT_ID        = :PV-OPER-UNT-ID           05040039
050500               AND VER_STATUS_CDE     = 'A'                       05050039
050600             ORDER BY SCREEN_SEQ_NBR                              05060039
050700     END-EXEC.                                                    05070039
050800                                                                  05080039
050900*                                                                 05090039
051000***********************************************************       05100039
051100*  COPYBOOK USED BY MBS SYSTEM                            *       05110039
051200***********************************************************       05120039
051300     COPY DPWS003.                                                05130039
051400*                                                                 05140039
051500/                                                                 05150039
051600 PROCEDURE DIVISION.                                              05160039
051700                                                                  05170039
051800     OPEN OUTPUT ERROR-FILE                                       05180039
051900                 DATETIME-FILE.                                   05190039
052000                                                                  05200039
052100     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           05210039
052200     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             05220039
052300             CC-CONTROL-CARD.                                     05230039
052400     IF NOT CC-VALID-MODE-IND                                     05240039
052500        DISPLAY '***************************'                     05250039
052600        DISPLAY 'CONTROL PARAMETERS: '                            05260039
052700                 CC-CONTROL-CARD                                  05270039
052800        DISPLAY 'MODE INDICATOR "' CC-RUN-DESCRIPTION '"'         05280039
052900                ' IS INVALID.'                                    05290039
053000        DISPLAY 'RUN ABORTED'                                     05300039
053100        DISPLAY '***************************'                     05310039
053200        PERFORM 9210-ABEND                                        05320039
053300     END-IF                                                       05330039
053400                                                                  05340052
053500     ACCEPT PC-SYSTEM-DATE FROM DATE.                             05350039
053600     MOVE PC-SYSTEM-YY TO PV-DATETIME-YY.                         05360039
053700     IF PC-SYSTEM-YY > PC-60                                      05370039
053800         MOVE PC-19 TO PV-DATETIME-CC                             05380039
053900     ELSE                                                         05390039
054000         MOVE PC-20 TO PV-DATETIME-CC                             05400039
054100     END-IF.                                                      05410039
054200     MOVE PC-SYSTEM-MM TO PV-DATETIME-MM.                         05420039
054300     MOVE PC-SYSTEM-DD TO PV-DATETIME-DD.                         05430039
054400     ACCEPT PC-SYSTEM-TIME FROM TIME.                             05440039
054500     MOVE PC-SYSTEM-HO TO PV-DATETIME-HO.                         05450039
054600     MOVE PC-SYSTEM-MI TO PV-DATETIME-MI.                         05460039
054700     MOVE PC-SYSTEM-SS TO PV-DATETIME-SS.                         05470039
054800     MOVE ZERO         TO PV-DATETIME-MSEC.                       05480039
054900     MOVE PV-DATETIME-WORK TO PV-DATETIME.                        05490039
055000                                                                  05500039
055100     WRITE DATETIME-RECORD FROM PV-DATETIME-RECORD.               05510039
055200     INITIALIZE PT-STORE-TABLE.                                   05520039
055300     PERFORM 8000-OPEN-XLT-LOC-CURSOR.                            05530039
055400                                                                  05540039
055500     PERFORM 8010-FETCH-XLT-LOC-CSR.                              05550039
055600                                                                  05560039
055700     PERFORM 8200-LOAD-STORE-TABLE                                05570039
055800         VARYING PT-STR-IDX                                       05580039
055900          FROM 1 BY 1                                             05590039
056000          UNTIL PT-STR-IDX  > 50                                  05600039
056100             OR PS-EOF-XLT-LOC-CSR.                               05610039
056200                                                                  05620039
056300     PERFORM 8300-CLOSE-XLT-LOC-CSR.                              05630039
056400                                                                  05640039
056500     PERFORM 6000-SELECT-TCOCNTL.                                 05650039
056600                                                                  05660045
056700                                                                  05670054
056800     EXEC SQL                                                     05680054
056900         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    05690054
057000     END-EXEC                                                     05700054
057100                                                                  05710054
057200     EXEC SQL                                                     05720054
057300         SET :PV-CURR-TMST-30-MIN = CURRENT TIMESTAMP - 30 MINUTES05730054
057400     END-EXEC                                                     05740054
057500                                                                  05750054
057600     IF CC-ORIG-NIGHTLY-RUN                                       05760039
057700         PERFORM 7000-OPEN-TRECEIV-CSR1                           05770039
057800         PERFORM 7100-FETCH-TRECEIV-CSR1                          05780039
057900     ELSE                                                         05790039
058000         PERFORM 6500-SELECT-TCOCNTL                              05800039
058100         PERFORM 7010-OPEN-TRECEIV-CSR2                           05810039
058200         PERFORM 7110-FETCH-TRECEIV-CSR2                          05820039
058300     END-IF                                                       05830039
058400                                                                  05840039
058500     PERFORM 1000-PROCESS-EXTRACTS                                05850039
058600         UNTIL PS-EOF-TRECEIV-CSR.                                05860039
058700                                                                  05870039
058800     IF CC-ORIG-NIGHTLY-RUN                                       05880039
058900         PERFORM 7200-CLOSE-TRECEIV-CSR1                          05890039
059000     ELSE                                                         05900039
059100         PERFORM 7210-CLOSE-TRECEIV-CSR2                          05910039
059200     END-IF.                                                      05920039
059300                                                                  05930039
059400     CLOSE ERROR-FILE                                             05940039
059500           DATETIME-FILE.                                         05950039
059600                                                                  05960039
059700     DISPLAY SPACES.                                              05970039
059800     MOVE PV-TRECEIV-COUNT TO PV-DISPLAY-COUNT                    05980039
059900     DISPLAY 'NUMBER OF TRECEIV ROWS EXTRACTED '                  05990039
060000                                  PV-DISPLAY-COUNT.               06000039
060100                                                                  06010039
060200     MOVE PV-TRECEIV-OK-COUNT  TO PV-DISPLAY-COUNT                06020039
060300     DISPLAY 'NUMBER OF TRECEIV ROWS PROCESSED '                  06030039
060400                                  PV-DISPLAY-COUNT.               06040039
060500                                                                  06050039
060600     MOVE PV-INSERT-COUNT      TO PV-DISPLAY-COUNT                06060039
060700     DISPLAY 'NUMBER OF TSTREXT ROWS INSERTED  '                  06070039
060800                                  PV-DISPLAY-COUNT.               06080039
060900                                                                  06090039
061000     MOVE PV-ERROR-COUNT       TO PV-DISPLAY-COUNT                06100039
061100     DISPLAY 'NUMBER OF ERROR RECORDS WRITTEN  '                  06110039
061200                                  PV-DISPLAY-COUNT.               06120039
061300                                                                  06130039
061400     MOVE PV-CURR-TMST         TO PV-DISPLAY-TMST                 06140054
061500     DISPLAY 'CURRENT TIMESTAMP   '                               06150051
061600                                  PV-DISPLAY-TMST.                06160051
061700                                                                  06170051
061800     MOVE PV-CURR-TMST-30-MIN  TO PV-DISPLAY-TMST-30              06180054
061900     DISPLAY 'CURRENT TIMESTAMP - 30 MINUTES '                    06190051
062000                                  PV-DISPLAY-TMST-30.             06200051
062100                                                                  06210051
062200     IF CC-ORIG-NIGHTLY-RUN                                       06220051
062300        DISPLAY 'ORIG NIGHT RUN   '                               06230051
062400                                  PV-DISPLAY-RUN                  06240051
062500     ELSE                                                         06250051
062600        DISPLAY 'PRE RUN          '                               06260051
062700                                  PV-DISPLAY-RUN                  06270051
062800     END-IF.                                                      06280051
062900                                                                  06290051
063000     GOBACK.                                                      06300051
063100                                                                  06310051
063200/                                                                 06320051
063300 1000-PROCESS-EXTRACTS.                                           06330051
063400                                                                  06340051
063500     MOVE 'N'                    TO PS-ERROR-SW.                  06350051
063600     MOVE RECEIV-ORD-NBR         TO STREXT-PO-NBR                 06360051
063700                                    PV-ORD-NBR.                   06370051
063800                                                                  06380051
063900     MOVE RECEIV-RCVR-NBR        TO PV-RCVR-NBR.                  06390051
064000     MOVE PV-RCVR-KEYREC         TO STREXT-RCVR-NBR.              06400051
064100                                                                  06410051
064200     MOVE RECEIV-REC-SEQ-NBR     TO STREXT-REC-SEQ-NBR.           06420051
064300     MOVE 'R'                    TO STREXT-REC-SRC-CDE.           06430051
064400     MOVE RECEIV-REC-SEQ-NBR     TO PV-REC-SEQ-NBR.               06440051
064500     MOVE PV-REC-YY              TO PV-DR-YY.                     06450051
064600     MOVE PV-REC-MM              TO PV-DR-MM.                     06460051
064700     MOVE PV-REC-DD              TO PV-DR-DD.                     06470051
064800     MOVE PV-REC-DATE            TO STREXT-REC-DTE.               06480051
064900     MOVE '03'                   TO STREXT-OP-CO-NBR.             06490051
065000     MOVE PV-VER-MM              TO PV-DV-MM.                     06500051
065100     MOVE PV-VER-DD              TO PV-DV-DD.                     06510051
065200     MOVE PV-VER-YY              TO PV-DV-YY.                     06520051
065300     MOVE PV-VER-DATE            TO STREXT-VERIFYD-CT-DTE.        06530051
065400     MOVE RECEIV-CURR-OPER-UNT-ID                                 06540051
065500                                 TO STREXT-CURR-OPER-UNT-ID.      06550051
065600     MOVE RECEIV-CURR-FCLTY-ID   TO STREXT-CURR-FCLTY-ID.         06560051
065700     MOVE RECEIV-OPER-UNT-ID     TO STREXT-OPER-UNT-ID.           06570051
065800     MOVE RECEIV-FCLTY-ID        TO STREXT-FCLTY-ID.              06580051
065900                                                                  06590051
066000     SET PT-STR-IDX              TO  1.                           06600051
066100     SEARCH PT-STORE-TBL                                          06610051
066200         AT END                                                   06620051
066300             MOVE 'DS'           TO STREXT-STR-TYP-CDE            06630051
066400         WHEN PT-STR-NBR (PT-STR-IDX) = RECEIV-OPER-UNT-ID        06640051
066500             MOVE 'DC'           TO STREXT-STR-TYP-CDE            06650051
066600     END-SEARCH.                                                  06660051
066700                                                                  06670051
066800     MOVE RECEIV-OPER-UNT-ID     TO PV-OPER-UNT-ID.               06680051
066900     MOVE SPACES                 TO PV-PRC-FCLTY-AREA-ID.         06690051
067000                                                                  06700051
067100     PERFORM 3000-SELECT-TPURCHS.                                 06710051
067200     IF  PS-ERROR                                                 06720051
067300         CONTINUE                                                 06730051
067400     ELSE                                                         06740051
067500         IF  PV-VERIFIED-DATE = PC-DEFAULT-DATE                   06750051
067600             SET PS-ERROR TO TRUE                                 06760051
067700             MOVE PC-DEFAULT-MESSAGE TO PV-ERROR-PARA             06770051
067800         ELSE                                                     06780051
067900            PERFORM 3100-GET-DIVISION-NMBR                        06790051
068000            IF  PS-ERROR                                          06800051
068100                CONTINUE                                          06810051
068200            ELSE                                                  06820051
068300                PERFORM 3200-GET-VENDOR-INFO                      06830051
068400                IF  PS-ERROR                                      06840051
068500                    CONTINUE                                      06850051
068600                ELSE                                              06860051
068700                    PERFORM 3500-PROCESS-PAYT-TERMS               06870051
068800                    IF  PS-ERROR                                  06880051
068900                        CONTINUE                                  06890051
069000                    ELSE                                          06900051
069100                        PERFORM 4000-TRECITM-LOOP                 06910051
069200                        IF  PS-ERROR                              06920051
069300                            CONTINUE                              06930051
069400                        ELSE                                      06940051
069500                            INITIALIZE PS-TRECEIV-UPDATE-SW       06950051
069600                            PERFORM 2000-UPDATE-TRECEIV           06960051
069700                            IF PS-TRECEIV-NOT-FOUND               06970051
069800                                EXEC SQL                          06980051
069900                                     ROLLBACK                     06990051
070000                                END-EXEC                          07000051
070100                            ELSE                                  07010051
070200                                ADD +1 TO PV-TRECEIV-OK-COUNT     07020051
070300                                PERFORM Z100-COMMIT               07030051
070400                            END-IF                                07040051
070500                        END-IF                                    07050051
070600                     END-IF                                       07060051
070700                 END-IF                                           07070051
070800             END-IF                                               07080051
070900         END-IF                                                   07090051
071000     END-IF.                                                      07100051
071100     IF  PS-ERROR                                                 07110051
071200         MOVE PV-ORD-NBR           TO PV-ERROR-PO                 07120051
071300         MOVE PV-REC-SEQ-NBR       TO PV-ERROR-REC-SEQ            07130051
071400         WRITE ERROR-RECORD FROM PV-ERROR-RECORD                  07140051
071500         ADD +1                    TO PV-ERROR-COUNT              07150051
071600     END-IF.                                                      07160051
071700                                                                  07170051
071800     IF CC-ORIG-NIGHTLY-RUN                                       07180051
071900         PERFORM 7100-FETCH-TRECEIV-CSR1                          07190051
072000     ELSE                                                         07200051
072100         PERFORM 7110-FETCH-TRECEIV-CSR2                          07210051
072200     END-IF.                                                      07220051
072300                                                                  07230051
072400**                                                                07240051
072500/                                                                 07250051
072600***************************************************************   07260051
072700*  THIS PARAGRAPH WILL SET THE TIMESTAMPS TO THE PROPER RUN   *   07270051
072800*  TIME.  THE REPORT INDICATOR IS OVERLAYED WITH IT'S ORIGINAL*   07280051
072900*  VALUE (THIS IS DONE DUE TO THE CURSOR BEING OPENED FOR UPDATE) 07290051
073000*  PV-DATETIME IS ACCEPTED FROM THE SYSTEM                        07300051
073100***************************************************************** 07310051
073200 2000-UPDATE-TRECEIV.                                             07320051
073300                                                                  18950056
073400     EXEC SQL                                                     07340055
073500          UPDATE                                                  07350055
073600               TRECEIV                                            07360055
073700          SET ML_POST_TMST         =  :PV-DATETIME,               07370055
073800              FS_POST_TMST         =  :PV-DATETIME                07380055
073900        WHERE   ORD_NBR            =  :RECEIV-ORD-NBR             07390055
074000          AND   REC_SEQ_NBR        =  :RECEIV-REC-SEQ-NBR         07400055
074100          AND   CRE_TMST           =  :PV-RECEIV-CRE-TMST         07410055
074200          AND   OPER_UNT_ID        =  :RECEIV-OPER-UNT-ID         07420055
074300          AND   RCVR_NBR           =  :RECEIV-RCVR-NBR            07430055
074400          AND   STATUS_CDE         =  'VE'                        07440055
074500          AND   VER_STATUS_CDE     =  'A'                         07450055
074600     END-EXEC.                                                    07460055
074700                                                                  07470051
074800     EVALUATE TRUE                                                07480051
074900         WHEN SQLCODE = ZERO                                      07490051
075000              CONTINUE                                            07500051
075100         WHEN SQLCODE = +100                                      07510051
075200              SET PS-TRECEIV-NOT-FOUND                            07520051
075300                           TO TRUE                                07530051
075400         WHEN SQLWARN0 NOT = SPACE                                07540051
075500         WHEN SQLCODE NOT = ZERO                                  07550051
075600         WHEN SQLCODE  NOT = +0                                   07560051
075700              MOVE '2000-UPDATE-TRECEIV'                          07570051
075800                           TO PV-ABEND-PARAGRAPH                  07580051
075900              MOVE 'UPDATE TRECEIV CURSOR'                        07590051
076000                           TO PV-ABEND-OPERATION                  07600051
076100              MOVE 'TRECIEV'   TO PV-ABEND-STRUCTURE-1            07610051
076200              MOVE SPACES      TO PV-ABEND-STRUCTURE-2            07620051
076300              DISPLAY 'RECEIVER ORD NBR' RECEIV-ORD-NBR           07630051
076400              DISPLAY 'REC SEQ NBR ' RECEIV-REC-SEQ-NBR           07640051
076500              MOVE RECEIV-ORD-NBR                                 07650051
076600                           TO PV-DB2-OPERATION-MESSAGE-1          07660051
076700              MOVE RECEIV-REC-SEQ-NBR                             07670051
076800                           TO PV-DB2-OPERATION-MESSAGE-2          07680051
076900              PERFORM 9900-DB2-ABEND                              07690051
077000     END-EVALUATE.                                                07700051
077100/                                                                 07720051
077200 3000-SELECT-TPURCHS.                                             07730051
077300     PERFORM                                                      07740051
077400         WITH TEST AFTER                                          07750051
077500         VARYING PV-RETRY-COUNT                                   07760051
077600         FROM 1 BY 1                                              07770051
077700         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 07780051
077800             OR (SQLCODE = +0)                                    07790051
077900             OR (SQLCODE = +100))                                 07800051
078000                                                                  07810051
078100**                                                                07820051
078200         EXEC SQL                                                 07830051
078300              SELECT DEPT_NBR                                     07840051
078400                    ,ENT_ID                                       07850051
078500              INTO   :PURCHS-DEPT-NBR                             07860051
078600                    ,:PV-PURCHS-ENT-ID                            07870051
078700                                                                  07880051
078800              FROM  TPURCHS                                       07890051
078900              WHERE PO_NBR         = :RECEIV-ORD-NBR              07900051
079000                AND VER_STATUS_CDE = 'A'                          07910051
079100         END-EXEC                                                 07920051
079200                                                                  07930051
079300         EVALUATE TRUE                                            07940051
079400             WHEN SQLCODE = ZERO                                  07950051
079500                 MOVE PURCHS-DEPT-NBR TO STREXT-DEPT-NBR          07960051
079600                                         PV-DEPT                  07970051
079700             WHEN SQLCODE = +100                                  07980051
079800                  SET PS-ERROR TO TRUE                            07990051
079900                  MOVE '3000-SELECT-TPURCHS'                      08000051
080000                               TO PV-ERROR-PARA                   08010051
080100             WHEN OTHER                                           08020051
080200                  MOVE '3000-SELECT-TPURCHS'                      08030051
080300                               TO PV-ABEND-PARAGRAPH              08040051
080400                  MOVE 'SELECT TPURCHS CURSOR'                    08050051
080500                               TO PV-ABEND-OPERATION              08060051
080600                  MOVE 'TPURCHS'   TO PV-ABEND-STRUCTURE-1        08070051
080700                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        08080051
080800                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  08090051
080900                                 TO PV-DB2-OPERATION-MESSAGE-1    08100051
081000                  MOVE PV-ORD-NBR                                 08110051
081100                                   TO PV-DB2-OPERATION-MESSAGE-2  08120051
081200                  PERFORM 9900-DB2-ABEND                          08130051
081300         END-EVALUATE                                             08140051
081400     END-PERFORM.                                                 08150051
081500                                                                  08160051
081600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          08170051
081700         MOVE '3000-SELECT-TPURCHS'                               08180051
081800                                 TO PV-ABEND-PARAGRAPH            08190051
081900         MOVE 'MAX RETRIES EXCEEDED'                              08200051
082000                                 TO PV-ABEND-OPERATION            08210051
082100         PERFORM 9900-DB2-ABEND                                   08220051
082200     END-IF.                                                      08230051
082300                                                                  08240051
082400/                                                                 08250051
082500 3100-GET-DIVISION-NMBR.                                          08260051
082600******************************************************************08270051
082700*  GET THE BUYER NAME AND NUMBER INFORMATION FROM THE MBS TABLES  08280051
082800*  USING SUBROUTINE 'DPKUT038'.                                   08290051
082900******************************************************************08300051
083000     SET DP003-DMM-LOOKUP-NMBR         TO TRUE.                   08310051
083100     MOVE PURCHS-DEPT-NBR              TO DP003-DPT-INPUT.        08320051
083200     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      08330051
083300     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       08340051
083400     MOVE PC-SYSTEM-DATE               TO DP003-CURRENT-DATE      08350051
083500                                          DP003-EFF-DATE.         08360051
083600*                                                                 08370051
083700     CALL PC-MPS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.08380051
083800*                                                                 08390051
083900     EVALUATE TRUE                                                08400051
084000        WHEN DP003-SUCCESSFUL                                     08410051
084100           MOVE DP003-DMM-NMBR   TO PV-DIV-SEQNO                  08420051
084200           MOVE ZERO             TO PV-DIV-ZERO                   08430051
084300           MOVE PV-DIVISION-SEQNO                                 08440051
084400                                 TO STREXT-DIV-SEQ-NBR            08450051
084500        WHEN DP003-DMM-NMBR-NOT-FOUND                             08460051
084600           INITIALIZE STREXT-DIV-SEQ-NBR                          08470051
084700        WHEN DP003-DMM-NMBR-DB2-ERROR                             08480051
084800           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          08490051
084900           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         08500051
085000                                 TO PV-ABEND-STRUCTURE-2          08510051
085100           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          08520051
085200           MOVE DP003-SQLCA      TO SQLCA                         08530051
085300           PERFORM 9900-DB2-ABEND                                 08540051
085400        WHEN DP003-DMM-NMBR-MAX-RETRIES                           08550051
085500           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          08560051
085600           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         08570051
085700                                 TO PV-ABEND-STRUCTURE-2          08580051
085800           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          08590051
085900           MOVE DP003-SQLCA      TO SQLCA                         08600051
086000           PERFORM 9900-DB2-ABEND                                 08610051
086100        WHEN DP003-NO-INPUT-SELECTION                             08620051
086200           MOVE 'CURRENT INPUT FIELDS ARE: '                      08630051
086300                                 TO PV-ERROR-MESSAGE-1            08640051
086400           MOVE DP003-INPUT-FIELDS                                08650051
086500                                 TO PV-ERROR-MESSAGE-2            08660051
086600           PERFORM 9200-ABEND                                     08670051
086700        WHEN DP003-SYSTEM-CODE-ERROR                              08680051
086800           MOVE 'THE SYSTEM CODE IS: '                            08690051
086900                                 TO PV-ERROR-MESSAGE-1            08700051
087000           MOVE DP003-SYSTEM-CODE                                 08710051
087100                                 TO PV-ERROR-MESSAGE-2            08720051
087200           PERFORM 9200-ABEND                                     08730051
087300        WHEN DP003-CURRENT-DATE-ERROR                             08740051
087400           MOVE 'THE CURRENT DATE USED IS:'                       08750051
087500                                 TO PV-ERROR-MESSAGE-1            08760051
087600           MOVE DP003-CURRENT-DATE                                08770051
087700                                 TO PV-ERROR-MESSAGE-2            08780051
087800           PERFORM 9200-ABEND                                     08790051
087900        WHEN DP003-EFF-DATE-ERROR                                 08800051
088000           MOVE 'THE EFFECTIVE DATE USED IS:'                     08810051
088100                                 TO PV-ERROR-MESSAGE-1            08820051
088200           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            08830051
088300           PERFORM 9200-ABEND                                     08840051
088400        WHEN DP003-DPT-MUST-BE-NUMERIC                            08850051
088500           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         08860051
088600                                 TO PV-ERROR-MESSAGE-1            08870051
088700           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            08880051
088800           PERFORM 9200-ABEND                                     08890051
088900        WHEN OTHER                                                08900051
089000           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '08910051
089100                                 TO PV-ERROR-MESSAGE-1            08920051
089200           MOVE DP003-INPUT-FIELDS                                08930051
089300                                 TO PV-ERROR-MESSAGE-2            08940051
089400           PERFORM 9200-ABEND                                     08950051
089500     END-EVALUATE.                                                08960051
089600/                                                                 08970051
089700 3200-GET-VENDOR-INFO.                                            08980051
089800                                                                  08990051
089900     EXEC SQL                                                     09000051
090000          SELECT INHOUSE_NBR                                      09010051
090100          INTO :VNDDPT-INHOUSE-NBR                                09020051
090200          FROM TVNDDPT                                            09030051
090300          WHERE DEPT_NBR       = :PV-DEPT                         09040051
090400            AND  ENT_ID        = :PV-PURCHS-ENT-ID                09050051
090500     END-EXEC.                                                    09060051
090600                                                                  09070051
090700     EVALUATE TRUE                                                09080051
090800         WHEN SQLCODE = +0                                        09090051
090900             MOVE VNDDPT-INHOUSE-NBR TO STREXT-VEND-INHSE-NBR     09100051
091000             PERFORM 3300-TENTNME-INFO                            09110051
091100         WHEN SQLCODE = +100                                      09120051
091200             SET PS-ERROR TO TRUE                                 09130051
091300              MOVE '3200-GET-VENDOR-INFO'                         09140051
091400                           TO PV-ERROR-PARA                       09150051
091500         WHEN OTHER                                               09160051
091600              MOVE '3200-GET-VENDOR-INFO'                         09170051
091700                           TO PV-ABEND-PARAGRAPH                  09180051
091800              MOVE 'SELECT TPURCHS CURSOR'                        09190051
091900                           TO PV-ABEND-OPERATION                  09200051
092000              MOVE 'TVNDDPT'   TO PV-ABEND-STRUCTURE-1            09210051
092100              MOVE PV-DEPT     TO PV-ABEND-STRUCTURE-2            09220051
092200              PERFORM 9900-DB2-ABEND                              09230051
092300     END-EVALUATE.                                                09240051
092400/                                                                 09250051
092500 3300-TENTNME-INFO.                                               09260051
092600                                                                  09270051
092700     EXEC SQL                                                     09280051
092800          SELECT ENT_NAME_DESC                                    09290051
092900          INTO :ENTNME-ENT-NAME-DESC                              09300051
093000          FROM TENTNME                                            09310051
093100          WHERE  ENT_ID        = :PV-PURCHS-ENT-ID                09320051
093200            AND TYPE_CDE       = '01'                             09330051
093300     END-EXEC.                                                    09340051
093400                                                                  09350051
093500     EVALUATE TRUE                                                09360051
093600         WHEN SQLCODE = +0                                        09370051
093700             MOVE ENTNME-ENT-NAME-DESC  TO STREXT-VEND-INHSE-NAME 09380051
093800                                           STREXT-VEND-DUNS-DESC  09390051
093900             PERFORM 3400-TEXTENT-INFO                            09400051
094000         WHEN SQLCODE = +100                                      09410051
094100             SET PS-ERROR TO TRUE                                 09420051
094200              MOVE '3300-TENTNME-INFO'                            09430051
094300                           TO PV-ERROR-PARA                       09440051
094400         WHEN OTHER                                               09450051
094500              MOVE '3300-TENTNME-INFO'                            09460051
094600                           TO PV-ABEND-PARAGRAPH                  09470051
094700              MOVE 'SELECT TPURCHS CURSOR'                        09480051
094800                           TO PV-ABEND-OPERATION                  09490051
094900              MOVE 'TENTNME'   TO PV-ABEND-STRUCTURE-1            09500051
095000              MOVE PV-DEPT     TO PV-ABEND-STRUCTURE-2            09510051
095100              PERFORM 9900-DB2-ABEND                              09520051
095200     END-EVALUATE.                                                09530051
095300/                                                                 09540051
095400 3400-TEXTENT-INFO.                                               09550051
095500                                                                  09560051
095600     EXEC SQL                                                     09570051
095700          SELECT DUN_NBR                                          09580051
095800          INTO :EXTENT-DUN-NBR                                    09590051
095900          FROM TEXTENT                                            09600051
096000          WHERE  ENT_ID        = :PV-PURCHS-ENT-ID                09610051
096100     END-EXEC.                                                    09620051
096200                                                                  09630051
096300     EVALUATE TRUE                                                09640051
096400         WHEN SQLCODE = +0                                        09650051
096500             MOVE EXTENT-DUN-NBR    TO STREXT-VEND-DUNS-NBR       09660051
096600         WHEN SQLCODE = +100                                      09670051
096700             SET PS-ERROR TO TRUE                                 09680051
096800              MOVE '3400-TEXTENT-INFO'                            09690051
096900                           TO PV-ERROR-PARA                       09700051
097000         WHEN OTHER                                               09710051
097100              MOVE '3400-TEXTENT-INFO'                            09720051
097200                           TO PV-ABEND-PARAGRAPH                  09730051
097300              MOVE 'SELECT TPURCHS CURSOR'                        09740051
097400                           TO PV-ABEND-OPERATION                  09750051
097500              MOVE 'TEXTENT'   TO PV-ABEND-STRUCTURE-1            09760051
097600              MOVE PV-DEPT     TO PV-ABEND-STRUCTURE-2            09770051
097700              PERFORM 9900-DB2-ABEND                              09780051
097800     END-EVALUATE.                                                09790051
097900/                                                                 09800051
098000 3500-PROCESS-PAYT-TERMS.                                         09810051
098100                                                                  09820051
098200     PERFORM WITH TEST AFTER                                      09830051
098300             VARYING PV-RETRY-COUNT    FROM 1 BY 1                09840051
098400             UNTIL   PV-RETRY-COUNT > PC-MAX-RETRIES OR           09850051
098500                     SQLCODE = ZERO OR                            09860051
098600                     SQLCODE = +100                               09870051
098700                                                                  09880051
098800     EXEC SQL                                                     09890051
098900          SELECT PAYT_TERM_ID                                     09900051
099000            INTO :POAGMT-PAYT-TERM-ID                             09910051
099100            FROM TPOAGMT                                          09920051
099200           WHERE PO_NBR         = :PV-ORD-NBR                     09930051
099300             AND AGRMT_TYP_ID   = '2'                             09940051
099400             AND VER_STATUS_CDE = 'A'                             09950051
099500     END-EXEC                                                     09960051
099600                                                                  09970051
099700     EVALUATE TRUE                                                09980051
099800         WHEN SQLCODE = +0                                        09990051
099900              PERFORM 3600-PROCESS-PAYT-TERMS                     10000051
100000         WHEN SQLCODE = +100                                      10010051
100100             SET PS-ERROR TO TRUE                                 10020051
100200              MOVE '3500-PROCESS-PAYT-TERMS'                      10030051
100300                           TO PV-ERROR-PARA                       10040051
100400         WHEN OTHER                                               10050051
100500              MOVE '3500-PROCESS-PAYT-TERMS'                      10060051
100600                           TO PV-ABEND-PARAGRAPH                  10070051
100700              MOVE 'SELECT TPOAGMT'                               10080051
100800                           TO PV-ABEND-OPERATION                  10090051
100900              MOVE 'TPOAGMT'   TO PV-ABEND-STRUCTURE-1            10100051
101000              MOVE 'CURRENT PO BEING PROCESSED ID:         '      10110051
101100                               TO PV-DB2-OPERATION-MESSAGE-1      10120051
101200              MOVE PV-ORD-NBR                                     10130051
101300                               TO PV-DB2-OPERATION-MESSAGE-2      10140051
101400              PERFORM 9900-DB2-ABEND                              10150051
101500     END-EVALUATE                                                 10160051
101600     END-PERFORM.                                                 10170051
101700                                                                  10180051
101800                                                                  10190051
101900     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          10200051
102000         MOVE '3500-PROCESS-PAYT-TERMS'                           10210051
102100                                 TO PV-ABEND-PARAGRAPH            10220051
102200         MOVE 'MAX RETRIES EXCEEDED'                              10230051
102300                                 TO PV-ABEND-OPERATION            10240051
102400         PERFORM 9900-DB2-ABEND                                   10250051
102500     END-IF.                                                      10260051
102600                                                                  10270051
102700/                                                                 10280051
102800 3600-PROCESS-PAYT-TERMS.                                         10290051
102900                                                                  10300051
103000     PERFORM WITH TEST AFTER                                      10310051
103100             VARYING PV-RETRY-COUNT    FROM 1 BY 1                10320051
103200             UNTIL   PV-RETRY-COUNT > PC-MAX-RETRIES OR           10330051
103300                     SQLCODE = ZERO                               10340051
103400                                                                  10350051
103500     EXEC SQL                                                     10360051
103600           SELECT PAY_TERM_ID                                     10370051
103700                 ,DISCOUNT_DAYS_QTY                               10380051
103800                 ,DISCOUNT_PCT                                    10390051
103900                 ,DUE_DAY_QTY                                     10400051
104000                 ,OTHER_TXT                                       10410051
104100                 ,DUE_DAY_FR_DTE_TXT                              10420051
104200            INTO :PAYTRM-PAY-TERM-ID                              10430051
104300                ,:PAYTRM-DISCOUNT-DAYS-QTY                        10440051
104400                ,:PAYTRM-DISCOUNT-PCT                             10450051
104500                ,:PAYTRM-DUE-DAY-QTY                              10460051
104600                ,:PAYTRM-OTHER-TXT                                10470051
104700                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       10480051
104800            FROM TPAYTRM                                          10490051
104900           WHERE PAY_TERM_ID = :POAGMT-PAYT-TERM-ID               10500051
105000     END-EXEC                                                     10510051
105100                                                                  10520051
105200     EVALUATE TRUE                                                10530051
105300         WHEN SQLCODE = ZERO                                      10540051
105400         WHEN SQLCODE = -904                                      10550051
105500         WHEN SQLCODE = -913                                      10560051
105600              CONTINUE                                            10570051
105700         WHEN SQLCODE = +100                                      10580051
105800             SET PS-ERROR TO TRUE                                 10590051
105900              MOVE '3600-PROCESS-PAYT-TERMS'                      10600051
106000                           TO PV-ERROR-PARA                       10610051
106100         WHEN OTHER                                               10620051
106200              MOVE '3600-PROCESS-PAYT-TERMS'                      10630051
106300                           TO PV-ABEND-PARAGRAPH                  10640051
106400              MOVE 'SELECT TPOAGMT'                               10650051
106500                           TO PV-ABEND-OPERATION                  10660051
106600              MOVE 'TPOAGMT'   TO PV-ABEND-STRUCTURE-1            10670051
106700              MOVE POAGMT-PAYT-TERM-ID                            10680051
106800                               TO PV-ABEND-STRUCTURE-2            10690051
106900              PERFORM 9900-DB2-ABEND                              10700051
107000     END-EVALUATE                                                 10710051
107100     END-PERFORM.                                                 10720051
107200                                                                  10730051
107300                                                                  10740051
107400     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          10750051
107500         MOVE '3600-PROCESS-PAYT-TERMS'                           10760051
107600                                 TO PV-ABEND-PARAGRAPH            10770051
107700         MOVE 'MAX RETRIES EXCEEDED'                              10780051
107800                                 TO PV-ABEND-OPERATION            10790051
107900         PERFORM 9900-DB2-ABEND                                   10800051
108000     END-IF.                                                      10810051
108100                                                                  10820051
108200                                                                  10830051
108300     IF PS-ERROR                                                  10840051
108400        CONTINUE                                                  10850051
108500     ELSE                                                         10860051
108600         MOVE 'S'                    TO STREXT-DISC-TERMS-CDE     10870051
108700         MOVE 'N'                    TO STREXT-EOM-IND            10880051
108800         MOVE '000'                  TO STREXT-DATING-EXTN-CD     10890051
108900                                                                  10900051
109000         IF PAYTRM-PAY-TERM-ID = 1 OR 2 OR 3 OR 4 OR 5 OR 63      10910051
109100             MOVE 'NET '             TO STREXT-CASH-DISC-CDE      10920051
109200             MOVE PAYTRM-DUE-DAY-QTY TO STREXT-DISC-DAYS-CNT      10930051
109300         END-IF                                                   10940051
109400         PERFORM 3700-TPLNSHP                                     10950051
109500         IF  SQLCODE = +0                                         10960051
109600             MOVE PLNSHP-FRGT-PAYT-CDE TO STREXT-FRGT-PAYT-CDE    10970051
109700         END-IF                                                   10980051
109800     END-IF.                                                      10990051
109900                                                                  11000051
110000*                                                                 11010051
110100/                                                                 11020051
110200 3700-TPLNSHP.                                                    11030051
110300     PERFORM WITH TEST AFTER                                      11040051
110400             VARYING PV-RETRY-COUNT    FROM 1 BY 1                11050051
110500             UNTIL   PV-RETRY-COUNT > PC-MAX-RETRIES OR           11060051
110600                     SQLCODE = ZERO                               11070051
110700                                                                  11080051
110800     EXEC SQL                                                     11090051
110900           SELECT FRGT_PAYT_CDE                                   11100051
111000            INTO :PLNSHP-FRGT-PAYT-CDE                            11110051
111100            FROM TPLNSHP                                          11120051
111200           WHERE PO_NBR         = :PV-ORD-NBR                     11130051
111300             AND VER_STATUS_CDE = 'A'                             11140051
111400     END-EXEC                                                     11150051
111500     EVALUATE TRUE                                                11160051
111600         WHEN SQLCODE = ZERO                                      11170051
111700         WHEN SQLCODE = -904                                      11180051
111800         WHEN SQLCODE = -913                                      11190051
111900              CONTINUE                                            11200051
112000         WHEN SQLCODE = +100                                      11210051
112100             SET PS-ERROR TO TRUE                                 11220051
112200              MOVE '3700-TPLNSHP'                                 11230051
112300                           TO PV-ERROR-PARA                       11240051
112400         WHEN OTHER                                               11250051
112500              DISPLAY 'ORDER NUMBER IS ' PV-ORD-NBR               11260051
112600              MOVE '3700-TPLNSHP'                                 11270051
112700                           TO PV-ABEND-PARAGRAPH                  11280051
112800              MOVE 'SELECT TPLNSHP'                               11290051
112900                           TO PV-ABEND-OPERATION                  11300051
113000              MOVE 'TPLNSHP'   TO PV-ABEND-STRUCTURE-1            11310051
113100              MOVE 'CURRENT PO BEING PROCESSED ID:         '      11320051
113200                               TO PV-DB2-OPERATION-MESSAGE-1      11330051
113300              MOVE PV-ORD-NBR                                     11340051
113400                               TO PV-DB2-OPERATION-MESSAGE-2      11350051
113500              PERFORM 9900-DB2-ABEND                              11360051
113600     END-EVALUATE                                                 11370051
113700     END-PERFORM.                                                 11380051
113800                                                                  11390051
113900     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          11400051
114000         MOVE '3700-TPLNSHP'                                      11410051
114100                                 TO PV-ABEND-PARAGRAPH            11420051
114200         MOVE 'MAX RETRIES EXCEEDED'                              11430051
114300                                 TO PV-ABEND-OPERATION            11440051
114400         PERFORM 9900-DB2-ABEND                                   11450051
114500     END-IF.                                                      11460051
114600                                                                  11470051
114700                                                                  11480051
114800 4000-TRECITM-LOOP.                                               11490051
114900     MOVE 'N' TO PV-EOF-TRECITM-SW.                               11500051
115000     PERFORM 4100-OPEN-TRECITM-CURSOR.                            11510051
115100     PERFORM 4200-FETCH-TRECITM-CSR.                              11520051
115200     PERFORM                                                      11530051
115300         WITH TEST AFTER                                          11540051
115400         VARYING PV-RETRY-COUNT                                   11550051
115500         FROM 1 BY 1                                              11560051
115600         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 11570051
115700             OR (PV-EOF-TRECITM)                                  11580051
115800             OR (PS-ERROR))                                       11590051
115900                                                                  11600051
116000         MOVE RECITM-ORD-LNE-NBR                                  11610051
116100                             TO STREXT-PO-LNE-NBR                 11620051
116200                                PV-LINE                           11630051
116300         MOVE RECITM-PKSL-NBR                                     11640051
116400                             TO STREXT-INVC-NBR                   11650051
116500                                                                  11660051
116600         PERFORM 4400-SELECT-TPURITM                              11670051
116700         IF  PS-ERROR                                             11680051
116800             CONTINUE                                             11690051
116900         ELSE                                                     11700051
117000******    WR # 27201 - START                                      11710051
117100             PERFORM 4900-GET-RETAIL-DATA                         11720051
117200             IF PS-ERROR                                          11730051
117300                CONTINUE                                          11740051
117400             ELSE                                                 11750051
117500******    WR # 27201 - END                                        11760051
117600                PERFORM 4500-GET-PROCESSING-AREA                  11770051
117700                IF  PS-ERROR                                      11780051
117800                    CONTINUE                                      11790051
117900                ELSE                                              11800051
118000                    PERFORM 5000-STORE-LOOP                       11810051
118100                                                                  11820051
118200                    PERFORM 4200-FETCH-TRECITM-CSR                11830051
118300                END-IF                                            11840051
118400              END-IF                                              11850051
118500         END-IF                                                   11860051
118600     END-PERFORM.                                                 11870051
118700                                                                  11880051
118800     PERFORM 4300-CLOSE-TRECITM-CSR.                              11890051
118900                                                                  11900051
119000 4100-OPEN-TRECITM-CURSOR.                                        11910051
119100                                                                  11920051
119200     PERFORM                                                      11930051
119300         WITH TEST AFTER                                          11940051
119400         VARYING PV-RETRY-COUNT                                   11950051
119500         FROM 1 BY 1                                              11960051
119600         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 11970051
119700            OR  (SQLCODE = +0))                                   11980051
119800                                                                  11990051
119900         EXEC SQL                                                 12000051
120000             OPEN TRECITM-CSR                                     12010051
120100         END-EXEC                                                 12020051
120200                                                                  12030051
120300         EVALUATE TRUE                                            12040051
120400             WHEN SQLCODE = +0                                    12050051
120500             WHEN SQLCODE = -904                                  12060051
120600             WHEN SQLCODE = -913                                  12070051
120700                  CONTINUE                                        12080051
120800             WHEN SQLWARN0 NOT = SPACE                            12090051
120900             WHEN SQLCODE  NOT = +0                               12100051
121000                  MOVE '4100-OPEN-TRECITM-CURSOR'                 12110051
121100                                 TO PV-ABEND-PARAGRAPH            12120051
121200                  MOVE 'OPEN TRECITM CURSOR'                      12130051
121300                                 TO PV-ABEND-OPERATION            12140051
121400                  MOVE 'TRECITM'   TO PV-ABEND-STRUCTURE-1        12150051
121500                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        12160051
121600                  PERFORM 9900-DB2-ABEND                          12170051
121700         END-EVALUATE                                             12180051
121800     END-PERFORM.                                                 12190051
121900                                                                  12200051
122000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          12210051
122100         MOVE '4100-OPEN-TRECITM-CURSOR'                          12220051
122200                                 TO PV-ABEND-PARAGRAPH            12230051
122300         MOVE 'MAX RETRIES EXCEEDED'                              12240051
122400                                 TO PV-ABEND-OPERATION            12250051
122500         PERFORM 9900-DB2-ABEND                                   12260051
122600     END-IF.                                                      12270051
122700                                                                  12280051
122800 4200-FETCH-TRECITM-CSR.                                          12290051
122900                                                                  12300051
123000******    WR # 27201 - ADDED RETAIL FIELDS TO FETCH               12310051
123100                                                                  12320051
123200     EXEC SQL                                                     12330051
123300          FETCH TRECITM-CSR                                       12340051
123400           INTO                                                   12350051
123500                  :RECITM-ORD-LNE-NBR                             12360051
123600                 ,:RECITM-PO-VER-NBR                              12370051
123700                 ,:RECITM-PKSL-NBR                                12380051
123800                 ,:RECITM-UNT-RTL-AMT                             12390051
123900                 ,:RECITM-GP-RTL-AMT                              12400051
124000                 ,:RECITM-GP-QTY                                  12410051
124100     END-EXEC.                                                    12420051
124200                                                                  12430051
124300     EVALUATE TRUE                                                12440051
124400         WHEN SQLCODE = +0                                        12450051
124500              CONTINUE                                            12460051
124600         WHEN SQLCODE = +100                                      12470051
124700              SET PV-EOF-TRECITM TO TRUE                          12480051
124800         WHEN SQLCODE = -811                                      12490051
124900              SET PS-ERROR       TO TRUE                          12500051
125000              MOVE '4200-FETCH-TRECITM-CSR'                       12510051
125100                                   TO PV-ERROR-PARA               12520051
125200         WHEN SQLWARN0 NOT = SPACE                                12530051
125300         WHEN SQLCODE  NOT = +0                                   12540051
125400              MOVE '4200-FETCH-TRECITM-CSR'                       12550051
125500                                   TO PV-ABEND-PARAGRAPH          12560051
125600              MOVE 'FETCH TRECITM CURSOR'                         12570051
125700                                   TO PV-ABEND-OPERATION          12580051
125800              MOVE 'TRECITM'       TO PV-ABEND-STRUCTURE-1        12590051
125900              MOVE 'CURRENT PO BEING PROCESSED ID:         '      12600051
126000                               TO PV-DB2-OPERATION-MESSAGE-1      12610051
126100              MOVE PV-ORD-NBR                                     12620051
126200                               TO PV-DB2-OPERATION-MESSAGE-2      12630051
126300              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        12640051
126400              PERFORM 9900-DB2-ABEND                              12650051
126500     END-EVALUATE.                                                12660051
126600 4300-CLOSE-TRECITM-CSR.                                          12670051
126700                                                                  12680051
126800     PERFORM                                                      12690051
126900         WITH TEST AFTER                                          12700051
127000         VARYING PV-RETRY-COUNT                                   12710051
127100         FROM 1 BY 1                                              12720051
127200         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 12730051
127300            OR  (SQLCODE = +0))                                   12740051
127400                                                                  12750051
127500            EXEC SQL                                              12760051
127600                CLOSE TRECITM-CSR                                 12770051
127700            END-EXEC                                              12780051
127800                                                                  12790051
127900            EVALUATE TRUE                                         12800051
128000                WHEN SQLCODE = 0                                  12810051
128100                    CONTINUE                                      12820051
128200                WHEN SQLCODE = -911                               12830051
128300                WHEN SQLCODE = -904                               12840051
128400                    CONTINUE                                      12850051
128500                WHEN SQLCODE  NOT = +0                            12860051
128600                     MOVE '4300-CLOSE-TRECITM-CSR'                12870051
128700                                  TO PV-ABEND-PARAGRAPH           12880051
128800                     MOVE 'CLOSE TRECITM CURSOR'                  12890051
128900                                  TO PV-ABEND-OPERATION           12900051
129000                     MOVE 'TRECITM'   TO PV-ABEND-STRUCTURE-1     12910051
129100                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     12920051
129200                     PERFORM 9900-DB2-ABEND                       12930051
129300            END-EVALUATE                                          12940051
129400                                                                  12950051
129500     END-PERFORM.                                                 12960051
129600                                                                  12970051
129700     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          12980051
129800         MOVE '4300-CLOSE-TRECITM-CSR'                            12990051
129900                                 TO PV-ABEND-PARAGRAPH            13000051
130000         MOVE 'MAX RETRIES EXCEEDED'                              13010051
130100                                 TO PV-ABEND-OPERATION            13020051
130200         PERFORM 9900-DB2-ABEND                                   13030051
130300     END-IF.                                                      13040051
130400                                                                  13050051
130500 4400-SELECT-TPURITM.                                             13060051
130600     PERFORM                                                      13070051
130700         WITH TEST AFTER                                          13080051
130800         VARYING PV-RETRY-COUNT                                   13090051
130900         FROM 1 BY 1                                              13100051
131000         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 13110051
131100             OR (SQLCODE = +0)                                    13120051
131200             OR (SQLCODE = +100))                                 13130051
131300                                                                  13140051
131400******    WR # 27201 - REMOVED RETAIL FIELDS FROM SELECT          13150051
131500**                                                                13160051
131600         EXEC SQL                                                 13170051
131700              SELECT CL_NBR                                       13180051
131800                    ,SKU_SEQ_NBR                                  13190051
131900                    ,UNT_COST_AMT                                 13200051
132000                    ,ITM_NBR                                      13210051
132100              INTO   :PURITM-CL-NBR                               13220051
132200                    ,:PURITM-SKU-SEQ-NBR                          13230051
132300                    ,:PURITM-UNT-COST-AMT                         13240051
132400                    ,:PURITM-ITM-NBR                              13250051
132500                                                                  13260051
132600              FROM  TPURITM                                       13270051
132700              WHERE PO_NBR         = :PV-ORD-NBR                  13280051
132800                AND APP_PO_LNE_NBR = :RECITM-ORD-LNE-NBR          13290051
132900                AND VER_NBR        = :RECITM-PO-VER-NBR           13300051
133000         END-EXEC                                                 13310051
133100                                                                  13320051
133200         EVALUATE TRUE                                            13330051
133300             WHEN SQLCODE = ZERO                                  13340051
133400                 MOVE PURITM-CL-NBR         TO  PV-CLASS1         13350051
133500                 MOVE ZERO                  TO  PV-CLASS3         13360051
133600                 MOVE PV-CLASS-NMBR         TO  STREXT-CLASS-NBR  13370051
133700                 MOVE PURITM-SKU-SEQ-NBR    TO  STREXT-SKU-SEQ-NBR13380051
133800                 IF  (PURITM-SKU-SEQ-NBR = '000' OR '999')        13390051
133900                     MOVE ZEROES      TO STREXT-LOWST-UNIT-RTL-AMT13400051
134000                 END-IF                                           13410051
134100******    WR # 27201 - START                                      13420051
134200*                IF  PURITM-GP-QTY > 1                            13430051
134300*                    COMPUTE  PV-AMT = PURITM-GP-RTL-AMT /        13440051
134400*                    PURITM-GP-QTY                                13450051
134500*                    MOVE PV-AMT      TO STREXT-LOWST-UNIT-RTL-AMT13460051
134600*                ELSE                                             13470051
134700*                    MOVE PURITM-UNT-RTL-PR-AMT TO                13480051
134800*                                        STREXT-LOWST-UNIT-RTL-AMT13490051
134900*                END-IF                                           13500051
135000*                MOVE PURITM-UNT-RTL-PR-AMT TO STREXT-UNIT-RTL-AMT13510051
135100******    WR # 27201 - END                                        13520051
135200                 MOVE PURITM-UNT-COST-AMT   TO PV-UNT-COST-AMT    13530051
135300                 MOVE PURITM-ITM-NBR        TO PV-ITM-NBR         13540051
135400             WHEN SQLCODE = +100                                  13550051
135500                  SET PS-ERROR TO TRUE                            13560051
135600                  MOVE '4400-SELECT-TPURITM'                      13570051
135700                               TO PV-ERROR-PARA                   13580051
135800             WHEN OTHER                                           13590051
135900                  MOVE '4400-SELECT-TPURITM'                      13600051
136000                               TO PV-ABEND-PARAGRAPH              13610051
136100                  MOVE 'SELECT TPURITM'                           13620051
136200                               TO PV-ABEND-OPERATION              13630051
136300                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  13640051
136400                                 TO PV-DB2-OPERATION-MESSAGE-1    13650051
136500                  MOVE PV-ORD-NBR                                 13660051
136600                                   TO PV-DB2-OPERATION-MESSAGE-2  13670051
136700                  MOVE RECITM-ORD-LNE-NBR                         13680051
136800                                   TO PV-DB2-OPERATION-MESSAGE-3  13690051
136900                  MOVE 'TPURITM'   TO PV-ABEND-STRUCTURE-1        13700051
137000                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        13710051
137100                  PERFORM 9900-DB2-ABEND                          13720051
137200         END-EVALUATE                                             13730051
137300     END-PERFORM.                                                 13740051
137400                                                                  13750051
137500     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          13760051
137600         MOVE '4400-SELECT-TPURITM'                               13770051
137700                                 TO PV-ABEND-PARAGRAPH            13780051
137800         MOVE 'MAX RETRIES EXCEEDED'                              13790051
137900                                 TO PV-ABEND-OPERATION            13800051
138000         PERFORM 9900-DB2-ABEND                                   13810051
138100     END-IF.                                                      13820051
138200/                                                                 13830051
138300 4500-GET-PROCESSING-AREA.                                        13840051
138400                                                                  13850051
138500     PERFORM 4550-OPEN-TWKORIN.                                   13860051
138600     PERFORM 4600-FETCH-TWKORIN-LOOP.                             13870051
138700                                                                  13880051
138800                                                                  13890051
138900 4550-OPEN-TWKORIN.                                               13900051
139000     PERFORM                                                      13910051
139100         WITH TEST AFTER                                          13920051
139200         VARYING PV-RETRY-COUNT                                   13930051
139300         FROM 1 BY 1                                              13940051
139400         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 13950051
139500            OR  (SQLCODE = +0))                                   13960051
139600                                                                  13970051
139700         EXEC SQL                                                 13980051
139800             OPEN TWKORIN-CSR                                     13990051
139900         END-EXEC                                                 14000051
140000                                                                  14010051
140100         EVALUATE TRUE                                            14020051
140200             WHEN SQLCODE = +0                                    14030051
140300             WHEN SQLCODE = -904                                  14040051
140400             WHEN SQLCODE = -913                                  14050051
140500                  CONTINUE                                        14060051
140600             WHEN SQLWARN0 NOT = SPACE                            14070051
140700             WHEN SQLCODE  NOT = +0                               14080051
140800                  MOVE '4550-OPEN-TWKORIN'                        14090051
140900                                 TO PV-ABEND-PARAGRAPH            14100051
141000                  MOVE 'OPEN TWKORIN CURSOR'                      14110051
141100                                 TO PV-ABEND-OPERATION            14120051
141200                  MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1        14130051
141300                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        14140051
141400                  PERFORM 9900-DB2-ABEND                          14150051
141500         END-EVALUATE                                             14160051
141600     END-PERFORM.                                                 14170051
141700                                                                  14180051
141800     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          14190051
141900         MOVE '4550-OPEN-TWKORIN'                                 14200051
142000                                 TO PV-ABEND-PARAGRAPH            14210051
142100         MOVE 'MAX RETRIES EXCEEDED'                              14220051
142200                                 TO PV-ABEND-OPERATION            14230051
142300         PERFORM 9900-DB2-ABEND                                   14240051
142400     END-IF.                                                      14250051
142500                                                                  14260051
142600 4575-CLOSE-TWKORIN.                                              14270051
142700     PERFORM                                                      14280051
142800         WITH TEST AFTER                                          14290051
142900         VARYING PV-RETRY-COUNT                                   14300051
143000         FROM 1 BY 1                                              14310051
143100         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 14320051
143200            OR  (SQLCODE = +0))                                   14330051
143300                                                                  14340051
143400            EXEC SQL                                              14350051
143500                CLOSE TWKORIN-CSR                                 14360051
143600            END-EXEC                                              14370051
143700                                                                  14380051
143800            EVALUATE TRUE                                         14390051
143900                WHEN SQLCODE = 0                                  14400051
144000                    CONTINUE                                      14410051
144100                WHEN SQLCODE = -911                               14420051
144200                WHEN SQLCODE = -904                               14430051
144300                    CONTINUE                                      14440051
144400                WHEN SQLCODE  NOT = +0                            14450051
144500                     MOVE '4575-CLOSE-TWKORIN'                    14460051
144600                                  TO PV-ABEND-PARAGRAPH           14470051
144700                     MOVE 'CLOSE TWKORIN CURSOR'                  14480051
144800                                  TO PV-ABEND-OPERATION           14490051
144900                     MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1     14500051
145000                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     14510051
145100                     PERFORM 9900-DB2-ABEND                       14520051
145200            END-EVALUATE                                          14530051
145300                                                                  14540051
145400     END-PERFORM.                                                 14550051
145500                                                                  14560051
145600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          14570051
145700         MOVE '4575-CLOSE-TWKORIN'                                14580051
145800                                 TO PV-ABEND-PARAGRAPH            14590051
145900         MOVE 'MAX RETRIES EXCEEDED'                              14600051
146000                                 TO PV-ABEND-OPERATION            14610051
146100         PERFORM 9900-DB2-ABEND                                   14620051
146200     END-IF.                                                      14630051
146300                                                                  14640051
146400 4600-FETCH-TWKORIN-LOOP.                                         14650051
146500                                                                  14660051
146600     MOVE 'N' TO PS-TWKORIN-CURSOR-SW.                            14670051
146700     MOVE 'N' TO PS-TWKORIN-ZERO-SW.                              14680051
146800     PERFORM 4650-FETCH-TWKORIN.                                  14690051
146900     IF  PS-EOF-TWKORIN-CSR                                       14700051
147000       OR WKORIN-STRT-TMST = PC-DEFAULT-DATE                      14710051
147100         PERFORM 4575-CLOSE-TWKORIN                               14720051
147200         PERFORM 4800-OPEN-WKORIN0-CURSOR                         14730051
147300         PERFORM 4850-FETCH-TWKORIN-ZERO                          14740051
147400         IF  WKORIN-STRT-TMST = PC-DEFAULT-DATE                   14750051
147500             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     14760051
147600                      PV-PRC-FCLTY-AREA-ID                        14770051
147700             MOVE 'N' TO PS-TWKORIN-ZERO-SW                       14780051
147800             PERFORM 4805-CLOSE-WKORIN0                           14790051
147900         ELSE                                                     14800051
148000             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     14810051
148100                      PV-PRC-FCLTY-AREA-ID                        14820051
148200             PERFORM 4850-FETCH-TWKORIN-ZERO                      14830051
148300                 UNTIL PS-EOF-TWKORIN-ZERO                        14840051
148400             PERFORM 4805-CLOSE-WKORIN0                           14850051
148500             MOVE PV-PRC-FCLTY-AREA-ID TO STREXT-PRC-FCLTY-AREA-ID14860051
148600     ELSE                                                         14870051
148700         MOVE WKORIN-PRC-FCLTY-AREA-ID TO PV-PRC-FCLTY-AREA-ID    14880051
148800         PERFORM 4650-FETCH-TWKORIN                               14890051
148900             UNTIL PS-EOF-TWKORIN-CSR                             14900051
149000         MOVE PV-PRC-FCLTY-AREA-ID     TO STREXT-PRC-FCLTY-AREA-ID14910051
149100         PERFORM 4575-CLOSE-TWKORIN                               14920051
149200     END-IF.                                                      14930051
149300 4650-FETCH-TWKORIN.                                              14940051
149400                                                                  14950051
149500     EXEC SQL                                                     14960051
149600          FETCH TWKORIN-CSR                                       14970051
149700             INTO :WKORIN-STRT-TMST                               14980051
149800                 ,:WKORIN-STOP-TMST                               14990051
149900                 ,:WKORIN-PRC-FCLTY-AREA-ID                       15000051
150000                 ,:WKORIN-SCREEN-SEQ-NBR                          15010051
150100     END-EXEC.                                                    15020051
150200                                                                  15030051
150300     EVALUATE TRUE                                                15040051
150400         WHEN SQLCODE = +0                                        15050051
150500              PERFORM 4675-CHECK-DATES                            15060051
150600         WHEN SQLCODE = +100                                      15070051
150700              SET PS-EOF-TWKORIN-CSR TO TRUE                      15080051
150800         WHEN SQLWARN0 NOT = SPACE                                15090051
150900         WHEN SQLCODE  NOT = +0                                   15100051
151000              MOVE '4600-FETCH-TWKORIN'                           15110051
151100                                   TO PV-ABEND-PARAGRAPH          15120051
151200              MOVE 'FETCH TWKORIN CURSOR'                         15130051
151300                                   TO PV-ABEND-OPERATION          15140051
151400              MOVE 'TWKORIN'       TO PV-ABEND-STRUCTURE-1        15150051
151500              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        15160051
151600              MOVE 'CURRENT PO BEING PROCESSED ID:         '      15170051
151700                                   TO PV-DB2-OPERATION-MESSAGE-1  15180051
151800              MOVE PV-ORD-NBR                                     15190051
151900                                   TO PV-DB2-OPERATION-MESSAGE-2  15200051
152000              MOVE PV-LINE                                        15210051
152100                                   TO PV-DB2-OPERATION-MESSAGE-3  15220051
152200              PERFORM 9900-DB2-ABEND                              15230051
152300     END-EVALUATE.                                                15240051
152400                                                                  15250051
152500 4675-CHECK-DATES.                                                15260051
152600     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-DATE               15270051
152700         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-DATE           15280051
152800             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     15290051
152900                        PV-PRC-FCLTY-AREA-ID                      15300051
153000         ELSE                                                     15310051
153100             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     15320051
153200                        PV-PRC-FCLTY-AREA-ID                      15330051
153300             SET PS-EOF-TWKORIN-CSR TO TRUE                       15340051
153400         END-IF                                                   15350051
153500     ELSE                                                         15360051
153600         SET PS-EOF-TWKORIN-CSR TO TRUE                           15370051
153700     END-IF.                                                      15380051
153800/                                                                 15390051
153900 4800-OPEN-WKORIN0-CURSOR.                                        15400051
154000     PERFORM                                                      15410051
154100         WITH TEST AFTER                                          15420051
154200         VARYING PV-RETRY-COUNT                                   15430051
154300         FROM 1 BY 1                                              15440051
154400         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 15450051
154500            OR  (SQLCODE = +0))                                   15460051
154600                                                                  15470051
154700         EXEC SQL                                                 15480051
154800             OPEN WKORIN0-CSR                                     15490051
154900         END-EXEC                                                 15500051
155000                                                                  15510051
155100         EVALUATE TRUE                                            15520051
155200             WHEN SQLCODE = +0                                    15530051
155300             WHEN SQLCODE = -904                                  15540051
155400             WHEN SQLCODE = -913                                  15550051
155500                  CONTINUE                                        15560051
155600             WHEN SQLWARN0 NOT = SPACE                            15570051
155700             WHEN SQLCODE  NOT = +0                               15580051
155800                  MOVE '4800-OPEN-WKORIN0'                        15590051
155900                                 TO PV-ABEND-PARAGRAPH            15600051
156000                  MOVE 'OPEN WKORIN0 CURSOR'                      15610051
156100                                 TO PV-ABEND-OPERATION            15620051
156200                  MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1        15630051
156300                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        15640051
156400                  PERFORM 9900-DB2-ABEND                          15650051
156500         END-EVALUATE                                             15660051
156600     END-PERFORM.                                                 15670051
156700                                                                  15680051
156800     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15690051
156900         MOVE '4800-OPEN-WKORIN0'                                 15700051
157000                                 TO PV-ABEND-PARAGRAPH            15710051
157100         MOVE 'MAX RETRIES EXCEEDED'                              15720051
157200                                 TO PV-ABEND-OPERATION            15730051
157300         PERFORM 9900-DB2-ABEND                                   15740051
157400     END-IF.                                                      15750051
157500                                                                  15760051
157600 4805-CLOSE-WKORIN0.                                              15770051
157700     PERFORM                                                      15780051
157800         WITH TEST AFTER                                          15790051
157900         VARYING PV-RETRY-COUNT                                   15800051
158000         FROM 1 BY 1                                              15810051
158100         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 15820051
158200            OR  (SQLCODE = +0))                                   15830051
158300                                                                  15840051
158400            EXEC SQL                                              15850051
158500                CLOSE WKORIN0-CSR                                 15860051
158600            END-EXEC                                              15870051
158700                                                                  15880051
158800            EVALUATE TRUE                                         15890051
158900                WHEN SQLCODE = 0                                  15900051
159000                    CONTINUE                                      15910051
159100                WHEN SQLCODE = -911                               15920051
159200                WHEN SQLCODE = -904                               15930051
159300                    CONTINUE                                      15940051
159400                WHEN SQLCODE  NOT = +0                            15950051
159500                     MOVE '4805-CLOSE-WKORIN0'                    15960051
159600                                  TO PV-ABEND-PARAGRAPH           15970051
159700                     MOVE 'CLOSE WKORIN0 CURSOR'                  15980051
159800                                  TO PV-ABEND-OPERATION           15990051
159900                     MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1     16000051
160000                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     16010051
160100                     PERFORM 9900-DB2-ABEND                       16020051
160200            END-EVALUATE                                          16030051
160300                                                                  16040051
160400     END-PERFORM.                                                 16050051
160500                                                                  16060051
160600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          16070051
160700         MOVE '4805-CLOSE-WKORIN0'                                16080051
160800                                 TO PV-ABEND-PARAGRAPH            16090051
160900         MOVE 'MAX RETRIES EXCEEDED'                              16100051
161000                                 TO PV-ABEND-OPERATION            16110051
161100         PERFORM 9900-DB2-ABEND                                   16120051
161200     END-IF.                                                      16130051
161300                                                                  16140051
161400 4850-FETCH-TWKORIN-ZERO.                                         16150051
161500     EXEC SQL                                                     16160051
161600          FETCH WKORIN0-CSR                                       16170051
161700             INTO :WKORIN-STRT-TMST                               16180051
161800                 ,:WKORIN-STOP-TMST                               16190051
161900                 ,:WKORIN-PRC-FCLTY-AREA-ID                       16200051
162000                 ,:WKORIN-SCREEN-SEQ-NBR                          16210051
162100     END-EXEC.                                                    16220051
162200                                                                  16230051
162300     EVALUATE TRUE                                                16240051
162400         WHEN SQLCODE = +0                                        16250051
162500              PERFORM 4860-CHECK-DATES                            16260051
162600         WHEN SQLCODE = +100                                      16270051
162700              SET PS-EOF-TWKORIN-ZERO TO TRUE                     16280051
162800         WHEN SQLWARN0 NOT = SPACE                                16290051
162900         WHEN SQLCODE  NOT = +0                                   16300051
163000              MOVE '4850-FETCH-TWKORIN-ZERO'                      16310051
163100                                   TO PV-ABEND-PARAGRAPH          16320051
163200              MOVE 'FETCH TWKORIN CURSOR'                         16330051
163300                                   TO PV-ABEND-OPERATION          16340051
163400              MOVE 'TWKORIN'       TO PV-ABEND-STRUCTURE-1        16350051
163500              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        16360051
163600              MOVE 'CURRENT PO BEING PROCESSED ID:         '      16370051
163700                                   TO PV-DB2-OPERATION-MESSAGE-1  16380051
163800              MOVE PV-ORD-NBR                                     16390051
163900                                   TO PV-DB2-OPERATION-MESSAGE-2  16400051
164000              MOVE PV-LINE                                        16410051
164100                                   TO PV-DB2-OPERATION-MESSAGE-3  16420051
164200              PERFORM 9900-DB2-ABEND                              16430051
164300     END-EVALUATE.                                                16440051
164400                                                                  16450051
164500 4860-CHECK-DATES.                                                16460051
164600     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-DATE               16470051
164700         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-DATE           16480051
164800             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     16490051
164900                        PV-PRC-FCLTY-AREA-ID                      16500051
165000         ELSE                                                     16510051
165100             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     16520051
165200                        PV-PRC-FCLTY-AREA-ID                      16530051
165300             SET PS-EOF-TWKORIN-CSR TO TRUE                       16540051
165400         END-IF                                                   16550051
165500     ELSE                                                         16560051
165600         MOVE WKORIN-PRC-FCLTY-AREA-ID TO                         16570051
165700                    PV-PRC-FCLTY-AREA-ID                          16580051
165800         SET PS-EOF-TWKORIN-CSR TO TRUE                           16590051
165900     END-IF.                                                      16600051
166000*                                                                 16610051
166100******    WR # 27201 - START                                      16620051
166200 4900-GET-RETAIL-DATA.                                            16630051
166300     PERFORM                                                      16640051
166400         WITH TEST AFTER                                          16650051
166500         VARYING PV-RETRY-COUNT                                   16660051
166600         FROM 1 BY 1                                              16670051
166700         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 16680051
166800             OR (SQLCODE = +0)                                    16690051
166900             OR (SQLCODE = +100))                                 16700051
167000                                                                  16710051
167100**                                                                16720051
167200         EXEC SQL                                                 16730051
167300              SELECT UNT_AMT                                      16740051
167400                    ,GP_AMT                                       16750051
167500                    ,GP_QTY                                       16760051
167600              INTO   :RCT00019-UNT-AMT                            16770051
167700                    ,:RCT00019-GP-AMT                             16780051
167800                    ,:RCT00019-GP-QTY                             16790051
167900                                                                  16800051
168000              FROM  RCT_PRC_RCPT                                  16810051
168100              WHERE ORD_NBR          = :PV-ORD-NBR                16820051
168200                AND ORD_LNE_NBR      = :RECITM-ORD-LNE-NBR        16830051
168300                AND REC_SEQ_NBR      = :RECEIV-REC-SEQ-NBR        16840051
168400                AND OPER_UNT_ID      = :RECEIV-OPER-UNT-ID        16850051
168500                AND FCLTY_ID         = :RECEIV-FCLTY-ID           16860051
168600                AND PRC_RCPT_TYP_CDE = 'VE'                       16870051
168700                AND AMT_TYP_CDE      = 'R'                        16880051
168800         END-EXEC                                                 16890051
168900                                                                  16900051
169000         EVALUATE TRUE                                            16910051
169100             WHEN SQLCODE = ZERO                                  16920051
169200                  IF  RCT00019-GP-QTY > 1                         16930051
169300                      COMPUTE  PV-AMT = RCT00019-GP-AMT /         16940051
169400                      RCT00019-GP-QTY                             16950051
169500                      MOVE PV-AMT     TO STREXT-LOWST-UNIT-RTL-AMT16960051
169600                  ELSE                                            16970051
169700                      MOVE RCT00019-UNT-AMT                       16980051
169800                                      TO STREXT-LOWST-UNIT-RTL-AMT16990051
169900                  END-IF                                          17000051
170000                  MOVE RCT00019-UNT-AMT     TO STREXT-UNIT-RTL-AMT17010051
170100             WHEN SQLCODE = +100                                  17020051
170200                  IF  RECITM-GP-QTY > 1                           17030051
170300                      COMPUTE  PV-AMT = RECITM-GP-RTL-AMT /       17040051
170400                      RECITM-GP-QTY                               17050051
170500                      MOVE PV-AMT     TO STREXT-LOWST-UNIT-RTL-AMT17060051
170600                  ELSE                                            17070051
170700                      MOVE RECITM-UNT-RTL-AMT                     17080051
170800                                      TO STREXT-LOWST-UNIT-RTL-AMT17090051
170900                  END-IF                                          17100051
171000                  MOVE RECITM-UNT-RTL-AMT   TO STREXT-UNIT-RTL-AMT17110051
171100             WHEN OTHER                                           17120051
171200                  MOVE '4900-GET-RETAIL-DATA'                     17130051
171300                               TO PV-ABEND-PARAGRAPH              17140051
171400                  MOVE 'SELECT RCT_PRC_RCPT'                      17150051
171500                               TO PV-ABEND-OPERATION              17160051
171600                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  17170051
171700                                 TO PV-DB2-OPERATION-MESSAGE-1    17180051
171800                  MOVE PV-ORD-NBR                                 17190051
171900                                   TO PV-DB2-OPERATION-MESSAGE-2  17200051
172000                  MOVE RECITM-ORD-LNE-NBR                         17210051
172100                                   TO PV-DB2-OPERATION-MESSAGE-3  17220051
172200                  MOVE 'RCT_PRC_RCPT' TO PV-ABEND-STRUCTURE-1     17230051
172300                  MOVE SPACES         TO PV-ABEND-STRUCTURE-2     17240051
172400                  PERFORM 9900-DB2-ABEND                          17250051
172500         END-EVALUATE                                             17260051
172600     END-PERFORM.                                                 17270051
172700                                                                  17280051
172800     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      17290051
172900         SQLCODE NOT = +0  AND SQLCODE NOT = +100                 17300051
173000         MOVE '4900-GET-RETAIL-DATA'                              17310051
173100                                 TO PV-ABEND-PARAGRAPH            17320051
173200         MOVE 'MAX RETRIES EXCEEDED'                              17330051
173300                                 TO PV-ABEND-OPERATION            17340051
173400         PERFORM 9900-DB2-ABEND                                   17350051
173500     END-IF.                                                      17360051
173600/                                                                 17370051
173700******    WR # 27201 - END                                        17380051
173800 5000-STORE-LOOP.                                                 17390051
173900                                                                  17400051
174000     PERFORM 5100-OPEN-TRECDIS-CSR                                17410051
174100     PERFORM 5110-FETCH-TRECDIS-CSR                               17420051
174200     PERFORM  UNTIL PS-EOF-TRECDIS-CSR OR PS-ERROR                17430051
174300         PERFORM 5200-INSERT                                      17440051
174400         PERFORM 5110-FETCH-TRECDIS-CSR                           17450051
174500     END-PERFORM.                                                 17460051
174600     PERFORM 5120-CLOSE-TRECDIS-CSR.                              17470051
174700                                                                  17480051
174800 5100-OPEN-TRECDIS-CSR.                                           17490051
174900                                                                  17500051
175000     SET PS-START-TRECDIS-CSR TO TRUE                             17510051
175100     PERFORM                                                      17520051
175200         WITH TEST AFTER                                          17530051
175300         VARYING PV-RETRY-COUNT                                   17540051
175400         FROM 1 BY 1                                              17550051
175500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 17560051
175600             OR (SQLCODE = ZERO))                                 17570051
175700                                                                  17580051
175800         EXEC SQL                                                 17590051
175900              OPEN  TRECDIS-CSR                                   17600051
176000         END-EXEC                                                 17610051
176100                                                                  17620051
176200         EVALUATE TRUE                                            17630051
176300             WHEN SQLCODE = ZERO                                  17640051
176400                 CONTINUE                                         17650051
176500             WHEN OTHER                                           17660051
176600                  MOVE '5100-OPEN-TRECDIS-CSR'                    17670051
176700                               TO PV-ABEND-PARAGRAPH              17680051
176800                  MOVE 'OPEN TRECDIS CURSOR'                      17690051
176900                               TO PV-ABEND-OPERATION              17700051
177000                  MOVE 'TRECDIS'   TO PV-ABEND-STRUCTURE-1        17710051
177100                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  17720051
177200                                 TO PV-DB2-OPERATION-MESSAGE-1    17730051
177300                  MOVE PV-ORD-NBR                                 17740051
177400                                   TO PV-DB2-OPERATION-MESSAGE-2  17750051
177500                  MOVE RECITM-ORD-LNE-NBR                         17760051
177600                                   TO PV-DB2-OPERATION-MESSAGE-3  17770051
177700                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        17780051
177800                  PERFORM 9900-DB2-ABEND                          17790051
177900         END-EVALUATE                                             17800051
178000     END-PERFORM.                                                 17810051
178100                                                                  17820051
178200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND SQLCODE < ZERO       17830051
178300         MOVE '5100-OPEN-TRECDIS-CSR'                             17840051
178400                                 TO PV-ABEND-PARAGRAPH            17850051
178500         MOVE 'MAX RETRIES EXCEEDED'                              17860051
178600                                 TO PV-ABEND-OPERATION            17870051
178700         PERFORM 9900-DB2-ABEND                                   17880051
178800     END-IF.                                                      17890051
178900                                                                  17900051
179000 5110-FETCH-TRECDIS-CSR.                                          17910051
179100     PERFORM                                                      17920051
179200         WITH TEST AFTER                                          17930051
179300         VARYING PV-RETRY-COUNT                                   17940051
179400         FROM 1 BY 1                                              17950051
179500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 17960051
179600             OR (SQLCODE = ZERO)                                  17970051
179700             OR (SQLCODE = +100))                                 17980051
179800                                                                  17990051
179900         EXEC SQL                                                 18000051
180000              FETCH  TRECDIS-CSR                                  18010051
180100              INTO  :RECDIS-STR-NBR                               18020051
180200                  , :RECDIS-EXPTED-ITM-QTY                        18030051
180300                  , :RECDIS-PLAN-ITM-QTY                          18040051
180400                  , :RECDIS-AP-VERIFY-ITM-QTY                     18050051
180500         END-EXEC                                                 18060051
180600                                                                  18070051
180700         EVALUATE TRUE                                            18080051
180800             WHEN SQLCODE = ZERO                                  18090051
180900                  MOVE RECDIS-STR-NBR TO STREXT-STR-NBR           18100051
181000                  MOVE RECDIS-EXPTED-ITM-QTY TO                   18110051
181100                                         STREXT-RTL-UNIT-RCVD-QTY 18120051
181200                                         STREXT-INVC-RTL-QTY      18130051
181300                  MOVE RECDIS-PLAN-ITM-QTY   TO                   18140051
181400                                         STREXT-RTL-UNIT-ORD-QTY  18150051
181500                  MOVE RECDIS-AP-VERIFY-ITM-QTY TO                18160051
181600                                         STREXT-RTL-UNIT-MK-QTY   18170051
181700                  COMPUTE STREXT-RTL-EXTN-AMT =                   18180051
181800                          STREXT-LOWST-UNIT-RTL-AMT *             18190051
181900                          STREXT-RTL-UNIT-MK-QTY                  18200051
182000                  COMPUTE STREXT-COST-EXTN-AMT  =                 18210051
182100                          PV-UNT-COST-AMT * STREXT-RTL-UNIT-MK-QTY18220051
182200                                                                  18230051
182300             WHEN SQLCODE = +100                                  18240051
182400                 SET PS-EOF-TRECDIS-CSR TO TRUE                   18250051
182500             WHEN OTHER                                           18260051
182600                  MOVE '5110-FETCH-TRECDIS-CSR'                   18270051
182700                               TO PV-ABEND-PARAGRAPH              18280051
182800                  MOVE 'SELECT TRECDIS'                           18290051
182900                               TO PV-ABEND-OPERATION              18300051
183000                  MOVE 'TRECDIS'   TO PV-ABEND-STRUCTURE-1        18310051
183100                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  18320051
183200                                 TO PV-DB2-OPERATION-MESSAGE-1    18330051
183300                  MOVE PV-ORD-NBR                                 18340051
183400                                   TO PV-DB2-OPERATION-MESSAGE-2  18350051
183500                  MOVE RECITM-ORD-LNE-NBR                         18360051
183600                                   TO PV-DB2-OPERATION-MESSAGE-3  18370051
183700                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        18380051
183800                  PERFORM 9900-DB2-ABEND                          18390051
183900         END-EVALUATE                                             18400051
184000     END-PERFORM.                                                 18410051
184100                                                                  18420051
184200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND SQLCODE < ZERO       18430051
184300         MOVE '5110-FETCH-TRECDIS'                                18440051
184400                                 TO PV-ABEND-PARAGRAPH            18450051
184500         MOVE 'MAX RETRIES EXCEEDED'                              18460051
184600                                 TO PV-ABEND-OPERATION            18470051
184700         PERFORM 9900-DB2-ABEND                                   18480051
184800     END-IF.                                                      18490051
184900                                                                  18500051
185000 5120-CLOSE-TRECDIS-CSR.                                          18510051
185100                                                                  18520051
185200     PERFORM                                                      18530051
185300         WITH TEST AFTER                                          18540051
185400         VARYING PV-RETRY-COUNT                                   18550051
185500         FROM 1 BY 1                                              18560051
185600         UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  18570051
185700             OR SQLCODE = ZERO                                    18580051
185800                                                                  18590051
185900         EXEC SQL                                                 18600051
186000              CLOSE TRECDIS-CSR                                   18610051
186100         END-EXEC                                                 18620051
186200                                                                  18630051
186300         EVALUATE TRUE                                            18640051
186400             WHEN SQLCODE = ZERO                                  18650051
186500                 CONTINUE                                         18660051
186600             WHEN OTHER                                           18670051
186700                  MOVE '5120-CLOSE-TRECDIS-CSR'                   18680051
186800                               TO PV-ABEND-PARAGRAPH              18690051
186900                  MOVE 'CLOSE TRECDIS'                            18700051
187000                               TO PV-ABEND-OPERATION              18710051
187100                  MOVE 'TRECDIS'   TO PV-ABEND-STRUCTURE-1        18720051
187200                  MOVE 'CURRENT PO BEING PROCESSED ID:         '  18730051
187300                                 TO PV-DB2-OPERATION-MESSAGE-1    18740051
187400                  MOVE PV-ORD-NBR                                 18750051
187500                                   TO PV-DB2-OPERATION-MESSAGE-2  18760051
187600                  MOVE RECITM-ORD-LNE-NBR                         18770051
187700                                   TO PV-DB2-OPERATION-MESSAGE-3  18780051
187800                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        18790051
187900                  PERFORM 9900-DB2-ABEND                          18800051
188000         END-EVALUATE                                             18810051
188100     END-PERFORM.                                                 18820051
188200                                                                  18830051
188300     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND SQLCODE < ZERO       18840051
188400         MOVE '5110-FETCH-TRECDIS'                                18850051
188500                                 TO PV-ABEND-PARAGRAPH            18860051
188600         MOVE 'MAX RETRIES EXCEEDED'                              18870051
188700                                 TO PV-ABEND-OPERATION            18880051
188800         PERFORM 9900-DB2-ABEND                                   18890051
188900     END-IF.                                                      18900051
189000                                                                  18910051
189100 5200-INSERT.                                                     18920051
189200                                                                  18930051
189300     EXEC SQL                                                     18970055
189400          INSERT                                                  18980055
189500          INTO  TSTREXT                                           18990055
189600               (OP_CO_NBR                                         19000055
189700              , STR_NBR                                           19010055
189800              , DIV_SEQ_NBR                                       19020055
189900              , DEPT_NBR                                          19030055
190000              , RCVR_NBR                                          19040055
190100              , PO_NBR                                            19050055
190200              , INVC_NBR                                          19060055
190300              , VERIFYD_CT_DTE                                    19070055
190400              , REC_DTE                                           19080055
190500              , CLASS_NBR                                         19090055
190600              , VEND_INHSE_NAME                                   19100055
190700              , VEND_INHSE_NBR                                    19110055
190800              , VEND_DUNS_DESC                                    19120055
190900              , VEND_DUNS_NBR                                     19130055
191000              , SKU_SEQ_NBR                                       19140055
191100              , UNIT_RTL_AMT                                      19150055
191200              , LOWST_UNIT_RTL_AMT                                19160055
191300              , RTL_UNIT_ORD_QTY                                  19170055
191400              , RTL_UNIT_RCVD_QTY                                 19180055
191500              , RTL_UNIT_MK_QTY                                   19190055
191600              , COST_EXTN_AMT                                     19200055
191700              , RTL_EXTN_AMT                                      19210055
191800              , PRC_FCLTY_AREA_ID                                 19220055
191900              , INVC_RTL_QTY                                      19230055
192000              , CASH_DISC_CDE                                     19240055
192100              , DISC_DAYS_CNT                                     19250055
192200              , DISC_TERMS_CDE                                    19260055
192300              , EOM_IND                                           19270055
192400              , DATING_EXTN_CD                                    19280055
192500              , FRGT_PAYT_CDE                                     19290055
192600              , STR_TYP_CDE                                       19300055
192700              , PO_LNE_NBR                                        19310055
192800              , REC_SEQ_NBR                                       19320055
192900              , REC_SRC_CDE                                       19330055
193000              , CURR_OPER_UNT_ID                                  19340055
193100              , CURR_FCLTY_ID                                     19350055
193200              , OPER_UNT_ID                                       19360055
193300              , FCLTY_ID)                                         19370055
193400          VALUES                                                  19380055
193500               (:STREXT-OP-CO-NBR                                 19390055
193600              ,:STREXT-STR-NBR                                    19400055
193700              ,:STREXT-DIV-SEQ-NBR                                19410055
193800              ,:STREXT-DEPT-NBR                                   19420055
193900              ,:STREXT-RCVR-NBR                                   19430055
194000              ,:STREXT-PO-NBR                                     19440055
194100              ,:STREXT-INVC-NBR                                   19450055
194200              ,:STREXT-VERIFYD-CT-DTE                             19460055
194300              ,:STREXT-REC-DTE                                    19470055
194400              ,:STREXT-CLASS-NBR                                  19480055
194500              ,:STREXT-VEND-INHSE-NAME                            19490055
194600              ,:STREXT-VEND-INHSE-NBR                             19500055
194700              ,:STREXT-VEND-DUNS-DESC                             19510055
194800              ,:STREXT-VEND-DUNS-NBR                              19520055
194900              ,:STREXT-SKU-SEQ-NBR                                19530055
195000              ,:STREXT-UNIT-RTL-AMT                               19540055
195100              ,:STREXT-LOWST-UNIT-RTL-AMT                         19550055
195200              ,:STREXT-RTL-UNIT-ORD-QTY                           19560055
195300              ,:STREXT-RTL-UNIT-RCVD-QTY                          19570055
195400              ,:STREXT-RTL-UNIT-MK-QTY                            19580055
195500              ,:STREXT-COST-EXTN-AMT                              19590055
195600              ,:STREXT-RTL-EXTN-AMT                               19600055
195700              ,:STREXT-PRC-FCLTY-AREA-ID                          19610055
195800              ,:STREXT-INVC-RTL-QTY                               19620055
195900              ,:STREXT-CASH-DISC-CDE                              19630055
196000              ,:STREXT-DISC-DAYS-CNT                              19640055
196100              ,:STREXT-DISC-TERMS-CDE                             19650055
196200              ,:STREXT-EOM-IND                                    19660055
196300              ,:STREXT-DATING-EXTN-CD                             19670055
196400              ,:STREXT-FRGT-PAYT-CDE                              19680055
196500              ,:STREXT-STR-TYP-CDE                                19690055
196600              ,:STREXT-PO-LNE-NBR                                 19700055
196700              ,:STREXT-REC-SEQ-NBR                                19710055
196800              ,:STREXT-REC-SRC-CDE                                19720055
196900              ,:STREXT-CURR-OPER-UNT-ID                           19730055
197000              ,:STREXT-CURR-FCLTY-ID                              19740055
197100              ,:STREXT-OPER-UNT-ID                                19750055
197200              ,:STREXT-FCLTY-ID)                                  19760055
197300     END-EXEC.                                                    19770055
197400                                                                  19780051
197500     EVALUATE TRUE                                                19790051
197600         WHEN SQLCODE = ZERO                                      19800051
197700              ADD +1            TO PV-INSERT-COUNT                19810051
197800         WHEN SQLCODE NOT = +0                                    19820051
197900              MOVE '5200-INSERT'                                  19830051
198000                           TO PV-ABEND-PARAGRAPH                  19840051
198100              MOVE 'INSERT TSTREXT'                               19850051
198200                           TO PV-ABEND-OPERATION                  19860051
198300              MOVE 'TSTREXT'   TO PV-ABEND-STRUCTURE-1            19870051
198400              MOVE SPACES      TO PV-ABEND-STRUCTURE-2            19880051
198500              PERFORM 9900-DB2-ABEND                              19890051
198600     END-EVALUATE.                                                19900051
198700/                                                                 19910051
198800                                                                  19920051
198900 6000-SELECT-TCOCNTL.                                             19930051
199000                                                                  19940051
199100     EXEC SQL                                                     19950051
199200          SELECT  DISTINCT (BTCH_PRC_DTE)                         19960051
199300            INTO :COCNTL-BTCH-PRC-DTE                             19970051
199400            FROM  TCOCNTL                                         19980051
199500     END-EXEC.                                                    19990051
199600                                                                  20000051
199700     EVALUATE TRUE                                                20010051
199800         WHEN SQLCODE = +0                                        20020051
199900         WHEN SQLCODE = -811                                      20030051
200000             DISPLAY SPACES                                               
200100             DISPLAY 'BTCH-PRC-DTE = ' COCNTL-BTCH-PRC-DTE                
200200             DISPLAY SPACES                                               
200300         WHEN SQLWARN0 NOT = SPACE                                20050051
200400         WHEN SQLCODE  NOT = +0                                   20060051
200500              MOVE '6000-SELECT-TCOCNTL   '                       20070051
200600                                   TO PV-ABEND-PARAGRAPH          20080051
200700              MOVE 'ERROR SELETING BTCH PROCESS DATE'             20090051
200800                                   TO PV-ABEND-OPERATION          20100051
200900              MOVE 'TCOCNTL'       TO PV-ABEND-STRUCTURE-1        20110051
201000              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        20120051
201100              PERFORM 9900-DB2-ABEND                              20130051
201200     END-EVALUATE.                                                20140051
201300                                                                  20150051
201400 6500-SELECT-TCOCNTL.                                             20160051
201500                                                                  20170051
201600     EXEC SQL                                                     20180051
201700          SELECT DATE(BTCH_PRC_DTE + 1 DAYS)                      20190051
201800            INTO :WS-BTCH-PRC-DTE                                 20200051
201900            FROM  TCOCNTL                                         20210051
202000     END-EXEC.                                                    20220051
202100                                                                  20230051
202200     EVALUATE TRUE                                                20240051
202300         WHEN SQLCODE = +0                                        20250051
202400         WHEN SQLCODE = -811                                      20260051
202500             DISPLAY SPACES                                       20261057
202600             DISPLAY 'BTCH-PRC-DTE = ' WS-BTCH-PRC-DTE            20262057
202700             DISPLAY SPACES                                       20270057
202800         WHEN SQLWARN0 NOT = SPACE                                20280051
202900         WHEN SQLCODE  NOT = +0                                   20290051
203000              MOVE '6500-SELECT-TCOCNTL   '                       20300051
203100                                   TO PV-ABEND-PARAGRAPH          20310051
203200              MOVE 'ERROR SELETING BTCH PROCESS DATE'             20320051
203300                                   TO PV-ABEND-OPERATION          20330051
203400              MOVE 'TCOCNTL'       TO PV-ABEND-STRUCTURE-1        20340051
203500              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        20350051
203600              PERFORM 9900-DB2-ABEND                              20360051
203700     END-EVALUATE.                                                20370051
203800                                                                  20380051
203900 7000-OPEN-TRECEIV-CSR1.                                          20390051
204000*    DISPLAY '7000-OPEN-TRECEIV-CSR1'.                            20390051
204100     PERFORM                                                      20400051
204200         WITH TEST AFTER                                          20410051
204300         VARYING PV-RETRY-COUNT                                   20420051
204400         FROM 1 BY 1                                              20430051
204500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 20440051
204600            OR  (SQLCODE = +0))                                   20450051
204700                                                                  20460051
204800         EXEC SQL                                                 20470051
204900             OPEN TRECEIV-CSR1                                    20480051
205000         END-EXEC                                                 20490051
205100                                                                  20500051
205200         EVALUATE TRUE                                            20510051
205300             WHEN SQLCODE = +0                                    20520051
205400             WHEN SQLCODE = -904                                  20530051
205500             WHEN SQLCODE = -913                                  20540051
205600                  CONTINUE                                        20550051
205700             WHEN SQLWARN0 NOT = SPACE                            20560051
205800             WHEN SQLCODE  NOT = +0                               20570051
205900                  MOVE '7000-OPEN-TRECEIV-CSR1'                   20580051
206000                                 TO PV-ABEND-PARAGRAPH            20590051
206100                  MOVE 'OPEN TRECEIV CURSOR'                      20600051
206200                                 TO PV-ABEND-OPERATION            20610051
206300                  MOVE 'TRECIEV'   TO PV-ABEND-STRUCTURE-1        20620051
206400                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        20630051
206500                  PERFORM 9900-DB2-ABEND                          20640051
206600         END-EVALUATE                                             20650051
206700     END-PERFORM.                                                 20660051
206800                                                                  20670051
206900     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          20680051
207000         MOVE '7000-OPEN-TRECEIV-CSR1'                            20690051
207100                                 TO PV-ABEND-PARAGRAPH            20700051
207200         MOVE 'MAX RETRIES EXCEEDED'                              20710051
207300                                 TO PV-ABEND-OPERATION            20720051
207400         PERFORM 9900-DB2-ABEND                                   20730051
207500     END-IF.                                                      20740051
207600                                                                  20750051
207700 7010-OPEN-TRECEIV-CSR2.                                          20760051
207800*    DISPLAY '7010-OPEN-TRECEIV-CSR2'                             20760051
207900     PERFORM                                                      20770051
208000         WITH TEST AFTER                                          20780051
208100         VARYING PV-RETRY-COUNT                                   20790051
208200         FROM 1 BY 1                                              20800051
208300         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 20810051
208400            OR  (SQLCODE = +0))                                   20820051
208500                                                                  20830051
208600         EXEC SQL                                                 20840051
208700             OPEN TRECEIV-CSR2                                    20850051
208800         END-EXEC                                                 20860051
208900                                                                  20870051
209000         EVALUATE TRUE                                            20880051
209100             WHEN SQLCODE = +0                                    20890051
209200             WHEN SQLCODE = -904                                  20900051
209300             WHEN SQLCODE = -913                                  20910051
209400                  CONTINUE                                        20920051
209500             WHEN SQLWARN0 NOT = SPACE                            20930051
209600             WHEN SQLCODE  NOT = +0                               20940051
209700                  MOVE '7010-OPEN-TRECEIV-CSR2'                   20950051
209800                                 TO PV-ABEND-PARAGRAPH            20960051
209900                  MOVE 'OPEN TRECEIV CURSOR'                      20970051
210000                                 TO PV-ABEND-OPERATION            20980051
210100                  MOVE 'TRECIEV'   TO PV-ABEND-STRUCTURE-1        20990051
210200                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        21000051
210300                  PERFORM 9900-DB2-ABEND                          21010051
210400         END-EVALUATE                                             21020051
210500     END-PERFORM.                                                 21030051
210600                                                                  21040051
210700     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          21050051
210800         MOVE '7010-OPEN-TRECEIV-CSR2'                            21060051
210900                                 TO PV-ABEND-PARAGRAPH            21070051
211000         MOVE 'MAX RETRIES EXCEEDED'                              21080051
211100                                 TO PV-ABEND-OPERATION            21090051
211200         PERFORM 9900-DB2-ABEND                                   21100051
211300     END-IF.                                                      21110051
211400                                                                  21120051
211500 7100-FETCH-TRECEIV-CSR1.                                         21130051
211600                                                                  21140051
211700     EXEC SQL                                                     21150051
211800          FETCH TRECEIV-CSR1                                      21160051
211900           INTO   :RECEIV-ORD-NBR                                 21170051
212000                 ,:RECEIV-REC-SEQ-NBR                             21180051
212100                 ,:PV-RECEIV-CRE-TMST                             21190051
212200                 ,:RECEIV-OPER-UNT-ID                             21200051
212300                 ,:RECEIV-FCLTY-ID                                21210051
212400                 ,:PV-REC-TMST                                    21220051
212500                 ,:RECEIV-RCVR-NBR                                21230051
212600                 ,:PV-VERIFIED-DATE                               21240051
212700                 ,:RECEIV-CURR-OPER-UNT-ID                        21250051
212800                 ,:RECEIV-CURR-FCLTY-ID                           21260051
212900     END-EXEC.                                                    21270051
213000                                                                  21280051
213100     EVALUATE TRUE                                                21290051
213200         WHEN SQLCODE = +0                                        21300051
213300              ADD +1 TO PV-TRECEIV-COUNT                          21310051
213400         WHEN SQLCODE = +100                                      21320051
213500              SET PS-EOF-TRECEIV-CSR TO TRUE                      21330051
213600         WHEN SQLWARN0 NOT = SPACE                                21340051
213700         WHEN SQLCODE  NOT = +0                                   21350051
213800              MOVE '7100-FETCH-TRECEIV-CSR1'                      21360051
213900                                   TO PV-ABEND-PARAGRAPH          21370051
214000              MOVE 'FETCH TRECEIV CURSOR'                         21380051
214100                                   TO PV-ABEND-OPERATION          21390051
214200              MOVE 'TRECEIV'       TO PV-ABEND-STRUCTURE-1        21400051
214300              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        21410051
214400              PERFORM 9900-DB2-ABEND                              21420051
214500     END-EVALUATE.                                                21430051
214600                                                                  21440051
214700 7110-FETCH-TRECEIV-CSR2.                                         21450051
214800                                                                  21460051
214900     EXEC SQL                                                     21470051
215000          FETCH TRECEIV-CSR2                                      21480051
215100           INTO   :RECEIV-ORD-NBR                                 21490051
215200                 ,:RECEIV-REC-SEQ-NBR                             21500051
215300                 ,:PV-RECEIV-CRE-TMST                             21510051
215400                 ,:RECEIV-OPER-UNT-ID                             21520051
215500                 ,:RECEIV-FCLTY-ID                                21530051
215600                 ,:PV-REC-TMST                                    21540051
215700                 ,:RECEIV-RCVR-NBR                                21550051
215800                 ,:PV-VERIFIED-DATE                               21560051
215900                 ,:RECEIV-CURR-OPER-UNT-ID                        21570051
216000                 ,:RECEIV-CURR-FCLTY-ID                           21580051
216100     END-EXEC.                                                    21590051
216200                                                                  21600051
216300     EVALUATE TRUE                                                21610051
216400         WHEN SQLCODE = +0                                        21620051
216500              ADD +1 TO PV-TRECEIV-COUNT                          21630051
216600         WHEN SQLCODE = +100                                      21640051
216700              SET PS-EOF-TRECEIV-CSR TO TRUE                      21650051
216800         WHEN SQLWARN0 NOT = SPACE                                21660051
216900         WHEN SQLCODE  NOT = +0                                   21670051
217000              MOVE '7110-FETCH-TRECEIV-CSR2'                      21680051
217100                                   TO PV-ABEND-PARAGRAPH          21690051
217200              MOVE 'FETCH TRECEIV CURSOR'                         21700051
217300                                   TO PV-ABEND-OPERATION          21710051
217400              MOVE 'TRECEIV'       TO PV-ABEND-STRUCTURE-1        21720051
217500              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        21730051
217600              PERFORM 9900-DB2-ABEND                              21740051
217700     END-EVALUATE.                                                21750051
217800                                                                  21760051
217900 7200-CLOSE-TRECEIV-CSR1.                                         21770051
218000                                                                  21780051
218100     PERFORM                                                      21790051
218200         WITH TEST AFTER                                          21800051
218300         VARYING PV-RETRY-COUNT                                   21810051
218400         FROM 1 BY 1                                              21820051
218500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 21830051
218600            OR  (SQLCODE = +0))                                   21840051
218700                                                                  21850051
218800            EXEC SQL                                              21860051
218900                CLOSE TRECEIV-CSR1                                21870051
219000            END-EXEC                                              21880051
219100                                                                  21890051
219200            EVALUATE TRUE                                         21900051
219300                WHEN SQLCODE = 0                                  21910051
219400                    CONTINUE                                      21920051
219500                WHEN SQLCODE = -911                               21930051
219600                WHEN SQLCODE = -904                               21940051
219700                    CONTINUE                                      21950051
219800                WHEN SQLCODE  NOT = +0                            21960051
219900                     MOVE '7200-CLOSE-TRECEIV-CSR1'               21970051
220000                                  TO PV-ABEND-PARAGRAPH           21980051
220100                     MOVE 'CLOSE TRECEIV CURSOR'                  21990051
220200                                  TO PV-ABEND-OPERATION           22000051
220300                     MOVE 'TRECIEV'   TO PV-ABEND-STRUCTURE-1     22010051
220400                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     22020051
220500                     PERFORM 9900-DB2-ABEND                       22030051
220600            END-EVALUATE                                          22040051
220700                                                                  22050051
220800     END-PERFORM.                                                 22060051
220900                                                                  22070051
221000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          22080051
221100         MOVE '7200-CLOSE-TRECEIV-CSR1'                           22090051
221200                                 TO PV-ABEND-PARAGRAPH            22100051
221300         MOVE 'MAX RETRIES EXCEEDED'                              22110051
221400                                 TO PV-ABEND-OPERATION            22120051
221500         PERFORM 9900-DB2-ABEND                                   22130051
221600     END-IF.                                                      22140051
221700                                                                  22150051
221800 7210-CLOSE-TRECEIV-CSR2.                                         22160051
221900                                                                  22170051
222000     PERFORM                                                      22180051
222100         WITH TEST AFTER                                          22190051
222200         VARYING PV-RETRY-COUNT                                   22200051
222300         FROM 1 BY 1                                              22210051
222400         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 22220051
222500            OR  (SQLCODE = +0))                                   22230051
222600                                                                  22240051
222700            EXEC SQL                                              22250051
222800                CLOSE TRECEIV-CSR2                                22260051
222900            END-EXEC                                              22270051
223000                                                                  22280051
223100            EVALUATE TRUE                                         22290051
223200                WHEN SQLCODE = 0                                  22300051
223300                    CONTINUE                                      22310051
223400                WHEN SQLCODE = -911                               22320051
223500                WHEN SQLCODE = -904                               22330051
223600                    CONTINUE                                      22340051
223700                WHEN SQLCODE  NOT = +0                            22350051
223800                     MOVE '7210-CLOSE-TRECEIV-CSR2'               22360051
223900                                  TO PV-ABEND-PARAGRAPH           22370051
224000                     MOVE 'CLOSE TRECEIV CURSOR'                  22380051
224100                                  TO PV-ABEND-OPERATION           22390051
224200                     MOVE 'TRECIEV'   TO PV-ABEND-STRUCTURE-1     22400051
224300                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     22410051
224400                     PERFORM 9900-DB2-ABEND                       22420051
224500            END-EVALUATE                                          22430051
224600                                                                  22440051
224700     END-PERFORM.                                                 22450051
224800                                                                  22460051
224900     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          22470051
225000         MOVE '7210-CLOSE-TRECEIV-CSR2'                           22480051
225100                                 TO PV-ABEND-PARAGRAPH            22490051
225200         MOVE 'MAX RETRIES EXCEEDED'                              22500051
225300                                 TO PV-ABEND-OPERATION            22510051
225400         PERFORM 9900-DB2-ABEND                                   22520051
225500     END-IF.                                                      22530051
225600                                                                  22540051
225700 8000-OPEN-XLT-LOC-CURSOR.                                        22550051
225800                                                                  22560051
225900     PERFORM                                                      22570051
226000         WITH TEST AFTER                                          22580051
226100         VARYING PV-RETRY-COUNT                                   22590051
226200         FROM 1 BY 1                                              22600051
226300         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 22610051
226400            OR  (SQLCODE = +0))                                   22620051
226500                                                                  22630051
226600         EXEC SQL                                                 22640051
226700             OPEN XLT-LOC-CSR                                     22650051
226800         END-EXEC                                                 22660051
226900                                                                  22670051
227000         EVALUATE TRUE                                            22680051
227100             WHEN SQLCODE = +0                                    22690051
227200             WHEN SQLCODE = -904                                  22700051
227300             WHEN SQLCODE = -913                                  22710051
227400                  CONTINUE                                        22720051
227500             WHEN SQLWARN0 NOT = SPACE                            22730051
227600             WHEN SQLCODE  NOT = +0                               22740051
227700                  MOVE '8000-OPEN-XLT-LOC-CURSOR'                 22750051
227800                                 TO PV-ABEND-PARAGRAPH            22760051
227900                  MOVE 'OPEN XLT-LOC CURSOR'                      22770051
228000                                 TO PV-ABEND-OPERATION            22780051
228100                  MOVE 'XLT-LOC'   TO PV-ABEND-STRUCTURE-1        22790051
228200                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        22800051
228300                  PERFORM 9900-DB2-ABEND                          22810051
228400         END-EVALUATE                                             22820051
228500     END-PERFORM.                                                 22830051
228600                                                                  22840051
228700     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          22850051
228800         MOVE '8000-OPEN-XLT-LOC-CURSOR'                          22860051
228900                                 TO PV-ABEND-PARAGRAPH            22870051
229000         MOVE 'MAX RETRIES EXCEEDED'                              22880051
229100                                 TO PV-ABEND-OPERATION            22890051
229200         PERFORM 9900-DB2-ABEND                                   22900051
229300     END-IF.                                                      22910051
229400                                                                  22920051
229500 8010-FETCH-XLT-LOC-CSR.                                          22930051
229600                                                                  22940051
229700     EXEC SQL                                                     22950051
229800          FETCH XLT-LOC-CSR                                       22960051
229900           INTO                                                   22970051
230000             :XLT00010-LOC-NBR                                    22980051
230100                                                                  22990051
230200     END-EXEC.                                                    23000051
230300                                                                  23010051
230400     EVALUATE TRUE                                                23020051
230500         WHEN SQLCODE = +0                                        23030051
230600              CONTINUE                                            23040051
230700         WHEN SQLCODE = +100                                      23050051
230800              SET PS-EOF-XLT-LOC-CSR TO TRUE                      23060051
230900         WHEN SQLWARN0 NOT = SPACE                                23070051
231000         WHEN SQLCODE  NOT = +0                                   23080051
231100              MOVE '8010-FETCH-XLT-LOC-CSR'                       23090051
231200                                   TO PV-ABEND-PARAGRAPH          23100051
231300              MOVE 'FETCH XLT-LOC CURSOR'                         23110051
231400                                   TO PV-ABEND-OPERATION          23120051
231500              MOVE 'XLT-LOC'       TO PV-ABEND-STRUCTURE-1        23130051
231600              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        23140051
231700              PERFORM 9900-DB2-ABEND                              23150051
231800     END-EVALUATE.                                                23160051
231900 8200-LOAD-STORE-TABLE.                                           23170051
232000     MOVE XLT00010-LOC-NBR   TO PT-STR-NBR (PT-STR-IDX).          23180051
232100     PERFORM 8010-FETCH-XLT-LOC-CSR.                              23190051
232200                                                                  23200051
232300 8300-CLOSE-XLT-LOC-CSR.                                          23210051
232400                                                                  23220051
232500     PERFORM                                                      23230051
232600         WITH TEST AFTER                                          23240051
232700         VARYING PV-RETRY-COUNT                                   23250051
232800         FROM 1 BY 1                                              23260051
232900         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 23270051
233000            OR  (SQLCODE = +0))                                   23280051
233100                                                                  23290051
233200            EXEC SQL                                              23300051
233300                CLOSE XLT-LOC-CSR                                 23310051
233400            END-EXEC                                              23320051
233500                                                                  23330051
233600            EVALUATE TRUE                                         23340051
233700                WHEN SQLCODE = 0                                  23350051
233800                    CONTINUE                                      23360051
233900                WHEN SQLCODE = -911                               23370051
234000                WHEN SQLCODE = -904                               23380051
234100                    CONTINUE                                      23390051
234200                WHEN SQLCODE  NOT = +0                            23400051
234300                     MOVE '8300-CLOSE-XLT-LOC-CSR'                23410051
234400                                  TO PV-ABEND-PARAGRAPH           23420051
234500                     MOVE 'CLOSE XLT-LOC CURSOR'                  23430051
234600                                  TO PV-ABEND-OPERATION           23440051
234700                     MOVE 'XLT-LOC'   TO PV-ABEND-STRUCTURE-1     23450051
234800                     MOVE SPACES      TO PV-ABEND-STRUCTURE-2     23460051
234900                     PERFORM 9900-DB2-ABEND                       23470051
235000            END-EVALUATE                                          23480051
235100                                                                  23490051
235200     END-PERFORM.                                                 23500051
235300                                                                  23510051
235400     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          23520051
235500         MOVE '8300-CLOSE-XLT-LOC-CSR'                            23530051
235600                                 TO PV-ABEND-PARAGRAPH            23540051
235700         MOVE 'MAX RETRIES EXCEEDED'                              23550051
235800                                 TO PV-ABEND-OPERATION            23560051
235900         PERFORM 9900-DB2-ABEND                                   23570051
236000     END-IF.                                                      23580051
236100                                                                  23590051
236200*----------------------------------------------------------------*23600051
236300*    COMMITS ALL DB2 UPDATES PERFORMED.                          *23610051
236400*----------------------M-----------------------------------------*23620051
236500 Z100-COMMIT.                                                     23630051
236600                                                                  23640051
236700     PERFORM WITH TEST AFTER                                      23650051
236800             VARYING PV-RETRY-COUNT FROM 1 BY 1                   23660051
236900             UNTIL   PV-RETRY-COUNT > PC-MAX-RETRIES OR           23670051
237000                     SQLCODE = ZERO                               23680051
237100                                                                  23690051
237200             EXEC SQL                                             23700051
237300                 COMMIT                                           23710051
237400             END-EXEC                                             23720051
237500                                                                  23730051
237600             EVALUATE TRUE                                        23740051
237700                 WHEN SQLCODE = ZERO                              23750051
237800                 WHEN SQLCODE = -904                              23760051
237900                 WHEN SQLCODE = -913                              23770051
238000                      CONTINUE                                    23780051
238100                                                                  23790051
238200                 WHEN SQLWARN0 NOT = SPACES                       23800051
238300                 WHEN SQLCODE  NOT = +0                           23810051
238400                     MOVE 'Z100-COMMIT'                           23820051
238500                                         TO PV-ABEND-PARAGRAPH    23830051
238600                     MOVE 'UNSUCCESSFUL COMMIT'                   23840051
238700                                         TO PV-ABEND-OPERATION    23850051
238800                     MOVE 'TRECEIV'      TO PV-ABEND-STRUCTURE-1  23860051
238900                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  23870051
239000                     PERFORM 9900-DB2-ABEND                       23880051
239100             END-EVALUATE                                         23890051
239200     END-PERFORM.                                                 23900051
239300                                                                  23910051
239400     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          23920051
239500         MOVE 'Z100-COMMIT'                                       23930051
239600                                 TO PV-ABEND-PARAGRAPH            23940051
239700         MOVE 'MAX RETRIES EXCEEDED'                              23950051
239800                                 TO PV-ABEND-OPERATION            23960051
239900         PERFORM 9900-DB2-ABEND                                   23970051
240000     END-IF.                                                      23980051
240100*                                                                 23990051
240200                                                                  24000051
240300 9900-DB2-ABEND.                                                  24010051
240400                                                                  24020051
240500     MOVE SQLCODE TO PV-SQLCODE.                                  24030051
240600     DISPLAY '*** DB2 ERROR '.                                    24040051
240700     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       24050051
240800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 24060051
240900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               24070051
241000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               24080051
241100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       24090051
241200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       24100051
241300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       24110051
241400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             24120051
241500                                                                  24130051
241600     IF PV-ABEND-STRUCTURE-2 > SPACES                             24140051
241700         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          24150051
241800     END-IF.                                                      24160051
241900                                                                  24170051
242000                                                                  24180051
242100     COPY DPPD004.                                                24190051
242200                                                                  24200051
242300     IF SQLCODE NOT = -911                                        24210051
242400         EXEC SQL                                                 24220051
242500              ROLLBACK                                            24230051
242600         END-EXEC                                                 24240051
242700     END-IF.                                                      24250051
242800                                                                  24260051
242900     MOVE +4013                  TO PV-ABEND-CODE.                24270051
243000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         24280051
243100*                                                                 24290051
243200 9200-ABEND.                                                      24300051
243300******************************************************************24310051
243400*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       24320051
243500******************************************************************24330051
243600     DISPLAY '***************************'.                       24340051
243700     DISPLAY '**       ABEND           **'.                       24350051
243800     DISPLAY '**  IN PROGRAM RVKCS001  **'.                       24360051
243900     DISPLAY '***************************'.                       24370051
244000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        24380051
244100     DISPLAY '**   ERROR         ** = ' DP003-RETURN-MSG.         24390051
244200     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       24400051
244300     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       24410051
244400     PERFORM 9210-ABEND.                                          24420051
244500 9210-ABEND.                                                      24430051
244600     MOVE +4014                  TO PV-ABEND-CODE.                24440051
244700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         24450051
244800*                                                                 24460051
