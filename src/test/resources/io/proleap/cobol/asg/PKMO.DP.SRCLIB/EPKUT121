000100 IDENTIFICATION DIVISION.                                         00010007
000200 PROGRAM-ID.      EPKUT121.                                       00020007
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030029
000400 DATE-WRITTEN.    FEBRUARY, 2003.                                 00040007
000500                                                                  00050007
000600*-----------------------------------------------------------      00060007
000700*              MERCHANDISE EXCLUSIONS IDENTIFIER                  00070029
000800*-----------------------------------------------------------      00080007
000900*-----------------------------------------------------------      00090007
001000* HISTORY LOG:                                                    00100007
001100*-----------------------------------------------------------      00110007
001200* DATE:                                                           00120007
001300* WR/IR#:                                                         00130007
001400* PROGRAMMER:                                                     00140007
001500* DESCRIPTION:                                                    00150007
001600*                                                                 00160007
001700*----------------------------------------------------------       00170007
001800 ENVIRONMENT DIVISION.                                            00180007
001900*----------------------------------------------------------       00190007
002000 CONFIGURATION SECTION.                                           00200007
002100 SOURCE-COMPUTER.        IBM-3090.                                00210007
002200 OBJECT-COMPUTER.        IBM-3090.                                00220007
002210                                                                  00221007
002220 INPUT-OUTPUT SECTION.                                            00222007
002230                                                                  00223007
002240 FILE-CONTROL.                                                    00224007
002250                                                                  00225007
002251     SELECT CONTROL-CARD-PGM-LAST-RUN-DTE                         00225146
002252       ASSIGN TO INP01.                                           00225268
002253     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00225346
002254       ASSIGN TO INP02.                                           00225468
002255     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00225546
002256       ASSIGN TO INP03.                                           00225668
002257     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00225746
002258       ASSIGN TO INP04.                                           00225868
002259     SELECT PROMO-NIGHT-FILE                                      00225944
002260       ASSIGN TO OUT01.                                           00226068
002261     SELECT PROMO-EMERGENCY-FILE                                  00226145
002262       ASSIGN TO OUT02.                                           00226268
002270                                                                  00227007
002280 DATA DIVISION.                                                   00228007
002290 FILE SECTION.                                                    00229007
002300                                                                  00230007
002400 FD  CONTROL-CARD-PGM-LAST-RUN-DTE                                00240046
002500     RECORDING MODE F                                             00250007
002600     BLOCK CONTAINS 0 RECORDS                                     00260007
002700     LABEL RECORDS ARE OMITTED                                    00270007
002800     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00280046
002900 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00290070
003000                                                                  00300007
003010 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00301046
003020     RECORDING MODE F                                             00302007
003030     BLOCK CONTAINS 0 RECORDS                                     00303007
003040     LABEL RECORDS ARE OMITTED                                    00304007
003050     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00305046
003060 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00306070
003070                                                                  00307007
003080 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00308046
003090     RECORDING MODE F                                             00309007
003091     BLOCK CONTAINS 0 RECORDS                                     00309107
003092     LABEL RECORDS ARE OMITTED                                    00309207
003093     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00309346
003094 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00309470
003095                                                                  00309507
003096 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00309646
003097     RECORDING MODE F                                             00309707
003098     BLOCK CONTAINS 0 RECORDS                                     00309807
003099     LABEL RECORDS ARE OMITTED                                    00309907
003100     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00310046
003101 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00310170
003102                                                                  00310207
003103 FD  PROMO-NIGHT-FILE                                             00310322
003104     RECORDING MODE F                                             00310407
003105     BLOCK CONTAINS 0 RECORDS                                     00310507
003106     LABEL RECORDS ARE OMITTED                                    00310607
003110     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00311022
003200 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00320070
003300                                                                  00330007
003310 FD  PROMO-EMERGENCY-FILE                                         00331045
003320     RECORDING MODE F                                             00332022
003330     BLOCK CONTAINS 0 RECORDS                                     00333022
003340     LABEL RECORDS ARE OMITTED                                    00334022
003350     DATA RECORD IS PROMO-EMERG-ID-RECORD.                        00335022
003360 01  PROMO-EMERGENCY-RECORD                        PIC  X(200).   00336070
003370                                                                  00337022
004100 WORKING-STORAGE SECTION.                                         00410007
004200*-----------------------------------------------------------      00420007
004300* PS - PROGRAM SWITCHES                                           00430020
004400*-----------------------------------------------------------      00440007
004500 01  PS-PROGRAM-SWITCHES.                                         00450007
005300     05  PS-MDSE-EXCL-CSR-EOF-SW                   PIC  X(001).   00530070
005310       88  PS-MDSE-EXCL-CSR-EOF                      VALUE 'Y'.   00531070
005320       88  PS-MDSE-EXCL-CSR-NOT-EOF                  VALUE 'N'.   00532070
005330     05  PS-MDSE-EXCL-ADHOC-CSR-EOF-SW             PIC  X(001).   00533070
005340       88  PS-MDSE-EXCL-ADHOC-CSR-EOF                VALUE 'Y'.   00534070
005350       88  PS-MDSE-EXCL-ADHOC-CSR-NOT-EOF            VALUE 'N'.   00535070
006000     05  PS-REC-FOUND-SW                           PIC  X(001).   00600070
006100       88  PS-REC-FOUND                              VALUE 'Y'.   00610070
006200       88  PS-NO-REC-FOUND                           VALUE 'N'.   00620070
006300     05  PS-WRITE-PROMO-SW                         PIC  X(001).   00630070
006400       88  PS-WRITE-PROMO                            VALUE 'Y'.   00640070
006500       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   00650070
006600     05  PS-FILE-STATUS                            PIC  X(002).   00660070
006610       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  00661070
006620       88  PS-END-OF-FILE                            VALUE '10'.  00662070
006630       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  00663070
006631     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   00663170
006632       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   00663270
006633       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   00663370
006640                                                                  00664007
006650*-----------------------------------------------------------      00665007
006660* PROGRAM CONSTANTS                                               00666007
006670*-----------------------------------------------------------      00667007
006680 01  PC-PROGRAM-CONSTANTS.                                        00668007
006690     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    00669070
006691       VALUE 'EPKUT121'.                                          00669165
006700     05  PC-BUSINESS-EVENT-ID                      PIC  X(003)    00670070
006800       VALUE '110'.                                               00680065
006900     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    00690070
006901       VALUE 'R'.                                                 00690165
006902     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    00690270
006903       VALUE 'A'.                                                 00690347
006904     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    00690474
006905       VALUE '99999'.                                             00690574
006906     05  PC-FILE-ACT-TYPE                          PIC  X(003)    00690670
006907       VALUE 'CHG'.                                               00690747
006908     05  PC-APPLY-NIGHTLY                          PIC  X(001)    00690870
006909       VALUE 'N'.                                                 00690947
006910     05  PC-APPLY-CORRECTION                       PIC  X(001)    00691070
006911       VALUE 'C'.                                                 00691147
006912     05  PC-MDSE-EXCL-STAT-CDE                     PIC  X(001).   00691270
006920       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   00692070
006950       88  PC-DELETE-STATUS                          VALUE 'D'.   00695070
006960       88  PC-CANCEL-STATUS                          VALUE 'C'.   00696070
006961     05  PC-ADD-STAT-CDE                           PIC  X(001)    00696170
006962       VALUE 'A'.                                                 00696247
006970     05  PC-DELETE-STAT-CDE                        PIC  X(001)    00697070
006971       VALUE 'D'.                                                 00697147
006972     05  PC-MDSE-EXCL-IND                          PIC  X(001)    00697270
006973       VALUE 'E'.                                                 00697347
007000                                                                  00700007
007100*-----------------------------------------------------------      00710007
007200* PV- PROGRAM VARIABLES                                           00720007
007300*-----------------------------------------------------------      00730007
007400 01  PV-PROGRAM-VARAIBLES.                                        00740007
007500     05  PV-SQL-SUB                                PIC S9(004)    00750070
007510                                                     VALUE +0     00751070
007520                                                     COMP.        00752070
008210     05  PV-CURRENT-SYSTEM-TMST                    PIC  X(026)    00821070
008220                                                     VALUE SPACES.00822070
008300     05  PV-ACTL-STRT-TMST.                                       00830039
008310       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    00831070
008311                                                     VALUE SPACES.00831170
008320       10  FILLER                                  PIC  X(016)    00832070
008330                                                     VALUE SPACES.00833070
008400     05  PV-ACTL-END-TMST                          PIC  X(026)    00840070
008410                                                     VALUE SPACES.00841070
008500     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    00850070
008510                                                     VALUE SPACES.00851070
008600     05  PV-EFF-STRT-TMST                          PIC  X(026)    00860070
008610                                                     VALUE SPACES.00861070
008700     05  PV-EFF-END-TMST                           PIC  X(026)    00870070
008710                                                     VALUE SPACES.00871070
008800     05  PV-EFF-END-NULL                           PIC S9(004)    00880070
008911                                                     VALUE ZEROS  00880176
008810                                                     COMP.        00881076
008900     05  PV-ABEND-CODE                             PIC  9999      00890070
008911                                                     VALUE ZEROS  00891170
008912                                                     COMP.        00891270
009000     05  PV-FUL-FILE-STR                           PIC  9(005)    00900070
009010                                                     VALUE ZEROS. 00901070
009100     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    00910070
009110                                                     VALUE SPACES.00911070
009200     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    00920070
009300                                                     VALUE SPACES.00930070
009400                                                                  00940068
009900*----------------------------------------------------------       00990007
010000* FULL FILE EXTRACT OUTPUT FILE.                                  01000007
010100*----------------------------------------------------------       01010007
010200     COPY EPRD072.                                                01020007
010300                                                                  01030007
010400*----------------------------------------------------------       01040007
010500* EPCC111 CONTROL CARD LAYOUT - CURRENT PRICING DATE              01050046
010600*----------------------------------------------------------       01060007
010700     COPY EPRD111.                                                01070007
010800                                                                  01080007
010810*----------------------------------------------------------       01081007
010820* EPCC113 CONTROL CARD LAYOUT - FUTURE CORRECTIONS DATE           01082046
010830*----------------------------------------------------------       01083007
010840     COPY EPRD113.                                                01084007
010850                                                                  01085007
010860*----------------------------------------------------------       01086007
010870* EPCC114 CONTROL CARD LAYOUT - PROGRAM LAST RUN DATE             01087046
010880*----------------------------------------------------------       01088007
010890     COPY EPRD114.                                                01089007
010891                                                                  01089107
010892*----------------------------------------------------------       01089207
010893* EPCC128 CONTROL CARD LAYOUT - CRITICAL EFFECTIVE DATE           01089346
010894*----------------------------------------------------------       01089407
010895     COPY EPRD128.                                                01089507
010896                                                                  01089607
011900*----------------------------------------------------------       01190007
012000* DATE ROUTINE COPY MEMBERS                                       01200007
012100*----------------------------------------------------------       01210007
012200     COPY DPWS500.                                                01220007
012300                                                                  01230007
012400*-----------------------------------------------------------      01240007
012500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01250007
012600*-----------------------------------------------------------      01260007
012700     COPY DPWS004.                                                01270007
012800                                                                  01280007
012900*-----------------------------------------------------------      01290007
013000* DB2 ABEND COPYBOOK                                              01300007
013100*-----------------------------------------------------------      01310007
013200     COPY DPWS900.                                                01320007
013300                                                                  01330007
013400*-----------------------------------------------------------      01340007
013500* DB2 MESSAGE AREA                                                01350007
013600*-----------------------------------------------------------      01360007
013700     COPY SQLCA2.                                                 01370007
013800                                                                  01380007
013900*-----------------------------------------------------------      01390007
014000* PROGRAM COUNTERS                                                01400007
014010*-----------------------------------------------------------      01401007
014020 01  PC-PROGRAM-COUNTERS.                                         01402007
014030     05  PC-CNT-READ-RECS                          PIC  9(009)    01403070
014031                                                     VALUE 0.     01403170
014040     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    01404070
014041                                                     VALUE 0.     01404170
014042     05  PC-CNT-EMERG-RECS                         PIC  9(009)    01404270
014043                                                     VALUE 0.     01404370
014050     05  PC-CNT-PROMO-RECS                         PIC  9(009)    01405070
014051                                                     VALUE 0.     01405170
014052     05  PC-CNT-RMS-RECS                           PIC  9(009)    01405270
014053                                                     VALUE 0.     01405370
014054     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    01405470
014055                                                     VALUE 0.     01405570
014060     05  PC-CNT-PMAP-RECS                          PIC  9(009)    01406070
014061                                                     VALUE 0.     01406170
014070     05  PC-CNT-ERROR-RECS                         PIC  9(009)    01407070
014071                                                     VALUE 0.     01407170
014080     05  PC-CNT-ALL-RECS                           PIC  9(009)    01408070
014081                                                     VALUE 0.     01408170
014090     05  PC-CNT-SPACES                             PIC  9(009)    01409070
014091                                                     VALUE 0.     01409170
014100     05  PC-CNT-POS                                PIC  9(009)    01410070
014110                                                     VALUE 0.     01411070
014200     05  PC-CNT-EXCL-CHECK                         PIC  9(009)    01420070
014210                                                     VALUE 0.     01421070
014300     05  PC-MAX-RETRIES                            PIC S9(004)    01430070
014310                                                     VALUE +5     01431070
014320                                                     COMP.        01432070
014400                                                                  01440007
014500*-----------------------------------------------------------      01450007
014600* ERROR HANDLING                                                  01460007
014700*-----------------------------------------------------------      01470007
014800 01  PV-MISC-ABEND-FIELDS.                                        01480007
014900     05  PV-PARAGRAPH-NAME                         PIC  X(030)    01490070
014910                                                     VALUE SPACE. 01491070
015000     05  PV-OPERATION-MSG-1                        PIC  X(040)    01500070
015001                                                     VALUE SPACE. 01500170
015100     05  PV-OPERATION-MSG-2                        PIC  X(040)    01510070
015110                                                     VALUE SPACE. 01511070
015200     05  PV-DB2-OPERATION                          PIC  X(030)    01520070
015210                                                     VALUE SPACE. 01521070
015300 01  ABEND-CODE                                    PIC S9(004)    01530070
015310                                                     VALUE ZEROS  01531070
015330                                                     COMP         01533070
015340                                                     SYNC.        01534070
015400   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 01540070
015500   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 01550070
015600   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 01560070
015700   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 01570070
015800   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 01580070
015900   88  ABEND-4008                                    VALUE +4008. 01590070
016000                                                                  01600007
016100*-----------------------------------------------------------      01610007
016200* DB2 COMMUNICATIONS AREA                                         01620007
016300*-----------------------------------------------------------      01630007
016400     EXEC SQL                                                     01640007
016500       INCLUDE SQLCA                                              01650048
016600     END-EXEC.                                                    01660007
016700                                                                  01670007
018270*-----------------------------------------------------------      01827007
018280* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01828007
018290*-----------------------------------------------------------      01829007
018300     EXEC SQL                                                     01830007
018400       INCLUDE XST00028                                           01840048
018500     END-EXEC.                                                    01850007
018600                                                                  01860007
018700*-----------------------------------------------------------      01870007
018800* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01880007
018900*                                               TABLE             01890007
019000*-----------------------------------------------------------      01900007
019100     EXEC SQL                                                     01910007
019200       INCLUDE XST00029                                           01920048
019300     END-EXEC.                                                    01930007
019400                                                                  01940007
019500*-----------------------------------------------------------      01950007
019600* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01960007
019700*-----------------------------------------------------------      01970007
019800     EXEC SQL                                                     01980007
019900       INCLUDE XST00031                                           01990048
020000     END-EXEC.                                                    02000007
020100                                                                  02010007
020360*-----------------------------------------------------------      02036007
020370* DB2 TABLE XST00034(XST_EXCL_MDSE) - MERCHANDSE EXCLUSIONS       02037066
020380*-----------------------------------------------------------      02038007
020390     EXEC SQL                                                     02039007
020400       INCLUDE XST00034                                           02040048
020500     END-EXEC.                                                    02050007
020600                                                                  02060007
020700*-----------------------------------------------------------      02070007
020800* MERCHANDISE EXCLUSION CHANGE INTRFCE INCLUDE CURSOR.(RMS)       02080066
021000*-----------------------------------------------------------      02100007
021100     EXEC SQL                                                     02110007
021200       DECLARE MDSE-EXCL-RMS CURSOR FOR                           02120070
021300         SELECT EXMDSE.EXCL_MDSE_ID                               02130070
021300               ,EXMDSE.PROMO_INTFC_SUB_ID                         02130170
021403               ,EXMDSE.STAT_CDE                                   02131070
021300               ,EXMDSE.LAST_UPD_TMST                              02140070
021404               ,EXMDSE.SOR_LAST_UPD_TMST                          02140448
021410               ,STRGP.PROMO_INTFC_ID                              02141048
021500               ,STRGP.MDSE_LNE_ID                                 02150048
021600               ,STRGP.STR_GP_TYP_CDE                              02160048
021700               ,STRGP.STR_GP_ID                                   02170048
021710               ,STRGP.STR_SELN_HIER_CDE                           02171048
021711               ,STRGP.ACTL_STRT_TMST                              02171148
021720               ,STRGP.ACTL_END_TMST                               02172048
021730               ,MDSSEL.PRICG_TYP_CDE                              02173048
021750         FROM XST_EXCL_MDSE      EXMDSE                           02175048
021751             ,XST_PROMO_STR_GP   STRGP                            02175148
021752             ,XST_MDSE_LNE_SELN  MDSSEL                           02175248
021753         WHERE EXMDSE.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      02175348
021754           AND EXMDSE.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         02175448
021759           AND MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       02175948
021760           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          02176048
021769           AND STRGP.STAT_CDE  IN ('S')                           02176948
021771           AND (EXMDSE.LAST_UPD_TMST                              02177148
021772               BETWEEN :EP114-CC-EXC-CUTOFF-TMST                  02177248
021773                   AND :PV-CURRENT-SYSTEM-TMST)                   02177348
021774           AND ((:EP111-CC-CRNT-DTE                               02177448
021775               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02177548
021776                   AND DATE(STRGP.ACTL_END_TMST))                 02177648
021777           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02177748
021778               BETWEEN :EP111-CC-DATE-PLUS1                       02177848
021779                   AND :EP113-CC-CRNT-DTE-MINUS1))                02177948
021799         FOR FETCH ONLY                                           02179948
021800         WITH UR                                                  02180048
021801     END-EXEC.                                                    02180107
021802                                                                  02180207
021803*-----------------------------------------------------------      02180307
021804* MERCHANDISE EXCLUSION CHANGE ADHOC CURSOR.                      02180470
021806*-----------------------------------------------------------      02180607
021807     EXEC SQL                                                     02180707
021810       DECLARE MDSE-EXCL-ADHOC CURSOR FOR                         02181024
021300         SELECT EXMDSE.EXCL_MDSE_ID                               02181170
021300               ,EXMDSE.PROMO_INTFC_SUB_ID                         02181270
021821               ,EXMDSE.STAT_CDE                                   02181370
021820               ,EXMDSE.LAST_UPD_TMST                              02182070
021822               ,EXMDSE.SOR_LAST_UPD_TMST                          02182248
021830               ,ADHOC.PROMO_INTFC_ID                              02183048
021840               ,ADHOC.MDSE_LNE_ID                                 02184048
021851               ,ADHOC.ADHC_STR_GP_ID                              02185148
021852               ,ADHOC.STR_SELN_HIER_CDE                           02185248
021860               ,ADHOC.ACTL_STRT_TMST                              02186048
021870               ,ADHOC.ACTL_END_TMST                               02187048
021874               ,MDSSEL.PRICG_TYP_CDE                              02187448
021875         FROM XST_EXCL_MDSE      EXMDSE                           02187548
021877             ,XST_PROMO_ADHC_RLT ADHOC                            02187748
021879             ,XST_MDSE_LNE_SELN  MDSSEL                           02187948
021882         WHERE EXMDSE.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      02188248
021883           AND EXMDSE.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         02188348
021884           AND ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      02188448
021885           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         02188548
021891           AND ADHOC.STAT_CDE  IN ('S')                           02189148
021893           AND (EXMDSE.LAST_UPD_TMST                              02189348
021894               BETWEEN :EP114-CC-EXC-CUTOFF-TMST                  02189448
021895                   AND :PV-CURRENT-SYSTEM-TMST)                   02189548
021910           AND ((:EP111-CC-CRNT-DTE                               02191048
021911               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 02191148
021912                   AND DATE(ADHOC.ACTL_END_TMST))                 02191248
021913           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        02191348
021914               BETWEEN :EP111-CC-DATE-PLUS1                       02191448
021915                   AND :EP113-CC-CRNT-DTE-MINUS1))                02191548
021916         FOR FETCH ONLY                                           02191648
021920         WITH UR                                                  02192048
021921     END-EXEC.                                                    02192118
021922                                                                  02192218
021923                                                                  02192318
021930 LINKAGE SECTION.                                                 02193007
021940                                                                  02194007
021950*----------------------------------------------------------       02195007
021951 PROCEDURE DIVISION.                                              02195141
021952*----------------------------------------------------------       02195207
021953 0000-MAINLINE.                                                   02195307
021954                                                                  02195407
021955     PERFORM 1000-INITIALIZATION.                                 02195507
021956                                                                  02195607
021957     PERFORM 2000-PROCESS-MERCH-EXCLUSIONS.                       02195718
021958                                                                  02195818
021959     PERFORM 9999-WRAPUP.                                         02195918
021960                                                                  02196018
021961     GOBACK.                                                      02196118
021962                                                                  02196218
021970*0000-EXIT.                                                       02197007
021980 EJECT.                                                           02198007
021990                                                                  02199007
022000*----------------------------------------------------------       02200007
022100* 1000-INITIALIZATION.                                            02210007
022200*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02220007
022300*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02230007
022400*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02240007
022500*     INTERFACE ID FILE.                                          02250007
022600*----------------------------------------------------------       02260007
022700 1000-INITIALIZATION.                                             02270007
022800                                                                  02280007
022900     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      02290046
023000                 CONTROL-CARD-FUTRE-CORR-DTE                      02300046
023100                 CONTROL-CARD-PGM-LAST-RUN-DTE                    02310046
023110                 CONTROL-CARD-CRIT-EFF-DTE.                       02311046
023310     OPEN OUTPUT PROMO-NIGHT-FILE                                 02331025
023320                 PROMO-EMERGENCY-FILE.                            02332022
023400                                                                  02340007
023411     INITIALIZE EP072-PROMO-INTFC-RECORD.                         02341129
023420                                                                  02342020
023500     PERFORM 1010-GET-CURRENT-SYSTEM-TMST.                        02350025
023510     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         02351046
023600     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       02360046
023610     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       02361046
023620     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         02362046
023800     PERFORM 6100-DATE-ROUTINE.                                   02380007
024200                                                                  02420007
024201*1000-EXIT.                                                       02420118
024202 EJECT.                                                           02420218
026470                                                                  02647007
026480*----------------------------------------------------------       02648007
026490* 1010-GET-CURRENT-SYSTEM-TMST.                                   02649025
026500*     RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE         02650018
026600*     USED WITHIN THE QUERIES TO IDENTIFY WHICH MERCHANDISE       02660018
026610*     EXCLUSIONS NEED TO BE INCLUDED, TMST ALSO WILL BE USED      02661018
026620*     TO UPDATE EPCC114 ON PROGRAM EXIT.                          02662018
026700*----------------------------------------------------------       02670007
026800 1010-GET-CURRENT-SYSTEM-TMST.                                    02680025
026900                                                                  02690007
027000     EXEC SQL                                                     02700018
027100       SET :PV-CURRENT-SYSTEM-TMST = CURRENT TIMESTAMP            02710018
027200     END-EXEC.                                                    02720018
027300                                                                  02730018
027310     IF SQLCODE NOT EQUAL ZERO                                    02731018
027360       MOVE 'GET CURRENT TIMESTAMP' TO PV-DB2-OPERATION           02736069
027370       MOVE '1010-GET-CURRENT-SYSTEM-TMST'                        02737069
027371                                    TO PV-PARAGRAPH-NAME          02737169
027372       PERFORM 9900-SQL-ABEND-ROUTINE                             02737269
027390     END-IF.                                                      02739018
027391                                                                  02739118
027500*1010-EXIT.                                                       02750018
027600 EJECT.                                                           02760007
027700                                                                  02770007
027710*----------------------------------------------------------       02771018
027720* 1020-READ-PGM-LAST-RUN-CARD.                                    02772046
027730*     READ CONTROL CARD EPCC114. THIS CONTROL CARD CONTAINS       02773018
027740*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT121                 02774018
027750*----------------------------------------------------------       02775018
027760 1020-READ-PGM-LAST-RUN-CARD.                                     02776046
027770                                                                  02777018
027781     READ CONTROL-CARD-PGM-LAST-RUN-DTE                           02778146
027782                                INTO EP114-CC-CONTROL-CARD        02778266
027783       AT END                                                     02778349
027784          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02778449
027785                                                                  02778549
027786     IF PS-END-OF-CNTL-CRD-FILE                                   02778649
027789       DISPLAY ' '                                                02778961
027790       DISPLAY '** ABEND     **'                                  02779061
027791       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02779161
027792       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   02779261
027793       DISPLAY '** CONTROL FILE IS EMPTY  '                       02779361
027794       DISPLAY ' '                                                02779461
027795       MOVE +4002 TO ABEND-CODE                                   02779561
027796       CALL 'ILBOABN0' USING ABEND-CODE                           02779661
027797     ELSE                                                         02779761
027799       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             02779963
027800       DISPLAY '** EPCC114   *  = ' EP114-CC-EXC-CUTOFF-TMST      02780066
027803       DISPLAY ' '                                                02780361
027804     END-IF.                                                      02780449
027812                                                                  02781218
027813*1020-EXIT.                                                       02781318
027814 EJECT.                                                           02781418
027815                                                                  02781518
027820*----------------------------------------------------------       02782007
027900* 1030-READ-CURR-PRICG-DTE-CARD.                                  02790046
028000*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       02800016
028100*     THE CURRENT PRICING DATE.                                   02810016
028200*----------------------------------------------------------       02820007
028210 1030-READ-CURR-PRICG-DTE-CARD.                                   02821046
028220                                                                  02822007
028230     READ CONTROL-CARD-CURR-PRICG-DTE                             02823046
028231                               INTO EP111-CC-CONTROL-CARD         02823151
028232       AT END                                                     02823251
028233          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02823351
028234                                                                  02823451
028235     IF PS-END-OF-CNTL-CRD-FILE                                   02823551
028236       DISPLAY ' '                                                02823651
028237       DISPLAY '** ABEND     **'                                  02823751
028238       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02823851
028239       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 02823951
028240       DISPLAY '** CONTROL FILE IS EMPTY  '                       02824051
028241       DISPLAY ' '                                                02824151
028242       MOVE +4002 TO ABEND-CODE                                   02824251
028243       CALL 'ILBOABN0' USING ABEND-CODE                           02824351
028244     ELSE                                                         02824461
028245       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         02824563
028246       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        02824662
028247       DISPLAY ' '                                                02824761
028248     END-IF.                                                      02824851
028249                                                                  02824951
028250                                                                  02825007
028251*1030-EXIT.                                                       02825118
028260 EJECT.                                                           02826007
028270                                                                  02827007
028280*----------------------------------------------------------       02828007
028290* 1040-READ-FUTRE-CORR-DTE-CARD.                                  02829046
028300*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       02830016
028301*     THE NEXT FUTURE CORRECTIONS DATE                            02830116
028302*----------------------------------------------------------       02830207
028303 1040-READ-FUTRE-CORR-DTE-CARD.                                   02830346
028304                                                                  02830407
028305     READ CONTROL-CARD-FUTRE-CORR-DTE                             02830546
028306                               INTO EP113-CC-CONTROL-CARD         02830651
028307       AT END                                                     02830751
028308          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02830851
028309                                                                  02830951
028310     IF PS-END-OF-CNTL-CRD-FILE                                   02831051
028311       DISPLAY ' '                                                02831151
028312       DISPLAY '** ABEND     **'                                  02831251
028313       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02831351
028314       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 02831451
028315       DISPLAY '** CONTROL FILE IS EMPTY  '                       02831551
028316       DISPLAY ' '                                                02831651
028317       MOVE +4002 TO ABEND-CODE                                   02831751
028318       CALL 'ILBOABN0' USING ABEND-CODE                           02831851
028319     ELSE                                                         02831961
028320       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       02832063
028321       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        02832161
028322       DISPLAY ' '                                                02832261
028323     END-IF.                                                      02832351
028324                                                                  02832446
028325*1040-EXIT.                                                       02832546
028326 EJECT.                                                           02832646
028327                                                                  02832746
028328*----------------------------------------------------------       02832846
028329* 1050-READ-CRIT-EFF-DTE-CARD.                                    02832946
028330*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       02833046
028331*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    02833146
028332*     ARE EMERGENCY OR NIGHTLY.                                   02833246
028333*----------------------------------------------------------       02833346
028334 1050-READ-CRIT-EFF-DTE-CARD.                                     02833446
028335                                                                  02833546
028336     READ CONTROL-CARD-CRIT-EFF-DTE                               02833646
028337                               INTO EP128-CC-CONTROL-CARD         02833751
028338       AT END                                                     02833851
028339          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02833951
028340                                                                  02834051
028341     IF PS-END-OF-CNTL-CRD-FILE                                   02834151
028342       DISPLAY ' '                                                02834251
028343       DISPLAY '** ABEND     **'                                  02834351
028344       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02834451
028345       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   02834551
028346       DISPLAY '** CONTROL FILE IS EMPTY  '                       02834651
028347       DISPLAY ' '                                                02834751
028348       MOVE +4002 TO ABEND-CODE                                   02834851
028349       CALL 'ILBOABN0' USING ABEND-CODE                           02834951
028350     ELSE                                                         02835061
028351       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      02835163
028352       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    02835262
028353       DISPLAY ' '                                                02835361
028354     END-IF.                                                      02835451
028355                                                                  02835546
028356*1050-EXIT.                                                       02835646
028357 EJECT.                                                           02835746
028358                                                                  02835818
028359*----------------------------------------------------------       02835918
028360* 2000-PROCESS-MERCH-EXCLUSIONS                                   02836018
028361*     MAIN PROCESSING AREA - EXECUTES RMS AND ADHOC QUERY         02836118
028362*     TO IDENTIFY MERCHANDISE EXCLUSIONS AND CREATES OUTPUT       02836218
028363*     FILES TO IDENTIFY WHICH STROE GROUP/PROMO INTERFACE I.D     02836318
028364*     COMBO'S NEED RECORDS CREATED FOR THE STORE SERVER.          02836418
028365*----------------------------------------------------------       02836518
028366 2000-PROCESS-MERCH-EXCLUSIONS.                                   02836618
028367                                                                  02836718
028368     PERFORM 2100-PROCESS-RMS-CURSOR.                             02836822
028369                                                                  02836918
028370     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           02837070
028371                                                                  02837118
028372*2000-EXIT.                                                       02837218
028373 EJECT.                                                           02837318
028374                                                                  02837418
028375*----------------------------------------------------------       02837516
028376* 2100-PROCESS-RMS-CURSOR.                                        02837618
028377*     READ THE RECORD FROM THE MERCHANDISE EXCLUSION TABLE AND    02837716
028378*     CREATE PROMO AND PMAP RECORDS BASED ON THE RECORD READ.     02837816
028379*----------------------------------------------------------       02837916
028380 2100-PROCESS-RMS-CURSOR.                                         02838018
                                                                        02838178
028381     PERFORM 2110-OPEN-MDSE-EXCL-RMS.                             02838270
028382     PERFORM 2120-FETCH-MDSE-EXCL-RMS                             02838371
028383       UNTIL PS-MDSE-EXCL-CSR-EOF.                                02838451
028384     PERFORM 2130-CLOSE-MDSE-EXCL-RMS.                            02838570
028390                                                                  02839007
028400*2100-EXIT.                                                       02840070
028500 EJECT.                                                           02850007
028510                                                                  02851018
030000*----------------------------------------------------------       03000007
030100* 2110-OPEN-MDSE-EXCL-RMS.                                        03010070
030200*     OPEN THE MERCHANDISE EXCLUSION CURSOR (RMS).                03020016
030300*----------------------------------------------------------       03030007
030400 2110-OPEN-MDSE-EXCL-RMS.                                         03040070
030500                                                                  03050007
030600     PERFORM                                                      03060007
030700         WITH TEST AFTER                                          03070007
030800         VARYING PV-SQL-SUB                                       03080007
030900         FROM 1 BY 1                                              03090007
031000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03100007
031100                   OR  SQLCODE = 0)                               03110007
031200                                                                  03120007
031300         EXEC SQL                                                 03130007
031400           OPEN MDSE-EXCL-RMS                                     03140077
031500         END-EXEC                                                 03150007
031600                                                                  03160007
031700         EVALUATE TRUE                                            03170007
031800           WHEN SQLCODE = -904                                    03180070
031900           WHEN SQLCODE = -911                                    03190070
032000           WHEN SQLCODE = -913                                    03200070
032100             CONTINUE                                             03210070
032200           WHEN SQLCODE = 0                                       03220070
032400             SET PS-MDSE-EXCL-CSR-NOT-EOF TO TRUE                 03240070
032500           WHEN SQLWARN0 NOT EQUAL SPACE                          03250070
032600           WHEN SQLCODE NOT EQUAL ZERO                            03260070
032700             MOVE '2110-OPEN-MDSE-EXCL-RMS'                       03270070
032800                                TO PV-PARAGRAPH-NAME              03280070
032900             MOVE 'ERROR ON OPEN OF MDSE EXCL RMS CURSOR'         03290070
033000                                TO PV-DB2-OPERATION               03300070
033100             PERFORM 9900-SQL-ABEND-ROUTINE                       03310070
033200         END-EVALUATE                                             03320070
033300     END-PERFORM.                                                 03330007
033400                                                                  03340007
033500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03350007
033600       MOVE '2110-OPEN-MDSE-EXCL-RMS'                             03360070
033700                            TO  PV-PARAGRAPH-NAME                 03370070
033800       MOVE 'OPEN RETRIES EXCEEDED'                               03380070
033900                             TO  PV-DB2-OPERATION                 03390070
034000       PERFORM 9900-SQL-ABEND-ROUTINE                             03400070
034100     END-IF.                                                      03410007
034200                                                                  03420007
034300*2110-EXIT.                                                       03430018
034400 EJECT.                                                           03440007
034500                                                                  03450007
034600*----------------------------------------------------------       03460007
034700* 2120-FETCH-MDSE-EXCL-RMS.                                       03470070
034800*     FETCH THE MERCHANDISE EXCLUSION CURSOR. (RMS)               03480016
034900*----------------------------------------------------------       03490007
035000 2120-FETCH-MDSE-EXCL-RMS.                                        03500070
035100                                                                  03510007
035200     PERFORM                                                      03520007
035300         WITH TEST AFTER                                          03530007
035400         VARYING PV-SQL-SUB                                       03540007
035500         FROM 1 BY 1                                              03550007
035600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03560007
035700                   OR  SQLCODE = 0                                03570007
035800                   OR  SQLCODE = +100)                            03580007
035900                                                                  03590007
036000         EXEC SQL                                                 03600077
036100           FETCH MDSE-EXCL-RMS                                    03610077
036200           INTO  :XST00034-EXCL-MDSE-ID                           03620077
036500                ,:XST00034-PROMO-INTFC-SUB-ID                     03620177
036300                ,:XST00034-STAT-CDE                               03620277
036200                ,:XST00034-LAST-UPD-TMST                          03621077
036400                ,:XST00034-SOR-LAST-UPD-TMST                      03640077
036500                ,:XST00029-PROMO-INTFC-ID                         03650077
036501                ,:XST00029-MDSE-LNE-ID                            03650177
036510                ,:XST00029-STR-GP-TYP-CDE                         03651077
036600                ,:XST00029-STR-GP-ID                              03660077
036700                ,:XST00029-STR-SELN-HIER-CDE                      03670077
036710                ,:XST00029-ACTL-STRT-TMST                         03671077
036800                ,:XST00029-ACTL-END-TMST                          03680077
037000                ,:XST00028-PRICG-TYP-CDE                          03700077
037100         END-EXEC                                                 03710077
037200                                                                  03720007
037300         EVALUATE TRUE                                            03730077
037400           WHEN SQLCODE = -904                                    03740077
037500           WHEN SQLCODE = -911                                    03750077
037600           WHEN SQLCODE = -913                                    03760077
037700             CONTINUE                                             03770077
037800           WHEN SQLCODE = ZERO                                    03780077
038000             PERFORM 3000-FORMAT-RMS-OUTPUT                       03800077
038010             ADD 1 TO PC-CNT-RMS-RECS                             03801077
038100           WHEN SQLCODE = +100                                    03810077
038200             SET PS-MDSE-EXCL-CSR-EOF TO TRUE                     03820077
038300           WHEN SQLWARN0 NOT EQUAL SPACE                          03830077
038400           WHEN SQLCODE NOT EQUAL ZERO                            03840077
038500             MOVE '2120-FETCH-MDSE-EXCL-RMS'                      03850077
038600                                 TO PV-PARAGRAPH-NAME             03860077
038700             MOVE 'ERROR ON FETCHING MDSE RMS CSR'                03870077
038800                                 TO PV-DB2-OPERATION              03880077
038900             PERFORM 9900-SQL-ABEND-ROUTINE                       03890077
039000         END-EVALUATE                                             03900077
039100     END-PERFORM.                                                 03910007
039200                                                                  03920007
039300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03930078
039400       MOVE '2120-FETCH-MDSE-EXCL-RMS'                            03940070
039500                             TO  PV-PARAGRAPH-NAME                03950070
039600       MOVE 'FETCH RETRIES EXCEEDED'                              03960070
039700                             TO  PV-DB2-OPERATION                 03970070
039800       PERFORM 9900-SQL-ABEND-ROUTINE                             03980070
039900     END-IF.                                                      03990007
040000                                                                  04000007
040100*2120-EXIT.                                                       04010018
040200 EJECT.                                                           04020007
040300                                                                  04030007
040400*-----------------------------------------------------------      04040007
040500* 2130-CLOSE-MDSE-EXCL-RMS.                                       04050070
040600*                                                                 04060007
040700*-----------------------------------------------------------      04070007
040800 2130-CLOSE-MDSE-EXCL-RMS.                                        04080070
041000                                                                  04100007
041100     PERFORM                                                      04110007
041200         WITH TEST AFTER                                          04120007
041300         VARYING PV-SQL-SUB                                       04130007
041400         FROM 1 BY 1                                              04140007
041500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04150007
041600                   OR  SQLCODE = 0)                               04160007
041700                                                                  04170007
041800         EXEC SQL                                                 04180077
041900           CLOSE MDSE-EXCL-RMS                                    04190077
042000         END-EXEC                                                 04200077
042100                                                                  04210007
042200         EVALUATE TRUE                                            04220077
042300           WHEN SQLCODE = -904                                    04230077
042400           WHEN SQLCODE = -911                                    04240077
042500           WHEN SQLCODE = -913                                    04250077
042600           WHEN SQLCODE = 0                                       04260077
042700             CONTINUE                                             04270077
042800           WHEN SQLWARN0 NOT EQUAL SPACE                          04280077
042900           WHEN SQLCODE NOT EQUAL ZERO                            04290077
043000             MOVE '2130-CLOSE-MDSE-EXCL-RMS'                      04300077
043100                                  TO PV-PARAGRAPH-NAME            04310075
043200             MOVE 'ERROR ON CLOSE OF MDSE EXCL RMS CURSOR'        04320077
043300                                   TO PV-DB2-OPERATION            04330070
043400             PERFORM 9900-SQL-ABEND-ROUTINE                       04340077
043500         END-EVALUATE                                             04350077
043600     END-PERFORM.                                                 04360007
043700                                                                  04370007
043800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04380007
043900       MOVE '2130-CLOSE-MDSE-EXCL-RMS'                            04390077
044000                               TO  PV-PARAGRAPH-NAME              04400007
044100       MOVE 'CLOSE RETRIES EXCEEDED'                              04410077
044200                               TO  PV-DB2-OPERATION               04420007
044300       PERFORM 9900-SQL-ABEND-ROUTINE                             04430077
044400     END-IF.                                                      04440007
044500                                                                  04450007
044600*2130-EXIT.                                                       04460018
044700 EJECT.                                                           04470007
044800                                                                  04480007
044810*----------------------------------------------------------       04481018
044820* 2200-PROCESS-ADHOC-CURSOR.                                      04482070
044830*     READ THE RECORD FROM THE MERCHANDISE EXCLUSION FILE AND     04483018
044840*     CREATE PROMO AND PMAP RECORDS BASED ON THE RECORD READ.     04484018
044850*----------------------------------------------------------       04485018
044860 2200-PROCESS-ADHOC-CURSOR.                                       04486070
                                                                        04486178
044870     PERFORM 2210-OPEN-ADHOC-CURSOR.                              04487070
044880     PERFORM 2220-FETCH-ADHOC-CURSOR                              04488070
044890       UNTIL PS-MDSE-EXCL-ADHOC-CSR-EOF.                          04489070
044891     PERFORM 2230-CLOSE-ADHOC-CURSOR.                             04489170
044892                                                                  04489218
044893*2200-EXIT.                                                       04489318
044894 EJECT.                                                           04489418
044895                                                                  04489518
044900*----------------------------------------------------------       04490007
045000* 2210-OPEN-ADHOC-CURSOR.                                         04500070
045100*     OPEN THE BWP BUY PROMO AND PMAP CURSOR.                     04510007
045200*----------------------------------------------------------       04520007
045300 2210-OPEN-ADHOC-CURSOR.                                          04530070
045400                                                                  04540007
045500     PERFORM                                                      04550007
045600         WITH TEST AFTER                                          04560007
045700         VARYING PV-SQL-SUB                                       04570007
045800         FROM 1 BY 1                                              04580007
045900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04590007
046000                   OR  SQLCODE = 0)                               04600007
046100                                                                  04610007
046200         EXEC SQL                                                 04620077
046300           OPEN MDSE-EXCL-ADHOC                                   04630077
046400         END-EXEC                                                 04640077
046600                                                                  04660007
046700         EVALUATE TRUE                                            04670007
046800           WHEN SQLCODE = -904                                    04680075
046900           WHEN SQLCODE = -911                                    04690075
047000           WHEN SQLCODE = -913                                    04700075
047100             CONTINUE                                             04710075
047200           WHEN SQLCODE = 0                                       04720075
047400             SET PS-MDSE-EXCL-ADHOC-CSR-NOT-EOF TO TRUE           04740075
047500           WHEN SQLWARN0 NOT EQUAL SPACE                          04750075
047600           WHEN SQLCODE NOT EQUAL ZERO                            04760075
047700             MOVE '2210-OPEN-ADHOC-CURSOR'                        04770075
047800                                  TO PV-PARAGRAPH-NAME            04780070
047900             MOVE 'ERROR ON OPEN OF MDSE ADHOC CURSOR'            04790075
048000                                  TO PV-DB2-OPERATION             04800070
048100             PERFORM 9900-SQL-ABEND-ROUTINE                       04810075
048200         END-EVALUATE                                             04820007
048300     END-PERFORM.                                                 04830007
048400                                                                  04840007
048500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04850007
048600       MOVE '2210-OPEN-ADHOC-CURSOR'                              04860070
048700                            TO  PV-PARAGRAPH-NAME                 04870070
048800       MOVE 'OPEN RETRIES EXCEEDED'                               04880070
048900                             TO  PV-DB2-OPERATION                 04890070
049000       PERFORM 9900-SQL-ABEND-ROUTINE                             04900070
049100     END-IF.                                                      04910007
049200                                                                  04920007
049300*2210-EXIT.                                                       04930018
049400 EJECT.                                                           04940007
049500                                                                  04950007
049600*----------------------------------------------------------       04960007
049700* 2220-FETCH-ADHOC-CURSOR.                                        04970070
049800*     FETCH THE BWP BUY PROMO AND PMAP CURSOR.                    04980007
049900*----------------------------------------------------------       04990007
050000 2220-FETCH-ADHOC-CURSOR.                                         05000070
050100                                                                  05010007
050200     PERFORM                                                      05020007
050300         WITH TEST AFTER                                          05030007
050400         VARYING PV-SQL-SUB                                       05040007
050500         FROM 1 BY 1                                              05050007
050600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05060007
050700                   OR  SQLCODE = 0                                05070007
050800                   OR  SQLCODE = +100)                            05080007
050900                                                                  05090007
051000         EXEC SQL                                                 05100077
051100           FETCH MDSE-EXCL-ADHOC                                  05110077
051110           INTO  :XST00034-EXCL-MDSE-ID                           05111077
051140                ,:XST00034-PROMO-INTFC-SUB-ID                     05111177
051120                ,:XST00034-STAT-CDE                               05111277
051110                ,:XST00034-LAST-UPD-TMST                          05111377
051130                ,:XST00034-SOR-LAST-UPD-TMST                      05113077
051140                ,:XST00031-PROMO-INTFC-ID                         05114077
051150                ,:XST00031-MDSE-LNE-ID                            05115077
051170                ,:XST00031-ADHC-STR-GP-ID                         05117077
051180                ,:XST00031-STR-SELN-HIER-CDE                      05118077
051190                ,:XST00031-ACTL-STRT-TMST                         05119077
051191                ,:XST00031-ACTL-END-TMST                          05119177
051192                 ,:XST00028-PRICG-TYP-CDE                         05119277
051840         END-EXEC                                                 05184077
051850                                                                  05185007
051860         EVALUATE TRUE                                            05186477
051861           WHEN SQLCODE = -904                                    05186577
051862           WHEN SQLCODE = -911                                    05186677
051863           WHEN SQLCODE = -913                                    05186777
051864             CONTINUE                                             05186877
051865           WHEN SQLCODE = ZERO                                    05186977
051867             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     05187077
051868             ADD 1 TO PC-CNT-ADHOC-RECS                           05187177
051869           WHEN SQLCODE = +100                                    05187277
051870             SET PS-MDSE-EXCL-ADHOC-CSR-EOF TO TRUE               05187377
051880           WHEN SQLWARN0 NOT EQUAL SPACE                          05188077
051881           WHEN SQLCODE NOT EQUAL ZERO                            05188177
051882             MOVE '2220-FETCH-ADHOC-CURSOR'                       05188277
051883                                TO PV-PARAGRAPH-NAME              05188377
051884             MOVE 'ERROR ON FETCHING MDSE ADHOC CURSOR'           05188477
051885                                 TO PV-DB2-OPERATION              05188577
051886             DISPLAY 'SQLCODE= ' SQLCODE                          05188677
051887             PERFORM 9900-SQL-ABEND-ROUTINE                       05188777
051888         END-EVALUATE                                             05188877
051889     END-PERFORM.                                                 05188907
051890                                                                  05189007
051891     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05189177
051892       MOVE '2220-FETCH-ADHOC-CURSOR'                             05189275
051893                               TO  PV-PARAGRAPH-NAME              05189307
051894       MOVE 'FETCH RETRIES EXCEEDED'                              05189475
051895                               TO  PV-DB2-OPERATION               05189507
051896       PERFORM 9900-SQL-ABEND-ROUTINE                             05189675
051897     END-IF.                                                      05189707
051898                                                                  05189807
051899*2220-EXIT.                                                       05189918
051900 EJECT.                                                           05190007
051901                                                                  05190107
051902*-----------------------------------------------------------      05190207
051903* 2230-CLOSE-ADHOC-CURSOR.                                        05190370
051904*     CLOSE THE BWP BUY PROMO AND PMAP CURSOR.                    05190407
051905*-----------------------------------------------------------      05190507
051906 2230-CLOSE-ADHOC-CURSOR.                                         05190670
051907                                                                  05190707
051908     PERFORM                                                      05190807
051909         WITH TEST AFTER                                          05190907
051910         VARYING PV-SQL-SUB                                       05191007
051911         FROM 1 BY 1                                              05191107
051912         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05191207
051913                   OR  SQLCODE = 0)                               05191307
051914                                                                  05191407
051915         EXEC SQL                                                 05191577
051916           CLOSE MDSE-EXCL-ADHOC                                  05191677
051917         END-EXEC                                                 05191777
051918                                                                  05191807
051919         EVALUATE TRUE                                            05191977
051920           WHEN SQLCODE = -904                                    05192077
051921           WHEN SQLCODE = -911                                    05192177
051922           WHEN SQLCODE = -913                                    05192277
051923           WHEN SQLCODE = 0                                       05192377
051924             CONTINUE                                             05192477
051925           WHEN SQLWARN0 NOT EQUAL SPACE                          05192577
051926           WHEN SQLCODE NOT EQUAL ZERO                            05192677
051927             MOVE '2230-CLOSE-ADHOC-CURSOR'                       05192777
051928                                   TO PV-PARAGRAPH-NAME           05192870
051929             MOVE 'ERROR ON CLOSE OF MDSE ADHOC CURSOR'           05192977
051930                                   TO PV-DB2-OPERATION            05193070
051931             PERFORM 9900-SQL-ABEND-ROUTINE                       05193177
051932         END-EVALUATE                                             05193277
051933     END-PERFORM.                                                 05193307
051934                                                                  05193407
051935     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05193507
051936       MOVE '2230-CLOSE-ADHOC-CURSOR'                             05193670
051937                               TO  PV-PARAGRAPH-NAME              05193707
051938       MOVE 'CLOSE RETRIES EXCEEDED'                              05193870
051939                               TO  PV-DB2-OPERATION               05193907
051940       PERFORM 9900-SQL-ABEND-ROUTINE                             05194070
051941     END-IF.                                                      05194107
051942                                                                  05194207
051943*2230-EXIT.                                                       05194318
051944 EJECT.                                                           05194407
051945                                                                  05194522
051946*-----------------------------------------------------------      05194607
051947* 3000-FORMAT-RMS-OUTPUT.                                         05194729
051948*     POPULATE COPYBOOK EPRD072.                                  05194807
051949*-----------------------------------------------------------      05194907
051960 3000-FORMAT-RMS-OUTPUT.                                          05196029
051961                                                                  05196121
051963     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05196335
051964     MOVE PC-BUSINESS-EVENT-ID                                    05196436
051965                             TO EP072-BUSINESS-EVENT-ID.          05196521
051966     MOVE PC-RMS-PRC-SETUP-IND                                    05196621
051967                             TO EP072-PRC-SETUP-IND.              05196721
051968     MOVE XST00029-STR-GP-TYP-CDE                                 05196821
051969                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05196921
051970     MOVE XST00029-STR-GP-ID                                      05197021
051971                             TO EP072-SETUP-STR-GRP-ID.           05197121
051972     MOVE XST00029-STR-SELN-HIER-CDE                              05197221
051973                             TO EP072-STR-SELN-HIER-CDE.          05197321
051974     MOVE XST00029-STR-GP-TYP-CDE                                 05197421
051975                             TO EP072-DIST-STR-GRP-TYP-CDE.       05197521
051976     MOVE XST00029-STR-GP-ID                                      05197621
051977                             TO EP072-DIST-STR-GRP-ID.            05197721
051978     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05197821
051979                                                                  05197921
051980     MOVE XST00029-ACTL-STRT-TMST                                 05198038
051981                             TO PV-ACTL-STRT-TMST.                05198138
051984                                                                  05198438
051985     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05198538
051986       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05198672
051987         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05198772
051988     ELSE                                                         05198838
051989       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05198938
051990         MOVE PC-APPLY-CORRECTION                                 05199072
051991                                  TO EP072-APPLY-IND              05199138
051992       END-IF                                                     05199238
051993     END-IF.                                                      05199338
051994                                                                  05199438
051995     MOVE XST00034-STAT-CDE  TO PC-MDSE-EXCL-STAT-CDE             05199538
051996                                                                  05199638
051997     IF PC-SCHEDULED-STATUS                                       05199738
051998       MOVE PC-ADD-STAT-CDE                                       05199838
051999                              TO EP072-RECORD-ACTION              05199972
052000     ELSE                                                         05200038
052001       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    05200172
052002         MOVE PC-DELETE-STAT-CDE                                  05200272
052003                              TO EP072-RECORD-ACTION              05200372
             END-IF                                                     05200472
           END-IF.                                                      05200570
052004                                                                  05200638
052005     MOVE XST00029-PROMO-INTFC-ID                                 05200738
052006                             TO EP072-PROMO-INTFC-ID.             05200838
052005     MOVE XST00034-PROMO-INTFC-SUB-ID                             05200970
052006                             TO EP072-PROMO-INTFC-SUB-ID.         05201070
052007     MOVE XST00029-MDSE-LNE-ID                                    05201170
052008                             TO EP072-MERCH-LNE-ID.               05201270
052007     MOVE XST00034-EXCL-MDSE-ID                                   05201370
052008                             TO EP072-EXCL-MDSE-ID.               05201470
052009     MOVE XST00028-PRICG-TYP-CDE                                  05201570
052010                             TO EP072-PRICG-TYP-CDE.              05201670
052011     MOVE PC-MDSE-EXCL-IND                                        05201770
052012                             TO EP072-MDSE-INC-EXC-IND.           05201870
052013     MOVE XST00029-ACTL-STRT-TMST                                 05201970
052014                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05202070
052015     MOVE XST00029-ACTL-END-TMST                                  05202170
052016                             TO EP072-STR-GRP-PROMO-END-TMST.     05202270
052017     MOVE XST00034-SOR-LAST-UPD-TMST                              05202370
052018                             TO EP072-SOR-LAST-UPD-TMST.          05202470
052019                                                                  05202570
052020     IF EP072-APPLY-NIGHTLY                                       05202670
052021       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05202770
052022     ELSE                                                         05202870
052024       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05202979
052303       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05203079
052023       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05203170
052025     END-IF.                                                      05203270
052026                                                                  05203370
052027*3000-EXIT.                                                       05203470
052028 EJECT.                                                           05203570
052029*-----------------------------------------------------------      05203670
052030* 3100-FORMAT-ADHOC-OUTPUT.                                       05203770
052040*     POPULATE COPYBOOK EPRD072.                                  05204038
052100*-----------------------------------------------------------      05210007
052200 3100-FORMAT-ADHOC-OUTPUT.                                        05220029
052201                                                                  05220122
052202     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05220235
052210     MOVE PC-BUSINESS-EVENT-ID                                    05221022
052220                             TO EP072-BUSINESS-EVENT-ID.          05222022
052230     MOVE PC-ADHOC-PRC-SETUP-IND                                  05223027
052240                             TO EP072-PRC-SETUP-IND.              05224022
052250     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05225022
052260                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05226022
052270     MOVE XST00031-ADHC-STR-GP-ID                                 05227024
052280                             TO EP072-SETUP-STR-GRP-ID.           05228022
052290     MOVE XST00031-STR-SELN-HIER-CDE                              05229022
052291                             TO EP072-STR-SELN-HIER-CDE.          05229122
052292     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05229222
052293                             TO EP072-DIST-STR-GRP-TYP-CDE.       05229322
052294     MOVE XST00031-ADHC-STR-GP-ID                                 05229424
052295                             TO EP072-DIST-STR-GRP-ID.            05229522
052296     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05229622
052297                                                                  05229722
052298     MOVE XST00031-ACTL-STRT-TMST                                 05229838
052299                             TO PV-ACTL-STRT-TMST.                05229938
052300                                                                  05230038
052301     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05230138
052302       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05230272
052303         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05230372
052304     ELSE                                                         05230422
052305       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05230538
052306         MOVE PC-APPLY-CORRECTION                                 05230672
052307                                 TO EP072-APPLY-IND               05230772
052308       END-IF                                                     05230822
052309     END-IF.                                                      05230922
052310                                                                  05231022
052311     MOVE XST00034-STAT-CDE  TO PC-MDSE-EXCL-STAT-CDE             05231124
052312                                                                  05231222
052313     IF PC-SCHEDULED-STATUS                                       05231322
052314       MOVE PC-ADD-STAT-CDE                                       05231422
052315                             TO EP072-RECORD-ACTION               05231522
052316     ELSE                                                         05231622
052317       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    05231772
052318         MOVE PC-DELETE-STAT-CDE                                  05231872
052319                             TO EP072-RECORD-ACTION               05231970
             END-IF                                                     05232072
           END-IF.                                                      05232170
052320                                                                  05232222
052321     MOVE XST00031-PROMO-INTFC-ID                                 05232322
052322                             TO EP072-PROMO-INTFC-ID.             05232422
052005     MOVE XST00034-PROMO-INTFC-SUB-ID                             05232570
052006                             TO EP072-PROMO-INTFC-SUB-ID.         05232670
052323     MOVE XST00031-MDSE-LNE-ID                                    05232722
052324                             TO EP072-MERCH-LNE-ID.               05232822
052007     MOVE XST00034-EXCL-MDSE-ID                                   05232970
052008                             TO EP072-EXCL-MDSE-ID.               05233070
052325     MOVE XST00028-PRICG-TYP-CDE                                  05233122
052326                             TO EP072-PRICG-TYP-CDE.              05233222
052327     MOVE PC-MDSE-EXCL-IND                                        05233324
052328                             TO EP072-MDSE-INC-EXC-IND.           05233422
052329     MOVE XST00031-ACTL-STRT-TMST                                 05233580
052330                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05233668
052333     MOVE XST00031-ACTL-END-TMST                                  05233780
052334                             TO EP072-STR-GRP-PROMO-END-TMST.     05233864
052335     MOVE XST00034-SOR-LAST-UPD-TMST                              05233964
052336                             TO EP072-SOR-LAST-UPD-TMST.          05234064
052337                                                                  05234164
052339     IF EP072-APPLY-NIGHTLY                                       05234222
052340       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05234329
052341     ELSE                                                         05234422
052343       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05234579
052303       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05234679
052023       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05234779
052344     END-IF.                                                      05235022
052350                                                                  05236022
052659*3100-EXIT.                                                       05265929
052660 EJECT.                                                           05266017
052670                                                                  05267029
052786*----------------------------------------------------------       05278607
052787* 4000-WRITE-NIGHT-APPLY-RECORD.                                  05278729
052788*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05278807
052789*----------------------------------------------------------       05278907
052790 4000-WRITE-NIGHT-APPLY-RECORD.                                   05279029
052791                                                                  05279107
052792     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      05279222
052793                                                                  05279322
052794     ADD 1           TO PC-CNT-NIGHT-RECS                         05279425
052795                        PC-CNT-ALL-RECS.                          05279525
052797                                                                  05279722
052798*4000-EXIT.                                                       05279829
052799 EJECT.                                                           05279907
052800                                                                  05280007
052801*----------------------------------------------------------       05280122
052802* 4100-WRITE-EMERG-APPLY-RECORD.                                  05280229
052803*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05280322
052810*----------------------------------------------------------       05281022
052900 4100-WRITE-EMERG-APPLY-RECORD.                                   05290029
053000                                                                  05300022
053100     WRITE PROMO-EMERGENCY-RECORD FROM EP072-PROMO-INTFC-RECORD.  05310022
053101                                                                  05310122
053110     ADD 1           TO PC-CNT-EMERG-RECS                         05311025
053120                        PC-CNT-ALL-RECS.                          05312025
053200                                                                  05320069
053210*4100-EXIT.                                                       05321029
053220 EJECT.                                                           05322022
053230                                                                  05323022
053231*----------------------------------------------------------       05323170
053232* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      05323270
053233* CCYYMMDD FORMAT.                                                05323370
053234*----------------------------------------------------------       05323470
053235 6100-DATE-ROUTINE.                                               05323529
053236                                                                  05323629
053237     INITIALIZE DPG51 DPG52 DPG53                                 05323729
053238                DPG54 DPG55 DPG56.                                05323829
053239                                                                  05323929
053240     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05324029
053241     SET DPG51-INCREMENT-DATE       TO TRUE.                      05324129
053242     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05324229
053243     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05324329
053244     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05324429
053245                                                                  05324529
053246     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05324629
053247                                             DPG54 DPG55 DPG56.   05324729
053248                                                                  05324829
053249     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05324929
053250       DISPLAY '** ABEND **'                                      05325070
053251       DISPLAY '** PROGRAM = EPKUT121'                            05325170
053252       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05325270
053253       DISPLAY DPG54-ERROR-MESSAGE                                05325370
053254       MOVE 4019 TO PV-ABEND-CODE                                 05325470
053255       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05325570
053256     END-IF.                                                      05325651
053257                                                                  05325729
053258     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      05325829
053259                                                                  05325929
053260     INITIALIZE DPG51 DPG52 DPG53                                 05326029
053261                DPG54 DPG55 DPG56.                                05326129
053262                                                                  05326229
053263     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05326329
053264     SET DPG51-DECREMENT-DATE       TO TRUE.                      05326429
053265     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05326529
053266     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05326629
053267     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05326729
053268                                                                  05326829
053269     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05326929
053270                                             DPG54 DPG55 DPG56.   05327029
053271                                                                  05327129
053272     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05327229
053273       DISPLAY '** ABEND **'                                      05327370
053274       DISPLAY '** PROGRAM = EPKUT121'                            05327470
053275       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05327570
053276       DISPLAY DPG54-ERROR-MESSAGE                                05327670
053277       MOVE 4019 TO PV-ABEND-CODE                                 05327770
053278       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05327870
053279     END-IF.                                                      05327951
053280                                                                  05328029
053281     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  05328129
053282                                                                  05328229
053283*6100-EXIT.                                                       05328329
053284 EJECT.                                                           05328429
053285                                                                  05328529
055400*----------------------------------------------------------       05540007
055500* 9900-SQL-ABEND-ROUTINE.                                         05550007
055600*     SQL ABEND ROUTINE.                                          05560007
055700*----------------------------------------------------------       05570007
055800 9900-SQL-ABEND-ROUTINE.                                          05580007
055900                                                                  05590007
056000     DISPLAY '** ABEND     **'.                                   05600007
056100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05610007
056200     DISPLAY '** PARAGRAPH ** = '                                 05620052
056300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05630007
056400                                                                  05640007
056500     COPY DPPD004.                                                05650007
056600     SET ABEND-4013-DB2-ERROR TO TRUE.                            05660007
056700     CALL 'ILBOABN0' USING ABEND-CODE.                            05670007
056800                                                                  05680007
056900*9900-EXIT.                                                       05690007
057000 EJECT.                                                           05700007
057100                                                                  05710007
057200*----------------------------------------------------------       05720007
057300* 9999-WRAPUP.                                                    05730007
057400*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      05740007
057500*     ANY DATA FROM THE PROGRAM.                                  05750007
057600*----------------------------------------------------------       05760007
057700 9999-WRAPUP.                                                     05770007
057800                                                                  05780007
057900     CLOSE CONTROL-CARD-PGM-LAST-RUN-DTE.                         05790046
057910     OPEN OUTPUT CONTROL-CARD-PGM-LAST-RUN-DTE.                   05791046
057920                                                                  05792022
057930     MOVE PV-CURRENT-SYSTEM-TMST TO EP114-CC-EXC-CUTOFF-TMST.     05793022
057931     WRITE CNTRL-CARD-PGM-LAST-RUN-REC                            05793146
057932                                   FROM EP114-CC-CONTROL-CARD.    05793222
057933                                                                  05793322
057940     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            05794046
058000           CONTROL-CARD-FUTRE-CORR-DTE                            05800046
058100           CONTROL-CARD-PGM-LAST-RUN-DTE                          05810046
058110           CONTROL-CARD-CRIT-EFF-DTE                              05811046
058200           PROMO-NIGHT-FILE                                       05820022
058210           PROMO-EMERGENCY-FILE.                                  05821022
058300                                                                  05830007
058400     DISPLAY ' '.                                                 05840007
058500     DISPLAY '*********************************************'.     05850007
058600     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05860007
058700     DISPLAY '*********************************************'.     05870007
059000     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  05900022
059100     DISPLAY 'NUMBER OF EMERG. RECS WRITTEN: ' PC-CNT-EMERG-RECS. 05910022
059110     DISPLAY 'NUMBER OF RECS FROM RMS QUERY:' PC-CNT-RMS-RECS.    05911032
059120     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.05912032
059300     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                05930007
059400     DISPLAY '*********************************************'.     05940007
059500                                                                  05950007
059600*9999-EXIT.                                                       05960007
059700 EJECT.                                                           05970007
059800                                                                  05980007
