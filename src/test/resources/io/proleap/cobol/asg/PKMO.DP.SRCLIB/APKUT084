000100*------------------------*                                        00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------*                                        00030000
000400 PROGRAM-ID.     APKUT084.                                        00040000
000500 AUTHOR.         KEVIN CATLIN.                                    00050000
000600 DATE-WRITTEN.   SEPTEMBER, 2002.                                 00060000
000700*---------------------------------------------------------------* 00070000
000800*           SELECT IMPORT POS FOR AUTO JOURNALIZATION           * 00080000
000900*---------------------------------------------------------------* 00090000
001000*                      COBOL 2 WITH SQL                         * 00100000
001100*---------------------------------------------------------------* 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DETERMINES WHICH IMPORT POS MEET THE          * 00130000
001400*  CRITERIA TO BE JOURNALIZED.  THE INPUT TO THIS PROCESS IS    * 00140000
001500*  THE SAME DATA THAT IS USED TO PRODUCE THE REPORT WHICH AP    * 00150000
001600*  USES TO MANUALLY DETERMINE WHICH POS TO JOURANLIZE.  WHEN A  * 00160000
001700*  PO MEETS THE CRITERIA, EACH MERCHANDISE INVOICE FOR THAT PO  * 00170000
001800*  WILL HAVE AN INVOICE STATUS UPDATE RECORD WRITTEN TO SET     * 00180000
001900*  THE STATUS 'BM', AND THE REPORTING RECORDS WILL BE REWRITTEN * 00190000
002000*  INDICATING THAT THEY SHOULD NOW GO TO THE AUTO JOURNALIZED   * 00200000
002100*  REPORT INSTEAD FO THE RECEIVING REPORT.                      * 00210000
002200*                                                               * 00220000
002300*---------------------------------------------------------------* 00230000
002400*                                                               * 00240000
002500*  DB2 TABLES:                              DCLGENS:            * 00250000
002600*  1. AP-PAYMENT CONTROL TABLE              (TAPCNTL)           * 00260000
002700*  2. AP-INVOICE TABLE                      (TINVOIC)           * 00270000
002800*  3. PO-PURCHASE TABLE                     (TPURCHS)           * 00280000
002900*  4. MERCHANDISE LEDGER - DATE RECORD      (TDTATTR)           * 00290000
003000*                                                               * 00300000
003100*  INPUT:                                   COPYBOOK:           * 00310000
003200*  1. IMPORT-COST-RPT-IN-FILE.              APRD036             * 00320000
003300*                                                               * 00330000
003400*  OUTPUT:                                  COPYBOOK:           * 00340000
003500*  1. IMPORT-COST-RPT-OUT-FILE.             APRD036             * 00350000
003600*  1. INVOICE-STATUS-UPD-FILE.              APRD252             * 00360000
003700*                                                               * 00370000
003800*---------------------------------------------------------------* 00380000
003900* CHANGE LOG:                                                   * 00390000
004000*   11/04/2002                                                  * 00400000
004100*      INITIAL VERSION.  COLBY DATING PROCESS.                  * 00410000
004200*   MADE BY: KEVIN CATLIN                WR#: 23750             * 00420000
004300*                                                               * 00430000
004400*   10/02/2006                                                  * 00440000
004500*      OPEN AUTO JOUNALIZATION TO ALL IMPORTS WITH ADDED EDITS  * 00450000
004600*   MADE BY: GREG WISIALOWSKI            WR#: 26729             * 00460000
004610*                                                               * 00461000
004620*   03/11/2007                                                  * 00462000
004630*      MBDC PROJECT. RECOMPILE                                  * 00463000
004640*   MADE BY: GREG WISIALOWSKI            WR#: 21578             * 00464000
004650*                                                               * 00465000
004660*   03/30/2007                                                  * 00466000
004670*      MODIFIED D200- TO PROPERLY USE THE OTB-PERIOD WHEN       * 00467000
004680*      THE DRAYAGE AND DECONSOL HAVE NOT BEEN FOUND. THE        * 00468000
004690*      EXISTING CODE WAS SET UP WITH THE HOLD-OTB-PERIOD        * 00469000
004700*      INCORRECTLY COMPARING AS <= TO THE CURRENT OTB-PERIOD.   * 00470000
004710*   MADE BY: MICHELE RINDFLEISCH         PM#: 988746            * 00471000
004711*                                                               * 00471100
004712*   01/08/2009                                                  * 00471200
004713*      MODIFIED S200- TO RETURN IMPORT VENDOR ID                * 00471300
004714*      THIS IS NEEDED FOR THE PROJECT TO BLOCK CREATING COMM    * 00471400
004715*      INVOICES FOR RELATED PARTY                               * 00471500
004717*   MADE BY: GREG WISIALOWSKI            WR#: 34381             * 00471700
004718*                                                               * 00471801
004723*   DATE  03/16/2009                                            * 00472303
004724*     CHANGE MADE: RECOMPILE FOR ADDITION OF DMA-NBR TO         * 00472402
004725*     APRD036.                                                  * 00472502
004726*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31546         * 00472602
004727*                                                               * 00472706
004728*   DATE  03/17/2014                                            * 00472806
004729*     CHANGE MADE: ADDED NEW DUTY FREE COUNTRIES TO THE 88 LEVEL* 00472906
004730*     IN WORKING STORAGE AND ADDED NEW IMPORT PARENT COMPANIES  * 00473006
004731*     TO THE 88 LEVEL IN WORKING STORAGE.                       * 00473106
004732*     MADE BY: NANCY EILBES            WR/IR #: CHG0076793      * 00473206
004733*                                                               * 00473313
004734*   DATE  04/27/2017                                            * 00473413
004735*     CHANGE MADE: MODIFIED LOGIC IN D200-VERIFY-PO-INVC TO     * 00473513
004736*     REMOVE 'OR ENTRY-FEE-FOUND' WHEN CHECKING THAT THE DUTY   * 00473613
004737*     FOUND CONDITION IS MET.  THIS SHOULD HAVE BEEN REMOVED    * 00473713
004738*     AS PART OF THE MPF PROJECT WHEN INVOICING FROM THE        * 00473813
004739*     CUSTOMS BROKER WAS CHANGED TO SEPARATE THE BROKER AND     * 00473913
004740*     DUTY CHARGES ONTO SEPARATE INVOICES.                      * 00474013
004741*     MADE BY: NANCY EILBES            WR/IR #: CHG0167500      * 00474113
004742*---------------------------------------------------------------* 00474213
004743                                                                  00474313
004744*---------------------*                                           00474413
004745 ENVIRONMENT DIVISION.                                            00474513
004746*---------------------*                                           00474613
004747 CONFIGURATION SECTION.                                           00474713
004748 SOURCE-COMPUTER.    IBM-3090.                                    00474813
004749 OBJECT-COMPUTER.    IBM-3090.                                    00474913
004750                                                                  00475013
004751 INPUT-OUTPUT SECTION.                                            00475113
004752 FILE-CONTROL.                                                    00475213
004753                                                                  00475313
004754     SELECT IMPORT-COST-RPT-IN-FILE    ASSIGN TO INP01.           00475413
004760     SELECT IMPORT-COST-RPT-OUT-FILE   ASSIGN TO OUT01.           00476000
004770     SELECT INVOICE-STATUS-UPD-FILE    ASSIGN TO OUT02.           00477000
004780                                                                  00478000
004790*--------------*                                                  00479000
004800 DATA DIVISION.                                                   00480000
004900*--------------*                                                  00490000
005000 FILE SECTION.                                                    00500000
005100                                                                  00510000
005200 FD  IMPORT-COST-RPT-IN-FILE                                      00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     BLOCK CONTAINS 0 RECORDS                                     00550000
005600     DATA RECORD IS IMPORT-COST-RPT-IN-REC.                       00560000
005700 01  IMPORT-COST-RPT-IN-REC      PIC  X(170).                     00570000
005800                                                                  00580000
005900 FD  IMPORT-COST-RPT-OUT-FILE                                     00590000
006000     RECORDING MODE IS F                                          00600000
006100     LABEL RECORDS ARE STANDARD                                   00610000
006200     BLOCK CONTAINS 0 RECORDS                                     00620000
006300     DATA RECORD IS IMPORT-COST-RPT-OUT-REC.                      00630000
006400 01  IMPORT-COST-RPT-OUT-REC     PIC  X(170).                     00640000
006500                                                                  00650000
006600 FD  INVOICE-STATUS-UPD-FILE                                      00660000
006700     RECORDING MODE IS F                                          00670000
006800     LABEL RECORDS ARE STANDARD                                   00680000
006900     BLOCK CONTAINS 0 RECORDS                                     00690000
007000     DATA RECORD IS INVOICE-STATUS-UPD-REC.                       00700000
007100 01  INVOICE-STATUS-UPD-REC      PIC  X(80).                      00710000
007200                                                                  00720000
007300 EJECT                                                            00730000
007400                                                                  00740000
007500 WORKING-STORAGE SECTION.                                         00750000
007600                                                                  00760000
007700 01  FILLER                      PIC  X(27)     VALUE             00770000
007800     '** START OF APKUT084 W/S **'.                               00780000
007900                                                                  00790000
008000 01  PROGRAM-CONSTANTS.                                           00800000
008100     05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'APKUT084'.  00810000
008200     05  PC-COLBY-NBR            PIC  X(09)    VALUE '009206194'. 00820000
008300     05  PC-MAX-RECEIV-VAR       PIC  9(1)V9999 VALUE 0.0200.     00830000
008400     05  PC-MAX-LAND-COST-VAR    PIC  9(1)V9999 VALUE 0.0500.     00840000
008500     05  PC-ALL-COND-MET         PIC  9(02)    VALUE 11.          00850000
008600     05  PC-ARRAY-ENTRY-LIMIT    PIC  9(02)    VALUE 15.          00860000
008601                                                                  00860100
008602 01  PV-PARENT                     PIC X(9)   VALUE SPACES.       00860200
008603     88  PV-PARENT-ENT                        VALUE '000059694',  00860300
008604                                                    '000070509',  00860404
008606                                                    '000116356'.  00860604
008607***  PARENT COMPANIES THAT HAVE NO COMMISSION PAYMENT             00860704
008608***  ROSETTI ASIA LIMITED    59694   000824219                    00860804
008609***  HOMEWORKS ASIA LTD      70509   000978494                    00860904
008610***  GSCM (HK) LIMITED      116356   001070187                    00861004
008611***                                                               00861104
008612                                                                  00861204
008613 01  PV-PROCESS-COUNTERS.                                         00861304
008614     05  PV-RECS-READ-COUNT      PIC  9(08)     VALUE ZEROS.      00861404
008615     05  PV-PO-CSR-COUNT         PIC  9(08)     VALUE ZEROS.      00861504
008616     05  PV-JRNL-IMP-COUNT       PIC  9(08)     VALUE ZEROS.      00861604
008617     05  PV-UNJRNL-IMP-COUNT     PIC  9(08)     VALUE ZEROS.      00861704
008620     05  PV-INVC-UPD-COUNT       PIC  9(08)     VALUE ZEROS.      00862000
008630     05  PV-COND-MET-COUNT       PIC  9(02)     VALUE ZEROS.      00863000
008640     05  PV-ENTRY-CNT            PIC  9(02)     VALUE ZEROS.      00864000
008650                                                                  00865000
008660 01  PROGRAM-SWITCHES.                                            00866000
008670     05  PS-END-FILE-SW             PIC  X(01)   VALUE 'N'.       00867000
008680         88  NOT-END-OF-FILE                     VALUE 'N'.       00868000
008690         88  END-OF-FILE                         VALUE 'Y'.       00869000
008700     05  PS-END-PO-CSR-SW           PIC  X(01)   VALUE 'N'.       00870000
008800         88  MORE-PO-CSR                         VALUE 'N'.       00880000
008900         88  END-OF-PO-CSR                       VALUE 'Y'.       00890000
009000     05  PS-PO-CSR-OPEN-SW          PIC  X(01)   VALUE 'N'.       00900000
009100         88  PO-CSR-CLOSED                       VALUE 'N'.       00910000
009200         88  PO-CSR-OPEN                         VALUE 'Y'.       00920000
009300 01  PO-SWITCHES.                                                 00930000
009400     05  PS-COLBY-PO-SW             PIC  X(01)   VALUE 'N'.       00940000
009500         88  NOT-COLBY-PO                        VALUE 'N'.       00950000
009600         88  COLBY-PO                            VALUE 'Y'.       00960000
009700     05  PS-INVC-BALANCE-SW         PIC  X(01)   VALUE 'N'.       00970000
009800         88  INVC-IN-BALANCE                     VALUE 'N'.       00980000
009900         88  INVC-OUT-OF-BALANCE                 VALUE 'Y'.       00990000
010000     05  PS-FIRST-COST-SW           PIC  X(01)   VALUE 'N'.       01000000
010100         88  NO-FIRST-COST                       VALUE 'N'.       01010000
010200         88  FIRST-COST-FOUND                    VALUE 'Y'.       01020000
010300     05  PS-DUTY-SW                 PIC  X(01)   VALUE 'N'.       01030000
010400         88  NO-DUTY                             VALUE 'N'.       01040000
010500         88  DUTY-FOUND                          VALUE 'Y'.       01050000
010600     05  PS-COMMISSION-SW           PIC  X(01)   VALUE 'N'.       01060000
010700         88  NO-COMMISSION                       VALUE 'N'.       01070000
010800         88  COMMISSION-FOUND                    VALUE 'Y'.       01080000
010900     05  PS-NO-COMMISSION-REQ-SW    PIC  X(01)   VALUE 'N'.       01090000
011000         88  COMMISSION-REQ                      VALUE 'N'.       01100000
011100         88  NO-COMMISSION-REQ                   VALUE 'Y'.       01110000
011200     05  PS-FREIGHT-SW              PIC  X(01)   VALUE 'N'.       01120000
011300         88  NO-FREIGHT                          VALUE 'N'.       01130000
011400         88  FREIGHT-FOUND                       VALUE 'Y'.       01140000
011500     05  PS-DECONSOL-SW             PIC  X(01)   VALUE 'N'.       01150000
011600         88  NO-DECONSOL                         VALUE 'N'.       01160000
011700         88  DECONSOL-FOUND                      VALUE 'Y'.       01170000
011800     05  PS-ENTRY-FEE-SW            PIC  X(01)   VALUE 'N'.       01180000
011900         88  NO-ENTRY-FEE                        VALUE 'N'.       01190000
012000         88  ENTRY-FEE-FOUND                     VALUE 'Y'.       01200000
012100     05  PS-DRAYAGE-SW              PIC  X(01)   VALUE 'N'.       01210000
012200         88  NO-DRAYAGE                          VALUE 'N'.       01220000
012300         88  DRAYAGE-FOUND                       VALUE 'Y'.       01230000
012400     05  PS-OVERSEAS-CONSOL-SW      PIC  X(01)   VALUE 'N'.       01240000
012500         88  NO-OVERSEAS-CONSOL                  VALUE 'N'.       01250000
012600         88  OVERSEAS-CONSOL-FOUND               VALUE 'Y'.       01260000
012700     05  PS-JOURNALIZE-SW           PIC  X(01)   VALUE 'N'.       01270000
012800         88  NO-JOURNALIZE                       VALUE 'N'.       01280000
012900         88  JOURNALIZE-PO                       VALUE 'Y'.       01290000
013000                                                                  01300000
013100 01  PROGRAM-VARIABLES.                                           01310000
013200     05  PV-CURR-OTB-PERIOD      PIC  X(06)     VALUE SPACES.     01320000
013300     05  PV-HOLD-PO-NBR          PIC  X(09)     VALUE SPACES.     01330000
013400     05  PV-HOLD-OTB-PERIOD      PIC  X(06)     VALUE SPACES.     01340000
013500     05  PV-HOLD-INVC-DTE        PIC  X(10)     VALUE SPACES.     01350000
013600     05  PV-HOLD-PO-STATUS       PIC  X(02)     VALUE SPACES.     01360000
013700     05  PV-FISCAL-CUTOFF-DTE    PIC  X(10)     VALUE SPACES.     01370000
013800     05  PV-PROD-CNTRY-CDE       PIC  X(03).                      01380000
013900         88 DUTY-FREE-CNTRY           VALUE 'MP' , 'MU' , 'BH' ,  01390009
014000                       'MX' , 'KE' , 'LS' , 'SZ' , 'IN' , 'ID' ,  01400009
014001                       'TH' , 'SV' , 'GT' , 'HN' , 'NI' , 'DO' ,  01400109
014002                       'CR' , 'HT' , 'EG' , 'JO' , 'PK'.          01400210
014005*      MP  =  NORTHERN MARIANA ISLANDS                            01400505
014006*      MU  =  MAURITIUS (AGOA) - PLU                              01400605
014007*      BH  =  BAHRAIN - BAH                                       01400705
014008*      MX  =  MEXICO (NAFTA) - CJS, LZC, PRO, MEX, MTY, NOG, PMS, 01400805
014009*      KE  =  KENYA (AGOA)  - MBA                                 01400905
014010*      LS   =  LESOTHO (AGOA)  - DUR, CPT                         01401005
014011*      SZ  =   SWAZILAND (AGOA) - DUR                             01401105
014012*      IN   =   INDIA (GSP) - BOM, COK, MAA, MUN, TUT, DEL, BLR, C01401205
014013*      ID   =   INDONESIA (GSP) -  SRG, JKT, SUB                  01401305
014014*      TH   =  THAILAND (GSP) - BKK                               01401405
014015*      SV   =  EL SALVADOR (DR-CAFTA) - SAL                       01401505
014016*      GT   =  GUATEMALA (DR-CAFTA) - GUA                         01401605
014017*      HN  =  HUNDORAS (DR-CAFTA) - SAP                           01401705
014018*      NI  =  NICARAGUA (DR-CAFTA) - MGA                          01401805
014019*      DO  =  DOMINICAN REPUBLIC (DR-CAFTA) - SDQ, POP, PAP       01401905
014020*      CR  =  COSTA RICA (DR-CAFTA)                               01402005
014021*      HT  =  HAITI (HOPE) SDQ, POP, PAP                          01402105
014022*      EG  =  EGYPT (QIZ TRADE PROGRAM)                           01402205
014023*      JO  =  JORDAN (JO/N TRADE PROGRAM)                         01402305
014024*      PK  =  PAKISTAN (GSP TRADE PROGRAM)                        01402405
014030     05  PV-RECEIV-VARIANCE    PIC S9(3)V9999 COMP-3 VALUE ZEROS. 01403000
014100     05  PV-LAND-COST-VARIANCE PIC S9(3)V9999 COMP-3 VALUE ZEROS. 01410000
014200     05  PV-ONE                  PIC  X(01)     VALUE SPACES.     01420000
014300     05  PV-FISCAL-YEAR-X        PIC  X(04)     VALUE ZEROS.      01430000
014400     05  PV-FISCAL-YEAR-9  REDEFINES                              01440000
014500         PV-FISCAL-YEAR-X        PIC  9(04).                      01450000
014600                                                                  01460000
014700 01  WS-PO-INV-INPUT-AREA.                                        01470000
014800     05  WS-INV-ARRAY-ENTRY     OCCURS 15 TIMES                   01480000
014900                                 INDEXED BY WS-IA-IDX.            01490000
015000         10  WS-IA-REPORT-TYP-CDE            PIC X(1).            01500000
015100             88  WS-IA-RCVING-RPT                VALUE 'R'.       01510000
015200             88  WS-IA-POSTING-RPT               VALUE 'P'.       01520000
015300             88  WS-IA-AUTO-JRNLD-RPT            VALUE 'A'.       01530000
015400         10  WS-IA-SORT-KEYS.                                     01540000
015500             15  WS-IA-VENDOR-NAME           PIC X(30).           01550000
015600             15  WS-IA-PO-NBR                PIC X(9).            01560000
015700             15  WS-IA-HDR-DTL-CDE           PIC X(1).            01570000
015800                 88  WS-IA-HEADER                VALUE '1'.       01580000
015900                 88  WS-IA-DETAIL                VALUE '2'.       01590000
016000             15  WS-IA-RPT-LINE-SEQ          PIC X(2).            01600000
016100                 88  WS-IA-FIRST-COST            VALUE 'A1'.      01610000
016200                 88  WS-IA-DUTY                  VALUE 'B1'.      01620000
016300                 88  WS-IA-COMMISSION            VALUE 'C1'.      01630000
016400                 88  WS-IA-ROYALTY               VALUE 'D1'.      01640000
016500                 88  WS-IA-FREIGHT               VALUE 'E1'.      01650000
016600                 88  WS-IA-1ST-COST-LOAD         VALUE 'F1'.      01660000
016700                 88  WS-IA-DECONSOLIDATION       VALUE 'G1'.      01670000
016800                 88  WS-IA-ENTRY-FEE             VALUE 'H1'.      01680000
016900                 88  WS-IA-DRAYAGE               VALUE 'I1'.      01690000
017000                 88  WS-IA-OVERSEAS-CONSOL       VALUE 'J1'.      01700000
017100                 88  WS-IA-HANGER-CHARGE         VALUE 'K1'.      01710000
017200                 88  WS-IA-MISC-CHARGES          VALUE 'L1'.      01720000
017300                 88  WS-IA-TOTAL-LANDED-COST     VALUE 'M1'.      01730000
017400             15  WS-IA-DEPT-NBR              PIC X(03).           01740000
017500             15  WS-IA-FOB-CDE               PIC X(03).           01750000
017600             15  WS-IA-OTB-PER-NBR           PIC X(06).           01760000
017700         10  WS-IA-HEADER-INFO.                                   01770000
017800             15  WS-IA-VENDOR-NBR            PIC X(9).            01780000
017900             15  WS-IA-PO-STATUS-CDE         PIC X(02).           01790000
018000             15  WS-IA-1ST-INVC-DTE          PIC X(10).           01800000
018100             15  WS-IA-1ST-VERFYD-DTE        PIC X(10).           01810000
018200             15  WS-IA-LAST-VERFYD-DTE       PIC X(10).           01820000
018300             15  WS-IA-PO-UNT-QTY            PIC S9(9) COMP-3.    01830000
018400             15  WS-IA-RCV-UNT-QTY           PIC S9(9) COMP-3.    01840000
018500             15  WS-IA-INV-UNT-QTY           PIC S9(9) COMP-3.    01850000
018600             15  FILLER                      PIC X(22).           01860000
018700         10  WS-IA-DETAIL-INFO REDEFINES WS-IA-HEADER-INFO.       01870000
018800             15  WS-IA-COMPONENT-DESC     PIC X(30).              01880000
018900             15  WS-IA-PO-COST-AMT        PIC S9(11)V99 COMP-3.   01890000
019000             15  WS-IA-EST-COST-AMT       PIC S9(11)V99 COMP-3.   01900000
019100             15  WS-IA-EST-UNT-COST       PIC S9(03)V9999 COMP-3. 01910000
019200             15  WS-IA-RCV-COST-AMT       PIC S9(11)V99 COMP-3.   01920000
019300             15  WS-IA-INV-COST-AMT       PIC S9(11)V99 COMP-3.   01930000
019400             15  WS-IA-INV-UNT-COST       PIC S9(03)V9999 COMP-3. 01940000
019500             15  WS-IA-INV-PCT-TO-FC      PIC S9(01)V9999 COMP-3. 01950000
019600             15  WS-IA-INV-PCT-TO-LC      PIC S9(01)V9999 COMP-3. 01960000
019700             15  FILLER                   PIC X(06).              01970000
019800         10  FILLER                       PIC X(16).              01980000
019900         10  WS-IA-FOB-RPT-CONTROLS.                              01990000
020000             15  WS-IA-FISCAL-MONTH          PIC 9(02).           02000000
020100             15  WS-IA-FISCAL-YEAR           PIC 9(04).           02010000
020200             15  WS-IA-FISCAL-SEASON         PIC X(01).           02020000
020300                 88  WS-IA-SPRING                VALUE 'S'.       02030000
020400                 88  WS-IA-FALL                  VALUE 'F'.       02040000
020500         10  WS-IA-OTB-EOW-DTE               PIC X(10).           02050000
020600         10  WS-IA-OTB-EOW-DATE REDEFINES WS-IA-OTB-EOW-DTE.      02060000
020700             15  WS-IA-OTB-EOW-DATE-CC       PIC 9(02).           02070000
020800             15  WS-IA-OTB-EOW-DATE-YY       PIC 9(02).           02080000
020900             15  FILLER                      PIC X(01).           02090000
021000             15  WS-IA-OTB-EOW-DATE-MM       PIC 9(02).           02100000
021100             15  FILLER                      PIC X(01).           02110000
021200             15  WS-IA-OTB-EOW-DATE-DD       PIC 9(02).           02120000
021300         10  FILLER                          PIC X(04).           02130000
021400                                                                  02140000
021500                                                                  02150000
021600 EJECT                                                            02160000
021700                                                                  02170000
021800*----------------------------------------------------------------*02180000
021900*  RECORD LAYOUT FOR THE IMPORT PO COST VARIANCE REPORTING FILE   02190000
022000*----------------------------------------------------------------*02200000
022100     COPY APRD036.                                                02210000
022200                                                                  02220000
022300*----------------------------------------------------------------*02230000
022400*  RECORD LAYOUT FOR THE OPEN TO PAY INVOICE UPDATE FILE          02240000
022500*----------------------------------------------------------------*02250000
022600     COPY APRD252.                                                02260000
022700                                                                  02270000
022800*----------------------------------------------------------------*02280000
022900*    SQL COMMUNICATIONS AREA DCLGEN                               02290000
023000*----------------------------------------------------------------*02300000
023100     EXEC SQL                                                     02310000
023200         INCLUDE SQLCA                                            02320000
023300     END-EXEC.                                                    02330000
023400                                                                  02340000
023500*----------------------------------------------------------------*02350000
023600*    AP-PAYMENT CONTROL TABLE                                     02360000
023700*----------------------------------------------------------------*02370000
023800     EXEC SQL                                                     02380000
023900         INCLUDE TAPCNTL                                          02390000
024000     END-EXEC.                                                    02400000
024100                                                                  02410000
024200*----------------------------------------------------------------*02420000
024300*    AP-INVOICE TABLE                                             02430000
024400*----------------------------------------------------------------*02440000
024500     EXEC SQL                                                     02450000
024600         INCLUDE TINVOIC                                          02460000
024700     END-EXEC.                                                    02470000
024800                                                                  02480000
024900*----------------------------------------------------------------*02490000
025000*    PO-PURCHASE TABLE                                            02500000
025100*----------------------------------------------------------------*02510000
025200     EXEC SQL                                                     02520000
025300         INCLUDE TPURCHS                                          02530000
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600*----------------------------------------------------------------*02560000
025700*    MERCHANDISE LEDGER - DATE RECORD                             02570000
025800*----------------------------------------------------------------*02580000
025900     EXEC SQL                                                     02590000
026000         INCLUDE TDTATTR                                          02600000
026100     END-EXEC.                                                    02610000
026200                                                                  02620000
026300*----------------------------------------------------------------*02630000
026400*    DB2 AREA FOR SYSDUMMY1                                       02640000
026500*----------------------------------------------------------------*02650000
026600     EXEC SQL                                                     02660000
026700          INCLUDE SYSDUMMY                                        02670000
026800     END-EXEC.                                                    02680000
026900                                                                  02690000
027000*----------------------------------------------------------------*02700000
027100*    PO CURSOR FOR INVC_ID, PAYT_DTE FETCH                        02710000
027200*----------------------------------------------------------------*02720000
027300     EXEC SQL                                                     02730000
027400         DECLARE PO_CSR CURSOR FOR                                02740000
027500             SELECT  INVC_ID                                      02750000
027600                    ,PAYT_DTE                                     02760000
027700               FROM  TINVOIC                                      02770000
027800              WHERE  PO_NBR        = :INVOIC-PO-NBR               02780000
027900                AND  INVC_TYP_CDE  = 'MI'                         02790000
028000                AND  AP_PRC_CDE    = ' '                          02800000
028100                AND  STATUS_CDE   <> 'DE'                         02810000
028200           ORDER BY  INVC_ID                                      02820000
028300     END-EXEC.                                                    02830000
028400                                                                  02840000
028500*----------------------------------------------------------------*02850000
028600*    ABEND DATA AREAS                                             02860000
028700*----------------------------------------------------------------*02870000
028800 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      02880000
028900                                   COMP         SYNC.             02890000
029000                                                                  02900000
029100     88  AC-ANY-ERROR                           VALUE  +4001      02910000
029200                                                THRU   +4019.     02920000
029300     88  AC-OPEN-ERROR                          VALUE  +4005.     02930000
029400     88  AC-CLOSE-ERROR                         VALUE  +4006.     02940000
029500     88  AC-INVALID-DATA                        VALUE  +4008.     02950000
029600     88  AC-DB2-ERROR                           VALUE  +4013.     02960000
029700     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     02970000
029800     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     02980000
029900                                                                  02990000
030000                                                                  03000000
030100 01  ABEND-AREAS.                                                 03010000
030200     05  AA-ABEND-LIT              PIC  X(40)   VALUE             03020000
030300             '*****       ABEND'.                                 03030000
030400     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             03040000
030500             '*****   PROGRAM: APKUT084'.                         03050000
030600     05  AA-PARAGRAPH-LIT.                                        03060000
030700         10  FILLER                PIC  X(17)   VALUE             03070000
030800             '***** PARAGRAPH: '.                                 03080000
030900         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     03090000
031000     05  AA-MESSAGE-LINE-1.                                       03100000
031100         10  FILLER                PIC  X(06)   VALUE '*****'.    03110000
031200         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     03120000
031300     05  AA-MESSAGE-LINE-2.                                       03130000
031400         10  FILLER                PIC  X(06)   VALUE '*****'.    03140000
031500         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     03150000
031600     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             03160000
031700             '*****    DB2 ERROR'.                                03170000
031800     05  AA-DB2-OPERATION-LIT.                                    03180000
031900         10  FILLER                PIC  X(17)   VALUE             03190000
032000             '***** OPERATION: '.                                 03200000
032100         10  AA-DB2-OPERATION.                                    03210000
032200             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     03220000
032300             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     03230000
032400     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     03240000
032500     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     03250000
032600                                                                  03260000
032700*----------------------------------------------------------------*03270000
032800*    SQLCA FORMATTED MESSAGE AREA                                 03280000
032900*----------------------------------------------------------------*03290000
033000     COPY DPWS004.                                                03300000
033100                                                                  03310000
033200 01  FILLER                      PIC  X(25)     VALUE             03320000
033300     '** END OF APKUT084 W/S **'.                                 03330000
033400                                                                  03340000
033500*-------------------*                                             03350000
033600 PROCEDURE DIVISION.                                              03360000
033700*-------------------*                                             03370000
033800 A100-MAINLINE.                                                   03380000
033900                                                                  03390000
034000     PERFORM B100-INITIALIZE.                                     03400000
034100                                                                  03410000
034200     PERFORM B200-PROCESS-PO-INVC                                 03420000
034300       UNTIL END-OF-FILE.                                         03430000
034400                                                                  03440000
034500     PERFORM B300-END-OF-PROGRAM.                                 03450000
034600                                                                  03460000
034700     GOBACK.                                                      03470000
034800                                                                  03480000
034900                                                                  03490000
035000*----------------------------------------------------------------*03500000
035100*    INITIALIZATION PROCESSING                                    03510000
035200*    - OPEN FILES                                                 03520000
035300*    - INITIALIZE DCLGENS AND SWITCHES                            03530000
035400*    - READ FIRST RECORD                                          03540000
035500*----------------------------------------------------------------*03550000
035600 B100-INITIALIZE.                                                 03560000
035700                                                                  03570000
035800     DISPLAY '**------  APKUT084  (PROCESSING MSGS)  ------**'.   03580000
035900                                                                  03590000
036000     OPEN  INPUT   IMPORT-COST-RPT-IN-FILE.                       03600000
036100     OPEN  OUTPUT  IMPORT-COST-RPT-OUT-FILE                       03610000
036200                   INVOICE-STATUS-UPD-FILE.                       03620000
036300                                                                  03630000
036400     INITIALIZE  DCLTAPCNTL                                       03640000
036500                 DCLTINVOIC                                       03650000
036600                 DCLTPURCHS                                       03660000
036700                 DCLTDTATTR                                       03670000
036800                 PROGRAM-SWITCHES                                 03680000
036900                 PO-SWITCHES.                                     03690000
037000                                                                  03700000
037100     PERFORM E100-DEFINE-OTB-PERIOD.                              03710000
037200     DISPLAY '** CURRENT OTB PERIOD: ' PV-CURR-OTB-PERIOD.        03720000
037300                                                                  03730000
037400     PERFORM R100-READ-IMPORT-FILE.                               03740000
037500                                                                  03750000
037600     IF END-OF-FILE                                               03760000
037700        DISPLAY '** EMPTY INPUT FILE **'                          03770000
037800     END-IF.                                                      03780000
037900                                                                  03790000
038000                                                                  03800000
038100*----------------------------------------------------------------*03810000
038200*    PROCESS IMPORT COST REPORT RECORD                            03820000
038300*    - CREATE ENTRIES ON ARRAY                                    03830000
038400*    - VERIFY PO/INVOICE CONDITIONS                               03840000
038500*    - WRITE ARRAY OUT                                            03850000
038600*----------------------------------------------------------------*03860000
038700 B200-PROCESS-PO-INVC.                                            03870000
038800                                                                  03880000
038900     INITIALIZE WS-PO-INV-INPUT-AREA                              03890000
039000                PO-SWITCHES                                       03900000
039100                PV-ENTRY-CNT.                                     03910000
039200                                                                  03920000
039300     MOVE AP036-PO-NBR TO PV-HOLD-PO-NBR                          03930000
039400                          PURCHS-PO-NBR                           03940000
039500                          INVOIC-PO-NBR.                          03950000
039600                                                                  03960000
039700     PERFORM S200-GET-COUNTRY-OF-PROD.                            03970000
039800                                                                  03980000
039900     PERFORM S300-CHECK-OUT-OF-BAL.                               03990000
040000                                                                  04000000
040100     SET WS-IA-IDX TO 1.                                          04010000
040200                                                                  04020000
040300     PERFORM C100-PROCESS-PO-INVC                                 04030000
040400       UNTIL AP036-PO-NBR NOT EQUAL PV-HOLD-PO-NBR                04040000
040500          OR END-OF-FILE.                                         04050000
040600                                                                  04060000
040700     PERFORM D200-VERIFY-PO-INVC.                                 04070000
040800                                                                  04080000
040900     PERFORM D300-WRITE-ARRAY.                                    04090000
041000                                                                  04100000
041100                                                                  04110000
041200*----------------------------------------------------------------*04120000
041300*    END OF PROGRAM                                               04130000
041400*    - CLOSE CURSOR, IF OPEN                                      04140000
041500*    - CLOSE FILES                                                04150000
041600*----------------------------------------------------------------*04160000
041700 B300-END-OF-PROGRAM.                                             04170000
041800                                                                  04180000
041900     DISPLAY '*************************************************'. 04190000
042000     DISPLAY '*************************************************'. 04200000
042100     DISPLAY '** TOTAL IMPORT RECS READ = ' PV-RECS-READ-COUNT.   04210000
042200     DISPLAY '*************************************************'. 04220000
042300     DISPLAY '** TOTAL JRNL IMP RECS WRT = ' PV-JRNL-IMP-COUNT.   04230000
042400     DISPLAY '*************************************************'. 04240000
042500     DISPLAY '** TOT UNJRNL IMP RECS WRT = ' PV-UNJRNL-IMP-COUNT. 04250000
042600     DISPLAY '*************************************************'. 04260000
042700     DISPLAY '** TOTAL INVC UPDT RECS WRT = ' PV-INVC-UPD-COUNT.  04270000
042800     DISPLAY '*************************************************'. 04280000
042900     DISPLAY '**         END OF APKUT084 PROCESSING          **'. 04290000
043000     DISPLAY '*************************************************'. 04300000
043100     DISPLAY ' '.                                                 04310000
043200                                                                  04320000
043300     CLOSE IMPORT-COST-RPT-IN-FILE                                04330000
043400           IMPORT-COST-RPT-OUT-FILE                               04340000
043500           INVOICE-STATUS-UPD-FILE.                               04350000
043600                                                                  04360000
043700                                                                  04370000
043800*----------------------------------------------------------------*04380000
043900*    - MOVE RECORD TO ARRAY                                       04390000
044000*    - READ NEXT RECORD                                           04400000
044100*----------------------------------------------------------------*04410000
044200 C100-PROCESS-PO-INVC.                                            04420000
044300                                                                  04430000
044400     IF WS-IA-IDX > PC-ARRAY-ENTRY-LIMIT                          04440000
044500        DISPLAY '*** PO NBR = ' PV-HOLD-PO-NBR                    04450000
044600        MOVE 'C100-PROCESS-PO-INVC'                               04460000
044700                              TO AA-PARAGRAPH-NAME                04470000
044800        MOVE '*** OVERFLOW OF INTERNAL ARRAY'                     04480000
044900                              TO AA-MESSAGE-1                     04490000
045000        MOVE '*** NUMBER OF ENTRIES EXCEEDED LIMIT OF 15'         04500000
045100                              TO AA-MESSAGE-2                     04510000
045200        MOVE +4004            TO ABEND-CODE                       04520000
045300        PERFORM Z998-ABEND                                        04530000
045400     END-IF                                                       04540000
045500                                                                  04550000
045600     MOVE AP036-IMPORT-REPORT-RECORD                              04560000
045700                           TO WS-INV-ARRAY-ENTRY (WS-IA-IDX).     04570000
045800                                                                  04580000
045900     SET WS-IA-IDX UP BY 1.                                       04590000
046000     ADD 1 TO PV-ENTRY-CNT.                                       04600000
046100                                                                  04610000
046200     PERFORM D100-PROCESS-REC-ATTRIB.                             04620000
046300                                                                  04630000
046400     PERFORM R100-READ-IMPORT-FILE.                               04640000
046500                                                                  04650000
046600                                                                  04660000
046700*----------------------------------------------------------------*04670000
046800*    - PROCESS ATTRIBUTES OF EACH RECORD DEPENDING ON WHETHER     04680000
046900*      IT'S HEADER RECORD OR DETAIL RECORD                        04690000
047000*----------------------------------------------------------------*04700000
047100 D100-PROCESS-REC-ATTRIB.                                         04710000
047200                                                                  04720000
047300     IF AP036-HEADER                                              04730000
047400        MOVE AP036-OTB-PER-NBR    TO PV-HOLD-OTB-PERIOD           04740000
047500        MOVE AP036-1ST-INVC-DTE   TO PV-HOLD-INVC-DTE             04750000
047600        MOVE AP036-PO-STATUS-CDE  TO PV-HOLD-PO-STATUS            04760000
047700*       IF AP036-VENDOR-NBR = PC-COLBY-NBR                        04770000
047800*          SET COLBY-PO TO TRUE                                   04780000
047900*       END-IF                                                    04790000
048000        IF AP036-INV-UNT-QTY = 0                                  04800000
048100           MOVE 100.0000 TO PV-RECEIV-VARIANCE                    04810000
048200        ELSE                                                      04820000
048300           COMPUTE PV-RECEIV-VARIANCE =                           04830000
048400                      (AP036-INV-UNT-QTY - AP036-RCV-UNT-QTY) /   04840000
048500                                        AP036-INV-UNT-QTY         04850000
048600           IF PV-RECEIV-VARIANCE < 0                              04860000
048700              COMPUTE PV-RECEIV-VARIANCE =                        04870000
048800                                         PV-RECEIV-VARIANCE * -1  04880000
048900           END-IF                                                 04890000
049000        END-IF                                                    04900000
049100     END-IF                                                       04910000
049200                                                                  04920000
049300     IF AP036-DETAIL                                              04930000
049400        EVALUATE AP036-RPT-LINE-SEQ                               04940000
049500           WHEN  'A1'                                             04950000
049600                 IF AP036-INV-COST-AMT > 0                        04960000
049700                    SET FIRST-COST-FOUND TO TRUE                  04970000
049800                 END-IF                                           04980000
049900           WHEN  'B1'                                             04990000
050000                 IF AP036-INV-COST-AMT > 0                        05000000
050100                    SET DUTY-FOUND TO TRUE                        05010000
050200                 END-IF                                           05020000
050300           WHEN  'C1'                                             05030000
050400                 IF AP036-INV-COST-AMT > 0                        05040000
050500                    SET COMMISSION-FOUND TO TRUE                  05050000
050600                 ELSE                                             05060000
050700                     IF AP036-EST-COST-AMT = 0 OR PV-PARENT-ENT   05070000
050800                        SET NO-COMMISSION-REQ TO TRUE             05080000
050900                     END-IF                                       05090000
051000                 END-IF                                           05100000
051100           WHEN  'E1'                                             05110000
051200                 IF AP036-INV-COST-AMT > 0                        05120000
051300                    SET FREIGHT-FOUND TO TRUE                     05130000
051400                 END-IF                                           05140000
051500           WHEN  'G1'                                             05150000
051600                 IF AP036-INV-COST-AMT > 0                        05160000
051700                    SET DECONSOL-FOUND TO TRUE                    05170000
051800                 END-IF                                           05180000
051900           WHEN  'H1'                                             05190000
052000                 IF AP036-INV-COST-AMT > 0                        05200000
052100                    SET ENTRY-FEE-FOUND TO TRUE                   05210000
052200                 END-IF                                           05220000
052300           WHEN  'I1'                                             05230000
052400                 IF AP036-INV-COST-AMT > 0                        05240000
052500                    SET DRAYAGE-FOUND TO TRUE                     05250000
052600                 END-IF                                           05260000
052700           WHEN  'J1'                                             05270000
052800                 IF AP036-INV-COST-AMT > 0                        05280000
052900                    SET OVERSEAS-CONSOL-FOUND TO TRUE             05290000
053000                 END-IF                                           05300000
053100           WHEN  'M1'                                             05310000
053200                 IF AP036-INV-COST-AMT = 0                        05320000
053300                    MOVE 100.0000 TO PV-LAND-COST-VARIANCE        05330000
053400                 ELSE                                             05340000
053500                    COMPUTE PV-LAND-COST-VARIANCE =               05350000
053600                      (AP036-INV-COST-AMT - AP036-RCV-COST-AMT) / 05360000
053700                                             AP036-INV-COST-AMT   05370000
053800                    IF PV-LAND-COST-VARIANCE < 0                  05380000
053900                       COMPUTE PV-LAND-COST-VARIANCE =            05390000
054000                                  PV-LAND-COST-VARIANCE * -1      05400000
054100                    END-IF                                        05410000
054200                 END-IF                                           05420000
054300        END-EVALUATE                                              05430000
054400     END-IF.                                                      05440000
054500                                                                  05450000
054600                                                                  05460000
054700*----------------------------------------------------------------*05470000
054800*    VERIFY WHETHER ALL CONDITIONS ARE MET TO JOURNALIZE PO       05480000
054900*----------------------------------------------------------------*05490000
055000 D200-VERIFY-PO-INVC.                                             05500000
055100                                                                  05510000
055200     INITIALIZE PV-COND-MET-COUNT.                                05520000
055300                                                                  05530000
055400     IF COLBY-PO                                                  05540000
055500        ADD +1 TO PV-COND-MET-COUNT                               05550000
055600     END-IF                                                       05560000
055700                                                                  05570000
055800     IF PV-HOLD-OTB-PERIOD <= PV-CURR-OTB-PERIOD                  05580000
055900        ADD +1 TO PV-COND-MET-COUNT                               05590000
056000     END-IF                                                       05600000
056100                                                                  05610000
056200     IF FIRST-COST-FOUND                                          05620000
056300        ADD +1 TO PV-COND-MET-COUNT                               05630000
056400     END-IF                                                       05640000
056500                                                                  05650000
056600     IF DUTY-FOUND                                                05660011
056700     OR DUTY-FREE-CNTRY                                           05670011
056900          ADD +1 TO PV-COND-MET-COUNT                             05690000
057000     END-IF                                                       05700000
057100                                                                  05710000
057200     IF COMMISSION-FOUND                                          05720000
057300        ADD +1 TO PV-COND-MET-COUNT                               05730000
057400     END-IF                                                       05740000
057500                                                                  05750000
057600     IF NO-COMMISSION-REQ                                         05760000
057700        ADD +1 TO PV-COND-MET-COUNT                               05770000
057800     END-IF                                                       05780000
057900                                                                  05790000
058000     IF FREIGHT-FOUND                                             05800000
058100        ADD +1 TO PV-COND-MET-COUNT                               05810000
058200     END-IF                                                       05820000
058300                                                                  05830000
058400     IF ENTRY-FEE-FOUND                                           05840000
058500        ADD +1 TO PV-COND-MET-COUNT                               05850000
058600     END-IF                                                       05860000
058700                                                                  05870000
058800     IF OVERSEAS-CONSOL-FOUND                                     05880000
058900        ADD +1 TO PV-COND-MET-COUNT                               05890000
059000     END-IF                                                       05900000
059100                                                                  05910000
059200     IF (DRAYAGE-FOUND AND DECONSOL-FOUND) OR                     05920000
059300         (PV-HOLD-OTB-PERIOD < PV-CURR-OTB-PERIOD) OR             05930000
059400        ((PV-HOLD-OTB-PERIOD = PV-CURR-OTB-PERIOD) AND            05940000
059500         (PV-FISCAL-CUTOFF-DTE <= APCNTL-BTCH-PRC-DTE))           05950000
059600         ADD +1 TO PV-COND-MET-COUNT                              05960000
059700     END-IF                                                       05970000
059800                                                                  05980000
059900     IF PV-RECEIV-VARIANCE <= PC-MAX-RECEIV-VAR OR                05990000
060000        PV-HOLD-PO-STATUS = 'CA' OR                               06000000
060100        PV-HOLD-PO-STATUS = 'CM'                                  06010000
060200          ADD +1 TO PV-COND-MET-COUNT                             06020000
060300     END-IF                                                       06030000
060400                                                                  06040000
060410     IF PV-LAND-COST-VARIANCE <= PC-MAX-LAND-COST-VAR             06041000
060420        ADD +1 TO PV-COND-MET-COUNT                               06042000
060430     END-IF                                                       06043000
060440                                                                  06044000
060450     IF INVC-IN-BALANCE                                           06045000
060460        ADD +1 TO PV-COND-MET-COUNT                               06046000
060470     END-IF                                                       06047000
060480                                                                  06048000
060490     IF PV-COND-MET-COUNT = PC-ALL-COND-MET                       06049000
060500        SET JOURNALIZE-PO TO TRUE                                 06050000
060600     END-IF.                                                      06060000
060700                                                                  06070000
060800                                                                  06080000
060900*----------------------------------------------------------------*06090000
061000*    PROCESS AND WRITE OUT ARRAY ENTRIES FOR PO                   06100000
061100*----------------------------------------------------------------*06110000
061200 D300-WRITE-ARRAY.                                                06120000
061300                                                                  06130000
061400     IF JOURNALIZE-PO                                             06140000
061500        PERFORM WITH TEST BEFORE                                  06150000
061600            VARYING WS-IA-IDX FROM 1 BY 1                         06160000
061700              UNTIL WS-IA-IDX > PV-ENTRY-CNT                      06170000
061800                MOVE 'A' TO WS-IA-REPORT-TYP-CDE (WS-IA-IDX)      06180000
061900                PERFORM W100-WRITE-IMPORT-OUT                     06190000
062000                ADD 1 TO PV-JRNL-IMP-COUNT                        06200000
062100        END-PERFORM                                               06210000
062200        SET MORE-PO-CSR TO TRUE                                   06220000
062300        PERFORM X100-OPEN-PO-CSR                                  06230000
062400        PERFORM S400-FETCH-PO-CSR                                 06240000
062500        PERFORM UNTIL END-OF-PO-CSR                               06250000
062600           PERFORM F100-CREATE-INVC-UPD-REC                       06260000
062700           PERFORM S400-FETCH-PO-CSR                              06270000
062800        END-PERFORM                                               06280000
062900        PERFORM Y100-CLOSE-PO-CSR                                 06290000
063000     ELSE                                                         06300000
063100        PERFORM WITH TEST BEFORE                                  06310000
063200            VARYING WS-IA-IDX FROM 1 BY 1                         06320000
063300              UNTIL WS-IA-IDX > PV-ENTRY-CNT                      06330000
063400                PERFORM W100-WRITE-IMPORT-OUT                     06340000
063500                ADD 1 TO PV-UNJRNL-IMP-COUNT                      06350000
063600        END-PERFORM                                               06360000
063700     END-IF.                                                      06370000
063800                                                                  06380000
063900                                                                  06390000
064000*----------------------------------------------------------------*06400000
064100*    DETERMINE CURRENT OPEN TO BUY PERIOD                         06410000
064200*----------------------------------------------------------------*06420000
064300 E100-DEFINE-OTB-PERIOD.                                          06430000
064400                                                                  06440000
064500     PERFORM S100-GET-CURR-OTB-PERIOD.                            06450000
064600                                                                  06460000
064700     IF DTATTR-CAL-MN-NBR = '01'                                  06470000
064800        MOVE DTATTR-FSCL-YR-NBR TO PV-FISCAL-YEAR-X               06480000
064900        ADD 1 TO PV-FISCAL-YEAR-9                                 06490000
065000     ELSE                                                         06500000
065100        MOVE DTATTR-FSCL-YR-NBR TO PV-FISCAL-YEAR-X               06510000
065200     END-IF                                                       06520000
065300                                                                  06530000
065400     STRING PV-FISCAL-YEAR-X   DELIMITED BY SIZE                  06540000
065500            DTATTR-CAL-MN-NBR  DELIMITED BY SIZE                  06550000
065600            INTO PV-CURR-OTB-PERIOD                               06560000
065700     END-STRING.                                                  06570000
065800                                                                  06580000
065900                                                                  06590000
066000*----------------------------------------------------------------*06600000
066100*    CREATE INVOICE STATUS UPDATE RECORD                          06610000
066200*----------------------------------------------------------------*06620000
066300 F100-CREATE-INVC-UPD-REC.                                        06630000
066400                                                                  06640000
066500     INITIALIZE AP252-RECORD.                                     06650000
066600                                                                  06660000
066700     MOVE INVOIC-PO-NBR      TO  AP252-PO-NBR.                    06670000
066800     MOVE INVOIC-INVC-ID     TO  AP252-INVOICE-ID.                06680000
066900     MOVE INVOIC-PAYT-DTE    TO  AP252-PAYT-DTE.                  06690000
067000     MOVE 'BM'               TO  AP252-NEW-STATUS-CDE.            06700000
067100                                                                  06710000
067200     PERFORM W200-WRITE-INVC-UPD.                                 06720000
067300                                                                  06730000
067400                                                                  06740000
067500*----------------------------------------------------------------*06750000
067600*    READ IMPORT COST REPORT FILE                                 06760000
067700*----------------------------------------------------------------*06770000
067800 R100-READ-IMPORT-FILE.                                           06780000
067900                                                                  06790000
068000     READ IMPORT-COST-RPT-IN-FILE INTO AP036-IMPORT-REPORT-RECORD 06800000
068100        AT END                                                    06810000
068200            SET END-OF-FILE TO TRUE                               06820000
068300        NOT AT END                                                06830000
068400            ADD +1 TO PV-RECS-READ-COUNT                          06840000
068500     END-READ.                                                    06850000
068600                                                                  06860000
068700                                                                  06870000
068800*----------------------------------------------------------------*06880000
068900*    GET CURRENT OPEN TO BUY PERIOD                               06890000
069000*----------------------------------------------------------------*06900000
069100 S100-GET-CURR-OTB-PERIOD.                                        06910000
069200                                                                  06920000
069300     EXEC SQL                                                     06930000
069400         SELECT  A.BTCH_PRC_DTE                                   06940000
069500                ,B.CAL_MN_NBR                                     06950000
069600                ,B.FSCL_YR_NBR                                    06960000
069700                ,(B.FSCL_MN_END_DTE - 5 DAYS)                     06970000
069800           INTO  :APCNTL-BTCH-PRC-DTE                             06980000
069900                ,:DTATTR-CAL-MN-NBR                               06990000
070000                ,:DTATTR-FSCL-YR-NBR                              07000000
070100                ,:PV-FISCAL-CUTOFF-DTE                            07010000
070200           FROM  TAPCNTL  A                                       07020000
070300                ,TDTATTR  B                                       07030000
070400          WHERE  A.BTCH_PRC_DTE  =  B.KY_DTE                      07040000
070500     END-EXEC.                                                    07050000
070600                                                                  07060000
070700     EVALUATE TRUE                                                07070000
070800         WHEN SQLCODE = ZERO                                      07080000
070900            CONTINUE                                              07090000
071000                                                                  07100000
071100         WHEN SQLWARN0 NOT = SPACES                               07110000
071200         WHEN SQLCODE NOT  = ZERO                                 07120000
071300            MOVE 'S100-GET-CURR-OTB-PERIOD'                       07130000
071400                                TO AA-PARAGRAPH-NAME              07140000
071500            MOVE 'UNSUCCESSFUL SELECT OF DATES'                   07150000
071600                                TO AA-DB2-OPERATION               07160000
071700            MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                 07170000
071800            MOVE 'TDTATRR'      TO AA-DB2-TABLE-2                 07180000
071900            PERFORM Z999-DB2-ABEND                                07190000
072000                                                                  07200000
072100     END-EVALUATE.                                                07210000
072200                                                                  07220000
072300                                                                  07230000
072400*----------------------------------------------------------------*07240000
072500*    GETS COUNTRY OF PRODUCTION FOR PO BEING PROCESSED            07250000
072600*----------------------------------------------------------------*07260000
072700 S200-GET-COUNTRY-OF-PROD.                                        07270000
072800                                                                  07280000
072900     EXEC SQL                                                     07290000
073000         SELECT    PROD_CNTRY_CDE                                 07300000
073100                 , IMPRT_VND_ID                                   07310000
073200           INTO   :PURCHS-PROD-CNTRY-CDE                          07320000
073300                 , :PURCHS-IMPRT-VND-ID                           07330000
073400           FROM  TPURCHS                                          07340000
073500          WHERE  PO_NBR         = :PURCHS-PO-NBR                  07350000
073600            AND  VER_STATUS_CDE = 'A'                             07360000
073700     END-EXEC.                                                    07370000
073800                                                                  07380000
073900     EVALUATE TRUE                                                07390000
074000         WHEN SQLCODE = ZERO                                      07400000
074100            MOVE PURCHS-PROD-CNTRY-CDE TO PV-PROD-CNTRY-CDE       07410000
074200***         DISPLAY 'VND-ID ' PURCHS-IMPRT-VND-ID                 07420012
074300            MOVE PURCHS-IMPRT-VND-ID TO PV-PARENT                 07430000
074400                                                                  07440000
074500         WHEN SQLWARN0 NOT = SPACES                               07450000
074600         WHEN SQLCODE NOT  = ZERO                                 07460000
074700            MOVE 'S200-GET-COUNTRY-OF-PROD'                       07470000
074800                                TO AA-PARAGRAPH-NAME              07480000
074900            MOVE 'UNSUCCESSFUL SELECT'                            07490000
075000                                TO AA-DB2-OPERATION               07500000
075100            MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                 07510000
075200            MOVE SPACES         TO AA-DB2-TABLE-2                 07520000
075300            DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR                   07530000
075400            PERFORM Z999-DB2-ABEND                                07540000
075500                                                                  07550000
075600     END-EVALUATE.                                                07560000
075700                                                                  07570000
075800                                                                  07580000
075900*----------------------------------------------------------------*07590000
076000*    EXISTENCE CHECK FOR OUT OF BALANCE INVOICES FOR A PO         07600000
076100*----------------------------------------------------------------*07610000
076200 S300-CHECK-OUT-OF-BAL.                                           07620000
076300                                                                  07630000
076400     EXEC SQL                                                     07640000
076500        SELECT '1'                                                07650000
076600          INTO  :PV-ONE                                           07660000
076700          FROM SYSIBM.SYSDUMMY1 X                                 07670000
076800         WHERE EXISTS                                             07680000
076900              (SELECT 1                                           07690000
077000                 FROM  TINVOIC A                                  07700000
077100                WHERE A.PO_NBR        = :INVOIC-PO-NBR            07710000
077200                  AND A.STATUS_CDE IN ('IB','OB','PR')            07720000
077300                  AND X.IBMREQD = X.IBMREQD)                      07730000
077400     END-EXEC.                                                    07740000
077500                                                                  07750000
077600     EVALUATE TRUE                                                07760000
077700         WHEN SQLCODE = ZERO                                      07770000
077800            SET INVC-OUT-OF-BALANCE TO TRUE                       07780000
077900                                                                  07790000
078000         WHEN SQLCODE = +100                                      07800000
078100            SET INVC-IN-BALANCE TO TRUE                           07810000
078200                                                                  07820000
078300         WHEN SQLWARN0 NOT = SPACES                               07830000
078400         WHEN SQLCODE NOT  = ZERO                                 07840000
078500            MOVE 'S300-CHECK-OUT-OF-BAL'                          07850000
078600                                TO AA-PARAGRAPH-NAME              07860000
078700            MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                   07870000
078800                                TO AA-DB2-OPERATION               07880000
078900            MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                 07890000
079000            MOVE SPACES         TO AA-DB2-TABLE-2                 07900000
079100            PERFORM Z999-DB2-ABEND                                07910000
079200                                                                  07920000
079300     END-EVALUATE.                                                07930000
079400                                                                  07940000
079500                                                                  07950000
079600*----------------------------------------------------------------*07960000
079700*    FETCH THE PO_CSR CURSOR                                      07970000
079800*----------------------------------------------------------------*07980000
079900 S400-FETCH-PO-CSR.                                               07990000
080000                                                                  08000000
080100     EXEC SQL                                                     08010000
080200          FETCH  PO_CSR                                           08020000
080300           INTO :INVOIC-INVC-ID                                   08030000
080400               ,:INVOIC-PAYT-DTE                                  08040000
080500     END-EXEC.                                                    08050000
080600                                                                  08060000
080700     EVALUATE TRUE                                                08070000
080800         WHEN SQLCODE = ZERO                                      08080000
080900             CONTINUE                                             08090000
081000                                                                  08100000
081100         WHEN SQLCODE = +100                                      08110000
081200             SET END-OF-PO-CSR TO TRUE                            08120000
081300                                                                  08130000
081400         WHEN SQLWARN0 NOT = SPACES                               08140000
081500         WHEN SQLCODE  NOT = ZERO                                 08150000
081600             MOVE 'S400-FETCH-PO-CSR'                             08160000
081700                                 TO AA-PARAGRAPH-NAME             08170000
081800             MOVE 'UNSUCCESSFUL FETCH FROM PO_CSR'                08180000
081900                                 TO AA-DB2-OPERATION              08190000
082000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                08200000
082100             MOVE SPACES         TO AA-DB2-TABLE-2                08210000
082200             PERFORM Z999-DB2-ABEND                               08220000
082300                                                                  08230000
082400     END-EVALUATE.                                                08240000
082500                                                                  08250000
082600                                                                  08260000
082700*----------------------------------------------------------------*08270000
082800*    WRITE RECORD TO IMPORT COST REPORT OUT FILE                  08280000
082900*----------------------------------------------------------------*08290000
083000 W100-WRITE-IMPORT-OUT.                                           08300000
083100                                                                  08310000
083200     WRITE IMPORT-COST-RPT-OUT-REC                                08320000
083300                             FROM WS-INV-ARRAY-ENTRY (WS-IA-IDX). 08330000
083400                                                                  08340000
083500                                                                  08350000
083600*----------------------------------------------------------------*08360000
083700*    WRITE RECORD TO INVOICE STATUS UPDATE FILE                   08370000
083800*----------------------------------------------------------------*08380000
083900 W200-WRITE-INVC-UPD.                                             08390000
084000                                                                  08400000
084100     WRITE INVOICE-STATUS-UPD-REC  FROM  AP252-RECORD.            08410000
084200                                                                  08420000
084300     ADD +1 TO PV-INVC-UPD-COUNT.                                 08430000
084400                                                                  08440000
084500                                                                  08450000
084600*----------------------------------------------------------------*08460000
084700*    OPEN PO_CSR CURSOR                                           08470000
084800*----------------------------------------------------------------*08480000
084900 X100-OPEN-PO-CSR.                                                08490000
085000                                                                  08500000
085100     EXEC SQL                                                     08510000
085200         OPEN PO_CSR                                              08520000
085300     END-EXEC.                                                    08530000
085400                                                                  08540000
085500     EVALUATE TRUE                                                08550000
085600         WHEN SQLCODE = ZERO                                      08560000
085700             SET PO-CSR-OPEN TO TRUE                              08570000
085800                                                                  08580000
085900         WHEN SQLWARN0 NOT = SPACES                               08590000
086000         WHEN SQLCODE  NOT = ZERO                                 08600000
086100             MOVE 'X100-OPEN-PO-CSR'                              08610000
086200                                 TO AA-PARAGRAPH-NAME             08620000
086300             MOVE 'UNSUCCESSFUL OPEN ON PO_CSR'                   08630000
086400                                 TO AA-DB2-OPERATION              08640000
086500             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                08650000
086600             MOVE SPACES         TO AA-DB2-TABLE-2                08660000
086700             PERFORM Z999-DB2-ABEND                               08670000
086800                                                                  08680000
086900     END-EVALUATE.                                                08690000
087000                                                                  08700000
087100                                                                  08710000
087200*----------------------------------------------------------------*08720000
087300*    CLOSE THE PO_CSR CURSOR                                      08730000
087400*----------------------------------------------------------------*08740000
087500 Y100-CLOSE-PO-CSR.                                               08750000
087600                                                                  08760000
087700     EXEC SQL                                                     08770000
087800         CLOSE PO_CSR                                             08780000
087900     END-EXEC.                                                    08790000
088000                                                                  08800000
088100     EVALUATE TRUE                                                08810000
088200         WHEN SQLCODE = ZERO                                      08820000
088300             SET PO-CSR-CLOSED TO TRUE                            08830000
088400                                                                  08840000
088500         WHEN SQLWARN0 NOT = SPACES                               08850000
088600         WHEN SQLCODE  NOT = ZERO                                 08860000
088700             MOVE 'Y100-CLOSE-PO-CSR'                             08870000
088800                                 TO AA-PARAGRAPH-NAME             08880000
088900             MOVE 'UNSUCCESSFUL CLOSE ON PO_CSR'                  08890000
089000                                 TO AA-DB2-OPERATION              08900000
089100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                08910000
089200             MOVE SPACES         TO AA-DB2-TABLE-2                08920000
089300             PERFORM Z999-DB2-ABEND                               08930000
089400                                                                  08940000
089500       END-EVALUATE.                                              08950000
089600                                                                  08960000
089700                                                                  08970000
089800*----------------------------------------------------------------*08980000
089900*    ABEND ROUTINE                                                08990000
090000*----------------------------------------------------------------*09000000
090100 Z998-ABEND.                                                      09010000
090200                                                                  09020000
090300     CLOSE IMPORT-COST-RPT-IN-FILE                                09030000
090400           IMPORT-COST-RPT-OUT-FILE                               09040000
090500           INVOICE-STATUS-UPD-FILE.                               09050000
090600                                                                  09060000
090700     DISPLAY AA-ABEND-LIT.                                        09070000
090800     DISPLAY AA-PROGRAM-LIT.                                      09080000
090900     DISPLAY AA-PARAGRAPH-LIT.                                    09090000
091000     DISPLAY AA-MESSAGE-LINE-1.                                   09100000
091100     DISPLAY AA-MESSAGE-LINE-2.                                   09110000
091200                                                                  09120000
091300     CALL 'ILBOABN0' USING ABEND-CODE.                            09130000
091400                                                                  09140000
091500                                                                  09150000
091600*----------------------------------------------------------------*09160000
091700*    DB2 ABEND ROUTINE                                            09170000
091800*----------------------------------------------------------------*09180000
091900 Z999-DB2-ABEND.                                                  09190000
092000                                                                  09200000
092100     CLOSE IMPORT-COST-RPT-IN-FILE                                09210000
092200           IMPORT-COST-RPT-OUT-FILE                               09220000
092300           INVOICE-STATUS-UPD-FILE.                               09230000
092400                                                                  09240000
092500     DISPLAY AA-ABEND-LIT.                                        09250000
092600     DISPLAY AA-MESSAGE-LINE-1.                                   09260000
092700     DISPLAY AA-MESSAGE-LINE-2.                                   09270000
092800     DISPLAY AA-DB2-ERROR-LIT.                                    09280000
092900     DISPLAY AA-PROGRAM-LIT.                                      09290000
093000     DISPLAY AA-PARAGRAPH-LIT.                                    09300000
093100     DISPLAY AA-DB2-OPERATION-LIT.                                09310000
093200     DISPLAY AA-DB2-TABLE-1.                                      09320000
093300     DISPLAY AA-DB2-TABLE-2.                                      09330000
093400     SET AC-DB2-ERROR TO TRUE.                                    09340000
093500                                                                  09350000
093600     COPY DPPD004.                                                09360000
093700                                                                  09370000
093800     CALL 'ILBOABN0' USING ABEND-CODE.                            09380000
093900                                                                  09390000
