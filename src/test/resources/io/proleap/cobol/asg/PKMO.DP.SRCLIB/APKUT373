000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKUT373.                                        00020099
000300 AUTHOR.         BARB SCHULTZ.                                    00030099
000400 DATE-WRITTEN.   OCTOBER 2020.                                    00040099
000500 DATE-COMPILED.                                                   00050099
000600***************************************************************** 00060099
000700*  HALLMARK EDIT PROGRAM                                        * 00070099
000800*                                                               * 00080099
000900*  THIS PROGRAM WILL READ THE INVOICES THAT ARE COMING FROM     * 00090099
001000*  HALLMARK.  THESE INVOICES WILL BE BY STORE/UPC BASED UPON THE* 00100099
001100*  SALES KOHLS SUPPLIES THEM EACH WEEK. ONE INVOICE PER         * 00110099
001200*  STORE PER WEEK WITH MANY LINES OF UPC'S. FOR EACH ADJUSTMENT * 00120099
001300*  ALL LINES (UPC'S) FOR THE SAME SUBCLASS SHOULD BE SUMMED     * 00130099
001400*  INTO ONE LINE AND WRITTEN TO THE OUTPUT FILE.  THIS FILE     * 00140099
001500*  WILL BE WRITTEN IN THE APRD045 FORMAT. A REJECTION FILE      * 00150099
001600*  ALSO NEEDS TO BE WRITTEN OUT.                                * 00160099
001700*                                                               * 00170099
001800* INPUT:                                                        * 00180099
001900*  1. HALLMARK-IN-FILE                            (APRD050)     * 00190099
002000*                                                               * 00200099
002100* OUTPUT:                                                       * 00210099
002200*  1. ADJ-JOURNAL-FILE                            (APRD045)     * 00220099
002300*  2. REJECTION-FILE                              (APRD051)     * 00230099
002400*                                                               * 00240099
002500***************************************************************** 00250099
002600* CHANGE LOG:                                                   * 00260099
002700*                                                               * 00270099
002800* 10/11/2021                                                    * 00280099
002900*    CHANGE MADE: FIXED PARAGRAPH E500-CHECK-DUP-INVC TO NOT    * 00290099
002910*    ABEND WHEN THERE IS A DUPLICATE INVOICE.  ALSO ADDED SOME  * 00291099
002920*    DISPLAYS TO TELL US THE WHAT INVOICE HAD A PROBLEM OTHER   * 00292099
002930*    THEN A DUPLICATE OR NOT FOUND.                             * 00293099
003000*                                                               * 00300099
003100* MADE BY: BARB SCHULTZ                        CHG0262437       * 00310099
003101*                                                               * 00310199
003110* 10/14/2021                                                    * 00311099
003120*    CHANGE MADE: MADE NUMEROUS CHANGES THOUGHOUT THE PROGRAM   * 00312099
003130*    BUT MAINLY TO PARAGRAPH E500-CHECKDUP-INVC SO WE ONLY      * 00313099
003140*    HAVE ONE REJECT MESSAGE PER INVOICE.                       * 00314099
003160*                                                               * 00316099
003170* MADE BY: BARB SCHULTZ                        CHG0262703       * 00317099
030001*                                                               * 00318099
029700*   DATE  03/16/2023                                            * 00319099
029800*   CHANGE MADE: RECOMPILE FOR UPDATED COPYBOOKS APWS050 AND    * 00319199
029800*                APRD051                                        * 00319299
030000*      MADE BY: JEAN KURK               WR/IR #: CHG0285404     * 00319399
030001*                                                               * 00319499
003200***************************************************************** 00320099
003300                                                                  00330099
003400 ENVIRONMENT DIVISION.                                            00340099
003500 CONFIGURATION SECTION.                                           00350099
003600 SOURCE-COMPUTER.    IBM-3090.                                    00360099
003700 OBJECT-COMPUTER.    IBM-3090.                                    00370099
003800                                                                  00380099
003900 INPUT-OUTPUT SECTION.                                            00390099
004000 FILE-CONTROL.                                                    00400099
004100     SELECT HALLMARK-IN-FILE  ASSIGN TO UT-S-INP01.               00410099
004200     SELECT ADJ-JOURNAL-FILE  ASSIGN TO UT-S-OUT01.               00420099
004300     SELECT REJECTION-FILE    ASSIGN TO UT-S-OUT02.               00430099
004400                                                                  00440099
004500 DATA DIVISION.                                                   00450099
004600 FILE SECTION.                                                    00460099
004700                                                                  00470099
004800 FD  HALLMARK-IN-FILE                                             00480099
004900     RECORDING MODE IS F                                          00490099
005000     LABEL RECORDS ARE STANDARD                                   00500099
005100     BLOCK CONTAINS 0 RECORDS                                     00510099
005200     DATA RECORD IS HALLMARK-IN-REC.                              00520099
005300 01  HALLMARK-IN-REC.                                             00530099
005400     05  FILLER                       PIC  X(350).                00540099
005500                                                                  00550099
005600 FD  ADJ-JOURNAL-FILE                                             00560099
005700     RECORDING MODE IS F                                          00570099
005800     LABEL RECORDS ARE STANDARD                                   00580099
005900     BLOCK CONTAINS 0 RECORDS                                     00590099
006000     DATA RECORD IS ADJ-JOURNAL-REC.                              00600099
006100 01  ADJ-JOURNAL-REC.                                             00610099
006200     05  FILLER                       PIC  X(500).                00620099
006300                                                                  00630099
006400 FD  REJECTION-FILE                                               00640099
006500     RECORDING MODE IS F                                          00650099
006600     LABEL RECORDS ARE STANDARD                                   00660099
006700     BLOCK CONTAINS 0 RECORDS                                     00670099
006800     DATA RECORD IS REJECTION-REC.                                00680099
006900 01  REJECTION-REC.                                               00690099
007000     05  FILLER                       PIC  X(500).                00700099
007100                                                                  00710099
007200 WORKING-STORAGE SECTION.                                         00720099
007300                                                                  00730099
007400 01  EOF-SW                          PIC X     VALUE 'N'.         00740099
007500     88  IN-EOF                                VALUE 'Y'.         00750099
007600                                                                  00760099
007700 01  PC-ZERO-STR                 PIC X(05) VALUE ZEROS.           00770099
007800 01  PC-LOC-TBL-MAX              PIC S9(09) COMP SYNC             00780099
007900                                           VALUE +2000.           00790099
008000 01  WS-SWITCHES.                                                 00800099
008100     05  FIRST-TIME-SW           PIC X(01) VALUE 'Y'.             00810099
008200         88  WS-FIRST-TIME                 VALUE 'Y'.             00820099
008300         88  WS-NOT-FIRST-TIME             VALUE 'N'.             00830099
008400     05  VALID-STORE-SW          PIC X(01) VALUE ' '.             00840099
008500         88  WS-VALID-STORE                VALUE 'Y'.             00850099
008600         88  WS-VALID-DC                   VALUE 'X'.             00860099
008700         88  WS-NOT-VALID-STORE            VALUE 'N'.             00870099
008800     05  VALID-STORE2-SW         PIC X(01) VALUE ' '.             00880099
008900         88  WS-VALID-STORE2               VALUE 'Y'.             00890099
009000         88  WS-VALID-DC2                  VALUE 'X'.             00900099
009100         88  WS-NOT-VALID-STORE2           VALUE 'N'.             00910099
009200     05  END-OF-EDIIN-FILE       PIC X(1)  VALUE 'N'.             00920099
009300         88  END-OF-EDIIN                  VALUE 'Y'.             00930099
009400         88  NOT-END-OF-EDIIN              VALUE 'N'.             00940099
009500     05  END-OF-LOC-CURSOR       PIC X(1)  VALUE 'N'.             00950099
009600         88  END-OF-LOC-CSR                VALUE 'Y'.             00960099
009700         88  NOT-END-OF-LOC-CSR            VALUE 'N'.             00970099
009800     05  ERR-DETAIL-SUM-GROSS-SW PIC X(1)  VALUE 'N'.             00980099
009900         88  ERR-DETAIL-GROSS-INVOICE      VALUE 'Y'.             00990099
010000         88  NO-ERR-DETAIL-GROSS-INVOICE   VALUE 'N'.             01000099
010100     05  VALID-DUNS-NUMBER-SW    PIC X(1)  VALUE ' '.             01010099
010200         88  WS-VALID-DUNS                 VALUE 'Y'.             01020099
010300         88  WS-NOT-VALID-DUNS             VALUE 'N'.             01030099
010400     05  VALID-UPC-NUMBER-SW     PIC X(1)  VALUE ' '.             01040099
010500         88  WS-VALID-UPC                  VALUE 'Y'.             01050099
010600         88  WS-NOT-VALID-UPC              VALUE 'N'.             01060099
010700     05  WS-DATE-INVALID         PIC  X(1) VALUE SPACE.           01070099
010800         88  WS-VALID-DATE                 VALUE 'Y'.             01080099
010900         88  WS-NOT-VALID-DATE             VALUE 'N'.             01090099
011000     05  WS-ERROR-SW             PIC X(1)  VALUE 'N'.             01100099
011100         88  ERROR-EDI                     VALUE 'Y'.             01110099
011200         88  NO-EDI-ERROR                  VALUE 'N'.             01120099
011300     05  VALID-STORE1-NUMBER-SW      PIC X(1)      VALUE ' '.     01130099
011400         88  WS-VALID-STORE1-DS                    VALUE 'Y'.     01140099
011500         88  WS-VALID-STORE1-CS                    VALUE 'W'.     01150099
011600         88  WS-VALID-DC1                          VALUE 'X'.     01160099
011700         88  WS-VALID-PO1                          VALUE 'Z'.     01170099
011800         88  WS-NOT-VALID-STORE1                   VALUE 'N'.     01180099
011900         88  WS-VALID-STORE1                       VALUE 'Y'.     01190099
012000     05  VALID-STORE2-NUMBER-SW      PIC X(1)      VALUE ' '.     01200099
012100         88  WS-VALID-STORE2-DS                    VALUE 'Y'.     01210099
012200         88  WS-VALID-STORE2-CS                    VALUE 'W'.     01220099
012300         88  WS-VALID-PO2                          VALUE 'Z'.     01230099
012400                                                                  01240099
012500 01  WS-UPC-13.                                                   01250099
012600     05  WS-UPC-ZERO                 PIC 9(01) VALUE ZEROS.       01260099
012700     05  WS-UPC-12                   PIC X(12) VALUE SPACES.      01270099
012800                                                                  01280099
012900 01  WS-INVOICE-COUNTERS.                                         01290099
013000     05  WS-TOT-REC-CNT              PIC 9(3)      VALUE ZEROS.   01300099
013100     05  WS-REJECT-REC-CNT           PIC 9(4)      VALUE ZEROS.   01310099
013200     05  WS-REC-01-CNT               PIC 9(3)      VALUE ZEROS.   01320099
013300     05  WS-REC-02-CNT               PIC 9(3)      VALUE ZEROS.   01330099
013400     05  WS-REC-03-CNT               PIC 9(3)      VALUE ZEROS.   01340099
013500     05  WS-REC-04-CNT               PIC 9(3)      VALUE ZEROS.   01350099
013600     05  WS-REC-05-CNT               PIC 9(3)      VALUE ZEROS.   01360099
013700     05  WS-REC-06-CNT               PIC 9(3)      VALUE ZEROS.   01370099
013800     05  WS-REC-07-CNT               PIC 9(7)      VALUE ZEROS.   01380099
013900     05  WS-REC-OTHER-CNT            PIC 9(3)      VALUE ZEROS.   01390099
014000                                                                  01400099
014100 01  WS-ABEND-FIELDS.                                             01410099
014200     05  WS-ABEND-PROGRAM            PIC X(8)  VALUE 'APKUT373'.  01420099
014300     05  WS-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01430099
014400     05  WS-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01440099
014500     05  WS-ABEND-STRUCTURE-1        PIC X(8)  VALUE SPACES.      01450099
014600     05  WS-ABEND-STRUCTURE-2        PIC X(8)  VALUE SPACES.      01460099
014700     05  WS-ABEND-STATUS             PIC XX    VALUE SPACES.      01470099
014800                                                                  01480099
014900 01  ABEND-CODE                      PIC S9(4) COMP SYNC          01490099
015000                                               VALUE ZEROS.       01500099
015100     88 AP-TABLE-FULL                          VALUE +4004.       01510099
015200     88 AP-EMPTY-FILE                          VALUE +4005.       01520099
015300     88 AP-DB2-ERROR                           VALUE +4013.       01530099
015400                                                                  01540099
015500 01  WS-WORKING-STORAGE.                                          01550099
015600     05  WS-TOT-INPUT-CNT            PIC 9(9)  VALUE ZEROS.       01560099
015700     05  WS-TOT-OUTPUT-CNT           PIC 9(9)  VALUE ZEROS.       01570099
015800     05  WS-TOT-R01-CNT              PIC 9(9)  VALUE ZEROS.       01580099
015900     05  WS-TOT-R07-CNT              PIC 9(9)  VALUE ZEROS.       01590099
016000     05  WS-SAVE-RECORD-TYPE-IND     PIC X(02) VALUE SPACES.      01600099
016100     05  WS-KOHLS-STORE-NBR1         PIC S9(4) COMP VALUE ZEROES. 01610099
016200     05  PV-STORE-9                  PIC X(5)  VALUE SPACES.      01620099
016300     05  PV-STORE-DIGITS             PIC X(5)  VALUE ZERO.        01630099
016400     05  PV-QUANTITY-INVOICED        PIC S9(9) VALUE ZERO.        01640099
016500     05  PV-WHOLSALE-UNIT-COST.                                   01650099
016600         10  PV-WHOLSALE-UNIT-COST1  PIC X(01) VALUE SPACE.       01660099
016700         10  PV-WHOLSALE-UNIT-COST9  PIC S9(6)V999 VALUE ZERO.    01670099
016800     05  PV-WHOLSALE-UNIT-COSTN      PIC S9(7)V999 VALUE ZERO.    01680099
016900     05  WS-RETL-AMT                 PIC S9(7)V99 VALUE ZERO.     01690099
017000     05  WS-UPC-NBR-D                PIC 9(15) VALUE ZEROS.       01700099
017100     05  WS-UPC-CODE                 PIC 9(13) VALUE ZEROS.       01710099
017200     05  WS-UPC-CODE-X REDEFINES WS-UPC-CODE PIC X(13).           01720099
017300     05  WS-UPC-CODE-COMP3           PIC S9(15) COMP-3            01730099
017400                                               VALUE ZEROS.       01740099
017500     05  WS-DUN-NBR-9S               PIC  9(09)    VALUE ZEROS.   01750099
017600     05  WS-DUN-NBR-X  REDEFINES WS-DUN-NBR-9S PIC X(09).         01760099
017700     05  WS-INVOICE-WITH-SUFFIX      PIC X(22) VALUE SPACES.      01770099
017800     05  WS-SAVE-DUN-INV-NBR         PIC X(31) VALUE SPACES.      01780099
017900     05  WS-DASH-DUN-INV-NBR         PIC X(31) VALUE SPACES.      01790099
018000     05  WS-DIFFERENCE               PIC S9(08)V99 VALUE 0.       01800099
018100     05  WS-LAST-REC-TYPE            PIC X(02) VALUE SPACES.      01810099
018110     05  WS-FIRST-REC-TYPE           PIC X(02) VALUE SPACES.      01811099
018200     05  WS-TRDPRT-ENT-ID            PIC S9(09) COMP VALUE ZEROS. 01820099
018300     05  WS-EXTENT-DUN-NBR           PIC X(09) VALUE SPACES.      01830099
018400         88 WS-HIGH-LIMIT-VENDOR         VALUES '003949435'       01840099
018500                                              , '000570275'       01850099
018600                                              , '029216363'       01860099
018700                                              , '076735463'       01870099
018800                                              , '009206194'       01880099
018900                                              , '000570960'.      01890099
019000         88 WS-VENDOR-IS-LI-FUNG         VALUE  '009206194'.      01900099
019100                                                                  01910099
019200     05  WS-VENDOR-INVOICE-NBR     PIC X(22)  VALUE SPACES.       01920099
019300     05  WS-SAVE-INVOICE-NBR       PIC X(22)  VALUE SPACES.       01930099
019310     05  WS-SAVE-VND-INV-NBR       PIC X(22)  VALUE SPACES.       01931099
019400     05  WS-SAVE-EDI-SEQ-NBR       PIC X(05)  VALUE SPACES.       01940099
019500     05  WS-SAVE-INVOICE-DATE      PIC X(06)   VALUE '000000'.    01950099
019600     05  WS-SAVE-INV-DATE  REDEFINES WS-SAVE-INVOICE-DATE.        01960099
019700         10  WS-SAVE-INV-YY        PIC X(02).                     01970099
019800         10  WS-SAVE-INV-MM        PIC X(02).                     01980099
019900         10  WS-SAVE-INV-DD        PIC X(02).                     01990099
020000     05  WS-SAVE-SHIPPED-DATE      PIC X(06)   VALUE '000000'.    02000099
020100     05  WS-SAVE-SHIP-DATE REDEFINES WS-SAVE-SHIPPED-DATE.        02010099
020200         10  WS-SAVE-SHIP-YY       PIC X(02).                     02020099
020300         10  WS-SAVE-SHIP-MM       PIC X(02).                     02030099
020400         10  WS-SAVE-SHIP-DD       PIC X(02).                     02040099
020500     05  WS-SAVE-EFFECTIVE-DATE    PIC X(06)   VALUE '000000'.    02050099
020600     05  WS-SAVE-EFF-DATE REDEFINES WS-SAVE-EFFECTIVE-DATE.       02060099
020700         10  WS-SAVE-EFF-YY        PIC X(02).                     02070099
020800         10  WS-SAVE-EFF-MM        PIC X(02).                     02080099
020900         10  WS-SAVE-EFF-DD        PIC X(02).                     02090099
021000     05  WS-CCYYMMDD.                                             02100099
021100         10  WS-CENTURY              PIC X(02)     VALUE '00'.    02110099
021200         10  WS-YYMMDD.                                           02120099
021300             15  WS-YY               PIC X(02)     VALUE '00'.    02130099
021400             15  WS-MM               PIC X(02)     VALUE '00'.    02140099
021500             15  WS-DD               PIC X(02)     VALUE '00'.    02150099
021600     05  WS-DTE.                                                  02160099
021700         10  WS-CC                   PIC X(02)     VALUE '00'.    02170099
021800         10  WS-YEAR                 PIC X(02)     VALUE '00'.    02180099
021900         10  FILLER                  PIC X(01)     VALUE '-'.     02190099
022000         10  WS-MONTH                PIC X(02)     VALUE '00'.    02200099
022100         10  FILLER                  PIC X(01)     VALUE '-'.     02210099
022200         10  WS-DAY                  PIC X(02)     VALUE '00'.    02220099
022300                                                                  02230099
022400 01  WS-PROGRAM-COUNTERS.                                         02240099
022500     05  WS-EDIIN-REC-CNT          PIC 9(9)  VALUE ZEROES.        02250099
022600     05  WS-TOT-INVC-LINES         PIC 9(8)  VALUE ZEROS.         02260099
022700     05  WS-SAVE-SUBCLASS.                                        02270099
022800         10  WS-SAVE-SUBCL-B       PIC X(02) VALUE SPACES.        02280099
022900         10  WS-SAVE-SUBCL-E       PIC X(02) VALUE SPACES.        02290099
023000     05  WS-SAVE-SUBCLASS-R REDEFINES WS-SAVE-SUBCLASS PIC X(04). 02300099
023100     05  WS-SAVE-DEPT.                                            02310099
023200         10  WS-SAVE-DEPT-B        PIC X(01) VALUE SPACES.        02320099
023300         10  WS-SAVE-DEPT-E        PIC X(03) VALUE SPACES.        02330099
023400     05  WS-SAVE-DEPT-R REDEFINES WS-SAVE-DEPT PIC X(04).         02340099
023500                                                                  02350099
023600     05  WS-SAVE-STORE-NBR         PIC X(05) VALUE SPACES.        02360099
023700     05  WS-SAVE-STORE-NBR1        PIC X(05) VALUE SPACES.        02370099
023800     05  WS-SAVE-STORE-NBR-FOR-DC  PIC X(05) VALUE SPACES.        02380099
023900     05  WS-SAVE-STORE-NBR2        PIC X(05) VALUE SPACES.        02390099
024000     05  WS-SAVE-STORE-NBR2-9      PIC S9(4) COMP VALUE 0.        02400099
024100     05  WS-SAVE-STORE-NBR2-9-UNPK PIC S9(4) VALUE 0.             02410099
024200                                                                  02420099
024300     05  WS-SAVE-GROSS-INVOICE-AMT   PIC S9(08)V99 VALUE ZEROS.   02430099
024400     05  WS-SAVE-DISC-INVC-AMT       PIC S9(08)V99 VALUE ZEROS.   02440099
024500     05  WS-SAVE-NET-COST            PIC S9(08)V99 VALUE ZEROS.   02450099
024600     05  WS-SAVE-INTERCHG-CNTL-NBR   PIC X(09)     VALUE SPACES.  02460099
024700     05  WS-DETAIL-GROSS-INVOICE-AMT PIC S9(08)V99 VALUE ZEROS.   02470099
024800     05  WS-DETAIL-ADJ-GROSS-INV-AMT PIC S9(08)V99 VALUE ZEROS.   02480099
024900     05  WS-DETAIL-ALLW-AMT-NEW      PIC S9(08)V99 VALUE ZEROS.   02490099
025000     05  WS-DETAIL-ALLW-AMT          PIC S9(08)V99 VALUE ZEROS.   02500099
025100     05  WS-DETAIL-CHRG-AMT          PIC S9(08)V99 VALUE ZEROS.   02510099
025200     05  WS-UNT-RTL-AMT-D            PIC S9(7)V9(2) VALUE ZERO.   02520099
025300     05  WS-UNT-RTL-AMT              PIC S9(7)V9(2) COMP-3        02530099
025400                                                   VALUE ZEROS.   02540099
025500     05  WS-CALC-EXTEN-INVOIC-AMT    PIC S9(08)V999 VALUE ZEROS.  02550099
025600                                                                  02560099
025700 01  WS-TABLE-AREA.                                               02570099
025800     05  WS-INVOICE-TABLE OCCURS 11000 TIMES INDEXED BY INV-INDX. 02580099
025900         10  WS-INV-REC.                                          02590099
026000             15  WS-AP050-KEY-AREA.                               02600099
026100                 20  WS-AP050-PO-NBR         PIC X(09).           02610099
026200                 20  WS-AP050-INV-NBR        PIC X(22).           02620099
026300                 20  WS-AP050-REC-TYPE       PIC X(02).           02630099
026400                 20  WS-AP050-FILLER1        PIC X(01).           02640099
026500                 20  WS-AP050-EDI-SEQ        PIC X(05).           02650099
026600                 20  WS-AP050-SORT-MTCH-LVL  PIC X(01).           02660099
026700                 20  WS-AP050-SORT-LOC       PIC X(05).           02670099
026800                 20  WS-AP050-FILLER2        PIC X(05).           02680099
026900             15  WS-AP050-DATA-AREA          PIC X(300).          02690099
027000         10  WS-INV-ERR-TBL-AREA.                                 02700099
027100             15  WS-INV-ERR-TBL  OCCURS 25 TIMES                  02710099
027200                                 INDEXED BY REJ-INDX.             02720099
027300                 20  WS-INV-ERR-CD       PIC 9(2).                02730099
027400                                                                  02740099
027500 01  WS-LOCATION-TABLE-AREA.                                      02750099
027600     05 WS-LOCATION-TABLE OCCURS 2000 TIMES INDEXED BY LOC-INDX.  02760099
027700        10  WS-STORE-NBR        PIC X(05).                        02770099
027800        10  WS-STORE-TYP-CDE    PIC X(2).                         02780099
027900                                                                  02790099
028000*--------------------------------------------------------------*  02800099
028100* GREGORIAN/JULIAN DATE CONVERSION                             *  02810099
028200*--------------------------------------------------------------*  02820099
028300     COPY DPWS500.                                                02830099
028400                                                                  02840099
028500*--------------------------------------------------------------*  02850099
028600* NEW EDI INVOICE INPUT LAYOUT                                 *  02860099
028700*--------------------------------------------------------------*  02870099
028800 01  FILLER                      PIC X(35)  VALUE                 02880099
028900     'BEGINNING OF AP050 INPUT FILE    **'.                       02890099
029000 01  AP050-EDI-IN-FILE.                                           02900099
029100     COPY APRD050.                                                02910099
029200                                                                  02920099
029300*--------------------------------------------------------------** 02930099
029400* AP WORK RECORD AREA                                          ** 02940099
029500*--------------------------------------------------------------** 02950099
029600 01  FILLER                      PIC X(35)  VALUE                 02960099
029700     'BEGINNING OF AP WORK RECORD AREA **'.                       02970099
029800 01  WS-WORK-REC.                                                 02980099
029900     COPY APRD050.                                                02990099
030000                                                                  03000099
030100*--------------------------------------------------------------*  03010099
030200* REJECTED EDI INVOICE OUTPUT LAYOUT                           *  03020099
030300*--------------------------------------------------------------*  03030099
030400 01  FILLER                      PIC X(35)  VALUE                 03040099
030500     'BEGINNING OF REJECT  RECORD AREA **'.                       03050099
030600 01  WS-REJECT-REC.                                               03060099
030700     COPY APRD051.                                                03070099
030800                                                                  03080099
030900*--------------------------------------------------------------*  03090099
031000* EDI INVOICE EDIT CODES AND MESSAGES                          *  03100099
031100*--------------------------------------------------------------*  03110099
031200 01  FILLER                      PIC X(35)  VALUE                 03120099
031300     'BEGINNING OF AP050 EDIT CODE FILE**'.                       03130099
031400 01  WS-EDIT-CODES.                                               03140099
031500     COPY APWS050.                                                03150099
031600                                                                  03160099
031700*--------------------------------------------------------------*  03170099
031800* ADJUSTMENT JOURNAL TRANSACTION FILE                             03180099
031900*--------------------------------------------------------------*  03190099
032000     COPY APRD045.                                                03200099
032100                                                                  03210099
032200*--------------------------------------------------------------*  03220099
032300* SQLCA FORMATTED MESSAGE AREA                                 *  03230099
032400*--------------------------------------------------------------*  03240099
032500     COPY DPWS004.                                                03250099
032600                                                                  03260099
032700*----------------------------------------------------------------*03270099
032800*    ABEND PROCESSING COPYBOOK.                                  *03280099
032900*----------------------------------------------------------------*03290099
033000     COPY DPWS013.                                                03300099
033100                                                                  03310099
033200*--------------------------------------------------------------*  03320099
033300* COMMUNICATIONS AREA2 FOR DB2                                 *  03330099
033400*--------------------------------------------------------------*  03340099
033500     COPY SQLCA2.                                                 03350099
033600                                                                  03360099
033700     EXEC SQL                                                     03370099
033800          INCLUDE SQLCA                                           03380099
033900     END-EXEC.                                                    03390099
034000                                                                  03400099
034100*--------------------------------------------------------------*  03410099
034200* LOCATION TABLE                                               *  03420099
034300*--------------------------------------------------------------*  03430099
034400     EXEC SQL                                                     03440099
034500          INCLUDE XFT00017                                        03450099
034600     END-EXEC.                                                    03460099
034700                                                                  03470099
034800*--------------------------------------------------------------*  03480099
034900* ADJUSTMENT JOURNAL TABLE                                     *  03490099
035000*--------------------------------------------------------------*  03500099
035100     EXEC SQL                                                     03510099
035200          INCLUDE TADJRNL                                         03520099
035300     END-EXEC.                                                    03530099
035400                                                                  03540099
035500*--------------------------------------------------------------*  03550099
035600* MERCHANDISE BUSINESS TABLE - TMDSEAR                         *  03560099
035700*--------------------------------------------------------------*  03570099
035800     EXEC SQL                                                     03580099
035900          INCLUDE TMDSEAR                                         03590099
036000     END-EXEC.                                                    03600099
036100                                                                  03610099
036200*--------------------------------------------------------------*  03620099
036300* DEPT TABLE FOR VENDOR MANAGEMENT - TVNDDPT                   *  03630099
036400*--------------------------------------------------------------*  03640099
036500     EXEC SQL                                                     03650099
036600          INCLUDE TVNDDPT                                         03660099
036700     END-EXEC.                                                    03670099
036800                                                                  03680099
036900*--------------------------------------------------------------*  03690099
037000* EXTERNAL ENTERPRISE VENDOR TABLE                             *  03700099
037100*--------------------------------------------------------------*  03710099
037200     EXEC SQL                                                     03720099
037300          INCLUDE TEXTENT                                         03730099
037400     END-EXEC.                                                    03740099
037500                                                                  03750099
037600*--------------------------------------------------------------*  03760099
037700* EXTERNAL ENTERPRISE VENDOR TABLE                             *  03770099
037800*--------------------------------------------------------------*  03780099
037900     EXEC SQL                                                     03790099
038000          INCLUDE TENTNME                                         03800099
038100     END-EXEC.                                                    03810099
038200                                                                  03820099
038300*--------------------------------------------------------------*  03830099
038400* UPC PRICE LOOKUP TABLE                                       *  03840099
038500*--------------------------------------------------------------*  03850099
038600     EXEC SQL                                                     03860099
038700          INCLUDE TUPCPLS                                         03870099
038800     END-EXEC.                                                    03880099
038900                                                                  03890099
039000*--------------------------------------------------------------*  03900099
039100* SKU CROSS REFERENCE TABLE                                    *  03910099
039200*--------------------------------------------------------------*  03920099
039300     EXEC SQL                                                     03930099
039400          INCLUDE TUPCSKU                                         03940099
039500     END-EXEC.                                                    03950099
039600                                                                  03960099
039700*--------------------------------------------------------------*  03970099
039800*    TSKXREF IS THE DCLGEN MEMBER FOR THE SKU CROSS REFERENCE  *  03980099
039900*      TABLE.                                                  *  03990099
040000*--------------------------------------------------------------*  04000099
040100                                                                  04010099
040200     EXEC SQL                                                     04020099
040300          INCLUDE TSKXREF                                         04030099
040400     END-EXEC.                                                    04040099
040500                                                                  04050099
040600*--------------------------------------------------------------*  04060099
040700* LOCATION CURSOR: RETURNS THE LOCATION NUMBERS AND THEIR TYPE *  04070099
040800* CODES FROM THE DOMAIN LOCATION TABLES TO ALLOW VALIDATION OF *  04080099
040900* STORE NUMBERS ON THE INCOMING INVOICES.                      *  04090099
041000*--------------------------------------------------------------*  04100099
041100     EXEC SQL                                                     04110099
041200          DECLARE LOCATION_CSR CURSOR FOR                         04120099
041300            SELECT DIGITS(LOC_NBR)                                04130099
041400                 , LOC_TYP_CDE                                    04140099
041500              FROM XFT_LOC                                        04150099
041600             WHERE LOC_TYP_CDE IN ('DS', 'DC')                    04160099
041700               AND CURRENT DATE <= FINCL_CLO_DTE                  04170099
041800     END-EXEC.                                                    04180099
041900                                                                  04190099
042000 PROCEDURE DIVISION.                                              04200099
042100 A100-MAIN.                                                       04210099
042200                                                                  04220099
042300     PERFORM B100-INITIALIZE.                                     04230099
042400                                                                  04240099
042500     PERFORM B200-PROCESS                                         04250099
042600         UNTIL END-OF-EDIIN.                                      04260099
042700                                                                  04270099
042710     IF NO-EDI-ERROR                                              04271099
042800        PERFORM W100-WRITE-OUTPUT                                 04280099
042801     ELSE                                                         04280199
042802        IF ERROR-EDI                                              04280299
042803            PERFORM W300-WRITE-REJECT                             04280399
042804        END-IF                                                    04280499
042810     END-IF.                                                      04281099
042900                                                                  04290099
043000     DISPLAY 'TOTAL INPUT COUNT  ' WS-TOT-INPUT-CNT.              04300099
043100     DISPLAY 'TOTAL OUTPUT COUNT ' WS-TOT-OUTPUT-CNT.             04310099
043200     DISPLAY 'TOTAL RECORD 01 COUNT ' WS-TOT-R01-CNT.             04320099
043300     DISPLAY 'TOTAL RECORD 07 COUNT ' WS-TOT-R07-CNT.             04330099
043400                                                                  04340099
043500     CLOSE HALLMARK-IN-FILE                                       04350099
043600           ADJ-JOURNAL-FILE                                       04360099
043700           REJECTION-FILE.                                        04370099
043800                                                                  04380099
043900     GOBACK.                                                      04390099
044000                                                                  04400099
044100*----------------------------------------------------------------*04410099
044200*    INITIALIZATION PROCESSING                                   *04420099
044300*----------------------------------------------------------------*04430099
044400 B100-INITIALIZE.                                                 04440099
044500                                                                  04450099
044600     OPEN INPUT  HALLMARK-IN-FILE                                 04460099
044700          OUTPUT ADJ-JOURNAL-FILE                                 04470099
044800                 REJECTION-FILE.                                  04480099
044900                                                                  04490099
045000     INITIALIZE AP045-TRANSACTION-FILE                            04500099
045100                AP051-KEY                                         04510099
045200                AP051-DATA-AREA                                   04520099
045300                AP051-ERROR-CODE-AREA.                            04530099
045400                                                                  04540099
045500     PERFORM VARYING INV-INDX FROM 1 BY 1                         04550099
045600        UNTIL INV-INDX > 11000                                    04560099
045700        MOVE HIGH-VALUES TO WS-AP050-KEY-AREA(INV-INDX)           04570099
045800        INITIALIZE WS-AP050-DATA-AREA(INV-INDX)                   04580099
045900        INITIALIZE WS-INV-ERR-TBL-AREA(INV-INDX)                  04590099
046000     END-PERFORM.                                                 04600099
046100                                                                  04610099
046200     INITIALIZE DCLTENTNME                                        04620099
046300                DCLTEXTENT                                        04630099
046400                DCLXFT00017                                       04640099
046500                DCLTUPCSKU.                                       04650099
046600                                                                  04660099
046700     MOVE '000000' TO WS-SAVE-INVOICE-DATE                        04670099
046800                      WS-SAVE-SHIPPED-DATE                        04680099
046900                      WS-SAVE-EFFECTIVE-DATE.                     04690099
047000     INITIALIZE    WS-INVOICE-COUNTERS.                           04700099
047010     SET NO-EDI-ERROR   TO TRUE.                                  04701099
047100                                                                  04710099
047200     SET INV-INDX TO 1.                                           04720099
047300     SET INV-INDX DOWN BY 1.                                      04730099
047400                                                                  04740099
047500     PERFORM X100-OPEN-LOCATION-CSR.                              04750099
047600     PERFORM X200-LOAD-LOCATION-TBL.                              04760099
047700     PERFORM X300-CLOSE-LOCATION-CSR.                             04770099
047800     PERFORM X500-COMMIT.                                         04780099
047900                                                                  04790099
048000     PERFORM R100-READ-INPUT.                                     04800099
048100     IF END-OF-EDIIN                                              04810099
048200        DISPLAY '**********************************'              04820099
048300        DISPLAY '*   EMPTY EDI INVOICE FILE       *'              04830099
048400        DISPLAY '*   PROGRAM ** = APKUT373        *'              04840099
048500        DISPLAY '**********************************'              04850099
048600        CALL 'ILBOABN0' USING ABEND-CODE                          04860099
048700     ELSE                                                         04870099
048800        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'      04880099
048900            MOVE AP050-INTRCHG-CNTL-NBR OF AP050-EDI-IN-FILE      04890099
049000                         TO WS-SAVE-INTERCHG-CNTL-NBR             04900099
049100        ELSE                                                      04910099
049200            MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR         04920099
049300        END-IF                                                    04930099
049400     END-IF.                                                      04940099
049500                                                                  04950099
049600*----------------------------------------------------------------*04960099
049700*    REFORMAT EACH INPUT RECORD TO THE OUTPUT TEXT FORMAT.       *04970099
049800*----------------------------------------------------------------*04980099
049900 B200-PROCESS.                                                    04990099
050000                                                                  05000099
050300     MOVE AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE           05030099
050400                                   TO AP045-DOC-NBR               05040099
050500                                      WS-VENDOR-INVOICE-NBR.      05050099
050600     MOVE '2'                      TO AP045-RECD-TYP-CDE.         05060099
050700                                                                  05070099
050760                                                                  05076099
050800     PERFORM E200-EDIT-ONE.                                       05080099
050900                                                                  05090099
051400     MOVE SPACES                  TO AP045-PO-NBR                 05140099
051500                                     AP045-AP-TRN-CDE             05150099
051600                                     AP045-GL-ACCT-NBR            05160099
051700                                     AP045-PSTG-TYP-CDE           05170099
051800                                     AP045-TRN-TYP-CDE            05180099
051900                                     AP045-ENTR-TMST              05190099
052000                                     AP045-ENTR-ID                05200099
052100                                     AP045-ORGN-CDE               05210099
052200                                     AP045-INV-CUTOFF-DTE         05220099
052300                                     AP045-BAR-CDE                05230099
052400                                     AP045-PS-BTCH-NBR            05240099
052500                                     AP045-RSN-TXT                05250099
052600                                     AP045-PSTG-FYR-NBR           05260099
052700                                     AP045-PSTG-FMN-NBR           05270099
052800                                     AP045-PSTG-FWK-NBR           05280099
052900                                     AP045-AUTH-NBR               05290099
053000                                     AP045-AUTO-OTP-PSTG-IND      05300099
053100                                     AP045-AP-PSTG-IND.           05310099
053200     MOVE 'N'                     TO AP045-DOC-HLD-CDE.           05320099
053300                                                                  05330099
053400     MOVE ZERO                    TO AP045-TERM-DISC-PCT          05340099
053500                                     AP045-NW-STR-DISC-PCT        05350099
053600                                     AP045-SALES-TAX-AMT          05360099
053700                                     AP045-TRD-DISC-PCT           05370099
053800                                     AP045-TERM-DISC-PCT          05380099
053900                                     AP045-MOS-DISC-PCT           05390099
054000                                     AP045-ADV-DISC-PCT           05400099
054100                                     AP045-FRGT-AMT               05410099
054200                                     AP045-MISC-CHRG-AMT          05420099
054300                                     AP045-DTL-TERM-DISC-AMT      05430099
054400                                     AP045-DTL-NW-STR-DISC-AMT    05440099
054500                                     AP045-DTL-TRD-DISC-AMT       05450099
054600                                     AP045-DTL-MOS-DISC-AMT       05460099
054700                                     AP045-SALES-TAX-AMT.         05470099
054800                                                                  05480099
054900     COMPUTE WS-RETL-AMT = PV-QUANTITY-INVOICED *                 05490099
055000                           WS-UNT-RTL-AMT.                        05500099
055100     MOVE WS-RETL-AMT TO AP045-RETL-AMT.                          05510099
055200                                                                  05520099
055300     PERFORM R100-READ-INPUT.                                     05530099
055400                                                                  05540099
055500*--------------------------------------------------------------*  05550099
055600* THIS PARAGRAPH PERFORMS THE FOLLOWING EDITS:                 *  05560099
055700*  -- VERIFIES THAT THERE IS ONLY ONE OF EACH SPECIFIC RECORD  *  05570099
055800*     TYPE                                                     *  05580099
055900*  -- VERIFIES THAT ALL NECESSARY FIELDS ARE POPULATED WITH    *  05590099
056000*     DATA                                                     *  05600099
056100*  -- VERIFIES THAT DATES ARE FORMATTED CORRECTLY              *  05610099
056200*  -- VERIFIES THAT NEGATIVE NUMERIC FIELDS DO NOT EXIST       *  05620099
056300*  -- DETERMINES THE MATCH LEVEL, STORE NUMBER, AND DC NUMBER  *  05630099
056400*     FOR EACH INVOICE                                         *  05640099
056500*  -- DETERMINES THE ITEM NUMBER IF THE UPC IS VALID           *  05650099
056600*  -- RETRIEVES THE PO_LNE_NBR AND STYLE CODE IF THE UPC/SKU   *  05660099
056700*     IS NOT FOUND OR INVALID                                  *  05670099
056800*  -- VERIFIES ANY ALLOWANCE AND/OR CHARGES                    *  05680099
056900*--------------------------------------------------------------*  05690099
057000                                                                  05700099
057100 E200-EDIT-ONE.                                                   05710099
057200                                                                  05720099
057300     SET INV-INDX UP BY 1                                         05730099
057400     MOVE AP050-EDI-IN-FILE TO WS-INV-REC(INV-INDX).              05740099
057500                                                                  05750099
057600     SET REJ-INDX TO 1.                                           05760099
057700     SET REJ-INDX DOWN BY 1.                                      05770099
057800                                                                  05780099
057900*---------------------------------------------------------------  05790099
058000* RECORD TYPE VALIDATION -- VERIFIES THAT THERE IS ONLY ONE       05800099
058100* OF EACH SPECIFIC RECORD TYPE                                    05810099
058200*---------------------------------------------------------------  05820099
058300     MOVE AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE TO           05830099
058400                                   WS-SAVE-RECORD-TYPE-IND        05840099
058500     EVALUATE AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE          05850099
058600        WHEN '01'                                                 05860099
058700             ADD 1 TO WS-REC-01-CNT                               05870099
058800                      WS-TOT-R01-CNT                              05880099
058900             MOVE '01' TO WS-LAST-REC-TYPE                        05890099
058920                          WS-FIRST-REC-TYPE                       05892099
059000             IF WS-REC-01-CNT > 1                                 05900099
059100                IF REJ-INDX NOT = 25                              05910099
059200                   SET REJ-INDX UP BY 1                           05920099
059300                END-IF                                            05930099
059400                SET ERROR-EDI TO TRUE                             05940099
059500                SET MULT-01-REC-CD TO TRUE                        05950099
059600                MOVE EDI-ERROR-CD TO                              05960099
059700                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            05970099
059800             END-IF                                               05980099
059900        WHEN '02'                                                 05990099
060000             ADD 1 TO WS-REC-02-CNT                               06000099
060100             MOVE '02' TO WS-LAST-REC-TYPE                        06010099
060200             IF WS-REC-02-CNT > 1                                 06020099
060300                IF REJ-INDX NOT = 25                              06030099
060400                   SET REJ-INDX UP BY 1                           06040099
060500                END-IF                                            06050099
060600                SET ERROR-EDI TO TRUE                             06060099
060700                SET MULT-02-REC-CD TO TRUE                        06070099
060800                MOVE EDI-ERROR-CD TO                              06080099
060900                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06090099
061000             ELSE                                                 06100099
061100                MOVE AP050-INVOICE-DATE OF AP050-EDI-IN-FILE      06110099
061200                               TO  WS-SAVE-INVOICE-DATE           06120099
061300                MOVE AP050-DATE-SHIPPED OF AP050-EDI-IN-FILE      06130099
061400                               TO  WS-SAVE-SHIPPED-DATE           06140099
061500                MOVE AP050-EFFECTIVE-DATE OF AP050-EDI-IN-FILE    06150099
061600                               TO  WS-SAVE-EFFECTIVE-DATE         06160099
061700             END-IF                                               06170099
061800             IF WS-REC-01-CNT = 0                                 06180099
061900                IF REJ-INDX NOT = 25                              06190099
062000                   SET REJ-INDX UP BY 1                           06200099
062100                END-IF                                            06210099
062200                SET ERROR-EDI TO TRUE                             06220099
062300                SET NO-01-REC-CD TO TRUE                          06230099
062400                MOVE EDI-ERROR-CD TO                              06240099
062500                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06250099
062600             END-IF                                               06260099
062700        WHEN '03'                                                 06270099
062800             ADD 1 TO WS-REC-03-CNT                               06280099
062900             MOVE '03' TO WS-LAST-REC-TYPE                        06290099
063000             IF WS-REC-03-CNT > 1                                 06300099
063100                IF REJ-INDX NOT = 25                              06310099
063200                   SET REJ-INDX UP BY 1                           06320099
063300                END-IF                                            06330099
063400                SET ERROR-EDI TO TRUE                             06340099
063500                SET MULT-03-REC-CD TO TRUE                        06350099
063600                MOVE EDI-ERROR-CD TO                              06360099
063700                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06370099
063800                MOVE ZEROES    TO AP045-ENT-ID                    06380099
063900                                  WS-TRDPRT-ENT-ID                06390099
064000                MOVE SPACES    TO AP045-ENT-NME-DESC              06400099
064100                                  ENTNME-ENT-NAME-DESC            06410099
064200                                  AP045-VND-NBR                   06420099
064300             ELSE                                                 06430099
064400                MOVE AP050-REMIT-VNDR-DUNS-NBR                    06440099
064500                                        OF AP050-EDI-IN-FILE      06450099
064600                                  TO  WS-DUN-NBR-9S               06460099
064700                MOVE WS-DUN-NBR-X TO  AP045-VND-NBR               06470099
064800                PERFORM R950-SELECT-TENTNME                       06480099
064900                IF SQLCODE = ZERO                                 06490099
065000                  MOVE ENTNME-ENT-NAME-DESC TO AP045-ENT-NME-DESC 06500099
065100                  MOVE EXTENT-ENT-ID        TO AP045-ENT-ID       06510099
065200                                               WS-TRDPRT-ENT-ID   06520099
065300                ELSE                                              06530099
065400                  MOVE ZEROES               TO AP045-ENT-ID       06540099
065500                                               WS-TRDPRT-ENT-ID   06550099
065600                  MOVE SPACES               TO AP045-ENT-NME-DESC 06560099
065700                END-IF                                            06570099
065800             END-IF                                               06580099
065840                                                                  06584099
065900        WHEN '04'                                                 06590099
066000             ADD 1 TO WS-REC-04-CNT                               06600099
066100             MOVE '04' TO WS-LAST-REC-TYPE                        06610099
066200             IF WS-REC-04-CNT > 1                                 06620099
066300                IF REJ-INDX NOT = 25                              06630099
066400                   SET REJ-INDX UP BY 1                           06640099
066500                END-IF                                            06650099
066600                SET ERROR-EDI TO TRUE                             06660099
066700                SET MULT-04-REC-CD TO TRUE                        06670099
066800                MOVE EDI-ERROR-CD   TO                            06680099
066900                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06690099
067000             END-IF                                               06700099
067100        WHEN '06'                                                 06710099
067200             ADD 1 TO WS-REC-06-CNT                               06720099
067300             MOVE '06' TO WS-LAST-REC-TYPE                        06730099
067400             IF WS-REC-06-CNT > 1                                 06740099
067500                IF REJ-INDX NOT = 25                              06750099
067600                   SET REJ-INDX UP BY 1                           06760099
067700                END-IF                                            06770099
067800                SET ERROR-EDI TO TRUE                             06780099
067900                SET MULT-06-REC-CD TO TRUE                        06790099
068000                MOVE EDI-ERROR-CD   TO                            06800099
068100                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06810099
068200             END-IF                                               06820099
068300             IF WS-REC-02-CNT = 0                                 06830099
068400                IF REJ-INDX NOT = 25                              06840099
068500                   SET REJ-INDX UP BY 1                           06850099
068600                END-IF                                            06860099
068700                SET ERROR-EDI TO TRUE                             06870099
068800                SET NO-02-REC-CD TO TRUE                          06880099
068900                MOVE EDI-ERROR-CD TO                              06890099
069000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            06900099
069100             END-IF                                               06910099
069200        WHEN '07'                                                 06920099
069300             ADD 1 TO WS-REC-07-CNT                               06930099
069400                      WS-TOT-R07-CNT                              06940099
069500             MOVE '07' TO WS-LAST-REC-TYPE                        06950099
069600             INITIALIZE PV-WHOLSALE-UNIT-COSTN                    06960099
069700             MOVE AP050-WHOLSALE-UNIT-COST OF AP050-EDI-IN-FILE   06970099
069800                     TO PV-WHOLSALE-UNIT-COST                     06980099
069900             IF PV-WHOLSALE-UNIT-COST1 = '-'                      06990099
070000                MULTIPLY PV-WHOLSALE-UNIT-COST9 BY -1 GIVING      07000099
070100                        PV-WHOLSALE-UNIT-COSTN                    07010099
070200             ELSE                                                 07020099
070300                MOVE AP050-WHOLSALE-UNIT-COST OF AP050-EDI-IN-FILE07030099
070400                     TO PV-WHOLSALE-UNIT-COSTN                    07040099
070500             END-IF                                               07050099
070600             INITIALIZE PV-QUANTITY-INVOICED                      07060099
070700             MOVE AP050-QUANTITY-INVOICED OF AP050-EDI-IN-FILE    07070099
070800                     TO PV-QUANTITY-INVOICED                      07080099
070900             COMPUTE WS-CALC-EXTEN-INVOIC-AMT ROUNDED             07090099
071000                   =    PV-QUANTITY-INVOICED                      07100099
071100                   *    PV-WHOLSALE-UNIT-COSTN                    07110099
071200             MOVE WS-CALC-EXTEN-INVOIC-AMT TO AP045-GRO-COST-AMT  07120099
071300                                              AP045-NET-COST-AMT  07130099
071400                                                                  07140099
071500        WHEN OTHER                                                07150099
071600             ADD 1 TO WS-REC-OTHER-CNT                            07160099
071700             IF REJ-INDX NOT = 25                                 07170099
071800                SET REJ-INDX UP BY 1                              07180099
071900             END-IF                                               07190099
072000             SET ERROR-EDI TO TRUE                                07200099
072100             SET INVALID-REC-TYPE-CD TO TRUE                      07210099
072200             DISPLAY 'INVALID-REC-TYPE-CD '                       07220099
072300               AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE         07230099
072400             MOVE EDI-ERROR-CD TO                                 07240099
072500                  WS-INV-ERR-CD(INV-INDX, REJ-INDX)               07250099
072600     END-EVALUATE.                                                07260099
072700                                                                  07270099
072800*---------------------------------------------------------------  07280099
072900* REQUIRED FIELD VALIDATION -- VERIFIES THAT ALL REQUIRED         07290099
073000* FIELDS AND 88 LEVEL ENTRIES ARE POPULATED WITH DATA             07300099
073100*---------------------------------------------------------------  07310099
073200     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'         07320099
073300        IF AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE = SPACES 07330099
073400           IF REJ-INDX NOT = 25                                   07340099
073500              SET REJ-INDX UP BY 1                                07350099
073600           END-IF                                                 07360099
073700           SET ERROR-EDI TO TRUE                                  07370099
073800           SET NO-INV-NBR-CD TO TRUE                              07380099
073900           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 07390099
074000        END-IF                                                    07400099
074100     END-IF.                                                      07410099
074200                                                                  07420099
074300     SET WS-VALID-DATE TO TRUE.                                   07430099
074400     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '02'         07440099
074500        IF AP050-INVOICE-DATE OF AP050-EDI-IN-FILE NOT NUMERIC    07450099
074600        OR AP050-INVOICE-DATE OF AP050-EDI-IN-FILE = '000000'     07460099
074700           IF REJ-INDX NOT = 25                                   07470099
074800              SET REJ-INDX UP BY 1                                07480099
074900           END-IF                                                 07490099
075000           SET ERROR-EDI TO TRUE                                  07500099
075100           SET NO-INV-DATE-CD TO TRUE                             07510099
075200           MOVE EDI-ERROR-CD TO                                   07520099
075300                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         07530099
075400        ELSE                                                      07540099
075500           MOVE AP050-INVOICE-DATE OF AP050-EDI-IN-FILE           07550099
075600                                                  TO WS-YYMMDD    07560099
075700           PERFORM E400-CHECK-DATE                                07570099
075800           IF WS-NOT-VALID-DATE                                   07580099
075900              IF REJ-INDX NOT = 25                                07590099
076000                 SET REJ-INDX UP BY 1                             07600099
076100              END-IF                                              07610099
076200              SET ERROR-EDI TO TRUE                               07620099
076300              SET INV-DATE-INVALID-CD TO TRUE                     07630099
076400              MOVE EDI-ERROR-CD TO                                07640099
076500                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      07650099
076600           ELSE                                                   07660099
076700             MOVE DPG52-DB2-ISO-DATE     TO WS-CCYYMMDD           07670099
076800             MOVE WS-CENTURY             TO WS-CC                 07680099
076900             MOVE WS-YY                  TO WS-YEAR               07690099
077000             MOVE WS-MM                  TO WS-MONTH              07700099
077100             MOVE WS-DD                  TO WS-DAY                07710099
077200             MOVE WS-DTE                 TO AP045-DOC-DTE         07720099
077300           END-IF                                                 07730099
077400        END-IF                                                    07740099
077500     END-IF.                                                      07750099
077640                                                                  07764099
077700     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '06'         07770099
077800        IF AP050-GROSS-INVOICE-AMT OF AP050-EDI-IN-FILE = 0       07780099
077900           IF REJ-INDX NOT = 25                                   07790099
078000              SET REJ-INDX UP BY 1                                07800099
078100           END-IF                                                 07810099
078200           SET ERROR-EDI TO TRUE                                  07820099
078300           SET NO-GROSS-INVC-CD TO TRUE                           07830099
078400           MOVE EDI-ERROR-CD TO                                   07840099
078500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         07850099
078600        END-IF                                                    07860099
078700     END-IF.                                                      07870099
078800                                                                  07880099
078900     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         07890099
079000        IF AP050-ID-QUALIFIER OF AP050-EDI-IN-FILE NOT = SPACES   07900099
079100           IF NOT AP050-EAN OF AP050-EDI-IN-FILE AND              07910099
079200              NOT AP050-UPC OF AP050-EDI-IN-FILE                  07920099
079300              IF REJ-INDX NOT = 25                                07930099
079400                 SET REJ-INDX UP BY 1                             07940099
079500              END-IF                                              07950099
079600              SET ERROR-EDI TO TRUE                               07960099
079700              SET INVALID-ID-QUAL-CD TO TRUE                      07970099
079800              MOVE EDI-ERROR-CD TO                                07980099
079900                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   07990099
080000            END-IF                                                08000099
080100        END-IF                                                    08010099
080200     END-IF.                                                      08020099
080300                                                                  08030099
080400     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         08040099
080500        IF ((AP050-EAN OF AP050-EDI-IN-FILE OR                    08050099
080600            AP050-UPC OF AP050-EDI-IN-FILE)                       08060099
080700               AND                                                08070099
080800           AP050-EAN-UPC OF AP050-EDI-IN-FILE NOT = SPACES)       08080099
080900        OR AP050-VENDOR-STYLE OF AP050-EDI-IN-FILE NOT = SPACES   08090099
081000           NEXT SENTENCE                                          08100099
081100        ELSE                                                      08110099
081200           IF REJ-INDX NOT = 25                                   08120099
081300              SET REJ-INDX UP BY 1                                08130099
081400           END-IF                                                 08140099
081500           SET ERROR-EDI TO TRUE                                  08150099
081600           SET NO-ITEM-ID-CD TO TRUE                              08160099
081700           MOVE EDI-ERROR-CD TO                                   08170099
081800                WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 08180099
081900        END-IF                                                    08190099
082000     END-IF.                                                      08200099
082100                                                                  08210099
082200     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         08220099
082300        IF AP050-QUANTITY-INVOICED OF AP050-EDI-IN-FILE           08230099
082400                                                  NOT NUMERIC     08240099
082500           IF REJ-INDX NOT = 25                                   08250099
082600              SET REJ-INDX UP BY 1                                08260099
082700           END-IF                                                 08270099
082800           SET ERROR-EDI TO TRUE                                  08280099
082900           SET NO-QUANTITY-INVOICED-CD TO TRUE                    08290099
083000           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 08300099
083100        END-IF                                                    08310099
083200     END-IF.                                                      08320099
083300                                                                  08330099
083400     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         08340099
083500        IF NOT AP050-IT1-MSR-EACH OF AP050-EDI-IN-FILE AND        08350099
083600           NOT AP050-IT1-MSR-PACK OF AP050-EDI-IN-FILE AND        08360099
083700           NOT AP050-IT1-MSR-PAIR OF AP050-EDI-IN-FILE AND        08370099
083800           NOT AP050-IT1-MSR-SET  OF AP050-EDI-IN-FILE AND        08380099
083900           NOT AP050-IT1-MSR-PK-HDR OF AP050-EDI-IN-FILE AND      08390099
084000           NOT AP050-IT1-MSR-PK-ITEM OF AP050-EDI-IN-FILE         08400099
084100           IF REJ-INDX NOT = 25                                   08410099
084200              SET REJ-INDX UP BY 1                                08420099
084300           END-IF                                                 08430099
084400           SET ERROR-EDI TO TRUE                                  08440099
084500           SET INVALID-QTY-INVD-UOM-CD TO TRUE                    08450099
084600           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 08460099
084700        END-IF                                                    08470099
084800     END-IF.                                                      08480099
084900                                                                  08490099
085000     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         08500099
085100        IF PV-WHOLSALE-UNIT-COSTN NOT NUMERIC                     08510099
085200           IF REJ-INDX NOT = 25                                   08520099
085300              SET REJ-INDX UP BY 1                                08530099
085400           END-IF                                                 08540099
085500           SET ERROR-EDI TO TRUE                                  08550099
085600           SET NO-UNIT-COST-CD TO TRUE                            08560099
085700           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 08570099
085800        END-IF                                                    08580099
085900     END-IF.                                                      08590099
086000                                                                  08600099
086100*---------------------------------------------------------------  08610099
086200* DATE VALIDATION                                                 08620099
086300*---------------------------------------------------------------  08630099
086400                                                                  08640099
086500     SET WS-VALID-DATE TO TRUE.                                   08650099
086600     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '04'         08660099
086700        IF AP050-NET-DUE-DATE OF AP050-EDI-IN-FILE NUMERIC AND    08670099
086800           AP050-NET-DUE-DATE OF AP050-EDI-IN-FILE NOT            08680099
086900                                                 = '000000'       08690099
087000           MOVE AP050-NET-DUE-DATE OF AP050-EDI-IN-FILE           08700099
087100                                                  TO WS-YYMMDD    08710099
087200           PERFORM E400-CHECK-DATE                                08720099
087300             MOVE DPG52-DB2-ISO-DATE     TO WS-CCYYMMDD           08730099
087400             MOVE WS-CENTURY             TO WS-CC                 08740099
087500             MOVE WS-YY                  TO WS-YEAR               08750099
087600             MOVE WS-MM                  TO WS-MONTH              08760099
087700             MOVE WS-DD                  TO WS-DAY                08770099
087800             MOVE WS-DTE                 TO AP045-PYMT-DUE-DTE    08780099
087900        ELSE                                                      08790099
088000           IF AP050-NET-DUE-DATE OF AP050-EDI-IN-FILE             08800099
088100                                      = SPACES OR '000000'        08810099
088200              MOVE SPACES                TO AP045-PYMT-DUE-DTE    08820099
088300           ELSE                                                   08830099
088400              SET WS-NOT-VALID-DATE TO TRUE                       08840099
088500           END-IF                                                 08850099
088600        END-IF                                                    08860099
088700        IF WS-NOT-VALID-DATE                                      08870099
088800           IF REJ-INDX NOT = 25                                   08880099
088900              SET REJ-INDX UP BY 1                                08890099
089000           END-IF                                                 08900099
089100           SET ERROR-EDI TO TRUE                                  08910099
089200           SET NET-DUE-DATE-NOT-VALID-CD TO TRUE                  08920099
089300           MOVE EDI-ERROR-CD TO                                   08930099
089400                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         08940099
089500        END-IF                                                    08950099
089600     END-IF.                                                      08960099
089700                                                                  08970099
089800*---------------------------------------------------------------  08980099
089900* STORE/DC VALIDATION - DETERMINES THE MATCH LEVEL, THE STORE     08990099
090000* NUMBER AND THE DC NUMBER FOR EACH INVOICE.                      09000099
090100*---------------------------------------------------------------  09010099
090200                                                                  09020099
090300     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '02'         09030099
090400        INITIALIZE VALID-STORE1-NUMBER-SW                         09040099
090500                   VALID-STORE2-NUMBER-SW                         09050099
090600                   WS-SAVE-STORE-NBR1                             09060099
090700                   WS-SAVE-STORE-NBR2                             09070099
090800                   WS-SAVE-STORE-NBR-FOR-DC                       09080099
090900        IF AP050-KOHLS-STORE-NBR1 OF AP050-EDI-IN-FILE = SPACES OR09090099
091000           AP050-KOHLS-STORE-NBR1 OF AP050-EDI-IN-FILE            09100099
091100                                                 NOT NUMERIC      09110099
091200           SET WS-NOT-VALID-STORE1  TO TRUE                       09120099
091300        ELSE                                                      09130099
091400           SET WS-VALID-STORE1  TO TRUE                           09140099
091500        END-IF                                                    09150099
091600        IF AP050-KOHLS-STORE-NBR2 OF AP050-EDI-IN-FILE = SPACES OR09160099
091700           AP050-KOHLS-STORE-NBR2 OF AP050-EDI-IN-FILE            09170099
091800                                                 NOT NUMERIC      09180099
091900           SET WS-NOT-VALID-STORE2  TO TRUE                       09190099
092000        ELSE                                                      09200099
092100           SET WS-VALID-STORE2  TO TRUE                           09210099
092200        END-IF                                                    09220099
092300                                                                  09230099
092400** REJECT THE INVOICE IF BOTH STORES ARE INVALID                  09240099
092500        IF WS-NOT-VALID-STORE1 AND WS-NOT-VALID-STORE2            09250099
092600           IF REJ-INDX NOT = 25                                   09260099
092700              SET REJ-INDX UP BY 1                                09270099
092800           END-IF                                                 09280099
092900           SET ERROR-EDI TO TRUE                                  09290099
093000           SET STORE-NBR-NOT-VALID TO TRUE                        09300099
093100           MOVE EDI-ERROR-CD                                      09310099
093200             TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 09320099
093300           MOVE AP050-EDI-IN-FILE TO WS-INV-REC(INV-INDX)         09330099
093400        END-IF                                                    09340099
093500                                                                  09350099
093600        IF WS-VALID-STORE1                                        09360099
093700           MOVE AP050-KOHLS-STORE-NBR1 OF AP050-EDI-IN-FILE       09370099
093800                                        TO WS-SAVE-STORE-NBR1     09380099
093900           PERFORM E340-VALIDATE-STORE1                           09390099
094000        ELSE                                                      09400099
094100           MOVE AP050-KOHLS-STORE-NBR2 OF AP050-EDI-IN-FILE       09410099
094200                                        TO WS-SAVE-STORE-NBR2     09420099
094300           PERFORM E350-VALIDATE-STORE2                           09430099
094400        END-IF                                                    09440099
094500     END-IF.                                                      09450099
094600                                                                  09460099
094700     IF AP050-KOHLS-STORE-NBR1 OF AP050-EDI-IN-FILE = SPACES AND  09470099
094800        AP050-KOHLS-STORE-NBR2 OF AP050-EDI-IN-FILE = SPACES      09480099
094900           DISPLAY 'NO STORE NBR PRESENT IN INPUT FILE'           09490099
095000     END-IF.                                                      09500099
095100                                                                  09510099
095200*---------------------------------------------------------------  09520099
095300* UPC VALIDATION - IF THE UPC NUMBER IS VALID, CHECK THE TUPCSKU  09530099
095400* TABLE TO OBTAIN THE ITEM NUMBER.                                09540099
095500*---------------------------------------------------------------  09550099
095600                                                                  09560099
095700     IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '07'         09570099
095800         IF AP050-UPC OF AP050-EDI-IN-FILE                        09580099
095900            MOVE AP050-UPC-CODE OF AP050-EDI-IN-FILE TO WS-UPC-12 09590099
096000            MOVE ZERO           TO WS-UPC-ZERO                    09600099
096100            MOVE WS-UPC-13      TO WS-UPC-CODE-X                  09610099
096200            IF WS-UPC-CODE-X NUMERIC                              09620099
096300               MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3              09630099
096400               IF WS-UPC-CODE-COMP3 NOT = TUPCSKU-UPC-NBR         09640099
096500                  PERFORM R400-SELECT-TUPCSKU                     09650099
096600               END-IF                                             09660099
096700            ELSE                                                  09670099
096800               SET WS-NOT-VALID-UPC TO TRUE                       09680099
096900            END-IF                                                09690099
097000            IF WS-VALID-UPC                                       09700099
097100               PERFORM R410-JOIN-TUPCSKU-TSKXREF                  09710099
097200               IF SQLCODE = +0                                    09720099
097300                  MOVE SKXREF-SUBCLASS TO WS-SAVE-SUBCLASS-R      09730099
097400                  MOVE WS-SAVE-SUBCL-E TO AP045-CL-NBR            09740099
097500                  MOVE SKXREF-DEPT     TO WS-SAVE-DEPT-R          09750099
097600                  MOVE WS-SAVE-DEPT-E  TO AP045-DEPT-NBR          09760099
097700                  MOVE SKXREF-SKU      TO AP045-SKU-NBR           09770099
097800                  MOVE TUPCSKU-UPC-NBR TO WS-UPC-NBR-D            09780099
097900                  PERFORM R420-GET-TUPCPLS-RETAIL                 09790099
098000               ELSE                                               09800099
098100                  SET WS-NOT-VALID-UPC TO TRUE                    09810099
098200                  PERFORM R430-SELECT-TVNDDPT                     09820099
098300                  IF SQLCODE = +0                                 09830099
098400                     PERFORM R440-SELECT-TMDSEAR                  09840099
098500                     IF SQLCODE = +0                              09850099
098600                        PERFORM R420-GET-TUPCPLS-RETAIL           09860099
098700                     END-IF                                       09870099
098800                  END-IF                                          09880099
098900               END-IF                                             09890099
099000            ELSE                                                  09900099
099100               SET WS-NOT-VALID-UPC TO TRUE                       09910099
099200               PERFORM R430-SELECT-TVNDDPT                        09920099
099300               IF SQLCODE = +0                                    09930099
099400                  PERFORM R440-SELECT-TMDSEAR                     09940099
099500                  IF SQLCODE = +0                                 09950099
099600                     PERFORM R420-GET-TUPCPLS-RETAIL              09960099
099700                  END-IF                                          09970099
099800               END-IF                                             09980099
099900            END-IF                                                09990099
100000         ELSE                                                     10000099
100100            IF AP050-EAN OF AP050-EDI-IN-FILE                     10010099
100200               MOVE AP050-EAN-CODE OF AP050-EDI-IN-FILE           10020099
100300                                            TO WS-UPC-CODE-X      10030099
100400               IF WS-UPC-CODE-X NUMERIC                           10040099
100500                  MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3           10050099
100600                  IF WS-UPC-CODE-COMP3 NOT = TUPCSKU-UPC-NBR      10060099
100700                     PERFORM R400-SELECT-TUPCSKU                  10070099
100800                  END-IF                                          10080099
100900                  PERFORM R410-JOIN-TUPCSKU-TSKXREF               10090099
101000                  IF SQLCODE = +0                                 10100099
101100                     MOVE SKXREF-SUBCLASS TO WS-SAVE-SUBCLASS-R   10110099
101200                     MOVE WS-SAVE-SUBCL-E TO AP045-CL-NBR         10120099
101300                     MOVE SKXREF-DEPT     TO WS-SAVE-DEPT-R       10130099
101400                     MOVE WS-SAVE-DEPT-E  TO AP045-DEPT-NBR       10140099
101500                     MOVE SKXREF-SKU      TO AP045-SKU-NBR        10150099
101600                     PERFORM R420-GET-TUPCPLS-RETAIL              10160099
101700                  ELSE                                            10170099
101800                     SET WS-NOT-VALID-UPC TO TRUE                 10180099
101900                     PERFORM R430-SELECT-TVNDDPT                  10190099
102000                     IF SQLCODE = +0                              10200099
102100                        PERFORM R440-SELECT-TMDSEAR               10210099
102200                        IF SQLCODE = +0                           10220099
102300                           PERFORM R420-GET-TUPCPLS-RETAIL        10230099
102400                        END-IF                                    10240099
102500                     END-IF                                       10250099
102600                  END-IF                                          10260099
102700               ELSE                                               10270099
102800                  SET WS-NOT-VALID-UPC TO TRUE                    10280099
102900                  PERFORM R430-SELECT-TVNDDPT                     10290099
103000                  IF SQLCODE = +0                                 10300099
103100                     PERFORM R440-SELECT-TMDSEAR                  10310099
103200                     IF SQLCODE = +0                              10320099
103300                        PERFORM R420-GET-TUPCPLS-RETAIL           10330099
103400                     END-IF                                       10340099
103500                  END-IF                                          10350099
103600               END-IF                                             10360099
103700            END-IF                                                10370099
103800         END-IF                                                   10380099
103900     END-IF.                                                      10390099
103901                                                                  10390199
104100*---------------------------------------------------------------  10410099
104200* EDIT TO VERIFY THAT THE FIRST RECORD TYPE WAS AN 01             10420099
104300*---------------------------------------------------------------  10430099
104400                                                                  10440099
104510     IF WS-FIRST-REC-TYPE NOT = '01'                              10451099
104600        IF REJ-INDX NOT = 25                                      10460099
104700           SET REJ-INDX UP BY 1                                   10470099
104800        END-IF                                                    10480099
104900        SET ERROR-EDI TO TRUE                                     10490099
105000        SET FIRST-REC-NOT-01 TO TRUE                              10500099
105100        MOVE EDI-ERROR-CD TO                                      10510099
105200             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    10520099
105201     END-IF.                                                      10520199
105205                                                                  10520599
105206     PERFORM E500-CHECK-DUP-INVC.                                 10520699
105210                                                                  10521099
105220     MOVE WS-DUN-NBR-X           TO WS-SAVE-DUN-INV-NBR(1:9)      10522099
105230                                    WS-DASH-DUN-INV-NBR(1:9).     10523099
105240     MOVE WS-SAVE-INVOICE-NBR    TO WS-SAVE-DUN-INV-NBR(10:22).   10524099
105250     MOVE WS-INVOICE-WITH-SUFFIX TO WS-DASH-DUN-INV-NBR(10:22).   10525099
105270                                                                  10527099
105700*---------------------------------------------------------------  10570099
105800* EDIT TO VERIFY THAT THE LAST RECORD TYPE WAS AN 07              10580099
105900*---------------------------------------------------------------  10590099
106000 E310-VERIFY-LAST-RECORD.                                         10600099
106100                                                                  10610099
106200     IF WS-LAST-REC-TYPE NOT = '07' AND                           10620099
106300        WS-LAST-REC-TYPE NOT = SPACES                             10630099
106400        DISPLAY '**************************'                      10640099
106500        DISPLAY 'LAST-REC-TYPE NOT = 07'                          10650099
106600        DISPLAY 'INVOICE NUMBER ' WS-SAVE-INVOICE-NBR             10660099
106700        DISPLAY '**************************'                      10670099
106800        IF REJ-INDX NOT = 25                                      10680099
106900           SET REJ-INDX UP BY 1                                   10690099
107000        END-IF                                                    10700099
107100        SET ERROR-EDI TO TRUE                                     10710099
107200        SET LAST-REC-NOT-07  TO TRUE                              10720099
107300        SET AP051-CHOSE-FOR-PRINT TO TRUE                         10730099
107400        MOVE EDI-ERROR-CD TO                                      10740099
107500             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    10750099
107700     END-IF.                                                      10770099
107800                                                                  10780099
107900*--------------------------------------------------------------*  10790099
108000* VALIDATE STORE NUMBER 1 AGAINST THE WS LOCATION TABLE        *  10800099
108100*--------------------------------------------------------------*  10810099
108200 E340-VALIDATE-STORE1.                                            10820099
108300                                                                  10830099
108400     PERFORM VARYING LOC-INDX FROM 1 BY 1                         10840099
108500       UNTIL WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR1          10850099
108600          OR WS-STORE-NBR(LOC-INDX) = SPACES                      10860099
108700          OR LOC-INDX > 2000                                      10870099
108800     END-PERFORM.                                                 10880099
108900                                                                  10890099
109000     EVALUATE TRUE                                                10900099
109100       WHEN WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR1           10910099
109200            SET WS-VALID-STORE1-DS TO TRUE                        10920099
109300            MOVE WS-SAVE-STORE-NBR1 TO AP045-STR-NBR              10930099
109400       WHEN WS-STORE-NBR(LOC-INDX) = SPACES OR LOC-INDX > 2000    10940099
109500            SET WS-NOT-VALID-STORE1 TO TRUE                       10950099
109600     END-EVALUATE.                                                10960099
109700                                                                  10970099
109800*--------------------------------------------------------------*  10980099
109900* VALIDATE STORE NUMBER 2 AGAINST LOCATION TABLE.              *  10990099
110000*--------------------------------------------------------------*  11000099
110100 E350-VALIDATE-STORE2.                                            11010099
110200                                                                  11020099
110300     PERFORM VARYING LOC-INDX FROM 1 BY 1                         11030099
110400       UNTIL WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2          11040099
110500          OR WS-STORE-NBR(LOC-INDX) = SPACES                      11050099
110600          OR LOC-INDX > 2000                                      11060099
110700     END-PERFORM.                                                 11070099
110800                                                                  11080099
110900     EVALUATE TRUE                                                11090099
111000       WHEN WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2           11100099
111100            SET WS-VALID-STORE2-DS TO TRUE                        11110099
111200            MOVE WS-SAVE-STORE-NBR2 TO AP045-STR-NBR              11120099
111300       WHEN WS-STORE-NBR(LOC-INDX) = SPACES OR LOC-INDX > 2000    11130099
111400            SET WS-NOT-VALID-STORE2 TO TRUE                       11140099
111500     END-EVALUATE.                                                11150099
111600                                                                  11160099
111700*--------------------------------------------------------------*  11170099
111800* CHECK THAT THE DATE ENTERED IS A VALID DATE                  *  11180099
111900*--------------------------------------------------------------*  11190099
112000 E400-CHECK-DATE.                                                 11200099
112100                                                                  11210099
112200     SET WS-NOT-VALID-DATE TO TRUE.                               11220099
112300                                                                  11230099
112400     IF  WS-YYMMDD    > '000000'                                  11240099
112500         IF WS-YY > 80                                            11250099
112600            MOVE '19' TO WS-CENTURY                               11260099
112700         ELSE                                                     11270099
112800            MOVE '20' TO WS-CENTURY                               11280099
112900         END-IF                                                   11290099
113000         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   11300099
113100         SET DPG52-LK-DTE-ISO           TO TRUE                   11310099
113200         MOVE WS-CCYYMMDD       TO DPG52-LK-DATE-INPUT            11320099
113300         MOVE SPACES            TO WS-DATE-INVALID                11330099
113400                                                                  11340099
113500         CALL  DP500-KOHLS-CALENDAR-ROUTINE USING                 11350099
113600                                           DPG51 DPG52 DPG53      11360099
113700                                           DPG54 DPG55 DPG56      11370099
113800                                                                  11380099
113900         IF (DPG54-SEVERE-ERROR                                   11390099
114000             OR                                                   11400099
114100             DPG54-WARNING-ERROR)                                 11410099
114200              SET WS-NOT-VALID-DATE TO TRUE                       11420099
114300         ELSE                                                     11430099
114400             SET WS-VALID-DATE TO TRUE                            11440099
114500         END-IF                                                   11450099
114600     END-IF.                                                      11460099
114700                                                                  11470099
114800****************************************************************  11480099
114900* LOOK UP ON TADJRNL                                              11490099
115000*            WHERE VND_NBR = EXTENT-DUN-NBR                       11500099
115100*              AND DOC_NBR = AP050-VENDOR-INVOICE-NBR             11510099
115200* IF SQLCODE = 0, WRITE OUT THE ERROR BECAUSE IT'S A DUPLICATE    11520099
115300****************************************************************  11530099
115400 E500-CHECK-DUP-INVC.                                             11540099
115500                                                                  11550099
115600     EXEC SQL                                                     11560099
115700         SELECT A.VND_NBR                                         11570099
115800         INTO  :ADJRNL-VND-NBR                                    11580099
115900         FROM  TADJRNL A                                          11590099
116000         WHERE A.VND_NBR      = :WS-DUN-NBR-X                     11600099
116100           AND A.DOC_NBR      = :WS-VENDOR-INVOICE-NBR            11610099
116200     END-EXEC.                                                    11620099
116300                                                                  11630099
116400     EVALUATE SQLCODE                                             11640099
116500         WHEN +0                                                  11650099
116510         WHEN +100                                                11651099
116600         WHEN -904                                                11660099
116700         WHEN -913                                                11670099
116800             CONTINUE                                             11680099
116900                                                                  11690099
117000         WHEN OTHER                                               11700099
117100             MOVE 'E500-CHECK-DUP-INVOICE         '               11710099
117200                                    TO WS-ABEND-PARAGRAPH         11720099
117300             MOVE 'DUPLICATE INVOICE NBR     '                    11730099
117400                                    TO WS-ABEND-OPERATION         11740099
117500             MOVE 'TADJRNL'  TO WS-ABEND-STRUCTURE-1              11750099
117600             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11760099
117610             DISPLAY 'DUPLICATE INVOICE NBR     '                 11761099
117620             DISPLAY 'VND_NBR ' WS-DUN-NBR-X                      11762099
117630             DISPLAY 'DOC_NBR ' WS-VENDOR-INVOICE-NBR             11763099
117700             PERFORM Z999-SQL-ERROR                               11770099
117800     END-EVALUATE.                                                11780099
117900                                                                  11790099
118000     IF SQLCODE = 0                                               11800099
118013        IF AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE          11801399
118014                         = WS-SAVE-VND-INV-NBR                    11801499
118022           CONTINUE                                               11802299
118030        ELSE                                                      11803099
118100           IF REJ-INDX NOT = 25                                   11810099
118200              SET REJ-INDX UP BY 1                                11820099
118300           END-IF                                                 11830099
118600           MOVE HIGH-VALUES TO WS-AP050-REC-TYPE(INV-INDX)        11860099
118700           SET ERROR-EDI TO TRUE                                  11870099
118800           SET DUPL-DUN-INV-COMBIN-CD TO TRUE                     11880099
118900           MOVE EDI-ERROR-CD TO                                   11890099
119000                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         11900099
119001           MOVE AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE     11900199
119002                        TO WS-SAVE-VND-INV-NBR                    11900299
119010        END-IF                                                    11901099
119100     END-IF.                                                      11910099
119800                                                                  11980099
119900*----------------------------------------------------------------*11990099
120000*    READ UNJOURNALIZED AGED FILE.                               *12000099
120100*----------------------------------------------------------------*12010099
120200 R100-READ-INPUT.                                                 12020099
120300                                                                  12030099
120400     READ HALLMARK-IN-FILE INTO AP050-EDI-IN-FILE                 12040099
120500         AT END SET END-OF-EDIIN TO TRUE.                         12050099
120600                                                                  12060099
120700     IF NOT END-OF-EDIIN                                          12070099
120800        ADD +1 TO WS-TOT-INPUT-CNT                                12080099
120900        IF WS-FIRST-TIME                                          12090099
121000            MOVE 'N' TO FIRST-TIME-SW                             12100099
121100        ELSE                                                      12110099
121200            IF WS-SAVE-RECORD-TYPE-IND = '07'                     12120099
121210               IF NO-EDI-ERROR                                    12121099
121300                  PERFORM W100-WRITE-OUTPUT                       12130099
121400               END-IF                                             12140099
121410            END-IF                                                12141099
121500        END-IF                                                    12150099
121600        IF AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE          12160099
121700                     NOT = WS-SAVE-INVOICE-NBR                    12170099
121800            PERFORM E310-VERIFY-LAST-RECORD                       12180099
121801                                                                  12180199
121810            IF ERROR-EDI                                          12181099
121820               PERFORM W300-WRITE-REJECT                          12182099
121830            END-IF                                                12183099
121900                                                                  12190099
122000            MOVE AP050-VENDOR-INVOICE-NBR OF AP050-EDI-IN-FILE    12200099
122100                             TO WS-SAVE-INVOICE-NBR               12210099
122200            MOVE AP050-EDI-SEQ-NBR OF AP050-EDI-IN-FILE           12220099
122300                            TO WS-SAVE-EDI-SEQ-NBR                12230099
122400            ADD 1 TO WS-EDIIN-REC-CNT                             12240099
122500            ADD 1 TO WS-TOT-INVC-LINES                            12250099
122600            MOVE ZERO TO WS-REC-01-CNT                            12260099
122700                         WS-REC-02-CNT                            12270099
122800                         WS-REC-03-CNT                            12280099
122900                         WS-REC-04-CNT                            12290099
123000                         WS-REC-05-CNT                            12300099
123100                         WS-REC-06-CNT                            12310099
123200                         WS-REC-07-CNT                            12320099
123300            PERFORM VARYING INV-INDX FROM 1 BY 1                  12330099
123400               UNTIL INV-INDX > 11000                             12340099
123500               MOVE HIGH-VALUES TO WS-AP050-KEY-AREA(INV-INDX)    12350099
123600               INITIALIZE WS-AP050-DATA-AREA(INV-INDX)            12360099
123700               INITIALIZE WS-INV-ERR-TBL-AREA(INV-INDX)           12370099
123800            END-PERFORM                                           12380099
123900            MOVE '000000' TO WS-SAVE-INVOICE-DATE                 12390099
124000                             WS-SAVE-SHIPPED-DATE                 12400099
124100                             WS-SAVE-EFFECTIVE-DATE               12410099
124200            SET INV-INDX TO 1                                     12420099
124300            SET INV-INDX DOWN BY 1                                12430099
124310            SET NO-EDI-ERROR   TO TRUE                            12431099
124400        END-IF                                                    12440099
124500     END-IF.                                                      12450099
124600                                                                  12460099
124700*--------------------------------------------------------------*  12470099
124800* VALIDATE STORE NUMBER 2 AGAINST LOCATION TABLE.              *  12480099
124900*--------------------------------------------------------------*  12490099
125000 R350-VALIDATE-STORE2.                                            12500099
125100                                                                  12510099
125200     PERFORM VARYING LOC-INDX FROM 1 BY 1                         12520099
125300       UNTIL WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2          12530099
125400          OR WS-STORE-NBR(LOC-INDX) = SPACES                      12540099
125500          OR LOC-INDX > 2000                                      12550099
125600     END-PERFORM.                                                 12560099
125700                                                                  12570099
125800     EVALUATE TRUE                                                12580099
125900       WHEN WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2           12590099
126000           IF WS-STORE-TYP-CDE(LOC-INDX) = 'DS'                   12600099
126100              SET WS-VALID-STORE2-DS TO TRUE                      12610099
126200           ELSE                                                   12620099
126300              SET WS-NOT-VALID-STORE2 TO TRUE                     12630099
126400           END-IF                                                 12640099
126500       WHEN WS-STORE-NBR(LOC-INDX) = SPACES OR LOC-INDX > 2000    12650099
126600           SET WS-NOT-VALID-STORE2 TO TRUE                        12660099
126700     END-EVALUATE.                                                12670099
126800                                                                  12680099
126900*--------------------------------------------------------------*  12690099
127000* CHECK FOR VALID UPC CODE                                     *  12700099
127100*--------------------------------------------------------------*  12710099
127200 R400-SELECT-TUPCSKU.                                             12720099
127300                                                                  12730099
127400     INITIALIZE DCLTUPCSKU.                                       12740099
127500                                                                  12750099
127600     EXEC SQL                                                     12760099
127700         SELECT UPC_NBR                                           12770099
127800              , ITEM_NBR                                          12780099
127900         INTO  :TUPCSKU-UPC-NBR                                   12790099
128000             , :TUPCSKU-ITEM-NBR                                  12800099
128100         FROM  TUPCSKU                                            12810099
128200         WHERE UPC_NBR = :WS-UPC-CODE-COMP3                       12820099
128300     END-EXEC.                                                    12830099
128400                                                                  12840099
128500     EVALUATE TRUE                                                12850099
128600         WHEN SQLCODE = ZERO                                      12860099
128700             SET WS-VALID-UPC TO TRUE                             12870099
128800         WHEN SQLCODE = +100                                      12880099
128900         WHEN SQLCODE = -904                                      12890099
129000         WHEN SQLCODE = -913                                      12900099
129100             SET WS-NOT-VALID-UPC TO TRUE                         12910099
129200         WHEN OTHER                                               12920099
129300             MOVE 'R400-SELECT-TUPCSKU           '                12930099
129400                                    TO WS-ABEND-PARAGRAPH         12940099
129500             MOVE 'UNSUCCESSFUL SELECT UPCSKU'                    12950099
129600                                    TO WS-ABEND-OPERATION         12960099
129700             MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1              12970099
129800             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              12980099
129900             PERFORM Z999-SQL-ERROR                               12990099
130000     END-EVALUATE.                                                13000099
130100                                                                  13010099
130200*--------------------------------------------------------------*  13020099
130300* GET THE DEPT,SUBCLASS, SKU AND ITM_NBR                          13030099
130400* ITM_NBR WILL BE USED TO GET UNT_RTL_AMT FROM UPCPLS TABLE       13040099
130500*--------------------------------------------------------------*  13050099
130600 R410-JOIN-TUPCSKU-TSKXREF.                                       13060099
130700                                                                  13070099
130800     EXEC SQL                                                     13080099
130900         SELECT B.DEPT                                            13090099
131000              , B.SUBCLASS                                        13100099
131100              , B.SKU                                             13110099
131200              , B.ITM_NBR                                         13120099
131300              , B.INTR_UPC_ID                                     13130099
131400              , A.UPC_NBR                                         13140099
131500              , A.ITEM_NBR                                        13150099
131600         INTO  :SKXREF-DEPT                                       13160099
131700              ,:SKXREF-SUBCLASS                                   13170099
131800              ,:SKXREF-SKU                                        13180099
131900              ,:SKXREF-ITM-NBR                                    13190099
132000              ,:SKXREF-INTR-UPC-ID                                13200099
132100              ,:TUPCSKU-UPC-NBR                                   13210099
132200              ,:TUPCSKU-ITEM-NBR                                  13220099
132300         FROM  TUPCSKU A                                          13230099
132400              ,TSKXREF B                                          13240099
132500         WHERE  A.UPC_NBR = :WS-UPC-CODE-COMP3                    13250099
132600           AND  A.ITEM_NBR = B.ITM_NBR                            13260099
132700     END-EXEC.                                                    13270099
132800                                                                  13280099
132900     EVALUATE TRUE                                                13290099
133000         WHEN SQLCODE = ZERO                                      13300099
133100             SET WS-VALID-UPC TO TRUE                             13310099
133200         WHEN SQLCODE = +100                                      13320099
133300         WHEN SQLCODE = -904                                      13330099
133400         WHEN SQLCODE = -913                                      13340099
133500             SET WS-NOT-VALID-UPC TO TRUE                         13350099
133600         WHEN OTHER                                               13360099
133700             DISPLAY '******************************'             13370099
133800             MOVE TUPCSKU-UPC-NBR TO WS-UPC-NBR-D                 13380099
133900             DISPLAY 'UPC ' WS-UPC-NBR-D                          13390099
134000             DISPLAY 'SQLCODE ' SQLCODE                           13400099
134100             DISPLAY 'DEPT SQL ' SKXREF-DEPT                      13410099
134200             DISPLAY 'SUBCLASS SQL ' SKXREF-SUBCLASS              13420099
134300             DISPLAY '******************************'             13430099
134400             MOVE 'R410-JOIN-TUPCSKU-TSKXREF     '                13440099
134500                                    TO WS-ABEND-PARAGRAPH         13450099
134600             MOVE 'UNSUCCESSFUL SELECT TUPCSKU'                   13460099
134700                                    TO WS-ABEND-OPERATION         13470099
134800             MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1              13480099
134900             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              13490099
135000             PERFORM Z999-SQL-ERROR                               13500099
135100     END-EVALUATE.                                                13510099
135200                                                                  13520099
135300*--------------------------------------------------------------*  13530099
135400* GET THE UNT_RTL_AMT FROM UPCPLS TABLE                           13540099
135500*--------------------------------------------------------------*  13550099
135600 R420-GET-TUPCPLS-RETAIL.                                         13560099
135700     MOVE WS-SAVE-STORE-NBR1 TO UPCPLS-STR-NBR.                   13570099
135800     EXEC SQL                                                     13580099
135900          SELECT UNT_RTL_AMT                                      13590099
136000            INTO :WS-UNT-RTL-AMT                                  13600099
136100            FROM TUPCPLS                                          13610099
136200           WHERE ITM_NBR = :SKXREF-ITM-NBR                        13620099
136300             AND STR_NBR = :UPCPLS-STR-NBR                        13630099
136400             AND EFF_END_TMST IS NULL                             13640099
136500     END-EXEC.                                                    13650099
136600                                                                  13660099
136700     EVALUATE TRUE                                                13670099
136800         WHEN SQLCODE = ZERO                                      13680099
136900             MOVE WS-UNT-RTL-AMT TO WS-UNT-RTL-AMT-D              13690099
137000         WHEN SQLCODE = +100                                      13700099
137100             PERFORM R425-GET-TUPCPLS-RETAIL-STORE0               13710099
137200         WHEN OTHER                                               13720099
137300             MOVE WS-KOHLS-STORE-NBR1 TO PV-STORE-9               13730099
137400             DISPLAY 'STR NUMBER ' PV-STORE-9                     13740099
137500             DISPLAY 'ITM NUMBER ' SKXREF-ITM-NBR                 13750099
137600             DISPLAY 'WS-SAVE-STORE-NBR1'  WS-SAVE-STORE-NBR1     13760099
137700             MOVE 'R420-GET-TUPCPLS-RETAIL     '                  13770099
137800                                    TO WS-ABEND-PARAGRAPH         13780099
137900             MOVE 'UNSUCCESSFUL SELECT TUPCPLS'                   13790099
138000                                    TO WS-ABEND-OPERATION         13800099
138100             MOVE 'TUPCPLS ' TO WS-ABEND-STRUCTURE-1              13810099
138200             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              13820099
138300             PERFORM Z999-SQL-ERROR                               13830099
138400     END-EVALUATE.                                                13840099
138500                                                                  13850099
138600*--------------------------------------------------------------*  13860099
138700* GET THE UNT_RTL_AMT FROM UPCPLS TABLE                           13870099
138800*--------------------------------------------------------------*  13880099
138900 R425-GET-TUPCPLS-RETAIL-STORE0.                                  13890099
139000                                                                  13900099
139100     MOVE ZERO TO UPCPLS-STR-NBR.                                 13910099
139200     EXEC SQL                                                     13920099
139300          SELECT UNT_RTL_AMT                                      13930099
139400            INTO :WS-UNT-RTL-AMT                                  13940099
139500            FROM TUPCPLS                                          13950099
139600           WHERE ITM_NBR = :SKXREF-ITM-NBR                        13960099
139700             AND STR_NBR = :UPCPLS-STR-NBR                        13970099
139800             AND EFF_END_TMST IS NULL                             13980099
139900     END-EXEC.                                                    13990099
140000                                                                  14000099
140100     EVALUATE TRUE                                                14010099
140200         WHEN SQLCODE = ZERO                                      14020099
140300             MOVE WS-UNT-RTL-AMT TO WS-UNT-RTL-AMT-D              14030099
140400         WHEN SQLCODE = +100                                      14040099
140500             MOVE ZERO           TO WS-UNT-RTL-AMT                14050099
140600                                    WS-UNT-RTL-AMT-D              14060099
140700         WHEN OTHER                                               14070099
140800             MOVE WS-KOHLS-STORE-NBR1 TO PV-STORE-9               14080099
140900             DISPLAY 'STR NUMBER ' PV-STORE-9                     14090099
141000             DISPLAY 'ITM NUMBER ' SKXREF-ITM-NBR                 14100099
141100             MOVE 'R425-GET-TUPCPLS-RETAIL-STORE0'                14110099
141200                                    TO WS-ABEND-PARAGRAPH         14120099
141300             MOVE 'UNSUCCESSFUL SELECT TUPCPLS'                   14130099
141400                                    TO WS-ABEND-OPERATION         14140099
141500             MOVE 'TUPCPLS ' TO WS-ABEND-STRUCTURE-1              14150099
141600             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              14160099
141700             PERFORM Z999-SQL-ERROR                               14170099
141800     END-EVALUATE.                                                14180099
141900                                                                  14190099
142000*--------------------------------------------------------------*  14200099
142100* GET THE DEPT NBR WHEN THE UPC IS INVALID                        14210099
142200*--------------------------------------------------------------*  14220099
142300 R430-SELECT-TVNDDPT.                                             14230099
142400                                                                  14240099
142500     EXEC SQL                                                     14250099
142600          SELECT MIN(DEPT_NBR)                                    14260099
142700            INTO :VNDDPT-DEPT-NBR                                 14270099
142800            FROM TVNDDPT                                          14280099
142900          WHERE ENT_ID  = :WS-TRDPRT-ENT-ID                       14290099
143000            AND VND_DEPT_STAT_CD = 'A'                            14300099
143100     END-EXEC.                                                    14310099
143200                                                                  14320099
143300     EVALUATE TRUE                                                14330099
143400         WHEN SQLCODE = ZERO                                      14340099
143500             MOVE VNDDPT-DEPT-NBR TO AP045-DEPT-NBR               14350099
143600         WHEN SQLCODE = +100                                      14360099
143700             MOVE '000'  TO AP045-DEPT-NBR                        14370099
143800         WHEN SQLCODE = -904                                      14380099
143900         WHEN SQLCODE = -913                                      14390099
144000             MOVE '000'          TO AP045-DEPT-NBR                14400099
144100         WHEN OTHER                                               14410099
144200             MOVE 'R430-SELECT-TVNDDPT     '                      14420099
144300                                    TO WS-ABEND-PARAGRAPH         14430099
144400             MOVE 'UNSUCCESSFUL SELECT TVNDDPT'                   14440099
144500                                    TO WS-ABEND-OPERATION         14450099
144600             MOVE 'TVNDDPT ' TO WS-ABEND-STRUCTURE-1              14460099
144700             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              14470099
144800             PERFORM Z999-SQL-ERROR                               14480099
144900     END-EVALUATE.                                                14490099
145000                                                                  14500099
145100*--------------------------------------------------------------*  14510099
145200* GET THE SUBCLASS NBR WHEN THE UPC IS INVALID                    14520099
145300*--------------------------------------------------------------*  14530099
145400 R440-SELECT-TMDSEAR.                                             14540099
145500                                                                  14550099
145600     EXEC SQL                                                     14560099
145700          SELECT MIN(SUB_CL_NBR)                                  14570099
145800            INTO :MDSEAR-SUB-CL-NBR                               14580099
145900            FROM TMDSEAR                                          14590099
146000          WHERE DEPT_NBR = :VNDDPT-DEPT-NBR                       14600099
146100            AND MDSELV_CDE = 'SCL'                                14610099
146200            AND END_DTE    = '9999-09-09'                         14620099
146300     END-EXEC.                                                    14630099
146400                                                                  14640099
146500     EVALUATE TRUE                                                14650099
146600         WHEN SQLCODE = ZERO                                      14660099
146700             MOVE MDSEAR-SUB-CL-NBR TO AP045-CL-NBR               14670099
146800         WHEN SQLCODE = +100                                      14680099
146900             MOVE '00'  TO AP045-CL-NBR                           14690099
147000         WHEN SQLCODE = -904                                      14700099
147100         WHEN SQLCODE = -913                                      14710099
147200             MOVE '00'          TO AP045-CL-NBR                   14720099
147300         WHEN OTHER                                               14730099
147400             MOVE 'R430-SELECT-TVNDDPT     '                      14740099
147500                                    TO WS-ABEND-PARAGRAPH         14750099
147600             MOVE 'UNSUCCESSFUL SELECT TMDSEAR'                   14760099
147700                                    TO WS-ABEND-OPERATION         14770099
147800             MOVE 'TMDSEAR ' TO WS-ABEND-STRUCTURE-1              14780099
147900             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              14790099
148000             PERFORM Z999-SQL-ERROR                               14800099
148100     END-EVALUATE.                                                14810099
148200                                                                  14820099
148300*--------------------------------------------------------------*  14830099
148400* USE THE DUN_NBR TO GET THE NAME AND ENT ID                   *  14840099
148500*--------------------------------------------------------------*  14850099
148600 R950-SELECT-TENTNME.                                             14860099
148700                                                                  14870099
148800     MOVE SPACES TO ENTNME-ENT-NAME-DESC.                         14880099
148900     MOVE ZEROES TO EXTENT-ENT-ID.                                14890099
149000                                                                  14900099
149100     EXEC SQL                                                     14910099
149200         SELECT A.ENT_NAME_DESC                                   14920099
149300              , B.ENT_ID                                          14930099
149400           INTO :ENTNME-ENT-NAME-DESC                             14940099
149500              , :EXTENT-ENT-ID                                    14950099
149600           FROM TENTNME A                                         14960099
149700              , TEXTENT B                                         14970099
149800           WHERE B.DUN_NBR        = :WS-DUN-NBR-X                 14980099
149900             AND B.ENT_ID         = A.ENT_ID                      14990099
150000             AND B.STATUS_CDE     = 'A'                           15000099
150100             AND A.TYPE_CDE       = '01'                          15010099
150200     END-EXEC.                                                    15020099
150300                                                                  15030099
150400     EVALUATE TRUE                                                15040099
150500        WHEN SQLCODE = ZERO                                       15050099
150600        WHEN SQLCODE = +100                                       15060099
150700            CONTINUE                                              15070099
150800        WHEN SQLWARN0 NOT = SPACES                                15080099
150900        WHEN SQLCODE  NOT = ZERO                                  15090099
151000            MOVE 'R950-SELECT-TENTNME           '                 15100099
151100                                 TO WS-ABEND-PARAGRAPH            15110099
151200            MOVE 'UNSUCCESSFUL SELECT ENTNME'                     15120099
151300                                 TO WS-ABEND-OPERATION            15130099
151400            MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1               15140099
151500            MOVE SPACES     TO WS-ABEND-STRUCTURE-2               15150099
151600            PERFORM Z999-SQL-ERROR                                15160099
151700     END-EVALUATE.                                                15170099
151800                                                                  15180099
151900     EVALUATE TRUE                                                15190099
152000        WHEN SQLCODE = ZEROS                                      15200099
152100             SET WS-VALID-DUNS TO TRUE                            15210099
152200        WHEN SQLCODE = +100                                       15220099
152300             SET WS-NOT-VALID-DUNS TO TRUE                        15230099
152400        WHEN OTHER                                                15240099
152500             MOVE 'R950-SELECT-TENTNME           ' TO             15250099
152600                                       WS-ABEND-PARAGRAPH         15260099
152700             MOVE 'UNSUCCESSFUL SELECT EXTENT'                    15270099
152800                           TO WS-ABEND-OPERATION                  15280099
152900             MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1              15290099
153000             MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-2              15300099
153100             PERFORM Z999-SQL-ERROR                               15310099
153200     END-EVALUATE.                                                15320099
153300                                                                  15330099
153400*--------------------------------------------------------------*  15340099
153500* OPEN LOCATION CURSOR                                         *  15350099
153600*--------------------------------------------------------------*  15360099
153700 X100-OPEN-LOCATION-CSR.                                          15370099
153800                                                                  15380099
153900     EXEC SQL                                                     15390099
154000        OPEN LOCATION_CSR                                         15400099
154100     END-EXEC.                                                    15410099
154200                                                                  15420099
154300     EVALUATE TRUE                                                15430099
154400         WHEN SQLCODE = ZERO                                      15440099
154500              CONTINUE                                            15450099
154600         WHEN SQLWARN0 NOT = SPACES                               15460099
154700         WHEN SQLCODE  NOT = ZERO                                 15470099
154800              MOVE 'X100-OPEN-LOCATION-CSR        '               15480099
154900                              TO WS-ABEND-PARAGRAPH               15490099
155000              MOVE 'UNSUCCESSFUL OPEN LOCATION CURSOR'            15500099
155100                              TO WS-ABEND-OPERATION               15510099
155200              MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1             15520099
155300              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             15530099
155400              PERFORM Z999-SQL-ERROR                              15540099
155500     END-EVALUATE.                                                15550099
155600                                                                  15560099
155700*--------------------------------------------------------------*  15570099
155800* FETCH ROWS FROM LOCATION CURSOR AND LOAD INTO LOCATION TABLE *  15580099
155900* FOR STORE NUMBER VALIDATION.                                 *  15590099
156000*--------------------------------------------------------------*  15600099
156100 X200-LOAD-LOCATION-TBL.                                          15610099
156200                                                                  15620099
156300     PERFORM VARYING LOC-INDX FROM 1 BY 1                         15630099
156400       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            15640099
156500           MOVE SPACES TO WS-STORE-NBR(LOC-INDX)                  15650099
156600                          WS-STORE-TYP-CDE(LOC-INDX)              15660099
156700     END-PERFORM.                                                 15670099
156800                                                                  15680099
156900     PERFORM VARYING LOC-INDX FROM 1 BY 1                         15690099
157000       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            15700099
157100          OR END-OF-LOC-CSR                                       15710099
157200             EXEC SQL                                             15720099
157300                  FETCH LOCATION_CSR                              15730099
157400                  INTO :PV-STORE-DIGITS                           15740099
157500                     , :XFT00017-LOC-TYP-CDE                      15750099
157600             END-EXEC                                             15760099
157700                                                                  15770099
157800             EVALUATE TRUE                                        15780099
157900               WHEN SQLCODE = +100                                15790099
158000                    SET END-OF-LOC-CSR TO TRUE                    15800099
158100               WHEN SQLCODE = ZERO                                15810099
158200                    MOVE PV-STORE-DIGITS TO WS-STORE-NBR(LOC-INDX)15820099
158300                    MOVE XFT00017-LOC-TYP-CDE                     15830099
158400                                     TO WS-STORE-TYP-CDE(LOC-INDX)15840099
158500               WHEN SQLWARN0 NOT = SPACES                         15850099
158600               WHEN SQLCODE  NOT = ZERO                           15860099
158700                    MOVE 'X200-LOAD-LOCATION-TBL        '         15870099
158800                                  TO WS-ABEND-PARAGRAPH           15880099
158900                    MOVE 'UNSUCCESSFUL FETCH LOCATION CSR'        15890099
159000                                  TO WS-ABEND-OPERATION           15900099
159100                    MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1       15910099
159200                    MOVE SPACES     TO WS-ABEND-STRUCTURE-2       15920099
159300                    PERFORM Z999-SQL-ERROR                        15930099
159400             END-EVALUATE                                         15940099
159500     END-PERFORM.                                                 15950099
159600                                                                  15960099
159700*--------------------------------------------------------------*  15970099
159800* CLOSE LOCATION CURSOR                                        *  15980099
159900*--------------------------------------------------------------*  15990099
160000 X300-CLOSE-LOCATION-CSR.                                         16000099
160100                                                                  16010099
160200     EXEC SQL                                                     16020099
160300        CLOSE LOCATION_CSR                                        16030099
160400     END-EXEC.                                                    16040099
160500                                                                  16050099
160600     EVALUATE TRUE                                                16060099
160700         WHEN SQLCODE = ZERO                                      16070099
160800              CONTINUE                                            16080099
160900         WHEN SQLWARN0 NOT = SPACES                               16090099
161000         WHEN SQLCODE  NOT = ZERO                                 16100099
161100              MOVE 'X300-CLOSE-LOCATION-CSR        '              16110099
161200                            TO WS-ABEND-PARAGRAPH                 16120099
161300              MOVE 'UNSUCCESSFUL CLOSE LOCATION CURSOR'           16130099
161400                            TO WS-ABEND-OPERATION                 16140099
161500              MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1             16150099
161600              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             16160099
161700              PERFORM Z999-SQL-ERROR                              16170099
161800     END-EVALUATE.                                                16180099
161900                                                                  16190099
162000*------------------------------------------------------------*    16200099
162100* COMMIT                                                     *    16210099
162200*------------------------------------------------------------*    16220099
162300 X500-COMMIT.                                                     16230099
162400                                                                  16240099
162500     EXEC SQL                                                     16250099
162600         COMMIT                                                   16260099
162700     END-EXEC.                                                    16270099
162800                                                                  16280099
162900     EVALUATE TRUE                                                16290099
163000         WHEN SQLCODE = ZERO                                      16300099
163100              CONTINUE                                            16310099
163200         WHEN SQLWARN0 NOT = SPACES                               16320099
163300         WHEN SQLCODE  NOT = ZERO                                 16330099
163400              MOVE 'X500-COMMIT                    '              16340099
163500                            TO WS-ABEND-PARAGRAPH                 16350099
163600              MOVE 'UNSUCCESSFUL COMMIT               '           16360099
163700                            TO WS-ABEND-OPERATION                 16370099
163800              MOVE SPACES     TO WS-ABEND-STRUCTURE-1             16380099
163900              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             16390099
164000              PERFORM Z999-SQL-ERROR                              16400099
164100     END-EVALUATE.                                                16410099
164200                                                                  16420099
164300*----------------------------------------------------------------*16430099
164400*    WRITE TEXT FILE OUT.                                        *16440099
164500*----------------------------------------------------------------*16450099
164600 W100-WRITE-OUTPUT.                                               16460099
164700                                                                  16470099
164800     IF AP045-NET-COST-AMT = ZERO                                 16480099
164900         DISPLAY '**************************************'         16490099
165000         DISPLAY 'COST WAS ZERO AND UPC NOT WRITTEN OUT '         16500099
165100         DISPLAY 'INVOICE NBR ' WS-VENDOR-INVOICE-NBR             16510099
165200         DISPLAY 'UPC NBR ' WS-UPC-CODE-X                         16520099
165300         DISPLAY '**************************************'         16530099
165400     ELSE                                                         16540099
165410         IF NO-EDI-ERROR                                          16541099
165500            WRITE ADJ-JOURNAL-REC FROM AP045-TRANSACTION-FILE     16550099
165600            ADD +1 TO WS-TOT-OUTPUT-CNT                           16560099
165710         END-IF                                                   16571099
165720     END-IF.                                                      16572099
165800                                                                  16580099
165900*--------------------------------------------------------------*  16590099
166000* WRITE OUT THE REJECTED EDI INVOICE TRANSACTION RECORDS       *  16600099
166100*--------------------------------------------------------------*  16610099
166200 W300-WRITE-REJECT.                                               16620099
166300                                                                  16630099
166400     PERFORM VARYING INV-INDX FROM 1 BY 1                         16640099
166500        UNTIL INV-INDX > 11000 OR                                 16650099
166600              WS-AP050-KEY-AREA(INV-INDX) = HIGH-VALUES           16660099
166700        INITIALIZE WS-REJECT-REC                                  16670099
166800        MOVE WS-AP050-KEY-AREA(INV-INDX)  TO AP051-KEY            16680099
166900        MOVE WS-AP050-DATA-AREA(INV-INDX) TO AP051-DATA-AREA      16690099
167000        MOVE WS-DUN-NBR-9S  TO AP051-SORT-VENDOR-NBR              16700099
167100        MOVE ENTNME-ENT-NAME-DESC TO AP051-VENDOR-DESC            16710099
167200        MOVE WS-SAVE-INVOICE-NBR TO AP051-SORT-INVOICE-NBR        16720099
167300        IF  WS-SAVE-INTERCHG-CNTL-NBR NUMERIC                     16730099
167400            MOVE WS-SAVE-INTERCHG-CNTL-NBR                        16740099
167500                               TO AP051-SAVE-INTERCHG-CNTL-NBR    16750099
167600        ELSE                                                      16760099
167700            MOVE ZEROS         TO AP051-SAVE-INTERCHG-CNTL-NBR    16770099
167800        END-IF                                                    16780099
167900        MOVE WS-INV-ERR-TBL-AREA(INV-INDX) TO                     16790099
168000                                      AP051-ERROR-CODE-AREA       16800099
168100        IF ERR-DETAIL-GROSS-INVOICE AND                           16810099
168200           WS-AP050-REC-TYPE(INV-INDX) = HIGH-VALUES              16820099
168300           COMPUTE WS-DETAIL-ADJ-GROSS-INV-AMT                    16830099
168400                 =   (WS-DETAIL-GROSS-INVOICE-AMT                 16840099
168500                 +    WS-DETAIL-CHRG-AMT)                         16850099
168600                 -    WS-DETAIL-ALLW-AMT                          16860099
168700           MOVE WS-DETAIL-ADJ-GROSS-INV-AMT TO                    16870099
168800                                  AP051-CALC-SUM-EXTEN            16880099
168900           SET AP051-ERR-DETL-GROSS-INV TO TRUE                   16890099
169000           SET AP051-CHOSE-FOR-PRINT TO TRUE                      16900099
169100        END-IF                                                    16910099
169200        IF AP051-ERR-CD(1) NOT = '00' OR                          16920099
169300          (ERR-DETAIL-GROSS-INVOICE AND                           16930099
169400          (WS-AP050-REC-TYPE(INV-INDX) = '05' OR '06' OR '07'))   16940099
169500           SET AP051-CHOSE-FOR-PRINT TO TRUE                      16950099
169600        END-IF                                                    16960099
169610        IF AP051-ERR-CD(1) NOT = '00'                             16961099
169700           WRITE REJECTION-REC FROM WS-REJECT-REC                 16970099
169710        END-IF                                                    16971099
169800        ADD 1 TO WS-REJECT-REC-CNT                                16980099
169900     END-PERFORM.                                                 16990099
170000                                                                  17000099
170100*--------------------------------------------------------------*  17010099
170200* PROCESS DB2 ABENDS                                           *  17020099
170300*--------------------------------------------------------------*  17030099
170400 Z999-SQL-ERROR.                                                  17040099
170500                                                                  17050099
170600     DISPLAY '*** DB2 ERROR '.                                    17060099
170700     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 17070099
170800     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               17080099
170900     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               17090099
171000     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             17100099
171100     IF WS-ABEND-STRUCTURE-2 > SPACES                             17110099
171200         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         17120099
171300                                                                  17130099
171400                                                                  17140099
171500     MOVE +4013                    TO ABEND-CODE.                 17150099
171600                                                                  17160099
171700     COPY DPPD004.                                                17170099
171800     CALL 'ILBOABN0' USING ABEND-CODE.                            17180099
171900                                                                  17190099
