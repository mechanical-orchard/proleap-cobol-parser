000400*                                                                 00040046
000410***************************************************************** 00041046
000500***NOTE!!!  COMPILE PROGRAM WITH SOCKETS ************************ 00050000
000600***************************************************************** 00060000
000700*                                                                 00070046
000900 IDENTIFICATION DIVISION.                                         00090000
001000 TITLE 'PACK-TO-LITE DISTRIBUTION STATUS UPLOAD'.                 00100000
001100                                                                  00110000
001200 PROGRAM-ID.             PCKCS722.                                00120000
001300 AUTHOR.                 RON KRIER.                               00130000
001400 INSTALLATION.           KOHLS.                                   00140000
001500 DATE-WRITTEN            OCTOBER 2000.                            00150000
001600 DATE-COMPILED.                                                   00160000
001700                                                                  00170000
001800******************************************************************00180000
001900* THIS PROGRAM WILL BE STARTED BY THE PACK-TO-LIGHT SYSTEM AND    00190000
002000* WILL ACCEPT THE UPLOAD OF INFORMATION RELATED TO A DISTRIBUTION 00200000
002100* BEING CLOSED IN ORDER TO UPDATE THE STORE UNITS TO THE HOST     00210000
002200* TABLES.                                                         00220000
002300******************************************************************00230000
002400                                                                  00240000
002500 ENVIRONMENT DIVISION.                                            00250000
002600 DATA DIVISION.                                                   00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800                                                                  00280000
002900*                                                                 00290000
003000*  SOCKET COMMANDS CODES NEED FOR THE TCP/IP SOCKET CALLS         00300000
003100     COPY DPWS081.                                                00310000
003200*                                                                 00320000
003300*  CLOSED DISTRIBUTION RECORD LAYOUT UPLOADED TO THE              00330000
003400*  MAINFRAME FROM THE PACK-TO-LIGHT SYSTEM.                       00340000
003500     COPY PCWS186.                                                00350000
003600                                                                  00360000
003700*---------------------------------------------------------------* 00370000
003800*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00380000
003900*  THE RECEIVER TRACKING MODULE (RCKUT137).                     * 00390000
004000*---------------------------------------------------------------* 00400000
004100     COPY RCWS071.                                                00410000
004200                                                                  00420000
004300*---------------------------------------------------------------* 00430000
004400*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00440000
004500*  THE VERIFICATION TRANSACTION (PCKCS200).                     * 00450000
004600*---------------------------------------------------------------* 00460000
004700     COPY RCWS289.                                                00470000
004800                                                                  00480000
004900*---------------------------------------------------------------* 00490000
005000*  RECORD LAYOUTS FOR THE VEM MODULE                              00500000
005100*---------------------------------------------------------------* 00510000
005200     COPY RCWS038.                                                00520000
005300                                                                  00530000
005400*---------------------------------------------------------------* 00540000
005500*  RECORD LAYOUTS FOR THE AUTO VERF PARM CHECK MODULE             00550000
005600*---------------------------------------------------------------* 00560000
005700     COPY RCWS040.                                                00570000
005800                                                                  00580000
005900*---------------------------------------------------------------* 00590000
006000*  COMMUNICATION AREA FOR UNIT ADJUSTMENTS MODULE - SUKUT702    * 00600000
006100*---------------------------------------------------------------* 00610000
006200     COPY SUWS035.                                                00620000
006300                                                                  00630000
006400******************************************************************00640000
006500*  RANDOM NUMBER AREA.                                            00650000
006600******************************************************************00660000
006700     COPY DPWS902.                                                00670000
006800                                                                  00680000
006900*                                                                 00690000
007000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00700000
007100     COPY DPWS013.                                                00710000
007200                                                                  00720000
007300*-----------------------------------------------------------------00730000
007400*  COPYBOOK FOR LOGISTIC MODULE XLKUT001                          00740000
007500*-----------------------------------------------------------------00750000
007600     COPY XLWS001.                                                00760000
007700                                                                  00770000
007800*-----------------------------------------------------------------00780000
007900* COMMAREA LAYOUT FOR THE UNITS WORKED MODULE (PCKCS756)          00790051
008000*-----------------------------------------------------------------00800000
008100     COPY PCWS238.                                                00810000
008200                                                                  00820000
008400*-----------------------------------------------------------------00840000
008500* TEMPORARY STORAGE QUEUE - STORE UNIT ADJUSTMENTS TO BE SENT     00850000
008600* TO RMS PO BY PCKCS759                                           00860000
008700*-----------------------------------------------------------------00870000
008800     COPY PCWS241.                                                00880000
009000                                                                  00900000
009100 77  TASK-START                     PIC X(40)                     00910000
009200      VALUE IS 'CONFIRMS....CICS-TCPIP INTERFACE START.;'.        00920000
009300 77  TASK-END                       PIC X(40)                     00930000
009400      VALUE IS 'CONFIRMS....CICS-TCPIP INTERFACE END....'.        00940000
009500*                                                                 00950000
009600 01  TCP-BUF-AREA.                                                00960000
009700     05  TCP-BUF-ALL                     PIC X(100) VALUE SPACES. 00970000
009800     05  TCP-BUF REDEFINES TCP-BUF-ALL                            00980000
009900                OCCURS 100 TIMES         PIC  X(01).              00990000
010000 01  PV-BUFFER-SUB                    PIC 9(08) BINARY VALUE ZERO.01000000
010100                                                                  01010000
010200 01  PC-PROGRAM-CONSTANTS.                                        01020000
010300     05  PC-MSG-TABLE-SIZE         PIC S9(03) COMP-3 VALUE 200.   01030000
010400     05  PC-RCKUT124               PIC X(08)  VALUE 'RCKUT124'.   01040000
010500                                                                  01050000
010600     05  PC-VRFY-ADJ-QUEUE-SEQ           PIC  9      VALUE 6.     01060000
010710     05  PC-TERM-CHARACTER               PIC  X(01)  VALUE X'3B'. 01071000
010800     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE +3     01080000
010900                                                     COMP-3.      01090000
011000     05  PC-NEW-TROUBLE                  PIC  X(01)  VALUE 'N'.   01100000
011100     05  PC-IN-PROCESS-TROUBLE           PIC  X(01)  VALUE 'I'.   01110000
011200     05  PC-RESOLVED-TROUBLE             PIC  X(01)  VALUE 'R'.   01120000
011300     05  PC-TROUBLE                      PIC  X(01)  VALUE 'T'.   01130000
011400                                                                  01140000
011500     05  PC-READY-TO-POST-STATUS         PIC  X(01)  VALUE 'N'.   01150000
011600     05  PC-READY-TO-VERIFY-STATUS       PIC  X(01)  VALUE 'R'.   01160000
011700     05  PC-PREVIOUSLY-VERIFIED-STATUS   PIC  X(01)  VALUE 'P'.   01170000
011800     05  PC-SPLIT-COMP-WAIT-STATUS       PIC  X(01)  VALUE 'B'.   01180000
011900     05  PC-NOT-MULT-OF-RATIO-STATUS     PIC  X(01)  VALUE 'A'.   01190000
012000     05  PC-NOT-ARRIVED-STATUS           PIC  X(01)  VALUE 'G'.   01200000
012100     05  PC-ERROR-STATUS                 PIC  X(01)  VALUE 'E'.   01210000
012200                                                                  01220000
012300     05  PC-RANDOM-NBR-GENERATOR      PIC  X(08) VALUE 'DPKUT902'.01230000
012400     05  PC-SUKUT702                  PIC  X(08) VALUE 'SUKUT702'.01240000
012500     05  PC-CURRENT-PGM-NAME          PIC  X(08) VALUE 'PCKCS722'.01250000
012600     05  PC-UNTS-WRKD-PGRM-NAME       PIC  X(08) VALUE 'PCKCS756'.01260000
012700     05  PC-SPACES                    PIC  X(22) VALUE SPACES.    01270000
012800     05  PC-NO-FREIGHT-BILL-STATUS    PIC  X(01) VALUE 'F'.       01280000
012900     05  PC-A                         PIC  X(01) VALUE 'A'.       01290000
013000     05  PC-N                         PIC  X(01) VALUE 'N'.       01300000
013100     05  PC-P                         PIC  X(01) VALUE 'P'.       01310000
013200     05  PC-Q                         PIC  X(01) VALUE 'Q'.       01320000
013300     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01330000
013400                                   '9999-09-09-09.09.09.999999'.  01340000
013500     05  PC-DEFAULT-DATE-1            PIC  X(26) VALUE            01350000
013600                                   '9999-09-09-09.09.09.999999'.  01360000
013700     05  PC-DEFAULT-DATE-2            PIC  X(26) VALUE            01370000
013800                                   '0001-01-01-00.00.00.000000'.  01380000
013900     05  PC-PREPK-P2L-DWNLD           PIC  X(01) VALUE 'D'.       01390000
014000     05  PC-DISPLAY-PO                PIC  9(8)  VALUE ZEROS.     01400000
014100     05  PC-DISPLAY-RCVR              PIC  9(4)  VALUE ZEROS.     01410000
014200     05  PC-DISPLAY-LINE              PIC  9(4)  VALUE ZEROS.     01420000
014300     05  PC-DISPLAY-OPER              PIC  9(4)  VALUE ZEROS.     01430000
014400     05  PC-DISPLAY-WORK              PIC  9(4)  VALUE ZEROS.     01440000
014500     05  PC-DISPLAY-SQL-CODE          PIC  9999- VALUE ZEROS.     01450000
014600     05  PC-DISPLAY-RANDOM-NBR        PIC  9(9)  VALUE ZEROS.     01460000
014700     05  PC-DISPLAY-CICS-RESP         PIC  999999999-             01470000
014800                                                  VALUE ZEROS.    01480000
014900     05  PV-DISPLAY-DIFF              PIC  999999999-             01490000
015000                                                  VALUE ZEROS.    01500000
015100     05  PV-DISPLAY-NET               PIC  999999999-             01510000
015200                                                  VALUE ZEROS.    01520000
015300     05  PV-DISPLAY-ADJ-NBR           PIC  9(09)  VALUE ZEROS.    01530000
015400     05  PV-DISPLAY-CICS-RESP         PIC  9(04).                 01540000
015410     05  PV-DISP-THSND-REC            PIC  9(04).                 01541049
015500                                                                  01550000
015600*                                                                 01560000
015700 01  DK-DB2-KEYS.                                                 01570000
015800     05  DK-DISTHD-OPER          PIC S9(4) VALUE ZERO COMP SYNC.  01580000
015900     05  DK-TRNID                PIC  X(4) VALUE SPACE.           01590000
016000     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  01600000
016100     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  01610000
016110     05  DK-REC-SEQ-NBR-THSND    PIC S9(9) VALUE ZERO COMP SYNC.  01611046
016200     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  01620000
016300     05  DK-WRK-ORD-SEQ-NBR      PIC S9(4) VALUE ZERO COMP SYNC.  01630000
016400     05  DK-STR-NBR              PIC S9(4) VALUE ZERO COMP SYNC.  01640000
016500     05  DK-PREPK-PO-NBR         PIC S9(9) VALUE ZERO COMP SYNC.  01650000
016600     05  DK-PREPK-REC-SEQ-NBR    PIC S9(9) VALUE ZERO COMP SYNC.  01660000
016700     05  DK-PREPK-LINE-NBR       PIC S9(9) VALUE ZERO COMP SYNC.  01670000
016800     05  DK-PREPK-LINE-NBR-2     PIC S9(9) VALUE ZERO COMP SYNC.  01680000
016900     05  DK-PREPK-ID             PIC S9(4) VALUE ZERO COMP SYNC.  01690000
017000     05  DK-UPC-NBR              PIC S9(15)V VALUE ZERO COMP-3.   01700000
017100                                                                  01710000
017200 01  PS-PROGRAM-SWITCHES.                                         01720000
017300     05  PS-SOCKET-ERROR-SW           PIC X(01) VALUE 'N'.        01730000
017400         88  PS-SOCKET-ERROR-NO                 VALUE 'N'.        01740000
017500         88  PS-SOCKET-ERROR                    VALUE 'Y'.        01750000
017600     05  PS-VALID-RANDOM-NUMBER-SW       PIC  X(01)  VALUE 'N'.   01760000
017700         88  PS-NOT-VALID-RANDOM-NUMBER              VALUE 'Y'.   01770000
017800         88  PS-VALID-RANDOM-NUMBER                  VALUE 'N'.   01780000
017900     05  PS-MANUALLY-VERIFIED-SW         PIC  X(01)  VALUE 'N'.   01790000
018000         88  PS-MANUALLY-VERIFIED                    VALUE 'Y'.   01800000
018100         88  PS-NOT-MANUALLY-VERIFIED                VALUE 'N'.   01810000
018200     05  PS-TDISTDT-ROW-PRESENT-SW       PIC  X(01)  VALUE 'Y'.   01820000
018300         88  PS-TDISTDT-ROW-PRESENT                  VALUE 'Y'.   01830000
018400         88  PS-TDISTDT-ROW-NOT-PRESENT              VALUE 'N'.   01840000
018500     05  PS-PREV-TDISTDT-PRESENT-SW      PIC  X(01)  VALUE 'Y'.   01850000
018600         88  PS-PREV-TDISTDT-PRESENT                 VALUE 'Y'.   01860000
018700         88  PS-PREV-TDISTDT-NOT-PRESENT             VALUE 'N'.   01870000
018800     05  PS-WAIT-FOR-CONFIRM-SW          PIC  X(01)  VALUE 'N'.   01880000
018900         88  PS-WAIT-FOR-CONFIRM                     VALUE 'Y'.   01890000
019000         88  PS-DO-NOT-WAIT-FOR-CONFIRM              VALUE 'N'.   01900000
019100     05  PS-PREVIOUSLY-VERIFIED-SW       PIC  X(01)  VALUE 'N'.   01910000
019200         88  PS-PREVIOUSLY-VERIFIED                  VALUE 'Y'.   01920000
019300         88  PS-NOT-PREVIOUSLY-VERIFIED              VALUE 'N'.   01930000
019400     05  PS-FREIGHT-BILL-SW              PIC  X(01)  VALUE 'N'.   01940000
019500         88  PS-FREIGHT-BILL-FOUND                   VALUE 'Y'.   01950000
019600         88  PS-NO-FREIGHT-BILL                      VALUE 'N'.   01960000
019700     05  PS-MULT-OF-RATIO-SW             PIC  X(01)  VALUE 'Y'.   01970000
019800         88  PS-MULT-OF-RATIO                        VALUE 'Y'.   01980000
019900         88  PS-NOT-MULT-OF-RATIO                    VALUE 'N'.   01990000
020000     05  PS-ARRIVED-SW                   PIC  X(01)  VALUE 'Y'.   02000000
020100         88  PS-ARRIVED                              VALUE 'Y'.   02010000
020200         88  PS-NOT-ARRIVED                          VALUE 'N'.   02020000
020300     05  PS-PREPK-LINES-LEFT-SW          PIC  X(01)  VALUE 'N'.   02030000
020400         88  PS-PREPK-LINES-LEFT                     VALUE 'N'.   02040000
020500         88  PS-NO-PREPK-LINES-LEFT                  VALUE 'Y'.   02050000
020600     05  PS-PREPK-RATIO-LINES-LEFT-SW    PIC  X(01)  VALUE 'N'.   02060000
020700         88  PS-PREPK-RATIO-LINES-LEFT               VALUE 'N'.   02070000
020800         88  PS-NO-PREPK-RATIO-LINES-LEFT            VALUE 'Y'.   02080000
020900     05  PS-PREPK-DISTDT-LINES-LEFT-SW   PIC  X(01)  VALUE 'N'.   02090000
021000         88  PS-PREPK-DISTDT-LINES-LEFT              VALUE 'N'.   02100000
021100         88  PS-NO-PREPK-DISTDT-LINES-LEFT           VALUE 'Y'.   02110000
021200     05  PS-PRPK-TDISTDT-ROW-PRESENT-SW  PIC  X(01)  VALUE 'Y'.   02120000
021300         88  PS-PRPK-TDISTDT-ROW-PRESENT             VALUE 'Y'.   02130000
021400         88  PS-PRPK-TDISTDT-ROW-NOT-PRESNT          VALUE 'N'.   02140000
021500     05  PS-ARRIVED-STATUS-SW            PIC  X(01)  VALUE 'Y'.   02150000
021600         88  PS-ARRIVED-STATUS                       VALUE 'Y'.   02160000
021700         88  PS-NOT-ARRIVED-STATUS                   VALUE 'N'.   02170000
021800     05  PS-MULT-OF-RATIO-STATUS-SW      PIC  X(01)  VALUE 'Y'.   02180000
021900         88  PS-MULT-OF-RATIO-STATUS                 VALUE 'Y'.   02190000
022000         88  PS-NOT-MULT-OF-RATIO-STATUS             VALUE 'N'.   02200000
022100                                                                  02210000
022200     05  PS-PREV-UPLOAD-UPDATE-SW        PIC  X(01)  VALUE 'N'.   02220000
022300         88  PS-PREV-UPLOAD-UPDATE                   VALUE 'Y'.   02230000
022400         88  PS-PREV-UPLOAD-NOT-UPDATE               VALUE 'N'.   02240000
022500                                                                  02250000
022600     05  PS-PART-RECEIVE-SW              PIC  X(01)  VALUE 'S'.   02260000
022700         88  PS-PART-RECEIVE                         VALUE 'P'.   02270000
022800         88  PS-COMP-RECEIVE                         VALUE 'C'.   02280000
022900         88  PS-ERROR-RECEIVE                        VALUE 'E'.   02290000
023000         88  PS-START-RECEIVE                        VALUE 'S'.   02300000
023100                                                                  02310000
023300     05  PS-PREV-UPLOAD-SW               PIC  X(01)  VALUE 'N'.   02330000
023400         88  PS-PREV-UPLOAD                          VALUE 'Y'.   02340000
023500         88  PS-NOT-PREV-UPLOAD                      VALUE 'N'.   02350000
023600     05  PS-PREV-UPLOAD-CHECK-SW         PIC  X(01)  VALUE 'N'.   02360000
023700         88  PS-PREV-UPLOAD-CHECK-DONE               VALUE 'Y'.   02370000
024000     05  PS-UPLOAD-ERROR-SW              PIC  X(01)  VALUE 'N'.   02400000
024100         88  PS-UPLOAD-ERROR                         VALUE 'Y'.   02410000
024200         88  PS-NOT-UPLOAD-ERROR                     VALUE 'N'.   02420000
024400                                                                  02440000
024500     05  PS-SOCKET-SW                    PIC  X(01)  VALUE 'N'.   02450000
024600         88  PS-SOCKET-OPEN                          VALUE 'Y'.   02460000
024700         88  PS-SOCKET-CLOSED                        VALUE 'N'.   02470000
024800     05  PS-CALL-UNIT-ADJ-MODULE-SW      PIC  X(01)  VALUE 'N'.   02480000
024900         88  PS-CALL-UNIT-ADJ-MOD-YES                VALUE 'Y'.   02490000
025000         88  PS-CALL-UNIT-ADJ-MOD-NO                 VALUE 'N'.   02500000
025100                                                                  02510000
025101     05  PS-TDISTHD-ERROR-SW             PIC  X(01)  VALUE 'N'.   02510147
025102         88  PS-TDISTHD-ERROR                        VALUE 'Y'.   02510247
025103         88  PS-NOT-TDISTHD-ERROR                    VALUE 'N'.   02510347
025104                                                                  02510447
025110     05  PS-RCVR-THSND-SW                PIC  X(01)  VALUE 'N'.   02511047
025120         88  PS-RCVR-THSND                           VALUE 'Y'.   02512047
025130         88  PS-RCVR-THSND-NO                        VALUE 'N'.   02513047
025131     05  PS-UNT-WRK-FROM-PICKMADE-sw     PIC  X(01)  VALUE 'N'.   02513152
025132         88  PS-UNT-WRK-FROM-PICKMADE                VALUE 'Y'.   02513252
025133         88  PS-UNT-WRK-FROM-PICKMADE-NO             VALUE 'N'.   02513352
025140                                                                  02514039
025200 01  PV-PROGRAM-VARIABLES.                                        02520000
025300                                                                  02530000
025400     05  PV-DISPLAY-SOCKETS           PIC  9(8)  VALUE ZERO.      02540000
025500     05  PV-DISPLAY-SOCKNO            PIC  9(8)- VALUE ZERO.      02550000
025600     05  PV-PREV-SEQUENCE             PIC S9(05) COMP-3           02560000
025700                                                     VALUE ZERO.  02570000
025800     05  PV-NEXT-SEQUENCE             PIC S9(05) COMP-3           02580000
025900                                                     VALUE ZERO.  02590000
026000                                                                  02600000
026100     05  PV-VRFY-ADJ-QUEUE-NAME.                                  02610000
026200         10  PV-VRFY-ADJ-TERM-ID        PIC   X(4).               02620000
026300         10  PV-VRFY-ADJ-TASK-NUMBER    PIC  S9(5) COMP-3.        02630000
026400         10  PV-VRFY-ADJ-ADJ-SEQ        PIC   9.                  02640000
026500     05  PV-NUMBER-OF-TS-ITEMS          PIC  S9(5) COMP-3.        02650000
026600     05  PV-VRFY-ITEM                 PIC S9(4) VALUE ZERO        02660000
026700                                                COMP SYNC.        02670000
026800                                                                  02680000
026900     05  PV-PREV-ACTL-ALLOC-QTY         PIC  S9(9) COMP.          02690000
027000     05  PV-PREV-ACTL-ALLOC-DIFF        PIC  S9(9) COMP.          02700000
027100     05  PV-PREV-ACTL-ALLOC-BEG         PIC  S9(9) COMP.          02710000
027200     05  PV-PREV-ACTL-ALLOC-AFT         PIC  S9(9) COMP.          02720000
027300     05  PV-PREV-ACTL-ALLOC-NET         PIC  S9(9) COMP.          02730000
027400                                                                  02740000
027500     05  PV-P2L-SPLT-UNT-QTY-X2         PIC S9(09)  COMP.         02750000
027600     05  PV-P2L-SPLT-UNT-QTY            PIC S9(09)  COMP.         02760000
027700     05  PV-SUMMARY-FIELD               PIC S9(10) VALUE +0 COMP. 02770000
027800     05  PV-PREPK-RATO-QTY              PIC S9(04) VALUE +0 COMP. 02780000
027900     05  PV-ALLOC-QTY                   PIC 9(09) VALUE ZEROES.   02790000
028000     05  PV-ALLOC-QTY2                  PIC 9(09) VALUE ZEROES.   02800000
028100     05  PV-RMNDR-QTY                   PIC 9(09) VALUE ZEROES.   02810000
028200     05  PV-VE-PREPK-CNT                PIC 9(09) VALUE ZEROES.   02820000
028300     05  PV-VE-PREPK-REM                PIC 9(09) VALUE ZEROES.   02830000
028400     05  PV-CURRENT-TMST                 PIC X(26).               02840000
028500     05  PV-ORDER-NBR                    PIC  9(09)  VALUE ZEROES.02850000
028600     05  PV-RCVR-SEQ-NBR                 PIC  9(04)  VALUE ZEROES.02860000
028700     05  PV-LNE-NBR                      PIC  9(04)  VALUE ZEROES.02870000
028800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02880000
028900                                                     COMP SYNC.   02890000
029000     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  02900000
029100                                                     COMP SYNC.   02910000
029200     05  PV-CICS-MSG-AREA2               PIC  X(132) VALUE SPACE. 02920000
029300     05  PV-CICS-MSG-HOLD.                                        02930000
029400         10  FILLER                      PIC  X(01)  VALUE SPACE. 02940000
029500         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02950000
029600     05  PV-CICS-MSG-HOLD2.                                       02960000
029700         10  FILLER                      PIC  X(01)  VALUE SPACE. 02970000
029800         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02980000
029900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02990000
030000                                                     COMP SYNC.   03000000
030100     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZEROS  03010000
030200                                                     COMP SYNC.   03020000
030300     05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  03030000
030400                                                     COMP SYNC.   03040000
030500     05  PV-DB2-TROUBLE-COUNT            PIC S9(09)  VALUE ZEROS  03050000
030600                                                     COMP-3.      03060000
030700     05  PV-DB2-COUNT                    PIC S9(09)  VALUE ZEROS  03070000
030800                                                     COMP-3.      03080000
030900     05  PV-DB2-FREIGHT-COUNT            PIC S9(09)  VALUE ZEROS  03090000
031000                                                     COMP-3.      03100000
031100     05  PV-STR-RECS-RECEIVED            PIC  9(03)  VALUE ZEROS. 03110000
031200     05  PV-STR-RECS-SENT                PIC  9(03)  VALUE ZEROS. 03120000
031300     05  PV-TASK-X.                                               03130000
031400         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  03140000
031500     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     03150000
031600                                                     COMP SYNC.   03160000
031700     05  PV-WRITE-LENGTH                 PIC S9(04)  VALUE +0     03170000
031800                                                     COMP SYNC.   03180000
031900     05  PV-STACK-RBA                    PIC S9(09)  VALUE ZEROS  03190000
032000                                                     COMP SYNC.   03200000
032100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 03210000
032200     05  PV-PRCG-STAT-CDE                PIC  X(01)  VALUE SPACE. 03220000
032300     05  PV-ERROR-OPER                   PIC  9(04)  VALUE ZEROS. 03230000
032400     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 03240000
032500     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 03250000
032600     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 03260000
032700     05  PV-ERROR-STR-NBR                PIC  9(04)  VALUE ZEROS. 03270000
032800     05  PV-ERROR-QTY                    PIC  Z(09)  VALUE ZEROS. 03280000
032900     05  PV-ERROR-BEFORE                 PIC  Z(09)- VALUE ZEROS. 03290000
033000     05  PV-ERROR-AFTER                  PIC  Z(09)- VALUE ZEROS. 03300000
033100     05  PV-ERROR-ADJUST                 PIC  Z(09)- VALUE ZEROS. 03310000
033200                                                                  03320000
033300     05  PV-RETCODE                      PIC  9(08)  VALUE ZEROS. 03330000
033400     05  PV-TCPLENG                      PIC  9(08)  VALUE ZEROS. 03340000
033500     05  PV-ERRNO                        PIC  9(08)  VALUE ZEROS. 03350000
033600     05  PV-TCP-BUF                      PIC  X(50)  VALUE SPACES.03360000
033700*                                                                 03370000
033800     05  PV-ACTUAL-DISTRO-QTY-X.                                  03380000
033900         10 PV-ACTUAL-DISTRO-QTY         PIC 9(06).               03390000
034000     05  PV-STR-NBR-X.                                            03400000
034100         10 PV-STR-NBR                   PIC 9(04).               03410000
034200     05  PV-ORD-NBR-X.                                            03420000
034300         10 PV-ORD-NBR                   PIC 9(08).               03430000
034400     05  PV-RECEIVER-NBR-X.                                       03440000
034500         10 PV-RECEIVER-NBR              PIC 9(03).               03450000
034600     05  PV-LINE-NBR-X.                                           03460000
034700         10 PV-LINE-NBR                  PIC 9(04).               03470000
034800     05  PV-WORK-ORD-SEQ-NBR-X.                                   03480000
034900         10 PV-WORK-ORD-SEQ-NBR          PIC 9(03).               03490000
035000                                                                  03500000
035100     05  PV-TCP-EXP-LENGTH               PIC 9(08)   VALUE 50.    03510000
035200     05  PV-TCP-RET-LENGTH               PIC 9(08)   VALUE ZEROS. 03520000
035300     05  PV-TCP-REM-LENGTH               PIC 9(08)   VALUE ZEROS. 03530000
035400     05  PV-TCP-PRCSD-LENGTH             PIC 9(08)   VALUE ZEROS. 03540000
035500     05  PV-TCP-TOT-LENGTH               PIC 9(08)   VALUE ZEROS. 03550000
035600     05  PV-PRPK-REC-ORD-LNE-NBR         PIC S9(9)   COMP.        03560000
035700     05  PV-PRPK-REC-PREPK-RATO-QTY      PIC S9(4)   COMP.        03570000
035800     05  PV-PRPK-ACTL-ALLOC-QTY-SNGL     PIC  9(06)  VALUE ZEROS. 03580000
035900     05  PV-PRPK-ACTL-ALLOC-QTY-REM      PIC  9(06)  VALUE ZEROS. 03590000
036000     05  PV-PRPK-ACTL-ALLOC-QTY-RATO     PIC S9(09)  VALUE ZEROS  03600000
036100                                                     COMP.        03610000
036300     05  PV-PREV-UPLOAD-TMST             PIC  X(26).              03630000
036400         88  PV-NOT-PREV-UPLOAD-TMST                 VALUE        03640000
036500             '9999-09-09-09.09.09.999999'.                        03650000
036700                                                                  03670000
036900     05  PV-SYSTEM-ID.                                            03690000
037000         10  FILLER              PIC  X(04)  VALUE SPACE.         03700000
037100         10  PV-REGION-IND       PIC  X(01).                      03710000
037200             88  PV-TEST-CICS                VALUE 'T'.           03720000
037300             88  PV-QA-CICS                  VALUE 'Q'.           03730000
037400             88  PV-PROD-CICS                VALUE 'P'.           03740000
037500             88  PV-LEARN-CICS               VALUE 'L'.           03750000
037600         10  FILLER              PIC  X(03)  VALUE SPACES.        03760000
037800                                                                  03780000
038000     05  PV-CYC-ADJ-NBR          PIC S9(9) COMP VALUE ZEROES.     03800000
038200                                                                  03820000
038400* add select parameter before recv socket command to determine if 03840000
038500* is still active                                                 03850000
038600*                                                                 03860000
038700* SELECT-NUMFDS needs to be set to 3.  1 for each p2l system and  03870000
038800* one for the print management system                             03880000
038900*                                                                 03890000
039000*                                                                 03900000
039100 01  SELECT-PARMS.                                                03910000
039200     02  SELECT-NUMFDS          PIC 9(8) COMP VALUE 3.            03920000
039300     02  SELECT-TIMEOUT.                                          03930000
039400         03  SELECT-SECS        PIC 9(8) COMP VALUE 05.           03940000
039500         03  SELECT-MILLSECS    PIC 9(8) COMP VALUE 0.            03950000
039600     02  SELECT-RD-MASK         PIC X(16).                        03960000
039700     02  SELECT-WR-MASK         PIC X(16).                        03970000
039800     02  SELECT-EX-MASK         PIC X(16).                        03980000
039900     02  SELECT-RR-MASK         PIC X(16).                        03990000
040000     02  SELECT-RW-MASK         PIC X(16).                        04000000
040100     02  SELECT-RE-MASK         PIC X(16).                        04010000
040200                                                                  04020000
040300 01  CHAR-MASK.                                                   04030000
040400     02 CHAR-STRING             PIC  X(100).                      04040000
040500                                                                  04050000
040600 01  CHAR-ARRAY REDEFINES CHAR-MASK.                              04060000
040700     02  CHAR-ENTRY-TABLE OCCURS 100 TIMES.                       04070000
040800       03  CHAR-ENTRY         PIC  X.                             04080000
040900                                                                  04090000
041000 01  BIT-MASK.                                                    04100000
041100     02  BIT-ARRAY            PIC  X(16).                         04110000
041200                                                                  04120000
041300 01  BIT-FUNCTION-CODES.                                          04130000
041400     02  CTOB                 PIC  X(4) VALUE 'CTOB'.             04140000
041500     02  BTOC                 PIC  X(4) VALUE 'BTOC'.             04150000
041600                                                                  04160000
041700 01  BIT-MASK-LENGTH          PIC  9(8) COMP VALUE 100.           04170000
041800                                                                  04180000
041900 01  BITMASK-TOKEN            PIC X(16) VALUE 'TCPIPBITMASKCOBL'. 04190000
042000 01  SOCKETS                  PIC  9(8) COMP VALUE 100.           04200000
042100 01  SOCKNO                   PIC S9(8) BINARY.                   04210000
042200 01  EZRETC                   PIC S9(8) COMP.                     04220000
042300                                                                  04230000
042400 01  SOCKET-SELECT-ERR.                                           04240000
042500     05  FILLER                       PIC X(10)                   04250000
042600         VALUE ' PCKCS722-'.                                      04260000
042700     05  FILLER                       PIC X(14)                   04270000
042800         VALUE 'SOCKET SELECT-'.                                  04280000
042900     05  FILLER                       PIC X(7)                    04290000
043000         VALUE '-RETCD='.                                         04300000
043100     05  SOCKET-RETCODE               PIC 9(10)-.                 04310000
043200     05  FILLER                       PIC X(1) VALUE SPACES.      04320000
043300     05  SOCKET-ERRNO                 PIC 9(8).                   04330000
043400     05  FILLER                       PIC X(1) VALUE SPACES.      04340000
043500     05  SOCKET-DESCR                 PIC X(10).                  04350000
043600     05  FILLER                       PIC X(1) VALUE SPACES.      04360000
043700     05  SOCKET-MESSAGE               PIC X(100).                 04370000
044100*                                                                 04410000
044200 01  PT-MSG-TABLE.                                                04420000
044300     05  PT-MSG-LINES OCCURS 200 TIMES                            04430000
044400                              INDEXED BY PT-MSG-IDX.              04440000
044500         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       04450000
044600         10  FILLER                      PIC  X(01).              04460000
044700         10  PT-TASK                     PIC 9(07).               04470000
044800         10  FILLER                      PIC  X(01).              04480000
044900         10  PT-MSG-LINE                 PIC X(100).              04490000
045000                                                                  04500000
045100                                                                  04510000
045200******************************************************************04520000
045300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ADJUSTMENTS        04530000
045400*  TABLE (SUT_FINCL_ADJ)                                          04540000
045500******************************************************************04550000
045600     EXEC SQL                                                     04560000
045700         INCLUDE SUT00030                                         04570000
045800     END-EXEC.                                                    04580000
045900                                                                  04590000
046000*---------------------------------------------------------------* 04600000
046100*    DB2 AREA FOR TDISTHD - DISTRIBUTION TRANSACTION HEADER     * 04610000
046200*---------------------------------------------------------------* 04620000
046300     EXEC SQL                                                     04630000
046400          INCLUDE TDISTHD                                         04640000
046500     END-EXEC.                                                    04650000
046600/                                                                 04660000
046700*---------------------------------------------------------------* 04670000
046800*    DB2 AREA FOR TDISTDT - DISTRIBUTION TRANSACTION DETAIL     * 04680000
046900*---------------------------------------------------------------* 04690000
047000     EXEC SQL                                                     04700000
047100          INCLUDE TDISTDT                                         04710000
047200     END-EXEC.                                                    04720000
047300/                                                                 04730000
047400*---------------------------------------------------------------* 04740000
047500*    DB2 AREA FOR TRECEIV                                       * 04750000
047600*---------------------------------------------------------------* 04760000
047700     EXEC SQL                                                     04770000
047800          INCLUDE TRECEIV                                         04780000
047900     END-EXEC.                                                    04790000
048000/                                                                 04800000
048100*---------------------------------------------------------------* 04810000
048200*    DB2 AREA FOR TRECITM - RECEIPT ITEM DISTRIBUTION TABLE     * 04820000
048300*---------------------------------------------------------------* 04830000
048400     EXEC SQL                                                     04840000
048500          INCLUDE TRECITM                                         04850000
048600     END-EXEC.                                                    04860000
048700/                                                                 04870000
048800*---------------------------------------------------------------* 04880000
048900*    DB2 AREA FOR TPURITM - PO-PURCHASE ITEM TABLE              * 04890000
049000*---------------------------------------------------------------* 04900000
049100     EXEC SQL                                                     04910000
049200          INCLUDE TPURITM                                         04920000
049300     END-EXEC.                                                    04930000
049400/                                                                 04940000
049500*---------------------------------------------------------------* 04950000
049600*    DB2 AREA FOR TTRBNTF - TROUBLE NOTIFICATION TABLE          * 04960000
049700*---------------------------------------------------------------* 04970000
049800     EXEC SQL                                                     04980000
049900          INCLUDE TTRBNTF                                         04990000
050000     END-EXEC.                                                    05000000
050100/                                                                 05010000
050200*---------------------------------------------------------------* 05020000
050300*    DB2 AREA FOR TTRBRSN - TROUBLE REASON CODE TABLE           * 05030000
050400*---------------------------------------------------------------* 05040000
050500     EXEC SQL                                                     05050000
050600          INCLUDE TTRBRSN                                         05060000
050700     END-EXEC.                                                    05070000
050800/                                                                 05080000
050900*---------------------------------------------------------------* 05090000
051000*    DB2 AREA FOR TSHIPMT - SHIPMENT TABLE                      * 05100000
051100*---------------------------------------------------------------* 05110000
051200     EXEC SQL                                                     05120000
051300          INCLUDE TSHIPMT                                         05130000
051400     END-EXEC.                                                    05140000
051500/                                                                 05150000
051600*---------------------------------------------------------------* 05160000
051700*    DB2 AREA FOR TSHPTPO - SHIPMENT PO TABLE                   * 05170000
051800*---------------------------------------------------------------* 05180000
051900     EXEC SQL                                                     05190000
052000          INCLUDE TSHPTPO                                         05200000
052100     END-EXEC.                                                    05210000
052200/                                                                 05220000
052300*---------------------------------------------------------------* 05230000
052400*    DB2 AREA FOR TKRPRPM - PARAMETER DATABASE                  * 05240000
052500*---------------------------------------------------------------* 05250000
052600     EXEC SQL                                                     05260000
052700         INCLUDE TKRPRPM                                          05270000
052800     END-EXEC.                                                    05280000
052900                                                                  05290000
052910*---------------------------------------------------------------* 05291037
052920*    DB2 AREA FOR TUPLDER - UPLOAD ERROR                        * 05292037
052930*---------------------------------------------------------------* 05293037
052940     EXEC SQL                                                     05294037
052950         INCLUDE TUPLDER                                          05295037
052960     END-EXEC.                                                    05296037
052970                                                                  05297037
053000*---------------------------------------------------------------* 05300000
053100*    DB2 AREA FOR COMMUNICATIONS                                * 05310000
053200*---------------------------------------------------------------* 05320000
053300     EXEC SQL                                                     05330000
053400          INCLUDE SQLCA                                           05340000
053500     END-EXEC.                                                    05350000
053600                                                                  05360000
053700                                                                  05370000
053800*---------------------------------------------------------------* 05380000
053900* PREPACK CURSOR FOR LINES FOR A SPECIFIC PULL THAT WERE NOT    * 05390000
054000* USED AS THE DRIVER/PROCESS LINE                               * 05400000
054100*---------------------------------------------------------------* 05410000
054200     EXEC SQL                                                     05420000
054300          DECLARE PRE_PACK_LNE_CSR CURSOR FOR                     05430000
054400              SELECT A.ORD_LNE_NBR                                05440000
054500                    ,A.PREPK_RATO_QTY                             05450000
054600                FROM TRECITM A                                    05460000
054700                    ,TPURITM B                                    05470000
054800               WHERE A.ORD_NBR         = :DK-PREPK-PO-NBR         05480000
054900                 AND A.REC_SEQ_NBR     = :DK-PREPK-REC-SEQ-NBR    05490000
055000                 AND A.PREPK_ID        = :DK-PREPK-ID             05500000
055100                 AND A.ORD_LNE_NBR    <> :DK-PREPK-LINE-NBR       05510000
055200                 AND A.ORD_NBR         = B.PO_NBR                 05520000
055300                 AND A.ORD_LNE_NBR     = B.APP_PO_LNE_NBR         05530000
055400                 AND A.VER_STATUS_CDE  = 'A'                      05540000
055500                 AND A.PO_VER_NBR      = B.VER_NBR                05550000
055600          ORDER BY                                                05560000
055700                A.ORD_LNE_NBR                                     05570000
055800     END-EXEC.                                                    05580000
055900                                                                  05590000
056000                                                                  05600000
056100*---------------------------------------------------------------* 05610000
056200* PREPACK CURSOR FOR ALL LINES FOR A SPECIFIC PACK              * 05620000
056300*---------------------------------------------------------------* 05630000
056400     EXEC SQL                                                     05640000
056500          DECLARE PRE_PACK_CSR CURSOR FOR                         05650000
056600              SELECT A.ORD_LNE_NBR                                05660000
056700                FROM TRECITM A                                    05670000
056800                    ,TPURITM B                                    05680000
056900               WHERE A.ORD_NBR         = :DK-PREPK-PO-NBR         05690000
057000                 AND A.REC_SEQ_NBR     = :DK-PREPK-REC-SEQ-NBR    05700000
057100                 AND A.PREPK_ID        = :DK-PREPK-ID             05710000
057200                 AND A.ORD_NBR         = B.PO_NBR                 05720000
057300                 AND A.ORD_LNE_NBR     = B.APP_PO_LNE_NBR         05730000
057400                 AND A.VER_STATUS_CDE  = 'A'                      05740000
057500                 AND A.PO_VER_NBR      = B.VER_NBR                05750000
057600          ORDER BY                                                05760000
057700                A.ORD_LNE_NBR                                     05770000
057800     END-EXEC.                                                    05780000
057900                                                                  05790000
058000                                                                  05800000
058100                                                                  05810000
058200 PROCEDURE DIVISION.                                              05820038
058300                                                                  05830000
058400 0000-PROGRAM-MAINLINE.                                           05840000
058500                                                                  05850000
058700     IF  PV-TEST-CICS                                             05870000
058800         INITIALIZE PV-CICS-MSG-AREA                              05880000
058900         STRING ' PCKCS722 - 0000-PROGRAM-MAINLINE'               05890000
059000                DELIMITED BY SIZE                                 05900000
059100           INTO PV-CICS-MSG-AREA                                  05910000
059200         PERFORM 9990-WRITE-CICS                                  05920000
059300     END-IF.                                                      05930000
059500                                                                  05950000
059600     INITIALIZE RC289-COMMAREA-FOR-E200                           05960000
059700                PV-SUMMARY-FIELD                                  05970000
059800                PV-PREPK-RATO-QTY                                 05980000
059900                PV-ALLOC-QTY                                      05990000
060000                PV-ALLOC-QTY2                                     06000000
060100                PV-RMNDR-QTY.                                     06010000
060101                                                                  06010147
060110     set  PS-RCVR-THSND-NO  to  true.                             06011047
060200                                                                  06020000
060300     MOVE EIBTASKN               TO PV-TASK.                      06030000
060400                                                                  06040000
060600     MOVE EIBTASKN               TO PV-VRFY-ADJ-TASK-NUMBER.      06060000
060700     MOVE EIBTRMID               TO PV-VRFY-ADJ-TERM-ID.          06070000
060800     MOVE PC-VRFY-ADJ-QUEUE-SEQ  TO PV-VRFY-ADJ-ADJ-SEQ.          06080000
061000                                                                  06100000
061100     STRING ' PCKCS722 PCC UPLOAD STARTED - TASK = ' PV-TASK-X    06110000
061200         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  06120000
061300     PERFORM 9990-WRITE-CICS                                      06130000
061400                                                                  06140000
061500*----------------------------------------------------------------*06150000
061600*  DETERMINE WHAT CICS NETWORK YOU ARE WORKING IN                *06160000
061800*----------------------------------------------------------------*06180000
061900     EXEC CICS                                                    06190000
062000          ASSIGN                                                  06200000
062100          APPLID(PV-SYSTEM-ID)                                    06210000
062200     END-EXEC.                                                    06220000
062600                                                                  06260000
062610     MOVE SPACES                 TO PT-MSG-TABLE.                 06261000
062620     SET PT-MSG-IDX              TO 1.                            06262000
062630     MOVE 1                      TO PT-MSG-SEQ (PT-MSG-IDX).      06263000
062640     MOVE ' PCKCS722 - STARTED'  TO PV-CICS-MSG-AREA              06264000
062650     PERFORM 9995-WRITE-CICS.                                     06265000
062660                                                                  06266000
062670     PERFORM 7115-GET-SOCKET-TIMEOUT.                             06267000
062680                                                                  06268000
062690     PERFORM 1000-GET-COMMAREA-FROM-LSTNR.                        06269000
062700                                                                  06270000
062800     MOVE ' PCKCS722 - AFTER RETRIEVE >>>> '                      06280000
062900                                 TO PV-CICS-MSG-AREA              06290000
063000     PERFORM 9995-WRITE-CICS.                                     06300000
063100                                                                  06310000
063200     PERFORM 1100-TAKE-SOCKET.                                    06320000
063300                                                                  06330000
063400     MOVE ' PCKCS722 - TAKESOCKET OK' TO PV-CICS-MSG-AREA         06340000
063500     PERFORM 9995-WRITE-CICS.                                     06350000
063600                                                                  06360000
063700     PERFORM 1200-CONFIRM-CONNECTION.                             06370000
063800                                                                  06380000
063900     MOVE ' PCKCS722 - WRITE SOCKET OK' TO pv-CICS-MSG-AREA       06390000
064000     PERFORM 9995-WRITE-CICS.                                     06400000
064100                                                                  06410000
064200     PERFORM 1300-RECEIVE-DATA-FROM-P2L                           06420051
064300         UNTIL PC186-STATUS-TLR                                   06430000
064410            OR PS-UPLOAD-ERROR.                                   06441039
064500                                                                  06450000
064600     MOVE PC186-STR-RECS-SENT    TO PV-STR-RECS-SENT.             06460000
064700                                                                  06470000
064800     IF (PV-STR-RECS-SENT NOT = PV-STR-RECS-RECEIVED  OR          06480041
064900         PS-UPLOAD-ERROR) and                                     06490041
064910         PS-NOT-TDISTHD-ERROR                                     06491041
065000         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      06500051
065100         PERFORM 1500-CLOSE-SOCKET                                06510000
065200         MOVE '0000-MAINLINE'    TO DP013-PARAGRAPH               06520000
065300         MOVE 'STORE RECS RECEIVED NOT SAME AS STORE RECS SENT'   06530000
065400                                 TO DP013-MESSAGE-TEXT (1)        06540000
065500         STRING ' RCVR: '            DELIMITED BY SIZE            06550000
065600              PC186-TLR-ORD-NBR      DELIMITED BY SIZE            06560000
065700              '-'                    DELIMITED BY SIZE            06570000
065800              PC186-TLR-RECEIVER-NBR DELIMITED BY SIZE            06580000
065900              '  LINE: '             DELIMITED BY SIZE            06590000
066000              PC186-TLR-LINE-NBR     DELIMITED BY SIZE            06600000
066100                               INTO DP013-MESSAGE-TEXT (2)        06610000
066200         STRING ' STORES SENT: '     DELIMITED BY SIZE            06620000
066300              PV-STR-RECS-SENT       DELIMITED BY SIZE            06630000
066400              '  STORES RECEIVED: '  DELIMITED BY SIZE            06640000
066500              PV-STR-RECS-RECEIVED   DELIMITED BY SIZE            06650000
066600                               INTO DP013-MESSAGE-TEXT (3)        06660000
066700         SET DP013-CICS-ABEND    TO  TRUE                         06670000
066800         SET DP013-ROLLBACK      TO  TRUE                         06680000
066900         PERFORM 9999-WRITE-CICS-LOG-MSG                          06690000
067000     END-IF.                                                      06700000
067100*                                                                 06710000
067200*  THIS CHECK WILL READ THE TDISTHD TABLE TO DETERMINE IF THE LINE06720000
067300*  BEING PROCESSED HAS SPLIT PROCESSING (FULLCASE DISTRIBUTION AND06730000
067400*  PACK-TO-LIGHT DISTRIBUTION) AND IF THERE IS SPLIT PROCESSING,  06740000
067500*  HAS THE FULLCASE PROCESS BEEN CONFIRMED.  IF IT IS SPLIT AND   06750000
067600*  THE FULLCASE HAS BEEN CONFIRMED, THEN THIS PROGRAM WILL ATTEMPT06760000
067700*  TO AUTO VERIFY THE LINE.  IF THIS LINE IS NOT SPLIT, THEN THIS 06770000
067800*  PROGRAM WILL ATTEMPT TO AUTO VERIFY THE LINE.  IF THIS LINE IS 06780000
067900*  SPLIT AND THE FULLCASE HAS NOT BEEN CONFIRMED, THEN THIS       06790000
068000*  PROGRAM WILL LOG THE FACT THAT THE P2L RESULTS HAVE BEEN       06800000
068100*  RECEIVED AND UPDATE THE STATUS CODE TO A VALUE OF 'B', HOWEVER,06810000
068200*  THE LINE WILL NOT BE SENT FOR AN AUTOMATIC VERIFICATION.       06820000
068300*                                                                 06830000
068400* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 06840000
068500* FOR THE PACK-TO-LIGHT SYSTEM.                                   06850000
068600     IF  PS-PREV-UPLOAD  OR                                       06860000
068700         PS-UPLOAD-ERROR or                                       06870039
068710         PS-TDISTHD-ERROR                                         06871039
068800         CONTINUE                                                 06880000
068900     ELSE                                                         06890000
069000         SET PS-DO-NOT-WAIT-FOR-CONFIRM TO TRUE                   06900000
069100         SET PS-NOT-PREVIOUSLY-VERIFIED TO TRUE                   06910000
069200         PERFORM 1325-CHECK-TRECITM-STATUS                        06920000
069300     END-IF.                                                      06930000
069400                                                                  06940000
069500                                                                  06950000
069700* THE FOLLOWING HAS BEEN ADDED TO CHECK IF THE PRCG_STAT_CDE NEEDS06970000
069800* TO BE UPDATED.                                                  06980000
069900* IF AN ORDER WAS ORIGINALLY SENT WITH A BAD RATIO ("A") THEN     06990000
070000* RESENT WITH THE CORRECT ALLOCATION, THE STATUS NEEDS TO BE SET  07000000
070100* TO AN "E" SO THAT THE SWEEPER PROGRAM CAN UPDATE IT.            07010000
070200     IF  PS-PREV-UPLOAD                                           07020000
070300         PERFORM 1380-SELECT-TDISTHD                              07030000
070400         IF  DISTHD-PRCG-STAT-CDE  =  'A'  AND                    07040000
070500             PS-MULT-OF-RATIO                                     07050000
070600             SET PS-PREV-UPLOAD-UPDATE  TO  TRUE                  07060000
070700         ELSE                                                     07070000
070800             SET PS-PREV-UPLOAD-NOT-UPDATE  TO  TRUE              07080000
070900         END-IF                                                   07090000
071000     END-IF.                                                      07100000
071200                                                                  07120000
071300                                                                  07130000
071400* THE ABOVE CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT     07140000
071500* FOR THE PACK-TO-LIGHT SYSTEM.                                   07150000
071600* BEFORE THE CHANGE, ONLY THE FOLLOWING EXISTED:                  07160000
071700*    SET PS-DO-NOT-WAIT-FOR-CONFIRM TO TRUE.                      07170000
071800*    SET PS-NOT-PREVIOUSLY-VERIFIED TO TRUE.                      07180000
071900*    PERFORM 1325-CHECK-TRECITM-STATUS.                           07190000
072000                                                                  07200000
072100* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 07210000
072200* FOR THE PACK-TO-LIGHT SYSTEM.                                   07220000
072300     IF (PS-PREV-UPLOAD  AND                                      07230000
072400         PS-PREV-UPLOAD-NOT-UPDATE)   OR                          07240000
072500         PS-UPLOAD-ERROR or                                       07250039
072510         PS-TDISTHD-ERROR                                         07251039
072600         CONTINUE                                                 07260000
072700     ELSE                                                         07270000
072800     IF  RECITM-STATUS-CDE = 'VE'                                 07280000
072900         SET PS-PREVIOUSLY-VERIFIED TO TRUE                       07290000
073000         MOVE PC-PREVIOUSLY-VERIFIED-STATUS                       07300000
073100                                    TO PV-PRCG-STAT-CDE           07310000
073200         MOVE DK-ORD-NBR            TO PV-ERROR-ORD-NBR           07320000
073300         MOVE DK-REC-SEQ-NBR        TO PV-ERROR-RCVR-SEQ-NBR      07330000
073400         MOVE DK-ORD-LNE-NBR        TO PV-ERROR-ORD-LNE-NBR       07340000
073500         STRING ' PCKCS722 - '          DELIMITED BY SIZE         07350000
073600                 PV-ERROR-ORD-NBR       DELIMITED BY SIZE         07360000
073700                 '-'                    DELIMITED BY SIZE         07370000
073800                 PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE         07380000
073900                 '  LINE: '             DELIMITED BY SIZE         07390000
074000                 PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE         07400000
074100                 ' VERIFIED PREVIOUSLY' DELIMITED BY SIZE         07410000
074200                                  INTO PV-CICS-MSG-AREA           07420000
074300         PERFORM 9990-WRITE-CICS                                  07430000
074400     ELSE                                                         07440000
074500         SET RC289-P2L-PROCESS TO TRUE                            07450000
074600         PERFORM 1370-CHECK-FOR-SPLIT                             07460000
074700         IF  PS-WAIT-FOR-CONFIRM                                  07470000
074800             MOVE PC-SPLIT-COMP-WAIT-STATUS                       07480000
074900                                        TO PV-PRCG-STAT-CDE       07490000
075000         ELSE                                                     07500000
075100             SET PS-NO-FREIGHT-BILL TO TRUE                       07510000
075200             PERFORM 1350-CHECK-FOR-PRO-NUMBER                    07520000
075300             IF  PS-NO-FREIGHT-BILL                               07530000
075400                 MOVE PC-NO-FREIGHT-BILL-STATUS                   07540000
075500                                         TO PV-PRCG-STAT-CDE      07550000
075600                 MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR      07560000
075700                 MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR 07570000
075800                 MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR  07580000
075900                 STRING ' PCKCS722 - '          DELIMITED BY SIZE 07590000
076000                         PV-ERROR-ORD-NBR       DELIMITED BY SIZE 07600000
076100                         '-'                    DELIMITED BY SIZE 07610000
076200                         PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE 07620000
076300                         '  LINE: '             DELIMITED BY SIZE 07630000
076400                         PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE 07640000
076500                         ' NO PRO NUMBER      ' DELIMITED BY SIZE 07650000
076600                                          INTO PV-CICS-MSG-AREA   07660000
076700                 PERFORM 9990-WRITE-CICS                          07670000
076800             ELSE                                                 07680000
076900             SET PS-ARRIVED-STATUS  TO TRUE                       07690000
077000             PERFORM 1390-CHECK-IF-ARRIVED                        07700000
077100             IF  PS-NOT-ARRIVED-STATUS                            07710000
077200                 MOVE PC-NOT-ARRIVED-STATUS                       07720000
077300                                         TO PV-PRCG-STAT-CDE      07730000
077400                 MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR      07740000
077500                 MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR 07750000
077600                 MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR  07760000
077700                 STRING ' PCKCS722 - '          DELIMITED BY SIZE 07770000
077800                         PV-ERROR-ORD-NBR       DELIMITED BY SIZE 07780000
077900                         '-'                    DELIMITED BY SIZE 07790000
078000                         PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE 07800000
078100                         '  LINE: '             DELIMITED BY SIZE 07810000
078200                         PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE 07820000
078300                         ' NOT ARRIVED        ' DELIMITED BY SIZE 07830000
078400                                          INTO PV-CICS-MSG-AREA   07840000
078500                 PERFORM 9990-WRITE-CICS                          07850000
078600             ELSE                                                 07860000
078700             IF  PS-NOT-MULT-OF-RATIO                             07870000
078800                 MOVE PC-NOT-MULT-OF-RATIO-STATUS                 07880000
078900                                         TO PV-PRCG-STAT-CDE      07890000
079000                 MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR      07900000
079100                 MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR 07910000
079200                 MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR  07920000
079300                 STRING ' PCKCS722 - '          DELIMITED BY SIZE 07930000
079400                         PV-ERROR-ORD-NBR       DELIMITED BY SIZE 07940000
079500                         '-'                    DELIMITED BY SIZE 07950000
079600                         PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE 07960000
079700                         '  LINE: '             DELIMITED BY SIZE 07970000
079800                         PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE 07980000
079900                         ' NOT MULT OF RATIO  ' DELIMITED BY SIZE 07990000
080000                                          INTO PV-CICS-MSG-AREA   08000000
080100                 PERFORM 9990-WRITE-CICS                          08010000
080300             ELSE                                                 08030000
080400             IF  PS-PREV-UPLOAD-UPDATE                            08040000
080500                 MOVE PC-ERROR-STATUS    TO PV-PRCG-STAT-CDE      08050000
080700             ELSE                                                 08070000
080800                 MOVE PC-READY-TO-VERIFY-STATUS                   08080000
080900                                            TO PV-PRCG-STAT-CDE   08090000
081000             END-IF                                               08100000
081100             END-IF                                               08110000
081200             END-IF                                               08120000
081300         END-IF                                                   08130000
081400     END-IF                                                       08140000
081500     END-IF.                                                      08150000
081600                                                                  08160000
081700* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 08170000
081800* FOR THE PACK-TO-LIGHT SYSTEM.                                   08180000
081900     IF (PS-PREV-UPLOAD  AND                                      08190000
082000         PS-PREV-UPLOAD-NOT-UPDATE)   OR                          08200000
082100         PS-UPLOAD-ERROR OR                                       08210039
082110         PS-TDISTHD-ERROR                                         08211039
082200         CONTINUE                                                 08220000
082300     ELSE                                                         08230000
082400         PERFORM 1330-UPDATE-TDISTHD                              08240000
082500     END-IF.                                                      08250000
083000                                                                  08300000
083100     IF  PS-UPLOAD-ERROR  OR                                      08310039
083110         PS-TDISTHD-ERROR                                         08311039
083200         CONTINUE                                                 08320000
083300     ELSE                                                         08330000
083400     IF  PS-PREV-UPLOAD                                           08340000
083500         IF  PS-MANUALLY-VERIFIED                                 08350000
083600             CONTINUE                                             08360000
083700         ELSE                                                     08370000
083800             MOVE DK-ORD-NBR          TO PC238-PO-NBR             08380000
083900             MOVE DK-REC-SEQ-NBR      TO PC238-RCVR-SEQ-NBR       08390000
084000             MOVE DK-ORD-LNE-NBR      TO PC238-PO-LNE-NBR         08400000
084100             MOVE PV-PREV-ACTL-ALLOC-NET                          08410000
084200                                      TO PC238-WRKD-UNT-QTY       08420000
084400             MOVE PV-VRFY-ITEM        TO PC238-TOT-QUEUE-ITEMS    08440000
084500             MOVE PV-VRFY-ADJ-QUEUE-NAME                          08450000
084600                                     TO PC238-VRFY-ADJ-QUEUE-NAME 08460000
084800             IF  PV-VRFY-ITEM  >  0                               08480000
084900                 PERFORM 8510-UPD-UNITS-WRKD-REOPEN               08490000
085000             END-IF                                               08500000
085100         END-IF                                                   08510000
085200     ELSE                                                         08520000
085300     IF  PS-PREVIOUSLY-VERIFIED                                   08530000
085400         CONTINUE                                                 08540000
085500     ELSE                                                         08550000
085600         MOVE DK-ORD-NBR          TO PC238-PO-NBR                 08560000
085700         MOVE DK-REC-SEQ-NBR      TO PC238-RCVR-SEQ-NBR           08570000
085800         MOVE DK-ORD-LNE-NBR      TO PC238-PO-LNE-NBR             08580000
085900         PERFORM 8500-UPDATE-UNITS-WRKD                           08590000
086000     END-IF                                                       08600000
086100     END-IF                                                       08610000
086200     END-IF.                                                      08620000
086300                                                                  08630000
086400* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 08640000
086500* FOR THE PACK-TO-LIGHT SYSTEM.                                   08650000
086600     IF  PS-UPLOAD-ERROR  OR                                      08660039
086610         PS-TDISTHD-ERROR                                         08661039
086700         CONTINUE                                                 08670000
086800     ELSE                                                         08680000
086900     IF  PS-PREV-UPLOAD                                           08690000
087000         IF  PV-PREV-ACTL-ALLOC-NET  =  0                         08700000
087100             CONTINUE                                             08710000
087200         ELSE                                                     08720000
087300         IF  DISTHD-PREPK-LNE-PRC-CDE  =  PC-PREPK-P2L-DWNLD      08730000
087400                   DIVIDE  PV-PREV-ACTL-ALLOC-NET                 08740000
087500                       BY  PV-PREPK-RATO-QTY                      08750000
087600                   GIVING  PV-ALLOC-QTY                           08760000
087700                REMAINDER  PV-RMNDR-QTY                           08770000
087800             PERFORM 4005-PROCESS-PREPK-REOPEN                    08780000
087900         END-IF                                                   08790000
088000     ELSE                                                         08800000
088100         IF  DISTHD-PREPK-LNE-PRC-CDE  =  PC-PREPK-P2L-DWNLD      08810000
088200                   DIVIDE  PV-SUMMARY-FIELD                       08820000
088300                       BY  PV-PREPK-RATO-QTY                      08830000
088400                   GIVING  PV-ALLOC-QTY                           08840000
088500                REMAINDER  PV-RMNDR-QTY                           08850000
088600             PERFORM 4000-PROCESS-PREPK                           08860000
088700         END-IF                                                   08870000
088800     END-IF.                                                      08880000
088900* THE ABOVE CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT     08890000
089000* FOR THE PACK-TO-LIGHT SYSTEM.                                   08900000
089100* BEFORE THE CHANGE, ONLY THE FOLLOWING EXISTED:                  08910000
089200*    IF  DISTHD-PREPK-LNE-PRC-CDE  =  PC-PREPK-P2L-DWNLD          08920000
089300*              DIVIDE  PV-SUMMARY-FIELD                           08930000
089400*                  BY  PV-PREPK-RATO-QTY                          08940000
089500*              GIVING  PV-ALLOC-QTY                               08950000
089600*           REMAINDER  PV-RMNDR-QTY                               08960000
089700*        PERFORM 4000-PROCESS-PREPK                               08970000
089800*    END-IF.                                                      08980000
089900                                                                  08990000
090000*  IF ALL OPERATIONS WERE SUCCESSFUL UP TO THIS POINT, THIS       09000000
090100*  COMPLETES A LOGICAL UNIT OF WORK.  ABENDS WILL NOT INCLUDE     09010000
090200*  A ROLLBACK COMMAND BECAUSE ANY RETRANSMISSION WILL OVERLAY     09020000
090300*  THE PACK VALUES.                                               09030000
090400                                                                  09040000
090500     PERFORM 9000-SYNCPOINT.                                      09050000
090600                                                                  09060000
090700*  CHECK IF THERE IS AN INVENTORY CYCLE IN PROGRESS. A SWITCH     09070000
090800*  WILL BE SET AND PASSED TO PCKCS200 IN RCWS289 (COMMAREA) THE   09080000
090900*  SWITCH WILL BE SET TO 'N' IF A +100 SQLCODE IS RECEIVED AND    09090000
091000*  TO 'Y' IF +0 (1 STORE) OR -811 (MANY STORES) IS RECEIVED       09100000
091100*  FOR STORES IN THE INVENTORY CYCLE.                             09110000
091200*                                                                 09120000
091300*  CHECK IF THERE IS ANY TROUBLE FOR THE SPECIFIED RECEIVER.      09130000
091400*  IF THERE ISN'T ANY UNRESOLVED TROUBLE PRESENT, START THE       09140000
091500*  TRANSACTION THAT INITIATES THE VERIFICATION PROCESS.           09150000
091600                                                                  09160000
091700     IF  PS-WAIT-FOR-CONFIRM    OR                                09170000
091800         PS-PREVIOUSLY-VERIFIED OR                                09180000
091900         PS-PREV-UPLOAD         OR                                09190000
092000         PS-UPLOAD-ERROR        OR                                09200039
092010         PS-TDISTHD-ERROR                                         09201039
092100         CONTINUE                                                 09210000
092200     ELSE                                                         09220000
092300         PERFORM 1355-SELECT-RECEIVER                             09230000
092400         PERFORM 1365-CHECK-IF-AUTOVE                             09240000
092500         PERFORM 1360-CALL-VEM-MODULE                             09250000
092600     END-IF.                                                      09260000
092700                                                                  09270000
092800                                                                  09280000
092900                                                                  09290000
093000     IF  PS-WAIT-FOR-CONFIRM    OR                                09300000
093100         PS-PREVIOUSLY-VERIFIED OR                                09310000
093200         PS-NOT-MULT-OF-RATIO   OR                                09320000
093300         PS-PREV-UPLOAD         OR                                09330000
093400         PS-UPLOAD-ERROR        OR                                09340000
093410         PS-TDISTHD-ERROR       OR                                09341039
093500         RC038-VERIFY-NO                                          09350000
093600         NEXT SENTENCE                                            09360000
093700     ELSE                                                         09370000
093800         IF  PS-NOT-PREVIOUSLY-VERIFIED                           09380000
093900             MOVE DISTHD-PREPK-LNE-PRC-CDE                        09390000
094000               TO RC289-DISTHD-PROC-TYPE                          09400000
094100             PERFORM 8000-START-E200                              09410000
094200             SET PT-MSG-IDX          UP BY 1                      09420000
094300             MOVE EIBTASKN           TO PT-TASK(PT-MSG-IDX)       09430000
094400             MOVE ' PCKCS722 - E200 STARTED OK'                   09440000
094500                                     TO PT-MSG-LINE(PT-MSG-IDX)   09450000
094900         END-IF                                                   09490000
095000     END-IF.                                                      09500000
095100                                                                  09510000
095200* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 09520000
095300* FOR THE PACK-TO-LIGHT SYSTEM.                                   09530000
095400     IF  PS-PREV-UPLOAD   OR                                      09540000
095500         PS-UPLOAD-ERROR  OR                                      09550039
095510         PS-TDISTHD-ERROR                                         09551039
095600         CONTINUE                                                 09560000
095700     ELSE                                                         09570000
095800         PERFORM 1600-STOP-P2L-WORK-ORDER                         09580000
095900         SET PT-MSG-IDX              UP BY 1                      09590000
096000         MOVE EIBTASKN               TO PT-TASK(PT-MSG-IDX)       09600000
096100         MOVE ' PCKCS722 - WORK ORDERS STOPPED'                   09610000
096200                                     TO PT-MSG-LINE(PT-MSG-IDX)   09620000
096300     END-IF.                                                      09630000
097300                                                                  09730000
097400     IF  PS-UPLOAD-ERROR  OR                                      09740039
097410         PS-TDISTHD-ERROR                                         09741039
097500         PERFORM 1400-SEND-CONFIRMATION-P2L                       09750051
097600         SET PT-MSG-IDX          UP BY 1                          09760000
097700         MOVE EIBTASKN           TO PT-TASK(PT-MSG-IDX)           09770000
097800         MOVE ' PCKCS722 - UPLOAD ERROR   '                       09780000
097900                                     TO PT-MSG-LINE(PT-MSG-IDX)   09790000
098000         PERFORM 1500-CLOSE-SOCKET                                09800000
098100         MOVE DK-ORD-NBR         TO PV-ORDER-NBR                  09810000
098200         MOVE DK-REC-SEQ-NBR     TO PV-RCVR-SEQ-NBR               09820000
098300         MOVE DK-ORD-LNE-NBR     TO PV-LNE-NBR                    09830000
098400         STRING ' PCKCS722-UPLOAD ERROR-TASK = ' PV-TASK-X        09840000
098500                ' '                                               09850000
098600                PV-ORDER-NBR '-'                                  09860000
098700                PV-RCVR-SEQ-NBR '-'                               09870000
098800                PV-LNE-NBR                                        09880000
098900                DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           09890000
099000         PERFORM 9990-WRITE-CICS                                  09900000
099100     ELSE                                                         09910000
099200         PERFORM 1400-SEND-CONFIRMATION-P2L                       09920051
099300         SET PT-MSG-IDX          UP BY 1                          09930000
099400         MOVE EIBTASKN           TO PT-TASK(PT-MSG-IDX)           09940000
099500         MOVE ' PCKCS722 - SEND CONFIRM OK'                       09950000
099600                                     TO PT-MSG-LINE(PT-MSG-IDX)   09960000
099700         PERFORM 1500-CLOSE-SOCKET                                09970000
099800         SET PT-MSG-IDX          UP BY 1                          09980000
099900         MOVE EIBTASKN           TO PT-TASK(PT-MSG-IDX)           09990000
100000         MOVE ' PCKCS722 - CLOSE SOCKET OK'                       10000000
100100                                     TO PT-MSG-LINE(PT-MSG-IDX)   10010000
100200         MOVE DK-ORD-NBR         TO PV-ORDER-NBR                  10020000
100300         MOVE DK-REC-SEQ-NBR     TO PV-RCVR-SEQ-NBR               10030000
100400         MOVE DK-ORD-LNE-NBR     TO PV-LNE-NBR                    10040000
100500         STRING ' PCKCS722 SUCCESSFUL - TASK = ' PV-TASK-X        10050000
100600                ' '                                               10060000
100700                PV-ORDER-NBR '-'                                  10070000
100800                PV-RCVR-SEQ-NBR '-'                               10080000
100900                PV-LNE-NBR                                        10090000
101000                DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           10100000
101100         PERFORM 9990-WRITE-CICS                                  10110000
101200     END-IF.                                                      10120000
101300                                                                  10130000
101400     GOBACK.                                                      10140000
101500/                                                                 10150000
101600************************************************************      10160000
101700* THE LISTENER HAS BEEN STARTED AND A SOCKET HAS BEEN      *      10170000
101800* ESTABLISHED WITHIN THE LISTENER PROGRAM.  THE LISTENER   *      10180000
101900* PROGRAM IN TURN WILL START THIS PROGRAM, SO WE MUST      *      10190000
102000* DO A RETREIVE TO GET THE COMMAREA WHICH WAS PASSED.      *      10200000
102100************************************************************      10210000
102200 1000-GET-COMMAREA-FROM-LSTNR.                                    10220000
102300                                                                  10230000
102500     IF  PV-TEST-CICS                                             10250000
102600         INITIALIZE PV-CICS-MSG-AREA                              10260000
102700         STRING ' PCKCS722 - 1000-GET-COMMAREA-FROM-LSTNR'        10270000
102800                DELIMITED BY SIZE                                 10280000
102900           INTO PV-CICS-MSG-AREA                                  10290000
103000         PERFORM 9990-WRITE-CICS                                  10300000
103100     END-IF.                                                      10310000
103300                                                                  10330000
103400     MOVE LENGTH OF DP081-LSTN-TCPSOCKET-PARM                     10340000
103500                                          TO  PV-RECEIVE-LENGTH.  10350000
103600                                                                  10360000
103700     EXEC CICS                                                    10370000
103800         RETRIEVE                                                 10380000
103900             INTO    (DP081-LSTN-TCPSOCKET-PARM)                  10390000
104000             LENGTH  (PV-RECEIVE-LENGTH)                          10400000
104100             RESP    (PV-CICS-RESPONSE)                           10410000
104200     END-EXEC.                                                    10420000
104300                                                                  10430000
104400     EVALUATE TRUE                                                10440000
104500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10450000
104600             CONTINUE                                             10460000
104700         WHEN OTHER                                               10470000
104800             MOVE '1000-GET-COMMAREA-FROM-LSTNR'                  10480000
104900                 TO DP013-PARAGRAPH                               10490000
105000             MOVE 'UNABLE TO RETRIEVE COMMAREA FROM LISTENER'     10500000
105100                 TO DP013-MESSAGE-TEXT (1)                        10510000
105200             SET DP013-CICS-ABEND   TO  TRUE                      10520000
105300             SET DP013-NO-ROLLBACK  TO  TRUE                      10530000
105400             PERFORM 9999-WRITE-CICS-LOG-MSG                      10540000
105500     END-EVALUATE.                                                10550000
105600/                                                                 10560000
105700*----------------------------------------------------------------*10570000
105800*  ACQUIRE A SOCKET FROM ANOTHER PROGRAM AND CREATE A NEW SOCKET.*10580000
105900*----------------------------------------------------------------*10590000
106000 1100-TAKE-SOCKET.                                                10600000
106100                                                                  10610000
106300     IF  PV-TEST-CICS                                             10630000
106400         INITIALIZE PV-CICS-MSG-AREA                              10640000
106500         STRING ' PCKCS722 - 1100-TAKE-SOCKET'                    10650000
106600                DELIMITED BY SIZE                                 10660000
106700           INTO PV-CICS-MSG-AREA                                  10670000
106800         PERFORM 9990-WRITE-CICS                                  10680000
106900     END-IF.                                                      10690000
107100                                                                  10710000
107200     MOVE DP081-AF-INET               TO DP081-CID-DOMAIN-LSTN    10720000
107300     MOVE DP081-LSTN-NAME             TO DP081-CID-NAME-LSTN      10730000
107400     MOVE DP081-LSTN-SUBTASKNAME      TO                          10740000
107500                                       DP081-CID-SUBTASKNAME-LSTN 10750000
107600     MOVE DP081-LSTN-GIVE-TAKE-SOCKET TO DP081-SOCK-ID            10760000
107700     CALL 'EZASOKET'                                              10770000
107800         USING                                                    10780000
107900                DP081-TAKESOCKET-CMD                              10790000
108000                DP081-SOCK-ID                                     10800000
108100                DP081-CLIENTID-LSTN                               10810000
108200                DP081-ERRNO                                       10820000
108300                DP081-RETCODE.                                    10830000
108400                                                                  10840000
108500* IF THE TAKESOCKET IS SUCCESSFUL, THE NEW SOCKET ID IS           10850000
108600*  CONTAINED IN THE RETCODE                                       10860000
108700                                                                  10870000
108800     IF DP081-RETCODE >= ZERO                                     10880000
108900         MOVE DP081-RETCODE           TO DP081-SOCK-ID            10890000
109000     ELSE                                                         10900000
109100         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        10910000
109200         SET  DP081-TCP-IP-TAKE-ERR TO TRUE                       10920000
109300         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         10930000
109400         SET  DP013-OTHER-ABEND   TO TRUE                         10940000
109500         SET  DP013-NO-ROLLBACK   TO TRUE                         10950000
109600         MOVE '1100-TAKE-SOCKET'  TO DP013-PARAGRAPH              10960000
109700         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  10970000
109800         PERFORM 9999-WRITE-CICS-LOG-MSG                          10980000
109900     END-IF.                                                      10990000
110000/                                                                 11000000
110100*----------------------------------------------------------------*11010000
110200*    CONFIRM THE CONNECTION ON THE SOCKET THAT WE RECEIVED FROM  *11020000
110300*    THE PACK TO LIGHT SYSTEM.                                   *11030000
110400*----------------------------------------------------------------*11040000
110500 1200-CONFIRM-CONNECTION.                                         11050000
110600                                                                  11060000
110800     IF  PV-TEST-CICS                                             11080000
110900         INITIALIZE PV-CICS-MSG-AREA                              11090000
111000         STRING ' PCKCS722 - 1200-CONFIRM-CONNECTION'             11100000
111100                DELIMITED BY SIZE                                 11110000
111200           INTO PV-CICS-MSG-AREA                                  11120000
111300         PERFORM 9990-WRITE-CICS                                  11130000
111400     END-IF.                                                      11140000
111600                                                                  11160000
111700     MOVE SPACES  TO  TCP-BUF-AREA                                11170000
111800     MOVE TASK-START TO TCP-BUF-AREA                              11180000
111900     MOVE 40      TO  DP081-NBR-BYTES                             11190000
112000                      DP081-TCPLENG.                              11200000
112100                                                                  11210000
112200* TRANSLATE EBCDIC TO ASCII                                       11220000
112300     CALL 'EZACIC04'                                              11230000
112400         USING  DP081-TOASCII-TOKEN                               11240000
112500                TCP-BUF-AREA                                      11250000
112600                DP081-TCPLENG.                                    11260000
112700                                                                  11270000
112800* WRITE DATA ON A CONNECTED SOCKET                                11280000
112900     CALL 'EZASOKET'                                              11290000
113000         USING  DP081-WRITE-CMD                                   11300000
113100                DP081-SOCK-ID                                     11310000
113200                DP081-NBR-BYTES                                   11320000
113300                TCP-BUF-AREA                                      11330000
113400                DP081-ERRNO                                       11340000
113500                DP081-RETCODE.                                    11350000
113600*                                                                 11360000
113700     IF DP081-RETCODE < ZERO                                      11370000
113800         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        11380000
113900         SET  DP081-TCP-IP-WRITE-ERR TO TRUE                      11390000
114000         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         11400000
114100         SET  DP013-OTHER-ABEND   TO TRUE                         11410000
114200         SET  DP013-NO-ROLLBACK   TO TRUE                         11420000
114300         MOVE '1200-CONFIRM-CONNECTION'                           11430000
114400             TO DP013-PARAGRAPH                                   11440000
114500         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  11450000
114600         PERFORM 9999-WRITE-CICS-LOG-MSG                          11460000
114700     END-IF.                                                      11470000
114800/                                                                 11480000
114900*----------------------------------------------------------------*11490000
115000*    RECEIVE THE DATA FROM THE PACK TO LIGHT SYSTEM.  THIS DATA  *11500000
115100*    WILL CONSIST OF A HEADER RECORD CONTAINING INFORMATION ON   *11510000
115200*    WHEN THE LINE WAS COMPLETED IN THE PACK TO LIGHT SYSTEM.    *11520000
115300*    DETAIL RECORDS ARE ALSO SENT FOR EACH STORE ON THE RECEIVER *11530000
115400*    LINE CONTAINING THE NUMBER OF PIECES PROCESSED.  A TRAILER  *11540000
115500*    RECORD IS SENT CONTAINING THE NUMBER OF STORE RECORDS THAT  *11550000
115600*    WERE SENT TO BE USED FOR CROSS-CHECK VALIDATION.            *11560000
115700*----------------------------------------------------------------*11570000
115800 1300-RECEIVE-DATA-FROM-P2L.                                      11580051
115900                                                                  11590000
116100     IF  PV-TEST-CICS                                             11610000
116200         INITIALIZE PV-CICS-MSG-AREA                              11620000
116300         STRING ' PCKCS722 - 1300-RECEIVE-DATA-FROM-P2L'          11630051
116400                DELIMITED BY SIZE                                 11640000
116500           INTO PV-CICS-MSG-AREA                                  11650000
116600         PERFORM 9990-WRITE-CICS                                  11660000
116700     END-IF.                                                      11670000
116900                                                                  11690000
117000                                                                  11700000
117100     PERFORM 2950-CHECK-SOCKET-CONNECTION.                        11710000
117200                                                                  11720000
117300                                                                  11730000
117400     PERFORM 3000-RECEIVE-TCP                                     11740000
117500                                                                  11750000
117600     INITIALIZE PC186-STATUS-RECORD.                              11760000
117700                                                                  11770000
117800     MOVE TCP-BUF-AREA           TO PC186-STATUS-RECORD.          11780000
117900                                                                  11790000
118100     IF  PV-TEST-CICS                                             11810000
118200         INITIALIZE PV-CICS-MSG-AREA                              11820000
118300         STRING ' PCKCS722 - ' PC186-STATUS-RECORD                11830000
118400               DELIMITED BY SIZE                                  11840000
118500          INTO PV-CICS-MSG-AREA                                   11850000
118600        PERFORM 9990-WRITE-CICS                                   11860000
118700     END-IF.                                                      11870000
118900                                                                  11890000
119000**!! DISPLAYS ADDED BY RON KRIER ON 09/15/1999 FROM HERE TO       11900000
119100**!! THE NEXT SET OF **!!                                         11910000
119200*                                                                 11920000
119300*    INITIALIZE PV-CICS-MSG-AREA.                                 11930000
119400*                                                                 11940000
119500*    STRING ' PCKCS722:'                                          11950000
119600*         TCP-BUF2                                                11960000
119700*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 11970000
119800*    PERFORM 9990-WRITE-CICS.                                     11980000
119900*                                                                 11990000
120000*    INITIALIZE PV-CICS-MSG-AREA.                                 12000000
120100*                                                                 12010000
120200*    MOVE RETCODE TO PV-RETCODE.                                  12020000
120300*    MOVE TCPLENG TO PV-TCPLENG.                                  12030000
120400*    MOVE ERRNO   TO PV-ERRNO.                                    12040000
120500*                                                                 12050000
120600*    STRING ' PCKCS722:'                                          12060000
120700*         ' '                                                     12070000
120800*         PC186-DTL-ORD-NBR                                       12080000
120900*         ' '                                                     12090000
121000*         PC186-DTL-RECEIVER-NBR                                  12100000
121100*         ' '                                                     12110000
121200*         PC186-DTL-LINE-NBR                                      12120000
121300*         ' RETCODE='                                             12130000
121400*         PV-RETCODE                                              12140000
121500*         ' TCPLENG='                                             12150000
121600*         PV-TCPLENG                                              12160000
121700*         ' ERRNO='                                               12170000
121800*         PV-ERRNO                                                12180000
121900*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 12190000
122000*    PERFORM 9990-WRITE-CICS.                                     12200000
122100                                                                  12210000
122200**!! DISPLAYS ADDED BY RON KRIER ON 09/15/1999 FROM HERE TO       12220000
122300**!! THE PREVIOUS SET OF **!!                                     12230000
122400                                                                  12240000
122500*    INITIALIZE PV-CICS-MSG-AREA.                                 12250000
122600*                                                                 12260000
122700*    STRING ' PCKCS722:'                                          12270000
122800*         'PO='                                                   12280000
122900*         PC186-DTL-ORD-NBR                                       12290000
123000*         ' RCVR='                                                12300000
123100*         PC186-DTL-RECEIVER-NBR                                  12310000
123200*         ' LINE='                                                12320000
123300*         PC186-DTL-LINE-NBR                                      12330000
123400*         ' WO='                                                  12340000
123500*         PC186-DTL-WORK-ORD-SEQ-NBR                              12350000
123600*         ' STR='                                                 12360000
123700*         PC186-STR-NBR                                           12370000
123800*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 12380000
123900*    PERFORM 9990-WRITE-CICS                                      12390000
124000*                                                                 12400000
124100**!!                                                              12410000
124200     MOVE PC186-DTL-ORD-NBR      TO PV-ORD-NBR-X.                 12420000
124300     MOVE PV-ORD-NBR             TO DK-ORD-NBR.                   12430000
124400     MOVE PC186-DTL-RECEIVER-NBR TO PV-RECEIVER-NBR-X.            12440000
124500     MOVE PV-RECEIVER-NBR        TO DK-REC-SEQ-NBR.               12450000
124600     MOVE PC186-DTL-LINE-NBR     TO PV-LINE-NBR-X.                12460000
124700     MOVE PV-LINE-NBR            TO DK-ORD-LNE-NBR.               12470000
124800     MOVE PC186-DTL-WORK-ORD-SEQ-NBR                              12480000
124900                                 TO PV-WORK-ORD-SEQ-NBR-X.        12490000
125000     MOVE PV-WORK-ORD-SEQ-NBR    TO DK-WRK-ORD-SEQ-NBR.           12500000
125100     MOVE ZEROES                 TO DK-UPC-NBR.                   12510000
125200                                                                  12520000
125300* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 12530000
125400* FOR THE PACK-TO-LIGHT SYSTEM.                                   12540000
125500     IF  PS-PREV-UPLOAD-CHECK-DONE  or                            12550042
125510         PS-TDISTHD-ERROR                                         12551042
125600         CONTINUE                                                 12560000
125700     ELSE                                                         12570000
125800         PERFORM 1395-CHECK-FOR-PREV-UPLOAD                       12580000
125900         SET PS-PREV-UPLOAD-CHECK-DONE TO TRUE                    12590000
126000         IF  PV-NOT-PREV-UPLOAD-TMST or                           12600042
126010             PS-TDISTHD-ERROR                                     12601042
126100             CONTINUE                                             12610000
126200         ELSE                                                     12620000
126300             SET PS-PREV-UPLOAD TO TRUE                           12630000
126400             MOVE DK-ORD-NBR            TO PV-ERROR-ORD-NBR       12640000
126500             MOVE DK-REC-SEQ-NBR        TO PV-ERROR-RCVR-SEQ-NBR  12650000
126600             MOVE DK-ORD-LNE-NBR        TO PV-ERROR-ORD-LNE-NBR   12660000
126700             STRING ' PCKCS722 - '          DELIMITED BY SIZE     12670000
126800                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     12680000
126900                     '-'                    DELIMITED BY SIZE     12690000
127000                     PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE     12700000
127100                     '  LINE: '             DELIMITED BY SIZE     12710000
127200                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     12720000
127300                     ' UPLOADED PREVIOUSLY' DELIMITED BY SIZE     12730000
127400                                      INTO PV-CICS-MSG-AREA       12740000
127500             PERFORM 9990-WRITE-CICS                              12750000
127600     END-IF.                                                      12760000
127700* THE ABOVE CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT     12770000
127800* FOR THE PACK-TO-LIGHT SYSTEM.                                   12780000
127900                                                                  12790000
128100     IF  PC186-STATUS-HDR and                                     12810042
128110         PS-NOT-TDISTHD-ERROR                                     12811042
128200         PERFORM 7110-SELECT-TKRPRPM                              12820000
128300     END-IF.                                                      12830000
128500                                                                  12850000
128501* dmh                                                             12850148
128510     IF  PC186-STATUS-HDR                                         12851048
128520         CONTINUE                                                 12852048
128521     ELSE                                                         12852148
128522         IF  PS-RCVR-THSND                                        12852248
128523             MOVE DK-REC-SEQ-NBR-THSND  TO  DK-REC-SEQ-NBR        12852348
128524         END-IF                                                   12852448
128525     END-IF.                                                      12852548
128540* dmh                                                             12854048
128600                                                                  12860000
128700     IF PC186-STR-NBR NUMERIC and                                 12870042
128710         PS-NOT-TDISTHD-ERROR                                     12871042
128800         MOVE PC186-STR-NBR      TO PV-STR-NBR-X                  12880000
128900         MOVE PV-STR-NBR         TO DK-STR-NBR                    12890000
129000     ELSE                                                         12900000
129100         MOVE ZEROES             TO PV-STR-NBR-X                  12910000
129200                                    DK-STR-NBR                    12920000
129300     END-IF.                                                      12930000
129400                                                                  12940000
129500     IF PC186-ACTUAL-DISTRO-QTY NUMERIC                           12950000
129600         MOVE PC186-ACTUAL-DISTRO-QTY TO PV-ACTUAL-DISTRO-QTY-X   12960000
129700         MOVE PV-ACTUAL-DISTRO-QTY    TO DISTDT-ACTL-ALLOC-QTY    12970000
129800     ELSE                                                         12980000
129900         MOVE ZEROES                  TO PV-ACTUAL-DISTRO-QTY-X   12990000
130000     END-IF.                                                      13000000
130100                                                                  13010000
130200     IF  PC186-STATUS-DTL AND                                     13020043
130300         PS-TDISTHD-ERROR                                         13030043
130400         PERFORM 1396-INSERT-TUPLDER                              13040043
130410     ELSE                                                         13041043
130500     IF  PC186-STATUS-DTL AND                                     13050043
130510         PS-NOT-TDISTHD-ERROR                                     13051042
130600         PERFORM 4050-DETERMINE-IF-PREPK                          13060000
130700     END-IF                                                       13070043
130800     END-IF.                                                      13080043
132400                                                                  13240000
132500* THE FOLLOWING CHECK WAS DONE AS PART OF THE RE-OPEN ENHANCEMENT 13250000
132600* FOR THE PACK-TO-LIGHT SYSTEM.                                   13260000
132610     IF  PS-TDISTHD-ERROR                                         13261042
132620         CONTINUE                                                 13262042
132630     ELSE                                                         13263042
132700     IF  PS-PREV-UPLOAD                                           13270000
132800         IF  PC186-STATUS-DTL                                     13280000
133000             SET PS-PREV-TDISTDT-PRESENT TO TRUE                  13300000
133100             PERFORM 1305-CHECK-PREV-ALLOC                        13310000
133200             MOVE DISTDT-ACTL-ALLOC-QTY                           13320000
133300              TO  PV-PREV-ACTL-ALLOC-AFT                          13330000
133400             MOVE PV-PREV-ACTL-ALLOC-QTY                          13340000
133500              TO  PV-PREV-ACTL-ALLOC-BEG                          13350000
133600             SUBTRACT  PV-PREV-ACTL-ALLOC-QTY                     13360000
133700                 FROM  DISTDT-ACTL-ALLOC-QTY                      13370000
133800               GIVING  PV-PREV-ACTL-ALLOC-DIFF                    13380000
133900             ADD  PV-PREV-ACTL-ALLOC-DIFF                         13390000
134000              TO  PV-PREV-ACTL-ALLOC-NET                          13400000
134100                                                                  13410000
134300             IF  PV-TEST-CICS                                     13430000
134400                 INITIALIZE PV-CICS-MSG-AREA                      13440000
134500                 MOVE PV-PREV-ACTL-ALLOC-NET TO PV-DISPLAY-DIFF   13450000
134600                 STRING ' PCKCS722 - ' PV-DISPLAY-DIFF            13460000
134700                        DELIMITED BY SIZE                         13470000
134800                   INTO PV-CICS-MSG-AREA                          13480000
134900                 PERFORM 9990-WRITE-CICS                          13490000
135000             END-IF                                               13500000
135200                                                                  13520000
135300             IF  DISTDT-ACTL-ALLOC-QTY  =                         13530000
135400                PV-PREV-ACTL-ALLOC-QTY                            13540000
135500                 CONTINUE                                         13550000
135600             ELSE                                                 13560000
135700                 PERFORM 1310-UPDATE-TDISTDT                      13570000
135800                 IF  PS-CALL-UNIT-ADJ-MOD-NO                      13580000
135900                     CONTINUE                                     13590000
136000                 ELSE                                             13600000
136100                     SET PS-NOT-VALID-RANDOM-NUMBER TO TRUE       13610000
136200                     PERFORM 5015-GET-RANDOM-NUMBER UNTIL         13620000
136300                         PS-VALID-RANDOM-NUMBER                   13630000
136400                     PERFORM 5000-CALL-UNIT-ADJ                   13640000
136500                 END-IF                                           13650000
136600                 IF  DISTHD-PREPK-LNE-PRC-CDE  =                  13660000
136700                     PC-PREPK-P2L-DWNLD                           13670000
136800                     PERFORM 4060-PROCESS-PREPK-DISTDT            13680000
136900                 END-IF                                           13690000
137000             END-IF                                               13700000
137200             ADD 1 TO PV-STR-RECS-RECEIVED                        13720000
137300         END-IF                                                   13730000
137400     ELSE                                                         13740000
137500         IF  PC186-STATUS-DTL                                     13750000
137600             SET PS-TDISTDT-ROW-PRESENT TO TRUE                   13760000
137700             SET PS-PREV-TDISTDT-PRESENT TO TRUE                  13770000
137800             PERFORM 1305-CHECK-PREV-ALLOC                        13780000
137900             MOVE DISTDT-ACTL-ALLOC-QTY                           13790000
138000              TO  PV-PREV-ACTL-ALLOC-AFT                          13800000
138100             MOVE PV-PREV-ACTL-ALLOC-QTY                          13810000
138200              TO  PV-PREV-ACTL-ALLOC-BEG                          13820000
138300             SUBTRACT  PV-PREV-ACTL-ALLOC-QTY                     13830000
138400                 FROM  DISTDT-ACTL-ALLOC-QTY                      13840000
138500               GIVING  PV-PREV-ACTL-ALLOC-DIFF                    13850000
138600             ADD  PV-PREV-ACTL-ALLOC-DIFF                         13860000
138700              TO  PV-PREV-ACTL-ALLOC-NET                          13870000
138800             IF  DISTDT-ACTL-ALLOC-QTY  =                         13880000
138900                PV-PREV-ACTL-ALLOC-QTY                            13890000
139000                 CONTINUE                                         13900000
139100             ELSE                                                 13910000
139200                 PERFORM 1310-UPDATE-TDISTDT                      13920000
139300                 IF  PS-CALL-UNIT-ADJ-MOD-NO                      13930000
139400                     CONTINUE                                     13940000
139500                 ELSE                                             13950000
139600                     IF  RECITM-STATUS-CDE  = 'VE'                13960000
139700                         SET PS-NOT-VALID-RANDOM-NUMBER TO TRUE   13970000
139800                         PERFORM 5015-GET-RANDOM-NUMBER UNTIL     13980000
139900                             PS-VALID-RANDOM-NUMBER               13990000
140000                         PERFORM 5000-CALL-UNIT-ADJ               14000000
140100                     END-IF                                       14010000
140200                 END-IF                                           14020000
140300                 IF  PS-TDISTDT-ROW-NOT-PRESENT                   14030000
140400                     PERFORM 1312-CHECK-ALLOCATIONS               14040000
140500                 END-IF                                           14050000
140600                 IF  DISTHD-PREPK-LNE-PRC-CDE =                   14060000
140700                     PC-PREPK-P2L-DWNLD                           14070000
140800                     PERFORM 4060-PROCESS-PREPK-DISTDT            14080000
140900                 END-IF                                           14090000
141000             END-IF                                               14100000
141100             ADD 1 TO PV-STR-RECS-RECEIVED                        14110000
141200         END-IF                                                   14120000
141300     END-IF                                                       14130042
141400     END-IF.                                                      14140042
142800                                                                  14280000
142900                                                                  14290000
143000*----------------------------------------------------------------*14300000
143100*  IF ORDER WAS PREVIOUSLY UPLOADED - CHECK TO SEE WHAT THE      *14310000
143200*  PREVIOUS ALLOCATION WAS TO DETERMINE IF ANY UNIT ADJUSTMENTS  *14320000
143300*  NEED TO BE MADE.                                            N *14330000
143500*----------------------------------------------------------------*14350000
143600 1305-CHECK-PREV-ALLOC.                                           14360000
143700                                                                  14370000
143900     IF  PV-TEST-CICS                                             14390000
144000         INITIALIZE PV-CICS-MSG-AREA                              14400000
144100         STRING ' PCKCS722 - 1305-CHECK-PREV-ALLOC'               14410000
144200                DELIMITED BY SIZE                                 14420000
144300           INTO PV-CICS-MSG-AREA                                  14430000
144400         PERFORM 9990-WRITE-CICS                                  14440000
144500     END-IF.                                                      14450000
144700                                                                  14470000
144800     EXEC SQL                                                     14480000
144900          SELECT  ACTL_ALLOC_QTY                                  14490000
145000            INTO  :PV-PREV-ACTL-ALLOC-QTY                         14500000
145100            FROM  TDISTDT                                         14510000
145200           WHERE  ORD_NBR        = :DK-ORD-NBR      AND           14520000
145300                  RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR  AND           14530000
145400                  ORD_LNE_NBR    = :DK-ORD-LNE-NBR  AND           14540000
145500                  STR_NBR        = :DK-STR-NBR                    14550000
145600     END-EXEC.                                                    14560000
145700                                                                  14570000
145800     EVALUATE TRUE                                                14580000
145900         WHEN SQLCODE = ZERO                                      14590000
146000              CONTINUE                                            14600000
146100         WHEN SQLCODE = +100                                      14610000
146200              SET  PS-PREV-TDISTDT-NOT-PRESENT  TO  TRUE          14620000
146300              MOVE ZEROES  TO  PV-PREV-ACTL-ALLOC-QTY             14630000
146400         WHEN SQLWARN0 NOT = SPACES                               14640000
146500         WHEN SQLCODE < ZERO                                      14650000
146600         WHEN SQLCODE > ZERO                                      14660000
146700             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  14670051
146800             PERFORM 1500-CLOSE-SOCKET                            14680000
146900             MOVE '1305-CHECK-PREV-ALLOC  '                       14690000
147000                                   TO DP013-PARAGRAPH             14700000
147100             MOVE 'CHECK PREV ALLOC UPLOAD   '                    14710000
147200                                   TO DP013-MESSAGE-TEXT (1)      14720000
147300             MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR            14730000
147400             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       14740000
147500             MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR        14750000
147600             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            14760000
147700             STRING ' RCVR: '              DELIMITED BY SIZE      14770000
147800                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      14780000
147900                    '-'                    DELIMITED BY SIZE      14790000
148000                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      14800000
148100                    '  LINE: '             DELIMITED BY SIZE      14810000
148200                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      14820000
148300                    '  STORE: '            DELIMITED BY SIZE      14830000
148400                    PV-ERROR-STR-NBR       DELIMITED BY SIZE      14840000
148500                                 INTO DP013-MESSAGE-TEXT (2)      14850000
148600             MOVE SQLCA            TO DP013-SQLCA                 14860000
148700             MOVE 'TDISTDT '       TO DP013-DB2-TABLE-NAME (1)    14870000
148800             SET DP013-ROLLBACK                                   14880000
148900                 DP013-DB2-ABEND   TO TRUE                        14890000
149000             PERFORM 9999-WRITE-CICS-LOG-MSG                      14900000
149100     END-EVALUATE.                                                14910000
149200                                                                  14920000
149300                                                                  14930000
149400*----------------------------------------------------------------*14940000
149500*    UPDATE THE ACTUAL ALLOCATION QUANTITY ON THE DISTRIBUTION   *14950000
149600*    DETAIL ROW.  THIS VALUE WILL BE SET TO THE ACTUAL NUMBER OF *14960000
149700*    PIECES PROCESSED IN THE PACK TO LIGHT SYSTEM FOR A STORE ON *14970000
149800*    THE SPECIFIED LINE OF THE RECEIVER.                         *14980000
149900*----------------------------------------------------------------*14990000
150000 1310-UPDATE-TDISTDT.                                             15000000
150100                                                                  15010000
150300     IF  PV-TEST-CICS                                             15030000
150400         INITIALIZE PV-CICS-MSG-AREA                              15040000
150500         STRING ' PCKCS722 - 1310-UPDATE-TDISTDT'                 15050000
150600                DELIMITED BY SIZE                                 15060000
150700           INTO PV-CICS-MSG-AREA                                  15070000
150800         PERFORM 9990-WRITE-CICS                                  15080000
150900     END-IF.                                                      15090000
151100                                                                  15110000
151200     PERFORM                                                      15120000
151300         WITH TEST AFTER                                          15130000
151400         VARYING PV-RETRY-COUNTER                                 15140000
151500         FROM 1 BY 1                                              15150000
151600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15160000
151700             OR (SQLCODE = +0)                                    15170000
151800             OR (SQLCODE = +100))                                 15180000
151900                                                                  15190000
152000         EXEC SQL                                                 15200000
152100             UPDATE TDISTDT                                       15210000
152200                 SET ACTL_ALLOC_QTY = :DISTDT-ACTL-ALLOC-QTY      15220000
152300             WHERE                                                15230000
152400                 ORD_NBR            = :DK-ORD-NBR         AND     15240000
152500                 RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR     AND     15250000
152600                 ORD_LNE_NBR        = :DK-ORD-LNE-NBR     AND     15260000
152700                 WRK_ORD_SEQ_NBR    = :DK-WRK-ORD-SEQ-NBR AND     15270000
152800                 STR_NBR            = :DK-STR-NBR                 15280000
152900         END-EXEC                                                 15290000
153000                                                                  15300000
153100         EVALUATE TRUE                                            15310000
153200             WHEN SQLCODE = ZERO                                  15320000
153300             WHEN SQLCODE = -904                                  15330000
153400             WHEN SQLCODE = -911                                  15340000
153500             WHEN SQLCODE = -913                                  15350000
153600                 ADD DISTDT-ACTL-ALLOC-QTY TO PV-SUMMARY-FIELD    15360000
153700             WHEN SQLCODE = +100                                  15370000
153800                 SET PS-TDISTDT-ROW-NOT-PRESENT TO TRUE           15380000
153900             WHEN SQLWARN0 NOT = SPACES                           15390000
154000             WHEN SQLCODE < ZERO                                  15400000
154100             WHEN SQLCODE > ZERO                                  15410000
154200                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              15420051
154300                 PERFORM 1500-CLOSE-SOCKET                        15430000
154400                 MOVE '1310-UPDATE-TDISTDT'                       15440000
154500                                   TO DP013-PARAGRAPH             15450000
154600                 MOVE 'ERROR UPDATING TDISTDT'                    15460000
154700                                   TO DP013-MESSAGE-TEXT (1)      15470000
154800                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            15480000
154900                 MOVE DK-REC-SEQ-NBR                              15490000
155000                                   TO PV-ERROR-RCVR-SEQ-NBR       15500000
155100                 MOVE DK-ORD-LNE-NBR                              15510000
155200                                   TO PV-ERROR-ORD-LNE-NBR        15520000
155300                 MOVE DK-STR-NBR   TO PV-ERROR-STR-NBR            15530000
155400                 STRING ' RCVR: '            DELIMITED BY SIZE    15540000
155500                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    15550000
155600                      '-'                    DELIMITED BY SIZE    15560000
155700                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    15570000
155800                      '  LINE: '             DELIMITED BY SIZE    15580000
155900                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    15590000
156000                      '  STORE: '            DELIMITED BY SIZE    15600000
156100                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    15610000
156200                                 INTO DP013-MESSAGE-TEXT (2)      15620000
156300                 MOVE SQLCA        TO DP013-SQLCA                 15630000
156400                 MOVE 'TDISTDT '   TO DP013-DB2-TABLE-NAME (1)    15640000
156500                 SET DP013-ROLLBACK                               15650000
156600                     DP013-DB2-ABEND                              15660000
156700                                   TO TRUE                        15670000
156800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  15680000
156900         END-EVALUATE                                             15690000
157000     END-PERFORM.                                                 15700000
157100*                                                                 15710000
157200     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  15720000
157300         (SQLCODE NOT = +0)                                       15730000
157400         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      15740051
157500         PERFORM 1500-CLOSE-SOCKET                                15750000
157600         MOVE '1310-UPDATE-TDISTDT'                               15760000
157700                                  TO DP013-PARAGRAPH              15770000
157800         MOVE 'MAX RETRIES EXCEEDED ON UPDATE OF TDISTDT ROW'     15780000
157900                                  TO DP013-MESSAGE-TEXT (1)       15790000
158000         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             15800000
158100         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        15810000
158200         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         15820000
158300         MOVE DK-STR-NBR          TO PV-ERROR-STR-NBR             15830000
158400         STRING ' RCVR: '            DELIMITED BY SIZE            15840000
158500              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            15850000
158600              '-'                    DELIMITED BY SIZE            15860000
158700              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            15870000
158800              '  LINE: '             DELIMITED BY SIZE            15880000
158900              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            15890000
159000              '  STORE: '            DELIMITED BY SIZE            15900000
159100              PV-ERROR-STR-NBR       DELIMITED BY SIZE            15910000
159200                                INTO DP013-MESSAGE-TEXT (2)       15920000
159300         MOVE SQLCA               TO DP013-SQLCA                  15930000
159400         MOVE 'TDISTDT'           TO DP013-DB2-TABLE-NAME (1)     15940000
159500         SET DP013-DB2-ABEND                                      15950000
159600             DP013-ROLLBACK       TO TRUE                         15960000
159700         PERFORM 9999-WRITE-CICS-LOG-MSG                          15970000
159800     END-IF.                                                      15980000
159900*                                                                 15990000
160000                                                                  16000000
160100*----------------------------------------------------------------*16010000
160200* IF STORE ALLOCATION NOT ON TDISTDT - CHECK WITH P2L ALLOCATIONS*16020000
160300*----------------------------------------------------------------*16030000
160400 1312-CHECK-ALLOCATIONS.                                          16040000
160500                                                                  16050000
160700     IF  PV-TEST-CICS                                             16070000
160800         INITIALIZE PV-CICS-MSG-AREA                              16080000
160900         STRING ' PCKCS722 - 1312-CHECK-ALLOCATIONS'              16090000
161000                DELIMITED BY SIZE                                 16100000
161100           INTO PV-CICS-MSG-AREA                                  16110000
161200         PERFORM 9990-WRITE-CICS                                  16120000
161300     END-IF.                                                      16130000
161500                                                                  16150000
161600     PERFORM 1313-TOT-P2L-QTY.                                    16160000
161700                                                                  16170000
161800     MULTIPLY  PV-P2L-SPLT-UNT-QTY                                16180000
161900           BY  2                                                  16190000
162000       GIVING  PV-P2L-SPLT-UNT-QTY-X2.                            16200000
162100                                                                  16210000
162200     IF  PV-P2L-SPLT-UNT-QTY-X2  >  DISTDT-ACTL-ALLOC-QTY         16220000
162300         PERFORM 1320-INSERT-TRANS-DTL-REC                        16230000
162400     ELSE                                                         16240000
162500         INITIALIZE PV-CICS-MSG-AREA                              16250000
162600         STRING ' PCKCS722-'                                      16260000
162700                ' TASK=' PV-TASK-X                                16270000
162800                ' - 1312-CHECK-ALLOCATIONS'                       16280000
162900         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  16290000
163000         PERFORM 9990-WRITE-CICS                                  16300000
163100                                                                  16310000
163200         INITIALIZE PV-CICS-MSG-AREA                              16320000
163300         STRING ' PCKCS722-'                                      16330000
163400                ' TASK=' PV-TASK-X                                16340000
163500                'STORE ALLOCATIONS > 2X TOTAL P2L ALLOCATIONS'    16350000
163600         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  16360000
163700         PERFORM 9990-WRITE-CICS                                  16370000
163800                                                                  16380000
163900         MOVE DK-ORD-NBR            TO PV-ERROR-ORD-NBR           16390000
164000         MOVE DK-REC-SEQ-NBR        TO PV-ERROR-RCVR-SEQ-NBR      16400000
164100         MOVE DK-ORD-LNE-NBR        TO PV-ERROR-ORD-LNE-NBR       16410000
164200         MOVE DK-STR-NBR            TO PV-ERROR-STR-NBR           16420000
164300         MOVE DISTDT-ACTL-ALLOC-QTY TO PV-ERROR-QTY               16430000
164400         INITIALIZE PV-CICS-MSG-AREA                              16440000
164500         STRING ' PCKCS722-'                                      16450000
164600                ' TASK=' PV-TASK-X                                16460000
164700                ' RCVR: '                                         16470000
164800              PV-ERROR-ORD-NBR                                    16480000
164900              '-'                                                 16490000
165000              PV-ERROR-RCVR-SEQ-NBR                               16500000
165100              '  LINE: '                                          16510000
165200              PV-ERROR-ORD-LNE-NBR                                16520000
165300              '  STORE: '                                         16530000
165400              PV-ERROR-STR-NBR                                    16540000
165500              '  QTY: '                                           16550000
165600              PV-ERROR-QTY                                        16560000
165700         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  16570000
165800         PERFORM 9990-WRITE-CICS                                  16580000
165900                                                                  16590000
166000     END-IF.                                                      16600000
166100                                                                  16610000
166200                                                                  16620000
166300*----------------------------------------------------------------*16630000
166400* GET THE TOTAL QTY UNITS ALLOCATED TO P2L FOR ORDER             *16640000
166500*----------------------------------------------------------------*16650000
166600 1313-TOT-P2L-QTY.                                                16660000
166700                                                                  16670000
166900     IF  PV-TEST-CICS                                             16690000
167000         INITIALIZE PV-CICS-MSG-AREA                              16700000
167100         STRING ' PCKCS722 - 1313-TOT-P2L-QTY'                    16710000
167200                DELIMITED BY SIZE                                 16720000
167300           INTO PV-CICS-MSG-AREA                                  16730000
167400         PERFORM 9990-WRITE-CICS                                  16740000
167500     END-IF.                                                      16750000
167700                                                                  16770000
167800     PERFORM                                                      16780000
167900         WITH TEST AFTER                                          16790000
168000         VARYING PV-RETRY-COUNTER                                 16800000
168100         FROM 1 BY 1                                              16810000
168200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16820000
168300             OR (SQLCODE = +0)                                    16830000
168400             OR (SQLCODE = +100))                                 16840000
168500                                                                  16850000
168600         EXEC SQL                                                 16860000
168700              SELECT SUM(P2L_SPLT_UNT_QTY)                        16870000
168800                INTO :PV-P2L-SPLT-UNT-QTY                         16880000
168900                FROM TDISTDT                                      16890000
169000               WHERE ORD_NBR          = :DK-ORD-NBR               16900000
169100                 AND RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR           16910000
169200                 AND ORD_LNE_NBR      = :DK-ORD-LNE-NBR           16920000
169300         END-EXEC                                                 16930000
169400                                                                  16940000
169500         EVALUATE TRUE                                            16950000
169600             WHEN SQLCODE = ZERO                                  16960000
169700             WHEN SQLCODE = -904                                  16970000
169800             WHEN SQLCODE = -911                                  16980000
169900             WHEN SQLCODE = -913                                  16990000
170000             WHEN SQLCODE = +100                                  17000000
170100                  CONTINUE                                        17010000
170200             WHEN SQLWARN0 NOT = SPACES                           17020000
170300             WHEN SQLCODE < ZERO                                  17030000
170400             WHEN SQLCODE > ZERO                                  17040000
170500                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              17050051
170600                 PERFORM 1500-CLOSE-SOCKET                        17060000
170700                 MOVE '1313-TOT-P2L-QTY   '                       17070000
170800                                   TO DP013-PARAGRAPH             17080000
170900                 MOVE 'ERROR SUMMING TDISTHD '                    17090000
171000                                   TO DP013-MESSAGE-TEXT (1)      17100000
171100                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            17110000
171200                 MOVE DK-REC-SEQ-NBR                              17120000
171300                                   TO PV-ERROR-RCVR-SEQ-NBR       17130000
171400                 MOVE DK-ORD-LNE-NBR                              17140000
171500                                   TO PV-ERROR-ORD-LNE-NBR        17150000
171600                 MOVE DK-STR-NBR   TO PV-ERROR-STR-NBR            17160000
171700                 STRING ' RCVR: '            DELIMITED BY SIZE    17170000
171800                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    17180000
171900                      '-'                    DELIMITED BY SIZE    17190000
172000                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    17200000
172100                      '  LINE: '             DELIMITED BY SIZE    17210000
172200                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    17220000
172300                      '  STORE: '            DELIMITED BY SIZE    17230000
172400                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    17240000
172500                                 INTO DP013-MESSAGE-TEXT (2)      17250000
172600                 MOVE SQLCA        TO DP013-SQLCA                 17260000
172700                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    17270000
172800                 SET DP013-ROLLBACK                               17280000
172900                     DP013-DB2-ABEND                              17290000
173000                                   TO TRUE                        17300000
173100                 PERFORM 9999-WRITE-CICS-LOG-MSG                  17310000
173200         END-EVALUATE                                             17320000
173300     END-PERFORM.                                                 17330000
173400*                                                                 17340000
173500     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  17350000
173600         (SQLCODE NOT = +0)                                       17360000
173700         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      17370051
173800         PERFORM 1500-CLOSE-SOCKET                                17380000
173900         MOVE '1313-TOT-P2L-QTY   '                               17390000
174000                                  TO DP013-PARAGRAPH              17400000
174100         MOVE 'MAX RETRIES EXCEEDED ON SUMMING TDISTHD      '     17410000
174200                                  TO DP013-MESSAGE-TEXT (1)       17420000
174300         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             17430000
174400         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        17440000
174500         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         17450000
174600         MOVE DK-STR-NBR          TO PV-ERROR-STR-NBR             17460000
174700         STRING ' RCVR: '            DELIMITED BY SIZE            17470000
174800              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            17480000
174900              '-'                    DELIMITED BY SIZE            17490000
175000              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            17500000
175100              '  LINE: '             DELIMITED BY SIZE            17510000
175200              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            17520000
175300              '  STORE: '            DELIMITED BY SIZE            17530000
175400              PV-ERROR-STR-NBR       DELIMITED BY SIZE            17540000
175500                                INTO DP013-MESSAGE-TEXT (2)       17550000
175600         MOVE SQLCA               TO DP013-SQLCA                  17560000
175700         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     17570000
175800         SET DP013-DB2-ABEND                                      17580000
175900             DP013-ROLLBACK       TO TRUE                         17590000
176000         PERFORM 9999-WRITE-CICS-LOG-MSG                          17600000
176100     END-IF.                                                      17610000
176200                                                                  17620000
176300                                                                  17630000
176400*----------------------------------------------------------------*17640000
176500*  INSERT A ROW ON THE TRANSACTION DETAIL TABLE.                 *17650000
176600*----------------------------------------------------------------*17660000
176700 1320-INSERT-TRANS-DTL-REC.                                       17670000
176800                                                                  17680000
177000     IF  PV-TEST-CICS                                             17700000
177100         INITIALIZE PV-CICS-MSG-AREA                              17710000
177200         STRING ' PCKCS722 - 1320-INSERT-TRANS-DTL-REC'           17720000
177300                DELIMITED BY SIZE                                 17730000
177400           INTO PV-CICS-MSG-AREA                                  17740000
177500         PERFORM 9990-WRITE-CICS                                  17750000
177600     END-IF.                                                      17760000
177800                                                                  17780000
177900     PERFORM                                                      17790000
178000         WITH TEST AFTER                                          17800000
178100         VARYING PV-RETRY-COUNTER                                 17810000
178200         FROM 1 BY 1                                              17820000
178300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17830000
178400             OR (SQLCODE = +0))                                   17840000
178500                                                                  17850000
178600         EXEC SQL                                                 17860000
178700              INSERT                                              17870000
178800              INTO  TDISTDT                                       17880000
178900                   (ORD_NBR                                       17890000
179000                   ,RCVR_SEQ_NBR                                  17900000
179100                   ,ORD_LNE_NBR                                   17910000
179200                   ,WRK_ORD_SEQ_NBR                               17920000
179300                   ,STR_NBR                                       17930000
179400                   ,EXPTED_ALLOC_QTY                              17940000
179500                   ,ACTL_ALLOC_QTY                                17950000
179600                   ,RCVG_PSTD_STAT_CDE                            17960000
179700                   ,P2L_SPLT_UNT_QTY)                             17970000
179800            VALUES                                                17980000
179900                  (:DK-ORD-NBR                                    17990000
180000                  ,:DK-REC-SEQ-NBR                                18000000
180100                  ,:DK-ORD-LNE-NBR                                18010000
180200                  ,:DK-WRK-ORD-SEQ-NBR                            18020000
180300                  ,:DK-STR-NBR                                    18030000
180400                  ,:DISTDT-ACTL-ALLOC-QTY                         18040000
180500                  ,:DISTDT-ACTL-ALLOC-QTY                         18050000
180600                  ,:PC-READY-TO-POST-STATUS                       18060000
180700                  ,:DISTDT-ACTL-ALLOC-QTY)                        18070000
180800         END-EXEC                                                 18080000
180900                                                                  18090000
181000         EVALUATE TRUE                                            18100000
181100             WHEN SQLCODE = ZERO                                  18110000
181200             WHEN SQLCODE = -904                                  18120000
181300             WHEN SQLCODE = -911                                  18130000
181400             WHEN SQLCODE = -913                                  18140000
181500                 ADD DISTDT-ACTL-ALLOC-QTY TO PV-SUMMARY-FIELD    18150000
181600             WHEN SQLWARN0 NOT = SPACES                           18160000
181700             WHEN SQLCODE NOT EQUAL ZERO                          18170000
181800                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              18180051
181900                 PERFORM 1500-CLOSE-SOCKET                        18190000
182000                 MOVE '1320-INSERT-TRANS-DTL-REC'                 18200000
182100                                   TO DP013-PARAGRAPH             18210000
182200                 MOVE 'INSERT TRANSACTION DETAIL ROW'             18220000
182300                                   TO DP013-MESSAGE-TEXT (1)      18230000
182400                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            18240000
182500                 MOVE DK-REC-SEQ-NBR                              18250000
182600                                   TO PV-ERROR-RCVR-SEQ-NBR       18260000
182700                 MOVE DK-ORD-LNE-NBR                              18270000
182800                                   TO PV-ERROR-ORD-LNE-NBR        18280000
182900                 MOVE DK-STR-NBR   TO PV-ERROR-STR-NBR            18290000
183000                 STRING ' RCVR: '            DELIMITED BY SIZE    18300000
183100                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    18310000
183200                      '-'                    DELIMITED BY SIZE    18320000
183300                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    18330000
183400                      '  LINE: '             DELIMITED BY SIZE    18340000
183500                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    18350000
183600                      '  STORE: '            DELIMITED BY SIZE    18360000
183700                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    18370000
183800                                 INTO DP013-MESSAGE-TEXT (2)      18380000
183900                  MOVE SQLCA       TO DP013-SQLCA                 18390000
184000                  MOVE 'TDISTDT'   TO DP013-DB2-TABLE-NAME (1)    18400000
184100                  SET DP013-DB2-ABEND                             18410000
184200                      PS-UPLOAD-ERROR                             18420000
184300                      DP013-ROLLBACK                              18430000
184400                                   TO TRUE                        18440000
184500                  PERFORM 9999-WRITE-CICS-LOG-MSG                 18450000
184600         END-EVALUATE                                             18460000
184700     END-PERFORM.                                                 18470000
184800*                                                                 18480000
184900     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  18490000
185000         (SQLCODE NOT = +0)                                       18500000
185100         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      18510051
185200         PERFORM 1500-CLOSE-SOCKET                                18520000
185300         MOVE '1320-INSERT-TRANS-DTL-REC'                         18530000
185400                                  TO DP013-PARAGRAPH              18540000
185500         MOVE 'MAX RETRIES EXCEEDED ON INSERT OF TDISTDT ROW'     18550000
185600                                  TO DP013-MESSAGE-TEXT (1)       18560000
185700         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             18570000
185800         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        18580000
185900         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         18590000
186000         MOVE DK-STR-NBR          TO PV-ERROR-STR-NBR             18600000
186100         STRING ' RCVR: '            DELIMITED BY SIZE            18610000
186200              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            18620000
186300              '-'                    DELIMITED BY SIZE            18630000
186400              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            18640000
186500              '  LINE: '             DELIMITED BY SIZE            18650000
186600              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            18660000
186700              '  STORE: '            DELIMITED BY SIZE            18670000
186800              PV-ERROR-STR-NBR       DELIMITED BY SIZE            18680000
186900                                INTO DP013-MESSAGE-TEXT (2)       18690000
187000         MOVE SQLCA               TO DP013-SQLCA                  18700000
187100         MOVE 'TDISTDT'           TO DP013-DB2-TABLE-NAME (1)     18710000
187200         SET DP013-DB2-ABEND                                      18720000
187300             PS-UPLOAD-ERROR                                      18730000
187400             DP013-ROLLBACK       TO TRUE                         18740000
187500         PERFORM 9999-WRITE-CICS-LOG-MSG                          18750000
187600     END-IF.                                                      18760000
187700*                                                                 18770000
187800*                                                                 18780000
187900*----------------------------------------------------------------*18790000
188000*    CHECK ON THE STATUS OF THE RECEIPT LINE ITEM.               *18800000
188100*----------------------------------------------------------------*18810000
188200 1325-CHECK-TRECITM-STATUS.                                       18820000
188300                                                                  18830000
188500     IF  PV-TEST-CICS                                             18850000
188600         INITIALIZE PV-CICS-MSG-AREA                              18860000
188700         STRING ' PCKCS722 - 1325-CHECK-TRECITM-STATUS'           18870000
188800                DELIMITED BY SIZE                                 18880000
188900           INTO PV-CICS-MSG-AREA                                  18890000
189000         PERFORM 9990-WRITE-CICS                                  18900000
189100     END-IF.                                                      18910000
189300                                                                  18930000
189400     INITIALIZE DCLTRECITM.                                       18940000
189500                                                                  18950000
189600     PERFORM                                                      18960000
189700         WITH TEST AFTER                                          18970000
189800         VARYING PV-RETRY-COUNTER                                 18980000
189900         FROM 1 BY 1                                              18990000
190000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                19000000
190100             OR (SQLCODE = +0)                                    19010000
190200                                                                  19020000
190300         EXEC SQL                                                 19030000
190400              SELECT                                              19040000
190500                    STATUS_CDE                                    19050000
190600                   ,PREPK_ID                                      19060000
190700                INTO                                              19070000
190800                    :RECITM-STATUS-CDE                            19080000
190900                   ,:RECITM-PREPK-ID                              19090000
191000                FROM                                              19100000
191100                    TRECITM                                       19110000
191200               WHERE                                              19120000
191300                    ORD_NBR      = :DK-ORD-NBR      AND           19130000
191400                    REC_SEQ_NBR  = :DK-REC-SEQ-NBR  AND           19140000
191500                    ORD_LNE_NBR  = :DK-ORD-LNE-NBR  AND           19150000
191600                    VER_STATUS_CDE = :PC-A                        19160000
191700         END-EXEC                                                 19170000
191800                                                                  19180000
191900         EVALUATE TRUE                                            19190000
192000             WHEN SQLCODE = ZERO                                  19200000
192100             WHEN SQLCODE = -904                                  19210000
192200             WHEN SQLCODE = -911                                  19220000
192300             WHEN SQLCODE = -913                                  19230000
192400                 CONTINUE                                         19240000
192500             WHEN SQLWARN0 NOT = SPACES                           19250000
192600             WHEN SQLCODE < ZERO                                  19260000
192700             WHEN SQLCODE > ZERO                                  19270000
192800                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              19280051
192900                 PERFORM 1500-CLOSE-SOCKET                        19290000
193000                 MOVE '1325-CHECK-TRECITM-STATUS'                 19300000
193100                                   TO DP013-PARAGRAPH             19310000
193200                 MOVE 'UNABLE TO CHECK TRECITM STATUS'            19320000
193300                                   TO DP013-MESSAGE-TEXT (1)      19330000
193400                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            19340000
193500                 MOVE DK-REC-SEQ-NBR                              19350000
193600                                   TO PV-ERROR-RCVR-SEQ-NBR       19360000
193700                 MOVE DK-ORD-LNE-NBR                              19370000
193800                                   TO PV-ERROR-ORD-LNE-NBR        19380000
193900                 STRING ' RCVR: '            DELIMITED BY SIZE    19390000
194000                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    19400000
194100                      '-'                    DELIMITED BY SIZE    19410000
194200                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    19420000
194300                      '  LINE: '             DELIMITED BY SIZE    19430000
194400                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    19440000
194500                                 INTO DP013-MESSAGE-TEXT (2)      19450000
194600                 MOVE SQLCA        TO DP013-SQLCA                 19460000
194700                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    19470000
194800                 SET DP013-ROLLBACK                               19480000
194900                     DP013-DB2-ABEND                              19490000
195000                                   TO TRUE                        19500000
195100                 PERFORM 9999-WRITE-CICS-LOG-MSG                  19510000
195200         END-EVALUATE                                             19520000
195300     END-PERFORM.                                                 19530000
195400                                                                  19540000
195500     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  19550000
195600         (SQLCODE NOT = +0)                                       19560000
195700         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      19570051
195800         PERFORM 1500-CLOSE-SOCKET                                19580000
195900         MOVE '1325-CHECK-TRECITM-STATUS'                         19590000
196000                                  TO DP013-PARAGRAPH              19600000
196100         MOVE 'MAX RETRIES EXCEEDED ON TRECITM STATUS CHECK'      19610000
196200                                  TO DP013-MESSAGE-TEXT (1)       19620000
196300         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             19630000
196400         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        19640000
196500         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         19650000
196600         STRING ' RCVR: '            DELIMITED BY SIZE            19660000
196700              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            19670000
196800              '-'                    DELIMITED BY SIZE            19680000
196900              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            19690000
197000              '  LINE: '             DELIMITED BY SIZE            19700000
197100              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            19710000
197200                                INTO DP013-MESSAGE-TEXT (2)       19720000
197300         MOVE SQLCA               TO DP013-SQLCA                  19730000
197400         MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)     19740000
197500         SET DP013-DB2-ABEND                                      19750000
197600             DP013-ROLLBACK       TO TRUE                         19760000
197700         PERFORM 9999-WRITE-CICS-LOG-MSG                          19770000
197800     END-IF.                                                      19780000
197900                                                                  19790000
198000     EJECT                                                        19800000
198100*----------------------------------------------------------------*19810000
198200*    CHANGE THE STATUS ON THE DISTRIBUTION HEADER RECORD FOR THE *19820000
198300*    SPECIFIED LINE TO AN 'R' (READY TO VERIFY), A 'P' (VERIFIED *19830000
198400*    PREVIOUSLY), 'F' (NO FREIGHT BILL), OR 'A' (QUANTITY NOT A  *19840000
198500*    MULTIPLE OF THE PREPK RATIO)                                *19850000
198600*----------------------------------------------------------------*19860000
198700 1330-UPDATE-TDISTHD.                                             19870000
198800                                                                  19880000
199000     IF  PV-TEST-CICS                                             19900000
199100         INITIALIZE PV-CICS-MSG-AREA                              19910000
199200         STRING ' PCKCS722 - 1330-UPDATE-TDISTHD'                 19920000
199300                DELIMITED BY SIZE                                 19930000
199400           INTO PV-CICS-MSG-AREA                                  19940000
199500         PERFORM 9990-WRITE-CICS                                  19950000
199600     END-IF.                                                      19960000
199800                                                                  19980000
199900     PERFORM                                                      19990000
200000         WITH TEST AFTER                                          20000000
200100         VARYING PV-RETRY-COUNTER                                 20010000
200200         FROM 1 BY 1                                              20020000
200300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20030000
200400             OR (SQLCODE = +0)                                    20040000
200500             OR (SQLCODE = +100))                                 20050000
200600                                                                  20060000
200700         EXEC SQL                                                 20070000
200800             UPDATE TDISTHD                                       20080000
200900                 SET PRCG_STAT_CDE   = :PV-PRCG-STAT-CDE          20090000
201000                   , RSLTS_RCVD_TMST = CURRENT TIMESTAMP          20100000
201100             WHERE                                                20110000
201200                 ORD_NBR             = :DK-ORD-NBR      AND       20120000
201300                 RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR  AND       20130000
201400                 ORD_LNE_NBR         = :DK-ORD-LNE-NBR  AND       20140000
201500                 WRK_ORD_SEQ_NBR     = :DK-WRK-ORD-SEQ-NBR        20150000
201600         END-EXEC                                                 20160000
201700                                                                  20170000
201800         EVALUATE TRUE                                            20180000
201900             WHEN SQLCODE = ZERO                                  20190000
202000                 PERFORM 8400-TRACKING                            20200000
202100             WHEN SQLCODE = +100                                  20210000
202200             WHEN SQLCODE = -904                                  20220000
202300             WHEN SQLCODE = -911                                  20230000
202400             WHEN SQLCODE = -913                                  20240000
202500                 CONTINUE                                         20250000
202600             WHEN SQLWARN0 NOT = SPACES                           20260000
202700             WHEN SQLCODE < ZERO                                  20270000
202800             WHEN SQLCODE > ZERO                                  20280000
202900                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              20290051
203000                 PERFORM 1500-CLOSE-SOCKET                        20300000
203100                 MOVE '1330-UPDATE-TDISTHD'                       20310000
203200                                   TO DP013-PARAGRAPH             20320000
203300                 MOVE 'ERROR UPDATING TDISTHD'                    20330000
203400                                   TO DP013-MESSAGE-TEXT (1)      20340000
203500                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            20350000
203600                 MOVE DK-REC-SEQ-NBR                              20360000
203700                                   TO PV-ERROR-RCVR-SEQ-NBR       20370000
203800                 MOVE DK-ORD-LNE-NBR                              20380000
203900                                   TO PV-ERROR-ORD-LNE-NBR        20390000
204000                 STRING ' RCVR: '            DELIMITED BY SIZE    20400000
204100                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    20410000
204200                      '-'                    DELIMITED BY SIZE    20420000
204300                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    20430000
204400                      '  LINE: '             DELIMITED BY SIZE    20440000
204500                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    20450000
204600                                 INTO DP013-MESSAGE-TEXT (2)      20460000
204700                 MOVE SQLCA        TO DP013-SQLCA                 20470000
204800                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    20480000
204900                 SET DP013-ROLLBACK                               20490000
205000                     DP013-DB2-ABEND                              20500000
205100                                   TO TRUE                        20510000
205200                 PERFORM 9999-WRITE-CICS-LOG-MSG                  20520000
205300         END-EVALUATE                                             20530000
205400     END-PERFORM.                                                 20540000
205500                                                                  20550000
205600     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  20560000
205700         (SQLCODE NOT = +0)                                       20570000
205800         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      20580051
205900         PERFORM 1500-CLOSE-SOCKET                                20590000
206000         MOVE '1330-UPDATE-TDISTHD'                               20600000
206100                                  TO DP013-PARAGRAPH              20610000
206200         MOVE 'MAX RETRIES EXCEEDED ON UPDATE OF TDISTHD ROW'     20620000
206300                                  TO DP013-MESSAGE-TEXT (1)       20630000
206400         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             20640000
206500         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        20650000
206600         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         20660000
206700         STRING ' RCVR: '            DELIMITED BY SIZE            20670000
206800              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            20680000
206900              '-'                    DELIMITED BY SIZE            20690000
207000              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            20700000
207100              '  LINE: '             DELIMITED BY SIZE            20710000
207200              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            20720000
207300                                INTO DP013-MESSAGE-TEXT (2)       20730000
207400         MOVE SQLCA               TO DP013-SQLCA                  20740000
207500         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     20750000
207600         SET DP013-DB2-ABEND                                      20760000
207700             DP013-ROLLBACK       TO TRUE                         20770000
207800         PERFORM 9999-WRITE-CICS-LOG-MSG                          20780000
207900     END-IF.                                                      20790000
208000                                                                  20800000
208200     IF  PV-TEST-CICS                                             20820000
208300         INITIALIZE PV-CICS-MSG-AREA                              20830000
208400         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          20840000
208500         MOVE DK-ORD-NBR              TO PC-DISPLAY-PO            20850000
208600         MOVE DK-REC-SEQ-NBR          TO PC-DISPLAY-RCVR          20860000
208700         MOVE DK-ORD-LNE-NBR          TO PC-DISPLAY-LINE          20870000
208800         STRING ' PCKCS722 - '      DELIMITED BY SIZE             20880000
208900                ' 1330-UPDATE-TDISTHD '                           20890000
209000                                    DELIMITED BY SIZE             20900000
209100                ' KEY - '           DELIMITED BY SIZE             20910000
209200                PC-DISPLAY-OPER     DELIMITED BY SIZE             20920000
209300                '-'                 DELIMITED BY SIZE             20930000
209400                PC-DISPLAY-PO       DELIMITED BY SIZE             20940000
209500                '-'                 DELIMITED BY SIZE             20950000
209600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             20960000
209700                '-'                 DELIMITED BY SIZE             20970000
209800                PC-DISPLAY-LINE     DELIMITED BY SIZE             20980000
209900                '  '                DELIMITED BY SIZE             20990000
210000                PV-PRCG-STAT-CDE    DELIMITED BY SIZE             21000000
210100                             INTO PV-CICS-MSG-AREA                21010000
210200         MOVE LENGTH OF PV-CICS-MSG-AREA                          21020000
210300                               TO PV-COMMAREA-LENGTH              21030000
210400         PERFORM 9990-WRITE-CICS                                  21040000
210500     END-IF.                                                      21050000
210700                                                                  21070000
210800     EJECT                                                        21080000
210900*----------------------------------------------------------------*21090000
211000*    COUNT TO DETERMINE IF A FREIGHT BILL IS ASSOCIATED TO THE   *21100000
211100*    RECEIVER BEING VERIFIED.                                    *21110000
211200*----------------------------------------------------------------*21120000
211300 1350-CHECK-FOR-PRO-NUMBER.                                       21130000
211400                                                                  21140000
211600     IF  PV-TEST-CICS                                             21160000
211700         INITIALIZE PV-CICS-MSG-AREA                              21170000
211800         STRING ' PCKCS722 - 1350-CHECK-FOR-PRO-NUMBER'           21180000
211900                DELIMITED BY SIZE                                 21190000
212000           INTO PV-CICS-MSG-AREA                                  21200000
212100         PERFORM 9990-WRITE-CICS                                  21210000
212200     END-IF.                                                      21220000
212400                                                                  21240000
212500     INITIALIZE PV-DB2-FREIGHT-COUNT.                             21250000
212600                                                                  21260000
212700     PERFORM                                                      21270000
212800         WITH TEST AFTER                                          21280000
212900         VARYING PV-RETRY-COUNTER                                 21290000
213000         FROM 1 BY 1                                              21300000
213100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21310000
213200             OR (SQLCODE = +0)                                    21320000
213300             OR (SQLCODE = +100))                                 21330000
213400                                                                  21340000
213500         EXEC SQL                                                 21350000
213600              SELECT COUNT(*)                                     21360000
213700                INTO :PV-DB2-FREIGHT-COUNT                        21370000
213800                FROM TSHIPMT A,                                   21380000
213900                     TSHPTPO B                                    21390000
214000               WHERE B.PO_NBR      = :DK-ORD-NBR                  21400000
214100                 AND B.REC_SEQ_NBR = :DK-REC-SEQ-NBR              21410000
214200                 AND A.SHIPT_ID    = B.SHIPT_ID                   21420000
214300                 AND NOT A.PRO_NBR = :PC-SPACES                   21430000
214400         END-EXEC                                                 21440000
214500                                                                  21450000
214600         EVALUATE TRUE                                            21460000
214700             WHEN SQLCODE = +0                                    21470000
214800                  IF PV-DB2-FREIGHT-COUNT > 0                     21480000
214900                     SET PS-FREIGHT-BILL-FOUND TO TRUE            21490000
215000                  ELSE                                            21500000
215100                     SET PS-NO-FREIGHT-BILL TO TRUE               21510000
215200                  END-IF                                          21520000
215300             WHEN SQLCODE = +100                                  21530000
215400             WHEN SQLCODE = -904                                  21540000
215500             WHEN SQLCODE = -911                                  21550000
215600             WHEN SQLCODE = -913                                  21560000
215700                  SET PS-NO-FREIGHT-BILL TO TRUE                  21570000
215800                                                                  21580000
215900             WHEN SQLWARN0 NOT = SPACES                           21590000
216000             WHEN SQLCODE < +0                                    21600000
216100             WHEN SQLCODE > +0                                    21610000
216200                  PERFORM 1410-SEND-ERROR-CONFIRM-P2L             21620051
216300                  PERFORM 1500-CLOSE-SOCKET                       21630000
216400                  MOVE '1350-CHECK-FOR-PRO-NUMBER'                21640000
216500                                  TO DP013-PARAGRAPH              21650000
216600                  MOVE 'UNSUCCESSFUL COUNT OF SHIPMENT ROWS'      21660000
216700                                  TO DP013-MESSAGE-TEXT (1)       21670000
216800                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             21680000
216900                  MOVE DK-REC-SEQ-NBR                             21690000
217000                                  TO PV-ERROR-RCVR-SEQ-NBR        21700000
217100                  STRING ' RCVR: '            DELIMITED BY SIZE   21710000
217200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   21720000
217300                       '-'                    DELIMITED BY SIZE   21730000
217400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   21740000
217500                                INTO DP013-MESSAGE-TEXT (2)       21750000
217600                  MOVE SQLCA      TO DP013-SQLCA                  21760000
217700                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     21770000
217800                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)     21780000
217900                  SET DP013-DB2-ABEND                             21790000
218000                      DP013-NO-ROLLBACK                           21800000
218100                                  TO TRUE                         21810000
218200                  PERFORM 9999-WRITE-CICS-LOG-MSG                 21820000
218300         END-EVALUATE                                             21830000
218400     END-PERFORM.                                                 21840000
218500                                                                  21850000
218600     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  21860000
218700         (SQLCODE NOT = +0)                                       21870000
218800         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      21880051
218900         PERFORM 1500-CLOSE-SOCKET                                21890000
219000         MOVE '1350-CHECK-FOR-PRO-NUMBER'                         21900000
219100                                  TO DP013-PARAGRAPH              21910000
219200         MOVE 'MAX RETRIES EXCEEDED ON COUNT OF SHIPMENT ROWS'    21920000
219300                                  TO DP013-MESSAGE-TEXT (1)       21930000
219400         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             21940000
219500         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        21950000
219600         STRING ' RCVR: '            DELIMITED BY SIZE            21960000
219700              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            21970000
219800              '-'                    DELIMITED BY SIZE            21980000
219900              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            21990000
220000                                INTO DP013-MESSAGE-TEXT (2)       22000000
220100         MOVE SQLCA               TO DP013-SQLCA                  22010000
220200         MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)     22020000
220300         MOVE 'TSHPTPO'           TO DP013-DB2-TABLE-NAME (2)     22030000
220400         SET DP013-DB2-ABEND                                      22040000
220500             DP013-NO-ROLLBACK    TO TRUE                         22050000
220600         PERFORM 9999-WRITE-CICS-LOG-MSG                          22060000
220700     END-IF.                                                      22070000
220800                                                                  22080000
221000     IF  PV-TEST-CICS                                             22100000
221100         INITIALIZE PV-CICS-MSG-AREA                              22110000
221200         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          22120000
221300         MOVE DK-ORD-NBR              TO PC-DISPLAY-PO            22130000
221400         MOVE DK-REC-SEQ-NBR          TO PC-DISPLAY-RCVR          22140000
221500         MOVE DK-ORD-LNE-NBR          TO PC-DISPLAY-LINE          22150000
221600         STRING ' PCKCS722 - '      DELIMITED BY SIZE             22160000
221700                ' 1350-CHECK-FOR-PRO-NUMBER '                     22170000
221800                                    DELIMITED BY SIZE             22180000
221900                ' KEY - '           DELIMITED BY SIZE             22190000
222000                PC-DISPLAY-OPER     DELIMITED BY SIZE             22200000
222100                '-'                 DELIMITED BY SIZE             22210000
222200                PC-DISPLAY-PO       DELIMITED BY SIZE             22220000
222300                '-'                 DELIMITED BY SIZE             22230000
222400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             22240000
222500                '-'                 DELIMITED BY SIZE             22250000
222600                PC-DISPLAY-LINE     DELIMITED BY SIZE             22260000
222700                             INTO PV-CICS-MSG-AREA                22270000
222800         MOVE LENGTH OF PV-CICS-MSG-AREA                          22280000
222900                               TO PV-COMMAREA-LENGTH              22290000
223000         PERFORM 9990-WRITE-CICS                                  22300000
223100     END-IF.                                                      22310000
223300                                                                  22330000
223400                                                                  22340000
223500 1355-SELECT-RECEIVER.                                            22350000
223600                                                                  22360000
223700     IF  PV-TEST-CICS                                             22370000
223800         INITIALIZE PV-CICS-MSG-AREA                              22380000
223900         STRING ' PCKCS722 - 1355-SELECT-RECEIVER'                22390000
224000                DELIMITED BY SIZE                                 22400000
224100           INTO PV-CICS-MSG-AREA                                  22410000
224200         PERFORM 9990-WRITE-CICS                                  22420000
224300     END-IF.                                                      22430000
224400                                                                  22440000
224500     PERFORM                                                      22450000
224600         WITH TEST AFTER                                          22460000
224700         VARYING PV-RETRY-COUNTER                                 22470000
224800         FROM 1 BY 1                                              22480000
224900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22490000
225000             OR (SQLCODE = +0)                                    22500000
225100             OR (SQLCODE = +100))                                 22510000
225200                                                                  22520000
225300         EXEC SQL                                                 22530000
225400              SELECT PACK_BY_ST_IND                               22540000
225500                  ,  PKGNG_CDE                                    22550000
225600                INTO :RECEIV-PACK-BY-ST-IND                       22560000
225700                  ,  :RECEIV-PKGNG-CDE                            22570000
225800                FROM TRECEIV                                      22580000
225900               WHERE ORD_NBR       = :DK-ORD-NBR                  22590000
226000                 AND REC_SEQ_NBR   = :DK-REC-SEQ-NBR              22600000
226100         END-EXEC                                                 22610000
226200                                                                  22620000
226300         EVALUATE TRUE                                            22630000
226400             WHEN SQLCODE = +0                                    22640000
226500             WHEN SQLCODE = -904                                  22650000
226600             WHEN SQLCODE = -911                                  22660000
226700             WHEN SQLCODE = -913                                  22670000
226800                  CONTINUE                                        22680000
226900                                                                  22690000
227000             WHEN SQLWARN0 NOT = SPACES                           22700000
227100             WHEN SQLCODE < +0                                    22710000
227200             WHEN SQLCODE > +0                                    22720000
227300                  PERFORM 1410-SEND-ERROR-CONFIRM-P2L             22730051
227400                  PERFORM 1500-CLOSE-SOCKET                       22740000
227500                  MOVE '1355-SELECT-RECEIVER'                     22750000
227600                                  TO DP013-PARAGRAPH              22760000
227700                  MOVE 'UNSUCCESSFUL SELECT OF TRECEIV'           22770000
227800                                  TO DP013-MESSAGE-TEXT (1)       22780000
227900                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             22790000
228000                  MOVE DK-REC-SEQ-NBR                             22800000
228100                                  TO PV-ERROR-RCVR-SEQ-NBR        22810000
228200                  STRING ' RCVR: '            DELIMITED BY SIZE   22820000
228300                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   22830000
228400                       '-'                    DELIMITED BY SIZE   22840000
228500                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   22850000
228600                                INTO DP013-MESSAGE-TEXT (2)       22860000
228700                  MOVE SQLCA      TO DP013-SQLCA                  22870000
228800                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     22880000
228900                  SET DP013-DB2-ABEND                             22890000
229000                      DP013-NO-ROLLBACK                           22900000
229100                                  TO TRUE                         22910000
229200                  PERFORM 9999-WRITE-CICS-LOG-MSG                 22920000
229300         END-EVALUATE                                             22930000
229400     END-PERFORM.                                                 22940000
229500                                                                  22950000
229600     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  22960000
229700         (SQLCODE NOT = +0)                                       22970000
229800         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      22980051
229900         PERFORM 1500-CLOSE-SOCKET                                22990000
230000         MOVE '1355-SELECT-RECEIVER'                              23000000
230100                                  TO DP013-PARAGRAPH              23010000
230200         MOVE 'MAX RETRIES EXCEEDED ON COUNT OF SHIPMENT ROWS'    23020000
230300                                  TO DP013-MESSAGE-TEXT (1)       23030000
230400         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             23040000
230500         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        23050000
230600         STRING ' RCVR: '            DELIMITED BY SIZE            23060000
230700              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            23070000
230800              '-'                    DELIMITED BY SIZE            23080000
230900              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            23090000
231000                                INTO DP013-MESSAGE-TEXT (2)       23100000
231100         MOVE SQLCA               TO DP013-SQLCA                  23110000
231200         MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)     23120000
231300         SET DP013-DB2-ABEND                                      23130000
231400             DP013-NO-ROLLBACK    TO TRUE                         23140000
231500         PERFORM 9999-WRITE-CICS-LOG-MSG                          23150000
231600     END-IF.                                                      23160000
231700                                                                  23170000
231800     IF  PV-TEST-CICS                                             23180000
231900         INITIALIZE PV-CICS-MSG-AREA                              23190000
232000         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          23200000
232100         MOVE DK-ORD-NBR              TO PC-DISPLAY-PO            23210000
232200         MOVE DK-REC-SEQ-NBR          TO PC-DISPLAY-RCVR          23220000
232300         STRING ' PCKCS722 - '      DELIMITED BY SIZE             23230000
232400                ' 1355-SELECT-RECEIVER  '                         23240000
232500                                    DELIMITED BY SIZE             23250000
232600                ' KEY - '           DELIMITED BY SIZE             23260000
232700                PC-DISPLAY-OPER     DELIMITED BY SIZE             23270000
232800                '-'                 DELIMITED BY SIZE             23280000
232900                PC-DISPLAY-PO       DELIMITED BY SIZE             23290000
233000                '-'                 DELIMITED BY SIZE             23300000
233100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             23310000
233200                             INTO PV-CICS-MSG-AREA                23320000
233300         MOVE LENGTH OF PV-CICS-MSG-AREA                          23330000
233400                               TO PV-COMMAREA-LENGTH              23340000
233500         PERFORM 9990-WRITE-CICS                                  23350000
233600     END-IF.                                                      23360000
233700                                                                  23370000
233800                                                                  23380000
233900 1360-CALL-VEM-MODULE.                                            23390000
234000                                                                  23400000
234200     IF  PV-TEST-CICS                                             23420000
234300         INITIALIZE PV-CICS-MSG-AREA                              23430000
234400         STRING ' PCKCS722 - 1360-CALL-VEM-MODULE'                23440000
234500                DELIMITED BY SIZE                                 23450000
234600           INTO PV-CICS-MSG-AREA                                  23460000
234700         PERFORM 9990-WRITE-CICS                                  23470000
234800     END-IF.                                                      23480000
235000                                                                  23500000
235100                                                                  23510000
235200     MOVE DK-ORD-NBR               TO RC038-PO-NBR.               23520000
235300     MOVE DK-REC-SEQ-NBR           TO RC038-REC-SEQ-NBR.          23530000
235400     MOVE DK-ORD-LNE-NBR           TO RC038-PO-LNE-NBR.           23540000
235500     MOVE DK-PREPK-ID              TO RC038-PREPACK-ID.           23550000
235600     MOVE DK-DISTHD-OPER           TO RC038-OPER-UNT-ID.          23560000
235700     MOVE 1                        TO RC038-FCLTY-ID.             23570000
235800     IF RECEIV-PACK-BY-ST-IND = 'Y'                               23580000
235900        SET RC038-PBS              TO TRUE                        23590000
236000     ELSE                                                         23600000
236100         IF RECEIV-PKGNG-CDE = 'M' OR 'I'                         23610000
236200            MOVE RECEIV-PKGNG-CDE                                 23620000
236300                                   TO RC038-PKGNG-CDE             23630000
236400         ELSE                                                     23640000
236500            MOVE 'B'               TO RC038-PKGNG-CDE             23650000
236600         END-IF                                                   23660000
236700     END-IF.                                                      23670000
236800                                                                  23680000
236900     MOVE PC-CURRENT-PGM-NAME      TO RC038-PROGRAM-NAME.         23690000
237000     MOVE 'P2L'                    TO RC038-USER-ID.              23700000
237100     MOVE RC040-AUTO-VE-SW         TO RC038-AUTOVE-PO-SW.         23710000
237200                                                                  23720000
237300     MOVE LENGTH OF RC038-FIELDS         TO PV-COMMAREA-LENGTH.   23730000
237400                                                                  23740000
237500     EXEC CICS                                                    23750000
237600         LINK PROGRAM  (PC-RCKUT124)                              23760000
237700              COMMAREA (RC038-FIELDS)                             23770000
237800              LENGTH   (PV-COMMAREA-LENGTH)                       23780000
237900              RESP     (PV-CICS-RESP)                             23790000
238000     END-EXEC.                                                    23800000
238100                                                                  23810000
238200     EVALUATE TRUE                                                23820000
238300         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     23830000
238400             IF  RC038-INVALID-SQL     OR                         23840000
238500                 RC038-DATABASE-BUSY                              23850000
238600                 STRING ' PCKCS722 - '        DELIMITED BY SIZE   23860000
238700                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   23870000
238800                        RC038-SUCCESS-IND     DELIMITED BY SIZE   23880000
238900                                   INTO DP013-MESSAGE-TEXT(1)     23890000
239000                 SET DP013-CICS-ABEND        TO TRUE              23900000
239100                 SET DP013-NO-ROLLBACK       TO TRUE              23910000
239200                 MOVE '1360-CALL-VEM-MODULE' TO DP013-PARAGRAPH   23920000
239300                 SET DP013-ROLLBACK                               23930000
239400                     DP013-DB2-ABEND                              23940000
239500                                   TO TRUE                        23950000
239600                 PERFORM 9999-WRITE-CICS-LOG-MSG                  23960000
239700             END-IF                                               23970000
239800         WHEN OTHER                                               23980000
239900             MOVE PV-CICS-RESP          TO PV-DISPLAY-CICS-RESP   23990000
240000             STRING ' PCKCS722 (OTHER) -' DELIMITED BY SIZE       24000000
240100                    ' CICS RESP = '       DELIMITED BY SIZE       24010000
240200                    PV-DISPLAY-CICS-RESP  DELIMITED BY SIZE       24020000
240300                               INTO DP013-MESSAGE-TEXT(1)         24030000
240400             SET DP013-CICS-ABEND        TO TRUE                  24040000
240500             SET DP013-NO-ROLLBACK       TO TRUE                  24050000
240600             MOVE '1360-CALL-VEM-MODULE' TO DP013-PARAGRAPH       24060000
240700             SET DP013-ROLLBACK                                   24070000
240800                 DP013-DB2-ABEND                                  24080000
240900                               TO TRUE                            24090000
241000             PERFORM 9999-WRITE-CICS-LOG-MSG                      24100000
241100                                                                  24110000
241200     END-EVALUATE.                                                24120000
241300                                                                  24130000
241400                                                                  24140000
241500*----------------------------------------------------------------*24150000
241600* CHECK TO SEE IF PO-RCVR IS AN AUTOVE PO                        *24160000
241700*----------------------------------------------------------------*24170000
241800 1365-CHECK-IF-AUTOVE.                                            24180000
241900                                                                  24190000
242000     IF  PV-TEST-CICS                                             24200000
242100         INITIALIZE PV-CICS-MSG-AREA                              24210000
242200         STRING ' PCKCS722 - 1365-CHECK-IF-AUTOVE'                24220000
242300                DELIMITED BY SIZE                                 24230000
242400           INTO PV-CICS-MSG-AREA                                  24240000
242500         PERFORM 9990-WRITE-CICS                                  24250000
242600     END-IF.                                                      24260000
242700                                                                  24270000
242800                                                                  24280000
242900     INITIALIZE RC040-FIELDS.                                     24290000
243000     MOVE DK-ORD-NBR               TO RC040-PO-NBR                24300000
243100     MOVE DK-REC-SEQ-NBR           TO RC040-PO-RCVR               24310000
243200                                                                  24320000
243300     SET RC040-RCVR-EXISTS         TO TRUE                        24330000
243400                                                                  24340000
243700     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  24370000
243800                                        RC040-COMMAREA            24380000
243900                                        RC040-FIELDS.             24390000
244000                                                                  24400000
244100     EVALUATE TRUE                                                24410000
244200         WHEN RC040-SUCCESSFUL                                    24420000
244300             CONTINUE                                             24430000
244400         WHEN OTHER                                               24440000
244500             MOVE PV-CICS-RESP          TO PV-DISPLAY-CICS-RESP   24450000
244600             STRING ' PCKCS722 (OTHER) -' DELIMITED BY SIZE       24460000
244700                    ' CICS RESP = '       DELIMITED BY SIZE       24470000
244800                    PV-DISPLAY-CICS-RESP  DELIMITED BY SIZE       24480000
244900                               INTO DP013-MESSAGE-TEXT(1)         24490000
245000             SET DP013-CICS-ABEND        TO TRUE                  24500000
245100             SET DP013-NO-ROLLBACK       TO TRUE                  24510000
245200             MOVE '1365-CHECK-IF-AUTOVE' TO DP013-PARAGRAPH       24520000
245300             SET DP013-ROLLBACK                                   24530000
245400                 DP013-DB2-ABEND                                  24540000
245500                               TO TRUE                            24550000
245600             PERFORM 9999-WRITE-CICS-LOG-MSG                      24560000
245700     END-EVALUATE.                                                24570000
245800                                                                  24580000
245900                                                                  24590000
246000                                                                  24600000
246100*----------------------------------------------------------------*24610000
246200*    READ THE TDISTHD TABLE FOR THE LINE BEING PROCESSED AND     *24620000
246300*    PULL BACK THE NEEDED INFORMATION.  THEN USING THE           *24630000
246400*    INFORMATION RETRIEVED, DETERMINE IF THE LINE HAS SPLIT      *24640000
246500*    PROCESSING AND IF BOTH OF THE PROCESSES ARE NOW COMPLETED   *24650000
246600*    AND THEN SET THE SWITCH TO DETERMINE IF THE LINE CAN BE     *24660000
246700*    AUTO VERIFIED OR IF THE PROCESS NEEDS TO WAIT FOR THE OTHER *24670000
246800*    PROCESS TO COMPLETE.                                        *24680000
246900*----------------------------------------------------------------*24690000
247000 1370-CHECK-FOR-SPLIT.                                            24700000
247100                                                                  24710000
247300     IF  PV-TEST-CICS                                             24730000
247400         INITIALIZE PV-CICS-MSG-AREA                              24740000
247500         STRING ' PCKCS722 - 1370-CHECK-FOR-SPLIT'                24750000
247600                DELIMITED BY SIZE                                 24760000
247700           INTO PV-CICS-MSG-AREA                                  24770000
247800         PERFORM 9990-WRITE-CICS                                  24780000
247900     END-IF.                                                      24790000
248100                                                                  24810000
248200     PERFORM 1380-SELECT-TDISTHD.                                 24820000
248300                                                                  24830000
248400     IF  DISTHD-FCSE-CNFRMN-TMST IS EQUAL TO PC-DEFAULT-DATE-1    24840000
248500     OR  DISTHD-FCSE-CNFRMN-TMST IS EQUAL TO PC-DEFAULT-DATE-2    24850000
248600         IF  DISTHD-FCSE-CART-CNT IS GREATER THAN ZERO            24860000
248700         OR  DISTHD-INPK-CART-CNT IS GREATER THAN ZERO            24870000
248800             SET PS-WAIT-FOR-CONFIRM TO TRUE                      24880000
248900*            SET RC289-P2L-CASE-PROCESS TO TRUE                   24890000
249000         END-IF                                                   24900000
249100     ELSE                                                         24910000
249200         SET RC289-P2L-CASE-PROCESS TO TRUE                       24920000
249300     END-IF.                                                      24930000
249400 EJECT                                                            24940000
249500*                                                                 24950000
249600*----------------------------------------------------------------*24960000
249700*    SELECT INFORMATION FROM THE DISTRIBUTION HEADER TABLE.      *24970000
249800*----------------------------------------------------------------*24980000
249900 1380-SELECT-TDISTHD.                                             24990000
250000                                                                  25000000
250200     IF  PV-TEST-CICS                                             25020000
250300         INITIALIZE PV-CICS-MSG-AREA                              25030000
250400         STRING ' PCKCS722 - 1380-SELECT-TDISTHD'                 25040000
250500                DELIMITED BY SIZE                                 25050000
250600           INTO PV-CICS-MSG-AREA                                  25060000
250700         PERFORM 9990-WRITE-CICS                                  25070000
250800     END-IF.                                                      25080000
251000                                                                  25100000
251100     INITIALIZE DCLTDISTHD.                                       25110000
251200                                                                  25120000
251300     PERFORM                                                      25130000
251400         WITH TEST AFTER                                          25140000
251500         VARYING PV-RETRY-COUNTER                                 25150000
251600         FROM 1 BY 1                                              25160000
251700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                25170000
251800             OR (SQLCODE = +0)                                    25180000
251900                                                                  25190000
252000         EXEC SQL                                                 25200000
252100              SELECT                                              25210000
252200                    FCSE_CART_CNT,                                25220000
252300                    INPK_CART_CNT,                                25230000
252400                    FCSE_CNFRMN_TMST,                             25240000
252500                    PREPK_LNE_PRC_CDE,                            25250000
252600                    PRCG_STAT_CDE                                 25260000
252700                INTO                                              25270000
252800                    :DISTHD-FCSE-CART-CNT,                        25280000
252900                    :DISTHD-INPK-CART-CNT,                        25290000
253000                    :DISTHD-FCSE-CNFRMN-TMST,                     25300000
253100                    :DISTHD-PREPK-LNE-PRC-CDE,                    25310000
253200                    :DISTHD-PRCG-STAT-CDE                         25320000
253300                FROM                                              25330000
253400                    TDISTHD                                       25340000
253500               WHERE                                              25350000
253600                    ORD_NBR      = :DK-ORD-NBR      AND           25360000
253700                    RCVR_SEQ_NBR = :DK-REC-SEQ-NBR  AND           25370000
253800                    ORD_LNE_NBR  = :DK-ORD-LNE-NBR  AND           25380000
253900                    WRK_ORD_SEQ_NBR     = :DK-WRK-ORD-SEQ-NBR     25390000
254000         END-EXEC                                                 25400000
254100                                                                  25410000
254200         EVALUATE TRUE                                            25420000
254300             WHEN SQLCODE = ZERO                                  25430000
254400             WHEN SQLCODE = -904                                  25440000
254500             WHEN SQLCODE = -911                                  25450000
254600             WHEN SQLCODE = -913                                  25460000
254700                 CONTINUE                                         25470000
254800             WHEN SQLWARN0 NOT = SPACES                           25480000
254900             WHEN SQLCODE < ZERO                                  25490000
255000             WHEN SQLCODE > ZERO                                  25500000
255100                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              25510051
255200                 PERFORM 1500-CLOSE-SOCKET                        25520000
255300                 MOVE '1380-READ-TDISTHD'                         25530000
255400                                   TO DP013-PARAGRAPH             25540000
255500                 MOVE 'UNABLE TO SELECT TDISTHD DATA '            25550000
255600                                   TO DP013-MESSAGE-TEXT (1)      25560000
255700                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            25570000
255800                 MOVE DK-REC-SEQ-NBR                              25580000
255900                                   TO PV-ERROR-RCVR-SEQ-NBR       25590000
256000                 MOVE DK-ORD-LNE-NBR                              25600000
256100                                   TO PV-ERROR-ORD-LNE-NBR        25610000
256200                 STRING ' RCVR: '            DELIMITED BY SIZE    25620000
256300                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    25630000
256400                      '-'                    DELIMITED BY SIZE    25640000
256500                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    25650000
256600                      '  LINE: '             DELIMITED BY SIZE    25660000
256700                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    25670000
256800                                 INTO DP013-MESSAGE-TEXT (2)      25680000
256900                 MOVE SQLCA        TO DP013-SQLCA                 25690000
257000                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    25700000
257100                 SET DP013-ROLLBACK                               25710000
257200                     DP013-DB2-ABEND                              25720000
257300                                   TO TRUE                        25730000
257400                 PERFORM 9999-WRITE-CICS-LOG-MSG                  25740000
257500         END-EVALUATE                                             25750000
257600     END-PERFORM.                                                 25760000
257700                                                                  25770000
257900     IF  PV-TEST-CICS                                             25790000
258000         INITIALIZE PV-CICS-MSG-AREA                              25800000
258100         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          25810000
258200         MOVE DK-ORD-NBR              TO PC-DISPLAY-PO            25820000
258300         MOVE DK-REC-SEQ-NBR          TO PC-DISPLAY-RCVR          25830000
258400         MOVE DK-ORD-LNE-NBR          TO PC-DISPLAY-LINE          25840000
258500         MOVE DK-WRK-ORD-SEQ-NBR      TO PC-DISPLAY-WORK          25850000
258600         STRING ' PCKCS722 - '      DELIMITED BY SIZE             25860000
258700                ' 1380-SELECT-TDISTHD '                           25870000
258800                                    DELIMITED BY SIZE             25880000
258900                ' KEY - '           DELIMITED BY SIZE             25890000
259000                PC-DISPLAY-OPER     DELIMITED BY SIZE             25900000
259100                '-'                 DELIMITED BY SIZE             25910000
259200                PC-DISPLAY-PO       DELIMITED BY SIZE             25920000
259300                '-'                 DELIMITED BY SIZE             25930000
259400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             25940000
259500                '-'                 DELIMITED BY SIZE             25950000
259600                PC-DISPLAY-LINE     DELIMITED BY SIZE             25960000
259700                '-'                 DELIMITED BY SIZE             25970000
259800                PC-DISPLAY-WORK     DELIMITED BY SIZE             25980000
259900                             INTO PV-CICS-MSG-AREA                25990000
260000         MOVE LENGTH OF PV-CICS-MSG-AREA                          26000000
260100                               TO PV-COMMAREA-LENGTH              26010000
260200         PERFORM 9990-WRITE-CICS                                  26020000
260300     END-IF                                                       26030000
260400                                                                  26040000
260500                                                                  26050000
260600     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  26060000
260700         (SQLCODE NOT = +0)                                       26070000
260800         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      26080051
260900         PERFORM 1500-CLOSE-SOCKET                                26090000
261000         MOVE '1380-READ-TDISTHD'                                 26100000
261100                                  TO DP013-PARAGRAPH              26110000
261200         MOVE 'MAX RETRIES EXCEEDED ON TDISTHD SELECT'            26120000
261300                                  TO DP013-MESSAGE-TEXT (1)       26130000
261400         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             26140000
261500         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        26150000
261600         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         26160000
261700         STRING ' RCVR: '            DELIMITED BY SIZE            26170000
261800              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            26180000
261900              '-'                    DELIMITED BY SIZE            26190000
262000              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            26200000
262100              '  LINE: '             DELIMITED BY SIZE            26210000
262200              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            26220000
262300                                INTO DP013-MESSAGE-TEXT (2)       26230000
262400         MOVE SQLCA               TO DP013-SQLCA                  26240000
262500         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     26250000
262600         SET DP013-DB2-ABEND                                      26260000
262700             DP013-ROLLBACK       TO TRUE                         26270000
262800         PERFORM 9999-WRITE-CICS-LOG-MSG                          26280000
262900     END-IF.                                                      26290000
263000                                                                  26300000
263100     EJECT                                                        26310000
263200*----------------------------------------------------------------*26320000
263300*    CHECK TRECEIVE IF ARRIVED                                   *26330000
263400*----------------------------------------------------------------*26340000
263500 1390-CHECK-IF-ARRIVED.                                           26350000
263600                                                                  26360000
263800     IF  PV-TEST-CICS                                             26380000
263900         INITIALIZE PV-CICS-MSG-AREA                              26390000
264000         STRING ' PCKCS722 - 1390-CHECK-IF-ARRIVED'               26400000
264100                DELIMITED BY SIZE                                 26410000
264200           INTO PV-CICS-MSG-AREA                                  26420000
264300         PERFORM 9990-WRITE-CICS                                  26430000
264400     END-IF.                                                      26440000
264600                                                                  26460000
264700     PERFORM                                                      26470000
264800         WITH TEST AFTER                                          26480000
264900         VARYING PV-RETRY-COUNTER                                 26490000
265000         FROM 1 BY 1                                              26500000
265100         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                26510000
265200             OR (SQLCODE = +0)                                    26520000
265300                                                                  26530000
265400         MOVE  ZEROES  TO  PV-DB2-COUNT                           26540000
265500                                                                  26550000
265600         EXEC SQL                                                 26560000
265700              SELECT COUNT(*)                                     26570000
265800                INTO :PV-DB2-COUNT :PV-NULL-IND                   26580000
265900                FROM TRECEIV                                      26590000
266000               WHERE ORD_NBR        = :DK-ORD-NBR                 26600000
266100                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             26610000
266200                 AND REC_TMST       = :PC-DEFAULT-TMST            26620000
266300         END-EXEC                                                 26630000
266400                                                                  26640000
266500         EVALUATE TRUE                                            26650000
266600             WHEN SQLCODE = +0                                    26660000
266700             WHEN SQLCODE = +100                                  26670000
266800                  IF  PV-DB2-COUNT  >  0                          26680000
266900                      SET  PS-NOT-ARRIVED-STATUS  TO TRUE         26690000
267000                  END-IF                                          26700000
267100             WHEN SQLCODE = -904                                  26710000
267200             WHEN SQLCODE = -911                                  26720000
267300             WHEN SQLCODE = -913                                  26730000
267400                  CONTINUE                                        26740000
267500                                                                  26750000
267600             WHEN SQLWARN0 NOT = SPACES                           26760000
267700             WHEN SQLCODE < +0                                    26770000
267800             WHEN SQLCODE > +0                                    26780000
267900                  MOVE '1390-CHECK-IF-ARRIVED'                    26790000
268000                                  TO DP013-PARAGRAPH              26800000
268100                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         26810000
268200                                  TO DP013-MESSAGE-TEXT (1)       26820000
268300                  MOVE SQLCA      TO DP013-SQLCA                  26830000
268400                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     26840000
268500                  SET DP013-DB2-ABEND                             26850000
268600                      DP013-ROLLBACK       TO TRUE                26860000
268700                  PERFORM 9999-WRITE-CICS-LOG-MSG                 26870000
268800         END-EVALUATE                                             26880000
268900     END-PERFORM.                                                 26890000
269000                                                                  26900000
269100                                                                  26910000
269200     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  26920000
269300         (SQLCODE NOT = +0)                                       26930000
269400         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      26940051
269500         PERFORM 1500-CLOSE-SOCKET                                26950000
269600         MOVE '1390-CHECK-IF-ARRIVED'                             26960000
269700                                  TO DP013-PARAGRAPH              26970000
269800         MOVE 'MAX RETRIES EXCEEDED ON TRECEIV SELECT'            26980000
269900                                  TO DP013-MESSAGE-TEXT (1)       26990000
270000         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             27000000
270100         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        27010000
270200         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         27020000
270300         STRING ' RCVR: '            DELIMITED BY SIZE            27030000
270400              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            27040000
270500              '-'                    DELIMITED BY SIZE            27050000
270600              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            27060000
270700              '  LINE: '             DELIMITED BY SIZE            27070000
270800              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            27080000
270900                                INTO DP013-MESSAGE-TEXT (2)       27090000
271000         MOVE SQLCA               TO DP013-SQLCA                  27100000
271100         MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)     27110000
271200         SET DP013-DB2-ABEND                                      27120000
271300             DP013-ROLLBACK       TO TRUE                         27130000
271400         PERFORM 9999-WRITE-CICS-LOG-MSG                          27140000
271500     END-IF.                                                      27150000
271600                                                                  27160000
271800     IF  PV-TEST-CICS                                             27180000
271900         INITIALIZE PV-CICS-MSG-AREA                              27190000
272000         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          27200000
272100         MOVE DK-ORD-NBR              TO PC-DISPLAY-PO            27210000
272200         MOVE DK-REC-SEQ-NBR          TO PC-DISPLAY-RCVR          27220000
272300         MOVE DK-ORD-LNE-NBR          TO PC-DISPLAY-LINE          27230000
272400         STRING ' PCKCS722 - '      DELIMITED BY SIZE             27240000
272500                ' 1390-CHECK-IF-ARRIVED '                         27250000
272600                                    DELIMITED BY SIZE             27260000
272700                ' KEY - '           DELIMITED BY SIZE             27270000
272800                PC-DISPLAY-OPER     DELIMITED BY SIZE             27280000
272900                '-'                 DELIMITED BY SIZE             27290000
273000                PC-DISPLAY-PO       DELIMITED BY SIZE             27300000
273100                '-'                 DELIMITED BY SIZE             27310000
273200                PC-DISPLAY-RCVR     DELIMITED BY SIZE             27320000
273300                '-'                 DELIMITED BY SIZE             27330000
273400                PC-DISPLAY-LINE     DELIMITED BY SIZE             27340000
273500                             INTO PV-CICS-MSG-AREA                27350000
273600         MOVE LENGTH OF PV-CICS-MSG-AREA                          27360000
273700                               TO PV-COMMAREA-LENGTH              27370000
273800         PERFORM 9990-WRITE-CICS                                  27380000
273900     END-IF.                                                      27390000
274100                                                                  27410000
274500*----------------------------------------------------------------*27450000
274600*    CHECK TDISTHD TO SEE IF DISTRIBUTION HAD BEEN UPLOADED      *27460000
274700*    BEFORE - ADDED BECAUSE OF THE P2L ENHANCEMENT TO RE-OPEN    *27470000
274800*    AN UPLOADED DISTRIBUTION FOR FURTHER PROCESSING             *27480000
274900*----------------------------------------------------------------*27490000
275000 1395-CHECK-FOR-PREV-UPLOAD.                                      27500000
275100                                                                  27510000
275300     IF  PV-TEST-CICS                                             27530000
275400         INITIALIZE PV-CICS-MSG-AREA                              27540000
275500         STRING ' PCKCS722 - 1395-CHECK-FOR-PREV-UPLOAD'          27550000
275600                DELIMITED BY SIZE                                 27560000
275700           INTO PV-CICS-MSG-AREA                                  27570000
275800         PERFORM 9990-WRITE-CICS                                  27580000
275900     END-IF.                                                      27590000
276100                                                                  27610000
276200     PERFORM                                                      27620000
276300         WITH TEST AFTER                                          27630000
276400         VARYING PV-RETRY-COUNTER                                 27640000
276500         FROM 1 BY 1                                              27650000
276600         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                27660000
276700             OR (SQLCODE = +100)                                  27670037
276710             OR (SQLCODE = +0)                                    27671037
276800                                                                  27680037
276900         MOVE  ZEROES  TO  PV-DB2-COUNT                           27690037
277000                                                                  27700037
277100         EXEC SQL                                                 27710037
277200              SELECT RSLTS_RCVD_TMST                              27720037
277300                    ,OPER_UNT_ID                                  27730037
277400                INTO :PV-PREV-UPLOAD-TMST                         27740037
277500                    ,:DK-DISTHD-OPER                              27750037
277600                FROM TDISTHD                                      27760037
277700               WHERE ORD_NBR             = :DK-ORD-NBR            27770037
277800                 AND RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR        27780037
277900                 AND ORD_LNE_NBR         = :DK-ORD-LNE-NBR        27790037
278000                 AND WRK_ORD_SEQ_NBR     = :DK-WRK-ORD-SEQ-NBR    27800037
278100         END-EXEC                                                 27810037
278200                                                                  27820037
278300                                                                  27830037
278400         EVALUATE TRUE                                            27840037
278500             WHEN SQLCODE = ZERO                                  27850037
278600             WHEN SQLCODE = -904                                  27860037
278700             WHEN SQLCODE = -911                                  27870037
278800             WHEN SQLCODE = -913                                  27880037
278900                 CONTINUE                                         27890037
278910             WHEN SQLCODE = +100                                  27891037
278911* dmh                                                             27891147
278912                  PERFORM 1700-CHECK-RCVR-THSND                   27891247
278913                  IF  PS-RCVR-THSND                               27891347
278914                      PERFORM 1397-GET-RCVR-OPER                  27891447
278915                      MOVE RECEIV-OPER-UNT-ID                     27891547
278916                                           TO UPLDER-OPER-UNT-ID  27891647
278917                      mOVE 'K'             TO UPLDER-UPLD-TRN-CDE 27891747
278918                      MOVE '002'           TO UPLDER-ERR-CDE      27891847
278919                      MOVE 0               TO UPLDER-UPLD-SEQ-NBR 27891947
278920                      MOVE DK-REC-SEQ-NBR-THSND                   27892048
278921                                           TO PV-DISP-THSND-REC   27892148
278922                      MOVE SPACES          TO UPLDER-PKT-TXT      27892248
278923                      STRING PC186-STATUS-RECORD                  27892350
278924                             PV-DISP-THSND-REC DELIMITED BY SIZE  27892448
278926                                         INTO UPLDER-PKT-TXT      27892648
278927                      PERFORM 1396-INSERT-TUPLDER                 27892748
278928                  ELSE                                            27892847
278929* dmh                                                             27892947
278930                      PERFORM 1397-GET-RCVR-OPER                  27893047
278931                      MOVE RECEIV-OPER-UNT-ID                     27893147
278932                                           TO UPLDER-OPER-UNT-ID  27893247
278933                      mOVE 'K'             TO UPLDER-UPLD-TRN-CDE 27893347
278934                      MOVE '001'           TO UPLDER-ERR-CDE      27893447
278935                      MOVE 0               TO UPLDER-UPLD-SEQ-NBR 27893547
278936                      MOVE PC186-STATUS-RECORD                    27893647
278937                                           tO UPLDER-PKT-TXT      27893747
278938                      PERFORM 1396-INSERT-TUPLDER                 27893847
278939                      SET  PS-TDISTHD-ERROR   TO  TRUE            27893947
278940                  END-IF                                          27894047
278950                                                                  27895047
279000             WHEN SQLWARN0 NOT = SPACES                           27900037
279100             WHEN SQLCODE < ZERO                                  27910037
279200             WHEN SQLCODE > ZERO                                  27920037
279300                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              27930051
279400                 PERFORM 1500-CLOSE-SOCKET                        27940037
279500                 MOVE '1395-CHECK-FOR-PREV-UPLOAD'                27950037
279600                                   TO DP013-PARAGRAPH             27960037
279700                 MOVE 'UNABLE TO SELECT TDISTHD DATA '            27970037
279800                                   TO DP013-MESSAGE-TEXT (1)      27980037
279900                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            27990037
280000                 MOVE DK-REC-SEQ-NBR                              28000037
280100                                   TO PV-ERROR-RCVR-SEQ-NBR       28010037
280200                 MOVE DK-ORD-LNE-NBR                              28020037
280300                                   TO PV-ERROR-ORD-LNE-NBR        28030037
280400                 STRING ' RCVR: '            DELIMITED BY SIZE    28040037
280500                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    28050037
280600                      '-'                    DELIMITED BY SIZE    28060037
280700                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    28070037
280800                      '  LINE: '             DELIMITED BY SIZE    28080037
280900                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    28090037
281000                                 INTO DP013-MESSAGE-TEXT (2)      28100037
281100                 MOVE SQLCA        TO DP013-SQLCA                 28110037
281200                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    28120037
281300                 SET DP013-ROLLBACK                               28130037
281400                     DP013-DB2-ABEND                              28140037
281500                                   TO TRUE                        28150037
281600                 PERFORM 9999-WRITE-CICS-LOG-MSG                  28160037
281700         END-EVALUATE                                             28170037
281800     END-PERFORM.                                                 28180037
281900                                                                  28190037
282000     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  28200037
282100         (SQLCODE NOT = +100) AND                                 28210040
282110         (SQLCODE NOT = +0)                                       28211037
282200         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      28220051
282300         PERFORM 1500-CLOSE-SOCKET                                28230037
282400         MOVE '1395-CHECK-FOR-PREV-UPLOAD'                        28240037
282500                                  TO DP013-PARAGRAPH              28250037
282600         MOVE 'MAX RETRIES EXCEEDED ON TDISTHD SELECT'            28260037
282700                                  TO DP013-MESSAGE-TEXT (1)       28270037
282800         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             28280037
282900         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        28290037
283000         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         28300037
283100         STRING ' RCVR: '            DELIMITED BY SIZE            28310037
283200              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            28320037
283300              '-'                    DELIMITED BY SIZE            28330037
283400              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            28340037
283500              '  LINE: '             DELIMITED BY SIZE            28350037
283600              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            28360037
283700                                INTO DP013-MESSAGE-TEXT (2)       28370037
283800         MOVE SQLCA               TO DP013-SQLCA                  28380037
283900         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     28390037
284000         SET DP013-DB2-ABEND                                      28400037
284100             DP013-ROLLBACK       TO TRUE                         28410037
284200         PERFORM 9999-WRITE-CICS-LOG-MSG                          28420037
284300     END-IF.                                                      28430037
284600                                                                  28460037
284601*----------------------------------------------------------------*28460137
284602* TDISTHD INFO HAS PURGED FROM DATABASE                          *28460237
284603* WRITE INFO TO TUPLDER TABLE                                    *28460337
284604*----------------------------------------------------------------*28460437
284610 1396-INSERT-TUPLDER.                                             28461037
284611                                                                  28461137
284612     IF  PV-TEST-CICS                                             28461237
284613         INITIALIZE PV-CICS-MSG-AREA                              28461337
284614         STRING ' PCKCS722 - 1396-INSERT-TUPLDER       '          28461437
284615                DELIMITED BY SIZE                                 28461537
284616           INTO PV-CICS-MSG-AREA                                  28461637
284617         PERFORM 9990-WRITE-CICS                                  28461737
284618     END-IF.                                                      28461837
284619                                                                  28461937
284701     EXEC SQL                                                     28470137
284702          INSERT                                                  28470237
284703          INTO  TUPLDER                                           28470337
284704               (OPER_UNT_ID                                       28470437
284705               ,UPLD_TRN_CDE                                      28470537
284706               ,ERR_CDE                                           28470637
284707               ,PRC_TMST                                          28470737
284708               ,UPLD_SEQ_NBR                                      28470837
284709               ,PKT_TXT                                           28470937
284710               )                                                  28471037
284713        VALUES                                                    28471337
284714              (:UPLDER-OPER-UNT-ID                                28471437
284715              ,:UPLDER-UPLD-TRN-CDE                               28471537
284716              ,:UPLDER-ERR-CDE                                    28471637
284717              , current timestamp                                 28471737
284718              ,:UPLDER-UPLD-SEQ-NBR                               28471837
284719              ,:UPLDER-PKT-TXT                                    28471937
284720               )                                                  28472037
284723     END-EXEC.                                                    28472337
284724                                                                  28472437
284725     EVALUATE TRUE                                                28472537
284726         WHEN SQLCODE = ZERO                                      28472637
284727         WHEN SQLCODE = -904                                      28472737
284728         WHEN SQLCODE = -911                                      28472837
284729         WHEN SQLCODE = -913                                      28472937
284730             continue                                             28473037
284731         when SQLWARN0 NOT = SPACES                               28473137
284732         WHEN SQLCODE NOT EQUAL ZERO                              28473237
284735             MOVE '1396-INSERT-TUPLDER      '                     28473537
284736                               TO DP013-PARAGRAPH                 28473637
284737             MOVE 'insert into tuplder          '                 28473737
284738                               TO DP013-MESSAGE-TEXT (1)          28473837
284739             MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR                28473937
284740             MOVE DK-REC-SEQ-NBR                                  28474037
284741                               TO PV-ERROR-RCVR-SEQ-NBR           28474137
284742             MOVE DK-ORD-LNE-NBR                                  28474237
284743                               TO PV-ERROR-ORD-LNE-NBR            28474337
284744             MOVE DK-STR-NBR   TO PV-ERROR-STR-NBR                28474437
284745             STRING ' RCVR: '            DELIMITED BY SIZE        28474537
284746                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        28474637
284747                  '-'                    DELIMITED BY SIZE        28474737
284748                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        28474837
284749                  '  LINE: '             DELIMITED BY SIZE        28474937
284750                  PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE        28475037
284751                  '  STORE: '            DELIMITED BY SIZE        28475137
284752                  PV-ERROR-STR-NBR       DELIMITED BY SIZE        28475237
284753                             INTO DP013-MESSAGE-TEXT (2)          28475337
284754              MOVE SQLCA       TO DP013-SQLCA                     28475437
284755              MOVE 'TUPLDER'   TO DP013-DB2-TABLE-NAME (1)        28475537
284756              SET DP013-DB2-ABEND                                 28475637
284757                  PS-UPLOAD-ERROR                                 28475737
284758                  DP013-ROLLBACK                                  28475837
284759                               TO TRUE                            28475937
284760              PERFORM 9999-WRITE-CICS-LOG-MSG                     28476037
284761     END-EVALUATE.                                                28476137
284770                                                                  28477037
284780                                                                  28478037
284781*----------------------------------------------------------------*28478139
284782* GET THE OPER FOR THE RECEIVER THAT HAS PURGED FROM TDISTHD     *28478239
284784*----------------------------------------------------------------*28478439
284790 1397-GET-RCVR-OPER.                                              28479039
284791                                                                  28479139
284792     IF  PV-TEST-CICS                                             28479239
284793         INITIALIZE PV-CICS-MSG-AREA                              28479339
284794         STRING ' PCKCS722 - 1397-GET-RCVR-OPER'                  28479439
284795                DELIMITED BY SIZE                                 28479539
284796           INTO PV-CICS-MSG-AREA                                  28479639
284797         PERFORM 9990-WRITE-CICS                                  28479739
284798     END-IF.                                                      28479839
284799                                                                  28479939
284808     EXEC SQL                                                     28480839
284809          SELECT OPER_UNT_ID                                      28480939
284811            INTO :RECEIV-OPER-UNT-ID                              28481139
284813            FROM TRECEIV                                          28481339
284814           WHERE ORD_NBR       = :DK-ORD-NBR                      28481439
284815             AND REC_SEQ_NBR   = :DK-REC-SEQ-NBR                  28481539
284816     END-EXEC                                                     28481639
284817                                                                  28481739
284818     EVALUATE TRUE                                                28481839
284819         WHEN SQLCODE = +0                                        28481939
284820         WHEN SQLCODE = -904                                      28482039
284821         WHEN SQLCODE = -911                                      28482139
284822         WHEN SQLCODE = -913                                      28482239
284823              CONTINUE                                            28482339
284824                                                                  28482439
284825         WHEN SQLWARN0 NOT = SPACES                               28482539
284826         WHEN SQLCODE < +0                                        28482639
284827         WHEN SQLCODE > +0                                        28482739
284830              MOVE ' 1397-GET-RCVR-OPER '                         28483039
284831                              TO DP013-PARAGRAPH                  28483139
284832              MOVE 'UNSUCCESSFUL SELECT OF TRECEIV'               28483239
284833                              TO DP013-MESSAGE-TEXT (1)           28483339
284834              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 28483439
284835              MOVE DK-REC-SEQ-NBR                                 28483539
284836                              TO PV-ERROR-RCVR-SEQ-NBR            28483639
284837              STRING ' RCVR: '            DELIMITED BY SIZE       28483739
284838                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       28483839
284839                   '-'                    DELIMITED BY SIZE       28483939
284840                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       28484039
284841                            INTO DP013-MESSAGE-TEXT (2)           28484139
284842              MOVE SQLCA      TO DP013-SQLCA                      28484239
284843              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)         28484339
284844              SET DP013-DB2-ABEND                                 28484439
284845                  DP013-NO-ROLLBACK                               28484539
284846                              TO TRUE                             28484639
284847              PERFORM 9999-WRITE-CICS-LOG-MSG                     28484739
284848     END-EVALUATE.                                                28484839
284850                                                                  28485039
284892                                                                  28489239
284893                                                                  28489339
284894*----------------------------------------------------------------*28489437
284900*    SEND A CONFIRMATION RECORD TO THE PACK TO LIGHT SYSTEM TO   *28490037
285000*    POSITIVELY ACKNOWLEDGE THE RECEIPT OF A RECORD FROM THEM.   *28500037
285100*----------------------------------------------------------------*28510037
285200 1400-SEND-CONFIRMATION-P2L.                                      28520051
285300                                                                  28530037
285500     IF  PV-TEST-CICS                                             28550037
285600         INITIALIZE PV-CICS-MSG-AREA                              28560037
285700         STRING ' PCKCS722 - 1400-SEND-CONFIRMATION-P2L'          28570051
285800                DELIMITED BY SIZE                                 28580037
285900           INTO PV-CICS-MSG-AREA                                  28590037
286000         PERFORM 9990-WRITE-CICS                                  28600037
286100     END-IF.                                                      28610037
286300                                                                  28630037
286400     MOVE SPACES              TO TCP-BUF-AREA.                    28640037
286500     SET PC186-STATUS-CONFIRM TO TRUE                             28650037
286600     MOVE ';'                 TO PC186-CFM-TERM-CHAR              28660037
286700     MOVE PC186-STATUS-RECORD TO TCP-BUF-AREA                     28670037
286800     MOVE PC186-DL-CONFIRM    TO DP081-NBR-BYTES                  28680037
286900                                 DP081-TCPLENG.                   28690037
287000                                                                  28700037
287100* TRANSLATE EBCDIC TO ASCII                                       28710037
287200     CALL 'EZACIC04'                                              28720037
287300         USING  DP081-TOASCII-TOKEN                               28730037
287400                TCP-BUF-AREA                                      28740037
287500                DP081-TCPLENG.                                    28750037
287600                                                                  28760037
287700* WRITE DATA ON A CONNECTED SOCKET                                28770037
287800     CALL 'EZASOKET'                                              28780037
287900         USING                                                    28790037
288000                DP081-WRITE-CMD                                   28800037
288100                DP081-SOCK-ID                                     28810037
288200                DP081-NBR-BYTES                                   28820037
288300                TCP-BUF-AREA                                      28830037
288400                DP081-ERRNO                                       28840037
288500                DP081-RETCODE.                                    28850037
288600*                                                                 28860037
288700*                                                                 28870037
288800     IF DP081-RETCODE < ZERO                                      28880037
288900         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        28890037
289000         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    28900037
289100         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         28910037
289200         SET  DP013-OTHER-ABEND   TO TRUE                         28920037
289300         SET  DP013-NO-ROLLBACK   TO TRUE                         28930037
289400         MOVE '1400-SEND-CONFIRMATION-P2L'                        28940051
289500             TO DP013-PARAGRAPH                                   28950037
289600         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  28960037
289700         PERFORM 9999-WRITE-CICS-LOG-MSG                          28970037
289800     END-IF.                                                      28980037
289900/                                                                 28990037
290000*----------------------------------------------------------------*29000037
290100*    SEND AN ERROR CONFIRMATION RECORD TO THE PACK TO LIGHT      *29010037
290200*    SYSTEM, INDICATING THERE WAS AN ERROR WITH THE DATA WE      *29020037
290300*    RECEIVED FROM THEM.                                         *29030037
290400*----------------------------------------------------------------*29040037
290500 1410-SEND-ERROR-CONFIRM-P2L.                                     29050051
290600                                                                  29060037
290800     IF  PV-TEST-CICS                                             29080037
290900         INITIALIZE PV-CICS-MSG-AREA                              29090037
291000         STRING ' PCKCS722 - 1410-SEND-ERROR-CONFIRM-P2L'         29100051
291100                DELIMITED BY SIZE                                 29110037
291200           INTO PV-CICS-MSG-AREA                                  29120037
291300         PERFORM 9990-WRITE-CICS                                  29130037
291400     END-IF.                                                      29140037
291600                                                                  29160037
291700     MOVE SPACES              TO TCP-BUF-AREA                     29170037
291800     SET PC186-STATUS-CONFIRM-ERROR                               29180037
291900                              TO TRUE                             29190037
292000     MOVE ';'                 TO PC186-CFM-TERM-CHAR              29200037
292100     MOVE PC186-STATUS-RECORD TO TCP-BUF-AREA                     29210037
292200     MOVE PC186-DL-ERROR   TO    DP081-NBR-BYTES                  29220037
292300                                 DP081-TCPLENG.                   29230037
292400                                                                  29240037
292500* TRANSLATE EBCDIC TO ASCII                                       29250037
292600     CALL 'EZACIC04'                                              29260037
292700         USING  DP081-TOASCII-TOKEN                               29270037
292800                TCP-BUF-AREA                                      29280037
292900                DP081-TCPLENG.                                    29290037
293000                                                                  29300037
293100* WRITE DATA ON A CONNECTED SOCKET                                29310037
293200     CALL 'EZASOKET'                                              29320037
293300         USING                                                    29330037
293400                DP081-WRITE-CMD                                   29340037
293500                DP081-SOCK-ID                                     29350037
293600                DP081-NBR-BYTES                                   29360037
293700                TCP-BUF-AREA                                      29370037
293800                DP081-ERRNO                                       29380037
293900                DP081-RETCODE.                                    29390037
294000*                                                                 29400037
294100     IF DP081-RETCODE < ZERO                                      29410037
294200         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        29420037
294300         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    29430037
294400         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         29440037
294500         SET  DP013-OTHER-ABEND   TO TRUE                         29450037
294600         SET  DP013-NO-ROLLBACK   TO TRUE                         29460037
294700         MOVE '1410-SEND-ERROR-CONFIRM-P2L'                       29470051
294800             TO DP013-PARAGRAPH                                   29480037
294900         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  29490037
295000         PERFORM 9999-WRITE-CICS-LOG-MSG                          29500037
295100     END-IF.                                                      29510037
295200/                                                                 29520037
295300*----------------------------------------------------------------*29530037
295400*    CLOSE THE SOCKET GIVEN TO US BY THE PACK TO LIGHT SYSTEM.   *29540037
295500*----------------------------------------------------------------*29550037
295600 1500-CLOSE-SOCKET.                                               29560037
295700                                                                  29570037
295900     IF  PV-TEST-CICS                                             29590037
296000         INITIALIZE PV-CICS-MSG-AREA                              29600037
296100         STRING ' PCKCS722 - 1500-CLOSE-SOCKET'                   29610037
296200                DELIMITED BY SIZE                                 29620037
296300           INTO PV-CICS-MSG-AREA                                  29630037
296400         PERFORM 9990-WRITE-CICS                                  29640037
296500     END-IF.                                                      29650037
296700                                                                  29670037
296800* CLOSE THE CONNECTED SOCKET                                      29680037
296900     CALL 'EZASOKET'                                              29690037
297000         USING                                                    29700037
297100                DP081-CLOSE-CMD                                   29710037
297200                DP081-SOCK-ID                                     29720037
297300                DP081-ERRNO                                       29730037
297400                DP081-RETCODE.                                    29740037
297500                                                                  29750037
297600     IF DP081-RETCODE < ZERO                                      29760037
297700         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        29770037
297800         SET  DP081-TCP-IP-CLOSE-ERR TO TRUE                      29780037
297900         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         29790037
298000         SET  DP013-OTHER-ABEND   TO TRUE                         29800037
298100         SET  DP013-NO-ROLLBACK   TO TRUE                         29810037
298200         MOVE '1500-CLOSE-SOCKET'                                 29820037
298300             TO DP013-PARAGRAPH                                   29830037
298400         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  29840037
298500         PERFORM 9999-WRITE-CICS-LOG-MSG                          29850037
298600     END-IF.                                                      29860037
298700/                                                                 29870037
298800*----------------------------------------------------------------*29880037
298900*    STOP THE WORK ORDER INSTRUCTION FOR THIS LINE ON THE        *29890037
299000*    SPECIFIED RECEIVER. (THIS IS IN THE PLANNING PROCESS)       *29900037
299100*----------------------------------------------------------------*29910037
299200 1600-STOP-P2L-WORK-ORDER.                                        29920037
299300                                                                  29930037
299500     IF  PV-TEST-CICS                                             29950037
299600         INITIALIZE PV-CICS-MSG-AREA                              29960037
299700         STRING ' PCKCS722 - 1600-STOP-P2L-WORK-ORDER'            29970037
299800                DELIMITED BY SIZE                                 29980037
299900           INTO PV-CICS-MSG-AREA                                  29990037
300000         PERFORM 9990-WRITE-CICS                                  30000037
300100     END-IF.                                                      30010037
300300                                                                  30030037
300400     EXIT.                                                        30040037
300500                                                                  30050037
300600                                                                  30060037
300610*----------------------------------------------------------------*30061047
300620*    CHECK TDISTHD TO SEE IF the receiver number was actually    *30062047
300630*    truncated.                                                  *30063047
300640*    Example:  rcvr from P2L is 234 but should be 1234           *30064047
300650*----------------------------------------------------------------*30065047
300651 1700-CHECK-RCVR-THSND.                                           30065147
300670                                                                  30067047
300680     IF  PV-TEST-CICS                                             30068047
300690         INITIALIZE PV-CICS-MSG-AREA                              30069047
300691         STRING ' PCKCS722 - 1700-CHECK-RCVR-THSND'               30069147
300692                DELIMITED BY SIZE                                 30069247
300693           INTO PV-CICS-MSG-AREA                                  30069347
300694         PERFORM 9990-WRITE-CICS                                  30069447
300695     END-IF.                                                      30069547
300696                                                                  30069647
300697     move DK-REC-SEQ-NBR  to  DK-REC-SEQ-NBR-THSND.               30069747
300698     add 1000             to  DK-REC-SEQ-NBR-THSND.               30069847
300699                                                                  30069947
300700     PERFORM                                                      30070047
300701         WITH TEST AFTER                                          30070147
300702         VARYING PV-RETRY-COUNTER                                 30070247
300703         FROM 1 BY 1                                              30070347
300704         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                30070447
300705             OR (SQLCODE = +100)                                  30070547
300706             OR (SQLCODE = +0)                                    30070647
300707                                                                  30070747
300708         MOVE  ZEROES  TO  PV-DB2-COUNT                           30070847
300709                                                                  30070947
300710         EXEC SQL                                                 30071047
300711              SELECT RSLTS_RCVD_TMST                              30071147
300712                    ,OPER_UNT_ID                                  30071247
300713                INTO :PV-PREV-UPLOAD-TMST                         30071347
300714                    ,:DK-DISTHD-OPER                              30071447
300715                FROM TDISTHD                                      30071547
300716               WHERE ORD_NBR             = :DK-ORD-NBR            30071647
300717                 AND RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR-THSND  30071747
300718                 AND ORD_LNE_NBR         = :DK-ORD-LNE-NBR        30071847
300719                 AND WRK_ORD_SEQ_NBR     = :DK-WRK-ORD-SEQ-NBR    30071947
300720                with ur                                           30072047
300721         END-EXEC                                                 30072147
300722                                                                  30072247
300723                                                                  30072347
300724         EVALUATE TRUE                                            30072447
300725             WHEN SQLCODE = ZERO                                  30072547
300726                 SET  PS-RCVR-THSND  TO  TRUE                     30072647
300727                 MOVE DK-REC-SEQ-NBR-THSND  TO  DK-REC-SEQ-NBR    30072747
300728                                                                  30072847
300729             WHEN SQLCODE = -904                                  30072947
300730             WHEN SQLCODE = -911                                  30073047
300731             WHEN SQLCODE = -913                                  30073147
300732                 CONTINUE                                         30073247
300733             WHEN SQLCODE = +100                                  30073347
300734                 SET  PS-RCVR-THSND-NO  TO  TRUE                  30073447
300735                                                                  30073547
300738             WHEN SQLWARN0 NOT = SPACES                           30073847
300739             WHEN SQLCODE < ZERO                                  30073947
300740             WHEN SQLCODE > ZERO                                  30074047
300741                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              30074151
300742                 PERFORM 1500-CLOSE-SOCKET                        30074247
300743                 MOVE '1700-CHECK-RCVR-THSND     '                30074347
300744                                   TO DP013-PARAGRAPH             30074447
300745                 MOVE 'UNABLE TO SELECT TDISTHD DATA '            30074547
300746                                   TO DP013-MESSAGE-TEXT (1)      30074647
300747                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            30074747
300748                 MOVE DK-REC-SEQ-NBR-THSND                        30074847
300749                                   TO PV-ERROR-RCVR-SEQ-NBR       30074947
300750                 MOVE DK-ORD-LNE-NBR                              30075047
300751                                   TO PV-ERROR-ORD-LNE-NBR        30075147
300752                 STRING ' RCVR: '            DELIMITED BY SIZE    30075247
300753                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    30075347
300754                      '-'                    DELIMITED BY SIZE    30075447
300755                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    30075547
300756                      '  LINE: '             DELIMITED BY SIZE    30075647
300757                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    30075747
300758                                 INTO DP013-MESSAGE-TEXT (2)      30075847
300759                 MOVE SQLCA        TO DP013-SQLCA                 30075947
300760                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    30076047
300761                 SET DP013-ROLLBACK                               30076147
300762                     DP013-DB2-ABEND                              30076247
300763                                   TO TRUE                        30076347
300764                 PERFORM 9999-WRITE-CICS-LOG-MSG                  30076447
300765         END-EVALUATE                                             30076547
300766     END-PERFORM.                                                 30076647
300767                                                                  30076747
300768     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  30076847
300769         (SQLCODE NOT = +100) AND                                 30076947
300770         (SQLCODE NOT = +0)                                       30077047
300771         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      30077151
300772         PERFORM 1500-CLOSE-SOCKET                                30077247
300773         MOVE '1700-CHECK-RCVR-THSND     '                        30077347
300774                                  TO DP013-PARAGRAPH              30077447
300775         MOVE 'MAX RETRIES EXCEEDED ON TDISTHD SELECT'            30077547
300776                                  TO DP013-MESSAGE-TEXT (1)       30077647
300777         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             30077747
300778         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        30077847
300779         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         30077947
300780         STRING ' RCVR: '            DELIMITED BY SIZE            30078047
300781              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            30078147
300782              '-'                    DELIMITED BY SIZE            30078247
300783              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            30078347
300784              '  LINE: '             DELIMITED BY SIZE            30078447
300785              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            30078547
300786                                INTO DP013-MESSAGE-TEXT (2)       30078647
300787         MOVE SQLCA               TO DP013-SQLCA                  30078747
300788         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     30078847
300789         SET DP013-DB2-ABEND                                      30078947
300790             DP013-ROLLBACK       TO TRUE                         30079047
300791         PERFORM 9999-WRITE-CICS-LOG-MSG                          30079147
300792     END-IF.                                                      30079247
300793                                                                  30079347
300794* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 30079437
300800*  added Select socket command to check if socket connection    * 30080037
300900*  is still active.  if return code > 0 then socket is active   * 30090037
301000*  if return code = 0 socket is no longer active.               * 30100037
301200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 30120037
301300 2950-CHECK-SOCKET-CONNECTION.                                    30130037
301400                                                                  30140037
301500     IF  PV-TEST-CICS                                             30150037
301600         INITIALIZE PV-CICS-MSG-AREA                              30160037
301700         STRING ' PCKCS722 - 2950-CHECK-SOCKET-CONNECTION'        30170037
301800                DELIMITED BY SIZE                                 30180037
301900           INTO PV-CICS-MSG-AREA                                  30190037
302000         PERFORM 9990-WRITE-CICS                                  30200037
302100     END-IF.                                                      30210037
302200                                                                  30220037
302300     INITIALIZE  PV-CICS-MSG-AREA.                                30230037
302400     STRING 'PCKCS722 - 2950-CHECK-SOCKET-CONNECT'                30240037
302500                                              DELIMITED BY SIZE   30250037
302600                                         INTO PV-CICS-MSG-AREA.   30260037
302700     PERFORM 9995-WRITE-CICS.                                     30270037
302800                                                                  30280037
302900* ZERO OUT ALL OUTPUT BIT MASKS FOR SELECT                        30290037
303000     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    30300037
303100        MOVE '0' TO CHAR-ENTRY(SOCKNO)                            30310037
303200     END-PERFORM.                                                 30320037
303300     PERFORM 2960-CHAR-TO-BIT.                                    30330037
303400                                                                  30340037
303500        INITIALIZE                       PV-CICS-MSG-AREA         30350037
303600        MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO         30360037
303700        MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS        30370037
303800        STRING ' PCKCS722- 2950-'                                 30380037
303900               '  SOCKNO='   PV-DISPLAY-SOCKNO                    30390037
304000               '  SOCKETS='  PV-DISPLAY-SOCKETS                   30400037
304100                                         DELIMITED BY SIZE        30410037
304200                                    INTO PV-CICS-MSG-AREA         30420037
304300        MOVE LENGTH OF PV-CICS-MSG-AREA                           30430037
304400                                      TO PV-COMMAREA-LENGTH       30440037
304500                                                                  30450037
304600     PERFORM 9995-WRITE-CICS.                                     30460037
304700                                                                  30470037
304800     MOVE BIT-MASK TO SELECT-RR-MASK.                             30480037
304900     MOVE BIT-MASK TO SELECT-RW-MASK.                             30490037
305000     MOVE BIT-MASK TO SELECT-RE-MASK.                             30500037
305100     MOVE BIT-MASK TO SELECT-EX-MASK.                             30510037
305200     MOVE BIT-MASK TO SELECT-WR-MASK.                             30520037
305300                                                                  30530037
305400* set all input bit masks for select to 1                         30540037
305500     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    30550037
305600        MOVE '1' TO CHAR-ENTRY(SOCKNO)                            30560037
305700     END-PERFORM.                                                 30570037
305800     PERFORM 2960-CHAR-TO-BIT.                                    30580037
305900     MOVE BIT-MASK TO SELECT-RD-MASK.                             30590037
306000                                                                  30600037
306100     INITIALIZE                       PV-CICS-MSG-AREA            30610037
306200     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            30620037
306300     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           30630037
306400     STRING ' PCKCS722- 2950-'                                    30640037
306500            '  SOCKNO='   PV-DISPLAY-SOCKNO                       30650037
306600            '  SOCKETS='  PV-DISPLAY-SOCKETS                      30660037
306700                                      DELIMITED BY SIZE           30670037
306800                                 INTO PV-CICS-MSG-AREA            30680037
306900     MOVE LENGTH OF PV-CICS-MSG-AREA                              30690037
307000                                   TO PV-COMMAREA-LENGTH          30700037
307100     PERFORM 9995-WRITE-CICS.                                     30710037
307200                                                                  30720037
307300*                                                                 30730037
307400* ISSUE THE SELECT COMMAND ----------------------------           30740037
307500* SELECT WILL FLIP A BIT IN THE READ MASK TO '1' FOR ANY          30750037
307600* SOCKET THAT HAS DATA TO BE PROCESSED.                           30760037
307700*                                                                 30770037
307800                                                                  30780037
307900     MOVE 0 TO DP081-ERRNO.                                       30790037
308000     MOVE 0 TO DP081-RETCODE.                                     30800037
308100     CALL 'EZASOKET' USING DP081-SELECT-CMD                       30810037
308200         SELECT-NUMFDS SELECT-TIMEOUT                             30820037
308300         SELECT-RD-MASK SELECT-WR-MASK SELECT-EX-MASK             30830037
308400         SELECT-RR-MASK SELECT-RW-MASK SELECT-RE-MASK             30840037
308500         DP081-ERRNO DP081-RETCODE.                               30850037
308600                                                                  30860037
308700                                                                  30870037
308800     INITIALIZE                       PV-CICS-MSG-AREA            30880037
308900     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            30890037
309000     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           30900037
309100     STRING ' PCKCS722- 2950-'                                    30910037
309200            '  RD-MASK=' SELECT-RD-MASK                           30920037
309300            '  WR-MASK=' SELECT-WR-MASK                           30930037
309400            '  EX-MASK=' SELECT-EX-MASK                           30940037
309500                                      DELIMITED BY SIZE           30950037
309600                                 INTO PV-CICS-MSG-AREA            30960037
309700     MOVE LENGTH OF PV-CICS-MSG-AREA                              30970037
309800                                   TO PV-COMMAREA-LENGTH          30980037
309900     PERFORM 9995-WRITE-CICS.                                     30990037
310000                                                                  31000037
310100     INITIALIZE                       PV-CICS-MSG-AREA            31010037
310200     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            31020037
310300     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           31030037
310400     STRING ' PCKCS722  2950-'                                    31040037
310500            '  RR-MASK=' SELECT-RR-MASK                           31050037
310600            '  RW-MASK=' SELECT-RW-MASK                           31060037
310700            '  RE-MASK=' SELECT-RE-MASK                           31070037
310800            '  BIT-MASK=' BIT-MASK                                31080037
310900                                      DELIMITED BY SIZE           31090037
311000                                 INTO PV-CICS-MSG-AREA            31100037
311100     MOVE LENGTH OF PV-CICS-MSG-AREA                              31110037
311200                                   TO PV-COMMAREA-LENGTH          31120037
311300     PERFORM 9995-WRITE-CICS.                                     31130037
311400                                                                  31140037
311500                                                                  31150037
311600     IF DP081-RETCODE < 0                                         31160037
311700         INITIALIZE  PV-CICS-MSG-AREA                             31170037
311800         SET  PS-SOCKET-ERROR        TO TRUE                      31180037
311900         MOVE 'PCKCS722'              TO DP081-TCP-IP-PGM-NAME    31190037
312000         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    31200037
312100         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      31210037
312200                                        SOCKET-ERRNO              31220037
312300         MOVE DP081-RETCODE          TO SOCKET-RETCODE            31230037
312400         MOVE PC186-STATUS-RECORD     TO SOCKET-MESSAGE           31240037
312500         MOVE 'SEE ERROR NBR '       TO SOCKET-DESCR              31250037
312600         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          31260037
312700         PERFORM 9995-WRITE-CICS                                  31270037
312800                                                                  31280037
312900         INITIALIZE  PV-CICS-MSG-AREA                             31290037
313000         STRING ' PCKCS722 -'                                     31300037
313100                 PC186-STATUS-RECORD                              31310037
313200                                         DELIMITED BY SIZE        31320037
313300                                     INTO PV-CICS-MSG-AREA        31330037
313400         PERFORM 9995-WRITE-CICS                                  31340037
313500                                                                  31350037
313600         INITIALIZE  PV-CICS-MSG-AREA                             31360037
313700         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      31370037
313800         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        31380037
313900         PERFORM 9995-WRITE-CICS                                  31390037
314000                                                                  31400037
314100     END-IF.                                                      31410037
314200                                                                  31420037
314300     IF DP081-RETCODE = 0                                         31430037
314400         INITIALIZE  PV-CICS-MSG-AREA                             31440037
314500         SET  PS-SOCKET-ERROR        TO TRUE                      31450037
314600         MOVE 'PCKCS722'              TO DP081-TCP-IP-PGM-NAME    31460037
314700         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    31470037
314800         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      31480037
314900                                        SOCKET-ERRNO              31490037
315000         MOVE DP081-RETCODE          TO SOCKET-RETCODE            31500037
315100         MOVE PC186-STATUS-RECORD    TO SOCKET-MESSAGE            31510037
315200         MOVE 'SOCKET TIMEOUT'       TO SOCKET-DESCR              31520037
315300                                                                  31530037
315400         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          31540037
315500         PERFORM 9995-WRITE-CICS                                  31550037
315600                                                                  31560037
315700         INITIALIZE  PV-CICS-MSG-AREA                             31570037
315800         STRING ' PCKCS722 -'            DELIMITED BY SIZE        31580037
315900                 PC186-STATUS-RECORD                              31590037
316000                                         DELIMITED BY SIZE        31600037
316100                                     INTO PV-CICS-MSG-AREA        31610037
316200         PERFORM 9995-WRITE-CICS                                  31620037
316300                                                                  31630037
316400         INITIALIZE  PV-CICS-MSG-AREA                             31640037
316500         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      31650037
316600         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        31660037
316700         PERFORM 9995-WRITE-CICS                                  31670037
316800                                                                  31680037
316900     END-IF.                                                      31690037
317000                                                                  31700037
317100***************************************************************   31710037
317200* CHAR-TO-BIT                                                 *   31720037
317300* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE*   31730037
317400* COBOL PROGRAM CAN WRITE IT.                                 *   31740037
317500***************************************************************   31750037
317600 2960-CHAR-TO-BIT.                                                31760037
317700                                                                  31770037
317800     IF  PV-TEST-CICS                                             31780037
317810         INITIALIZE PV-CICS-MSG-AREA                              31781037
317820         STRING ' PCKCS722 - 2960-CHAR-TO-BIT            '        31782037
317830                DELIMITED BY SIZE                                 31783037
317840           INTO PV-CICS-MSG-AREA                                  31784037
317850         PERFORM 9990-WRITE-CICS                                  31785037
317860     END-IF.                                                      31786037
317870                                                                  31787037
317880     INITIALIZE                       PV-CICS-MSG-AREA            31788037
317890     STRING ' PCKCS722- 2960-CHAR-TO-BIT              '           31789037
317900                                         DELIMITED BY SIZE        31790037
318000                                    INTO PV-CICS-MSG-AREA         31800037
318100     MOVE LENGTH OF PV-CICS-MSG-AREA                              31810037
318200                                      TO PV-COMMAREA-LENGTH       31820037
318300     PERFORM 9995-WRITE-CICS.                                     31830037
318400                                                                  31840037
318500* CHAR-TO-BIT                                                     31850037
318600* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE    31860037
318700* COBOL PROGRAM CAN WRITE IT.                                     31870037
318800*                                                                 31880037
318900     CALL 'EZACIC06' USING BITMASK-TOKEN CTOB                     31890037
319000          BIT-MASK CHAR-MASK BIT-MASK-LENGTH EZRETC               31900037
319100     IF  EZRETC < 0 THEN                                          31910037
319200         MOVE '!EZCIC06 - CTOB-EXCP ' TO PV-CICS-MSG-AREA         31920037
319300         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH    31930037
319400                                                                  31940037
319500         EXEC CICS                                                31950037
319600             WRITEQ TD                                            31960037
319700                 QUEUE   ('CSSL')                                 31970037
319800                 FROM    (PV-CICS-MSG-AREA)                       31980037
319900                 LENGTH  (PV-COMMAREA-LENGTH)                     31990037
320000                 RESP    (PV-CICS-RESPONSE)                       32000037
320100         END-EXEC                                                 32010037
320200                                                                  32020037
320300         INITIALIZE  PV-CICS-MSG-AREA                             32030037
320400         SET  PS-SOCKET-ERROR        TO TRUE                      32040037
320500         MOVE 'PCKCS722'              TO DP081-TCP-IP-PGM-NAME    32050037
320600         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    32060037
320700         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      32070037
320800                                        SOCKET-ERRNO              32080037
320900         MOVE DP081-RETCODE          TO SOCKET-RETCODE            32090037
321000         MOVE PC186-STATUS-RECORD    TO SOCKET-MESSAGE            32100037
321100         MOVE 'SEE ERROR NO '        TO SOCKET-DESCR              32110037
321200                                                                  32120037
321300         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          32130037
321400         PERFORM 9995-WRITE-CICS                                  32140037
321500                                                                  32150037
321600         INITIALIZE  PV-CICS-MSG-AREA                             32160037
321700         STRING ' PCKCS722 -'            DELIMITED BY SIZE        32170037
321800                 PC186-STATUS-RECORD                              32180037
321900                                         DELIMITED BY SIZE        32190037
322000                                     INTO PV-CICS-MSG-AREA        32200037
322100         PERFORM 9990-WRITE-CICS                                  32210037
322200         PERFORM 9995-WRITE-CICS                                  32220037
322300                                                                  32230037
322400         INITIALIZE  PV-CICS-MSG-AREA                             32240037
322500         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      32250037
322600         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        32260037
322700         PERFORM 9995-WRITE-CICS                                  32270037
322800                                                                  32280037
322900     END-IF.                                                      32290037
323000                                                                  32300037
323100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 32310037
323300                                                                  32330037
323400                                                                  32340037
323500*----------------------------------------------------------------*32350037
323600*    THIS PARAGRAPH WILL CONTROL THE RECEIVES TO CAPTURE ALL     *32360037
323700*    OF THE DATA BEING PASSED TO THE MAINFRAME FROM THE P2L      *32370051
323800*    SYSTEM.  THIS PARAGRAPH IS WRITTEN WITH THE UNDERSTANDING   *32380037
323900*    THAT A RECEIVE COMMAND MAY OR MAY NOT BRING BACK AN ENTIRE  *32390037
324000*    SOCKET PACKET OF DATA.  WE ARE EXPECTING A BLOCK OF 50      *32400037
324100*    CHARACTERS TO BE RECEIVED, HOWEVER, IF LESS THAN 50 ARE     *32410037
324200*    RECEIVED, THEN THIS PARAGRAPH WILL LOOP UNTIL THE ENTIRE    *32420037
324300*    FIFTY IS RECEIVED.                                          *32430037
324400*----------------------------------------------------------------*32440037
324500                                                                  32450037
324600 3000-RECEIVE-TCP.                                                32460037
324700                                                                  32470037
324900     IF  PV-TEST-CICS                                             32490037
325000         INITIALIZE PV-CICS-MSG-AREA                              32500037
325100         STRING ' PCKCS722 - 3000-RECEIVE-TCP'                    32510037
325200                DELIMITED BY SIZE                                 32520037
325300           INTO PV-CICS-MSG-AREA                                  32530037
325400         PERFORM 9990-WRITE-CICS                                  32540037
325500         PERFORM 9995-WRITE-CICS                                  32550037
325600     END-IF.                                                      32560037
325800                                                                  32580037
325900     MOVE SPACES                      TO  TCP-BUF-AREA            32590037
326000     MOVE ZERO                        TO PV-BUFFER-SUB            32600037
326100     SET PS-SOCKET-OPEN               TO TRUE.                    32610037
326200     MOVE PC186-DL-DETAIL             TO DP081-TCPLENG            32620037
326300     MOVE 1                           TO DP081-NBR-BYTES          32630037
326400                                                                  32640037
326500     PERFORM UNTIL TCP-BUF (PV-BUFFER-SUB) = PC-TERM-CHARACTER    32650037
326600                OR PS-SOCKET-CLOSED                               32660037
326700                                                                  32670037
326800     CALL 'EZASOKET'                                              32680037
326900         USING                                                    32690037
327000                DP081-RECV-CMD                                    32700037
327100                DP081-SOCK-ID                                     32710037
327200                DP081-FLAG                                        32720037
327300                DP081-NBR-BYTES                                   32730037
327400                TCP-BUF (PV-BUFFER-SUB + 1)                       32740037
327500                DP081-ERRNO                                       32750037
327600                DP081-RETCODE                                     32760037
327700                                                                  32770037
327800     EVALUATE TRUE                                                32780037
327900     WHEN DP081-RETCODE > ZERO                                    32790037
328000         ADD DP081-RETCODE            TO PV-BUFFER-SUB            32800037
328100     WHEN DP081-RETCODE < ZERO                                    32810037
328200         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      32820051
328300         PERFORM 1500-CLOSE-SOCKET                                32830037
328400         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        32840037
328500         SET  DP081-TCP-IP-READ-ERR TO TRUE                       32850037
328600         MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         32860037
328700         SET  DP013-OTHER-ABEND   TO TRUE                         32870037
328800         SET  DP013-NO-ROLLBACK   TO TRUE                         32880037
328900         MOVE '3000-RECEIVE-TCP'                                  32890037
329000             TO DP013-PARAGRAPH                                   32900037
329100         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  32910037
329200         PERFORM 9999-WRITE-CICS-LOG-MSG                          32920037
329300                                                                  32930037
329400     WHEN DP081-RETCODE = ZERO                                    32940037
329500             SET PS-SOCKET-CLOSED     TO TRUE                     32950037
329600             INITIALIZE PV-CICS-MSG-AREA                          32960037
329700             MOVE DP081-RETCODE TO PV-RETCODE                     32970037
329800             MOVE DP081-NBR-BYTES TO PV-TCPLENG                   32980037
329900             MOVE DP081-ERRNO   TO PV-ERRNO                       32990037
330000             STRING ' PCKCS722:'                                  33000037
330100                  'SOCKET ERROR EQ 0'                             33010037
330200                  ' RETCODE='                                     33020037
330300                  PV-RETCODE                                      33030037
330400                  ' TCPLENG='                                     33040037
330500                  PV-TCPLENG                                      33050037
330600                  ' ERRNO='                                       33060037
330700                  PV-ERRNO                                        33070037
330800                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA          33080037
330900             PERFORM 9990-WRITE-CICS                              33090037
331000             MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME    33100037
331100             SET  DP081-TCP-IP-READ-ERR TO TRUE                   33110037
331200             MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR     33120037
331300             SET  DP013-OTHER-ABEND   TO TRUE                     33130037
331400             SET  DP013-NO-ROLLBACK   TO TRUE                     33140037
331500             MOVE '3000-RECEIVE-TCP'                              33150037
331600                 TO DP013-PARAGRAPH                               33160037
331700             MOVE DP081-TCP-IP-LOGGING-MSG                        33170037
331800                                      TO DP013-MESSAGE-TEXT (1)   33180037
331900             PERFORM 9999-WRITE-CICS-LOG-MSG                      33190037
332000                                                                  33200037
332100     END-EVALUATE                                                 33210037
332200     END-PERFORM.                                                 33220037
332300                                                                  33230037
332400* BEGIN OF TRANSLATE ASCII TO EBCDIC                              33240037
332500     CALL 'EZACIC05'                                              33250037
332600          USING  DP081-TOEBCDIC-TOKEN                             33260037
332700                 TCP-BUF-AREA                                     33270037
332800                 DP081-TCPLENG.                                   33280037
332900* END OF TRANSLATE ASCII TO EBCDIC                                33290037
333000/                                                                 33300037
333100*----------------------------------------------------------------*33310037
333200* WHEN IT HAS BEEN DETERMINED THAT THE LINE IS PART OF A PREPK   *33320037
333300* ORDER.  THE OTHER LINES ASSOCIATED WITH THE PREPK (THAT WERE   *33330037
333400* NOT SENT TO P2L) NEED TO BE UPDATED ALSO. (TDISTHD)            *33340037
333500*----------------------------------------------------------------*33350037
333600 4000-PROCESS-PREPK.                                              33360037
333700                                                                  33370037
333900     IF  PV-TEST-CICS                                             33390037
334000         INITIALIZE PV-CICS-MSG-AREA                              33400037
334100         STRING ' PCKCS722 - 4000-PROCESS-PREPK'                  33410037
334200                DELIMITED BY SIZE                                 33420037
334300           INTO PV-CICS-MSG-AREA                                  33430037
334400         PERFORM 9990-WRITE-CICS                                  33440037
334500         PERFORM 9995-WRITE-CICS                                  33450037
334600     END-IF.                                                      33460037
334800                                                                  33480037
334900     SET  PS-PREPK-LINES-LEFT     TO  TRUE.                       33490037
335000     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            33500037
335100     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       33510037
335200     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          33520037
335300     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID.                33530037
335400                                                                  33540037
335500     PERFORM 4010-OPEN-PREPK-CSR.                                 33550037
335600     PERFORM 4015-FETCH-PREPK-CSR                                 33560037
335700       UNTIL PS-NO-PREPK-LINES-LEFT.                              33570037
335800     PERFORM 4020-CLOSE-PREPK-CSR.                                33580037
335900                                                                  33590037
336000                                                                  33600037
336100*----------------------------------------------------------------*33610037
336200* WHEN IT HAS BEEN DETERMINED THAT THE LINE IS PART OF A PREPK   *33620037
336300* ORDER.  THE OTHER LINES ASSOCIATED WITH THE PREPK (THAT WERE   *33630037
336400* NOT SENT TO P2L)                                               *33640037
336600*----------------------------------------------------------------*33660037
336700 4005-PROCESS-PREPK-REOPEN.                                       33670037
336800                                                                  33680037
337000     IF  PV-TEST-CICS                                             33700037
337100         INITIALIZE PV-CICS-MSG-AREA                              33710037
337200         STRING ' PCKCS722 - 4005-PROCESS-PREPK-REOPEN'           33720037
337300                '  PV-ALLOC-QTY=' PV-ALLOC-QTY                    33730037
337400                DELIMITED BY SIZE                                 33740037
337500           INTO PV-CICS-MSG-AREA                                  33750037
337600         PERFORM 9990-WRITE-CICS                                  33760037
337700         PERFORM 9995-WRITE-CICS                                  33770037
337800     END-IF.                                                      33780037
338000                                                                  33800037
338100     SET  PS-PREPK-LINES-LEFT     TO  TRUE.                       33810037
338200     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            33820037
338300     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       33830037
338400     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          33840037
338500     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID.                33850037
338600                                                                  33860037
338700     PERFORM 4010-OPEN-PREPK-CSR.                                 33870037
338800     PERFORM 4030-FETCH-PREPK-CSR-REOPEN                          33880037
338900       UNTIL PS-NO-PREPK-LINES-LEFT.                              33890037
339000     PERFORM 4020-CLOSE-PREPK-CSR.                                33900037
339100                                                                  33910037
339200                                                                  33920037
339300*----------------------------------------------------------------*33930037
339400* PRE-PACK ORDER - OPEN CURSOR                                   *33940037
339500*----------------------------------------------------------------*33950037
339600 4010-OPEN-PREPK-CSR.                                             33960037
339700                                                                  33970037
339900     IF  PV-TEST-CICS                                             33990037
340000         INITIALIZE PV-CICS-MSG-AREA                              34000037
340100         STRING ' PCKCS722 - 4010-OPEN-PREPK-CSR'                 34010037
340200                DELIMITED BY SIZE                                 34020037
340300           INTO PV-CICS-MSG-AREA                                  34030037
340400         PERFORM 9990-WRITE-CICS                                  34040037
340500     END-IF.                                                      34050037
340700                                                                  34070037
340800     EXEC SQL                                                     34080037
340900          OPEN PRE_PACK_LNE_CSR                                   34090037
341000     END-EXEC.                                                    34100037
341100                                                                  34110037
341200     EVALUATE TRUE                                                34120037
341300         WHEN SQLCODE = ZERO                                      34130037
341400             CONTINUE                                             34140037
341500         WHEN SQLCODE = -904                                      34150037
341600         WHEN SQLCODE = -911                                      34160037
341700         WHEN SQLCODE = -913                                      34170037
341800             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  34180051
341900             PERFORM 1500-CLOSE-SOCKET                            34190037
342000             MOVE '4010-OPEN-PREPK-CSR    '                       34200037
342100                               TO DP013-PARAGRAPH                 34210037
342200             MOVE 'OPEN PREPACK LINE CURSOR - '                   34220037
342300                               TO DP013-MESSAGE-TEXT (1)          34230037
342400             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        34240037
342500             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   34250037
342600             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    34260037
342700             STRING ' RCVR: '             DELIMITED BY SIZE       34270037
342800                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       34280037
342900                    '-'                   DELIMITED BY SIZE       34290037
343000                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       34300037
343100                    '  LINE: '            DELIMITED BY SIZE       34310037
343200                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       34320037
343300                                     INTO DP013-MESSAGE-TEXT (2)  34330037
343400             MOVE SQLCA               TO DP013-SQLCA              34340037
343500             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 34350037
343600             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 34360037
343700             SET DP013-ROLLBACK                                   34370037
343800                 DP013-DB2-ABEND      TO TRUE                     34380037
343900             PERFORM 9999-WRITE-CICS-LOG-MSG                      34390037
344000         WHEN SQLWARN0 NOT = SPACES                               34400037
344100         WHEN SQLCODE < ZERO                                      34410037
344200         WHEN SQLCODE > ZERO                                      34420037
344300                                                                  34430037
344400             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  34440051
344500             PERFORM 1500-CLOSE-SOCKET                            34450037
344600             MOVE '4010-OPEN-PREPK-CSR    '                       34460037
344700                               TO DP013-PARAGRAPH                 34470037
344800             MOVE 'OPEN PREPACK LINE CURSOR - '                   34480037
344900                               TO DP013-MESSAGE-TEXT (1)          34490037
345000             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        34500037
345100             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   34510037
345200             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    34520037
345300             STRING ' RCVR: '             DELIMITED BY SIZE       34530037
345400                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       34540037
345500                    '-'                   DELIMITED BY SIZE       34550037
345600                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       34560037
345700                    '  LINE: '            DELIMITED BY SIZE       34570037
345800                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       34580037
345900                                     INTO DP013-MESSAGE-TEXT (2)  34590037
346000             MOVE SQLCA               TO DP013-SQLCA              34600037
346100             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 34610037
346200             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 34620037
346300             SET DP013-ROLLBACK                                   34630037
346400                 DP013-DB2-ABEND      TO TRUE                     34640037
346500             PERFORM 9999-WRITE-CICS-LOG-MSG                      34650037
346600     END-EVALUATE.                                                34660037
346700                                                                  34670037
346800                                                                  34680037
346900*----------------------------------------------------------------*34690037
347000* PRE-PACK ORDER - FETCH CURSOR - LINES NOT DOWNLOADED TO P2L    *34700037
347100*----------------------------------------------------------------*34710037
347200 4015-FETCH-PREPK-CSR.                                            34720037
347300                                                                  34730037
347500     IF  PV-TEST-CICS                                             34750037
347600         INITIALIZE PV-CICS-MSG-AREA                              34760037
347700         STRING ' PCKCS722 - 4015-FETCH-PREPK-CSR'                34770037
347800                DELIMITED BY SIZE                                 34780037
347900           INTO PV-CICS-MSG-AREA                                  34790037
348000         PERFORM 9990-WRITE-CICS                                  34800037
348100     END-IF.                                                      34810037
348300                                                                  34830037
348400     EXEC SQL                                                     34840037
348500          FETCH PRE_PACK_LNE_CSR                                  34850037
348600           INTO :PV-PRPK-REC-ORD-LNE-NBR                          34860037
348700               ,:PV-PRPK-REC-PREPK-RATO-QTY                       34870037
348800     END-EXEC.                                                    34880037
348900                                                                  34890037
349000     EVALUATE TRUE                                                34900037
349100         WHEN SQLCODE = ZERO                                      34910037
349200             PERFORM 4025-UPDATE-PREPK-HEADER                     34920037
349300             IF PS-PREVIOUSLY-VERIFIED                            34930037
349400                 CONTINUE                                         34940037
349500             ELSE                                                 34950037
349600                  MULTIPLY  PV-ALLOC-QTY                          34960037
349700                        BY  PV-PRPK-REC-PREPK-RATO-QTY            34970037
349800                    GIVING  PV-ALLOC-QTY2                         34980037
349900                 ADD PV-RMNDR-QTY   TO PV-ALLOC-QTY2              34990037
350000                 MOVE PV-ALLOC-QTY2 TO PV-SUMMARY-FIELD           35000037
350100                 MOVE DK-ORD-NBR          TO PC238-PO-NBR         35010037
350200                 MOVE DK-REC-SEQ-NBR      TO PC238-RCVR-SEQ-NBR   35020037
350300                 MOVE PV-PRPK-REC-ORD-LNE-NBR TO                  35030037
350400                                             PC238-PO-LNE-NBR     35040037
350500                 PERFORM 8500-UPDATE-UNITS-WRKD                   35050037
350600             END-IF                                               35060037
350700         WHEN SQLCODE = +100                                      35070037
350800             SET PS-NO-PREPK-LINES-LEFT TO TRUE                   35080037
350900         WHEN SQLCODE = -904                                      35090037
351000         WHEN SQLCODE = -911                                      35100037
351100         WHEN SQLCODE = -913                                      35110037
351200             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  35120051
351300             PERFORM 1500-CLOSE-SOCKET                            35130037
351400             MOVE '4015-FETCH-PREPK-CSR   '                       35140037
351500                               TO DP013-PARAGRAPH                 35150037
351600             MOVE 'FETCH PREPACK LINE CURSOR - '                  35160037
351700                               TO DP013-MESSAGE-TEXT (1)          35170037
351800             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        35180037
351900             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   35190037
352000             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    35200037
352100             STRING ' RCVR: '             DELIMITED BY SIZE       35210037
352200                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       35220037
352300                    '-'                   DELIMITED BY SIZE       35230037
352400                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       35240037
352500                    '  LINE: '            DELIMITED BY SIZE       35250037
352600                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       35260037
352700                                     INTO DP013-MESSAGE-TEXT (2)  35270037
352800             MOVE SQLCA               TO DP013-SQLCA              35280037
352900             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 35290037
353000             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 35300037
353100             SET DP013-ROLLBACK                                   35310037
353200                 DP013-DB2-ABEND      TO TRUE                     35320037
353300             PERFORM 9999-WRITE-CICS-LOG-MSG                      35330037
353400         WHEN SQLWARN0 NOT = SPACE                                35340037
353500         WHEN SQLCODE NOT = ZERO                                  35350037
353600             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  35360051
353700             PERFORM 1500-CLOSE-SOCKET                            35370037
353800             MOVE '4015-FETCH-PREPK-CSR   '                       35380037
353900                               TO DP013-PARAGRAPH                 35390037
354000             MOVE 'FETCH PREPACK LINE CURSOR - '                  35400037
354100                               TO DP013-MESSAGE-TEXT (1)          35410037
354200             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        35420037
354300             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   35430037
354400             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    35440037
354500             STRING ' RCVR: '             DELIMITED BY SIZE       35450037
354600                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       35460037
354700                    '-'                   DELIMITED BY SIZE       35470037
354800                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       35480037
354900                    '  LINE: '            DELIMITED BY SIZE       35490037
355000                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       35500037
355100                                     INTO DP013-MESSAGE-TEXT (2)  35510037
355200             MOVE SQLCA               TO DP013-SQLCA              35520037
355300             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 35530037
355400             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 35540037
355500             SET DP013-ROLLBACK                                   35550037
355600                 DP013-DB2-ABEND      TO TRUE                     35560037
355700             PERFORM 9999-WRITE-CICS-LOG-MSG                      35570037
355800     END-EVALUATE.                                                35580037
355900                                                                  35590037
356000*----------------------------------------------------------------*35600037
356100* PRE-PACK ORDER - CLOSE CURSOR                                  *35610037
356200*----------------------------------------------------------------*35620037
356300 4020-CLOSE-PREPK-CSR.                                            35630037
356400                                                                  35640037
356600     IF  PV-TEST-CICS                                             35660037
356700         INITIALIZE PV-CICS-MSG-AREA                              35670037
356800         STRING ' PCKCS722 - 4020-CLOSE-PREPK-CSR'                35680037
356900                DELIMITED BY SIZE                                 35690037
357000           INTO PV-CICS-MSG-AREA                                  35700037
357100         PERFORM 9990-WRITE-CICS                                  35710037
357200     END-IF.                                                      35720037
357400                                                                  35740037
357500     EXEC SQL                                                     35750037
357600          CLOSE PRE_PACK_LNE_CSR                                  35760037
357700     END-EXEC.                                                    35770037
357800                                                                  35780037
357900     EVALUATE TRUE                                                35790037
358000         WHEN SQLCODE = ZERO                                      35800037
358100             CONTINUE                                             35810037
358200         WHEN SQLCODE = -904                                      35820037
358300         WHEN SQLCODE = -911                                      35830037
358400         WHEN SQLCODE = -913                                      35840037
358500             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  35850051
358600             PERFORM 1500-CLOSE-SOCKET                            35860037
358700             MOVE '4020-CLOSE-PREPK-CSR   '                       35870037
358800                               TO DP013-PARAGRAPH                 35880037
358900             MOVE 'CLOSE PREPACK LINE CURSOR - '                  35890037
359000                               TO DP013-MESSAGE-TEXT (1)          35900037
359100             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        35910037
359200             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   35920037
359300             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    35930037
359400             STRING ' RCVR: '             DELIMITED BY SIZE       35940037
359500                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       35950037
359600                    '-'                   DELIMITED BY SIZE       35960037
359700                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       35970037
359800                    '  LINE: '            DELIMITED BY SIZE       35980037
359900                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       35990037
360000                                     INTO DP013-MESSAGE-TEXT (2)  36000037
360100             MOVE SQLCA               TO DP013-SQLCA              36010037
360200             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 36020037
360300             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 36030037
360400             SET DP013-ROLLBACK                                   36040037
360500                 DP013-DB2-ABEND      TO TRUE                     36050037
360600             PERFORM 9999-WRITE-CICS-LOG-MSG                      36060037
360700         WHEN SQLWARN0 NOT = SPACES                               36070037
360800         WHEN SQLCODE < ZERO                                      36080037
360900         WHEN SQLCODE > ZERO                                      36090037
361000             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  36100051
361100             PERFORM 1500-CLOSE-SOCKET                            36110037
361200             MOVE '4020-CLOSE-PREPK-CSR   '                       36120037
361300                               TO DP013-PARAGRAPH                 36130037
361400             MOVE 'CLOSE PREPACK LINE CURSOR - '                  36140037
361500                               TO DP013-MESSAGE-TEXT (1)          36150037
361600             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        36160037
361700             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   36170037
361800             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    36180037
361900             STRING ' RCVR: '             DELIMITED BY SIZE       36190037
362000                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       36200037
362100                    '-'                   DELIMITED BY SIZE       36210037
362200                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       36220037
362300                    '  LINE: '            DELIMITED BY SIZE       36230037
362400                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       36240037
362500                                     INTO DP013-MESSAGE-TEXT (2)  36250037
362600             MOVE SQLCA               TO DP013-SQLCA              36260037
362700             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 36270037
362800             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 36280037
362900             SET DP013-ROLLBACK                                   36290037
363000                 DP013-DB2-ABEND      TO TRUE                     36300037
363100             PERFORM 9999-WRITE-CICS-LOG-MSG                      36310037
363200     END-EVALUATE.                                                36320037
363300                                                                  36330037
363400*----------------------------------------------------------------*36340037
363500* UPDATE DISTRIBUTION HEADER PREPK LINE NOT DOWNLOADED (TDISTHD) *36350037
363600*----------------------------------------------------------------*36360037
363700 4025-UPDATE-PREPK-HEADER.                                        36370037
363800                                                                  36380037
364000     IF  PV-TEST-CICS                                             36400037
364100         INITIALIZE PV-CICS-MSG-AREA                              36410037
364200         STRING ' PCKCS722 - 4025-UPDATE-PREPK-HEADER'            36420037
364300                DELIMITED BY SIZE                                 36430037
364400           INTO PV-CICS-MSG-AREA                                  36440037
364500         PERFORM 9990-WRITE-CICS                                  36450037
364600     END-IF.                                                      36460037
364800                                                                  36480037
364900     EXEC SQL                                                     36490037
365000          UPDATE TDISTHD                                          36500037
365100             SET PRCG_STAT_CDE   = :PV-PRCG-STAT-CDE              36510037
365200               , RSLTS_RCVD_TMST = CURRENT TIMESTAMP              36520037
365300           WHERE ORD_NBR             = :DK-PREPK-PO-NBR           36530037
365400             AND RCVR_SEQ_NBR        = :DK-PREPK-REC-SEQ-NBR      36540037
365500             AND ORD_LNE_NBR         = :PV-PRPK-REC-ORD-LNE-NBR   36550037
365600     END-EXEC.                                                    36560037
365700                                                                  36570037
365800     EVALUATE TRUE                                                36580037
365900         WHEN SQLCODE = ZERO                                      36590037
366000         WHEN SQLCODE = +100                                      36600037
366100              CONTINUE                                            36610037
366200         WHEN SQLCODE = -904                                      36620037
366300         WHEN SQLCODE = -911                                      36630037
366400         WHEN SQLCODE = -913                                      36640037
366500             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  36650051
366600             PERFORM 1500-CLOSE-SOCKET                            36660037
366700             MOVE '4025-UPDATE-PREPK-DISTHD'                      36670037
366800                               TO DP013-PARAGRAPH                 36680037
366900             MOVE 'UPDATE PREPACK LINE - '                        36690037
367000                               TO DP013-MESSAGE-TEXT (1)          36700037
367100             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        36710037
367200             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   36720037
367300             MOVE PV-PRPK-REC-ORD-LNE-NBR                         36730037
367400                                       TO PV-ERROR-ORD-LNE-NBR    36740037
367500             STRING ' RCVR: '             DELIMITED BY SIZE       36750037
367600                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       36760037
367700                    '-'                   DELIMITED BY SIZE       36770037
367800                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       36780037
367900                    '  LINE: '            DELIMITED BY SIZE       36790037
368000                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       36800037
368100                                     INTO DP013-MESSAGE-TEXT (2)  36810037
368200             MOVE SQLCA               TO DP013-SQLCA              36820037
368300             MOVE 'TDISTHD '          TO DP013-DB2-TABLE-NAME (1) 36830037
368400             SET DP013-ROLLBACK                                   36840037
368500                 DP013-DB2-ABEND      TO TRUE                     36850037
368600             PERFORM 9999-WRITE-CICS-LOG-MSG                      36860037
368700         WHEN SQLWARN0 NOT = SPACES                               36870037
368800         WHEN SQLCODE NOT EQUAL ZERO                              36880037
368900             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  36890051
369000             PERFORM 1500-CLOSE-SOCKET                            36900037
369100             MOVE '4025-UPDATE-PREPK-DISTHD'                      36910037
369200                               TO DP013-PARAGRAPH                 36920037
369300             MOVE 'UPDATE PREPACK LINE - '                        36930037
369400                               TO DP013-MESSAGE-TEXT (1)          36940037
369500             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        36950037
369600             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   36960037
369700             MOVE PV-PRPK-REC-ORD-LNE-NBR                         36970037
369800                                       TO PV-ERROR-ORD-LNE-NBR    36980037
369900             STRING ' RCVR: '             DELIMITED BY SIZE       36990037
370000                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       37000037
370100                    '-'                   DELIMITED BY SIZE       37010037
370200                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       37020037
370300                    '  LINE: '            DELIMITED BY SIZE       37030037
370400                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       37040037
370500                                     INTO DP013-MESSAGE-TEXT (2)  37050037
370600             MOVE SQLCA               TO DP013-SQLCA              37060037
370700             MOVE 'TDISTHD '          TO DP013-DB2-TABLE-NAME (1) 37070037
370800             SET DP013-ROLLBACK                                   37080037
370900                 DP013-DB2-ABEND      TO TRUE                     37090037
371000             PERFORM 9999-WRITE-CICS-LOG-MSG                      37100037
371100     END-EVALUATE.                                                37110037
371200                                                                  37120037
371400     IF  PV-TEST-CICS                                             37140037
371500         INITIALIZE PV-CICS-MSG-AREA                              37150037
371600         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          37160037
371700         MOVE DK-PREPK-PO-NBR         TO PC-DISPLAY-PO            37170037
371800         MOVE DK-PREPK-REC-SEQ-NBR    TO PC-DISPLAY-RCVR          37180037
371900         MOVE PV-PRPK-REC-ORD-LNE-NBR TO PC-DISPLAY-LINE          37190037
372000         STRING ' PCKCS722 - '      DELIMITED BY SIZE             37200037
372100                ' 1330-UPDATE-TDISTHD '                           37210037
372200                                    DELIMITED BY SIZE             37220037
372300                ' KEY - '           DELIMITED BY SIZE             37230037
372400                PC-DISPLAY-OPER     DELIMITED BY SIZE             37240037
372500                '-'                 DELIMITED BY SIZE             37250037
372600                PC-DISPLAY-PO       DELIMITED BY SIZE             37260037
372700                '-'                 DELIMITED BY SIZE             37270037
372800                PC-DISPLAY-RCVR     DELIMITED BY SIZE             37280037
372900                '-'                 DELIMITED BY SIZE             37290037
373000                PC-DISPLAY-LINE     DELIMITED BY SIZE             37300037
373100                '  '                DELIMITED BY SIZE             37310037
373200                PV-PRCG-STAT-CDE    DELIMITED BY SIZE             37320037
373300                             INTO PV-CICS-MSG-AREA                37330037
373400         MOVE LENGTH OF PV-CICS-MSG-AREA                          37340037
373500                               TO PV-COMMAREA-LENGTH              37350037
373600         PERFORM 9990-WRITE-CICS                                  37360037
373700     END-IF.                                                      37370037
373900                                                                  37390037
374000                                                                  37400037
374100*----------------------------------------------------------------*37410037
374200* PRE-PACK ORDER - FETCH CURSOR - LINES NOT DOWNLOADED TO P2L    *37420037
374300* ONLY FOR - REOPEN                                              *37430037
374400*----------------------------------------------------------------*37440037
374500 4030-FETCH-PREPK-CSR-REOPEN.                                     37450037
374600                                                                  37460037
374800     IF  PV-TEST-CICS                                             37480037
374900         INITIALIZE PV-CICS-MSG-AREA                              37490037
375000         STRING ' PCKCS722 - 4030-FETCH-PREPK-CSR-REOPEN'         37500037
375100                '  PV-ALLOC-QTY=' PV-ALLOC-QTY                    37510037
375200                DELIMITED BY SIZE                                 37520037
375300           INTO PV-CICS-MSG-AREA                                  37530037
375400         PERFORM 9990-WRITE-CICS                                  37540037
375500     END-IF.                                                      37550037
375700                                                                  37570037
375800     EXEC SQL                                                     37580037
375900          FETCH PRE_PACK_LNE_CSR                                  37590037
376000           INTO :PV-PRPK-REC-ORD-LNE-NBR                          37600037
376100               ,:PV-PRPK-REC-PREPK-RATO-QTY                       37610037
376200     END-EXEC.                                                    37620037
376300                                                                  37630037
376400     EVALUATE TRUE                                                37640037
376500         WHEN SQLCODE = ZERO                                      37650037
376600              MULTIPLY  PV-ALLOC-QTY                              37660037
376700                    BY  PV-PRPK-REC-PREPK-RATO-QTY                37670037
376800                GIVING  PV-ALLOC-QTY2                             37680037
376900              ADD PV-RMNDR-QTY   TO PV-ALLOC-QTY2                 37690037
377000              MOVE PV-ALLOC-QTY2 TO PV-SUMMARY-FIELD              37700037
377100              MOVE PV-ALLOC-QTY2 TO PC238-WRKD-UNT-QTY            37710037
377200              MOVE DK-ORD-NBR          TO PC238-PO-NBR            37720037
377300              MOVE DK-REC-SEQ-NBR      TO PC238-RCVR-SEQ-NBR      37730037
377400              MOVE PV-PRPK-REC-ORD-LNE-NBR TO                     37740037
377500                                          PC238-PO-LNE-NBR        37750037
377700             MOVE PV-VRFY-ITEM       TO PC238-TOT-QUEUE-ITEMS     37770037
377800             MOVE PV-VRFY-ADJ-QUEUE-NAME                          37780037
377900                                     TO PC238-VRFY-ADJ-QUEUE-NAME 37790037
378100              IF  PV-VRFY-ITEM  >  0                              37810037
378200                  PERFORM 8510-UPD-UNITS-WRKD-REOPEN              37820037
378300              END-IF                                              37830037
378400                                                                  37840037
378600              IF PS-PREV-UPLOAD                                   37860037
378700                  IF  PS-PREV-UPLOAD-UPDATE                       37870037
378800                      PERFORM 4025-UPDATE-PREPK-HEADER            37880037
378900                  END-IF                                          37890037
379000              END-IF                                              37900037
379200                                                                  37920037
379300         WHEN SQLCODE = +100                                      37930037
379400             SET PS-NO-PREPK-LINES-LEFT TO TRUE                   37940037
379500                                                                  37950037
379600         WHEN SQLCODE = -904                                      37960037
379700         WHEN SQLCODE = -911                                      37970037
379800         WHEN SQLCODE = -913                                      37980037
379900             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  37990051
380000             PERFORM 1500-CLOSE-SOCKET                            38000037
380100             MOVE '4030-FETCH-PREPK-CSR-REOPEN  '                 38010037
380200                               TO DP013-PARAGRAPH                 38020037
380300             MOVE 'FETCH PREPACK LINE CURSOR - '                  38030037
380400                               TO DP013-MESSAGE-TEXT (1)          38040037
380500             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        38050037
380600             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   38060037
380700             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    38070037
380800             STRING ' RCVR: '             DELIMITED BY SIZE       38080037
380900                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       38090037
381000                    '-'                   DELIMITED BY SIZE       38100037
381100                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       38110037
381200                    '  LINE: '            DELIMITED BY SIZE       38120037
381300                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       38130037
381400                                     INTO DP013-MESSAGE-TEXT (2)  38140037
381500             MOVE SQLCA               TO DP013-SQLCA              38150037
381600             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 38160037
381700             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 38170037
381800             SET DP013-ROLLBACK                                   38180037
381900                 DP013-DB2-ABEND      TO TRUE                     38190037
382000             PERFORM 9999-WRITE-CICS-LOG-MSG                      38200037
382100         WHEN SQLWARN0 NOT = SPACE                                38210037
382200         WHEN SQLCODE NOT = ZERO                                  38220037
382300             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  38230051
382400             PERFORM 1500-CLOSE-SOCKET                            38240037
382500             MOVE '4030-FETCH-PREPK-CSR-REOPEN  '                 38250037
382600                               TO DP013-PARAGRAPH                 38260037
382700             MOVE 'FETCH PREPACK LINE CURSOR - '                  38270037
382800                               TO DP013-MESSAGE-TEXT (1)          38280037
382900             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        38290037
383000             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   38300037
383100             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    38310037
383200             STRING ' RCVR: '             DELIMITED BY SIZE       38320037
383300                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       38330037
383400                    '-'                   DELIMITED BY SIZE       38340037
383500                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       38350037
383600                    '  LINE: '            DELIMITED BY SIZE       38360037
383700                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       38370037
383800                                     INTO DP013-MESSAGE-TEXT (2)  38380037
383900             MOVE SQLCA               TO DP013-SQLCA              38390037
384000             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 38400037
384100             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 38410037
384200             SET DP013-ROLLBACK                                   38420037
384300                 DP013-DB2-ABEND      TO TRUE                     38430037
384400             PERFORM 9999-WRITE-CICS-LOG-MSG                      38440037
384500     END-EVALUATE.                                                38450037
384600                                                                  38460037
384700*----------------------------------------------------------------*38470037
384800* CALL LOGISTICS ITEM ACCESS MODULE (XLKUT001)                   *38480037
384900*----------------------------------------------------------------*38490037
385000 4035-CALL-XLKUT001.                                              38500037
385100                                                                  38510037
385200     IF  PV-TEST-CICS                                             38520037
385300         INITIALIZE PV-CICS-MSG-AREA                              38530037
385400         STRING ' PCKCS722 - 4035-CALL-XLKUT001'                  38540037
385500                DELIMITED BY SIZE                                 38550037
385600           INTO PV-CICS-MSG-AREA                                  38560037
385700         PERFORM 9990-WRITE-CICS                                  38570037
385800     END-IF.                                                      38580037
385900                                                                  38590037
386000      INITIALIZE XL001-ITEM-COMMAREA.                             38600037
386100      MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR.                 38610037
386200                                                                  38620037
386300      SET  XL001-BY-ITEM                                          38630037
386400           XL001-SELECT-UPC     TO TRUE.                          38640037
386500                                                                  38650037
386600      CALL XL001-VSM-PGM USING DFHEIBLK                           38660037
386700                               XL001-COMMAREA                     38670037
386800                               XL001-ITEM-COMMAREA.               38680037
386900                                                                  38690037
387000      EVALUATE TRUE                                               38700037
387100          WHEN XL001-SUCCESSFUL                                   38710037
387200              MOVE XL001-UPC-NBR  TO  DK-UPC-NBR                  38720037
387300                                                                  38730037
387400          WHEN XL001-SQL-ERROR                                    38740037
387500              IF XL001-UPC-SQLCODE = +0                           38750037
387600                  MOVE XL001-UPC-NBR  TO  DK-UPC-NBR              38760037
387700              ELSE                                                38770037
387800                  MOVE ZEROES         TO  DK-UPC-NBR              38780037
387900              END-IF                                              38790037
388000                                                                  38800037
388100          WHEN XL001-INVALID-ACCESS                               38810037
388200                  MOVE ZEROES         TO  DK-UPC-NBR              38820037
388300         END-EVALUATE.                                            38830037
388400                                                                  38840037
388500                                                                  38850037
388600*----------------------------------------------------------------*38860037
388700* DETERMINE IF DETAIL BELONGS TO A PREPACK ORDER M OR I          *38870037
388800*----------------------------------------------------------------*38880037
388900 4050-DETERMINE-IF-PREPK.                                         38890037
389000                                                                  38900037
389200     IF  PV-TEST-CICS                                             38920037
389300         INITIALIZE PV-CICS-MSG-AREA                              38930037
389400         STRING ' PCKCS722 - 4050-DETERMINE-IF-PREPK'             38940037
389500                DELIMITED BY SIZE                                 38950037
389600           INTO PV-CICS-MSG-AREA                                  38960037
389700         PERFORM 9990-WRITE-CICS                                  38970037
389800     END-IF.                                                      38980037
390000                                                                  39000037
390100     EXEC SQL                                                     39010037
390200          SELECT                                                  39020037
390300                 A.PREPK_ID                                       39030037
390400                ,A.PREPK_RATO_QTY                                 39040037
390500                ,A.STATUS_CDE                                     39050037
390600                ,B.PREPK_LNE_PRC_CDE                              39060037
390700                ,B.OPER_UNT_ID                                    39070037
390800                ,B.VRFD_TMST                                      39080037
390900                ,B.RSLTS_RCVD_TMST                                39090037
391000            INTO                                                  39100037
391100                 :RECITM-PREPK-ID                                 39110037
391200                ,:PV-PREPK-RATO-QTY                               39120037
391300                ,:RECITM-STATUS-CDE                               39130037
391400                ,:DISTHD-PREPK-LNE-PRC-CDE                        39140037
391500                ,:DISTHD-OPER-UNT-ID                              39150037
391600                ,:DISTHD-VRFD-TMST                                39160037
391700                ,:DISTHD-RSLTS-RCVD-TMST                          39170037
391800            FROM                                                  39180037
391900                 TRECITM A                                        39190037
392000                ,TDISTHD B                                        39200037
392100           WHERE                                                  39210037
392200                 A.ORD_NBR        = :DK-ORD-NBR      AND          39220037
392300                 A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR  AND          39230037
392400                 A.ORD_LNE_NBR    = :DK-ORD-LNE-NBR  AND          39240037
392500                 A.VER_STATUS_CDE = :PC-A            AND          39250037
392600                 B.ORD_NBR        = :DK-ORD-NBR      AND          39260037
392700                 B.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR  AND          39270037
392800                 B.ORD_LNE_NBR    = :DK-ORD-LNE-NBR               39280037
392900     END-EXEC.                                                    39290037
393000                                                                  39300037
393100     EVALUATE TRUE                                                39310037
393200         WHEN SQLCODE = ZERO                                      39320037
393300              MOVE DISTHD-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID   39330037
393400         WHEN SQLCODE = +100                                      39340037
393500              MOVE ' ' TO DISTHD-PREPK-LNE-PRC-CDE                39350037
393600         WHEN SQLWARN0 NOT = SPACES                               39360037
393700         WHEN SQLCODE < ZERO                                      39370037
393800         WHEN SQLCODE > ZERO                                      39380037
393900             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  39390051
394000             PERFORM 1500-CLOSE-SOCKET                            39400037
394100             MOVE '4050-DETERMINE-IF-PREPK'                       39410037
394200                                   TO DP013-PARAGRAPH             39420037
394300             MOVE 'DETERMINE IF PREPACK ORDER'                    39430037
394400                                   TO DP013-MESSAGE-TEXT (1)      39440037
394500             MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR            39450037
394600             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       39460037
394700             MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR        39470037
394800             STRING ' RCVR: '              DELIMITED BY SIZE      39480037
394900                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      39490037
395000                    '-'                    DELIMITED BY SIZE      39500037
395100                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      39510037
395200                    '  LINE: '             DELIMITED BY SIZE      39520037
395300                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      39530037
395400                                 INTO DP013-MESSAGE-TEXT (2)      39540037
395500             MOVE SQLCA            TO DP013-SQLCA                 39550037
395600             MOVE 'TRECITM '       TO DP013-DB2-TABLE-NAME (1)    39560037
395700             MOVE 'TDISTHD '       TO DP013-DB2-TABLE-NAME (2)    39570037
395800             SET DP013-ROLLBACK                                   39580037
395900                 DP013-DB2-ABEND   TO TRUE                        39590037
396000             PERFORM 9999-WRITE-CICS-LOG-MSG                      39600037
396100     END-EVALUATE.                                                39610037
396200                                                                  39620037
396300                                                                  39630037
396400*----------------------------------------------------------------*39640037
396500* WHEN IT HAS BEEN DETERMINED THAT THE LINE IS PART OF A PREPK   *39650037
396600* ORDER.  THE OTHER LINES ASSOCIATED WITH THE PREPK (THAT WERE   *39660037
396700* NOT SENT TO P2L) NEED TO BE UPDATED ALSO. (TDISTDT)            *39670037
396800*----------------------------------------------------------------*39680037
396900 4060-PROCESS-PREPK-DISTDT.                                       39690037
397000                                                                  39700037
397200     IF  PV-TEST-CICS                                             39720037
397300         INITIALIZE PV-CICS-MSG-AREA                              39730037
397400         STRING ' PCKCS722 - 4060-PROCESS-PREPK-DISTDT'           39740037
397500                DELIMITED BY SIZE                                 39750037
397600           INTO PV-CICS-MSG-AREA                                  39760037
397700         PERFORM 9990-WRITE-CICS                                  39770037
397800     END-IF.                                                      39780037
398000                                                                  39800037
398100     DIVIDE  DISTDT-ACTL-ALLOC-QTY                                39810037
398200         BY  PV-PREPK-RATO-QTY                                    39820037
398300     GIVING  PV-PRPK-ACTL-ALLOC-QTY-SNGL                          39830037
398400     REMAINDER PV-PRPK-ACTL-ALLOC-QTY-REM.                        39840037
398500                                                                  39850037
398600     SET  PS-PREPK-DISTDT-LINES-LEFT                              39860037
398700          PS-PRPK-TDISTDT-ROW-PRESENT                             39870037
398800                                  TO  TRUE.                       39880037
398900     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            39890037
399000     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       39900037
399100     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          39910037
399200     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID.                39920037
399300                                                                  39930037
399400     PERFORM 4010-OPEN-PREPK-CSR.                                 39940037
399500     PERFORM 4065-FETCH-PREPK-CSR                                 39950037
399600       UNTIL PS-NO-PREPK-DISTDT-LINES-LEFT.                       39960037
399700     PERFORM 4020-CLOSE-PREPK-CSR.                                39970037
399800                                                                  39980037
399900     SET  PS-PREPK-RATIO-LINES-LEFT  TO TRUE.                     39990037
400000                                                                  40000037
402600     IF  PV-PRPK-ACTL-ALLOC-QTY-REM  >  0                         40260037
402700         SET PS-NOT-MULT-OF-RATIO                                 40270037
402800             PS-PREPK-RATIO-LINES-LEFT TO TRUE                    40280037
402900         PERFORM 4080-OPEN-PREPK-LINES-CSR                        40290037
403000         PERFORM 4085-FETCH-PREPK-LINES-CSR                       40300037
403100           UNTIL PS-NO-PREPK-RATIO-LINES-LEFT                     40310037
403200         PERFORM 4090-CLOSE-PREPK-LINES-CSR                       40320037
403300     END-IF.                                                      40330037
403400                                                                  40340037
403500                                                                  40350037
403600*----------------------------------------------------------------*40360037
403700* PRE-PACK ORDER - FETCH CURSOR - LINES NOT DOWNLOADED TO P2L    *40370037
403800*----------------------------------------------------------------*40380037
403900 4065-FETCH-PREPK-CSR.                                            40390037
404000                                                                  40400037
404200     IF  PV-TEST-CICS                                             40420037
404300         INITIALIZE PV-CICS-MSG-AREA                              40430037
404400         STRING ' PCKCS722 - 4065-FETCH-PREPK-CSR'                40440037
404500                DELIMITED BY SIZE                                 40450037
404600           INTO PV-CICS-MSG-AREA                                  40460037
404700         PERFORM 9990-WRITE-CICS                                  40470037
404800     END-IF.                                                      40480037
405000                                                                  40500037
405100     EXEC SQL                                                     40510037
405200          FETCH PRE_PACK_LNE_CSR                                  40520037
405300           INTO :PV-PRPK-REC-ORD-LNE-NBR                          40530037
405400               ,:PV-PRPK-REC-PREPK-RATO-QTY                       40540037
405500     END-EXEC.                                                    40550037
405600                                                                  40560037
405700     EVALUATE TRUE                                                40570037
405800         WHEN SQLCODE = ZERO                                      40580037
405900                                                                  40590037
406000              PERFORM 4067-CHECK-PREPK-PREV-ALLOC                 40600037
406100                                                                  40610037
406200              MOVE PV-PREV-ACTL-ALLOC-QTY                         40620037
406300               TO  PV-PREV-ACTL-ALLOC-BEG                         40630037
406400                                                                  40640037
406500              PERFORM 4070-UPDATE-PREPK-DISTDT                    40650037
406600              IF  PS-PRPK-TDISTDT-ROW-NOT-PRESNT                  40660037
406700                  PERFORM 4075-INSERT-PREPK-DISTDT                40670037
406800              END-IF                                              40680037
406900                                                                  40690037
407000              MOVE PV-PRPK-ACTL-ALLOC-QTY-RATO                    40700037
407100               TO  PV-PREV-ACTL-ALLOC-AFT                         40710037
407200              SUBTRACT  PV-PREV-ACTL-ALLOC-QTY                    40720037
407300                  FROM  PV-PRPK-ACTL-ALLOC-QTY-RATO               40730037
407500                GIVING  PV-PREV-ACTL-ALLOC-DIFF                   40750037
407800                                                                  40780037
407900              IF  PS-PREV-UPLOAD                                  40790037
408000                  IF PV-PREV-ACTL-ALLOC-DIFF  = 0  OR             40800037
408100                     PS-CALL-UNIT-ADJ-MOD-NO                      40810037
408200                     CONTINUE                                     40820037
408300                  ELSE                                            40830037
408400                     SET PS-NOT-VALID-RANDOM-NUMBER TO TRUE       40840037
408500                     PERFORM 5015-GET-RANDOM-NUMBER UNTIL         40850037
408600                         PS-VALID-RANDOM-NUMBER                   40860037
408700                     PERFORM 5002-CALL-UNIT-ADJ-PREPK             40870037
408800                  END-IF                                          40880037
408900              ELSE                                                40890037
409000                  IF  RECITM-STATUS-CDE  = 'VE'                   40900037
409100                      IF  PS-CALL-UNIT-ADJ-MOD-NO                 40910037
409200                          CONTINUE                                40920037
409300                      ELSE                                        40930037
409400                          SET PS-NOT-VALID-RANDOM-NUMBER TO TRUE  40940037
409500                          PERFORM 5015-GET-RANDOM-NUMBER UNTIL    40950037
409600                              PS-VALID-RANDOM-NUMBER              40960037
409700                          PERFORM 5002-CALL-UNIT-ADJ-PREPK        40970037
409800                      END-IF                                      40980037
409900                  END-IF                                          40990037
410000              END-IF                                              41000037
410100                                                                  41010037
410200         WHEN SQLCODE = +100                                      41020037
410300         SET PS-NO-PREPK-DISTDT-LINES-LEFT                        41030037
410400                                   TO TRUE                        41040037
410500         WHEN SQLCODE = -904                                      41050037
410600         WHEN SQLCODE = -911                                      41060037
410700         WHEN SQLCODE = -913                                      41070037
410800             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  41080051
410900             PERFORM 1500-CLOSE-SOCKET                            41090037
411000             MOVE '4065-FETCH-PREPK-CSR   '                       41100037
411100                               TO DP013-PARAGRAPH                 41110037
411200             MOVE 'FETCH PREPACK LINE CURSOR - '                  41120037
411300                               TO DP013-MESSAGE-TEXT (1)          41130037
411400             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        41140037
411500             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   41150037
411600             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    41160037
411700             STRING ' RCVR: '             DELIMITED BY SIZE       41170037
411800                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       41180037
411900                    '-'                   DELIMITED BY SIZE       41190037
412000                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       41200037
412100                    '  LINE: '            DELIMITED BY SIZE       41210037
412200                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       41220037
412300                                     INTO DP013-MESSAGE-TEXT (2)  41230037
412400             MOVE SQLCA               TO DP013-SQLCA              41240037
412500             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 41250037
412600             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 41260037
412700             SET DP013-ROLLBACK                                   41270037
412800                 DP013-DB2-ABEND      TO TRUE                     41280037
412900             PERFORM 9999-WRITE-CICS-LOG-MSG                      41290037
413000         WHEN SQLWARN0 NOT = SPACE                                41300037
413100         WHEN SQLCODE NOT = ZERO                                  41310037
413200             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  41320051
413300             PERFORM 1500-CLOSE-SOCKET                            41330037
413400             MOVE '4065-FETCH-PREPK-CSR   '                       41340037
413500                               TO DP013-PARAGRAPH                 41350037
413600             MOVE 'FETCH PREPACK LINE CURSOR - '                  41360037
413700                               TO DP013-MESSAGE-TEXT (1)          41370037
413800             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        41380037
413900             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   41390037
414000             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    41400037
414100             STRING ' RCVR: '             DELIMITED BY SIZE       41410037
414200                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       41420037
414300                    '-'                   DELIMITED BY SIZE       41430037
414400                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       41440037
414500                    '  LINE: '            DELIMITED BY SIZE       41450037
414600                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       41460037
414700                                     INTO DP013-MESSAGE-TEXT (2)  41470037
414800             MOVE SQLCA               TO DP013-SQLCA              41480037
414900             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 41490037
415000             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 41500037
415100             SET DP013-ROLLBACK                                   41510037
415200                 DP013-DB2-ABEND      TO TRUE                     41520037
415300             PERFORM 9999-WRITE-CICS-LOG-MSG                      41530037
415400     END-EVALUATE.                                                41540037
415500                                                                  41550037
415600                                                                  41560037
415700*----------------------------------------------------------------*41570037
415800*  IF ORDER WAS PREVIOUSLY UPLOADED - CHECK TO SEE WHAT THE      *41580037
415900*  PREVIOUS ALLOCATION WAS TO DETERMINE IF ANY UNIT ADJUSTMENTS  *41590037
416000*  NEED TO BE MADE. PREPACK ONLY                                 *41600037
416200*----------------------------------------------------------------*41620037
416300 4067-CHECK-PREPK-PREV-ALLOC.                                     41630037
416400                                                                  41640037
416600     IF  PV-TEST-CICS                                             41660037
416700         INITIALIZE PV-CICS-MSG-AREA                              41670037
416800         STRING ' PCKCS722 - 4067-CHECK-PREPK-PREV-ALLOC'         41680037
416900                DELIMITED BY SIZE                                 41690037
417000           INTO PV-CICS-MSG-AREA                                  41700037
417100         PERFORM 9990-WRITE-CICS                                  41710037
417200     END-IF.                                                      41720037
417400                                                                  41740037
417500     EXEC SQL                                                     41750037
417600          SELECT  ACTL_ALLOC_QTY                                  41760037
417700            INTO  :PV-PREV-ACTL-ALLOC-QTY                         41770037
417800            FROM  TDISTDT                                         41780037
417900           WHERE  ORD_NBR      = :DK-PREPK-PO-NBR         AND     41790037
418000                  RCVR_SEQ_NBR = :DK-PREPK-REC-SEQ-NBR    AND     41800037
418100                  ORD_LNE_NBR  = :PV-PRPK-REC-ORD-LNE-NBR AND     41810037
418200                  STR_NBR      = :DK-STR-NBR                      41820037
418300     END-EXEC.                                                    41830037
418400                                                                  41840037
418500     EVALUATE TRUE                                                41850037
418600         WHEN SQLCODE = ZERO                                      41860037
418700              CONTINUE                                            41870037
418800         WHEN SQLCODE = +100                                      41880037
418900              SET  PS-PREV-TDISTDT-NOT-PRESENT  TO  TRUE          41890037
419000              MOVE ZEROES  TO  PV-PREV-ACTL-ALLOC-QTY             41900037
419100         WHEN SQLWARN0 NOT = SPACES                               41910037
419200         WHEN SQLCODE < ZERO                                      41920037
419300         WHEN SQLCODE > ZERO                                      41930037
419400             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  41940051
419500             PERFORM 1500-CLOSE-SOCKET                            41950037
419600             MOVE '4067-CHECK-PREPK-PREV-ALLOC '                  41960037
419700                                   TO DP013-PARAGRAPH             41970037
419800             MOVE 'CHECK PREV ALLOC UPLOAD - PREPK'               41980037
419900                                   TO DP013-MESSAGE-TEXT (1)      41990037
420000             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        42000037
420100             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   42010037
420200             MOVE PV-PRPK-REC-ORD-LNE-NBR                         42020037
420300                                       TO PV-ERROR-ORD-LNE-NBR    42030037
420400             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            42040037
420500             STRING ' RCVR: '              DELIMITED BY SIZE      42050037
420600                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      42060037
420700                    '-'                    DELIMITED BY SIZE      42070037
420800                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      42080037
420900                    '  LINE: '             DELIMITED BY SIZE      42090037
421000                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      42100037
421100                    '  STORE: '            DELIMITED BY SIZE      42110037
421200                    PV-ERROR-STR-NBR       DELIMITED BY SIZE      42120037
421300                                 INTO DP013-MESSAGE-TEXT (2)      42130037
421400             MOVE SQLCA            TO DP013-SQLCA                 42140037
421500             MOVE 'TDISTDT '       TO DP013-DB2-TABLE-NAME (1)    42150037
421600             SET DP013-ROLLBACK                                   42160037
421700                 DP013-DB2-ABEND   TO TRUE                        42170037
421800             PERFORM 9999-WRITE-CICS-LOG-MSG                      42180037
421900     END-EVALUATE.                                                42190037
422000                                                                  42200037
422100                                                                  42210037
422200*----------------------------------------------------------------*42220037
422300*    UPDATE THE ACTUAL ALLOCATION QUANTITY ON THE DISTRIBUTION   *42230037
422400*    DETAIL ROW.  THIS VALUE WILL BE SET TO THE ACTUAL NUMBER OF *42240037
422500*    PIECES PROCESSED IN THE PACK TO LIGHT SYSTEM FOR A STORE ON *42250037
422600*    THE SPECIFIED LINE OF THE RECEIVER.                         *42260037
422700*    PREPK - NON-DOWNLOADED LINES                                *42270037
422800*----------------------------------------------------------------*42280037
422900 4070-UPDATE-PREPK-DISTDT.                                        42290037
423000                                                                  42300037
423200     IF  PV-TEST-CICS                                             42320037
423300         INITIALIZE PV-CICS-MSG-AREA                              42330037
423400         STRING ' PCKCS722 - 4070-UPDATE-PREPK-DISTDT'            42340037
423500                DELIMITED BY SIZE                                 42350037
423600           INTO PV-CICS-MSG-AREA                                  42360037
423700         PERFORM 9990-WRITE-CICS                                  42370037
423800     END-IF.                                                      42380037
424000                                                                  42400037
424100     MOVE  PV-PRPK-REC-ORD-LNE-NBR TO DK-PREPK-LINE-NBR-2         42410037
424200     MULTIPLY  PV-PRPK-ACTL-ALLOC-QTY-SNGL                        42420037
424300           BY  PV-PRPK-REC-PREPK-RATO-QTY                         42430037
424400       GIVING  PV-PRPK-ACTL-ALLOC-QTY-RATO                        42440037
424500          ADD  PV-PRPK-ACTL-ALLOC-QTY-REM                         42450037
424600           TO  PV-PRPK-ACTL-ALLOC-QTY-RATO.                       42460037
424700                                                                  42470037
426400     EXEC SQL                                                     42640037
426500          UPDATE TDISTDT                                          42650037
426600             SET ACTL_ALLOC_QTY = :PV-PRPK-ACTL-ALLOC-QTY-RATO    42660037
426700           WHERE                                                  42670037
426800                 ORD_NBR            = :DK-PREPK-PO-NBR      AND   42680037
426900                 RCVR_SEQ_NBR       = :DK-PREPK-REC-SEQ-NBR AND   42690037
427000                 ORD_LNE_NBR        = :DK-PREPK-LINE-NBR-2  AND   42700037
427100                 WRK_ORD_SEQ_NBR    = :DK-WRK-ORD-SEQ-NBR   AND   42710037
427200                 STR_NBR            = :DK-STR-NBR                 42720037
427300     END-EXEC.                                                    42730037
427400                                                                  42740037
427500     EVALUATE TRUE                                                42750037
427600         WHEN SQLCODE = ZERO                                      42760037
427700              CONTINUE                                            42770037
427800         WHEN SQLCODE = -904                                      42780037
427900         WHEN SQLCODE = -911                                      42790037
428000         WHEN SQLCODE = -913                                      42800037
428100              PERFORM 1410-SEND-ERROR-CONFIRM-P2L                 42810051
428200              PERFORM 1500-CLOSE-SOCKET                           42820037
428300              MOVE '4070-UPDATE-PREPK-DISTDT'                     42830037
428400                                    TO DP013-PARAGRAPH            42840037
428500              MOVE 'ERROR UPDATING TDISTDT'                       42850037
428600                                    TO DP013-MESSAGE-TEXT (1)     42860037
428700              MOVE DK-PREPK-PO-NBR  TO PV-ERROR-ORD-NBR           42870037
428800              MOVE DK-PREPK-REC-SEQ-NBR                           42880037
428900                                    TO PV-ERROR-RCVR-SEQ-NBR      42890037
429000              MOVE DK-PREPK-LINE-NBR-2                            42900037
429100                                    TO PV-ERROR-ORD-LNE-NBR       42910037
429200              MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR           42920037
429300              STRING ' RCVR: '               DELIMITED BY SIZE    42930037
429400                     PV-ERROR-ORD-NBR        DELIMITED BY SIZE    42940037
429500                     '-'                     DELIMITED BY SIZE    42950037
429600                     PV-ERROR-RCVR-SEQ-NBR   DELIMITED BY SIZE    42960037
429700                     '  LINE: '              DELIMITED BY SIZE    42970037
429800                     PV-ERROR-ORD-LNE-NBR    DELIMITED BY SIZE    42980037
429900                     '  STORE: '             DELIMITED BY SIZE    42990037
430000                     PV-ERROR-STR-NBR        DELIMITED BY SIZE    43000037
430100                                   INTO DP013-MESSAGE-TEXT (2)    43010037
430200              MOVE SQLCA             TO DP013-SQLCA               43020037
430300              MOVE 'TDISTDT '        TO DP013-DB2-TABLE-NAME(1)   43030037
430400              SET DP013-ROLLBACK                                  43040037
430500                  DP013-DB2-ABEND    TO TRUE                      43050037
430600              PERFORM 9999-WRITE-CICS-LOG-MSG                     43060037
430700         WHEN SQLCODE = +100                                      43070037
430800             SET PS-PRPK-TDISTDT-ROW-NOT-PRESNT TO TRUE           43080037
430900             WHEN SQLWARN0 NOT = SPACES                           43090037
431000             WHEN SQLCODE < ZERO                                  43100037
431100             WHEN SQLCODE > ZERO                                  43110037
431200                  PERFORM 1410-SEND-ERROR-CONFIRM-P2L             43120051
431300                  PERFORM 1500-CLOSE-SOCKET                       43130037
431400                  MOVE '4070-UPDATE-PREPK-DISTDT'                 43140037
431500                                    TO DP013-PARAGRAPH            43150037
431600                  MOVE 'ERROR UPDATING TDISTDT'                   43160037
431700                                    TO DP013-MESSAGE-TEXT (1)     43170037
431800                  MOVE DK-PREPK-PO-NBR TO PV-ERROR-ORD-NBR        43180037
431900                  MOVE DK-PREPK-REC-SEQ-NBR                       43190037
432000                                       TO PV-ERROR-RCVR-SEQ-NBR   43200037
432100                  MOVE DK-PREPK-LINE-NBR-2                        43210037
432200                                       TO PV-ERROR-ORD-LNE-NBR    43220037
432300                  MOVE DK-STR-NBR      TO PV-ERROR-STR-NBR        43230037
432400                  STRING ' RCVR: '           DELIMITED BY SIZE    43240037
432500                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    43250037
432600                      '-'                    DELIMITED BY SIZE    43260037
432700                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    43270037
432800                      '  LINE: '             DELIMITED BY SIZE    43280037
432900                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    43290037
433000                      '  STORE: '            DELIMITED BY SIZE    43300037
433100                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    43310037
433200                                     INTO DP013-MESSAGE-TEXT (2)  43320037
433300                  MOVE SQLCA           TO DP013-SQLCA             43330037
433400                  MOVE 'TDISTDT '      TO DP013-DB2-TABLE-NAME(1) 43340037
433500                  SET DP013-ROLLBACK                              43350037
433600                      PS-UPLOAD-ERROR                             43360037
433700                      DP013-DB2-ABEND  TO TRUE                    43370037
433800                  PERFORM 9999-WRITE-CICS-LOG-MSG                 43380037
433900     END-EVALUATE.                                                43390037
434000                                                                  43400037
434100                                                                  43410037
434200*----------------------------------------------------------------*43420037
434300*  INSERT A ROW ON THE TRANSACTION DETAIL TABLE. - PREPACK       *43430037
434400*----------------------------------------------------------------*43440037
434500 4075-INSERT-PREPK-DISTDT.                                        43450037
434600                                                                  43460037
434800     IF  PV-TEST-CICS                                             43480037
434900         INITIALIZE PV-CICS-MSG-AREA                              43490037
435000         STRING ' PCKCS722 - 4075-INSERT-PREPK-DISTDT'            43500037
435100                DELIMITED BY SIZE                                 43510037
435200           INTO PV-CICS-MSG-AREA                                  43520037
435300         PERFORM 9990-WRITE-CICS                                  43530037
435400     END-IF.                                                      43540037
435600                                                                  43560037
435700     EXEC SQL                                                     43570037
435800          INSERT                                                  43580037
435900            INTO  TDISTDT                                         43590037
436000                 (ORD_NBR                                         43600037
436100                 ,RCVR_SEQ_NBR                                    43610037
436200                 ,ORD_LNE_NBR                                     43620037
436300                 ,WRK_ORD_SEQ_NBR                                 43630037
436400                 ,STR_NBR                                         43640037
436500                 ,EXPTED_ALLOC_QTY                                43650037
436600                 ,ACTL_ALLOC_QTY                                  43660037
436700                 ,RCVG_PSTD_STAT_CDE                              43670037
436800                 ,P2L_SPLT_UNT_QTY)                               43680037
436900          VALUES                                                  43690037
437000                 (:DK-PREPK-PO-NBR                                43700037
437100                 ,:DK-PREPK-REC-SEQ-NBR                           43710037
437200                 ,:DK-PREPK-LINE-NBR-2                            43720037
437300                 ,:DK-WRK-ORD-SEQ-NBR                             43730037
437400                 ,:DK-STR-NBR                                     43740037
437500                 ,:PV-PRPK-ACTL-ALLOC-QTY-RATO                    43750037
437600                 ,:PV-PRPK-ACTL-ALLOC-QTY-RATO                    43760037
437700                 ,:PC-READY-TO-POST-STATUS                        43770037
437800                 ,:PV-PRPK-ACTL-ALLOC-QTY-RATO)                   43780037
437900     END-EXEC                                                     43790037
438000                                                                  43800037
438100     EVALUATE TRUE                                                43810037
438200         WHEN SQLCODE = ZERO                                      43820037
438300              CONTINUE                                            43830037
438400         WHEN SQLCODE = -904                                      43840037
438500         WHEN SQLCODE = -911                                      43850037
438600         WHEN SQLCODE = -913                                      43860037
438700              PERFORM 1410-SEND-ERROR-CONFIRM-P2L                 43870051
438800              PERFORM 1500-CLOSE-SOCKET                           43880037
438900              MOVE '4075-INSERT-PREPK-DISTDT'                     43890037
439000                                       TO DP013-PARAGRAPH         43900037
439100             MOVE 'MAX RETRIES EXCEEDED ON INSERT OF TDISTDT ROW' 43910037
439200                                       TO DP013-MESSAGE-TEXT (1)  43920037
439300              MOVE DK-PREPK-PO-NBR     TO PV-ERROR-ORD-NBR        43930037
439400              MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR  43940037
439500              MOVE DK-PREPK-LINE-NBR-2 TO PV-ERROR-ORD-LNE-NBR    43950037
439600              MOVE DK-STR-NBR          TO PV-ERROR-STR-NBR        43960037
439700              STRING ' RCVR: '            DELIMITED BY SIZE       43970037
439800              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            43980037
439900              '-'                    DELIMITED BY SIZE            43990037
440000              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            44000037
440100              '  LINE: '             DELIMITED BY SIZE            44010037
440200              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            44020037
440300              '  STORE: '            DELIMITED BY SIZE            44030037
440400              PV-ERROR-STR-NBR       DELIMITED BY SIZE            44040037
440500                                     INTO DP013-MESSAGE-TEXT (2)  44050037
440600              MOVE SQLCA               TO DP013-SQLCA             44060037
440700              MOVE 'TDISTDT'           TO DP013-DB2-TABLE-NAME(1) 44070037
440800              SET DP013-DB2-ABEND                                 44080037
440900                  PS-UPLOAD-ERROR                                 44090037
441000                  DP013-ROLLBACK       TO TRUE                    44100037
441100              PERFORM 9999-WRITE-CICS-LOG-MSG                     44110037
441200         WHEN SQLWARN0 NOT = SPACES                               44120037
441300         WHEN SQLCODE NOT EQUAL ZERO                              44130037
441400              PERFORM 1410-SEND-ERROR-CONFIRM-P2L                 44140051
441500              PERFORM 1500-CLOSE-SOCKET                           44150037
441600              MOVE '4075-INSERT-PREPK-DISTDT'                     44160037
441700                                   TO DP013-PARAGRAPH             44170037
441800              MOVE 'INSERT TRANSACTION DETAIL ROW'                44180037
441900                                   TO DP013-MESSAGE-TEXT (1)      44190037
442000              MOVE DK-PREPK-PO-NBR TO PV-ERROR-ORD-NBR            44200037
442100              MOVE DK-PREPK-REC-SEQ-NBR                           44210037
442200                                   TO PV-ERROR-RCVR-SEQ-NBR       44220037
442300              MOVE DK-PREPK-LINE-NBR-2                            44230037
442400                                   TO PV-ERROR-ORD-LNE-NBR        44240037
442500              MOVE DK-STR-NBR      TO PV-ERROR-STR-NBR            44250037
442600              STRING ' RCVR: '              DELIMITED BY SIZE     44260037
442700                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     44270037
442800                     '-'                    DELIMITED BY SIZE     44280037
442900                     PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE     44290037
443000                     '  LINE: '             DELIMITED BY SIZE     44300037
443100                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     44310037
443200                     '  STORE: '            DELIMITED BY SIZE     44320037
443300                     PV-ERROR-STR-NBR       DELIMITED BY SIZE     44330037
443400                                 INTO DP013-MESSAGE-TEXT (2)      44340037
443500              MOVE SQLCA           TO DP013-SQLCA                 44350037
443600              MOVE 'TDISTDT'       TO DP013-DB2-TABLE-NAME (1)    44360037
443700              SET DP013-DB2-ABEND                                 44370037
443800                  PS-UPLOAD-ERROR                                 44380037
443900                  DP013-ROLLBACK   TO TRUE                        44390037
444000              PERFORM 9999-WRITE-CICS-LOG-MSG                     44400037
444100     END-EVALUATE.                                                44410037
444200                                                                  44420037
444300                                                                  44430037
444400*----------------------------------------------------------------*44440037
444500* PRE-PACK ORDER - OPEN CURSOR                                   *44450037
444600*----------------------------------------------------------------*44460037
444700 4080-OPEN-PREPK-LINES-CSR.                                       44470037
444800                                                                  44480037
445000     IF  PV-TEST-CICS                                             44500037
445100         INITIALIZE PV-CICS-MSG-AREA                              44510037
445200         STRING ' PCKCS722 - 4080-OPEN-PREPK-LINES-CSR'           44520037
445300                DELIMITED BY SIZE                                 44530037
445400           INTO PV-CICS-MSG-AREA                                  44540037
445500         PERFORM 9990-WRITE-CICS                                  44550037
445600     END-IF.                                                      44560037
445800                                                                  44580037
445900     EXEC SQL                                                     44590037
446000          OPEN PRE_PACK_CSR                                       44600037
446100     END-EXEC.                                                    44610037
446200                                                                  44620037
446300     EVALUATE TRUE                                                44630037
446400         WHEN SQLCODE = ZERO                                      44640037
446500             CONTINUE                                             44650037
446600         WHEN SQLCODE = -904                                      44660037
446700         WHEN SQLCODE = -911                                      44670037
446800         WHEN SQLCODE = -913                                      44680037
446900             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  44690051
447000             PERFORM 1500-CLOSE-SOCKET                            44700037
447100             MOVE '4080-OPEN-PREPK-LINES-CSR'                     44710037
447200                               TO DP013-PARAGRAPH                 44720037
447300             MOVE 'OPEN PREPACK LINE CURSOR - '                   44730037
447400                               TO DP013-MESSAGE-TEXT (1)          44740037
447500             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        44750037
447600             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   44760037
447700             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    44770037
447800             STRING ' RCVR: '             DELIMITED BY SIZE       44780037
447900                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       44790037
448000                    '-'                   DELIMITED BY SIZE       44800037
448100                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       44810037
448200                    '  LINE: '            DELIMITED BY SIZE       44820037
448300                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       44830037
448400                                     INTO DP013-MESSAGE-TEXT (2)  44840037
448500             MOVE SQLCA               TO DP013-SQLCA              44850037
448600             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 44860037
448700             SET DP013-ROLLBACK                                   44870037
448800                 DP013-DB2-ABEND      TO TRUE                     44880037
448900             PERFORM 9999-WRITE-CICS-LOG-MSG                      44890037
449000         WHEN SQLWARN0 NOT = SPACES                               44900037
449100         WHEN SQLCODE < ZERO                                      44910037
449200         WHEN SQLCODE > ZERO                                      44920037
449300                                                                  44930037
449400             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  44940051
449500             PERFORM 1500-CLOSE-SOCKET                            44950037
449600             MOVE '4080-OPEN-PREPK-LINES-CSR'                     44960037
449700                               TO DP013-PARAGRAPH                 44970037
449800             MOVE 'OPEN PREPACK CURSOR - '                        44980037
449900                               TO DP013-MESSAGE-TEXT (1)          44990037
450000             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        45000037
450100             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   45010037
450200             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    45020037
450300             STRING ' RCVR: '             DELIMITED BY SIZE       45030037
450400                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       45040037
450500                    '-'                   DELIMITED BY SIZE       45050037
450600                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       45060037
450700                    '  LINE: '            DELIMITED BY SIZE       45070037
450800                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       45080037
450900                                     INTO DP013-MESSAGE-TEXT (2)  45090037
451000             MOVE SQLCA               TO DP013-SQLCA              45100037
451100             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 45110037
451200             SET DP013-ROLLBACK                                   45120037
451300                 DP013-DB2-ABEND      TO TRUE                     45130037
451400             PERFORM 9999-WRITE-CICS-LOG-MSG                      45140037
451500     END-EVALUATE.                                                45150037
451600                                                                  45160037
451700                                                                  45170037
451800*----------------------------------------------------------------*45180037
451900* PRE-PACK ORDER - FETCH CURSOR                                  *45190037
452000*----------------------------------------------------------------*45200037
452100 4085-FETCH-PREPK-LINES-CSR.                                      45210037
452200                                                                  45220037
452400     IF  PV-TEST-CICS                                             45240037
452500         INITIALIZE PV-CICS-MSG-AREA                              45250037
452600         STRING ' PCKCS722 - 4085-FETCH-PREPK-LINES-CSR'          45260037
452700                DELIMITED BY SIZE                                 45270037
452800           INTO PV-CICS-MSG-AREA                                  45280037
452900         PERFORM 9990-WRITE-CICS                                  45290037
453000     END-IF.                                                      45300037
453200                                                                  45320037
453300     EXEC SQL                                                     45330037
453400          FETCH PRE_PACK_CSR                                      45340037
453500           INTO :PV-PRPK-REC-ORD-LNE-NBR                          45350037
453600     END-EXEC.                                                    45360037
453700                                                                  45370037
453800     EVALUATE TRUE                                                45380037
453900         WHEN SQLCODE = ZERO                                      45390037
454000              MOVE  PC-NOT-MULT-OF-RATIO-STATUS                   45400037
454100                TO  PV-PRCG-STAT-CDE                              45410037
454200              PERFORM 4025-UPDATE-PREPK-HEADER                    45420037
454300                                                                  45430037
454400         WHEN SQLCODE = +100                                      45440037
454500              SET PS-NO-PREPK-RATIO-LINES-LEFT TO TRUE            45450037
454600                                                                  45460037
454700         WHEN SQLCODE = -904                                      45470037
454800         WHEN SQLCODE = -911                                      45480037
454900         WHEN SQLCODE = -913                                      45490037
455000             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  45500051
455100             PERFORM 1500-CLOSE-SOCKET                            45510037
455200             MOVE '4085-FETCH-PREPK-LINES-CSR'                    45520037
455300                               TO DP013-PARAGRAPH                 45530037
455400             MOVE 'FETCH PREPACK CURSOR - '                       45540037
455500                               TO DP013-MESSAGE-TEXT (1)          45550037
455600             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        45560037
455700             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   45570037
455800             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    45580037
455900             STRING ' RCVR: '             DELIMITED BY SIZE       45590037
456000                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       45600037
456100                    '-'                   DELIMITED BY SIZE       45610037
456200                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       45620037
456300                    '  LINE: '            DELIMITED BY SIZE       45630037
456400                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       45640037
456500                                     INTO DP013-MESSAGE-TEXT (2)  45650037
456600             MOVE SQLCA               TO DP013-SQLCA              45660037
456700             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 45670037
456800             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 45680037
456900             SET DP013-ROLLBACK                                   45690037
457000                 DP013-DB2-ABEND      TO TRUE                     45700037
457100             PERFORM 9999-WRITE-CICS-LOG-MSG                      45710037
457200         WHEN SQLWARN0 NOT = SPACE                                45720037
457300         WHEN SQLCODE NOT = ZERO                                  45730037
457400             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  45740051
457500             PERFORM 1500-CLOSE-SOCKET                            45750037
457600             MOVE '4085-FETCH-PREPK-LINES-CSR'                    45760037
457700                               TO DP013-PARAGRAPH                 45770037
457800             MOVE 'FETCH PREPACK CURSOR - '                       45780037
457900                               TO DP013-MESSAGE-TEXT (1)          45790037
458000             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        45800037
458100             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   45810037
458200             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    45820037
458300             STRING ' RCVR: '             DELIMITED BY SIZE       45830037
458400                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       45840037
458500                    '-'                   DELIMITED BY SIZE       45850037
458600                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       45860037
458700                    '  LINE: '            DELIMITED BY SIZE       45870037
458800                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       45880037
458900                                     INTO DP013-MESSAGE-TEXT (2)  45890037
459000             MOVE SQLCA               TO DP013-SQLCA              45900037
459100             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 45910037
459200             SET DP013-ROLLBACK                                   45920037
459300                 DP013-DB2-ABEND      TO TRUE                     45930037
459400             PERFORM 9999-WRITE-CICS-LOG-MSG                      45940037
459500     END-EVALUATE.                                                45950037
459600                                                                  45960037
459700                                                                  45970037
459800*----------------------------------------------------------------*45980037
459900* PRE-PACK ORDER - CLOSE CURSOR                                  *45990037
460000*----------------------------------------------------------------*46000037
460100 4090-CLOSE-PREPK-LINES-CSR.                                      46010037
460200                                                                  46020037
460400     IF  PV-TEST-CICS                                             46040037
460500         INITIALIZE PV-CICS-MSG-AREA                              46050037
460600         STRING ' PCKCS722 - 4090-CLOSE-PREPK-LINES-CSR'          46060037
460700                DELIMITED BY SIZE                                 46070037
460800           INTO PV-CICS-MSG-AREA                                  46080037
460900         PERFORM 9990-WRITE-CICS                                  46090037
461000     END-IF.                                                      46100037
461200                                                                  46120037
461300     EXEC SQL                                                     46130037
461400          CLOSE PRE_PACK_CSR                                      46140037
461500     END-EXEC.                                                    46150037
461600                                                                  46160037
461700     EVALUATE TRUE                                                46170037
461800         WHEN SQLCODE = ZERO                                      46180037
461900             CONTINUE                                             46190037
462000         WHEN SQLCODE = -904                                      46200037
462100         WHEN SQLCODE = -911                                      46210037
462200         WHEN SQLCODE = -913                                      46220037
462300             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  46230051
462400             PERFORM 1500-CLOSE-SOCKET                            46240037
462500             MOVE '4090-CLOSE-PREPK-LINES-CSR'                    46250037
462600                               TO DP013-PARAGRAPH                 46260037
462700             MOVE 'CLOSE PREPACK CURSOR - '                       46270037
462800                               TO DP013-MESSAGE-TEXT (1)          46280037
462900             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        46290037
463000             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   46300037
463100             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    46310037
463200             STRING ' RCVR: '             DELIMITED BY SIZE       46320037
463300                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       46330037
463400                    '-'                   DELIMITED BY SIZE       46340037
463500                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       46350037
463600                    '  LINE: '            DELIMITED BY SIZE       46360037
463700                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       46370037
463800                                     INTO DP013-MESSAGE-TEXT (2)  46380037
463900             MOVE SQLCA               TO DP013-SQLCA              46390037
464000             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 46400037
464100             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 46410037
464200             SET DP013-ROLLBACK                                   46420037
464300                 DP013-DB2-ABEND      TO TRUE                     46430037
464400             PERFORM 9999-WRITE-CICS-LOG-MSG                      46440037
464500         WHEN SQLWARN0 NOT = SPACES                               46450037
464600         WHEN SQLCODE < ZERO                                      46460037
464700         WHEN SQLCODE > ZERO                                      46470037
464800             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  46480051
464900             PERFORM 1500-CLOSE-SOCKET                            46490037
465000             MOVE '4090-CLOSE-PREPK-LINES-CSR'                    46500037
465100                               TO DP013-PARAGRAPH                 46510037
465200             MOVE 'CLOSE PREPACK CURSOR - '                       46520037
465300                               TO DP013-MESSAGE-TEXT (1)          46530037
465400             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        46540037
465500             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   46550037
465600             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    46560037
465700             STRING ' RCVR: '             DELIMITED BY SIZE       46570037
465800                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       46580037
465900                    '-'                   DELIMITED BY SIZE       46590037
466000                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       46600037
466100                    '  LINE: '            DELIMITED BY SIZE       46610037
466200                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       46620037
466300                                     INTO DP013-MESSAGE-TEXT (2)  46630037
466400             MOVE SQLCA               TO DP013-SQLCA              46640037
466500             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 46650037
466600             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 46660037
466700             SET DP013-ROLLBACK                                   46670037
466800                 DP013-DB2-ABEND      TO TRUE                     46680037
466900             PERFORM 9999-WRITE-CICS-LOG-MSG                      46690037
467000     END-EVALUATE.                                                46700037
467100                                                                  46710037
467200                                                                  46720037
478300*----------------------------------------------------------------*47830037
478400* CALL UNIT ADJUSTMENT MODULE TO MAKE VERIFICATION/POST VERIFICN *47840037
478500* ADJUSTMENTS WHEN A ORDER IS UPLOADED A 2ND TIME.               *47850037
478700*----------------------------------------------------------------*47870037
478800 5000-CALL-UNIT-ADJ.                                              47880037
478900                                                                  47890037
479100     IF  PV-TEST-CICS                                             47910037
479200         INITIALIZE PV-CICS-MSG-AREA                              47920037
479300         STRING ' PCKCS722 - 5000-CALL-UNIT-ADJ'                  47930037
479400                DELIMITED BY SIZE                                 47940037
479500           INTO PV-CICS-MSG-AREA                                  47950037
479600         PERFORM 9990-WRITE-CICS                                  47960037
479700     END-IF.                                                      47970037
479800                                                                  47980037
480100     IF  DK-UPC-NBR  >  0                                         48010037
480200         CONTINUE                                                 48020037
480300     ELSE                                                         48030037
480400         PERFORM 5030-GET-ITEM-NBR                                48040037
480500     END-IF.                                                      48050037
480600                                                                  48060037
480700     EXEC SQL                                                     48070037
480800         SET :SU035-CRE-TMST  = CURRENT TIMESTAMP                 48080037
480900     END-EXEC.                                                    48090037
481000                                                                  48100037
481100     INITIALIZE  SU035-COMM-AREA.                                 48110037
481200     MOVE DP902-RANDOM-NUMBER     TO SU035-FINCL-ADJ-ID.          48120037
481300     MOVE ZEROES                  TO SU035-SHIPT-UNT-ID.          48130037
481400     MOVE DK-UPC-NBR              TO SU035-UPC-NBR.               48140037
481500     MOVE ZEROES                  TO SU035-ORIG-OPER-UNT-ID.      48150037
481600     MOVE DK-DISTHD-OPER          TO SU035-ORIG-OPER-UNT-ID       48160037
481700     MOVE PV-PREV-ACTL-ALLOC-BEG  TO SU035-BEFORE-QTY.            48170037
481800     MOVE PV-PREV-ACTL-ALLOC-AFT  TO SU035-AFTER-QTY.             48180037
481900     MOVE PV-PREV-ACTL-ALLOC-DIFF TO SU035-ADJUST-QTY.            48190037
482000     MOVE 'P2L'                   TO SU035-CREATE-USER-ID.        48200037
482100     MOVE DK-ORD-NBR              TO SU035-PO.                    48210037
482200     MOVE DK-REC-SEQ-NBR          TO SU035-REC-SEQ-NBR.           48220037
482300     MOVE DK-ORD-LNE-NBR          TO SU035-PO-LNE-NBR.            48230037
482400     MOVE ZEROES                  TO SU035-ADJ-AUDIT-CNTL-NBR.    48240037
482500     MOVE DK-STR-NBR              TO SU035-DEST-LOC-NBR.          48250037
482600     MOVE 'N'                     TO SU035-CASEPACK-DELETE-IND.   48260037
482700     MOVE 'N'                     TO SU035-UPDATE-UNTS-WORKED-IND.48270037
482800     MOVE  SPACES                 TO SU035-CART-CREATE-SRC.       48280037
482900     MOVE  SPACES                 TO SU035-SUCCESS-IND.           48290037
483000     MOVE 'N'                     TO SU035-UPDATE-DISTDT-IND.     48300037
483100     MOVE PV-CYC-ADJ-NBR          TO SU035-CYC-ADJ-NBR.           48310037
483200     SET PS-NOT-MANUALLY-VERIFIED TO  TRUE.                       48320037
483300     IF  RECITM-STATUS-CDE    =  'VE'                             48330037
483400         IF  DISTHD-VRFD-TMST NOT =  PC-DEFAULT-TMST              48340037
483600             IF  SU035-AFTER-QTY   > 0  AND                       48360037
483700                 PV-PREPK-RATO-QTY > 0                            48370037
483800                 DIVIDE SU035-AFTER-QTY                           48380037
483900                     BY PV-PREPK-RATO-QTY                         48390037
484000                 GIVING PV-VE-PREPK-CNT                           48400037
484100                 REMAINDER PV-VE-PREPK-REM                        48410037
484200             ELSE                                                 48420037
484300                 MOVE  ZEROES  TO  PV-VE-PREPK-REM                48430037
484400             END-IF                                               48440037
484500             IF  PV-VE-PREPK-REM  > 0                             48450037
484600                 SET SU035-LOG-AS-FAIL TO TRUE                    48460037
484700                 MOVE 'PCCS722E'   TO SU035-PRC-RSN-CDE           48470037
484800                 MOVE 'PCCS722E'   TO SU035-PROGRAM-NAME          48480037
484900             ELSE                                                 48490037
485100                 SET  SU035-LOG-ONLY-NO   TO TRUE                 48510037
485200                 MOVE 'PCKCS722'      TO SU035-PRC-RSN-CDE        48520037
485300                 MOVE 'PCKCS722'      TO SU035-PROGRAM-NAME       48530037
485400             END-IF                                               48540037
485500         ELSE                                                     48550037
485600             SET  SU035-LOG-AS-FAIL   TO TRUE                     48560037
485700             SET PS-MANUALLY-VERIFIED  TO  TRUE                   48570037
485800             IF  DISTHD-RSLTS-RCVD-TMST = PC-DEFAULT-TMST         48580037
485900                 MOVE 'PCCS722B'       TO SU035-PRC-RSN-CDE       48590037
486000                 MOVE 'PCCS722B'       TO SU035-PROGRAM-NAME      48600037
486100             ELSE                                                 48610037
486200                 MOVE 'PCCS722D'       TO SU035-PRC-RSN-CDE       48620037
486300                 MOVE 'PCCS722D'       TO SU035-PROGRAM-NAME      48630037
486400             END-IF                                               48640037
486500         END-IF                                                   48650037
486600     ELSE                                                         48660037
486700         SET  SU035-LOG-ONLY      TO TRUE                         48670037
486800         MOVE 'PCCS722C'          TO SU035-PRC-RSN-CDE            48680037
486900         MOVE 'PCCS722C'          TO SU035-PROGRAM-NAME           48690037
487000     END-IF.                                                      48700037
487200     IF  PV-TEST-CICS                                             48720037
487300         MOVE DK-DISTHD-OPER     TO SU035-ORIG-OPER-UNT-ID        48730037
487400         MOVE SU035-ORIG-OPER-UNT-ID TO PV-ERROR-OPER             48740037
487500         MOVE SU035-PO           TO PV-ERROR-ORD-NBR              48750037
487600         MOVE SU035-REC-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR         48760037
487700         MOVE SU035-PO-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR          48770037
487800         MOVE SU035-DEST-LOC-NBR TO PV-ERROR-STR-NBR              48780037
487900         MOVE SU035-BEFORE-QTY   TO PV-ERROR-BEFORE               48790037
488000         MOVE SU035-AFTER-QTY    TO PV-ERROR-AFTER                48800037
488100         MOVE SU035-ADJUST-QTY   TO PV-ERROR-ADJUST               48810037
488200         INITIALIZE PV-CICS-MSG-AREA                              48820037
488300         STRING ' PCKCS722 - '                                    48830037
488400                PV-ERROR-OPER '-'                                 48840037
488500                PV-ERROR-ORD-NBR '-'                              48850037
488600                PV-ERROR-RCVR-SEQ-NBR '-'                         48860037
488700                PV-ERROR-ORD-LNE-NBR '-'                          48870037
488800                PV-ERROR-STR-NBR                                  48880037
488900                DELIMITED BY SIZE                                 48890037
489000           INTO PV-CICS-MSG-AREA                                  48900037
489100         PERFORM 9990-WRITE-CICS                                  48910037
489200         INITIALIZE PV-CICS-MSG-AREA                              48920037
489300         STRING ' PCKCS722 - '                                    48930037
489400                'BEFORE: ' PV-ERROR-BEFORE '  '                   48940037
489500                'AFTER:  ' PV-ERROR-AFTER  '  '                   48950037
489600                'ADJUST: ' PV-ERROR-ADJUST '  '                   48960037
489700                DELIMITED BY SIZE                                 48970037
489800           INTO PV-CICS-MSG-AREA                                  48980037
489900         PERFORM 9990-WRITE-CICS                                  48990037
490000                                                                  49000037
490100         INITIALIZE PV-CICS-MSG-AREA                              49010037
490200         STRING ' PCKCS722 - RECITM-STATUS-CDE='                  49020037
490300                 RECITM-STATUS-CDE  '  '                          49030037
490400                 ' SU035-LOG-ONLY-IND='                           49040037
490500                 SU035-LOG-ONLY-IND                               49050037
490600                DELIMITED BY SIZE                                 49060037
490700           INTO PV-CICS-MSG-AREA                                  49070037
490800         PERFORM 9990-WRITE-CICS                                  49080037
490900     END-IF.                                                      49090037
491100                                                                  49110037
491200     PERFORM 5010-LINK-SUKUT702.                                  49120037
491300                                                                  49130037
491500     IF  PV-TEST-CICS                                             49150037
491600         INITIALIZE PV-CICS-MSG-AREA                              49160037
491700         STRING ' PCKCS722 - 5000-CALL-UNIT-ADJ - '               49170037
491800                'SUCCESS=' SU035-SUCCESS-IND ' - '                49180037
491900                'UPDATE='  SU035-UPDATE-TYPE-IND                  49190037
492000                DELIMITED BY SIZE                                 49200037
492100           INTO PV-CICS-MSG-AREA                                  49210037
492200         PERFORM 9990-WRITE-CICS                                  49220037
492300     END-IF.                                                      49230037
492400                                                                  49240037
492500* IF A VERIFICATION OR POST-VERIFICATION WAS MADE SUCCESSFULLY    49250037
492600* ADJUSTMENT MUST BE SENT TO RMS PO                               49260037
492700                                                                  49270037
492800     IF  SU035-SUCCESSFUL                                         49280037
492900         MOVE SU035-CYC-ADJ-NBR            TO PV-CYC-ADJ-NBR      49290037
493000         IF (SU035-VERIFIED  OR                                   49300037
493100             SU035-POST-VERIFIED)                                 49310037
493200             ADD  1                        TO PV-VRFY-ITEM        49320037
493300             MOVE SU035-PO                 TO PC241-PO-NBR        49330037
493400             MOVE SU035-PO-LNE-NBR         TO PC241-PO-LNE-NBR    49340037
493500             MOVE SU035-REC-SEQ-NBR        TO PC241-REC-SEQ-NBR   49350037
493600             MOVE SU035-ORIG-OPER-UNT-ID   TO PC241-OPER-UNT-ID   49360037
493700             MOVE 1                        TO PC241-FCLTY-ID      49370037
493800             MOVE SU035-DEST-LOC-NBR       TO PC241-STR-NBR       49380037
493900             IF  DISTHD-PREPK-LNE-PRC-CDE  =                      49390037
494000                 PC-PREPK-P2L-DWNLD                               49400037
494100                 IF  SU035-ADJUST-QTY   >  0  AND                 49410037
494200                     PV-PREPK-RATO-QTY  >  0                      49420037
494300                     DIVIDE  SU035-ADJUST-QTY                     49430037
494400                         BY  PV-PREPK-RATO-QTY                    49440037
494500                     GIVING  PC241-STR-ADJ-QTY                    49450037
494600                 ELSE                                             49460037
494700                     MOVE  ZEROES          TO PC241-STR-ADJ-QTY   49470037
494800                 END-IF                                           49480037
494900             ELSE                                                 49490037
495000                 MOVE SU035-ADJUST-QTY     TO PC241-STR-ADJ-QTY   49500037
495100             END-IF                                               49510037
495200             ADD 1                         TO PV-VRFY-ITEM        49520037
495300             PERFORM 5100-WRITE-VRFY-ADJ-QUEUE                    49530037
495400        END-IF                                                    49540037
495500     END-IF.                                                      49550037
495700                                                                  49570037
495800                                                                  49580037
495900*----------------------------------------------------------------*49590037
496000* CALL UNIT ADJUSTMENT MODULE TO MAKE VERIFICATION/POST VERIFICN *49600037
496100* ADJUSTMENTS WHEN A ORDER IS UPLOADED A 2ND TIME.               *49610037
496300*----------------------------------------------------------------*49630037
496400 5002-CALL-UNIT-ADJ-PREPK.                                        49640037
496500                                                                  49650037
496700     IF  PV-TEST-CICS                                             49670037
496800         INITIALIZE PV-CICS-MSG-AREA                              49680037
496900         STRING ' PCKCS722 - 5002-CALL-UNIT-ADJ-PREPK'            49690037
497000                DELIMITED BY SIZE                                 49700037
497100           INTO PV-CICS-MSG-AREA                                  49710037
497200         PERFORM 9990-WRITE-CICS                                  49720037
497300     END-IF.                                                      49730037
497400                                                                  49740037
497600     PERFORM 5032-GET-ITEM-NBR-PREPK.                             49760037
497700                                                                  49770037
497800     EXEC SQL                                                     49780037
497900         SET :SU035-CRE-TMST  = CURRENT TIMESTAMP                 49790037
498000     END-EXEC.                                                    49800037
498100                                                                  49810037
498200     INITIALIZE  SU035-COMM-AREA.                                 49820037
498300     MOVE DP902-RANDOM-NUMBER     TO SU035-FINCL-ADJ-ID.          49830037
498400     MOVE ZEROES                  TO SU035-SHIPT-UNT-ID.          49840037
498500     MOVE DK-UPC-NBR              TO SU035-UPC-NBR.               49850037
498600     MOVE ZEROES                  TO SU035-ORIG-OPER-UNT-ID.      49860037
498700     MOVE DK-DISTHD-OPER          TO SU035-ORIG-OPER-UNT-ID       49870037
498800     MOVE PV-PREV-ACTL-ALLOC-BEG  TO SU035-BEFORE-QTY.            49880037
498900     MOVE PV-PREV-ACTL-ALLOC-AFT  TO SU035-AFTER-QTY.             49890037
499000     SUBTRACT  SU035-BEFORE-QTY                                   49900037
499100         FROM  SU035-AFTER-QTY                                    49910037
499200       GIVING  SU035-ADJUST-QTY.                                  49920037
499300     MOVE 'P2L'                   TO SU035-CREATE-USER-ID.        49930037
499400     MOVE DK-PREPK-PO-NBR         TO SU035-PO.                    49940037
499500     MOVE DK-PREPK-REC-SEQ-NBR    TO SU035-REC-SEQ-NBR.           49950037
499600     MOVE DK-PREPK-LINE-NBR-2     TO SU035-PO-LNE-NBR.            49960037
499700     MOVE ZEROES                  TO SU035-ADJ-AUDIT-CNTL-NBR.    49970037
499800     MOVE DK-STR-NBR              TO SU035-DEST-LOC-NBR.          49980037
499900     MOVE 'N'                     TO SU035-CASEPACK-DELETE-IND.   49990037
500000     MOVE 'N'                     TO SU035-UPDATE-UNTS-WORKED-IND.50000037
500100     MOVE  SPACES                 TO SU035-CART-CREATE-SRC.       50010037
500200     MOVE  SPACES                 TO SU035-SUCCESS-IND.           50020037
500300     MOVE 'N'                     TO SU035-UPDATE-DISTDT-IND.     50030037
500400     MOVE PV-CYC-ADJ-NBR          TO SU035-CYC-ADJ-NBR.           50040037
500500     IF  RECITM-STATUS-CDE    =  'VE'                             50050037
500600         IF  DISTHD-VRFD-TMST NOT =  PC-DEFAULT-TMST              50060037
500800             IF  SU035-AFTER-QTY             > 0  AND             50080037
500900                 PV-PRPK-REC-PREPK-RATO-QTY  > 0                  50090037
501000                 DIVIDE SU035-AFTER-QTY                           50100037
501100                     BY PV-PRPK-REC-PREPK-RATO-QTY                50110037
501200                 GIVING PV-VE-PREPK-CNT                           50120037
501300                 REMAINDER PV-VE-PREPK-REM                        50130037
501400             ELSE                                                 50140037
501500                 MOVE  ZEROES  TO  PV-VE-PREPK-REM                50150037
501600             END-IF                                               50160037
501700             IF  PV-VE-PREPK-REM  > 0                             50170037
501800                 SET SU035-LOG-AS-FAIL TO TRUE                    50180037
501900                 MOVE 'PCCS722E'   TO SU035-PRC-RSN-CDE           50190037
502000                 MOVE 'PCCS722E'   TO SU035-PROGRAM-NAME          50200037
502100             ELSE                                                 50210037
502300                 SET  SU035-LOG-ONLY-NO   TO TRUE                 50230037
502400                 MOVE 'PCKCS722'      TO SU035-PRC-RSN-CDE        50240037
502500                 MOVE 'PCKCS722'      TO SU035-PROGRAM-NAME       50250037
502600             END-IF                                               50260037
502700         ELSE                                                     50270037
502800             SET  SU035-LOG-AS-FAIL   TO TRUE                     50280037
502900             IF  DISTHD-RSLTS-RCVD-TMST = PC-DEFAULT-TMST         50290037
503000                 MOVE 'PCCS722B'       TO SU035-PRC-RSN-CDE       50300037
503100                 MOVE 'PCCS722B'       TO SU035-PROGRAM-NAME      50310037
503200             ELSE                                                 50320037
503300                 MOVE 'PCCS722D'       TO SU035-PRC-RSN-CDE       50330037
503400                 MOVE 'PCCS722D'       TO SU035-PROGRAM-NAME      50340037
503500             END-IF                                               50350037
503600         END-IF                                                   50360037
503700     ELSE                                                         50370037
503800         SET  SU035-LOG-ONLY      TO TRUE                         50380037
503900         MOVE 'PCCS722C'          TO SU035-PRC-RSN-CDE            50390037
504000         MOVE 'PCCS722C'          TO SU035-PROGRAM-NAME           50400037
504100     END-IF.                                                      50410037
504300     IF  PV-TEST-CICS                                             50430037
504400         MOVE DK-DISTHD-OPER     TO SU035-ORIG-OPER-UNT-ID        50440037
504500         MOVE SU035-ORIG-OPER-UNT-ID TO PV-ERROR-OPER             50450037
504600         MOVE SU035-PO           TO PV-ERROR-ORD-NBR              50460037
504700         MOVE SU035-REC-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR         50470037
504800         MOVE SU035-PO-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR          50480037
504900         MOVE SU035-DEST-LOC-NBR TO PV-ERROR-STR-NBR              50490037
505000         MOVE SU035-BEFORE-QTY   TO PV-ERROR-BEFORE               50500037
505100         MOVE SU035-AFTER-QTY    TO PV-ERROR-AFTER                50510037
505200         MOVE SU035-ADJUST-QTY   TO PV-ERROR-ADJUST               50520037
505300         INITIALIZE PV-CICS-MSG-AREA                              50530037
505400         STRING ' PCKCS722 - '                                    50540037
505500                PV-ERROR-OPER '-'                                 50550037
505600                PV-ERROR-ORD-NBR '-'                              50560037
505700                PV-ERROR-RCVR-SEQ-NBR '-'                         50570037
505800                PV-ERROR-ORD-LNE-NBR '-'                          50580037
505900                PV-ERROR-STR-NBR                                  50590037
506000                DELIMITED BY SIZE                                 50600037
506100           INTO PV-CICS-MSG-AREA                                  50610037
506200         PERFORM 9990-WRITE-CICS                                  50620037
506300         INITIALIZE PV-CICS-MSG-AREA                              50630037
506400         STRING ' PCKCS722 - '                                    50640037
506500                'BEFORE: ' PV-ERROR-BEFORE '  '                   50650037
506600                'AFTER:  ' PV-ERROR-AFTER  '  '                   50660037
506700                'ADJUST: ' PV-ERROR-ADJUST '  '                   50670037
506800                DELIMITED BY SIZE                                 50680037
506900           INTO PV-CICS-MSG-AREA                                  50690037
507000         PERFORM 9990-WRITE-CICS                                  50700037
507100                                                                  50710037
507200         INITIALIZE PV-CICS-MSG-AREA                              50720037
507300         STRING ' PCKCS722 - RECITM-STATUS-CDE='                  50730037
507400                 RECITM-STATUS-CDE  '  '                          50740037
507500                 ' SU035-LOG-ONLY-IND='                           50750037
507600                 SU035-LOG-ONLY-IND                               50760037
507700                DELIMITED BY SIZE                                 50770037
507800           INTO PV-CICS-MSG-AREA                                  50780037
507900         PERFORM 9990-WRITE-CICS                                  50790037
508000     END-IF.                                                      50800037
508200                                                                  50820037
508300     PERFORM 5010-LINK-SUKUT702.                                  50830037
508400                                                                  50840037
508500                                                                  50850037
508600*----------------------------------------------------------------*50860037
508700*  LINK TO SUKUT702 - UNIT ADJUSTMENT S MODULE                    50870037
508900*----------------------------------------------------------------*50890037
509000 5010-LINK-SUKUT702.                                              50900037
509100                                                                  50910037
509300     IF  PV-TEST-CICS                                             50930037
509400         INITIALIZE PV-CICS-MSG-AREA                              50940037
509500         MOVE  PV-CYC-ADJ-NBR  TO  PV-DISPLAY-ADJ-NBR             50950037
509600         STRING ' PCKCS722 - 5010-LINK-SUKUT702'                  50960037
509700                ' - CYC-ADJ-NBR=' PV-DISPLAY-ADJ-NBR              50970037
509800                DELIMITED BY SIZE                                 50980037
509900           INTO PV-CICS-MSG-AREA                                  50990037
510000         PERFORM 9990-WRITE-CICS                                  51000037
510100     END-IF.                                                      51010037
510300                                                                  51030037
510400     MOVE LENGTH OF SU035-COMM-AREA      TO PV-COMMAREA-LENGTH.   51040037
510500                                                                  51050037
510600     EXEC CICS                                                    51060037
510700         LINK PROGRAM  (PC-SUKUT702)                              51070037
510800              COMMAREA (SU035-COMM-AREA)                          51080037
510900              LENGTH   (PV-COMMAREA-LENGTH)                       51090037
511000              RESP     (PV-CICS-RESPONSE)                         51100037
511100     END-EXEC.                                                    51110037
511200                                                                  51120037
511300     EVALUATE TRUE                                                51130037
511400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 51140037
511500             IF  SU035-INVALID-SQL     OR                         51150037
511600                 SU035-DATABASE-BUSY                              51160037
511700                                                                  51170037
511900             INITIALIZE PV-CICS-MSG-AREA                          51190037
512000             MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR            51200037
512100             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       51210037
512200             MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR        51220037
512300             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            51230037
512400                                                                  51240037
512500             STRING 'PCKCS722 - 5010-LINK-SUKUT702 '              51250037
512600                    ' - CALL UNIT ADJ MODULE    '                 51260037
512700                                      DELIMITED BY SIZE           51270037
512800                                 INTO PV-CICS-MSG-AREA            51280037
512900             PERFORM 9990-WRITE-CICS                              51290037
513000                                                                  51300037
513100             INITIALIZE PV-CICS-MSG-AREA                          51310037
513200             STRING 'PCKCS722 - PO-RCVR - '                       51320037
513300                     PV-ERROR-ORD-NBR '-'                         51330037
513400                     PV-ERROR-RCVR-SEQ-NBR '-'                    51340037
513500                     PV-ERROR-ORD-LNE-NBR                         51350037
513600                    ' STORE=' PV-ERROR-STR-NBR                    51360037
513700                                      DELIMITED BY SIZE           51370037
513800                                 INTO PV-CICS-MSG-AREA            51380037
513900             PERFORM 9990-WRITE-CICS                              51390037
514000                                                                  51400037
514100             INITIALIZE PV-CICS-MSG-AREA                          51410037
514200             MOVE SU035-SQLCA       TO PV-CICS-MSG-AREA           51420037
514300             PERFORM 9990-WRITE-CICS                              51430037
514400                                                                  51440037
514500             INITIALIZE PV-CICS-MSG-AREA                          51450037
514600             MOVE SU035-CRA-RET-MSG TO PV-CICS-MSG-AREA           51460037
514700             PERFORM 9990-WRITE-CICS                              51470037
514900                                                                  51490037
515000                 MOVE '5010-LINK-SUKUT702     '                   51500037
515100                                   TO DP013-PARAGRAPH             51510037
515200                 MOVE 'CALL UNIT ADJ MODULE       '               51520037
515300                                   TO DP013-MESSAGE-TEXT (1)      51530037
515400                 MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR        51540037
515500                 MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR   51550037
515600                 MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR    51560037
515700                 MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR        51570037
515800                 STRING ' RCVR: '         DELIMITED BY SIZE       51580037
515900                        PV-ERROR-ORD-NBR  DELIMITED BY SIZE       51590037
516000                        '-'               DELIMITED BY SIZE       51600037
516100                        PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE   51610037
516200                        '  LINE: '        DELIMITED BY SIZE       51620037
516300                        PV-ERROR-ORD-LNE-NBR DELIMITED BY SIZE    51630037
516400                        '  STORE: '       DELIMITED BY SIZE       51640037
516500                        PV-ERROR-STR-NBR  DELIMITED BY SIZE       51650037
516600                                      INTO DP013-MESSAGE-TEXT (2) 51660037
516700                 STRING ' PCKCS722 - '    DELIMITED BY SIZE       51670037
516800                        '5010-LINK-SUKUT702 ' DELIMITED BY SIZE   51680037
516900                        ' RETURN MESSAGE - ' DELIMITED BY SIZE    51690037
517000                        SU035-SUCCESS-IND DELIMITED BY SIZE       51700037
517100                                      INTO DP013-MESSAGE-TEXT (3) 51710037
517200                 MOVE SU035-SQLCA     TO DP013-SQLCA              51720037
517300                                                                  51730037
517400                 PERFORM 1410-SEND-ERROR-CONFIRM-P2L              51740051
517500                 PERFORM 1500-CLOSE-SOCKET                        51750037
517600                                                                  51760037
517700                 SET DP013-ROLLBACK                               51770037
517800                     DP013-DB2-ABEND  TO TRUE                     51780037
517900                 PERFORM 9999-WRITE-CICS-LOG-MSG                  51790037
518000             END-IF                                               51800037
518100                                                                  51810037
518200         WHEN OTHER                                               51820037
518300                                                                  51830037
518500             INITIALIZE PV-CICS-MSG-AREA                          51850037
518600             MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR            51860037
518700             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       51870037
518800             MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR        51880037
518900             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            51890037
519000                                                                  51900037
519100             STRING 'PCKCS722 - 5010-LINK-SUKUT702 '              51910037
519200                    ' - CALL UNIT ADJ MODULE    '                 51920037
519300                                      DELIMITED BY SIZE           51930037
519400                                 INTO PV-CICS-MSG-AREA            51940037
519500             PERFORM 9990-WRITE-CICS                              51950037
519600                                                                  51960037
519700             INITIALIZE PV-CICS-MSG-AREA                          51970037
519800             STRING 'PCKCS722 - PO-RCVR - '                       51980037
519900                     PV-ERROR-ORD-NBR '-'                         51990037
520000                     PV-ERROR-RCVR-SEQ-NBR '-'                    52000037
520100                     PV-ERROR-ORD-LNE-NBR                         52010037
520200                    ' STORE=' PV-ERROR-STR-NBR                    52020037
520300                                      DELIMITED BY SIZE           52030037
520400                                 INTO PV-CICS-MSG-AREA            52040037
520500             PERFORM 9990-WRITE-CICS                              52050037
520600                                                                  52060037
520700             INITIALIZE PV-CICS-MSG-AREA                          52070037
520800             MOVE SU035-SQLCA       TO PV-CICS-MSG-AREA           52080037
520900             PERFORM 9990-WRITE-CICS                              52090037
521000                                                                  52100037
521100             INITIALIZE PV-CICS-MSG-AREA                          52110037
521200             MOVE SU035-CRA-RET-MSG TO PV-CICS-MSG-AREA           52120037
521300             PERFORM 9990-WRITE-CICS                              52130037
521500                                                                  52150037
521600             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  52160051
521700             PERFORM 1500-CLOSE-SOCKET                            52170037
521800                                                                  52180037
521900             MOVE '5010-LINK-SUKUT702 '                           52190037
522000                               TO DP013-PARAGRAPH                 52200037
522100             MOVE 'CALL UNIT ADJ MODULE   '                       52210037
522200                               TO DP013-MESSAGE-TEXT (1)          52220037
522300             MOVE DK-ORD-NBR           TO PV-ERROR-ORD-NBR        52230037
522400             MOVE DK-REC-SEQ-NBR       TO PV-ERROR-RCVR-SEQ-NBR   52240037
522500             MOVE DK-ORD-LNE-NBR       TO PV-ERROR-ORD-LNE-NBR    52250037
522600             MOVE DK-STR-NBR           TO PV-ERROR-STR-NBR        52260037
522700             STRING ' RCVR: '             DELIMITED BY SIZE       52270037
522800                    PV-ERROR-ORD-NBR      DELIMITED BY SIZE       52280037
522900                    '-'                   DELIMITED BY SIZE       52290037
523000                    PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE       52300037
523100                    '  LINE: '            DELIMITED BY SIZE       52310037
523200                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       52320037
523300                    '  STORE: '           DELIMITED BY SIZE       52330037
523400                    PV-ERROR-STR-NBR      DELIMITED BY SIZE       52340037
523500                                     INTO DP013-MESSAGE-TEXT (2)  52350037
523600             STRING ' PCKCS722 - '        DELIMITED BY SIZE       52360037
523700                    '5010-LINK-SUKUT702 ' DELIMITED BY SIZE       52370037
523800                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       52380037
523900                    SU035-SUCCESS-IND     DELIMITED BY SIZE       52390037
524000                                     INTO DP013-MESSAGE-TEXT (3)  52400037
524100             MOVE SU035-SQLCA         TO DP013-SQLCA              52410037
524200             SET DP013-ROLLBACK                                   52420037
524300                 DP013-DB2-ABEND      TO TRUE                     52430037
524400             PERFORM 9999-WRITE-CICS-LOG-MSG                      52440037
524500     END-EVALUATE.                                                52450037
524600                                                                  52460037
524700                                                                  52470037
524800*----------------------------------------------------------------*52480037
524900*   CALL MODULE TO GET RANDOM NUMBER TO ADJUSTMENT NUMBER        *52490037
525000*----------------------------------------------------------------*52500037
525100 5015-GET-RANDOM-NUMBER.                                          52510037
525200                                                                  52520037
525400     IF  PV-TEST-CICS                                             52540037
525500         INITIALIZE PV-CICS-MSG-AREA                              52550037
525600         STRING ' PCKCS722 - 5015-GET-RANDOM-NUMBER'              52560037
525700                DELIMITED BY SIZE                                 52570037
525800           INTO PV-CICS-MSG-AREA                                  52580037
525900         PERFORM 9990-WRITE-CICS                                  52590037
526000     END-IF.                                                      52600037
526200                                                                  52620037
526300     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     52630037
526400     CALL PC-RANDOM-NBR-GENERATOR USING                           52640037
526500                            DFHEIBLK                              52650037
526600                            DFHCOMMAREA                           52660037
526700                            DP902-RANDNBR-ROUTINE-FIELDS.         52670037
526800                                                                  52680037
526900     IF DP902-SUCCESSFUL                                          52690037
527000         PERFORM 5020-SELECT-SUT-FINCL-ADJ                        52700037
527100     ELSE                                                         52710037
527200         INITIALIZE PV-CICS-MSG-AREA                              52720037
527300         MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR                52730037
527400         MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR           52740037
527500         MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR            52750037
527600         MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR                52760037
527700                                                                  52770037
527800         STRING 'PCKCS722 - 5015-GET-RANDOM-NUMBER'               52780037
527900                ' - RANDOM NUMBER GENERATOR '                     52790037
528000                                   DELIMITED BY SIZE              52800037
528100                              INTO PV-CICS-MSG-AREA               52810037
528200         PERFORM 9990-WRITE-CICS                                  52820037
528300                                                                  52830037
528400         INITIALIZE PV-CICS-MSG-AREA                              52840037
528500         STRING 'PCKCS722 - PO-RCVR - '                           52850037
528600                 PV-ERROR-ORD-NBR '-'                             52860037
528700                 PV-ERROR-RCVR-SEQ-NBR '-'                        52870037
528800                 PV-ERROR-ORD-LNE-NBR                             52880037
528900                ' STORE=' PV-ERROR-STR-NBR                        52890037
529000                                  DELIMITED BY SIZE               52900037
529100                             INTO PV-CICS-MSG-AREA                52910037
529200         PERFORM 9990-WRITE-CICS                                  52920037
529300                                                                  52930037
529600         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      52960051
529700         PERFORM 1500-CLOSE-SOCKET                                52970037
529800                                                                  52980037
529900         MOVE '5015-GET-RANDOM-NUMBER'                            52990037
530000                           TO DP013-PARAGRAPH                     53000037
530100         MOVE 'RANDOM NUMBER GENERATOR'                           53010037
530200                           TO DP013-MESSAGE-TEXT (1)              53020037
530300         MOVE DK-ORD-NBR           TO PV-ERROR-ORD-NBR            53030037
530400         MOVE DK-REC-SEQ-NBR       TO PV-ERROR-RCVR-SEQ-NBR       53040037
530500         MOVE DK-ORD-LNE-NBR       TO PV-ERROR-ORD-LNE-NBR        53050037
530600         MOVE DK-STR-NBR           TO PV-ERROR-STR-NBR            53060037
530700         STRING ' RCVR: '             DELIMITED BY SIZE           53070037
530800                PV-ERROR-ORD-NBR      DELIMITED BY SIZE           53080037
530900                '-'                   DELIMITED BY SIZE           53090037
531000                PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE           53100037
531100                '  LINE: '            DELIMITED BY SIZE           53110037
531200                PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE           53120037
531300                '  STORE: '           DELIMITED BY SIZE           53130037
531400                PV-ERROR-STR-NBR      DELIMITED BY SIZE           53140037
531500                                 INTO DP013-MESSAGE-TEXT (2)      53150037
531600         SET DP013-ROLLBACK                                       53160037
531700             DP013-DB2-ABEND      TO TRUE                         53170037
531800         PERFORM 9999-WRITE-CICS-LOG-MSG                          53180037
531900     END-IF.                                                      53190037
532000                                                                  53200037
532300     IF  PV-TEST-CICS                                             53230037
532400         MOVE DP902-RANDOM-NUMBER TO PC-DISPLAY-RANDOM-NBR        53240037
532500         INITIALIZE PV-CICS-MSG-AREA                              53250037
532600         STRING ' PCKCS722 - RANDOM NUMBER = '                    53260037
532700                PC-DISPLAY-RANDOM-NBR                             53270037
532800                DELIMITED BY SIZE                                 53280037
532900           INTO PV-CICS-MSG-AREA                                  53290037
533000         PERFORM 9990-WRITE-CICS                                  53300037
533100     END-IF.                                                      53310037
533300                                                                  53330037
533400                                                                  53340037
533500 5020-SELECT-SUT-FINCL-ADJ.                                       53350037
533600                                                                  53360037
533700     EXEC SQL                                                     53370037
533800         SELECT   FINCL_ADJ_ID                                    53380037
533900         INTO     :SUT00030-FINCL-ADJ-ID                          53390037
534000         FROM     SUT_FINCL_ADJ                                   53400037
534100         WHERE    FINCL_ADJ_ID = :DP902-RANDOM-NUMBER             53410037
534200     END-EXEC.                                                    53420037
534300                                                                  53430037
534400     EVALUATE TRUE                                                53440037
534500         WHEN SQLCODE = ZERO                                      53450037
534600             CONTINUE                                             53460037
534700                                                                  53470037
534800         WHEN SQLCODE = +100                                      53480037
534900             SET PS-VALID-RANDOM-NUMBER  TO TRUE                  53490037
535000                                                                  53500037
535100         WHEN SQLWARN0 NOT = SPACES                               53510037
535200         WHEN SQLCODE < ZERO                                      53520037
535300         WHEN SQLCODE > ZERO                                      53530037
535400         INITIALIZE PV-CICS-MSG-AREA                              53540037
535500         MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR                53550037
535600         MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR           53560037
535700         MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR            53570037
535800         MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR                53580037
535900                                                                  53590037
536000         STRING 'PCKCS722 - 5020-SELECT-SUT-FINCL-ADJ'            53600037
536100                ' - CHECK RANDOM NUMBER '                         53610037
536200                                   DELIMITED BY SIZE              53620037
536300                              INTO PV-CICS-MSG-AREA               53630037
536400         PERFORM 9990-WRITE-CICS                                  53640037
536500                                                                  53650037
536600         INITIALIZE PV-CICS-MSG-AREA                              53660037
536700         STRING 'PCKCS722 - PO-RCVR - '                           53670037
536800                 PV-ERROR-ORD-NBR '-'                             53680037
536900                 PV-ERROR-RCVR-SEQ-NBR '-'                        53690037
537000                 PV-ERROR-ORD-LNE-NBR                             53700037
537100                ' STORE=' PV-ERROR-STR-NBR                        53710037
537200                                  DELIMITED BY SIZE               53720037
537300                             INTO PV-CICS-MSG-AREA                53730037
537400         PERFORM 9990-WRITE-CICS                                  53740037
537500                                                                  53750037
537600         PERFORM 1410-SEND-ERROR-CONFIRM-P2L                      53760051
537700         PERFORM 1500-CLOSE-SOCKET                                53770037
537800                                                                  53780037
537900         MOVE '5020-SELECT-SUT-FINCL-ADJ '                        53790037
538000                           TO DP013-PARAGRAPH                     53800037
538100         MOVE 'CHECK RANDOM NUMBER '                              53810037
538200                           TO DP013-MESSAGE-TEXT (1)              53820037
538300         MOVE DK-ORD-NBR           TO PV-ERROR-ORD-NBR            53830037
538400         MOVE DK-REC-SEQ-NBR       TO PV-ERROR-RCVR-SEQ-NBR       53840037
538500         MOVE DK-ORD-LNE-NBR       TO PV-ERROR-ORD-LNE-NBR        53850037
538600         MOVE DK-STR-NBR           TO PV-ERROR-STR-NBR            53860037
538700         STRING ' RCVR: '             DELIMITED BY SIZE           53870037
538800                PV-ERROR-ORD-NBR      DELIMITED BY SIZE           53880037
538900                '-'                   DELIMITED BY SIZE           53890037
539000                PV-ERROR-RCVR-SEQ-NBR DELIMITED BY SIZE           53900037
539100                '  LINE: '            DELIMITED BY SIZE           53910037
539200                PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE           53920037
539300                '  STORE: '           DELIMITED BY SIZE           53930037
539400                PV-ERROR-STR-NBR      DELIMITED BY SIZE           53940037
539500                                 INTO DP013-MESSAGE-TEXT (2)      53950037
539600         SET DP013-ROLLBACK                                       53960037
539700             DP013-DB2-ABEND      TO TRUE                         53970037
539800         PERFORM 9999-WRITE-CICS-LOG-MSG                          53980037
539900     END-EVALUATE.                                                53990037
540000                                                                  54000037
540100                                                                  54010037
540200*----------------------------------------------------------------*54020037
540300*  GET UPC NUMBER FOR AUTOMATIC ADJUSTMENTS                      *54030037
540400*----------------------------------------------------------------*54040037
540500 5030-GET-ITEM-NBR.                                               54050037
540600                                                                  54060037
540700     IF  PV-TEST-CICS                                             54070037
540800         INITIALIZE PV-CICS-MSG-AREA                              54080037
540900         STRING ' PCKCS722 - 5030-GET-ITEM-NBR'                   54090037
541000                DELIMITED BY SIZE                                 54100037
541100           INTO PV-CICS-MSG-AREA                                  54110037
541200         PERFORM 9990-WRITE-CICS                                  54120037
541300     END-IF.                                                      54130037
541400                                                                  54140037
541500     EXEC SQL                                                     54150037
541600          SELECT ITM_NBR                                          54160037
541700            INTO :PURITM-ITM-NBR                                  54170037
541800            FROM TPURITM                                          54180037
541900           WHERE PO_NBR          = :DK-ORD-NBR                    54190037
542000             AND APP_PO_LNE_NBR  = :DK-ORD-LNE-NBR                54200037
542100             AND VER_STATUS_CDE  = 'A'                            54210037
542200     END-EXEC.                                                    54220037
542300                                                                  54230037
542400     EVALUATE TRUE                                                54240037
542500         WHEN SQLCODE = ZERO                                      54250037
542600             IF PURITM-ITM-NBR > ZERO                             54260037
542700                 PERFORM 4035-CALL-XLKUT001                       54270037
542800             END-IF                                               54280037
542900         WHEN SQLWARN0 NOT = SPACES                               54290037
543000         WHEN SQLCODE < ZERO                                      54300037
543100         WHEN SQLCODE > ZERO                                      54310037
543200             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  54320051
543300             PERFORM 1500-CLOSE-SOCKET                            54330037
543400             MOVE '5030-GET-ITEM-NBR      '                       54340037
543500                                   TO DP013-PARAGRAPH             54350037
543600             MOVE 'GET ITEM NUMBER FOR UPC   '                    54360037
543700                                   TO DP013-MESSAGE-TEXT (1)      54370037
543800             MOVE DK-ORD-NBR       TO PV-ERROR-ORD-NBR            54380037
543900             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       54390037
544000             MOVE DK-ORD-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR        54400037
544100             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            54410037
544200             STRING ' RCVR: '              DELIMITED BY SIZE      54420037
544300                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      54430037
544400                    '-'                    DELIMITED BY SIZE      54440037
544500                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      54450037
544600                    '  LINE: '             DELIMITED BY SIZE      54460037
544700                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      54470037
544800                    '  STORE: '            DELIMITED BY SIZE      54480037
544900                    PV-ERROR-STR-NBR       DELIMITED BY SIZE      54490037
545000                                 INTO DP013-MESSAGE-TEXT (2)      54500037
545100             MOVE SQLCA            TO DP013-SQLCA                 54510037
545200             MOVE 'TDISTDT '       TO DP013-DB2-TABLE-NAME (1)    54520037
545300             SET DP013-ROLLBACK                                   54530037
545400                 DP013-DB2-ABEND   TO TRUE                        54540037
545500             PERFORM 9999-WRITE-CICS-LOG-MSG                      54550037
545600     END-EVALUATE.                                                54560037
545700                                                                  54570037
545800                                                                  54580037
545900*----------------------------------------------------------------*54590037
546000*  GET UPC NUMBER FOR AUTOMATIC ADJUSTMENTS                      *54600037
546100*----------------------------------------------------------------*54610037
546200 5032-GET-ITEM-NBR-PREPK.                                         54620037
546300                                                                  54630037
546400     IF  PV-TEST-CICS                                             54640037
546500         INITIALIZE PV-CICS-MSG-AREA                              54650037
546600         STRING ' PCKCS722 - 5032-GET-ITEM-NBR-PREPK'             54660037
546700                DELIMITED BY SIZE                                 54670037
546800           INTO PV-CICS-MSG-AREA                                  54680037
546900         PERFORM 9990-WRITE-CICS                                  54690037
547000     END-IF.                                                      54700037
547100                                                                  54710037
547200     EXEC SQL                                                     54720037
547300          SELECT ITM_NBR                                          54730037
547400            INTO :PURITM-ITM-NBR                                  54740037
547500            FROM TPURITM                                          54750037
547600           WHERE PO_NBR          = :DK-PREPK-PO-NBR               54760037
547700             AND APP_PO_LNE_NBR  = :DK-PREPK-LINE-NBR-2           54770037
547800             AND VER_STATUS_CDE  = 'A'                            54780037
547900     END-EXEC.                                                    54790037
548000                                                                  54800037
548100     EVALUATE TRUE                                                54810037
548200         WHEN SQLCODE = ZERO                                      54820037
548300             IF PURITM-ITM-NBR > ZERO                             54830037
548400                 PERFORM 4035-CALL-XLKUT001                       54840037
548500             END-IF                                               54850037
548600         WHEN SQLWARN0 NOT = SPACES                               54860037
548700         WHEN SQLCODE < ZERO                                      54870037
548800         WHEN SQLCODE > ZERO                                      54880037
548900             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  54890051
549000             PERFORM 1500-CLOSE-SOCKET                            54900037
549100             MOVE '5032-GET-ITEM-NBR-PREPK'                       54910037
549200                                   TO DP013-PARAGRAPH             54920037
549300             MOVE 'GET ITEM NUMBER FOR UPC   '                    54930037
549400                                   TO DP013-MESSAGE-TEXT (1)      54940037
549500             MOVE DK-PREPK-PO-NBR  TO PV-ERROR-ORD-NBR            54950037
549600             MOVE DK-REC-SEQ-NBR   TO PV-ERROR-RCVR-SEQ-NBR       54960037
549700             MOVE DK-PREPK-LINE-NBR-2 TO PV-ERROR-ORD-LNE-NBR     54970037
549800             MOVE DK-STR-NBR       TO PV-ERROR-STR-NBR            54980037
549900             STRING ' RCVR: '              DELIMITED BY SIZE      54990037
550000                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      55000037
550100                    '-'                    DELIMITED BY SIZE      55010037
550200                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      55020037
550300                    '  LINE: '             DELIMITED BY SIZE      55030037
550400                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      55040037
550500                    '  STORE: '            DELIMITED BY SIZE      55050037
550600                    PV-ERROR-STR-NBR       DELIMITED BY SIZE      55060037
550700                                 INTO DP013-MESSAGE-TEXT (2)      55070037
550800             MOVE SQLCA            TO DP013-SQLCA                 55080037
550900             MOVE 'TDISTDT '       TO DP013-DB2-TABLE-NAME (1)    55090037
551000             SET DP013-ROLLBACK                                   55100037
551100                 DP013-DB2-ABEND   TO TRUE                        55110037
551200             PERFORM 9999-WRITE-CICS-LOG-MSG                      55120037
551300     END-EVALUATE.                                                55130037
551400                                                                  55140037
551500                                                                  55150037
551700******************************************************************55170037
551800* WRITE ENTRIES TO VERIFY ADJUSTMENT QUEUE                       *55180037
551900******************************************************************55190037
552000 5100-WRITE-VRFY-ADJ-QUEUE.                                       55200037
552100                                                                  55210037
552200     IF  PV-TEST-CICS                                             55220037
552300         INITIALIZE PV-CICS-MSG-AREA                              55230037
552400         STRING ' PCKCS722 - 5100-WRITE-VRFY-ADJ-QUEUE'           55240037
552500                DELIMITED BY SIZE                                 55250037
552600           INTO PV-CICS-MSG-AREA                                  55260037
552700         PERFORM 9990-WRITE-CICS                                  55270037
552800         MOVE PC241-OPER-UNT-ID  TO PV-ERROR-OPER                 55280037
552900         MOVE PC241-PO-NBR       TO PV-ERROR-ORD-NBR              55290037
553000         MOVE PC241-REC-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR         55300037
553100         MOVE PC241-PO-LNE-NBR   TO PV-ERROR-ORD-LNE-NBR          55310037
553200         MOVE PC241-STR-NBR      TO PV-ERROR-STR-NBR              55320037
553300         MOVE PC241-STR-ADJ-QTY  TO PV-ERROR-ADJUST               55330037
553400         INITIALIZE PV-CICS-MSG-AREA                              55340037
553500         STRING ' PCKCS722 - '                                    55350037
553600                PV-ERROR-OPER '-'                                 55360037
553700                PV-ERROR-ORD-NBR '-'                              55370037
553800                PV-ERROR-RCVR-SEQ-NBR '-'                         55380037
553900                PV-ERROR-ORD-LNE-NBR '-'                          55390037
554000                PV-ERROR-STR-NBR '-'                              55400037
554100                PV-ERROR-ADJUST                                   55410037
554200                DELIMITED BY SIZE                                 55420037
554300           INTO PV-CICS-MSG-AREA                                  55430037
554400         PERFORM 9990-WRITE-CICS                                  55440037
554500     END-IF.                                                      55450037
554600                                                                  55460037
554700     EXEC CICS WRITEQ TS                                          55470037
554800               QUEUE (PV-VRFY-ADJ-QUEUE-NAME)                     55480037
554900               FROM  (PC241-FIELDS)                               55490037
555000               ITEM  (PV-VRFY-ITEM)                               55500037
555100               RESP  (PV-CICS-RESP)                               55510037
555200     END-EXEC.                                                    55520037
555300                                                                  55530037
555400     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       55540037
555500             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  55550051
555600             PERFORM 1500-CLOSE-SOCKET                            55560037
555700             MOVE '5100-WRITE-VRFY-ADJ-QUEUE'                     55570037
555800                                   TO DP013-PARAGRAPH             55580037
555900             MOVE 'P2L UPDATE TO RMS PO      '                    55590037
556000                                   TO DP013-MESSAGE-TEXT (1)      55600037
556100             MOVE PC241-PO-NBR      TO PV-ERROR-ORD-NBR           55610037
556200             MOVE PC241-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR      55620037
556300             MOVE PC241-PO-LNE-NBR  TO PV-ERROR-ORD-LNE-NBR       55630037
556400             MOVE PC241-STR-NBR     TO PV-ERROR-STR-NBR           55640037
556500             STRING ' RCVR: '              DELIMITED BY SIZE      55650037
556600                    PV-ERROR-ORD-NBR       DELIMITED BY SIZE      55660037
556700                    '-'                    DELIMITED BY SIZE      55670037
556800                    PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE      55680037
556900                    '  LINE: '             DELIMITED BY SIZE      55690037
557000                    PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE      55700037
557100                    '  STORE: '            DELIMITED BY SIZE      55710037
557200                    PV-ERROR-STR-NBR       DELIMITED BY SIZE      55720037
557300                                 INTO DP013-MESSAGE-TEXT (2)      55730037
557400             MOVE SQLCA            TO DP013-SQLCA                 55740037
557500             SET DP013-ROLLBACK                                   55750037
557600                 DP013-DB2-ABEND   TO TRUE                        55760037
557700             PERFORM 9999-WRITE-CICS-LOG-MSG                      55770037
557800     END-IF.                                                      55780037
557900                                                                  55790037
558100                                                                  55810037
558300 7110-SELECT-TKRPRPM.                                             55830037
558400                                                                  55840037
558500     IF  PV-TEST-CICS                                             55850037
558600         INITIALIZE PV-CICS-MSG-AREA                              55860037
558700         MOVE  DK-DISTHD-OPER    TO  PC-DISPLAY-OPER              55870037
558800         STRING ' PCKCS722 - 7110-SELECT-TKRPRPM'                 55880037
558900                ' - ' PC-DISPLAY-OPER                             55890037
559000                DELIMITED BY SIZE                                 55900037
559100           INTO PV-CICS-MSG-AREA                                  55910037
559200         PERFORM 9990-WRITE-CICS                                  55920037
559300     END-IF.                                                      55930037
559400                                                                  55940037
559500     EXEC SQL                                                     55950037
559600          SELECT FUNC_TXT                                         55960037
559700            INTO :KRPRPM-FUNC-TXT                                 55970037
559800            FROM TKRPRPM                                          55980037
559900           WHERE LOC_ID            = :DK-DISTHD-OPER              55990037
560000             AND INTFC_SYS_CDE    = 'KHL'                         56000037
560100             AND SYS_PRC_FUNC_CDE = 'P2LUNT'                      56010037
560200             AND FUNC_PRC_STAT_CDE = 'AC'                         56020037
560300             AND FUNC_TXT          = 'Y'                          56030037
560400     END-EXEC.                                                    56040037
560500                                                                  56050037
560600     EVALUATE TRUE                                                56060037
560700         WHEN SQLCODE = ZERO                                      56070037
560800              SET PS-CALL-UNIT-ADJ-MOD-YES  TO  TRUE              56080037
560900                                                                  56090037
561000         WHEN SQLCODE = +100                                      56100037
561100              SET PS-CALL-UNIT-ADJ-MOD-NO   TO  TRUE              56110037
561200                                                                  56120037
561300         WHEN SQLWARN0 NOT = SPACES                               56130037
561400         WHEN SQLCODE < ZERO                                      56140037
561500         WHEN SQLCODE > ZERO                                      56150037
561600             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  56160051
561700             PERFORM 1500-CLOSE-SOCKET                            56170037
561800             MOVE '7110-SELECT-TKRPRPM  '                         56180037
561900                                   TO DP013-PARAGRAPH             56190037
562000             STRING 'CHECK IF CALL UNIT ADJ MOD - '               56200037
562100                    DK-TRNID          DELIMITED BY SIZE           56210037
562200                                 INTO DP013-MESSAGE-TEXT (1)      56220037
562300             MOVE SQLCA            TO DP013-SQLCA                 56230037
562400             MOVE 'TKRPRPM '       TO DP013-DB2-TABLE-NAME (1)    56240037
562500             SET DP013-ROLLBACK                                   56250037
562600                 DP013-DB2-ABEND   TO TRUE                        56260037
562700             PERFORM 9999-WRITE-CICS-LOG-MSG                      56270037
562800     END-EVALUATE.                                                56280037
563000                                                                  56300037
563100     IF  PV-TEST-CICS                                             56310037
563200         INITIALIZE PV-CICS-MSG-AREA                              56320037
563300         IF  PS-CALL-UNIT-ADJ-MOD-YES                             56330037
563400             STRING ' PCKCS722 - CALL UNIT ADJUSTMENT - YES'      56340037
563500                    DELIMITED BY SIZE                             56350037
563600               INTO PV-CICS-MSG-AREA                              56360037
563700         ELSE                                                     56370037
563800             STRING ' PCKCS722 - CALL UNIT ADJUSTMENT - NO '      56380037
563900                    DELIMITED BY SIZE                             56390037
564000               INTO PV-CICS-MSG-AREA                              56400037
564100         END-IF                                                   56410037
564200         PERFORM 9990-WRITE-CICS                                  56420037
564300     END-IF.                                                      56430037
564400                                                                  56440037
564500                                                                  56450037
564600*----------------------------------------------------------------*56460037
564700* SELECT SOCKET TIMEOUT FROM PARAMETER DATABASE                  *56470037
564900*----------------------------------------------------------------*56490037
565000 7115-GET-SOCKET-TIMEOUT.                                         56500037
565100                                                                  56510037
565200     IF  PV-TEST-CICS                                             56520037
565300         INITIALIZE PV-CICS-MSG-AREA                              56530037
565400         MOVE  DK-DISTHD-OPER    TO  PC-DISPLAY-OPER              56540037
565500         STRING ' PCKCS722 - 7115-SOCKET-TIMEOUT'                 56550037
565600                ' - ' PC-DISPLAY-OPER                             56560037
565700                DELIMITED BY SIZE                                 56570037
565800           INTO PV-CICS-MSG-AREA                                  56580037
565900         PERFORM 9990-WRITE-CICS                                  56590037
566000     END-IF.                                                      56600037
566100                                                                  56610037
566200     MOVE  DK-DISTHD-OPER    TO  PC-DISPLAY-OPER                  56620037
566300     STRING ' PCKCS722 - 7115-SOCKET-TIMEOUT'                     56630037
566400            ' - ' PC-DISPLAY-OPER   DELIMITED BY SIZE             56640037
566500                               INTO PV-CICS-MSG-AREA              56650037
566600     PERFORM 9995-WRITE-CICS.                                     56660037
566700                                                                  56670037
566800     EXEC SQL                                                     56680037
566900          SELECT FUNC_QTY                                         56690037
567000            INTO :KRPRPM-FUNC-QTY                                 56700037
567100            FROM TKRPRPM                                          56710037
567200           WHERE LOC_ID            = 90                           56720037
567300             AND INTFC_SYS_CDE    = 'KHL'                         56730037
567400             AND SYS_PRC_FUNC_CDE = 'SCKTM7'                      56740037
567500             AND FUNC_PRC_STAT_CDE = 'AC'                         56750037
567600     END-EXEC.                                                    56760037
567700                                                                  56770037
567800     EVALUATE TRUE                                                56780037
567900         WHEN SQLCODE = ZERO                                      56790037
568000              MOVE KRPRPM-FUNC-QTY  TO  SELECT-SECS               56800037
568100                                                                  56810037
568200         WHEN SQLCODE = +100                                      56820037
568300              CONTINUE                                            56830037
568400                                                                  56840037
568500         WHEN SQLWARN0 NOT = SPACES                               56850037
568600         WHEN SQLCODE < ZERO                                      56860037
568700         WHEN SQLCODE > ZERO                                      56870037
568800             PERFORM 1410-SEND-ERROR-CONFIRM-P2L                  56880051
568900             PERFORM 1500-CLOSE-SOCKET                            56890037
569000             MOVE '7115-GET-SOCKET-TIMEOUT'                       56900037
569100                                   TO DP013-PARAGRAPH             56910037
569200             MOVE SQLCA            TO DP013-SQLCA                 56920037
569300             MOVE 'TKRPRPM '       TO DP013-DB2-TABLE-NAME (1)    56930037
569400             SET DP013-ROLLBACK                                   56940037
569500                 DP013-DB2-ABEND   TO TRUE                        56950037
569600             PERFORM 9999-WRITE-CICS-LOG-MSG                      56960037
569700     END-EVALUATE.                                                56970037
569900                                                                  56990037
570000                                                                  57000037
570100*----------------------------------------------------------------*57010037
570200*    START THE TRANSACTION THAT PERFORMS THE VERIFICATION PROCESS*57020037
570300*    FOR THE SPECIFIED LINE OF THE RECEIVER.                     *57030037
570400*----------------------------------------------------------------*57040037
570500 8000-START-E200.                                                 57050037
570600                                                                  57060037
570800     IF  PV-TEST-CICS                                             57080037
570900         INITIALIZE PV-CICS-MSG-AREA                              57090037
571000         STRING ' PCKCS722 - 8000-START-E200'                     57100037
571100                DELIMITED BY SIZE                                 57110037
571200           INTO PV-CICS-MSG-AREA                                  57120037
571300         PERFORM 9990-WRITE-CICS                                  57130037
571400     END-IF.                                                      57140037
571600                                                                  57160037
571700     MOVE DK-ORD-NBR              TO RC289-ORD-NBR.               57170037
571800     MOVE DK-REC-SEQ-NBR          TO RC289-RCVR-SEQ-NBR.          57180037
571900     MOVE DK-ORD-LNE-NBR          TO RC289-ORD-LNE-NBR.           57190037
572000     MOVE PC-CURRENT-PGM-NAME     TO RC289-CALLING-PROGRAM.       57200037
572100     MOVE 'P2L'                   TO RC289-USER-ID.               57210037
572200     SET  RC289-VERIF-P2L         TO TRUE.                        57220037
572300                                                                  57230037
572400     EXEC CICS                                                    57240037
572500          START TRANSID ('E200')                                  57250037
572600               FROM (RC289-COMMAREA-FOR-E200)                     57260037
572700     END-EXEC.                                                    57270037
572800                                                                  57280037
572900                                                                  57290037
575500 8400-TRACKING.                                                   57550037
575600                                                                  57560037
575700     INITIALIZE RC071-FIELDS.                                     57570037
575800     MOVE DK-ORD-NBR                TO RC071-PO-NBR.              57580037
575900     MOVE DK-REC-SEQ-NBR            TO RC071-PO-RCVR.             57590037
576000     IF RECITM-PREPK-ID > 0                                       57600037
576100        MOVE RECITM-PREPK-ID        TO RC071-PREPK-ID             57610037
576200        MOVE 0                      TO RC071-PO-LINE              57620037
576300     ELSE                                                         57630037
576400        MOVE 0                      TO RC071-PREPK-ID             57640037
576500        MOVE DK-ORD-LNE-NBR         TO RC071-PO-LINE              57650037
576600     END-IF                                                       57660037
576700     MOVE PC238-WRKD-OPER-UNT-ID    TO RC071-SIGNON-LOCATION.     57670037
576800     MOVE 'P2L'                     TO RC071-USER-ID.             57680037
576900                                                                  57690037
577000     EVALUATE TRUE                                                57700037
577100          WHEN PV-PRCG-STAT-CDE = 'C'                             57710037
577200              SET RC071-SUSP-P2LUP-CANCELLED TO TRUE              57720037
577300          WHEN PV-PRCG-STAT-CDE = 'E'                             57730037
577400              SET RC071-SUSP-P2LUP-RCVR-TRBL TO TRUE              57740037
577500          WHEN PV-PRCG-STAT-CDE = 'F'                             57750037
577600              SET RC071-SUSP-P2LUP-NO-PRONBR TO TRUE              57760037
577700          WHEN PV-PRCG-STAT-CDE = 'G'                             57770037
577800             SET RC071-SUSP-P2LUP-NT-ARRVD  TO TRUE               57780037
577900          WHEN PV-PRCG-STAT-CDE = 'H'                             57790037
578000              SET RC071-SUSP-P2LUP-OP-SY-AUD TO TRUE              57800037
578100          WHEN PV-PRCG-STAT-CDE = 'I'                             57810037
578200             SET RC071-SUSP-P2LUP-ST-INVTRY TO TRUE               57820037
578300          WHEN PV-PRCG-STAT-CDE = 'P'                             57830037
578400              SET RC071-SUSP-P2LUP-PREV-VRFY TO TRUE              57840037
578500          WHEN PV-PRCG-STAT-CDE = 'J'                             57850037
578600             SET RC071-SUSP-P2LUP-NOT-MNFST TO TRUE               57860037
578700          WHEN PV-PRCG-STAT-CDE = 'R'                             57870037
578800             SET RC071-SUSP-P2LUP-FOR-READY TO TRUE               57880037
578900     END-EVALUATE.                                                57890037
579000                                                                  57900037
579100     MOVE 'PCKCS722'                TO RC071-CALLING-PROGRAM.     57910037
579200                                                                  57920037
579300     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        57930037
579400                                                                  57940037
579500     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  57950037
579600                                        RC071-COMMAREA            57960037
579700                                        RC071-FIELDS.             57970037
579800                                                                  57980037
579900     EVALUATE TRUE                                                57990037
580000         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     58000037
580100             IF  RC071-INVALID-SQL     OR                         58010037
580200                 RC071-DATABASE-BUSY                              58020037
580300                 STRING ' RCKUT137 - '        DELIMITED BY SIZE   58030037
580400                   '8700-TRACK-CONFIRMATION'  DELIMITED BY SIZE   58040037
580500                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   58050037
580600                        RC071-SUCCESS-IND     DELIMITED BY SIZE   58060037
580700                                         INTO RC071-CRA-RET-MSG   58070037
580800             MOVE RC071-CRA-RET-MSG       TO PV-CICS-MSG-AREA     58080037
580900             PERFORM 9990-WRITE-CICS                              58090037
581000                 SET RC071-NOT-SUCCESSFUL TO TRUE                 58100037
581100             END-IF                                               58110037
581200         WHEN OTHER                                               58120037
581300             STRING ' PCKCS722 (OTHER) -' DELIMITED BY SIZE       58130037
581400                '8700-TRACK-CONFIRMATION' DELIMITED BY SIZE       58140037
581500                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       58150037
581600                    RC071-SUCCESS-IND     DELIMITED BY SIZE       58160037
581700                                         INTO RC071-CRA-RET-MSG   58170037
581800             MOVE RC071-CRA-RET-MSG       TO PV-CICS-MSG-AREA     58180037
581900             PERFORM 9990-WRITE-CICS                              58190037
582000             SET RC071-NOT-SUCCESSFUL TO TRUE                     58200037
582100     END-EVALUATE.                                                58210037
582200                                                                  58220037
582300******   INSERT A RECORD TO THE TRACKING TABLE TO SAY THAT        58230037
582400******   P2L IS UPLOADED                                          58240037
582500                                                                  58250037
582600     SET RC071-P2L-UPLOAD-PCC TO TRUE.                            58260037
582700                                                                  58270037
582800     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        58280037
582900                                                                  58290037
583000     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  58300037
583100                                        RC071-COMMAREA            58310037
583200                                        RC071-FIELDS.             58320037
583300                                                                  58330037
583400     EVALUATE TRUE                                                58340037
583500         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     58350037
583600             IF  RC071-INVALID-SQL     OR                         58360037
583700                 RC071-DATABASE-BUSY                              58370037
583800                 STRING ' RCKUT137 - '        DELIMITED BY SIZE   58380037
583900                   '8700-TRACK-CONFIRMATION'  DELIMITED BY SIZE   58390037
584000                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   58400037
584100                        RC071-SUCCESS-IND     DELIMITED BY SIZE   58410037
584200                                         INTO RC071-CRA-RET-MSG   58420037
584300             MOVE RC071-CRA-RET-MSG       TO PV-CICS-MSG-AREA     58430037
584400             PERFORM 9990-WRITE-CICS                              58440037
584500                 SET RC071-NOT-SUCCESSFUL TO TRUE                 58450037
584600             END-IF                                               58460037
584700         WHEN OTHER                                               58470037
584800             STRING ' PCKCS722 (OTHER) -' DELIMITED BY SIZE       58480037
584900                '8700-TRACK-CONFIRMATION' DELIMITED BY SIZE       58490037
585000                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       58500037
585100                    RC071-SUCCESS-IND     DELIMITED BY SIZE       58510037
585200                                         INTO RC071-CRA-RET-MSG   58520037
585300             MOVE RC071-CRA-RET-MSG       TO PV-CICS-MSG-AREA     58530037
585400             PERFORM 9990-WRITE-CICS                              58540037
585500             SET RC071-NOT-SUCCESSFUL TO TRUE                     58550037
585600     END-EVALUATE.                                                58560037
585700                                                                  58570037
585800                                                                  58580037
585900*----------------------------------------------------------------*58590037
586000*    CALL THE UNITS WORKED UPDATE MODULE PCKCS756                 58600037
586100*----------------------------------------------------------------*58610037
586200 8500-UPDATE-UNITS-WRKD.                                          58620037
586300                                                                  58630037
586500     IF  PV-TEST-CICS                                             58650037
586600         INITIALIZE PV-CICS-MSG-AREA                              58660037
586700         STRING ' PCKCS722 - 8500-UPDATE-UNITS-WRKD'              58670037
586800                DELIMITED BY SIZE                                 58680037
586900           INTO PV-CICS-MSG-AREA                                  58690037
587000         PERFORM 9990-WRITE-CICS                                  58700037
587100     END-IF.                                                      58710037
587300                                                                  58730037
587301*                                                                 58730152
587302*** 3/8/24 - begin                                                58730252
587303*                                                                 58730352
587310     SET  PS-UNT-WRK-FROM-PICKMADE-NO  TO  TRUE.                  58731052
587320     PERFORM 8550-CHECK-UNT-WRK-PICKMADE.                         58732052
587321*                                                                 58732152
587322*** 3/8/24 - end                                                  58732252
587331*                                                                 58733152
587380                                                                  58738052
587400* THIS WILL CALL PCKCS756 WHICH WILL UPDATE THE TABLES FOR UNITS  58740037
587500* WORKED OR VERIFIED                                              58750037
587600                                                                  58760037
587700     EXEC SQL                                                     58770037
587800         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                58780037
587900     END-EXEC.                                                    58790037
588000                                                                  58800037
588010*                                                                 58801052
588011*        10  PC238-TRANS-TYPE-CDE           PIC  X(1).            58801152
588016* * * *      88  PC238-TRANS-P2L-UPLOAD     VALUE 'P'. * * * *    58801652
588017*        10  PC238-VERIFY-TYPE-CDE          PIC  X(1).            58801752
588018*            88  PC238-AUTO-VERIFY          VALUE 'A'.            58801852
588019*            88  PC238-MANUAL-VERIFY        VALUE 'M'.            58801952
588020* * * *      88  PC238-NOT-VERIFY           VALUE 'N'. * * * *    58802052
588030*                                                                 58803052
588100     MOVE PV-CURRENT-TMST            TO PC238-WRKD-TMST.          58810037
588200     MOVE PV-SUMMARY-FIELD           TO PC238-WRKD-UNT-QTY.       58820037
588300     MOVE SPACES                     TO PC238-PRCG-AREA-CDE.      58830037
588400     MOVE PC-P                       TO PC238-TRANS-TYPE-CDE.     58840037
588500     MOVE PC-N                       TO PC238-VERIFY-TYPE-CDE.    58850037
588700     MOVE PV-VRFY-ITEM               TO PC238-TOT-QUEUE-ITEMS.    58870037
588800     MOVE PV-VRFY-ADJ-QUEUE-NAME     TO PC238-VRFY-ADJ-QUEUE-NAME.58880037
589000     MOVE LENGTH OF PC238-COMM-AREA  TO PV-COMMAREA-LENGTH.       58900037
589100                                                                  58910037
589300     IF  PV-TEST-CICS                                             58930037
589400         INITIALIZE PV-CICS-MSG-AREA                              58940037
589500         MOVE PC238-WRKD-OPER-UNT-ID  TO PC-DISPLAY-OPER          58950037
589600         MOVE PC238-PO-NBR            TO PC-DISPLAY-PO            58960037
589700         MOVE PC238-RCVR-SEQ-NBR      TO PC-DISPLAY-RCVR          58970037
589800         MOVE PC238-PO-LNE-NBR        TO PC-DISPLAY-LINE          58980037
589900         STRING ' PCKCS722 - '                                    58990052
590000                ' 8500-UPDATE-UNITS-WRKD '                        59000037
590100                                                                  59010052
590200                ' KEY - '                                         59020052
590300                PC-DISPLAY-OPER                                   59030052
590400                '-'                                               59040052
590500                PC-DISPLAY-PO                                     59050052
590600                '-'                                               59060052
590700                PC-DISPLAY-RCVR                                   59070052
590800                '-'                                               59080052
590900                PC-DISPLAY-LINE                                   59090052
590910                '  SW:' PS-UNT-WRK-FROM-PICKMADE-SW               59091052
590920                                    DELIMITED BY SIZE             59092052
591000                             INTO PV-CICS-MSG-AREA                59100037
591100         MOVE LENGTH OF PV-CICS-MSG-AREA                          59110037
591200                               TO PV-COMMAREA-LENGTH              59120037
591300         PERFORM 9990-WRITE-CICS                                  59130037
591400     END-IF                                                       59140037
591600                                                                  59160037
591610     IF  PS-UNT-WRK-FROM-PICKMADE                                 59161054
591620         CONTINUE                                                 59162052
591630     ELSE                                                         59163052
591700         EXEC CICS                                                59170052
591800             LINK                                                 59180052
591900                 PROGRAM   (PC-UNTS-WRKD-PGRM-NAME)               59190052
592000                 COMMAREA  (PC238-COMM-AREA)                      59200052
592100                 LENGTH    (PV-COMMAREA-LENGTH)                   59210052
592200                 RESP      (PV-CICS-RESPONSE)                     59220052
592300         END-EXEC                                                 59230052
592400                                                                  59240052
592500         EVALUATE TRUE                                            59250052
592600             WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)             59260052
592700                  EVALUATE TRUE                                   59270052
592800                      WHEN PC238-MOD-SUCCESSFUL                   59280052
592900                           CONTINUE                               59290052
593000                     WHEN PC238-MOD-UNSUCCESSFUL                  59300052
593100                         PERFORM 8600-MOD-UNSUCCESSFUL            59310052
593200                 END-EVALUATE                                     59320052
593300                                                                  59330052
593400             WHEN OTHER                                           59340052
593500                 MOVE PC238-PO-NBR        TO PC-DISPLAY-PO        59350055
593600                 MOVE PC238-RCVR-SEQ-NBR  TO PC-DISPLAY-RCVR      59360055
593700                 MOVE PC238-PO-LNE-NBR    TO PC-DISPLAY-LINE      59370055
593800                 STRING ' PCKCS722 - '      DELIMITED BY SIZE     59380052
593900                        ' 8500-UPDATE-UNITS-WRKD '                59390052
594100                        ' KEY INFO - '                            59410055
594200                        PC-DISPLAY-PO                             59420055
594300                        ' - '                                     59430055
594400                        PC-DISPLAY-RCVR                           59440055
594500                        ' - '                                     59450055
594600                        PC-DISPLAY-LINE                           59460055
594610                        '  SW:' PS-UNT-WRK-FROM-PICKMADE-SW       59461055
594700                                           DELIMITED BY SIZE      59470056
594710                                      INTO PV-CICS-MSG-AREA       59471056
594800                 MOVE LENGTH OF PV-CICS-MSG-AREA                  59480052
594900                                       TO PV-COMMAREA-LENGTH      59490052
595000                 PERFORM 9990-WRITE-CICS                          59500052
595100         END-EVALUATE                                             59510052
595110     END-IF.                                                      59511052
595200                                                                  59520052
595300                                                                  59530037
595400*----------------------------------------------------------------*59540037
595500*    CALL THE UNITS WORKED UPDATE MODULE PCKCS756                 59550037
595600* UPDATE UNITS WORKED IF AN ORDER HAS BEEN RE-OPENED IN P2L       59560037
595700* 3/20/03                                                         59570037
595800*----------------------------------------------------------------*59580037
595900 8510-UPD-UNITS-WRKD-REOPEN.                                      59590037
596000                                                                  59600037
596200     IF  PV-TEST-CICS                                             59620037
596300         INITIALIZE PV-CICS-MSG-AREA                              59630037
596400         STRING ' PCKCS722 - 8510-UPD-UNITS-WRKD-REOPEN'          59640037
596500                DELIMITED BY SIZE                                 59650037
596600           INTO PV-CICS-MSG-AREA                                  59660037
596700         PERFORM 9990-WRITE-CICS                                  59670037
596800     END-IF.                                                      59680037
596900                                                                  59690037
596910*                                                                 59691055
596920*** 3/8/24 - begin                                                59692055
596930*                                                                 59693055
596940     SET  PS-UNT-WRK-FROM-PICKMADE-NO  TO  TRUE.                  59694055
596950     PERFORM 8550-CHECK-UNT-WRK-PICKMADE.                         59695055
596960*                                                                 59696055
596970*** 3/8/24 - end                                                  59697055
596980*                                                                 59698055
597000     EXEC SQL                                                     59700037
597100         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                59710037
597200     END-EXEC.                                                    59720037
597300                                                                  59730037
597400     IF  PV-TEST-CICS                                             59740037
597500         INITIALIZE PV-CICS-MSG-AREA                              59750037
597600             MOVE PC238-PO-NBR              TO PC-DISPLAY-PO      59760037
597700             MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR    59770037
597800             MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE    59780037
597900             MOVE PC238-WRKD-UNT-QTY        TO PV-DISPLAY-NET     59790037
598000             MOVE PC238-WRKD-OPER-UNT-ID    TO PC-DISPLAY-OPER    59800037
598100             STRING ' PCKCS722 - '                                59810037
598200                    '8510-UPD-UNITS-WRKD-REOPEN  '                59820037
598300                    PC-DISPLAY-OPER '-'                           59830037
598400                    PC-DISPLAY-PO '-'                             59840037
598500                    PC-DISPLAY-RCVR '-'                           59850037
598600                    PC-DISPLAY-LINE '   '                         59860037
598610                    '  SW:' PS-UNT-WRK-FROM-PICKMADE-SW           59861055
598620                    '   '                                         59862055
598700                    PV-DISPLAY-NET      DELIMITED BY SIZE         59870037
598800                                  INTO PV-CICS-MSG-AREA           59880037
598900             MOVE LENGTH OF PV-CICS-MSG-AREA                      59890037
599000                                   TO PV-COMMAREA-LENGTH          59900037
599100             PERFORM 9990-WRITE-CICS                              59910037
599200         INITIALIZE PV-CICS-MSG-AREA                              59920037
599300             MOVE PC238-TOT-QUEUE-ITEMS     TO PV-DISPLAY-NET     59930037
599400             STRING ' PCKCS722 - '                                59940037
599500                    PC238-VRFY-ADJ-QUEUE-NAME  ' - '              59950037
599600                    PV-DISPLAY-NET      DELIMITED BY SIZE         59960037
599700                                  INTO PV-CICS-MSG-AREA           59970037
599800             MOVE LENGTH OF PV-CICS-MSG-AREA                      59980037
599900                                   TO PV-COMMAREA-LENGTH          59990037
600000             PERFORM 9990-WRITE-CICS                              60000037
600100     END-IF.                                                      60010037
600300                                                                  60030037
600400* THIS WILL CALL PCKCS756 WHICH WILL UPDATE THE TABLES FOR UNITS  60040037
600500* WORKED OR VERIFIED                                              60050037
600900                                                                  60090037
600910*                                                                 60091055
600920*        10  PC238-TRANS-TYPE-CDE           PIC  X(1).            60092055
600930* * * *      88  PC238-TRANS-P2L-UPLOAD     VALUE 'P'. * * * *    60093055
600931* * * *      Q - INDICATES ADDITIONAL UNITS VALUE 'Q'. * * * *    60093155
600940*        10  PC238-VERIFY-TYPE-CDE          PIC  X(1).            60094055
600950*            88  PC238-AUTO-VERIFY          VALUE 'A'.            60095055
600960*            88  PC238-MANUAL-VERIFY        VALUE 'M'.            60096055
600970* * * *      88  PC238-NOT-VERIFY           VALUE 'N'. * * * *    60097055
600980*                                                                 60098055
601000     MOVE PV-CURRENT-TMST             TO PC238-WRKD-TMST.         60100037
601100     MOVE SPACES                      TO PC238-PRCG-AREA-CDE.     60110037
601200     MOVE PC-Q                        TO PC238-TRANS-TYPE-CDE.    60120037
601300     MOVE PC-N                        TO PC238-VERIFY-TYPE-CDE.   60130037
601400     MOVE LENGTH OF PC238-COMM-AREA   TO PV-COMMAREA-LENGTH.      60140037
601500                                                                  60150037
601510     IF  PS-UNT-WRK-FROM-PICKMADE                                 60151055
601520         CONTINUE                                                 60152055
601530     ELSE                                                         60153055
601600         EXEC CICS                                                60160055
601700             LINK                                                 60170055
601800                 PROGRAM   (PC-UNTS-WRKD-PGRM-NAME)               60180055
601900                 COMMAREA  (PC238-COMM-AREA)                      60190055
602000                 LENGTH    (PV-COMMAREA-LENGTH)                   60200055
602100                 RESP      (PV-CICS-RESPONSE)                     60210055
602200         END-EXEC                                                 60220055
602300                                                                  60230055
602400         EVALUATE TRUE                                            60240055
602500             WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)             60250055
602600                  EVALUATE TRUE                                   60260055
602700                      WHEN PC238-MOD-SUCCESSFUL                   60270055
602800                           CONTINUE                               60280055
602900                     WHEN PC238-MOD-UNSUCCESSFUL                  60290055
603000                         PERFORM 8600-MOD-UNSUCCESSFUL            60300055
603100                 END-EVALUATE                                     60310055
603200                                                                  60320055
603300             WHEN OTHER                                           60330055
603400                 MOVE PC238-PO-NBR              TO PC-DISPLAY-PO  60340055
603500                 MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR60350055
603600                 MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE60360055
603700                 STRING ' PCKCS722 - '                            60370055
603800                        ' 8510-UPD-UNITS-WRKD-REOPEN '            60380055
604000                        ' KEY INFO - '                            60400055
604100                        PC-DISPLAY-PO                             60410055
604200                        ' - '                                     60420055
604300                        PC-DISPLAY-RCVR                           60430055
604400                        ' - '                                     60440055
604500                        PC-DISPLAY-LINE                           60450055
604510                        '  SW:' PS-UNT-WRK-FROM-PICKMADE-SW       60451055
604520                                            DELIMITED BY SIZE     60452055
604600                                      INTO PV-CICS-MSG-AREA       60460055
604700                 MOVE LENGTH OF PV-CICS-MSG-AREA                  60470055
604800                                       TO PV-COMMAREA-LENGTH      60480055
604900                 PERFORM 9990-WRITE-CICS                          60490055
605000         END-EVALUATE                                             60500055
605010     END-IF.                                                      60501055
605100                                                                  60510037
605101                                                                  60510152
605102*----------------------------------------------------------------*60510252
605103*   Check parm P2lWRK to see if the DC is calculating units      *60510352
605104*   worked based on labor Pickmade or based on verification      *60510452
605105*   If the DC is calculating Units Worked based on Pickmade      *60510552
605106*   then Units Worked Module PCKCS756 will not be called         *60510652
605107*   Date of casepack download (TDISTHD-CRE_TMST) must be after   *60510752
605108*   the timestamp that parm P2LWRK was turned on for the DC.     *60510852
605109*----------------------------------------------------------------*60510952
605110 8550-CHECK-UNT-WRK-PICKMADE.                                     60511052
605200                                                                  60520037
605202     IF  PV-TEST-CICS                                             60520252
605203         INITIALIZE PV-CICS-MSG-AREA                              60520352
605204         STRING ' PCKCS722 - 8550-CHECK-UNT-WRK-PICKMADE'         60520452
605205                DELIMITED BY SIZE                                 60520552
605206           INTO PV-CICS-MSG-AREA                                  60520652
605207         PERFORM 9990-WRITE-CICS                                  60520752
605208     END-IF.                                                      60520852
605209                                                                  60520952
605210     SET PS-UNT-WRK-FROM-PICKMADE-NO  TO  TRUE.                   60521052
605220                                                                  60522052
605226     EXEC SQL                                                     60522652
605227          SELECT A.FUNC_TXT                                       60522752
605228            INTO :PS-UNT-WRK-FROM-PICKMADE-SW                     60522852
605229            FROM TKRPRPM A                                        60522952
605230               , TDISTHD B                                        60523052
605231           WHERE A.INTFC_SYS_CDE     = 'KHL'                      60523152
605232             AND A.SYS_PRC_FUNC_CDE  = 'P2LWRK'                   60523252
605233             AND A.FUNC_PRC_STAT_CDE = 'AC'                       60523352
605234             AND A.FUNC_TXT          = 'Y'                        60523452
605235             AND B.ORD_NBR           = :DK-ORD-NBR                60523552
605236             AND B.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR            60523652
605237             AND B.ORD_LNE_NBR       = :DK-ORD-LNE-NBR            60523752
605238             AND A.LOC_ID            =  B.OPER_UNT_ID             60523852
605239             AND A.FUNC_BEG_TMST    <=  B.CRE_TMST                60523957
605240             AND A.FUNC_END_TMST    >=  B.CRE_TMST                60524057
605241            WITH UR                                               60524152
605242     END-EXEC.                                                    60524252
605243                                                                  60524352
605244     EVALUATE TRUE                                                60524452
605245         WHEN SQLCODE = ZERO                                      60524552
605246              SET PS-UNT-WRK-FROM-PICKMADE     TO  TRUE           60524654
605247                                                                  60524752
605248         WHEN SQLCODE = +100                                      60524852
605249              SET PS-UNT-WRK-FROM-PICKMADE-NO  TO  TRUE           60524952
605250                                                                  60525052
605251         WHEN SQLWARN0 NOT = SPACES                               60525152
605252         WHEN SQLCODE < ZERO                                      60525252
605253         WHEN SQLCODE > ZERO                                      60525352
605256             MOVE '8550-CHECK-UNT-WRK-PICKMADE'                   60525652
605257                                   TO DP013-PARAGRAPH             60525752
605258             STRING 'CHECK IF CALL UNIT WORKED    '               60525852
605259                                      DELIMITED BY SIZE           60525952
605260                                 INTO DP013-MESSAGE-TEXT (1)      60526052
605261             MOVE DK-ORD-NBR       TO PC-DISPLAY-PO               60526152
605262             MOVE DK-REC-SEQ-NBR   TO PC-DISPLAY-RCVR             60526252
605263             MOVE DK-ORD-LNE-NBR   TO PC-DISPLAY-LINE             60526352
605264             STRING ' ' PC-DISPLAY-PO                             60526452
605265                    '-' PC-DISPLAY-RCVR                           60526552
605266                    '-' PC-DISPLAY-LINE                           60526652
605267                                      DELIMITED BY SIZE           60526752
605268                                 INTO DP013-MESSAGE-TEXT (2)      60526852
605269             MOVE SQLCA            TO DP013-SQLCA                 60526952
605270             MOVE 'TKRPRPM '       TO DP013-DB2-TABLE-NAME (1)    60527052
605271             MOVE 'TDISTHD '       TO DP013-DB2-TABLE-NAME (2)    60527152
605272             SET DP013-ROLLBACK                                   60527252
605273                 DP013-DB2-ABEND   TO TRUE                        60527352
605274             PERFORM 9999-WRITE-CICS-LOG-MSG                      60527452
605275     END-EVALUATE.                                                60527552
605276                                                                  60527652
605277     IF  PV-TEST-CICS                                             60527752
605278         INITIALIZE PV-CICS-MSG-AREA                              60527852
605279         IF  PS-UNT-WRK-FROM-PICKMADE                             60527954
605280             STRING ' PCKCS722-UNITS WORKED FROM PICKMADE - YES'  60528052
605281                    DELIMITED BY SIZE                             60528152
605282               INTO PV-CICS-MSG-AREA                              60528252
605283             PERFORM 9990-WRITE-CICS                              60528352
605284                                                                  60528452
605285             MOVE DK-ORD-NBR       TO PC-DISPLAY-PO               60528552
605286             MOVE DK-REC-SEQ-NBR   TO PC-DISPLAY-RCVR             60528652
605287             MOVE DK-ORD-LNE-NBR   TO PC-DISPLAY-LINE             60528752
605288             STRING ' ' PC-DISPLAY-PO                             60528852
605289                    '-' PC-DISPLAY-RCVR                           60528952
605290                    '-' PC-DISPLAY-LINE                           60529052
605291                                      DELIMITED BY SIZE           60529152
605292               INTO PV-CICS-MSG-AREA                              60529252
605293             PERFORM 9990-WRITE-CICS                              60529352
605294         ELSE                                                     60529452
605295             STRING ' PCKCS722-UNITS WORKED FROM PICKMADE - NO'   60529552
605296                    DELIMITED BY SIZE                             60529652
605297               INTO PV-CICS-MSG-AREA                              60529752
605298             PERFORM 9990-WRITE-CICS                              60529852
605299                                                                  60529952
605300             MOVE DK-ORD-NBR       TO PC-DISPLAY-PO               60530052
605301             MOVE DK-REC-SEQ-NBR   TO PC-DISPLAY-RCVR             60530152
605302             MOVE DK-ORD-LNE-NBR   TO PC-DISPLAY-LINE             60530252
605303             STRING ' ' PC-DISPLAY-PO                             60530352
605304                    '-' PC-DISPLAY-RCVR                           60530452
605305                    '-' PC-DISPLAY-LINE                           60530552
605306                                      DELIMITED BY SIZE           60530652
605307               INTO PV-CICS-MSG-AREA                              60530752
605308             PERFORM 9990-WRITE-CICS                              60530852
605309         END-IF                                                   60530952
605310     END-IF.                                                      60531052
605313                                                                  60531352
605314                                                                  60531452
605315*----------------------------------------------------------------*60531552
605316*                                                                *60531652
605317*----------------------------------------------------------------*60531752
605320 8600-MOD-UNSUCCESSFUL.                                           60532037
605400                                                                  60540037
605600     IF  PV-TEST-CICS                                             60560037
605700         INITIALIZE PV-CICS-MSG-AREA                              60570037
605800         STRING ' PCKCS722 - 8600-MOD-UNSUCCESSFUL'               60580037
605900                DELIMITED BY SIZE                                 60590037
606000           INTO PV-CICS-MSG-AREA                                  60600037
606100         PERFORM 9990-WRITE-CICS                                  60610037
606200     END-IF.                                                      60620037
606400                                                                  60640037
606500     MOVE PC238-PO-NBR              TO PC-DISPLAY-PO.             60650037
606600     MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR.           60660037
606700     MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE.           60670037
606800     MOVE PC238-WRKD-OPER-UNT-ID    TO PC-DISPLAY-OPER.           60680037
606900     MOVE PC238-BAD-SQL-CDE         TO PC-DISPLAY-SQL-CODE.       60690037
607000                                                                  60700037
607100     IF  PC238-MOD-BAD-TMST                                       60710037
607200         STRING ' PCKCS722 - '      DELIMITED BY SIZE             60720037
607300                ' 8500-UPDATE-UNITS-WRKD '                        60730037
607400                                    DELIMITED BY SIZE             60740037
607500                ' BAD TIMESTAMP '   DELIMITED BY SIZE             60750037
607600                PC238-WRKD-TMST     DELIMITED BY SIZE             60760037
607700                             INTO PV-CICS-MSG-AREA                60770037
607800         MOVE LENGTH OF PV-CICS-MSG-AREA                          60780037
607900                               TO PV-COMMAREA-LENGTH              60790037
608000         PERFORM 9990-WRITE-CICS                                  60800037
608100         STRING ' PCKCS722 - '      DELIMITED BY SIZE             60810037
608200                ' 8500-UPDATE-UNITS-WRKD '                        60820037
608300                                    DELIMITED BY SIZE             60830037
608400                ' KEY INFO - '      DELIMITED BY SIZE             60840037
608500                PC-DISPLAY-PO       DELIMITED BY SIZE             60850037
608600                ' - '               DELIMITED BY SIZE             60860037
608700                PC-DISPLAY-RCVR     DELIMITED BY SIZE             60870037
608800                ' - '               DELIMITED BY SIZE             60880037
608900                PC-DISPLAY-LINE     DELIMITED BY SIZE             60890037
609000                             INTO PV-CICS-MSG-AREA                60900037
609100         MOVE LENGTH OF PV-CICS-MSG-AREA                          60910037
609200                               TO PV-COMMAREA-LENGTH              60920037
609300         PERFORM 9990-WRITE-CICS                                  60930037
609400     ELSE                                                         60940037
609500     IF  PC238-MOD-BAD-OPER                                       60950037
609600         STRING ' PCKCS722 - '      DELIMITED BY SIZE             60960037
609700                ' 8500-UPDATE-UNITS-WRKD '                        60970037
609800                                    DELIMITED BY SIZE             60980037
609900                ' BAD OPER UNIT '   DELIMITED BY SIZE             60990037
610000                PC-DISPLAY-OPER     DELIMITED BY SIZE             61000037
610100                             INTO PV-CICS-MSG-AREA                61010037
610200         MOVE LENGTH OF PV-CICS-MSG-AREA                          61020037
610300                               TO PV-COMMAREA-LENGTH              61030037
610400         PERFORM 9990-WRITE-CICS                                  61040037
610500         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61050037
610600                ' 8500-UPDATE-UNITS-WRKD '                        61060037
610700                                    DELIMITED BY SIZE             61070037
610800                ' KEY INFO - '      DELIMITED BY SIZE             61080037
610900                PC-DISPLAY-PO       DELIMITED BY SIZE             61090037
611000                ' - '               DELIMITED BY SIZE             61100037
611100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             61110037
611200                ' - '               DELIMITED BY SIZE             61120037
611300                PC-DISPLAY-LINE     DELIMITED BY SIZE             61130037
611400                             INTO PV-CICS-MSG-AREA                61140037
611500         MOVE LENGTH OF PV-CICS-MSG-AREA                          61150037
611600                               TO PV-COMMAREA-LENGTH              61160037
611700         PERFORM 9990-WRITE-CICS                                  61170037
611800     ELSE                                                         61180037
611900     IF  PC238-MOD-BAD-TRANS-TYPE                                 61190037
612000         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61200037
612100                ' 8500-UPDATE-UNITS-WRKD '                        61210037
612200                                    DELIMITED BY SIZE             61220037
612300                ' BAD TRAN TYPE '   DELIMITED BY SIZE             61230037
612400                PC238-TRANS-TYPE-CDE                              61240037
612500                                    DELIMITED BY SIZE             61250037
612600                             INTO PV-CICS-MSG-AREA                61260037
612700         MOVE LENGTH OF PV-CICS-MSG-AREA                          61270037
612800                               TO PV-COMMAREA-LENGTH              61280037
612900         PERFORM 9990-WRITE-CICS                                  61290037
613000         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61300037
613100                ' 8500-UPDATE-UNITS-WRKD '                        61310037
613200                                    DELIMITED BY SIZE             61320037
613300                ' KEY INFO - '      DELIMITED BY SIZE             61330037
613400                PC-DISPLAY-PO       DELIMITED BY SIZE             61340037
613500                ' - '               DELIMITED BY SIZE             61350037
613600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             61360037
613700                ' - '               DELIMITED BY SIZE             61370037
613800                PC-DISPLAY-LINE     DELIMITED BY SIZE             61380037
613900                             INTO PV-CICS-MSG-AREA                61390037
614000         MOVE LENGTH OF PV-CICS-MSG-AREA                          61400037
614100                               TO PV-COMMAREA-LENGTH              61410037
614200         PERFORM 9990-WRITE-CICS                                  61420037
614300     ELSE                                                         61430037
614400     IF  PC238-MOD-BAD-PO                                         61440037
614500         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61450037
614600                ' 8500-UPDATE-UNITS-WRKD '                        61460037
614700                                    DELIMITED BY SIZE             61470037
614800                ' BAD PO NUMBER '   DELIMITED BY SIZE             61480037
614900                PC-DISPLAY-PO       DELIMITED BY SIZE             61490037
615000                             INTO PV-CICS-MSG-AREA                61500037
615100         MOVE LENGTH OF PV-CICS-MSG-AREA                          61510037
615200                               TO PV-COMMAREA-LENGTH              61520037
615300         PERFORM 9990-WRITE-CICS                                  61530037
615400         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61540037
615500                ' 8500-UPDATE-UNITS-WRKD '                        61550037
615600                                    DELIMITED BY SIZE             61560037
615700                ' KEY INFO - '      DELIMITED BY SIZE             61570037
615800                PC-DISPLAY-PO       DELIMITED BY SIZE             61580037
615900                ' - '               DELIMITED BY SIZE             61590037
616000                PC-DISPLAY-RCVR     DELIMITED BY SIZE             61600037
616100                ' - '               DELIMITED BY SIZE             61610037
616200                PC-DISPLAY-LINE     DELIMITED BY SIZE             61620037
616300                             INTO PV-CICS-MSG-AREA                61630037
616400         MOVE LENGTH OF PV-CICS-MSG-AREA                          61640037
616500                               TO PV-COMMAREA-LENGTH              61650037
616600         PERFORM 9990-WRITE-CICS                                  61660037
616700     ELSE                                                         61670037
616800     IF  PC238-MOD-BAD-RCVR                                       61680037
616900         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61690037
617000                ' 8500-UPDATE-UNITS-WRKD '                        61700037
617100                                    DELIMITED BY SIZE             61710037
617200                ' BAD RCVR NBR  '   DELIMITED BY SIZE             61720037
617300                PC-DISPLAY-RCVR     DELIMITED BY SIZE             61730037
617400                             INTO PV-CICS-MSG-AREA                61740037
617500         MOVE LENGTH OF PV-CICS-MSG-AREA                          61750037
617600                               TO PV-COMMAREA-LENGTH              61760037
617700         PERFORM 9990-WRITE-CICS                                  61770037
617800         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61780037
617900                ' 8500-UPDATE-UNITS-WRKD '                        61790037
618000                                    DELIMITED BY SIZE             61800037
618100                ' KEY INFO - '      DELIMITED BY SIZE             61810037
618200                PC-DISPLAY-PO       DELIMITED BY SIZE             61820037
618300                ' - '               DELIMITED BY SIZE             61830037
618400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             61840037
618500                ' - '               DELIMITED BY SIZE             61850037
618600                PC-DISPLAY-LINE     DELIMITED BY SIZE             61860037
618700                             INTO PV-CICS-MSG-AREA                61870037
618800         MOVE LENGTH OF PV-CICS-MSG-AREA                          61880037
618900                               TO PV-COMMAREA-LENGTH              61890037
619000         PERFORM 9990-WRITE-CICS                                  61900037
619100     ELSE                                                         61910037
619200     IF  PC238-MOD-BAD-LINE                                       61920037
619300         STRING ' PCKCS722 - '      DELIMITED BY SIZE             61930037
619400                ' 8500-UPDATE-UNITS-WRKD '                        61940037
619500                                    DELIMITED BY SIZE             61950037
619600                ' BAD LINE NBR  '   DELIMITED BY SIZE             61960037
619700                PC-DISPLAY-LINE     DELIMITED BY SIZE             61970037
619800                             INTO PV-CICS-MSG-AREA                61980037
619900         MOVE LENGTH OF PV-CICS-MSG-AREA                          61990037
620000                               TO PV-COMMAREA-LENGTH              62000037
620100         PERFORM 9990-WRITE-CICS                                  62010037
620200         STRING ' PCKCS722 - '      DELIMITED BY SIZE             62020037
620300                ' 8500-UPDATE-UNITS-WRKD '                        62030037
620400                                    DELIMITED BY SIZE             62040037
620500                ' KEY INFO - '      DELIMITED BY SIZE             62050037
620600                PC-DISPLAY-PO       DELIMITED BY SIZE             62060037
620700                ' - '               DELIMITED BY SIZE             62070037
620800                PC-DISPLAY-RCVR     DELIMITED BY SIZE             62080037
620900                ' - '               DELIMITED BY SIZE             62090037
621000                PC-DISPLAY-LINE     DELIMITED BY SIZE             62100037
621100                             INTO PV-CICS-MSG-AREA                62110037
621200         MOVE LENGTH OF PV-CICS-MSG-AREA                          62120037
621300                               TO PV-COMMAREA-LENGTH              62130037
621400         PERFORM 9990-WRITE-CICS                                  62140037
621500     ELSE                                                         62150037
621600     IF  PC238-MOD-BAD-NO-SHIFT                                   62160037
621700         STRING ' PCKCS722 - '      DELIMITED BY SIZE             62170037
621800                ' 8500-UPDATE-UNITS-WRKD '                        62180037
621900                                    DELIMITED BY SIZE             62190037
622000                ' SHIFT NOT FOUND ' DELIMITED BY SIZE             62200037
622100                PC238-WRKD-TMST     DELIMITED BY SIZE             62210037
622200                ' FOR OPER '        DELIMITED BY SIZE             62220037
622300                PC-DISPLAY-OPER     DELIMITED BY SIZE             62230037
622400                             INTO PV-CICS-MSG-AREA                62240037
622500         MOVE LENGTH OF PV-CICS-MSG-AREA                          62250037
622600                               TO PV-COMMAREA-LENGTH              62260037
622700         PERFORM 9990-WRITE-CICS                                  62270037
622800         STRING ' PCKCS722 - '      DELIMITED BY SIZE             62280037
622900                ' 8500-UPDATE-UNITS-WRKD '                        62290037
623000                                    DELIMITED BY SIZE             62300037
623100                ' KEY INFO - '      DELIMITED BY SIZE             62310037
623200                PC-DISPLAY-PO       DELIMITED BY SIZE             62320037
623300                ' - '               DELIMITED BY SIZE             62330037
623400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             62340037
623500                ' - '               DELIMITED BY SIZE             62350037
623600                PC-DISPLAY-LINE     DELIMITED BY SIZE             62360037
623700                             INTO PV-CICS-MSG-AREA                62370037
623800         MOVE LENGTH OF PV-CICS-MSG-AREA                          62380037
623900                               TO PV-COMMAREA-LENGTH              62390037
624000         PERFORM 9990-WRITE-CICS                                  62400037
624100     ELSE                                                         62410037
624200         STRING ' PCKCS722 - '      DELIMITED BY SIZE             62420037
624300                ' 8500-UPDATE-UNITS-WRKD '                        62430037
624400                                    DELIMITED BY SIZE             62440037
624500                ' DB ERROR - SQL CODE '                           62450037
624600                                    DELIMITED BY SIZE             62460037
624700                PC-DISPLAY-SQL-CODE DELIMITED BY SIZE             62470037
624800                ' FUNC: '           DELIMITED BY SIZE             62480037
624900                PC238-BAD-TABLE-FUNCTION                          62490037
625000                                    DELIMITED BY SIZE             62500037
625100                ' TABLE: '          DELIMITED BY SIZE             62510037
625200                PC238-BAD-TABLE-NAME                              62520037
625300                                    DELIMITED BY SIZE             62530037
625400                             INTO PV-CICS-MSG-AREA                62540037
625500         MOVE LENGTH OF PV-CICS-MSG-AREA                          62550037
625600                               TO PV-COMMAREA-LENGTH              62560037
625700         PERFORM 9990-WRITE-CICS                                  62570037
625800         STRING ' PCKCS722 - '      DELIMITED BY SIZE             62580037
625900                ' 8500-UPDATE-UNITS-WRKD '                        62590037
626000                                    DELIMITED BY SIZE             62600037
626100                ' KEY - '           DELIMITED BY SIZE             62610037
626200                PC-DISPLAY-OPER     DELIMITED BY SIZE             62620037
626300                '-'                 DELIMITED BY SIZE             62630037
626400                PC-DISPLAY-PO       DELIMITED BY SIZE             62640037
626500                '-'                 DELIMITED BY SIZE             62650037
626600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             62660037
626700                '-'                 DELIMITED BY SIZE             62670037
626800                PC-DISPLAY-LINE     DELIMITED BY SIZE             62680037
626900                             INTO PV-CICS-MSG-AREA                62690037
627000         MOVE LENGTH OF PV-CICS-MSG-AREA                          62700037
627100                               TO PV-COMMAREA-LENGTH              62710037
627200         PERFORM 9990-WRITE-CICS                                  62720037
627300     END-IF                                                       62730037
627400     END-IF                                                       62740037
627500     END-IF                                                       62750037
627600     END-IF                                                       62760037
627700     END-IF                                                       62770037
627800     END-IF                                                       62780037
627900     END-IF.                                                      62790037
628000                                                                  62800037
628100 9000-SYNCPOINT.                                                  62810037
628200                                                                  62820037
628400     IF  PV-TEST-CICS                                             62840037
628500         INITIALIZE PV-CICS-MSG-AREA                              62850037
628600         STRING ' PCKCS722 - 9000-SYNCPOINT'                      62860037
628700                DELIMITED BY SIZE                                 62870037
628800           INTO PV-CICS-MSG-AREA                                  62880037
628900         PERFORM 9990-WRITE-CICS                                  62890037
629000     END-IF.                                                      62900037
629200                                                                  62920037
629300     EXEC CICS                                                    62930037
629400         SYNCPOINT                                                62940037
629500     END-EXEC.                                                    62950037
629600                                                                  62960037
629700 9990-WRITE-CICS.                                                 62970037
629800     EXEC CICS                                                    62980037
629900         WRITEQ TD                                                62990037
630000         QUEUE('CSSL')                                            63000037
630100         FROM(PV-CICS-MSG-AREA)                                   63010037
630200         RESP(PV-CICS-RESPONSE)                                   63020037
630300     END-EXEC.                                                    63030037
630400                                                                  63040037
630500     MOVE SPACES TO PV-CICS-MSG-AREA.                             63050037
630600*                                                                 63060037
630700 9995-WRITE-CICS.                                                 63070037
630800                                                                  63080037
630900* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  63090037
631000* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       63100037
631100* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 63110037
631200* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     63120037
631300* WRAPPED AROUND.                                                 63130037
631400                                                                  63140037
631500     EVALUATE TRUE                                                63150037
631600     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          63160037
631700         MOVE EIBTASKN                TO PT-TASK(PT-MSG-IDX)      63170037
631800         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 63180037
631900         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         63190037
632000         SET PT-MSG-IDX UP BY 1                                   63200037
632100                                                                  63210037
632200     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          63220037
632300         MOVE EIBTASKN                TO PT-TASK(PT-MSG-IDX)      63230037
632400         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 63240037
632500         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         63250037
632600         SET PT-MSG-IDX               TO 1                        63260037
632700     END-EVALUATE.                                                63270037
632800                                                                  63280037
632900     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1.             63290037
633000     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX). 63300037
633100                                                                  63310037
633200     MOVE SPACES                      TO PV-CICS-MSG-AREA.        63320037
633300                                                                  63330037
633400************************************************************      63340037
633500**                                                                63350037
633600************************************************************      63360037
633700 9999-WRITE-CICS-LOG-MSG.                                         63370037
633800                                                                  63380037
634000     IF  PV-TEST-CICS                                             63400037
634100         INITIALIZE PV-CICS-MSG-AREA                              63410037
634200         STRING ' PCKCS722 - 9999-WRITE-CICS-LOG-MSG'             63420037
634300                DELIMITED BY SIZE                                 63430037
634400           INTO PV-CICS-MSG-AREA                                  63440037
634500         PERFORM 9990-WRITE-CICS                                  63450037
634600     END-IF.                                                      63460037
634800                                                                  63480037
634900     MOVE PC-CURRENT-PGM-NAME  TO  DP013-PROGRAM.                 63490037
635000     MOVE DFHEIBLK             TO  DP013-DFHEIBLK.                63500037
635100                                                                  63510037
635200     INITIALIZE DP013-SRC-TASK-NUMBER                             63520037
635300                DP013-STACK.                                      63530037
635400     SET DP013-LINK-RETURN     TO TRUE.                           63540037
635500                                                                  63550037
635600     EXEC CICS                                                    63560037
635700         LINK                                                     63570037
635800             PROGRAM   (DP013-NAME)                               63580037
635900             COMMAREA  (DP013-PARAMETERS)                         63590037
636000             LENGTH    (DP013-LENGTH)                             63600037
636100     END-EXEC.                                                    63610037
636200                                                                  63620037
636300     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 63630037
636400                     PT-MSG-LINE(PT-MSG-IDX) = SPACES             63640037
636500                     OR PT-MSG-IDX > 200                          63650037
636600         MOVE PT-MSG-LINE(PT-MSG-IDX) TO PV-CICS-MSG-AREA         63660037
636700         PERFORM 9990-WRITE-CICS                                  63670037
636800     END-PERFORM.                                                 63680037
636900                                                                  63690037
637000     EXEC CICS                                                    63700037
637100         RETURN                                                   63710037
637200     END-EXEC.                                                    63720037
637300*                                                                 63730037
