000100*----------------------------------------------------------------*05/02/95
000200 IDENTIFICATION DIVISION.                                         DPKCS036
000300*----------------------------------------------------------------*   LV002
000400 PROGRAM-ID.    TRKCS182.                                         DPKCS036
000500 AUTHOR.        NIRMAL KUMAR.                                     DPKCS036
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
000700 DATE-WRITTEN.  03-13-98.                                         DPKCS036
000800 DATE-COMPILED.                                                   DPKCS036
000900                                                                  DPKCS036
001000*---------------------------------------------------------------* DPKCS036
001100*    Y182 - VESSEL/VOYAGE DETAIL PROGRAM.                       * DPKCS036
001200*                                                               * DPKCS036
001300*    THIS PROGRAM GENERATES A LIST OF ALL OCCURENCES OF A       * DPKCS036
001400*    CONTAINER BY VESSEL/VOYAGE. THE APPROPRIATE PROGRAM IS     * DPKCS036
001500*    INVOKED WHEN THE OPERATOR SELECTS ONE OR MORE ITEMS AND    * DPKCS036
001600*    PRESSES A FUNCTION KEY.                                    * DPKCS036
001700*                                                               * DPKCS036
001800*---------------------------------------------------------------* DPKCS036
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  DPKCS036
002000 ENVIRONMENT DIVISION.                                            DPKCS036
002100                                                                  DPKCS036
002200 DATA DIVISION.                                                   DPKCS036
002300                                                                  DPKCS036
002400 WORKING-STORAGE SECTION.                                         DPKCS036
002500                                                                  DPKCS036
002600 01  DK-DB2-KEYS.                                                 DPKCS036
002700     05  DK-VSL-NAME                    PIC  X(25)  VALUE SPACE.  DPKCS036
002800     05  DK-VOY-NBR                     PIC  X(10)  VALUE SPACE.  DPKCS036
002900                                                                  DPKCS036
003000 01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
003200                                                    'TR182A  '.   DPKCS036
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
003400                                                    'TRKM182 '.   DPKCS036
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
003600                                                    'TRKCS182'.   DPKCS036
003700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
003800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
003900     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    DPKCS036
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     DPKCS036
004100                                                    COMP SYNC.    DPKCS036
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
004300                                                    COMP SYNC.    DPKCS036
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
004500                                                    +1000000      DPKCS036
004600                                                    COMP-3.       DPKCS036
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
004800                                                    COMP SYNC.    DPKCS036
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
005000                                                    COMP-3.       DPKCS036
005100     05  PC-INIT-DATE                   PIC  X(10)  VALUE         DPKCS036
005200                                                    '0001-01-01'. DPKCS036
005300     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    DPKCS036
005400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
005500                                                                  DPKCS036
005600     05  PC-TSYMSG-NUMBERS.                                       DPKCS036
005700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
005800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
005900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  DPKCS036
006000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
006100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
006200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
006300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
006400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
006500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
006600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
006700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
006800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
006900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
007000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
007100                                                                  DPKCS036
007200 01  PS-PROGRAM-SWITCHES.                                         DPKCS036
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
007400         88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
007500         88  PS-ERROR                               VALUE 'N'.    DPKCS036
007600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
007700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
007800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
007900                                                                  DPKCS036
008000 01  PV-PROGRAM-VARIABLES.                                        DPKCS036
008100     05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
008200                                                    COMP SYNC.    DPKCS036
008300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
008400                                                    COMP SYNC.    DPKCS036
008500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
008600                                                    COMP-3.       DPKCS036
008700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
008800                                                    COMP-3.       DPKCS036
008900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
009000                                                    COMP-3.       DPKCS036
009100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
009200                                                    COMP-3.       DPKCS036
009300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
009400                                                    COMP-3.       DPKCS036
009500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
009600                                                    COMP-3.       DPKCS036
009700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
009800                                                    COMP-3.       DPKCS036
009900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
010000                                                    COMP SYNC.    DPKCS036
010100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
010200                                                    COMP SYNC.    DPKCS036
010300     05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
010400                                                    COMP SYNC.    DPKCS036
010500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
010600                                                    COMP SYNC.    DPKCS036
010700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
010800                                                    COMP SYNC.    DPKCS036
010900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
011000                                                    COMP SYNC.    DPKCS036
011100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
011200                                                    COMP SYNC.    DPKCS036
011300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
011400                                                    COMP SYNC.    DPKCS036
011500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011600                                                    COMP SYNC.    DPKCS036
011700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011800                                                    COMP SYNC.    DPKCS036
011900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
012000                                                    COMP SYNC.    DPKCS036
012100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
012200                                                    COMP SYNC.    DPKCS036
012300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
012400                                                    COMP SYNC.    DPKCS036
012500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
012600                                                    COMP SYNC.    DPKCS036
012700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
012800                                                    COMP SYNC.    DPKCS036
012900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
013000                                                    COMP SYNC.    DPKCS036
013100     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      DPKCS036
013200                                                    COMP-3.       DPKCS036
013300     05  PV-DATE-BREAK.                                           DPKCS036
013400         10 FILLER                      PIC  X(02).               DPKCS036
013500         10 PV-DB-YY                    PIC  X(02).               DPKCS036
013600         10 FILLER                      PIC  X(01).               DPKCS036
013700         10 PV-DB-MM                    PIC  X(02).               DPKCS036
013800         10 FILLER                      PIC  X(01).               DPKCS036
013900         10 PV-DB-DD                    PIC  X(02).               DPKCS036
014000                                                                  DPKCS036
014100     05 PV-DATE-DISPLAY.                                          DPKCS036
014200         10 PV-DD-MM                    PIC  X(02).               DPKCS036
014300         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
014400         10 PV-DD-DD                    PIC  X(02).               DPKCS036
014500         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
014600         10 PV-DD-YY                    PIC  X(02).               DPKCS036
014700                                                                  DPKCS036
014800**--------------------------------------------------------------**DPKCS036
014900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **DPKCS036
015000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **DPKCS036
015100**  APPLICATION-SPECIFIC COMMAREA.                              **DPKCS036
015200**--------------------------------------------------------------**DPKCS036
015300 01  LQW-LIST-QUEUE-WORK-AREA.                                    DPKCS036
015400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  DPKCS036
015500     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           DPKCS036
015600                                        INDEXED BY LQW-IDX.       DPKCS036
015700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       DPKCS036
015800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
015900         10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
016000             88  LQW-SELECT                         VALUE 'S'.    DPKCS036
016100             88  LQW-DESELECT                       VALUE ' '.    DPKCS036
016200         10  LQW-ACTION                 PIC  X(03).               DPKCS036
016300         10  LQW-CONTNR-NO              PIC  X(12).               DPKCS036
016400         10  LQW-FOB                    PIC  X(03).               DPKCS036
016500         10  LQW-ATD                    PIC  X(08).               DPKCS036
016600         10  LQW-ATA                    PIC  X(08).               DPKCS036
016700         10  LQW-PO-CNT                 PIC  9(03).               DPKCS036
016710         10  LQW-CARR-SCAC-ID           PIC  X(04).               DPKCS036
016800         10  LQW-CONTNR-SEQ-NO          PIC S9(04) COMP.          DPKCS036
016900                                                                  DPKCS036
017000 EJECT                                                            DPKCS036
017100*---------------------------------------------------------------* DPKCS036
017200*  RECORD LAYOUT FOR THE VOYAGE  SELECTION TEMP STORAGE QUEUE.  * DPKCS036
017300*---------------------------------------------------------------* DPKCS036
017400                                                                  DPKCS036
017500     COPY TRWS101.                                                DPKCS036
017600                                                                  DPKCS036
017700 EJECT                                                            DPKCS036
017800*---------------------------------------------------------------* DPKCS036
017900*    MAP LAYOUT                                                 * DPKCS036
018000*---------------------------------------------------------------* DPKCS036
018100                                                                  DPKCS036
018200     COPY TRKM182.                                                DPKCS036
018300                                                                  DPKCS036
018400 01  MR-OCCURS-LAYOUT                   REDEFINES  TR182AO.       DPKCS036
018500     05  FILLER                         PIC X(87).                DPKCS036
018600     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          DPKCS036
018700         10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
018800         10  MR-SELECTA                 PIC  X(01).               DPKCS036
018900         10  MR-SELECTC                 PIC  X(01).               DPKCS036
019000         10  MR-SELECTH                 PIC  X(01).               DPKCS036
019100         10  MR-SELECTI                 PIC  X(01).               DPKCS036
019200                                                                  DPKCS036
019300         10  MR-ACTIONL                 PIC S9(04) COMP.          DPKCS036
019400         10  MR-ACTIONA                 PIC  X(01).               DPKCS036
019500         10  MR-ACTIONC                 PIC  X(01).               DPKCS036
019600         10  MR-ACTIONH                 PIC  X(01).               DPKCS036
019700         10  MR-ACTION                  PIC  X(03).               DPKCS036
019800                                                                  DPKCS036
019900         10  MR-CONTNR-NOL              PIC S9(04) COMP.          DPKCS036
020000         10  MR-CONTNR-NOA              PIC  X(01).               DPKCS036
020100         10  MR-CONTNR-NOC              PIC  X(01).               DPKCS036
020200         10  MR-CONTNR-NOH              PIC  X(01).               DPKCS036
020300         10  MR-CONTNR-NO               PIC  X(12).               DPKCS036
020400                                                                  DPKCS036
020500         10  MR-FOBL                    PIC S9(04) COMP.          DPKCS036
020600         10  MR-FOBA                    PIC  X(01).               DPKCS036
020700         10  MR-FOBC                    PIC  X(01).               DPKCS036
020800         10  MR-FOBH                    PIC  X(01).               DPKCS036
020900         10  MR-FOB                     PIC  X(03).               DPKCS036
021000                                                                  DPKCS036
021100         10  MR-ATDL                    PIC S9(04) COMP.          DPKCS036
021200         10  MR-ATDA                    PIC  X(01).               DPKCS036
021300         10  MR-ATDC                    PIC  X(01).               DPKCS036
021400         10  MR-ATDH                    PIC  X(01).               DPKCS036
021500         10  MR-ATD                     PIC  X(08).               DPKCS036
021600                                                                  DPKCS036
021700         10  MR-ATAL                    PIC S9(04) COMP.          DPKCS036
021800         10  MR-ATAA                    PIC  X(01).               DPKCS036
021900         10  MR-ATAC                    PIC  X(01).               DPKCS036
022000         10  MR-ATAH                    PIC  X(01).               DPKCS036
022100         10  MR-ATA                     PIC  X(08).               DPKCS036
022200                                                                  DPKCS036
022300         10  MR-PO-CNTL                 PIC S9(04) COMP.          DPKCS036
022400         10  MR-PO-CNTA                 PIC  X(01).               DPKCS036
022500         10  MR-PO-CNTC                 PIC  X(01).               DPKCS036
022600         10  MR-PO-CNTH                 PIC  X(01).               DPKCS036
022700         10  MR-PO-CNT                  PIC  ZZZ.                 DPKCS036
022701                                                                  DPKCS036
022702         10  MR-CARR-SCACL              PIC S9(04) COMP.          DPKCS036
022703         10  MR-CARR-SCACA              PIC  X(01).               DPKCS036
022704         10  MR-CARR-SCACC              PIC  X(01).               DPKCS036
022705         10  MR-CARR-SCACH              PIC  X(01).               DPKCS036
022706         10  MR-CARR-SCAC               PIC  X(04).               DPKCS036
022800                                                                  DPKCS036
022900     05  FILLER                         PIC  X(12).               DPKCS036
023000                                                                  DPKCS036
023100 EJECT                                                            DPKCS036
023200*---------------------------------------------------------------* DPKCS036
023300*    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
023400*---------------------------------------------------------------* DPKCS036
023500                                                                  DPKCS036
023600     COPY DPWS015.                                                DPKCS036
023700                                                                  DPKCS036
023800 EJECT                                                            DPKCS036
023900*---------------------------------------------------------------* DPKCS036
024000*    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
024100*---------------------------------------------------------------* DPKCS036
024200                                                                  DPKCS036
024300     COPY DPWS016.                                                DPKCS036
024400                                                                  DPKCS036
024500 EJECT                                                            DPKCS036
024600*---------------------------------------------------------------* DPKCS036
024700*    NUMERIC EDIT LAYOUT.                                       * DPKCS036
024800*---------------------------------------------------------------* DPKCS036
024900                                                                  DPKCS036
025000     COPY DPWS010I.                                               DPKCS036
025100                                                                  DPKCS036
025200 EJECT                                                            DPKCS036
025300*---------------------------------------------------------------* DPKCS036
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
025500*---------------------------------------------------------------* DPKCS036
025600                                                                  DPKCS036
025700     COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
025900 EJECT                                                            DPKCS036
026000*---------------------------------------------------------------* DPKCS036
026100*    STANDARD COMMAREA.                                         * DPKCS036
026200*---------------------------------------------------------------* DPKCS036
026300                                                                  DPKCS036
026400     COPY DPWS020.                                                DPKCS036
026500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
026600*---------------------------------------------------------------* DPKCS036
026700* INTER-APPLICATION COMMAREA.                                   * DPKCS036
026800*   TRWS102 - IS THE INPUT LAYOUT WHEN COMING FROM THE VESSEL   * DPKCS036
026900*             LIST SCREEN.                                      * DPKCS036
027000*   TRWS104 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * DPKCS036
027100*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * DPKCS036
027101*   TRWS198 - IS THE INPUT LAYOUT WHEN COMING FROM THE CONTAINER* DPKCS036
027102*             LIST SCREEN.                                      * DPKCS036
027200*---------------------------------------------------------------* DPKCS036
027300         10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
027400     COPY TRWS102.                                                DPKCS036
027500     COPY TRWS104.                                                DPKCS036
027510     COPY TRWS198.                                                DPKCS036
027600                                                                  DPKCS036
027700 EJECT                                                            DPKCS036
027800*---------------------------------------------------------------* DPKCS036
027900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
028000*---------------------------------------------------------------* DPKCS036
028100         10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
028200             15  ASC-LIST-KEYS.                                   DPKCS036
028300                 20  ASC-KEY-VSL-NAME                PIC  X(25).  DPKCS036
028400                 20  ASC-KEY-VOY-NBR                 PIC  X(10).  DPKCS036
028500                                                                  DPKCS036
028600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
028700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
028800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
028900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
029000                                                                  DPKCS036
029100                 20  ASC-ITEM-ARRAY.                              DPKCS036
029200                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        DPKCS036
029300                         30  ASC-LIST-ITEM-NUMBER                 DPKCS036
029400                                                     PIC S9(09)   DPKCS036
029500                                                     COMP-3.      DPKCS036
029600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
029700                             88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
029800                                                           'S'    DPKCS036
029900                                                           'B'    DPKCS036
030000                                                           'E'.   DPKCS036
030100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
030200                             88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
030300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
030400                             88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
030500                         30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
030600                             88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
030700                             88  ASC-SELECT          VALUE 'S'.   DPKCS036
030800                             88  ASC-BEGIN           VALUE 'B'.   DPKCS036
030900                             88  ASC-END             VALUE 'E'.   DPKCS036
031000                         30  ASC-ACTION              PIC  X(03).  DPKCS036
031100                         30  ASC-CONTNR-NO           PIC  X(12).  DPKCS036
031200                         30  ASC-FOB                 PIC  X(03).  DPKCS036
031300                         30  ASC-ATD                 PIC  X(08).  DPKCS036
031400                         30  ASC-ATA                 PIC  X(08).  DPKCS036
031500                         30  ASC-PO-CNT              PIC  9(03).  DPKCS036
031510                         30  ASC-CARR-SCAC-ID        PIC  X(04).          
031600                         30  ASC-CONTNR-SEQ-NO       PIC S9(04)   DPKCS036
031700                                                          COMP.   DPKCS036
031800                                                                  DPKCS036
031900             15  ASC-BLK-SUB                         PIC S9(04)   DPKCS036
032000                                                          COMP    DPKCS036
032100                                                          SYNC.   DPKCS036
032200             15  ASC-ITEM-SUB                        PIC S9(04)   DPKCS036
032300                                                          COMP    DPKCS036
032400                                                          SYNC.   DPKCS036
032500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   DPKCS036
032600                                                          COMP-3. DPKCS036
032700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   DPKCS036
032800                                                          COMP-3. DPKCS036
032900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   DPKCS036
033000                                                          COMP-3. DPKCS036
033100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   DPKCS036
033200                                                          COMP-3. DPKCS036
033300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   DPKCS036
033400                                                          COMP-3. DPKCS036
033500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   DPKCS036
033600                                                          COMP    DPKCS036
033700                                                          SYNC.   DPKCS036
033800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   DPKCS036
033900                                                          COMP-3. DPKCS036
034000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   DPKCS036
034100                                                          COMP-3. DPKCS036
034200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
034300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   DPKCS036
034400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   DPKCS036
034500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  DPKCS036
034600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
034700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
034800             15  ASC-LIST-QUEUE-NAME.                             DPKCS036
034900                 20  ASC-LIST-TERM-ID                PIC  X(04).  DPKCS036
035000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   DPKCS036
035100                                                          COMP-3. DPKCS036
035200                 20  ASC-LIST-SEQ                    PIC  9(01).  DPKCS036
035300             15  ASC-SEL-QUEUE-NAME.                              DPKCS036
035400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  DPKCS036
035500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   DPKCS036
035600                                                          COMP-3. DPKCS036
035700                 20  ASC-SEL-SEQ                     PIC  9(01).  DPKCS036
035800                                                                  DPKCS036
035900             15  ASC-START-ITEM-REQUEST.                          DPKCS036
036000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  DPKCS036
036100                                                                  DPKCS036
036200 EJECT                                                            DPKCS036
036300*---------------------------------------------------------------* DPKCS036
036400*    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
036500*---------------------------------------------------------------* DPKCS036
036600                                                                  DPKCS036
036700     COPY DPWS013.                                                DPKCS036
036800                                                                  DPKCS036
036900 EJECT                                                            DPKCS036
037000*---------------------------------------------------------------* DPKCS036
037100*    DB2 AREA FOR TIMCNTK                                       * DPKCS036
037200*---------------------------------------------------------------* DPKCS036
037300     EXEC SQL                                                     DPKCS036
037400          INCLUDE TIMCNTK                                         DPKCS036
037500     END-EXEC.                                                    DPKCS036
037600*---------------------------------------------------------------* DPKCS036
037700*    DB2 AREA FOR TIMFOB                                        * DPKCS036
037800*---------------------------------------------------------------* DPKCS036
037900     EXEC SQL                                                     DPKCS036
038000          INCLUDE TIMFOB                                          DPKCS036
038100     END-EXEC.                                                    DPKCS036
038200*---------------------------------------------------------------* DPKCS036
038300*    DB2 AREA FOR TIMCNPO                                       * DPKCS036
038400*---------------------------------------------------------------* DPKCS036
038500     EXEC SQL                                                     DPKCS036
038600          INCLUDE TIMCNPO                                         DPKCS036
038700     END-EXEC.                                                    DPKCS036
038800*---------------------------------------------------------------* DPKCS036
038900*    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
039000*---------------------------------------------------------------* DPKCS036
039100     EXEC SQL                                                     DPKCS036
039200          INCLUDE SQLCA                                           DPKCS036
039300     END-EXEC.                                                    DPKCS036
039400*---------------------------------------------------------------* DPKCS036
039500*    CURSOR WHEN VESSEL NAME IS REQUESTED                       * DPKCS036
039600*---------------------------------------------------------------* DPKCS036
039700                                                                  DPKCS036
039800     EXEC SQL                                                     DPKCS036
039900          DECLARE VSL-DTL-CSR CURSOR                              DPKCS036
040000          FOR SELECT                                              DPKCS036
040100                A.CONTNR_ID                                       DPKCS036
040200              , A.FDR_FOB_CDE                                     DPKCS036
040300              , A.MOM_FOB_CDE                                     DPKCS036
040400              , A.FDR_DPRTR_TMST                                  DPKCS036
040500              , A.MOM_DPRTR_TMST                                  DPKCS036
040600              , A.CONTNR_SEQ_NBR                                  DPKCS036
040700              , A.MOM_TRIP_TYP_CDE                                DPKCS036
040710              , A.MOM_CARR_SCAC_ID                                        
040800              , A.FDR_TRIP_TYP_CDE                                DPKCS036
040900              , A.ACTL_POE_DELY_TMST                              DPKCS036
041000          FROM                                                    DPKCS036
041100                TIMCNTK A                                         DPKCS036
041200          WHERE                                                   DPKCS036
041300                A.MOM_IMPRT_VEH_NM  = :DK-VSL-NAME                DPKCS036
041400          AND   A.MOM_IMPRT_TRIP_ID = :DK-VOY-NBR                 DPKCS036
041500          ORDER BY                                                DPKCS036
041600                A.CONTNR_ID                                       DPKCS036
041700     END-EXEC.                                                    DPKCS036
041800                                                                  DPKCS036
041900 EJECT                                                            DPKCS036
042000*                                                                 DPKCS036
042100 LINKAGE SECTION.                                                 DPKCS036
042200                                                                  DPKCS036
042300 01  DFHCOMMAREA.                                                 DPKCS036
042400     05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
042500                                        DEPENDING ON EIBCALEN.    DPKCS036
042600         10  FILLER                     PIC X.                    DPKCS036
042700                                                                  DPKCS036
042800 EJECT                                                            DPKCS036
042900*----------------------------------------------------------------*DPKCS036
043000 PROCEDURE DIVISION.                                              DPKCS036
043100*----------------------------------------------------------------*DPKCS036
043200*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *DPKCS036
043300*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *DPKCS036
043400*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *DPKCS036
043500*----------------------------------------------------------------*DPKCS036
043600 0000-MAIN-MODULE.                                                DPKCS036
043700                                                                  DPKCS036
043800     INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
043900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
044000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
044100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
044200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
044300     MOVE LENGTH OF TR182AI        TO DP030-MAP-LENGTH (1).       DPKCS036
044400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
044500     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
044600*                                                                 DPKCS036
044700     PERFORM 1000-CONTROL-PROCESSING                              DPKCS036
044800*                                                                 DPKCS036
044900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
045000     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
045100                                                                  DPKCS036
045200**--------------------------------------------------------------**DPKCS036
045300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **DPKCS036
045400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **DPKCS036
045500**--------------------------------------------------------------**DPKCS036
045600 0001-CALL-CICS-ARCH-API.                                         DPKCS036
045700                                                                  DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      DPKCS036
045900                                    DFHCOMMAREA                           
046000                                    DP030-CICS-API-FIELDS                 
046100                                    DP020-STANDARD-COMMAREA               
046200                                    TR182AI.                              
046300*                                                                 DPKCS036
046400     IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
046500         CONTINUE                                                 DPKCS036
046600     ELSE                                                         DPKCS036
046700         SET DP013-NO-ROLLBACK                                    DPKCS036
046800             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
046900             DP013-CICS-ABEND      TO TRUE                        DPKCS036
047000         MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
047100                                   TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE ODPKCS036
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      DPKCS036
047400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
047500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
047600     END-IF.                                                      DPKCS036
047700                                                                  DPKCS036
047800 EJECT                                                            DPKCS036
047900*----------------------------------------------------------------*DPKCS036
048000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
048100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
048200*                                                                *DPKCS036
048300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
048400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
048500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
048600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
048700*----------------------------------------------------------------*DPKCS036
048800 1000-CONTROL-PROCESSING.                                         DPKCS036
048900                                                                  DPKCS036
049000     EVALUATE TRUE                                                DPKCS036
049100         WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
049200             INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
049300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
049400                                      ASC-SEL-TERM-ID             DPKCS036
049500             MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
049600                                   TO ASC-LIST-TASK-NUMBER        DPKCS036
049700                                      ASC-SEL-TASK-NUMBER         DPKCS036
049800             MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
049900                                   TO ASC-LIST-SEQ                DPKCS036
050000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
050100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
050200***-----$TEMPLATE NOTE$-------------------------------------------DPKCS036
050300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,DPKCS036
050400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  DPKCS036
050500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.DPKCS036
050600***---------------------------------------------------------------DPKCS036
050700             IF  PS-COMMAREA-NOT-VALID                            DPKCS036
050800                 SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
050900                                   TO TRUE                        DPKCS036
051000             ELSE                                                 DPKCS036
051100                 PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
051200             END-IF                                               DPKCS036
051300                                                                  DPKCS036
051400         WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
051500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
051600                                   TO PV-TOP-ITEM                 DPKCS036
051700             PERFORM 2000-PROCESS-PANEL                           DPKCS036
051800                                                                  DPKCS036
051900         WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
052000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
052100                                   TO PV-TOP-ITEM                 DPKCS036
052200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
052300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 DPKCS036
052400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
052500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
052600                                                                  DPKCS036
052700         WHEN OTHER                                               DPKCS036
052800             SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
052900             SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
053000             MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
053100                                   TO DP013-PARAGRAPH             DPKCS036
053200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
053300                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
053400             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
053500     END-EVALUATE.                                                DPKCS036
053600                                                                  DPKCS036
053700 EJECT                                                            DPKCS036
053800*----------------------------------------------------------------*DPKCS036
053900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
054000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
054100*----------------------------------------------------------------*DPKCS036
054200 1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
054300                                                                  DPKCS036
054400     SET PS-COMMAREA-VALID         TO TRUE.                       DPKCS036
054500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
054600*                                                                 DPKCS036
054700     IF  DP020-INT-APPL-FORMAT-IND = PC-LIST-FORMAT               DPKCS036
054800         MOVE TR104-VSL-NAME       TO ASC-KEY-VSL-NAME            DPKCS036
054900                                      DK-VSL-NAME                 DPKCS036
055000         MOVE TR104-VOY-NBR        TO ASC-KEY-VOY-NBR             DPKCS036
055100                                      DK-VOY-NBR                  DPKCS036
055200     END-IF.                                                      DPKCS036
055300                                                                  DPKCS036
055400 EJECT                                                            DPKCS036
055500*----------------------------------------------------------------*DPKCS036
055600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *DPKCS036
055700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
055800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
055900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
056000* FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
056100*----------------------------------------------------------------*DPKCS036
056200 2000-PROCESS-PANEL.                                              DPKCS036
056300                                                                  DPKCS036
056400     EVALUATE TRUE                                                DPKCS036
056500         WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
056600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
056700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
056800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
056900                                                                  DPKCS036
057000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
057100             MOVE ASC-KEY-VSL-NAME TO DK-VSL-NAME                 DPKCS036
057200             MOVE ASC-KEY-VOY-NBR  TO DK-VOY-NBR                  DPKCS036
057300             PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
057400             PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
057500                                                                  DPKCS036
057600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    DPKCS036
057700             PERFORM 2140-DESELECT-ALL-ITEMS                      DPKCS036
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
057900                                                                  DPKCS036
058000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  DPKCS036
058100             PERFORM 2150-SELECT-ALL-ITEMS                        DPKCS036
058200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
058300                                                                  DPKCS036
058400         WHEN OTHER                                               DPKCS036
058500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 DPKCS036
058600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
058700             IF  PS-NO-ERROR                                      DPKCS036
058800                 SET DP030-CONTINUE-GO                            DPKCS036
058900                                 TO TRUE                          DPKCS036
059000                 PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
059100             ELSE                                                 DPKCS036
059200                 SET DP030-OVERRIDE-GO                            DPKCS036
059300                                 TO TRUE                          DPKCS036
059400             END-IF                                               DPKCS036
059500     END-EVALUATE.                                                DPKCS036
059600                                                                  DPKCS036
059700 EJECT                                                            DPKCS036
059800*----------------------------------------------------------------*DPKCS036
059900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
060000*----------------------------------------------------------------*DPKCS036
060100 2050-DELETE-LIST-QUEUE.                                          DPKCS036
060200                                                                  DPKCS036
060300     EXEC CICS                                                    DPKCS036
060400         DELETEQ TS                                               DPKCS036
060500             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
060600             RESP  (PV-CICS-RESP)                                 DPKCS036
060700     END-EXEC.                                                    DPKCS036
060800                                                                  DPKCS036
060900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
061000        (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
061100         CONTINUE                                                 DPKCS036
061200     ELSE                                                         DPKCS036
061300         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
061400         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
061500                                                                  DPKCS036
061600         MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
061700                                   TO DP013-PARAGRAPH             DPKCS036
061800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
061900                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
062000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
062100     END-IF.                                                      DPKCS036
062200                                                                  DPKCS036
062300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
062400                                                                  DPKCS036
062500 EJECT                                                            DPKCS036
062600*----------------------------------------------------------------*DPKCS036
062700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
062800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
062900* CICS ARCHITECTURE API.                                         *DPKCS036
063000*----------------------------------------------------------------*DPKCS036
063100 2100-CHECK-FUNCTION-KEY.                                         DPKCS036
063200                                                                  DPKCS036
063300     EVALUATE TRUE                                                DPKCS036
063400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              DPKCS036
063500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              DPKCS036
063510         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              DPKCS036
063600             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                 DPKCS036
063700                 INITIALIZE TR102-INTER-APPL-COMMAREA             DPKCS036
063800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
063900                                TO TR102-NUMBER-OF-SELECTED-ITEMS DPKCS036
064000                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
064100             ELSE                                                 DPKCS036
064200                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             DPKCS036
064300                     SET DP030-OVERRIDE-GO                        DPKCS036
064400                                      TO TRUE                     DPKCS036
064500                     MOVE PC-TSYMSG-00047                         DPKCS036
064600                                      TO DP020-MSG-NUMBER         DPKCS036
064700                     SET DP020-MSG-WARNING                        DPKCS036
064800                                      TO TRUE                     DPKCS036
064900                 ELSE                                             DPKCS036
065000                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         DPKCS036
065100                         SET DP030-OVERRIDE-GO                    DPKCS036
065200                                      TO TRUE                     DPKCS036
065300                         MOVE PC-TSYMSG-00057                     DPKCS036
065400                                      TO DP020-MSG-NUMBER         DPKCS036
065500                         SET DP020-MSG-WARNING                    DPKCS036
065600                                      TO TRUE                     DPKCS036
065700                     END-IF                                       DPKCS036
065800                 END-IF                                           DPKCS036
065900             END-IF                                               DPKCS036
066000                                                                  DPKCS036
066001         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              DPKCS036
066002             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1                 DPKCS036
066003                 INITIALIZE TR198-INTER-APPL-COMMAREA             DPKCS036
066004                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
066005                                TO TR198-NUMBER-OF-SELECTED-ITEMS DPKCS036
066006                 MOVE ASC-KEY-VSL-NAME TO TR198-VSL-NAME                  
066007                 MOVE ASC-KEY-VOY-NBR  TO TR198-VOY-NBR                   
066008                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
066009             ELSE                                                 DPKCS036
066010                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             DPKCS036
066011                     SET DP030-OVERRIDE-GO                        DPKCS036
066012                                      TO TRUE                     DPKCS036
066013                     MOVE PC-TSYMSG-00047                         DPKCS036
066014                                      TO DP020-MSG-NUMBER         DPKCS036
066015                     SET DP020-MSG-WARNING                        DPKCS036
066016                                      TO TRUE                     DPKCS036
066017                 ELSE                                             DPKCS036
066018                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         DPKCS036
066019                         SET DP030-OVERRIDE-GO                    DPKCS036
066020                                      TO TRUE                     DPKCS036
066021                         MOVE PC-TSYMSG-00057                     DPKCS036
066022                                      TO DP020-MSG-NUMBER         DPKCS036
066023                         SET DP020-MSG-WARNING                    DPKCS036
066024                                      TO TRUE                     DPKCS036
066025                     END-IF                                       DPKCS036
066026                 END-IF                                           DPKCS036
066027             END-IF                                               DPKCS036
066028                                                                          
066100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
066200             MOVE +1               TO PV-TOP-ITEM                 DPKCS036
066300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
066400             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
066500                                                                  DPKCS036
066600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
066700             PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
066800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
066900             PERFORM 3200-RESET-ATTRIBUTES                        DPKCS036
067000                                                                  DPKCS036
067100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
067200             PERFORM 2120-BROWSE-FORWARD                          DPKCS036
067300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
067400                                                                  DPKCS036
067500         WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
067600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
067700             IF  PS-ERROR                                         DPKCS036
067800                 CONTINUE                                         DPKCS036
067900             ELSE                                                 DPKCS036
068000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
068100             END-IF                                               DPKCS036
068200                                                                  DPKCS036
068300         WHEN OTHER                                               DPKCS036
068400             SET DP013-NO-ROLLBACK                                DPKCS036
068500                 DP013-XCTL-DISPLAY-RESTART                       DPKCS036
068600                 DP013-CICS-ABEND  TO TRUE                        DPKCS036
068700             MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
068800                                   TO DP013-PARAGRAPH             DPKCS036
068900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
069000                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
069100             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
069200     END-EVALUATE.                                                DPKCS036
069300                                                                  DPKCS036
069400 EJECT                                                            DPKCS036
069500*----------------------------------------------------------------*DPKCS036
069600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
069700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
069800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
069900*    MESSAGE.                                                    *DPKCS036
070000*----------------------------------------------------------------*DPKCS036
070100 2110-BROWSE-BACKWARD.                                            DPKCS036
070200                                                                  DPKCS036
070300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
070400         GIVING PV-TOP-ITEM.                                      DPKCS036
070500*                                                                 DPKCS036
070600     IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
070700       OR (PV-TOP-ITEM = +1))                                     DPKCS036
070800         MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
070900*---------- TOP OF LIST -----                                     DPKCS036
071000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
071100         SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
071200     END-IF.                                                      DPKCS036
071300                                                                  DPKCS036
071400 EJECT                                                            DPKCS036
071500*----------------------------------------------------------------*DPKCS036
071600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
071700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
071800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
071900*----------------------------------------------------------------*DPKCS036
072000 2120-BROWSE-FORWARD.                                             DPKCS036
072100                                                                  DPKCS036
072200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
072300         GIVING PV-TOP-ITEM.                                      DPKCS036
072400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
072500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
072600                                   TO PV-TOP-ITEM                 DPKCS036
072700*---------- BOTTOM OF LIST --                                     DPKCS036
072800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
072900         SET DP020-MSG-INFORMATIONAL                              DPKCS036
073000                                   TO TRUE                        DPKCS036
073100     ELSE                                                         DPKCS036
073200         COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
073300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
073400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
073500*-------------- BOTTOM OF LIST --                                 DPKCS036
073600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
073700             SET DP020-MSG-INFORMATIONAL                          DPKCS036
073800                                   TO TRUE                        DPKCS036
073900         END-IF                                                   DPKCS036
074000     END-IF.                                                      DPKCS036
074100                                                                  DPKCS036
074200 EJECT                                                            DPKCS036
074300*----------------------------------------------------------------*DPKCS036
074400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
074500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
074600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
074700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
074800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
074900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
075000*----------------------------------------------------------------*DPKCS036
075100 2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
075200                                                                  DPKCS036
075300     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
075400     IF (ASC-START-ITEM-REQUEST = SPACE)                          DPKCS036
075500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
075600                                   TO PV-TOP-ITEM                 DPKCS036
075700     ELSE                                                         DPKCS036
075800         MOVE ASC-START-ITEM-REQUEST                              DPKCS036
075900                                   TO DP010I-UNEDITED-FIELD       DPKCS036
076000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
076100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
076200         SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
076300                                   TO TRUE                        DPKCS036
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
076500                                                                  DPKCS036
076600         IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
076700             MOVE DP010I-NUMERIC-FIELD                            DPKCS036
076800                                   TO  ASC-START-ITEM-REQUEST-N   DPKCS036
076900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
077000                 IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
077100                                          ASC-NUMBER-OF-ITEMS-READDPKCS036
077200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
077300                     COMPUTE PV-TOP-ITEM =                        DPKCS036
077400                             ASC-NUMBER-OF-ITEMS-READ             DPKCS036
077500                             - PC-ITEMS-PER-PANEL + 1             DPKCS036
077600                     IF  PV-TOP-ITEM < +1                         DPKCS036
077700                         MOVE +1   TO PV-TOP-ITEM                 DPKCS036
077800                         MOVE PC-TSYMSG-00070                     DPKCS036
077900                                   TO DP020-MSG-NUMBER            DPKCS036
078000                         SET DP020-MSG-INFORMATIONAL              DPKCS036
078100                                   TO TRUE                        DPKCS036
078200                     END-IF                                       DPKCS036
078300                 ELSE                                             DPKCS036
078400                     MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
078500                                   TO PV-TOP-ITEM                 DPKCS036
078600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
078700                     COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
078800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
078900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
079000*-------------------------- BOTTOM OF LIST --                     DPKCS036
079100                         MOVE PC-TSYMSG-00070                     DPKCS036
079200                                   TO DP020-MSG-NUMBER            DPKCS036
079300                         SET DP020-MSG-INFORMATIONAL              DPKCS036
079400                                   TO TRUE                        DPKCS036
079500                     END-IF                                       DPKCS036
079600                 END-IF                                           DPKCS036
079700             ELSE                                                 DPKCS036
079800*------------------- VALUE OUT OF RANGE ----                      DPKCS036
079900                 MOVE PC-TSYMSG-00101                             DPKCS036
080000                                   TO DP020-MSG-NUMBER            DPKCS036
080100                 MOVE -1           TO ASTRTITL                    DPKCS036
080200                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
080300                                   TO TRUE                        DPKCS036
080400                 MOVE DP015-REVERSE                               DPKCS036
080500                                   TO ASTRTITH                    DPKCS036
080600                 MOVE DP015-RED    TO ASTRTITC                    DPKCS036
080700                 MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
080800                                   TO ASTRTITA                    DPKCS036
080900                 SET DP020-MSG-FATAL                              DPKCS036
081000                                   TO TRUE                        DPKCS036
081100                 SET PS-ERROR      TO TRUE                        DPKCS036
081200             END-IF                                               DPKCS036
081300                                                                  DPKCS036
081400         ELSE                                                     DPKCS036
081500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
081600             MOVE -1               TO ASTRTITL                    DPKCS036
081700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
081800             MOVE DP015-REVERSE    TO ASTRTITH                    DPKCS036
081900             MOVE DP015-RED        TO ASTRTITC                    DPKCS036
082000             MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
082100                                   TO ASTRTITA                    DPKCS036
082200             SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
082300             SET PS-ERROR          TO TRUE                        DPKCS036
082400         END-IF                                                   DPKCS036
082500     END-IF.                                                      DPKCS036
082600                                                                  DPKCS036
082700 EJECT                                                            DPKCS036
082800*----------------------------------------------------------------*DPKCS036
082900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
083000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
083100*----------------------------------------------------------------*DPKCS036
083200 2140-DESELECT-ALL-ITEMS.                                         DPKCS036
083300                                                                  DPKCS036
083400     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
083500                                                                  DPKCS036
083600     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
083700         VARYING ASC-ITEM-SUB                                     DPKCS036
083800         FROM 1 BY 1                                              DPKCS036
083900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
084000                                                                  DPKCS036
084100     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
084200                                                                  DPKCS036
084300     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
084400         VARYING ASC-ITEM-SUB                                     DPKCS036
084500         FROM 1 BY 1                                              DPKCS036
084600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
084700                                                                  DPKCS036
084800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
084900                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
085000                                                                  DPKCS036
085100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
085200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
085300                                                                  DPKCS036
085400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
085500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
085600         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
085700                                                                  DPKCS036
085800         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
085900                                                                  DPKCS036
086000         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
086100                                                                  DPKCS036
086200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
086300             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
086400                                                                  DPKCS036
086500         PERFORM                                                  DPKCS036
086600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
086700                                                                  DPKCS036
086800             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
086900                                                                  DPKCS036
087000             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
087100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
087200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
087300                                                                  DPKCS036
087400             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
087500                                                                  DPKCS036
087600             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
087700                                                                  DPKCS036
087800         END-PERFORM                                              DPKCS036
087900                                                                  DPKCS036
088000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
088100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
088200                                                                  DPKCS036
088300         PERFORM                                                  DPKCS036
088400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
088500                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
088600                                                                  DPKCS036
088700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
088800                                   TO PV-BLOCK-NUMBER             DPKCS036
088900                                                                  DPKCS036
089000             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
089100                                                                  DPKCS036
089200             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
089300                 VARYING ASC-ITEM-SUB                             DPKCS036
089400                 FROM 1 BY 1                                      DPKCS036
089500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
089600                                                                  DPKCS036
089700             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
089800                                                                  DPKCS036
089900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
090000                                                                  DPKCS036
090100         END-PERFORM                                              DPKCS036
090200                                                                  DPKCS036
090300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
090400                                   TO PV-BLOCK-NUMBER             DPKCS036
090500                                                                  DPKCS036
090600         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
090700     END-IF.                                                      DPKCS036
090800                                                                  DPKCS036
090900     MOVE +0                    TO ASC-NUMBER-OF-SELECTED-ITEMS.  DPKCS036
091000     MOVE +0                    TO ASC-START-OF-SELECTED-RANGE.   DPKCS036
091100     MOVE +0                    TO ASC-END-OF-SELECTED-RANGE.     DPKCS036
091200                                                                  DPKCS036
091300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
091400                                                                  DPKCS036
091500 EJECT                                                            DPKCS036
091600*----------------------------------------------------------------*DPKCS036
091700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
091800*----------------------------------------------------------------*DPKCS036
091900 2141-CLEAR-SELECTED-INDS.                                        DPKCS036
092000                                                                  DPKCS036
092100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
092200             NOT EQUAL ZERO                                       DPKCS036
092300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
092400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
092500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
092600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
092700                                   TO TRUE                        DPKCS036
092800         END-IF                                                   DPKCS036
092900     END-IF.                                                      DPKCS036
093000                                                                  DPKCS036
093100 EJECT                                                            DPKCS036
093200*----------------------------------------------------------------*DPKCS036
093300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
093400*  FOR ALL ITEMS.                                                *DPKCS036
093500*----------------------------------------------------------------*DPKCS036
093600 2150-SELECT-ALL-ITEMS.                                           DPKCS036
093700                                                                  DPKCS036
093800     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
093900                                                                  DPKCS036
094000     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
094100         VARYING ASC-ITEM-SUB                                     DPKCS036
094200         FROM 1 BY 1                                              DPKCS036
094300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
094400                                                                  DPKCS036
094500     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
094600                                                                  DPKCS036
094700     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
094800         VARYING ASC-ITEM-SUB                                     DPKCS036
094900         FROM 1 BY 1                                              DPKCS036
095000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
095100                                                                  DPKCS036
095200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
095300                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
095400                                                                  DPKCS036
095500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
095600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
095700                                                                  DPKCS036
095800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
095900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
096000         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
096100                                                                  DPKCS036
096200         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
096300                                                                  DPKCS036
096400         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
096500                                                                  DPKCS036
096600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
096700             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
096800                                                                  DPKCS036
096900         PERFORM                                                  DPKCS036
097000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
097100                                                                  DPKCS036
097200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
097300                                                                  DPKCS036
097400             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
097500                 VARYING ASC-ITEM-SUB                             DPKCS036
097600                 FROM 1 BY 1                                      DPKCS036
097700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
097800                                                                  DPKCS036
097900             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
098000                                                                  DPKCS036
098100             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
098200                                                                  DPKCS036
098300         END-PERFORM                                              DPKCS036
098400                                                                  DPKCS036
098500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
098600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
098700                                                                  DPKCS036
098800         PERFORM                                                  DPKCS036
098900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
099000                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
099100                                                                  DPKCS036
099200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
099300                                   TO PV-BLOCK-NUMBER             DPKCS036
099400                                                                  DPKCS036
099500             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
099600                                                                  DPKCS036
099700             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
099800                 VARYING ASC-ITEM-SUB                             DPKCS036
099900                 FROM 1 BY 1                                      DPKCS036
100000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
100100                                                                  DPKCS036
100200             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
100300                                                                  DPKCS036
100400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
100500                                                                  DPKCS036
100600         END-PERFORM                                              DPKCS036
100700                                                                  DPKCS036
100800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
100900                                   TO PV-BLOCK-NUMBER             DPKCS036
101000                                                                  DPKCS036
101100         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
101200     END-IF.                                                      DPKCS036
101300                                                                  DPKCS036
101400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
101500                       ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
101600                                                                  DPKCS036
101700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
101800                                                                  DPKCS036
101900 EJECT                                                            DPKCS036
102000*----------------------------------------------------------------*DPKCS036
102100*    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
102200*----------------------------------------------------------------*DPKCS036
102300 2151-SET-SELECTED-INDS.                                          DPKCS036
102400                                                                  DPKCS036
102500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
102600             NOT EQUAL ZERO                                       DPKCS036
102700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
102800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
102900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
103000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
103100                               TO  TRUE                           DPKCS036
103200         END-IF                                                   DPKCS036
103300     END-IF.                                                      DPKCS036
103400                                                                  DPKCS036
103500 EJECT                                                            DPKCS036
103600**--------------------------------------------------------------**DPKCS036
103700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **DPKCS036
103800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **DPKCS036
103900**--------------------------------------------------------------**DPKCS036
104000 2200-MOVE-SCREEN-TO-COMMAREA.                                    DPKCS036
104100                                                                  DPKCS036
104200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             DPKCS036
104300     MOVE +1                       TO PV-SUB.                     DPKCS036
104400*                                                                 DPKCS036
104500     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
104600     IF  ASTRTITL > ZERO                                          DPKCS036
104700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          DPKCS036
104800     ELSE                                                         DPKCS036
104900         IF  ASTRTITF = DP015-ERASE-EOF                           DPKCS036
105000             INITIALIZE ASC-START-ITEM-REQUEST                    DPKCS036
105100         END-IF                                                   DPKCS036
105200     END-IF.                                                      DPKCS036
105300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
105400         VARYING PV-SUB                                           DPKCS036
105500         FROM 1 BY 1                                              DPKCS036
105600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
105700                                                                  DPKCS036
105800 EJECT                                                            DPKCS036
105900*----------------------------------------------------------------*DPKCS036
106000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *DPKCS036
106100*----------------------------------------------------------------*DPKCS036
106200 2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
106300                                                                  DPKCS036
106400     IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
106500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
106600         MOVE MR-SELECTI (PV-SUB)                                 DPKCS036
106700                                   TO ASC-TEMP-SELECTED-SW        DPKCS036
106800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
106900     ELSE                                                         DPKCS036
107000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
107100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
107200                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
107300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
107400         END-IF                                                   DPKCS036
107500     END-IF.                                                      DPKCS036
107600     ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
107700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
107800         ADD +1                    TO ASC-BLK-SUB                 DPKCS036
107900         MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
108000     END-IF.                                                      DPKCS036
108100                                                                  DPKCS036
108200 EJECT                                                            DPKCS036
108300**--------------------------------------------------------------**DPKCS036
108400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
108500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
108600**--------------------------------------------------------------**DPKCS036
108700 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
108800                                                                  DPKCS036
108900     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
109000     PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
109100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
109200**                                                                DPKCS036
109300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
109400* EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
109500**                                                                DPKCS036
109600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
109700         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
109800     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
109900     PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
110000         VARYING PV-SUB                                           DPKCS036
110100         FROM PV-SUB BY -1                                        DPKCS036
110200         UNTIL PV-SUB < +1                                        DPKCS036
110300*                                                                 DPKCS036
110400     IF  PS-NO-ERROR                                              DPKCS036
110500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
110600     END-IF.                                                      DPKCS036
110700*                                                                 DPKCS036
110800     IF  ((PS-NO-ERROR)                                           DPKCS036
110900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
111000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
111100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
111200     END-IF.                                                      DPKCS036
111300                                                                  DPKCS036
111400 EJECT                                                            DPKCS036
111500*----------------------------------------------------------------*DPKCS036
111600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
111700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
111800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
111900*                                                                *DPKCS036
112000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
112100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
112200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
112300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
112400*----------------------------------------------------------------*DPKCS036
112500 3100-SET-SUBSCRIPTS.                                             DPKCS036
112600                                                                  DPKCS036
112700     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
112800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
112900                                                                  DPKCS036
113000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
113100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
113200                                                                  DPKCS036
113300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
113400     ELSE                                                         DPKCS036
113500         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
113600     END-IF.                                                      DPKCS036
113700                                                                  DPKCS036
113800 EJECT                                                            DPKCS036
113900*----------------------------------------------------------------*DPKCS036
114000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **DPKCS036
114100*----------------------------------------------------------------*DPKCS036
114200 3200-RESET-ATTRIBUTES.                                           DPKCS036
114300                                                                  DPKCS036
114400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   DPKCS036
114500     MOVE DP015-GREEN              TO ASTRTITC.                   DPKCS036
114600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   DPKCS036
114700*                                                                 DPKCS036
114800     PERFORM                                                      DPKCS036
114900         VARYING PV-SUB                                           DPKCS036
115000         FROM 1 BY 1                                              DPKCS036
115100         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   DPKCS036
115200                         ASC-ITEMS-DISPLAYED)                     DPKCS036
115300         MOVE DP015-UNP-ALP-NOR-OFF                               DPKCS036
115400                                   TO MR-SELECTA (PV-SUB)         DPKCS036
115500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         DPKCS036
115600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         DPKCS036
115700     END-PERFORM.                                                 DPKCS036
115800                                                                  DPKCS036
115900 EJECT                                                            DPKCS036
116000*----------------------------------------------------------------*DPKCS036
116100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *DPKCS036
116200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *DPKCS036
116300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *DPKCS036
116400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *DPKCS036
116500*----------------------------------------------------------------*DPKCS036
116600 3300-EDIT-SELECTIONS.                                            DPKCS036
116700                                                                  DPKCS036
116800     EVALUATE TRUE                                                DPKCS036
116900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
117000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
117100                 CONTINUE                                         DPKCS036
117200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
117300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
117400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   DPKCS036
117500                 MOVE ASC-TEMP-SELECTED-SW                        DPKCS036
117600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
117700                                TO ASC-SELECTED-SW                DPKCS036
117800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
117900             END-IF                                               DPKCS036
118000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
118100                 = SPACE                                          DPKCS036
118200             EVALUATE TRUE                                        DPKCS036
118300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
118400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
118500                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
118600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
118700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
118800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    DPKCS036
118900                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
119000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
119100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
119200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      DPKCS036
119300                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
119400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
119500             END-EVALUATE                                         DPKCS036
119600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
119700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
119800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
119900             END-IF                                               DPKCS036
120000             PERFORM 3310-EDIT-RANGE                              DPKCS036
120100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
120200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
120300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
120400             END-IF                                               DPKCS036
120500             PERFORM 3310-EDIT-RANGE                              DPKCS036
120600         WHEN OTHER                                               DPKCS036
120700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           DPKCS036
120800             SET DP020-MSG-FATAL    TO TRUE                       DPKCS036
120900             MOVE -1                TO MR-SELECTL (PV-SUB)        DPKCS036
121000             SET DP030-SET-CURSOR-APPL-1                          DPKCS036
121100                                    TO TRUE                       DPKCS036
121200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        DPKCS036
121300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        DPKCS036
121400             SET PS-ERROR TO TRUE                                 DPKCS036
121500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
121600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     DPKCS036
121700                 MOVE SPACE         TO ASC-SELECTED-SW            DPKCS036
121800                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
121900             END-IF                                               DPKCS036
122000     END-EVALUATE.                                                DPKCS036
122100                                                                  DPKCS036
122200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 DPKCS036
122300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               DPKCS036
122400     IF  ASC-ITEM-SUB < 1                                         DPKCS036
122500         SUBTRACT +1 FROM ASC-BLK-SUB                             DPKCS036
122600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                DPKCS036
122700     END-IF.                                                      DPKCS036
122800                                                                  DPKCS036
122900 EJECT                                                            DPKCS036
123000*----------------------------------------------------------------*DPKCS036
123100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *DPKCS036
123200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *DPKCS036
123300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *DPKCS036
123400*  THE ENDING.                                                   *DPKCS036
123500*----------------------------------------------------------------*DPKCS036
123600 3310-EDIT-RANGE.                                                 DPKCS036
123700                                                                  DPKCS036
123800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                DPKCS036
123900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   DPKCS036
124000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
124100                                   TO ASC-SELECTED-SW             DPKCS036
124200                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
124300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE DPKCS036
124400         ELSE                                                     DPKCS036
124500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     DPKCS036
124600                 CONTINUE                                         DPKCS036
124700             ELSE                                                 DPKCS036
124800*----------------ONLY ONE BEGINNING-OF-RANGE-ALLOWED --           DPKCS036
124900                 MOVE PC-TSYMSG-00054                             DPKCS036
125000                                   TO DP020-MSG-NUMBER            DPKCS036
125100                 SET DP020-MSG-FATAL                              DPKCS036
125200                                   TO TRUE                        DPKCS036
125300                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
125400                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
125500                                   TO TRUE                        DPKCS036
125600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         DPKCS036
125700                 MOVE DP015-UNDERLINE                             DPKCS036
125800                                   TO MR-SELECTH (PV-SUB)         DPKCS036
125900                 SET PS-ERROR      TO TRUE                        DPKCS036
126000             END-IF                                               DPKCS036
126100         END-IF                                                   DPKCS036
126200     ELSE                                                         DPKCS036
126300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
126400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
126500                                   TO ASC-SELECTED-SW             DPKCS036
126600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
126700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   DPKCS036
126800         ELSE                                                     DPKCS036
126900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       DPKCS036
127000                 CONTINUE                                         DPKCS036
127100             ELSE                                                 DPKCS036
127200*----------------ONLY ONE END-OF-RANGE ALLOWED --                 DPKCS036
127300                 MOVE PC-TSYMSG-00055                             DPKCS036
127400                                   TO DP020-MSG-NUMBER            DPKCS036
127500                 SET DP020-MSG-FATAL                              DPKCS036
127600                                   TO TRUE                        DPKCS036
127700                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
127800                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
127900                                   TO TRUE                        DPKCS036
128000                 SET PS-ERROR      TO TRUE                        DPKCS036
128100             END-IF                                               DPKCS036
128200         END-IF                                                   DPKCS036
128300     END-IF.                                                      DPKCS036
128400                                                                  DPKCS036
128500 EJECT                                                            DPKCS036
128600*----------------------------------------------------------------*DPKCS036
128700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *DPKCS036
128800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *DPKCS036
128900*----------------------------------------------------------------*DPKCS036
129000 3400-CHECK-RANGE-SEQUENCE.                                       DPKCS036
129100                                                                  DPKCS036
129200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
129300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      DPKCS036
129400       AND  ASC-START-OF-SELECTED-RANGE >                         DPKCS036
129500                                         ASC-END-OF-SELECTED-RANGEDPKCS036
129600*--------END-OF-RANGE BEFORE BEGINNING-OF-RANGE--                 DPKCS036
129700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 DPKCS036
129800         SET DP020-MSG-FATAL TO TRUE                              DPKCS036
129900         SET PS-ERROR TO TRUE                                     DPKCS036
130000         PERFORM 3410-POSITION-AT-ERROR                           DPKCS036
130100     END-IF.                                                      DPKCS036
130200                                                                  DPKCS036
130300 EJECT                                                            DPKCS036
130400*----------------------------------------------------------------*DPKCS036
130500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *DPKCS036
130600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *DPKCS036
130700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *DPKCS036
130800*----------------------------------------------------------------*DPKCS036
130900 3410-POSITION-AT-ERROR.                                          DPKCS036
131000                                                                  DPKCS036
131100     SET DP030-SET-CURSOR-APPL-1                                  DPKCS036
131200                                   TO TRUE.                       DPKCS036
131300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
131400                    - PV-TOP-ITEM + 1.                            DPKCS036
131500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
131600         CONTINUE                                                 DPKCS036
131700     ELSE                                                         DPKCS036
131800         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
131900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
132000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
132100     END-IF.                                                      DPKCS036
132200*                                                                 DPKCS036
132300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
132400                    - PV-TOP-ITEM + 1.                            DPKCS036
132500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
132600         CONTINUE                                                 DPKCS036
132700     ELSE                                                         DPKCS036
132800         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
132900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
133000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
133100     END-IF.                                                      DPKCS036
133200                                                                  DPKCS036
133300 EJECT                                                            DPKCS036
133400*----------------------------------------------------------------*DPKCS036
133500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *DPKCS036
133600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *DPKCS036
133700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *DPKCS036
133800*----------------------------------------------------------------*DPKCS036
133900 3500-MARK-RANGE-AS-SELECTED.                                     DPKCS036
134000                                                                  DPKCS036
134100     MOVE +1                       TO  ASC-BLK-SUB.               DPKCS036
134200     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
134300         VARYING ASC-ITEM-SUB                                     DPKCS036
134400         FROM 1 BY 1                                              DPKCS036
134500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
134600                                                                  DPKCS036
134700     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
134800     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
134900         VARYING ASC-ITEM-SUB                                     DPKCS036
135000         FROM 1 BY 1                                              DPKCS036
135100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
135200                                                                  DPKCS036
135300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
135400                                   TO  PV-LIST-ITEM-NUMBER.       DPKCS036
135500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
135600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         DPKCS036
135700               PC-ITEMS-PER-PANEL).                               DPKCS036
135800                                                                  DPKCS036
135900     MOVE ASC-START-OF-SELECTED-RANGE                             DPKCS036
136000                                   TO PV-START-OF-SELECTED-RANGE. DPKCS036
136100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            DPKCS036
136200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  DPKCS036
136300               PC-ITEMS-PER-PANEL).                               DPKCS036
136400                                                                  DPKCS036
136500     MOVE ASC-END-OF-SELECTED-RANGE                               DPKCS036
136600                                   TO  PV-END-OF-SELECTED-RANGE.  DPKCS036
136700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             DPKCS036
136800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    DPKCS036
136900               PC-ITEMS-PER-PANEL).                               DPKCS036
137000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             DPKCS036
137100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             DPKCS036
137200                                                                  DPKCS036
137300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    DPKCS036
137400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        DPKCS036
137500         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
137600         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
137700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
137800             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
137900                                                                  DPKCS036
138000         PERFORM                                                  DPKCS036
138100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      DPKCS036
138200                   PV-PREV-BLOCK-IN-ARRAY                         DPKCS036
138300             MOVE PV-FIRST-BLOCK-IN-RANGE                         DPKCS036
138400                                   TO PV-BLOCK-NUMBER             DPKCS036
138500             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
138600             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
138700                 VARYING ASC-ITEM-SUB                             DPKCS036
138800                 FROM 1 BY 1                                      DPKCS036
138900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
139000             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
139100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     DPKCS036
139200         END-PERFORM                                              DPKCS036
139300                                                                  DPKCS036
139400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
139500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
139600         PERFORM                                                  DPKCS036
139700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
139800                   PV-LAST-BLOCK-IN-RANGE                         DPKCS036
139900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
140000                                   TO PV-BLOCK-NUMBER             DPKCS036
140100             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
140200             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
140300                 VARYING ASC-ITEM-SUB                             DPKCS036
140400                 FROM 1 BY 1                                      DPKCS036
140500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
140600             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
140700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
140800         END-PERFORM                                              DPKCS036
140900                                                                  DPKCS036
141000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
141100                                   TO PV-BLOCK-NUMBER             DPKCS036
141200         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
141300     END-IF.                                                      DPKCS036
141400                                                                  DPKCS036
141500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE DPKCS036
141600                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
141700                                                                  DPKCS036
141800 EJECT                                                            DPKCS036
141900*----------------------------------------------------------------*DPKCS036
142000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *DPKCS036
142100*----------------------------------------------------------------*DPKCS036
142200 3510-MARK-SELECTED-INDS.                                         DPKCS036
142300                                                                  DPKCS036
142400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
142500                                ASC-ITEM-SUB) >                   DPKCS036
142600         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
142700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
142800                                ASC-ITEM-SUB) =                   DPKCS036
142900         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
143000                                                                  DPKCS036
143100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
143200                                    ASC-ITEM-SUB) <               DPKCS036
143300             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
143400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
143500                                    ASC-ITEM-SUB) =               DPKCS036
143600             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
143700                                                                  DPKCS036
143800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
143900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
144000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
144100                               TO TRUE                            DPKCS036
144200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              DPKCS036
144300                               TO TRUE                            DPKCS036
144400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
144500             END-IF                                               DPKCS036
144600         END-IF                                                   DPKCS036
144700     END-IF.                                                      DPKCS036
144800                                                                  DPKCS036
144900 EJECT                                                            DPKCS036
145000*----------------------------------------------------------------*DPKCS036
145100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
145200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
145300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
145400*    DISPLAY THE PANEL TO USER.                                  *DPKCS036
145500*----------------------------------------------------------------*DPKCS036
145600 4000-BUILD-INITIAL-PANEL.                                        DPKCS036
145700                                                                  DPKCS036
145800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            DPKCS036
145900                                 ASC-BLOCK-ENTRIES (2).           DPKCS036
146000     MOVE +1                 TO ASC-BLK-SUB.                      DPKCS036
146100     SET ASC-ITEMS-LEFT-ON-DB                                     DPKCS036
146200                             TO TRUE.                             DPKCS036
146300                                                                  DPKCS036
146400     MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
146500                                ASC-NUMBER-OF-ITEMS-READ          DPKCS036
146600                                ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
146700                                ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
146800                                ASC-START-OF-SELECTED-RANGE       DPKCS036
146900                                ASC-END-OF-SELECTED-RANGE         DPKCS036
147000                                ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
147100                                                                  DPKCS036
147200     PERFORM 4010-OPEN-CURSOR.                                    DPKCS036
147300                                                                  DPKCS036
147400     PERFORM 4300-READ-ITEMS-FROM-DB.                             DPKCS036
147500                                                                  DPKCS036
147600     PERFORM 4020-CLOSE-CURSOR.                                   DPKCS036
147700                                                                  DPKCS036
147800     MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
147900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
148000         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
148100         SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
148200         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
148300     ELSE                                                         DPKCS036
148400         MOVE -1               TO MR-SELECTL (1)                  DPKCS036
148500         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
148600                               TO TRUE                            DPKCS036
148700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
148800     END-IF.                                                      DPKCS036
148900                                                                  DPKCS036
149000 EJECT                                                            DPKCS036
149100*----------------------------------------------------------------*DPKCS036
149200*   OPEN THE VESSEL DETAIL CURSOR                                *DPKCS036
149300*----------------------------------------------------------------*DPKCS036
149400 4010-OPEN-CURSOR.                                                DPKCS036
149500                                                                  DPKCS036
149600     PERFORM                                                      DPKCS036
149700         WITH TEST AFTER                                          DPKCS036
149800         VARYING PV-RETRY-COUNTER                                 DPKCS036
149900         FROM 1 BY 1                                              DPKCS036
150000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               DPKCS036
150100                   OR (SQLCODE = ZERO))                           DPKCS036
150200         MOVE 'CURSOR:  VSL-DTL-CSR'                              DPKCS036
150300                                 TO DP013-MESSAGE-TEXT (2)        DPKCS036
150400         EXEC SQL                                                 DPKCS036
150500              OPEN VSL-DTL-CSR                                    DPKCS036
150600         END-EXEC                                                 DPKCS036
150700                                                                  DPKCS036
150800                                                                  DPKCS036
150900         EVALUATE TRUE                                            DPKCS036
151000             WHEN SQLCODE = ZERO                                  DPKCS036
151100             WHEN SQLCODE = -904                                  DPKCS036
151200             WHEN SQLCODE = -913                                  DPKCS036
151300                 CONTINUE                                         DPKCS036
151400             WHEN SQLWARN0 NOT = SPACES                           DPKCS036
151500             WHEN SQLCODE < ZERO                                  DPKCS036
151600             WHEN SQLCODE > ZERO                                  DPKCS036
151700                 MOVE '4010-OPEN-CURSOR'                          DPKCS036
151800                                   TO DP013-PARAGRAPH             DPKCS036
151900                 MOVE 'OPEN VESSEL DETAIL CURSOR - '              DPKCS036
152000                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
152100                 MOVE SQLCA        TO DP013-SQLCA                 DPKCS036
152200                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    DPKCS036
152300                 SET DP013-DB2-ABEND                              DPKCS036
152400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           DPKCS036
152500                 PERFORM DP013-0000-PROCESS-ABEND                 DPKCS036
152600         END-EVALUATE                                             DPKCS036
152700     END-PERFORM.                                                 DPKCS036
152800*                                                                 DPKCS036
152900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        DPKCS036
153000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             DPKCS036
153100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   DPKCS036
153200                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
153300         MOVE SQLCA                TO DP013-SQLCA                 DPKCS036
153400         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    DPKCS036
153500         SET DP013-DB2-ABEND                                      DPKCS036
153600             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
153700                                   TO TRUE                        DPKCS036
153800         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
153900     END-IF.                                                      DPKCS036
154000                                                                  DPKCS036
154100 EJECT                                                            DPKCS036
154200*----------------------------------------------------------------*DPKCS036
154300*   CLOSE THE VESSEL DETAIL CURSOR                               *DPKCS036
154400*----------------------------------------------------------------*DPKCS036
154500 4020-CLOSE-CURSOR.                                               DPKCS036
154600                                                                  DPKCS036
154700     EXEC SQL                                                     DPKCS036
154800          CLOSE VSL-DTL-CSR                                       DPKCS036
154900     END-EXEC.                                                    DPKCS036
155000*                                                                 DPKCS036
155100     EVALUATE TRUE                                                DPKCS036
155200         WHEN SQLCODE = ZERO                                      DPKCS036
155300             CONTINUE                                             DPKCS036
155400         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
155500         WHEN SQLCODE < ZERO                                      DPKCS036
155600         WHEN SQLCODE > ZERO                                      DPKCS036
155700             MOVE '4020-CLOSE-CURSOR'                             DPKCS036
155800                               TO DP013-PARAGRAPH                 DPKCS036
155900             MOVE 'CLOSE VESSEL DETIAL CURSOR '                   DPKCS036
156000                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
156100             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
156200             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
156300             SET DP013-DB2-ABEND                                  DPKCS036
156400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
156500             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
156600     END-EVALUATE.                                                DPKCS036
156700                                                                  DPKCS036
156800 EJECT                                                            DPKCS036
156900*----------------------------------------------------------------*DPKCS036
157000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *DPKCS036
157100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *DPKCS036
157200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *DPKCS036
157300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *DPKCS036
157400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *DPKCS036
157500*                                                                *DPKCS036
157600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *DPKCS036
157700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *DPKCS036
157800*    UPON INITIALIZATION.                                        *DPKCS036
157900*----------------------------------------------------------------*DPKCS036
158000 4300-READ-ITEMS-FROM-DB.                                         DPKCS036
158100                                                                  DPKCS036
158200     PERFORM                                                      DPKCS036
158300         VARYING PV-READ-COUNT                                    DPKCS036
158400         FROM 1 BY 1                                              DPKCS036
158500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    DPKCS036
158600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         DPKCS036
158700                                                                  DPKCS036
158800         PERFORM 4310-FETCH                                       DPKCS036
158900                                                                  DPKCS036
159000         IF  ASC-ITEMS-LEFT-ON-DB                                 DPKCS036
159100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
159200                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
159300             ELSE                                                 DPKCS036
159400                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
159500                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
159600                                                                  DPKCS036
159700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
159800                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
159900                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
160000                                   TO TRUE                        DPKCS036
160100                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
160200                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
160300                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
160400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
160500                     ADD +1        TO ASC-BLK-SUB                 DPKCS036
160600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
160700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
160800                                   TO TRUE                        DPKCS036
160900                 END-IF                                           DPKCS036
161000             END-IF                                               DPKCS036
161100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    DPKCS036
161200             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
161300                                   TO ASC-LIST-ITEM-NUMBER        DPKCS036
161400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
161500             MOVE IMCNTK-CONTNR-ID TO ASC-CONTNR-NO               DPKCS036
161600                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
161700             MOVE IMCNTK-CONTNR-SEQ-NBR                           DPKCS036
161800                                   TO  ASC-CONTNR-SEQ-NO          DPKCS036
161900                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
162000             PERFORM  4330-FOB-CDE-CHECK                          DPKCS036
162100             PERFORM  4360-SELECT-PO-CNT                          DPKCS036
162200             MOVE PV-PO-COUNT      TO  ASC-PO-CNT                 DPKCS036
162300                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
162400             MOVE IMCNTK-MOM-CARR-SCAC-ID                                 
162401                                   TO  ASC-CARR-SCAC-ID           DPKCS036
162402                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
162403*                                                                 DPKCS036
162500             IF IMCNTK-FDR-DPRTR-TMST (1:10)                      DPKCS036
162600                                   = SPACES OR PC-INIT-DATE       DPKCS036
162700                MOVE IMCNTK-MOM-DPRTR-TMST (1:10)                 DPKCS036
162800                                   TO  PV-DATE-BREAK              DPKCS036
162900             ELSE                                                 DPKCS036
163000                MOVE IMCNTK-FDR-DPRTR-TMST (1:10)                 DPKCS036
163100                                   TO  PV-DATE-BREAK              DPKCS036
163200             END-IF                                               DPKCS036
163300             IF PV-DATE-BREAK      = SPACES OR PC-INIT-DATE       DPKCS036
163400                MOVE SPACES        TO  ASC-ATD                    DPKCS036
163500                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
163600             ELSE                                                 DPKCS036
163700                PERFORM 4320-FORMAT-DATE                          DPKCS036
163800                MOVE PV-DATE-DISPLAY                              DPKCS036
163900                                   TO  ASC-ATD                    DPKCS036
164000                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
164100             END-IF                                               DPKCS036
164200             IF IMCNTK-ACTL-POE-DELY-TMST (1:10)                          
164300                                         = SPACES OR PC-INIT-DATE         
164400                MOVE SPACES         TO ASC-ATA                            
164500                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
164600             ELSE                                                         
164700               STRING  IMCNTK-ACTL-POE-DELY-TMST(6:2) '/'                 
164800                        IMCNTK-ACTL-POE-DELY-TMST(9:2) '/'                
164900                        IMCNTK-ACTL-POE-DELY-TMST(3:2)                    
165000                       DELIMITED BY SIZE                                  
165100                                  INTO ASC-ATA                            
165200                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
165300             END-IF                                                       
165400         END-IF                                                   DPKCS036
165500     END-PERFORM.                                                 DPKCS036
165600*                                                                 DPKCS036
165700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
165800         MOVE +1               TO ASC-BLK-SUB                     DPKCS036
165900         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
166000         ADD +1                TO ASC-BLK-SUB                     DPKCS036
166100         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
166200                                                                  DPKCS036
166300         MOVE 1                TO ASC-BLK-SUB                     DPKCS036
166400                                  PV-BLOCK-NUMBER                 DPKCS036
166500         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
166600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
166700             MOVE 2            TO ASC-BLK-SUB                     DPKCS036
166800                                  PV-BLOCK-NUMBER                 DPKCS036
166900             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
167000         END-IF                                                   DPKCS036
167100     END-IF.                                                      DPKCS036
167200                                                                  DPKCS036
167300 EJECT                                                            DPKCS036
167400*----------------------------------------------------------------*DPKCS036
167500*    FETCH THE VESSEL LIST CURSOR                                *DPKCS036
167600*----------------------------------------------------------------*DPKCS036
167700 4310-FETCH.                                                      DPKCS036
167800                                                                  DPKCS036
167900     EXEC SQL                                                     DPKCS036
168000          FETCH VSL-DTL-CSR                                       DPKCS036
168100          INTO  :IMCNTK-CONTNR-ID                                 DPKCS036
168200              , :IMCNTK-FDR-FOB-CDE                               DPKCS036
168300              , :IMCNTK-MOM-FOB-CDE                               DPKCS036
168400              , :IMCNTK-FDR-DPRTR-TMST                            DPKCS036
168500              , :IMCNTK-MOM-DPRTR-TMST                            DPKCS036
168600              , :IMCNTK-CONTNR-SEQ-NBR                            DPKCS036
168700              , :IMCNTK-MOM-TRIP-TYP-CDE                          DPKCS036
168710              , :IMCNTK-MOM-CARR-SCAC-ID                                  
168800              , :IMCNTK-FDR-TRIP-TYP-CDE                          DPKCS036
168900              , :IMCNTK-ACTL-POE-DELY-TMST                        DPKCS036
169000     END-EXEC.                                                    DPKCS036
169100                                                                  DPKCS036
169200     EVALUATE TRUE                                                DPKCS036
169300         WHEN SQLCODE = ZERO                                      DPKCS036
169400         WHEN SQLCODE = +100                                      DPKCS036
169500              CONTINUE                                            DPKCS036
169600         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
169700         WHEN SQLCODE NOT = ZERO                                  DPKCS036
169800              MOVE '4310-FETCH-CURSOR'                            DPKCS036
169900                               TO DP013-PARAGRAPH                 DPKCS036
170000              MOVE 'FETCH VESSEL DETAIL CURSOR'                   DPKCS036
170100                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
170200              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
170300              SET DP013-DB2-ABEND                                 DPKCS036
170400                               TO TRUE                            DPKCS036
170500              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
170600     END-EVALUATE.                                                DPKCS036
170700                                                                  DPKCS036
170800     IF  SQLCODE EQUAL +100                                       DPKCS036
170900         SET ASC-NO-ITEMS-LEFT-ON-DB                              DPKCS036
171000                                   TO TRUE                        DPKCS036
171100     END-IF.                                                      DPKCS036
171200                                                                  DPKCS036
171300 EJECT                                                            DPKCS036
171400*----------------------------------------------------------------*DPKCS036
171500*      FORMAT THE DB2 DATE TO MM/DD/YY                           *DPKCS036
171600*----------------------------------------------------------------*DPKCS036
171700 4320-FORMAT-DATE.                                                DPKCS036
171800                                                                  DPKCS036
171900     MOVE PV-DB-MM          TO  PV-DD-MM.                         DPKCS036
172000     MOVE PV-DB-DD          TO  PV-DD-DD.                         DPKCS036
172100     MOVE PV-DB-YY          TO  PV-DD-YY.                         DPKCS036
172200                                                                  DPKCS036
172300 EJECT                                                            DPKCS036
172400*----------------------------------------------------------------*DPKCS036
172500*      CHECK TRIP TYPE CODE AND MOVE FOB CODE                    *DPKCS036
172600*----------------------------------------------------------------*DPKCS036
172700 4330-FOB-CDE-CHECK.                                              DPKCS036
172800                                                                  DPKCS036
172900     EVALUATE TRUE                                                DPKCS036
173000          WHEN  (IMCNTK-FDR-TRIP-TYP-CDE  = 'A')  OR              DPKCS036
173100                (IMCNTK-MOM-TRIP-TYP-CDE  = 'A')                  DPKCS036
173200                IF IMCNTK-FDR-FOB-CDE   = SPACES                  DPKCS036
173300                   MOVE IMCNTK-MOM-FOB-CDE TO ASC-FOB             DPKCS036
173400                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
173500                ELSE                                              DPKCS036
173600                   MOVE IMCNTK-FDR-FOB-CDE TO ASC-FOB             DPKCS036
173700                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
173800                END-IF                                            DPKCS036
173900                                                                  DPKCS036
174000          WHEN  IMCNTK-MOM-TRIP-TYP-CDE  = 'O' OR 'M'             DPKCS036
174100                IF IMCNTK-FDR-FOB-CDE = SPACES                    DPKCS036
174200                   PERFORM 4340-SELECT-MOM-FOB-CDE                DPKCS036
174300                ELSE                                              DPKCS036
174400                   PERFORM 4350-SELECT-FDR-FOB-CDE                DPKCS036
174500                END-IF                                            DPKCS036
174600                                                                  DPKCS036
174700                MOVE IMFOB-FOB-CDE      TO ASC-FOB                DPKCS036
174800                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
174900                                                                  DPKCS036
175000          WHEN  OTHER                                             DPKCS036
175100                MOVE SPACES             TO ASC-FOB                DPKCS036
175200                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
175300     END-EVALUATE.                                                DPKCS036
175400                                                                  DPKCS036
175500 EJECT                                                            DPKCS036
175600*----------------------------------------------------------------*DPKCS036
175700*      SELECT MOM FOB CODE FROM TIMFOB                           *DPKCS036
175800*----------------------------------------------------------------*DPKCS036
175900 4340-SELECT-MOM-FOB-CDE.                                         DPKCS036
176000                                                                  DPKCS036
176100     EXEC SQL                                                     DPKCS036
176200         SELECT DISTINCT                                          DPKCS036
176300               A.FOB_CDE                                          DPKCS036
176400         INTO   :IMFOB-FOB-CDE                                    DPKCS036
176500         FROM   TIMFOB A                                          DPKCS036
176600         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-MOM-FOB-CDE           DPKCS036
176700            AND A.STAT_CDE = 'A'                                  DPKCS036
176800     END-EXEC.                                                    DPKCS036
176900                                                                  DPKCS036
177000     EVALUATE TRUE                                                DPKCS036
177100         WHEN SQLCODE = ZERO                                      DPKCS036
177200              CONTINUE                                            DPKCS036
177300         WHEN SQLCODE = +100                                      DPKCS036
177400         WHEN SQLCODE = -811                                      DPKCS036
177500              MOVE SPACES          TO IMFOB-FOB-CDE               DPKCS036
177600         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
177700         WHEN SQLCODE NOT = ZERO                                  DPKCS036
177800              MOVE '4340-SELECT-MOM-FOB-CDE'                      DPKCS036
177900                               TO DP013-PARAGRAPH                 DPKCS036
178000              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             DPKCS036
178100                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
178200              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
178300              SET DP013-DB2-ABEND                                 DPKCS036
178400                               TO TRUE                            DPKCS036
178500              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
178600     END-EVALUATE.                                                DPKCS036
178700                                                                  DPKCS036
178800 EJECT                                                            DPKCS036
178900*----------------------------------------------------------------*DPKCS036
179000*      SELECT FDR FOB CODE FROM TIMFOB                           *DPKCS036
179100*----------------------------------------------------------------*DPKCS036
179200 4350-SELECT-FDR-FOB-CDE.                                         DPKCS036
179300                                                                  DPKCS036
179400     EXEC SQL                                                     DPKCS036
179500         SELECT DISTINCT                                          DPKCS036
179600               A.FOB_CDE                                          DPKCS036
179700         INTO   :IMFOB-FOB-CDE                                    DPKCS036
179800         FROM   TIMFOB A                                          DPKCS036
179900         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-FDR-FOB-CDE           DPKCS036
180000            AND A.STAT_CDE = 'A'                                  DPKCS036
180100     END-EXEC.                                                    DPKCS036
180200                                                                  DPKCS036
180300     EVALUATE TRUE                                                DPKCS036
180400         WHEN SQLCODE = ZERO                                      DPKCS036
180500              CONTINUE                                            DPKCS036
180600         WHEN SQLCODE = +100                                      DPKCS036
180700         WHEN SQLCODE = -811                                      DPKCS036
180800              MOVE SPACES          TO IMFOB-FOB-CDE               DPKCS036
180900         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
181000         WHEN SQLCODE NOT = ZERO                                  DPKCS036
181100              MOVE '4350-SELECT-FDR-FOB-CDE'                      DPKCS036
181200                               TO DP013-PARAGRAPH                 DPKCS036
181300              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             DPKCS036
181400                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
181500              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
181600              SET DP013-DB2-ABEND                                 DPKCS036
181700                               TO TRUE                            DPKCS036
181800              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
181900     END-EVALUATE.                                                DPKCS036
182000                                                                  DPKCS036
182100 EJECT                                                            DPKCS036
182200*----------------------------------------------------------------*DPKCS036
182300* SELECT PO COUNT IN THE CONTAINER  FOR THE REQUESTED VSL/VOY    *DPKCS036
182400*----------------------------------------------------------------*DPKCS036
182500 4360-SELECT-PO-CNT.                                              DPKCS036
182600                                                                  DPKCS036
182700     EXEC SQL                                                     DPKCS036
182800         SELECT                                                   DPKCS036
182900               COUNT(DISTINCT PO_NBR)                             DPKCS036
183000         INTO   :PV-PO-COUNT                                      DPKCS036
183100         FROM   TIMCNPO                                           DPKCS036
183200         WHERE  CONTNR_ID      = :IMCNTK-CONTNR-ID                DPKCS036
183300            AND CONTNR_SEQ_NBR = :IMCNTK-CONTNR-SEQ-NBR           DPKCS036
183400     END-EXEC.                                                    DPKCS036
183500                                                                  DPKCS036
183600     EVALUATE TRUE                                                DPKCS036
183700         WHEN SQLCODE = ZERO                                      DPKCS036
183800         WHEN SQLCODE = +100                                      DPKCS036
183900              CONTINUE                                            DPKCS036
184000         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
184100         WHEN SQLCODE NOT = ZERO                                  DPKCS036
184200              MOVE '4360-SELECT-PO-COUNT'                         DPKCS036
184300                               TO DP013-PARAGRAPH                 DPKCS036
184400              MOVE 'SQL ERROR SELECTING PO COUNT'                 DPKCS036
184500                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
184600              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
184700              SET DP013-DB2-ABEND                                 DPKCS036
184800                               TO TRUE                            DPKCS036
184900              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
185000     END-EVALUATE.                                                DPKCS036
185100                                                                  DPKCS036
185200 EJECT                                                            DPKCS036
185300*----------------------------------------------------------------*DPKCS036
185400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *DPKCS036
185500*----------------------------------------------------------------*DPKCS036
185600 4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
185700                                                                  DPKCS036
185800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
185900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
186000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
186100             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
186200             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
186300             ADD +1     TO ASC-BLK-SUB                            DPKCS036
186400             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
186500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
186600                 GIVING PV-BLOCK-NUMBER                           DPKCS036
186700                 REMAINDER PV-REMAINDER                           DPKCS036
186800             IF  PV-REMAINDER > ZERO                              DPKCS036
186900                 ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
187000             END-IF                                               DPKCS036
187100             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
187200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
187300             ADD +1     TO ASC-BLK-SUB                            DPKCS036
187400                           PV-BLOCK-NUMBER                        DPKCS036
187500             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
187600     END-IF.                                                      DPKCS036
187700     MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
187800     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
187900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
188000         + PC-ITEMS-PER-PANEL).                                   DPKCS036
188100*                                                                 DPKCS036
188200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
188300         ADD +1         TO ASC-BLK-SUB                            DPKCS036
188400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
188500     END-IF.                                                      DPKCS036
188600*                                                                 DPKCS036
188700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
188800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
188900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
189000     PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
189100         VARYING PV-SUB                                           DPKCS036
189200         FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
189300         UNTIL PV-SUB < +1.                                       DPKCS036
189400*                                                                 DPKCS036
189500     COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
189600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
189700     MOVE ASC-KEY-VSL-NAME         TO AVSNMO.                     DPKCS036
189800     MOVE ASC-KEY-VOY-NBR          TO AVYNOO.                     DPKCS036
189900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
190000                                      ASTRTITO.                   DPKCS036
190100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    DPKCS036
190200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    DPKCS036
190300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
190400                                   TO ASELITO.                    DPKCS036
190500*                                                                 DPKCS036
190600     IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
190700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
190800*--------------- MORE ITEMS TO DISPLAY ----                       DPKCS036
190900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
191000             SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
191100         END-IF                                                   DPKCS036
191200     END-IF.                                                      DPKCS036
191300                                                                  DPKCS036
191400 EJECT                                                            DPKCS036
191500*----------------------------------------------------------------*DPKCS036
191600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
191700*----------------------------------------------------------------*DPKCS036
191800 4410-READ-TEMP-STORAGE.                                          DPKCS036
191900                                                                  DPKCS036
192000     EXEC CICS                                                    DPKCS036
192100         READQ TS                                                 DPKCS036
192200             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
192300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
192400             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
192500             RESP  (PV-CICS-RESP)                                 DPKCS036
192600     END-EXEC.                                                    DPKCS036
192700                                                                  DPKCS036
192800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
192900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
193000         CONTINUE                                                 DPKCS036
193100     ELSE                                                         DPKCS036
193200         SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
193300         SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
193400         MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
193500                                  TO DP013-PARAGRAPH              DPKCS036
193600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
193700                                  TO DP013-MESSAGE-TEXT(1)        DPKCS036
193800         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
193900     END-IF.                                                      DPKCS036
194000                                                                  DPKCS036
194100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
194200                                                                  DPKCS036
194300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
194400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
194500     END-IF.                                                      DPKCS036
194600                                                                  DPKCS036
194700 EJECT                                                            DPKCS036
194800*----------------------------------------------------------------*DPKCS036
194900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
195000*----------------------------------------------------------------*DPKCS036
195100 4420-FORMAT-LIST-LINES.                                          DPKCS036
195200                                                                  DPKCS036
195300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
195400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
195500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           DPKCS036
195600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           DPKCS036
195700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           DPKCS036
195800                                    MR-ACTION (PV-SUB)            DPKCS036
195900                                    MR-CONTNR-NO (PV-SUB)         DPKCS036
196000                                    MR-FOB (PV-SUB)               DPKCS036
196100                                    MR-ATD (PV-SUB)               DPKCS036
196200                                    MR-ATA (PV-SUB)               DPKCS036
196210                                    MR-CARR-SCAC (PV-SUB)         DPKCS036
196300                                                                  DPKCS036
196400         MOVE ZEROS              TO MR-PO-CNT (PV-SUB)            DPKCS036
196500     ELSE                                                         DPKCS036
196600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
196700                                                   > SPACE        DPKCS036
196800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
196900                                 TO MR-SELECTI (PV-SUB)           DPKCS036
197000         ELSE                                                     DPKCS036
197100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
197200                                 TO MR-SELECTI (PV-SUB)           DPKCS036
197300         END-IF                                                   DPKCS036
197400*                                                                 DPKCS036
197500         IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
197600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
197700                 > SPACE)                                         DPKCS036
197800               OR (PV-SUB = 1))                                   DPKCS036
197900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
198000                MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
198100             END-IF                                               DPKCS036
198200         END-IF                                                   DPKCS036
198300*                                                                 DPKCS036
198400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
198500             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
198600                                 TO MR-ACTION (PV-SUB)            DPKCS036
198700             MOVE ASC-CONTNR-NO (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
198800                                 TO MR-CONTNR-NO (PV-SUB)         DPKCS036
198900             MOVE ASC-FOB (ASC-BLK-SUB ASC-ITEM-SUB)              DPKCS036
199000                                 TO MR-FOB (PV-SUB)               DPKCS036
199100             MOVE ASC-ATD (ASC-BLK-SUB ASC-ITEM-SUB)              DPKCS036
199200                                 TO MR-ATD (PV-SUB)               DPKCS036
199300             MOVE ASC-ATA (ASC-BLK-SUB ASC-ITEM-SUB)              DPKCS036
199400                                 TO MR-ATA (PV-SUB)               DPKCS036
199500             MOVE ASC-PO-CNT (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
199600                                 TO MR-PO-CNT (PV-SUB)            DPKCS036
199601             MOVE ASC-CARR-SCAC-ID (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
199602                                 TO MR-CARR-SCAC (PV-SUB)         DPKCS036
199700         END-IF                                                   DPKCS036
199800     END-IF.                                                      DPKCS036
199900     SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
200000     IF  ASC-ITEM-SUB < + 1                                       DPKCS036
200100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
200200         MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
200300     END-IF.                                                      DPKCS036
200400                                                                  DPKCS036
200500 EJECT                                                            DPKCS036
200600*----------------------------------------------------------------*DPKCS036
200700*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *DPKCS036
200800*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *DPKCS036
200900*  ISSUE A WARNING.                                              *DPKCS036
201000*----------------------------------------------------------------*DPKCS036
201100 4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
201200                                                                  DPKCS036
201300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
201400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
201500*-------------- NO END-OF-RANGE SPECFIED ---                      DPKCS036
201600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
201700             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
201800             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
201900         END-IF                                                   DPKCS036
202000     ELSE                                                         DPKCS036
202100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
202200*-------------- NO BEGINNING-OF-RANGE SPECFIED ---                DPKCS036
202300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
202400             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
202500             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
202600         END-IF                                                   DPKCS036
202700     END-IF.                                                      DPKCS036
202800                                                                  DPKCS036
202900 EJECT                                                            DPKCS036
203000*----------------------------------------------------------------*DPKCS036
203100*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *DPKCS036
203200*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *DPKCS036
203300*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *DPKCS036
203400*  POSITION THE CURSOR THERE.                                    *DPKCS036
203500*----------------------------------------------------------------*DPKCS036
203600 4431-POSITION-AT-WARNING.                                        DPKCS036
203700                                                                  DPKCS036
203800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
203900                    - PV-TOP-ITEM + 1.                            DPKCS036
204000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
204100         CONTINUE                                                 DPKCS036
204200     ELSE                                                         DPKCS036
204300         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
204400                                   TO TRUE                        DPKCS036
204500         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
204600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
204700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
204800     END-IF.                                                      DPKCS036
204900*                                                                 DPKCS036
205000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
205100                    - PV-TOP-ITEM + 1.                            DPKCS036
205200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
205300         CONTINUE                                                 DPKCS036
205400     ELSE                                                         DPKCS036
205500         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
205600                                   TO TRUE                        DPKCS036
205700         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
205800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
205900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
206000     END-IF.                                                      DPKCS036
206100                                                                  DPKCS036
206200 EJECT                                                            DPKCS036
206300*----------------------------------------------------------------*DPKCS036
206400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *DPKCS036
206500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *DPKCS036
206600* FOR THE SELECTED ITEMS QUEUE.                                  *DPKCS036
206700*                                                                *DPKCS036
206800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *DPKCS036
206900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *DPKCS036
207000* THE ARRAY IS FULL.                                             *DPKCS036
207100*----------------------------------------------------------------*DPKCS036
207200 5000-PREPARE-SEL-QUEUE.                                          DPKCS036
207300                                                                  DPKCS036
207400     MOVE +1                   TO  ASC-BLK-SUB.                   DPKCS036
207500     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
207600     ADD +1                    TO  ASC-BLK-SUB.                   DPKCS036
207700     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
207800                                                                  DPKCS036
207900     MOVE ASC-SEL-QUEUE-NAME    TO  TR102-SEL-QUEUE-NAME.         DPKCS036
207910     MOVE ASC-SEL-QUEUE-NAME    TO  TR198-SEL-QUEUE-NAME.         DPKCS036
208000     PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
208100                                                                  DPKCS036
208200     SET ASC-UPDATE-TSQ        TO  TRUE.                          DPKCS036
208300                                                                  DPKCS036
208400     SET TR101-IDX             TO  1.                             DPKCS036
208500     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.       DPKCS036
208510     MOVE ZERO                 TO TR198-NUMBER-OF-TS-ITEMS.       DPKCS036
208600     INITIALIZE TR101-SELECTED-ITEM-ARRAY.                        DPKCS036
208700                                                                  DPKCS036
208800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
208900             VARYING PV-ITEM                                      DPKCS036
209000             FROM 1 BY 1                                          DPKCS036
209100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
209200                                                                  DPKCS036
209300     IF  TR101-IDX > 1                                            DPKCS036
209400         PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
209500         ADD +1                TO TR102-NUMBER-OF-TS-ITEMS        DPKCS036
209510         ADD +1                TO TR198-NUMBER-OF-TS-ITEMS        DPKCS036
209600     END-IF.                                                      DPKCS036
209700                                                                  DPKCS036
209800 EJECT                                                            DPKCS036
209900*----------------------------------------------------------------*DPKCS036
210000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
210100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
210200*----------------------------------------------------------------*DPKCS036
210300 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
210400                                                                  DPKCS036
210500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
210600                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
210700     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
210800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
210900                                                                  DPKCS036
211000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
211100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
211200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
211300             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
211400         END-IF                                                   DPKCS036
211500     ELSE                                                         DPKCS036
211600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
211700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
211800         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
211900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
212000     END-IF.                                                      DPKCS036
212100                                                                  DPKCS036
212200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
212300                                                                  DPKCS036
212400 EJECT                                                            DPKCS036
212500*----------------------------------------------------------------*DPKCS036
212600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *DPKCS036
212700*  SPECIFIC COMMAREA.                                            *DPKCS036
212800*----------------------------------------------------------------*DPKCS036
212900 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
213000                                                                  DPKCS036
213100     EXEC CICS                                                    DPKCS036
213200         WRITEQ TS                                                DPKCS036
213300             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
213400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
213500             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
213600             REWRITE                                              DPKCS036
213700             RESP  (PV-CICS-RESP)                                 DPKCS036
213800     END-EXEC.                                                    DPKCS036
213900                                                                  DPKCS036
214000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
214100         CONTINUE                                                 DPKCS036
214200     ELSE                                                         DPKCS036
214300         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
214400         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
214500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
214600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
214700                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
214800         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
214900     END-IF.                                                      DPKCS036
215000                                                                  DPKCS036
215100 EJECT                                                            DPKCS036
215200*----------------------------------------------------------------*DPKCS036
215300*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *DPKCS036
215400*  SPECIFIC COMMAREA.                                            *DPKCS036
215500*----------------------------------------------------------------*DPKCS036
215600 5110-WRITE-ASC-LISTQ.                                            DPKCS036
215700                                                                  DPKCS036
215800     EXEC CICS                                                    DPKCS036
215900         WRITEQ TS                                                DPKCS036
216000             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
216100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
216200             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
216300             RESP  (PV-CICS-RESP)                                 DPKCS036
216400     END-EXEC.                                                    DPKCS036
216500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
216600         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
216700         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
216800         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
216900                                   TO DP013-PARAGRAPH             DPKCS036
217000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
217100                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
217200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
217300     END-IF.                                                      DPKCS036
217400                                                                  DPKCS036
217500 EJECT                                                            DPKCS036
217600*----------------------------------------------------------------*DPKCS036
217700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *DPKCS036
217800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *DPKCS036
217900*----------------------------------------------------------------*DPKCS036
218000 5200-FILL-SEL-QUEUE-RECORD.                                      DPKCS036
218100                                                                  DPKCS036
218200     PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
218300                                                                  DPKCS036
218400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
218500         PERFORM                                                  DPKCS036
218600         VARYING LQW-IDX                                          DPKCS036
218700         FROM 1 BY 1                                              DPKCS036
218800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
218900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
219000                                                                  DPKCS036
219100             IF  LQW-SELECT (LQW-IDX)                             DPKCS036
219200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
219300                                TO TR101-ITEM (TR101-IDX)         DPKCS036
219400                 MOVE LQW-CONTNR-NO (LQW-IDX)                     DPKCS036
219500                                TO TR102-CONTNR-NO                DPKCS036
219510                                   TR198-CONTNR-NO                        
219600                                   TR101-CONTNR-NO                DPKCS036
219700                                       (TR101-IDX)                DPKCS036
219800                 MOVE LQW-CONTNR-SEQ-NO (LQW-IDX)                 DPKCS036
219900                                TO TR102-CONTNR-SEQ-NO            DPKCS036
219910                                   TR198-CONTNR-SEQ-NO                    
220000                                   TR101-CONTNR-SEQ-NO            DPKCS036
220100                                       (TR101-IDX)                DPKCS036
220200                 MOVE 'I'       TO TR101-ACTION-SW (TR101-IDX)    DPKCS036
220300                 SET TR101-IDX UP BY 1                            DPKCS036
220400                 IF  TR101-IDX > TR101-MAX-ITEMS                  DPKCS036
220500                     PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
220600                     ADD +1        TO TR102-NUMBER-OF-TS-ITEMS    DPKCS036
220610                     ADD +1        TO TR198-NUMBER-OF-TS-ITEMS            
220700                     INITIALIZE TR101-SELECTED-ITEM-ARRAY         DPKCS036
220800                     SET TR101-IDX TO  1                          DPKCS036
220900                 END-IF                                           DPKCS036
221000             END-IF                                               DPKCS036
221100         END-PERFORM                                              DPKCS036
221200     END-IF.                                                      DPKCS036
221300                                                                  DPKCS036
221400 EJECT                                                            DPKCS036
221500*----------------------------------------------------------------*DPKCS036
221600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
221700*----------------------------------------------------------------*DPKCS036
221800 5205-WRITE-SEL-QUEUE.                                            DPKCS036
221900                                                                  DPKCS036
222000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
222100                                   TO TR101-SELECTED-ITEMS.       DPKCS036
222200                                                                  DPKCS036
222300     EXEC CICS                                                    DPKCS036
222400          WRITEQ TS                                               DPKCS036
222500              QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
222600              FROM  (TR101-VOYAGE-SEL-REC)                        DPKCS036
222700              ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
222800              RESP  (PV-CICS-RESP)                                DPKCS036
222900     END-EXEC.                                                    DPKCS036
223000                                                                  DPKCS036
223100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
223200         CONTINUE                                                 DPKCS036
223300     ELSE                                                         DPKCS036
223400         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
223500         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
223600         MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
223700                                   TO DP013-PARAGRAPH             DPKCS036
223800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
223900                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
224000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
224100     END-IF.                                                      DPKCS036
224200                                                                  DPKCS036
224300 EJECT                                                            DPKCS036
224400*----------------------------------------------------------------*DPKCS036
224500*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *DPKCS036
224600*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *DPKCS036
224700*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *DPKCS036
224800*  THE USER.                                                     *DPKCS036
224900*----------------------------------------------------------------*DPKCS036
225000 6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
225100                                                                  DPKCS036
225200     IF  ASC-UPDATE-TSQ                                           DPKCS036
225300         SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
225400         MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
225500                                      PV-SEL-QUEUE-ITEM           DPKCS036
225600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
225700                                   TO PV-HOLD-SELECTED-ITEMS      DPKCS036
225800         MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
225900         PERFORM 6100-UPDATE-TSQ                                  DPKCS036
226000             UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
226100                                     PV-HOLD-SELECTED-ITEMS       DPKCS036
226200         PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
226300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
226400                    ASC-BLOCK-ENTRIES (2)                         DPKCS036
226500     END-IF.                                                      DPKCS036
226600                                                                  DPKCS036
226700 EJECT                                                            DPKCS036
226800*----------------------------------------------------------------*DPKCS036
226900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
227000*----------------------------------------------------------------*DPKCS036
227100 6010-DELETE-SEL-QUEUE.                                           DPKCS036
227200                                                                  DPKCS036
227300     EXEC CICS                                                    DPKCS036
227400         DELETEQ TS                                               DPKCS036
227500             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
227600             RESP  (PV-CICS-RESP)                                 DPKCS036
227700     END-EXEC.                                                    DPKCS036
227800*                                                                 DPKCS036
227900     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
228000        (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
228100         CONTINUE                                                 DPKCS036
228200     ELSE                                                         DPKCS036
228300         SET DP013-CICS-ABEND TO TRUE                             DPKCS036
228400         SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
228500         MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
228600                        TO DP013-PARAGRAPH                        DPKCS036
228700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
228800                        TO DP013-MESSAGE-TEXT (1)                 DPKCS036
228900         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
229000     END-IF.                                                      DPKCS036
229100                                                                  DPKCS036
229200 EJECT                                                            DPKCS036
229300*----------------------------------------------------------------*DPKCS036
229400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
229500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
229600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
229700*    THE TEMP QUEUE.                                             *DPKCS036
229800*----------------------------------------------------------------*DPKCS036
229900 6100-UPDATE-TSQ.                                                 DPKCS036
230000                                                                  DPKCS036
230100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
230200     PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
230300     PERFORM                                                      DPKCS036
230400         VARYING TR101-IDX                                        DPKCS036
230500         FROM 1 BY 1                                              DPKCS036
230600         UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
230700                              PV-HOLD-SELECTED-ITEMS)             DPKCS036
230800         OR (TR101-IDX GREATER THAN TR101-MAX-ITEMS))             DPKCS036
230900         IF  TR101-ACTION-SW (TR101-IDX) > SPACE                  DPKCS036
231000             PERFORM 6110-PROCESS-ITEMS                           DPKCS036
231100         END-IF                                                   DPKCS036
231200         ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
231300     END-PERFORM.                                                 DPKCS036
231400     PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
231500                                                                  DPKCS036
231600 EJECT                                                            DPKCS036
231700*----------------------------------------------------------------*DPKCS036
231800*    READ THE LIST QUEUE RECORD.                                 *DPKCS036
231900*----------------------------------------------------------------*DPKCS036
232000 6105-READ-SEL-QUEUE.                                             DPKCS036
232100                                                                  DPKCS036
232200     EXEC CICS                                                    DPKCS036
232300          READQ TS                                                DPKCS036
232400              QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
232500              INTO  (TR101-VOYAGE-SEL-REC)                        DPKCS036
232600              ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
232700              RESP  (PV-CICS-RESP)                                DPKCS036
232800     END-EXEC.                                                    DPKCS036
232900*                                                                 DPKCS036
233000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
233100         CONTINUE                                                 DPKCS036
233200     ELSE                                                         DPKCS036
233300         SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
233400         SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
233500         MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
233600                                   TO  DP013-PARAGRAPH            DPKCS036
233700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
233800                                   TO  DP013-MESSAGE-TEXT(1)      DPKCS036
233900         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
234000     END-IF.                                                      DPKCS036
234100                                                                  DPKCS036
234200 EJECT                                                            DPKCS036
234300*----------------------------------------------------------------*DPKCS036
234400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
234500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
234600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
234700*----------------------------------------------------------------*DPKCS036
234800 6110-PROCESS-ITEMS.                                              DPKCS036
234900                                                                  DPKCS036
235000     COMPUTE PV-ITEM = 1 + ((TR101-ITEM (TR101-IDX) - 1)          DPKCS036
235100                     / PC-ITEMS-PER-PANEL).                       DPKCS036
235200                                                                  DPKCS036
235300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
235400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
235500             PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
235600         END-IF                                                   DPKCS036
235700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
235800                                                                  DPKCS036
235900         PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
236000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
236100             CONTINUE                                             DPKCS036
236200         END-IF                                                   DPKCS036
236300     END-IF.                                                      DPKCS036
236400                                                                  DPKCS036
236500     COMPUTE PV-SUB = (TR101-ITEM (TR101-IDX)                     DPKCS036
236600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
236700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         DPKCS036
236800     MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
236900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
237000                                                                  DPKCS036
237100     IF TR101-INQ (TR101-IDX)                                     DPKCS036
237200        MOVE PC-INQ      TO LQW-ACTION (PV-SUB)                   DPKCS036
237300     END-IF.                                                      DPKCS036
237400                                                                  DPKCS036
237500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
237600                                                                  DPKCS036
237700 EJECT                                                            DPKCS036
237800*----------------------------------------------------------------*DPKCS036
237900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
238000*----------------------------------------------------------------*DPKCS036
238100 6111-WRITE-LIST-QUEUE.                                           DPKCS036
238200                                                                  DPKCS036
238300     EXEC CICS                                                    DPKCS036
238400         WRITEQ TS                                                DPKCS036
238500             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
238600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
238700             ITEM  (PV-SAVE-ITEM)                                 DPKCS036
238800             REWRITE                                              DPKCS036
238900             RESP  (PV-CICS-RESP)                                 DPKCS036
239000     END-EXEC.                                                    DPKCS036
239100*                                                                 DPKCS036
239200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
239300         CONTINUE                                                 DPKCS036
239400     ELSE                                                         DPKCS036
239500         SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
239600         SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
239700         MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
239800                               TO  DP013-PARAGRAPH                DPKCS036
239900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
240000                               TO  DP013-MESSAGE-TEXT(1)          DPKCS036
240100         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
240200     END-IF.                                                      DPKCS036
240300                                                                  DPKCS036
240400 EJECT                                                            DPKCS036
240500*----------------------------------------------------------------*DPKCS036
240600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
240700*----------------------------------------------------------------*DPKCS036
240800 6112-READ-LIST-QUEUE.                                            DPKCS036
240900                                                                  DPKCS036
241000     EXEC CICS                                                    DPKCS036
241100         READQ TS                                                 DPKCS036
241200             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
241300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
241400             ITEM  (PV-ITEM)                                      DPKCS036
241500             RESP  (PV-CICS-RESP)                                 DPKCS036
241600     END-EXEC.                                                    DPKCS036
241700*                                                                 DPKCS036
241800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
241900         CONTINUE                                                 DPKCS036
242000     ELSE                                                         DPKCS036
242100         SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
242200         SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
242300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
242400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
242500                                     TO DP013-MESSAGE-TEXT(1)     DPKCS036
242600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
242700     END-IF.                                                      DPKCS036
242800                                                                  DPKCS036
242900 EJECT                                                            DPKCS036
243000*----------------------------------------------------------------*DPKCS036
243100*    ABEND PROCESSOR MODULE                                      *DPKCS036
243200*----------------------------------------------------------------*DPKCS036
243300                                                                  DPKCS036
243400     COPY DPPD013.                                                DPKCS036
