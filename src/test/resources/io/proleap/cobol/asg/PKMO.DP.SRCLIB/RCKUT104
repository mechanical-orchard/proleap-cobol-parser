000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RCKUT104.                                         00040000
000500 AUTHOR.        JOE LAROSA.                                       00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   SEPTEMBER 1999.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM READS IN THE DAILY STORE RECEIPT EXTRACT FILE   * 00100000
001100*  (STOREEXT), READS THE SKU DATABASE (TSK) TO GET STS & PRICE, * 00110000
001200*  AND USES STORE NUMBER TO READ THE UPC STORE PRICING TABLE    * 00120000
001300*  (TUPCPLS) TO CHECK FOR A STORE SELLING PRICE SET-UP.         * 00130000
001400*  IF A DIFFERENCE IN THE PRICES FOUND, AN EXTRACT RECORD       * 00140000
001500*  (RCRD048) IS WRITTEN OUT.                                    * 00150000
001600***************************************************************** 00160000
001700*  CHANGED MM/DD/YY BY XXXXXXXXXXX                              * 00170000
001800*   WR# XXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX * 00180000
001900*                                                               * 00190000
002000***************************************************************** 00200000
002100***************************************************************** 00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300***************************************************************** 00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT DAILY-STORE-FILE ASSIGN TO UT-S-INP01.                00280000
002900     SELECT EXTRACT-FILE     ASSIGN TO UT-S-OUT01.                00290000
003000                                                                  00300000
003100***************************************************************** 00310000
003200 DATA DIVISION.                                                   00320000
003300***************************************************************** 00330000
003400 FILE SECTION.                                                    00340000
003500*                                                                 00350000
003600 FD  DAILY-STORE-FILE                                             00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     RECORD CONTAINS 300                                          00390000
004000     BLOCK CONTAINS 0 RECORDS                                     00400000
004100     DATA RECORD IS STORE-RECORD.                                 00410000
004200 01  STORE-RECORD                PIC X(300).                      00420000
004300*                                                                 00430000
004400 FD  EXTRACT-FILE                                                 00440000
004500     RECORDING MODE IS F                                          00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     RECORD CONTAINS 140                                          00470000
004800     BLOCK CONTAINS 0 RECORDS                                     00480000
004900     DATA RECORD IS EXTRACT-RECORD.                               00490000
005000 01  EXTRACT-RECORD              PIC X(140).                      00500000
005100*                                                                 00510000
005200***************************************************************** 00520000
005300 WORKING-STORAGE SECTION.                                         00530000
005400                                                                  00540000
005500 01  PS-PROGRAM-SWITCHES.                                         00550000
005600     05  PS-END-OF-INPUT-SW           PIC X(01)  VALUE 'N'.       00560000
005700         88  PS-END-OF-INPUT                     VALUE 'Y'.       00570000
005800         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00580000
005900     05  PS-SKU-FOUND-SW              PIC X(01)  VALUE 'N'.       00590000
006000         88  PS-SKU-FOUND                        VALUE 'Y'.       00600000
006100         88  PS-SKU-NOT-FOUND                    VALUE 'N'.       00610000
006110     05  PS-GROUP-PRICE-FOUND-SW      PIC X(01)  VALUE 'N'.       00620000
006120         88  PS-GROUP-PRICE-FOUND                VALUE 'Y'.       00630000
006130         88  PS-NO-GROUP-PRICE-FOUND             VALUE 'N'.       00640000
006140     05  PS-VRFD-DTE-PRICE-FOUND-SW   PIC X(01)  VALUE 'N'.       00650000
006150         88  PS-VRFD-DTE-PRICE-FOUND             VALUE 'Y'.       00660000
006160         88  PS-NO-VRFD-DTE-PRICE-FOUND          VALUE 'N'.       00670000
006170     05  PS-UPC-PRICE-SW              PIC X(01)  VALUE 'N'.       00680000
006180         88  PS-UPC-PRICE                        VALUE 'Y'.       00690000
006190         88  PS-NO-UPC-PRICE                     VALUE 'N'.       00700000
006200     05  PS-SKU-SW                    PIC X(01)  VALUE 'N'.       00710000
006300         88  PS-SAME-SKU                         VALUE 'Y'.       00720000
006400         88  PS-DIFF-SKU                         VALUE 'N'.       00730000
006500     05  PS-EOF-TUPCPLS-STR-CSR-SW       PIC  X(01)  VALUE 'N'.   00740000
006600         88  PS-EOF-TUPCPLS-STR-CSR                  VALUE 'Y'.   00750000
006700         88  PS-NOT-EOF-TUPCPLS-STR-CSR              VALUE 'N'.   00760000
006800     05  PS-EOF-TUPCPLS-RCVR-CSR-SW      PIC  X(01)  VALUE 'N'.   00770000
006900         88  PS-EOF-TUPCPLS-RCVR-CSR                 VALUE 'Y'.   00780000
007000         88  PS-NOT-EOF-TUPCPLS-RCVR-CSR             VALUE 'N'.   00790000
007100     05  PS-EOF-TUPCPLS-CNSTK-CSR-SW     PIC  X(01)  VALUE 'N'.   00800000
007200         88  PS-EOF-TUPCPLS-CNSTK-CSR                VALUE 'Y'.   00810000
007300         88  PS-NOT-EOF-TUPCPLS-CNSTK-CSR            VALUE 'N'.   00820000
007400*                                                                 00830000
007500 01  DK-DB2-KEY-FIELDS.                                           00840000
007600**************************************************************    00850000
007700*  DK-TSK-KEY GROUP VARIABLE IS REMOVED           WR# 21361  *    00860000
007800**************************************************************    00870000
007900**************************************************************    00880000
008000*  CHANGES MADE FOR WR# 21361 ENDS HERE.                     *    00890000
008100**************************************************************    00900000
008200     05  DK-TUPCPLS-KEY.                                          00910000
008300         10  DK-UPC-ITM-NBR           PIC S9(15)V COMP-3.         00920000
008400         10  DK-UPC-STORE             PIC S9(04)  COMP.           00930000
008500     05  DK-TMITGPL-KEY.                                          00940000
008600         10  DK-MEITGP-NBR            PIC  S9(9) COMP.            00950000
008700     05  DK-TRECITM-KEY.                                          00960000
008800         10  DK-ORD-NBR               PIC  S9(9) COMP.            00970000
008900         10  DK-ORD-LNE-NBR           PIC  S9(9) COMP.            00980000
009000         10  DK-REC-SEQ-NBR           PIC  S9(9) COMP.            00990000
009100     05  DK-TCEPLIT-KEY.                                          01000000
009200         10  DK-CNSTK-REQ-PL-NBR      PIC  S9(9) COMP.            01010000
009300         10  DK-PL-LNE-NBR            PIC  S9(4) COMP.            01020000
009400*                                                                 01030000
009500 01  PV-PROGRAM-VARIABLES.                                        01040000
009600     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       01050000
009700     05  PV-RECORDS-READ              PIC S9(8) VALUE ZERO.       01060000
009800     05  PV-RECORDS-ZERO-MARK         PIC S9(8) VALUE ZERO.       01070000
009900     05  PV-RECORDS-WRITTEN           PIC S9(8) VALUE ZERO.       01080000
010000     05  PV-RECORDS-NOT-WRITTEN       PIC S9(8) VALUE ZERO.       01090000
010100     05  PV-DISPLAY-AMT               PIC ZZZ,ZZZ.99-.            01100000
010200     05  PV-DISPLAY-ITEM              PIC 999999999999999.        01110000
010300     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZZ-.            01120000
010400     05  PV-AMT                       PIC  9(07)V99.              01130000
010500     05  PV-LOWST-UNIT-RTL-AMT        PIC S9(7)V9(2) COMP-3.      01140000
010600     05  PV-MEITGP-NBR                PIC  S9(9) COMP.            01150000
010700*************************************************************     01160000
010800*   PV-SAVE-SEQ REPLACED WITH PV-SAVE-NBR        WR #21361  *     01170000
010900*************************************************************     01180000
011000     05  PV-SAVE-SKU.                                             01190000
011100         10  PV-SAVE-DEPT             PIC X(03).                  01200000
011200         10  PV-SAVE-CLASS            PIC X(03).                  01210000
011300         10  PV-SAVE-NBR              PIC X(08).                  01220000
011400*************************************************************     01230000
011500*   CHANGES MADE FOR WR# 21361 ENDS HERE.                   *     01240000
011600*************************************************************     01250000
011700*                                                                 01260000
011800     05  PV-DATE-VERIFIED             PIC X(26) VALUE SPACE.      01270000
011900     05  FILLER REDEFINES PV-DATE-VERIFIED.                       01280000
012000         10  PV-DATE-VERIFIED-CC      PIC 99.                     01290000
012100         10  PV-DATE-VERIFIED-YY      PIC 99.                     01300000
012200         10  PV-DATE-VERIFIED-1ST     PIC X.                      01310000
012300         10  PV-DATE-VERIFIED-MM      PIC 99.                     01320000
012400         10  PV-DATE-VERIFIED-2ND     PIC X.                      01330000
012500         10  PV-DATE-VERIFIED-DD      PIC 99.                     01340000
012600         10  PV-DATE-VERIFIED-3RD     PIC X.                      01350000
012700         10  PV-DATE-TIMESTAMP        PIC X(15).                  01360000
012800*                                                                 01370000
011800     05  PV-CURRENT-DATE              PIC 9(08) VALUE ZEROES.     01380001
011800     05  FILLER                       REDEFINES PV-CURRENT-DATE.  01390001
               10 PV-CURRENT-CC             PIC 9(02).                  01400002
               10 FILLER                    PIC 9(06).                  01410002
012800*                                                                 01420001
012900 01 PC-PROGRAM-CONSTANTS.                                         01430000
013000     05 PC-PROGRAM-NAME               PIC X(08) VALUE 'RCKUT104'. 01440000
013100*                                                                 01450000
013200 01  PV-ABEND-FIELDS.                                             01460000
013300     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01470000
013400                                                 COMP SYNC.       01480000
013500     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT104'.01490000
013600     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01500000
013700     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01510000
013800     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01520000
013900     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01530000
014000     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01540000
014100     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01550000
014200     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01560000
014300     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01570000
014400     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01580000
014500     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01590000
014600*                                                                 01600000
014700******************************************************************01610000
014800*  USED FOR DB2 ERROR MESSAGE BUILDING                            01620000
014900******************************************************************01630000
015000     COPY DPWS004.                                                01640000
015100                                                                  01650000
015200******************************************************************01660000
015300*                                                    WR # 21361  *01670000
015400*   RECORD LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE        *01680000
015500******************************************************************01690000
015600     COPY XLWS001.                                                01700000
015700******************************************************************01710000
015800*   CHANGES MADE FOR WR # 21361 ENDS HERE                        *01720000
015900******************************************************************01730000
016000                                                                  01740000
016100******************************************************************01750000
016200*   DB2 SQL COMMUNICATION AREA                                    01760000
016300******************************************************************01770000
016400     EXEC SQL                                                     01780000
016500          INCLUDE SQLCA                                           01790000
016600     END-EXEC.                                                    01800000
016700                                                                  01810000
016800******************************************************************01820000
016900*   DCLGEN FOR TSK TABLE REMOVED                    WR # 21361   *01830000
017000******************************************************************01840000
017100******************************************************************01850000
017200*   CHANGES MADE FOR WR # 21361 ENDS HERE                        *01860000
017300******************************************************************01870000
017400******************************************************************01880000
017500*   DB2 DCLGEN FOR UPC PRICING TABLE                              01890000
017600******************************************************************01900000
017700     EXEC SQL                                                     01910000
017800          INCLUDE TUPCPLS                                         01920000
017900     END-EXEC.                                                    01930000
018000                                                                  01940000
018010******************************************************************01950000
018020*   DB2 DCLGEN FOR ITEM GROUP PRICING TABLE                       01960000
018030******************************************************************01970000
018040     EXEC SQL                                                     01980000
018050          INCLUDE TMITGPL                                         01990000
018060     END-EXEC.                                                    02000000
018070                                                                  02010000
018080******************************************************************02020000
018090*   DB2 DCLGEN FOR RECEIVER ITEM TABLE                            02030000
018100******************************************************************02040000
018200     EXEC SQL                                                     02050000
018300          INCLUDE TRECITM                                         02060000
018400     END-EXEC.                                                    02070000
018500                                                                  02080000
018600******************************************************************02090000
018700*   DB2 DCLGEN FOR CENTRAL STOCK PULL ITEM TABLE                  02100000
018800******************************************************************02110000
018900     EXEC SQL                                                     02120000
019000          INCLUDE TCEPLIT                                         02130000
019100     END-EXEC.                                                    02140000
019200                                                                  02150000
019300******************************************************************02160000
019400*  CURSOR AGAINST TUPCPLS USING STORE                             02170000
019500******************************************************************02180000
019600                                                                  02190000
019700     EXEC SQL                                                     02200000
019800        DECLARE TUPCPLS-STR-CSR CURSOR FOR                        02210000
019900          SELECT  UNT_RTL_AMT                                     02220000
020000                 ,EFF_END_TMST                                    02230000
020100                 ,MEITGP_NBR                                      02240000
020200            FROM  TUPCPLS                                         02250000
020300           WHERE  DATE(EFF_BEG_TMST) <= :PV-DATE-VERIFIED         02260000
020400            AND  (DATE(EFF_END_TMST) >= :PV-DATE-VERIFIED         02270000
020500             OR   EFF_END_TMST IS NULL)                           02280000
020600            AND   ITM_NBR = :DK-UPC-ITM-NBR                       02290000
020700            AND   STR_NBR = :DK-UPC-STORE                         02300000
020800            AND   OPERCO_NBR    = '03'                            02310000
020900         ORDER BY EFF_END_TMST DESC                               02320000
021000     END-EXEC.                                                    02330000
021100******************************************************************02340000
021200*  CURSOR AGAINST TUPCPLS AND TRECITM USING RECEIVER AND LINE     02350000
021300******************************************************************02360000
021400                                                                  02370000
021500     EXEC SQL                                                     02380000
021600        DECLARE TUPCPLS-RCVR-CSR CURSOR FOR                       02390000
021700         SELECT  A.UNT_RTL_AMT                                    02400000
021800               , A.EFF_END_TMST                                   02410000
021810               , A.MEITGP_NBR                                     02420000
021820           FROM  TUPCPLS A                                        02430000
021830              ,  TRECITM B                                        02440000
021840          WHERE  B.ORD_NBR = :DK-ORD-NBR                          02450000
021850            AND  B.REC_SEQ_NBR = :DK-REC-SEQ-NBR                  02460000
021860            AND  B.ORD_LNE_NBR = :DK-ORD-LNE-NBR                  02470000
021870            AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED        02480000
021880            AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED        02490000
021890            OR   A.EFF_END_TMST IS NULL)                          02500000
021900            AND  A.ITM_NBR = B.ITM_NBR                            02510000
022000            AND  A.STR_NBR = 0                                    02520000
022100            AND  A.OPERCO_NBR    = '03'                           02530000
022200          ORDER BY A.EFF_END_TMST DESC                            02540000
022300     END-EXEC.                                                    02550000
022400******************************************************************02560000
022500*  CURSOR AGAINST TUPCPLS AND TRECITM USING CENTRAL STOCK REQ     02570000
022600*  PULL NUMBER                                                    02580000
022700******************************************************************02590000
022800                                                                  02600000
022900     EXEC SQL                                                     02610000
023000        DECLARE TUPCPLS-CNSTK-CSR CURSOR FOR                      02620000
023100            SELECT  A.UNT_RTL_AMT                                 02630000
023200                  , A.EFF_END_TMST                                02640000
023300                  , A.MEITGP_NBR                                  02650000
023400              FROM  TUPCPLS A                                     02660000
023500                 ,  TCEPLIT B                                     02670000
023600             WHERE  B.CNSTK_REQ_PL_NBR = :DK-CNSTK-REQ-PL-NBR     02680000
023700               AND  B.PL_LNE_NBR = :DK-PL-LNE-NBR                 02690000
023800               AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED     02700000
023900               AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED     02710000
024000               OR   A.EFF_END_TMST IS NULL)                       02720000
024100               AND  A.ITM_NBR = B.ITM_NBR                         02730000
024200               AND  A.STR_NBR = 0                                 02740000
024300               AND  A.OPERCO_NBR    = '03'                        02750000
024400             ORDER BY A.EFF_END_TMST DESC                         02760000
024500     END-EXEC.                                                    02770000
024600***********************************************************       02780000
024700*  COPYBOOK USED BY INPUT FILE                            *       02790000
024800***********************************************************       02800000
024900     COPY STOREEXT.                                               02810000
025000                                                                  02820000
025100***********************************************************       02830000
025200*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       02840000
025300***********************************************************       02850000
025400     COPY RCRD048.                                                02860000
025500                                                                  02870000
025600 EJECT                                                            02880000
025700***********************************************************       02890000
025800 PROCEDURE DIVISION.                                              02900000
025900***********************************************************       02910000
026000     DISPLAY '*** BEGINNING RCKUT104 ***'.                        02920000
026100*                                                                 02930000
026200     OPEN INPUT  DAILY-STORE-FILE                                 02940000
026300          OUTPUT EXTRACT-FILE.                                    02950000
026400*                                                                 02960000
026500*READ FIRST INPUT RECORD.                                         02970000
026600     SET PS-NOT-END-OF-INPUT TO TRUE.                             02980000
026700     READ DAILY-STORE-FILE                                        02990000
026800       INTO STORE-EXTRACT-LINE                                    03000000
026900         AT END                                                   03010000
027000           SET PS-END-OF-INPUT TO TRUE.                           03020000
027100*                                                                 03030001
027200*RETRIEVE CURRENT CENTURY.                                        03040001
            ACCEPT PV-CURRENT-DATE          FROM DATE YYYYMMDD.         03050001
027100*                                                                 03060000
027200*PROCESS INPUT FILE.                                              03070000
027300     IF PS-END-OF-INPUT                                           03080000
027400         DISPLAY '**** NO INPUT FILE FOUND FOR RCKUT104 ****'     03090000
027500     ELSE                                                         03100000
027600         PERFORM 1000-PROCESS-INPUT                               03110000
027700             UNTIL PS-END-OF-INPUT                                03120000
027800     END-IF.                                                      03130000
027900*                                                                 03140000
028000     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            03150000
028100     DISPLAY '*** RECORDS READ        ==> ' PV-DISPLAY-RECORD.    03160000
028200     MOVE PV-RECORDS-ZERO-MARK   TO PV-DISPLAY-RECORD.            03170000
028300     DISPLAY '*** RECORDS ZERO MARK   ==> ' PV-DISPLAY-RECORD.    03180000
028400     MOVE PV-RECORDS-WRITTEN     TO PV-DISPLAY-RECORD.            03190000
028500     DISPLAY '*** RECORDS WRITTEN     ==> ' PV-DISPLAY-RECORD.    03200000
028600     MOVE PV-RECORDS-NOT-WRITTEN TO PV-DISPLAY-RECORD.            03210000
028700     DISPLAY '*** RECORDS NOT WRITTEN ==> ' PV-DISPLAY-RECORD.    03220000
028800*                                                                 03230000
028900*CLOSE FILES.                                                     03240000
029000     CLOSE DAILY-STORE-FILE                                       03250000
029100           EXTRACT-FILE.                                          03260000
029200*                                                                 03270000
029300     GOBACK.                                                      03280000
029400*                                                                 03290000
029500*                                                                 03300000
029600***************************************************************** 03310000
029700 1000-PROCESS-INPUT.                                              03320000
029800***************************************************************** 03330000
029900     MOVE '1000-PROCESS-INPUT      ' TO PV-ABEND-PARAGRAPH.       03340000
030000*                                                                 03350000
030100     ADD +1 TO PV-RECORDS-READ.                                   03360000
030200*                                                                 03370000
030300*GET SKU.                                                         03380000
030400     PERFORM 1100-GET-SKU.                                        03390000
030500*                                                                 03400000
030600*GET UPC PRICE.                                                   03410000
030700     IF  PS-SKU-FOUND                                             03420000
030800***  AND XL001-REGN-PRIC-IND = 'Y'                                03430000
030900***      DISPLAY ' * SKU W/ Y FLAG = '                            03440000
031000***              DK-SKU-DEPT '-' DK-SKU-CLASS '-' DK-SKU-SEQ      03450000
031100         PERFORM 1200-GET-PRICE                                   03460000
031200     ELSE                                                         03470000
031300         SET PS-NO-UPC-PRICE TO TRUE                              03480000
031400     END-IF.                                                      03490000
031500*                                                                 03500000
031600*WRITE EXTRACT RECORD.                                            03510000
031700     PERFORM 1500-CREATE-EXTRACT-RECORD.                          03520000
031800*                                                                 03530000
031900*READ NEXT INPUT RECORD.                                          03540000
032000     PERFORM 2000-READ-INPUT-FILE.                                03550000
032100*                                                                 03560000
032200*                                                                 03570000
032300***************************************************************** 03580000
032400 1100-GET-SKU.                                                    03590000
032500***************************************************************** 03600000
032600     MOVE '1100-GET-SKU            ' TO PV-ABEND-PARAGRAPH.       03610000
032700*                                                                 03620000
032800     IF (SE-DEPT NOT = PV-SAVE-DEPT)                              03630000
032900       OR (SE-CLASS NOT = PV-SAVE-CLASS)                          03640000
033000       OR (SE-SKU-NBR NOT = PV-SAVE-NBR)                          03650000
033100         MOVE SE-DEPT    TO PV-SAVE-DEPT                          03660000
033200         MOVE SE-CLASS   TO PV-SAVE-CLASS                         03670000
033300         MOVE SE-SKU-NBR TO PV-SAVE-NBR                           03680000
033400         SET PS-SKU-FOUND TO TRUE                                 03690000
033500         SET PS-DIFF-SKU  TO TRUE                                 03700000
033600         MOVE ZERO TO PV-MEITGP-NBR                               03710000
033700         PERFORM 1150-CALL-XLKUT-DOMAIN-PGM                       03720000
033800         IF  PS-SKU-FOUND                                         03730000
033900             SET PS-UPC-PRICE    TO TRUE                          03740000
034000             MOVE XL001-ITM-NBR  TO DK-UPC-ITM-NBR                03750000
034100                                                                  03760000
034200             IF  XL001-GP-QTY > 1                                 03770000
034300                 COMPUTE  PV-AMT = XL001-GP-AMT / XL001-GP-QTY    03780000
034400                 MOVE PV-AMT      TO PV-LOWST-UNIT-RTL-AMT        03790000
034500             ELSE                                                 03800000
034600                 MOVE 0           TO PV-LOWST-UNIT-RTL-AMT        03810000
034700             END-IF                                               03820000
034800                                                                  03830000
034900             MOVE 0              TO DK-UPC-STORE                  03840000
035000             MOVE SE-PO          TO DK-ORD-NBR                    03850000
035100             MOVE SE-POLINENO    TO DK-ORD-LNE-NBR                03860000
035200             MOVE SE-REC-SEQ-NBR TO DK-REC-SEQ-NBR                03870000
035300             MOVE 20            TO PV-DATE-VERIFIED-CC            03880000
035400             MOVE SE-DV-YY      TO PV-DATE-VERIFIED-YY            03890000
035500             MOVE '-'           TO PV-DATE-VERIFIED-1ST           03900000
035600             MOVE SE-DV-MM      TO PV-DATE-VERIFIED-MM            03910000
035700             MOVE '-'           TO PV-DATE-VERIFIED-2ND           03920000
035800             MOVE SE-DV-DD      TO PV-DATE-VERIFIED-DD            03930000
035900             IF  SE-REC-SEQ-NBR = 0                               03940000
036000                 MOVE SE-PO          TO DK-CNSTK-REQ-PL-NBR       03950000
036100                 MOVE SE-POLINENO    TO DK-PL-LNE-NBR             03960000
036200                 SET PS-VRFD-DTE-PRICE-FOUND TO TRUE              03970000
036300                 PERFORM 1270-SELECT-TUPCPLS                      03980000
036400                 IF  PS-NO-VRFD-DTE-PRICE-FOUND                   03990000
036500                     CONTINUE                                     04000000
036600                 ELSE                                             04010000
036700                     PERFORM 1280-PROCESS-FOR-GROUP-PRICE         04020000
036800                     MOVE PV-AMT TO PV-LOWST-UNIT-RTL-AMT         04030000
036900                 END-IF                                           04040000
037000             ELSE                                                 04050000
037100                 SET PS-VRFD-DTE-PRICE-FOUND TO TRUE              04060000
037200                 PERFORM 1260-SELECT-TUPCPLS                      04070000
037300                 IF  PS-NO-VRFD-DTE-PRICE-FOUND                   04080000
037400                     CONTINUE                                     04090000
037500                 ELSE                                             04100000
037600                     PERFORM 1280-PROCESS-FOR-GROUP-PRICE         04110000
037700                     MOVE PV-AMT TO PV-LOWST-UNIT-RTL-AMT         04120000
037800                 END-IF                                           04130000
037900             END-IF                                               04140000
038000             IF  PS-UPC-PRICE                                     04150000
038100                 IF  PV-LOWST-UNIT-RTL-AMT = 0                    04160000
038200                     MOVE UPCPLS-UNT-RTL-AMT TO                   04170000
038300                          XL001-UNT-RTL-AMT                       04180000
038400                 ELSE                                             04190000
038500                     MOVE PV-LOWST-UNIT-RTL-AMT TO                04200000
038600                          XL001-UNT-RTL-AMT                       04210000
038700                 END-IF                                           04220000
038800             ELSE                                                 04230000
038900                 MOVE XL001-ITM-NBR TO PV-DISPLAY-ITEM            04240000
039000                 DISPLAY ' * TUPCPLS STORE/ITEM NOT FOUND = '     04250000
039100                          PV-DISPLAY-ITEM                         04260000
039200                 IF  PV-LOWST-UNIT-RTL-AMT = 0                    04270000
039300                     CONTINUE                                     04280000
039400                 ELSE                                             04290000
039500                     MOVE PV-LOWST-UNIT-RTL-AMT TO                04300000
039600                          XL001-UNT-RTL-AMT                       04310000
039700                 END-IF                                           04320000
039800             END-IF                                               04330000
039900         END-IF                                                   04340000
040000     ELSE                                                         04350000
040100         SET PS-SAME-SKU  TO TRUE                                 04360000
040200     END-IF.                                                      04370000
040300*                                                                 04380000
040400***************************************************************** 04390000
040500 1150-CALL-XLKUT-DOMAIN-PGM.                                      04400000
040600                                                                  04410000
040700     MOVE '1150-CALL-XLKUT-DOMAIN-PGM' TO PV-ABEND-PARAGRAPH.     04420000
040800                                                                  04430000
040900     INITIALIZE XL001-ITEM-COMMAREA.                              04440000
041000*                                                                 04450000
041100     MOVE SE-SKU-NBR TO XL001-KEY-SKU.                            04460000
041200     MOVE ZEROES     TO XL001-KEY-STR-NBR.                        04470000
041300*                                                                 04480000
041400     SET  XL001-BY-NUMERIC-SKU                                    04490000
041500          XL001-SELECT-SKU                                        04500000
041600          XL001-SELECT-SKU-STR TO TRUE.                           04510000
041700*                                                                 04520000
041800     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                04530000
041900*                                                                 04540000
042000     MOVE 'SKU'             TO PV-ABEND-STRUCTURE-1.              04550000
042100     MOVE XL001-SKU-SQLCODE TO SQLCODE.                           04560000
042200*                                                                 04570000
042300     EVALUATE TRUE                                                04580000
042400       WHEN XL001-SKU-SQLCODE = +0                                04590000
042500         CONTINUE                                                 04600000
042600       WHEN XL001-SKU-SQLCODE = +100                              04610000
042700         SET PS-SKU-NOT-FOUND TO TRUE                             04620000
042800         DISPLAY '*** SKU NOT FOUND ==> ' XL001-KEY-SKU           04630000
042900       WHEN XL001-SKU-CONTENTION                                  04640000
043000         MOVE 'SKU CONTENTION' TO PV-DB2-OPERATION-MESSAGE-1      04650000
043100         PERFORM Z999-SQL-ERROR                                   04660000
043200       WHEN OTHER                                                 04670000
043300         MOVE 'INVALID SQLCODE' TO PV-DB2-OPERATION-MESSAGE-1     04680000
043400         PERFORM Z999-SQL-ERROR                                   04690000
043500     END-EVALUATE.                                                04700000
043600*                                                                 04710000
043700     MOVE 'SKU-STORE'           TO PV-ABEND-STRUCTURE-1.          04720000
043800     MOVE XL001-SKU-STR-SQLCODE TO SQLCODE.                       04730000
043900*                                                                 04740000
044000     EVALUATE TRUE                                                04750000
044100       WHEN XL001-SKU-STR-SQLCODE = +0                            04760000
044200         CONTINUE                                                 04770000
044300       WHEN XL001-SKU-STR-SQLCODE = +100                          04780000
044400         CONTINUE                                                 04790000
044500       WHEN XL001-SKU-STR-CONTENTION                              04800000
044600         MOVE 'SKU STR CONTENTION' TO PV-DB2-OPERATION-MESSAGE-1  04810000
044700         PERFORM Z999-SQL-ERROR                                   04820000
044800       WHEN OTHER                                                 04830000
044900         MOVE 'INVALID SQLCODE' TO PV-DB2-OPERATION-MESSAGE-1     04840000
045000         PERFORM Z999-SQL-ERROR                                   04850000
045100     END-EVALUATE.                                                04860000
045200*                                                                 04870000
045300***************************************************************** 04880000
045400 1200-GET-PRICE.                                                  04890000
045500***************************************************************** 04900000
045600     MOVE '1200-GET-PRICE          ' TO PV-ABEND-PARAGRAPH.       04910000
045700                                                                  04920000
045800     SET PS-UPC-PRICE   TO TRUE.                                  04930000
045900                                                                  04940000
046000     MOVE XL001-ITM-NBR TO DK-UPC-ITM-NBR.                        04950000
046100     MOVE SE-LOC-NBR    TO DK-UPC-STORE.                          04960000
046200                                                                  04970000
046300     MOVE 20            TO PV-DATE-VERIFIED-CC.                   04980000
046400     MOVE SE-DV-YY      TO PV-DATE-VERIFIED-YY.                   04990000
046500     MOVE '-'           TO PV-DATE-VERIFIED-1ST.                  05000000
046600     MOVE SE-DV-MM      TO PV-DATE-VERIFIED-MM.                   05010000
046700     MOVE '-'           TO PV-DATE-VERIFIED-2ND.                  05020000
046800     MOVE SE-DV-DD      TO PV-DATE-VERIFIED-DD.                   05030000
046900                                                                  05040000
047000***  DISPLAY ' * TUPCPLS STORE / DATE = '                         05050000
047100***          SE-LOC-NBR ' / ' PV-DATE-VERIFIED                    05060000
047200     PERFORM 1250-SELECT-TUPCPLS.                                 05070000
047300     IF  PS-UPC-PRICE                                             05080000
047400         PERFORM 1280-PROCESS-FOR-GROUP-PRICE                     05090000
047500         IF  PV-AMT = 0                                           05100000
047600             CONTINUE                                             05110000
047700         ELSE                                                     05120000
047800             MOVE PV-AMT TO UPCPLS-UNT-RTL-AMT                    05130000
047900         END-IF                                                   05140000
048000     END-IF.                                                      05150000
048100                                                                  05160000
048200***************************************************************** 05170000
048300 1250-SELECT-TUPCPLS.                                             05180000
048400***************************************************************** 05190000
048500     MOVE '1250-SELECT-TUPCPLS     ' TO PV-ABEND-PARAGRAPH.       05200000
048600*                                                                 05210000
048700     INITIALIZE DCLTUPCPLS.                                       05220000
048800*                                                                 05230000
048900     EXEC SQL                                                     05240000
049000       SELECT  UNT_RTL_AMT                                        05250000
049100            ,  MEITGP_NBR                                         05260000
049200         INTO  :UPCPLS-UNT-RTL-AMT                                05270000
049300            ,  :UPCPLS-MEITGP-NBR                                 05280000
049400         FROM  TUPCPLS                                            05290000
049500        WHERE  DATE(EFF_BEG_TMST) <= :PV-DATE-VERIFIED            05300000
049600         AND  (DATE(EFF_END_TMST) >= :PV-DATE-VERIFIED            05310000
049700          OR   EFF_END_TMST IS NULL)                              05320000
049800         AND   ITM_NBR = :DK-UPC-ITM-NBR                          05330000
049900         AND   STR_NBR = :DK-UPC-STORE                            05340000
050000         AND   OPERCO_NBR    = '03'                               05350000
050100     END-EXEC.                                                    05360000
050200                                                                  05370000
050300     EVALUATE TRUE                                                05380000
050400       WHEN SQLCODE = ZEROS                                       05390000
050500         CONTINUE                                                 05400000
050600***      MOVE UPCPLS-UNT-RTL-AMT TO PV-DISPLAY-AMT                05410000
050700***      DISPLAY ' * TUPCPLS RETAIL AMT = ' PV-DISPLAY-AMT        05420000
050800       WHEN SQLCODE = -811                                        05430000
050900         PERFORM 1255-SELECT-TUPCPLS-STR                          05440000
051000       WHEN SQLCODE = +100                                        05450000
051100***      DISPLAY ' * TUPCPLS NOT FOUND * '                        05460000
051200         SET PS-NO-UPC-PRICE TO TRUE                              05470000
051300       WHEN OTHER                                                 05480000
051400         PERFORM Z999-SQL-ERROR                                   05490000
051500     END-EVALUATE.                                                05500000
051600                                                                  05510000
051700*                                                                 05520000
051800***************************************************************** 05530000
051900 1255-SELECT-TUPCPLS-STR.                                         05540000
052000***************************************************************** 05550000
052100     MOVE '1255-SELECT-TUPCPLS-STR ' TO PV-ABEND-PARAGRAPH.       05560000
052200*                                                                 05570000
052300     DISPLAY ' 1255-SELECT-TUPCPLS * '                            05580000
052400                                                                  05590000
052500                                                                  05600000
052600     INITIALIZE DCLTUPCPLS.                                       05610000
052700*                                                                 05620000
052800     EXEC SQL                                                     05630000
052900       SELECT  UNT_RTL_AMT                                        05640000
053000            ,  MEITGP_NBR                                         05650000
053100         INTO  :UPCPLS-UNT-RTL-AMT                                05660000
053200            ,  :UPCPLS-MEITGP-NBR                                 05670000
053300         FROM  TUPCPLS                                            05680000
053400        WHERE  DATE(EFF_BEG_TMST) <= :PV-DATE-VERIFIED            05690000
053500         AND   EFF_END_TMST IS NULL                               05700000
053600         AND   ITM_NBR = :DK-UPC-ITM-NBR                          05710000
053700         AND   STR_NBR = :DK-UPC-STORE                            05720000
053800         AND   OPERCO_NBR    = '03'                               05730000
053900     END-EXEC.                                                    05740000
054000                                                                  05750000
054100     EVALUATE TRUE                                                05760000
054200       WHEN SQLCODE = ZEROS                                       05770000
054300         CONTINUE                                                 05780000
054400       WHEN SQLCODE = +100                                        05790000
054500          PERFORM 1300-PROCESS-TUPCPLS-STR-CSR                    05800000
054600       WHEN OTHER                                                 05810000
054700         PERFORM Z999-SQL-ERROR                                   05820000
054800     END-EVALUATE.                                                05830000
054900                                                                  05840000
055000*                                                                 05850000
055100***************************************************************** 05860000
055200 1260-SELECT-TUPCPLS.                                             05870000
055300***************************************************************** 05880000
055400     MOVE '1260-SELECT-TUPCPLS     ' TO PV-ABEND-PARAGRAPH.       05890000
055500*                                                                 05900000
055600     INITIALIZE DCLTUPCPLS.                                       05910000
055700*                                                                 05920000
055800     EXEC SQL                                                     05930000
055900       SELECT  A.UNT_RTL_AMT                                      05940000
056000            ,  A.MEITGP_NBR                                       05950000
056100         INTO  :UPCPLS-UNT-RTL-AMT                                05960000
056200            ,  :UPCPLS-MEITGP-NBR                                 05970000
056300         FROM  TUPCPLS A                                          05980000
056400            ,  TRECITM B                                          05990000
056500        WHERE  B.ORD_NBR = :DK-ORD-NBR                            06000000
056600          AND  B.REC_SEQ_NBR = :DK-REC-SEQ-NBR                    06010000
056700          AND  B.ORD_LNE_NBR = :DK-ORD-LNE-NBR                    06020000
056800          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          06030000
056900          AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED          06040000
057000          OR   A.EFF_END_TMST IS NULL)                            06050000
057100          AND  A.ITM_NBR = B.ITM_NBR                              06060000
057200          AND  A.STR_NBR = 0                                      06070000
057300          AND  A.OPERCO_NBR    = '03'                             06080000
057400     END-EXEC.                                                    06090000
057500                                                                  06100000
057600     EVALUATE TRUE                                                06110000
057700       WHEN SQLCODE = ZEROS                                       06120000
057800***      MOVE UPCPLS-UNT-RTL-AMT TO PV-DISPLAY-AMT                06130000
057900***      DISPLAY ' * TUPCPLS RETAIL AMT = ' PV-DISPLAY-AMT        06140000
058000         CONTINUE                                                 06150000
058100       WHEN SQLCODE = -811                                        06160000
058200          PERFORM 1265-SELECT-TUPCPLS-RCVR                        06170000
058300       WHEN SQLCODE = +100                                        06180000
058400***      DISPLAY ' * TUPCPLS NOT FOUND * '                        06190000
058500         SET PS-NO-UPC-PRICE TO TRUE                              06200000
058600         SET PS-NO-VRFD-DTE-PRICE-FOUND TO TRUE                   06210000
058700       WHEN OTHER                                                 06220000
058800         PERFORM Z999-SQL-ERROR                                   06230000
058900     END-EVALUATE.                                                06240000
059000                                                                  06250000
059100*                                                                 06260000
059200*                                                                 06270000
059300***************************************************************** 06280000
059400 1265-SELECT-TUPCPLS-RCVR.                                        06290000
059500***************************************************************** 06300000
059600     MOVE '1265-SELECT-TUPCPLS-RCVR' TO PV-ABEND-PARAGRAPH.       06310000
059700*                                                                 06320000
059800     INITIALIZE DCLTUPCPLS.                                       06330000
059900*                                                                 06340000
060000     EXEC SQL                                                     06350000
060100       SELECT  A.UNT_RTL_AMT                                      06360000
060200            ,  A.MEITGP_NBR                                       06370000
060300         INTO  :UPCPLS-UNT-RTL-AMT                                06380000
060400            ,  :UPCPLS-MEITGP-NBR                                 06390000
060500         FROM  TUPCPLS A                                          06400000
060600            ,  TRECITM B                                          06410000
060700        WHERE  B.ORD_NBR = :DK-ORD-NBR                            06420000
060800          AND  B.REC_SEQ_NBR = :DK-REC-SEQ-NBR                    06430000
060900          AND  B.ORD_LNE_NBR = :DK-ORD-LNE-NBR                    06440000
060910          AND  B.VER_STATUS_CDE  = 'A'                            06450000
060920          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          06460000
060930          AND  A.EFF_END_TMST IS NULL                             06470000
060940          AND  A.ITM_NBR = B.ITM_NBR                              06480000
060950          AND  A.STR_NBR = 0                                      06490000
060960          AND  A.OPERCO_NBR    = '03'                             06500000
060970     END-EXEC.                                                    06510000
060980                                                                  06520000
060990     EVALUATE TRUE                                                06530000
061000       WHEN SQLCODE = ZEROS                                       06540000
061100           CONTINUE                                               06550000
061200       WHEN SQLCODE = +100                                        06560000
061300           PERFORM 1350-PRCS-UPCPLS-RCVR-CSR                      06570000
061400       WHEN OTHER                                                 06580000
061500         PERFORM Z999-SQL-ERROR                                   06590000
061600     END-EVALUATE.                                                06600000
061700                                                                  06610000
061800*                                                                 06620000
061900***************************************************************** 06630000
062000 1270-SELECT-TUPCPLS.                                             06640000
062100***************************************************************** 06650000
062200*  THIS PARAGRAPH WILL BE USED FOR THE RECORDS ASSOCIATED TO      06660000
062300*  CENTRAL STOCK PULLS.  IF THE RECEIVER SEQUENCE NUMBER ON       06670000
062400*  THE INPUT IS EQUAL TO ZERO, THIS WOULD BE A RECORD ASSOCIATED  06680000
062500*  TO A CENTRAL STOCK PULL.  IN CEK010, THERE IS A PROGRAM THAT   06690000
062600*  TAKES THE DAILY PULLS AND CONVERTS FROM THE CENTRAL STOCK      06700000
062700*  LAYOUT TO THE STOREEXT LAYOUT (RCKUT105) SO THAT THE DATA      06710000
062800*  COULD BE PASSED THROUGH THIS PROGRAM WHICH ALREADY EXISTED.    06720000
062900***************************************************************** 06730000
063000     MOVE '1270-SELECT-TUPCPLS     ' TO PV-ABEND-PARAGRAPH.       06740000
063100*                                                                 06750000
063200     INITIALIZE DCLTUPCPLS.                                       06760000
063300*                                                                 06770000
063400     EXEC SQL                                                     06780000
063500       SELECT  A.UNT_RTL_AMT                                      06790000
063600            ,  A.MEITGP_NBR                                       06800000
063700         INTO  :UPCPLS-UNT-RTL-AMT                                06810000
063800            ,  :UPCPLS-MEITGP-NBR                                 06820000
063900         FROM  TUPCPLS A                                          06830000
064000            ,  TCEPLIT B                                          06840000
064100        WHERE  B.CNSTK_REQ_PL_NBR = :DK-CNSTK-REQ-PL-NBR          06850000
064200          AND  B.PL_LNE_NBR = :DK-PL-LNE-NBR                      06860000
064300          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          06870000
064400          AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED          06880000
064500          OR   A.EFF_END_TMST IS NULL)                            06890000
064600          AND  A.ITM_NBR = B.ITM_NBR                              06900000
064700          AND  A.STR_NBR = 0                                      06910000
064800          AND  A.OPERCO_NBR    = '03'                             06920000
064900     END-EXEC.                                                    06930000
065000                                                                  06940000
065100     EVALUATE TRUE                                                06950000
065200       WHEN SQLCODE = ZEROS                                       06960000
065300          CONTINUE                                                06970000
065400***      MOVE UPCPLS-UNT-RTL-AMT TO PV-DISPLAY-AMT                06980000
065500***      DISPLAY ' * TUPCPLS RETAIL AMT = ' PV-DISPLAY-AMT        06990000
065600       WHEN SQLCODE = -811                                        07000000
065700          PERFORM 1275-SELECT-TUPCPLS-PL-NBR                      07010000
065800       WHEN SQLCODE = +100                                        07020000
065900***      DISPLAY ' * TUPCPLS NOT FOUND * '                        07030000
066000         SET PS-NO-UPC-PRICE TO TRUE                              07040000
066100         SET PS-NO-VRFD-DTE-PRICE-FOUND TO TRUE                   07050000
066200       WHEN OTHER                                                 07060000
066300         PERFORM Z999-SQL-ERROR                                   07070000
066400     END-EVALUATE.                                                07080000
066500                                                                  07090000
066600*                                                                 07100000
066700***************************************************************** 07110000
066800 1275-SELECT-TUPCPLS-PL-NBR.                                      07120000
066900***************************************************************** 07130000
067000     MOVE '1275-SELECT-TUPCPLS-PL-NBR'  TO PV-ABEND-PARAGRAPH.    07140000
067100*                                                                 07150000
067200     INITIALIZE DCLTUPCPLS.                                       07160000
067300*                                                                 07170000
067400     EXEC SQL                                                     07180000
067500       SELECT  A.UNT_RTL_AMT                                      07190000
067600            ,  A.MEITGP_NBR                                       07200000
067700         INTO  :UPCPLS-UNT-RTL-AMT                                07210000
067800            ,  :UPCPLS-MEITGP-NBR                                 07220000
067900         FROM  TUPCPLS A                                          07230000
068000            ,  TCEPLIT B                                          07240000
068100        WHERE  B.CNSTK_REQ_PL_NBR = :DK-CNSTK-REQ-PL-NBR          07250000
068200          AND  B.PL_LNE_NBR = :DK-PL-LNE-NBR                      07260000
068300          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          07270000
068400          AND  A.EFF_END_TMST IS NULL                             07280000
068500          AND  A.ITM_NBR = B.ITM_NBR                              07290000
068600          AND  A.STR_NBR = 0                                      07300000
068700          AND  A.OPERCO_NBR    = '03'                             07310000
068800     END-EXEC.                                                    07320000
068900                                                                  07330000
069000     EVALUATE TRUE                                                07340000
069100       WHEN SQLCODE = ZEROS                                       07350000
069200           CONTINUE                                               07360000
069300       WHEN SQLCODE = +100                                        07370000
069400           PERFORM 1400-PRCESS-UPCPLS-CNSTK-CSR                   07380000
069500       WHEN OTHER                                                 07390000
069600         PERFORM Z999-SQL-ERROR                                   07400000
069700     END-EVALUATE.                                                07410000
069800                                                                  07420000
069900**************************************************************    07430000
070000 1280-PROCESS-FOR-GROUP-PRICE.                                    07440000
070100                                                                  07450000
070200     IF  UPCPLS-MEITGP-NBR = 0                                    07460000
070300         MOVE ZEROS TO PV-AMT                                     07470000
070400     ELSE                                                         07480000
070500         MOVE UPCPLS-MEITGP-NBR TO DK-MEITGP-NBR                  07490000
070600         PERFORM 1600-GET-GROUP-PRICE                             07500000
070700         IF  PS-GROUP-PRICE-FOUND                                 07510000
070800             IF  MITGPL-MITGPL-QTY > 1                            07520000
070900                 COMPUTE  PV-AMT = MITGPL-GP-AMT /                07530000
071000                          MITGPL-MITGPL-QTY                       07540000
071100             ELSE                                                 07550000
071200                 MOVE ZEROS TO PV-AMT                             07560000
071300             END-IF                                               07570000
071400         ELSE                                                     07580000
071500             MOVE ZEROS TO PV-AMT                                 07590000
071600         END-IF                                                   07600000
071700     END-IF.                                                      07610000
071800                                                                  07620000
071900**************************************************************    07630000
072000 1300-PROCESS-TUPCPLS-STR-CSR.                                    07640000
072100     SET  PS-NOT-EOF-TUPCPLS-STR-CSR TO TRUE.                     07650000
072110     PERFORM 1310-OPEN-TUPCPLS-STR-CSR.                           07660000
072111     PERFORM 1320-FETCH-TUPCPLS-STR-CSR                           07670000
072112             UNTIL PS-EOF-TUPCPLS-STR-CSR.                        07680000
072113     PERFORM 1330-CLOSE-TUPCPLS-STR-CSR.                          07690000
072114*                                                                 07700000
072115 1310-OPEN-TUPCPLS-STR-CSR.                                       07710000
072116                                                                  07720000
072117     MOVE '1310-OPEN-TUPCPLS-STR-CSR' TO PV-ABEND-PARAGRAPH.      07730000
072118                                                                  07740000
072119     EXEC SQL                                                     07750000
072120         OPEN TUPCPLS-STR-CSR                                     07760000
072130     END-EXEC.                                                    07770000
072140                                                                  07780000
072150     EVALUATE TRUE                                                07790000
072160         WHEN SQLCODE = +0                                        07800000
072170             CONTINUE                                             07810000
072180         WHEN OTHER                                               07820000
072190              PERFORM Z999-SQL-ERROR                              07830000
072200     END-EVALUATE.                                                07840000
072300                                                                  07850000
072400                                                                  07860000
072500 1320-FETCH-TUPCPLS-STR-CSR.                                      07870000
072600     MOVE '1320-FETCH-TUPCPLS-STR-CSR' TO PV-ABEND-PARAGRAPH.     07880000
072700     DISPLAY ' 1320-FETCH-TUPCPLS  * '                            07890000
072800                                                                  07900000
072900     EXEC SQL                                                     07910000
073000          FETCH TUPCPLS-STR-CSR                                   07920000
073100           INTO :UPCPLS-UNT-RTL-AMT                               07930000
073200              , :UPCPLS-EFF-END-TMST                              07940000
073300              , :UPCPLS-MEITGP-NBR                                07950000
073400     END-EXEC.                                                    07960000
073500                                                                  07970000
073600     EVALUATE TRUE                                                07980000
073700         WHEN SQLCODE = +0                                        07990000
073800         WHEN SQLCODE = -305                                      08000000
073900             SET PS-EOF-TUPCPLS-STR-CSR TO TRUE                   08010000
074000         WHEN OTHER                                               08020000
074100              PERFORM Z999-SQL-ERROR                              08030000
074200     END-EVALUATE.                                                08040000
074300                                                                  08050000
074400 1330-CLOSE-TUPCPLS-STR-CSR.                                      08060000
074500     MOVE '1330-CLOSE-TUPCPLS-STR-CSR' TO PV-ABEND-PARAGRAPH.     08070000
074600     EXEC SQL                                                     08080000
074700         CLOSE TUPCPLS-STR-CSR                                    08090000
074800     END-EXEC.                                                    08100000
074900*                                                                 08110000
075000     EVALUATE TRUE                                                08120000
075100         WHEN SQLCODE = +0                                        08130000
075200             CONTINUE                                             08140000
075300         WHEN OTHER                                               08150000
075400              PERFORM Z999-SQL-ERROR                              08160000
075500     END-EVALUATE.                                                08170000
075600******************************************************************08180000
075700 1350-PRCS-UPCPLS-RCVR-CSR.                                       08190000
075800     SET PS-NOT-EOF-TUPCPLS-RCVR-CSR TO TRUE.                     08200000
075900     PERFORM 1360-OPEN-RCVR-CSR.                                  08210000
076000     PERFORM 1370-FETCH-RCVR-CSR                                  08220000
076100             UNTIL PS-EOF-TUPCPLS-RCVR-CSR.                       08230000
076200     PERFORM 1380-CLOSE-RCVR-CSR.                                 08240000
076300******************************************************************08250000
076400 1360-OPEN-RCVR-CSR.                                              08260000
076500                                                                  08270000
076600     MOVE '1360-OPEN-RCVR-CSR' TO PV-ABEND-PARAGRAPH.             08280000
076700                                                                  08290000
076800     EXEC SQL                                                     08300000
076900         OPEN TUPCPLS-RCVR-CSR                                    08310000
077000     END-EXEC.                                                    08320000
077100                                                                  08330000
077200     EVALUATE TRUE                                                08340000
077300         WHEN SQLCODE = +0                                        08350000
077400             CONTINUE                                             08360000
077500         WHEN OTHER                                               08370000
077600              PERFORM Z999-SQL-ERROR                              08380000
077700     END-EVALUATE.                                                08390000
077800                                                                  08400000
077900 1370-FETCH-RCVR-CSR.                                             08410000
078000                                                                  08420000
078100     MOVE '1370-FETCH-RCVR-CSR' TO PV-ABEND-PARAGRAPH.            08430000
078200     DISPLAY  '1370-FETCH-RCVR-CSR'                               08440000
078300                                                                  08450000
078400     EXEC SQL                                                     08460000
078500          FETCH TUPCPLS-RCVR-CSR                                  08470000
078600           INTO :UPCPLS-UNT-RTL-AMT                               08480000
078700              , :UPCPLS-EFF-END-TMST                              08490000
078800              , :UPCPLS-MEITGP-NBR                                08500000
078900     END-EXEC.                                                    08510000
079000                                                                  08520000
079100     EVALUATE TRUE                                                08530000
079200         WHEN SQLCODE = +0                                        08540000
079300         WHEN SQLCODE = -305                                      08550000
079400             SET PS-EOF-TUPCPLS-RCVR-CSR TO TRUE                  08560000
079500         WHEN OTHER                                               08570000
079600              PERFORM Z999-SQL-ERROR                              08580000
079700     END-EVALUATE.                                                08590000
079800 1380-CLOSE-RCVR-CSR.                                             08600000
079900                                                                  08610000
080000     MOVE '1380-CLOSE-RCVR-CSR' TO PV-ABEND-PARAGRAPH.            08620000
080100                                                                  08630000
080200     EXEC SQL                                                     08640000
080300         CLOSE TUPCPLS-RCVR-CSR                                   08650000
080400     END-EXEC.                                                    08660000
080500*                                                                 08670000
080600     EVALUATE TRUE                                                08680000
080700         WHEN SQLCODE = +0                                        08690000
080800             CONTINUE                                             08700000
080900         WHEN OTHER                                               08710000
081000              PERFORM Z999-SQL-ERROR                              08720000
081100     END-EVALUATE.                                                08730000
081200*                                                                 08740000
081300******************************************************************08750000
081400 1400-PRCESS-UPCPLS-CNSTK-CSR.                                    08760000
081500     SET PS-NOT-EOF-TUPCPLS-CNSTK-CSR TO TRUE.                    08770000
081600     PERFORM 1410-OPEN-TUPCPLS-CNSTK-CSR.                         08780000
081700     PERFORM 1420-FETCH-TUPCPLS-CNSTK-CSR                         08790000
081800             UNTIL PS-EOF-TUPCPLS-CNSTK-CSR.                      08800000
081900     PERFORM 1430-CLOSE-TUPCPLS-CNSTK-CSR.                        08810000
082000*                                                                 08820000
082100 1410-OPEN-TUPCPLS-CNSTK-CSR.                                     08830000
082200                                                                  08840000
082300     MOVE '1410-OPEN-TUPCPLS-CNSTK-CSR' TO PV-ABEND-PARAGRAPH.    08850000
082400                                                                  08860000
082500     EXEC SQL                                                     08870000
082600         OPEN TUPCPLS-CNSTK-CSR                                   08880000
082700     END-EXEC.                                                    08890000
082800                                                                  08900000
082900     EVALUATE TRUE                                                08910000
083000         WHEN SQLCODE = +0                                        08920000
083100             CONTINUE                                             08930000
083200         WHEN OTHER                                               08940000
083300              PERFORM Z999-SQL-ERROR                              08950000
083400     END-EVALUATE.                                                08960000
083500*                                                                 08970000
083600 1420-FETCH-TUPCPLS-CNSTK-CSR.                                    08980000
083700                                                                  08990000
083800     MOVE '1420-FETCH-TUPCPLS-CNSTK-CSR' TO PV-ABEND-PARAGRAPH.   09000000
083900     DISPLAY '1420-FETCH-TUPCPLS-CNSTK-CSR'.                      09010000
084000                                                                  09020000
084100     EXEC SQL                                                     09030000
084200          FETCH TUPCPLS-CNSTK-CSR                                 09040000
084300           INTO :UPCPLS-UNT-RTL-AMT                               09050000
084400              , :UPCPLS-EFF-END-TMST                              09060000
084500              , :UPCPLS-MEITGP-NBR                                09070000
084600     END-EXEC.                                                    09080000
084700                                                                  09090000
084800     EVALUATE TRUE                                                09100000
084900         WHEN SQLCODE = +0                                        09110000
085000         WHEN SQLCODE = -305                                      09120000
085100             SET PS-EOF-TUPCPLS-CNSTK-CSR TO TRUE                 09130000
085200         WHEN OTHER                                               09140000
085300              PERFORM Z999-SQL-ERROR                              09150000
085400     END-EVALUATE.                                                09160000
085500 1430-CLOSE-TUPCPLS-CNSTK-CSR.                                    09170000
085600                                                                  09180000
085700     MOVE '1430-CLOSE-TUPCPLS-CNSTK-CSR' TO PV-ABEND-PARAGRAPH.   09190000
085800                                                                  09200000
085900     EXEC SQL                                                     09210000
086000         CLOSE TUPCPLS-CNSTK-CSR                                  09220000
086100     END-EXEC.                                                    09230000
086200                                                                  09240000
086300     EVALUATE TRUE                                                09250000
086400         WHEN SQLCODE = +0                                        09260000
086500             CONTINUE                                             09270000
086600         WHEN OTHER                                               09280000
086700              PERFORM Z999-SQL-ERROR                              09290000
086800     END-EVALUATE.                                                09300000
086900*                                                                 09310000
087000***************************************************************** 09320000
087100 1500-CREATE-EXTRACT-RECORD.                                      09330000
087200***************************************************************** 09340000
087300     MOVE '1500-CREATE-EXTRACT-RECORD' TO PV-ABEND-PARAGRAPH.     09350000
087400*                                                                 09360000
087500     INITIALIZE RC048-PRICE-DIFFERENCES.                          09370000
087600*                                                                 09380000
            MOVE PV-CURRENT-CC            TO RC048-VERIFY-CC            09390001
            MOVE SE-DV-MM                 TO RC048-VERIFY-MM            09400001
            MOVE SE-DV-DD                 TO RC048-VERIFY-DD            09410001
            MOVE SE-DV-YY                 TO RC048-VERIFY-YY            09420001
087600*                                                                 09430001
087700     IF SE-RETAIL-UNITS-MARK = +0                                 09440000
087800         ADD +1 TO PV-RECORDS-ZERO-MARK                           09450000
087900         ADD +1 TO PV-RECORDS-NOT-WRITTEN                         09460000
088000     ELSE                                                         09470000
088100         IF PS-SKU-NOT-FOUND                                      09480000
088200             MOVE SE-PO           TO RC048-PO                     09490000
088300             MOVE SE-REC-SEQ-NBR  TO RC048-REC-SEQ-NBR            09500000
088400             MOVE SE-POLINENO     TO RC048-POLINENO               09510000
088500             MOVE SE-LOC-NBR      TO RC048-STORE                  09520000
088600             MOVE SE-DEPT         TO RC048-DEPT                   09530000
088700             MOVE SE-CLASS        TO RC048-CLASS                  09540000
088800             MOVE SE-SKU-NBR      TO RC048-SKU-NBR                09550000
088900             MOVE SE-LOWEST-RETAIL TO RC048-PO-UNIT-RETAIL        09560000
089000             MOVE ZEROES          TO RC048-STORE-UNIT-RETAIL      09570000
089100             MOVE 'SKU NOT FOUND' TO RC048-SKU-STATUS             09580000
089200             MOVE 'SKU NOT FOUND' TO RC048-RETAIL-STATUS          09590000
089300             MOVE SE-RETAIL-UNITS-MARK                            09600000
089400                              TO RC048-RETAIL-UNITS-MARK          09610000
089500             WRITE EXTRACT-RECORD                                 09620000
089600               FROM RC048-PRICE-DIFFERENCES                       09630000
089700             ADD +1 TO PV-RECORDS-WRITTEN                         09640000
089800         ELSE                                                     09650000
089900             IF PS-NO-UPC-PRICE                                   09660000
090000                 IF XL001-UNT-RTL-AMT NOT = SE-LOWEST-RETAIL      09670000
090100                     MOVE SE-PO           TO RC048-PO             09680000
090200                     MOVE SE-REC-SEQ-NBR  TO RC048-REC-SEQ-NBR    09690000
090300                     MOVE SE-POLINENO     TO RC048-POLINENO       09700000
090400                     MOVE SE-LOC-NBR      TO RC048-STORE          09710000
090500                     MOVE SE-DEPT         TO RC048-DEPT           09720000
090600                     MOVE SE-CLASS        TO RC048-CLASS          09730000
090700                     MOVE SE-SKU-NBR      TO RC048-SKU-NBR        09740000
090800                     MOVE SE-LOWEST-RETAIL TO                     09750000
090900                          RC048-PO-UNIT-RETAIL                    09760000
091000                     MOVE XL001-UNT-RTL-AMT                       09770000
091100                                      TO RC048-STORE-UNIT-RETAIL  09780000
091200                     PERFORM 1510-SET-SKU-STATUS                  09790000
091300                     PERFORM 1520-SET-RETAIL-STATUS               09800000
091400                     MOVE SE-RETAIL-UNITS-MARK                    09810000
091500                                      TO RC048-RETAIL-UNITS-MARK  09820000
091600                     WRITE EXTRACT-RECORD                         09830000
091700                       FROM RC048-PRICE-DIFFERENCES               09840000
091800                     ADD +1 TO PV-RECORDS-WRITTEN                 09850000
091900                 ELSE                                             09860000
092000                     ADD +1 TO PV-RECORDS-NOT-WRITTEN             09870000
092100                 END-IF                                           09880000
092200             ELSE                                                 09890000
092300                 IF UPCPLS-UNT-RTL-AMT NOT = SE-LOWEST-RETAIL     09900000
092400                     MOVE SE-PO           TO RC048-PO             09910000
092500                     MOVE SE-REC-SEQ-NBR  TO RC048-REC-SEQ-NBR    09920000
092600                     MOVE SE-POLINENO     TO RC048-POLINENO       09930000
092700                     MOVE SE-LOC-NBR      TO RC048-STORE          09940000
092800                     MOVE SE-DEPT         TO RC048-DEPT           09950000
092900                     MOVE SE-CLASS        TO RC048-CLASS          09960000
093000                     MOVE SE-SKU-NBR      TO RC048-SKU-NBR        09970000
093100                     MOVE SE-LOWEST-RETAIL TO                     09980000
093200                          RC048-PO-UNIT-RETAIL                    09990000
093300                     MOVE UPCPLS-UNT-RTL-AMT                      10000000
093400                                       TO RC048-STORE-UNIT-RETAIL 10010000
093500                     PERFORM 1510-SET-SKU-STATUS                  10020000
093600                     PERFORM 1520-SET-RETAIL-STATUS               10030000
093700                     MOVE SE-RETAIL-UNITS-MARK                    10040000
093800                                       TO RC048-RETAIL-UNITS-MARK 10050000
093900                     WRITE EXTRACT-RECORD                         10060000
094000                       FROM RC048-PRICE-DIFFERENCES               10070000
094100                     ADD +1 TO PV-RECORDS-WRITTEN                 10080000
094200                 ELSE                                             10090000
094300                     ADD +1 TO PV-RECORDS-NOT-WRITTEN             10100000
094400                 END-IF                                           10110000
094500             END-IF                                               10120000
094600         END-IF                                                   10130000
094700     END-IF.                                                      10140000
094800*                                                                 10150000
094900*                                                                 10160000
095000***************************************************************** 10170000
095100 1510-SET-SKU-STATUS.                                             10180000
095200***************************************************************** 10190000
095300*                                                                 10200000
095400     EVALUATE XL001-STR-SKU-STAT-CDE                              10210000
095500       WHEN +10                                                   10220000
095600         MOVE 'NEW            ' TO RC048-SKU-STATUS               10230000
095700       WHEN +20                                                   10240000
095800         MOVE 'ACTIVE         ' TO RC048-SKU-STATUS               10250000
095900       WHEN +25                                                   10260000
096000         MOVE 'MIXED          ' TO RC048-SKU-STATUS               10270000
096100       WHEN +30                                                   10280000
096200         MOVE 'CLEARANCE      ' TO RC048-SKU-STATUS               10290000
096300       WHEN +40                                                   10300000
096400         MOVE 'PROMOTIONAL    ' TO RC048-SKU-STATUS               10310000
096500       WHEN +90                                                   10320000
096600         MOVE 'DISCONTINUED   ' TO RC048-SKU-STATUS               10330000
096700       WHEN +98                                                   10340000
096800         MOVE 'RENUMBERED     ' TO RC048-SKU-STATUS               10350000
096900       WHEN OTHER                                                 10360000
097000         MOVE 'UNKNOWN        ' TO RC048-SKU-STATUS               10370000
097100     END-EVALUATE.                                                10380000
097200*                                                                 10390000
097300*                                                                 10400000
097400***************************************************************** 10410000
097500 1520-SET-RETAIL-STATUS.                                          10420000
097600***************************************************************** 10430000
097700*                                                                 10440000
097800     IF PS-NO-UPC-PRICE                                           10450000
097900         EVALUATE XL001-STR-SKU-STAT-CDE                          10460000
098000           WHEN +10                                               10470000
098100             MOVE 'NEW            ' TO RC048-RETAIL-STATUS        10480000
098200           WHEN +20                                               10490000
098300             MOVE 'ACTIVE         ' TO RC048-RETAIL-STATUS        10500000
098400           WHEN +25                                               10510000
098500             MOVE 'REGIONAL       ' TO RC048-RETAIL-STATUS        10520000
098600           WHEN +30                                               10530000
098700             MOVE 'CLEARANCE      ' TO RC048-RETAIL-STATUS        10540000
098800           WHEN +40                                               10550000
098900             MOVE 'PROMOTIONAL    ' TO RC048-RETAIL-STATUS        10560000
099000           WHEN +90                                               10570000
099100             MOVE 'DISCONTINUED   ' TO RC048-RETAIL-STATUS        10580000
099200           WHEN +98                                               10590000
099300             MOVE 'RENUMBERED     ' TO RC048-RETAIL-STATUS        10600000
099400           WHEN OTHER                                             10610000
099500             MOVE 'UNKNOWN        ' TO RC048-RETAIL-STATUS        10620000
099600         END-EVALUATE                                             10630000
099700     ELSE                                                         10640000
099800         EVALUATE UPCPLS-UPC-STAT-CDE                             10650000
099900           WHEN '10'                                              10660000
100000             MOVE 'NEW            ' TO RC048-RETAIL-STATUS        10670000
100100           WHEN '20'                                              10680000
100200             MOVE 'ACTIVE         ' TO RC048-RETAIL-STATUS        10690000
100300           WHEN '25'                                              10700000
100400             MOVE 'MIXED          ' TO RC048-RETAIL-STATUS        10710000
100500           WHEN '30'                                              10720000
100600             MOVE 'CLEARANCE      ' TO RC048-RETAIL-STATUS        10730000
100700           WHEN '40'                                              10740000
100800             MOVE 'PROMOTIONAL    ' TO RC048-RETAIL-STATUS        10750000
100900           WHEN '90'                                              10760000
101000             MOVE 'DISCONTINUED   ' TO RC048-RETAIL-STATUS        10770000
101100           WHEN '98'                                              10780000
101200             MOVE 'RENUMBERED     ' TO RC048-RETAIL-STATUS        10790000
101300           WHEN OTHER                                             10800000
101400             MOVE 'UNKNOWN        ' TO RC048-RETAIL-STATUS        10810000
101500         END-EVALUATE                                             10820000
101600     END-IF.                                                      10830000
101700*                                                                 10840000
101800 1600-GET-GROUP-PRICE.                                            10850000
101900***************************************************************** 10860000
102000*  THIS PARAGRAPH WILL BE USED TO RETRIEVE THE GROUP PRICE        10870000
102100*  FROM THE GROUP PRICE RETAIL TABLE.                             10880000
102200***************************************************************** 10890000
102300     MOVE '1600-GET-GROUP-PRICE    ' TO PV-ABEND-PARAGRAPH.       10900000
102400*                                                                 10910000
102500     INITIALIZE DCLTMITGPL.                                       10920000
102600     SET PS-GROUP-PRICE-FOUND TO TRUE.                            10930000
102700*                                                                 10940000
102800     EXEC SQL                                                     10950000
102900       SELECT  A.MITGPL_QTY                                       10960000
103000            ,  A.GP_AMT                                           10970000
103100         INTO  :MITGPL-MITGPL-QTY                                 10980000
103200            ,  :MITGPL-GP-AMT                                     10990000
103300         FROM  TMITGPL A                                          11000000
103400        WHERE  A.OPERCO_NBR = '03'                                11010000
103500          AND  A.MEITGP_NBR = :DK-MEITGP-NBR                      11020000
103600          AND  A.ADLOC_ID = '   '                                 11030000
103700     END-EXEC.                                                    11040000
103800                                                                  11050000
103900     EVALUATE TRUE                                                11060000
104000       WHEN SQLCODE = ZEROS                                       11070000
104100         MOVE DK-MEITGP-NBR TO PV-MEITGP-NBR                      11080000
104200       WHEN SQLCODE = +100                                        11090000
104300         SET PS-NO-GROUP-PRICE-FOUND TO TRUE                      11100000
104400         MOVE ZERO TO PV-MEITGP-NBR                               11110000
104500       WHEN OTHER                                                 11120000
104600         PERFORM Z999-SQL-ERROR                                   11130000
104700     END-EVALUATE.                                                11140000
104800                                                                  11150000
104900*                                                                 11160000
105000***************************************************************** 11170000
105100 2000-READ-INPUT-FILE.                                            11180000
105200***************************************************************** 11190000
105300     MOVE '2000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       11200000
105400*                                                                 11210000
105500     READ DAILY-STORE-FILE                                        11220000
105600       INTO STORE-EXTRACT-LINE                                    11230000
105700         AT END                                                   11240000
105800           SET PS-END-OF-INPUT TO TRUE.                           11250000
105900*                                                                 11260000
106000*                                                                 11270000
106100***************************************************************** 11280000
106200 Z999-SQL-ERROR.                                                  11290000
106300***************************************************************** 11300000
106400                                                                  11310000
106500     MOVE SQLCODE TO PV-SQLCODE.                                  11320000
106600     DISPLAY '*** DB2 ERROR '.                                    11330000
106700     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       11340000
106800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11350000
106900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11360000
107000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11370000
107100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11380000
107200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       11390000
107300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       11400000
107400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             11410000
107500                                                                  11420000
107600     IF PV-ABEND-STRUCTURE-2 > SPACES                             11430000
107700         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          11440000
107800     END-IF.                                                      11450000
107900                                                                  11460000
108000                                                                  11470000
108100     COPY DPPD004.                                                11480000
108200                                                                  11490000
108300                                                                  11500000
108400     MOVE +4013                  TO PV-ABEND-CODE.                11510000
108500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11520000
